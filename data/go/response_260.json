[{"tags": ["http", "go"], "comments": [{"owner": {"reputation": 19, "user_id": 12556135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d4797f41b84e6b0f4653231c9209bfe?s=128&d=identicon&r=PG&f=1", "display_name": "user72840184", "link": "https://stackoverflow.com/users/12556135/user72840184"}, "reply_to_user": {"reputation": 449279, "user_id": 65863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/f00013ceab8fb1928885c5c172fbfd4a?s=128&d=identicon&r=PG", "display_name": "Remy Lebeau", "link": "https://stackoverflow.com/users/65863/remy-lebeau"}, "edited": false, "score": 0, "creation_date": 1577835546, "post_id": 59549142, "comment_id": 105267379, "body": "Yes, typo. I&#39;ll update the question"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577837141, "post_id": 59549142, "comment_id": 105267560, "body": "@d681 See <a href=\"https://play.golang.org/p/buHCoJxxeyJ\" rel=\"nofollow noreferrer\">play.golang.org/p/buHCoJxxeyJ</a> where %2F is handled correctly.  How are you testing the URLs? Is the middleware, apphandler or testhandler returning the 404?"}, {"owner": {"reputation": 19, "user_id": 12556135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d4797f41b84e6b0f4653231c9209bfe?s=128&d=identicon&r=PG&f=1", "display_name": "user72840184", "link": "https://stackoverflow.com/users/12556135/user72840184"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577839610, "post_id": 59549142, "comment_id": 105267812, "body": "Turns out I had an outdated version of Gorilla mux. Works now"}, {"owner": {"reputation": 407, "user_id": 9192769, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61c7f1df276fb87bd11ca67f20f8eb63?s=128&d=identicon&r=PG&f=1", "display_name": "Dils Matchanov", "link": "https://stackoverflow.com/users/9192769/dils-matchanov"}, "edited": false, "score": 1, "creation_date": 1577867954, "post_id": 59549142, "comment_id": 105270837, "body": "mark it as solved then"}], "owner": {"reputation": 19, "user_id": 12556135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d4797f41b84e6b0f4653231c9209bfe?s=128&d=identicon&r=PG&f=1", "display_name": "user72840184", "link": "https://stackoverflow.com/users/12556135/user72840184"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1577835586, "creation_date": 1577835327, "last_edit_date": 1577835586, "question_id": 59549142, "link": "https://stackoverflow.com/questions/59549142/router-returns-404-for-encoded-slash-2f", "title": "Router returns 404 for encoded slash (%2F)", "body": "<p>I have a simple http server and passing in a url such as:</p>\n\n<p><code>http://localhost:8000/test/bob%2Fvanderlen</code></p>\n\n<p>where <code>%2F</code> is the encoded form of <code>/</code>. I am using Gorilla mux for routing and have:</p>\n\n<p><code>router := mux.NewRouter().StrictSlash(true).UseEncodedPath()</code></p>\n\n<p>My route:</p>\n\n<p><code>router.NewRoute().Name(\"test\").Methods(\"GET\").Path(\"/test/{name}\").Handler(\n        f.middleware(appHandler(f.testHandler)),\n    )</code></p>\n\n<p>When I hit the above url, I get a <code>404 Not Found</code>. Taking out the <code>%2F</code> gives me a <code>200</code> status.</p>\n\n<p>From <a href=\"https://github.com/gorilla/mux/issues/77\" rel=\"nofollow noreferrer\">this issue</a> it seems like adding <code>UseEncodedPath()</code> is the answer but it still doesn't work. What am I missing?</p>\n"}, {"tags": ["templates", "go", "go-templates"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577824258, "post_id": 59548190, "comment_id": 105265496, "body": "You can&#39;t. If you want to iterate keys/values in a template, use a <code>map</code>, not a <code>struct</code>."}, {"owner": {"reputation": 1453, "user_id": 1697349, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/w8L7g.jpg?s=128&g=1", "display_name": "joeButler", "link": "https://stackoverflow.com/users/1697349/joebutler"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577824670, "post_id": 59548190, "comment_id": 105265578, "body": "So would you recommend converting the struct to something like a map[string]interface - where the key is the member name?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577825216, "post_id": 59548190, "comment_id": 105265695, "body": "That&#39;s really your choice to make. Personally it seems extremely unlikely to me that you&#39;ll end up with an application where you use the same template to render a bunch of different objects and just want to list all their fields in arbitrary order with no special formatting or behavior at all. That sounds like debugging, which I would probably just use JSON or something for. So, it seems like just using structs with different templates is the sane long-term solution. But it&#39;s your project, you know it better than anyone on SO will, it&#39;s your design decision to make."}], "answers": [{"comments": [{"owner": {"reputation": 1453, "user_id": 1697349, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/w8L7g.jpg?s=128&g=1", "display_name": "joeButler", "link": "https://stackoverflow.com/users/1697349/joebutler"}, "edited": false, "score": 0, "creation_date": 1577826327, "post_id": 59548342, "comment_id": 105265883, "body": "Thanks - the second approach was what I needed. from within Go gin framework you can add template functions in at the router/engine  \trouter := gin.Default() \trouter.SetFuncMap(template.FuncMap{ \t\t&quot;field&quot;: field, \t})"}], "tags": [], "owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "is_accepted": true, "score": 1, "last_activity_date": 1577826011, "last_edit_date": 1577826011, "creation_date": 1577825266, "answer_id": 59548342, "question_id": 59548190, "link": "https://stackoverflow.com/questions/59548190/access-struct-member-by-name-in-go-template/59548342#59548342", "title": "Access struct member by name in Go template", "body": "<p>Create a template function that returns the struct field names and values as a map:</p>\n\n<pre><code>// fields returns map of field names and values for struct s.\nfunc fields(s interface{}) (map[string]interface{}, error) {\n    v := reflect.Indirect(reflect.ValueOf(s))\n    if v.Kind() != reflect.Struct {\n        return nil, fmt.Errorf(\"%T is not a struct\", s)\n    }\n    m := make(map[string]interface{})\n    t := v.Type()\n    for i := 0; i &lt; t.NumField(); i++ {\n        sv := t.Field(i)\n        m[sv.Name] = v.Field(i).Interface()\n    }\n    return m, nil\n}\n</code></pre>\n\n<p>Specify the function when parsing the file:</p>\n\n<pre><code>t, err := template.New(\"\").Funcs(template.FuncMap{\"fields\": fields}).ParseFiles(\"table.gohtml\")\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Use it like this:</p>\n\n<pre><code>{{range $i, $v :=  .Model}}\n&lt;tr&gt;\n    {{$m := fields $v}}\n    {{range $key, $value := $fields}}\n       &lt;td&gt;{{index $m $value}}&lt;/td&gt;\n    {{end}}\n&lt;/tr&gt;\n{{end}}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/bgBU33H65D2\" rel=\"nofollow noreferrer\">Run it on the playground</a>.</p>\n\n<p>Another approach is to write a function that looks up a field by name:</p>\n\n<pre><code>func field(s interface{}, k string) (interface{}, error) {\n    v := reflect.Indirect(reflect.ValueOf(s))\n    if v.Kind() != reflect.Struct {\n        return nil, fmt.Errorf(\"%T is not a struct\", s)\n    }\n    v = v.FieldByName(k)\n    if !v.IsValid() {\n        return nil, fmt.Errorf(\"no field in %T with name %s\", s, k)\n    }\n    return v.Interface(), nil\n}\n</code></pre>\n\n<p>Parse with the function:</p>\n\n<pre><code>t, err := template.New(\"\").Funcs(template.FuncMap{\"field\": field}).ParseFiles(\"table.gohtml\")\n</code></pre>\n\n<p>Use it like this:</p>\n\n<pre><code>{{range $i, $v :=  .Model}}\n&lt;tr&gt;\n    {{range $key, $value := $fields}}\n       &lt;td&gt;{{field $v $value}}&lt;/td&gt;\n    {{end}}\n&lt;/tr&gt;\n{{end}}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/bgBU33H65D2\" rel=\"nofollow noreferrer\">Run it on the playground</a>.</p>\n"}], "owner": {"reputation": 1453, "user_id": 1697349, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/w8L7g.jpg?s=128&g=1", "display_name": "joeButler", "link": "https://stackoverflow.com/users/1697349/joebutler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 59548342, "answer_count": 1, "score": 0, "last_activity_date": 1577828855, "creation_date": 1577823759, "last_edit_date": 1577828855, "question_id": 59548190, "link": "https://stackoverflow.com/questions/59548190/access-struct-member-by-name-in-go-template", "title": "Access struct member by name in Go template", "body": "<p>I'm hoping to create a common/generic Go html template which will produce a standard html table based on its inputs. I had hoped to look up the struct members by name, but I haven't been able to make this work.</p>\n\n<p>I've had a look around and I can't find a solution, so I'm either missing something obvious, or the approach is wrong. In this respect I would accept a solution which showed an alternate or better approach which avoids trying this lookup.</p>\n\n<p>Example Template:</p>\n\n<pre><code>{{ $fields := .FieldMap }}\n&lt;table&gt;\n    &lt;thead&gt;\n    &lt;tr&gt;\n    {{ range $key, $value := $fields }}\n        &lt;th&gt;{{ $key }}&lt;/th&gt;\n    {{ end }}\n    &lt;/tr&gt;\n\n    &lt;/thead&gt;\n    &lt;tbody&gt;\n    {{ range $i, $v :=  .Model }}\n    &lt;tr&gt;\n        {{ $rowData := . }}\n{{/* FAILS: error calling index: can't index item of type main.Person  &lt;td&gt; {{ index . \"FirstName\"}}&lt;/td&gt;*/}}\n        {{ range $key, $value := $fields }}\n\n{{/* FAILS: error calling index: can't index item of type main.Person   &lt;td&gt; {{ index $rowData $value }}&lt;/td&gt;*/}}\n{{/* FAILS: bad character U+0024 '$'                                    &lt;td&gt; {{ $rowData.$value }}&lt;/td&gt;*/}}\n        {{ end }}\n    &lt;/tr&gt;\n    {{ end }}\n    &lt;/tbody&gt;\n&lt;/table&gt;\n</code></pre>\n\n<p>Example Go:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"html/template\"\n    \"os\"\n)\n\ntype Person struct {\n    FirstName string\n    LastName string\n}\n\ntype Animal struct {\n    Species string\n}\n\ntype TemplateData struct {\n    Model interface{}\n    FieldMap map[string]string\n}\n\nfunc main() {\n    t, err := template.ParseFiles(\"table.gohtml\")\n    if err != nil {\n        panic(err)\n    }\n\n    // Here we use Person, but I may want to pass other types of struct to the template, for example \"Animal\"\n    dataPerson := TemplateData{\n        Model: []Person{\n            {\n                FirstName: \"Test\",\n                LastName:  \"Template\",\n            },\n        },\n        FieldMap: map[string]string{\"First\": \"FirstName\", \"Last\": \"LastName\"},\n    }\n\n    err = t.Execute(os.Stdout, dataPerson)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>I hope its clear what I am trying to do - have a single template which I can reuse across various types of struct.</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577805257, "post_id": 59545793, "comment_id": 105260404, "body": "What is <code>go-temp</code>? That&#39;s not a valid module name, as the error says. Go modules also shouldn&#39;t have <code>pkg</code> or <code>src</code> directories. Can you provide more info on your module structure?"}, {"owner": {"reputation": 375, "user_id": 6155813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CpWi2nVr_fQ/AAAAAAAAAAI/AAAAAAAAADY/VF9PXDitHuk/photo.jpg?sz=128", "display_name": "Ali Bedaer", "link": "https://stackoverflow.com/users/6155813/ali-bedaer"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577806631, "post_id": 59545793, "comment_id": 105260865, "body": "it&#39;s the directory that contain all the packages , it&#39;s an old project built  before go module ."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1577806837, "post_id": 59545793, "comment_id": 105260950, "body": "Even before modules, no import should have <code>pkg</code> or <code>src</code> in it. So it&#39;s still unclear what your project/module structure is."}], "answers": [{"tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": false, "score": -1, "last_activity_date": 1577818830, "last_edit_date": 1577818830, "creation_date": 1577811861, "answer_id": 59546790, "question_id": 59545793, "link": "https://stackoverflow.com/questions/59545793/how-to-migrate-already-exist-golang-project-from-go-path-to-go-module/59546790#59546790", "title": "how to migrate already exist golang project from go path to go module", "body": "<p>A simple <code>go mod init PROJECT_NAME</code> into the directory can be enough. Then <code>go clean</code> and <code>go build</code></p>\n\n<p><code>go-temp</code> have to be a go module created using <code>go mod init go-temp</code>. Than you need to import it using the <code>go.mod</code> file. </p>\n\n<p>NOTE: i don't know if \"go-temp\" is a valid name, probably the bar into name is not allowed.</p>\n"}], "owner": {"reputation": 375, "user_id": 6155813, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CpWi2nVr_fQ/AAAAAAAAAAI/AAAAAAAAADY/VF9PXDitHuk/photo.jpg?sz=128", "display_name": "Ali Bedaer", "link": "https://stackoverflow.com/users/6155813/ali-bedaer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1234, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1577818830, "creation_date": 1577805188, "question_id": 59545793, "link": "https://stackoverflow.com/questions/59545793/how-to-migrate-already-exist-golang-project-from-go-path-to-go-module", "title": "how to migrate already exist golang project from go path to go module", "body": "<p>i have an already exist golang project want to migrate it to go mod, i followed this article <a href=\"https://blog.golang.org/migrating-to-go-modules\" rel=\"nofollow noreferrer\">migrate to go modules</a> but the problem here is i get this error every time i try to run or build the project </p>\n\n<blockquote>\n  <p>cannot load go-temp/pkg/custom_package: malformed module path \"go-temp/pkg/custom_package\": missing dot in first path element</p>\n</blockquote>\n\n<p><strong>custom_package</strong> is an internal package and imported in several other packages </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code> import (\n    \"github.com/gin-gonic/gin\"\n    \"github.com/joho/godotenv\"\n    \"go-temp/pkg/custom_package\"\n    \"go-temp/src/another_package\"\n    \"go-temp/src/routes\"\n    \"log\"\n    \"os\"\n   )\n</code></pre>\n\n<p>how to solve this problem without walking through all this packages and change them from relative path to absolute path start with the module domain </p>\n"}, {"tags": ["go", "reflect"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1577801518, "post_id": 59545133, "comment_id": 105259172, "body": "You properly used <code>Elem()</code> in your first example but not in the 2nd. Without calling <code>Elem()</code>, you only have a pointer value and not a struct value."}, {"owner": {"reputation": 3, "user_id": 12632422, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DbJ3ihitzes/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reLJ5FWJvpF4tUwF2cua_UgKfItLQ/photo.jpg?sz=128", "display_name": "qin ray", "link": "https://stackoverflow.com/users/12632422/qin-ray"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1578028988, "post_id": 59545133, "comment_id": 105314399, "body": "So I need a addressable value &lt;- Values := reflect.ValueOf(obj).Elem() &lt;- obj must be a pointer &lt;- pass a pointer to the obj param like &quot;SetStringField2(&amp;student)&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 327, "user_id": 5177327, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oE7n0.png?s=128&g=1", "display_name": "Donutloop", "link": "https://stackoverflow.com/users/5177327/donutloop"}, "is_accepted": false, "score": 0, "last_activity_date": 1577804548, "creation_date": 1577804548, "answer_id": 59545678, "question_id": 59545133, "link": "https://stackoverflow.com/questions/59545133/how-to-update-all-string-fields-of-arbitrary-go-struct/59545678#59545678", "title": "How to update all string fields of arbitrary go struct?", "body": "<p>Solution 1:</p>\n\n<p><a href=\"https://i.stack.imgur.com/zjfg7.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/zjfg7.png\" alt=\"enter image description here\"></a></p>\n\n<pre><code>package service\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"testing\"\n)\n\n\nfunc SetStringField2(obj interface{}) {\n    Values := reflect.ValueOf(obj).Elem()\n    count := reflect.Indirect(reflect.ValueOf(obj)).NumField()\n    for i := 0; i &lt; count; i++ {\n        fieldValue := Values.Field(i)\n        switch fieldValue.Kind() {\n        case reflect.String:\n            fieldValue.SetString(\"fieldCleanString2 set name\")\n        }\n    }\n}\n\nfunc TestSetValue(t *testing.T) {\n\n    type Student struct {\n        Name string\n        Age  int\n    }\n    student := &amp;Student{\n        \"alice\",\n        12,\n    }\n\n    SetStringField2(student)\n\n    fmt.Print(student.Name)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "is_accepted": true, "score": 1, "last_activity_date": 1577809184, "creation_date": 1577809184, "answer_id": 59546408, "question_id": 59545133, "link": "https://stackoverflow.com/questions/59545133/how-to-update-all-string-fields-of-arbitrary-go-struct/59546408#59546408", "title": "How to update all string fields of arbitrary go struct?", "body": "<p>The problem is that the reflect value is not settable. To fix this issue, create the reflect value from a pointer.  </p>\n\n<pre><code>// SetStringField2 sets strings fields on the struct pointed to by ps.\nfunc SetStringField2(ps interface{}) {\n    v := reflect.ValueOf(ps).Elem() // Elem() dereferences pointer\n    for i := 0; i &lt; v.NumField(); i++ {\n        fv := v.Field(i)\n        switch fv.Kind() {\n        case reflect.String:\n            fv.SetString(\"fieldCleanString2 set name\")\n        }\n    }\n}\n</code></pre>\n\n<p>Pass a pointer to the value to the function:</p>\n\n<pre><code>student := Student{\n    \"alice\",\n    12,\n}\nSetStringField2(&amp;student)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/LfWdfJfBxjC\" rel=\"nofollow noreferrer\">Run it on the playground</a>.</p>\n"}], "owner": {"reputation": 3, "user_id": 12632422, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-DbJ3ihitzes/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reLJ5FWJvpF4tUwF2cua_UgKfItLQ/photo.jpg?sz=128", "display_name": "qin ray", "link": "https://stackoverflow.com/users/12632422/qin-ray"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 0, "accepted_answer_id": 59546408, "answer_count": 2, "score": 0, "last_activity_date": 1577809184, "creation_date": 1577801370, "question_id": 59545133, "link": "https://stackoverflow.com/questions/59545133/how-to-update-all-string-fields-of-arbitrary-go-struct", "title": "How to update all string fields of arbitrary go struct?", "body": "<p>I try to write a function to update all string fields of <strong>arbitrary</strong> structs, like this:</p>\n\n<pre><code>type Student struct {\n  Name  string\n  Age   int\n}\n\nfunc SetStringField(obj interface{}) {\n    reflect.ValueOf(obj).Elem().FieldByName(\"Name\").SetString(\"set name\")\n}\n\nfunc main() {\n  student := Student{\n    \"alice\",\n    12,\n  }\n\n  SetStringField(&amp;student)\n}\n</code></pre>\n\n<p>but this func can only update specific field. And I try this:</p>\n\n<pre><code>\nfunc SetStringField2(obj interface{}) {\n    // Keys := reflect.TypeOf(obj)\n    Values := reflect.ValueOf(obj)\n    count := reflect.ValueOf(obj).NumField()\n    for i := 0; i &lt; count; i++ {\n        // fieldKey := Keys.Field(i).Name\n        fieldValue := Values.Field(i)\n        switch fieldValue.Kind() {\n        case reflect.String:\n            // fieldValue.CanSet()==false\n            fieldValue.SetString(\"fieldCleanString2 set name\")\n            // panic: reflect: call of reflect.Value.FieldByName on interface Value\n            // reflect.ValueOf(&amp;obj).Elem().FieldByName(fieldKey).SetString(\"123\")\n        }\n    }\n}\n\nfunc main() {\n  student := Student{\n    \"alice\",\n    12,\n  }\n  SetStringField2(student)\n}\n</code></pre>\n\n<ol>\n<li>fieldValue.SetString() got \"panic: reflect: reflect.flag.mustBeAssignable using unaddressable value\" because fieldValue.CanSet()==false.</li>\n<li>reflect.ValueOf(&amp;obj).Elem().FieldByName(fieldKey).SetString(\"fieldCleanString2 set name\") also fail, got \"panic: reflect: call of reflect.Value.FieldByName on interface Value\".</li>\n</ol>\n\n<p>And calling SetStringField2(&amp;student) got \"panic: reflect: call of reflect.Value.NumField on ptr Value\"</p>\n\n<p>So, are there any other methods to do this work?</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1577804134, "post_id": 59544780, "comment_id": 105260032, "body": "&quot;Some bright developer thought that every module must have a dot(.) in their module name.&quot; Because some bright developer actually understood how Go imports were meant to be used - they&#39;re meant to be <code>go get</code>-able, not just arbitrary directories on disk."}, {"owner": {"reputation": 163, "user_id": 4227545, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/52e478d8a6fc5120448c3b5229de3431?s=128&d=identicon&r=PG&f=1", "display_name": "deepg", "link": "https://stackoverflow.com/users/4227545/deepg"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1577805471, "post_id": 59544780, "comment_id": 105260482, "body": "@Adrian dont get mad at me! Its very individualistic policy.Just to give an example its like unless you wear a red pyjamas at the party you wont get food vs you wear anything you want..come to the party..we will give you red pyjamas and you have food then... Go assumes some-one is going to write the modules push it to the repository and I am going to work on it ... it doesnt assume (however it gives mechanism to work with it) that I can create multiple random modules on the disk without trying to push them anywhere!"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1577806701, "post_id": 59544780, "comment_id": 105260901, "body": "Correct. That is how Go modules work. The (entirely reasonable) assumption is that any software project will have a repository. Usually the first step in any software project beyond a throw-away single-file script is to create a repository for it, so it shouldn&#39;t be a problem. If you&#39;re making a complex, multi-module, inter-dependent software project and you don&#39;t have a repository, the problem isn&#39;t Go modules&#39; support for arbitrary local modules, it&#39;s that you&#39;re not using source control."}], "answers": [{"comments": [{"owner": {"reputation": 163, "user_id": 4227545, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/52e478d8a6fc5120448c3b5229de3431?s=128&d=identicon&r=PG&f=1", "display_name": "deepg", "link": "https://stackoverflow.com/users/4227545/deepg"}, "edited": false, "score": 1, "creation_date": 1577803395, "post_id": 59544844, "comment_id": 105259778, "body": "thanks for the solution...but is this even viable? I thought the whole idea of import is that I as a developer would be abstracted away from all the dependencies of the module I am importing. Lets say I have a big project where there are 10-12 hierarchy and I want to consume the latest . I have to include each of my imported libraries&#39; dependencies!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 163, "user_id": 4227545, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/52e478d8a6fc5120448c3b5229de3431?s=128&d=identicon&r=PG&f=1", "display_name": "deepg", "link": "https://stackoverflow.com/users/4227545/deepg"}, "edited": false, "score": 1, "creation_date": 1577803952, "post_id": 59544844, "comment_id": 105259974, "body": "@deepg This is only needed if the modules you use have <code>replace</code> directives which otherwise should only be used for testing / local development. When you publish a module, it should have no dependencies on local packages not being part of the module. Using such modules you have nothing to do: you just import them and the <code>go</code> tool and module system resolves all dependencies automatically."}, {"owner": {"reputation": 163, "user_id": 4227545, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/52e478d8a6fc5120448c3b5229de3431?s=128&d=identicon&r=PG&f=1", "display_name": "deepg", "link": "https://stackoverflow.com/users/4227545/deepg"}, "edited": false, "score": 1, "creation_date": 1577805832, "post_id": 59544844, "comment_id": 105260593, "body": "Thanks @icza for the detailed explanation. It really helped. Just to be honest . Go brings very new perspective from development POV. However the documentation fails to highlight the nuances of it. Don&#39;t get me wrong there are loads of information lurking within those lines , but its like a pearl within an ocean."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 163, "user_id": 4227545, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/52e478d8a6fc5120448c3b5229de3431?s=128&d=identicon&r=PG&f=1", "display_name": "deepg", "link": "https://stackoverflow.com/users/4227545/deepg"}, "edited": false, "score": 0, "creation_date": 1577806746, "post_id": 59544844, "comment_id": 105260916, "body": "@deepg There are a lot to be covered, so a single, few page documentation cannot possible cover everything anybody would ever need. The official home page is always a good starting point, which also covers this (added as the 2nd quote). Stackoverflow is also a good place to ask what you cannot find or understand."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1577806700, "last_edit_date": 1577806700, "creation_date": 1577799591, "answer_id": 59544844, "question_id": 59544780, "link": "https://stackoverflow.com/questions/59544780/how-to-resolve-transitive-dependencies-of-local-modules/59544844#59544844", "title": "How to resolve transitive dependencies of local modules", "body": "<p><a href=\"https://github.com/golang/go/wiki/Modules#gomod\" rel=\"nofollow noreferrer\">Go Wiki: Modules: go.mod</a></p>\n\n<blockquote>\n  <p><code>exclude</code> and <code>replace</code> directives only operate on the current (\u201cmain\u201d) module. <strong><code>exclude</code> and <code>replace</code> directives in modules other than the main module are ignored when building the main module.</strong> The <code>replace</code> and <code>exclude</code> statements, therefore, allow the main module complete control over its own build, without also being subject to complete control by dependencies. (See FAQ <a href=\"https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive\" rel=\"nofollow noreferrer\">below</a> for a discussion of when to use a <code>replace</code> directive).</p>\n</blockquote>\n\n<p>And also in <a href=\"https://golang.org/cmd/go/#hdr-The_main_module_and_the_build_list\" rel=\"nofollow noreferrer\">Command go: The main module and the build list:</a></p>\n\n<blockquote>\n  <p>The main module's go.mod file defines the precise set of packages available for use by the go command, through require, replace, and exclude statements. Dependency modules, found by following require statements, also contribute to the definition of that set of packages, but only through their go.mod files' require statements: <strong>any replace and exclude statements in dependency modules are ignored</strong>. The replace and exclude statements therefore allow the main module complete control over its own build, without also being subject to complete control by dependencies.</p>\n</blockquote>\n\n<p>Package <code>a</code> is not found when building the module <code>c</code>, so the <code>go</code> tool tries to resolve it, tries to download it. That's why it tries to interpret the package name as something that should start with a host name.</p>\n\n<p>You do not need to rename package <code>a</code> to <code>example.com/a</code>, but you must add a <code>replace</code> directive to <code>c</code>'s <code>go.mod</code> where you tell where the package <code>a</code> is located.</p>\n"}], "owner": {"reputation": 163, "user_id": 4227545, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/52e478d8a6fc5120448c3b5229de3431?s=128&d=identicon&r=PG&f=1", "display_name": "deepg", "link": "https://stackoverflow.com/users/4227545/deepg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1559, "favorite_count": 0, "accepted_answer_id": 59544844, "answer_count": 1, "score": 1, "last_activity_date": 1577815908, "creation_date": 1577799216, "last_edit_date": 1577815908, "question_id": 59544780, "link": "https://stackoverflow.com/questions/59544780/how-to-resolve-transitive-dependencies-of-local-modules", "title": "How to resolve transitive dependencies of local modules", "body": "<p>Inside some random folder, there are 3 folders a, b, c. Each of these folders contain a mod file.</p>\n\n<p>The mod files contains are the following .  </p>\n\n<p>go.mod inside a</p>\n\n<pre><code>module a\n\ngo 1.13\n</code></pre>\n\n<p>go.mod inside b</p>\n\n<pre><code>module b\ngo 1.13\nrequire a v0.0.0\nreplace a v0.0.0 =&gt; ./../a\n</code></pre>\n\n<p>go.mod inside c </p>\n\n<pre><code>module c\ngo 1.13\nrequire b v0.0.0\nreplace b v0.0.0 =&gt; ./../b\n</code></pre>\n\n<p>Module b throws no error. But module c throws error</p>\n\n<pre><code>go: b@v0.0.0 requires\na@v0.0.0: unrecognized import path \"a\" (import path does not begin with hostname)\n</code></pre>\n\n<p>Every module must have a dot(.) in their module name.</p>\n\n<p>'Some random folder' changes to example.com. Now example.com named folder contains all the a.b.c folders. Here is how the modules look now</p>\n\n<p>Module A looks like </p>\n\n<pre><code>module example.com/a\ngo 1.13\n</code></pre>\n\n<p>Module B looks like</p>\n\n<pre><code>module example.com/b\ngo 1.13\nrequire example.com/a v0.0.0\nreplace example.com/a v0.0.0 =&gt; ../a\n</code></pre>\n\n<p>Module C looks like</p>\n\n<pre><code>module example.com/c\ngo 1.13\nrequire example.com/b v0.0.0\nreplace example.com/b v0.0.0 =&gt; ../b\n</code></pre>\n\n<p>Too bad!   Error!</p>\n\n<pre><code>go: example.com/b@v0.0.0 requires\nexample.com/a@v0.0.0: unrecognized import path \"example.com/a\" (https fetch: Get \nhttps://example.com/a?go-get=1: dial tcp 208.73.210.202:443: connect: connection refused)\n</code></pre>\n\n<p>How does the transitive dependency for local modules work?\nWhy is Go hitting example.com to bring the modules?\nWhat is going on?</p>\n"}, {"tags": ["go", "bitwise-operators"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1577806942, "last_edit_date": 1577806942, "creation_date": 1577797644, "answer_id": 59544516, "question_id": 59544360, "link": "https://stackoverflow.com/questions/59544360/bitwise-not-to-how-to-do-without-ffffffff/59544516#59544516", "title": "Bitwise not to how to do without ffffffff", "body": "<p>You get a lot of leading <code>ff</code> because your <code>a</code> number in fact is only 32-bit \"large\" but is used \"within\" a 64-bit <code>uint64</code> value. (You're processing numbers with 8 hex digits = 4 bytes data = 32 bit.) It has 4 leading 0 bytes, which when negated will turn into <code>ff</code>. You can verify this with:</p>\n\n<pre><code>fmt.Printf(\"a %#x\\n\",a)\n</code></pre>\n\n<p>Outputs:</p>\n\n<pre><code>a 0x38382434\n</code></pre>\n\n<p>To get rid of those leading <code>ff</code>, convert the result to <code>uint32</code>:</p>\n\n<pre><code>xh := strconv.FormatUint(uint64(uint32(^a)), 16)\nfmt.Println(xh)\n</code></pre>\n\n<p>(Converting back to <code>uint64</code> is because <a href=\"https://golang.org/pkg/strconv/#FormatUint\" rel=\"nofollow noreferrer\"><code>strconv.FormatUint()</code></a> expects / requires <code>uint64</code>.)</p>\n\n<p>This outputs:</p>\n\n<pre><code>c7c7dbcb\n</code></pre>\n\n<p>Another option is to apply a <code>0xffffffff</code> bitmask:</p>\n\n<pre><code>xh = strconv.FormatUint(^a&amp;0xffffffff, 16)\nfmt.Println(xh)\n</code></pre>\n\n<p>Also note that you could print it using <a href=\"https://golang.org/pkg/fmt/#Printf\" rel=\"nofollow noreferrer\"><code>fmt.Printf()</code></a> (or <a href=\"https://golang.org/pkg/fmt/#Sprintf\" rel=\"nofollow noreferrer\"><code>fmt.Sprintf()</code></a> if you need it as a <code>string</code>) where you specify <code>%08x</code> verb which also adds leading zeros should the input has more than 3 leading 0 bits (and thus <code>strconv.FormatUint()</code> would not add leading hex zeros):</p>\n\n<pre><code>fmt.Printf(\"%08x\", uint32(^a))\n</code></pre>\n\n<p>This outputs the same. Try the examples on the <a href=\"https://play.golang.org/p/JyrEiApON1y\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 21, "user_id": 7589126, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cbf3dc4a04054837835a010e114e985?s=128&d=identicon&r=PG&f=1", "display_name": "akahhor", "link": "https://stackoverflow.com/users/7589126/akahhor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 59544516, "answer_count": 1, "score": 1, "last_activity_date": 1577815997, "creation_date": 1577796595, "last_edit_date": 1577815997, "question_id": 59544360, "link": "https://stackoverflow.com/questions/59544360/bitwise-not-to-how-to-do-without-ffffffff", "title": "Bitwise not to how to do without ffffffff", "body": "<p>When doing bitwise not, get a lot ffffffff. How to do correctly?</p>\n\n<pre><code>    space := \"    \"\n    str := \"12345678999298765432179.170.184.81\"\n\n    sp := len(str) % 4\n    if sp &gt; 0 {\n        str = str + space[0:4-sp]\n    }\n    fmt.Println(str, len(str))\n\n    hx := hex.EncodeToString([]byte(str))\n    ln := len(hx)\n    a, _ := strconv.ParseUint(hx[0:8], 16, 0)\n    for i := 8; i &lt; ln; i += 8 {\n        b, _ := strconv.ParseUint(hx[i:i+8], 16, 0)\n        a = a ^ b\n    }\n\n    xh := strconv.FormatUint(^a, 16)\n    fmt.Println(xh)\n</code></pre>\n\n<p>output\nffffffffc7c7dbcb</p>\n\n<p>I need only\nc7c7dbcb</p>\n"}, {"tags": ["go", "url-routing", "httphandler", "go-gin"], "answers": [{"comments": [{"owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "edited": false, "score": 0, "creation_date": 1577980805, "post_id": 59551539, "comment_id": 105300521, "body": "In the end this worked. I updated to <a href=\"https://github.com/gin-gonic/gin/commit/352d69c71f45d51971f2d23f5c4450c6410aa481\" rel=\"nofollow noreferrer\">github.com/gin-gonic/gin/commit/&hellip;</a> and used the default value of <code>RemoveExtraSlash</code> (<code>false</code>) to keep my desired behavior."}], "tags": [], "owner": {"reputation": 780, "user_id": 10619575, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/00c8cf5318b13db75d2fc82d724ee406?s=128&d=identicon&r=PG&f=1", "display_name": "Anton B&#228;rwald", "link": "https://stackoverflow.com/users/10619575/anton-b%c3%a4rwald"}, "is_accepted": true, "score": 1, "last_activity_date": 1577873069, "creation_date": 1577873069, "answer_id": 59551539, "question_id": 59544026, "link": "https://stackoverflow.com/questions/59544026/how-to-control-behavior-for-missing-url-params-in-gin-1-4-0/59551539#59551539", "title": "How to control behavior for missing URL params in gin 1.4.0+?", "body": "<p>I found out that the problem is the internal <code>cleanPath()</code> function with the following documentation:  </p>\n\n<blockquote>\n  <p>...  The following rules are applied iteratively until no further\n  processing can  be done:</p>\n  \n  <ol>\n  <li>Replace multiple slashes with a single slash. </li>\n  </ol>\n  \n  <p><a href=\"https://github.com/gin-gonic/gin/blob/59ab588bf597f9f41faee4f217b5659893c2e925/path.go#L13\" rel=\"nofollow noreferrer\">reference</a></p>\n</blockquote>\n\n<p>And if you checkout the latest master branch on Github there is a configuration called <a href=\"https://github.com/gin-gonic/gin/blob/59ab588bf597f9f41faee4f217b5659893c2e925/gin.go#L141\" rel=\"nofollow noreferrer\">RemoveExtraSlash</a> and is false by default. The <code>RemoveExtraSlash</code> by default will not call <code>cleanPath()</code><a href=\"https://github.com/gin-gonic/gin/blob/59ab588bf597f9f41faee4f217b5659893c2e925/gin.go#L394\" rel=\"nofollow noreferrer\">here</a>. </p>\n\n<p>What I can see this was added Nov 28 and the latest commit for <code>1.5.0</code> was Nov 24. </p>\n\n<p>What you can do is download the source from <a href=\"https://github.com/gin-gonic/gin.git\" rel=\"nofollow noreferrer\">GitHub</a>:</p>\n\n<pre><code>git clone https://github.com/gin-gonic/gin.git /home/user/projects/gin\n</code></pre>\n\n<p>Then do a replace at the end of your go.mod file. When there is a new release you can just remove the line:</p>\n\n<pre><code>replace github.com/gin-gonic/gin =&gt; /home/user/projects/gin\n</code></pre>\n"}], "owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 678, "favorite_count": 0, "accepted_answer_id": 59551539, "answer_count": 1, "score": 0, "last_activity_date": 1577873069, "creation_date": 1577794518, "question_id": 59544026, "link": "https://stackoverflow.com/questions/59544026/how-to-control-behavior-for-missing-url-params-in-gin-1-4-0", "title": "How to control behavior for missing URL params in gin 1.4.0+?", "body": "<p>I'm working on migrating from <code>1.3.0</code> to <code>1.4.0</code> (or <code>1.5.0</code>) and I've discovered that <code>1.3.0</code> for the following snippet</p>\n\n<pre><code>router := gin.New()\nrouter.GET(\"/func/:id/details\", func(c *gin.Context) {\n    value := c.Param(\"id\")\n    fmt.Printf(\"value is %v\\n\", value)\n})\n</code></pre>\n\n<p>Would always get to the handler even when requesting <code>/func//details</code> (note the missing URL <code>param</code>) whereas <code>1.4.0</code> and above will return <code>404</code>.</p>\n\n<p>Is it possible to control this behavior? (to work the same way as it worked in <code>1.3.0</code>?)</p>\n\n<p>I've tried using <a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.BindUri\" rel=\"nofollow noreferrer\"><code>BindUri</code></a> introduced in <code>1.5.0</code></p>\n\n<pre><code>func main() {\n    type Params struct {\n        ID string `uri:\"id\" binding:\"required\"`\n    }\n    router := gin.New()\n    router.GET(\"/func/:id/details\", func(c *gin.Context) {\n        var pp Params\n        if err := c.BindUri(&amp;pp); err != nil {\n            log.Errorf(\"failed binding: %v\", err)\n            c.Status(http.StatusBadRequest)\n            return\n        }\n\n        log.Printf(\"params %+v\\n\", pp)\n    })\n\n    if err := router.Run(\"localhost:8080\"); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>But this also fails (with <code>404</code>) when called.</p>\n"}, {"tags": ["sorting", "go"], "comments": [{"owner": {"reputation": 148, "user_id": 9412770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/180638fcbff29a7cf03172b5b0815fe6?s=128&d=identicon&r=PG&f=1", "display_name": "radix", "link": "https://stackoverflow.com/users/9412770/radix"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577791106, "post_id": 59543209, "comment_id": 105255733, "body": "I only wanted to ask if I&#39;m using the sort slice function right"}, {"owner": {"reputation": 148, "user_id": 9412770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/180638fcbff29a7cf03172b5b0815fe6?s=128&d=identicon&r=PG&f=1", "display_name": "radix", "link": "https://stackoverflow.com/users/9412770/radix"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577792190, "post_id": 59543209, "comment_id": 105256096, "body": "How do I sort the entire outer slice (CombinedRooms), based on values from []Rooms?"}, {"owner": {"reputation": 148, "user_id": 9412770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/180638fcbff29a7cf03172b5b0815fe6?s=128&d=identicon&r=PG&f=1", "display_name": "radix", "link": "https://stackoverflow.com/users/9412770/radix"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577793303, "post_id": 59543209, "comment_id": 105256455, "body": "minimum value in the slice"}], "answers": [{"comments": [{"owner": {"reputation": 148, "user_id": 9412770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/180638fcbff29a7cf03172b5b0815fe6?s=128&d=identicon&r=PG&f=1", "display_name": "radix", "link": "https://stackoverflow.com/users/9412770/radix"}, "edited": false, "score": 0, "creation_date": 1577795113, "post_id": 59543587, "comment_id": 105257069, "body": "Thank you but the other answer was working as expected in multiple conditions"}], "tags": [], "owner": {"reputation": 880, "user_id": 8203644, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3FgKzkxl4L0/AAAAAAAAAAI/AAAAAAAAAEk/Il97o9zDpaw/photo.jpg?sz=128", "display_name": "shahin mahmud", "link": "https://stackoverflow.com/users/8203644/shahin-mahmud"}, "is_accepted": false, "score": 2, "last_activity_date": 1577793360, "last_edit_date": 1577793360, "creation_date": 1577792054, "answer_id": 59543587, "question_id": 59543209, "link": "https://stackoverflow.com/questions/59543209/sorting-multidimensional-slices/59543587#59543587", "title": "Sorting Multidimensional slices", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n    \"strconv\"\n)\n\ntype Rooms struct {\n    Type  string\n    Total string\n}\n\nfunc main() {\n    CombinedRooms := [][]Rooms{\n        {Rooms{Type: \"c\", Total: \"2\"}, Rooms{Type: \"b\", Total: \"1\"}, Rooms{Type: \"f\", Total: \"10\"}},\n        {Rooms{Type: \"d\", Total: \"5\"}, Rooms{Type: \"a\", Total: \"0\"}},\n    }\n    fmt.Println(CombinedRooms)\n\n    for i, _ := range CombinedRooms {\n        sort.Slice(CombinedRooms[i], func(j, k int) bool {\n            netRateJ, _ := strconv.Atoi(CombinedRooms[i][j].Total)\n            netRateK, _ := strconv.Atoi(CombinedRooms[i][k].Total)\n            return netRateJ &lt; netRateK\n        })\n    }\n    fmt.Println(CombinedRooms)\n\n    sort.Slice(CombinedRooms[:], func(i, j int) bool {\n        for x := range CombinedRooms[i] {\n            netRateJ, _ := strconv.Atoi(CombinedRooms[i][x].Total)\n            netRateK, _ := strconv.Atoi(CombinedRooms[j][x].Total)\n            if netRateJ == netRateK {\n                continue\n            }\n            return netRateJ &lt; netRateK\n        }\n        return false\n    })\n    fmt.Println(CombinedRooms)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/F3ba054z14V\" rel=\"nofollow noreferrer\">playground link</a></p>\n\n<p>I understand your problem now, above solutions tries to sort the slices by comparing each internal slices elements to order the internal slices in outer slices(in which inner slice elements should be sorted). If you want better than that, i believe you have to flat the slices and sort that.</p>\n"}, {"tags": [], "owner": {"reputation": 163, "user_id": 10547264, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b30c862a9d857e96da3d2e7e4b227f4c?s=128&d=identicon&r=PG&f=1", "display_name": "Riya John", "link": "https://stackoverflow.com/users/10547264/riya-john"}, "is_accepted": true, "score": 0, "last_activity_date": 1577793875, "creation_date": 1577793875, "answer_id": 59543915, "question_id": 59543209, "link": "https://stackoverflow.com/questions/59543209/sorting-multidimensional-slices/59543915#59543915", "title": "Sorting Multidimensional slices", "body": "<p>Your example <a href=\"https://play.golang.org/p/yyGygJyqtkn\" rel=\"nofollow noreferrer\">https://play.golang.org/p/yyGygJyqtkn</a> is correctly sorting the inner slices, it is printing the same output as the inner slices have the same values. However if you also want to sort CombinedRooms based on inner slices' values, add below code:</p>\n\n<pre><code>sort.Slice(CombinedRooms, func(j, k int) bool {\n            netRateJ, _ := strconv.Atoi(CombinedRooms[j][0].Total)\n            netRateK, _ := strconv.Atoi(CombinedRooms[k][0].Total)\n            return netRateJ &lt; netRateK\n    })\n</code></pre>\n\n<p>Find working code here <a href=\"https://play.golang.org/p/LLCeJdlE-hM\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LLCeJdlE-hM</a></p>\n"}], "owner": {"reputation": 148, "user_id": 9412770, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/180638fcbff29a7cf03172b5b0815fe6?s=128&d=identicon&r=PG&f=1", "display_name": "radix", "link": "https://stackoverflow.com/users/9412770/radix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 59543915, "answer_count": 2, "score": -4, "last_activity_date": 1577816018, "creation_date": 1577790127, "last_edit_date": 1577816018, "question_id": 59543209, "link": "https://stackoverflow.com/questions/59543209/sorting-multidimensional-slices", "title": "Sorting Multidimensional slices", "body": "<p>Wanted to sort a nested slice (asc to desc) based on int values, however the slice remains unaffected.</p>\n\n<p>Below is the short snippet of what I was trying.</p>\n\n<pre><code>type Rooms struct {\n    type   string\n    total  string\n}\n\nCombinedRooms := make([][]Rooms)\n\n// sort by price\nfor i, _ := range CombinedRooms {\n    sort.Slice(CombinedRooms[i], func(j, k int) bool {\n        netRateJ, _ := strconv.Atoi(CombinedRooms[i][j].Total)\n        netRateK, _ := strconv.Atoi(CombinedRooms[i][k].Total)\n        return netRateJ &lt; netRateK\n    })\n}\n</code></pre>\n\n<p>The Slice CombinedRooms remains unaffected even after the sorting func.</p>\n\n<p>Adding a small example: <a href=\"https://play.golang.org/p/yyGygJyqtkn\" rel=\"nofollow noreferrer\">https://play.golang.org/p/yyGygJyqtkn</a></p>\n"}, {"tags": ["mongodb", "go", "connection", "connection-pooling"], "comments": [{"owner": {"reputation": 343, "user_id": 8411263, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nLuEd7kVkpA/AAAAAAAAAAI/AAAAAAAAACI/XGfe0AyH8n8/photo.jpg?sz=128", "display_name": "Manouchehr Rasouli", "link": "https://stackoverflow.com/users/8411263/manouchehr-rasouli"}, "edited": false, "score": 0, "creation_date": 1587452374, "post_id": 59542753, "comment_id": 108509088, "body": "you don&#39;t need to use written connection pool, instead create a list of connection and refresh the connection in round robin fashion, then pass connection for each request on thin layer to crud operation."}], "answers": [{"comments": [{"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "edited": false, "score": 0, "creation_date": 1577937102, "post_id": 59543273, "comment_id": 105284492, "body": "I think I understood what you want to say. For your Note, yes all merchant&#39;s dbs are hosted on same server. But can you give me a hint for my 2nd query ?"}, {"owner": {"reputation": 464, "user_id": 4716685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60f976b0a7f6e8e3f25dc6cdd5378f3a?s=128&d=identicon&r=PG&f=1", "display_name": "reda la", "link": "https://stackoverflow.com/users/4716685/reda-la"}, "reply_to_user": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "edited": false, "score": 0, "creation_date": 1577954990, "post_id": 59543273, "comment_id": 105288890, "body": "You need to establish one connexion pool to a mongo server without giving the default DB name in the mgo.DialInfo struct, it\u2019s optional: &amp;mgo.DialInfo{         \u2026         Database:  &quot;&quot;,         \u2026     }"}, {"owner": {"reputation": 464, "user_id": 4716685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60f976b0a7f6e8e3f25dc6cdd5378f3a?s=128&d=identicon&r=PG&f=1", "display_name": "reda la", "link": "https://stackoverflow.com/users/4716685/reda-la"}, "reply_to_user": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "edited": false, "score": 0, "creation_date": 1577956064, "post_id": 59543273, "comment_id": 105289289, "body": "according to <a href=\"https://godoc.org/gopkg.in/mgo.v2#DialInfo\" rel=\"nofollow noreferrer\">godoc.org/gopkg.in/mgo.v2#DialInfo</a>: Database is the default database name used when the Session.DB method is called with an empty name, and is also used during the initial authentication if Source is unset"}, {"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "edited": false, "score": 0, "creation_date": 1577961369, "post_id": 59543273, "comment_id": 105291404, "body": "Yes its perfect. Thanks alot @reda laanait for your support! :)"}], "tags": [], "owner": {"reputation": 464, "user_id": 4716685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60f976b0a7f6e8e3f25dc6cdd5378f3a?s=128&d=identicon&r=PG&f=1", "display_name": "reda la", "link": "https://stackoverflow.com/users/4716685/reda-la"}, "is_accepted": false, "score": 4, "last_activity_date": 1577791949, "last_edit_date": 1577791949, "creation_date": 1577790447, "answer_id": 59543273, "question_id": 59542753, "link": "https://stackoverflow.com/questions/59542753/use-mongodb-connection-pooling-with-go-application/59543273#59543273", "title": "Use MongoDb Connection pooling with Go Application", "body": "<p>The problem is that you create a new connection pool in each UpdateCustomer's call, this is inconvenient and costly.</p>\n\n<p>You can use inversion of control:</p>\n\n<ul>\n<li>Prepare a connexion pool in the application setup. </li>\n<li>Inject the prepared mgo session in your model\u2019s struct (e.g MerchantDatabase)</li>\n<li>Use the injected session in your model's function calls to connect to the corresponding merchant\u2019s DB.</li>\n</ul>\n\n<p>Note: I suppose that all merchant\u2019s DBs are hosted in the same mongo server node or replica set.</p>\n"}, {"comments": [{"owner": {"reputation": 659, "user_id": 1155514, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mjZMX.jpg?s=128&g=1", "display_name": "Muhammad Tariq", "link": "https://stackoverflow.com/users/1155514/muhammad-tariq"}, "edited": false, "score": 0, "creation_date": 1605978377, "post_id": 59545555, "comment_id": 114821544, "body": "For my clarity, there is no connection pool like min,max configuration in mongo like we do it in production sql databases? We can write production apps with heavy database interaction and mongo-go-driver will automatically handle that? Is my understanding correct?  My background is in Java+sql (dbs) where we carefully configure pooling for production app, and I am working on Mongo+Go production app"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1577803747, "creation_date": 1577803747, "answer_id": 59545555, "question_id": 59542753, "link": "https://stackoverflow.com/questions/59542753/use-mongodb-connection-pooling-with-go-application/59545555#59545555", "title": "Use MongoDb Connection pooling with Go Application", "body": "<p>I'm guessing this was copied &amp; pasted from somewhere without actually understanding what it does or why it would be used:</p>\n\n<pre><code>func (MerchantDb *MerchantDatabase) UpdateCustomer(uid int, query interface{}) (err error) {\n    mongoSession := config.ConnectDb(MerchantDb.Database)\n    defer mongoSession.Close()\n\n    sessionCopy := mongoSession.Copy()\n    defer sessionCopy.Close()\n\n    getCollection := sessionCopy.DB(MerchantDb.Database).C(\"customers\")\n    err = getCollection.Update(bson.M{\"uid\": uid}, query)\n    return err\n}\n</code></pre>\n\n<p><code>mongoSession.Copy()</code> is how you would get a new session and correctly use pooling. <code>mongoSession</code> is effectively the pool. But here, you're creating a connection, creating another connection, doing your query, then closing both connections. No pooling.</p>\n\n<p>If you look at any tutorials for mgo, what you'll find is that you should create one main connection to act as your pool, and when you need a connection from the pool, you <code>Copy()</code> that main connection, use the copy as needed, then close the copy. You only close the original when the application exits (generally speaking). The original is used as a factory to create pooled connections from.</p>\n\n<p>When I Googled \"go mongo mgo connection pool\", I got these top results that explain how to do it:</p>\n\n<p><a href=\"https://www.ardanlabs.com/blog/2014/02/running-queries-concurrently-against.html\" rel=\"nofollow noreferrer\">https://www.ardanlabs.com/blog/2014/02/running-queries-concurrently-against.html</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/23223743/connections-pool-in-go-mgo-package\">Connections pool in Go mgo package</a></p>\n\n<p>However this is something of a moot point - as the <code>mgo</code> documentation and readme both state, it has been deprecated and is no longer maintained. There is now an official driver from Mongo: <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">https://github.com/mongodb/mongo-go-driver</a></p>\n"}], "owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1297, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1577803747, "creation_date": 1577787599, "question_id": 59542753, "link": "https://stackoverflow.com/questions/59542753/use-mongodb-connection-pooling-with-go-application", "title": "Use MongoDb Connection pooling with Go Application", "body": "<p>I am working on a Golang SAAS application along with Mongodb. Previously I worked with db connections without pooling. As a result of this, my db hangs on or shuts down when some traffic comes in.</p>\n\n<p>Then I get to know about connection pooling. I explored it but I have some doubts whether it will go with my application structure or not.</p>\n\n<p>I am providing here some code samples from my application.</p>\n\n<p>Function to create connection to db:</p>\n\n<pre><code>func ConnectDb(merchantDb string) (mongoSession *mgo.Session) {\n    mongoDBDialInfo := &amp;mgo.DialInfo{\n        Addrs:     []string{DatabaseIpPort},\n        Username:  DbUsername,\n        Password:  DbPassword,\n        Source:    DbSource,\n        Database:  merchantDb,\n        Timeout:   60 * time.Second,\n        PoolLimit: 4096,\n    }\n    mongoSession, err := mgo.DialWithInfo(mongoDBDialInfo)\n    if err != nil {\n        fmt.Printf(\"CreateSession: %s\\n\", err)\n        defer mongoSession.Close()\n        return mongoSession\n    }\n    mongoSession.SetMode(mgo.Monotonic, true)\n    return mongoSession\n}\n</code></pre>\n\n<p>Example of a model function which connects to db:</p>\n\n<pre><code>func (MerchantDb *MerchantDatabase) UpdateCustomer(uid int, query interface{}) (err error) {\n    mongoSession := config.ConnectDb(MerchantDb.Database)\n    defer mongoSession.Close()\n\n    sessionCopy := mongoSession.Copy()\n    defer sessionCopy.Close()\n\n    getCollection := sessionCopy.DB(MerchantDb.Database).C(\"customers\")\n    err = getCollection.Update(bson.M{\"uid\": uid}, query)\n    return err\n}\n</code></pre>\n\n<p>How I call this function:</p>\n\n<pre><code>type MerchantDatabase struct {\n    Database string\n}\nmerchantDb := MerchantDatabase{c.Keys[\"merchant_db\"].(string)}\nmerchantDb.UpdateUser(7, bson.M{\"$set\": bson.M{\"name\": \"john\"})\n</code></pre>\n\n<p>Like above code I use different model function for every query &amp; in every model function a new connection is established with mongodb. </p>\n\n<p>My queries are:</p>\n\n<ol>\n<li>I just passed PoolLimit with the existing code. Is this the way connection pool works? Or there something else?</li>\n<li>Also in my application, there are multiple databases according to merchant. Thats why I call every model function with database signature, so that it can query on that particular database. I am confused about as connection pool works as a cache of connections, can it use one merchant's database connection for other merchant's database ? If yes, how can I prevent this with connection pooling ?</li>\n<li>How can I decide the limit for connection pool for my application ?</li>\n</ol>\n\n<p>I will very grateful to receive the replies.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 969, "user_id": 1831452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b37747b2425c48e6d8b57fda11257f68?s=128&d=identicon&r=PG", "display_name": "nguyenhoai890", "link": "https://stackoverflow.com/users/1831452/nguyenhoai890"}, "edited": false, "score": 1, "creation_date": 1577761106, "post_id": 59538978, "comment_id": 105248014, "body": "<a href=\"https://play.golang.org/p/Sfl5zjIfQYp\" rel=\"nofollow noreferrer\">play.golang.org/p/Sfl5zjIfQYp</a> the behavior does not like your describe. I think you need to add more detail in your question."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1577816754, "post_id": 59538978, "comment_id": 105263865, "body": "I&#39;m not sure this is <i>off topic</i> so much as: well, you used <code>unsafe</code>, so you broke things. :-)"}], "answers": [{"tags": [], "owner": {"reputation": 146, "user_id": 11974253, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mDV7PtmCmsTe67qnXzmY6Zx0cc_Uv4fEICXq_ip=k-s128", "display_name": "Sayf Uddin Al Azad Sagor", "link": "https://stackoverflow.com/users/11974253/sayf-uddin-al-azad-sagor"}, "is_accepted": false, "score": 0, "last_activity_date": 1577761158, "creation_date": 1577761158, "answer_id": 59539086, "question_id": 59538978, "link": "https://stackoverflow.com/questions/59538978/fmt-println-can-change-the-value-of-the-array/59539086#59539086", "title": "fmt.Println can change the value of the array?", "body": "<p>Your code works fine in <code>go playground</code>.\nThe output always gives you <code>5</code>.\n<code>fmt.Println</code> doesn't change the <code>x.c[0]</code> value</p>\n\n<p>Code :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nvar x struct {\n    a bool\n    b int16\n    c []int32\n}\n\nfunc main() {\n    //a := []int32{1 &lt;&lt; 9}\n    //x.c = a\n    pb := (*[]int8)(unsafe.Pointer(uintptr(unsafe.Pointer(&amp;x)) + unsafe.Offsetof(x.c)))\n    *pb = []int8{5}\n    println(x.c[0])     // 5\n    println(x.c[0])     // 5\n    fmt.Println(x.c[0]) // 5\n    fmt.Println(x.c[0]) // 327685 why????????\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>5\n5\n5\n5\n</code></pre>\n\n<p>link: <a href=\"https://play.golang.org/p/8l1Vj9of2vR\" rel=\"nofollow noreferrer\">https://play.golang.org/p/8l1Vj9of2vR</a></p>\n"}, {"comments": [{"owner": {"reputation": 1416, "user_id": 2424594, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oS1ii.jpg?s=128&g=1", "display_name": "manish", "link": "https://stackoverflow.com/users/2424594/manish"}, "edited": false, "score": 0, "creation_date": 1577761798, "post_id": 59539108, "comment_id": 105248110, "body": "correct &amp; precise!"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 2, "last_activity_date": 1577761382, "creation_date": 1577761382, "answer_id": 59539108, "question_id": 59538978, "link": "https://stackoverflow.com/questions/59538978/fmt-println-can-change-the-value-of-the-array/59539108#59539108", "title": "fmt.Println can change the value of the array?", "body": "<p>Using <code>unsafe</code>, you placed an <code>int8</code> slice whose underlying array is allocated in stack in place of an <code>int32</code> slice. So, now you have a situation where the runtime thinks there is an array of <code>int32</code> values, but in fact the array is an array of <code>int8</code> values. So when <code>fmt.Println</code> reads from it, you read the byte containing the <code>5</code> you placed there, plus any junk that happens to be there.</p>\n\n<p>Run it a few times, with different values, and check the bit pattern. You'll get a value where the LSB is always 5. You're reading an <code>int32</code> from a memory location into which you placed an <code>int8</code> value 5. The remaining three bytes are stack leftover values.</p>\n\n<p>If you initialize your slice with <code>[]int8{5,0,0,0}</code>, you'll always get 5.</p>\n"}], "owner": {"reputation": 9, "user_id": 6048981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4792e8945dfdac49e940996bd293dfda?s=128&d=identicon&r=PG&f=1", "display_name": "linming he", "link": "https://stackoverflow.com/users/6048981/linming-he"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "closed_date": 1577780316, "answer_count": 2, "score": -2, "last_activity_date": 1577816046, "creation_date": 1577759894, "last_edit_date": 1577816046, "question_id": 59538978, "link": "https://stackoverflow.com/questions/59538978/fmt-println-can-change-the-value-of-the-array", "closed_reason": "Not suitable for this site", "title": "fmt.Println can change the value of the array?", "body": "<pre><code>var x struct {\n    a bool\n    b int16\n    c []int32\n}\n\nfunc main() {\n    //a := []int32{1 &lt;&lt; 9}\n    //x.c = a\n    pb := (*[]int8)(unsafe.Pointer(uintptr(unsafe.Pointer(&amp;x)) + unsafe.Offsetof(x.c)))\n    *pb = []int8{5}\n    println(x.c[0])  // 5\n    println(x.c[0])  // 5\n    fmt.Println(x.c[0])  // 5\n    fmt.Println(x.c[0])  // 327685 why????????\n}\n</code></pre>\n\n<p>fmt.Println the same x.c[0] twice, but got different result. why?</p>\n"}, {"tags": ["c++", "go", "named-pipes"], "comments": [{"owner": {"reputation": 29795, "user_id": 720030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ed0a5a78d65824827fb112e8e716f8?s=128&d=identicon&r=PG", "display_name": "karmakaze", "link": "https://stackoverflow.com/users/720030/karmakaze"}, "edited": false, "score": 0, "creation_date": 1577766358, "post_id": 59538860, "comment_id": 105248753, "body": "In the C reader, how many times is the <code>ReadFile</code> executed and what is the value of <code>cbRead</code> and <code>GetLastError()</code> each time? What do you see printed as received data?  Note that <code>printf(chBuf);</code> will truncate on the first zero byte of chBuf (if any would be present). Also any &#39;%&#39; characters could be misinterpreted as formatting of parameters not provided."}, {"owner": {"reputation": 41, "user_id": 12628884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9eb0ad7e0fd0885e70eef4e8a5101e3b?s=128&d=identicon&r=PG&f=1", "display_name": "Dave Smith", "link": "https://stackoverflow.com/users/12628884/dave-smith"}, "reply_to_user": {"reputation": 29795, "user_id": 720030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ed0a5a78d65824827fb112e8e716f8?s=128&d=identicon&r=PG", "display_name": "karmakaze", "link": "https://stackoverflow.com/users/720030/karmakaze"}, "edited": false, "score": 0, "creation_date": 1577819706, "post_id": 59538860, "comment_id": 105264524, "body": "The ReadFile loop is only executed once. cbRead is 4096 bytes and GetLastError() is 0. I see the characters printed normally (my test string is plain alphanumeric ASCII), but with the last part of the string missing after 4096 bytes."}, {"owner": {"reputation": 29795, "user_id": 720030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ed0a5a78d65824827fb112e8e716f8?s=128&d=identicon&r=PG", "display_name": "karmakaze", "link": "https://stackoverflow.com/users/720030/karmakaze"}, "edited": false, "score": 0, "creation_date": 1577820612, "post_id": 59538860, "comment_id": 105264722, "body": "In the Go pipe-proxy program, what are the return values from <code>io.WriteString(w, response)</code>? There could be an error there with a clue."}, {"owner": {"reputation": 41, "user_id": 12628884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9eb0ad7e0fd0885e70eef4e8a5101e3b?s=128&d=identicon&r=PG&f=1", "display_name": "Dave Smith", "link": "https://stackoverflow.com/users/12628884/dave-smith"}, "reply_to_user": {"reputation": 29795, "user_id": 720030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ed0a5a78d65824827fb112e8e716f8?s=128&d=identicon&r=PG", "display_name": "karmakaze", "link": "https://stackoverflow.com/users/720030/karmakaze"}, "edited": false, "score": 0, "creation_date": 1577852520, "post_id": 59538860, "comment_id": 105268935, "body": "OK, I have found a solution that seems to work. Before calling ReadFile, call PeekNamedPipe to get the number of bytes in the pipe. Then pass this value to the buffer size when calling ReadFile. Repeat the loop while PeekNamedPipe gets 4096 bytes. Before posting this as an answer, I will do some more testing to make sure it is effective for a wider set of conditions. I would also really like to know why ReadFile only reads the first 4096 bytes of the data. Hopefully someone with better knowledge than me of named pipes in C++ will see this and give us an answer."}, {"owner": {"reputation": 29795, "user_id": 720030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ed0a5a78d65824827fb112e8e716f8?s=128&d=identicon&r=PG", "display_name": "karmakaze", "link": "https://stackoverflow.com/users/720030/karmakaze"}, "edited": false, "score": 0, "creation_date": 1577912017, "post_id": 59538860, "comment_id": 105280467, "body": "You can achieve the same thing without PeekNamedPipe if in the original code, you just keep looping when <code>fSuccess</code> is true. You have to know how many bytes in your response body (by parsing the HTTP response headers) to know when to stop reading."}, {"owner": {"reputation": 41, "user_id": 12628884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9eb0ad7e0fd0885e70eef4e8a5101e3b?s=128&d=identicon&r=PG&f=1", "display_name": "Dave Smith", "link": "https://stackoverflow.com/users/12628884/dave-smith"}, "reply_to_user": {"reputation": 29795, "user_id": 720030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ed0a5a78d65824827fb112e8e716f8?s=128&d=identicon&r=PG", "display_name": "karmakaze", "link": "https://stackoverflow.com/users/720030/karmakaze"}, "edited": false, "score": 0, "creation_date": 1577951178, "post_id": 59538860, "comment_id": 105287708, "body": "In theory yes, but for whatever reason, the go http function does not always send the ContentLength header. I&#39;ve not looked into the reason behind this any further since the PeekNamedPipe method seems to work well."}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1577952344, "post_id": 59538860, "comment_id": 105288045, "body": "It doesn&#39;t have to send a content length. See RFC 2616 and successors. If you don&#39;t know what&#39;s in there you haven&#39;t a hope of getting this right. And <code>ReadFile()</code> is entitled to return whatever chunks it likes."}], "answers": [{"comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1577952280, "post_id": 59559870, "comment_id": 105288025, "body": "&#39;Returns 0 bytes even when there is more data in the pipe&#39; is a contradiction in terms. The only way you can know there is more data in the pipe is if it <i>doesn&#39;t</i> return zero. There is no other test."}], "tags": [], "owner": {"reputation": 41, "user_id": 12628884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9eb0ad7e0fd0885e70eef4e8a5101e3b?s=128&d=identicon&r=PG&f=1", "display_name": "Dave Smith", "link": "https://stackoverflow.com/users/12628884/dave-smith"}, "is_accepted": false, "score": 1, "last_activity_date": 1577950874, "creation_date": 1577950874, "answer_id": 59559870, "question_id": 59538860, "link": "https://stackoverflow.com/questions/59538860/c-named-pipe-client-wont-read-more-than-4096-bytes/59559870#59559870", "title": "C++ named pipe client won&#39;t read more than 4096 bytes", "body": "<p>The solution I have implemented is as follows:</p>\n\n<ul>\n<li>Call ReadFile first to get the first 4096 (or fewer) bytes. </li>\n<li>Call PeekNamedPipe to check for additional data in the pipe, and get the number of bytes (<code>cbReadPeek</code> in my case) for the next call to ReadFile. I have found that PeekNamedPipe is not 100% reliable when called once (it sometimes returns 0 bytes read, even when there is more data in the pipe). I have therefor implemented it as a <code>do {...} while ( fSuccess &amp;&amp; cbReadPeek == 0 )</code>, so it loops until there is either data to read, or fSuccess fails with an error (no more data in the pipe). </li>\n<li>Call ReadFile again if there is more data to read. If not, break the loop: <code>if (GetLastError() == ERROR_BROKEN_PIPE) { break; }</code></li>\n<li>On every ReadFile iteration, the exact number of bytes in cbRead / cbReadPeek is copied from the buffer (chBuf) and appended to a string, otherwise we end up with some of the previously read data when the bytes read drops below 4096. Or I guess the buffer could be flushed instead. </li>\n</ul>\n\n<p>Anyway, it appears to be working fine. I would still really like to know why ReadFile only reads a maximum of 4096 bytes at a time from the pipe. I could not find anything in the MS documentation for the function to explain this behaviour, but maybe I'm missing something obvious. Perhaps this question could be left open for a while to give someone a chance to see it and provide some insight? </p>\n"}], "owner": {"reputation": 41, "user_id": 12628884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9eb0ad7e0fd0885e70eef4e8a5101e3b?s=128&d=identicon&r=PG&f=1", "display_name": "Dave Smith", "link": "https://stackoverflow.com/users/12628884/dave-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1092, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1577950874, "creation_date": 1577758737, "question_id": 59538860, "link": "https://stackoverflow.com/questions/59538860/c-named-pipe-client-wont-read-more-than-4096-bytes", "title": "C++ named pipe client won&#39;t read more than 4096 bytes", "body": "<p>I am trying to implement a Windows named pipe client in C++, that will send RPC requests to a named pipe server written in Go. It all works for short server response lengths. However if the length of the server response exceeds 4096 bytes, the client will not read past 4096 bytes and the response is cut short. I have included a minimal reproducible example of the client and server code below, with most of the error handling removed for brevity. To reproduce the error, change \"some large data string\" in the server code into a string of ~5000 characters. </p>\n\n<p>I have tried the following without any luck:</p>\n\n<ul>\n<li>Setting the length of all buffers to a much larger value than 4096.</li>\n<li>Tried using both MESSAGE and BYTE mode in the client and server.</li>\n<li>Checked the http response headers: the response is not chunked.</li>\n</ul>\n\n<p>Any advice would be most appreciated. </p>\n\n<p>C++ client code:</p>\n\n<pre><code>//Minimal implementation of C++ named pipe client. Most error handling removed for brevity. \n//Adapted from https://docs.microsoft.com/en-us/windows/win32/ipc/named-pipe-client\n\n#include &lt;windows.h&gt; \n#include &lt;stdio.h&gt;\n#include &lt;conio.h&gt;\n#include &lt;tchar.h&gt;\n\n#define BUFSIZE 1048576\n\nint _tmain(int argc, TCHAR *argv[]) \n{ \n    HANDLE hPipe; \n    const char  *lpvMessage=\"POST / HTTP/1.0\\r\\nHost: localhost\\r\\nContent-Length: 33\\r\\n\\r\\n{\\\"method\\\":\\\"test\\\",\\\"params\\\":[\\\"\\\"]}\\r\\n\\n\";\n    char   chBuf[BUFSIZE]; \n    BOOL   fSuccess = FALSE; \n    DWORD  cbRead, cbToWrite, cbWritten, dwMode; \n    LPTSTR lpszPipename = TEXT(\"\\\\\\\\.\\\\pipe\\\\mypipe.ipc\"); \n\n    // Try to open a named pipe then close it - attempt 1. \n    while (1) \n    { \n        hPipe = CreateFile( \n        lpszPipename,   // pipe name \n        GENERIC_READ |  // read and write access \n        GENERIC_WRITE, \n        0,              // no sharing \n        NULL,           // default security attributes\n        OPEN_EXISTING,  // opens existing pipe \n        0,              // default attributes \n        NULL);          // no template file \n\n    // Break if the pipe handle is valid. \n        if (hPipe != INVALID_HANDLE_VALUE) \n        break; \n        // Exit if an error occurs. \n        _tprintf( TEXT(\"Could not open pipe. GLE=%d\\n\"), GetLastError() ); \n        return -1;\n    } \n    CloseHandle(hPipe);\n\n    // If successful, open pipe again for use. For some reason, pipe must be opened and closed once (attempt 1) before actually using.  \n    hPipe = CreateFile( \n    lpszPipename,   // pipe name \n    GENERIC_READ |  // read and write access \n    GENERIC_WRITE, \n    0,              // no sharing \n    NULL,           // default security attributes\n    OPEN_EXISTING,  // opens existing pipe \n    0,              // default attributes \n    NULL);          // no template file \n\n    // The pipe connected; change to message-read mode. \n    dwMode = PIPE_READMODE_MESSAGE;  //PIPE_READMODE_BYTE doesn't solve the problem either; \n    fSuccess = SetNamedPipeHandleState( \n    hPipe,    // pipe handle \n    &amp;dwMode,  // new pipe mode \n    NULL,     // don't set maximum bytes \n    NULL);    // don't set maximum time\n    if ( ! fSuccess) \n    {\n    _tprintf( TEXT(\"SetNamedPipeHandleState failed. GLE=%d\\n\"), GetLastError() ); \n    return -1;\n    }\n\n    // Send a message to the pipe server. \n    cbToWrite = (lstrlen(lpvMessage)+1)*sizeof(char);\n    fSuccess = WriteFile( \n    hPipe,                  // pipe handle \n    lpvMessage,             // message \n    cbToWrite,              // message length \n    &amp;cbWritten,             // bytes written \n    NULL);                  // not overlapped \n\n    do \n    { \n    // Read from the pipe. \n    fSuccess = ReadFile( \n    hPipe,    // pipe handle \n    chBuf,    // buffer to receive reply \n    BUFSIZE*sizeof(char),  // size of buffer \n    &amp;cbRead,  // number of bytes read \n    NULL);    // not overlapped \n\n    if ( ! fSuccess &amp;&amp; GetLastError() != ERROR_MORE_DATA )\n    break; \n\n    printf(chBuf);\n    } while ( ! fSuccess);  // repeat loop if ERROR_MORE_DATA \n\n    printf(\"\\n&lt;End of message, press ENTER to terminate connection and exit&gt;\");\n    _getch();\n    CloseHandle(hPipe); \n    return 0; \n}\n</code></pre>\n\n<p>Go server code:</p>\n\n<pre><code>//Minimal implementation of Golang named pipe server. Most error handling removed for brevity. \n// +build windows\n\npackage main\n\nimport (\n    \"github.com/Microsoft/go-winio\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"net\"\n    \"net/http\"\n    \"os\"\n)\n\nfunc main() {\n    log.Print(\"Starting IPC server...\")\n    StartIPCServer()\n}\n\nfunc HandleDefault(w http.ResponseWriter, req *http.Request) {\n    body, _ := ioutil.ReadAll(io.LimitReader(req.Body, 1048576)) \n    defer req.Body.Close()\n    log.Printf(\"Received: '%q'\", string(body))\n    response:= \"some large data string\" //If length of response plus http headers &gt;4096 bytes, client will not read past 4096.  \n    io.WriteString(w, response)\n}\n\nfunc serve(l net.Listener) error {\n    http.HandleFunc(\"/\", HandleDefault)\n    return http.Serve(l, nil)\n}\n\nfunc StartIPCServer() {\n    var c winio.PipeConfig\n    c.SecurityDescriptor = \"\"\n    c.MessageMode = true //changing to false (byte mode) does not solve the problem. \n    c.InputBufferSize = 1048576\n    c.OutputBufferSize = 1048576\n\n    path:= `\\\\.\\pipe\\mypipe.ipc`\n    listener, err := winio.ListenPipe(path, &amp;c)\n    log.Print(\"IPC server running!\")\n    defer listener.Close()\n\n    err = serve(listener)\n    if err != nil {\n        log.Fatalf(\"Serve: %v\", err)\n        os.Exit(1)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "select", "widget", "panic", "fyne"], "answers": [{"comments": [{"owner": {"reputation": 489, "user_id": 4492824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aedaea88f7da873f57b6605882571968?s=128&d=identicon&r=PG&f=1", "display_name": "Scott M", "link": "https://stackoverflow.com/users/4492824/scott-m"}, "edited": false, "score": 0, "creation_date": 1577765381, "post_id": 59537851, "comment_id": 105248613, "body": "Then I suppose I&#39;m confused. The Select must have been on the canvas because it&#39;s displayed; how could it have been drawn otherwise? But assuming you&#39;re right, I don&#39;t see how to proceed. How do I tap into right click for a variety of widgets? And is there a way to provide each widget with additional data, without resorting to a separate lookup table?"}, {"owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "reply_to_user": {"reputation": 489, "user_id": 4492824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aedaea88f7da873f57b6605882571968?s=128&d=identicon&r=PG&f=1", "display_name": "Scott M", "link": "https://stackoverflow.com/users/4492824/scott-m"}, "edited": false, "score": 0, "creation_date": 1577795780, "post_id": 59537851, "comment_id": 105257291, "body": "There will be accidentally multiple pointers associated with the custom widget. If you call ExtendBaseWidget for the overriding component it may fix the issue."}, {"owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "reply_to_user": {"reputation": 489, "user_id": 4492824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aedaea88f7da873f57b6605882571968?s=128&d=identicon&r=PG&f=1", "display_name": "Scott M", "link": "https://stackoverflow.com/users/4492824/scott-m"}, "edited": false, "score": 0, "creation_date": 1577795822, "post_id": 59537851, "comment_id": 105257311, "body": "The officially supported way to extend widgets is to embed their type in your extended version. Your code is embedding pointers which has not been tested but may work."}, {"owner": {"reputation": 489, "user_id": 4492824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aedaea88f7da873f57b6605882571968?s=128&d=identicon&r=PG&f=1", "display_name": "Scott M", "link": "https://stackoverflow.com/users/4492824/scott-m"}, "edited": false, "score": 0, "creation_date": 1577838980, "post_id": 59537851, "comment_id": 105267744, "body": "I&#39;m still not seeing a solution. I&#39;m going to abandon this question and start a new one"}, {"owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "reply_to_user": {"reputation": 489, "user_id": 4492824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aedaea88f7da873f57b6605882571968?s=128&d=identicon&r=PG&f=1", "display_name": "Scott M", "link": "https://stackoverflow.com/users/4492824/scott-m"}, "edited": false, "score": 0, "creation_date": 1577871599, "post_id": 59537851, "comment_id": 105271433, "body": "This has been answered above. I\u2019m not sure why it isn\u2019t working for you as you have not provided additional information. It is unlikely that asking the question again will get a different answer."}, {"owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "reply_to_user": {"reputation": 489, "user_id": 4492824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aedaea88f7da873f57b6605882571968?s=128&d=identicon&r=PG&f=1", "display_name": "Scott M", "link": "https://stackoverflow.com/users/4492824/scott-m"}, "edited": false, "score": 0, "creation_date": 1578753212, "post_id": 59537851, "comment_id": 105545591, "body": "It seems that there was a bug in this area, apologies. As long as you use a embedded struct, not pointer, and call ExtendBaseWidget in your new widget&#39;s constructor this should work as expected"}], "tags": [], "owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "is_accepted": false, "score": -1, "last_activity_date": 1577747776, "creation_date": 1577747776, "answer_id": 59537851, "question_id": 59537733, "link": "https://stackoverflow.com/questions/59537733/how-did-i-manage-to-panic-when-using-the-select-widget/59537851#59537851", "title": "How did I manage to panic when using the Select Widget", "body": "<p>It does not look like the select is being composed - your extended select is just creating a new one, tapping it later.</p>\n\n<p>The crash is coming from it trying to display a pop up next to a select that has not been found on the canvas.</p>\n\n<p>If you are extending builtin widgets you also need to call ExtendBaseWidget so that the driver can lookup your widget instead of the default one.\nThat said a single widget that can extend any other type of widget kind of goes against the strongly types design of Fyne APIs and you may run in to trouble.</p>\n"}, {"tags": [], "owner": {"reputation": 489, "user_id": 4492824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aedaea88f7da873f57b6605882571968?s=128&d=identicon&r=PG&f=1", "display_name": "Scott M", "link": "https://stackoverflow.com/users/4492824/scott-m"}, "is_accepted": true, "score": 1, "last_activity_date": 1579113214, "creation_date": 1579113214, "answer_id": 59757644, "question_id": 59537733, "link": "https://stackoverflow.com/questions/59537733/how-did-i-manage-to-panic-when-using-the-select-widget/59757644#59757644", "title": "How did I manage to panic when using the Select Widget", "body": "<p>This turns out to have been a Fyne bug, which has since been fixed. </p>\n"}], "owner": {"reputation": 489, "user_id": 4492824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aedaea88f7da873f57b6605882571968?s=128&d=identicon&r=PG&f=1", "display_name": "Scott M", "link": "https://stackoverflow.com/users/4492824/scott-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 231, "favorite_count": 0, "accepted_answer_id": 59757644, "answer_count": 2, "score": 0, "last_activity_date": 1579113214, "creation_date": 1577746746, "last_edit_date": 1577816070, "question_id": 59537733, "link": "https://stackoverflow.com/questions/59537733/how-did-i-manage-to-panic-when-using-the-select-widget", "title": "How did I manage to panic when using the Select Widget", "body": "<p>New to Go and Fyne, and stumbling trying to get what I need out of Fyne. Sorry, this will be long.</p>\n\n<p>My problem is this. I\u2019m writing a application that gets a list of commands from a server, telling it to create a series of widgets and display them. They are of various types \u2013 Label, Button, Entry, Select, etc. </p>\n\n<p>But these aren\u2019t standard widgets; I need to extend their behavior a bit. For one thing, when operated by the user, they each need access to some per-widget information. Button click, for example, has to reference some data specific to that button so it knows what to do. We\u2019ll call this additional information the About struct.</p>\n\n<p>Secondly, every widget needs to be able to take a right click and drop down a widget specific menu. Yes, even buttons and labels need to be able to provide drop down menus. In the case of a widget like Entry, I know this design is going to condemn me to having to write my own menu choices for Paste, Copy and the other operations Entry normally offers on a right click, but I\u2019m ok with that.</p>\n\n<p>I have all this working, but in the process I broke Select (and probably there will be breakage for other widgets.) and I can\u2019t see how to fix it.</p>\n\n<p>Problem: trying to send the Select widget causes a panic: interface conversion: fyne.Canvas is nil, not *glfw.glCanvas</p>\n\n<p>Approach:</p>\n\n<pre><code>type GenericWidget struct {\n    fyne.Widget //I\u2019m some kind of widget\n    about *About //here\u2019s my personal \u201cAbout\u201d data\n\n    //function pointers\n    OnRightClickp func(gw *GenericWidget, pe *fyne.PointEvent)\n    OnLeftClickp func(gw *GenericWidget, pe *fyne.PointEvent)\n    \u2026other \u201cfunction pointers\u201d for OnRunep and so on\u2026\n}\n</code></pre>\n\n<p>And now I have to catch all \u201cevents\u201d so GenericWidget will see them:</p>\n\n<pre><code>func (gw *GenericWidget) TappedSecondary(pe *fyne.PointEvent) {\n    if (gw.OnRightClickp != nil) {gw.OnRightClickp(gw, pe)}\n}\nfunc (gw *GenericWidget) Tapped(pe *fyne.PointEvent) {\n    if (gw.OnLeftClickp != nil){gw.OnLeftClickp(gw, pe)}\n}\n//type Focusable interface\n//etc\u2026.\n</code></pre>\n\n<p>This should represent any single widget, regardless of type. It\u2019s not complicated: When Tapped is invoked by the driver, GenericWidget.Tapped gets called. If this widget has a function pointer for \u201cOnLeftClickp\u201d set, call it. Crucially, we pass a pointer to the widget itself when that happens, because all the event handlers I write will need access to the *About and maybe anything else I add to GenericWidget.</p>\n\n<p>Creation is simple enough:</p>\n\n<pre><code>func NewGenericWidget(w fyne.Widget, about *About) *GenericWidget {\n    gw := GenericWidget{w, about, nil, nil, nil, nil, nil, nil, nil, nil}\n    return &amp;gw\n}\n</code></pre>\n\n<p>And when it\u2019s time to create a Label, I do that and fold it into a GenericWidget</p>\n\n<pre><code>func NewExtendedLabelWithStyle( //Label with catachable left and right click\n text string, \n about *About, \n alignment fyne.TextAlign, \n style fyne.TextStyle, \n tappedLeft func(*GenericWidget, *fyne.PointEvent), \n tappedRight func(*GenericWidget, *fyne.PointEvent)) *GenericWidget {\n    e := NewGenericWidget(widget.NewLabelWithStyle(text, alignment, style), about)\n    e.OnLeftClickp = tappedLeft\n    e.OnRightClickp = tappedRight\n   return e\n}\n</code></pre>\n\n<p>All these GenericWidgets work fine \u2013 I add them to the appropriate Box and the window paints as I\u2019d expect. I can right click on a label and if OnRightClickp is set, which is generally is, code gets called and is given access to *GenericWidget, which leads to *About, which means the menu that gets put up can offer all the right stuff for what\u2019s in this label.</p>\n\n<p>Of course, Labels don\u2019t normally care about clicking, so the fact that I\u2019ve stolen all the calls in Tappable doesn\u2019t matter. </p>\n\n<p>But a Select widget does care about left clicks, so the fact that GenericWidget is intercepting the call to Tapped() means I\u2019d never see the dropdown appear.</p>\n\n<p>No problem, I thought. When I create the Select widget and the surrounding GenericWidget, I\u2019ll just specify I want to call Select\u2019s Tapped myself:</p>\n\n<pre><code>func NewExtendedSelect(about *About, sel func(*GenericWidget, string)) *GenericWidget {\n    //build the options. NewSelect demands a slice of strings, so...\n    st := make([]string, 64)\n    for e := about.theList.Front(); e != nil; e = e.Next() {\n        st = append(st, e.Value.(string))\n    }\n    s := widget.NewSelect(st, func(c string){})\n    //make sure it selects the text it should, initially\n    s.SetSelected(about.value)\n    //wrap it\n    e := NewGenericWidget(s, about)\n    //e.OnChangedp = sel //not set up yet (and don\u2019t know how)\n\n    //HERE BE DRAGONS --------------\n\n    //But we don't want to break left click. So when we intercept it, \n    // pass it down to the actual Selection widget:\n    e.OnLeftClickp = func(me* GenericWidget, pe *fyne.PointEvent) {\n        fmt.Println(\"select tapped\")\n        //call the Tapped that Select knows about:\n        s.Tapped(pe) //PANIC!\n    }\n    // -----------------------------\n\n    //Handle right click with our usual menu magic\n    e.OnRightClickp =func(me* GenericWidget, pe *fyne.PointEvent) {\n        //defer used because not sure what to do with the return value, so make it Go's problem\n        defer widget.NewPopUpMenuAtPosition(me.GetRightClickMenu(), \n            me.about.sheet.window.Canvas(), pe.AbsolutePosition)\n    }\n    return e //here's your GenericWidget, ready to drop into a Fyne container.\n}\n</code></pre>\n\n<p>Compiles fine, Selects get displayed, but when I left click it prints the expected \u201cselect tapped\u201d and then immediately panics:</p>\n\n<pre><code>select tapped\npanic: interface conversion: fyne.Canvas is nil, not *glfw.glCanvas\n</code></pre>\n\n<p>I\u2019m lost. My GenericWidget is just a widget; I thought that\u2019s what composition did, and all the GenericWidgets I create are put in a Box which is in a Box which is SetContent into the window. But the error is suggesting to me that somehow this Select object wasn\u2019t set up right and when it goes to draw the options, something is missing. What did I do wrong?</p>\n\n<p>It\u2019s possible my whole approach is wrong (I do a lot of C++ and Python and I take an OO view of things). In that case, how do I do all this?</p>\n"}, {"tags": ["go", "promise", "webdriver", "chromedp"], "comments": [{"owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1577749477, "post_id": 59537265, "comment_id": 105246052, "body": "I assume that SITE_KEY is set correctly. Does the snippet work when you paste it in your browsers&#39; dev tools? You might also want to handle errors and display them somewhere you can see"}, {"owner": {"reputation": 21, "user_id": 8811558, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wWFb9NJCpuU/AAAAAAAAAAI/AAAAAAAAAAw/qnRahnQJ17w/photo.jpg?sz=128", "display_name": "Ata amini", "link": "https://stackoverflow.com/users/8811558/ata-amini"}, "reply_to_user": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1577769079, "post_id": 59537265, "comment_id": 105249271, "body": "@xarantolus <code>SITE_KEY</code> is modified, yes work fine in the devtools, but returns."}, {"owner": {"reputation": 21, "user_id": 8811558, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wWFb9NJCpuU/AAAAAAAAAAI/AAAAAAAAAAw/qnRahnQJ17w/photo.jpg?sz=128", "display_name": "Ata amini", "link": "https://stackoverflow.com/users/8811558/ata-amini"}, "reply_to_user": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1577770427, "post_id": 59537265, "comment_id": 105249487, "body": "<code>log.Println(token)</code> returns <code>map[then:map[]]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 8811558, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wWFb9NJCpuU/AAAAAAAAAAI/AAAAAAAAAAw/qnRahnQJ17w/photo.jpg?sz=128", "display_name": "Ata amini", "link": "https://stackoverflow.com/users/8811558/ata-amini"}, "edited": false, "score": 0, "creation_date": 1577818183, "post_id": 59542385, "comment_id": 105264224, "body": "Thanks @xarantolus, in fact <code>textarea</code> never been hidden and <code>WaitVisible</code> not waiting the element, it&#39;s problem is javascript <code>Promise</code>.  solution: ` (async () =&gt; { \t\t\tvar t = await grecaptcha.execute(&#39;SITE_KEY&#39;, { action: &#39;%v&#39; }).then(function(token) { return token; }); \t\t\ttextarea.value = t; \t\t\ttextarea.style.display = &#39;&#39; \t\t})() `"}], "tags": [], "owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "is_accepted": false, "score": 1, "last_activity_date": 1577785830, "creation_date": 1577785830, "answer_id": 59542385, "question_id": 59537265, "link": "https://stackoverflow.com/questions/59537265/why-promise-not-working-in-golang-chromedp/59542385#59542385", "title": "Why promise not working in golang chromedp", "body": "<p><a href=\"https://godoc.org/github.com/chromedp/chromedp#WaitVisible\" rel=\"nofollow noreferrer\"><code>WaitVisible</code></a> waits until your element is visible.</p>\n\n<p>In your line <code>textarea.style.display = 'display:none;'</code>, the CSS style is invalid and thus ignored, which means that this is the point at which your element is visible.\nThe line should be </p>\n\n<pre><code>textarea.style.display = 'none'\n</code></pre>\n\n<p>So <code>WaitVisible</code> returns at the moment after <code>document.body.appendChild(textarea);</code> is run, which means that everything after it doesn't affect the <code>token</code>.</p>\n\n<p>When you change the incorrect CSS, it should work since the element will only be made visible after the promise runs</p>\n"}], "owner": {"reputation": 21, "user_id": 8811558, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-wWFb9NJCpuU/AAAAAAAAAAI/AAAAAAAAAAw/qnRahnQJ17w/photo.jpg?sz=128", "display_name": "Ata amini", "link": "https://stackoverflow.com/users/8811558/ata-amini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1577785830, "creation_date": 1577742913, "question_id": 59537265, "link": "https://stackoverflow.com/questions/59537265/why-promise-not-working-in-golang-chromedp", "title": "Why promise not working in golang chromedp", "body": "<p>I was actually tried to execute this code in <code>golang chromedp</code>, but not working</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const inlineJavascript = `\n    var textarea = document.createElement('textarea');\n    textarea.setAttribute('id', 'recaptcha-token-container');\n    textarea.style.display = 'display:none;'\n    document.body.appendChild(textarea);\n\n    grecaptcha.execute('SITE_KEY', { action: 'login' }).then(function(token) {\n        textarea.value = token;\n        textarea.style.display = ''\n    });\n`\n</code></pre>\n\n\n\n<pre class=\"lang-js prettyprint-override\"><code>chromedp.EvaluateAsDevTools(inlineJavascript, &amp;token),\nchromedp.WaitVisible(`#recaptcha-token-container`),\nchromedp.Value(`#recaptcha-token-container`, &amp;token),\n</code></pre>\n\n\n\n<p>application wait for textarea, <code>.then</code> not working and textarea <code>never</code> showing.</p>\n"}, {"tags": ["mongodb", "go"], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 6681436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ee53c57b11d17e4162982225fe3c867?s=128&d=identicon&r=PG&f=1", "display_name": "SimonTheLeg", "link": "https://stackoverflow.com/users/6681436/simontheleg"}, "edited": false, "score": 0, "creation_date": 1577802390, "post_id": 59538770, "comment_id": 105259425, "body": "Yes with this I could convert it to string first and then to a byte slice. I&#39;ve marked the other answer as correct, because it&#39;s slightly simpler, but this works as well. Thanks!"}], "tags": [], "owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "is_accepted": false, "score": 2, "last_activity_date": 1577757962, "creation_date": 1577757962, "answer_id": 59538770, "question_id": 59537212, "link": "https://stackoverflow.com/questions/59537212/how-to-convert-mongo-insertoneresults-insertedid-to-byte/59538770#59538770", "title": "How to convert mongo.InsertOneResult&#39;s InsertedID to []byte", "body": "<p><a href=\"https://godoc.org/go.mongodb.org/mongo-driver/bson/primitive#ObjectID\" rel=\"nofollow noreferrer\">https://godoc.org/go.mongodb.org/mongo-driver/bson/primitive#ObjectID</a></p>\n\n<p>guess that's you want</p>\n\n<p>first, you can assert InsertedID to primitive.ObjectID, then convert to string or something else</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>res.InsertedID.(primitive.ObjectID).String()\nres.InsertedID.(primitive.ObjectID).Hex()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 3, "last_activity_date": 1577758210, "creation_date": 1577758210, "answer_id": 59538802, "question_id": 59537212, "link": "https://stackoverflow.com/questions/59537212/how-to-convert-mongo-insertoneresults-insertedid-to-byte/59538802#59538802", "title": "How to convert mongo.InsertOneResult&#39;s InsertedID to []byte", "body": "<p>The <code>InsertedID</code> is a <code>primitive.ObjectID</code>, which is <code>[12]byte</code>. So you can do this to get a byte slice:</p>\n\n<pre><code>oid:=res.InsertedID.(primitive.ObjectID)\nslice:=oid[:]\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 6681436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ee53c57b11d17e4162982225fe3c867?s=128&d=identicon&r=PG&f=1", "display_name": "SimonTheLeg", "link": "https://stackoverflow.com/users/6681436/simontheleg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 613, "favorite_count": 0, "accepted_answer_id": 59538802, "answer_count": 2, "score": 0, "last_activity_date": 1577758210, "creation_date": 1577742612, "question_id": 59537212, "link": "https://stackoverflow.com/questions/59537212/how-to-convert-mongo-insertoneresults-insertedid-to-byte", "title": "How to convert mongo.InsertOneResult&#39;s InsertedID to []byte", "body": "<p>Hi all I am struggling to convert the InsertedID of an InsertOne() Operation to a byte slice*. I am using this mongoDB client library <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">https://github.com/mongodb/mongo-go-driver</a></p>\n\n<hr>\n\n<p>So far I have tried to use TypeAssertion directly like this:</p>\n\n<pre><code>res.InsertedID.([]byte)\n</code></pre>\n\n<p>which compiles, but results in the following error during the assertion:</p>\n\n<blockquote>\n  <p>panic: interface conversion: interface {} is primitive.ObjectID, not []uint8</p>\n</blockquote>\n\n<p>I have also tried to use multiple TypeAssertions or the <code>[]byte()</code> function directly, but could not get it to compile</p>\n\n<hr>\n\n<p>*byte slice is in this case desired because I am using gRPC, which limits the possible types I can use for return values.</p>\n"}, {"tags": ["go", "delve"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 2, "creation_date": 1577725836, "post_id": 59534360, "comment_id": 105238484, "body": "Instead of <code>step</code>, use <code>next</code>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1577726295, "post_id": 59534360, "comment_id": 105238664, "body": "Delve doesn&#39;t think of it as &quot;your code&quot; and &quot;imported code&quot;. Neither does the Go compiler. It&#39;s all just code."}, {"owner": {"reputation": 5187, "user_id": 2759075, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/OUIOd.png?s=128&g=1", "display_name": "Yaron Schwimmer", "link": "https://stackoverflow.com/users/2759075/yaron-schwimmer"}, "edited": false, "score": 0, "creation_date": 1577785975, "post_id": 59534360, "comment_id": 105253881, "body": "you want to <code>step over</code>, not <code>step into</code>"}], "owner": {"reputation": 97, "user_id": 10143812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e1fc65fdf160ed7f1d91d1cace065d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/10143812/peter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1577725546, "creation_date": 1577725546, "question_id": 59534360, "link": "https://stackoverflow.com/questions/59534360/how-to-only-debug-my-code-with-delve-go-debugger", "title": "How to only debug my code with Delve Go Debugger?", "body": "<p>Whenever I debug Go code with Delve, I need to set breakpoints on almost every line of my code and hit <code>Continue</code> rather than <code>Step Into</code>, because <code>Step Into</code> will step through every line of code that I imported, and not just the code that I wrote.  How do I only debug my code, and let Delve step over any imported functions so that I don't need to set breakpoints at every line of my code?</p>\n"}, {"tags": ["go", "telegram", "tdlib"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 11645900, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-X1Kv8kh5Obs/AAAAAAAAAAI/AAAAAAAAABo/4hwzSKHgtWU/photo.jpg?sz=128", "display_name": "Jian-Hua He", "link": "https://stackoverflow.com/users/11645900/jian-hua-he"}, "is_accepted": true, "score": 0, "last_activity_date": 1578039626, "creation_date": 1578039626, "answer_id": 59575224, "question_id": 59533513, "link": "https://stackoverflow.com/questions/59533513/stuck-on-authorizationsstatewaitphonenumber-status-with-go-tdlib/59575224#59575224", "title": "Stuck on \u201cauthorizationsStateWaitPhoneNumber\u201d status with go-tdlib", "body": "<p>I change the auth process with <a href=\"https://github.com/Arman92/go-tdlib/blob/master/examples/authorization/basicAuthorization.go\" rel=\"nofollow noreferrer\">this example</a> and it works!</p>\n"}], "owner": {"reputation": 1, "user_id": 11645900, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-X1Kv8kh5Obs/AAAAAAAAAAI/AAAAAAAAABo/4hwzSKHgtWU/photo.jpg?sz=128", "display_name": "Jian-Hua He", "link": "https://stackoverflow.com/users/11645900/jian-hua-he"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 168, "favorite_count": 0, "accepted_answer_id": 59575224, "answer_count": 1, "score": 0, "last_activity_date": 1578039626, "creation_date": 1577721382, "question_id": 59533513, "link": "https://stackoverflow.com/questions/59533513/stuck-on-authorizationsstatewaitphonenumber-status-with-go-tdlib", "title": "Stuck on \u201cauthorizationsStateWaitPhoneNumber\u201d status with go-tdlib", "body": "<p>I\u2019m working with <a href=\"https://github.com/Arman92/go-tdlib\" rel=\"nofollow noreferrer\">go-tdlib</a> to collect messages in Telegram. I try to modify the <a href=\"https://github.com/Arman92/go-tdlib/blob/master/examples/getChats/getChats.go\" rel=\"nofollow noreferrer\">example</a>. When I restart the services in the third time. It stops working. So I print out the messages. It keeps giving me <code>authorizationsStateWaitPhoneNumber</code> status. I can\u2019t even enter my phone number in the console. Below is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"math\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n    \"time\"\n    \"github.com/Arman92/go-tdlib\"\n    \"github.com/joho/godotenv\"\n)\n\nconst (\n    MaxAttempt = 10\n)\n\nvar (\n    apiID string\n    apiHash string\n)\n\nvar allChats []*tdlib.Chat\nvar haveFullChatList bool\n\nfunc main() {\n    log.Println(\"Start Service\")\n    log.Printf(\"API ID: %+v\\n\", apiID)\n    log.Printf(\"API HASH: %+v\\n\", apiHash)\n    tdlib.SetLogVerbosityLevel(1)\n    tdlib.SetFilePath(\"./errors.txt\")\n\n    // Create new instance of client\n    client := tdlib.NewClient(tdlib.Config{\n        APIID:               apiID,\n        APIHash:             apiHash,\n        SystemLanguageCode:  \"en\",\n        DeviceModel:         \"Server\",\n        SystemVersion:       \"1.0.0\",\n        ApplicationVersion:  \"1.0.0\",\n        UseMessageDatabase:  true,\n        UseFileDatabase:     true,\n        UseChatInfoDatabase: true,\n        UseTestDataCenter:   false,\n        DatabaseDirectory:   \"./tdlib-db\",\n        FileDirectory:       \"./tdlib-files\",\n        IgnoreFileNames:     false,\n    })\n\n    log.Println(\"Starting auth\")\n\n    // Wait while we get AuthorizationReady!\n    // Note: See authorization example for complete authorization sequence example\n    currentState, err := client.Authorize()\n    if err != nil {\n        log.Fatalf(\"Authorize error: %+v\\n\", err)\n    }\n\n    attempt := 0\n    for ; currentState.GetAuthorizationStateEnum() != tdlib.AuthorizationStateReadyType; currentState, err = client.Authorize() {\n        if err != nil {\n            log.Fatalf(\"Authorize error: %+v\\n\", err)\n        }\n        fmt.Printf(\"Current auth state: %+v\\n\", currentState)\n        attempt += 1\n        time.Sleep(5000 * time.Millisecond)\n    }\n\n    // get at most 1000 chats list\n    if err = getChatList(client, 1000); err != nil {\n        log.Fatalf(\"Error occurred in getChatList, msg: %+v\\n\", err)\n    }\n    log.Printf(\"got %d chats\\n\", len(allChats))\n\n    for _, chat := range allChats {\n        log.Printf(\"Chat title: %s \\n\", chat.Title)\n    }\n\n    signalTermination()\n}\n\n// see https://stackoverflow.com/questions/37782348/how-to-use-getchats-in-tdlib\nfunc getChatList(client *tdlib.Client, limit int) error {\n    if !haveFullChatList &amp;&amp; limit &gt; len(allChats) {\n        offsetOrder := int64(math.MaxInt64)\n        offsetChatID := int64(0)\n        var lastChat *tdlib.Chat\n\n        if len(allChats) &gt; 0 {\n            lastChat = allChats[len(allChats)-1]\n            offsetOrder = int64(lastChat.Order)\n            offsetChatID = lastChat.ID\n        }\n\n        // get chats (ids) from tdlib\n        chats, err := client.GetChats(tdlib.JSONInt64(offsetOrder),\n            offsetChatID, int32(limit-len(allChats)))\n        if err != nil {\n            return err\n        }\n        if len(chats.ChatIDs) == 0 {\n            haveFullChatList = true\n            return nil\n        }\n\n        for _, chatID := range chats.ChatIDs {\n            // get chat info from tdlib\n            chat, err := client.GetChat(chatID)\n            if err == nil {\n                allChats = append(allChats, chat)\n            } else {\n                return err\n            }\n        }\n\n        return getChatList(client, limit)\n    }\n\n    return nil\n}\n\nfunc signalTermination() {\n    c := make(chan os.Signal, 1)\n    signal.Notify(c, syscall.SIGINT, syscall.SIGTERM)\n    &lt;-c\n}\n\nfunc init() {\n    err := godotenv.Load()\n    if err != nil {\n        log.Fatal(\"Error loading .env file\")\n    }\n    apiID = os.Getenv(\"TELEGRAM_API_ID\")\n    apiHash = os.Getenv(\"TELEGRAM_API_HASH\")\n}\n</code></pre>\n\n<p>Does anyone encounter this issue before? What am I doing wrong?</p>\n"}, {"tags": ["csv", "go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 0, "last_activity_date": 1577861317, "creation_date": 1577861317, "answer_id": 59550524, "question_id": 59531388, "link": "https://stackoverflow.com/questions/59531388/create-and-write-two-csv-simultaneously-golang/59550524#59550524", "title": "create and write two CSV simultaneously golang", "body": "<p>In your <code>init</code> function you have both writers writing to the success file.</p>\n\n<pre><code>csvWriterSuccess = csv.NewWriter(csvSuccess)\ncsvWriterError = csv.NewWriter(csvSuccess)\n</code></pre>\n\n<p>Write to the success and error files separately.</p>\n\n<pre><code>csvWriterSuccess = csv.NewWriter(csvSuccess)\ncsvWriterError = csv.NewWriter(csvError)\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 9419555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7605e1b111513e59e531a3f40faab3f?s=128&d=identicon&r=PG&f=1", "display_name": "Darara", "link": "https://stackoverflow.com/users/9419555/darara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 1, "accepted_answer_id": 59550524, "answer_count": 1, "score": 0, "last_activity_date": 1577893569, "creation_date": 1577711183, "last_edit_date": 1577893569, "question_id": 59531388, "link": "https://stackoverflow.com/questions/59531388/create-and-write-two-csv-simultaneously-golang", "title": "create and write two CSV simultaneously golang", "body": "<p>I am trying to create two CSV files and write both simultaneously. This code doesn't work that way, but it's just to exemplify what I want to do. Since (* csv.Writer) is a pointer I don't know how I can differentiate it from another file. Is it possible to do that?</p>\n\n<pre><code>\npackage test\n\nimport (\n    \"encoding/csv\"\n    \"os\"\n    \"sync\"\n    \"time\"\n)\n\nvar csvSuccess *os.File\nvar csvError *os.File\nvar csvErr error\nvar csvWriterSuccess *csv.Writer\nvar csvWriterError *csv.Writer\nvar mutex *sync.Mutex\n\nfunc init() {\n    csvSuccess, csvErr = os.Create(\"sucess-result.csv\")\n    csvError, csvErr = os.Create(\"error-result.csv\")\n    if csvErr != nil {\n        panic(\"Error open file\")\n    }\n    csvWriterSuccess = csv.NewWriter(csvSuccess)\n    csvWriterError = csv.NewWriter(csvSuccess)\n    mutex = &amp;sync.Mutex{}\n}\n\nfunc WriteRecordSuccess(record []string) {\n    mutex.Lock()\n    if err := csvWriterSuccess.Write(record); err != nil {\n        if err != nil {\n            panic(\"Error writing success record\")\n        }\n        csvWriterSuccess.Flush()\n    }\n    mutex.Unlock()\n}\n\nfunc WriteRecordError(record []string) {\n    mutex.Lock()\n    if err := csvWriterError.Write(record); err != nil {\n        if err != nil {\n            panic(\"Error writing error record\")\n        }\n        csvWriterError.Flush()\n    }\n    mutex.Unlock()\n}\n\nfunc ClosecsvFile() {\n    csvWriterSuccess.Flush()\n    csvWriterError.Flush()\n    csvSuccess.Sync()\n    csvError.Sync()\n    csvSuccess.Close()\n    csvError.Close()\n}\n</code></pre>\n"}, {"tags": ["go", "scope", "deferred"], "comments": [{"owner": {"reputation": 1650, "user_id": 4399634, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001746244457/picture?type=large", "display_name": "frankegoesdown", "link": "https://stackoverflow.com/users/4399634/frankegoesdown"}, "edited": false, "score": 0, "creation_date": 1577710041, "post_id": 59530933, "comment_id": 105231687, "body": "@jub0bs Thank you I upd 2nd code snippet"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 2, "creation_date": 1577710141, "post_id": 59530933, "comment_id": 105231735, "body": "In your first snippet, because there is no named result parameter, your deferred function has no way of influencing what is returned by the enclosing function (<code>test</code>). See <a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"nofollow noreferrer\">the spec</a>: <i>if the deferred function is a function literal and the surrounding function has named result parameters that are in scope within the literal, the deferred function may access and modify the result parameters before they are returned.</i>"}, {"owner": {"reputation": 1650, "user_id": 4399634, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001746244457/picture?type=large", "display_name": "frankegoesdown", "link": "https://stackoverflow.com/users/4399634/frankegoesdown"}, "reply_to_user": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1577710266, "post_id": 59530933, "comment_id": 105231786, "body": "@jub0bs thanks again. Now for explain :)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1577719941, "post_id": 59530933, "comment_id": 105235991, "body": "Also see related / possible duplicates: <a href=\"https://stackoverflow.com/a/59461751/1705598\">Why can a normal return hide a panic that a named return correctly provides to the caller?</a> and <a href=\"https://stackoverflow.com/a/33167433/1705598\">How to return a value in a Go function that panics?</a>"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1577723847, "post_id": 59530933, "comment_id": 105237702, "body": "@icza Related, but not dupes, IMO."}], "answers": [{"tags": [], "owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "is_accepted": true, "score": 3, "last_activity_date": 1577793622, "last_edit_date": 1577793622, "creation_date": 1577710555, "answer_id": 59531235, "question_id": 59530933, "link": "https://stackoverflow.com/questions/59530933/why-does-this-defer-statement-affect-the-result-in-one-case-but-not-the-other/59531235#59531235", "title": "Why does this defer statement affect the result in one case but not the other?", "body": "<p>The Golang spec says <a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"nofollow noreferrer\">this</a> about defer statements:</p>\n\n<blockquote>\n  <p>[...] if the deferred function is a function literal <strong>and the surrounding function has named result parameters</strong> that are in scope within the literal, the deferred function may access and modify the result parameters before they are returned.</p>\n</blockquote>\n\n<p>(my emphasis)</p>\n\n<p>In <a href=\"https://play.golang.org/p/ITTEazbdseX\" rel=\"nofollow noreferrer\">your first snippet</a>, function <code>test</code> has no named return parameter; <code>x</code> is merely a local variable. Therefore, your defer statement cannot modify the result of function <code>test</code>.</p>\n\n<p>In <a href=\"https://play.golang.org/p/cNUVKWAQa2z\" rel=\"nofollow noreferrer\">your second snippet</a>, function <code>test</code> has a named return parameter <code>x</code>, which is in scope within your function literal. Therefore, the defer statement can (and does) modify the result of function <code>test</code>.</p>\n"}], "owner": {"reputation": 1650, "user_id": 4399634, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001746244457/picture?type=large", "display_name": "frankegoesdown", "link": "https://stackoverflow.com/users/4399634/frankegoesdown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 59531235, "answer_count": 1, "score": 0, "last_activity_date": 1592152401, "creation_date": 1577709201, "last_edit_date": 1592152401, "question_id": 59530933, "link": "https://stackoverflow.com/questions/59530933/why-does-this-defer-statement-affect-the-result-in-one-case-but-not-the-other", "title": "Why does this defer statement affect the result in one case but not the other?", "body": "<p>I've 2 code examples:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func test() int {\n    var x int\n    defer func() {\n\n        x++\n    }()\n    x = 1\n    return x\n}\n\nfunc main() {\n    fmt.Println(test())\n}\n</code></pre>\n\n<p>It returns: <code>1</code>. However, the following code example behaves differently: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func test() (x int) {\n    defer func() {\n\n        x++\n    }()\n    x = 1\n    return\n}\n\nfunc main() {\n    fmt.Println(test())\n}\n</code></pre>\n\n<p>It returns <code>2</code>.</p>\n\n<hr>\n\n<p>In order to understand what's going on, I disassembled the code.</p>\n\n<p>For the first code snippet (whose output is <code>1</code>):</p>\n\n<pre><code>  main.go:19            0x48cf40                64488b0c25f8ffffff      MOVQ FS:0xfffffff8, CX\n  main.go:19            0x48cf49                483b6110                CMPQ 0x10(CX), SP\n  main.go:19            0x48cf4d                7678                    JBE 0x48cfc7\n  main.go:19            0x48cf4f                4883ec58                SUBQ $0x58, SP\n  main.go:19            0x48cf53                48896c2450              MOVQ BP, 0x50(SP)\n  main.go:19            0x48cf58                488d6c2450              LEAQ 0x50(SP), BP\n  main.go:20            0x48cf5d                e83effffff              CALL main.test(SB)\n  main.go:20            0x48cf62                e8c9bff7ff              CALL runtime.convT64(SB)\n  main.go:20            0x48cf67                488b442408              MOVQ 0x8(SP), AX\n  main.go:20            0x48cf6c                0f57c0                  XORPS X0, X0\n  main.go:20            0x48cf6f                0f11442440              MOVUPS X0, 0x40(SP)\n  main.go:20            0x48cf74                488d0d05090100          LEAQ 0x10905(IP), CX\n  main.go:20            0x48cf7b                48894c2440              MOVQ CX, 0x40(SP)\n  main.go:20            0x48cf80                4889442448              MOVQ AX, 0x48(SP)\n  print.go:274          0x48cf85                488b0524020d00          MOVQ os.Stdout(SB), AX\n  print.go:274          0x48cf8c                488d0d0dd70400          LEAQ go.itab.*os.File,io.Writer(SB), CX\n  print.go:274          0x48cf93                48890c24                MOVQ CX, 0(SP)\n  print.go:274          0x48cf97                4889442408              MOVQ AX, 0x8(SP)\n  print.go:274          0x48cf9c                488d442440              LEAQ 0x40(SP), AX\n  print.go:274          0x48cfa1                4889442410              MOVQ AX, 0x10(SP)\n  print.go:274          0x48cfa6                48c744241801000000      MOVQ $0x1, 0x18(SP)\n  print.go:274          0x48cfaf                48c744242001000000      MOVQ $0x1, 0x20(SP)\n  print.go:274          0x48cfb8                e84397ffff              CALL fmt.Fprintln(SB)\n  print.go:274          0x48cfbd                488b6c2450              MOVQ 0x50(SP), BP\n  print.go:274          0x48cfc2                4883c458                ADDQ $0x58, SP\n  print.go:274          0x48cfc6                c3                      RET\n  main.go:19            0x48cfc7                e8d447fcff              CALL runtime.morestack_noctxt(SB)\n  main.go:19            0x48cfcc                e96fffffff              JMP main.main(SB)\n</code></pre>\n\n<p>For the second code snippet (whose output is <code>2</code>):</p>\n\n<pre><code>  main.go:18            0x48cf30                64488b0c25f8ffffff      MOVQ FS:0xfffffff8, CX\n  main.go:18            0x48cf39                483b6110                CMPQ 0x10(CX), SP\n  main.go:18            0x48cf3d                7678                    JBE 0x48cfb7\n  main.go:18            0x48cf3f                4883ec58                SUBQ $0x58, SP\n  main.go:18            0x48cf43                48896c2450              MOVQ BP, 0x50(SP)\n  main.go:18            0x48cf48                488d6c2450              LEAQ 0x50(SP), BP\n  main.go:19            0x48cf4d                e84effffff              CALL main.test(SB)\n  main.go:19            0x48cf52                e8d9bff7ff              CALL runtime.convT64(SB)\n  main.go:19            0x48cf57                488b442408              MOVQ 0x8(SP), AX\n  main.go:19            0x48cf5c                0f57c0                  XORPS X0, X0\n  main.go:19            0x48cf5f                0f11442440              MOVUPS X0, 0x40(SP)\n  main.go:19            0x48cf64                488d0d15090100          LEAQ 0x10915(IP), CX\n  main.go:19            0x48cf6b                48894c2440              MOVQ CX, 0x40(SP)\n  main.go:19            0x48cf70                4889442448              MOVQ AX, 0x48(SP)\n  print.go:274          0x48cf75                488b0534020d00          MOVQ os.Stdout(SB), AX\n  print.go:274          0x48cf7c                488d0d1dd70400          LEAQ go.itab.*os.File,io.Writer(SB), CX\n  print.go:274          0x48cf83                48890c24                MOVQ CX, 0(SP)\n  print.go:274          0x48cf87                4889442408              MOVQ AX, 0x8(SP)\n  print.go:274          0x48cf8c                488d442440              LEAQ 0x40(SP), AX\n  print.go:274          0x48cf91                4889442410              MOVQ AX, 0x10(SP)\n  print.go:274          0x48cf96                48c744241801000000      MOVQ $0x1, 0x18(SP)\n  print.go:274          0x48cf9f                48c744242001000000      MOVQ $0x1, 0x20(SP)\n  print.go:274          0x48cfa8                e85397ffff              CALL fmt.Fprintln(SB)\n  print.go:274          0x48cfad                488b6c2450              MOVQ 0x50(SP), BP\n  print.go:274          0x48cfb2                4883c458                ADDQ $0x58, SP\n  print.go:274          0x48cfb6                c3                      RET\n  main.go:18            0x48cfb7                e8e447fcff              CALL runtime.morestack_noctxt(SB)\n  main.go:18            0x48cfbc                e96fffffff              JMP main.main(SB)\n</code></pre>\n"}, {"tags": ["go", "redis", "redis-cluster"], "comments": [{"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "edited": false, "score": 0, "creation_date": 1577736015, "post_id": 59530921, "comment_id": 105241996, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/38042629/redis-cross-slot-error\">Redis Cross Slot error</a>"}, {"owner": {"reputation": 136, "user_id": 3760520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed91b795d579bbd516b2185a8692797?s=128&d=identicon&r=PG&f=1", "display_name": "rajat", "link": "https://stackoverflow.com/users/3760520/rajat"}, "reply_to_user": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "edited": false, "score": 0, "creation_date": 1577740828, "post_id": 59530921, "comment_id": 105243609, "body": "Yes partially. Helps me understand that Lua wouldn\u2019t be helpful here. But I still would like to understand possible options here. Preferably something other than hash tags or restricting keys to hash slots"}, {"owner": {"reputation": 7374, "user_id": 593425, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ad54f71e8e63bf711680cf8f5f1e53c1?s=128&d=identicon&r=PG", "display_name": "Guy Korland", "link": "https://stackoverflow.com/users/593425/guy-korland"}, "edited": false, "score": 0, "creation_date": 1577783432, "post_id": 59530921, "comment_id": 105253008, "body": "@rajat you might want to consider using RedisGears, which allow you to run cross slots/shards operations"}], "answers": [{"comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1577732460, "post_id": 59532594, "comment_id": 105240814, "body": "I don&#39;t think a single pipeline will automatically shard the commands to separate cluster nodes."}, {"owner": {"reputation": 136, "user_id": 3760520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed91b795d579bbd516b2185a8692797?s=128&d=identicon&r=PG&f=1", "display_name": "rajat", "link": "https://stackoverflow.com/users/3760520/rajat"}, "edited": false, "score": 0, "creation_date": 1577740642, "post_id": 59532594, "comment_id": 105243533, "body": "Thanks for the direction here. I\u2019ll try pipelines once since restricting keys to hash slots is something I would like to avoid for now. However Is go routines a bad idea or an option here?"}], "tags": [], "owner": {"reputation": 5187, "user_id": 2759075, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/OUIOd.png?s=128&g=1", "display_name": "Yaron Schwimmer", "link": "https://stackoverflow.com/users/2759075/yaron-schwimmer"}, "is_accepted": false, "score": 2, "last_activity_date": 1577720015, "last_edit_date": 1577720015, "creation_date": 1577716945, "answer_id": 59532594, "question_id": 59530921, "link": "https://stackoverflow.com/questions/59530921/deleting-multiple-keys-in-a-redis-cluster/59532594#59532594", "title": "Deleting multiple keys in a redis cluster", "body": "<p>I'm not sure using a Lua script will help you with that. Lua scripts are good for forcing atomicity, but won't help you overcome the issue with multiple slots.</p>\n\n<p>Two possible solutions for your issue are:  </p>\n\n<ol>\n<li><p>Use Redis <a href=\"https://redis.io/topics/cluster-tutorial#redis-cluster-data-sharding\" rel=\"nofollow noreferrer\">hash tags</a>. What it means is that if you have a common substring in all your keys (e.g. <code>[\"mykey_a\", \"mykey_b\", ...]</code>), then you can force Redis to group all the keys to the same slot by adding curly braces around the common substring (<code>[\"{mykey}_a\", \"{mykey}_b\", ...]</code>). Obviously it is not recommended to use the same slot for <em>all</em> of your keys, but if you can group some of them for a certain purpose, then this solution is valid.</p></li>\n<li><p>Use <a href=\"https://redis.io/topics/pipelining\" rel=\"nofollow noreferrer\">Redis pipelines</a>. This way, you perform each <code>DEL</code> command separately, but save the network RTT. Pipeline in Go can look like:</p></li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>pipe := c.client.Pipeline()\nfor _, key := range keys {\n    pipe.Del(key)\n}\npipe.Exec()\n</code></pre>\n"}], "owner": {"reputation": 136, "user_id": 3760520, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8ed91b795d579bbd516b2185a8692797?s=128&d=identicon&r=PG&f=1", "display_name": "rajat", "link": "https://stackoverflow.com/users/3760520/rajat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1804, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1577765655, "creation_date": 1577709160, "last_edit_date": 1577765655, "question_id": 59530921, "link": "https://stackoverflow.com/questions/59530921/deleting-multiple-keys-in-a-redis-cluster", "title": "Deleting multiple keys in a redis cluster", "body": "<p>As I understand in redis cluster the slots are distributed, the <code>DEL</code> command which can take multiple keys fails with a <code>CROSSSLOT Keys in request don't hash to the same slot</code> error. </p>\n\n<p>Since my existing codebase is designed around batch processing, there are quite a few places where the redis cache delete operation is called with a list of keys to be deleted. As changing this would not be a smart idea <strong>I am trying to find a solution at my cache interface layer where I can still receive the multiple keys to be deleted and add required logic here to achieve the same final result.</strong> I had two options in my view which I need help with </p>\n\n<p><strong>Method 1.</strong> Loop on the keys and use Go routines + weight groups </p>\n\n<p><strong>Method 2.</strong> Use <code>EVAL</code> : I am not sure if this is the right direction or if I am using it right. Following is the sample golang snippet below </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (c CacheClient) Del(ctx context.Context, keysToBeDeleted []string) error {\n    // _, err := c.client.Del(strings.Join(keysToBeDeleted, \" \")).Result() // previously used when on single redis instance\n    _, err := c.client.Eval(\"return redis.call('DEL', KEYS[1])\", keysToBeDeleted).Result()\n\n    if err != nil {\n        // handle error\n    }\n    return nil\n}\n</code></pre>\n\n<p>I created a dummy cluster and used redis-cli to test the eval command as below </p>\n\n<p><code>redis&gt; EVAL \"redis.call('del', KEYS[1]) \" 2 mykey1, mykey2</code></p>\n\n<p>This too failed with a <code>CROSSSLOT Keys in request don't hash to the same slot</code> error. </p>\n\n<p><strong>Am I using the KEYS table in a wrong way in the Lua script. Or what is the right way to delete multiple keys from a cluster. Should I stick to method 1?</strong> </p>\n\n<p>Using Golang v1.13 and <a href=\"https://godoc.org/gopkg.in/redis.v5\" rel=\"nofollow noreferrer\">redis.v5</a> as my redis-client package. \nIf someone can help me find a solution using the redis.v5 package itself that would be even great. </p>\n"}, {"tags": ["docker", "go", "go-modules", "go-packages"], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 10883730, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ryIRVQvNRrM/AAAAAAAAAAI/AAAAAAAAAAc/fmLNnobSPbU/photo.jpg?sz=128", "display_name": "R.E.B Hernandez", "link": "https://stackoverflow.com/users/10883730/r-e-b-hernandez"}, "edited": false, "score": 0, "creation_date": 1577712170, "post_id": 59531320, "comment_id": 105232612, "body": "Hi ! thank you for your answer. Unfortunately, changing GO111MODULE to auto didn&#39;t make the docker build succeed. Now I have a new error still at go build line:  <code>unexpected directory layout: \timport path: _&#47;go&#47;src&#47;app&#47;tools \troot: &#47;go&#47;src \tdir: &#47;go&#47;src&#47;app&#47;tools \texpand root: &#47;go \texpand dir: &#47;go&#47;src&#47;app&#47;tools \tseparator: &#47;</code>"}, {"owner": {"reputation": 90, "user_id": 8194156, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cyt7b.jpg?s=128&g=1", "display_name": "Juxuny Wu", "link": "https://stackoverflow.com/users/8194156/juxuny-wu"}, "reply_to_user": {"reputation": 107, "user_id": 10883730, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ryIRVQvNRrM/AAAAAAAAAAI/AAAAAAAAAAc/fmLNnobSPbU/photo.jpg?sz=128", "display_name": "R.E.B Hernandez", "link": "https://stackoverflow.com/users/10883730/r-e-b-hernandez"}, "edited": false, "score": 1, "creation_date": 1577713882, "post_id": 59531320, "comment_id": 105233392, "body": "Do you miss something important ? I created a demo here.(<a href=\"https://github.com/juxuny/go-build-trial\" rel=\"nofollow noreferrer\">github.com/juxuny/go-build-trial</a>). You just step into the root directory and run <code>docker build -t go-build-demo -f service1&#47;Dockerfile .</code>"}, {"owner": {"reputation": 107, "user_id": 10883730, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ryIRVQvNRrM/AAAAAAAAAAI/AAAAAAAAAAc/fmLNnobSPbU/photo.jpg?sz=128", "display_name": "R.E.B Hernandez", "link": "https://stackoverflow.com/users/10883730/r-e-b-hernandez"}, "edited": false, "score": 0, "creation_date": 1577715120, "post_id": 59531320, "comment_id": 105233961, "body": "Thank you for all your effort and help ! I really appreciate it. I cloned your repo and could build the dockerfile with no errors. But the tool module was &quot;naked&quot; and the one I&#39;m trying to build actually uses different public modules. So I added a simple logging module and tried to build again. It failed with the same error as mine. I will push my modifications in a branch if you allow me to"}, {"owner": {"reputation": 90, "user_id": 8194156, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cyt7b.jpg?s=128&g=1", "display_name": "Juxuny Wu", "link": "https://stackoverflow.com/users/8194156/juxuny-wu"}, "reply_to_user": {"reputation": 107, "user_id": 10883730, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ryIRVQvNRrM/AAAAAAAAAAI/AAAAAAAAAAc/fmLNnobSPbU/photo.jpg?sz=128", "display_name": "R.E.B Hernandez", "link": "https://stackoverflow.com/users/10883730/r-e-b-hernandez"}, "edited": false, "score": 0, "creation_date": 1577715888, "post_id": 59531320, "comment_id": 105234265, "body": "Ok, you can push your modifications in a branch .let me see what is going wrong."}, {"owner": {"reputation": 107, "user_id": 10883730, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ryIRVQvNRrM/AAAAAAAAAAI/AAAAAAAAAAc/fmLNnobSPbU/photo.jpg?sz=128", "display_name": "R.E.B Hernandez", "link": "https://stackoverflow.com/users/10883730/r-e-b-hernandez"}, "edited": false, "score": 0, "creation_date": 1577716296, "post_id": 59531320, "comment_id": 105234441, "body": "I forked your repo then created a PR to make things simple and clean ;)"}, {"owner": {"reputation": 90, "user_id": 8194156, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cyt7b.jpg?s=128&g=1", "display_name": "Juxuny Wu", "link": "https://stackoverflow.com/users/8194156/juxuny-wu"}, "reply_to_user": {"reputation": 107, "user_id": 10883730, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ryIRVQvNRrM/AAAAAAAAAAI/AAAAAAAAAAc/fmLNnobSPbU/photo.jpg?sz=128", "display_name": "R.E.B Hernandez", "link": "https://stackoverflow.com/users/10883730/r-e-b-hernandez"}, "edited": false, "score": 0, "creation_date": 1577722299, "post_id": 59531320, "comment_id": 105237050, "body": "It seams to be no way to compile.Because you set <code>GOPATH</code> environment variable, you can build the code successfully on local machine."}, {"owner": {"reputation": 90, "user_id": 8194156, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cyt7b.jpg?s=128&g=1", "display_name": "Juxuny Wu", "link": "https://stackoverflow.com/users/8194156/juxuny-wu"}, "reply_to_user": {"reputation": 107, "user_id": 10883730, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ryIRVQvNRrM/AAAAAAAAAAI/AAAAAAAAAAc/fmLNnobSPbU/photo.jpg?sz=128", "display_name": "R.E.B Hernandez", "link": "https://stackoverflow.com/users/10883730/r-e-b-hernandez"}, "edited": false, "score": 0, "creation_date": 1577722351, "post_id": 59531320, "comment_id": 105237074, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/205090/discussion-between-juxuny-wu-and-r-e-b-hernandez\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 90, "user_id": 8194156, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cyt7b.jpg?s=128&g=1", "display_name": "Juxuny Wu", "link": "https://stackoverflow.com/users/8194156/juxuny-wu"}, "is_accepted": false, "score": 0, "last_activity_date": 1577761976, "last_edit_date": 1577761976, "creation_date": 1577710926, "answer_id": 59531320, "question_id": 59530619, "link": "https://stackoverflow.com/questions/59530619/manage-local-private-golang-packages-and-modules-for-docker-builds/59531320#59531320", "title": "Manage local/private Golang packages and modules for docker builds", "body": "<p>You should change your environment variable <code>GO111MODULE</code> as auto.</p>\n\n<p>The final Dockerfile is:</p>\n\n<pre><code>FROM golang:1.13 as builder\nENV GO111MODULE=auto\nWORKDIR /go/src/app\nCOPY ./tools ./tools\nCOPY ./service1 ./service1\n\nWORKDIR /go/src/app/tools\nRUN go mod download\nWORKDIR /go/src/app/service1\nRUN go mod download\n\nWORKDIR /go/src/app\n\nRUN go build -o server /go/src/app/service1/main.go\n\nFROM centos:7\nRUN yum -y update &amp;&amp; yum clean all\nCOPY --from=builder /go/src/app/server .\nEXPOSE 3000\nCMD [\"./server\"]\n</code></pre>\n\n<p><strong>UPDATE</strong></p>\n\n<p>In my opinion, if GO111MODULE is equal to 'auto', golang will disable the module features, and find the third-party package in GOPATH. Before compile the code, you should <code>go get -u github.com/op/go-logging</code>. I think it is not you want.</p>\n\n<p>According to the example <a href=\"https://github.com/go-modules-by-example/index/blob/master/009_submodules/README.md\" rel=\"nofollow noreferrer\">here</a>, I updated my repo, <a href=\"https://github.com/juxuny/go-build-trial\" rel=\"nofollow noreferrer\">here</a>. You can try to build the code inside docker container. It can build succeed, but you should change the package name.</p>\n"}, {"tags": [], "owner": {"reputation": 23, "user_id": 8616226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44a319ae513baff984abeecff4a94f3d?s=128&d=identicon&r=PG&f=1", "display_name": "vecta", "link": "https://stackoverflow.com/users/8616226/vecta"}, "is_accepted": false, "score": 0, "last_activity_date": 1619206024, "creation_date": 1619206024, "answer_id": 67235827, "question_id": 59530619, "link": "https://stackoverflow.com/questions/59530619/manage-local-private-golang-packages-and-modules-for-docker-builds/67235827#67235827", "title": "Manage local/private Golang packages and modules for docker builds", "body": "<p>For anyone facing a similar issue - I solved a similar problem using the <code>vendor</code> directory. Basically, you download the dependencies on the host by running <code>go mod vendor</code> and they will then get copied to the docker container automatically.</p>\n<p>From the Dockerfile, you have to remove <code>RUN go mod download</code>, and you also need to modify the build command with the <code>-mod=vendor</code> flag.</p>\n<p>To build the docker image, you need to run these commands</p>\n<pre><code>go mod vendor\ndocker build . -t image-name\n</code></pre>\n<p>I hope this will help someone. I have found this solution here: <a href=\"https://smartystreets.com/blog/2018/09/private-dependencies-in-docker-and-go/\" rel=\"nofollow noreferrer\">https://smartystreets.com/blog/2018/09/private-dependencies-in-docker-and-go/</a></p>\n"}], "owner": {"reputation": 107, "user_id": 10883730, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ryIRVQvNRrM/AAAAAAAAAAI/AAAAAAAAAAc/fmLNnobSPbU/photo.jpg?sz=128", "display_name": "R.E.B Hernandez", "link": "https://stackoverflow.com/users/10883730/r-e-b-hernandez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1326, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1619206024, "creation_date": 1577707827, "last_edit_date": 1577712359, "question_id": 59530619, "link": "https://stackoverflow.com/questions/59530619/manage-local-private-golang-packages-and-modules-for-docker-builds", "title": "Manage local/private Golang packages and modules for docker builds", "body": "<p>I'm pretty new to golang and docker so after looking around in many threads and internet resources I ended up confused about how I should set things up.</p>\n\n<p>My problem is that I'm facing a docker build error of a golang app because of a not found local dependency.</p>\n\n<p>FYI (local machine): go version go1.13.4 linux/amd64</p>\n\n<p>Here is the context of my problem:</p>\n\n<p>I have a repository that will hold sources for simple micro-services (written in Go) that will be running in Kubernetes. So each folder in the repository represents a service. I also have a folder \"tools\" that regroups helper functions and ressources that many services share.\nMy repository is not in any Go special paths, it's located in the root of one of my drives.\nSo here is how my repo looks like:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 service1\n\u2502   \u251c\u2500\u2500 main.go\n\u2502   \u251c\u2500\u2500 Dockerfile\n\u2502   \u251c\u2500\u2500 go.mod\n\u2502   \u2514\u2500\u2500 go.sum\n\u251c\u2500\u2500 service2\n\u251c\u2500\u2500 service3\n\u2502   ...\n\u251c\u2500\u2500 serviceX\n\u251c\u2500\u2500 tools\n\u2502   \u251c\u2500\u2500 helpers.go\n\u2502   \u251c\u2500\u2500 ressources.go\n\u2502   \u251c\u2500\u2500 go.mod\n\u2514\u2500\u2500 \u2514\u2500\u2500 go.sum\n</code></pre>\n\n<p>So each folder/service is a go module to handle its dependencies independently. The folder tools is a module as well.\nI initialized each module with <code>go mod init FOLDER_NAME</code></p>\n\n<p>In the service <strong>service1</strong> I reference the module <strong>tools</strong> to use some functions. Here is how I implemented it : (src of ./service1/main.go)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    st \"../tools\"\n\n    // other modules imports\n)\n\nfunc main() {\n    st.ExecHelperFunc()\n    // http server inits\n}\n</code></pre>\n\n<p>When I locally run <strong>service1's</strong> main.go or if I locally build it and run the binary afterwards  the service works fine.</p>\n\n<p>But when I attempt to build the dockerfile of <strong>service1</strong> I get golang build error: \n<code>build _/go/src/app/tools: cannot find module for path _/go/src/app/tools</code></p>\n\n<p>Here is my dockerfile:</p>\n\n<pre><code>FROM golang:1.13 as builder\nENV GO111MODULE=on\nWORKDIR /go/src/app\nCOPY ./tools ./tools\nCOPY ./service1 ./service1\n\nWORKDIR /go/src/app/tools\nRUN go mod download\nWORKDIR /go/src/app/service1\nRUN go mod download\n\nWORKDIR /go/src/app\n\nRUN go build -o server /go/src/app/service1/main.go\n\nFROM centos:7\nRUN yum -y update &amp;&amp; yum clean all\nCOPY --from=builder /go/src/app/server .\nEXPOSE 3000\nCMD [\"./server\"]\n</code></pre>\n\n<p>So I dont understand why docker fails to build the service? Apparently he is not able to locate/identify the module tools but why? I tried many different setups for the dockerfile but I still couldn't figure it out.</p>\n\n<p>Thank you in advance for your help.</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>As suggested in an answer, changing the value of <strong>GO111MODULE</strong> in the dockerfile from on to auto didn't fix the build error but gets me a new one:</p>\n\n<pre><code>unexpected directory layout:\n    import path: _/go/src/app/tools\n    root: /go/src\n    dir: /go/src/app/tools\n    expand root: /go\n    expand dir: /go/src/app/tools\n    separator: /\n</code></pre>\n"}, {"tags": ["go", "utf-8", "ucs2"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 7429600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6967398b953f5e4b8bf5e52017b48dbe?s=128&d=identicon&r=PG&f=1", "display_name": "B.G.Venkatraj", "link": "https://stackoverflow.com/users/7429600/b-g-venkatraj"}, "edited": false, "score": 0, "creation_date": 1579517891, "post_id": 59532666, "comment_id": 105780757, "body": "The above code work fine for me. Thanks for the response. Now using the same code I am not able to read files &quot;encode in UTF-8 withoutBOM&quot;. Is there a way to find the encode of the file? so that I can this logic only for UCS-2 encoded file?"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1577749579, "last_edit_date": 1577749579, "creation_date": 1577717363, "answer_id": 59532666, "question_id": 59529543, "link": "https://stackoverflow.com/questions/59529543/read-text-file-which-has-been-encoded-with-ucs-2-little-endian-using-go/59532666#59532666", "title": "read text file which has been encoded with UCS-2 little Endian using Go", "body": "<blockquote>\n  <p>I have a Go program to read a text file. How can I convert the [UCS-2 little endian] file to UFT-8 format to read it?</p>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://home.unicode.org/\" rel=\"nofollow noreferrer\">Unicode</a></p>\n  \n  <p><a href=\"https://www.unicode.org/faq/utf_bom.html\" rel=\"nofollow noreferrer\">FAQ: UTF-8, UTF-16, UTF-32 &amp; BOM</a></p>\n  \n  <p>Q: <a href=\"https://www.unicode.org/faq/utf_bom.html#utf16-11\" rel=\"nofollow noreferrer\">What is the difference between UCS-2 and UTF-16?</a></p>\n  \n  <p>A: UCS-2 is obsolete terminology which refers to a Unicode\n  implementation up to Unicode 1.1, before surrogate code points and\n  UTF-16 were added to Version 2.0 of the standard. This term should now\n  be avoided.</p>\n  \n  <p>UCS-2 does not describe a data format distinct from UTF-16, because\n  both use exactly the same 16-bit code unit representations. However,\n  UCS-2 does not interpret surrogate code points, and thus cannot be\n  used to conformantly represent supplementary characters.</p>\n  \n  <p>Sometimes in the past an implementation has been labeled \"UCS-2\" to\n  indicate that it does not support supplementary characters and doesn't\n  interpret pairs of surrogate code points as characters. Such an\n  implementation would not handle processing of character properties,\n  code point boundaries, collation, etc. for supplementary characters.</p>\n</blockquote>\n\n<p>UCS-2 is a proper subset of UTF-16.</p>\n\n<hr>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n\n    \"golang.org/x/text/encoding/unicode\"\n)\n\nfunc main() {\n    // \"Language Learning and Teaching\" written in 16 or more languages: UCS-2\n    // http://www.humancomp.org/unichtm/unilang.htm\n    f, err := os.Open(\"unilang.htm\")\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        os.Exit(1)\n    }\n    defer f.Close()\n\n    dec := unicode.UTF16(unicode.LittleEndian, unicode.IgnoreBOM).NewDecoder()\n    scn := bufio.NewScanner(dec.Reader(f))\n    for scn.Scan() {\n        fmt.Println(scn.Text())\n    }\n    if err := scn.Err(); err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/3VombFxUNb1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/3VombFxUNb1</a></p>\n"}], "owner": {"reputation": 11, "user_id": 7429600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6967398b953f5e4b8bf5e52017b48dbe?s=128&d=identicon&r=PG&f=1", "display_name": "B.G.Venkatraj", "link": "https://stackoverflow.com/users/7429600/b-g-venkatraj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 703, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1577749579, "creation_date": 1577702892, "last_edit_date": 1577718017, "question_id": 59529543, "link": "https://stackoverflow.com/questions/59529543/read-text-file-which-has-been-encoded-with-ucs-2-little-endian-using-go", "title": "read text file which has been encoded with UCS-2 little Endian using Go", "body": "<p>I have a Go program to read a text file similar to the code below:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    file, err := os.Open(\"test.txt\")\n\n    if err != nil {\n        log.Fatalf(\"failed opening file: %s\", err)\n    }\n\n    scanner := bufio.NewScanner(file)\n    scanner.Split(bufio.ScanLines)\n    var txtlines []string\n\n    for scanner.Scan() {\n        txtlines = append(txtlines, scanner.Text())\n    }\n\n    file.Close()\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/cnDOEFaT0lr\" rel=\"nofollow noreferrer\">https://play.golang.org/p/cnDOEFaT0lr</a></p>\n\n<p>The code works fine for all the text files except the files which have been encoded with UCS-2 little endian. How can I convert the file to UFT8 format to read it?</p>\n"}, {"tags": ["json", "api", "http", "go", "server"], "comments": [{"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 1, "creation_date": 1577702491, "post_id": 59529411, "comment_id": 105228578, "body": "How did you define <code>JSONData</code>?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1577703047, "post_id": 59529411, "comment_id": 105228806, "body": "Also add the JSON document to the question."}, {"owner": {"reputation": 11, "user_id": 11213936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1999f263e0e0e3e039e59f66c97695d?s=128&d=identicon&r=PG", "display_name": "danvixent", "link": "https://stackoverflow.com/users/11213936/danvixent"}, "edited": false, "score": 0, "creation_date": 1577704315, "post_id": 59529411, "comment_id": 105229310, "body": "it&#39;s a query to GItHub&#39;s API as follows  <a href=\"https://api.github.com/search/repositories?q=user:danvixent\" rel=\"nofollow noreferrer\">api.github.com/search/repositories?q=user:danvixent</a> (example for my own username)....mine isn&#39;t large so it gets all of the json...but for a user like microsoft...it gets only about 30 records."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1577705678, "post_id": 59529411, "comment_id": 105229824, "body": "<a href=\"https://developer.github.com/v3/guides/traversing-with-pagination/\" rel=\"nofollow noreferrer\">developer.github.com/v3/guides/traversing-with-pagination</a>"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 11213936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1999f263e0e0e3e039e59f66c97695d?s=128&d=identicon&r=PG", "display_name": "danvixent", "link": "https://stackoverflow.com/users/11213936/danvixent"}, "edited": false, "score": 2, "creation_date": 1577708013, "post_id": 59530414, "comment_id": 105230831, "body": "No they don&#39;t actually...you&#39;re only required to do so for the ones you whose corresponding json key are different e.g FulllName and &quot;full_name&quot;...this needs to be associated with a JSON tags...also Peter already gave me the solution i need in a comment above..it&#39;s not my code it&#39;s a behaviour from GitHub.. But thanks for taking the time to answer my question!!!  \ud83d\ude00"}, {"owner": {"reputation": 114, "user_id": 3464082, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09516fd5e14b754405f97fadfd0757b?s=128&d=identicon&r=PG&f=1", "display_name": "bgnfu7re", "link": "https://stackoverflow.com/users/3464082/bgnfu7re"}, "reply_to_user": {"reputation": 11, "user_id": 11213936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1999f263e0e0e3e039e59f66c97695d?s=128&d=identicon&r=PG", "display_name": "danvixent", "link": "https://stackoverflow.com/users/11213936/danvixent"}, "edited": false, "score": 0, "creation_date": 1577709525, "post_id": 59530414, "comment_id": 105231466, "body": "You&#39;re right. I&#39;ve tried to unmarshal and to my surprise, it worked. Thank you for pointing that out, that&#39;s news for me. Still, I think it is usually good to keep tags in there for two reasons. First, you pin the JSON field name, even when the name changes. Second, marshaling without a tag would result in the capital first letter. <a href=\"https://play.golang.org/p/YoZc3yViw-C\" rel=\"nofollow noreferrer\">play.golang.org/p/YoZc3yViw-C</a>"}, {"owner": {"reputation": 11, "user_id": 11213936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1999f263e0e0e3e039e59f66c97695d?s=128&d=identicon&r=PG", "display_name": "danvixent", "link": "https://stackoverflow.com/users/11213936/danvixent"}, "edited": false, "score": 0, "creation_date": 1577724690, "post_id": 59530414, "comment_id": 105238028, "body": "Yeah that is true...Thank you\ud83d\ude00"}], "tags": [], "owner": {"reputation": 114, "user_id": 3464082, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09516fd5e14b754405f97fadfd0757b?s=128&d=identicon&r=PG&f=1", "display_name": "bgnfu7re", "link": "https://stackoverflow.com/users/3464082/bgnfu7re"}, "is_accepted": false, "score": 0, "last_activity_date": 1577706848, "creation_date": 1577706848, "answer_id": 59530414, "question_id": 59529411, "link": "https://stackoverflow.com/questions/59529411/server-doest-get-all-the-json-from-remote-rest-api/59530414#59530414", "title": "Server does&#39;t get all the JSON from remote REST API", "body": "<p>The <code>JSONData</code> needs to define JSON tags.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Owner struct {\n    Login string `json:\"login\"`\n}\n\n// Item is the single repository data structure\ntype Item struct {\n    ID          int    `json:\"id\"`\n    Name        string `json:\"name\"`\n    FullName    string `json:\"full_name\"`\n    Owner       Owner  `json:\"owner\"`\n    Description string `json:\"description\"`\n    CreatedAt   string `json:\"created_at\"`\n}\n\n// JSONData contains the GitHub API response\ntype JSONData struct {\n    Count    int    `json:\"total_count\"`\n    Username string `json:\"username\"`\n    Items    []Item `json:\"items\"`\n}\n</code></pre>\n\n<hr>\n\n<p>If no tag is specified, the name is taken as-is:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Owner struct {\n  Login string\n}\n</code></pre>\n\n<p>that would be marshaled (and correspondingly unmarshalled) into similar:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>{\"Login\": \"some login\"}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 11213936, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1999f263e0e0e3e039e59f66c97695d?s=128&d=identicon&r=PG", "display_name": "danvixent", "link": "https://stackoverflow.com/users/11213936/danvixent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1577816234, "creation_date": 1577702333, "last_edit_date": 1577816234, "question_id": 59529411, "link": "https://stackoverflow.com/questions/59529411/server-doest-get-all-the-json-from-remote-rest-api", "title": "Server does&#39;t get all the JSON from remote REST API", "body": "<p>My Go server does not retrieve all the JSON data from a remote API</p>\n\n<p>I even tried creating a custom http.Client to make the request...but still it won't retrieve <strong>ALL</strong> the JSON data,and even tried extending the respective timeouts</p>\n\n<p>Here's my code:</p>\n\n<pre><code>var netTransport = &amp;http.Transport{\n        Dial: (&amp;net.Dialer{\n            Timeout: 50 * time.Second,\n        }).Dial,\n        TLSHandshakeTimeout: 50 * time.Second,\n    }\n    var netClient = &amp;http.Client{\n        Timeout:   time.Second * 40,\n        Transport: netTransport,\n    }\n    res, getErr := netClient.Get(url)\n\n    if getErr != nil {\n        log.Fatal(getErr)\n    }\n    data := JSONData{}\n    if err := json.NewDecoder(res.Body).Decode(&amp;data); err != nil {\n        log.Fatal(err)\n    }\n    data.Username = user\n    fmt.Println(data)\n</code></pre>\n\n<p>JSONData is defined as follows:</p>\n\n<pre><code>type Owner struct {\n    Login string\n}\n\n// Item is the single repository data structure\ntype Item struct {\n    ID          int\n    Name        string\n    FullName    string `json:\"full_name\"`\n    Owner       Owner\n    Description string\n    CreatedAt   string `json:\"created_at\"`\n}\n\n// JSONData contains the GitHub API response\ntype JSONData struct {\n    Count    int `json:\"total_count\"`\n    Username string\n    Items    []Item\n}\n</code></pre>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1577696618, "post_id": 59528071, "comment_id": 105226356, "body": "The code show is unlikely to show the described bbehaviour. What is wrong: You should use <code>http.Handle(&quot;&#47;files&#47;&quot;, ...)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "is_accepted": true, "score": 0, "last_activity_date": 1577758577, "creation_date": 1577758577, "answer_id": 59538845, "question_id": 59528071, "link": "https://stackoverflow.com/questions/59528071/http-handlefunc-always-match/59538845#59538845", "title": "http.HandleFunc always match &quot;/&quot;", "body": "<p>try to use \"/list/\" replace \"/list\"</p>\n\n<p>more information: <a href=\"https://pkg.go.dev/net/http?tab=doc#ServeMux\" rel=\"nofollow noreferrer\">https://pkg.go.dev/net/http?tab=doc#ServeMux</a></p>\n"}], "owner": {"reputation": 3, "user_id": 11784782, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WJw4w.png?s=128&g=1", "display_name": "sbbtd", "link": "https://stackoverflow.com/users/11784782/sbbtd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "closed_date": 1577927076, "accepted_answer_id": 59538845, "answer_count": 1, "score": -3, "last_activity_date": 1578168091, "creation_date": 1577696239, "last_edit_date": 1578168091, "question_id": 59528071, "link": "https://stackoverflow.com/questions/59528071/http-handlefunc-always-match", "closed_reason": "Needs details or clarity", "title": "http.HandleFunc always match &quot;/&quot;", "body": "<p>Code:</p>\n\n<pre><code>http.HandleFunc(\"/\", api.Index)\nhttp.HandleFunc(\"/list\", api.FileList)\n\nhttp.HandleFunc(\"/api/upload\", api.UploadFile)\nhttp.HandleFunc(\"/api/delete\", api.DeleteFile)\n\nhttp.Handle(\"/files\", http.StripPrefix(\"/files/\", http.FileServer(http.Dir(settings.FilesPath))))\n\nhttp.ListenAndServe(\":1234\", nil)\n</code></pre>\n\n<p>Result 1:</p>\n\n<p><a href=\"http://localhost:1234/\" rel=\"nofollow noreferrer\">http://localhost:1234/</a></p>\n\n<p><a href=\"http://localhost:1234/list\" rel=\"nofollow noreferrer\">http://localhost:1234/list</a></p>\n\n<p><a href=\"http://localhost:1234/files\" rel=\"nofollow noreferrer\">http://localhost:1234/files</a></p>\n\n<blockquote>\n  <p>match \"/\"</p>\n  \n  <p>api.index (It's wrong for the second and third)</p>\n</blockquote>\n\n<p>Result 2:</p>\n\n<p><a href=\"http://localhost:1234/api/upload\" rel=\"nofollow noreferrer\">http://localhost:1234/api/upload</a></p>\n\n<p><a href=\"http://localhost:1234/api/delete\" rel=\"nofollow noreferrer\">http://localhost:1234/api/delete</a></p>\n\n<blockquote>\n  <p>match \"/api/xxx\"</p>\n  \n  <p>api.xxx (It's right)</p>\n</blockquote>\n\n<p>env:</p>\n\n<p>go 1.13.5 windows/amd64</p>\n\n<p>What should I do to fix this problem?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 61700, "user_id": 5291015, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ZFijZ.jpg?s=128&g=1", "display_name": "Inian", "link": "https://stackoverflow.com/users/5291015/inian"}, "edited": false, "score": 0, "creation_date": 1577694998, "post_id": 59527702, "comment_id": 105225846, "body": "Recommend using backticks to put literal strings `  ` for regex definitions than <code>&#39;..&#39;</code> or <code>&quot;..&quot;</code>"}], "answers": [{"comments": [{"owner": {"reputation": 50117, "user_id": 243943, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1c2c4840dd73dbea59932f83d4640c56?s=128&d=identicon&r=PG", "display_name": "npinti", "link": "https://stackoverflow.com/users/243943/npinti"}, "edited": false, "score": 0, "creation_date": 1577694308, "post_id": 59527729, "comment_id": 105225660, "body": "Didn&#39;t the OP say that it <i>cannot</i> return <code>false</code> those cases?"}, {"owner": {"reputation": 5550, "user_id": 2416394, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/daugZ.jpg?s=128&g=1", "display_name": "Samuel", "link": "https://stackoverflow.com/users/2416394/samuel"}, "reply_to_user": {"reputation": 50117, "user_id": 243943, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1c2c4840dd73dbea59932f83d4640c56?s=128&d=identicon&r=PG", "display_name": "npinti", "link": "https://stackoverflow.com/users/243943/npinti"}, "edited": false, "score": 2, "creation_date": 1577695325, "post_id": 59527729, "comment_id": 105225954, "body": "@npinti I assumed language barriers here because he technically repeated himself regarding the last three matches saying he &quot;want false&quot; but &quot;cannot return false&quot;"}], "tags": [], "owner": {"reputation": 5550, "user_id": 2416394, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/daugZ.jpg?s=128&g=1", "display_name": "Samuel", "link": "https://stackoverflow.com/users/2416394/samuel"}, "is_accepted": true, "score": 1, "last_activity_date": 1577694258, "creation_date": 1577694258, "answer_id": 59527729, "question_id": 59527702, "link": "https://stackoverflow.com/questions/59527702/how-regex-match-exact-3-numbers/59527729#59527729", "title": "How regex match exact 3 numbers", "body": "<p>You are close, try restricting the match with <code>^[.]{1}[0-9]{3}$</code></p>\n\n<p><a href=\"https://regex101.com/r/fZ8AI6/1\" rel=\"nofollow noreferrer\">See online demo</a></p>\n"}, {"tags": [], "owner": {"reputation": 12662, "user_id": 997162, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/M5HoQ.png?s=128&g=1", "display_name": "emix", "link": "https://stackoverflow.com/users/997162/emix"}, "is_accepted": false, "score": 2, "last_activity_date": 1577801052, "last_edit_date": 1577801052, "creation_date": 1577698140, "answer_id": 59528463, "question_id": 59527702, "link": "https://stackoverflow.com/questions/59527702/how-regex-match-exact-3-numbers/59528463#59528463", "title": "How regex match exact 3 numbers", "body": "<p>The pattern is as simple as: </p>\n\n<pre><code>^\\.\\d{3}$\n</code></pre>\n\n<p>Same as:</p>\n\n<pre><code>^\\.[0-9]{3}$\n</code></pre>\n\n<p>Which is:</p>\n\n<pre><code>^     // from the beginning\n\\.    // a single dot\n\\d{3} // a digit (exactly 3 times)\n$     // until the end of the string\n</code></pre>\n\n<p>You have to escape the <code>\\</code> symbol though so: <code>^\\\\.\\\\d{3}$</code></p>\n\n<p><a href=\"https://regex101.com/r/IkLhWO/1\" rel=\"nofollow noreferrer\">Regexp Demo</a>. <a href=\"https://play.golang.org/p/dYFM-ZvApH8\" rel=\"nofollow noreferrer\">Go Demo</a>.</p>\n"}], "owner": {"reputation": 3105, "user_id": 963844, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4b3e62d69f8a00a6c03829c82f833852?s=128&d=identicon&r=PG", "display_name": "CL So", "link": "https://stackoverflow.com/users/963844/cl-so"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "closed_date": 1577735170, "accepted_answer_id": 59527729, "answer_count": 2, "score": -1, "last_activity_date": 1577801052, "creation_date": 1577694058, "last_edit_date": 1577699940, "question_id": 59527702, "link": "https://stackoverflow.com/questions/59527702/how-regex-match-exact-3-numbers", "closed_reason": "Duplicate", "title": "How regex match exact 3 numbers", "body": "<p>I want true for these cases:</p>\n\n<pre><code>.123\n.000\n.999\n</code></pre>\n\n<p>And want false for these cases:</p>\n\n<pre><code>123\na123\n.123a\n.1234\na.123\n</code></pre>\n\n<p>This is my current regex:</p>\n\n<pre><code>match, _ := regexp.MatchString(\"[.]{1}[0-9]{3}\", \".123a\")\nfmt.Println(match)\n</code></pre>\n\n<p>But this pattern doesn't return <code>false</code> for:</p>\n\n<pre><code>.123a\n.1234\na.123\n</code></pre>\n\n<p>What is the correct regex?</p>\n"}, {"tags": ["go", "types", "package"], "comments": [{"owner": {"reputation": 1564, "user_id": 7152771, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/79oVK.jpg?s=128&g=1", "display_name": "Wanda Ichsanul Isra", "link": "https://stackoverflow.com/users/7152771/wanda-ichsanul-isra"}, "edited": false, "score": 0, "creation_date": 1577693166, "post_id": 59527479, "comment_id": 105225326, "body": "Are you currently using <code>Go</code> extension in VS Code?"}, {"owner": {"reputation": 21, "user_id": 12623699, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-1-DU0pNuyf8/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-ho0T01AMQRezEiyiT6X8It_YZIIg/mo/photo.jpg?sz=128", "display_name": "Hannibal Rasberry", "link": "https://stackoverflow.com/users/12623699/hannibal-rasberry"}, "reply_to_user": {"reputation": 1564, "user_id": 7152771, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/79oVK.jpg?s=128&g=1", "display_name": "Wanda Ichsanul Isra", "link": "https://stackoverflow.com/users/7152771/wanda-ichsanul-isra"}, "edited": false, "score": 0, "creation_date": 1577693491, "post_id": 59527479, "comment_id": 105225417, "body": "I believe so yes, and I using a Mac desktop to run my program. And for the life of me, I don&#39;t understand what is causing this issue."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577713780, "post_id": 59527479, "comment_id": 105233334, "body": "By default, VSC runs a formatter on save. The default formatter it runs will remove <i>unused</i> imports. It is correct to remove unused imports. The fix would be to use the import you&#39;ve added before saving the file."}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 12623699, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-1-DU0pNuyf8/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-ho0T01AMQRezEiyiT6X8It_YZIIg/mo/photo.jpg?sz=128", "display_name": "Hannibal Rasberry", "link": "https://stackoverflow.com/users/12623699/hannibal-rasberry"}, "is_accepted": true, "score": 0, "last_activity_date": 1586835806, "last_edit_date": 1586835806, "creation_date": 1577747207, "answer_id": 59537795, "question_id": 59527479, "link": "https://stackoverflow.com/questions/59527479/my-visual-studio-code-app-keeps-deleting-my-imported-package/59537795#59537795", "title": "My Visual Studio code app keeps deleting my imported package", "body": "<p>I found the solution to my problem. Turns out it was a simple matter of how I was naming the variables in the second file. I was naming the variables how I usually do by underlining the first letter and capitalizing the second. Which works fine in the main executable file, but creates an unreadable error for Golang when you are trying to call it to your main file. </p>\n\n<p>By simply renaming the variables and capitalizing the first letter of the file instead, when you call it to the second file, it seems to work without any more trouble. </p>\n\n<p>Thanks to everyone who tried to help me out on the matter, because I spent a few hours trying to figure out what I was doing wrong. </p>\n"}], "owner": {"reputation": 21, "user_id": 12623699, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-1-DU0pNuyf8/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-ho0T01AMQRezEiyiT6X8It_YZIIg/mo/photo.jpg?sz=128", "display_name": "Hannibal Rasberry", "link": "https://stackoverflow.com/users/12623699/hannibal-rasberry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "accepted_answer_id": 59537795, "answer_count": 1, "score": -2, "last_activity_date": 1586836368, "creation_date": 1577692675, "last_edit_date": 1586836368, "question_id": 59527479, "link": "https://stackoverflow.com/questions/59527479/my-visual-studio-code-app-keeps-deleting-my-imported-package", "title": "My Visual Studio code app keeps deleting my imported package", "body": "<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n\n    type (\n        fullGram int\n\n        fullKilogram int\n\n        fullTon int\n    )\n\n\nvar (\n    salt fullGram = 100\n\n    apples fullKilogram = 5\n\n    truck fullTon = 10\n)\n\nfmt.Printf(\"salt: %d, apples: %d, truck: %d\\n\", salt, apples, truck)\n\nsalt = fullGram(weights.callGram(100))\n\nfmt.Printf(\"Type of weights.Gram: %T\\n\", weights.callGram(1))\n\n\n}\n\n\npackage weight\n\ntype (\n\n        callGram int\n\n       callKilogram int\n\n       callTon int\n)\n</code></pre>\n\n<p>I am working on a simple code program that is supposed to call a type from another custom file. \nThe problem I have with it is that whenever I try to import the path <code>/Users/inanc/go/src/github.com/inancgumus/learngo/weights</code> my app will instantly delete the import upon my attempt to save the file. </p>\n\n<p>And because of this, I can never call the file properly. </p>\n"}, {"tags": ["go", "recursion"], "answers": [{"comments": [{"owner": {"reputation": 571, "user_id": 5727581, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/9e5874b115166d204073fbb1d730f29c?s=128&d=identicon&r=PG&f=1", "display_name": "ABSimon", "link": "https://stackoverflow.com/users/5727581/absimon"}, "edited": false, "score": 0, "creation_date": 1577699349, "post_id": 59528469, "comment_id": 105227299, "body": "thanks, this works. (but still dont know how to use n.FirstChild.NextSibling. In the loop it works... maybe someday I&#39;ll get it ;))"}, {"owner": {"reputation": 571, "user_id": 5727581, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/9e5874b115166d204073fbb1d730f29c?s=128&d=identicon&r=PG&f=1", "display_name": "ABSimon", "link": "https://stackoverflow.com/users/5727581/absimon"}, "edited": false, "score": 0, "creation_date": 1577700144, "post_id": 59528469, "comment_id": 105227633, "body": "Ok, I get it. <a href=\"https://play.golang.org/p/MRRQBww4mgd\" rel=\"nofollow noreferrer\">play.golang.org/p/MRRQBww4mgd</a> When using n.FirstChild.NextSibling, there might be more turns needed than two..."}], "tags": [], "owner": {"reputation": 102, "user_id": 12603592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KXTp8.jpg?s=128&g=1", "display_name": "PatrickMahomes", "link": "https://stackoverflow.com/users/12603592/patrickmahomes"}, "is_accepted": true, "score": 0, "last_activity_date": 1577698159, "creation_date": 1577698159, "answer_id": 59528469, "question_id": 59527440, "link": "https://stackoverflow.com/questions/59527440/how-to-replace-a-simple-two-turn-loop-with-two-manual-calls-tricky/59528469#59528469", "title": "How to replace a simple two turn loop, with two manual calls (tricky)", "body": "<p>If you want to go with the second group of code you suggested that has a weird indent, here is the solution:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"strings\"\n\n    \"golang.org/x/net/html\"\n)\n\nfunc main() {\n    r := strings.NewReader(`&lt;a href=\"test1.html\"&gt;1&lt;/a&gt;&lt;a href=\"test1.html\"&gt;1&lt;/a&gt;&lt;div&gt;&lt;a href=\"test2.html\"&gt;2&lt;/a&gt;&lt;a href=\"test3.html\"&gt;3&lt;/a&gt;&lt;/div&gt;`)\n    doc, err := html.Parse(r)\n    if err != nil {\n        log.Fatalln(err)\n    }\n    indent(\"\", doc)\n}\n\nfunc indent(space string, n *html.Node) {\n    fmt.Println(space, n.Data)\n\n    if n.FirstChild != nil {\n        indent(space+\"   \", n.FirstChild)\n    }\n    if n.NextSibling != nil {\n        indent(space, n.NextSibling)\n    }\n}\n</code></pre>\n\n<p>You just have to remove the extra <code>+\"    \"</code> for the indent call with <code>n.NextSibling</code> so that sibling nodes are not pushed out further than their previous siblings.</p>\n"}], "owner": {"reputation": 571, "user_id": 5727581, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/9e5874b115166d204073fbb1d730f29c?s=128&d=identicon&r=PG&f=1", "display_name": "ABSimon", "link": "https://stackoverflow.com/users/5727581/absimon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 59528469, "answer_count": 1, "score": 0, "last_activity_date": 1577699952, "creation_date": 1577692453, "last_edit_date": 1577699952, "question_id": 59527440, "link": "https://stackoverflow.com/questions/59527440/how-to-replace-a-simple-two-turn-loop-with-two-manual-calls-tricky", "title": "How to replace a simple two turn loop, with two manual calls (tricky)", "body": "<p>Here is the code: <a href=\"https://play.golang.org/p/Sizbc3uJt_c\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Sizbc3uJt_c</a></p>\n\n<p>I try to replace this simple loop</p>\n\n<pre><code>for c := n.FirstChild; c != nil; c = c.NextSibling {\n    indent(space+\"   \", c)\n}\n</code></pre>\n\n<p>which produces </p>\n\n<pre><code>html\n   head\n   body\n      a\n         1\n      a\n         1\n      div\n         a\n            2\n         a\n            3\n</code></pre>\n\n<p>When I try this</p>\n\n<pre><code>if n.FirstChild != nil {\n    indent(space+\"   \", n.FirstChild)\n}\nif n.FirstChild != nil &amp;&amp; n.FirstChild.NextSibling != nil {\n    indent(space+\"   \", n.FirstChild.NextSibling)\n}\n</code></pre>\n\n<p>the output is only half     </p>\n\n<pre><code>html\n   head\n   body\n      a\n         1\n      a\n         1\n</code></pre>\n\n<p>And when I try this </p>\n\n<pre><code>if n.FirstChild != nil {\n    indent(space+\"   \", n.FirstChild)\n}\nif n.NextSibling != nil {\n    indent(space+\"   \", n.NextSibling)\n}\n</code></pre>\n\n<p>the output is complete, but indent is different. The result is</p>\n\n<pre><code>html\n   head\n      body\n         a\n            1\n            a\n               1\n               div\n                  a\n                     2\n                     a\n                        3\n</code></pre>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 264, "user_id": 5353730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ccd4d1c05cf575710739c8a8e792d78d?s=128&d=identicon&r=PG", "display_name": "Zoinks", "link": "https://stackoverflow.com/users/5353730/zoinks"}, "edited": false, "score": 1, "creation_date": 1577692727, "post_id": 59527254, "comment_id": 105225196, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/37118263/is-it-possible-to-have-a-struct-with-multiple-json-tags\">Is it possible to have a struct with multiple JSON tags?</a>"}, {"owner": {"reputation": 65, "user_id": 9106111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cd738d66a94bab3e75847de116dd1a7?s=128&d=identicon&r=PG&f=1", "display_name": "sandeep gaur", "link": "https://stackoverflow.com/users/9106111/sandeep-gaur"}, "reply_to_user": {"reputation": 264, "user_id": 5353730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ccd4d1c05cf575710739c8a8e792d78d?s=128&d=identicon&r=PG", "display_name": "Zoinks", "link": "https://stackoverflow.com/users/5353730/zoinks"}, "edited": false, "score": 0, "creation_date": 1577695400, "post_id": 59527254, "comment_id": 105225979, "body": "Yeah, Thank You."}], "answers": [{"tags": [], "owner": {"reputation": 264, "user_id": 5353730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ccd4d1c05cf575710739c8a8e792d78d?s=128&d=identicon&r=PG", "display_name": "Zoinks", "link": "https://stackoverflow.com/users/5353730/zoinks"}, "is_accepted": false, "score": 3, "last_activity_date": 1577692527, "creation_date": 1577692527, "answer_id": 59527448, "question_id": 59527254, "link": "https://stackoverflow.com/questions/59527254/one-struct-multiple-json-representation/59527448#59527448", "title": "One struct multiple json representation", "body": "<p>I am not sure which package are you importing that uses <code>form</code> struct tag, but to try and answer the question, I am assuming it is similar to <code>json</code> tag that is imported by <code>encoding/json</code> package.</p>\n\n<p>In short, no it is not possible to have a same <strong>struct tag</strong> for a field, as answered in this SOF question - <a href=\"https://stackoverflow.com/a/37118633/5353730\">https://stackoverflow.com/a/37118633/5353730</a></p>\n\n<p>The OP in above question was trying to accomplish something like:</p>\n\n<pre><code>type Foo struct {\n    Name string `json:\"name\" json:\"employee_name\"`\n    Age  int    `json:\"age\" json:\"-\"`\n}     \n</code></pre>\n\n<p>...which I assume is what you want to achieve.</p>\n\n<p>If, however, you might've been trying to use different meta tags for the same field, then that is easily supportable as shown in this answer - <a href=\"https://stackoverflow.com/a/18635910/5353730\">https://stackoverflow.com/a/18635910/5353730</a></p>\n\n<pre><code>type Page struct {\n    PageId string                 `bson:\"pageId\" json:\"pageId\"`\n    Meta   map[string]interface{} `bson:\"meta\" json:\"meta\"`\n}\n</code></pre>\n\n<p>P.S. You can always create 2 separate fields, one each for <code>itId</code> and <code>ItrId</code> to solve your problem but then you will need to check for both these fields at the place of usage of struct.</p>\n"}], "owner": {"reputation": 65, "user_id": 9106111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cd738d66a94bab3e75847de116dd1a7?s=128&d=identicon&r=PG&f=1", "display_name": "sandeep gaur", "link": "https://stackoverflow.com/users/9106111/sandeep-gaur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "closed_date": 1577695304, "answer_count": 1, "score": -1, "last_activity_date": 1577693365, "creation_date": 1577691323, "last_edit_date": 1577693365, "question_id": 59527254, "link": "https://stackoverflow.com/questions/59527254/one-struct-multiple-json-representation", "closed_reason": "Duplicate", "title": "One struct multiple json representation", "body": "<p>The Problem I am trying to solve is that I have a representation as below:</p>\n\n<pre><code>type Request struct{\nItId string `form:\"itId\"`\ntR string `form:\"treason\"`\ncd string `form:\"cdetails\"`\n}\n</code></pre>\n\n<p>but I want the above one in such a manner that it can accept: </p>\n\n<pre><code>itId and ItrId   both for ItId\n</code></pre>\n\n<p>It will be something like this:</p>\n\n<pre><code>type Request struct{\nItId string `form:\"itId\"` || ItId string `form:\"ItrId\"`\ntR string `form:\"treason\"`\ncd string `form:\"cdetails\"`\n}\n</code></pre>\n\n<p>what can be the possible solution for such a case?</p>\n"}, {"tags": ["go", "concurrency", "race-condition", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 68, "user_id": 7870746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mKG7t.jpg?s=128&g=1", "display_name": "Nicky Logan", "link": "https://stackoverflow.com/users/7870746/nicky-logan"}, "edited": false, "score": 1, "creation_date": 1577693244, "post_id": 59527391, "comment_id": 105225350, "body": "If <code>wg.Add(1)</code> is added before <code>p.work()</code>, won&#39;t <code>wg</code> only reach 100? Let&#39;s say there are 1000 jobs in queue. Won&#39;t <code>wg</code> reach 0 after 100 jobs are finished?"}, {"owner": {"reputation": 2815, "user_id": 123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eeb220ccf249757b0960465f2b10631?s=128&d=identicon&r=PG", "display_name": "icio", "link": "https://stackoverflow.com/users/123600/icio"}, "edited": false, "score": 1, "creation_date": 1577727893, "post_id": 59527391, "comment_id": 105239206, "body": "It would, yes. pipe.work&#39;s wg.Done should be deferred on its first line, or preferably moves into an anonymous function wrapping the p.work call in pipe.Process so that wg doesn&#39;t need to be passed around at all."}, {"owner": {"reputation": 29795, "user_id": 720030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ed0a5a78d65824827fb112e8e716f8?s=128&d=identicon&r=PG", "display_name": "karmakaze", "link": "https://stackoverflow.com/users/720030/karmakaze"}, "edited": false, "score": 0, "creation_date": 1577728173, "post_id": 59527391, "comment_id": 105239297, "body": "Yes right. You could pass the <code>wg</code> to the thing that consumes <code>out</code> and call <code>wg.Done</code> after each is consumed."}, {"owner": {"reputation": 68, "user_id": 7870746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mKG7t.jpg?s=128&g=1", "display_name": "Nicky Logan", "link": "https://stackoverflow.com/users/7870746/nicky-logan"}, "reply_to_user": {"reputation": 2815, "user_id": 123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eeb220ccf249757b0960465f2b10631?s=128&d=identicon&r=PG", "display_name": "icio", "link": "https://stackoverflow.com/users/123600/icio"}, "edited": false, "score": 0, "creation_date": 1577754774, "post_id": 59527391, "comment_id": 105247058, "body": "@icio Yes, that would work. @karmakaze I&#39;m trying to avoid the user of <code>out</code> having to deal with any details about <code>wg</code>."}, {"owner": {"reputation": 29795, "user_id": 720030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ed0a5a78d65824827fb112e8e716f8?s=128&d=identicon&r=PG", "display_name": "karmakaze", "link": "https://stackoverflow.com/users/720030/karmakaze"}, "edited": false, "score": 0, "creation_date": 1577755665, "post_id": 59527391, "comment_id": 105247232, "body": "In that case, having the single sender do the <code>wg.Add</code> and the processor do <code>wg.Done</code> at end makes sense."}], "tags": [], "owner": {"reputation": 29795, "user_id": 720030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ed0a5a78d65824827fb112e8e716f8?s=128&d=identicon&r=PG", "display_name": "karmakaze", "link": "https://stackoverflow.com/users/720030/karmakaze"}, "is_accepted": false, "score": 0, "last_activity_date": 1577692184, "creation_date": 1577692184, "answer_id": 59527391, "question_id": 59527245, "link": "https://stackoverflow.com/questions/59527245/race-condition-between-close-and-send-to-channel/59527391#59527391", "title": "Race condition between close and send to channel", "body": "<p>It's possible that the jobs are being completed just as fast as they're being sent. In this case the WaitGroup will be floating near zero even while there's many more items to process.</p>\n\n<p>One fix for this is to add one before sending jobs, and decrement that one after sending them all, effectively consider the sender to be one of the 'jobs'. In this case, it's better if we do the <code>wg.Add</code> in the sender:</p>\n\n<pre><code>func (p *pipe) Process(in chan interface{}) (out chan interface{}) {\n    var wg sync.WaitGroup\n    out = make(chan interface{}, 100)\n    go func() {\n        for i := 1; i &lt;= 100; i++ {\n            wg.Add(1)\n            go p.work(in, out, &amp;wg)\n        }\n        wg.Wait()\n        close(out)\n    }()\n\n    return\n}\n\nfunc (p *pipe) work(jobs &lt;-chan interface{}, out chan&lt;- interface{}, wg *sync.WaitGroup) {\n    for j := range jobs {\n        func(j Job) {\n            res := doSomethingWith(j)\n\n            out &lt;- res\n            wg.Done()\n        }(j)\n    }\n}\n</code></pre>\n\n<p>One thing I notice in the code is that a goroutine is started for each job. At the same time each job processes the <code>jobs</code> channel in a loop until empty/closed. It doesn't seem necessary to do both.</p>\n"}, {"comments": [{"owner": {"reputation": 68, "user_id": 7870746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mKG7t.jpg?s=128&g=1", "display_name": "Nicky Logan", "link": "https://stackoverflow.com/users/7870746/nicky-logan"}, "edited": false, "score": 0, "creation_date": 1577750697, "post_id": 59528670, "comment_id": 105246297, "body": "To clarify, no I&#39;m not trying to assign a worker to <i>each</i> job. The idea is that once a worker is finished with its job, it can immediately take another job from the job queue."}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 0, "last_activity_date": 1577699293, "last_edit_date": 1577699293, "creation_date": 1577698969, "answer_id": 59528670, "question_id": 59527245, "link": "https://stackoverflow.com/questions/59527245/race-condition-between-close-and-send-to-channel/59528670#59528670", "title": "Race condition between close and send to channel", "body": "<p>It's not clear why you want one worker per job, but if you do, you can restructure your outer loop setup (see untested code below).  This kind of obviates the need for worker pools in the first place.</p>\n\n<p>Always, though, do a <code>wg.Add</code> <em>before</em> spinning off any worker.  Right here, you are spinning off exactly 100 workers:</p>\n\n<pre><code>var wg sync.WaitGroup\nout = make(chan interface{}, 100)\ngo func() {\n    for i := 1; i &lt;= 100; i++ {\n        go p.work(in, out, &amp;wg)\n    }\n    wg.Wait()\n    close(out)\n}()\n</code></pre>\n\n<p>You could therefore do this:</p>\n\n<pre><code>var wg sync.WaitGroup\nout = make(chan interface{}, 100)\ngo func() {\n    wg.Add(100)  // ADDED - count the 100 workers\n    for i := 1; i &lt;= 100; i++ {\n        go p.work(in, out, &amp;wg)\n    }\n    wg.Wait()\n    close(out)\n}()\n</code></pre>\n\n<p>Note that you can now move <code>wg</code> itself down into the goroutine that spins off the workers.  This can make things cleaner, if you give up on the notion of having each worker spin off jobs as new goroutines.  But if each worker is going to spin off another goroutine, that worker itself must also use <code>wg.Add</code>, like this:</p>\n\n<pre><code>for j := range jobs {\n    wg.Add(1)  // ADDED - count the spun-off goroutines\n    func(j Job) {\n        res := doSomethingWith(j)\n\n        out &lt;- res\n        wg.Done()  // MOVED (for illustration only, can defer as before)\n    }(j)\n}\nwg.Done() // ADDED - our work in `p.work` is now done\n</code></pre>\n\n<p>That is, each anonymous function is another user of the channel, so increment the users-of-channel count (<code>wg.Add(1)</code>) before spinning off a new goroutine.  When you have finished reading the input channel <code>jobs</code>, call <code>wg.Done()</code> (perhaps via an earlier <code>defer</code>, but I showed it at the end here).</p>\n\n<p><strong>The key to thinking about this is that <code>wg</code> counts the number of active goroutines that <em>could</em>, at this point, write to the channel.  It only goes to zero when <em>no</em> goroutines intend to write any more.</strong>  That makes it safe to close the channel.</p>\n\n<hr>\n\n<p>Consider using the rather simpler (but untested):</p>\n\n<pre><code>func (p *pipe) Process(in chan interface{}) (out chan interface{}) {\n    out = make(chan interface{})\n    var wg sync.WaitGroup\n    go func() {\n        defer close(out)\n        for j := range in {\n            wg.Add(1)\n            go func(j Job) {\n                res := doSomethingWith(j)\n                out &lt;- res\n                wg.Done()\n            }(j)\n        }\n        wg.Wait()\n    }()\n    return out\n}\n</code></pre>\n\n<p>You now have one goroutine that is reading the <code>in</code> channel as fast as it can, spinning off jobs as it goes.  You'll get one goroutine per incoming job, except when they finish their work early.  There is no pool, just one worker per job (same as your code except that we knock out the pools that aren't doing anything useful).</p>\n\n<hr>\n\n<p>Or, since there are only some number of CPUs available, spin off some number of goroutines as you did before at the start, but have each one run <em>one</em> job to completion, and deliver its result, then go back to reading the next job:</p>\n\n<pre><code>func (p *pipe) Process(in chan interface{}) (out chan interface{}) {\n    out = make(chan interface{})\n    go func() {\n        defer close(out)\n        var wg sync.WaitGroup\n        ncpu := runtime.NumCPU()  // or something fancier if you like\n        wg.Add(ncpu)\n        for i := 0; i &lt; ncpu; i++ {\n            go func() {\n                defer wg.Done()\n                for j := range in {\n                    out &lt;- doSomethingWith(j)\n                }\n            }()\n        }\n        wg.Wait()\n    }\n    return out\n}\n</code></pre>\n\n<p>By using <code>runtime.NumCPU()</code> we get only as many workers reading jobs as there are CPUs to run jobs.  Those are the pools and they only do one job at a time.</p>\n\n<p>There's generally no need to buffer the output channel, if the output-channel readers are well-structured (i.e., don't cause the pipeline to constipate).  If they're not, the depth of buffering here limits how many jobs you can \"work ahead\" of whoever is consuming the results.  Set it based on how useful it is to do this \"working ahead\"\u2014not necessarily the number of CPUs, or the number of expected jobs, or whatever.</p>\n"}], "owner": {"reputation": 68, "user_id": 7870746, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mKG7t.jpg?s=128&g=1", "display_name": "Nicky Logan", "link": "https://stackoverflow.com/users/7870746/nicky-logan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 228, "favorite_count": 0, "accepted_answer_id": 59528670, "answer_count": 2, "score": 0, "last_activity_date": 1577699974, "creation_date": 1577691279, "last_edit_date": 1577699974, "question_id": 59527245, "link": "https://stackoverflow.com/questions/59527245/race-condition-between-close-and-send-to-channel", "title": "Race condition between close and send to channel", "body": "<p>I'm trying to build a generic pipeline library using worker pools. I created an interface for a source, pipe, and sink. You see, the pipe's job is to receive data from an input channel, process it, and output the result onto a channel. Here is its intended behavior: </p>\n\n<ol>\n<li>Receive data from an input channel.</li>\n<li>Delegate the data to an available worker.</li>\n<li>The worker sends the result to the output channel.</li>\n<li>Close the output channel once all workers are finished.</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (p *pipe) Process(in chan interface{}) (out chan interface{}) {\n    var wg sync.WaitGroup\n    out = make(chan interface{}, 100)\n    go func() {\n        for i := 1; i &lt;= 100; i++ {\n            go p.work(in, out, &amp;wg)\n        }\n        wg.Wait()\n        close(out)\n    }()\n\n    return\n}\n\nfunc (p *pipe) work(jobs &lt;-chan interface{}, out chan&lt;- interface{}, wg *sync.WaitGroup) {\n    for j := range jobs {\n        func(j Job) {\n            defer wg.Done()\n            wg.Add(1)\n\n            res := doSomethingWith(j)\n\n            out &lt;- res\n        }(j)\n    }\n}\n\n</code></pre>\n\n<p>However, running it may either exit without processing all of the inputs or panic with a <code>send on closed channel</code> message. Building the source with the <code>-race</code> flag gives out a data race warning between <code>close(out)</code> and <code>out &lt;- res</code>.</p>\n\n<p>Here's what I think might happen. Once a number of workers have finished their jobs, there's a split second where <code>wg</code>'s counter reach zero. Hence, <code>wg.Wait()</code> is done and the program proceeds to <code>close(out)</code>. Meanwhile, the job channel isn't finished producing data, meaning some workers are still running in another goroutine. Since the <code>out</code> channel is already closed, it results in a panic.</p>\n\n<p>Should the wait group be placed somewhere else? Or is there a better way to wait for all workers to finish?</p>\n"}, {"tags": ["go", "jwt", "toml"], "comments": [{"owner": {"reputation": 1564, "user_id": 7152771, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/79oVK.jpg?s=128&g=1", "display_name": "Wanda Ichsanul Isra", "link": "https://stackoverflow.com/users/7152771/wanda-ichsanul-isra"}, "edited": false, "score": 0, "creation_date": 1577689419, "post_id": 59526864, "comment_id": 105224243, "body": "Are you using any Go dependency management like <code>dep</code> or <code>go module</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 10886548, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vgHxHydckQo/AAAAAAAAAAI/AAAAAAAABGE/tmkeZI7djtM/photo.jpg?sz=128", "display_name": "arsaphone", "link": "https://stackoverflow.com/users/10886548/arsaphone"}, "edited": false, "score": 0, "creation_date": 1577690146, "post_id": 59526892, "comment_id": 105224439, "body": "if i would ask, where does the system save the file after go get?"}, {"owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "reply_to_user": {"reputation": 1, "user_id": 10886548, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vgHxHydckQo/AAAAAAAAAAI/AAAAAAAABGE/tmkeZI7djtM/photo.jpg?sz=128", "display_name": "arsaphone", "link": "https://stackoverflow.com/users/10886548/arsaphone"}, "edited": false, "score": 0, "creation_date": 1577690182, "post_id": 59526892, "comment_id": 105224449, "body": "in the <code>$GOPATH&#47;src</code>"}, {"owner": {"reputation": 1, "user_id": 10886548, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vgHxHydckQo/AAAAAAAAAAI/AAAAAAAABGE/tmkeZI7djtM/photo.jpg?sz=128", "display_name": "arsaphone", "link": "https://stackoverflow.com/users/10886548/arsaphone"}, "edited": false, "score": 0, "creation_date": 1577692043, "post_id": 59526892, "comment_id": 105224991, "body": "oh yeah thanks! any other way to run that main.go as background process as windows?"}], "tags": [], "owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "is_accepted": true, "score": 1, "last_activity_date": 1577689136, "creation_date": 1577689136, "answer_id": 59526892, "question_id": 59526864, "link": "https://stackoverflow.com/questions/59526864/error-in-compiling-golang-after-migrating-to-centos/59526892#59526892", "title": "Error in compiling golang after migrating to centos", "body": "<p>looks like you have configured your GOPATH, without Go Module, you can use <code>go get [package path]</code> to download imported packages.</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>go get github.com/BurntSushi/toml\ngo get github.com/dgrijalva/jwt-go\ngo get github.com/gwlkm_service/config\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 10886548, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vgHxHydckQo/AAAAAAAAAAI/AAAAAAAABGE/tmkeZI7djtM/photo.jpg?sz=128", "display_name": "arsaphone", "link": "https://stackoverflow.com/users/10886548/arsaphone"}, "edited": false, "score": 0, "creation_date": 1577692777, "post_id": 59527295, "comment_id": 105225211, "body": "Okay sir thanks. any way to run the main.go as background process?"}, {"owner": {"reputation": 1893, "user_id": 2223260, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c5071efdc4b75172b161f42f9758a019?s=128&d=identicon&r=PG", "display_name": "anshuVersatile", "link": "https://stackoverflow.com/users/2223260/anshuversatile"}, "reply_to_user": {"reputation": 1, "user_id": 10886548, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vgHxHydckQo/AAAAAAAAAAI/AAAAAAAABGE/tmkeZI7djtM/photo.jpg?sz=128", "display_name": "arsaphone", "link": "https://stackoverflow.com/users/10886548/arsaphone"}, "edited": false, "score": 0, "creation_date": 1577694461, "post_id": 59527295, "comment_id": 105225702, "body": "use <code>pm2</code> <i>or</i> use nohup <i>or</i> add &amp; in the end of command like <code>go run main.go &amp;</code>"}], "tags": [], "owner": {"reputation": 1893, "user_id": 2223260, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c5071efdc4b75172b161f42f9758a019?s=128&d=identicon&r=PG", "display_name": "anshuVersatile", "link": "https://stackoverflow.com/users/2223260/anshuversatile"}, "is_accepted": false, "score": 0, "last_activity_date": 1577691619, "creation_date": 1577691619, "answer_id": 59527295, "question_id": 59526864, "link": "https://stackoverflow.com/questions/59526864/error-in-compiling-golang-after-migrating-to-centos/59527295#59527295", "title": "Error in compiling golang after migrating to centos", "body": "<p>Precisely</p>\n\n<p>your go installation on server seems in <code>/usr/local/go</code> and\nyour project is in <code>/root/work</code>\nso all your dependencies should be either in <code>/root/work/src</code> or <code>/usr/local/go/src</code></p>\n\n<p>now coming to action check your <code>GOPATH</code> with running <code>echo $GOPATH</code> \nassuming it is automatically set to <code>/usr/local/go/src</code>\nIf not then follow - <a href=\"https://stackoverflow.com/questions/21001387/how-do-i-set-the-gopath-environment-variable-on-ubuntu-what-file-must-i-edit\">How do I SET the GOPATH environment variable on Ubuntu? What file must I edit?</a></p>\n\n<p>If everything is ok then in your folder run <code>go mod init</code></p>\n\n<p>this will create mod file which will help you in further installations\nlook into - <a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">https://blog.golang.org/using-go-modules</a></p>\n\n<p>then run go get commands as above @beiping96 said</p>\n\n<p><code>go get github.com/BurntSushi/toml</code>\n<code>go get github.com/dgrijalva/jwt-go</code>\n<code>go get github.com/gwlkm_service/config</code></p>\n\n<p>NOTE - after completing above process you will generate go modules file(same as package.json) and in future you won't need to care about dependencies </p>\n"}], "owner": {"reputation": 1, "user_id": 10886548, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vgHxHydckQo/AAAAAAAAAAI/AAAAAAAABGE/tmkeZI7djtM/photo.jpg?sz=128", "display_name": "arsaphone", "link": "https://stackoverflow.com/users/10886548/arsaphone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 347, "favorite_count": 0, "accepted_answer_id": 59526892, "answer_count": 2, "score": -1, "last_activity_date": 1577705884, "creation_date": 1577688906, "last_edit_date": 1577705884, "question_id": 59526864, "link": "https://stackoverflow.com/questions/59526864/error-in-compiling-golang-after-migrating-to-centos", "title": "Error in compiling golang after migrating to centos", "body": "<p>I was migrating my <strong>Golang</strong> programs from windows to Centos 7</p>\n\n<p>It worked perfectly in Windows<br>\nbut when I tried to <strong>compile on centos</strong> I get errors like</p>\n\n<pre><code>main.go:20:3: cannot find package \"github.com/BurntSushi/toml\" in any of:\n        /usr/local/go/src/github.com/BurntSushi/toml (from $GOROOT)\n        /root/work/src/github.com/BurntSushi/toml (from $GOPATH)\nmain.go:15:3: cannot find package \"github.com/dgrijalva/jwt-go\" in any of:\n        /usr/local/go/src/github.com/dgrijalva/jwt-go (from $GOROOT)\n        /root/work/src/github.com/dgrijalva/jwt-go (from $GOPATH)\nmain.go:16:3: cannot find package \"github.com/gwlkm_service/config\" in any of:\n        /usr/local/go/src/github.com/gwlkm_service/config (from $GOROOT)\n        /root/work/src/github.com/gwlkm_service/config (from $GOPATH)\n</code></pre>\n\n<p>kinda new to centos so idk what to do</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "is_accepted": false, "score": 1, "last_activity_date": 1577688832, "creation_date": 1577688832, "answer_id": 59526850, "question_id": 59526800, "link": "https://stackoverflow.com/questions/59526800/counting-in-steps-in-go/59526850#59526850", "title": "Counting in steps in go", "body": "<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var waletMoney float64\n    var stepSize float64\n    var tmpMoney float64\n\n    waletMoney = 0.123456789\n    stepSize = 0.00001\n\n    tmpMoney = float64(int(waletMoney /stepSize)) *stepSize \n\n    fmt.Println(tmpMoney)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29795, "user_id": 720030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ed0a5a78d65824827fb112e8e716f8?s=128&d=identicon&r=PG", "display_name": "karmakaze", "link": "https://stackoverflow.com/users/720030/karmakaze"}, "is_accepted": false, "score": 0, "last_activity_date": 1577689415, "creation_date": 1577689415, "answer_id": 59526940, "question_id": 59526800, "link": "https://stackoverflow.com/questions/59526800/counting-in-steps-in-go/59526940#59526940", "title": "Counting in steps in go", "body": "<p>The problem is that a <code>float64</code> uses <a href=\"https://en.wikipedia.org/wiki/IEEE_754\" rel=\"nofollow noreferrer\">IEEE 754</a> representation which can't exactly represent <code>0.0001</code>. Repeatedly adding it is not the same as doing so using decimal (paper &amp; pencil) arithmetic.</p>\n\n<p>One thing you can do to at least avoid multiple rounding errors, is to use a counter and multiply rather than repeated addition which will accumulate rounding errors.</p>\n\n<pre><code>tmpMoney = 0.0\nloop := true\ncount := 0\nfor loop {\n    tmpMoney = stepSize * float64(count)\n    // fmt.Println(tmpMoney)\n    if tmpMoney + stepSize &gt;= waletMoney {\n        loop = false\n    }\n    count += 1\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 12623300, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mCR-ZzZV4xaJa7pUlP881cUjrXBFAIL8X5rArbiJlc=k-s128", "display_name": "michael kaltenecker", "link": "https://stackoverflow.com/users/12623300/michael-kaltenecker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1577689415, "creation_date": 1577688509, "question_id": 59526800, "link": "https://stackoverflow.com/questions/59526800/counting-in-steps-in-go", "title": "Counting in steps in go", "body": "<p>i am trying to solve the following problem but have no nice solution for this.</p>\n\n<p>i have the following float64 0.123456789\nand want to count up in the following step-size: 0.0001</p>\n\n<p>so the result should be 0.123400000</p>\n\n<p>my current solution is really ugly and don't works well:</p>\n\n<pre><code>var waletMoney float64\nvar stepSize float64\nvar tmpMoney float64\n\nwaletMoney = 0.123456789\nstepSize = 0.0001\n\ntmpMoney = 0.0000000\nloop := true\nfor loop {\n    tmpMoney = tmpMoney + stepSize\n    // fmt.Println(tmpMoney)\n    if tmpMoney+stepSize &gt;= waletMoney {\n        loop = false\n    }\n}\nfmt.Println(tmpMoney)\n// result is 0.12340000000000251 but should be 0.123400000 or 0.1234\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/vM-3qZ05QOR\" rel=\"nofollow noreferrer\">https://play.golang.org/p/vM-3qZ05QOR</a> </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3176, "user_id": 3090583, "user_type": "registered", "accept_rate": 23, "profile_image": "https://i.stack.imgur.com/Rw4DX.jpg?s=128&g=1", "display_name": "Raj Sharma", "link": "https://stackoverflow.com/users/3090583/raj-sharma"}, "edited": false, "score": 0, "creation_date": 1577684683, "post_id": 59526183, "comment_id": 105223053, "body": "Hi, it fails for animalsOrder := []string{&quot;bird&quot;, &quot;lion&quot;, &quot;fox&quot;, &quot;zebra&quot;, &quot;cat&quot;}"}, {"owner": {"reputation": 90, "user_id": 8194156, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cyt7b.jpg?s=128&g=1", "display_name": "Juxuny Wu", "link": "https://stackoverflow.com/users/8194156/juxuny-wu"}, "reply_to_user": {"reputation": 3176, "user_id": 3090583, "user_type": "registered", "accept_rate": 23, "profile_image": "https://i.stack.imgur.com/Rw4DX.jpg?s=128&g=1", "display_name": "Raj Sharma", "link": "https://stackoverflow.com/users/3090583/raj-sharma"}, "edited": false, "score": 0, "creation_date": 1577684907, "post_id": 59526183, "comment_id": 105223102, "body": "Oh, sorry, I make a mistake."}, {"owner": {"reputation": 90, "user_id": 8194156, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cyt7b.jpg?s=128&g=1", "display_name": "Juxuny Wu", "link": "https://stackoverflow.com/users/8194156/juxuny-wu"}, "reply_to_user": {"reputation": 3176, "user_id": 3090583, "user_type": "registered", "accept_rate": 23, "profile_image": "https://i.stack.imgur.com/Rw4DX.jpg?s=128&g=1", "display_name": "Raj Sharma", "link": "https://stackoverflow.com/users/3090583/raj-sharma"}, "edited": false, "score": 0, "creation_date": 1577685674, "post_id": 59526183, "comment_id": 105223300, "body": "After updating the <code>sort</code> function, it will work perfectly.@RajSharma"}], "tags": [], "owner": {"reputation": 90, "user_id": 8194156, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cyt7b.jpg?s=128&g=1", "display_name": "Juxuny Wu", "link": "https://stackoverflow.com/users/8194156/juxuny-wu"}, "is_accepted": false, "score": 1, "last_activity_date": 1577685577, "last_edit_date": 1577685577, "creation_date": 1577684410, "answer_id": 59526183, "question_id": 59526127, "link": "https://stackoverflow.com/questions/59526127/sort-order-a-slice-string-by-given-slice/59526183#59526183", "title": "Sort/order a slice string by given slice", "body": "<p>You can try this code: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc sort(in, order []string) (out []string) {\n    flag := make([]bool, len(in))\n    out = make([]string, len(in))\n    orderCountMap := make(map[string]int)\n    for i := range in {\n        orderCountMap[in[i]] += 1\n    }\n    for i := range in {\n        if _, found := orderCountMap[in[i]]; found {\n            flag[i] = true\n        } else {\n            flag[i] = false\n        }\n    }\n    p := 0\n    for i := range order {\n        if v, found := orderCountMap[order[i]]; found {\n            for j := 0; j &lt; v; j++ {\n                out[p] = order[i]\n                p += 1\n            }\n        }\n    }\n    for i := range flag {\n        if !flag[i] {\n            out[p] = in[i]\n            p += 1\n        }\n    }\n    return\n}\n\nfunc main(){\n    animalsInput := []string{\"cat\", \"bird\", \"zebra\", \"fox\"}\n    animalsOrder := []string{\"bird\", \"lion\", \"fox\", \"zebra\", \"cat\"}\n    out := sort(animalsInput, animalsOrder)\n    fmt.Println(out)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 3, "last_activity_date": 1577684767, "creation_date": 1577684767, "answer_id": 59526238, "question_id": 59526127, "link": "https://stackoverflow.com/questions/59526127/sort-order-a-slice-string-by-given-slice/59526238#59526238", "title": "Sort/order a slice string by given slice", "body": "<p>One way you can implement this is by writing a <code>rank</code> map based on the order array</p>\n\n<pre><code>rank:=map[string]int{}\nfor i, x:=range animalsOrder {\n   rank[x]=i\n}\n</code></pre>\n\n<p>Then use <code>rank</code> in <code>sort</code>:</p>\n\n<pre><code>sort.Slice(animalsInput,func(i,j int) bool {\n  irank, ok:=rank[animalsInput[i]]\n  if !ok {\n      irank=len(animalsInput)\n  }\n  jrank, ok:=rank[animalsInput[j]]\n  if !ok {\n      jrank=len(animalsInput)\n  }\n  return irank&lt;jrank\n})\n</code></pre>\n"}], "owner": {"reputation": 3176, "user_id": 3090583, "user_type": "registered", "accept_rate": 23, "profile_image": "https://i.stack.imgur.com/Rw4DX.jpg?s=128&g=1", "display_name": "Raj Sharma", "link": "https://stackoverflow.com/users/3090583/raj-sharma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 59526238, "answer_count": 2, "score": -1, "last_activity_date": 1577700005, "creation_date": 1577683924, "last_edit_date": 1577700005, "question_id": 59526127, "link": "https://stackoverflow.com/questions/59526127/sort-order-a-slice-string-by-given-slice", "title": "Sort/order a slice string by given slice", "body": "<p>How do I sort a slice of string in a order that is given by another slice of strings. If that string is not there in the input slice then just ignore it. </p>\n\n<pre><code>animalsInput := []string{\"cat\", \"bird\", \"zebra\", \"fox\"}\nanimalsOrder := []string{\"bird\", \"lion\", \"fox\"}\n\n//desired output\n//{\"bird\", \"fox\", \"cat\", \"zebra\"}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577680923, "post_id": 59525750, "comment_id": 105222309, "body": "No, there&#39;s not. If you&#39;re hitting the open file descriptor limit, the only way around that is to increase the limit."}, {"owner": {"reputation": 415, "user_id": 10263695, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-IClZzCdXtC8/AAAAAAAAAAI/AAAAAAAAGAs/4BH-9diuSwM/photo.jpg?sz=128", "display_name": "Vani Polnedi", "link": "https://stackoverflow.com/users/10263695/vani-polnedi"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1577681806, "post_id": 59525750, "comment_id": 105222474, "body": "@hobbs can u suggest me the best way to restrict fewer sockets ?"}, {"owner": {"reputation": 9530, "user_id": 1755108, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/IkECk.jpg?s=128&g=1", "display_name": "brokenfoot", "link": "https://stackoverflow.com/users/1755108/brokenfoot"}, "edited": false, "score": 0, "creation_date": 1577682170, "post_id": 59525750, "comment_id": 105222550, "body": "From the error, it sounds like your process, or in the OS in general (linux?)- too many sockets are opened.. You can verify that by looking into <code>ls &#47;proc&#47;$pid&#47;fd</code>.."}], "answers": [{"comments": [{"owner": {"reputation": 415, "user_id": 10263695, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-IClZzCdXtC8/AAAAAAAAAAI/AAAAAAAAGAs/4BH-9diuSwM/photo.jpg?sz=128", "display_name": "Vani Polnedi", "link": "https://stackoverflow.com/users/10263695/vani-polnedi"}, "edited": false, "score": 1, "creation_date": 1577684705, "post_id": 59526112, "comment_id": 105223059, "body": "if status!=200, then i&#39;m getting resp as nil. so i&#39;m unable to close it"}, {"owner": {"reputation": 29795, "user_id": 720030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ed0a5a78d65824827fb112e8e716f8?s=128&d=identicon&r=PG", "display_name": "karmakaze", "link": "https://stackoverflow.com/users/720030/karmakaze"}, "reply_to_user": {"reputation": 415, "user_id": 10263695, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-IClZzCdXtC8/AAAAAAAAAAI/AAAAAAAAGAs/4BH-9diuSwM/photo.jpg?sz=128", "display_name": "Vani Polnedi", "link": "https://stackoverflow.com/users/10263695/vani-polnedi"}, "edited": false, "score": 1, "creation_date": 1577685908, "post_id": 59526112, "comment_id": 105223361, "body": "Try running <code>netstat -na</code> and see if you have long output. In particular, look for <code>TIME_WAIT</code>, if you have many of those it indicates that there are connections that didn&#39;t do a full close handshake. This <a href=\"https://benohead.com/blog/2013/07/21/tcp-about-fin_wait_2-time_wait-and-close_wait/\" rel=\"nofollow noreferrer\">TCP states</a> info page seems to say that many TIME_WAIT means it&#39;s in a passive close transition and that it&#39;s okay until it affects performance. Seems like you want an active close sequence if possible."}], "tags": [], "owner": {"reputation": 29795, "user_id": 720030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ed0a5a78d65824827fb112e8e716f8?s=128&d=identicon&r=PG", "display_name": "karmakaze", "link": "https://stackoverflow.com/users/720030/karmakaze"}, "is_accepted": false, "score": 2, "last_activity_date": 1577683797, "creation_date": 1577683797, "answer_id": 59526112, "question_id": 59525750, "link": "https://stackoverflow.com/questions/59525750/dial-tcp-socket-too-many-open-files/59526112#59526112", "title": "dial tcp : socket: too many open files", "body": "<p>Your problem may be that you're not cleanly closing connections which causes delays to be added before reusing TCP port client port numbers.</p>\n\n<p>In your code example above, the response body is only consumed and closed when the status is 200. You should always consume/close the response body when present.</p>\n"}], "owner": {"reputation": 415, "user_id": 10263695, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-IClZzCdXtC8/AAAAAAAAAAI/AAAAAAAAGAs/4BH-9diuSwM/photo.jpg?sz=128", "display_name": "Vani Polnedi", "link": "https://stackoverflow.com/users/10263695/vani-polnedi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2637, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1577683797, "creation_date": 1577680387, "question_id": 59525750, "link": "https://stackoverflow.com/questions/59525750/dial-tcp-socket-too-many-open-files", "title": "dial tcp : socket: too many open files", "body": "<p>I'm getting dial tcp : socket: too many open files error when i do load test.By setting ulimit its working fine but is there any other solution without setting ulimit?</p>\n\n<p>Code:</p>\n\n<pre><code>package main\nimport (\n \"fmt\"\n \"io\"\n \"io/ioutil\"\n \"encoding/json\"\n \"net/http\"\n )\n\ntype Struct_Response struct {\n    Meta struct {\n        Requestid        string\n    }\n} \n\nvar HttpClient = &amp;http.Client{}\n\nfunc main(){\n    apiUrl := \"http://example.com\"\n    JsonStr :=\"teststr\"\n    conn_token :=\"1233333333333\"\n    req, err := http.NewRequest(\"POST\", apiUrl, bytes.NewBuffer(JsonStr))\n    if err!=nil{ \n        fmt.Println(err)\n    }\n    req.Header.Set(\"Content-Type\", \"application/json\")\n    req.Header.Set(\"requestid\", \"1234\")\n    req.Header.Set(\"Authorization\", \"Bearer \"+conn_token)\n    req.Header.Set(\"Connection\", \"close\")\n\n    resp, err := HttpClient.Do(req)\n    req.Close=true\n    if resp!=nil &amp;&amp; resp.StatusCode==200 {\n        body, _ := ioutil.ReadAll(resp.Body)\n        var Responce Struct_Response\n        err := json.Unmarshal([]byte(string(body)), &amp;Responce)\n        if err != nil {\n            fmt.Println(err)\n        }\n        io.Copy(ioutil.Discard, resp.Body)\n        resp.Body.Close()\n    }\n}\n</code></pre>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["go", "data-race"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1577680967, "post_id": 59525738, "comment_id": 105222321, "body": "Never just &quot;live with&quot; a race condition."}], "answers": [{"tags": [], "owner": {"reputation": 29795, "user_id": 720030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ed0a5a78d65824827fb112e8e716f8?s=128&d=identicon&r=PG", "display_name": "karmakaze", "link": "https://stackoverflow.com/users/720030/karmakaze"}, "is_accepted": true, "score": 1, "last_activity_date": 1577710941, "last_edit_date": 1577710941, "creation_date": 1577680492, "answer_id": 59525763, "question_id": 59525738, "link": "https://stackoverflow.com/questions/59525738/wanted-data-race-or-bad-design/59525763#59525763", "title": "Wanted data-race or bad design?", "body": "<p>Any access to <code>.hits</code> should be behind the mutex, so</p>\n\n<pre><code>// reset hits every second to 0\ngo func() {\n    tick := time.Tick(1 * time.Second)\n    for range tick {\n        m.Lock()\n        subject.hits = 0\n        m.Unlock()\n    }\n}()\n</code></pre>\n\n<p>Also any sleeps should not occur with the mutex locked, so</p>\n\n<pre><code>m.Lock()\n...\n    {\n        m.Unlock()\n        // cool down for one second\n        time.Sleep(1 * time.Second)\n        m.Lock()\n        ...\n    }\n...\nm.Unlock()\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 6144622, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7cb4069348431434d8fa7885bc9a8f4?s=128&d=identicon&r=PG&f=1", "display_name": "LeniM", "link": "https://stackoverflow.com/users/6144622/lenim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "accepted_answer_id": 59525763, "answer_count": 1, "score": -2, "last_activity_date": 1577710941, "creation_date": 1577680221, "last_edit_date": 1577707668, "question_id": 59525738, "link": "https://stackoverflow.com/questions/59525738/wanted-data-race-or-bad-design", "title": "Wanted data-race or bad design?", "body": "<p>I am implementing an app that integrates a third party API that has a limit of hits per second. I wrote my adapter and I was a happy man until I run my tests with the race condition detector.</p>\n\n<p>The design is simple, there is a:</p>\n\n<ul>\n<li>A struct that counts the requests it has made</li>\n<li>A tick that resets this counter to 0 every second</li>\n<li>A private function on this struct which is blocking until conditions are met to allow to do an extra call to the API.</li>\n</ul>\n\n<p>Running this test case works very well until you give it the <code>-race</code> flag.\nI believe the data-race is caused by the tick thread trying to reset the hit counter and the call requests who increments it...</p>\n\n<p>Is my design bad or should I just live with a data-race alert ?</p>\n\n<pre><code>\nimport (\n    \"sync\"\n    \"testing\"\n    \"time\"\n)\n\nvar subject httpClientWrapper\n\nfunc init() {\n    subject = httpClientWrapper{\n        hits:       0,\n        hitsSecond: 1,\n    }\n    // reset hits every second to 0\n    go func() {\n        tick := time.Tick(1 * time.Second)\n        for range tick {\n            subject.hits = 0\n        }\n    }()\n}\n\ntype httpClientWrapper struct {\n    hits, hitsSecond int\n}\n\nvar m sync.Mutex\n\nfunc (c *httpClientWrapper) allowCall() {\n    m.Lock()\n    callAllowanceReached := c.hits &gt;= c.hitsSecond\n    for callAllowanceReached {\n        // cool down for one second\n        time.Sleep(1 * time.Second)\n        callAllowanceReached = c.hits &gt;= c.hitsSecond\n    }\n    c.hits = c.hits + 1\n    m.Unlock()\n}\n\nfunc TestItSleeps(t *testing.T) {\n    timeStart := time.Now()\n    var wg = sync.WaitGroup{}\n    for i := 0; i &lt; 3; i++ {\n        wg.Add(1)\n        go func() {\n            subject.allowCall()\n            wg.Done()\n        }()\n    }\n    wg.Wait()\n    elapsedTime := time.Since(timeStart)\n    if elapsedTime &lt; (1 * time.Second) {\n        t.Errorf(\"this test should not had been able to run in less than a second due to locks and cool down\")\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "mgo"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1577681370, "post_id": 59525630, "comment_id": 105222392, "body": "You can&#39;t do what you want using a query/sort. You can try using post-processing in your code, or aggregation pipeline coupled with some post-processing."}, {"owner": {"reputation": 33, "user_id": 11331001, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/106bw.jpg?s=128&g=1", "display_name": "SachsA", "link": "https://stackoverflow.com/users/11331001/sachsa"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1577681454, "post_id": 59525630, "comment_id": 105222415, "body": "Ah.. Yes, that what I was thinking... Thanks for your answer."}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 11331001, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/106bw.jpg?s=128&g=1", "display_name": "SachsA", "link": "https://stackoverflow.com/users/11331001/sachsa"}, "edited": false, "score": 0, "creation_date": 1577681532, "post_id": 59525834, "comment_id": 105222426, "body": "I will try, i&#39;ll let you know, thanks for the answer. I assume with your response and the comment of Burak that I have to do it in a post process function because I can&#39;t do it directly with mongo."}, {"owner": {"reputation": 33, "user_id": 11331001, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/106bw.jpg?s=128&g=1", "display_name": "SachsA", "link": "https://stackoverflow.com/users/11331001/sachsa"}, "edited": false, "score": 1, "creation_date": 1577684576, "post_id": 59525834, "comment_id": 105223026, "body": "Hello again, It&#39;s working perfeclty, thank you very much. I was thinking i could to it with Mongo direclty but apparently i was wrong. Thanks so much."}], "tags": [], "owner": {"reputation": 96, "user_id": 11670343, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VrFDk.png?s=128&g=1", "display_name": "Roshan Patil", "link": "https://stackoverflow.com/users/11670343/roshan-patil"}, "is_accepted": true, "score": 1, "last_activity_date": 1577681202, "creation_date": 1577681202, "answer_id": 59525834, "question_id": 59525630, "link": "https://stackoverflow.com/questions/59525630/find-all-elements-sorted-by-best-matches/59525834#59525834", "title": "Find all elements sorted by best matches", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/ahmetb/go-linq\"\n)\n\ntype T struct {\n    Name string\n    Tags []string\n}\n\nfunc main() {\n    params := []string{\"food\", \"music\", \"gaming\", \"sport\"}\n    t := []T{\n        T{Name: \"event1\", Tags: []string{\"food\", \"music\", \"gaming\", \"sport\"}},\n        T{Name: \"event2\", Tags: []string{\"gaming\"}},\n        T{Name: \"event3\", Tags: []string{\"music\", \"sport\"}},\n        T{Name: \"event4\", Tags: []string{\"food\", \"music\", \"gaming\", \"sport\"}},\n        T{Name: \"event5\", Tags: []string{\"music\", \"coding\", \"sport\"}},\n        T{Name: \"event6\", Tags: []string{\"coding\"}},\n        T{Name: \"event7\", Tags: []string{\"food\", \"gaming\", \"sport\"}},\n    }\n    var result []T\n    linq.From(t).SortT(func(t1 T, t2 T) bool {\n        var rs1 []string\n        linq.From(t1.Tags).IntersectByT(linq.From(params), func(str string) string {\n            return str\n        }).ToSlice(&amp;rs1)\n        var rs2 []string\n        linq.From(t2.Tags).IntersectByT(linq.From(params), func(str string) string {\n            return str\n        }).ToSlice(&amp;rs2)\n        return len(rs1) &gt; len(rs2)\n    }).ToSlice(&amp;result)\n\n    fmt.Printf(\"%+v\", result)\n}\n</code></pre>\n\n<blockquote>\n  <p>[{Name:event1 Tags:[food music gaming sport]} {Name:event4 Tags:[food music gaming sport]} {Name:event7 Tags:[food gaming sport]} {Name:event3 Tags:[music sport]} {Name:event5 Tags:[music coding sport]} {Name:event2 Tags:[gaming]} {Name:event6 Tags:[coding]}]</p>\n</blockquote>\n\n<p>Above program sorts the array as per your requirements, Hope this will help you.</p>\n"}], "owner": {"reputation": 33, "user_id": 11331001, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/106bw.jpg?s=128&g=1", "display_name": "SachsA", "link": "https://stackoverflow.com/users/11331001/sachsa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 59525834, "answer_count": 1, "score": 0, "last_activity_date": 1577700025, "creation_date": 1577679073, "last_edit_date": 1577700025, "question_id": 59525630, "link": "https://stackoverflow.com/questions/59525630/find-all-elements-sorted-by-best-matches", "title": "Find all elements sorted by best matches", "body": "<p>I have some entities in my database called <strong>\"events\"</strong>. Each of these events contain an array of string, called <strong>\"tags\"</strong>.</p>\n\n<p>I want to make a query to get all the events matching an array of tags that I will give in parameter.</p>\n\n<p>BUT, I want these events to be sorted like:</p>\n\n<ul>\n<li>The first one is the one containing most of the tags I give in parameter.</li>\n<li>The second one is the second one containing most of the tags I give in parameter.</li>\n<li>And so on.</li>\n</ul>\n\n<p>If there are more than one event containing the same amount of tags I want them to be sorted by their <strong>\"name\"</strong> property in <strong>alphabetical order</strong>.</p>\n\n<p><strong>Example:</strong></p>\n\n<ul>\n<li>\"name\" = \"event1\", \"tags\" = [\"food\", \"music\", \"gaming\", \"sport\"]</li>\n<li>\"name\" = \"event2\", \"tags\" = [\"gaming\"]</li>\n<li>\"name\" = \"event3\", \"tags\" = [\"music\", \"sport\"]</li>\n<li>\"name\" = \"event4\", \"tags\" = [\"food\", \"music\", \"gaming\", \"sport\"]</li>\n<li>\"name\" = \"event5\", \"tags\" = [\"music\", \"sport\", \"coding\"]</li>\n<li>\"name\" = \"event6\", \"tags\" = [\"coding\"]</li>\n<li>\"name\" = \"event7\", \"tags\" = [\"food\", \"gaming\", \"sport\"]</li>\n</ul>\n\n<p>The array of tags that I give in parameter for this example is: [\"food\", \"music\", \"gaming\", \"sport\"]</p>\n\n<p>The result for this example will be an array of events, containing in that order:\n<strong>event1, event4, event7, event3, event5, event2</strong></p>\n\n<p>To get all the events containing the tags I simply make a query with the <strong>\"$or\"</strong> operators. This allowed me to get all the events if they contained at least one of the tag given in parameter.</p>\n\n<p><strong>Code:</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    var events []model.Event\n\n    var MyQuery []map[string]interface{}\n    for i := 0; i &lt; len(tags); i++ {\n        currentCondition := bson.M{\"tags\": tags[i]}\n        MyQuery = append(MyQuery, currentCondition)\n    }\n\n    err := dbEvents.C(collectionEvents).Find(bson.M{\"$or\": OrQuery}).All(&amp;events)\n</code></pre>\n\n<p>But i really don't know how to sort them like I showed you.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 29795, "user_id": 720030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ed0a5a78d65824827fb112e8e716f8?s=128&d=identicon&r=PG", "display_name": "karmakaze", "link": "https://stackoverflow.com/users/720030/karmakaze"}, "edited": false, "score": 0, "creation_date": 1577676903, "post_id": 59525360, "comment_id": 105221646, "body": "Go&#39;s <code>sync&#47;atomic</code> package is not well defined and can misbehave in unexpected ways. It&#39;s not documented except for requiring &#39;great care&#39;. Here&#39;s a <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/0uPDCRiBWqc\" rel=\"nofollow noreferrer\">discussion on a mailing list</a> where they&#39;re still trying to decide what it should do so it can be documented.  Long story short, don&#39;t use &#39;sync/atomic&#39;. Measure the performance using rwlock, improve where possible, only then go into less documented/unsafe territory."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1577681164, "post_id": 59525360, "comment_id": 105222351, "body": "Your use of unsafe is wrong, and you&#39;re corrupting the memory. The perceived benefits of using unsafe for performance purposes many times results in unexpected bugs because you&#39;re relying on runtime-specific features and underlying representations, which change from release to release. Also, the way you&#39;re trying to swap maps does not look useful. That will only protect the variables referencing the map, not the map itself. What exactly are you trying to achieve?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1577697137, "post_id": 59525360, "comment_id": 105226511, "body": "&quot;I want a lock-free way ...&quot; There is no &quot;I want&quot; in Go."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1577697256, "post_id": 59525360, "comment_id": 105226546, "body": "&quot;if I use a rwlock, there will have serious performance penalty.&quot; Until you benchmarked it this is at most a hypothesis. (Others might call it a premature optimisation)."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1577697288, "post_id": 59525360, "comment_id": 105226558, "body": "Depending on what you really are trying to do experimenting with sync.Map might be useful."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1577697317, "post_id": 59525360, "comment_id": 105226567, "body": "Note that the language is called &quot;Go&quot; and golang.org is the website."}], "answers": [{"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": false, "score": 2, "last_activity_date": 1577696402, "creation_date": 1577696402, "answer_id": 59528108, "question_id": 59525360, "link": "https://stackoverflow.com/questions/59525360/atomic-swap-map-pointer-cause-program-stuck/59528108#59528108", "title": "Atomic swap map pointer cause program stuck", "body": "<p>The function <code>atomic.SwapPointer</code> does not do what you want / need.  As <a href=\"https://golang.org/pkg/sync/atomic/#SwapPointer\" rel=\"nofollow noreferrer\">the documentation</a> says, this is roughly equivalent to:</p>\n\n<pre><code>old = *addr\n*addr = new\nreturn old\n</code></pre>\n\n<p>(except that the write to <code>*addr</code> and read-back from <code>*addr</code> are done atomically).  What you wanted was, I think, the atomic equivalent of:</p>\n\n<pre><code>*old, *new = *new, *old\n</code></pre>\n\n<p>(and no useful return value).  This operation simply does not exist in the <code>sync</code> package.  If it did, you could swap the two internal map pointers, but you'd still be treading in dangerous (might-break-in-future-compilers) waters, as multiple commenters noted.</p>\n\n<p>Consider using <a href=\"https://golang.org/pkg/sync/#Map\" rel=\"nofollow noreferrer\"><code>sync.Map</code></a> instead.  It provides a somewhat-concurrency-safe map with internal (per entry) locking that is optimized for two use cases, as described in the linked package documentation.  If your use case is one of these two, it may provide what you need.</p>\n\n<hr>\n\n<p>Just for illustration (don't do this! it's silly, you could just write <code>*old, *new = *new, *old</code> in <code>swap</code>)... <a href=\"https://play.golang.org/p/n0C5fbv3VKI\" rel=\"nofollow noreferrer\">A non-atomic swap of old and new <em>can</em> be achieved using <code>atomic.SwapPointer</code></a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync/atomic\"\n    \"unsafe\"\n)\n\nfunc read(p unsafe.Pointer) unsafe.Pointer {\n    return *(*unsafe.Pointer)(p)\n}\n\nfunc swap(old *map[string]string, new *map[string]string) {\n    p := atomic.SwapPointer((*unsafe.Pointer)(unsafe.Pointer(old)), read(unsafe.Pointer(new)))\n    _ = atomic.SwapPointer((*unsafe.Pointer)(unsafe.Pointer(new)), p)\n}\n\nfunc main() {\n    old := map[string]string{\"old\": \"old\"}\n    new := map[string]string{\"hello\": \"apple\", \"new\": \"new\"}\n    fmt.Println(\"before: old =\", old, \"new =\", new)\n    // fmt.Println(\"before: old:\", read(unsafe.Pointer(&amp;old)), \"new:\", read(unsafe.Pointer(&amp;new)))\n    swap(&amp;old, &amp;new)\n    // fmt.Println(\"after: old:\", read(unsafe.Pointer(&amp;old)), \"new:\", read(unsafe.Pointer(&amp;new)))\n    fmt.Println(\"after: old =\", old, \"new =\", new)\n}\n</code></pre>\n\n<p>Uncomment the commented-out lines to see more details.   Of course, calling two separate <code>atomic.SwapPointer</code> operations is not atomic: there is a moment when both map variables view the new map, until the second swap makes the <code>old</code> variable view the old map.  I <em>think</em> the <code>unsafe.Pointer</code> variable <code>p</code> preserves the old map against GC until we get it stored back into <code>old</code>, but I am not at all sure about this (that's one of the darker corners of Go).</p>\n\n<p>Again: don't do this.  If measurement suggests it helps, try <code>sync.Map</code> instead.</p>\n"}], "owner": {"reputation": 158, "user_id": 8451478, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49358a2db456a97db528bc6a459c8049?s=128&d=identicon&r=PG&f=1", "display_name": "ideoutrea", "link": "https://stackoverflow.com/users/8451478/ideoutrea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 460, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1577700058, "creation_date": 1577676211, "last_edit_date": 1577700058, "question_id": 59525360, "link": "https://stackoverflow.com/questions/59525360/atomic-swap-map-pointer-cause-program-stuck", "title": "Atomic swap map pointer cause program stuck", "body": "<pre><code>package main\n\nimport (\n   \"fmt\"\n   \"sync/atomic\"\n   \"unsafe\"\n)\n\n\n\nfunc main(){\n   old := make(map[string]string)\n   new := make(map[string]string)\n   new[\"hello\"] = \"apple\"\n   fmt.Println(\"start swap\")\n   atomic.SwapPointer((*unsafe.Pointer)(unsafe.Pointer(&amp;old)), unsafe.Pointer(&amp;new))\n   fmt.Println(\"end swap\")\n\n   // pending here, don't stop\n   fmt.Println(old)\n   fmt.Println(\"end print old\")\n\n}\n</code></pre>\n\n<p>I want a <strong>lock-free</strong> way to update old map with new map because of the old map will be concurrent read at the most of the time. <br>\nif I use a rwlock, there will have serious <strong>performance</strong> penalty.<br>\nso I choose Golang atomic package to implement this, but the line \n<strong>fmt.Println(old)</strong>, the program is stuck here, could somebody give some advice. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "edited": false, "score": 1, "creation_date": 1577668504, "post_id": 59524634, "comment_id": 105220353, "body": "how do you install go? did you just clone it from the go github repo?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577679487, "post_id": 59524634, "comment_id": 105222072, "body": "Did you upgrade from another version?"}, {"owner": {"reputation": 4426, "user_id": 501333, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/80549e1bfcf0a7f1a2829ab47c19789d?s=128&d=identicon&r=PG", "display_name": "Sean W.", "link": "https://stackoverflow.com/users/501333/sean-w"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1577713032, "post_id": 59524634, "comment_id": 105232988, "body": "@Adrian, yep, apparently the Windows for Go does not completely remove <code>C:\\Go </code> like it should. I had to manually delete the directory after running the uninstaller."}], "answers": [{"comments": [{"owner": {"reputation": 4426, "user_id": 501333, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/80549e1bfcf0a7f1a2829ab47c19789d?s=128&d=identicon&r=PG", "display_name": "Sean W.", "link": "https://stackoverflow.com/users/501333/sean-w"}, "edited": false, "score": 1, "creation_date": 1577713044, "post_id": 59524723, "comment_id": 105232993, "body": "@Adrian, yep, apparently the Windows for Go does not completely remove <code>C:\\Go </code> like it should. I had to manually delete the directory after running the uninstaller. Thanks!"}], "tags": [], "owner": {"reputation": 823, "user_id": 3807226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/968fa2c7813b5007f1099a0d1d23e75f?s=128&d=identicon&r=PG&f=1", "display_name": "Chun Liu", "link": "https://stackoverflow.com/users/3807226/chun-liu"}, "is_accepted": true, "score": 5, "last_activity_date": 1577668559, "creation_date": 1577668559, "answer_id": 59524723, "question_id": 59524634, "link": "https://stackoverflow.com/questions/59524634/why-am-i-getting-redeclared-errors-when-trying-to-build-any-go-program/59524723#59524723", "title": "Why am I getting redeclared errors when trying to build any Go program?", "body": "<p>It seems a common issue of Go v1.13. You can try to do a clean uninstall and reinstall. See <a href=\"https://www.reddit.com/r/golang/comments/d2srx1/newbie_qissues_with_113/\" rel=\"noreferrer\">this post</a>.</p>\n"}], "owner": {"reputation": 4426, "user_id": 501333, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/80549e1bfcf0a7f1a2829ab47c19789d?s=128&d=identicon&r=PG", "display_name": "Sean W.", "link": "https://stackoverflow.com/users/501333/sean-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1337, "favorite_count": 0, "accepted_answer_id": 59524723, "answer_count": 1, "score": 0, "last_activity_date": 1577672119, "creation_date": 1577667528, "question_id": 59524634, "link": "https://stackoverflow.com/questions/59524634/why-am-i-getting-redeclared-errors-when-trying-to-build-any-go-program", "title": "Why am I getting redeclared errors when trying to build any Go program?", "body": "<p>I want to learn Go. I installed Go 1.13.5 on 64-bit Windows 10. I started out trying to build the following hello world program:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package hello\n\nimport (\"fmt\")\n\nfunc main() {\n    fmt.Printf(\"Hello world!\")\n\n}\n</code></pre>\n\n<p>However, when I try to build it or any other Go program, I get errors</p>\n\n<pre><code>c:\\go\\src\\runtime\\stubs_x86.go:10:6: stackcheck redeclared in this block\n        previous declaration at c:\\go\\src\\runtime\\stubs_amd64x.go:10:6\nc:\\go\\src\\runtime\\unaligned1.go:11:6: readUnaligned32 redeclared in this block\n        previous declaration at c:\\go\\src\\runtime\\alg.go:321:40\nc:\\go\\src\\runtime\\unaligned1.go:15:6: readUnaligned64 redeclared in this block\n        previous declaration at c:\\go\\src\\runtime\\alg.go:329:40\n</code></pre>\n\n<p>Does anyone know what is going wrong?</p>\n"}, {"tags": ["git", "go", "ssh", "gitea"], "answers": [{"comments": [{"owner": {"reputation": 23176, "user_id": 18149, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f5e10278b9b6a518d5835f658704d85f?s=128&d=identicon&r=PG", "display_name": "leeand00", "link": "https://stackoverflow.com/users/18149/leeand00"}, "edited": false, "score": 0, "creation_date": 1577665354, "post_id": 59524471, "comment_id": 105219879, "body": "It looks like it&#39;s trying to use IPv6....binding to any and all addresses <code>::</code>"}, {"owner": {"reputation": 23176, "user_id": 18149, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f5e10278b9b6a518d5835f658704d85f?s=128&d=identicon&r=PG", "display_name": "leeand00", "link": "https://stackoverflow.com/users/18149/leeand00"}, "edited": false, "score": 2, "creation_date": 1577665685, "post_id": 59524471, "comment_id": 105219944, "body": "Had to use the <code>HTTP_ADDR</code> configuration directive it seems..."}], "tags": [], "owner": {"reputation": 400, "user_id": 10615396, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-jjHyNsQ6-ho/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbDMDV6tnCvg5Mogtv70kysWJmv6UA/mo/photo.jpg?sz=128", "display_name": "Michael Jarrett", "link": "https://stackoverflow.com/users/10615396/michael-jarrett"}, "is_accepted": true, "score": 2, "last_activity_date": 1577665172, "creation_date": 1577665172, "answer_id": 59524471, "question_id": 59524372, "link": "https://stackoverflow.com/questions/59524372/binding-gitea-to-the-localhost-address-for-tunneling/59524471#59524471", "title": "Binding gitea to the localhost address for tunneling?", "body": "<p>To double-check that Gitea is <em>actually</em> listening only on the loopback interface, check the output of</p>\n\n<pre><code>netstat -tulpn | grep 3000\n</code></pre>\n\n<p>which should appear as <code>127.0.0.1:3000</code> (in the 3rd column). Any other binding would indicate that your changes to the config haven't affected the service, and that it's still binding to other interfaces.</p>\n"}, {"tags": [], "owner": {"reputation": 2360, "user_id": 790981, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d61e824b2c253ba713e7284b79b812d3?s=128&d=identicon&r=PG", "display_name": "radiospiel", "link": "https://stackoverflow.com/users/790981/radiospiel"}, "is_accepted": false, "score": 1, "last_activity_date": 1592906133, "creation_date": 1592906133, "answer_id": 62532032, "question_id": 59524372, "link": "https://stackoverflow.com/questions/59524372/binding-gitea-to-the-localhost-address-for-tunneling/62532032#62532032", "title": "Binding gitea to the localhost address for tunneling?", "body": "<p>Just repeating what @leeand00 says: gitea's config lists <code>HTTP_ADDR</code> as the relevant setting. <a href=\"https://docs.gitea.io/en-us/config-cheat-sheet/\" rel=\"nofollow noreferrer\">https://docs.gitea.io/en-us/config-cheat-sheet/</a></p>\n<p>Afterwards, <code>netstat -tulpn | grep 3000</code> is certainly a good check to see if everything is right :)</p>\n"}], "owner": {"reputation": 23176, "user_id": 18149, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f5e10278b9b6a518d5835f658704d85f?s=128&d=identicon&r=PG", "display_name": "leeand00", "link": "https://stackoverflow.com/users/18149/leeand00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 362, "favorite_count": 0, "accepted_answer_id": 59524471, "answer_count": 2, "score": 1, "last_activity_date": 1592906133, "creation_date": 1577663973, "question_id": 59524372, "link": "https://stackoverflow.com/questions/59524372/binding-gitea-to-the-localhost-address-for-tunneling", "title": "Binding gitea to the localhost address for tunneling?", "body": "<p>I've found some configuration which appears to indicate the port the gitea binds to, see below:</p>\n\n<p><a href=\"https://i.stack.imgur.com/icu9D.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/icu9D.png\" alt=\"hos\"></a></p>\n\n<p>I changed the actual address of the machine to <code>127.0.0.1</code> (the loopback) thinking that I would be able to make <a href=\"https://security.stackexchange.com/questions/106333/is-binding-all-private-services-to-the-127-0-0-1-address-and-then-accessing-them\">gitea accessible only by tunneling into the device with SSH</a>, but when I restart the service I can still access it via the device's ip on port 3000. </p>\n\n<p>Shouldn't changing the <code>ROOT_URL</code> and <code>HTTP_PORT</code> cause it to be bound to the loopback address, requiring me to do port forwarding through my SSH client to reach port <code>http://127.0.0.1:3000</code>?</p>\n\n<p>P.S. If you feel this question does not belong on Stack Exchange, go ahead and send it over to another site that is more well suited to it; but I would think that gitea isn't used too much by people other than programmers, which is why I posted it here.</p>\n"}, {"tags": ["go", "garbage-collection", "pprof"], "comments": [{"owner": {"reputation": 628808, "user_id": 139985, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/147c5a9cc1feec049c50da791ac7d144?s=128&d=identicon&r=PG", "display_name": "Stephen C", "link": "https://stackoverflow.com/users/139985/stephen-c"}, "edited": false, "score": 0, "creation_date": 1577660595, "post_id": 59524032, "comment_id": 105219104, "body": "Possibly you have configured a heap size limit, and the heap is too close to full.  Possibly your VM doesn&#39;t have enough physical memory and it is being pushed into thrashing."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1577661524, "post_id": 59524032, "comment_id": 105219275, "body": "<code>fib(34)</code> takes 50 ms in my computer (recursive version, written in Go). What you do in your VM we can&#39;t see and cannot reason about."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1577664655, "last_edit_date": 1577664655, "creation_date": 1577660704, "answer_id": 59524072, "question_id": 59524032, "link": "https://stackoverflow.com/questions/59524032/go-gc-responsible-for-90-of-cpu-time/59524072#59524072", "title": "Go GC responsible for 90% of CPU time", "body": "<p>It's your recursive algorithm which generates a combinatorial explosion. Use an iterative algorithm.</p>\n\n<hr>\n\n<p>Try this iterative algorithm:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n// fibonacci returns the Fibonacci number for 0 &lt;= n &lt;= 92.\n// OEIS: A000045: Fibonacci numbers:\n// F(n) = F(n-1) + F(n-2) with F(0) = 0 and F(1) = 1.\nfunc fibonacci(n int) int64 {\n    if n &lt; 0 {\n        panic(\"fibonacci: n &lt; 0\")\n    }\n    f := int64(0)\n    a, b := int64(0), int64(1)\n    for i := 0; i &lt;= n; i++ {\n        if a &lt; 0 {\n            panic(\"fibonacci: overflow\")\n        }\n        f, a, b = a, b, a+b\n    }\n    return f\n}\n\nfunc main() {\n    for _, n := range []int{0, 1, 2, 3, 90, 91, 92} {\n        fmt.Printf(\"%-2d  %d\\n\", n, fibonacci(n))\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/_5CMHZm3Hlo\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_5CMHZm3Hlo</a></p>\n\n<p>Output:</p>\n\n<pre><code>0   0\n1   1\n2   1\n3   2\n90  2880067194370816120\n91  4660046610375530309\n92  7540113804746346429\n\nreal    0m0.003s\nuser    0m0.002s\nsys     0m0.000s\n</code></pre>\n\n<hr>\n\n<p>Reference :</p>\n\n<p><a href=\"https://www.cs.toronto.edu/~gfb/csc104/2016W/Lectures/CSC104.2016W.Week-7.Lecture.Fibonacci.I.pdf\" rel=\"nofollow noreferrer\">The Fibonacci Sequence and Combinatorial Explosion</a></p>\n"}, {"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": false, "score": 2, "last_activity_date": 1577663682, "last_edit_date": 1577663682, "creation_date": 1577662624, "answer_id": 59524252, "question_id": 59524032, "link": "https://stackoverflow.com/questions/59524032/go-gc-responsible-for-90-of-cpu-time/59524252#59524252", "title": "Go GC responsible for 90% of CPU time", "body": "<p>As <a href=\"https://stackoverflow.com/questions/59524032/go-gc-responsible-for-90-of-cpu-time#comment105219275_59524032\">icza noted in a comment</a>, actually compiling and running this as <em>Go</em> code, it runs quite fast:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc fib(n int) int {\n    if n &lt; 2 {\n        return n\n    } else {\n        return fib(n-1) + fib(n-2)\n    }\n}\n\nfunc main() {\n    s := time.Now()\n    fmt.Println(fib(34))\n    d := time.Now().Sub(s)\n    fmt.Println(\"took\", d)\n}\n\n$ go run fib.go\n5702887\ntook 49.244697ms\n</code></pre>\n\n<p>(note: the above is sloppy: we should use <code>int64</code>, I was just lazy).</p>\n\n<p>The Python3 variant:</p>\n\n<pre><code>import time\ndef fib(n):\n    if n &lt; 2:\n        return n\n    return fib(n-1) + fib(n-2)\n\ns = time.time()\nprint(fib(34))\nprint(f\"took {time.time() - s}s\")\n</code></pre>\n\n<p>takes a bit longer:</p>\n\n<pre><code>$ python3 fib.py\n5702887\ntook 2.1027958393096924s\n</code></pre>\n\n<p>As <a href=\"https://stackoverflow.com/a/59524072/1256452\">peterSO notes</a>, the recursive algorithm makes a <em>lot</em> of calls:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nvar calls int\n\nfunc fib(n int) int {\n    calls += 1\n    if n &lt; 2 {\n        return n\n    } else {\n        return fib(n-1) + fib(n-2)\n    }\n}\n\nfunc main() {\n    s := time.Now()\n    fmt.Println(fib(34))\n    d := time.Now().Sub(s)\n    fmt.Println(\"took\", d, \"to make\", calls, \"calls\")\n}\n\n$ go run fib.go\n5702887\ntook 53.328049ms to make 18454929 calls\n</code></pre>\n\n<p>(the extra few milliseconds are due to counting the calls).  So Go ran 18.45 million calls in about 50 ms, and Python ran the same 18.45 million calls in about 2.1 s.  Go took about 2.7 ns per call, and Python took about 114 ms per call.</p>\n"}], "owner": {"reputation": 53, "user_id": 10647583, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad9763120996efab32e1de3f36006228?s=128&d=identicon&r=PG&f=1", "display_name": "Francis", "link": "https://stackoverflow.com/users/10647583/francis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1577664655, "creation_date": 1577660198, "question_id": 59524032, "link": "https://stackoverflow.com/questions/59524032/go-gc-responsible-for-90-of-cpu-time", "title": "Go GC responsible for 90% of CPU time", "body": "<p>I'm writing a virtual machine for a simple, made-up programming language in Go. I'm using the profiler pprof to improve performance. I'm running the Fibonacci function in my made up language to test recursive functions.</p>\n\n<pre><code>func fib(n) {\n    if n &lt; 2 {\n        return n\n    } else {\n        return fib(n-1) + fib(n-2)\n    }\n}\nprint fib(34)\n</code></pre>\n\n<p>When I run this it takes 14 seconds, in Python it takes 2 seconds. Here's an image from PProf. I've highlighted my actual program's function calls in green. They take 2 seconds, the other 12 seconds appears to be all Go's garbage collector.\n<a href=\"https://i.stack.imgur.com/EmA3m.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/EmA3m.png\" alt=\"enter image description here\"></a>\nIs there any way to figure out why the garbage collector is taking so much of the time?</p>\n"}, {"tags": ["go", "channel"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1577654000, "last_edit_date": 1577654000, "creation_date": 1577652861, "answer_id": 59523188, "question_id": 59522876, "link": "https://stackoverflow.com/questions/59522876/missing-printings-from-goroutine-after-closing-done-channel/59523188#59523188", "title": "Missing printings from goroutine after closing done channel", "body": "<p>There are code paths that will not print some of the <code>done</code> messages. The scheduler happened to choose one that does not print the one for <code>multiply</code>. If you change the code a bit (for instance, log at different instances than you're doing now), you'll see that it may miss the <code>add</code> <code>done</code> message as well. (<a href=\"https://play.golang.org/p/meEPM5GR9Rr\" rel=\"nofollow noreferrer\">https://play.golang.org/p/meEPM5GR9Rr</a>). Here's the reason:</p>\n\n<p>If the <code>done</code> message arrives right after generator writes the number to the channel and the multiplier reads it, then the multipler sees that <code>done</code> is available and picks that. This is the case when <code>multiplier</code> prints the <code>done</code> message. If the <code>done</code> message arrives while multiplier is waiting in the for-loop, then multiplier will receive the closing on the input channel (not the <code>done</code> channel), causing the for loop to terminate without printing the <code>done</code> message.</p>\n\n<p>The problem arises because you're reading from a channel in a for-loop, and then selecting. While waiting for the for-loop to read from the channel, none of the events related to the select is evaluated.</p>\n\n<p>A better way of dealing with this is not using a for-loop to read from the channel. For instance:</p>\n\n<pre><code>for {\n     select {\n        case &lt;-done:\n           return\n        case i, ok:= &lt;-intstream:\n           if !ok {\n              return\n           }\n           select {\n               case &lt;- done:\n                    return\n               case addedStream &lt;- i + additive:\n           }\n     }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": false, "score": 1, "last_activity_date": 1577653236, "creation_date": 1577653236, "answer_id": 59523248, "question_id": 59522876, "link": "https://stackoverflow.com/questions/59522876/missing-printings-from-goroutine-after-closing-done-channel/59523248#59523248", "title": "Missing printings from goroutine after closing done channel", "body": "<p>Your <code>add</code> and <code>multiply</code> routines are not forever loops, but rather <code>for ... range</code> loops.  As such, at the top of each loop, they wait for the next integer, rather than waiting in the <code>select</code> that either receives the close from <code>done</code> or sends a result to their stream.  This is not a <em>problem</em>, but it means that if their input stream is <em>closed</em>, they will return without entering the loop itself.</p>\n\n<p>If I <a href=\"https://play.golang.org/p/QyMHbXCRdKU\" rel=\"nofollow noreferrer\">add <code>fmt.Println</code> calls to expose the point at which they exit due to reaching the end of their input stream</a>, the behavior changes slightly (probably due to timing; I haven't bothered to reason much about it and <a href=\"https://stackoverflow.com/a/59523188/1256452\">Burak Serdar posted his answer</a> already while I was typing this) and the output becomes:</p>\n\n<pre><code>add after select\n2\nmultiply after select\ngenerator after select\nmultiply after select\nadd after select\n4\ngenerator after select\nmultiply after select\nadd after select\n6\ngenerator after select\nClosed done\ndone multiply !\nadd got end of stream - done!\nfinished iterating pipeline\ngenerator after select\ndone generator!\nramaining goroutines: 1\nfinished!\n</code></pre>\n\n<p>It's often more reasonable to make <em>only</em> the generator itself take a <code>done</code> signal, and make the pipelined functions always write all their results, which makes them more predictable.  Of course then whoever is reading each pipe must read to the end\u2014but you do that already in the main goroutine, so we just propagate this throughout.  <a href=\"https://play.golang.org/p/MbYnvjF9hPx\" rel=\"nofollow noreferrer\">Here</a> is a simplified version of your code that does it this way; it outputs:</p>\n\n<pre><code>2\ngenerator after select\n4\ngenerator after select\n6\ngenerator after select\nClosed done\n8\ngenerator after select\ndone generator!\nmultiply got end of stream - done!\nadd got end of stream - done!\nfinished iterating pipeline\nremaining goroutines: 1\n</code></pre>\n\n<p>Note that this time, we get the final computed value (8) from the final generated value (3).</p>\n"}], "owner": {"reputation": 5719, "user_id": 927477, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/0371d87e695b51de2f76e828e6a5915f?s=128&d=identicon&r=PG", "display_name": "Avner Levy", "link": "https://stackoverflow.com/users/927477/avner-levy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 59523188, "answer_count": 2, "score": 0, "last_activity_date": 1577654000, "creation_date": 1577650077, "last_edit_date": 1577650542, "question_id": 59522876, "link": "https://stackoverflow.com/questions/59522876/missing-printings-from-goroutine-after-closing-done-channel", "title": "Missing printings from goroutine after closing done channel", "body": "<p>I was running the following code based on an example from the book \"Concurrency in Go\" when I've noticed that not all closing printings in the pipeline are printed.<br>\nSee that \"done multiply!\" is missing.<br>\nOn the other hand, the NumGoroutine() shows only main func is running.<br>\nWhat is wrong with the following code? (<a href=\"https://play.golang.org/p/tkFgvKboVgS\" rel=\"nofollow noreferrer\">https://play.golang.org/p/tkFgvKboVgS</a>)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"time\"\n)\n\nfunc main() {\n    generator := func(done &lt;-chan struct{}) &lt;-chan int {\n        intStream := make(chan int)\n        i:=0\n        go func() {\n            defer close(intStream)\n            for {\n                select {\n                case &lt;-done:\n                    fmt.Println(\"done generator!\")\n                    return\n                case intStream &lt;- i:\n                    time.Sleep(1 * time.Second)\n                    i++\n                }\n                fmt.Println(\"generator after select\")\n            }\n        }()\n        return intStream\n    }\n\n    multiply := func(\n        done &lt;-chan struct{},\n        intStream &lt;-chan int,\n        multiplier int,\n    ) &lt;-chan int {\n        multipliedStream := make(chan int)\n        go func() {\n            defer close(multipliedStream)\n            for i := range intStream {\n                select {\n                case &lt;-done:\n                    fmt.Println(\"done multiply !\")\n                    return\n                case multipliedStream &lt;- i * multiplier:\n                }\n                fmt.Println(\"multiply after select\")\n            }\n        }()\n        return multipliedStream\n    }\n    add := func(\n        done &lt;-chan struct{},\n        intStream &lt;-chan int,\n        additive int,\n    ) &lt;-chan int {\n        addedStream := make(chan int)\n        go func() {\n            defer close(addedStream)\n            for i := range intStream {\n                select {\n                case &lt;-done:\n                    fmt.Println(\"done add !\")\n                    return\n                case addedStream &lt;- i + additive:\n                }\n                fmt.Println(\"add after select\")\n            }\n        }()\n        return addedStream\n    }\n\n    done := make(chan struct{})\n\n    intStream := generator(done)\n    pipeline := add(done, multiply(done, intStream, 2), 2)\n    go func() {\n        time.Sleep(3 * time.Second)\n        close(done)\n        fmt.Println(\"Closed done\")\n    }()\n    for v := range pipeline {\n        fmt.Println(v)\n    }\n    fmt.Println(\"finished iterating pipeline\")\n    time.Sleep(10 * time.Second)\n    fmt.Println(\"ramaining goroutines:\", runtime.NumGoroutine())\n    fmt.Println(\"finished!\")\n}\n</code></pre>\n\n<p>Output:  </p>\n\n<pre><code>add after select\n2\nmultiply after select\ngenerator after select\nmultiply after select\nadd after select\n4\ngenerator after select\nmultiply after select\nadd after select\n6\ngenerator after select\nClosed done\nmultiply after select\ndone add !\nfinished iterating pipeline\ngenerator after select\ndone generator!\nramaining goroutines: 1\nfinished!\n</code></pre>\n"}, {"tags": ["user-interface", "go"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1577644278, "post_id": 59521225, "comment_id": 105215238, "body": "Your question is <a href=\"https://stackoverflow.com/help/on-topic\">strictly off-topic on SO</a>. Please try <a href=\"https://github.com/golang/go/wiki#the-go-community\" rel=\"nofollow noreferrer\">other venues</a> to ask such question on Go, thanks."}], "answers": [{"tags": [], "owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "is_accepted": true, "score": 0, "last_activity_date": 1577638586, "creation_date": 1577638586, "answer_id": 59521426, "question_id": 59521225, "link": "https://stackoverflow.com/questions/59521225/is-there-gui-framework-for-mobile-and-desktop-applications/59521426#59521426", "title": "is there GUI framework for mobile and desktop applications?", "body": "<p>There is also the <a href=\"https://fyne.io\" rel=\"nofollow noreferrer\">Fyne</a> toolkit that aims to be easy to learn for anyone. It supports desktop and mobile and it's apps follow use material design using light and dark themes. There are tutorials available on <a href=\"https://www.youtube.com/watch?v=-v1vz_NcWng&amp;list=PLjpijTpXl1_po-ld8jORR9k5NornDNKQk\" rel=\"nofollow noreferrer\">YouTube</a> and there is a <a href=\"https://tour.fyne.io\" rel=\"nofollow noreferrer\">tour</a> if you prefer reading.</p>\n"}], "owner": {"reputation": 3, "user_id": 12553843, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b974c9bb7f75f108e7e9cf35c31f32d?s=128&d=identicon&r=PG&f=1", "display_name": "Hussam F.", "link": "https://stackoverflow.com/users/12553843/hussam-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "closed_date": 1577645424, "accepted_answer_id": 59521426, "answer_count": 1, "score": -1, "last_activity_date": 1577644195, "creation_date": 1577637108, "last_edit_date": 1577644195, "question_id": 59521225, "link": "https://stackoverflow.com/questions/59521225/is-there-gui-framework-for-mobile-and-desktop-applications", "closed_reason": "Not suitable for this site", "title": "is there GUI framework for mobile and desktop applications?", "body": "<p>HI I'm big lover of golang but I'm beginner and I want to knew if it possible to build interface application with go for mobile or desktop \nI see video on YouTube that's talk about framework called GIO    <a href=\"https://gioui.org/\" rel=\"nofollow noreferrer\">https://gioui.org/</a>     <a href=\"https://www.youtube.com/watch?v=PxnL3-Sex3o\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=PxnL3-Sex3o</a>\n but it's has small community and I've got many errors so is there any one familiar with GIO tell how to start if it's possible    </p>\n"}, {"tags": ["go", "cryptography"], "comments": [{"owner": {"reputation": 502, "user_id": 4896540, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87995a686ab93aa90a57360c43ea00b6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4896540/alex"}, "edited": false, "score": 0, "creation_date": 1577638577, "post_id": 59521105, "comment_id": 105213746, "body": "Are you sure body is intact after copy? Perhaps some trailing <code>\\n</code> added and it screws it all. Also, use <code>hmac.Equal</code> and <code>hash.Write()</code> never returns errors."}, {"owner": {"reputation": 2122, "user_id": 7215553, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vRRBO.png?s=128&g=1", "display_name": "Hurobaki", "link": "https://stackoverflow.com/users/7215553/hurobaki"}, "reply_to_user": {"reputation": 502, "user_id": 4896540, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87995a686ab93aa90a57360c43ea00b6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4896540/alex"}, "edited": false, "score": 0, "creation_date": 1577639836, "post_id": 59521105, "comment_id": 105214112, "body": "I try to serve my local server with Ngrok and you are right, my copy/paste should had hidden characters ... Now my two hashes are equal. Feel free to post your answer so I can accept it :)"}], "answers": [{"comments": [{"owner": {"reputation": 1104, "user_id": 3061903, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/64f8fa66e84b9b938e659bc1849fef57?s=128&d=identicon&r=PG&f=1", "display_name": "Vishal Maral", "link": "https://stackoverflow.com/users/3061903/vishal-maral"}, "edited": false, "score": 0, "creation_date": 1609402840, "post_id": 59521610, "comment_id": 115833897, "body": "In my case copy-paste added additional new line characters. I removed all formatting chars and passed pure json."}], "tags": [], "owner": {"reputation": 502, "user_id": 4896540, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87995a686ab93aa90a57360c43ea00b6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4896540/alex"}, "is_accepted": true, "score": 3, "last_activity_date": 1577639919, "last_edit_date": 1592644375, "creation_date": 1577639919, "answer_id": 59521610, "question_id": 59521105, "link": "https://stackoverflow.com/questions/59521105/github-secret-token-verification/59521610#59521610", "title": "Github secret token verification", "body": "<blockquote>\n<p>I copy the payload of the Github webhook in Postman with the right header.</p>\n<p>I've checked my key is non-empty with the correct value and my body is non-empty too.</p>\n</blockquote>\n<p>The crypto is correct, except few minor issues. Obviously your body does not match the same body you have got from Github. Could be formatting, trailing newlines, etc. It must exactly byte-to-byte match the original body.</p>\n<p>If this code works with Github and does not work with copy in Postman just replace <code>X-Hub-Signature</code> in your fixture with that &quot;wrong&quot; hash.</p>\n<p>Some extras:</p>\n<ul>\n<li>Use <code>hmac.Equal</code> for secure comparison</li>\n<li><code>hash.Write</code> never returns errors</li>\n</ul>\n"}], "owner": {"reputation": 2122, "user_id": 7215553, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vRRBO.png?s=128&g=1", "display_name": "Hurobaki", "link": "https://stackoverflow.com/users/7215553/hurobaki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "accepted_answer_id": 59521610, "answer_count": 1, "score": 0, "last_activity_date": 1577651249, "creation_date": 1577636256, "last_edit_date": 1577651249, "question_id": 59521105, "link": "https://stackoverflow.com/questions/59521105/github-secret-token-verification", "title": "Github secret token verification", "body": "<p>I'm making a little API using Go. I would like to be able to handle Github webhooks with secret token. I set up the secret on my webhook Github which is \"azerty\". </p>\n\n<p>Now I try to verify that the incoming webhook has the correct secret token. I've read Github documentation which say the algorithm use HMAC with SHA1. But I can't verify the secret from the incoming Github webhook ... </p>\n\n<pre><code>func IsValidSignature(r *http.Request, key string) bool {\n    // KEY =&gt; azerty\n\n    gotHash := strings.SplitN(r.Header.Get(\"X-Hub-Signature\"), \"=\", 2)\n    if gotHash[0] != \"sha1\" {\n        return false\n    }\n    defer r.Body.Close()\n\n    b, err := ioutil.ReadAll(r.Body)\n    if err != nil {\n        log.Printf(\"Cannot read the request body: %s\\n\", err)\n        return false\n    }\n\n    hash := hmac.New(sha1.New, []byte(key))\n    if _, err := hash.Write(b); err != nil {\n        log.Printf(\"Cannot compute the HMAC for request: %s\\n\", err)\n        return false\n    }\n\n    expectedHash := hex.EncodeToString(hash.Sum(nil))\n    log.Println(\"EXPECTED HASH:\", expectedHash)\n    log.Println(\"GOT HASH:\", gotHash[1])\n    return gotHash[1] == expectedHash\n}\nEXPECTED HASH: 10972179a3b0efc337f79ec41847062bc598bb04\nGOT HASH: 36de72e0d386e36e2c7b034c85cd3b3889594992\n</code></pre>\n\n<p>To test, I copy the payload of the Github webhook in Postman with the right headers. I don't know why I get two different hash ... I've checked my key is non-empty with the correct value and my body is non-empty too.</p>\n\n<p>Do I miss something?</p>\n"}, {"tags": ["json", "api", "go", "post"], "comments": [{"owner": {"reputation": 2815, "user_id": 123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eeb220ccf249757b0960465f2b10631?s=128&d=identicon&r=PG", "display_name": "icio", "link": "https://stackoverflow.com/users/123600/icio"}, "edited": false, "score": 3, "creation_date": 1577636045, "post_id": 59520691, "comment_id": 105213082, "body": "See <a href=\"https://stackoverflow.com/questions/31048557/assigning-null-to-json-fields-instead-of-empty-strings\" title=\"assigning null to json fields instead of empty strings\">stackoverflow.com/questions/31048557/&hellip;</a>"}, {"owner": {"reputation": 2815, "user_id": 123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eeb220ccf249757b0960465f2b10631?s=128&d=identicon&r=PG", "display_name": "icio", "link": "https://stackoverflow.com/users/123600/icio"}, "edited": false, "score": 1, "creation_date": 1577636082, "post_id": 59520691, "comment_id": 105213092, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/31048557/assigning-null-to-json-fields-instead-of-empty-strings\">Assigning null to JSON fields instead of empty strings</a>"}], "answers": [{"comments": [{"owner": {"reputation": 269, "user_id": 9719777, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/--nmJMIUdc9Y/AAAAAAAAAAI/AAAAAAAAAHk/yZlUWRBeA7M/photo.jpg?sz=128", "display_name": "Mahmood Bkh", "link": "https://stackoverflow.com/users/9719777/mahmood-bkh"}, "edited": false, "score": 0, "creation_date": 1577658645, "post_id": 59521291, "comment_id": 105218706, "body": "when i use pointer and send a json with no name field i recive a panic saying :runtime error: invalid memory address or nil pointer dereference"}], "tags": [], "owner": {"reputation": 4746, "user_id": 1644215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e2195ef04472c73ccd53d77bec0c7e6?s=128&d=identicon&r=PG", "display_name": "KevBurnsJr", "link": "https://stackoverflow.com/users/1644215/kevburnsjr"}, "is_accepted": false, "score": 1, "last_activity_date": 1577637560, "creation_date": 1577637560, "answer_id": 59521291, "question_id": 59520691, "link": "https://stackoverflow.com/questions/59520691/how-to-check-if-there-is-null-value-in-json-body-in-post-request/59521291#59521291", "title": "How to check if there is null value in json.body in post request", "body": "<p>You can use a pointer</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Animal struct {\n    Name *string\n    Age  int\n    Zone int\n}\n</code></pre>\n\n<p>or a package</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import \"github.com/guregu/null\"\n\ntype Animal struct {\n    Name null.String\n    Age  int\n    Zone int\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 2533287, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/842004e8cbbd8b3f1499ce2894e656fe?s=128&d=identicon&r=PG", "display_name": "diafour", "link": "https://stackoverflow.com/users/2533287/diafour"}, "is_accepted": false, "score": 1, "last_activity_date": 1577637650, "creation_date": 1577637650, "answer_id": 59521306, "question_id": 59520691, "link": "https://stackoverflow.com/questions/59520691/how-to-check-if-there-is-null-value-in-json-body-in-post-request/59521306#59521306", "title": "How to check if there is null value in json.body in post request", "body": "<p><code>string</code> can't be nil. If you want to distinguish between absent field, <code>null</code> value and empty value <code>\"\"</code>, you've got these options:</p>\n\n<ol>\n<li>As a quick solution you can use a pointer:</li>\n</ol>\n\n<pre><code>type Animal struct {\nName *string\n}\n</code></pre>\n\n<p>The drawback is that you need to use a temporal variable to set this field.</p>\n\n<ol start=\"2\">\n<li>A more flexible solution is to implement <code>Unmarshaler</code> interface for Animal struct and use temporal <code>map[string]string</code> to make desired checks and return an error:</li>\n</ol>\n\n<pre><code>type Animal struct {\nName string\n}\n\nfunc (a *Animal) UnmarshalJSON(data []byte) error {\n  m := map[string]interface{}{}\n  err := json.Unmarshal(data, &amp;m)\n  if err != nil {\n    return err\n  }\n  // check if field is exist\n  name, exist := m[\"name\"]\n  if !exist {\n    return fmt.Errorf(\"field 'name' should be present\")\n  }\n  // check other fields...\n  // ...\n\n  // if all fields are ok, you can:\n  // 1. set fields from map items\n  a.Name = name\n  ...\n\n  // 2. call Unmarshal\n  return json.Unmarshal(data, a)\n}\n</code></pre>\n\n<p>The drawback here is that you need to check each field \"by hands\".</p>\n\n<ol start=\"3\">\n<li>The next step is to use heavy machinery: <code>go-swagger</code> or <code>go-openapi</code>. These instruments give you the ability to use declarative schema (OpenAPI) to perform checks over JSON data, you can easily implement versioning, publish your APIs, and more.\nOf course, it is overengineering for a 3 field struct.</li>\n</ol>\n"}], "owner": {"reputation": 269, "user_id": 9719777, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/--nmJMIUdc9Y/AAAAAAAAAAI/AAAAAAAAAHk/yZlUWRBeA7M/photo.jpg?sz=128", "display_name": "Mahmood Bkh", "link": "https://stackoverflow.com/users/9719777/mahmood-bkh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 474, "favorite_count": 0, "closed_date": 1577654959, "answer_count": 2, "score": 0, "last_activity_date": 1577654913, "creation_date": 1577633065, "last_edit_date": 1577654913, "question_id": 59520691, "link": "https://stackoverflow.com/questions/59520691/how-to-check-if-there-is-null-value-in-json-body-in-post-request", "closed_reason": "Duplicate", "title": "How to check if there is null value in json.body in post request", "body": "<p>I have a struct containing 4 fields:</p>\n\n<pre><code>type Animal struct {\n    Name string\n    Age  int\n    Zone int\n}\n</code></pre>\n\n<p>I am doing a post request sending a json object to decode as the struct,\nthe json should look like this:</p>\n\n<pre><code>{\n\"Age\":10,\n\"Name\":\"Lion\", \n\"Zone\":1,\n}\n</code></pre>\n\n<p>I want all fields to be field, but when ever I don't fill all the fields and send some json like.</p>\n\n<pre><code>{\n\"Age\":10,\n\"Zone\":1,\n}\n</code></pre>\n\n<p>The json.Decoder automatically build that Filed and set it as <code>\"\"</code> (which is zero value for the type) instead of null.</p>\n\n<p>How can I set null value or check it for being null and generate an error ?</p>\n\n<p>I expect the result to be <code>{Age:10, Zone:1, Name:null}</code> or at least generate an error!</p>\n\n<p>this is the code I use to convert json to struct </p>\n\n<pre><code>animalModel := Animal{}\nerr := json.NewDecoder(r.Body).Decode(&amp;animalModel)\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 464, "user_id": 4716685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60f976b0a7f6e8e3f25dc6cdd5378f3a?s=128&d=identicon&r=PG&f=1", "display_name": "reda la", "link": "https://stackoverflow.com/users/4716685/reda-la"}, "is_accepted": true, "score": 1, "last_activity_date": 1577637013, "last_edit_date": 1577637013, "creation_date": 1577630672, "answer_id": 59520390, "question_id": 59520050, "link": "https://stackoverflow.com/questions/59520050/how-does-go-mod-generate-the-version-and-timestamp-from-a-commit-id/59520390#59520390", "title": "How does go mod generate the version and timestamp from a commit id", "body": "<p>According to <a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">doc</a> go mod use a <a href=\"https://golang.org/cmd/go/#hdr-Pseudo_versions\" rel=\"nofollow noreferrer\">pseudo-version</a> when you specify an untagged commit</p>\n\n<p><strong>v0.0.137</strong> is the recent tagged version in the commit's graph before the specified commit</p>\n\n<p>and <strong>0.20191229121626</strong> is the commit time in UTC</p>\n"}], "owner": {"reputation": 67, "user_id": 11207806, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f086c8066684520b36676839b7357614?s=128&d=identicon&r=PG&f=1", "display_name": "Lu Liu", "link": "https://stackoverflow.com/users/11207806/lu-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 59520390, "answer_count": 1, "score": 1, "last_activity_date": 1577637013, "creation_date": 1577627974, "last_edit_date": 1577628287, "question_id": 59520050, "link": "https://stackoverflow.com/questions/59520050/how-does-go-mod-generate-the-version-and-timestamp-from-a-commit-id", "title": "How does go mod generate the version and timestamp from a commit id", "body": "<p>when I specify a git commit id in go.mod like \"xxx.xxx.org/xxxx/common 686937ffa3bf\". Then it seems that go mod will generate a version and a timestamp automatically like below \"xxx.xxx.org/xxxx/common v0.0.137-0.20191229121626-686937ffa3bf\". What I was wondering is where are \"v0.0.137\" and \"0.20191229121626\" from?</p>\n"}, {"tags": ["database", "go", "memory-leaks", "pq"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 3, "creation_date": 1577623353, "post_id": 59519456, "comment_id": 105209890, "body": "Using <code>rows.Close()</code> is fine when you have a single exit point to your function, otherwise <code>defer rows.Close()</code> is better to make sure it doesn&#39;t get missed. You should <a href=\"https://golang.org/pkg/runtime/pprof/\" rel=\"nofollow noreferrer\">profile</a> your program to figure out where the memory is going. This could be perfectly normal."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1577680584, "post_id": 59519456, "comment_id": 105222250, "body": "Why are you preallocating 10000000 length slices? Are you actually loading that many rows every time this function is called? Are you aware that <code>date = date[:z]</code> just changes the window into the underlying array that the slice reveals, and <b>does not</b> free the extra elements for garbage collection?"}, {"owner": {"reputation": 1103, "user_id": 5502866, "user_type": "registered", "accept_rate": 81, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg=k-s128", "display_name": "Kingindanord", "link": "https://stackoverflow.com/users/5502866/kingindanord"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577703011, "post_id": 59519456, "comment_id": 105228790, "body": "@Adrian I am loading more than 1M rows so instead of dynamically allocating the resources I decided to preallocate with a constant number (I&#39;ve noticed this approach is faster). The <code>date = date[:z]</code> part is to free the unused resources. However, as suggested in the answer below, at the end of the loop I used <code>date = nil</code> and <code>price = nil</code>, but this step didn&#39;t help neither."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1577713488, "post_id": 59519456, "comment_id": 105233212, "body": "It&#39;s faster but it wastes memory. As I noted, <code>date = date[:z]</code> doesn&#39;t free anything. The underlying slice is still there so those elements cannot be garbage collected. Have you considered preallocating the actual number of rows returned by your query instead of an arbitrary constant?"}, {"owner": {"reputation": 1103, "user_id": 5502866, "user_type": "registered", "accept_rate": 81, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg=k-s128", "display_name": "Kingindanord", "link": "https://stackoverflow.com/users/5502866/kingindanord"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577714290, "post_id": 59519456, "comment_id": 105233598, "body": "@Adrian yes but that means I have to make an additional query to the database, I didn&#39;t find yet a way to get the rows count before scanning them."}], "answers": [{"comments": [{"owner": {"reputation": 1103, "user_id": 5502866, "user_type": "registered", "accept_rate": 81, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg=k-s128", "display_name": "Kingindanord", "link": "https://stackoverflow.com/users/5502866/kingindanord"}, "edited": false, "score": 0, "creation_date": 1577660369, "post_id": 59522377, "comment_id": 105219057, "body": "thanks for the explanation. Allocating the slices before calling the function didn&#39;t affect the memory allocation. Calling <code>runtime.GC() </code> at the end of the for loop did the trick somehow though I am not sure if it has negative effects."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1103, "user_id": 5502866, "user_type": "registered", "accept_rate": 81, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg=k-s128", "display_name": "Kingindanord", "link": "https://stackoverflow.com/users/5502866/kingindanord"}, "edited": false, "score": 1, "creation_date": 1577707133, "post_id": 59522377, "comment_id": 105230475, "body": "Don&#39;t ever call <code>runtime.GC()</code> in production code: it&#39;s intended for debugging purposes. Again, if you face (what you think is) an uncontrollable memory growth you either have a bug in your code or in the Go runtime or its stdlib. The latter is highly unlikely for the\u2014I hope\u2014apparent reasons unless, of course, you&#39;re using a bleeding edge version of Go. Since we do not access to the full code, we&#39;re unable to assess whether you&#39;ve implemented slice reusing correctly or not. And of course memory churn can also happen in other places of the code. <i>Profiling</i> is the only answer to this &quot;riddle&quot;."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 3, "last_activity_date": 1577645798, "creation_date": 1577645798, "answer_id": 59522377, "question_id": 59519456, "link": "https://stackoverflow.com/questions/59519456/memory-leaks-when-using-db-connections-within-a-for-loop/59522377#59522377", "title": "Memory leaks when using db connections within a for loop", "body": "<p>You're allocating two slices of 10M elements each (<code>float64</code> is 8 bytes and <code>time.Time</code> is bigger) on each call to <code>importPrices</code>.</p>\n\n<p>Sure, most of those slices eventually become garbage (supposedly, you overwrite some variables with those two slices returned from <code>importPrices</code>), but that garbage will naturally <em>float</em> until the Go runtime powering your program decides to collect it. Until that happens, the memory consumption will grow.</p>\n\n<p>It's crucial to understand that the two \"standard\" implementations of the language (of which you supposedly is using one) feature <em>scanning</em> GC which is working in parallel with the main program flow. In other words, when the program loses the last live reference to an allocated memory block, <em>nothing happens</em> in that very moment with regard to the memory that block occupies\u2014it'll have to wait until the GC will find it and then collect. The exact moment in time when this will happen is mostly unpredictable; Go features complex dynamic algorithm to <em>pace</em> the GC in a way it strikes some balance between the amount of CPU cycles spent on collecting the garbage and letting the memory consumption grow.</p>\n\n<p>As to the problem at hand, the usual approach is to simply reuse the allocated memory between iterations.\nThat is, allocate your slices up front before calling <code>importPrices</code>,\npass them there, and then reset them to the zero length before passing them in again.</p>\n"}], "owner": {"reputation": 1103, "user_id": 5502866, "user_type": "registered", "accept_rate": 81, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg=k-s128", "display_name": "Kingindanord", "link": "https://stackoverflow.com/users/5502866/kingindanord"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 669, "favorite_count": 0, "accepted_answer_id": 59522377, "answer_count": 1, "score": 0, "last_activity_date": 1577651369, "creation_date": 1577622918, "last_edit_date": 1577651369, "question_id": 59519456, "link": "https://stackoverflow.com/questions/59519456/memory-leaks-when-using-db-connections-within-a-for-loop", "title": "Memory leaks when using db connections within a for loop", "body": "<p>I am trying to continuously query Postgres Database within an infinite for loop. However, it seems that the queries are not closing, the garbage collector not working probably and I face memory allocation problems.</p>\n\n<p>The script design is as following:</p>\n\n<p>In <code>func main()</code> I declare a global db connection. Then execute <code>func checkCross(...)</code> which contains the for loop which with each iteration executes the <code>func importPrices(...)</code> which in it's turn import rows from the database.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    \"database/sql\"\n    _\"github.com/lib/pq\"\n    \"runtime\"\n    )\n\n\nvar db *sql.DB\n\nfunc main() {\n    var err error\n\n    psqlInfo := fmt.Sprintf(\"host=%s port=%d user=%s \"+\" dbname=%s password=%s \", host, port, user, dbname, password)\n\n    //connection\n    db, err = sql.Open(\"postgres\", psqlInfo)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer db.Close()\n\n    checkCross(\"EUR_USD\")\n\n    ...\n</code></pre>\n\n<p><strong>func checkCross(...)</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>   func checkCross(instrument string) {\n\n    for i := 1; i &lt; 4; i++ {\n            rawData, _ := importPrices(instrument)\n\n            var mem runtime.MemStats\n            runtime.ReadMemStats(&amp;mem)\n            fmt.Printf(\"alloc [%v] \\t heapAlloc [%v] \\n\", mem.Alloc, mem.HeapAlloc)\n\n            ...\n\n        }\n\n</code></pre>\n\n<p><strong>func importPrices(...)</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func importPrices(instrument string) ([]float64, []time.Time) {\n\n    var price_ float64\n    var date_ time.Time\n\n    price := make([]float64, 10000000)\n    date := make([]time.Time, 10000000)\n\n    queryCommand := fmt.Sprintf(\"SELECT * FROM table where instrument = '%[1]v' ORDER BY 1 ASC;\", instrument)\n\n    rows, err := db.Query(queryCommand)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n\n    //scan from db\n    z := 0\n    for rows.Next() {\n        err := rows.Scan(&amp;date_, &amp;price_)\n        if err != nil {\n            log.Fatal(err)\n        }\n        price[z] = price_\n\n        date[z] = date_\n\n        z+=1\n    }\n\n    price = price[:z] \n    date = date[:z] \n\n\n    if err := rows.Err(); err != nil {\n        log.Fatal(err)\n    }\n\n    rows.Close()\n    return price, date\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>alloc [321664064]        heapAlloc [321664064] \nalloc [641723264]        heapAlloc [641723264] \nalloc [961781984]        heapAlloc [961781984]\n</code></pre>\n\n<p>Can you please guide me where is the issue in my code or approach?\nI've read some articles and they recommend to use <code>rows.Close()</code> within the for loop instead of <code>defer rows.Close()</code> but this solution didn't work. </p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": true, "score": 6, "last_activity_date": 1577627874, "last_edit_date": 1577627874, "creation_date": 1577617453, "answer_id": 59518809, "question_id": 59518482, "link": "https://stackoverflow.com/questions/59518482/how-to-save-byte-data-in-array-list/59518809#59518809", "title": "How to save []byte data in array list", "body": "<p>Step one convert your JSON into a go struct.  To do this I always use an online converter like <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">https://mholt.github.io/json-to-go/</a></p>\n\n<pre><code>type AutoGenerated struct {\n    TotalGrand      int `json:\"total_grand\"`\n    TotalBillable   int `json:\"total_billable\"`\n    TotalCurrencies []struct {\n        Currency string `json:\"currency\"`\n        Amount   int    `json:\"amount\"`\n    } `json:\"total_currencies\"`\n    Data []struct {\n        ID    int `json:\"id\"`\n        Title struct {\n            Project string      `json:\"project\"`\n            Client  interface{} `json:\"client\"`\n        } `json:\"title\"`\n        Time            int `json:\"time\"`\n        TotalCurrencies []struct {\n            Currency string `json:\"currency\"`\n            Amount   int    `json:\"amount\"`\n        } `json:\"total_currencies\"`\n        Items []struct {\n            Title struct {\n                TimeEntry string `json:\"time_entry\"`\n            } `json:\"title\"`\n            Time int    `json:\"time\"`\n            Cur  string `json:\"cur\"`\n            Sum  int    `json:\"sum\"`\n            Rate int    `json:\"rate\"`\n        } `json:\"items\"`\n    } `json:\"data\"`\n}\n</code></pre>\n\n<p>Then</p>\n\n<ul>\n<li>read the json file into a byte array ie, using <code>http.NewRequest(\"GET\", url, nil)</code> , <code>client.Do(req)</code> and <code>byte_array,err:=ioutil.ReadAll(resp.Body)</code></li>\n<li>with <code>make</code> or <code>new</code> create an instance of the struct</li>\n<li>process the byte array into the struct instance <code>json.Unmarshal(byte_array, &amp;instance_of_struct)</code></li>\n</ul>\n\n<p>You will then have a struct containing the data from the JSON</p>\n"}], "owner": {"reputation": 43, "user_id": 11960653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8c3a877ea3dc694f1690f2208da595b?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v2", "link": "https://stackoverflow.com/users/11960653/jpskgc-v2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 59518809, "answer_count": 1, "score": -1, "last_activity_date": 1577651436, "creation_date": 1577614506, "last_edit_date": 1577651436, "question_id": 59518482, "link": "https://stackoverflow.com/questions/59518482/how-to-save-byte-data-in-array-list", "title": "How to save []byte data in array list", "body": "<h3>Summarize the problem</h3>\n\n<p>I make some application that receive data from toggl api.\nI try to save []byte response data in array list in Go to modify data later.\nI want to know how to translate and store this response []byte json style data as array list.</p>\n\n<h3>Show some code</h3>\n\n<p>main.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\ntype togglData struct {\n}\n\nfunc GetTogglReports() []byte {\n    //some code\n\n    resp, err := client.Do(req)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer resp.Body.Close()\n\n    data, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    return data\n}\n\nfunc makeSurveyText() {\n    // I want to save []byte data GetTogglReports() in array list here.\n    var togglData []togglData\n}\n\n</code></pre>\n\n<p>data is like this:</p>\n\n<pre><code> {\n    \"total_grand\":36004000,\n    \"total_billable\":14400000,\n    \"total_currencies\":[{\"currency\":\"EUR\",\"amount\":40}],\n    \"data\": [\n      {\n        \"id\":193009951,\n        \"title\":{\"project\":\"Toggl Development\",\"client\":null},\n        \"time\":14400000,\n        \"total_currencies\":[{\"currency\":\"EUR\",\"amount\":0}],\n        \"items\":[\n          {\n            \"title\":{\"time_entry\":\"Hard work\"},\n            \"time\":14400000,\n            \"cur\":\"EUR\",\n            \"sum\":0,\n            \"rate\":50\n          }\n        ]\n      },{\n        \"id\":null,\n        \"title\":{\"project\":null,\"client\":null},\n        \"time\":7204000,\n        \"total_currencies\":[],\n        \"items\":[\n          {\n            \"title\":{\"time_entry\":\"No title yet\"},\n            \"time\":1000,\n            \"cur\":\"EUR\",\n            \"sum\":0,\n            \"rate\":50\n          }\n        ]\n      }\n    ]\n  }\n</code></pre>\n"}, {"tags": ["api", "authentication", "go"], "answers": [{"comments": [{"owner": {"reputation": 2314, "user_id": 9768260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/604c85a549d2603e8119880c100b5aae?s=128&d=identicon&r=PG", "display_name": "ccd", "link": "https://stackoverflow.com/users/9768260/ccd"}, "edited": false, "score": 0, "creation_date": 1577621362, "post_id": 59519146, "comment_id": 105209415, "body": "Is that mean I should set name and pass in client header, then send the <code>&#47;v1&#47;users&#47;token</code> url?"}, {"owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "reply_to_user": {"reputation": 2314, "user_id": 9768260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/604c85a549d2603e8119880c100b5aae?s=128&d=identicon&r=PG", "display_name": "ccd", "link": "https://stackoverflow.com/users/9768260/ccd"}, "edited": false, "score": 1, "creation_date": 1577621503, "post_id": 59519146, "comment_id": 105209444, "body": "Correct. The example checks if the client sent the credentials (in that case <code>ok</code> would be true). If not, the request is denied"}], "tags": [], "owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "is_accepted": false, "score": 1, "last_activity_date": 1577660702, "last_edit_date": 1577660702, "creation_date": 1577620321, "answer_id": 59519146, "question_id": 59518205, "link": "https://stackoverflow.com/questions/59518205/web-api-set-name-and-password-to-request-basicauth/59519146#59519146", "title": "Web api set name and password to request.BasicAuth", "body": "<p>Before a browser asks the user to supply basic auth credentials, you have to deny the request access (using status code 401 Unauthorized). You should set the header <code>WWW-Authenticate</code> to <code>Basic realm=\"Your message\"</code>. \nAlso see <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Authentication\" rel=\"nofollow noreferrer\">this article</a>.</p>\n\n<p>So in your code, when <code>ok</code> is false, you should deny that request:</p>\n\n<pre><code>func (u *User) Token(ctx context.Context, w http.ResponseWriter, r *http.Request, params map[string]string) error {\n    ...\n    name, pass, ok := r.BasicAuth()\n    if !ok  {\n         w.Header().Set(\"WWW-Authenticate\", \"Basic realm=\\\"Your message\\\"\")\n         http.Error(w, \"Must supply authentication credentials\", http.StatusUnauthorized)\n         return\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2314, "user_id": 9768260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/604c85a549d2603e8119880c100b5aae?s=128&d=identicon&r=PG", "display_name": "ccd", "link": "https://stackoverflow.com/users/9768260/ccd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1577660702, "creation_date": 1577611747, "last_edit_date": 1577623035, "question_id": 59518205, "link": "https://stackoverflow.com/questions/59518205/web-api-set-name-and-password-to-request-basicauth", "title": "Web api set name and password to request.BasicAuth", "body": "<p>The route for login authenticate -- <code>app.Handle(\"GET\", \"/v1/users/token\", u.Token)</code>. </p>\n\n<p>We can get name and password from request.BasicAuth.</p>\n\n<pre><code>func (u *User) Token(ctx context.Context, w http.ResponseWriter, r *http.Request, params map[string]string) error {\n    ...\n    name, pass, ok := r.BasicAuth()\n    ...\n}\n</code></pre>\n\n<p>But how can I set name and pass from client web url?</p>\n"}, {"tags": ["go", "caching", "proxy", "video-streaming", "streaming"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1577637228, "post_id": 59518175, "comment_id": 105213353, "body": "Edit the question to include the server code."}, {"owner": {"reputation": 722, "user_id": 3195688, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64698dbaa30e3023a418181f2a4f50f0?s=128&d=identicon&r=PG&f=1", "display_name": "Erikas", "link": "https://stackoverflow.com/users/3195688/erikas"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577653706, "post_id": 59518175, "comment_id": 105217624, "body": "Added source code"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577661324, "post_id": 59518175, "comment_id": 105219237, "body": "The copy loop does not handle the case where k != len(buf).   Fix the code by using io.Copy to copy the response.   The application does not propagate request and response headers between the client and the backend server.  That may or may not be a problem."}, {"owner": {"reputation": 722, "user_id": 3195688, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64698dbaa30e3023a418181f2a4f50f0?s=128&d=identicon&r=PG&f=1", "display_name": "Erikas", "link": "https://stackoverflow.com/users/3195688/erikas"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577742283, "post_id": 59518175, "comment_id": 105244111, "body": "I already tried <code>io.Copy(...)</code>, tried <code>resp.Write(...)</code>, tried hijacking sessions and writing raw TCP as well as <code>httputil.NewChunked...</code> - data is being buffered, but never starts playing (as described in the post). Stream type is actually <code>mpeg-ts</code> and I think I should be looking into other go projects working with mpeg-ts streams."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577758767, "post_id": 59518175, "comment_id": 105247700, "body": "The current copy code is broken and the easiest and best fix is to replace it with io.Copy.  Dump the request and response headers for the two cases and compare."}], "answers": [{"tags": [], "owner": {"reputation": 722, "user_id": 3195688, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64698dbaa30e3023a418181f2a4f50f0?s=128&d=identicon&r=PG&f=1", "display_name": "Erikas", "link": "https://stackoverflow.com/users/3195688/erikas"}, "is_accepted": false, "score": 0, "last_activity_date": 1578216515, "creation_date": 1578216515, "answer_id": 59598522, "question_id": 59518175, "link": "https://stackoverflow.com/questions/59518175/how-do-i-manually-proxy-application-octet-stream-live-video-in-go/59598522#59598522", "title": "How do I manually proxy application/octet-stream (live video) in Go?", "body": "<p>I was building a dynamic <em>M3U</em> playlist and putting <code>.m3u8</code> ending on each link. All the links are of unknown type, so I thought media players will just look at <em>Content-Type</em> and handle media accordingly, but actually they look at URL endings as well (whether URL contains <code>.m3u8</code> or not).</p>\n\n<p>If you put at the end of the link <code>.m3u8</code>, then set that link's Content-Type as <code>application/octet-stream</code> and provide actual <code>application/octet-stream</code> stream - players will never start showing any video stream. Solution - do not append <code>.m3u8</code> to URL if that URL is not <code>m3u8</code> format media. Without <code>m3u8</code> media players can still show the video.</p>\n"}], "owner": {"reputation": 722, "user_id": 3195688, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64698dbaa30e3023a418181f2a4f50f0?s=128&d=identicon&r=PG&f=1", "display_name": "Erikas", "link": "https://stackoverflow.com/users/3195688/erikas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 517, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1578216515, "creation_date": 1577611371, "last_edit_date": 1577653613, "question_id": 59518175, "link": "https://stackoverflow.com/questions/59518175/how-do-i-manually-proxy-application-octet-stream-live-video-in-go", "title": "How do I manually proxy application/octet-stream (live video) in Go?", "body": "<p>I am trying to build an application which would act as a streaming proxy server with caching features. The thing is, I want to do it manually without using <code>NewSingleHostReverseProxy</code>. Manually means performing these steps:</p>\n\n<ol>\n<li>Perform single <code>GET</code> request to the server</li>\n<li>Read <code>resp.Body</code> to buffer and write to connected client(s)</li>\n</ol>\n\n<p>And the issue is that VLC doesn't play anything. If I access stream directly - VLC plays it without problems, but if I do it via GO - VLC (as well as Kodi) just keeps buffering and never starts playing.</p>\n\n<p>Things I've tried, but did not work:</p>\n\n<ol>\n<li><code>io.Copy(...)</code></li>\n<li><code>bufio</code> reader/scanner and writing to the connected client. Flushing also did not help.</li>\n</ol>\n\n<p>This is what <code>curl -v &lt;stream_url&gt;</code> says (accessing streaming url directly):</p>\n\n<pre><code>...\n* Mark bundle as not supporting multiuse\n&lt; HTTP/1.1 200 Ok\n&lt; Server: Myserver\n&lt; Cache-Control: no-cache\n&lt; Pragma: no-cache\n&lt; Content-Type: application/octet-stream\n&lt; Access-Control-Allow-Origin: *\n&lt; Connection: close\n&lt; \nWarning: Binary output can mess up your terminal. Use \"--output -\" to tell \nWarning: curl to output it to your terminal anyway, or consider \"--output \nWarning: &lt;FILE&gt;\" to save to a file.\n* Failed writing body (0 != 2896)\n* Closing connection 0\n</code></pre>\n\n<p>This is what <code>curl -v &lt;my_app_url&gt;</code> says:</p>\n\n<pre><code>...\n* Mark bundle as not supporting multiuse\n&lt; HTTP/1.1 200 OK\n&lt; Access-Control-Allow-Origin: *\n&lt; Cache-Control: no-cache\n&lt; Content-Type: application/octet-stream\n&lt; Pragma: no-cache\n&lt; Server: Myserver\n&lt; Date: Sun, 29 Dec 2019 09:13:44 GMT\n&lt; Transfer-Encoding: chunked\n&lt; \nWarning: Binary output can mess up your terminal. Use \"--output -\" to tell \nWarning: curl to output it to your terminal anyway, or consider \"--output \nWarning: &lt;FILE&gt;\" to save to a file.\n* Failed writing body (0 != 14480)\n* Failed reading the chunked-encoded stream\n* Closing connection 0\n</code></pre>\n\n<hr>\n\n<p>Seems the issue is here, but how do I solve it?</p>\n\n<p>Good:</p>\n\n<pre><code>* Failed writing body (0 != 2896)\n* Closing connection 0\n</code></pre>\n\n<p>Bad:</p>\n\n<pre><code>* Failed writing body (0 != 14480)\n* Failed reading the chunked-encoded stream\n* Closing connection 0\n</code></pre>\n\n<hr>\n\n<p>Also adding a source code for example:</p>\n\n<pre><code>func main() {\n    http.HandleFunc(\"/stream\", func(w http.ResponseWriter, r *http.Request) {\n        resp, err := http.Get(\"http://example.com/stream/videostream\")\n        if err != nil {\n            panic(err)\n        }\n        defer resp.Body.Close()\n        reader := bufio.NewReader(resp.Body)\n        buf := make([]byte, 1024)\n        for {\n            k, _ := reader.Read(buf)\n            if k == 0 {\n                break\n            }\n            w.Write(buf)\n        }\n    })\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "server"], "comments": [{"owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1577601669, "post_id": 59517301, "comment_id": 105206037, "body": "You&#39;re giving the path to a file (<code>index.html</code>) to <code>http.Dir</code>, which expects to be given a directory name. Maybe that could be the cause? Also, you should call <code>http.Handle</code> before <code>ListenAndServe</code>"}], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 12617531, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBPshGndlfougQV_wE_o0XAsa_jf-IZOhMKaqvGyg=k-s128", "display_name": "Tori ", "link": "https://stackoverflow.com/users/12617531/tori"}, "edited": false, "score": 0, "creation_date": 1577632095, "post_id": 59517375, "comment_id": 105212143, "body": "Awesome, thank you. I did all these things and it&#39;s now serving from my static index.html, although this isn&#39;t being updated during my npm build (I want my app body to be replaced in there with my react code).  I&#39;m thinking that I need some custom build script or to use a library that&#39;s already out there to get this to handle correctly??"}, {"owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "reply_to_user": {"reputation": 61, "user_id": 12617531, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBPshGndlfougQV_wE_o0XAsa_jf-IZOhMKaqvGyg=k-s128", "display_name": "Tori ", "link": "https://stackoverflow.com/users/12617531/tori"}, "edited": false, "score": 0, "creation_date": 1577659809, "post_id": 59517375, "comment_id": 105218945, "body": "Why is it not updated? If the files are generated somewhere else, you could also copy them over automatially. This really depends on your setup and how files are generated/built"}], "tags": [], "owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "is_accepted": false, "score": 1, "last_activity_date": 1577601938, "creation_date": 1577601938, "answer_id": 59517375, "question_id": 59517301, "link": "https://stackoverflow.com/questions/59517301/why-do-i-get-a-404-for-my-static-webpage/59517375#59517375", "title": "Why do I get a 404 for my static webpage?", "body": "<p>There are two things that could be the cause:</p>\n\n<ul>\n<li>You're giving a file name to <a href=\"https://godoc.org/net/http#Dir\" rel=\"nofollow noreferrer\"><code>http.Dir</code></a>, which expects a directory.</li>\n<li>Your handler is registered after calling <code>ListenAndServe</code>, thus making it useless (http.Handle is never called)</li>\n</ul>\n\n<p>You could fix it by changing your code like this:</p>\n\n<pre><code>indexLoc := os.Genenv(webRootEnv) // webRootEnv is a directory path\nfs := http.FileServer(http.Dir(indexLoc))\nhttp.Handle(\"/\", fs) // register handler before listening\nhttp.ListenAndServe(\":8080\", nil)\n</code></pre>\n\n<p>You might also want to handle the error returned from <a href=\"https://godoc.org/net/http#ListenAndServe\" rel=\"nofollow noreferrer\"><code>ListenAndServe</code></a> to prevent silent failures of your program</p>\n"}], "owner": {"reputation": 61, "user_id": 12617531, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBPshGndlfougQV_wE_o0XAsa_jf-IZOhMKaqvGyg=k-s128", "display_name": "Tori ", "link": "https://stackoverflow.com/users/12617531/tori"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1577605785, "creation_date": 1577600564, "last_edit_date": 1577605785, "question_id": 59517301, "link": "https://stackoverflow.com/questions/59517301/why-do-i-get-a-404-for-my-static-webpage", "title": "Why do I get a 404 for my static webpage?", "body": "<p>I\u2019ve been working for about 2 years developing full stack apps (which were fairly mature when I get to them initially) and am starting up my first from scratch. I spent the day spinning up an EC2 instance, loading the dependencies for my stack (Postgres, golang, react), and all the other frills a shiny new machine needs (tmux, npm, vim plugins, git integration etc). I\u2019m now stuck. \nI used create-react-app to get started on my front end and running npm start to have a build going. To see this, I can go to my instanceip:3000. \nI created golang server code which is serving up on port 8080 and I can hit my helloworld code by going to instanceip:8080/hello. \nI added an axios call in my react code to get endpoint /hello which returns a 404. </p>\n\n<p>I also attempted to make my golang handle the index.js as a static page for the instanceip:8080 and that returns a 404. </p>\n\n<p>How do I get my different ports to play nice? I can\u2019t figure out what I\u2019m missing here. </p>\n\n<p>Here\u2019s a snippet of my server code in main:</p>\n\n<pre><code>indexLoc := os.Genenv(webRootEnv) + \"/index.html\" // verified this is the correct path to my static index.html file by logging it out\nfs := http.FileServer(http.Dir(indexLoc))\nhttp.ListenAndServe(\":8080\", nil)\nhttp.Handle(\"/\", fs)\n</code></pre>\n\n<p>Anyone have any ideas what I\u2019m missing? Thanks in advance!</p>\n"}, {"tags": ["go", "gcc", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 3221, "user_id": 2245634, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/OHoy2.jpg?s=128&g=1", "display_name": "Amit\u0101bha", "link": "https://stackoverflow.com/users/2245634/amit%c4%81bha"}, "is_accepted": false, "score": 0, "last_activity_date": 1577600225, "creation_date": 1577600225, "answer_id": 59517276, "question_id": 59517128, "link": "https://stackoverflow.com/questions/59517128/implicit-declaration-of-function-beginthread-when-call-go-library-from-c-code/59517276#59517276", "title": "implicit declaration of function \u2018_beginthread\u2019 when call go library from c code", "body": "<p>i install tdm-gcc  solved problem</p>\n\n<p><a href=\"http://tdm-gcc.tdragon.net/download/\" rel=\"nofollow noreferrer\">http://tdm-gcc.tdragon.net/download/</a> </p>\n"}], "owner": {"reputation": 3221, "user_id": 2245634, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/OHoy2.jpg?s=128&g=1", "display_name": "Amit\u0101bha", "link": "https://stackoverflow.com/users/2245634/amit%c4%81bha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 514, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1577600225, "creation_date": 1577598287, "question_id": 59517128, "link": "https://stackoverflow.com/questions/59517128/implicit-declaration-of-function-beginthread-when-call-go-library-from-c-code", "title": "implicit declaration of function \u2018_beginthread\u2019 when call go library from c code", "body": "<p>i want to call go method in c code\nos is windows10\ni use Cygwin64 Terminal</p>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport \"C\"\n\nfunc main() {}\n\n//export number_add_mod\nfunc number_add_mod(a, b, mod C.int) C.int {\n    return (a + b) % mod\n}\n</code></pre>\n\n<p>_test_main.c</p>\n\n<pre><code>#include \"number.h\"\n\n#include &lt;stdio.h&gt;\n\nint main() {\n    int a = 10;\n    int b = 5;\n    int c = 12;\n\n    int x = number_add_mod(a, b, c);\n    printf(\"(%d+%d)%%%d = %d\\n\", a, b, c, x);\n\n    return 0;\n}\n</code></pre>\n\n<p>when i run</p>\n\n<pre><code>go build -buildmode=c-archive -o number.a\n</code></pre>\n\n<p>report error</p>\n\n<pre><code># runtime/cgo\ngcc_libinit_windows.c: in function\u2018x_cgo_sys_thread_create\u2019:\ngcc_libinit_windows.c:57:12: error\uff1aimplicit declaration of function \u2018_beginthread\u2019; did you mean \u2018OpenThread\u2019? [-Werror=implicit-function-declaration]\n  thandle = _beginthread(func, 0, arg);\n            ^~~~~~~~~~~~\n            OpenThread\ncc1\uff1a\ngo: failed to remove work dir: GetFileInformationByHandle D:\\cygwin64new\\tmp\\go-build109746670\\NUL: Incorrect function.\nmake: *** [Makefile:5\uff1adefault]\n</code></pre>\n"}, {"tags": ["go", "dynamic", "reflection"], "comments": [{"owner": {"reputation": 464, "user_id": 4716685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60f976b0a7f6e8e3f25dc6cdd5378f3a?s=128&d=identicon&r=PG&f=1", "display_name": "reda la", "link": "https://stackoverflow.com/users/4716685/reda-la"}, "edited": false, "score": 0, "creation_date": 1577633601, "post_id": 59516527, "comment_id": 105212459, "body": "I think the efficient way to do this is to keep pointers of these local variables into a global registry var (a map[string]interface) and implement on top of it some concurrency-safe accessor functions or methods. This kinda solution was adopted by many libraries... I think is the most idiomatic / promoted one"}, {"owner": {"reputation": 2815, "user_id": 123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eeb220ccf249757b0960465f2b10631?s=128&d=identicon&r=PG", "display_name": "icio", "link": "https://stackoverflow.com/users/123600/icio"}, "edited": false, "score": 1, "creation_date": 1577635819, "post_id": 59516527, "comment_id": 105213021, "body": "&quot;a random variable in golang&quot; - Can you clarify how you imagine identifying the random variable? From a string of its name, for example?"}, {"owner": {"reputation": 603, "user_id": 2904179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XMgKy.png?s=128&g=1", "display_name": "SteveCoffman", "link": "https://stackoverflow.com/users/2904179/stevecoffman"}, "edited": false, "score": 0, "creation_date": 1577808239, "post_id": 59516527, "comment_id": 105261401, "body": "Yes, from a string of its name."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": -1, "last_activity_date": 1577645592, "creation_date": 1577645592, "answer_id": 59522352, "question_id": 59516527, "link": "https://stackoverflow.com/questions/59516527/how-can-you-dynamically-resolve-or-introspect-variables/59522352#59522352", "title": "How can you dynamically resolve or introspect variables", "body": "<blockquote>\n  <p>[I]f I have a string value strVal := \"s\" that corresponds to the name of a var s string in the same scope, can I dynamically look up the value of s?</p>\n</blockquote>\n\n<p>No. A dead simple No.</p>\n"}, {"comments": [{"owner": {"reputation": 603, "user_id": 2904179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XMgKy.png?s=128&g=1", "display_name": "SteveCoffman", "link": "https://stackoverflow.com/users/2904179/stevecoffman"}, "edited": false, "score": 0, "creation_date": 1577808433, "post_id": 59523578, "comment_id": 105261457, "body": "Is it possible to programmatically (at run time) use delve to identify the value of variables by name?"}, {"owner": {"reputation": 327, "user_id": 5177327, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oE7n0.png?s=128&g=1", "display_name": "Donutloop", "link": "https://stackoverflow.com/users/5177327/donutloop"}, "reply_to_user": {"reputation": 603, "user_id": 2904179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XMgKy.png?s=128&g=1", "display_name": "SteveCoffman", "link": "https://stackoverflow.com/users/2904179/stevecoffman"}, "edited": false, "score": 0, "creation_date": 1577815710, "post_id": 59523578, "comment_id": 105263560, "body": "This is super strange your idea but maybe you could directly call a delve API to get this information but I think this isn&#39;t a best practice -&gt; <a href=\"https://blog.jetbrains.com/go/2018/04/30/debugging-containerized-go-applications/\" rel=\"nofollow noreferrer\">blog.jetbrains.com/go/2018/04/30/&hellip;</a>"}, {"owner": {"reputation": 603, "user_id": 2904179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XMgKy.png?s=128&g=1", "display_name": "SteveCoffman", "link": "https://stackoverflow.com/users/2904179/stevecoffman"}, "edited": false, "score": 0, "creation_date": 1577816255, "post_id": 59523578, "comment_id": 105263707, "body": "Yeah, it seems like I would be swimming upstream. My use case is that I want to enable metaprogramming similar to <code>Eval</code>, but it seems this is not easy, and I should just avoid the situation entirely."}, {"owner": {"reputation": 327, "user_id": 5177327, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oE7n0.png?s=128&g=1", "display_name": "Donutloop", "link": "https://stackoverflow.com/users/5177327/donutloop"}, "reply_to_user": {"reputation": 603, "user_id": 2904179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XMgKy.png?s=128&g=1", "display_name": "SteveCoffman", "link": "https://stackoverflow.com/users/2904179/stevecoffman"}, "edited": false, "score": 0, "creation_date": 1577816621, "post_id": 59523578, "comment_id": 105263818, "body": "You could maybe fork some concepts and code fragments of this interpreter-&gt; <a href=\"https://github.com/containous/yaegi\" rel=\"nofollow noreferrer\">github.com/containous/yaegi</a>"}], "tags": [], "owner": {"reputation": 327, "user_id": 5177327, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oE7n0.png?s=128&g=1", "display_name": "Donutloop", "link": "https://stackoverflow.com/users/5177327/donutloop"}, "is_accepted": false, "score": 0, "last_activity_date": 1577655945, "creation_date": 1577655945, "answer_id": 59523578, "question_id": 59516527, "link": "https://stackoverflow.com/questions/59516527/how-can-you-dynamically-resolve-or-introspect-variables/59523578#59523578", "title": "How can you dynamically resolve or introspect variables", "body": "<p>If you want to analyze while runtime a variable then you could use a debugger like delve</p>\n\n<p>Ref: <a href=\"https://github.com/go-delve/delve\" rel=\"nofollow noreferrer\">https://github.com/go-delve/delve</a></p>\n"}, {"comments": [{"owner": {"reputation": 603, "user_id": 2904179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XMgKy.png?s=128&g=1", "display_name": "SteveCoffman", "link": "https://stackoverflow.com/users/2904179/stevecoffman"}, "edited": false, "score": 0, "creation_date": 1578062915, "post_id": 59547363, "comment_id": 105327324, "body": "This is as good as you can get in Go, as far as I can tell. Thanks!"}, {"owner": {"reputation": 327, "user_id": 5177327, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oE7n0.png?s=128&g=1", "display_name": "Donutloop", "link": "https://stackoverflow.com/users/5177327/donutloop"}, "reply_to_user": {"reputation": 603, "user_id": 2904179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XMgKy.png?s=128&g=1", "display_name": "SteveCoffman", "link": "https://stackoverflow.com/users/2904179/stevecoffman"}, "edited": false, "score": 0, "creation_date": 1578076499, "post_id": 59547363, "comment_id": 105333480, "body": "They discuss a lot of new upcoming features for go2 on Github. Maybe you could create an issue -&gt; <a href=\"https://github.com/golang/go/labels/Go2\" rel=\"nofollow noreferrer\">github.com/golang/go/labels/Go2</a>"}], "tags": [], "owner": {"reputation": 327, "user_id": 5177327, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oE7n0.png?s=128&g=1", "display_name": "Donutloop", "link": "https://stackoverflow.com/users/5177327/donutloop"}, "is_accepted": true, "score": 1, "last_activity_date": 1577816204, "creation_date": 1577816204, "answer_id": 59547363, "question_id": 59516527, "link": "https://stackoverflow.com/questions/59516527/how-can-you-dynamically-resolve-or-introspect-variables/59547363#59547363", "title": "How can you dynamically resolve or introspect variables", "body": "<p>It seems like you cloud extract this information from a struct.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n\n)\n\ntype Article struct {\n    Id    int   \n    Title string\n    Price float32\n    Authors []string    \n}\n\nfunc main() {\n\n    article := Article{}\n\n    e := reflect.ValueOf(&amp;article).Elem()\n\n    for i := 0; i &lt; e.NumField(); i++ {\n        name := e.Type().Field(i).Name\n        varType := e.Type().Field(i).Type\n        value := e.Field(i).Interface()\n        fmt.Printf(\"%v %v %v\\n\", name, varType, value)\n    }\n}\n</code></pre>\n\n<p>Example: </p>\n\n<p><a href=\"https://play.golang.org/p/vWkRzpvWKYn\" rel=\"nofollow noreferrer\">https://play.golang.org/p/vWkRzpvWKYn</a></p>\n"}], "owner": {"reputation": 603, "user_id": 2904179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XMgKy.png?s=128&g=1", "display_name": "SteveCoffman", "link": "https://stackoverflow.com/users/2904179/stevecoffman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 1, "accepted_answer_id": 59547363, "answer_count": 3, "score": 0, "last_activity_date": 1577816204, "creation_date": 1577588148, "last_edit_date": 1577808367, "question_id": 59516527, "link": "https://stackoverflow.com/questions/59516527/how-can-you-dynamically-resolve-or-introspect-variables", "title": "How can you dynamically resolve or introspect variables", "body": "<p>Is there a way to resolve or introspect a variable identified from a string of its name? </p>\n\n<p>For instance, if I have a string value <code>strVal := \"s\"</code> that corresponds to the name of a variable such as <code>var s string</code> which is in the same function\n's scope, can I dynamically look up the value of the <code>s</code> variable? </p>\n\n<p>I know if these were fields of a struct, I could use reflection, but for my use case, I am dealing with locally scoped variables that are not part of a struct or map.</p>\n"}, {"tags": ["go", "cors", "jwt", "go-gin"], "answers": [{"tags": [], "owner": {"reputation": 61150, "user_id": 441757, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/921df025d1d7c99fad4553ac83bd8bdf?s=128&d=identicon&r=PG", "display_name": "sideshowbarker", "link": "https://stackoverflow.com/users/441757/sideshowbarker"}, "is_accepted": true, "score": 1, "last_activity_date": 1577589721, "creation_date": 1577589721, "answer_id": 59516630, "question_id": 59516369, "link": "https://stackoverflow.com/questions/59516369/angular-8-cors-when-connecting-to-go-gin/59516630#59516630", "title": "Angular 8 CORS when connecting to Go Gin", "body": "<p>Change <code>AllowHeaders: []string{\"Origin\"}</code> to <code>AllowHeaders: []string{\"content-type\"}</code>;</p>\n"}], "owner": {"reputation": 1429, "user_id": 3255061, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/67905c5234c8238498c0482115662138?s=128&d=identicon&r=PG&f=1", "display_name": "user3255061", "link": "https://stackoverflow.com/users/3255061/user3255061"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 838, "favorite_count": 0, "accepted_answer_id": 59516630, "answer_count": 1, "score": 0, "last_activity_date": 1577589834, "creation_date": 1577585317, "last_edit_date": 1577589834, "question_id": 59516369, "link": "https://stackoverflow.com/questions/59516369/angular-8-cors-when-connecting-to-go-gin", "title": "Angular 8 CORS when connecting to Go Gin", "body": "<p>I built a backend with Golang's <a href=\"https://gin-gonic.com/docs/quickstart/\" rel=\"nofollow noreferrer\">Gin framework</a> and the <a href=\"https://github.com/appleboy/gin-jwt\" rel=\"nofollow noreferrer\">JWT middleware for it</a>. This is the <a href=\"https://github.com/appleboy/gin-jwt#example\" rel=\"nofollow noreferrer\">official example from the readme</a>, which I used:</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"time\"\n\n    \"github.com/appleboy/gin-jwt/v2\"\n    \"github.com/gin-gonic/gin\"\n)\n\ntype login struct {\n    Username string `form:\"username\" json:\"username\" binding:\"required\"`\n    Password string `form:\"password\" json:\"password\" binding:\"required\"`\n}\n\nvar identityKey = \"id\"\n\nfunc helloHandler(c *gin.Context) {\n    claims := jwt.ExtractClaims(c)\n    user, _ := c.Get(identityKey)\n    c.JSON(200, gin.H{\n        \"userID\":   claims[identityKey],\n        \"userName\": user.(*User).UserName,\n        \"text\":     \"Hello World.\",\n    })\n}\n\n// User demo\ntype User struct {\n    UserName  string\n    FirstName string\n    LastName  string\n}\n\nfunc main() {\n    port := os.Getenv(\"PORT\")\n    r := gin.New()\n    r.Use(gin.Logger())\n    r.Use(gin.Recovery())\n\n    if port == \"\" {\n        port = \"8000\"\n    }\n\n    // the jwt middleware\n    authMiddleware, err := jwt.New(&amp;jwt.GinJWTMiddleware{\n        Realm:       \"test zone\",\n        Key:         []byte(\"secret key\"),\n        Timeout:     time.Hour,\n        MaxRefresh:  time.Hour,\n        IdentityKey: identityKey,\n        PayloadFunc: func(data interface{}) jwt.MapClaims {\n            if v, ok := data.(*User); ok {\n                return jwt.MapClaims{\n                    identityKey: v.UserName,\n                }\n            }\n            return jwt.MapClaims{}\n        },\n        IdentityHandler: func(c *gin.Context) interface{} {\n            claims := jwt.ExtractClaims(c)\n            return &amp;User{\n                UserName: claims[identityKey].(string),\n            }\n        },\n        Authenticator: func(c *gin.Context) (interface{}, error) {\n            var loginVals login\n            if err := c.ShouldBind(&amp;loginVals); err != nil {\n                return \"\", jwt.ErrMissingLoginValues\n            }\n            userID := loginVals.Username\n            password := loginVals.Password\n\n            if (userID == \"admin\" &amp;&amp; password == \"admin\") || (userID == \"test\" &amp;&amp; password == \"test\") {\n                return &amp;User{\n                    UserName:  userID,\n                    LastName:  \"Bo-Yi\",\n                    FirstName: \"Wu\",\n                }, nil\n            }\n\n            return nil, jwt.ErrFailedAuthentication\n        },\n        Authorizator: func(data interface{}, c *gin.Context) bool {\n            if v, ok := data.(*User); ok &amp;&amp; v.UserName == \"admin\" {\n                return true\n            }\n\n            return false\n        },\n        Unauthorized: func(c *gin.Context, code int, message string) {\n            c.JSON(code, gin.H{\n                \"code\":    code,\n                \"message\": message,\n            })\n        },\n        // TokenLookup is a string in the form of \"&lt;source&gt;:&lt;name&gt;\" that is used\n        // to extract token from the request.\n        // Optional. Default value \"header:Authorization\".\n        // Possible values:\n        // - \"header:&lt;name&gt;\"\n        // - \"query:&lt;name&gt;\"\n        // - \"cookie:&lt;name&gt;\"\n        // - \"param:&lt;name&gt;\"\n        TokenLookup: \"header: Authorization, query: token, cookie: jwt\",\n        // TokenLookup: \"query:token\",\n        // TokenLookup: \"cookie:token\",\n\n        // TokenHeadName is a string in the header. Default value is \"Bearer\"\n        TokenHeadName: \"Bearer\",\n\n        // TimeFunc provides the current time. You can override it to use another time value. This is useful for testing or if your server uses a different time zone than your tokens.\n        TimeFunc: time.Now,\n    })\n\n    if err != nil {\n        log.Fatal(\"JWT Error:\" + err.Error())\n    }\n\n    r.POST(\"/login\", authMiddleware.LoginHandler)\n\n    r.NoRoute(authMiddleware.MiddlewareFunc(), func(c *gin.Context) {\n        claims := jwt.ExtractClaims(c)\n        log.Printf(\"NoRoute claims: %#v\\n\", claims)\n        c.JSON(404, gin.H{\"code\": \"PAGE_NOT_FOUND\", \"message\": \"Page not found\"})\n    })\n\n    auth := r.Group(\"/auth\")\n    // Refresh time can be longer than token timeout\n    auth.GET(\"/refresh_token\", authMiddleware.RefreshHandler)\n    auth.Use(authMiddleware.MiddlewareFunc())\n    {\n        auth.GET(\"/hello\", helloHandler)\n    }\n\n    if err := http.ListenAndServe(\":\"+port, r); err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>My auth service in Angular 8 looks like this:</p>\n\n<p><strong>auth.service</strong></p>\n\n<pre><code>headers = new HttpHeaders({ \"Content-Type\": \"application/json\" });\n\nlogin(username: string, password: string): Promise&lt;any&gt; {\n    const url: string = `${this.BASE_URL}` + \"/login\";\n    const request = this.http\n        .post(\n            url,\n            JSON.stringify({ username: username, password: password }),\n            { headers: this.headers }\n        )\n\n        .toPromise();\n\n    return request;\n}\n</code></pre>\n\n<p>But this gives me an error message in Chrome:</p>\n\n<pre><code>Access to XMLHttpRequest at 'http://127.0.0.1:8000/api/login' from origin 'http://localhost:4200' has been blocked by CORS policy: Request header field content-type is not allowed by Access-Control-Allow-Headers in preflight response.\n</code></pre>\n\n<p>In the console Gin returns status code 204 though.</p>\n\n<p>I thought this was a CORS issue, so I implemented Gin's <a href=\"https://github.com/gin-contrib/cors#canonical-example\" rel=\"nofollow noreferrer\">CORS middleware</a>:</p>\n\n<pre><code>r.Use(cors.New(cors.Config{\n    AllowOrigins:     []string{\"http://localhost:8000\"},\n    AllowMethods:     []string{\"PUT\", \"PATCH\"},\n    AllowHeaders:     []string{\"Origin\"},\n    ExposeHeaders:    []string{\"Content-Length\"},\n    AllowCredentials: true,\n    AllowOriginFunc: func(origin string) bool {\n        return origin == \"https://github.com\"\n    },\n    MaxAge: 12 * time.Hour,\n}))\n</code></pre>\n\n<p>Unfortunately it still didn't work. Also not if I added the POST method to the allowed methods:</p>\n\n<pre><code>AllowMethods:     []string{\"PUT\", \"PATCH\", \"POST\"}\n</code></pre>\n\n<p>My last try was to use proxy, as described in the <a href=\"https://angular.io/guide/build#proxying-to-a-backend-server\" rel=\"nofollow noreferrer\">Angular documentation</a>:</p>\n\n<p><strong>proxy.conf.json</strong></p>\n\n<pre><code>{\n  \"/api\": {\n    \"target\": \"http://localhost:8000\",\n    \"secure\": false\n  }\n}\n</code></pre>\n\n<p><strong>angular.json</strong></p>\n\n<pre><code>\"options\": {\n      \"browserTarget\": \"your-application-name:build\",\n      \"proxyConfig\": \"src/proxy.conf.json\"\n }\n</code></pre>\n\n<p>I re-started with ng serve, but the error still appears (I changed the urls to /api/login in the auth.service and main.go according to the configuration in the proxy file).</p>\n\n<p>What am I doing wrong here?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 3, "creation_date": 1577583453, "post_id": 59516162, "comment_id": 105204046, "body": "Start with <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">A Tour of Go</a>. It covers <a href=\"https://tour.golang.org/methods/1\" rel=\"nofollow noreferrer\">Methods</a> and much more."}], "answers": [{"tags": [], "owner": {"reputation": 8957, "user_id": 1073868, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/397bb6e2c9cc191a20143ca8566385c5?s=128&d=identicon&r=PG&f=1", "display_name": "Dan", "link": "https://stackoverflow.com/users/1073868/dan"}, "is_accepted": false, "score": 4, "last_activity_date": 1577584364, "last_edit_date": 1577584364, "creation_date": 1577581920, "answer_id": 59516180, "question_id": 59516162, "link": "https://stackoverflow.com/questions/59516162/how-go-use-this-function/59516180#59516180", "title": "How go use this function", "body": "<p><code>(t TestContent)</code> is not the return type. <code>(t TestContent)</code> indicates that <code>CalculateHash</code> is a method of the <code>TestContent</code> struct. The return type of this function is <code>([]byte, error)</code>.</p>\n\n<p>It's used on an instance of <code>TestContent</code>, ie:</p>\n\n<pre><code>  var t TestContent\n  bytes, err := t.CalculateHash()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 2, "creation_date": 1577597625, "post_id": 59516323, "comment_id": 105205566, "body": "The question is about Go. The Python example is irrelevant. It is also wrong, Go doesn&#39;t have classes."}, {"owner": {"reputation": 11566, "user_id": 1262820, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mq3Cq.png?s=128&g=1", "display_name": "felipsmartins", "link": "https://stackoverflow.com/users/1262820/felipsmartins"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1577598219, "post_id": 59516323, "comment_id": 105205620, "body": "That is why I have used &quot;roughly&quot; word here. It&#39;s just an example/comparation. it&#39;s not fair use moderator powers to edit or delete part of answers. Please use the comments section to make additional considerations and do not modify answers."}], "tags": [], "owner": {"reputation": 11566, "user_id": 1262820, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mq3Cq.png?s=128&g=1", "display_name": "felipsmartins", "link": "https://stackoverflow.com/users/1262820/felipsmartins"}, "is_accepted": false, "score": -2, "last_activity_date": 1577595939, "last_edit_date": 1577595939, "creation_date": 1577584449, "answer_id": 59516323, "question_id": 59516162, "link": "https://stackoverflow.com/questions/59516162/how-go-use-this-function/59516323#59516323", "title": "How go use this function", "body": "<p>Actually, it's a <a href=\"https://golang.org/ref/spec#Method_declarations\" rel=\"nofollow noreferrer\">method declaration</a>. From docs:</p>\n\n<blockquote>\n  <p>A method is a function with a receiver. A method declaration binds an\n  identifier, the method name, to a method, and associates the method\n  with the receiver's base type.</p>\n</blockquote>\n\n<pre><code>MethodDecl = \"func\" [Receiver][1] MethodName Signature [ FunctionBody ] .\nReceiver   = Parameters .\n</code></pre>\n\n<p>Yet:</p>\n\n<blockquote>\n  <p>Go does not have classes. However, you can define methods on types. A\n  method is a function with a special receiver argument. The receiver\n  appears in its own argument list between the func keyword and the\n  method name.</p>\n</blockquote>\n\n<p>So in your example, <code>(t TestContent)</code> is a receiver on method declaration.<br>\nThe following python snippet is <strong>roughly</strong> the Golang version:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>#!/usr/bin/env python3\nclass TestContent:\n    def __init__(self):\n        self.x: str = \"\"\n\ndef CalculateHash():\n    pass\n\ntestContent = TestContent()\ntestContent.CalculateHash = CalculateHash\n</code></pre>\n\n<ul>\n<li><a href=\"https://tour.golang.org/methods/1\" rel=\"nofollow noreferrer\">Tour of Go - Methods</a></li>\n<li><p><a href=\"https://golang.org/ref/spec#Receiver\" rel=\"nofollow noreferrer\">Receivers</a></p></li>\n<li><p><a href=\"https://golang.org/ref/spec#Method_declarations\" rel=\"nofollow noreferrer\">Method declaration</a></p></li>\n</ul>\n"}], "owner": {"reputation": 109, "user_id": 646052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8W9Rp.gif?s=128&g=1", "display_name": "metalbean", "link": "https://stackoverflow.com/users/646052/metalbean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "closed_date": 1577653731, "answer_count": 2, "score": 0, "last_activity_date": 1577653744, "creation_date": 1577581699, "last_edit_date": 1577653567, "question_id": 59516162, "link": "https://stackoverflow.com/questions/59516162/how-go-use-this-function", "closed_reason": "Duplicate", "title": "How go use this function", "body": "<pre><code>type TestContent struct {\n  x string\n}\n\n//CalculateHash hashes the values of a TestContent\nfunc (t TestContent) CalculateHash() ([]byte, error) {\n  h := sha256.New()\n  if _, err := h.Write([]byte(t.x)); err != nil {\n    return nil, err\n  }\n\n  return h.Sum(nil), nil\n}\n</code></pre>\n\n<p>In the declared function <code>CalculateHash()</code>, why is there a datatype <code>t TestContent</code> written before the function name? Isn't the return type not suppose to be written after the function name?</p>\n"}, {"tags": ["go", "url", "hugo", "static-site", "jamstack"], "answers": [{"tags": [], "owner": {"reputation": 14976, "user_id": 2031033, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/88ce5a1f961832585f329292d22451fc?s=128&d=identicon&r=PG", "display_name": "Connor Leech", "link": "https://stackoverflow.com/users/2031033/connor-leech"}, "is_accepted": false, "score": 2, "last_activity_date": 1577580070, "creation_date": 1577580070, "answer_id": 59516069, "question_id": 59515945, "link": "https://stackoverflow.com/questions/59515945/how-do-i-change-the-default-url-posts-routing-in-a-hugo-site/59516069#59516069", "title": "How do I change the default url &quot;/posts/&quot; routing in a Hugo site?", "body": "<p>Shoulda been <code>posts</code> instead of <code>post</code>.</p>\n\n<p><strong>config.toml</strong></p>\n\n<pre><code>baseURL = \"https://connorleech.info/\"\nlanguageCode = \"en-us\"\ntitle = \"Connor Leech\"\ntheme = \"ananke\"\n[permalinks]\n  posts = \"blog/:title\"\n</code></pre>\n"}], "owner": {"reputation": 14976, "user_id": 2031033, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/88ce5a1f961832585f329292d22451fc?s=128&d=identicon&r=PG", "display_name": "Connor Leech", "link": "https://stackoverflow.com/users/2031033/connor-leech"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 897, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1577580070, "creation_date": 1577578260, "question_id": 59515945, "link": "https://stackoverflow.com/questions/59515945/how-do-i-change-the-default-url-posts-routing-in-a-hugo-site", "title": "How do I change the default url &quot;/posts/&quot; routing in a Hugo site?", "body": "<p>I have created a new Hugo project. By default the urls route to <code>mysite.com/posts/my-first-post</code>. However I'm deploying to an existing domain where the url path for the posts is <code>mysite.com/blog/my-first-post</code>. How can I configure Hugo to go to /blog instead of /posts when view individual blog posts?</p>\n\n<p>I've tried adding:</p>\n\n<pre><code>[permalinks]\n    post = \"/blog/:slug\"\n</code></pre>\n\n<p>To my <strong>config.toml</strong> file and then running <code>hugo server --disableFastRender</code> so it looks for changes and restarted server but I haven't been able to change the url structure. How might I go about doing this? Currently running <a href=\"https://themes.gohugo.io/gohugo-theme-ananke/\" rel=\"nofollow noreferrer\">anake</a> theme.</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1577570725, "post_id": 59514634, "comment_id": 105202148, "body": "<a href=\"https://software.intel.com/en-us/blogs/2013/01/06/benign-data-races-what-could-possibly-go-wrong\" rel=\"nofollow noreferrer\">software.intel.com/en-us/blogs/2013/01/06/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 0, "creation_date": 1577567264, "post_id": 59514821, "comment_id": 105201383, "body": "Thank you, is there any go spec or any reference on tight loop?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 1, "creation_date": 1577568458, "post_id": 59514821, "comment_id": 105201628, "body": "There is this: <a href=\"https://github.com/golang/go/issues/10958\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/10958</a> Not a canonical reference, but it explains the issue."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1577708891, "last_edit_date": 1577708891, "creation_date": 1577566859, "answer_id": 59514821, "question_id": 59514634, "link": "https://stackoverflow.com/questions/59514634/is-it-concurrent-safe-to-use-tight-and-long-running-loops-in-go/59514821#59514821", "title": "Is it concurrent safe to use tight and long-running loops in Go?", "body": "<p>There is no guarantee that the busy-wait for loop will terminate even if <code>ok</code> is set to <code>false</code> by another goroutine. There is no explicit synchronization during the setting and reading of <code>ok</code>, so the main goroutine is not guaranteed to see the changes made to it. In other words, there is no way to establish a happened-before relationship between the two goroutines.</p>\n\n<p><a href=\"https://golang.org/ref/mem\" rel=\"nofollow noreferrer\">https://golang.org/ref/mem</a></p>\n\n<p>Second version of the code is safe even though it is not stated in the Go memory model with respect to <code>ok</code>, but it is not safe because such tight loops may not allow other goroutines to execute. Atomic read/write has the memory barriers necessary for a happened-before relationship. You should use one of the synchronization primitives (mutex, channel) to guarantee that. </p>\n"}], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 59514821, "answer_count": 1, "score": -2, "last_activity_date": 1603642654, "creation_date": 1577565146, "last_edit_date": 1603642654, "question_id": 59514634, "link": "https://stackoverflow.com/questions/59514634/is-it-concurrent-safe-to-use-tight-and-long-running-loops-in-go", "title": "Is it concurrent safe to use tight and long-running loops in Go?", "body": "<p>Is it concurrent safe (without race, without starving, and non-blocking) to use tight and long-running loops, like this?</p>\n<pre><code>    for atomic.LoadInt32(&amp;ok) != 0 {\n        i++\n    }\n</code></pre>\n<p><a href=\"https://play.golang.org/p/rlz6GxkmUa8\" rel=\"nofollow noreferrer\">Code</a>:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;runtime&quot;\n    &quot;sync/atomic&quot;\n    &quot;time&quot;\n)\n\nfunc main() {\n    fmt.Println(runtime.NumCPU())             // 8\n    fmt.Println(runtime.Version())            // go1.15.3\n    fmt.Println(runtime.GOOS, runtime.GOARCH) // linux amd64\n\n    i := uint64(0)\n    ok := int32(1)\n\n    time.AfterFunc(1000*time.Millisecond, func() {\n        atomic.StoreInt32(&amp;ok, 0)\n    })\n\n    for atomic.LoadInt32(&amp;ok) != 0 {\n        i++\n    }\n\n    fmt.Println(i) // 2_827_768_686 on go version go1.15.3 linux/amd64\n}\n</code></pre>\n<p><strong>Edit</strong>: <a href=\"https://golang.org/doc/go1.14#runtime\" rel=\"nofollow noreferrer\">go1.14</a></p>\n<p>Goroutines are now <strong>asynchronously preemptible</strong>. As a result, loops without function calls no longer potentially deadlock the scheduler or significantly delay garbage collection. This is supported on all platforms except windows/arm, darwin/arm, js/wasm, and plan9/*.</p>\n"}, {"tags": ["go", "ssl", "tls1.2"], "comments": [{"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1577575748, "post_id": 59514126, "comment_id": 105202985, "body": "When you say &quot;many requests/second from a few sources,&quot; do you mean that a few sources are holding their TLS connections and reusing them, or that those sources are generating a new TLS session for every request. Every time you negotiate a new TLS session, that&#39;s very expensive, even if it&#39;s a source you&#39;ve seen before (that doesn&#39;t really have much impact). If you only have a few sources, they should reuse their sessions."}, {"owner": {"reputation": 1, "user_id": 12615471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6407265fbba5a130114629ec1b641b55?s=128&d=identicon&r=PG&f=1", "display_name": "ManOnPoint", "link": "https://stackoverflow.com/users/12615471/manonpoint"}, "reply_to_user": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1577580996, "post_id": 59514126, "comment_id": 105203735, "body": "Thanks. I suspect that this is what my be happening with Siege (not reusing connections often enough even though I did set connection to keep-alive (both keep-alive and close in the siegerc didnt make a difference) but I don&#39;t actually know what it&#39;s doing. Yes, in practice a few clients will each be making many requests per second to the api. I will note that the average response time was something like 7ms (it&#39;s around 2ms with http) so it&#39;s definitely not doing a whole handshake EVERY request, but there&#39;s something I&#39;m missing or doing wrong."}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1577581817, "post_id": 59514126, "comment_id": 105203851, "body": "You will need to explore this on the client and server side, and watch the network traffic. I&#39;m not familiar with Siege particularly. Ideally you&#39;d move this to HTTP/2, which supports multiplexing over a single TLS connection. In HTTP/1.1, you will need to make sure that you pipeline your requests. If all the current connections are busy, you may have it configured to create a new connection (which is expensive) rather than wait for an existing connection to become available. This is a complex topic, and not trivial to address in this kind of Q&amp;A format."}, {"owner": {"reputation": 1, "user_id": 12615471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6407265fbba5a130114629ec1b641b55?s=128&d=identicon&r=PG&f=1", "display_name": "ManOnPoint", "link": "https://stackoverflow.com/users/12615471/manonpoint"}, "reply_to_user": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1577582127, "post_id": 59514126, "comment_id": 105203882, "body": "Thanks. Makes sense I&#39;ll dig into it more. I mostly wanted to make sure there wasn&#39;t something obvious I was missing."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 12615471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6407265fbba5a130114629ec1b641b55?s=128&d=identicon&r=PG&f=1", "display_name": "ManOnPoint", "link": "https://stackoverflow.com/users/12615471/manonpoint"}, "edited": false, "score": 0, "creation_date": 1577567298, "post_id": 59514187, "comment_id": 105201391, "body": "thanks, but on second thought, my code is doing quite a lot between requests (looking up multiple values in redis, doing some string manipulation and computation), I can&#39;t imagine the packet encoding is adding that much overhead?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1577575541, "post_id": 59514187, "comment_id": 105202952, "body": "Using an external proxy doesn&#39;t improve that situation at all. It only moves it. In fact, it may hurt the situation."}, {"owner": {"reputation": 4551, "user_id": 2908599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Df1FU.jpg?s=128&g=1", "display_name": "Romeo Ninov", "link": "https://stackoverflow.com/users/2908599/romeo-ninov"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577593044, "post_id": 59514187, "comment_id": 105205030, "body": "@Flimzy, proxy can be on external machine."}, {"owner": {"reputation": 4551, "user_id": 2908599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Df1FU.jpg?s=128&g=1", "display_name": "Romeo Ninov", "link": "https://stackoverflow.com/users/2908599/romeo-ninov"}, "reply_to_user": {"reputation": 1, "user_id": 12615471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6407265fbba5a130114629ec1b641b55?s=128&d=identicon&r=PG&f=1", "display_name": "ManOnPoint", "link": "https://stackoverflow.com/users/12615471/manonpoint"}, "edited": false, "score": 0, "creation_date": 1577599043, "post_id": 59514187, "comment_id": 105205703, "body": "@ManOnPoint, we talk about encryption and this always is quite heavy operation."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577612908, "post_id": 59514187, "comment_id": 105207760, "body": "@RomeoNinov: Of course it can. But that still just moves the problem."}, {"owner": {"reputation": 4551, "user_id": 2908599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Df1FU.jpg?s=128&g=1", "display_name": "Romeo Ninov", "link": "https://stackoverflow.com/users/2908599/romeo-ninov"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577613347, "post_id": 59514187, "comment_id": 105207863, "body": "@Flimzy, SSL/TLS cost CPU power, this is cryptography :)"}, {"owner": {"reputation": 1, "user_id": 12615471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6407265fbba5a130114629ec1b641b55?s=128&d=identicon&r=PG&f=1", "display_name": "ManOnPoint", "link": "https://stackoverflow.com/users/12615471/manonpoint"}, "edited": false, "score": 0, "creation_date": 1577635931, "post_id": 59514187, "comment_id": 105213061, "body": "@romeoNinov, more power than doing multiple string.contains and splitting calls, pulling up 10 or so redis keys over intranet (elasticache) and doing other computations and logic, per each request to server  vs encoding around 200 bytes response? Seems unlikely . I will try to profile this later or find a better benchmark that uses http/2"}, {"owner": {"reputation": 4551, "user_id": 2908599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Df1FU.jpg?s=128&g=1", "display_name": "Romeo Ninov", "link": "https://stackoverflow.com/users/2908599/romeo-ninov"}, "reply_to_user": {"reputation": 1, "user_id": 12615471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6407265fbba5a130114629ec1b641b55?s=128&d=identicon&r=PG&f=1", "display_name": "ManOnPoint", "link": "https://stackoverflow.com/users/12615471/manonpoint"}, "edited": false, "score": 0, "creation_date": 1577636430, "post_id": 59514187, "comment_id": 105213176, "body": "@ManOnPoint, sure, make your profiling. And post here the result."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577651081, "post_id": 59514187, "comment_id": 105217030, "body": "@RomeoNinov: Yes, And putting them on another server <i>still</i> costs CPU power. This is common sense."}], "tags": [], "owner": {"reputation": 4551, "user_id": 2908599, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Df1FU.jpg?s=128&g=1", "display_name": "Romeo Ninov", "link": "https://stackoverflow.com/users/2908599/romeo-ninov"}, "is_accepted": false, "score": 1, "last_activity_date": 1577575519, "last_edit_date": 1577575519, "creation_date": 1577561205, "answer_id": 59514187, "question_id": 59514126, "link": "https://stackoverflow.com/questions/59514126/listenandserve-vs-listenandservetls-speed/59514187#59514187", "title": "ListenAndServe vs ListenAndServeTLS Speed", "body": "<p>When using SSL/TLS your program needs to encode, decode each message sent or received, and this consumes CPU power. You may try to add http/https proxy which will terminate the SSL/TLS traffic. This can be apache http, nginx, haproxy. This can improve the situation.</p>\n"}], "owner": {"reputation": 1, "user_id": 12615471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6407265fbba5a130114629ec1b641b55?s=128&d=identicon&r=PG&f=1", "display_name": "ManOnPoint", "link": "https://stackoverflow.com/users/12615471/manonpoint"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1577575519, "creation_date": 1577560666, "question_id": 59514126, "link": "https://stackoverflow.com/questions/59514126/listenandserve-vs-listenandservetls-speed", "title": "ListenAndServe vs ListenAndServeTLS Speed", "body": "<p>I'm building an API that will be hit with many requests/second from a few sources (call it 1000/sec) and will be responding to each quickly with very little information (think &lt; 1k). </p>\n\n<p>When I use HTTP (<code>http.ListenAndServe()</code>), performance is between 1000-2000 req/sec using Siege on my t3.micro and CPU usage rarely exceeds 30-40%</p>\n\n<p>With HTTPS (<code>http.ListenAndServeTLS()</code>), I cap at around 450 req/sec with CPU usage at 100%. It seems pretty obvious it's doing a lot of SSL handshake type work, but my question is why would this be the case? Even with few concurrent connections from Siege it is much slower (I also tried connection=keep-alive in siege config)</p>\n\n<p>I get that the first connection should be slower, but after that, is this behavior still expected or is there some issue I am not aware of? One thing I noticed is Siege is using HTTP/1.1, I would think it should be using 2.0 when going over HTTPS?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1577555156, "post_id": 59513341, "comment_id": 105198481, "body": "See <a href=\"https://stackoverflow.com/a/58983312/1705598\">mongo-go-driver aggregate query always return &quot;Current&quot;: null</a>"}, {"owner": {"reputation": 1391, "user_id": 6657842, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0arXm.jpg?s=128&g=1", "display_name": "RLD", "link": "https://stackoverflow.com/users/6657842/rld"}, "edited": false, "score": 0, "creation_date": 1577564065, "post_id": 59513341, "comment_id": 105200709, "body": "Your query and result are not in synch. Revisit the query."}], "answers": [{"tags": [], "owner": {"reputation": 96, "user_id": 11670343, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VrFDk.png?s=128&g=1", "display_name": "Roshan Patil", "link": "https://stackoverflow.com/users/11670343/roshan-patil"}, "is_accepted": true, "score": 1, "last_activity_date": 1577595899, "creation_date": 1577595899, "answer_id": 59516986, "question_id": 59513341, "link": "https://stackoverflow.com/questions/59513341/how-to-perform-aggregations-in-go-using-mongo-driver/59516986#59516986", "title": "How to perform aggregations in Go using mongo-driver", "body": "<pre><code>group :=[]bson.M{bson.M{\n    \"$group\": bson.M{\n        \"_id\":bson.M{\n            \"field1\": \"$field1\",\n            \"field2\": \"$field2\"\n        }\n    }\n},\nbson.M {\n    \"$group\": bson.M{\n        \"_id\":nil,\n        \"count\": bson.M{\n            \"$sum\":1\n        }\n    }\n}\n} \n\ncursor, err := coll.Aggregate(context.Background(), mongo.Pipeline{group})\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>Try the above solution, It will works.</p>\n"}, {"tags": [], "owner": {"reputation": 1074, "user_id": 9363929, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FS1lH1f5mjo/AAAAAAAAAAI/AAAAAAAAAAc/xLut-sRzp-0/photo.jpg?sz=128", "display_name": "miqrc", "link": "https://stackoverflow.com/users/9363929/miqrc"}, "is_accepted": false, "score": 0, "last_activity_date": 1577614874, "creation_date": 1577614874, "answer_id": 59518517, "question_id": 59513341, "link": "https://stackoverflow.com/questions/59513341/how-to-perform-aggregations-in-go-using-mongo-driver/59518517#59518517", "title": "How to perform aggregations in Go using mongo-driver", "body": "<p>To complement the accepted solution I am sharing the full code with the cursor iteration and decode. I changed the <code>\"_id\": nil</code> to <code>\"_id\": \"\"</code> to receive strings and be able to decode to a struct without issues.</p>\n\n<pre><code>pipeline := []bson.M{\n    {\n        \"$group\": bson.M{\"_id\": bson.M{\"field1\": \"$field1\", \"field2\": \"$field2\"}},\n    },\n    {\n        \"$group\": bson.M{\"_id\": \"\", \"count\": bson.M{\"$sum\": 1}},\n    },\n}\n\ncursor, err := coll.Aggregate(ctx, pipeline)\nif err != nil {\n    return err\n}\ntype Result struct {\n    ID    string `bson:\"_id\"`\n    Count int    `bson:\"count\"`\n}\nvar res Result\nfor cursor.Next(ctx) {\n    err := cursor.Decode(&amp;res)\n    if err != nil {\n        return err\n    }\n    fmt.Printf(\"Element %v\", res)\n}\n</code></pre>\n"}], "owner": {"reputation": 1074, "user_id": 9363929, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FS1lH1f5mjo/AAAAAAAAAAI/AAAAAAAAAAc/xLut-sRzp-0/photo.jpg?sz=128", "display_name": "miqrc", "link": "https://stackoverflow.com/users/9363929/miqrc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 59516986, "answer_count": 2, "score": 0, "last_activity_date": 1577614874, "creation_date": 1577554787, "question_id": 59513341, "link": "https://stackoverflow.com/questions/59513341/how-to-perform-aggregations-in-go-using-mongo-driver", "title": "How to perform aggregations in Go using mongo-driver", "body": "<p>I have a MongoDB collection with 3 fields:</p>\n\n<pre><code>_id: ObjectId\nfield1: Number\nfield2: Number\n</code></pre>\n\n<p>I am doing this aggregation to get \"distinct\" field1/field2 rows and doing a total count of the results. This works OK in the client (Robo3t):</p>\n\n<pre><code>db.mycollection.aggregate([\n    {\n        $group: { \n            _id: { field1: \"$field1\", field2: \"$field2\" },\n        }\n    },\n    { \n        $group: { \n            _id: null, count: { $sum: 1 } \n        } \n    }\n])\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>{\n    \"_id\" : null,\n    \"count\" : 57.0\n}\n</code></pre>\n\n<p><strong>How could I do this aggregation in Go using <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo\" rel=\"nofollow noreferrer\">mongo-driver</a>?</strong></p>\n\n<p>There is <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo#Collection.Aggregate\" rel=\"nofollow noreferrer\">this</a> method to perform aggregations but the documentation is not clear to me. I understand that I should do some kind of bson query but I don't know where to start.</p>\n"}, {"tags": ["go", "unix", "terminal", "pty", "terminal-emulator"], "answers": [{"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": false, "score": 1, "last_activity_date": 1577599622, "creation_date": 1577599622, "answer_id": 59517233, "question_id": 59512763, "link": "https://stackoverflow.com/questions/59512763/get-previous-input-form-a-pseudo-terminal/59517233#59517233", "title": "Get previous input form a pseudo terminal", "body": "<p>Offsets will not help you.  The problem is that a pty is a channel-like device with no memory: once data have flowed <em>through</em> the pty, from one end to the other, and been consumed by a reader, those data are gone.  The OS's seek offset is not relevant.</p>\n\n<p>If you want to maintain a log of all data exchanged, you'll have to do that yourself.</p>\n"}], "owner": {"reputation": 132, "user_id": 8290819, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/1ba7cbb1dc3db9c1bb81319972768bbb?s=128&d=identicon&r=PG&f=1", "display_name": "Fransebas", "link": "https://stackoverflow.com/users/8290819/fransebas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 107, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1577599622, "creation_date": 1577550904, "last_edit_date": 1577551436, "question_id": 59512763, "link": "https://stackoverflow.com/questions/59512763/get-previous-input-form-a-pseudo-terminal", "title": "Get previous input form a pseudo terminal", "body": "<p>I have a program that uses <a href=\"https://github.com/creack/pty\" rel=\"nofollow noreferrer\">https://github.com/creack/pty</a> to create pseudo terminals. How it works it's that I given a command - in this case is <code>bash -i</code> - it creates a file object where you can read and write and it will work as <code>stdin</code> and <code>stdout</code>, with that I'm continuously reading the file and sending the data to a client. This works fine but when another client connects, it will only receive the data after she connects wich is not desirable.</p>\n\n<p>Normal client behavior:</p>\n\n<pre><code>computer:~$ \ncomputer:~$\ncomputer:~$\ncomputer:~$\ncomputer:~$ echo \"a\"\na\ncomputer:~$\n</code></pre>\n\n<p>Second client connects after client 1 typed c:</p>\n\n<pre><code>ho \"a\"\na\ncomputer:~$\n</code></pre>\n\n<p>As you can see this is problematic because client 2 it's going to have truncated input, the desired behaviour would be to send all the history or cache state.</p>\n\n<p>I tried reading the file using <code>file.ReadAt(b, 0)</code> which read the file starting at offset 0 and stores the result in <code>b</code> but I get <code>ENXIO: 6 - No such device or address</code> I think this happens because the file is not really a file. What I'm currently doing is storing all output data into a buffer and when a new client connects I send the stored buffer but It's not a complete solution because if client one uses <code>clear</code> or if it uses a command that messed up with the terminal like <code>vi</code> or <code>nano</code> the buffer doesn't adapts it only stores the output.</p>\n\n<p>I'm using GO but I think this problem is not related that much with a specific language so if you have an answer in C or something, I can see it and try to find the equivalent in GO. In any case here is the GO code I'm using.</p>\n\n<p>Initialization:</p>\n\n<pre><code>c := exec.Command(\"bash\", \"-i\")\n\n// Start the command with a pty.\nptmx, err := pty.Start(c) // ptmx is of type *os.File\n</code></pre>\n\n<p>Reading:</p>\n\n<pre><code>// this gets called in a while true loop\nfunc (t *Terminal) Read(b []byte) (int, error) {\n    n, e := t.ptmx.Read(b)\n    for _, byt := range b {\n        t.buffer.Insert(byt)\n    }\n    return n, e\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1592, "user_id": 9211949, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Pny8Y.png?s=128&g=1", "display_name": "CoderCharmander", "link": "https://stackoverflow.com/users/9211949/codercharmander"}, "edited": false, "score": 2, "creation_date": 1577550389, "post_id": 59512688, "comment_id": 105197162, "body": "<code>byte</code> returns the ASCII value of the character. If your case, it&#39;s 48."}, {"owner": {"reputation": 52685, "user_id": 980550, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/8emhY.jpg?s=128&g=1", "display_name": "lurker", "link": "https://stackoverflow.com/users/980550/lurker"}, "edited": false, "score": 4, "creation_date": 1577550390, "post_id": 59512688, "comment_id": 105197163, "body": "The byte value of <code>&#39;0&#39;</code> is 48 (decimal). You the value <code>0</code> isn&#39;t printable as a visible character. In C, the character <code>&#39;0&#39;</code> is <i>not</i> equal to the number 0. It&#39;s 48 in C as well. It&#39;s unclear why you believe otherwise."}, {"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 1, "creation_date": 1577550665, "post_id": 59512688, "comment_id": 105197234, "body": "As lurker mentioned: this is expected in both languages. Try the following in C: <code>printf(&quot;char: %c, int: %d\\n&quot;, &#39;0&#39;, &#39;0&#39;);</code>. The first is printing the character representation (<code>&#39;0&#39;</code>), the second is printing its integer value (<code>48</code>)."}, {"owner": {"reputation": 158, "user_id": 8451478, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49358a2db456a97db528bc6a459c8049?s=128&d=identicon&r=PG&f=1", "display_name": "ideoutrea", "link": "https://stackoverflow.com/users/8451478/ideoutrea"}, "reply_to_user": {"reputation": 52685, "user_id": 980550, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/8emhY.jpg?s=128&g=1", "display_name": "lurker", "link": "https://stackoverflow.com/users/980550/lurker"}, "edited": false, "score": 0, "creation_date": 1577551302, "post_id": 59512688, "comment_id": 105197413, "body": "@lurker yeah, I read the ascii table again, &#39;0&#39; equal to 48 !! thanks"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1577551570, "last_edit_date": 1577551570, "creation_date": 1577550746, "answer_id": 59512743, "question_id": 59512688, "link": "https://stackoverflow.com/questions/59512688/char-0-not-equal-to-int-0/59512743#59512743", "title": "Char &#39;0&#39; not equal to int 0?", "body": "<p>This is how the <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\"><code>fmt</code></a> package works. <a href=\"https://golang.org/pkg/fmt/#Println\" rel=\"nofollow noreferrer\"><code>fmt.Println()</code></a> will use the <em>default</em> format for its arguments, which is <code>%d</code> for integer values (such as <code>byte</code>, <code>int</code> etc., and even for <code>rune</code>) which means to print its numerical base 10 representation. <code>'0'</code> is a <a href=\"https://golang.org/ref/spec#Rune_literals\" rel=\"nofollow noreferrer\">rune literal</a>, when passed to <code>fmt.Println()</code> it will take the type <code>rune</code> which is an alias for <code>int32</code>, so it's an integer value, it has decimal value <code>48</code>.</p>\n\n<pre><code>fmt.Println('0', rune('0'), byte('0'))\n</code></pre>\n\n<p>This prints:</p>\n\n<pre><code>48 48 48\n</code></pre>\n\n<p>If you want to print the character, convert it to <code>string</code>, or use a format string with <code>%c</code> verb:</p>\n\n<pre><code>fmt.Println(string('0'))\nfmt.Printf(\"%c\", '0')\n</code></pre>\n\n<p>This prints:</p>\n\n<pre><code>0\n0\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/CX79GPOIwAl\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>See related: <a href=\"https://stackoverflow.com/questions/29914662/equivalent-of-pythons-ord-chr-in-go\">Equivalent of python&#39;s ord(), chr() in go?</a></p>\n"}, {"tags": [], "owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "is_accepted": false, "score": 1, "last_activity_date": 1577550756, "creation_date": 1577550756, "answer_id": 59512744, "question_id": 59512688, "link": "https://stackoverflow.com/questions/59512688/char-0-not-equal-to-int-0/59512744#59512744", "title": "Char &#39;0&#39; not equal to int 0?", "body": "<blockquote>\n  <p>in c char '0' always equal to number 0, please explain this to me, or I'm totally wrong !</p>\n</blockquote>\n\n<p>You're totally wrong :P . Here's the C equivalent of your code.  </p>\n\n<pre><code>$ cat t.c\n#include &lt;stdio.h&gt;\n\nint main() {\n  printf(\"%d\\n\",'0');\n}\n\n$ gcc -o tc t.c &amp;&amp; ./tc\n48\n</code></pre>\n\n<p>However, if you specifically <em>tell</em> <code>printf</code> to interpret '0' as a character, you'll get  a literal <code>0</code>, - its binary representation is decimal 48.</p>\n\n<pre><code>$ cat t.c\n#include &lt;stdio.h&gt;\n\nint main() {\n  printf(\"%d %c %c\\n\", '0', '0', 48);\n}\n\n$ gcc -o tc t.c &amp;&amp; ./tc\n48 0 0\n</code></pre>\n"}], "owner": {"reputation": 158, "user_id": 8451478, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49358a2db456a97db528bc6a459c8049?s=128&d=identicon&r=PG&f=1", "display_name": "ideoutrea", "link": "https://stackoverflow.com/users/8451478/ideoutrea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "closed_date": 1577645659, "answer_count": 2, "score": -5, "last_activity_date": 1577575855, "creation_date": 1577550311, "last_edit_date": 1577575855, "question_id": 59512688, "link": "https://stackoverflow.com/questions/59512688/char-0-not-equal-to-int-0", "closed_reason": "Not suitable for this site", "title": "Char &#39;0&#39; not equal to int 0?", "body": "<pre><code>package main\n\nimport \"fmt\"\nfunc  main() {\n   fmt.Println(byte('0'))\n\n}\n</code></pre>\n\n<p>why run this code On Mac which print <strong>48</strong>, not <strong>0</strong> ? <br>\nin c char '0' always equal to number 0, please explain this to me, or I'm totally wrong !  </p>\n"}, {"tags": ["debugging", "go", "visual-studio-code", "aws-sam"], "answers": [{"tags": [], "owner": {"reputation": 126, "user_id": 9013693, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zAN81.png?s=128&g=1", "display_name": "Rob S.", "link": "https://stackoverflow.com/users/9013693/rob-s"}, "is_accepted": false, "score": 2, "last_activity_date": 1578930063, "creation_date": 1578930063, "answer_id": 59719759, "question_id": 59512329, "link": "https://stackoverflow.com/questions/59512329/how-to-debug-application-made-by-aws-sam-in-vscode/59719759#59719759", "title": "How to debug application made by AWS SAM in VSCode?", "body": "<p>The <code>reading debug_info: could not find abstract origin</code> line tells us that the compile flags got scrambled and the debug info was not actually included. What we  need is:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>GOOS=linux GOARCH=amd64 go build -gcflags \"all=-N -l\" -o hello-world/hello-world ./hello-world\n</code></pre>\n\n<p>Second, VSCode should tell you this, but in <code>launch.json</code>, <code>\"request\": \"launch\",</code> is now <code>\"request\": \"attach\",</code> for mode <code>remote</code> giving:</p>\n\n<pre><code>{\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n        {\n            \"name\": \"Connect to SAM local\",\n            \"type\": \"go\",\n            \"request\": \"attach\",\n            \"mode\": \"remote\",\n            \"remotePath\": \"\",\n            \"port\": 5986,\n            \"host\": \"127.0.0.1\",\n            \"program\": \"${workspaceRoot}\",\n            \"env\": {},\n            \"args\": []\n        }\n    ]\n}\n</code></pre>\n\n<p>With the above changes you should be able to attach to the debug server using VSCode (or GoLand/Vim/CLI).</p>\n\n<p>Finally, the <code>Could not create config directory: mkdir /home/sbx_user1051: permission denied.</code> line is safe to ignore.</p>\n\n<blockquote>\n  <p>I am contributing this on behalf of my employer, Amazon. My contribution is licensed under the MIT license. See <a href=\"https://aws-preview.aka.amazon.com/tools/stackoverflow-samples-license/\" rel=\"nofollow noreferrer\">here</a> for a more detailed explanation.</p>\n</blockquote>\n"}], "owner": {"reputation": 43, "user_id": 11960653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8c3a877ea3dc694f1690f2208da595b?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v2", "link": "https://stackoverflow.com/users/11960653/jpskgc-v2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 863, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1578930063, "creation_date": 1577547751, "last_edit_date": 1577582890, "question_id": 59512329, "link": "https://stackoverflow.com/questions/59512329/how-to-debug-application-made-by-aws-sam-in-vscode", "title": "How to debug application made by AWS SAM in VSCode?", "body": "<h3>Summary</h3>\n\n<p>I made Go application by AWS SAM. Now I try to debug this sample application in VSCode, but It fails so I want to know how to correctly debug it.</p>\n\n<h3>Tried</h3>\n\n<pre><code>toggl-slack\n\u251c\u2500\u2500 Makefile                    \n\u251c\u2500\u2500 README.md     \n\u251c\u2500\u2500 dlv \n\u251c\u2500\u2500 samconfig.toml               \n\u251c\u2500\u2500 hello-world                \n\u2502   \u251c\u2500\u2500 main.go                 \n\u2502   \u2514\u2500\u2500 main_test.go            \n\u2514\u2500\u2500 template.yaml\n</code></pre>\n\n<p>I put following command on console for debug.</p>\n\n<pre><code>cd toggl-slack\ngo get -u github.com/go-delve/delve/cmd/dlv\nGOARCH=amd64 GOOS=linux go build -o ./dlv github.com/go-delve/delve/cmd/dlv\nGOARCH=amd64 GOOS=linux go build -gcflags='-N -l' -o hello-world/hello-world ./hello-world\nsam local start-api -d 5986 --debugger-path . --debug-args=\"-delveAPI=2\"\ncurl http://127.0.0.1:3000/hello\n</code></pre>\n\n<p>As result, debug does not work and console shows error message.</p>\n\n<pre><code>Mounting HelloWorldFunction at http://127.0.0.1:3000/hello [GET]\nYou can now browse to the above endpoints to invoke your functions. You do not need to restart/reload SAM CLI while working on your functions, changes will be reflected instantly/automatically. You only need to restart SAM CLI if you update your AWS SAM template\n2019-12-28 21:23:17  * Running on http://127.0.0.1:3000/ (Press CTRL+C to quit)\nInvoking hello-world (go1.x)\n\nFetching lambci/lambda:go1.x Docker container image......\nMounting /Users/jpskgc/toggl-slack/hello-world as /var/task:ro,delegated inside runtime container\nCould not create config directory: mkdir /home/sbx_user1051: permission denied.API server listening at: [::]:5986\n2019-12-28T12:23:46Z info layer=debugger launching process with args: [/var/task/hello-world]\n2019-12-28T12:23:47Z warning layer=debugger reading debug_info: could not find abstract origin (0x13ed31) of inlined call at 0xfab50\n</code></pre>\n\n<h3>Codes</h3>\n\n<p>launch.json</p>\n\n<pre><code>{\n  \"version\": \"0.2.0\",\n  \"configurations\": [\n    {\n      \"name\": \"Connect to Lambda container\",\n      \"type\": \"go\",\n      \"request\": \"launch\",\n      \"mode\": \"remote\",\n      \"remotePath\": \"\",\n      \"port\": 5986,\n      \"host\": \"127.0.0.1\",\n      \"program\": \"${workspaceRoot}\",\n      \"env\": {},\n      \"args\": []\n    }\n  ]\n}\n</code></pre>\n\n<p>Other code is same as default sample application for AWS SAM.</p>\n\n<p>Full Source Code is here:<br>\n<a href=\"https://github.com/jpskgc/toggl-slack/tree/0db02109685ce89f17ed64fdaadd5261e5f61512\" rel=\"nofollow noreferrer\">https://github.com/jpskgc/toggl-slack/tree/0db02109685ce89f17ed64fdaadd5261e5f61512</a></p>\n"}, {"tags": ["sqlite", "go", "go-gorm"], "comments": [{"owner": {"reputation": 29795, "user_id": 720030, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38ed0a5a78d65824827fb112e8e716f8?s=128&d=identicon&r=PG", "display_name": "karmakaze", "link": "https://stackoverflow.com/users/720030/karmakaze"}, "edited": false, "score": 1, "creation_date": 1577548527, "post_id": 59512148, "comment_id": 105196659, "body": "Does <code>cxn:=&quot;file:memdb1?mode=memory&amp;cache=shared&quot;</code> as described at  <a href=\"https://www.sqlite.org/inmemorydb.html#temp_db\" rel=\"nofollow noreferrer\">sqllite.org</a> work?"}], "answers": [{"tags": [], "owner": {"reputation": 35177, "user_id": 125380, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4c2e7e7267110bb949cbe4aac47190f2?s=128&d=identicon&r=PG", "display_name": "User1", "link": "https://stackoverflow.com/users/125380/user1"}, "is_accepted": true, "score": 0, "last_activity_date": 1577549612, "creation_date": 1577549612, "answer_id": 59512587, "question_id": 59512148, "link": "https://stackoverflow.com/questions/59512148/how-to-have-two-gorm-sessions-to-the-same-in-memory-database/59512587#59512587", "title": "How to have two GORM sessions to the same in-memory database?", "body": "<p>This worked:  <code>cxn:=\"file:memdb1?mode=memory&amp;cache=shared\"</code></p>\n\n<p>Thanks for the comment from @karmakaze.</p>\n"}], "owner": {"reputation": 35177, "user_id": 125380, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4c2e7e7267110bb949cbe4aac47190f2?s=128&d=identicon&r=PG", "display_name": "User1", "link": "https://stackoverflow.com/users/125380/user1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 308, "favorite_count": 0, "accepted_answer_id": 59512587, "answer_count": 1, "score": 0, "last_activity_date": 1577549612, "creation_date": 1577546384, "last_edit_date": 1577548276, "question_id": 59512148, "link": "https://stackoverflow.com/questions/59512148/how-to-have-two-gorm-sessions-to-the-same-in-memory-database", "title": "How to have two GORM sessions to the same in-memory database?", "body": "<p>I am trying to test GORM code.  The code paths open a new GORM session.  The first session adds data to GORM, the second session uses it.  When testing, it seems that GORM will forget the first session's data when using the in-memory parameter, <code>:memory:</code>.  I even tried the <code>cache=shared</code> option with no success.</p>\n\n<p>Here's an example test:</p>\n\n<pre><code>type testRecord struct{\n    ID string\n    Data string\n}\n\n\nfunc TestOpenGormTwice(t *testing.T){\n    cxn:=\":memory:?cache=shared\"\n    database, err := gorm.Open(\"sqlite3\", cxn)\n    assert.NoError(t, err)\n\n    err=database.CreateTable(&amp;testRecord{}).Error\n    assert.NoError(t, err)\n\n    err=database.Create(testRecord{\n        ID:   \"1\",\n        Data: \"abc\",\n    }).Error\n    assert.NoError(t, err)\n\n    tr:=testRecord{}\n    err=database.First(&amp;tr).Error\n    assert.NoError(t, err)\n\n    assert.True(t, database.HasTable(&amp;testRecord{}))\n\n    //Open :memory: again, hopefully it won't forget what was saved last time\n    database2, err := gorm.Open(\"sqlite3\", cxn)\n    assert.NoError(t, err)\n    assert.True(t, database2.HasTable(&amp;testRecord{}))\n}\n</code></pre>\n\n<p>The test fails at the last assert.True.  How can this code be changed to pass the last test?</p>\n\n<p>I also tried <code>cxn:=\"memdb1?mode=memory&amp;cache=shared\"</code>, it appeared to work, but in reality it is not going into an in-memory mode <a href=\"https://www.sqlite.org/inmemorydb.html#temp_db\" rel=\"nofollow noreferrer\">as described in the Sqlite docs</a>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1577536304, "post_id": 59510887, "comment_id": 105193626, "body": "So you want pagination?"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1577537182, "post_id": 59510887, "comment_id": 105193815, "body": "To get those extra rows to load dynamically, you&#39;ll need to handle a client-side event and perform an ajax call in the handler. The server-side (the part actually written in Go) can&#39;t know when the user scrolled all the way down"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1577537903, "post_id": 59510887, "comment_id": 105193981, "body": "No worries, had a quick look at how this stuff might work, and found the scroll event + a way to verify whether the client scrolled all the way down to the bottom of the page or not. Just add the AJAX call there, and it should be fairly simple to get this to work, if you&#39;re willing to do it yourself, otherwise like I said: there&#39;s a couple of plugins out there already"}], "answers": [{"tags": [], "owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "is_accepted": true, "score": 2, "last_activity_date": 1577537785, "last_edit_date": 1577537785, "creation_date": 1577537105, "answer_id": 59510999, "question_id": 59510887, "link": "https://stackoverflow.com/questions/59510887/displaying-data-dynamically-from-sql-database-with-golang-json-and-javascript/59510999#59510999", "title": "Displaying data dynamically from SQL database with Golang, JSON, and JavaScript", "body": "<p>Assuming what you're looking for is pagination, then the answer is quite simple, but it requires changes both on the client and the server side:</p>\n\n<p>Getting the data: You'll want the client-side to tell the server how big the batches of data should be (typically 10, 20, 30, 40, or 50 results per call, with a default value of 10).<br>\nThe second parameter you'll want from the client is to indicate how many results the client has already loaded on their end. </p>\n\n<p>With these two values, you'll be able to enrich the query to include a limit and offset value. The default offset being 0, and default limit being 10.</p>\n\n<p>That means the first query will look something like:</p>\n\n<pre><code>SELECT * FROM people LIMIT 10 OFFSET 0; \n</code></pre>\n\n<p>This is often shortened to <code>LIMIT 10;</code> or <code>LIMIT 0, 10;</code>.</p>\n\n<p>Now if the client scrolls down, to load the next 10 records, you'll want them to perform an AJAX call providing you the batch size, and the offset value (how many records are already displayed), then just plug in these values, and you'll get:</p>\n\n<pre><code>SELECT * FROM people LIMIT 10 OFFSET 10;\n</code></pre>\n\n<p>This query tells the DB to skip the first 10 results, and return the next 10. </p>\n\n<p>If you're using actual pages, another common way to handle this is to have the client provide the page size value, and the page number. For example: I want to see 20 people per page, and I want to jump directly from page 1 to page 5, the parameters passed to the server would be something like: <code>page_size=20&amp;page=5</code></p>\n\n<p>That means that I need a query that skips the first 80 records (20 times 4 pages), a trivial computation:</p>\n\n<pre><code>offset := pageNr * pageSize - pageSize // or (pageNr -1 ) * pageSize\n</code></pre>\n\n<p>For the query to be:</p>\n\n<pre><code>SELECT * FROM people LIMIT 20 OFFSET 80;\n</code></pre>\n\n<p>Some general tips:</p>\n\n<ul>\n<li>Avoid <code>SELECT *</code> as much as possible, always be explicit about the fields you select. Adding fields to a table is common, and using <code>select *</code> can result in exposing data you don't want people to see, or your code messing up because it can't handle new fields</li>\n<li>Specify the order for your data. Have a <code>created_at</code> field in your table, and sort by that value, or sort by name or whatever. If you don't sort the results in a particular way, how can you guarantee that the first 10 results will always be the same? If you can't guarantee that, why wouldn't it be possible that you're going to skip some records, and display others twice?</li>\n<li>Create a <code>People</code> type server-side that represents the records in the DB if you haven't already</li>\n</ul>\n\n<hr>\n\n<p>It's been quite a number of years since I've done any front-end work, but to know when you need to load more records, you'll want to write some JS that handles the <code>scroll</code> event. There's a number of plugins out there already, and my JS is most likely outdated, but here's an attempt (untested, and to be treated as pseudo-code):</p>\n\n<pre><code>document.querySelector('#person_container').addEventListener('scroll', (function(ls) {\n    var last = ls[ls.length-1] // last person already loaded\n    let batchSize = ls.length // IIRC, let is used instead of var now\n    // returning the actual handler\n    return function(e) {\n        // scroll reached bottom of the page\n        if ((window.innerHeight + window.scrollY) &gt;= document.body.offsetHeight) {\n            // make AJAX call with batchSize + offset, append new elements after last element\n        }\n    };\n}(document.querySelectorAll('.person_item')))\n</code></pre>\n"}], "owner": {"reputation": 1568, "user_id": 4239355, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/1062734612/picture?type=large", "display_name": "Zoltan King", "link": "https://stackoverflow.com/users/4239355/zoltan-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 59510999, "answer_count": 1, "score": 0, "last_activity_date": 1577538112, "creation_date": 1577536141, "last_edit_date": 1577538112, "question_id": 59510887, "link": "https://stackoverflow.com/questions/59510887/displaying-data-dynamically-from-sql-database-with-golang-json-and-javascript", "title": "Displaying data dynamically from SQL database with Golang, JSON, and JavaScript", "body": "<p>I have a Golang server that fetches all the rows from a database table.</p>\n\n<pre><code>SELECT * FROM people;\n</code></pre>\n\n<p>The fetched data is 'marshaled' into JSON:</p>\n\n<pre><code>json.NewEncoder(w).Encode(people)\n</code></pre>\n\n<p>JavaScript can fetch the rows through its Fetch API.</p>\n\n<p>Now let's say the database table has 10,000 rows but I only want to display as many rows as they fit on the screen.</p>\n\n<p>As I scroll the page I'd like more rows to be fetched dynamically from the database.</p>\n\n<p>Does the client need to send data to the server telling the server to fetch the JSON again with more data?</p>\n\n<p>I would be grateful for any suggestion. Thank you!</p>\n"}, {"tags": ["go", "go-gin"], "answers": [{"tags": [], "owner": {"reputation": 28098, "user_id": 86072, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/dd41ab60469c4ee32c957c97fc101b9d?s=128&d=identicon&r=PG", "display_name": "LeGEC", "link": "https://stackoverflow.com/users/86072/legec"}, "is_accepted": true, "score": 7, "last_activity_date": 1577525570, "last_edit_date": 1577525570, "creation_date": 1577525222, "answer_id": 59509628, "question_id": 59509505, "link": "https://stackoverflow.com/questions/59509505/c-json-gin-h-outputs-empty-objects/59509628#59509628", "title": "c.JSON gin.H{()} outputs empty objects", "body": "<p>Lowercase fields are considered private, and will not be serialized by the standard json serializer.</p>\n\n<p>Change the fields of your <code>alcoholDrink</code> type, so that they start with an uppercase letter :</p>\n\n<pre><code>type alcoholDrink struct {\n    Name             string\n    Description      string\n    NutritionsAmount string\n    Nutritions       map[string]string\n}\n</code></pre>\n\n<p>If you want to see lowercased names in the resulting json, you can add an annotation to each field :</p>\n\n<pre><code>type alcoholDrink struct {\n    Name             string    `json:\"name\"`\n    Description      string    `json:\"description\"`\n    NutritionsAmount string    `json:\"nutritionsAmount\"`\n    Nutritions       map[string]string   `json:\"nutritions\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 2782, "user_id": 2315443, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a6a38bc5fa524ee7b1e320312cc1e537?s=128&d=identicon&r=PG", "display_name": "Valor_", "link": "https://stackoverflow.com/users/2315443/valor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 846, "favorite_count": 0, "accepted_answer_id": 59509628, "answer_count": 1, "score": 2, "last_activity_date": 1577525570, "creation_date": 1577524048, "question_id": 59509505, "link": "https://stackoverflow.com/questions/59509505/c-json-gin-h-outputs-empty-objects", "title": "c.JSON gin.H{()} outputs empty objects", "body": "<p>I just started to learn GO(lang) in combination with Gin framework and I've decided that I will write some simple api for fetching data about alcohol drinks.</p>\n\n<p>My current problem is that api (get method on <code>http://localhost:8080/alcohol-drinks</code>) returns empty data object</p>\n\n<p>My code:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gin-gonic/gin\"\n)\n\ntype alcoholDrink struct {\n    name             string\n    description      string\n    nutritionsAmount string\n    nutritions       map[string]string\n}\n\nfunc main() {\n    r := gin.Default()\n    r.GET(\"/alcohol-drinks\", func(c *gin.Context) {\n\n        d := []alcoholDrink{\n            {\n                name:             \"Gin\",\n                description:      \"DescriptionGin is a distilled alcoholic drink that derives its predominant flavour from juniper berries. Gin is one of the broadest categories of spirits, all of various origins, styles, and flavour profiles, that revolve around juniper as a common ingredient\",\n                nutritionsAmount: \"per 100 grams\",\n                nutritions: map[string]string{\n                    \"Calories\":     \"263\",\n                    \"TotalFat\":     \"0 g\",\n                    \"Cholesterol\":  \"0 mg\",\n                    \"Sodium\":       \"2 mg\",\n                    \"Carbohydrate\": \"0 g\",\n                    \"Protein\":      \"0 g\",\n                },\n            },\n            {\n                name:             \"Vodka\",\n                description:      \"odka is a clear distilled alcoholic beverage with different varieties originating in Poland and Russia. It is composed primarily of water and ethanol, but sometimes with traces of impurities and flavorings.\",\n                nutritionsAmount: \"per 100 grams\",\n                nutritions: map[string]string{\n                    \"Calories\":     \"231\",\n                    \"TotalFat\":     \"0 g\",\n                    \"Cholesterol\":  \"0 mg\",\n                    \"Sodium\":       \"1 mg\",\n                    \"Carbohydrate\": \"0 g\",\n                    \"Protein\":      \"0 g\",\n                },\n            },\n        }\n\n        c.JSON(200, gin.H{\n            \"status\": \"OK\",\n            \"code\":   200,\n            \"data\":   d,\n        })\n\n    })\n    r.Run()\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/dQIIz.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/dQIIz.png\" alt=\"enter image description here\"></a></p>\n\n<p>The question is, what do I need to do with variable <code>d</code> so data will be outputted in browser?</p>\n"}, {"tags": ["pointers", "go", "struct", "slice", "composite-literals"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1577529451, "post_id": 59508966, "comment_id": 105192259, "body": "It&#39;s a pointer to book, of course, because you can&#39;t store anything else than that in a slice of pointer to book."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1577529654, "post_id": 59509463, "comment_id": 105192301, "body": "What does field access have to do with struct literals?"}, {"owner": {"reputation": 69, "user_id": 6610936, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KQHij.jpg?s=128&g=1", "display_name": "Artiko", "link": "https://stackoverflow.com/users/6610936/artiko"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1577540144, "post_id": 59509463, "comment_id": 105194496, "body": "hmm i think i got it wrong, i thought what he mean by literal is field, sorry"}], "tags": [], "owner": {"reputation": 69, "user_id": 6610936, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KQHij.jpg?s=128&g=1", "display_name": "Artiko", "link": "https://stackoverflow.com/users/6610936/artiko"}, "is_accepted": false, "score": 0, "last_activity_date": 1577529608, "last_edit_date": 1577529608, "creation_date": 1577523595, "answer_id": 59509463, "question_id": 59508966, "link": "https://stackoverflow.com/questions/59508966/slice-of-structs-behaviour/59509463#59509463", "title": "Slice of structs behaviour", "body": "<p><code>Does go auto convert composite literals inside a slice to pointers if I declare the slice as a pointer to a struct?</code></p>\n\n<p>it is default behavior of pointer to struct</p>\n\n<blockquote>\n  <p>To access the field X of a struct when we have the struct pointer p we could write (*p).X. However, that notation is cumbersome, so the language permits us instead to write just p.X, without the explicit dereference.</p>\n</blockquote>\n\n<p><a href=\"https://tour.golang.org/moretypes/4\" rel=\"nofollow noreferrer\">https://tour.golang.org/moretypes/4</a></p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1577549122, "last_edit_date": 1592644375, "creation_date": 1577542841, "answer_id": 59511712, "question_id": 59508966, "link": "https://stackoverflow.com/questions/59508966/slice-of-structs-behaviour/59511712#59511712", "title": "Slice of structs behaviour", "body": "<p>It will be a pointer to <code>book</code>, same as <code>&amp;book{1, &quot;Yellow moon&quot;}</code>, but the spec allows to elide the type and the <code>&amp;</code> operator, because it's obvious from the type.</p>\n<pre><code>var books = []*book {\n    {1, &quot;Yellow moon&quot;},  // This is the same as &amp;book{1, &quot;Yellow moon&quot;}\n}\n</code></pre>\n<p><a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">Spec: Composite literals:</a></p>\n<blockquote>\n<p>Within a composite literal of array, slice, or map type <code>T</code>, elements or map keys that are themselves composite literals may elide the respective literal type if it is identical to the element or key type of <code>T</code>. Similarly, elements or keys that are addresses of composite literals may elide the <code>&amp;T</code> when the element or key type is <code>*T</code>.</p>\n<pre><code>[][]Point{{{0, 1}, {1, 2}}}  // same as [][]Point{[]Point{Point{0, 1}, Point{1, 2}}}\n\n[2]*Point{{1.5, -3.5}, {}}   // same as [2]*Point{&amp;Point{1.5, -3.5}, &amp;Point{}}\n</code></pre>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 327, "user_id": 5177327, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oE7n0.png?s=128&g=1", "display_name": "Donutloop", "link": "https://stackoverflow.com/users/5177327/donutloop"}, "is_accepted": true, "score": 1, "last_activity_date": 1577565133, "creation_date": 1577565133, "answer_id": 59514632, "question_id": 59508966, "link": "https://stackoverflow.com/questions/59508966/slice-of-structs-behaviour/59514632#59514632", "title": "Slice of structs behaviour", "body": "<p>It is possible to define with and without type:</p>\n\n<p><a href=\"https://play.golang.org/p/CB2MDPDztrc\" rel=\"nofollow noreferrer\">https://play.golang.org/p/CB2MDPDztrc</a></p>\n"}], "owner": {"reputation": 307, "user_id": 5474221, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-DhllUtPCe88/AAAAAAAAAAI/AAAAAAAAAA8/oWjW4E8-KNE/photo.jpg?sz=128", "display_name": "Shubhang b", "link": "https://stackoverflow.com/users/5474221/shubhang-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 59514632, "answer_count": 3, "score": 0, "last_activity_date": 1577576127, "creation_date": 1577518207, "last_edit_date": 1577576127, "question_id": 59508966, "link": "https://stackoverflow.com/questions/59508966/slice-of-structs-behaviour", "title": "Slice of structs behaviour", "body": "<p>When we declare a slice of structs, but set the data type to a pointer to the struct, does go automatically convert the literals to pointers?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type book struct {\n    id int\n    name string\n}\n\nvar books = []*book {\n    {1, \"Yellow moon\"}, // ---&gt; Is this a pointer to book OR just book\n}\n</code></pre>\n"}, {"tags": ["go", "cpu", "channel"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1577508863, "post_id": 59508092, "comment_id": 105188990, "body": "SendDataToChannel should not have a default select case, it should block until it can send the data to the channel. Otherwise you either lose data or go through a busy loop."}, {"owner": {"reputation": 31, "user_id": 8241135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbc8faf42726241e29bae8273ab23376?s=128&d=identicon&r=PG&f=1", "display_name": "EricOlivier", "link": "https://stackoverflow.com/users/8241135/ericolivier"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1577509105, "post_id": 59508092, "comment_id": 105189030, "body": "@Not_a_Golfer In my case\uff0cthe SendDataIn should be non-blocking and the data can be discard\uff0c as I memtioned in the question"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1577509358, "post_id": 59508092, "comment_id": 105189065, "body": "Seems like you are just feeding your server more work than it can handle, but your code doesn&#39;t demonstrate what you&#39;re doing so it&#39;s hard to judge. What happens if you remove all the channel stuff? Just handle the requests and skip SendDataToChannel. Does it behave the same? If so (which is my guess) then the problem is that you are overflowing your capacity."}, {"owner": {"reputation": 31, "user_id": 8241135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbc8faf42726241e29bae8273ab23376?s=128&d=identicon&r=PG&f=1", "display_name": "EricOlivier", "link": "https://stackoverflow.com/users/8241135/ericolivier"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1577509847, "post_id": 59508092, "comment_id": 105189128, "body": "@Not_a_Golfer the server works fine without feeding and handle the channel. The sendDatatoChannel is more like a middleware in every request\uff0cwould not affect server\u2018s regular logic . The handleData is a gorouting started before the server start."}, {"owner": {"reputation": 31, "user_id": 8241135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbc8faf42726241e29bae8273ab23376?s=128&d=identicon&r=PG&f=1", "display_name": "EricOlivier", "link": "https://stackoverflow.com/users/8241135/ericolivier"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1577510023, "post_id": 59508092, "comment_id": 105189158, "body": "@Not_a_Golfer One interesting thing is that\uff0c even if I remove Dosomething .The cpu still increase infinitly. So I think is something about the loop maybe"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1577510802, "post_id": 59508092, "comment_id": 105189269, "body": "Well, your code doesn&#39;t reveal enough, remember the minimal reproducible example thing..."}, {"owner": {"reputation": 102, "user_id": 12603592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KXTp8.jpg?s=128&g=1", "display_name": "PatrickMahomes", "link": "https://stackoverflow.com/users/12603592/patrickmahomes"}, "edited": false, "score": 0, "creation_date": 1577511841, "post_id": 59508092, "comment_id": 105189377, "body": "How does this even compile? You declare TestChan to be type int then assign a chan int to it. As far as I know that isn&#39;t allowed in Go."}, {"owner": {"reputation": 31, "user_id": 8241135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbc8faf42726241e29bae8273ab23376?s=128&d=identicon&r=PG&f=1", "display_name": "EricOlivier", "link": "https://stackoverflow.com/users/8241135/ericolivier"}, "reply_to_user": {"reputation": 102, "user_id": 12603592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KXTp8.jpg?s=128&g=1", "display_name": "PatrickMahomes", "link": "https://stackoverflow.com/users/12603592/patrickmahomes"}, "edited": false, "score": 0, "creation_date": 1577512684, "post_id": 59508092, "comment_id": 105189478, "body": "@PatrickMahomes slip\uff0c edited"}, {"owner": {"reputation": 114, "user_id": 3464082, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09516fd5e14b754405f97fadfd0757b?s=128&d=identicon&r=PG&f=1", "display_name": "bgnfu7re", "link": "https://stackoverflow.com/users/3464082/bgnfu7re"}, "edited": false, "score": 0, "creation_date": 1577526250, "post_id": 59508092, "comment_id": 105191610, "body": "Need a minimal working example here. <code>SendDataToChannel</code> function doesn&#39;t make sense -- it is equally as writing <code>TestChan &lt;- dataIn</code>. From the problem, I understand that there is a tight loop somewhere eating up CPU.  To drop messages on the floor it is possible to create a buffered channel and if it is full, then return early."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1577585416, "post_id": 59508092, "comment_id": 105204242, "body": "Sleeping before checking the channel seems unnecessary. <code>tmpData := &lt;- TestChan</code> will block until there is data on <code>TestChan</code>. Channels were made for this. <a href=\"https://gist.github.com/schwern/921c17face323cc91317204383f6d222\" rel=\"nofollow noreferrer\">Example</a>"}, {"owner": {"reputation": 31, "user_id": 8241135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbc8faf42726241e29bae8273ab23376?s=128&d=identicon&r=PG&f=1", "display_name": "EricOlivier", "link": "https://stackoverflow.com/users/8241135/ericolivier"}, "reply_to_user": {"reputation": 114, "user_id": 3464082, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09516fd5e14b754405f97fadfd0757b?s=128&d=identicon&r=PG&f=1", "display_name": "bgnfu7re", "link": "https://stackoverflow.com/users/3464082/bgnfu7re"}, "edited": false, "score": 0, "creation_date": 1577585897, "post_id": 59508092, "comment_id": 105204296, "body": "@bgnfu7re not really\uff0cIn this case\uff0c the qps of Senddata is much  more than handle. Since  the Dosomething\uff08call other downstream server\uff09  in handle func is in a qps limitation\uff0c and the data which send to Senddata func can be discarded\uff0c I use select default in Senddata func and non-buffered channel.  Then using Sleep in Handle func to control the qps to downstream."}, {"owner": {"reputation": 31, "user_id": 8241135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbc8faf42726241e29bae8273ab23376?s=128&d=identicon&r=PG&f=1", "display_name": "EricOlivier", "link": "https://stackoverflow.com/users/8241135/ericolivier"}, "reply_to_user": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 0, "creation_date": 1577585979, "post_id": 59508092, "comment_id": 105204302, "body": "@Schwern plz see my case on reply bgnfu7re."}], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 8241135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbc8faf42726241e29bae8273ab23376?s=128&d=identicon&r=PG&f=1", "display_name": "EricOlivier", "link": "https://stackoverflow.com/users/8241135/ericolivier"}, "is_accepted": false, "score": 0, "last_activity_date": 1577603405, "creation_date": 1577603405, "answer_id": 59517485, "question_id": 59508092, "link": "https://stackoverflow.com/questions/59508092/infinite-loop-channel-operation-cause-high-cpu-usage/59517485#59517485", "title": "Infinite loop channel operation cause high CPU usage", "body": "<p>Finally, I found that when Add the Channel Logic, the logic will add some data to a place that other code in the server would frequently serialize/deserialize them. And thats the place which eat the CPU. \nAs a result, the CPU increasing is nothing to do with the infinite Channel logic</p>\n"}], "owner": {"reputation": 31, "user_id": 8241135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbc8faf42726241e29bae8273ab23376?s=128&d=identicon&r=PG&f=1", "display_name": "EricOlivier", "link": "https://stackoverflow.com/users/8241135/ericolivier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 256, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1577603405, "creation_date": 1577506946, "last_edit_date": 1577576153, "question_id": 59508092, "link": "https://stackoverflow.com/questions/59508092/infinite-loop-channel-operation-cause-high-cpu-usage", "title": "Infinite loop channel operation cause high CPU usage", "body": "<p>the code example is as followed</p>\n\n<pre><code>var TestChan chan int    \n\nfunc SendDataToChannel(dataIn int){\n        select {\n           case TestChan &lt;- dataIn:\n           return\n        default:\n          return\n    }\n}\n\nfunc HandleChannelData(){\n\n    for{\n        time.Sleep(10 * time.Millisecond)\n        tmpData := &lt;- TestChan\n        /*\n        DoSomething with tmpData, call other server\n        */\n     }\n}\n\nfunc main(){\n    TestChan = make(chan int)\n    go HandleChannelData()\n    \uff0f*\n        Start server\n     *\uff0f\n }\n</code></pre>\n\n<p>The scenario is that, in my server, every request(3-5thousand qps) will call the SendDataToChannnel. DoSomething in HandleChannelData takes times to process and its downstream is under a QPS limitation, so I simply add a sleep in HandleChannelData.  The data add to the Channel should be non-bloacking and can be discarded, So I get a \"select default\" and non-buffered Channel there.</p>\n\n<p>When the server runs, the CPU usage increase infinitely and finally reached 95%(4 cores) while I have to shutdown the server. I pprof the server get the torch graph, find nothing(same distribution to the same server without this channel logic )<br>\nI'm confused by the CPU usage.</p>\n"}, {"tags": ["go", "enums", "protocol-buffers"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577503767, "post_id": 59507736, "comment_id": 105188379, "body": "The statement <code>oper, found := pb.Operation_Operator(os.Args[1])</code> will not compile given the type declaration <code>type Operation_Operator int32</code> in the <code>pb</code> package.  Post actual code."}, {"owner": {"reputation": 3418, "user_id": 311624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17e69b45adb2cf73eda5cc74052ca0c8?s=128&d=identicon&r=PG", "display_name": "Chuk Lee", "link": "https://stackoverflow.com/users/311624/chuk-lee"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577508134, "post_id": 59507736, "comment_id": 105188885, "body": "@CeriseLim&#243;n Corrected my mistake. Thanks"}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 4, "creation_date": 1577526748, "post_id": 59507736, "comment_id": 105191710, "body": "I think the answer to your question is no. You have an int32 and you want to convert it to <code>type X int32</code>. The right way is <code>X(my_int32)</code> as you wrote."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 1, "creation_date": 1577529874, "post_id": 59507736, "comment_id": 105192345, "body": "You&#39;re really out of options, so a cast is the way to go. That said, there&#39;s nothing wrong with creating a function that handles the cast, that can also check whether or not the <code>int32</code> value you&#39;re casting is indeed a valid enum value."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577546495, "post_id": 59507736, "comment_id": 105196079, "body": "The question and a comment mention casting.  The question and comment are actually referring <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">a conversion</a>.  Go does not have a feature like casting in other languages."}], "owner": {"reputation": 3418, "user_id": 311624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17e69b45adb2cf73eda5cc74052ca0c8?s=128&d=identicon&r=PG", "display_name": "Chuk Lee", "link": "https://stackoverflow.com/users/311624/chuk-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1577508055, "creation_date": 1577501317, "last_edit_date": 1577508055, "question_id": 59507736, "link": "https://stackoverflow.com/questions/59507736/idiomatic-way-of-converting-to-enum-from-int32", "title": "Idiomatic way of converting to enum from int32", "body": "<p>I have the following protocol buffer (proto3 syntax)</p>\n\n<pre><code>message Operation {\n   enum Operator {\n      UNKNOWN = 0;\n      ADD = 1;\n      ...\n   }\n   float operand = 1;\n   Operator operator = 2;\n}\n</code></pre>\n\n<p>The <code>enum</code> is generated as </p>\n\n<pre><code>type Operation_Operator int32\n</code></pre>\n\n<p>I'm creating the <code>Operation</code> message like so</p>\n\n<pre><code>//Assume package is pb\noper, found := pb.Operation_Operator_value(os.Args[1]) // one of the enums\nif !found {\n   // do something\n}\nmsg := &amp;pb.Operation {\n   Operand: float32(aNum),\n   Operator: pb.Operation_Operator(oper),\n}\n</code></pre>\n\n<p>My question is is there an idiomatic way of converting <code>int32</code> to <code>Operation_Operator</code> apart from casting as I did above?</p>\n"}, {"tags": ["mongodb", "go", "mongo-go"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 4324991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5d2baaf8ccf508f077d481f128d554c?s=128&d=identicon&r=PG&f=1", "display_name": "Suhaib Mujahid", "link": "https://stackoverflow.com/users/4324991/suhaib-mujahid"}, "edited": false, "score": 0, "creation_date": 1577725443, "post_id": 59510034, "comment_id": 105238324, "body": "Thank you. I&#39;m already doing this, however, this leads to having the []byte stored in the database as an Array of int32."}, {"owner": {"reputation": 114, "user_id": 3464082, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09516fd5e14b754405f97fadfd0757b?s=128&d=identicon&r=PG&f=1", "display_name": "bgnfu7re", "link": "https://stackoverflow.com/users/3464082/bgnfu7re"}, "reply_to_user": {"reputation": 21, "user_id": 4324991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5d2baaf8ccf508f077d481f128d554c?s=128&d=identicon&r=PG&f=1", "display_name": "Suhaib Mujahid", "link": "https://stackoverflow.com/users/4324991/suhaib-mujahid"}, "edited": false, "score": 0, "creation_date": 1577730927, "post_id": 59510034, "comment_id": 105240280, "body": "Saving bytes as int32 isn&#39;t that bad. You could potentially save a few bytes by packing every four bytes into int32 on marshal and reversing that on unmarshal. Though this approach has its downsides. First is maintaining the code. Second, the data is serialized and it is harder to edit directly if anything. To me, the gain here is questionable."}, {"owner": {"reputation": 114, "user_id": 3464082, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09516fd5e14b754405f97fadfd0757b?s=128&d=identicon&r=PG&f=1", "display_name": "bgnfu7re", "link": "https://stackoverflow.com/users/3464082/bgnfu7re"}, "reply_to_user": {"reputation": 21, "user_id": 4324991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5d2baaf8ccf508f077d481f128d554c?s=128&d=identicon&r=PG&f=1", "display_name": "Suhaib Mujahid", "link": "https://stackoverflow.com/users/4324991/suhaib-mujahid"}, "edited": false, "score": 0, "creation_date": 1577731146, "post_id": 59510034, "comment_id": 105240345, "body": "You can store more than 53 million of <code>Hash</code>&#39;es you have that would fit into 1 GiB. Consider that before trying to improve storage schema."}], "tags": [], "owner": {"reputation": 114, "user_id": 3464082, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09516fd5e14b754405f97fadfd0757b?s=128&d=identicon&r=PG&f=1", "display_name": "bgnfu7re", "link": "https://stackoverflow.com/users/3464082/bgnfu7re"}, "is_accepted": false, "score": 1, "last_activity_date": 1577528883, "creation_date": 1577528883, "answer_id": 59510034, "question_id": 59507580, "link": "https://stackoverflow.com/questions/59507580/how-to-store-byte-as-binary-in-mongodb-using-go-mongo-driver/59510034#59510034", "title": "How to store []byte as binary in MongoDB using go mongo-driver", "body": "<p>BSON is a binary JSON. JSON per se doesn't have the byte array type, but it does have arrays.</p>\n\n<p>The library can handle types without any additional marshallers.</p>\n\n<p>Here is a minimal working example.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"time\"\n\n    \"go.mongodb.org/mongo-driver/bson\"\n    \"go.mongodb.org/mongo-driver/mongo\"\n    \"go.mongodb.org/mongo-driver/mongo/options\"\n)\n\ntype Hash [4]byte\n\ntype Model struct {\n    Key Hash `bson:\"key\"`\n}\n\nfunc main() {\n    client, err := mongo.NewClient(options.Client().ApplyURI(\"mongodb://localhost:27017\"))\n    if err != nil {\n        panic(err)\n    }\n    ctx, cancel := context.WithTimeout(context.Background(), 20*time.Second)\n    defer cancel()\n\n    err = client.Connect(ctx)\n    if err != nil {\n        panic(err)\n    }\n\n    db := client.Database(\"database\")\n    collection := db.Collection(\"collection\")\n\n    // insert as plain []byte slice\n    _, err = collection.InsertOne(ctx, bson.M{\"key\": [4]byte{1, 2, 3, 4}})\n    if err != nil {\n        panic(err)\n    }\n\n    // insert h as a Hash type\n    h := Hash([4]byte{1, 2, 3, 4})\n    _, err = collection.InsertOne(ctx, bson.M{\"key\": h})\n    if err != nil {\n        panic(err)\n    }\n\n    cursor, err := collection.Find(ctx, bson.M{})\n    if err != nil {\n        panic(err)\n    }\n\n    var all []Model\n    if err := cursor.All(ctx, &amp;all); err != nil {\n        panic(err)\n    }\n\n    fmt.Println(all)\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 4324991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5d2baaf8ccf508f077d481f128d554c?s=128&d=identicon&r=PG&f=1", "display_name": "Suhaib Mujahid", "link": "https://stackoverflow.com/users/4324991/suhaib-mujahid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1896, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1581687966, "creation_date": 1577498537, "last_edit_date": 1581687966, "question_id": 59507580, "link": "https://stackoverflow.com/questions/59507580/how-to-store-byte-as-binary-in-mongodb-using-go-mongo-driver", "title": "How to store []byte as binary in MongoDB using go mongo-driver", "body": "<p>I'm using <code>using go.mongodb.org/mongo-driver/mongo</code> and I'm trying to story byte slice in MongoDB. However, the driver marshals it as an array of integers.</p>\n\n<p>In my case I have the following type:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Hash [20]byte\n</code></pre>\n\n<p>I tried to implement the <code>ValueMarshaler</code> interface as the foollowing: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (h Hash) MarshalBSONValue() (bsontype.Type, []byte, error) {\n    return bsontype.Binary, h[:20], nil\n}\n</code></pre>\n\n<p>But it is clear that <code>h[:20]</code> does not return valid bytes for mongo. It panics and returns the following: </p>\n\n<pre><code>panic: runtime error: slice bounds out of range [:-658764325]\n\ngoroutine 39 [running]:\ngo.mongodb.org/mongo-driver/x/bsonx/bsoncore.ReadElement(0xc0004bca1c, 0x1d, 0xe4, 0x55b6910, 0xffffffffffffff01, 0xc000178d00, 0xc00129aa18, 0x406d52d, 0x4819ea0, 0xc000bba240)\n       /go/pkg/mod/go.mongodb.org/mongo-driver@v1.0.1/x/bsonx/bsoncore/bsoncore.go:122 +0x271\ngo.mongodb.org/mongo-driver/x/bsonx/bsoncore.Document.Validate(0xc0004bca18, 0x21, 0xe8, 0x4799100, 0x26)\n       /go/pkg/mod/go.mongodb.org/mongo-driver@v1.0.1/x/bsonx/bsoncore/document.go:377 +0xe4\ngo.mongodb.org/mongo-driver/x/bsonx.(*Doc).UnmarshalBSON(0xc00129aba0, 0xc0004bca18, 0x21, 0xe8, 0x5, 0xc00129abc8)\n       /go/pkg/mod/go.mongodb.org/mongo-driver@v1.0.1/x/bsonx/document.go:225 +0x6e\ngo.mongodb.org/mongo-driver/x/bsonx.ReadDoc(0xc0004bca18, 0x21, 0xe8, 0xc0004bca18, 0x21, 0xe8, 0xc0004bca39, 0x0)\n       /go/pkg/mod/go.mongodb.org/mongo-driver@v1.0.1/x/bsonx/document.go:54 +0x77\ngo.mongodb.org/mongo-driver/x/bsonx.(*Val).UnmarshalBSONValue(0xc00129b2c0, 0x3, 0xc0004bca18, 0x21, 0xe8, 0x21, 0xe8)\n       /go/pkg/mod/go.mongodb.org/mongo-driver@v1.0.1/x/bsonx/value.go:249 +0x90f\ngo.mongodb.org/mongo-driver/x/bsonx.(*Doc).UnmarshalBSON(0xc00129b370, 0xc0004bca0a, 0x30, 0xf6, 0x44747df, 0xc0000b21e0)\n       /go/pkg/mod/go.mongodb.org/mongo-driver@v1.0.1/x/bsonx/document.go:236 +0x173\ngo.mongodb.org/mongo-driver/x/bsonx.ReadDoc(0xc0004bca0a, 0x30, 0xf6, 0xc0004bca0a, 0x30, 0xf6, 0xc0004bca3a, 0x0)\n       /go/pkg/mod/go.mongodb.org/mongo-driver@v1.0.1/x/bsonx/document.go:54 +0x77\ngo.mongodb.org/mongo-driver/x/bsonx.(*Val).UnmarshalBSONValue(0xc00129ba90, 0x3, 0xc0004bca0a, 0x30, 0xf6, 0x30, 0xf6)\n       /go/pkg/mod/go.mongodb.org/mongo-driver@v1.0.1/x/bsonx/value.go:249 +0x90f\ngo.mongodb.org/mongo-driver/x/bsonx.(*Doc).UnmarshalBSON(0xc00129bb40, 0xc0004bca00, 0x3b, 0x100, 0xc0000b21e0, 0x100)\n       /go/pkg/mod/go.mongodb.org/mongo-driver@v1.0.1/x/bsonx/document.go:236 +0x173\ngo.mongodb.org/mongo-driver/x/bsonx.ReadDoc(0xc0004bca00, 0x3b, 0x100, 0x0, 0x100, 0x4833880, 0xc000bba090, 0xc0004bca00)\n       /go/pkg/mod/go.mongodb.org/mongo-driver@v1.0.1/x/bsonx/document.go:54 +0x77\ngo.mongodb.org/mongo-driver/mongo.transformDocument(0xc00014a070, 0x4833880, 0xc000bba090, 0xc000bba120, 0x1, 0x1, 0x0, 0x0)\n       /go/pkg/mod/go.mongodb.org/mongo-driver@v1.0.1/mongo/mongo.go:155 +0x1f5\ngo.mongodb.org/mongo-driver/mongo.(*Collection).UpdateOne(0xc00010e1e0, 0x4cca0a0, 0xc00010e3c0, 0x4833880, 0xc000bba060, 0x4833880, 0xc000bba090, 0x0, 0x0, 0x0, ...)\n       /go/pkg/mod/go.mongodb.org/mongo-driver@v1.0.1/mongo/collection.go:530 +0xf0\n\n\nProcess finished with exit code 2\n\n</code></pre>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "edited": false, "score": 0, "creation_date": 1577620203, "post_id": 59507513, "comment_id": 105209165, "body": "Could you please provide the complete source code for reproduce the error?"}, {"owner": {"reputation": 304, "user_id": 7204831, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-BVTzI4cFWd8/AAAAAAAAAAI/AAAAAAAAADc/ENN2SgC00pY/photo.jpg?sz=128", "display_name": "Samyukta Ramnath", "link": "https://stackoverflow.com/users/7204831/samyukta-ramnath"}, "edited": false, "score": 0, "creation_date": 1619203254, "post_id": 59507513, "comment_id": 118843690, "body": "Were you able to find a solution to this?"}], "answers": [{"tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": false, "score": -1, "last_activity_date": 1577620322, "creation_date": 1577620322, "answer_id": 59519147, "question_id": 59507513, "link": "https://stackoverflow.com/questions/59507513/cgo-undefined-reference-to/59519147#59519147", "title": "cgo undefined reference to", "body": "<p>Your have to omit the <code>testc</code> folder, because they are in the same path in the import.\nSo this import:  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// #include \"testc/collection/linkedlist.h\"\n</code></pre>\n\n<p>will be:  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// #include \"collection/linkedlist.h\"\n</code></pre>\n"}], "owner": {"reputation": 3221, "user_id": 2245634, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/OHoy2.jpg?s=128&g=1", "display_name": "Amit\u0101bha", "link": "https://stackoverflow.com/users/2245634/amit%c4%81bha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 913, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1577620322, "creation_date": 1577497367, "question_id": 59507513, "link": "https://stackoverflow.com/questions/59507513/cgo-undefined-reference-to", "title": "cgo undefined reference to", "body": "<p>go project structure</p>\n\n<pre><code>src\n  test.go\n  testc/collection/linkedlist.h\n  testc/collection/linkedlist.c\n</code></pre>\n\n<p>test.go</p>\n\n<pre><code>package main\n\n// #cgo CFLAGS: -g -Wall\n// #include &lt;stdlib.h&gt;\n// #include \"testc/collection/linkedlist.h\"\nimport \"C\"\n\nfunc main() {\n  C.insertFirst(1,10);\n  C.insertFirst(2,20);\n  C.insertFirst(3,30);\n  C.insertFirst(4,1);\n  C.insertFirst(5,40);\n  C.insertFirst(6,56);\n  C.printList();\n}\n</code></pre>\n\n<p>linkedlist.h</p>\n\n<pre><code>#include &lt;stdbool.h&gt;\n\n#ifndef TEST_LINKEDLIST_H\n#define TEST_LINKEDLIST_H\nstruct node {\n    int data;\n    int key;\n    struct node *next;\n};\n\nstruct node * getHeader();\nvoid printList();\nvoid insertFirst(int key, int data);\nstruct node* deleteFirst();\nbool isEmpty();\nint length();\nstruct node* find(int key);\nstruct node* delete(int key);\nvoid sort();\nvoid reverse(struct node** head_ref);\n//void testList();\n#endif //TEST_LINKEDLIST_H\n</code></pre>\n\n<p>the error</p>\n\n<pre><code># command-line-arguments\nd:/gcc-9.2.0-no-debug/bin/../lib/gcc/x86_64-w64-mingw32/9.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: $WORK\\b001\\_x002.o: in function `_cgo_8b2a34aa27ef_Cfunc_insertFirst':\n/tmp/go-build/cgo-gcc-prolog:62: undefined reference to `insertFirst'\nd:/gcc-9.2.0-no-debug/bin/../lib/gcc/x86_64-w64-mingw32/9.2.0/../../../../x86_64-w64-mingw32/bin/ld.exe: $WORK\\b001\\_x002.o: in function `_cgo_8b2a34aa27ef_Cfunc_printList':\n/tmp/go-build/cgo-gcc-prolog:74: undefined reference to `printList'\ncollect2.exe: error: ld returned 1 exit status\n# command-line-arguments\ncgo-gcc-prolog: In function '_cgo_8b2a34aa27ef_Cfunc_printList':\ncgo-gcc-prolog:72:49: warning: unused variable '_cgo_a' [-Wunused-variable]\n</code></pre>\n"}, {"tags": ["go", "language-specifications"], "answers": [{"comments": [{"owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "edited": false, "score": 0, "creation_date": 1577496540, "post_id": 59507418, "comment_id": 105187600, "body": "So,  since both are defined types, they cannot be assigned to each other directly.  You can however say <code>d = Defined(i)</code>"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 5, "last_activity_date": 1577495985, "creation_date": 1577495985, "answer_id": 59507418, "question_id": 59507320, "link": "https://stackoverflow.com/questions/59507320/assignability-question-in-golang-specification/59507418#59507418", "title": "Assignability question in golang specification", "body": "<p>Also from the spec:</p>\n\n<p><a href=\"https://golang.org/ref/spec#Numeric_types\" rel=\"noreferrer\">https://golang.org/ref/spec#Numeric_types</a></p>\n\n<blockquote>\n  <p>To avoid portability issues all numeric types are defined types and thus distinct</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 1488, "user_id": 1366696, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/6d8a8ff690a4afe79c40eb03ed84beb8?s=128&d=identicon&r=PG", "display_name": "Venkatesh-Prasad Ranganath", "link": "https://stackoverflow.com/users/1366696/venkatesh-prasad-ranganath"}, "is_accepted": false, "score": 1, "last_activity_date": 1577500870, "last_edit_date": 1577500870, "creation_date": 1577496701, "answer_id": 59507463, "question_id": 59507320, "link": "https://stackoverflow.com/questions/59507320/assignability-question-in-golang-specification/59507463#59507463", "title": "Assignability question in golang specification", "body": "<p>Since <code>type Defined int32</code> defines a new type, <code>d</code> and <code>i</code> don't have identical types; hence, the first clause <em>x's type is identical to T</em> from the <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">assignability spec</a> isn't applicable.  The second clause <em>x's type V and T have identical underlying types and at least one of V or T is not a defined type</em> is not applicable as the types of both <code>i</code> and <code>d</code> are defined types.  As the remaining clauses from the assignability spec do not apply in this situation, the assignment fails.  Changing <code>type Defined int32</code> to <code>type Defined = int32</code> (which aliases a type) fixes the error.</p>\n\n<p><code>x = y</code> due to the <em>T is an interface type and x implements T</em> clause from the assignability spec is applicable.</p>\n"}], "owner": {"reputation": 121, "user_id": 3747979, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/2a0149ce2f981e7755f4c323efcb765b?s=128&d=identicon&r=PG&f=1", "display_name": "Nick B", "link": "https://stackoverflow.com/users/3747979/nick-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 59507418, "answer_count": 2, "score": 3, "last_activity_date": 1577500870, "creation_date": 1577494448, "question_id": 59507320, "link": "https://stackoverflow.com/questions/59507320/assignability-question-in-golang-specification", "title": "Assignability question in golang specification", "body": "<p>While reading go specification \"Assignability\" section, I tried to execute a couple of examples to get a better understanding of the topic, and now I can't get what am I doing wrong in my code.</p>\n\n<p>According to the <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">specification</a>,\nOne of the cases when a value <code>x</code> is assignable to a variable of type <code>T</code> is as follows:</p>\n\n<blockquote>\n  <p>x's type V and T have identical underlying types and at least one of V or T is not a defined type.</p>\n</blockquote>\n\n<p>Defined type <a href=\"https://golang.org/ref/spec#Type_definitions\" rel=\"nofollow noreferrer\">specification</a> states that</p>\n\n<blockquote>\n  <p>Type definition creates a new, distinct type with the same underlying type and operations as the given type, and binds an identifier to it.</p>\n</blockquote>\n\n<p>But when I try to run following code, the build fails:</p>\n\n<pre><code>func main() {\n    type Defined int32\n    var d Defined\n    var i int32\n    d = i\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>cannot use i (type int32) as type Defined in assignment\n</code></pre>\n\n<p>Meanwhile, the similar example with composite literal works fine:</p>\n\n<pre><code>func main() {\n    type MyMap map[string]int\n    var x MyMap \n    var y map[string]int\n    x = y\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/VCLrUJsAqJW\" rel=\"nofollow noreferrer\">playground</a></p>\n"}, {"tags": ["go", "ssh", "cryptography"], "comments": [{"owner": {"reputation": 430, "user_id": 986597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O0hCj.jpg?s=128&g=1", "display_name": "Graham Nicholls", "link": "https://stackoverflow.com/users/986597/graham-nicholls"}, "edited": false, "score": 0, "creation_date": 1577487417, "post_id": 59506608, "comment_id": 105186194, "body": "Running &quot;ssh -Q &lt;cipher_use_case&gt;&quot;  is useful for finding the algorithms supported by the client - I need to ensure that the server isn&#39;t offering the use of deprecated algorithms."}, {"owner": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 0, "creation_date": 1577487535, "post_id": 59506608, "comment_id": 105186224, "body": "Your data is odd because SSH is not a text protocol, it&#39;s a binary one, and the telnet command knows nothing at all about it. Nmap, on the other hand, does now something about the SSH protocol. Just because you see some recognizable ASCII strings in a protocol does not necessarily mean it&#39;s a text-based protocol."}, {"owner": {"reputation": 430, "user_id": 986597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O0hCj.jpg?s=128&g=1", "display_name": "Graham Nicholls", "link": "https://stackoverflow.com/users/986597/graham-nicholls"}, "reply_to_user": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 0, "creation_date": 1577488930, "post_id": 59506608, "comment_id": 105186520, "body": "What does telnet need to know?  Surely before the client and server are able to set up an encrypted (binary) connection, they negotiate in &quot;ASCII&quot; (I put that in quotes because I&#39;d only expect the algorithm names to be ASCII).  Running the nmap script with --script-trace it showing similar data to the &quot;binary&quot; format I get from telnet, yet nmap is able to produce useful output. So I agree that nmap knows something I don&#39;t - that was sort of my question, really."}, {"owner": {"reputation": 36469, "user_id": 238704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VgOZI.png?s=128&g=1", "display_name": "President James K. Polk", "link": "https://stackoverflow.com/users/238704/president-james-k-polk"}, "edited": false, "score": 0, "creation_date": 1577491039, "post_id": 59506608, "comment_id": 105186904, "body": "The protocol is documented in <a href=\"https://tools.ietf.org/html/rfc4253\" rel=\"nofollow noreferrer\">RFC 4253</a> -- and don&#39;t call me Shirley. The first 3 lines of output (<code>Trying 127.0.0.1...</code>, etc) have nothing to do with the protocol, that&#39;s just the telnet program reporting its progress. The next two are an exchange of ASCII version information. After that, the binary protocol occurs."}], "answers": [{"tags": [], "owner": {"reputation": 430, "user_id": 986597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O0hCj.jpg?s=128&g=1", "display_name": "Graham Nicholls", "link": "https://stackoverflow.com/users/986597/graham-nicholls"}, "is_accepted": true, "score": 0, "last_activity_date": 1579961718, "creation_date": 1579961718, "answer_id": 59910044, "question_id": 59506608, "link": "https://stackoverflow.com/questions/59506608/ssh-client-to-show-server-supported-algorithms/59910044#59910044", "title": "ssh client to show server-supported algorithms", "body": "<p>Opening a tcp connection to port 22, (in golang, with net.Dial) then accepting and sending connection strings leaves us able to Read() from the Reader for the connection.  Thence the data is in a standard format described by the RFC.  From this, I can list the algorithms supported in each phase of an ssh connection.   This is very useful for measuring what is being offered, rather than what the appears to be configured (it's easy to configure sshd to use a different config file).</p>\n\n<p>It's a useful thing to be able to do from a security POV.\nTested on every version of ssh I can find from 1.x on a very old solaris or AIX box, to RHEL 8.1. </p>\n"}], "owner": {"reputation": 430, "user_id": 986597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O0hCj.jpg?s=128&g=1", "display_name": "Graham Nicholls", "link": "https://stackoverflow.com/users/986597/graham-nicholls"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 446, "favorite_count": 0, "accepted_answer_id": 59910044, "answer_count": 1, "score": -2, "last_activity_date": 1580638164, "creation_date": 1577485790, "last_edit_date": 1580638164, "question_id": 59506608, "link": "https://stackoverflow.com/questions/59506608/ssh-client-to-show-server-supported-algorithms", "title": "ssh client to show server-supported algorithms", "body": "<p>In order to check that all the servers across a fleet aren't supporting deprecated algorithms, I'm (programmatically) doing this:</p>\n\n<pre><code>telnet localhost 22 \nTrying 127.0.0.1...\nConnected to localhost. \nEscape character is '^]'. \nSSH-2.0-OpenSSH_8.0p1 Ubuntu-6build1\nSSH-2.0-Censor-SSH2 \n4&amp;m\ufffd\ufffd\ufffd\ufffd&amp;F \ufffdV\ufffd\ufffdcurve25519-sha256,curve25519-sha256@libssh.org,ecdh-sha2-nistp256,ecdh-sha2-nistp384,ecdh-sha2-nistp521,diffie-hellman-group-exchange-sha256,diffie-hellman-group16-sha512,diffie-hellman-group18-sha512,diffie-hellman-group14-sha256,diffie-hellman-group14-sha1Arsa-sha2-512,rsa-sha2-256,ssh-rsa,ecdsa-sha2-nistp256,ssh-ed25519lchacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.comlchacha20-poly1305@openssh.com,aes128-ctr,aes192-ctr,aes256-ctr,aes128-gcm@openssh.com,aes256-gcm@openssh.com\ufffdumac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1\ufffdumac-64-etm@openssh.com,umac-128-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512-etm@openssh.com,hmac-sha1-etm@openssh.com,umac-64@openssh.com,umac-128@openssh.com,hmac-sha2-256,hmac-sha2-512,hmac-sha1none,zlib@openssh.comnone,zlib@openssh.comSSH-2.0-Censor-SSH2\nConnection closed by foreign host.\n</code></pre>\n\n<p>Which is supposed to be a list of supported algorithms for the various phases of setting up a connection. (kex, host key, etc).   Every time I run, I get a different piece of odd data at the start - always a different length.</p>\n\n<p>There's an nmap plugin - ssh2-enum-algos - which returns the data in it's complete form, but I don't want to run nmap; I have a go program which opens the port, and sends the query, but it gets the same as telnet.      What am I missing, and how do I fix it?</p>\n\n<p>For comparison, here's the top few lines from the output of nmap script:</p>\n\n<pre><code>$ nmap --script ssh2-enum-algos super\nStarting Nmap 7.80 ( https://nmap.org ) at 2019-12-27 22:15 GMT\nNmap scan report for super (192.168.50.1)\nHost is up (0.0051s latency).\nrDNS record for 192.168.50.1: supermaster\nNot shown: 998 closed ports\nPORT    STATE SERVICE\n22/tcp  open  ssh\n| ssh2-enum-algos: \n|   kex_algorithms: (12)\n|       curve25519-sha256\n|       curve25519-sha256@libssh.org\n|       ecdh-sha2-nistp256\n|       ecdh-sha2-nistp384\n|       ecdh-sha2-nistp521\n</code></pre>\n"}, {"tags": ["api", "go", "swagger-ui", "go-templates", "api-doc"], "answers": [{"comments": [{"owner": {"reputation": 101, "user_id": 4957458, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/vCiPT.jpg?s=128&g=1", "display_name": "buterfly85", "link": "https://stackoverflow.com/users/4957458/buterfly85"}, "edited": false, "score": 0, "creation_date": 1577486087, "post_id": 59506317, "comment_id": 105185909, "body": "after posting this question I started to think that something might be wrong with my data type when passing it to the template. But before I figured it out, I saw your response )) It worked. Thanks for your answer!"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1577483208, "creation_date": 1577483208, "answer_id": 59506317, "question_id": 59505856, "link": "https://stackoverflow.com/questions/59505856/when-providing-pregenerated-links-for-supporting-multiple-api-specs-swagger-ui-d/59506317#59506317", "title": "When providing pregenerated links for supporting multiple API specs Swagger UI doesn&#39;t load the specs", "body": "<p>There appear to be two mistakes:</p>\n\n<p>First:</p>\n\n<pre><code>  urls: {{ .jsonURLs }},\n</code></pre>\n\n<p>This will not write <code>jsonURLs</code> in JSON format for you. It will simply write a string representation of <code>jsonURLs</code>. Either you need to write the template to iterate elements of <code>jsonURLs</code> and print them out one by one, or marshal <code>jsonURLs</code> to json yourself:</p>\n\n<pre><code>jsonText,_:=json.Marshal(jsonURLs)\nreturn c.Render(http.StatusOK, \"docs/index\", map[string]interface{}{\n        \"source\":   source,\n        \"key\":      key,\n        \"pageType\": \"docs\",\n        \"jsonURLs\": string(jsonText),\n    })\n</code></pre>\n\n<p>Second: it looks like you didn't export the member fields of <code>DocsURL</code> struct. Capitalize the field names and add json tags.</p>\n\n<pre><code>type DocsURL struct {\n  URL string `json:\"url\"`\n  Name string `json:\"name\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 4957458, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/vCiPT.jpg?s=128&g=1", "display_name": "buterfly85", "link": "https://stackoverflow.com/users/4957458/buterfly85"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 59506317, "answer_count": 1, "score": 0, "last_activity_date": 1577483208, "creation_date": 1577479498, "question_id": 59505856, "link": "https://stackoverflow.com/questions/59505856/when-providing-pregenerated-links-for-supporting-multiple-api-specs-swagger-ui-d", "title": "When providing pregenerated links for supporting multiple API specs Swagger UI doesn&#39;t load the specs", "body": "<p>I have a service written in Go that also uses go templates for frontend. This service is used by our external third parties as a portal for looking up stuff and searching. There is another service that is a rest API for handling orders. The portal service has a page where you can look up API docs. \nI had only one API version and I use SwaggerUI for showing API docs. I had to create a new endpoint and make it a part of a new API version. Now I want to show a new API version but also the old one for supporting old clients. Something like this:\n<a href=\"https://i.stack.imgur.com/l1pX0.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/l1pX0.png\" alt=\"enter image description here\"></a></p>\n\n<p>So when a user clicks a button on the portal website to see documentation, the request is handled by this function in portal (Note: I already refactored this function to support multiple urls):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func getDocs(c echo.Context) error {\n    source := c.Get(auth.SourceName).(string)\n    key := c.Get(auth.KeyName).(string)\n\n    jsonURLs := []DocsURL{\n        {\n            url:         fmt.Sprintf(\"%s/0.1/docs?source=%s\", config.baseURL, key),\n            name:        \"0.1\"\n        },\n        {\n            url:         fmt.Sprintf(\"%s/1.0/docs?source=%s\", config.baseURL, key),\n            name:        \"0.1\"\n        },\n    }\n\n    return c.Render(http.StatusOK, \"docs/index\", map[string]interface{}{\n        \"source\":   source,\n        \"key\":      key,\n        \"pageType\": \"docs\",\n        \"jsonURLs\": jsonURLs,\n    })\n}\n</code></pre>\n\n<p>And this is the script from the template where I use SwaggerUI:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>  window.onload = function() {\n    const ui = SwaggerUIBundle({\n      urls: {{ .jsonURLs }},\n      dom_id: '#swagger-ui',\n      deepLinking: true,\n      presets: [\n        SwaggerUIBundle.presets.apis,\n        SwaggerUIStandalonePreset\n      ],\n      plugins: [\n        SwaggerUIBundle.plugins.DownloadUrl\n      ],\n      layout: \"StandaloneLayout\",\n      supportedSubmitMethods: []\n    })\n    window.ui = ui\n    $('.tryitout').prop('disabled', true);\n  }\n</code></pre>\n\n<p>I need to generate links depending on the environment (production, staging, local). Also it makes sense to generate data on the backend and feed it to the template to display. BUT THIS DOENS'T WORK!</p>\n\n<p>However, if I hard-code the links in the <code>SwaggerUIBundle</code> it works and portal shows a correct drop-down menu and allows to switch between versions and loads docs for the corresponding version.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func getDocs(c echo.Context) error {\n    source := c.Get(auth.SourceName).(string)\n    key := c.Get(auth.KeyName).(string)\n\n    return c.Render(http.StatusOK, \"docs/index\", map[string]interface{}{\n        \"source\":   source,\n        \"key\":      key,\n        \"pageType\": \"docs\",\n    })\n}\n</code></pre>\n\n<p>In the template:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>window.onload = function() {\n    const ui = SwaggerUIBundle({\n      urls: [\n        {\n          url: \"http://localhost:8088/0.1/docs?source=111111\",\n          name: \"0.1\"\n        },\n        {\n          url: \"http://localhost:8088/1.0/docs?source=111111\",\n          name: \"1.0\"\n        }\n      ],\n      dom_id: '#swagger-ui',\n      deepLinking: true,\n      presets: [\n        SwaggerUIBundle.presets.apis,\n        SwaggerUIStandalonePreset\n      ],\n      plugins: [\n        SwaggerUIBundle.plugins.DownloadUrl\n      ],\n      layout: \"StandaloneLayout\",\n      supportedSubmitMethods: []\n    })\n    window.ui = ui\n    $('.tryitout').prop('disabled', true);\n  }\n</code></pre>\n\n<p>Why is that? And is there a way to make the first version of code work?</p>\n\n<p>I need the links to be dynamic and preferably generated in the handler. Thank you!</p>\n"}, {"tags": ["go", "shiny"], "answers": [{"tags": [], "owner": {"reputation": 4797, "user_id": 177154, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f719bc9e36272f09feca03728b4a160c?s=128&d=identicon&r=PG", "display_name": "draganstankovic", "link": "https://stackoverflow.com/users/177154/draganstankovic"}, "is_accepted": false, "score": 0, "last_activity_date": 1577493094, "creation_date": 1577493094, "answer_id": 59507242, "question_id": 59505702, "link": "https://stackoverflow.com/questions/59505702/how-to-get-screen-position/59507242#59507242", "title": "How to get screen position", "body": "<p>Depending on what are you trying to achieve, I assume you can reuse some parts from the example <a href=\"https://github.com/golang/exp/blob/master/shiny/example/basic/main.go\" rel=\"nofollow noreferrer\">https://github.com/golang/exp/blob/master/shiny/example/basic/main.go</a></p>\n\n<p>Below is an excerpt that might be of interest to you:</p>\n\n<pre><code>var sz size.Event\nfor {\n    e := w.NextEvent()\n\n    switch e := e.(type) {\n        //...\n        // Basically wait for the resize event...\n        case size.Event:\n            // Save the latest size so later you could read it as sz.Bounds()\n            sz = e \n        // ...\n}\n...\n</code></pre>\n\n<p><code>sz.Bounds()</code> returns: <a href=\"https://godoc.org/image#Rectangle\" rel=\"nofollow noreferrer\">https://godoc.org/image#Rectangle</a> and hopefully its <code>Min</code>, <code>Max</code> points would be absolute locations.</p>\n"}], "owner": {"reputation": 77, "user_id": 9642759, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Dl5xpL75Ar0/AAAAAAAAAAI/AAAAAAAAAAA/xW6I1G-3J24/photo.jpg?sz=128", "display_name": "deku", "link": "https://stackoverflow.com/users/9642759/deku"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 182, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1577493926, "creation_date": 1577478250, "last_edit_date": 1577493926, "question_id": 59505702, "link": "https://stackoverflow.com/questions/59505702/how-to-get-screen-position", "title": "How to get screen position", "body": "<p>I'm using the package <code>golang.org/x/exp/shiny/screen</code> in the document, it says that the basic usage to create a screen would be:</p>\n\n<pre><code>func main() {\n    driver.Main(func(s screen.Screen) {\n        w, err := s.NewWindow(nil)\n        if err != nil {\n            handleError(err)\n            return\n        }\n        defer w.Release()\n\n        for {\n            switch e := w.NextEvent().(type) {\n            case lifecycle.Event:\n                if e.To == lifecycle.StageDead {\n                    return\n                }\n                etc\n            case etc:\n                etc\n            }\n        }\n    })\n}\n</code></pre>\n\n<p>How do I get the position of the screen? </p>\n\n<p>In definition it says that the struct consists of</p>\n\n<pre><code>type NewWindowOptions struct {\n    // Width and Height specify the dimensions of the new window. If Width\n    // or Height are zero, a driver-dependent default will be used for each\n    // zero value dimension.\n    Width, Height int\n\n    // Title specifies the window title.\n    Title string\n}\n</code></pre>\n\n<p>So I was thinking of getting this <code>Width</code> and <code>Height</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1577470172, "post_id": 59504264, "comment_id": 105181365, "body": "See the official faq. The error tells all there is to know."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1577474720, "post_id": 59504264, "comment_id": 105182809, "body": "Converting a value <code>va</code> of type <code>interface A</code> to a new value <code>vb</code> of type <code>interface B</code> involves a run-time check, that the concrete type in <code>va</code> implements <code>interface B</code> (see <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Assignability</a>, or really better here, <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Type_assertions</a>). So to convert a slice of such interfaces, you need a loop, with each element being converted, with a runtime check at each conversion."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1577475263, "post_id": 59504264, "comment_id": 105183000, "body": "In this case, since <code>Host</code> by definition includes <code>Initializable</code>, all the type assertions are guaranteed to succeed (and we could hope the compiler optimizes them away). However, a loop that does all the type assertions you&#39;d need is just as long as writing out the loop with direct calls to <code>member.Initialize()</code>, so there&#39;s no real point in converting <code>[]Host</code> to <code>[]Initializable</code>: just do the loop and call <code>Initialize</code>."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 2, "last_activity_date": 1577471082, "creation_date": 1577471082, "answer_id": 59504661, "question_id": 59504264, "link": "https://stackoverflow.com/questions/59504264/downcasting-a-slice-of-interfaces-to-a-sub-interface-slice/59504661#59504661", "title": "Downcasting a slice of interfaces to a sub-interface slice", "body": "<blockquote>\n  <p>I can't seem to figure out the proper syntax to use for this application</p>\n</blockquote>\n\n<p>There is no such syntax. You simply cannot do this (directly).</p>\n"}], "owner": {"reputation": 24, "user_id": 6534580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1fa7f02debd90bdd2a9e26baad2af04?s=128&d=identicon&r=PG&f=1", "display_name": "Morgan G", "link": "https://stackoverflow.com/users/6534580/morgan-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "closed_date": 1577474585, "accepted_answer_id": 59504661, "answer_count": 1, "score": -3, "last_activity_date": 1577474665, "creation_date": 1577468740, "question_id": 59504264, "link": "https://stackoverflow.com/questions/59504264/downcasting-a-slice-of-interfaces-to-a-sub-interface-slice", "closed_reason": "Duplicate", "title": "Downcasting a slice of interfaces to a sub-interface slice", "body": "<p>I'm trying to get better at using interfaces in Go to describe specific functionality, and using interface composition to write better, more understandable code. I ran into this problem which seems like it would be a common use case of go interfaces, yet I can't seem to figure out the proper syntax to use for this application. Here's some code to help explain what I am trying to do:</p>\n\n<pre><code>// Initializable is an interface to an object that can be initialized.\ntype Initializable interface {\n    Initialize() error\n}\n\n// InitializeAll initializes an array of members.\nfunc InitializeAll(members []Initializable) error {\n    for _, member := range members {\n        err := member.Initialize()\n        if err != nil {\n            return err\n        }\n    }\n    return nil\n}\n\n// Host is an interface to an object providing a set of handlers for a web host.\ntype Host interface {\n    Initializable\n    Hostname() string\n    RegisterHandlers(router *mux.Router)\n}\n\n// ConfigureHosts configures a set of hosts and initializes them.\nfunc ConfigureHosts(hosts []Host) (*mux.Router, error) {\n    err := InitializeAll(hosts) // compiler error here\n}\n</code></pre>\n\n<p>This is the error: <code>cannot use hosts (type []Host) as type []Initializable in argument InitializeAll</code>.</p>\n\n<p>My initial thought was that I was missing some sort of type downcast, which I know works for single interface objects, but had difficulty casting an array. When I tried doing <code>err := InitializeAll(hosts.([]Initializable))</code>, I got the following error: <code>invalid type assertion: hosts.([]Initializable) (non-interface type []Host on left)</code>.</p>\n\n<p>I'd appreciate any ideas as it comes to the design of this code example, and perhaps any suggestions as to proper syntax or some refactoring that I could do to solve this problem. Thanks!</p>\n"}, {"tags": ["go", "concurrency", "runtime", "runnable", "goroutine"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577464244, "post_id": 59503413, "comment_id": 105179349, "body": "Your function doesn&#39;t print the number of goroutines, it prints a static string (or would, if it would even compile, which it won&#39;t, because of the unused variable <code>x</code>). <code>len(debug.Stack())</code> has no relation to the number of runnable goroutines. As <a href=\"https://golang.org/pkg/runtime/debug/#Stack\" rel=\"nofollow noreferrer\">the documentation for <code>debug.Stack</code> states</a>, it returns the stack trace <b>of the goroutine that calls it</b>, so if you call it in the loop, yes the trace will always be the same. I&#39;m not aware of any call to get the number of runnable goroutines, which is an internal scheduler implementation detail."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1577466011, "post_id": 59503413, "comment_id": 105180027, "body": "I&#39;m afraid <i>this</i> is not currently possible. The closest thing is debugging under <a href=\"https://golang.org/doc/diagnostics.html#godebug\" rel=\"nofollow noreferrer\"><code>GOTRACE=schedtrace=X</code></a>. You might find <a href=\"https://software.intel.com/en-us/blogs/2014/05/10/debugging-performance-issues-in-go-programs\" rel=\"nofollow noreferrer\">this explanation of <code>schedtrace</code></a> useful."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1577467142, "post_id": 59503413, "comment_id": 105180417, "body": "Part of the problem is that the entire concept of a goroutine &quot;in runnable state&quot; is an internal implementation detail of the current version of the scheduler; it is not part of the spec. It could change at any point in the future, on any or all platforms, and any stdlib call to retrieve that detail would be broken, violating the compatibility promise."}], "answers": [{"tags": [], "owner": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "is_accepted": true, "score": 2, "last_activity_date": 1577485517, "last_edit_date": 1577485517, "creation_date": 1577484802, "answer_id": 59506503, "question_id": 59503413, "link": "https://stackoverflow.com/questions/59503413/how-to-count-the-number-of-goroutine-in-runnable-state/59506503#59506503", "title": "How to count the number of goroutine in runnable state", "body": "<p>I don't recommend to use this way (because that's how it works inside runtime and might be changed at future), but in testing purposes would be fine:\n<a href=\"https://play.golang.org/p/6gi26PF3iTT\" rel=\"nofollow noreferrer\">https://play.golang.org/p/6gi26PF3iTT</a></p>\n\n<p>As you can see, <em>running</em> and <em>runnable</em> states are the different states.</p>\n"}], "owner": {"reputation": 707, "user_id": 8343916, "user_type": "registered", "accept_rate": 7, "profile_image": "https://www.gravatar.com/avatar/54d382e5c2f991df05e0f0138af7e5a9?s=128&d=identicon&r=PG&f=1", "display_name": "claudioz", "link": "https://stackoverflow.com/users/8343916/claudioz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 905, "favorite_count": 0, "accepted_answer_id": 59506503, "answer_count": 1, "score": -3, "last_activity_date": 1577485517, "creation_date": 1577463795, "last_edit_date": 1577483940, "question_id": 59503413, "link": "https://stackoverflow.com/questions/59503413/how-to-count-the-number-of-goroutine-in-runnable-state", "title": "How to count the number of goroutine in runnable state", "body": "<p>I am testing my Go application. Right now I'm getting some information, but I wanted to know how to know the exact number (given some time instant) of <strong>goroutines in the runnable state</strong>: the function <code>NumGoroutine()</code> of the <code>runtime</code> package returns the number of goroutines that currently exist (which are many more than those in the <em>runnable</em> state!). </p>\n\n<p>This is my function which prints the goroutine number every second:</p>\n\n<pre><code>func count() {\n    for {\n        fmt.Println(\"Number of runnable goroutines: \", runtime.NumGoroutine())\n        time.Sleep(1 * time.Second)\n    }\n}\n</code></pre>\n\n<p>Unfortunately, the result is not good (the number of goroutines in the program is constantly growing, and I know that so many goroutines cannot be active at the same time!). This page: <a href=\"https://golang.org/doc/diagnostics.html\" rel=\"nofollow noreferrer\">https://golang.org/doc/diagnostics.html</a> says that <code>debug.Stack</code> <em>returns the current stack trace. Stack trace is useful to see how many goroutines are currently running, what they are doing, and whether they are blocked or not.</em></p>\n\n<p>If I print <code>debug.Stack()</code> (instead of runtime.NumGoroutine()) the result changes completely (every second it always prints the same stack!). My question is: is <code>len(debug.Stack())</code> the correct number of goroutines in the <em>runnable</em> state? It seems to me not, since this number is constant.\nHow do I get the right information?</p>\n"}, {"tags": ["sockets", "go", "networking", "tcp"], "comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1577765156, "post_id": 59502881, "comment_id": 105248574, "body": "Bizarre. Do both connections work? i.e. can you send and receive data correctly via both of them?"}, {"owner": {"reputation": 153, "user_id": 5213297, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hShPKbRRpU4/AAAAAAAAAAI/AAAAAAAAAA8/Bs25OhDJ8H4/photo.jpg?sz=128", "display_name": "dzdx", "link": "https://stackoverflow.com/users/5213297/dzdx"}, "reply_to_user": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1577773780, "post_id": 59502881, "comment_id": 105250162, "body": "such as  server ``` conn1.Write([]byte(&quot;1&quot;)) conn2.Write([]byte(&quot;2&quot;))  conn1.Write([]byte(&quot;3&quot;)) conn2.Write([]byte(&quot;4&quot;))  ``` client can received <code>14</code>  from the conncetion"}, {"owner": {"reputation": 153, "user_id": 5213297, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hShPKbRRpU4/AAAAAAAAAAI/AAAAAAAAAA8/Bs25OhDJ8H4/photo.jpg?sz=128", "display_name": "dzdx", "link": "https://stackoverflow.com/users/5213297/dzdx"}, "reply_to_user": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1577775338, "post_id": 59502881, "comment_id": 105250563, "body": "@user207421   Both connections works. I tried to write a few data after accept the two connections on the server. The client can read the data written by the both connections, but not all of the messages can be received"}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1577777039, "post_id": 59502881, "comment_id": 105251040, "body": "Define &#39;not all of the messages can be received&#39;. Can they be received by connections from unique 5-tuples? or is there just a bug in your code?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1577827429, "post_id": 59502881, "comment_id": 105266097, "body": "Is this really the code you&#39;re running? The server discards all data read without writing anything back, but the client is expecting a response. The duplicate error on the server side could happen if the client closes a connection, and then reuses the same port it used before, but that doesn&#39;t look possible from the code."}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1577856787, "post_id": 59502881, "comment_id": 105269356, "body": "... and if the server closes the connection without reading all the pending data, the connection will be reset rather than closed, which will permit the reuse of the client port."}, {"owner": {"reputation": 258, "user_id": 2050626, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5ce4735b776f58a0a48a74ef03fe5e68?s=128&d=identicon&r=PG", "display_name": "AriesDevil", "link": "https://stackoverflow.com/users/2050626/ariesdevil"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1577933778, "post_id": 59502881, "comment_id": 105284019, "body": "@BurakSerdar the client-side will block on read op so that there is no port reusing happen."}, {"owner": {"reputation": 258, "user_id": 2050626, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5ce4735b776f58a0a48a74ef03fe5e68?s=128&d=identicon&r=PG", "display_name": "AriesDevil", "link": "https://stackoverflow.com/users/2050626/ariesdevil"}, "reply_to_user": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1577933884, "post_id": 59502881, "comment_id": 105284039, "body": "@user207421 and the server never close any connections in these code snippets until the main exit."}, {"owner": {"reputation": 153, "user_id": 5213297, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hShPKbRRpU4/AAAAAAAAAAI/AAAAAAAAAA8/Bs25OhDJ8H4/photo.jpg?sz=128", "display_name": "dzdx", "link": "https://stackoverflow.com/users/5213297/dzdx"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1577934336, "post_id": 59502881, "comment_id": 105284106, "body": "@BurakSerdar  the code is runnable. server block on accept new connection, and client block on read from connection, both client and server will not close the connections, I validate this by <a href=\"https://github.com/iovisor/bcc/blob/master/tools/tcptracer.py\" rel=\"nofollow noreferrer\">github.com/iovisor/bcc/blob/master/tools/tcptracer.py</a>.   I capture localhost network traffic by wireshark, 56186, 57376, 47892 have duplicate problems. other ports, such as 42002, do not have this problem. can you help me to see what is wrong?   <a href=\"https://drive.google.com/file/d/1GsxwXr3306KnIMm5rhsdQB4go0BoAeXv/view\" rel=\"nofollow noreferrer\">drive.google.com/file/d/1GsxwXr3306KnIMm5rhsdQB4go0BoAeXv/vi&zwnj;&#8203;ew</a>"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1577947510, "post_id": 59502881, "comment_id": 105286595, "body": "On the server side, try reading from a duplicate connection when you find it, see if you get an EOF error. That means, the connection was closed."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1578072408, "post_id": 59502881, "comment_id": 105331821, "body": "I cannot reproduce your problem on my system (Centos 7). Have you tried running this in a different environment?"}, {"owner": {"reputation": 258, "user_id": 2050626, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5ce4735b776f58a0a48a74ef03fe5e68?s=128&d=identicon&r=PG", "display_name": "AriesDevil", "link": "https://stackoverflow.com/users/2050626/ariesdevil"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1578141901, "post_id": 59502881, "comment_id": 105347040, "body": "@BurakSerdar Thank you for responding, the reproducing is not steady, we can reproduce on (fedora desktop kernel 5.3, ubuntu-desktop kernel 5.0, ubuntu-desktop kernel 4.19, ubuntu-server kernel 5.0, Gentoo kernel 4.9), but we cannot reproduce on (ubuntu (both desktop and server) kernel 4.15, Gentoo kernel 4.4). And even on the machines that can be reproduced, not every attempt can be made."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1578161002, "post_id": 59502881, "comment_id": 105352017, "body": "I don&#39;t see anything wrong with your Go code. I think what&#39;s happening is closed (or reset) connections, and as I said before, you can test this hypothesis by testing your connection once you find a duplicate port was used. Then, if you have the time and will, you can try diagnosing why those connections are closing (resetting)."}, {"owner": {"reputation": 153, "user_id": 5213297, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hShPKbRRpU4/AAAAAAAAAAI/AAAAAAAAAA8/Bs25OhDJ8H4/photo.jpg?sz=128", "display_name": "dzdx", "link": "https://stackoverflow.com/users/5213297/dzdx"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1578317324, "post_id": 59502881, "comment_id": 105389054, "body": "@BurakSerdar Based on your suggestion, I tried it <a href=\"https://gist.github.com/dzdx/35363a04ea9582cd9b0b324e44a7c1c4\" rel=\"nofollow noreferrer\">gist.github.com/dzdx/35363a04ea9582cd9b0b324e44a7c1c4</a>   only one connection can be read, but another connection is not closed at the time"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1579015623, "post_id": 59502881, "comment_id": 105622435, "body": "@dzdx, what do you mean by &quot;another connection is not closed&quot;? Can you read from it without error? If there is error, what is the error?"}, {"owner": {"reputation": 258, "user_id": 2050626, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5ce4735b776f58a0a48a74ef03fe5e68?s=128&d=identicon&r=PG", "display_name": "AriesDevil", "link": "https://stackoverflow.com/users/2050626/ariesdevil"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1579165947, "post_id": 59502881, "comment_id": 105676684, "body": "@BurakSerdar &quot;is not closed&quot; means the socket is exist and we can fire a read op on it. The error is shown here: <a href=\"https://gist.github.com/dzdx/35363a04ea9582cd9b0b324e44a7c1c4#gistcomment-3128816\" rel=\"nofollow noreferrer\">gist.github.com/dzdx/&hellip;</a>"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1579189650, "post_id": 59502881, "comment_id": 105690144, "body": "The &quot;connection reset&quot; error shows that the socket is closed. The &quot;connection timeout&quot; shows that one side is waiting for an ack that never arrives. Maybe it missed the reset? Either case, the other end of the socket is closed, and somehow one side missed it. My guess is the message was really lost, or there is a tcp stack related thing going in here. This is unlikely related to the go implementation."}, {"owner": {"reputation": 258, "user_id": 2050626, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5ce4735b776f58a0a48a74ef03fe5e68?s=128&d=identicon&r=PG", "display_name": "AriesDevil", "link": "https://stackoverflow.com/users/2050626/ariesdevil"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1579593766, "post_id": 59502881, "comment_id": 105807930, "body": "@BurakSerdar Yup, programming language is irrelevant, we can reproduce it use other programming languages."}, {"owner": {"reputation": 1359, "user_id": 113316, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4772c3b95b4065144bb7f26dd24eae37?s=128&d=identicon&r=PG", "display_name": "rajeshnair", "link": "https://stackoverflow.com/users/113316/rajeshnair"}, "edited": false, "score": 0, "creation_date": 1594585540, "post_id": 59502881, "comment_id": 111170385, "body": "@dzdx, what&#39;s the status of TCP connection? it is possible that one of the duplicate is in CLOSE_WAIT state and another in ESTABLISHED state"}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1595230553, "creation_date": 1595230553, "answer_id": 62990627, "question_id": 59502881, "link": "https://stackoverflow.com/questions/59502881/why-accepted-two-same-5-tuple-socket-when-concurrent-connect-to-the-server/62990627#62990627", "title": "Why accepted two same 5-tuple socket when concurrent connect to the server?", "body": "<p>Connection is added to the map <code>data  map[int]net.Conn</code> when it is established, but when connection is closed it is not removed from the map. So if connection gets closed its port become free and could be reused by an Operation System for next connection. That's a reason why you can see duplicate ports.</p>\n<p>Try to remove port from map when they are get closed.</p>\n"}], "owner": {"reputation": 153, "user_id": 5213297, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-hShPKbRRpU4/AAAAAAAAAAI/AAAAAAAAAA8/Bs25OhDJ8H4/photo.jpg?sz=128", "display_name": "dzdx", "link": "https://stackoverflow.com/users/5213297/dzdx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 613, "favorite_count": 6, "answer_count": 1, "score": 13, "last_activity_date": 1595230553, "creation_date": 1577460875, "last_edit_date": 1578054197, "question_id": 59502881, "link": "https://stackoverflow.com/questions/59502881/why-accepted-two-same-5-tuple-socket-when-concurrent-connect-to-the-server", "title": "Why accepted two same 5-tuple socket when concurrent connect to the server?", "body": "<p>server.go</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"net\"\n    \"net/http\"\n    _ \"net/http/pprof\"\n    \"sync\"\n    \"syscall\"\n)\n\ntype ConnSet struct {\n    data  map[int]net.Conn\n    mutex sync.Mutex\n}\n\nfunc (m *ConnSet) Update(id int, conn net.Conn) error {\n    m.mutex.Lock()\n    defer m.mutex.Unlock()\n    if _, ok := m.data[id]; ok {\n        fmt.Printf(\"add: key %d existed \\n\", id)\n        return fmt.Errorf(\"add: key %d existed \\n\", id)\n    }\n    m.data[id] = conn\n    return nil\n}\n\nvar connSet = &amp;ConnSet{\n    data: make(map[int]net.Conn),\n}\n\nfunc main() {\n    setLimit()\n\n    ln, err := net.Listen(\"tcp\", \":12345\")\n    if err != nil {\n        panic(err)\n    }\n\n    go func() {\n        if err := http.ListenAndServe(\":6060\", nil); err != nil {\n            log.Fatalf(\"pprof failed: %v\", err)\n        }\n    }()\n\n    var connections []net.Conn\n    defer func() {\n        for _, conn := range connections {\n            conn.Close()\n        }\n    }()\n\n    for {\n        conn, e := ln.Accept()\n        if e != nil {\n            if ne, ok := e.(net.Error); ok &amp;&amp; ne.Temporary() {\n                log.Printf(\"accept temp err: %v\", ne)\n                continue\n            }\n\n            log.Printf(\"accept err: %v\", e)\n            return\n        }\n        port := conn.RemoteAddr().(*net.TCPAddr).Port\n        connSet.Update(port, conn)\n        go handleConn(conn)\n        connections = append(connections, conn)\n        if len(connections)%100 == 0 {\n            log.Printf(\"total number of connections: %v\", len(connections))\n        }\n    }\n}\n\nfunc handleConn(conn net.Conn) {\n    io.Copy(ioutil.Discard, conn)\n}\n\nfunc setLimit() {\n    var rLimit syscall.Rlimit\n    if err := syscall.Getrlimit(syscall.RLIMIT_NOFILE, &amp;rLimit); err != nil {\n        panic(err)\n    }\n    rLimit.Cur = rLimit.Max\n    if err := syscall.Setrlimit(syscall.RLIMIT_NOFILE, &amp;rLimit); err != nil {\n        panic(err)\n    }\n\n    log.Printf(\"set cur limit: %d\", rLimit.Cur)\n}\n</code></pre>\n\n<p>client.go</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"flag\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"net\"\n    \"os\"\n    \"strconv\"\n    \"sync\"\n    \"syscall\"\n    \"time\"\n)\n\nvar portFlag = flag.Int(\"port\", 12345, \"port\")\n\ntype ConnSet struct {\n    data  map[int]net.Conn\n    mutex sync.Mutex\n}\n\nfunc (m *ConnSet) Update(id int, conn net.Conn) error {\n    m.mutex.Lock()\n    defer m.mutex.Unlock()\n    if _, ok := m.data[id]; ok {\n        fmt.Printf(\"add: key %d existed \\n\", id)\n        return fmt.Errorf(\"add: key %d existed \\n\", id)\n    }\n    m.data[id] = conn\n    return nil\n}\n\nvar connSet = &amp;ConnSet{\n    data: make(map[int]net.Conn),\n}\n\nfunc echoClient() {\n    addr := fmt.Sprintf(\"127.0.0.1:%d\", *portFlag)\n    dialer := net.Dialer{}\n    conn, err := dialer.Dial(\"tcp\", addr)\n    if err != nil {\n        fmt.Println(\"ERROR\", err)\n        os.Exit(1)\n    }\n    port := conn.LocalAddr().(*net.TCPAddr).Port\n    connSet.Update(port, conn)\n    defer conn.Close()\n\n    for i := 0; i &lt; 10; i++ {\n        s := fmt.Sprintf(\"%s\", strconv.Itoa(i))\n        _, err := conn.Write([]byte(s))\n        if err != nil {\n            log.Println(\"write error: \", err)\n        }\n        b := make([]byte, 1024)\n        _, err = conn.Read(b)\n        switch err {\n        case nil:\n            if string(bytes.Trim(b, \"\\x00\")) != s {\n                log.Printf(\"resp req not equal, req: %d, res: %s\", i, string(bytes.Trim(b, \"\\x00\")))\n            }\n        case io.EOF:\n            fmt.Println(\"eof\")\n            break\n        default:\n            fmt.Println(\"ERROR\", err)\n            break\n        }\n    }\n    time.Sleep(time.Hour)\n    if err := conn.Close(); err != nil {\n        log.Printf(\"client conn close err: %s\", err)\n    }\n}\n\nfunc main() {\n    flag.Parse()\n    setLimit()\n    before := time.Now()\n    var wg sync.WaitGroup\n    for i := 0; i &lt; 20000; i++ {\n        wg.Add(1)\n        go func() {\n            defer wg.Done()\n            echoClient()\n        }()\n    }\n    wg.Wait()\n    fmt.Println(time.Now().Sub(before))\n}\n\nfunc setLimit() {\n    var rLimit syscall.Rlimit\n    if err := syscall.Getrlimit(syscall.RLIMIT_NOFILE, &amp;rLimit); err != nil {\n        panic(err)\n    }\n    rLimit.Cur = rLimit.Max\n    if err := syscall.Setrlimit(syscall.RLIMIT_NOFILE, &amp;rLimit); err != nil {\n        panic(err)\n    }\n\n    log.Printf(\"set cur limit: %d\", rLimit.Cur)\n}\n</code></pre>\n\n<p>running command</p>\n\n<pre><code>go run server.go\n---\ngo run client.go\n</code></pre>\n\n<p>server running screenshot</p>\n\n<p><a href=\"https://i.stack.imgur.com/R9Nue.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/R9Nue.png\" alt=\"enter image description here\"></a></p>\n\n<p>The client simultaneously initiates 20,000 connections to the server, and the server accepted two remotePort connections that are exactly the same (in a extremely short period of time).</p>\n\n<p>I try to use <a href=\"https://gist.github.com/ariesdevil/408e102a8e61d2371fabaf6a3155cf80\" rel=\"noreferrer\">tcpconn.py</a> from bcc (patched from <a href=\"https://github.com/iovisor/bcc/blob/master/tools/tcpconnect.py\" rel=\"noreferrer\">tcpconnect.py</a> by add skc_num(aka: local_port)) \n<a href=\"https://i.stack.imgur.com/EkPw6.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/EkPw6.png\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://github.com/iovisor/bcc/blob/master/tools/tcpaccept.py\" rel=\"noreferrer\">tcpaccept.py</a> \n<a href=\"https://i.stack.imgur.com/Z7k6j.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/Z7k6j.png\" alt=\"enter image description here\"></a>\ntracing the connection, and also finds that the remote port is duplicated on the server side when there is no duplicate on the client side</p>\n\n<p>In my understanding, the 5-tuple of the socket will not be duplicated, Why the server accepted two sockets with exactly the same remote port?</p>\n\n<p>My test environment: </p>\n\n<p>Fedora 31, kernel version 5.3.15 x86_64\nand\nUbuntu 18.04.3 LTS, kernel version 4.19.1 x86_64</p>\n\n<p>go version go1.13.5 linux/amd64</p>\n\n<p>wireshark:\nserver TCP Keep-Alive to both ACK &amp; PSH+ACK\n<img src=\"https://i.stack.imgur.com/wG4yn.png\" alt=\"dup flow\"></p>\n\n<p>server TCP Keep-Alive to PSH+ACK only\n<img src=\"https://i.stack.imgur.com/fX4bC.png\" alt=\"no dup\"></p>\n"}, {"tags": ["json", "go", "type-assertion"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1577461809, "post_id": 59502850, "comment_id": 105178391, "body": "Based purely on the short sample data in your code, your data seems to have no consistent structure. If that&#39;s the case, there&#39;s nothing you can really do beyond unmarshaling into <code>interface{}</code> and using type switches/assertions to work with the data."}], "answers": [{"tags": [], "owner": {"reputation": 327, "user_id": 5177327, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oE7n0.png?s=128&g=1", "display_name": "Donutloop", "link": "https://stackoverflow.com/users/5177327/donutloop"}, "is_accepted": true, "score": 0, "last_activity_date": 1577656904, "creation_date": 1577656904, "answer_id": 59523678, "question_id": 59502850, "link": "https://stackoverflow.com/questions/59502850/simpler-way-to-type-assert-a-two-dimensional-interface-array-from-json-unmarshal/59523678#59523678", "title": "Simpler way to type assert a two-dimensional interface array from json unmarshal", "body": "<p>Solution 1:</p>\n\n<p>You need to apply twice an assertion on your empty interface{} type.</p>\n\n<p><a href=\"https://i.stack.imgur.com/usdUi.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/usdUi.png\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://play.golang.org/p/AeV6_fC3vYI\" rel=\"nofollow noreferrer\">https://play.golang.org/p/AeV6_fC3vYI</a></p>\n"}], "owner": {"reputation": 734, "user_id": 2830988, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/dec32076f11ec3ed1fa78e7b8c515337?s=128&d=identicon&r=PG&f=1", "display_name": "AngryYogurt", "link": "https://stackoverflow.com/users/2830988/angryyogurt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "accepted_answer_id": 59523678, "answer_count": 1, "score": 0, "last_activity_date": 1577656904, "creation_date": 1577460722, "question_id": 59502850, "link": "https://stackoverflow.com/questions/59502850/simpler-way-to-type-assert-a-two-dimensional-interface-array-from-json-unmarshal", "title": "Simpler way to type assert a two-dimensional interface array from json unmarshal", "body": "<p>I need to unmarshal a complex json data with a [][]interface{} array in it. I want to use more abstract struct type to unmarshal it, but Golang can only recognize it as []interface{}.</p>\n\n<p>example code:</p>\n\n<pre><code>// I want to use this, but not work\nvar r1 = struct {\n    Data map[string]interface{}\n}{}\n\n// Works well, but too complex if data nest much\nvar r2 = struct {\n    Data struct{\n        P1 int64\n        P2 [][]interface{}\n    }\n}{}\n\njsonData := []byte(`{\"data\" :{\"p1\": 0, \"p2\":[[\"1\", null], [\"2\", null] ]}}`)\n\njson.Unmarshal (jsonData, &amp;r1)\n_, ok := r1.Data[\"p2\"].([][]interface{})\nfmt.Println(ok)\n\nfmt.Println(\"======\")\n\n_, ok = r1.Data[\"p2\"].([]interface{})\nfmt.Println(ok)\n\nfmt.Println(\"======\")\n\njson.Unmarshal (jsonData, &amp;r2)\nfmt.Println(r2.Data.P2)\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>false\n======\ntrue\n======\n[[1 &lt;nil&gt;] [2 &lt;nil&gt;]]\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1369, "user_id": 2730233, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GDPoY.jpg?s=128&g=1", "display_name": "Lucio Mollinedo", "link": "https://stackoverflow.com/users/2730233/lucio-mollinedo"}, "edited": false, "score": 1, "creation_date": 1577459491, "post_id": 59502588, "comment_id": 105177560, "body": "Your question is not clear. Please rephrase it."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1577461863, "post_id": 59502588, "comment_id": 105178414, "body": "<a href=\"https://tour.golang.org/moretypes/16\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/16</a>"}, {"owner": {"reputation": 15, "user_id": 11116793, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UM5-EXoQowI/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOBIazP7dFG0nUmG_UyDC2PkvIhOA/mo/photo.jpg?sz=128", "display_name": "aaron anderson", "link": "https://stackoverflow.com/users/11116793/aaron-anderson"}, "edited": false, "score": 0, "creation_date": 1577669443, "post_id": 59502588, "comment_id": 105220514, "body": "Function random.Perm() generates a slice, random numbers obviously, try to iterate through the slice, they are in order, why?"}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 11116793, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UM5-EXoQowI/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOBIazP7dFG0nUmG_UyDC2PkvIhOA/mo/photo.jpg?sz=128", "display_name": "aaron anderson", "link": "https://stackoverflow.com/users/11116793/aaron-anderson"}, "edited": false, "score": 0, "creation_date": 1577669398, "post_id": 59502915, "comment_id": 105220506, "body": "I know that I mean the function random.Perm() generate some random values, unordered, but I while I iterate through the slice, they are in order!"}], "tags": [], "owner": {"reputation": 11096, "user_id": 2749717, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46af1ef54856d737d52b7667afd240ee?s=128&d=identicon&r=PG&f=1", "display_name": "bipll", "link": "https://stackoverflow.com/users/2749717/bipll"}, "is_accepted": false, "score": 5, "last_activity_date": 1577461004, "creation_date": 1577461004, "answer_id": 59502915, "question_id": 59502588, "link": "https://stackoverflow.com/questions/59502588/slice-automatically-be-sorted/59502915#59502915", "title": "Slice automatically be sorted?", "body": "<p><code>range</code> returns an index as the first value for an array or slice, which always goes from 0 up to <code>len - 1</code>. Use <code>for _, num := range sli {</code> if you want to iterate over the values themselves rather than the set of indices.</p>\n"}], "owner": {"reputation": 15, "user_id": 11116793, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-UM5-EXoQowI/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOBIazP7dFG0nUmG_UyDC2PkvIhOA/mo/photo.jpg?sz=128", "display_name": "aaron anderson", "link": "https://stackoverflow.com/users/11116793/aaron-anderson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1577576315, "creation_date": 1577459319, "last_edit_date": 1577576315, "question_id": 59502588, "link": "https://stackoverflow.com/questions/59502588/slice-automatically-be-sorted", "title": "Slice automatically be sorted?", "body": "<p>While I want to create my own pipeline to practice with goroutines, there's something particularly weird.\nI use the random perm function to generate some int numbers, randomly obviously, I write them to IO writer and then read them form IO reader, cuz its binary source so I print them and they are sorted!!</p>\n\n<p>Here's the code:</p>\n\n<pre><code>func RandomSource(tally int) chan int {\n    out := make(chan int)\n    sli := rand.Perm(tally)\n    fmt.Println(sli)\n    go func() {\n        for num := range sli {\n            out &lt;- num\n        }\n        close(out)\n    }()\n    return out\n}\n</code></pre>\n\n<pre><code>func ReaderSource(reader io.Reader) chan int {\n    out := make(chan int)\n    go func() {\n        buffer := make([]byte, 8)\n        for ; ; {\n            n, err := reader.Read(buffer)\n            if n &gt; 0 {\n                v := int(binary.BigEndian.Uint64(buffer))\n                out &lt;- v\n            }\n            if err != nil {\n                break\n            }\n        }\n        close(out)\n    }()\n    return out\n}\n</code></pre>\n\n<pre><code>func WriterSink(writer io.Writer, in chan int) {\n    for v := range in {\n        buffer := make([]byte, 8)\n        binary.BigEndian.PutUint64(\n            buffer, uint64(v))\n        writer.Write(buffer)\n    }\n}\n</code></pre>\n\n<pre><code>func main() {\n    fileName := \"small.in\"\n    file, err := os.Create(fileName)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer file.Close()\n\n    p := RandomSource(500)\n    WriterSink(file, p)\n\n    file, err = os.Open(fileName)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer file.Close()\n\n    p = ReaderSource(file)\n    for v := range p {\n        fmt.Println(v)\n    }\n}\n</code></pre>\n"}, {"tags": ["pointers", "go"], "answers": [{"tags": [], "owner": {"reputation": 114, "user_id": 3464082, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09516fd5e14b754405f97fadfd0757b?s=128&d=identicon&r=PG&f=1", "display_name": "bgnfu7re", "link": "https://stackoverflow.com/users/3464082/bgnfu7re"}, "is_accepted": false, "score": 3, "last_activity_date": 1577456288, "creation_date": 1577456288, "answer_id": 59502042, "question_id": 59501788, "link": "https://stackoverflow.com/questions/59501788/convert-string-pointer-to-string-with-empty-string-for-nil/59502042#59502042", "title": "Convert string pointer to string with empty string for nil", "body": "<p>The way you wrote it is the shortest way.</p>\n\n<p>The question though why the func requires strings as pointers?</p>\n\n<p>It seems that you're trying to solve the problem with optional parameters. <code>database.AllDataPointsMetricVolumes</code> function already allows an empty string. So, if you pass value instead of pointers, you can obsolete the function and use the <code>database.AllDataPointsMetricVolumes</code> directly.</p>\n"}], "owner": {"reputation": 662, "user_id": 1887912, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/cb3aa8025d2e06f2adac3f3a8a6388de?s=128&d=identicon&r=PG", "display_name": "JonB", "link": "https://stackoverflow.com/users/1887912/jonb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 185, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1577456542, "creation_date": 1577454826, "last_edit_date": 1577456197, "question_id": 59501788, "link": "https://stackoverflow.com/questions/59501788/convert-string-pointer-to-string-with-empty-string-for-nil", "title": "Convert string pointer to string with empty string for nil", "body": "<p>I have a func. that takes in two variables as string pointers, these parameters need to be passed to another func. but I need to convert the them to strings, with empty string <code>\"\"</code> if it's a nil pointer, I have achieved this, but find my version cumbersome. How can it be simplified / prettified ? </p>\n\n<pre><code>func allMetricVolumes(start, end *string, measuredType []string, volumeUUID string) []*models.ResourceMetrics {\n    var startStr = \"\"\n    if start != nil {\n        startStr = *start\n    }\n\n    var endStr = \"\"\n    if end != nil {\n        endStr = *end\n    }\n\n    return database.AllDataPointsMetricVolumes(startStr, endStr, measuredType, volumeUUID)\n}\n</code></pre>\n\n<p><strong>EDIT:</strong></p>\n\n<p>This is also an option that I came up with, just to create a helper func. but the main argument still stands though, that if it can be shorter?</p>\n\n<pre><code>func stringPointerToString(input *string) string {\n    if input != nil {\n        return *input\n    }\n    return \"\"\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 2, "creation_date": 1577447266, "post_id": 59500237, "comment_id": 105173089, "body": "Your backend is fine; modify your client so that you throw an error on if <code>!res.ok</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1577457504, "post_id": 59500237, "comment_id": 105176744, "body": "<code>fetch</code> does not <code>throw</code> in this case because the request didn&#39;t fail. It returned a response, and that response was a status code 400 with a response body. If you want to treat that as a failure, you&#39;ll need to do so in your own logic."}], "answers": [{"tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": false, "score": 3, "last_activity_date": 1577448857, "creation_date": 1577448857, "answer_id": 59500691, "question_id": 59500237, "link": "https://stackoverflow.com/questions/59500237/how-do-you-make-a-fetch-call-in-js-catch-from-a-go-server/59500691#59500691", "title": "How do you make a fetch call in JS catch from a Go server?", "body": "<blockquote>\n  <p>A <code>fetch()</code> promise will reject with a <code>TypeError</code> <strong>when a network\n  error is encountered</strong> or CORS is misconfigured on the server-side,\n  although this usually means permission issues or similar \u2014 a 404 does\n  not constitute a network error, for example. An accurate check for a\n  successful <code>fetch()</code> would include checking that the promise resolved,\n  then checking that the <code>Response.ok</code> property has a value of true.</p>\n</blockquote>\n\n<p><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch#Checking_that_the_fetch_was_successful\" rel=\"nofollow noreferrer\">Per MDN</a></p>\n"}], "owner": {"reputation": 3009, "user_id": 4975090, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/95acff6227d6efe0c2f5fcb265ed9639?s=128&d=identicon&r=PG&f=1", "display_name": "sdfsdf", "link": "https://stackoverflow.com/users/4975090/sdfsdf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1577576332, "creation_date": 1577446744, "last_edit_date": 1577576332, "question_id": 59500237, "link": "https://stackoverflow.com/questions/59500237/how-do-you-make-a-fetch-call-in-js-catch-from-a-go-server", "title": "How do you make a fetch call in JS catch from a Go server?", "body": "<p>I have a JS frontend and a Go backend. On the server, when I respond with an error, I use</p>\n\n<pre><code>http.Error(w, `{\"err\":\"bad request\"}`, http.StatusBadRequest)\n</code></pre>\n\n<p>and on my frontend, I have</p>\n\n<pre><code>fetch(`${API_URL}/dosomething`)\n  .then(res =&gt; res.json())\n  .then(data =&gt; console.log('data', data))\n  .catch(err =&gt; console.log('err', err));\n</code></pre>\n\n<p>The error is sent over just fine, but the fetch call in JS does not catch. The <code>err</code> object just gets passed to <code>.then(data =&gt; console.log('data', data))</code>. What should I do on my server to make the fetch call catch with a string for an <code>err</code> value (so I don't have to respond with json).</p>\n"}, {"tags": ["sql-server", "go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "edited": false, "score": 0, "creation_date": 1577446833, "post_id": 59500008, "comment_id": 105172914, "body": "Thanks for your response. After adding <code>db.SingularTable(true)</code>, this error is resolved - <code>Invalid object name &#39;currencies&#39;</code>. However, I am not getting any rows in the response."}, {"owner": {"reputation": 6381, "user_id": 12354911, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Sz0V.jpg?s=128&g=1", "display_name": "Eldar", "link": "https://stackoverflow.com/users/12354911/eldar"}, "reply_to_user": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "edited": false, "score": 0, "creation_date": 1577446983, "post_id": 59500008, "comment_id": 105172972, "body": "@RahulSatal find may expect an array to be passed. Find will find all objects in the table. You can try using <code>first</code> method or pass an array of <code>Currency</code>"}, {"owner": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "edited": false, "score": 0, "creation_date": 1577447019, "post_id": 59500008, "comment_id": 105172986, "body": "After using the function <code>TableName</code>. I am getting another error - <code>unsupported destination, should be slice or struct.</code> I may not be using the function correctly. You can see my code here - <a href=\"https://play.golang.org/p/g9fwRcq-pQw\" rel=\"nofollow noreferrer\">play.golang.org/p/g9fwRcq-pQw</a>"}, {"owner": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "edited": false, "score": 0, "creation_date": 1577451026, "post_id": 59500008, "comment_id": 105174433, "body": "Thanks for the code. However, from the above code I am getting empty string with no error as - <code>[{CurrencyId:0 Code: Description: CreateDate:0001-01-01 00:00:00 +0000 UTC}]</code>"}, {"owner": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "edited": false, "score": 0, "creation_date": 1577451311, "post_id": 59500008, "comment_id": 105174535, "body": "Also, with <code>var Currency Currency</code> and <code>db.First(&amp;Currency)</code> . I am getting this error - <code>mssql: Invalid usage of the option NEXT in the FETCH statement.</code>"}, {"owner": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "edited": false, "score": 0, "creation_date": 1577451674, "post_id": 59500008, "comment_id": 105174663, "body": "When I add some options like `\tdb.First(&amp;Currency).Order(&quot;Code&quot;).Limit(2).Offset(0)` I don&#39;t get any error, but still the response is empty."}, {"owner": {"reputation": 6381, "user_id": 12354911, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Sz0V.jpg?s=128&g=1", "display_name": "Eldar", "link": "https://stackoverflow.com/users/12354911/eldar"}, "reply_to_user": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "edited": false, "score": 0, "creation_date": 1577452649, "post_id": 59500008, "comment_id": 105174987, "body": "@RahulSatal For <code>first</code> method gorm has an unresolved <a href=\"https://github.com/jinzhu/gorm/issues/1205\" rel=\"nofollow noreferrer\">issue</a>. As SQL server expects and order by phrase to make fetch work. And try to log sql query generated by gorm and execute query somewhere else (Visualstudio or SSMS) see how it results"}, {"owner": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "edited": false, "score": 0, "creation_date": 1577453133, "post_id": 59500008, "comment_id": 105175148, "body": "Using <code>First</code> with debug I am getting this query - <code>SELECT * FROM [currency]  OFFSET 0 LIMIT 1 ROWS FETCH NEXT 1 ROWS ONLY</code> which is invalid on SSMS and giving same error as - <code>Invalid usage of the option NEXT in the FETCH statement.</code>"}, {"owner": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "edited": false, "score": 0, "creation_date": 1577453302, "post_id": 59500008, "comment_id": 105175223, "body": "Using <code>db.Debug().Find(&amp;Currency)</code> I am getting this output <code>[1 rows affected or returned ]</code> . However again the response is empty. Any clue?"}, {"owner": {"reputation": 6381, "user_id": 12354911, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Sz0V.jpg?s=128&g=1", "display_name": "Eldar", "link": "https://stackoverflow.com/users/12354911/eldar"}, "reply_to_user": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "edited": false, "score": 0, "creation_date": 1577458902, "post_id": 59500008, "comment_id": 105177336, "body": "@RahulSatal After making my own tests i managed to reproduce your issues. It seems gorm fails to throw the right exception. The case you are having occurs when your property names don&#39;t match the database exactly. Check your property names or  use annotations to configure your property names : <code>type User struct {\t \tMail string</code> <code>gorm:&quot;column:EMail&quot;</code> }`"}, {"owner": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "edited": false, "score": 0, "creation_date": 1577541297, "post_id": 59500008, "comment_id": 105194781, "body": "Yes, It is always creating the wrong SQL statement. It is creating <code>SELECT * FROM [currency]</code> but it should be <code>SELECT * FROM IMBookingApp.dbo.currency</code>. I am quitting from GORM. I will manually use the <code>&quot;database&#47;sql&quot;</code> package. Thanks for your help @Eldar."}, {"owner": {"reputation": 6381, "user_id": 12354911, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Sz0V.jpg?s=128&g=1", "display_name": "Eldar", "link": "https://stackoverflow.com/users/12354911/eldar"}, "reply_to_user": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "edited": false, "score": 0, "creation_date": 1577541911, "post_id": 59500008, "comment_id": 105194936, "body": "@rahul <code>gorm.DefaultTableNameHandler = func(dbVeiculosGorm *gorm.DB, defaultTableName string) string {     return &quot;your schema name.&quot; + defaultTableName }</code> you can use this function to manually set your schema"}], "tags": [], "owner": {"reputation": 6381, "user_id": 12354911, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Sz0V.jpg?s=128&g=1", "display_name": "Eldar", "link": "https://stackoverflow.com/users/12354911/eldar"}, "is_accepted": true, "score": 2, "last_activity_date": 1577448526, "last_edit_date": 1577448526, "creation_date": 1577445469, "answer_id": 59500008, "question_id": 59499577, "link": "https://stackoverflow.com/questions/59499577/unable-to-query-data-from-sql-server-using-golang-getting-error-invalid-objec/59500008#59500008", "title": "Unable to query data from SQL Server using Golang - Getting error &quot;Invalid object name&quot;", "body": "<p>If you check your error <code>Invalid object name 'currencies'</code> it tries to find table named <code>currencies</code>. By default gorm pluralizes tables names. If you want a custom table name you can define it like below :</p>\n\n<pre><code>func (Currency) TableName() string {\n    return \"currency\"\n}\n</code></pre>\n\n<p>Or you can globally disable it with :</p>\n\n<pre><code>db.SingularTable(true)\n</code></pre>\n\n<p>So you sample should look like this :</p>\n\n<pre><code>type Currency struct {\n    CurrencyId  int\n    Code        string\n    Description string\n    CreateDate  time.Time\n}\n\nfunc (Currency) TableName() string {\n    return \"currency\"\n}\n\n\nfunc main() {\n    db, err := gorm.Open(\"mssql\", \"sqls*******talog=dbo\")\n\n    db.SingularTable(true)\n\n    fmt.Println(\"db.HasTable: Currency:\", db.HasTable(\"ClientUser\"))\n\n    var Currency []Currency \n\n    db.Find(&amp;Currency)\n\n    ....\n}\n\n</code></pre>\n"}], "owner": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 391, "favorite_count": 0, "accepted_answer_id": 59500008, "answer_count": 1, "score": 0, "last_activity_date": 1577448526, "creation_date": 1577443475, "question_id": 59499577, "link": "https://stackoverflow.com/questions/59499577/unable-to-query-data-from-sql-server-using-golang-getting-error-invalid-objec", "title": "Unable to query data from SQL Server using Golang - Getting error &quot;Invalid object name&quot;", "body": "<p>I am trying to query data from SQL Server using Golang and GORM. But I am getting below error:-</p>\n\n<pre><code>DB Connection: &amp;{{{0 0} 0 0 0 0} &lt;nil&gt; &lt;nil&gt; 0 0xc0000a4480 false 0 {0xc0000e5db0} &lt;nil&gt; {{0 0} {&lt;nil&gt;} map[] 0} 0xc00004c5b0 0xaccbe0 0xc00014d0a0 false &lt;nil&gt;}\n\nHasTable- Currency: true\n{CurrencyId:0 Code: Description:}\n\n[35m(C:/Users/RahulBFL/Documents/architechbc/dot net/GORM/main.go:26)[0m\n[33m[2019-12-27 15:56:13][0m [31;1m mssql: Invalid object name 'currencies'. [0m\n</code></pre>\n\n<p>My Table Schema looks like below:-</p>\n\n<pre><code>     Currency\nCurrencyId    int\nCode          char\nDescription   varchar\n</code></pre>\n\n<p>On SSMS, I am successfully able to query the table using the below command</p>\n\n<pre><code>select * from IMBookingApp.dbo.Currency\n</code></pre>\n\n<p>My Golang code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/mssql\"\n)\n\ntype Currency struct {\n    CurrencyId  int\n    Code        string\n    Description string\n}\n\nfunc main() {\n\n    db, err := gorm.Open(\"mssql\", \"sqlserver://USERNAME:PASSWORD@Endpoint:1433?database=DATABASENAME&amp;Initial+Catalog=SCHEMA_NAME\")\n\n    if err != nil {\n        fmt.Println(\"Connection Error:\", err)\n    }\n\n   fmt.Println(\"DB Connection\", db)\n\n\n    fmt.Println(\"HasTable- Currency:\", db.HasTable(\"ClientUser\"))\n\n    var Currency Currency\n    db.Find(&amp;Currency)\n\n    fmt.Printf(\"%+v\\n\", Currency)\n\n    defer db.Close()\n}\n</code></pre>\n\n<p>I don't understand why I am getting the error as  - Invalid object name 'currencies'. Though there is no <strong>currencies</strong> in the schema, there is only <strong>currency</strong>.</p>\n\n<p>Any help will be appreciated.</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 2105, "user_id": 9328497, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/6e011969ef6d71e46b18d76a1e785b6d?s=128&d=identicon&r=PG&f=1", "display_name": "Hide", "link": "https://stackoverflow.com/users/9328497/hide"}, "edited": false, "score": 0, "creation_date": 1577453671, "post_id": 59500363, "comment_id": 105175338, "body": "You&#39;re right. Anyway, where should I close db connection? Is it unnecessary?"}, {"owner": {"reputation": 114, "user_id": 3464082, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09516fd5e14b754405f97fadfd0757b?s=128&d=identicon&r=PG&f=1", "display_name": "bgnfu7re", "link": "https://stackoverflow.com/users/3464082/bgnfu7re"}, "reply_to_user": {"reputation": 2105, "user_id": 9328497, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/6e011969ef6d71e46b18d76a1e785b6d?s=128&d=identicon&r=PG&f=1", "display_name": "Hide", "link": "https://stackoverflow.com/users/9328497/hide"}, "edited": false, "score": 0, "creation_date": 1577455633, "post_id": 59500363, "comment_id": 105176028, "body": "It is a good practice to close connections. Here, it seems that you want to close the connection when the app exits. The solution here would be to wire a connection in the application entry point and defer closing the connection."}], "tags": [], "owner": {"reputation": 114, "user_id": 3464082, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09516fd5e14b754405f97fadfd0757b?s=128&d=identicon&r=PG&f=1", "display_name": "bgnfu7re", "link": "https://stackoverflow.com/users/3464082/bgnfu7re"}, "is_accepted": true, "score": 2, "last_activity_date": 1577447303, "creation_date": 1577447303, "answer_id": 59500363, "question_id": 59498408, "link": "https://stackoverflow.com/questions/59498408/gorm-invalid-memory-address-or-nil-pointer-dereference/59500363#59500363", "title": "gorm invalid memory address or nil pointer dereference", "body": "<p>The stack trace refers to the file <code>controllers.go:18</code>, which you didn't include here.</p>\n\n<p>The <code>db.go</code> has an issue in the <code>Init()</code> function. You're closing the connection to the database once the function completes. Also, it seems that you're misunderstanding the behavior of <code>defer</code> keyword as you're using it at the end of the function.</p>\n"}], "owner": {"reputation": 2105, "user_id": 9328497, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/6e011969ef6d71e46b18d76a1e785b6d?s=128&d=identicon&r=PG&f=1", "display_name": "Hide", "link": "https://stackoverflow.com/users/9328497/hide"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 676, "favorite_count": 0, "accepted_answer_id": 59500363, "answer_count": 1, "score": 0, "last_activity_date": 1578636011, "creation_date": 1577437805, "last_edit_date": 1578636011, "question_id": 59498408, "link": "https://stackoverflow.com/questions/59498408/gorm-invalid-memory-address-or-nil-pointer-dereference", "title": "gorm invalid memory address or nil pointer dereference", "body": "<p>I'm new at golang and gorm framework.</p>\n\n<p>Here is my code that I used gorm to fetch database.</p>\n\n<p><strong>db.go</strong></p>\n\n<pre><code>package db\n\nimport (\n    \"fmt\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/lib/pq\"\n    \"github.com/teamhide/hfive_go/users\"\n    \"log\"\n)\n\nconst (\n    DbHost     = \"localhost\"\n    DbPort     = \"5432\"\n    DbUser     = \"1\"\n    DbPassword = \"1\"\n    DbName     = \"1\"\n)\n\nvar db *gorm.DB\nvar err error\n\nfunc Init() {\n    db, err = gorm.Open(\n        \"postgres\",\n        fmt.Sprintf(\n            \"host=%s port=%s user=%s dbname=%s password=%s sslmode=disable\",\n            DbHost,\n            DbPort,\n            DbUser,\n            DbName,\n            DbPassword,\n        ),\n    )\n    if err != nil {\n        log.Fatal(err.Error())\n    }\n    db.AutoMigrate(&amp;users.User{})\n    defer db.Close()\n}\n\nfunc GetDB() *gorm.DB {\n    return db\n}\n</code></pre>\n\n<p><strong>users/usecase.go</strong></p>\n\n<pre><code>package users\n\nimport (\n    \"fmt\"\n\n    \"github.com/teamhide/gin_boilerplate/db\"\n)\n\ntype UserUsecase interface {\n    RegisterUserUsecase(email, password1, password2 string) (bool, error)\n}\n\nfunc RegisterUserUsecase(email, password1, password2 string) (bool, error) {\n    db := db.GetDB()\n    fmt.Println(db)\n    return true, nil\n}\n</code></pre>\n\n<p>In usecase, as you know that I just printed db variable to check it has proper db data.</p>\n\n<p>But when I execute it, it throw errors.</p>\n\n<pre><code>...\nruntime error: invalid memory address or nil pointer dereference\n...\n/Users/hide/go/src/github.com/teamhide/hfive_go/users/controllers.go:18 (0x15b3301)\n        UserController.RegisterDefaultUser: uc.RegisterUserUsecase(form.Email, form.Password1, \nform.Password2)\n...\n</code></pre>\n\n<p>Is there any problem with my code?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 5620328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7c210452c728c4d69aa30884b5855bc?s=128&d=identicon&r=PG&f=1", "display_name": "bst19", "link": "https://stackoverflow.com/users/5620328/bst19"}, "edited": false, "score": 0, "creation_date": 1577452639, "post_id": 59499266, "comment_id": 105174983, "body": "thx for answer. Yes, I saw this package, but what interesting for me in this example is how can i optimize response time using goexpect, to be exact what timeout should i set as parameter to Spawn method. or maybe I can tell that telnet is closed from some field of result object *GExpect"}], "tags": [], "owner": {"reputation": 102, "user_id": 12603592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KXTp8.jpg?s=128&g=1", "display_name": "PatrickMahomes", "link": "https://stackoverflow.com/users/12603592/patrickmahomes"}, "is_accepted": false, "score": 0, "last_activity_date": 1577442180, "creation_date": 1577442180, "answer_id": 59499266, "question_id": 59498351, "link": "https://stackoverflow.com/questions/59498351/goexpect-fastest-way-to-check-if-telnet-is-open/59499266#59499266", "title": "goexpect, fastest way to check if telnet is open", "body": "<p>This worked for me after getting the github.com/reiver/go-telnet package:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/reiver/go-telnet\"\n)\n\nfunc main() {\n    address := \"127.0.0.1:8080\"\n    _, err := telnet.DialTo(address)\n    if err != nil {\n        fmt.Println(err)\n        fmt.Println(\"Telnet closed\")\n    } else {\n        fmt.Println(\"Telnet open\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 5620328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7c210452c728c4d69aa30884b5855bc?s=128&d=identicon&r=PG&f=1", "display_name": "bst19", "link": "https://stackoverflow.com/users/5620328/bst19"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 214, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1577442180, "creation_date": 1577437513, "last_edit_date": 1577438530, "question_id": 59498351, "link": "https://stackoverflow.com/questions/59498351/goexpect-fastest-way-to-check-if-telnet-is-open", "title": "goexpect, fastest way to check if telnet is open", "body": "<p>I'm using goexpect for connection to multiple wi-fi access points.\nFor some of them I need to use telnet, and SSH for others.</p>\n\n<p>So, I need fastest way to check if telnet is open for some IP.</p>\n\n<p>Code now looks like</p>\n\n<pre><code>e, _, err := expect.Spawn(fmt.Sprintf(\"telnet %s\", ip), -1)\nres, _, err := e.Expect(userRE, timeout) // we expect user prompt\n    if err != nil {\n        // if timeout, pass control to code block which handle SSH connection\n    }\n</code></pre>\n\n<p>I suppose there is a better and faster way to tell if telnet is open.\nAny suggestions?</p>\n"}, {"tags": ["go", "go-modules"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 11284182, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/477cf2f5d1babdba723d5a635cc8b3a7?s=128&d=identicon&r=PG&f=1", "display_name": "Y.Lu", "link": "https://stackoverflow.com/users/11284182/y-lu"}, "edited": false, "score": 0, "creation_date": 1577449553, "post_id": 59498410, "comment_id": 105173870, "body": "But the second line is the hash of the only the module version&#39;s go.mod file. If it is just a normal package that is not opted in go module, it means that this package does not have a go.mod file. So how to calculate the hash of &quot;go.mod file&quot; of this package?"}], "tags": [], "owner": {"reputation": 1893, "user_id": 2223260, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/c5071efdc4b75172b161f42f9758a019?s=128&d=identicon&r=PG", "display_name": "anshuVersatile", "link": "https://stackoverflow.com/users/2223260/anshuversatile"}, "is_accepted": false, "score": 0, "last_activity_date": 1577437808, "creation_date": 1577437808, "answer_id": 59498410, "question_id": 59496488, "link": "https://stackoverflow.com/questions/59496488/why-i-use-golang-module-and-import-a-module-that-is-not-opted-in-module-but-go/59498410#59498410", "title": "why I use golang module, and import a module that is not opted in module, but go.sum file has go.mod file hash?", "body": "<p><code>go.sum</code> contains the expected cryptographic checksums\nof the content of specific module versions. Each time a dependency is\nused, its checksum is added to go.sum if missing or else required to match\nthe existing entry in go.sum.</p>\n\n<p>Every package/module is dependency and every dependency mean to be maintained with checksums in <code>go.sum</code> so whether it is package or module it would be maintained.</p>\n\n<p>The sources would be downloaded in <code>$GOPATH/src</code> directory accordingly.</p>\n\n<p>TRY - </p>\n"}, {"comments": [{"owner": {"reputation": 11, "user_id": 11284182, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/477cf2f5d1babdba723d5a635cc8b3a7?s=128&d=identicon&r=PG&f=1", "display_name": "Y.Lu", "link": "https://stackoverflow.com/users/11284182/y-lu"}, "edited": false, "score": 0, "creation_date": 1577450263, "post_id": 59500761, "comment_id": 105174144, "body": "But the second line is the hash of the only the module version&#39;s go.mod file. If it is just a normal package that is not opted in go module, it means that this package does not have a go.mod file. So how to calculate the hash of &quot;go.mod file&quot; of this package?"}], "tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": false, "score": 0, "last_activity_date": 1577449268, "creation_date": 1577449268, "answer_id": 59500761, "question_id": 59496488, "link": "https://stackoverflow.com/questions/59496488/why-i-use-golang-module-and-import-a-module-that-is-not-opted-in-module-but-go/59500761#59500761", "title": "why I use golang module, and import a module that is not opted in module, but go.sum file has go.mod file hash?", "body": "<p>Cause in into the <code>go.sum</code> file are written EVERY dependencies sum hash. The one related to your <code>go.mod</code> file, and the one imported from the modules that you have imported. Try run <code>go mod tidy</code> in order to reduce the imported modules, your <code>go.mod</code> file will contains some <code>//indirect</code> import, that are the one that your imported modules use internally.</p>\n"}, {"tags": [], "owner": {"reputation": 964, "user_id": 2752670, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BUkkv.jpg?s=128&g=1", "display_name": "vikyd", "link": "https://stackoverflow.com/users/2752670/vikyd"}, "is_accepted": false, "score": 0, "last_activity_date": 1583141037, "creation_date": 1583141037, "answer_id": 60485792, "question_id": 59496488, "link": "https://stackoverflow.com/questions/59496488/why-i-use-golang-module-and-import-a-module-that-is-not-opted-in-module-but-go/60485792#60485792", "title": "why I use golang module, and import a module that is not opted in module, but go.sum file has go.mod file hash?", "body": "<p>Maybe the Golang source code can explain the reason:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (r *codeRepo) legacyGoMod(rev, dir string) []byte {\n    // We used to try to build a go.mod reflecting pre-existing\n    // package management metadata files, but the conversion\n    // was inherently imperfect (because those files don't have\n    // exactly the same semantics as go.mod) and, when done\n    // for dependencies in the middle of a build, impossible to\n    // correct. So we stopped.\n    // Return a fake go.mod that simply declares the module path.\n    return []byte(fmt.Sprintf(\"module %s\\n\", modfile.AutoQuote(r.modPath)))\n}\n</code></pre>\n\n<p>code from here: <a href=\"https://github.com/golang/go/blob/acac535c3ca571beeb168c953d6d672f61387ef1/src/cmd/go/internal/modfetch/coderepo.go#L857\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/acac535c3ca571beeb168c953d6d672f61387ef1/src/cmd/go/internal/modfetch/coderepo.go#L857</a></p>\n\n<p>\u2193 VSCode open <code>/usr/local/go/src</code>:</p>\n\n<ol>\n<li>locate to <code>cmd/go/internal/modfetch/coderepo.go</code>, add a breakpoint to func <code>legacyGoMod</code></li>\n<li>locate to <code>cmd/go/internal/modfetch/coderepo_test.go</code>, press F5</li>\n<li>wait for a while, stop at the breakpoint</li>\n</ol>\n\n<p><a href=\"https://i.stack.imgur.com/1QEWF.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/1QEWF.jpg\" alt=\"VSCode debug Golang source code\"></a></p>\n"}], "owner": {"reputation": 11, "user_id": 11284182, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/477cf2f5d1babdba723d5a635cc8b3a7?s=128&d=identicon&r=PG&f=1", "display_name": "Y.Lu", "link": "https://stackoverflow.com/users/11284182/y-lu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2878, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1583141037, "creation_date": 1577425490, "last_edit_date": 1577425870, "question_id": 59496488, "link": "https://stackoverflow.com/questions/59496488/why-i-use-golang-module-and-import-a-module-that-is-not-opted-in-module-but-go", "title": "why I use golang module, and import a module that is not opted in module, but go.sum file has go.mod file hash?", "body": "<p>I am now using golang 1.13 and use go module. </p>\n\n<p>However, when I import a package (for example, a) that is <strong>not</strong> opted in go module, in go.sum file there is still two lines. Go module tells us that \"Each known module version results in two lines in the go.sum file. The first line gives the hash of the module version's file tree. The second line appends \"/go.mod\" to the version and gives the hash of only the module version's (possibly synthesized) go.mod file. The go.mod-only hash allows downloading and authenticating a module version's go.mod file, which is needed to compute the dependency graph, without also downloading all the module's source code.\"</p>\n\n<p>(<a href=\"https://tip.golang.org/cmd/go/#hdr-Module_downloading_and_verification\" rel=\"nofollow noreferrer\">https://tip.golang.org/cmd/go/#hdr-Module_downloading_and_verification</a>). </p>\n\n<p>But this package is not a module, and so it does not have a go.mod file? For example, if I import package call \"github.com/example/a\" that is not a module, in go.sum file, it still has these two lines:</p>\n\n<pre><code>github.com/example/a v0.0.0-20190627063042-31896c4e4162 h1:rSqi2vQEpS+GAFKrLvmxzWW3OGlLI4hANnEf/ib/ofo=\n\ngithub.com/example/a v0.0.0-20190627063042-31896c4e4162/go.mod h1:tcpxll8wcruwpPpWBbjAsWc1JbLHld/v9F+3rgLIr4c=\n</code></pre>\n\n<p>My question is, how the second line generated?</p>\n"}, {"tags": ["java", "go", "jna", "cgo"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1577425572, "post_id": 59495888, "comment_id": 105166486, "body": "You passed 0 as the size, so your malloc call uses <code>0 * sizeof(char *)</code>, which is of course zero. You have therefore done the equivalent of <code>return malloc(0)</code>. Calling C&#39;s <code>malloc</code> with zero can either return NULL, in which case you must not use the pointer, or can return a pointer to a memory area with zero usable bytes. You then use <code>1 * sizeof(char *)</code> of these zero usable bytes to store things."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1577425700, "post_id": 59495888, "comment_id": 105166507, "body": "Meanwhile, as <a href=\"https://stackoverflow.com/a/59496419/1256452\">peterSO noted</a>, now that you have written (e.g.) 4 or 8 bytes to the zero bytes you allocated, you then free the zero bytes you allocated (or call <code>free(NULL)</code> which is a no-op\u2014but if <code>malloc</code> returned <code>NULL</code>, we&#39;ve probably already crashed), and then return the now-invalidated C memory pointer."}, {"owner": {"reputation": 2795, "user_id": 3983547, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4d72b66c4c9b849d2078bb6c8b71fb8a?s=128&d=identicon&r=PG&f=1", "display_name": "dbustosp", "link": "https://stackoverflow.com/users/3983547/dbustosp"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1577444873, "post_id": 59495888, "comment_id": 105172249, "body": "@torek I am sorry, it was a typo when I was writing the question here. I updated and question based on PeterSO answer and your comments here."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1577469526, "post_id": 59495888, "comment_id": 105181170, "body": "Update: the Java documentation says that Java&#39;s <code>String []</code> works like C&#39;s <code>argv</code> so when you build the C argument vector you&#39;ll need a series of <code>char *</code> values that ends with <code>NULL</code>. There&#39;s probably a better way to deal with this, but given what you have so far you&#39;d need to allocate <code>2 * sizeof(char *)</code>, set the one at <code>[0]</code> to a C string, and set the one at <code>[1]</code> to <code>NULL</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2795, "user_id": 3983547, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4d72b66c4c9b849d2078bb6c8b71fb8a?s=128&d=identicon&r=PG&f=1", "display_name": "dbustosp", "link": "https://stackoverflow.com/users/3983547/dbustosp"}, "edited": false, "score": 0, "creation_date": 1577445310, "post_id": 59496419, "comment_id": 105172395, "body": "thanks for your answer. On one hand, you are right, I made a typo when I was writing the question here on SO. On the other hand, I allocated memory and then I removed the &#39;free&#39; sentence to be called afterwards and I still having the same issue. Please see the update."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1577425910, "last_edit_date": 1577425910, "creation_date": 1577424907, "answer_id": 59496419, "question_id": 59495888, "link": "https://stackoverflow.com/questions/59495888/return-string-from-go-using-cgo/59496419#59496419", "title": "Return String[] from Go using cgo", "body": "<p>You write:</p>\n\n<pre><code>func getSearchKeysA() **C.char {\n    set_char := C.cmalloc(0)\n    defer C.free(unsafe.Pointer(set_char))\n    C.setElement(set_char, C.CString(\"hello world\"), C.int(0))\n    return set_char\n}\n</code></pre>\n\n<p>Which likely executes as:</p>\n\n<pre><code>func getSearchKeysA() (retval **C.char) {\n    set_char := C.cmalloc(42)\n    C.setElement(set_char, C.CString(\"hello world\"), C.int(1))\n    retval = set_char\n    C.free(unsafe.Pointer(set_char))\n    return retval\n}\n</code></pre>\n\n<p>Are you referring to <code>set_char</code> after <code>free</code>?</p>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a> Version of July 31,\n  2019</p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"nofollow noreferrer\">Defer statements</a></p>\n  \n  <p>A \"defer\" statement invokes a function whose execution is deferred to\n  the moment the surrounding function returns, either because the\n  surrounding function executed a return statement, reached the end of\n  its function body, or because the corresponding goroutine is\n  panicking.</p>\n</blockquote>\n\n<hr>\n\n<p>You write:</p>\n\n<pre><code>set_char := C.cmalloc(0)\n\nstatic char** cmalloc(int size) {\n    return (char**) malloc(size * sizeof(char*));\n}\n</code></pre>\n\n<blockquote>\n  <p>$ man malloc</p>\n  \n  <p>The malloc() function allocates size bytes and returns a pointer to\n  the\n         allocated memory.  The memory is not initialized.  If size is  0,  then\n         malloc()  returns either NULL, or a unique pointer value that can later\n         be successfully passed to free().</p>\n</blockquote>\n\n<p>Why allocate size 0 (zero)?</p>\n\n<p><code>malloc</code> memory is not initialized.  </p>\n"}, {"tags": [], "owner": {"reputation": 2795, "user_id": 3983547, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4d72b66c4c9b849d2078bb6c8b71fb8a?s=128&d=identicon&r=PG&f=1", "display_name": "dbustosp", "link": "https://stackoverflow.com/users/3983547/dbustosp"}, "is_accepted": true, "score": 1, "last_activity_date": 1577475028, "creation_date": 1577475028, "answer_id": 59505254, "question_id": 59495888, "link": "https://stackoverflow.com/questions/59495888/return-string-from-go-using-cgo/59505254#59505254", "title": "Return String[] from Go using cgo", "body": "<p>I could finally return a <code>String[]</code> from <code>GO</code> using <code>cgo</code>.</p>\n\n<p>I will leave the functions signatures: </p>\n\n<pre><code>//export getSearchKeys\nfunc getSearchKeys(numKeysByReference *C.int) **C.char {\n  *numKeysByReference = // ... some value\n  // Using the C helper defined above\n  set_char := C.cmalloc(*numKeysByReference)\n  // Logic allocating and populating C.char[i .. *numKeysByReference]\n  // ...\n  return set_char\n}\n</code></pre>\n\n<p>After creating the <code>**C.char</code> structure using <code>cgo</code>, on <code>Java</code> side, I am receiving the data as follow: </p>\n\n<pre><code>IntByReference intByReference = new IntByReference();\nPointerByReference array = lib.getSearchKeys(intByReference);\nString[] results = array.getPointer().getStringArray(0, intByReference.getValue());\n</code></pre>\n\n<p>As @PeterSO mentioned, we have call <code>defer C.free()</code> after using it. Otherwise, it will be deallocated after returning.  </p>\n"}], "owner": {"reputation": 2795, "user_id": 3983547, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4d72b66c4c9b849d2078bb6c8b71fb8a?s=128&d=identicon&r=PG&f=1", "display_name": "dbustosp", "link": "https://stackoverflow.com/users/3983547/dbustosp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 1, "accepted_answer_id": 59505254, "answer_count": 2, "score": 1, "last_activity_date": 1577548159, "creation_date": 1577419887, "last_edit_date": 1577548159, "question_id": 59495888, "link": "https://stackoverflow.com/questions/59495888/return-string-from-go-using-cgo", "title": "Return String[] from Go using cgo", "body": "<p>I have to call a Go function from Java. \nI am using <code>cgo</code> and <code>JNA</code> for doing this.</p>\n\n<p>The only thing that the Go routine does is allocating memory and return a <code>char**</code>. From Java side, I am receiving the <code>char**</code> using <code>String[]</code> as is mentioned in the <a href=\"https://github.com/java-native-access/jna/blob/master/www/PointersAndArrays.md\" rel=\"nofollow noreferrer\">documentation</a>.</p>\n\n<p>Below are the details of the C helper and Go functions:</p>\n\n<pre><code>static char** cmalloc(int size) {\n    return (char**) malloc(size * sizeof(char*));\n}\n\nstatic void setElement(char **a, char *s, int index) {\n    a[index] = s;\n}\n\n//export getSearchKeysA\nfunc getSearchKeysA() **C.char {\n    set_char := C.cmalloc(1)\n    defer C.free(unsafe.Pointer(set_char))\n    C.setElement(set_char, C.CString(\"hello world\"), C.int(0))\n    return set_char\n}\n</code></pre>\n\n<p>The Java side: </p>\n\n<pre><code>String[] getSearchKeysA();\n</code></pre>\n\n<p>The error I am getting is: </p>\n\n<pre><code>#\n# A fatal error has been detected by the Java Runtime Environment:\n#\n#  SIGSEGV (0xb) at pc=0x00007fff6b15323e, pid=92979, tid=0x0000000000000c07\n#\n# JRE version: Java(TM) SE Runtime Environment (8.0_192-b12) (build 1.8.0_192-b12)\n# Java VM: Java HotSpot(TM) 64-Bit Server VM (25.192-b12 mixed mode bsd-amd64 compressed oops)\n# Problematic frame:\n# C  [libsystem_kernel.dylib+0x723e]  __pthread_kill+0xa\n#\n# Failed to write core dump. Core dumps have been disabled. To enable core dumping, try \"ulimit -c unlimited\" before starting Java again\n#\n# An error report file with more information is saved as:\n# /Users/dfb3/datafabric/pocs/go-java-connector/hs_err_pid92979.log\n#\n# If you would like to submit a bug report, please visit:\n#   http://bugreport.java.com/bugreport/crash.jsp\n# The crash happened outside the Java Virtual Machine in native code.\n# See problematic frame for where to report the bug.\n#\n</code></pre>\n\n<p><strong>What I have noticed is that the issue appears when malloc is allocating memory.</strong> </p>\n\n<p>I already tried doing <code>ulimit -c unlimited</code> and removing the <code>defer C.free(unsafe.Pointer(set_char))</code> from the method. </p>\n\n<p>What can be the cause of the error and how can I solve it? Is there any other way of returning a <code>[]string</code> from Go using <code>JNA</code>? </p>\n\n<p>Update because of typo and base on @PeterSO answer  :</p>\n\n<ol>\n<li>I wrote initially malloc(0) but it should be malloc(1) </li>\n<li><code>func C.CString(string) *C.char</code>, it should allocate the memory for me, is\nnot?</li>\n</ol>\n"}, {"tags": ["unit-testing", "go", "middleware", "go-chi"], "answers": [{"tags": [], "owner": {"reputation": 35, "user_id": 7281140, "user_type": "registered", "profile_image": "https://graph.facebook.com/707152042785801/picture?type=large", "display_name": "rsmnarts", "link": "https://stackoverflow.com/users/7281140/rsmnarts"}, "is_accepted": false, "score": 0, "last_activity_date": 1577436360, "creation_date": 1577436360, "answer_id": 59498143, "question_id": 59495537, "link": "https://stackoverflow.com/questions/59495537/how-to-do-unit-testing-in-the-case-of-access-log-middleware/59498143#59498143", "title": "How to do unit testing in the case of access log middleware", "body": "<p>solved, this is my code to solve it</p>\n\n<pre><code>package accesslog\n\nimport (\n    \"io\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"net/http/httptest\"\n    \"testing\"\n\n    \"github.com/go-chi/chi\"\n\n    \"transactionService/pkg/log\"\n)\n\nfunc TestHandler(t *testing.T) {\n    logger, _ := log.NewForTest()\n\n    r := chi.NewRouter()\n    r.Use(Handler(logger))\n    r.Get(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        w.WriteHeader(http.StatusOK)\n        _, _ = w.Write([]byte(\"test\"))\n    })\n\n    ts := httptest.NewServer(r)\n    defer ts.Close()\n\n    if resp, body := testRequest(t, ts, \"GET\", \"/\", nil); body != \"root\" &amp;&amp; resp.StatusCode != 200 {\n        t.Fatalf(body)\n    }\n}\n\nfunc testRequest(t *testing.T, ts *httptest.Server, method, path string, body io.Reader) (*http.Response, string) {\n    req, err := http.NewRequest(method, ts.URL+path, body)\n    if err != nil {\n        t.Fatal(err)\n        return nil, \"\"\n    }\n\n    resp, err := http.DefaultClient.Do(req)\n    if err != nil {\n        t.Fatal(err)\n        return nil, \"\"\n    }\n\n    respBody, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        t.Fatal(err)\n        return nil, \"\"\n    }\n    defer resp.Body.Close()\n\n    return resp, string(respBody)\n}\n\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 7281140, "user_type": "registered", "profile_image": "https://graph.facebook.com/707152042785801/picture?type=large", "display_name": "rsmnarts", "link": "https://stackoverflow.com/users/7281140/rsmnarts"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 588, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1577438426, "creation_date": 1577415686, "last_edit_date": 1577438426, "question_id": 59495537, "link": "https://stackoverflow.com/questions/59495537/how-to-do-unit-testing-in-the-case-of-access-log-middleware", "title": "How to do unit testing in the case of access log middleware", "body": "<p>I have a middleware to log this service access. But I'm confused to do the unit testing several times I surfed googling. I have not found the right way to solve this</p>\n\n<pre><code>package accesslog\n\nimport (\n    \"net/http\"\n    \"time\"\n\n    \"github.com/go-chi/chi/middleware\"\n\n    \"transactionService/pkg/log\"\n)\n\nfunc Handler(logger log.Logger) func(next http.Handler) http.Handler {\n    return func(next http.Handler) http.Handler {\n        fn := func(w http.ResponseWriter, r *http.Request) {\n            ctx := r.Context()\n            ctx = log.WithRequest(ctx, r)\n            ww := middleware.NewWrapResponseWriter(w, r.ProtoMajor)\n\n            start := time.Now()\n            defer func() {\n                logger.With(ctx, \"duration\", time.Since(start), \"status\", ww.Status()).\n                    Infof(\"%s %s %s %d %d\", r.Method, r.URL.Path, r.Proto, ww.Status(), ww.BytesWritten())\n            }()\n\n            next.ServeHTTP(ww, r.WithContext(ctx))\n        }\n\n        return http.HandlerFunc(fn)\n    }\n}\n\n\n</code></pre>\n"}, {"tags": ["go", "websocket", "gorilla"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577414411, "post_id": 59495249, "comment_id": 105164616, "body": "This error comes from the server (or a proxy to the server) closing the connection.  There&#39;s insufficient information to answer why the server closes the connection."}, {"owner": {"reputation": 86, "user_id": 11501624, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-X1mfN_NJiMA/AAAAAAAAAAI/AAAAAAAAANk/yIY6-6rKAbw/photo.jpg?sz=128", "display_name": "Quang V&#245;", "link": "https://stackoverflow.com/users/11501624/quang-v%c3%b5"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577414677, "post_id": 59495249, "comment_id": 105164659, "body": "Yes, unfortunately that the server side is belong to a third party. I just connect to them, so I&#39;m trying to figure it out the problem is from the client side or server side"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577414899, "post_id": 59495249, "comment_id": 105164683, "body": "Does the server require the application to send messages to keep the connection open?"}, {"owner": {"reputation": 86, "user_id": 11501624, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-X1mfN_NJiMA/AAAAAAAAAAI/AAAAAAAAANk/yIY6-6rKAbw/photo.jpg?sz=128", "display_name": "Quang V&#245;", "link": "https://stackoverflow.com/users/11501624/quang-v%c3%b5"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577414984, "post_id": 59495249, "comment_id": 105164699, "body": "@CeriseLim&#243;n I have no idea because I don&#39;t have codebase of the server side. But so far, I think it does"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1577415156, "post_id": 59495249, "comment_id": 105164729, "body": "More detail: the 1006 error is returned when read on the connection unexpectedly returns io.EOF.  The io.EOF error is returned when the peer (the server in this case) closes the connection.  The io.EOF error is only expected after the peer cleanly closes the connection by sending a close frame."}, {"owner": {"reputation": 86, "user_id": 11501624, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-X1mfN_NJiMA/AAAAAAAAAAI/AAAAAAAAANk/yIY6-6rKAbw/photo.jpg?sz=128", "display_name": "Quang V&#245;", "link": "https://stackoverflow.com/users/11501624/quang-v%c3%b5"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577415240, "post_id": 59495249, "comment_id": 105164739, "body": "@CeriseLim&#243;n Thanks for your help. I think so too, and if that&#39;s the case then nothing I can do but open a new connection which is kinda costly ..."}, {"owner": {"reputation": 86, "user_id": 11501624, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-X1mfN_NJiMA/AAAAAAAAAAI/AAAAAAAAANk/yIY6-6rKAbw/photo.jpg?sz=128", "display_name": "Quang V&#245;", "link": "https://stackoverflow.com/users/11501624/quang-v%c3%b5"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1577415490, "post_id": 59495249, "comment_id": 105164776, "body": "@CeriseLim&#243;n I think what I can do is to send a ping message after like 15-30 second to maintain the connection between client and server"}], "answers": [{"comments": [{"owner": {"reputation": 86, "user_id": 11501624, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-X1mfN_NJiMA/AAAAAAAAAAI/AAAAAAAAANk/yIY6-6rKAbw/photo.jpg?sz=128", "display_name": "Quang V&#245;", "link": "https://stackoverflow.com/users/11501624/quang-v%c3%b5"}, "edited": false, "score": 0, "creation_date": 1577414504, "post_id": 59495406, "comment_id": 105164630, "body": "Hmm perhaps I didn&#39;t let you know what I want clear enough. What I want is to hold that connection forever (like chat messages) , because after writing a bunch of messages to the server and get result from <code>ReadMessage</code>, my client throw that error. So if the next time I want to write messages, I have to open the websocket connection again and I don&#39;t want that"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 86, "user_id": 11501624, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-X1mfN_NJiMA/AAAAAAAAAAI/AAAAAAAAANk/yIY6-6rKAbw/photo.jpg?sz=128", "display_name": "Quang V&#245;", "link": "https://stackoverflow.com/users/11501624/quang-v%c3%b5"}, "edited": false, "score": 1, "creation_date": 1577414579, "post_id": 59495406, "comment_id": 105164642, "body": "@QuangV&#245; If the server closes the connection, then you have no choice but to open a new connection.  A robust application will be written to handle this situation."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1577414684, "post_id": 59495406, "comment_id": 105164662, "body": "The error is a <code>*weboscket.CloseError</code>, not io.EOF.  Use <code>websocket.IsCloseError(err, websocket.CloseAbnormalClosure)</code> to test for the error in the question. That said, all errors should be handled identically in the OP&#39;s scenario: close the current connection and open a new connection."}, {"owner": {"reputation": 105, "user_id": 10819158, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HFbxz.jpg?s=128&g=1", "display_name": "quzhen", "link": "https://stackoverflow.com/users/10819158/quzhen"}, "edited": false, "score": 0, "creation_date": 1577415348, "post_id": 59495406, "comment_id": 105164753, "body": "You can use for loop to keep the connection to the server,  maybe the client will be closed because of error, and you can&#39;t write message again, I don&#39;t know how to describe it clearly, you can  catch the error at first."}, {"owner": {"reputation": 86, "user_id": 11501624, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-X1mfN_NJiMA/AAAAAAAAAAI/AAAAAAAAANk/yIY6-6rKAbw/photo.jpg?sz=128", "display_name": "Quang V&#245;", "link": "https://stackoverflow.com/users/11501624/quang-v%c3%b5"}, "edited": false, "score": 0, "creation_date": 1577415540, "post_id": 59495406, "comment_id": 105164783, "body": "@EricPen like a for loop to send ping messages after 15-30 sec ?"}], "tags": [], "owner": {"reputation": 105, "user_id": 10819158, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HFbxz.jpg?s=128&g=1", "display_name": "quzhen", "link": "https://stackoverflow.com/users/10819158/quzhen"}, "is_accepted": false, "score": 0, "last_activity_date": 1577414240, "creation_date": 1577414240, "answer_id": 59495406, "question_id": 59495249, "link": "https://stackoverflow.com/questions/59495249/gorilla-websocket-client-read-message-error/59495406#59495406", "title": "Gorilla websocket client read message error", "body": "<p><code>EOF</code> means you are at end of the file and you can't read anymore, you can add <code>err == io.EOF</code> into your codes, it works. The complete code is as follows:</p>\n\n<pre><code>c, _, err := websocket.DefaultDialer.Dial(\"&lt;url&gt;\", nil)\nif err != nil {\n    panic(err)\n}\ngo func() {\n    defer close(clientResponse)\n    for {\n        _, message, err := c.ReadMessage()\n        if err != nil || err == io.EOF {\n            log.Fatal(\"Error reading: \", err)\n            break\n        }\n        clientResponse &lt;- message\n        fmt.Printf(\"recv: %s\", message)\n    }\n}()\n</code></pre>\n"}], "owner": {"reputation": 86, "user_id": 11501624, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-X1mfN_NJiMA/AAAAAAAAAAI/AAAAAAAAANk/yIY6-6rKAbw/photo.jpg?sz=128", "display_name": "Quang V&#245;", "link": "https://stackoverflow.com/users/11501624/quang-v%c3%b5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 961, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1577416421, "creation_date": 1577412390, "question_id": 59495249, "link": "https://stackoverflow.com/questions/59495249/gorilla-websocket-client-read-message-error", "title": "Gorilla websocket client read message error", "body": "<p>I have a client websocket code look like this</p>\n\n<pre><code>c, _, err := websocket.DefaultDialer.Dial(\"&lt;url&gt;\", nil)\n    if err != nil {\n        panic(err)\n    }\n    go func() {\n        defer close(clientResponse)\n        for {\n            _, message, err := c.ReadMessage()\n            if err != nil {\n                log.Fatal(\"Error reading: \", err)\n                break\n            }\n            clientResponse &lt;- message\n            fmt.Printf(\"recv: %s\", message)\n        }\n    }()\n</code></pre>\n\n<p>What happened is after I stop writing messages to the server side, my client throw this error which come from the <code>ReadMessage</code> method:</p>\n\n<p><code>websocket: close 1006 (abnormal closure): unexpected EOF</code></p>\n\n<p>Anyone know where is this error come from and how to fix it ?. So far all I can think of is the server/client have a Read/Write deadline and after that, it just auto disconnect</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 1, "creation_date": 1577413543, "post_id": 59495083, "comment_id": 105164479, "body": "mmmm... that <code>islice</code> function is kind of I don&#39;t know what is does well....let&#39;s says i have taste it at the playground: play.golang.org/p/V5a2Sf4EPl0 and don&#39;t get it... in any case if you need to loop over an slice of <code>[]Images</code>, use the <code>range</code> operator for iterate... i wonder if this code might help... <a href=\"https://play.golang.org/p/UWr8VVUEto9\" rel=\"nofollow noreferrer\">play.golang.org/p/UWr8VVUEto9</a>"}], "answers": [{"comments": [{"owner": {"reputation": 319, "user_id": 7661057, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b48b40d782b71a562d242f3e1904437a?s=128&d=identicon&r=PG&f=1", "display_name": "Rekt", "link": "https://stackoverflow.com/users/7661057/rekt"}, "edited": false, "score": 0, "creation_date": 1577412820, "post_id": 59495183, "comment_id": 105164391, "body": "thanks for your help earlier and thanks for this, however im getting  <code>cannot use new_images (type []Images) as type []uuid.UUID in argument to islice</code> error, when I tried this"}, {"owner": {"reputation": 102, "user_id": 12603592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KXTp8.jpg?s=128&g=1", "display_name": "PatrickMahomes", "link": "https://stackoverflow.com/users/12603592/patrickmahomes"}, "reply_to_user": {"reputation": 319, "user_id": 7661057, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b48b40d782b71a562d242f3e1904437a?s=128&d=identicon&r=PG&f=1", "display_name": "Rekt", "link": "https://stackoverflow.com/users/7661057/rekt"}, "edited": false, "score": 0, "creation_date": 1577413306, "post_id": 59495183, "comment_id": 105164446, "body": "No problem. You cannot pass in new_images because the Images type is not a uuid, the Images.image_id is the uuid. You need to make a different slice of only the Images.image_id then pass that one in"}, {"owner": {"reputation": 319, "user_id": 7661057, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b48b40d782b71a562d242f3e1904437a?s=128&d=identicon&r=PG&f=1", "display_name": "Rekt", "link": "https://stackoverflow.com/users/7661057/rekt"}, "edited": false, "score": 0, "creation_date": 1577414303, "post_id": 59495183, "comment_id": 105164598, "body": "How do I do that in this case? I think my struct is right wit the datatype and I declared <code>new_images []Images</code> then throughout the iteration of rows I appended the <code>oldimages.image_id</code> to <code>Images.image_id</code> which is according to the example you gave, should become the slice that has been made throughout the iteration of rows and should be passed to the islice func?   I tried stuff but it isnt working, still the same error"}, {"owner": {"reputation": 102, "user_id": 12603592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KXTp8.jpg?s=128&g=1", "display_name": "PatrickMahomes", "link": "https://stackoverflow.com/users/12603592/patrickmahomes"}, "reply_to_user": {"reputation": 319, "user_id": 7661057, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b48b40d782b71a562d242f3e1904437a?s=128&d=identicon&r=PG&f=1", "display_name": "Rekt", "link": "https://stackoverflow.com/users/7661057/rekt"}, "edited": false, "score": 0, "creation_date": 1577416752, "post_id": 59495183, "comment_id": 105164969, "body": "Eliminate the Images struct all together and just append the image_ids into a slice of their own. ie <code>var new_images []uuid.UUID</code> then just <code>new_images = append(new_images, oldimages.image_id)</code> instead of <code>new_images = append(new_images , Images{image_id: oldimages.image_id})</code>"}], "tags": [], "owner": {"reputation": 102, "user_id": 12603592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KXTp8.jpg?s=128&g=1", "display_name": "PatrickMahomes", "link": "https://stackoverflow.com/users/12603592/patrickmahomes"}, "is_accepted": true, "score": 1, "last_activity_date": 1577411566, "creation_date": 1577411566, "answer_id": 59495183, "question_id": 59495083, "link": "https://stackoverflow.com/questions/59495083/how-to-loop-through-uuid-items/59495183#59495183", "title": "How to loop through UUID items", "body": "<p>All you need to do is replace []int with []uuid.UUID everywhere in your islice function, including the parameter types. The functionality of islice() is not bound to []int if thats what your problem is.</p>\n"}], "owner": {"reputation": 319, "user_id": 7661057, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b48b40d782b71a562d242f3e1904437a?s=128&d=identicon&r=PG&f=1", "display_name": "Rekt", "link": "https://stackoverflow.com/users/7661057/rekt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 170, "favorite_count": 0, "accepted_answer_id": 59495183, "answer_count": 1, "score": -1, "last_activity_date": 1577484220, "creation_date": 1577410376, "last_edit_date": 1577484220, "question_id": 59495083, "link": "https://stackoverflow.com/questions/59495083/how-to-loop-through-uuid-items", "title": "How to loop through UUID items", "body": "<p>How do I loop through a slice composed of UUIDS? My values comes from db via <code>rows.Next()</code></p>\n\n<p>Here's how I'm appending my uuid values to my slice (really don't know if its proper)</p>\n\n<pre><code>type Images struct {\n    image_id uuid.UUID `gorm:\"type:uuid;primary_key;\"`\n}\n\n\nvar new_images []Images\n\nfor olds.Next() {\n    olds.Scan(&amp;oldimages.image_id)    \n    new_images = append(new_images , Images{image_id: oldimages.image_id})\n\n}\n</code></pre>\n\n<p>olds here is the rows im getting from <code>gorm Rows</code> </p>\n\n<pre><code>olds, err := db.Raw(\"SELECT images_received.image_id FROM old_pics\").Rows()\ndefer olds.Close()\n</code></pre>\n\n<p>Heres the function in looping I was given but its for int i dont know how to use this for uuid:</p>\n\n<pre><code>func islice(s []int, n int, f func([]int)) {\n    for i := 0; i &lt; len(s); i += n {\n        var section []int\n        if i &gt; len(s)-n {\n            section = s[i:]\n        } else {\n            section = s[i : i+n]\n        }\n        f(section)\n    }\n} \n</code></pre>\n\n<p>Any idea how I do this? Currently for uuid im using the <code>\"github.com/satori/go.uuid\"</code> lib</p>\n\n<p>I got the function from another SO question, My goal is to iterate over the rows, but <code>rows.Next()</code> doesnt allow that I guess in order to do that I thought I needed to append them into a slice, so I can get them by fours. </p>\n\n<p>Hence leading to this question.</p>\n"}, {"tags": ["go", "goland"], "comments": [{"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 3, "creation_date": 1577428461, "post_id": 59494584, "comment_id": 105167171, "body": "What&#39;s the error that you receive? Also, where does the GOPATH points to? Go to Settings/Preferences | Go | GOPATH and see if it matches your expectations."}, {"owner": {"reputation": 11, "user_id": 10837022, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-CoyI2jhrZd8/AAAAAAAAAAI/AAAAAAAAAA8/tXWiQE8d7v8/photo.jpg?sz=128", "display_name": "George", "link": "https://stackoverflow.com/users/10837022/george"}, "reply_to_user": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1577462142, "post_id": 59494584, "comment_id": 105178511, "body": "My mistake added the wrong picture, I&#39;ve edited the original thread to include the correct error. As for the GOPATH It&#39;s set to C:\\Users\\George\\go"}], "answers": [{"tags": [], "owner": {"reputation": 4797, "user_id": 177154, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f719bc9e36272f09feca03728b4a160c?s=128&d=identicon&r=PG", "display_name": "draganstankovic", "link": "https://stackoverflow.com/users/177154/draganstankovic"}, "is_accepted": false, "score": 0, "last_activity_date": 1577567371, "creation_date": 1577567371, "answer_id": 59514879, "question_id": 59494584, "link": "https://stackoverflow.com/questions/59494584/go-goland-cant-read-repositories/59514879#59514879", "title": "Go/goland can&#39;t read repositories", "body": "<p>What you can try is to replace <code>github.com</code> url with the ssh one so instead of:</p>\n\n<pre><code>...\npb \"github.com:/eros/Micro/proto/consignment\"\n...\n</code></pre>\n\n<p>try to use: </p>\n\n<pre><code>...\npb \"git@github.com:/eros/Micro/proto/consignment\"\n...\n</code></pre>\n\n<p>If that doesn't work I would open terminal in Goland (<code>ALT/OPTION) + F12</code>) and try to execute the same go get command that breaks. If it fails the same way - great! Now just go and see what is different than executing it outside Goland (what are env vars, which ssh key Goland terminal is using, etc.)</p>\n"}], "owner": {"reputation": 11, "user_id": 10837022, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-CoyI2jhrZd8/AAAAAAAAAAI/AAAAAAAAAA8/tXWiQE8d7v8/photo.jpg?sz=128", "display_name": "George", "link": "https://stackoverflow.com/users/10837022/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 199, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1577567371, "creation_date": 1577404489, "last_edit_date": 1577462095, "question_id": 59494584, "link": "https://stackoverflow.com/questions/59494584/go-goland-cant-read-repositories", "title": "Go/goland can&#39;t read repositories", "body": "<p>I'm currently working in Go to make some microservices, using go get works perfectly fine to install the packages required however it does not find them in my IDE (Goland by Jetbrains) they show up in the editor like this</p>\n\n<p><a href=\"https://i.stack.imgur.com/YNJRt.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/YNJRt.png\" alt=\"imports\"></a></p>\n\n<p>when using the macro in Goland to it provides the option to run the go get command, when running that command the terminal shows this error </p>\n\n<p><a href=\"https://i.stack.imgur.com/PQzUW.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/PQzUW.png\" alt=\"enter image description here\"></a></p>\n\n<p>I did some searching and couldn't find much on it, one thing I saw people saying was for the github import that it couldn't find my SSH key on Github, I've checked and re-added my SSH key to Github and it's working as intended. Should also mention that the repo in the import is private.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1577405389, "post_id": 59494349, "comment_id": 105163314, "body": "This problem is straightforward as stated (see <a href=\"https://stackoverflow.com/a/59494504/1256452\">PatrickMahomes2&#39;s answer</a>). Are you looking for something more generic, such as the ability to define an iterator with some argument <code>n</code> for how many elements to put into each sub-slice? If so, see, e.g., <a href=\"https://play.golang.org/p/O09ZsVNWV2D\" rel=\"nofollow noreferrer\">play.golang.org/p/O09ZsVNWV2D</a> (I wrapped his code in a little function that takes a function to call)."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1577422999, "post_id": 59494349, "comment_id": 105165946, "body": "@torek: In Go, we would likely write your code as <a href=\"https://play.golang.org/p/uUxR8Ct5O_W\" rel=\"nofollow noreferrer\">play.golang.org/p/uUxR8Ct5O_W</a>. See my answer for an explanation."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1577425296, "post_id": 59494349, "comment_id": 105166421, "body": "@peterSO: yes, I would have done that myself were I not starting with someone else&#39;s code fragment."}], "answers": [{"comments": [{"owner": {"reputation": 11200, "user_id": 1055395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be6778daa107272cbbf6bc69c6c24683?s=128&d=identicon&r=PG&f=1", "display_name": "Anatolii", "link": "https://stackoverflow.com/users/1055395/anatolii"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1577481377, "post_id": 59494504, "comment_id": 105184771, "body": "@torek I guess someone downvoted it because the author didn&#39;t try to explain his answer - just posted the code."}], "tags": [], "owner": {"reputation": 102, "user_id": 12603592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KXTp8.jpg?s=128&g=1", "display_name": "PatrickMahomes", "link": "https://stackoverflow.com/users/12603592/patrickmahomes"}, "is_accepted": true, "score": 1, "last_activity_date": 1577420064, "last_edit_date": 1577420064, "creation_date": 1577403571, "answer_id": 59494504, "question_id": 59494349, "link": "https://stackoverflow.com/questions/59494349/how-to-iterate-on-slices-4-items-at-a-time/59494504#59494504", "title": "How to iterate on slices, 4 items at a time", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    slice := []int{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}\n    for i := 0; i &lt; len(slice); i += 4 {\n        var section []int\n        if i &gt; len(slice)-4 {\n            section = slice[i:]\n        } else {\n            section = slice[i : i+4]\n        }\n        fmt.Println(section)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/kf7_OJcP13t\" rel=\"nofollow noreferrer\">https://play.golang.org/p/kf7_OJcP13t</a></p>\n\n<p>Output:</p>\n\n<pre><code>[1 2 3 4]\n[5 6 7 8]\n[9 10 11 12]\n[13 14 15]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1577423161, "last_edit_date": 1577423161, "creation_date": 1577422175, "answer_id": 59496115, "question_id": 59494349, "link": "https://stackoverflow.com/questions/59494349/how-to-iterate-on-slices-4-items-at-a-time/59496115#59496115", "title": "How to iterate on slices, 4 items at a time", "body": "<blockquote>\n  <p>How To Iterate on Slices in Go, Iterating 4 items at a time. I want a\n  for loop.</p>\n</blockquote>\n\n<hr>\n\n<p>In Go, readability is paramount. First we read the normal path, then we read the exception/error paths.</p>\n\n<p>We write the normal path.</p>\n\n<pre><code>n := 4\nfor i := 0; i &lt; len(s); i += n {\n    ss := s[i : i+n]\n    fmt.Println(ss)\n}\n</code></pre>\n\n<p>We use <code>n</code> for the stride value throughout.</p>\n\n<p>We write a little tweak that doesn't disturb the normal path to handle an exception, the end of the slice.</p>\n\n<pre><code>if n &gt; len(s)-i {\n    n = len(s) - i\n}\n</code></pre>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    s := []int{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15}\n    n := 4\n    for i := 0; i &lt; len(s); i += n {\n        if n &gt; len(s)-i {\n            n = len(s) - i\n        }\n        ss := s[i : i+n]\n        fmt.Println(ss)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/Vtpig2EeXB7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Vtpig2EeXB7</a></p>\n\n<p>Output:</p>\n\n<pre><code>[1 2 3 4]\n[5 6 7 8]\n[9 10 11 12]\n[13 14 15]\n</code></pre>\n"}], "owner": {"reputation": 319, "user_id": 7661057, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/b48b40d782b71a562d242f3e1904437a?s=128&d=identicon&r=PG&f=1", "display_name": "Rekt", "link": "https://stackoverflow.com/users/7661057/rekt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 1, "accepted_answer_id": 59494504, "answer_count": 2, "score": -1, "last_activity_date": 1577445860, "creation_date": 1577402007, "last_edit_date": 1577438459, "question_id": 59494349, "link": "https://stackoverflow.com/questions/59494349/how-to-iterate-on-slices-4-items-at-a-time", "title": "How to iterate on slices, 4 items at a time", "body": "<p>How do I iterate through a Go slice 4 items at a time.</p>\n\n<p>lets say I have <code>[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15]</code></p>\n\n<p>I want a for loop to be able to get</p>\n\n<pre><code>[1,2,3,4] //First Iteration\n[5,6,7,8] //Second Iteration\n[9,10,11,12] //Third Iteration\n[13,14,15,] // Fourth Iteration\n</code></pre>\n\n<p>I can do this in java and python but for golang I really dont have an idea.</p>\n"}, {"tags": ["algorithm", "go"], "comments": [{"owner": {"reputation": 1040, "user_id": 11767140, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Tbfr3YlhoOs/AAAAAAAAAAI/AAAAAAAAAWo/4_25j9xubwc/photo.jpg?sz=128", "display_name": "David Garc&#237;a Bodego", "link": "https://stackoverflow.com/users/11767140/david-garc%c3%ada-bodego"}, "edited": false, "score": 0, "creation_date": 1577408565, "post_id": 59494268, "comment_id": 105163748, "body": "Welcome to SO! So you are looking for the next element to the one you search or you are looking for a second search? Any programming language?"}], "answers": [{"tags": [], "owner": {"reputation": 102, "user_id": 12603592, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KXTp8.jpg?s=128&g=1", "display_name": "PatrickMahomes", "link": "https://stackoverflow.com/users/12603592/patrickmahomes"}, "is_accepted": false, "score": 0, "last_activity_date": 1577404847, "creation_date": 1577404847, "answer_id": 59494619, "question_id": 59494268, "link": "https://stackoverflow.com/questions/59494268/what-is-the-best-way-to-get-substring-info-from-a-string/59494619#59494619", "title": "What is the best way to get substring info from a string", "body": "<p>I'm not sure what your result string looks like but if you can turn it into a format such as \"City:San Fran;State:CA;Country:US\" then this can easily be converted into a map. For instance:</p>\n\n<pre><code>result := \"City:San Fran,State:CA,Country:US\"\nfields := strings.Split(result, \",\")\nfieldsMap := map[string]string{}\nfor _, field := range fields {\n    pair := strings.Split(field, \":\")\n    fieldsMap[pair[0]] = pair[1]\n}\n</code></pre>\n\n<p>Now you can access any value very easily:\n<code>country := fieldsMap[\"Country\"]</code> will give \"US\" if you <code>fmt.Println(country)</code></p>\n"}, {"tags": [], "owner": {"reputation": 267, "user_id": 7496749, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-ij7XNtbUPqw/AAAAAAAAAAI/AAAAAAAABGQ/bpdn80GLhEs/photo.jpg?sz=128", "display_name": "Deepak Sah", "link": "https://stackoverflow.com/users/7496749/deepak-sah"}, "is_accepted": false, "score": 2, "last_activity_date": 1577431900, "creation_date": 1577431900, "answer_id": 59497483, "question_id": 59494268, "link": "https://stackoverflow.com/questions/59494268/what-is-the-best-way-to-get-substring-info-from-a-string/59497483#59497483", "title": "What is the best way to get substring info from a string", "body": "<p>You can use <a href=\"https://golang.org/pkg/regexp/#example_Regexp_FindStringIndex\" rel=\"nofollow noreferrer\">FindStringIndex</a> from the <code>regexp</code> package. It is guaranteed to run in time linear in the size of the input. <code>FindStringIndex</code> returns a <code>slice</code> of two elements defining the location of the matched string so you can easily get the next word.</p>\n"}, {"tags": [], "owner": {"reputation": 1257, "user_id": 9790416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2e4d4944386ae38d1b229977ac4b3e4?s=128&d=identicon&r=PG", "display_name": "Shubham Chadokar", "link": "https://stackoverflow.com/users/9790416/shubham-chadokar"}, "is_accepted": false, "score": 0, "last_activity_date": 1577447278, "creation_date": 1577447278, "answer_id": 59500361, "question_id": 59494268, "link": "https://stackoverflow.com/questions/59494268/what-is-the-best-way-to-get-substring-info-from-a-string/59500361#59500361", "title": "What is the best way to get substring info from a string", "body": "<p>It is another way to find the index of the string.   </p>\n\n<p>Split by that string and then <code>length of the first index</code> is the index of the first occurrence of the string.<br>\n<a href=\"https://play.golang.org/p/x7QWyuC_1wK\" rel=\"nofollow noreferrer\">https://play.golang.org/p/x7QWyuC_1wK</a>   </p>\n\n<pre><code>    result := \"City:San Fran,State:CA,Country:US\"\n\n    // split the string \n    s := strings.Split(result, \"US\")\n\n    // index of US \n    index := len(s[0])\n\n    fmt.Println(index)\n\n// Output\n    U 31\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 12603685, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a69571b882f3925f9356051618ebfa20?s=128&d=identicon&r=PG&f=1", "display_name": "cami", "link": "https://stackoverflow.com/users/12603685/cami"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 1, "answer_count": 3, "score": 2, "last_activity_date": 1577447278, "creation_date": 1577401069, "last_edit_date": 1577430743, "question_id": 59494268, "link": "https://stackoverflow.com/questions/59494268/what-is-the-best-way-to-get-substring-info-from-a-string", "title": "What is the best way to get substring info from a string", "body": "<p>I am actually doing a function to get some data. The data has info that it's not necessary for me, so I'am searching for an optimal way to find it.\nWhat I have is this</p>\n\n<pre><code>e := strings.Index(result, \"Country\") //Searching for the country info like Country: US\n</code></pre>\n\n<p>When I get the index I search for the Info that I need something like the next word. That's what I'm looking for.\nAny idea to resolve this in an optimal way?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 69, "user_id": 6610936, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KQHij.jpg?s=128&g=1", "display_name": "Artiko", "link": "https://stackoverflow.com/users/6610936/artiko"}, "is_accepted": false, "score": 0, "last_activity_date": 1577400200, "creation_date": 1577400200, "answer_id": 59494185, "question_id": 59494078, "link": "https://stackoverflow.com/questions/59494078/command-line-application-outputs-usage-instructions-even-though-i-think-i-am-alr/59494185#59494185", "title": "Command line application outputs usage instructions even though I think I am already using it correctly", "body": "<p>I think you need to implement <code>Action</code>\nand also retrieving url is not like that, check this code</p>\n\n<pre><code>\n    func commands() {\n        var url string\n\n        urlFlag := cli.StringFlag{\n            Name:        \"url\",\n            Usage:       \"Site url\",\n            Destination: &amp;url,\n        }\n\n        app.Flags = []cli.Flag{\n            &amp;urlFlag,\n        }\n    }\n\n    func main() {\n        info()\n        commands()\n\n        app.Action = func(c *cli.Context) error {\n            fmt.Printf(\"Passed url: %v\", c.String(\"url\"))\n            return nil\n        }\n\n        err := app.Run(os.Args)\n        if err != nil {\n            log.Fatal(err)\n        }\n    }\n\n</code></pre>\n\n<p>pls note that I remove return from <code>func commands()</code></p>\n"}], "owner": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 39, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1577400200, "creation_date": 1577399116, "question_id": 59494078, "link": "https://stackoverflow.com/questions/59494078/command-line-application-outputs-usage-instructions-even-though-i-think-i-am-alr", "title": "Command line application outputs usage instructions even though I think I am already using it correctly", "body": "<p>Input</p>\n\n<pre><code>go run site-downloader.go --url https://www.google.com\n</code></pre>\n\n<p>Expected output</p>\n\n<pre><code>Passed url: https://www.google.com\n</code></pre>\n\n<p>Actual output</p>\n\n<pre><code>Passed url: NAME:\n   Site downloader - Follows an URL and downloads rendered html content. Follows and download anchor links to child pages recursively. Only follows relative links.\n\nUSAGE:\n   site-downloader [global options] command [command options] [arguments...]\n\nCOMMANDS:\n   help, h  Shows a list of commands or help for one command\n\nGLOBAL OPTIONS:\n   --url value  Site url\n   --help, -h   show help (default: false)\n</code></pre>\n\n<p>What is wrong in my code?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n\n    \"github.com/urfave/cli\"\n)\n\nvar app = cli.NewApp()\n\nfunc info() {\n    app.Name = \"Site downloader\"\n    app.Usage = \"Follows an URL and downloads rendered html content. Follows and download anchor links to child pages recursively. Only follows relative links.\"\n}\n\nfunc commands() string {\n    var url string\n\n    urlFlag := cli.StringFlag{\n        Name:        \"url\",\n        Usage:       \"Site url\",\n        Destination: &amp;url,\n    }\n\n    app.Flags = []cli.Flag{\n        &amp;urlFlag,\n    }\n\n    return url\n}\n\nfunc main() {\n    info()\n    var url = commands()\n\n    fmt.Printf(\"Passed url: %v\", url)\n\n    err := app.Run(os.Args)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1577395887, "post_id": 59493644, "comment_id": 105161315, "body": "Please show the entire panic message. It tells you exactly which line of your code caused the problem."}, {"owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "edited": false, "score": 0, "creation_date": 1577396192, "post_id": 59493644, "comment_id": 105161398, "body": "The line number won&#39;t do much good unless we also know which line that is in the code you provided.  It would be best to provide a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">stackoverflow.com/help/minimal-reproducible-example</a> so we can try it for ourselves."}, {"owner": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "edited": false, "score": 0, "creation_date": 1577397553, "post_id": 59493644, "comment_id": 105161708, "body": "Entire panic message addded above. Code added on Go playground."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1577398442, "creation_date": 1577398442, "answer_id": 59493998, "question_id": 59493644, "link": "https://stackoverflow.com/questions/59493644/panic-runtime-error-slice-bounds-out-of-range-21/59493998#59493998", "title": "panic: runtime error: slice bounds out of range [2:1]", "body": "<p><code>[2:1]</code> is an invalid slice index.  The proper format is <code>[low:high]</code>, so the second number must always be larger than (or equal to) the first. This is why you get a panic.</p>\n\n<p>The solution is to replace:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>        str := s[half-1:1] + s[half:1]\n</code></pre>\n\n<p>with:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>        str := s[half-1:half] + s[half:half+1]\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/0TsxhUuyhhQ\" rel=\"nofollow noreferrer\">Playground</a>, which can be further simplified to:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>        str := s[half-1:half+1]\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/VBXZxzIixQY\" rel=\"nofollow noreferrer\">playground</a></p>\n"}], "owner": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1150, "favorite_count": 0, "accepted_answer_id": 59493998, "answer_count": 1, "score": -3, "last_activity_date": 1577398442, "creation_date": 1577395669, "last_edit_date": 1577397530, "question_id": 59493644, "link": "https://stackoverflow.com/questions/59493644/panic-runtime-error-slice-bounds-out-of-range-21", "title": "panic: runtime error: slice bounds out of range [2:1]", "body": "<p>I am working on an academic problem and Go panics.\nThe code will find the middle charcter of a string.</p>\n\n<pre><code>func findMiddle(s string) string {\n    len := len(s)\n    half := len / 2\n\n    if len == 0 {\n        panic(\"zero\")\n    }\n\n    if len%2 == 0 {\n        fmt.Println(\"#53:\" + s)\n        str := s[half-1:1] + s[half:1]\n        fmt.Println(\"Even: \" + str)\n        return str\n    } else {\n        fmt.Println(\"#58: \" + s)\n        str := s[half:1]\n        fmt.Println(\"Odd: \" + str)\n        return str\n    }\n}\n</code></pre>\n\n<p>My debug output looks like:</p>\n\n<pre><code>#58: 1\nOdd: 1\n#58: 2\nOdd: 2\n#58: 5\nOdd: 5\n#53:13\nEven: 1\n#53:89\nEven: 8\n#58: 233\nOdd: \n#53:1597\npanic: runtime error: slice bounds out of range [2:1]\n\ngoroutine 1 [running]:\nmain.findMiddle(0xc00001a200, 0x4, 0xc00001a200, 0x4)\n        /home/peter/work/src/misc2/prime-recursion-strings/main.go:68 +0x403\nmain.iterate(0x4f8bc0, 0xc00009c008)\n        /home/peter/work/src/misc2/prime-recursion-strings/main.go:30 +0x92\nmain.main()\n        /home/peter/work/src/misc2/prime-recursion-strings/main.go:17 +0xa3\nexit status 2\n\n\n\n</code></pre>\n\n<p>As you can see the code runs multiple iterations before it panics.</p>\n\n<p>Any clue to what is happening? \nTest the code here: <a href=\"https://play.golang.org/p/_K1DivJST3F\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_K1DivJST3F</a></p>\n"}, {"tags": ["go", "amazon-dynamodb", "unix-timestamp"], "answers": [{"tags": [], "owner": {"reputation": 4797, "user_id": 177154, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f719bc9e36272f09feca03728b4a160c?s=128&d=identicon&r=PG", "display_name": "draganstankovic", "link": "https://stackoverflow.com/users/177154/draganstankovic"}, "is_accepted": true, "score": 2, "last_activity_date": 1577388751, "creation_date": 1577388751, "answer_id": 59492677, "question_id": 59492628, "link": "https://stackoverflow.com/questions/59492628/dynamodb-updateitem-failed/59492677#59492677", "title": "DynamoDB UpdateItem failed", "body": "<p>It seems like your attribute <code>rt</code> is missing a <code>:</code> ->  <code>:rt</code> :)</p>\n"}], "owner": {"reputation": 379, "user_id": 3935715, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/7462de9b868da1b88001d7e25489e839?s=128&d=identicon&r=PG&f=1", "display_name": "Korba", "link": "https://stackoverflow.com/users/3935715/korba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 0, "accepted_answer_id": 59492677, "answer_count": 1, "score": 0, "last_activity_date": 1577390471, "creation_date": 1577388414, "last_edit_date": 1577390471, "question_id": 59492628, "link": "https://stackoverflow.com/questions/59492628/dynamodb-updateitem-failed", "title": "DynamoDB UpdateItem failed", "body": "<p>I am using DynamoDB Go SDK for CRUD operations. I verified <code>PutItem</code> and <code>GetItem</code> calls are working fine. However, when I use <code>UpdateItem</code> which updates some attributes, it fails. I narrowed it down to specific to an attribute that stores the current timestamp in epoch format.</p>\n\n<pre><code>    updateItem := &amp;dynamodb.UpdateItemInput{\n        TableName:aws.String(tableName),\n        ExpressionAttributeValues: map[string]*dynamodb.AttributeValue{\n            \":r\": {\n                S:aws.String(\"Renamed\"),\n            },\n            \":rp\": {\n                S: aws.String(\"RenamingParty\"),\n            },\n            \":rr\": {\n                S: aws.String(\"RenameReason\"),\n            },\n            \"rt\": {\n                N: aws.String(strconv.FormatInt(time.Now().Unix(), 10)),\n            },\n        },\n        Key: map[string]*dynamodb.AttributeValue{\n            \"pKey\": {\n                S: aws.String(pKey),\n            },\n            \"rKey\": {\n                S:aws.String(rKey),\n            },\n        },\n        ReturnValues:aws.String(\"ALL_NEW\"),\n        UpdateExpression:aws.String(\"set RenameStatus = :r, RenamingParty = :rp, RenameReason = :rr RenameTime = :rt\"),\n    }\n\n    _, err := svc.UpdateItem(updateItem)\n</code></pre>\n\n<p><strong>Error returned</strong>:</p>\n\n<blockquote>\n  <p>failed to update item: %v ValidationException: ExpressionAttributeValues contains invalid key: Syntax error; key: \"rt\"\n      status code: 400, request id: </p>\n</blockquote>\n"}, {"tags": ["go", "broadcast", "goroutine"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577386792, "post_id": 59492335, "comment_id": 105159064, "body": "You have one worker and one channel but you&#39;ve got all this extra stuff - what are you trying to do here? Why are you using <code>broadcast</code>? Why are you using <code>barrier</code> (which says on its own readme that it&#39;s deprecated)?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577386857, "post_id": 59492335, "comment_id": 105159080, "body": "Generally speaking a deadlock happens because all of the goroutines are waiting on other goroutines, which means none of them can ever proceed. The use of these third-party libraries over built-in langauge constructs makes it harder to tell what exactly is causing this and what you&#39;re trying to accomplish."}, {"owner": {"reputation": 21, "user_id": 12356687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5faec2e3c2b8287d99103b1a96059e5b?s=128&d=identicon&r=PG&f=1", "display_name": "omar", "link": "https://stackoverflow.com/users/12356687/omar"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577387400, "post_id": 59492335, "comment_id": 105159213, "body": "@Adrian i am learning broadcast to use it later on my project so i am trying to understand it first and it was an issue happen when b.Submit(d) end brodcast and  close before workerOne() function recieve all message so i used the Barrier to prevent it from closing before  workerOne() function get all message"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577387480, "post_id": 59492335, "comment_id": 105159246, "body": "I wouldn&#39;t recommend using libraries that are deprecated. Looking at broadcast, I can&#39;t say I would recommend it either; in an effort to save maybe one or two dozen lines of code, it sacrifices type-safety, which is a pretty big price to pay for very little benefit."}], "answers": [{"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 0, "last_activity_date": 1577400252, "creation_date": 1577400252, "answer_id": 59494193, "question_id": 59492335, "link": "https://stackoverflow.com/questions/59492335/cant-handle-a-go-routine-deadloock/59494193#59494193", "title": "Can&#39;t handle a go routine deadloock", "body": "<p>As <a href=\"https://stackoverflow.com/questions/59492335/cant-handle-a-go-routine-deadloock#comment105159246_59492335\">Adrian noted in a comment</a>, the <a href=\"https://github.com/pwaller/barrier\" rel=\"nofollow noreferrer\"><code>barrier</code></a> package you are using is deprecated in favor of Go's included <a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\"><code>context</code></a> package.  You should use <a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\"><code>context</code></a> instead. ( The <a href=\"https://github.com/dustin/go-broadcast\" rel=\"nofollow noreferrer\"><code>broadcast</code></a> package you are using is not really doing you any good either, at the moment.)</p>\n\n<p>The immediate problem seems pretty obvious, though: the (single) goroutine running <code>workerOne</code> reads from a channel, and only if the channel is <em>closed</em> (so that <code>ok</code> becomes <code>false</code>) does it call <code>bar.Fall()</code> to drop the barrier.  Meanwhile, the (single) goroutine running the anonymous sender function:</p>\n\n<pre><code>go func() {\n    for i := 0; i &lt; 5; i++ {\n        d.x = i\n        log.Printf(\"Sending %v\", d)\n        b.Submit(d)\n    }\n    &lt;-bar.Barrier()\n    b.Close()\n}()\n</code></pre>\n\n<p>submits five items through the <a href=\"https://github.com/dustin/go-broadcast\" rel=\"nofollow noreferrer\"><code>broadcast</code></a> package's (very) simple message pub/sub interface, then waits for the barrier to fall.  The only goroutine that will <em>drop</em> the barrier\u2014think of it as the only other <a href=\"https://blog.golang.org/gopher\" rel=\"nofollow noreferrer\">gopher</a> that can rescue you here\u2014is the one running <code>workerOne</code>.  He is, right now, waiting in channel-receive:</p>\n\n<pre><code>    v, ok := &lt;-ch\n</code></pre>\n\n<p>You, in your main goroutine, are waiting via your <code>sync.WaitGroup</code> variable:</p>\n\n<pre><code>w.Wait()\n</code></pre>\n\n<p>The gopher running the anonymous sender function is waiting:</p>\n\n<pre><code>    &lt;-bar.Barrier()\n</code></pre>\n\n<p>Who\u2014which of these three gophers running or waiting in various Go routines\u2014is going to signal, to the gopher in the anonymous sender, the <code>v, ok := &lt;-ch</code> should get a <code>!ok</code> result?  The only one who <em>could</em> is the gopher running <code>workerOne</code>, but he's stuck.</p>\n\n<p>The <a href=\"https://github.com/dustin/go-broadcast\" rel=\"nofollow noreferrer\"><code>broadcast</code></a> package won't ever close your channel for you.  Unregistering a channel just removes it from the broadcaster's output channels, which leaves the unregistered channel open; and closing the broadcaster entirely effectively just unregisters all channels, again leaving them open.  So if you want your channel closed, you would have to do that yourself, somewhere else.</p>\n\n<p>Alternatively, you could modify your <code>workerOne</code> so that it doesn't depend on the channel being closed.  For instance, your variable <code>d</code> has an <code>x int</code> and a <code>y string</code>; you could pick one or both of these and decide that a string value reading \"drop the barrier\"\u2014perhaps with some particular <code>int</code> value as well\u2014means \"call <code>bar.Fall()</code> now\".  If you do this, you're getting even less out of these two nonstandard packages, though.</p>\n"}], "owner": {"reputation": 21, "user_id": 12356687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5faec2e3c2b8287d99103b1a96059e5b?s=128&d=identicon&r=PG&f=1", "display_name": "omar", "link": "https://stackoverflow.com/users/12356687/omar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 59494193, "answer_count": 1, "score": -2, "last_activity_date": 1577400252, "creation_date": 1577386383, "question_id": 59492335, "link": "https://stackoverflow.com/questions/59492335/cant-handle-a-go-routine-deadloock", "title": "Can&#39;t handle a go routine deadloock", "body": "<p>I am trying to broadcast a message to a channel, I just want it to send 5 messages. but I always get this error :\n<strong>fatal error: all goroutines are asleep - deadlock!</strong></p>\n\n<p>my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"sync\"\n\n    broadcast \"github.com/dustin/go-broadcast\"\n    \"github.com/pwaller/barrier\"\n)\n\n//Message boradcasted\ntype Message struct {\n    y string\n    x int\n}\n\nvar w sync.WaitGroup\nvar bar barrier.Barrier\n\nfunc main() {\n\n    b := broadcast.NewBroadcaster(100)\n\n    w.Add(1)\n    go workerOne(b)\n\n    d := Message{\"message :\", 0}\n\n    go func() {\n        for i := 0; i &lt; 5; i++ {\n            d.x = i\n            log.Printf(\"Sending %v\", d)\n            b.Submit(d)\n        }\n        &lt;-bar.Barrier()\n        b.Close()\n    }()\n    w.Wait()\n}\n\nfunc workerOne(b broadcast.Broadcaster) {\n    ch := make(chan interface{})\n    b.Register(ch)\n\n    for {\n        v, ok := &lt;-ch\n        if ok {\n            log.Printf(\"workerOne() reading : %v\", v)\n        } else {\n            log.Printf(\"i am here\")\n            close(ch)\n            b.Unregister(ch)\n            bar.Fall()\n            w.Done()\n            return\n        }\n    }\n}\n</code></pre>\n\n<p>the output :</p>\n\n<pre><code>2019/12/26 20:34:11 Sending {message : 0}\n2019/12/26 20:34:11 Sending {message : 1}\n2019/12/26 20:34:11 Sending {message : 2}\n2019/12/26 20:34:11 Sending {message : 3}\n2019/12/26 20:34:11 Sending {message : 4}\n2019/12/26 20:34:11 workerOne() reading : {message : 0}\n2019/12/26 20:34:11 workerOne() reading : {message : 1}\n2019/12/26 20:34:11 workerOne() reading : {message : 2}\n2019/12/26 20:34:11 workerOne() reading : {message : 3}\n2019/12/26 20:34:11 workerOne() reading : {message : 4}\nfatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [semacquire]:\nsync.runtime_Semacquire(0x59f530)\n        C:/Go/src/runtime/sema.go:56 +0x40\nsync.(*WaitGroup).Wait(0x59f528)\n        C:/Go/src/sync/waitgroup.go:130 +0x6c\nmain.main()\n        C:/Users/DELL/Desktop/work/demos/Design pattern/broadcast/broadcast.go:38 +0x107\n\ngoroutine 19 [select]:\ngithub.com/dustin/go-broadcast.(*broadcaster).run(0xc000060420)\n        D:/gocode/src/github.com/dustin/go-broadcast/broadcaster.go:39 +0x10f\ncreated by github.com/dustin/go-broadcast.NewBroadcaster\n        D:/gocode/src/github.com/dustin/go-broadcast/broadcaster.go:64 +0x103\n\ngoroutine 20 [chan receive]:\nmain.workerOne(0x4f1de0, 0xc000060420)\n        C:/Users/DELL/Desktop/work/demos/Design pattern/broadcast/broadcast.go:46 +0xcd\ncreated by main.main\n        C:/Users/DELL/Desktop/work/demos/Design pattern/broadcast/broadcast.go:25 +0x8e\n\ngoroutine 21 [chan receive]:\nmain.main.func1(0xc000060440, 0x4f1de0, 0xc000060420)\n        C:/Users/DELL/Desktop/work/demos/Design pattern/broadcast/broadcast.go:35 +0x168\ncreated by main.main\n        C:/Users/DELL/Desktop/work/demos/Design pattern/broadcast/broadcast.go:29 +0xf7\nexit status 2\n</code></pre>\n\n<p>I tried everything but it doesn't go throw condition !ok in workerOne() function to close the channel and end waiting, but still have the same error</p>\n"}, {"tags": ["go", "widget", "tabcontainer", "fyne"], "answers": [{"tags": [], "owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "is_accepted": true, "score": 2, "last_activity_date": 1577386674, "creation_date": 1577386674, "answer_id": 59492372, "question_id": 59491885, "link": "https://stackoverflow.com/questions/59491885/navigating-and-adding-to-whats-in-a-tabitem/59492372#59492372", "title": "Navigating and adding to what&#39;s in a TabItem", "body": "<p>You need to assert the type this way instead:\nmyBox := tc.Items[thing.about.page].Content.(*widget.Box)</p>\n"}], "owner": {"reputation": 489, "user_id": 4492824, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aedaea88f7da873f57b6605882571968?s=128&d=identicon&r=PG&f=1", "display_name": "Scott M", "link": "https://stackoverflow.com/users/4492824/scott-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 59492372, "answer_count": 1, "score": 1, "last_activity_date": 1577390484, "creation_date": 1577383488, "last_edit_date": 1577390484, "question_id": 59491885, "link": "https://stackoverflow.com/questions/59491885/navigating-and-adding-to-whats-in-a-tabitem", "title": "Navigating and adding to what&#39;s in a TabItem", "body": "<p>I have a specific and perhaps unusual problem involving building a GUI in Fyne. My application is Tabbed; aka first thing in the window is a TabContainer. All other widgets to be placed in the application are placed dynamically, at the direction of a server, which sends down a stream of instructions like \"in tab 2, row 4, column 3, place an Entry widget\" and so on. To be clear, the application is going to make every TabItem a set of vertical Box widgets, each of which will contain a set of horizontal boxes. Think of it as a ragged grid, with no attempt to line up columns, in each tab.</p>\n\n<p>My confusion is this: when I get an instruction from the server, I may (often will!) have to extend the VBoxes on the TabItem, and/or the HBoxes in the chosen VBox. So I want to go to the TabItem and ask it how many VBoxes it already has and then append a few more as needed, and ditto for the horizontal Boxes in that vertical Box. But I can't figure out how to ask that.</p>\n\n<p>Given the tab number, it's not hard to get to the TabItem: tc.Items[tabNumber] gets me that, and I can get to the Content with tc.Items[tabNumber].Content. The problem is, I know that content is a Box, and I (generally) want to add to it. But the compiler isn't putting up with my attempt to cast:</p>\n\n<pre><code>aBox := widget.Box(tc.Items[thing.about.page].Content) //Trust me, it is one. Really.\n//and now I can append as needed to this aBox. Except the line above doesn't compile.\n</code></pre>\n\n<p>The compile error makes sense; this presumably is not a reasonable cast. In C++ I'd break out dynamic_cast and be fine. Being new to Go I don't know how to manage the equivalent.</p>\n\n<p>I know I can arrange a set of maps of maps of maps on the side to hold my Boxes; I don't strictly speaking need to ask tab containers what they contain since I can keep track of it all separately. But that feels wrong; I'm duplicating knowledge that Fyne already has, if only I knew how to dig it out. And when I get commands from the server to start deleting some of the widgets, I'm going to be doing a lot of parallel effort, managing both the Tab container and my maps.</p>\n\n<p>What's the elegant solution?</p>\n"}, {"tags": ["mongodb", "go"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1577382833, "creation_date": 1577382833, "answer_id": 59491775, "question_id": 59491670, "link": "https://stackoverflow.com/questions/59491670/how-to-handle-duplicate-unique-index-error/59491775#59491775", "title": "How to handle duplicate unique index error?", "body": "<p>According to the driver docs, <code>InsertOne</code> may return a <code>WriteException</code>, so you can check if the error is a <code>WriteException</code>, and if it is so, then check the <code>WriteErrors</code> in it. Each <code>WriteError</code> contains an error code.</p>\n\n<pre><code>if we, ok:=err.(WriteException); ok {\n   for _,e:=range we.WriteErrors {\n      // check e.Code\n   }\n}\n</code></pre>\n\n<p>You can write an <code>IsDup</code> based on this.</p>\n"}], "owner": {"reputation": 67, "user_id": 7680253, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/8f1a6fc7149d4085fda85607478790d6?s=128&d=identicon&r=PG&f=1", "display_name": "Metamorphosis", "link": "https://stackoverflow.com/users/7680253/metamorphosis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 243, "favorite_count": 0, "accepted_answer_id": 59491775, "answer_count": 1, "score": 0, "last_activity_date": 1577382904, "creation_date": 1577382133, "last_edit_date": 1577382904, "question_id": 59491670, "link": "https://stackoverflow.com/questions/59491670/how-to-handle-duplicate-unique-index-error", "title": "How to handle duplicate unique index error?", "body": "<p>I'm using MongoDB. Code to add data to the collection:</p>\n\n<pre><code>  type User struct {\n  Firstname        string             `json:\"firstname\" bson:\"firstname\"`\n  Lastname         *string            `json:\"lastname,omitempty\" bson:\"lastname\"`\n  Username         string             `json:\"username\" bson:\"username\"`\n  RegistrationDate primitive.DateTime `json:\"registrationDate\" bson:\"registrationData\"`\n  LastLogin        primitive.DateTime `json:\"lastLogin\" bson:\"lastLogin\"`\n}\n\n\nvar client *mongo.Client\n\nfunc AddUser(response http.ResponseWriter, request *http.Request) {\n  collection := client.Database(\"hattip\").Collection(\"user\")\n  var user User\n  _ = json.NewDecoder(request.Body).Decode(&amp;user)\n  insertResult, err := collection.InsertOne(context.TODO(), user)\n  if err != nil {\n    // here i need to get the kind of error.\n    fmt.Println(\"Error on inserting new user\", err)\n    response.WriteHeader(http.StatusPreconditionFailed)\n  } else {\n    fmt.Println(insertResult.InsertedID)\n    response.WriteHeader(http.StatusCreated)\n  }\n\n}\n\nfunc main() {\n  client = GetClient()\n  err := client.Ping(context.Background(), readpref.Primary())\n  if err != nil {\n    log.Fatal(\"Couldn't connect to the database\", err)\n  } else {\n    log.Println(\"Connected!\")\n  }\n\n  router := mux.NewRouter()\n  router.HandleFunc(\"/person\", AddUser).Methods(\"POST\")\n  err = http.ListenAndServe(\"127.0.0.1:8080\", router)\n  if err == nil {\n    fmt.Println(\"Server is listening...\")\n  } else {\n    fmt.Println(err.Error())\n  }\n\n}\n\nfunc GetClient() *mongo.Client {\n  clientOptions := options.Client().ApplyURI(\"mongodb://127.0.0.1:27017\")\n  client, err := mongo.NewClient(clientOptions)\n\n  if err != nil {\n    log.Fatal(err)\n  }\n  err = client.Connect(context.Background())\n  if err != nil {\n    log.Fatal(err)\n  }\n  return client\n}\n</code></pre>\n\n<p>If I add a record with a username that already exists in the database, I get - </p>\n\n<blockquote>\n  <p>Error on inserting new user multiple write errors: [{write errors:\n  [{E11000 duplicate key error collection: hattip.user index:\n  username_unique dup key: { username: \"dd\" }}]}, {}]</p>\n</blockquote>\n\n<p>in the line <code>fmt.Println(\"Error on inserting new user\", err)</code> The record with the string <code>dd</code> in the <code>username</code> field is already there, and the <code>username</code> field is a unique index.</p>\n\n<p>I want to be sure that the error is exact E11000 error (a repeating collection of key errors).</p>\n\n<p>So far i compare <code>err</code> to whole error string that appears on duplication of a unique field, but it's completely wrong. If there is a way to get error code from <code>err</code> object, or there are other ways to solve this problem? </p>\n\n<p>Also, i found <code>mgo</code> package, but to use it properly i have to learn it, rewrite current code and so on, but honestly, it looks good:</p>\n\n<pre><code>if mgo.IsDup(err) {\n    err = errors.New(\"Duplicate name exists\")\n}\n</code></pre>\n"}, {"tags": ["linux", "go", "performance-testing", "cpu-usage", "analysis"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1577378898, "post_id": 59491098, "comment_id": 105156567, "body": "Number of goroutines isn&#39;t the same as number of threads; number of goroutines can be gotten from <a href=\"https://golang.org/pkg/runtime/#NumGoroutine\" rel=\"nofollow noreferrer\"><code>runtime.NumGoroutine</code></a>. CPU usage changes with process count is a complex metric you&#39;re unlikely to find a single quick solution to. Stack utilization is measured by default by <a href=\"https://golang.org/pkg/expvar/\" rel=\"nofollow noreferrer\"><code>expvar</code></a>. Questions requesting software recommendations (&quot;Is there any program...&quot;) are off-topic for SO."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577390626, "post_id": 59491098, "comment_id": 105160075, "body": "&quot;Useful information on ... maximum number of goroutines&quot;  -- Max number of goroutines is almost certainly <i>not</i> useful."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577390669, "post_id": 59491098, "comment_id": 105160088, "body": "Take a look at the official Go blog post about <a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">profiling</a>."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1577392876, "post_id": 59491098, "comment_id": 105160612, "body": "@Flimzy, by itself, the number of live goroutines is not useful, but the number of <i>runnable</i> live goroutines is useful in some circumstances as it is indicative on the load put on scheduler. It&#39;s not uncommon for a goroutine to wait to run for an inordinate amount of time under certain heavy scheduler churn."}, {"owner": {"reputation": 707, "user_id": 8343916, "user_type": "registered", "accept_rate": 7, "profile_image": "https://www.gravatar.com/avatar/54d382e5c2f991df05e0f0138af7e5a9?s=128&d=identicon&r=PG&f=1", "display_name": "claudioz", "link": "https://stackoverflow.com/users/8343916/claudioz"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1577461306, "post_id": 59491098, "comment_id": 105178225, "body": "@kostix: How do I know the number of runnable goroutines?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1577462317, "post_id": 59491098, "comment_id": 105178571, "body": "@Adrian&#39;s comment contains lots of useful information."}, {"owner": {"reputation": 707, "user_id": 8343916, "user_type": "registered", "accept_rate": 7, "profile_image": "https://www.gravatar.com/avatar/54d382e5c2f991df05e0f0138af7e5a9?s=128&d=identicon&r=PG&f=1", "display_name": "claudioz", "link": "https://stackoverflow.com/users/8343916/claudioz"}, "edited": false, "score": 0, "creation_date": 1577462862, "post_id": 59491098, "comment_id": 105178794, "body": "but runtime.NumGoroutine()  does not return the number of goroutines in the &quot;runnable&quot; state, but the number of all the existing goroutines (which are many more!)"}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 1, "last_activity_date": 1577458367, "last_edit_date": 1577458367, "creation_date": 1577392574, "answer_id": 59493233, "question_id": 59491098, "link": "https://stackoverflow.com/questions/59491098/program-to-collect-cpu-usage-data-for-performance-analysis/59493233#59493233", "title": "Program to collect CPU usage data for performance analysis", "body": "<p>Well, that's a complex topic so there cannot be a single definitive answer.</p>\n\n<p>Actually, what you came close to, is called \"collection of metrics\" or \"telemetry\" in production settings.</p>\n\n<p>In most cases, the collection of metrics uses sampling approach: that is, a snapshot of the system state of interest is collected and sent somewhere.\n\"Somewhere\" is usually some system which allows to persist the values of the metrics somewhere, and also usually provides various ways to analyze them.</p>\n\n<p>In the simplest case, the ananysis is done by glaring at graphs drawn from the collected data in some sort of the UI. More complex cases include alerting when the value of some metric raises above (or drops below) some threshold.</p>\n\n<p>A single metric is some <em>named</em> value of a particular type.</p>\n\n<hr>\n\n<p>The metrics can be produced from different sources of data.\nThe sources typical to a reasonably common setups in which programs written in Go run include:</p>\n\n<ul>\n<li><p>The Go runtime itself.</p>\n\n<p>This includes things like the number of goroutines and the garbage collection stats\u2014the measurements impossible to get outside of the running\nGo program for obvious reasons.</p></li>\n<li><p>The measurements provided by the OS about the running process which executes your program.</p>\n\n<p>This includes things like the CPU time spent in the user and system contexts of the kernel, the memory consumption\u2014as seen by the OS, the number of opened file (and socket) descriptors, number of CPU context switches, disk I/O stats and so on.</p></li>\n<li><p>The measurements provided by the containerization software running the container containing the program.</p>\n\n<p>On Linux this is usually provided by the <code>cgroup</code> subsystem which is chiefly responsible for controlling of the resource limits imposed onto a process hierarchy.</p></li>\n</ul>\n\n<hr>\n\n<p>How exactly to turn the data from these data sources is an open question (and that's why it's unfit for the SO format).</p>\n\n<p>For instance, to collect Go runtime stats you may use the <code>expvar</code> mechanism\u2014as suggested by @Adrian,\u2014and periodically poll the HTTP endpoint provided by it for data.</p>\n\n<p>Or you may run an internal goroutine in your program which periodically grabs these data from the runtime and pushes it somewhere.</p>\n\n<p>Sampling of the OS-level process-related data, again, can be done in different ways. Say, you may collect them from your very program using something like <a href=\"https://github.com/shirou/gopsutil\" rel=\"nofollow noreferrer\"><code>github.com/shirou/gopsutil/process</code></a> and push them along with the metrics gathered from the runtime stats, or you may use one or more of myriads of tools to collect this data externally.</p>\n\n<p>(The most low-tech but accessible way of gathering the OS-level performance data I know of is using tools like <code>pidstat</code>, <code>iotop</code>, <code>atop</code>, <code>cpustat</code> etc).</p>\n\n<hr>\n\n<p>The question of persisting and analyzing the collected data is, again, open.</p>\n\n<p>For a start, it may be as simple as dumping everything into a structured file\u2014may be with a timestamp on each record\u2014and process it with anything you like\u2014for instance, <code>pyplot</code> or RRD-tool or R or\u2026whatever.</p>\n\n<p>Or you may reach for a big gun right from the start and send your metrics to graphite or graphana or zabbix or icinga or whatever currently is at the top of its hip curve.</p>\n"}], "owner": {"reputation": 707, "user_id": 8343916, "user_type": "registered", "accept_rate": 7, "profile_image": "https://www.gravatar.com/avatar/54d382e5c2f991df05e0f0138af7e5a9?s=128&d=identicon&r=PG&f=1", "display_name": "claudioz", "link": "https://stackoverflow.com/users/8343916/claudioz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "closed_date": 1577390518, "accepted_answer_id": 59493233, "answer_count": 1, "score": -3, "last_activity_date": 1577458367, "creation_date": 1577378514, "last_edit_date": 1577390513, "question_id": 59491098, "link": "https://stackoverflow.com/questions/59491098/program-to-collect-cpu-usage-data-for-performance-analysis", "closed_reason": "Not suitable for this site", "title": "Program to collect CPU usage data for performance analysis", "body": "<p>I wrote a complex program in Go (which uses many concurrency constructs).\nI would like to make an accurate analysis of my program's <strong>CPU usage</strong> but I don't know where to start.\nIn particular, I would like to obtain useful information on:</p>\n\n<ul>\n<li><p>Maximum number of goroutines (i.e. concurrent threads) running at the same time;</p></li>\n<li><p>How much CPU usage changes if I run multiple instances of the same program at the same time?</p></li>\n<li><p>Stack utilization (it tells me if I use a lot (or a few) of the stack based on how many nested functions I engage);</p></li>\n</ul>\n\n<p>I work in Linux Ubuntu 18.04.1 LTS. \nWhat should I do to get this information? Is there any program (maybe specific for Golang) that allows to obtain this information?</p>\n"}, {"tags": ["go", "pgx"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1577381717, "post_id": 59489925, "comment_id": 105157541, "body": "Not sure if it&#39;s related, but <code>res := tx.QueryRow(context.Background(), query, args)</code> is wrong, it should be <code>res := tx.QueryRow(context.Background(), query, args...)</code> in the <code>QueryRow</code> method of your <code>*PGRepository</code> implementation."}, {"owner": {"reputation": 1438, "user_id": 2053591, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/Gh6T4.png?s=128&g=1", "display_name": "Romowski", "link": "https://stackoverflow.com/users/2053591/romowski"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1577433749, "post_id": 59489925, "comment_id": 105168518, "body": "@mkopriva, oh!!! such a shame... thank you"}], "owner": {"reputation": 1438, "user_id": 2053591, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/Gh6T4.png?s=128&g=1", "display_name": "Romowski", "link": "https://stackoverflow.com/users/2053591/romowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 745, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1577434569, "creation_date": 1577371471, "last_edit_date": 1577434569, "question_id": 59489925, "link": "https://stackoverflow.com/questions/59489925/migrating-from-lib-pq-to-jackc-pgx", "title": "Migrating from lib/pq to jackc/pgx", "body": "<p>After migrating project to \"<a href=\"https://godoc.org/github.com/jackc/pgx\" rel=\"nofollow noreferrer\">github.com/jackc/pgx/pgxpool</a>\" I have an error on every query:</p>\n\n<p><code>expected 0 arguments, got 1</code></p>\n\n<p>I noticed that error occurs at <strong>Scan</strong> </p>\n\n<p>Here is simple code block: </p>\n\n<pre><code>sql := `SELECT location FROM tb_champ WHERE is_active = true LIMIT 1;`\nvar location string\nrow := app.Repo.QueryRow(sql)\nfmt.Printf(\"%T\\n %v\\n\\n\", row, row)\nerr = row.Scan(&amp;location)\nif err != nil {\n    fmt.Println(err)\n}\nfmt.Println(location)\n</code></pre>\n\n<p>Here is output:</p>\n\n<pre><code>*pgx.connRow\n&amp;{0xc0000b2048 0xc000152240 0xc0001441e0 [] 0 0xc0000a26c0 [] {13797143304121583776 6737745 0x1a8c9c0} SELECT location FROM tb_champ WHERE is_active = true LIMIT 1; [[]] true &lt;nil&gt; &lt;nil&gt;}\n\nexpected 0 arguments, got 1\n</code></pre>\n\n<p>My App struct:</p>\n\n<pre><code>type App struct {\n   Config       *Config\n   Logger       *Logger\n   Repo         Repository\n}\n</code></pre>\n\n<p>...</p>\n\n<pre><code>type Repository interface {\n   Exec(query string, args ...interface{}) (pgconn.CommandTag, error)\n   Query(query string, args ...interface{}) (pgx.Rows, error)\n   QueryRow(query string, args ...interface{}) pgx.Row\n   Close() error\n}\n</code></pre>\n\n<p>PGRepository implementing Repository:</p>\n\n<pre><code>type PGRepository struct {\n    *pgxpool.Pool\n}\n</code></pre>\n\n<p>...\nHere is QueryRow implementation:</p>\n\n<pre><code>func (pg *PGRepository) QueryRow(query string, args ...interface{}) pgx.Row {\n   tx, err := pg.Begin(context.Background())\n   if err != nil {\n       return nil\n   }\n   defer tx.Rollback(context.Background())\n\n   res := tx.QueryRow(context.Background(), query, args)\n   if err != nil {\n       return nil\n   }\n\n   err = tx.Commit(context.Background())\n   if err != nil {\n       return nil\n   }\n\n   return res\n}\n</code></pre>\n\n<p>Need help! I don't understand which arguments about in error? How to fix this error?</p>\n\n<p><strong>AFTER @mkopriva COMMENT</strong> (ashamed of my code):</p>\n\n<pre><code>res := tx.QueryRow(context.Background(), query, args)\n</code></pre>\n\n<p>changed to</p>\n\n<pre><code>res := tx.QueryRow(context.Background(), query, args...)\n</code></pre>\n\n<p>Argument error is gone. But now some problem in <code>tx.Commit</code> row appeared: <code>conn busy</code></p>\n"}, {"tags": ["go", "go-gin", "lumberjack"], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 4021854, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hl7km.jpg?s=128&g=1", "display_name": "Lalchand Mali", "link": "https://stackoverflow.com/users/4021854/lalchand-mali"}, "edited": false, "score": 1, "creation_date": 1577430045, "post_id": 59487684, "comment_id": 105167611, "body": "thanks for your reply, But i do not want in this way. I should add log.WithField(&quot;requestId&quot;, &quot;value&quot;) at once place and it should reflect other place as well."}, {"owner": {"reputation": 61, "user_id": 9402308, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afe1f1cbaa52f9643738ab59522826cd?s=128&d=identicon&r=PG&f=1", "display_name": "jimmy", "link": "https://stackoverflow.com/users/9402308/jimmy"}, "edited": false, "score": 0, "creation_date": 1595395203, "post_id": 59487684, "comment_id": 111455296, "body": "did you solve this issue? I&#39;m looking for the same thing without having to call WithField every time"}], "tags": [], "owner": {"reputation": 111, "user_id": 7133719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bfaf34da0c8c293498e38ba2d862231?s=128&d=identicon&r=PG&f=1", "display_name": "Tugrul Bayrak", "link": "https://stackoverflow.com/users/7133719/tugrul-bayrak"}, "is_accepted": false, "score": 1, "last_activity_date": 1577359150, "creation_date": 1577359150, "answer_id": 59487684, "question_id": 59487028, "link": "https://stackoverflow.com/questions/59487028/how-to-print-custom-common-field-for-all-request-in-logrus-golang-without-impact/59487684#59487684", "title": "How to print custom common field for all request in logrus golang without impacting performance", "body": "<p>You may achieve this using WithField or WithFields functions. If you want multiple fields use WithFields method.</p>\n\n<p>Here is the function definition <code>func WithField(key string, value interface{}) *Entry</code></p>\n\n<p>An example: <code>log.WithField(\"requestId\", \"value\").Info(\"Your log message here\")</code></p>\n\n<p>For more information <a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\">https://github.com/sirupsen/logrus</a></p>\n"}, {"tags": [], "owner": {"reputation": 56, "user_id": 3632845, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000032206024/picture?type=large", "display_name": "ArthurMa", "link": "https://stackoverflow.com/users/3632845/arthurma"}, "is_accepted": false, "score": 2, "last_activity_date": 1577440442, "creation_date": 1577440442, "answer_id": 59498910, "question_id": 59487028, "link": "https://stackoverflow.com/questions/59487028/how-to-print-custom-common-field-for-all-request-in-logrus-golang-without-impact/59498910#59498910", "title": "How to print custom common field for all request in logrus golang without impacting performance", "body": "<p>You should warp it by yourself</p>\n\n<pre><code>func (logger *MyLogger) Debug(direction string, i *LogInfo, msg string) {\n    logger.Log.WithFields(logrus.Fields{\n        \"method\":     i.method,\n        \"path\":       i.path,\n        \"direction\":  direction,\n        \"clientIP\":   i.clientIP,\n        \"userAgent\":  i.userAgent,\n        \"dataLength\": i.dataLength,\n        \"func\":       i.function,\n        \"line\":       i.line,\n    }).Debug(msg)\n}\n</code></pre>\n\n<p>and write a utily func can generate those paramter.</p>\n"}], "owner": {"reputation": 131, "user_id": 4021854, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Hl7km.jpg?s=128&g=1", "display_name": "Lalchand Mali", "link": "https://stackoverflow.com/users/4021854/lalchand-mali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 722, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1577684311, "creation_date": 1577355831, "last_edit_date": 1577684311, "question_id": 59487028, "link": "https://stackoverflow.com/questions/59487028/how-to-print-custom-common-field-for-all-request-in-logrus-golang-without-impact", "title": "How to print custom common field for all request in logrus golang without impacting performance", "body": "<p>I want to add a custom field like requestId in logs and it should be printed along with message while calling\nlog.Info(message) or log.Debug(messasge)</p>\n"}, {"tags": ["string", "go", "redis", "redigo"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 1, "creation_date": 1577343241, "post_id": 59484596, "comment_id": 105145146, "body": "How do you put Value to redis, could you show all related code?"}, {"owner": {"reputation": 7374, "user_id": 593425, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ad54f71e8e63bf711680cf8f5f1e53c1?s=128&d=identicon&r=PG", "display_name": "Guy Korland", "link": "https://stackoverflow.com/users/593425/guy-korland"}, "edited": false, "score": 0, "creation_date": 1577350798, "post_id": 59484596, "comment_id": 105147234, "body": "Did you consider using RedisJSON module?"}, {"owner": {"reputation": 343, "user_id": 4550048, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9a5558abc1ffced3a0a86b5a9e5e7351?s=128&d=identicon&r=PG&f=1", "display_name": "Abhay Kumar", "link": "https://stackoverflow.com/users/4550048/abhay-kumar"}, "reply_to_user": {"reputation": 7374, "user_id": 593425, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ad54f71e8e63bf711680cf8f5f1e53c1?s=128&d=identicon&r=PG", "display_name": "Guy Korland", "link": "https://stackoverflow.com/users/593425/guy-korland"}, "edited": false, "score": 1, "creation_date": 1577353598, "post_id": 59484596, "comment_id": 105148188, "body": "@GuyKorland Issue was due to use of redis.Values. Correct way would be which is given in the answer opDataStr, err := redis.String(con.Do(&quot;GET&quot;, uIDDiscoveryOffer))"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1577343277, "creation_date": 1577343277, "answer_id": 59484908, "question_id": 59484596, "link": "https://stackoverflow.com/questions/59484596/reading-redis-key-value-which-is-json-string-using-redigo/59484908#59484908", "title": "Reading Redis key-value which is JSON string using redigo", "body": "<p>The Redis <a href=\"https://redis.io/commands/get\" rel=\"nofollow noreferrer\"><code>GET</code></a> returns the value of a key. <a href=\"https://godoc.org/github.com/gomodule/redigo/redis#Values\" rel=\"nofollow noreferrer\"><code>redis.Values()</code></a> may be used to convert the result of a command that returns multiple items.</p>\n\n<p>Since <code>GET</code> returns a single item, only use <a href=\"https://godoc.org/github.com/gomodule/redigo/redis#String\" rel=\"nofollow noreferrer\"><code>redis.String()</code></a>, you don't need <code>redis.Values()</code> here:</p>\n\n<pre><code>opDataStr, err := redis.String(con.Do(\"GET\", uIDDiscoveryOffer))\n</code></pre>\n"}], "owner": {"reputation": 343, "user_id": 4550048, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/9a5558abc1ffced3a0a86b5a9e5e7351?s=128&d=identicon&r=PG&f=1", "display_name": "Abhay Kumar", "link": "https://stackoverflow.com/users/4550048/abhay-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1577350178, "creation_date": 1577341448, "last_edit_date": 1577350178, "question_id": 59484596, "link": "https://stackoverflow.com/questions/59484596/reading-redis-key-value-which-is-json-string-using-redigo", "title": "Reading Redis key-value which is JSON string using redigo", "body": "<p>I am trying to read Redis Key-val in Go. Key is string and value is JSON string. Eg- Key= </p>\n\n<pre><code>discov_32161296\n</code></pre>\n\n<p>and Value as Json string= </p>\n\n<pre><code>\"{\\\"10283\\\":true,\\\"11064\\\":true,\\\"15123\\\":true,\\\"15447\\\":true,\\\"15926\\\":true,\\\"16530\\\":true,\\\"16537\\\":true,\\\"16799\\\":true,\\\"17088\\\":true,\\\"17249\\\":true,\\\"18501\\\":true,\\\"18529\\\":true,\\\"18601\\\":true,\\\"3044\\\":true,\\\"3687\\\":true,\\\"4926\\\":true,\\\"5483\\\":true,\\\"6\\\":true,\\\"6675\\\":true,\\\"8332\\\":true,\\\"8336\\\":true,\\\"8674\\\":true}\"\n</code></pre>\n\n<p>Getting below error while reading in Go</p>\n\n<pre><code>redis.Values err redigo: unexpected type for Values, got type []uint8\n</code></pre>\n\n<p>Here's my code :</p>\n\n<pre><code>uIDDiscoveryOffer := fmt.Sprintf(\"%s_%d\", \"discov\", uid)\nopDataStr, err := redis.String(redis.Values(con.Do(\"GET\", uIDDiscoveryOffer)))\n    if err != nil || err != redis.ErrNil {\n        utils.Log1(\"readCacheTxnByUID-Disc-redis.Values-err\", fmt.Sprint(\"redis.Values err : \", uidDiscoveryOffer, \" error: \", err.Error()))\n    } else {\n         //Some Logic\n    }\n</code></pre>\n"}, {"tags": ["go", "goose"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1577350250, "post_id": 59484553, "comment_id": 105147074, "body": "Don&#39;t paste images of text. They are very hard to read. And for the visually impaired, they are impossible to read, and they can&#39;t be indexed or search. Instead, just copy-and-paste the text directly into your question."}, {"owner": {"reputation": 4970, "user_id": 892788, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/e233ae4d7776dd50ffc5dd43eab2d8e8?s=128&d=identicon&r=PG", "display_name": "diyoda_", "link": "https://stackoverflow.com/users/892788/diyoda"}, "edited": false, "score": 0, "creation_date": 1577385318, "post_id": 59484553, "comment_id": 105158629, "body": "And please submit relevant code snippets related to the error."}], "owner": {"reputation": 23, "user_id": 11727168, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-53NTedcDv04/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfl9ihMNEQ6xBHS45NgnZietr1aZA/photo.jpg?sz=128", "display_name": "Doctor Strange", "link": "https://stackoverflow.com/users/11727168/doctor-strange"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1577350277, "creation_date": 1577341157, "last_edit_date": 1577350277, "question_id": 59484553, "link": "https://stackoverflow.com/questions/59484553/how-fix-error-failure-in-ensuredbversion", "title": "How fix error &quot;failure in EnsureDBVersion()&quot;", "body": "<p>I have project with <strong>Go</strong> . I use <strong>goose</strong> to bind migration with data . After install , i create file .sql and test it . But it not working . \n<a href=\"https://i.stack.imgur.com/sparT.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/sparT.png\" alt=\"enter image description here\"></a></p>\n\n<p>What should I do?</p>\n"}]