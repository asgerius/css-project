[{"tags": ["go", "timeout", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1528333076, "post_id": 50731055, "comment_id": 88470952, "body": "No, you cannot interrupt a blocking cgo call. You might want run the functions in a separate process that can be easily killed and cleaned up."}, {"owner": {"reputation": 1044, "user_id": 2640586, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3cd3f696c7c9e654d9f9d4d357d432ed?s=128&d=identicon&r=PG", "display_name": "Evan Mosseri", "link": "https://stackoverflow.com/users/2640586/evan-mosseri"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528847263, "post_id": 50731055, "comment_id": 88659192, "body": "@JimB if you answer this question with that comment I&#39;ll choose it as the correct answer"}], "answers": [{"tags": [], "owner": {"reputation": 1044, "user_id": 2640586, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3cd3f696c7c9e654d9f9d4d357d432ed?s=128&d=identicon&r=PG", "display_name": "Evan Mosseri", "link": "https://stackoverflow.com/users/2640586/evan-mosseri"}, "is_accepted": true, "score": 2, "last_activity_date": 1529347796, "creation_date": 1529347796, "answer_id": 50915756, "question_id": 50731055, "link": "https://stackoverflow.com/questions/50731055/timing-out-a-long-running-cgo-function-call/50915756#50915756", "title": "Timing Out A Long Running cgo Function Call", "body": "<p>There are only two ways to interrupt a cgo function call. </p>\n\n<ol>\n<li><p>Leave the goroutine running but stop waiting/blocking on it as demonstrated above</p></li>\n<li><p>Put all of the logic behind the cgo call in a separate executable and call it within a subprocess. </p></li>\n</ol>\n"}], "owner": {"reputation": 1044, "user_id": 2640586, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3cd3f696c7c9e654d9f9d4d357d432ed?s=128&d=identicon&r=PG", "display_name": "Evan Mosseri", "link": "https://stackoverflow.com/users/2640586/evan-mosseri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 50915756, "answer_count": 1, "score": 0, "last_activity_date": 1529347796, "creation_date": 1528328090, "question_id": 50731055, "link": "https://stackoverflow.com/questions/50731055/timing-out-a-long-running-cgo-function-call", "title": "Timing Out A Long Running cgo Function Call", "body": "<p>I am currently working on a program which calls a long running function using a c library with <code>cgo</code>. I cannot edit the library to allow for timeouts using c. My only solution so far was to leave a zombie goroutine running</p>\n\n<pre><code>func Timeout(timeout time.Duration, runFunc func()) bool {\n    var wg = new(sync.WaitGroup)\n    c := make(chan interface{})\n    wg.Add(1)\n    go func() {\n        defer close(c)\n        wg.Wait()\n    }()\n    go func() {\n        runFunc()\n        c &lt;- nil\n        wg.Done()\n    }()\n    select {\n    case &lt;-c:\n        return false\n    case &lt;-time.After(timeout):\n        return true\n    }\n}\n</code></pre>\n\n<p>with the long running function working but this is for a long-running server which can lead to massive memory leaks/wasted cpu cycles over time. </p>\n"}, {"tags": ["go", "memory-management", "struct", "instances"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1528328850, "last_edit_date": 1528328850, "creation_date": 1528328504, "answer_id": 50731115, "question_id": 50731026, "link": "https://stackoverflow.com/questions/50731026/return-a-new-struct-instance-in-golang/50731115#50731115", "title": "Return a new Struct instance in Golang", "body": "<p>The values created by <code>EndRangeTest</code> share the backing arrays of <code>net.IPv6zero</code> or <code>net.IPv4zero</code>. A change to the backing array of one <code>DDIAddress</code> changes the backing array of other <code>DDIAddress</code> values of the same size. </p>\n\n<p>To fix the problem, allocate a new slice:</p>\n\n<pre><code>   if addr.isIPv4() == false {\n      maskSize = 16\n      start = 0\n      endAddr.IP = make(net.IP, net.IPv6len)\n   } else {\n      maskSize = 4\n      start = 12\n      endAddr.IP = make(net.IP, net.IPv4len)\n   }\n</code></pre>\n"}], "owner": {"reputation": 80, "user_id": 5802463, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0fdd5f762758d1e80f640f676cda72d9?s=128&d=identicon&r=PG", "display_name": "eman_44", "link": "https://stackoverflow.com/users/5802463/eman-44"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 548, "favorite_count": 0, "accepted_answer_id": 50731115, "answer_count": 1, "score": 0, "last_activity_date": 1528328850, "creation_date": 1528327865, "question_id": 50731026, "link": "https://stackoverflow.com/questions/50731026/return-a-new-struct-instance-in-golang", "title": "Return a new Struct instance in Golang", "body": "<p>My goal is to return a new DDIAddress from EndRangeTest(); however, when I try to do this, subsequent calls to EndRangeTest seem to modify the same struct instance instead of creating a new object. </p>\n\n<p>For instance, when I run the code below, I expect tRange to be 127.0.0.255 and sRange equal to 255.0.0.20. But what actually happens is  that s.EndRangeTest() modifies tRange. </p>\n\n<pre><code>t := new(DDIAddress)\ns := new(DDIAddress)\n\nt.FromString(\"127.0.0.1\")\nt.cidr = 24\n\ns.FromString(\"255.0.0.20\")\ns.cidr = 32\n\ntRange := t.EndRangeTest()\nfmt.Printf(\"T Result:%s\\n\", tRange.String())\n\nsRange := s.EndRangeTest()\n\nfmt.Printf(\"S Result:%s\\n\", sRange.String())\nfmt.Printf(\"T Result:%s\\n\\n\\n\", tRange.String())\n</code></pre>\n\n<p>Output: </p>\n\n<pre><code>T Result:127.0.0.255\nS Result:255.0.0.20\nT Result:255.0.0.20\n</code></pre>\n\n<p>I am new to Go, and don't understand what I am doing wrong here.  </p>\n\n<p>My DDIAddress struct is implemented as followed:</p>\n\n<pre><code>type DDIAddress struct {\n    net.IP\n    cidr uint32\n}\n\nfunc (addr *DDIAddress) EndRangeTest() (DDIAddress) {\n   var maskSize int\n   var start int\n\n   endAddr := DDIAddress{}\n\n   if addr.isIPv4() == false {\n      maskSize = 16\n      start = 0\n      endAddr.IP = net.IPv6zero\n   }else{\n      maskSize = 4\n      start = 12\n      endAddr.IP = net.IPv4zero\n   }\n\n   mask := net.CIDRMask(int(addr.cidr), 8*maskSize)\n\n   for i :=0; i &lt; maskSize; i++{\n      endAddr.IP[start] = addr.IP[start] | (mask[i] ^ 0xff)\n      start++\n   }\n\n   return endAddr\n}\n</code></pre>\n\n<p>Thanks!</p>\n"}, {"tags": ["docker", "go", "dockerfile", "docker-multi-stage-build"], "comments": [{"owner": {"reputation": 197, "user_id": 3020267, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a78f6cc4fc127a344343983280674d46?s=128&d=identicon&r=PG", "display_name": "kakashi", "link": "https://stackoverflow.com/users/3020267/kakashi"}, "edited": false, "score": 0, "creation_date": 1528327381, "post_id": 50730918, "comment_id": 88469590, "body": "can you try <code>docker history --no-trunc</code> to see what&#39;s inside the image?"}], "answers": [{"comments": [{"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 1, "creation_date": 1528370577, "post_id": 50731117, "comment_id": 88487330, "body": "So <code>&#47;</code> was copied from the container of the first stage."}], "tags": [], "owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "is_accepted": true, "score": 3, "last_activity_date": 1528328519, "creation_date": 1528328519, "answer_id": 50731117, "question_id": 50730918, "link": "https://stackoverflow.com/questions/50730918/why-is-my-final-docker-image-in-this-multi-stage-build-so-large/50731117#50731117", "title": "Why is my final docker image in this multi-stage build so large?", "body": "<p>Buried deep in the Docker documentation I found that my <code>ARG</code> and <code>ENV</code> definitions were cleared when I started the final <code>FROM</code>.  Redefining them solved the issue:</p>\n\n<pre><code># Configure environment and build settings.\nFROM golang:alpine AS buildstage\nARG name=ddmnh\nENV GOPATH=/gopath\n\n# Create the working directory.\nWORKDIR ${GOPATH}\n\n# Copy the repository into the image.\nADD . ${GOPATH}\n\n# Move to GOPATH, install dependencies and build the binary.\nRUN cd ${GOPATH} &amp;&amp; go get ${name}\nRUN CGO_ENABLED=0 GOOS=linux go build ${name}\n\n# Multi-stage build, we just use plain alpine for the final image.\nFROM alpine:latest\nARG name=ddmnh\nENV GOPATH=/gopath\n\n# Copy the binary from the first stage.\nCOPY --from=buildstage ${GOPATH}/${name} ./${name}\nRUN chmod u+x ./${name}\n\n# Expose Port 80.\nEXPOSE 80\n\n# Set the run command.\nCMD ./ddmnh\n</code></pre>\n"}], "owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 920, "favorite_count": 0, "accepted_answer_id": 50731117, "answer_count": 1, "score": 3, "last_activity_date": 1595581740, "creation_date": 1528327050, "last_edit_date": 1533691551, "question_id": 50730918, "link": "https://stackoverflow.com/questions/50730918/why-is-my-final-docker-image-in-this-multi-stage-build-so-large", "title": "Why is my final docker image in this multi-stage build so large?", "body": "<p>After reading about the enormous image size reductions that are possible with multi-stage docker builds, I'm attempting to slim down the image size for a Dockerfile I have for building a Go binary.  My Dockerfile is below.</p>\n\n<pre><code># Configure environment and build settings.\nFROM golang:alpine AS buildstage\nARG name=ddmnh\nENV GOPATH=/gopath\n\n# Create the working directory.\nWORKDIR ${GOPATH}\n\n# Copy the repository into the image.\nADD . ${GOPATH}\n\n# Move to GOPATH, install dependencies and build the binary.\nRUN cd ${GOPATH} &amp;&amp; go get ${name}\nRUN CGO_ENABLED=0 GOOS=linux go build ${name}\n\n# Multi-stage build, we just use plain alpine for the final image.\nFROM alpine:latest\n\n# Copy the binary from the first stage.\nCOPY --from=buildstage ${GOPATH}/${name} ./${name}\nRUN chmod u+x ./${name}\n\n# Expose Port 80.\nEXPOSE 80\n\n# Set the run command.\nCMD ./ddmnh\n</code></pre>\n\n<p>The resulting image, however, doesn't seem to be size reduced at all.  I suspect that the <code>golang:alpine</code> image is being included somehow.  Below is a screenshot of the results of running <code>docker build .</code> on the Dockerfile above.</p>\n\n<p><a href=\"https://i.stack.imgur.com/o8P1I.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/o8P1I.png\" alt=\"docker images\"></a></p>\n\n<p>The <code>alpine:latest</code> image is only 4.15MB.  Adding the size of the compiled binary (which is relatively small) I would expect no more than, say, maybe 15MB for the final image.  But it's 407MB.  I'm clearly doing something wrong!</p>\n\n<p>How can I adjust my Dockerfile to produce an image of less size?</p>\n"}, {"tags": ["go", "types", "maps"], "answers": [{"comments": [{"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1528325252, "post_id": 50730619, "comment_id": 88469001, "body": "Is a good workaround! i wonder if there is no way to avoid instanciating a new struct (<code>Person{}</code>) of the given type in order to get the type? In that case a recommended approach would be to have an internal struct of type Person instanciated (i.e. in universe block golang but not public) that as &quot;living representation of the type&quot;?"}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1528325548, "post_id": 50730619, "comment_id": 88469095, "body": "Thanks @ThunderCat!! very valuable info you share! No idea what kind of vuddu magic is <code>reflect.TypeOf((*Person)(nil)).Elem()</code> but thanks for the idea!"}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1528325901, "post_id": 50730619, "comment_id": 88469195, "body": "Let&#39;s call this tecnique &quot;type based on living representation&quot; shall we :D. You need to create an instance of the given type (pointer or value) in order to get the type."}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1528326338, "post_id": 50730619, "comment_id": 88469310, "body": "please, allow me to maintain this question open for a little bit more  (in order to be able get more answers). If no more information is provided to this question this shall be the correct answer. As &quot;type based on living represantion&quot; is the idiomatic way to map types (until golang-dev-team implements comparision of types &quot;as-is&quot;)"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1528325376, "last_edit_date": 1528325376, "creation_date": 1528325001, "answer_id": 50730619, "question_id": 50730331, "link": "https://stackoverflow.com/questions/50730331/mapping-concrete-types/50730619#50730619", "title": "Mapping concrete types", "body": "<p>Use <code>reflect.Type</code> as the key:</p>\n\n<pre><code>var tableNameByType map[reflect.Type]string = map[reflect.Type]string{\n    reflect.TypeOf(Person{}): \"person\",\n}\n</code></pre>\n\n<p>You can get the name for a type using:</p>\n\n<pre><code>name := tableNameByType[reflect.TypeOf(Person{})]\n</code></pre>\n\n<p>... or the name for value <code>v</code> using:</p>\n\n<pre><code>name := tableNameByType[reflect.ValueOf(v).Type()]\n</code></pre>\n\n<p>You can avoid instantiating the struct value by replacing <code>reflect.TypeOf(Person{})</code> with <code>reflect.TypeOf((*Person)(nil)).Elem()</code> in the above code.</p>\n"}], "owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 1, "accepted_answer_id": 50730619, "answer_count": 1, "score": 0, "last_activity_date": 1528352521, "creation_date": 1528322865, "last_edit_date": 1528324681, "question_id": 50730331, "link": "https://stackoverflow.com/questions/50730331/mapping-concrete-types", "title": "Mapping concrete types", "body": "<p>What is the idiomatic way to define something like <code>map[type]interface{}</code>?</p>\n\n<p>As far i can see the <strong>type</strong> (as keyword) is not something <em>comparable</em> so can not be used as a key in a map. Maybe i'm going in the wrong way, so i would accept any suggestion.</p>\n\n<p>TL;DR;</p>\n\n<p>Example motivation</p>\n\n<p>Let's asume in the appplication model i have <strong>type</strong> called <strong>Person</strong>, being stored in a <em>table</em> named <strong>\"person\"</strong> of a <em>rdbms</em>.</p>\n\n<p>If i would like to link the entity object <strong>Person</strong> to the the <strong>table name</strong>. Things that by definition doens't come together, so it is wise to avoid polluting the Person struct with \"not-naturally-related\" (this is where my java-OO-based mind appears) [pointer|value]-recieve methods, so a map could be in handy here, right? (maps are great for associating things from differents worlds or sets, right?)</p>\n\n<pre><code>var tableNameByType map[type]string = map[type]string{\n      Person: \"person\",\n}\n</code></pre>\n\n<p>This statement causes the compiler to yell at me complaining about <code>expected type, found 'type'</code>. I have tried used instead of type, interface{} and struct, with no better results.</p>\n\n<p>In advance, thanks for taking the time of reading me.</p>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1528318908, "post_id": 50729437, "comment_id": 88466839, "body": "If the goroutine is blocked on <code>s.output &lt;- 42</code>, then it can&#39;t return. The point of <code>s.ctx.Done()</code> being a channel is so you can select against multiple cases."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9905513"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528320567, "post_id": 50729437, "comment_id": 88467516, "body": "Gotcha. What I am trying to figure out is how to get the client to give up and move on in the case of a timeout, without leaving the service hung up when it eventually gets around to putting something on the output channel."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1528320702, "post_id": 50729437, "comment_id": 88467562, "body": "<code>ctx.Done()</code> is a channel so you can select against multiple cases -- select between <code>s.output</code>, and the <code>cdx.Done()</code> channel. I don&#39;t understand why there&#39;s another goroutine involved here."}], "answers": [{"tags": [], "owner": {"reputation": 216, "user_id": 5039386, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y1c-Clsbdkw/AAAAAAAAAAI/AAAAAAAAAKA/WFHwWVc3h_I/photo.jpg?sz=128", "display_name": "Hau Ma", "link": "https://stackoverflow.com/users/5039386/hau-ma"}, "is_accepted": false, "score": 0, "last_activity_date": 1530184250, "creation_date": 1530184250, "answer_id": 51081417, "question_id": 50729437, "link": "https://stackoverflow.com/questions/50729437/goroutine-leak-with-context-timeout/51081417#51081417", "title": "goroutine leak with context timeout?", "body": "<p>Context has timeout of 5 milliseconds and you sleep for 10 millisecond before this line <code>s.output &lt;-42</code> is run. So the context is timeout first and error occurs, that correct, but take a look at <code>main</code> function:</p>\n\n<pre><code>select {\n    case o := &lt;-s.output:\n        fmt.Println(\"output: \", o)\n    case err := &lt;-s.errs:\n        fmt.Println(\"error: \", err)\n    }\n</code></pre>\n\n<p>The <code>select</code> statement has reached case <code>err := &lt;-s.errs</code> so it will break the select and go to the end of <code>main</code> function => program exit\nEven if <code>s.output &lt;- 42</code> is call simultaneously with <code>s.errs &lt;- errors.New(\"ctx done\")</code> only one case has reached in <code>select</code> statement, if you need to reach second case, put a loop around select statement</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9905513"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 483, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1530184250, "creation_date": 1528318430, "question_id": 50729437, "link": "https://stackoverflow.com/questions/50729437/goroutine-leak-with-context-timeout", "title": "goroutine leak with context timeout?", "body": "<p>In the code below, a client is putting a string on a service's input channel and listening for a reply on either an output or an error channel.</p>\n\n<p>The context is set with a 5ms timeout.</p>\n\n<pre><code>func (s service) run() {\n    &lt;-s.input\n\n    go func() {\n        select {\n        case &lt;-s.ctx.Done():\n            s.errs &lt;- errors.New(\"ctx done\")\n            return\n        }\n    }()\n\n    time.Sleep(10 * time.Millisecond)\n    s.output &lt;- 42\n    fmt.Println(\"run exit\")\n}\n</code></pre>\n\n<p>The code times out correctly (due to the 10ms sleep) and outputs </p>\n\n<pre><code>error:  ctx done\n</code></pre>\n\n<p>However, the \"run exit\" is never printed.</p>\n\n<p><strong>Question</strong>: Is there a goroutine leak with processes stuck on </p>\n\n<pre><code>s.output &lt;- 42\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/S1K9thh6Anx\" rel=\"nofollow noreferrer\">Go Playground</a> example</p>\n"}, {"tags": ["math", "go", "geometry", "line"], "comments": [{"owner": {"reputation": 45308, "user_id": 3483203, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/592wq.png?s=128&g=1", "display_name": "user3483203", "link": "https://stackoverflow.com/users/3483203/user3483203"}, "edited": false, "score": 2, "creation_date": 1528316757, "post_id": 50728950, "comment_id": 88465884, "body": "SO is not a tutorial site or free code writing service.  Please check out <a href=\"https://stackoverflow.com/questions/how-to-ask\">How to Ask</a>, as well as look at the <a href=\"https://stackoverflow.com/help/on-topic\">help center</a> to see which topics are appropriate to ask about here."}, {"owner": {"reputation": 824, "user_id": 733100, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/954f89b0decc75e8355cf87699ab0e60?s=128&d=identicon&r=PG", "display_name": "64bit_twitchyliquid", "link": "https://stackoverflow.com/users/733100/64bit-twitchyliquid"}, "reply_to_user": {"reputation": 45308, "user_id": 3483203, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/592wq.png?s=128&g=1", "display_name": "user3483203", "link": "https://stackoverflow.com/users/3483203/user3483203"}, "edited": false, "score": 0, "creation_date": 1528316872, "post_id": 50728950, "comment_id": 88465937, "body": "As far as I can tell I meet everything mentioned in the How to Ask section? I&#39;m asking for algorithmic advice, not dev freebies."}, {"owner": {"reputation": 647, "user_id": 4288069, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/OitGe.jpg?s=128&g=1", "display_name": "Ben Quigley", "link": "https://stackoverflow.com/users/4288069/ben-quigley"}, "edited": false, "score": 0, "creation_date": 1528316917, "post_id": 50728950, "comment_id": 88465953, "body": "I ran into this issue recently, but I didn&#39;t bother to write code that solved the problem perfectly. In other words, my lines do fall off the canvas a little bit, not that the user can tell. Is there a reason why you must solve this problem?"}, {"owner": {"reputation": 13335, "user_id": 8204776, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e6qyq.jpg?s=128&g=1", "display_name": "meowgoesthedog", "link": "https://stackoverflow.com/users/8204776/meowgoesthedog"}, "edited": false, "score": 1, "creation_date": 1528316973, "post_id": 50728950, "comment_id": 88465978, "body": "Just clip the lines with e.g. Sutherland-Hodgman."}, {"owner": {"reputation": 824, "user_id": 733100, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/954f89b0decc75e8355cf87699ab0e60?s=128&d=identicon&r=PG", "display_name": "64bit_twitchyliquid", "link": "https://stackoverflow.com/users/733100/64bit-twitchyliquid"}, "edited": false, "score": 0, "creation_date": 1528317025, "post_id": 50728950, "comment_id": 88465999, "body": "Hi Ben. Some PCB fabricators (eg: mine) care if your generated drawings exceed the bounds of your design, so I need a clean cutoff at exactly the board edge."}, {"owner": {"reputation": 2338, "user_id": 3080953, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fe6bc2a51d294b0d1d65fa203e496c7a?s=128&d=identicon&r=PG&f=1", "display_name": "c2huc2hu", "link": "https://stackoverflow.com/users/3080953/c2huc2hu"}, "edited": false, "score": 0, "creation_date": 1528320363, "post_id": 50728950, "comment_id": 88467449, "body": "Find the point where your boundary and road intersect: <a href=\"https://stackoverflow.com/questions/563198/how-do-you-detect-where-two-line-segments-intersect\" title=\"how do you detect where two line segments intersect\">stackoverflow.com/questions/563198/&hellip;</a>"}, {"owner": {"reputation": 48421, "user_id": 1196549, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/fa597bf0dc47449a25e1f7f5b57e3ef1?s=128&d=identicon&r=PG", "display_name": "Yves Daoust", "link": "https://stackoverflow.com/users/1196549/yves-daoust"}, "reply_to_user": {"reputation": 13335, "user_id": 8204776, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e6qyq.jpg?s=128&g=1", "display_name": "meowgoesthedog", "link": "https://stackoverflow.com/users/8204776/meowgoesthedog"}, "edited": false, "score": 0, "creation_date": 1528359818, "post_id": 50728950, "comment_id": 88480156, "body": "@meowgoesthedog: Sutherland-Hodgman is a little overkill for an axis-aligned rectangular window. Cohen\u2013Sutherland is more specialized."}], "answers": [{"tags": [], "owner": {"reputation": 824, "user_id": 733100, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/954f89b0decc75e8355cf87699ab0e60?s=128&d=identicon&r=PG", "display_name": "64bit_twitchyliquid", "link": "https://stackoverflow.com/users/733100/64bit-twitchyliquid"}, "is_accepted": false, "score": 0, "last_activity_date": 1528328147, "creation_date": 1528328147, "answer_id": 50731072, "question_id": 50728950, "link": "https://stackoverflow.com/questions/50728950/given-a-set-of-lines-in-2d-space-how-to-truncate-them-to-be-within-bounds/50731072#50731072", "title": "Given a set of lines in 2d space, how to truncate them to be within bounds?", "body": "<p>Sat down and worked it out. My rudimentary approach was to:</p>\n\n<ol>\n<li>Compute the slope of the line &amp; the y-intercept</li>\n<li>Check both points on all four sides to see if they exceed bounds, and if they do, recompute the necessary co-ordinate by plugging the bound into the formula <code>y=mx+b</code>.</li>\n</ol>\n\n<p>Here is my Go code:</p>\n\n<pre><code>func boundLine(line *kcgen.Line) {\nif line.Start.X == line.End.X {\n    panic(\"infinite slope not yet supported\")\n}\nslope := (line.End.Y - line.Start.Y) / (line.End.X - line.Start.X)\nb := line.End.Y - (slope * line.End.X) //y = mx + b which is equivalent to b = y - mx\nif line.Start.X &lt; (-*width/2) {\n    line.Start.Y = (slope * (-*width/2)) + b\n    line.Start.X = -*width/2\n}\nif line.End.X &lt; (-*width/2) {\n    line.End.Y = (slope * (-*width/2)) + b\n    line.End.X = -*width/2\n}\nif line.Start.X &gt; (*width/2) {\n    line.Start.Y = (slope * (*width/2)) + b\n    line.Start.X = *width/2\n}\nif line.End.X &gt; (*width/2) {\n    line.End.Y = (slope * (*width/2)) + b\n    line.End.X = *width/2\n}\n\nif line.Start.Y &lt; (-*height/2) {\n    line.Start.Y = -*height/2\n    line.Start.X = ((-*height/2) - b) / slope //y = mx + b equiv. (y-b)/m = x\n}\nif line.End.Y &lt; (-*height/2) {\n    line.End.Y = -*height/2\n    line.End.X = ((-*height/2) - b) / slope //y = mx + b equiv. (y-b)/m = x\n}\nif line.Start.Y &gt; (*height/2) {\n    line.Start.Y = *height/2\n    line.Start.X = ((*height/2) - b) / slope //y = mx + b equiv. (y-b)/m = x\n}\nif line.End.Y &gt; (*height/2) {\n    line.End.Y = *height/2\n    line.End.X = ((*height/2) - b) / slope //y = mx + b equiv. (y-b)/m = x\n}\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 48421, "user_id": 1196549, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/fa597bf0dc47449a25e1f7f5b57e3ef1?s=128&d=identicon&r=PG", "display_name": "Yves Daoust", "link": "https://stackoverflow.com/users/1196549/yves-daoust"}, "is_accepted": true, "score": 1, "last_activity_date": 1528359606, "creation_date": 1528359606, "answer_id": 50736250, "question_id": 50728950, "link": "https://stackoverflow.com/questions/50728950/given-a-set-of-lines-in-2d-space-how-to-truncate-them-to-be-within-bounds/50736250#50736250", "title": "Given a set of lines in 2d space, how to truncate them to be within bounds?", "body": "<p>Your best friend is the Cohen\u2013Sutherland line clipping algorithm.</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Cohen%E2%80%93Sutherland_algorithm\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Cohen%E2%80%93Sutherland_algorithm</a></p>\n"}], "owner": {"reputation": 824, "user_id": 733100, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/954f89b0decc75e8355cf87699ab0e60?s=128&d=identicon&r=PG", "display_name": "64bit_twitchyliquid", "link": "https://stackoverflow.com/users/733100/64bit-twitchyliquid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 1, "accepted_answer_id": 50736250, "answer_count": 2, "score": -1, "last_activity_date": 1528359606, "creation_date": 1528316569, "last_edit_date": 1528328167, "question_id": 50728950, "link": "https://stackoverflow.com/questions/50728950/given-a-set-of-lines-in-2d-space-how-to-truncate-them-to-be-within-bounds", "title": "Given a set of lines in 2d space, how to truncate them to be within bounds?", "body": "<p><strong>Background:</strong></p>\n\n<p>Heya! I'm trying to generate a circuit board which has a subset of San Francisco printed on it. Most of the pieces of this are done, and I'm generating images that look like this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/jdOpB.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/jdOpB.jpg\" alt=\"Rendered San Francisco\"></a></p>\n\n<p>The problem is that I am rendering lines which extend outside my hardcoded cutoff boundary (I am rendering lines which one side is in and one side is out of bounds).</p>\n\n<p><strong>Question:</strong></p>\n\n<p>Given a set of lines like this:</p>\n\n<pre><code># x1,y1,  x2,y2\n10,10,40,40\n80,80,120,120\n</code></pre>\n\n<p>How can I modify the co-ordinates of each line such that it 'cuts off' at a specific bound?</p>\n\n<p>In the case above, the second line (which in original form) extends to (120,120), should only extend to (100,100) assuming bounds of 100,100.</p>\n\n<p><strong>Thoughts</strong></p>\n\n<p>Based on what I remember from high-school math, I should plug something into the formula <code>y=mx+b</code> yeah? Even then, how would I deal with an infinite gradient or the like?</p>\n\n<p>Thanks for any and all help :D Puesdocode/python/Go preferred, but explanations just as graciously recieved.</p>\n\n<p>&lt;3\nTom</p>\n"}, {"tags": ["go", "ethereum", "solidity", "web3", "go-ethereum"], "answers": [{"tags": [], "owner": {"reputation": 272, "user_id": 9404942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7662221ee2e97291bef4f25e2b960b48?s=128&d=identicon&r=PG&f=1", "display_name": "mirg", "link": "https://stackoverflow.com/users/9404942/mirg"}, "is_accepted": false, "score": 1, "last_activity_date": 1528343010, "creation_date": 1528343010, "answer_id": 50732611, "question_id": 50728855, "link": "https://stackoverflow.com/questions/50728855/pass-parameter-as-bytes32-to-solidity-smart-contract/50732611#50732611", "title": "Pass parameter as bytes32 to Solidity Smart Contract", "body": "<p>I think you have to encode it</p>\n\n<pre><code>types.ComplexString(\"myString\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 17856, "user_id": 1439168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd72ad672b055a7d59cfb1c30d1c724f?s=128&d=identicon&r=PG", "display_name": "Miguel Mota", "link": "https://stackoverflow.com/users/1439168/miguel-mota"}, "is_accepted": false, "score": 1, "last_activity_date": 1528497043, "creation_date": 1528497043, "answer_id": 50769168, "question_id": 50728855, "link": "https://stackoverflow.com/questions/50728855/pass-parameter-as-bytes32-to-solidity-smart-contract/50769168#50769168", "title": "Pass parameter as bytes32 to Solidity Smart Contract", "body": "<p>To convert a string to a <code>bytes32</code> for solidity all you have to do is create a fixed length byte array in Go and copy the string the value to it.</p>\n\n<pre><code>value := [32]byte{}\ncopy(key[:], []byte(\"hello\"))\n</code></pre>\n\n<p>Then you may pass the value to the smart contract function:</p>\n\n<pre><code>hash, err := contract.Send(transaction, \"vote\", value)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1275, "user_id": 3581006, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/Ja6DE.png?s=128&g=1", "display_name": "bergben", "link": "https://stackoverflow.com/users/3581006/bergben"}, "is_accepted": true, "score": 0, "last_activity_date": 1528654866, "creation_date": 1528654866, "answer_id": 50786769, "question_id": 50728855, "link": "https://stackoverflow.com/questions/50728855/pass-parameter-as-bytes32-to-solidity-smart-contract/50786769#50786769", "title": "Pass parameter as bytes32 to Solidity Smart Contract", "body": "<p>The creator of the package told me that the reason for this is this issue: <a href=\"https://github.com/regcostajr/go-web3/issues/31\" rel=\"nofollow noreferrer\">https://github.com/regcostajr/go-web3/issues/31</a></p>\n\n<p>He is trying to solve it.</p>\n"}], "owner": {"reputation": 1275, "user_id": 3581006, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/Ja6DE.png?s=128&g=1", "display_name": "bergben", "link": "https://stackoverflow.com/users/3581006/bergben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1688, "favorite_count": 0, "accepted_answer_id": 50786769, "answer_count": 3, "score": 2, "last_activity_date": 1528654866, "creation_date": 1528316222, "question_id": 50728855, "link": "https://stackoverflow.com/questions/50728855/pass-parameter-as-bytes32-to-solidity-smart-contract", "title": "Pass parameter as bytes32 to Solidity Smart Contract", "body": "<p>I am using <a href=\"https://github.com/regcostajr/go-web3\" rel=\"nofollow noreferrer\">this Ethereum Go Client</a> and trying to pass a string / bytes32 to Solidity.</p>\n\n<p>The function in the smart contract is very simple (for testing now): </p>\n\n<pre><code>  function vote(bytes32 id) {\n    //id has the value 0x0000000000000000000000000000000000000000000000000000000000000000\n  }\n</code></pre>\n\n<p>calling </p>\n\n<pre><code>hash, err := contract.Send(transaction, \"vote\", \"myString\")\n</code></pre>\n\n<p>will result in <code>0x0000000000000000000000000000000000000000000000000000000000000000</code></p>\n\n<p>for the bytes32 param id...</p>\n\n<p>How would I have to pass in the parameter to my Smart Contract from Go so that solidity will have the correct value? </p>\n\n<p>Alternatively I just need to pass a unique identifier for that string that I can easily create in Golang from the string...</p>\n"}, {"tags": ["go", "webserver", "httprequest", "httpresponse", "http-redirect"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1528315664, "post_id": 50728423, "comment_id": 88465400, "body": "&quot;This field is only populated during client redirects.&quot;  This is server code."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1528314997, "creation_date": 1528314997, "answer_id": 50728560, "question_id": 50728423, "link": "https://stackoverflow.com/questions/50728423/why-isnt-the-response-field-of-this-http-request-being-populated/50728560#50728560", "title": "Why isn&#39;t the Response field of this HTTP Request being populated?", "body": "<p>In your sample, the redirect is happening in the browser; the server doesn't get to know what response generated the redirect. That field is populated when making HTTP requests <em>from</em> a Go app; for example, if you use <code>http.Client</code> to request a URL, and the response is a redirect, it generates a new <code>Request</code> for the redirect URL, and in <em>that</em> <code>Request</code>, the <code>Response</code> field will be populated with the response that triggered that redirect.</p>\n\n<p>This is evidenced in the source for <code>http.Client</code>: <a href=\"https://golang.org/src/net/http/client.go#L669\" rel=\"nofollow noreferrer\">https://golang.org/src/net/http/client.go#L669</a></p>\n"}], "owner": {"reputation": 2279, "user_id": 1353391, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/113cbd78d7b98635d06c25f31f0b2b94?s=128&d=identicon&r=PG", "display_name": "John Gowers", "link": "https://stackoverflow.com/users/1353391/john-gowers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 20, "favorite_count": 0, "accepted_answer_id": 50728560, "answer_count": 1, "score": 0, "last_activity_date": 1528314997, "creation_date": 1528314469, "question_id": 50728423, "link": "https://stackoverflow.com/questions/50728423/why-isnt-the-response-field-of-this-http-request-being-populated", "title": "Why isn&#39;t the Response field of this HTTP Request being populated?", "body": "<p>The comment for the field <code>Response</code> in the type <code>http.Request</code> is as follows.</p>\n\n<pre><code>// Response is the redirect response which caused this request\n// to be created. This field is only populated during client\n// redirects.\nResponse *Response\n</code></pre>\n\n<p>However, it seems to me that this field is not being populated during requests, as it is implied that it is.  Consider the following example:</p>\n\n<pre><code>package main\n\nimport (\n  \"net/http\"\n  \"log\"\n  \"fmt\"\n)\n\nfunc handleA(writer http.ResponseWriter, request *http.Request) {\n  http.Redirect(writer, request, \"/b\", http.StatusSeeOther)\n}\n\nfunc handleB(writer http.ResponseWriter, request *http.Request) {\n  fmt.Println(request.Response)\n}\n\nfunc main() {\n  http.HandleFunc(\"/a\", handleA)\n  http.HandleFunc(\"/b\", handleB)\n  log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n</code></pre>\n\n<p>If I compile and run this code and navigate to <code>localhost:8080/a</code>, then I get redirected to <code>localhost:8080/b</code> and the server prints <code>&lt;nil&gt;</code> to the console.  But shouldn't it be printing out a non-<code>nil</code> value, since the request is coming as the result of a redirect?</p>\n"}, {"tags": ["go", "go-packages"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528313112, "post_id": 50728066, "comment_id": 88464176, "body": "<a href=\"https://godoc.org/os#File.Read\" rel=\"nofollow noreferrer\">Read</a> reads bytes from the file. The buffer starts of empty and is filled by the call to Read."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528343732, "post_id": 50728066, "comment_id": 88473185, "body": "Take the Tour of Go to learn about all this."}], "answers": [{"tags": [], "owner": {"reputation": 1178, "user_id": 3967945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d671333d111810416ba4952f1da75c1?s=128&d=identicon&r=PG", "display_name": "mroman", "link": "https://stackoverflow.com/users/3967945/mroman"}, "is_accepted": true, "score": 0, "last_activity_date": 1528959432, "creation_date": 1528959432, "answer_id": 50851354, "question_id": 50728066, "link": "https://stackoverflow.com/questions/50728066/os-read-how-is-work-golang/50851354#50851354", "title": "os.Read() How is work? Golang", "body": "<blockquote>\n  <p>Unless bs is only argument, how Read() can Change it?</p>\n</blockquote>\n\n<p>It seems that you may be missing basic knowledge about programming languages in general. There are different kind of \"values\". There are pointers (or references) and there are the \"usual values\".</p>\n\n<p>For example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc changeIt(p *int) {\n    *p = 9\n}\n\nfunc main() {\n    a := 1\n    fmt.Println(a)\n    changeIt(&amp;a)\n    fmt.Println(a)\n}\n</code></pre>\n\n<p>It'll print <code>1 9</code> not <code>1 1</code>. <code>*int</code> is not an integer, but a pointer to an integer. A pointer is a value that points (references) another value. If you have a value of type pointer you get the actual value that the pointer points to by using <code>*</code> (which is called dereferencing):</p>\n\n<pre><code>func main() {\n    a := 1\n    b := &amp;a\n    fmt.Println(b, *b)\n}\n</code></pre>\n\n<p><code>b</code> is a pointer (of type <code>*int</code>) that points to <code>a</code>. The <code>println</code> will print the location of <code>a</code> followed by the value of <code>a</code> which is usually something like uhm <code>0x10414020 1</code>. We can also modify the value a pointer points to by using <code>*p = ...</code>:</p>\n\n<pre><code>func main() {\n    a := 1\n    b := &amp;a\n    *b = 9\n    fmt.Println(b, *b, a)\n}\n</code></pre>\n\n<p>which will print <code>0x10414020 9 9</code>.</p>\n\n<p>Now, <code>[]byte</code> is a slice... slices are like pointers. When you do</p>\n\n<pre><code>func changeIt(buf []byte) {\n    buf[0] = 10\n}\n\nfunc main() {\n    data := []byte{1,2,3}\n    changeIt(data)\n    fmt.Println(data)\n}\n</code></pre>\n\n<p>You're not actually passing the values <code>[1 2 3]</code> to <code>changeIt</code> but a pointer to those values. Thus here the <code>println</code> will show <code>[10 2 3]</code>. Compare this to:</p>\n\n<pre><code>func changeIt(buf [3]byte) {\n    buf[0] = 10\n}\n\nfunc main() {\n    data := [3]byte{1,2,3}\n    changeIt(data)\n    fmt.Println(data)\n}\n</code></pre>\n\n<p>Which will print <code>[1 2 3]</code> and it will pass the values <code>[1 2 3]</code> and not a pointer so changeIt essentially works on a copy and the <code>buf[0] = 10</code> has no effect. Remember: <code>[n]T</code> is an array, <code>[]T</code> is a slice. <code>[n]T</code> is a \"raw value\" and <code>[]T</code> is a \"pointer value\". </p>\n"}], "owner": {"reputation": 5, "user_id": 4670673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/p5U6m.jpg?s=128&g=1", "display_name": "Py_Dev", "link": "https://stackoverflow.com/users/4670673/py-dev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 300, "favorite_count": 0, "accepted_answer_id": 50851354, "answer_count": 1, "score": -3, "last_activity_date": 1528959432, "creation_date": 1528312911, "last_edit_date": 1528316250, "question_id": 50728066, "link": "https://stackoverflow.com/questions/50728066/os-read-how-is-work-golang", "title": "os.Read() How is work? Golang", "body": "<p>Why if I print <code>bs</code>, before calling <code>Read()</code>, it prints nothing, but after the call <code>file.Read(bs)</code>, it shows the inside of test.txt file. Unless <code>bs</code> is only argument, how <code>Read()</code> can Change it?</p>\n\n<pre><code>package main\nimport (\n\"os\"\n\"fmt\"\n)\n\nfunc main() {\n    file , err := os.Open(\"test.txt\")\nif err == nil {\n} else {\n\n}\nstat , _ := file.Stat()\n\n\nbs := make([]byte, stat.Size())\nfmt.Println(string(bs))\nbsf ,err := file.Read(bs)\n\nif err != nil{\n    fmt.Println(err)\n    fmt.Println(bsf)\n}\nfmt.Println(string(bs))\n\n\n} \n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>(Line1)                                           \n(Line2)hi, This is Example text in test.txt file.\n</code></pre>\n"}, {"tags": ["pdf", "go", "pdf-generation", "google-noto"], "answers": [{"tags": [], "owner": {"reputation": 76, "user_id": 9921401, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-eCYKXxQD-DQ/AAAAAAAAAAI/AAAAAAAAAEc/yUvxfBb4gbk/photo.jpg?sz=128", "display_name": "Chad Maine", "link": "https://stackoverflow.com/users/9921401/chad-maine"}, "is_accepted": false, "score": 0, "last_activity_date": 1528886952, "creation_date": 1528886952, "answer_id": 50835319, "question_id": 50727535, "link": "https://stackoverflow.com/questions/50727535/using-google-noto-fonts-with-gopdf/50835319#50835319", "title": "Using Google Noto fonts with goPdf", "body": "<p>It looks like gopdf supports embedding fonts:</p>\n\n<p><a href=\"https://godoc.org/github.com/signintech/gopdf#GoPdf.AddTTFFont\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/signintech/gopdf#GoPdf.AddTTFFont</a></p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 8630306, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-6BhWa3jDg24/AAAAAAAAAAI/AAAAAAAAU8k/_fJ-1IK9t0g/photo.jpg?sz=128", "display_name": "oneplus anantapan", "link": "https://stackoverflow.com/users/8630306/oneplus-anantapan"}, "is_accepted": false, "score": 0, "last_activity_date": 1532681784, "last_edit_date": 1532681784, "creation_date": 1532680005, "answer_id": 51553894, "question_id": 50727535, "link": "https://stackoverflow.com/questions/50727535/using-google-noto-fonts-with-gopdf/51553894#51553894", "title": "Using Google Noto fonts with goPdf", "body": "<p>GoPdf support only embedding <code>.ttf</code> font.</p>\n\n<p>Example:</p>\n\n<pre><code>gp := gopdf.GoPdf{}\n...\ngp.AddTTFFont(\"fontname\",\"./fonts/fontfile.ttf\") //add font\n...\ngp.SetFont(\"fontname\",\"\",14)  //use font\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 6651722, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/tHDzV.png?s=128&g=1", "display_name": "nullptr", "link": "https://stackoverflow.com/users/6651722/nullptr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 411, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1532681784, "creation_date": 1528310936, "question_id": 50727535, "link": "https://stackoverflow.com/questions/50727535/using-google-noto-fonts-with-gopdf", "title": "Using Google Noto fonts with goPdf", "body": "<p>I am trying to use this <a href=\"https://www.google.com/get/noto/#sans-thai\" rel=\"nofollow noreferrer\">Google Noto font</a>, but all I'm seeing are squares when I print to pdf. Does anyone know how to add this font to <a href=\"https://github.com/signintech/gopdf\" rel=\"nofollow noreferrer\">goPdf</a>?</p>\n"}, {"tags": ["arrays", "go"], "answers": [{"comments": [{"owner": {"reputation": 8230, "user_id": 2876830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/23e4baefc1b032e53e723ce13f34f9c3?s=128&d=identicon&r=PG&f=1", "display_name": "YaFred", "link": "https://stackoverflow.com/users/2876830/yafred"}, "edited": false, "score": 0, "creation_date": 1528318440, "post_id": 50726629, "comment_id": 88466625, "body": "Your answer is exactly what I was looking for. However, now I understand better, I&#39;m not sure I agree with your editing my question. I think the slices are a mean to access the array (so in my question, array was the right terminology I think)"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 8230, "user_id": 2876830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/23e4baefc1b032e53e723ce13f34f9c3?s=128&d=identicon&r=PG&f=1", "display_name": "YaFred", "link": "https://stackoverflow.com/users/2876830/yafred"}, "edited": false, "score": 0, "creation_date": 1528324708, "post_id": 50726629, "comment_id": 88468816, "body": "@YaFred The code in question uses slices, not arrays. If you had asked how to copy a [4]byte the end of a [10]byte, then array would have been the correct term to use."}, {"owner": {"reputation": 8230, "user_id": 2876830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/23e4baefc1b032e53e723ce13f34f9c3?s=128&d=identicon&r=PG&f=1", "display_name": "YaFred", "link": "https://stackoverflow.com/users/2876830/yafred"}, "edited": false, "score": 0, "creation_date": 1528620079, "post_id": 50726629, "comment_id": 88570582, "body": "because of make() ... Ok, I get it now."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 8230, "user_id": 2876830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/23e4baefc1b032e53e723ce13f34f9c3?s=128&d=identicon&r=PG&f=1", "display_name": "YaFred", "link": "https://stackoverflow.com/users/2876830/yafred"}, "edited": false, "score": 0, "creation_date": 1528639356, "post_id": 50726629, "comment_id": 88575429, "body": "It&#39;s because small and big are slices, not arrays. It&#39;s unimportant that the slice was created with make."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1528307478, "creation_date": 1528307478, "answer_id": 50726629, "question_id": 50726577, "link": "https://stackoverflow.com/questions/50726577/how-to-copy-a-small-slice-to-the-end-of-a-bigger-slice/50726629#50726629", "title": "How to copy a small slice to the end of a bigger slice", "body": "<p>Use the builtin <a href=\"https://godoc.org/builtin#copy\" rel=\"nofollow noreferrer\">copy</a> function:</p>\n\n<pre><code>copy(big[6:], small) \n</code></pre>\n"}], "owner": {"reputation": 8230, "user_id": 2876830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/23e4baefc1b032e53e723ce13f34f9c3?s=128&d=identicon&r=PG&f=1", "display_name": "YaFred", "link": "https://stackoverflow.com/users/2876830/yafred"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 0, "accepted_answer_id": 50726629, "answer_count": 1, "score": 1, "last_activity_date": 1528307478, "creation_date": 1528307293, "last_edit_date": 1528307421, "question_id": 50726577, "link": "https://stackoverflow.com/questions/50726577/how-to-copy-a-small-slice-to-the-end-of-a-bigger-slice", "title": "How to copy a small slice to the end of a bigger slice", "body": "<p>I'm looking for the equivalent of Java <code>System.arraycopy()</code></p>\n\n<p>Let's say I have 2 slices</p>\n\n<pre><code>small := make([]byte, 4)\nbig := make([]byte, 10)\n</code></pre>\n\n<p>I'd like to copy the content of <code>small</code> to <code>big</code> at position 6 (the bytes of <code>small</code> being the last bytes of <code>big</code></p>\n\n<p>The only way I found is to write a loop.</p>\n"}, {"tags": ["debugging", "go", "visual-studio-code"], "answers": [{"tags": [], "owner": {"reputation": 13, "user_id": 4289298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dac9061d7f46a55d2ba2e01293dac551?s=128&d=identicon&r=PG&f=1", "display_name": "Marco", "link": "https://stackoverflow.com/users/4289298/marco"}, "is_accepted": false, "score": 1, "last_activity_date": 1530792695, "creation_date": 1530792695, "answer_id": 51191014, "question_id": 50726399, "link": "https://stackoverflow.com/questions/50726399/visual-studio-code-cant-find-method-rpcserver-eval/51191014#51191014", "title": "Visual Studio Code - Can&#39;t find method RPCServer.Eval", "body": "<p>I had the same issue, to fix it I added the following to the launch.json file:</p>\n\n<p><code>useAPIv1 : false</code></p>\n\n<p>On linux seems to be key sensitive. Take a look at this post where I found the information: <a href=\"https://github.com/Microsoft/vscode/issues/51370\" rel=\"nofollow noreferrer\">https://github.com/Microsoft/vscode/issues/51370</a></p>\n"}], "owner": {"reputation": 102, "user_id": 4464033, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/15779d496f6ed2c56990cfcb2fe3219c?s=128&d=identicon&r=PG&f=1", "display_name": "Masoud Safi", "link": "https://stackoverflow.com/users/4464033/masoud-safi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1530792695, "creation_date": 1528306653, "last_edit_date": 1528307457, "question_id": 50726399, "link": "https://stackoverflow.com/questions/50726399/visual-studio-code-cant-find-method-rpcserver-eval", "title": "Visual Studio Code - Can&#39;t find method RPCServer.Eval", "body": "<p>When debugging GoLang in Visual Studio Code, once a break point is hit, typing anything such as \"help\" in the prompt (bottom) will return the below  error message.  Wondering if it is a configuration issue?</p>\n\n<p>help\nnot available\n2018/06/06 10:31:57 server.go:266: rpc: can't find method RPCServer.Eval</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528303285, "post_id": 50725468, "comment_id": 88459165, "body": "Do you have the static libraries installed?"}, {"owner": {"reputation": 2732, "user_id": 2061886, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/dkfiz.jpg?s=128&g=1", "display_name": "lightweight", "link": "https://stackoverflow.com/users/2061886/lightweight"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528303384, "post_id": 50725468, "comment_id": 88459222, "body": "I believe so? code works on the ec2, but I&#39;m not too familiar with C and go and how to check that"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528304064, "post_id": 50725468, "comment_id": 88459582, "body": "I don&#39;t understand -- the output here shows it&#39;s running on ec2, but you say it works on ec2. Where doesn&#39;t it work? You also are not supposed to statically link glibc, so I&#39;m confused what actual goal is here."}, {"owner": {"reputation": 2732, "user_id": 2061886, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/dkfiz.jpg?s=128&g=1", "display_name": "lightweight", "link": "https://stackoverflow.com/users/2061886/lightweight"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528304263, "post_id": 50725468, "comment_id": 88459684, "body": "ah so I&#39;m compiling this on ec2 and then running it in aws lambda. Essentially I&#39;m trying to get the kafka go confluent client to run in aws lambda. The confluent go client uses librdkafka which uses some other C libraries I think"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528305451, "post_id": 50725468, "comment_id": 88460324, "body": "You need to start by installing the static libraries on your ec2 instance. You should also check what cgo flags may be set in the confluent source. You may have better luck only statically linking the librdkafka specific dependencies and avoid glibc versions differing at runtime. If that fails, statically linking with a different libc like musl may have better results."}, {"owner": {"reputation": 2732, "user_id": 2061886, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/dkfiz.jpg?s=128&g=1", "display_name": "lightweight", "link": "https://stackoverflow.com/users/2061886/lightweight"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528305680, "post_id": 50725468, "comment_id": 88460444, "body": "so when I do the <code>make</code> and <code>make install</code> on librdkafka, make sure to statically link its dependencies?"}], "owner": {"reputation": 2732, "user_id": 2061886, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/dkfiz.jpg?s=128&g=1", "display_name": "lightweight", "link": "https://stackoverflow.com/users/2061886/lightweight"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 547, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1528303933, "creation_date": 1528303186, "last_edit_date": 1528303933, "question_id": 50725468, "link": "https://stackoverflow.com/questions/50725468/compiling-go-with-static-c-libraries", "title": "compiling go with static c libraries", "body": "<p>I'm trying to compile Go where it includes all the libraries that I need to run it. I'm trying to run the go binary in lambda so I need to add some C libraries (I think) when I build it (on linux), but when I do, I get this error:</p>\n\n<pre><code>[ec2-user@ip- src]$ go build -tags static --ldflags '-extldflags \"-static -lpthread -lxml2 -lz -lm -llzma -lc\"' main.go\n# command-line-arguments\n/usr/local/go/pkg/tool/linux_amd64/link: running gcc failed: exit status 1\n/usr/bin/ld: cannot find -lm\n/usr/bin/ld: cannot find -ldl\n/usr/bin/ld: cannot find -lpthread\n/usr/bin/ld: cannot find -lrt\n/usr/bin/ld: cannot find -lpthread\n/usr/bin/ld: cannot find -lpthread\n/usr/bin/ld: cannot find -lxml2\n/usr/bin/ld: cannot find -lz\n/usr/bin/ld: cannot find -lm\n/usr/bin/ld: cannot find -llzma\n/usr/bin/ld: cannot find -lc\n/usr/bin/ld: cannot find -lc\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>---EDIT00000</p>\n\n<p>I did a quick <code>ldconfig</code> search? and see this for example...are these the ones I need?</p>\n\n<pre><code>ldconfig -p | grep -e xml2 -e pthread -e lzma -e dl \n    libxml2.so.2 (libc6,x86-64) =&gt; /lib64/libxml2.so.2\n    libreadline.so.6 (libc6,x86-64) =&gt; /lib64/libreadline.so.6\n    libpthread.so.0 (libc6,x86-64, OS ABI: Linux 2.6.32) =&gt; /lib64/libpthread.so.0\n    liblzma.so.5 (libc6,x86-64) =&gt; /lib64/liblzma.so.5\n    libhandle.so.1 (libc6,x86-64) =&gt; /lib64/libhandle.so.1\n    libgpgme-pthread.so.11 (libc6,x86-64) =&gt; /lib64/libgpgme-pthread.so.11\n    libdl.so.2 (libc6,x86-64, OS ABI: Linux 2.6.32) =&gt; /lib64/libdl.so.2\n    libdl.so (libc6,x86-64, OS ABI: Linux 2.6.32) =&gt; /lib64/libdl.so\n</code></pre>\n"}, {"tags": ["unit-testing", "go", "zip"], "comments": [{"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1530519745, "post_id": 50725437, "comment_id": 89248220, "body": "When you say you need to zip some folder with content into specific target, do you mean that the base folder for the zipped files is taken from param&#91;2], if it&#39;s available ?"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "reply_to_user": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1530522769, "post_id": 50725437, "comment_id": 89249759, "body": "@yes, but what i need some unit test for this mechanism"}], "answers": [{"comments": [{"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1530560604, "post_id": 51133888, "comment_id": 89269659, "body": "Thanks :), But as requested I need unit test, could you please provide it?"}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1530789953, "post_id": 51133888, "comment_id": 89361839, "body": "@shopiaT I&#39;ve updated the answer. Let me know if it&#39;s not clear enough."}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1530825733, "post_id": 51133888, "comment_id": 89381773, "body": "Can you please provide all the test , I want the E2E with the testing framework, I want to check it..thanks!"}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1530881822, "post_id": 51133888, "comment_id": 89402599, "body": "@shopiaT I have added a sample code for a test, but the values of source and newBaseDir as well as the string value of the zipped file created using those parameters need to be known beforehand for the test to be validated."}], "tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": false, "score": 2, "last_activity_date": 1530881841, "last_edit_date": 1530881841, "creation_date": 1530526710, "answer_id": 51133888, "question_id": 50725437, "link": "https://stackoverflow.com/questions/50725437/zip-folder-with-source-and-target/51133888#51133888", "title": "zip folder with source and target", "body": "<p>For Testing :</p>\n\n<p>You can pass a mocked variable <code>zipFile</code> which impliments the <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"nofollow noreferrer\"><code>io.Writer</code></a> interface, as an argument for function <code>zipit</code> and compare it with expected data in a test. <br>\nAlso you would need a known set of files in destination so that you compare it with the value in mock.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/29504852/how-to-test-io-writer-in-golang\">Refer this for testing io.Writer</a></p>\n\n<p>Testing Code :</p>\n\n<p>The string value of a zipped file created with specific values of <code>source</code> &amp; <code>newBaseDir</code> should be known beforehand and stored in <code>want</code>.</p>\n\n<pre><code>func TestZipIt(t *testing.T) {\n\n    source := \"\"\n    newBaseDir := \"\"\n\n    var zipFileMock bytes.Buffer\n    if err := zipit(zipFileMock, source, newBaseDir); err != nil {\n        t.Fatalf(\"zipit() returned an error: %s\", err)\n    }\n\n    got := b.String()\n\n    // want is the value of the zipped file as a string\n    want := ...\n\n    if got != want {\n        t.Errorf(\"zipit() test failed\")\n        // t.Errorf(\"zipit() = %q, want %q\", got, want)\n    }\n}\n</code></pre>\n\n<p>Program Code :</p>\n\n<pre><code>func main() {\n    ...\n    // params[0] is source\n    // params[1] is destination\n    // params[2] is newBaseDirectory\n\n    zipfile, err := os.Create(destination)\n    if err != nil {\n        // handle error\n    }\n    defer zipfile.Close()\n\n    if err = zipit(zipfile, source, newBaseDir); err != nil {\n        // handle error\n    }\n    ...\n}\n\nfunc zipit(zipFile io.Writer, source, newBaseDir string) error {\n\n    archive := zip.NewWriter(zipfile)\n    defer archive.Close()\n\n    info, err := os.Stat(source)\n    if err != nil {\n        return err\n    }\n\n    var baseDir string\n    if info.IsDir() {\n        baseDir = filepath.Dir(source)\n    }\n\n    if baseDir != \"\" {\n        baseDir += \"/\"\n    }\n\n    filepath.Walk(source, func(path string, info os.FileInfo, err error) error {\n        if err != nil {\n            return err\n        }\n\n        if info.IsDir() {\n            return nil\n        }\n\n        header, err := zip.FileInfoHeader(info)\n        if err != nil {\n            return err\n        }\n\n        if baseDir != \"\" {\n            header.Name = filepath.Join(newBaseDir, strings.TrimPrefix(path, baseDir))\n        }\n\n        header.Method = zip.Deflate\n\n        writer, err := archive.CreateHeader(header)\n        if err != nil {\n            return err\n        }\n\n        file, err := os.Open(path)\n        if err != nil {\n            return err\n        }\n        defer file.Close()\n        _, err = io.Copy(writer, file)\n        return err\n    })\n\n    return err\n}\n</code></pre>\n\n<hr>\n\n<p><strong><em>Original Answer:</em></strong></p>\n\n<p>There are a few things to consider.</p>\n\n<ul>\n<li><p>You need to use <a href=\"https://golang.org/pkg/path/filepath/#Dir\" rel=\"nofollow noreferrer\"><code>filepath.Dir</code></a> instead of <a href=\"https://golang.org/pkg/path/filepath/#Base\" rel=\"nofollow noreferrer\"><code>filepath.Base</code></a>. \nBase gives the last element of the path not the base directory.</p></li>\n<li><p><code>if info.IsDir(); len(params) &gt; 2 {</code> only checks the condition <code>len(params) &gt; 2</code>, <code>info.IsDir()</code> is evaluated but not used anywhere.</p></li>\n</ul>\n\n<p>Refer : If with a short statement format in Go <a href=\"https://www.calhoun.io/one-liner-if-statements-with-errors/\" rel=\"nofollow noreferrer\">[1]</a> <a href=\"https://tour.golang.org/flowcontrol/6\" rel=\"nofollow noreferrer\">[2]</a></p>\n\n<p>It should be</p>\n\n<pre><code>if info.IsDir() {\n    if len(params) &gt; 2 {\n        ...\n    } else {\n        ...\n    }\n}\n</code></pre>\n\n<ul>\n<li>If my understanding of your requirement is right. The old base path needs to be stripped from the file headers and\nreplaced with value of param[2] if available or assuming that we maintain a relative file structure, if it is empty.</li>\n</ul>\n\n<p>Changes :</p>\n\n<pre><code>var baseDir string\nif info.IsDir(); len(params) &gt; 2 {\n    baseDir = params[2]\n} else {\n    baseDir = filepath.Base(params[0])\n}\n</code></pre>\n\n<p>should be</p>\n\n<pre><code>    var baseDir, newBaseDir string\n    if info.IsDir() {\n        baseDir = filepath.Dir(params[0])\n        if len(params) &gt; 2 {\n            newBaseDir = params[2]\n        }\n    }\n</code></pre>\n\n<p>AND</p>\n\n<p><code>header.Name = filepath.Join(strings.TrimPrefix(path, baseDir))</code><br>\nbecomes <br>\n<code>header.Name = filepath.Join(newBaseDir, strings.TrimPrefix(path, baseDir))</code></p>\n"}], "owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 351, "favorite_count": 4, "answer_count": 1, "score": 1, "last_activity_date": 1530881841, "creation_date": 1528303096, "last_edit_date": 1530522791, "question_id": 50725437, "link": "https://stackoverflow.com/questions/50725437/zip-folder-with-source-and-target", "title": "zip folder with source and target", "body": "<p>I use the following code which zip some folder to a given path,the issue that im currently facing is that I need to zip some folder with content into specific target and not in the same directory </p>\n\n<p>For example </p>\n\n<p>Folder in path like\n<strong>source</strong></p>\n\n<p><code>\"/Users/i03434/go/src/zdf/BUILD\"</code></p>\n\n<p><em>target</em></p>\n\n<p><code>\"/Users/i03434/go/src/zdf/app/info.zip\"</code></p>\n\n<p>currently I try to add new path[2] which doesnt helps, any idea how to do it?</p>\n\n<p>This is all the code</p>\n\n<pre><code>func zipit(params ...string) error {\n\n    zipfile, err := os.Create(params[1])\n    if err != nil {\n        return err\n    }\n    defer zipfile.Close()\n\n    archive := zip.NewWriter(zipfile)\n    defer archive.Close()\n\n    info, err := os.Stat(params[0])\n    if err != nil {\n        return err\n    }\n\n    var baseDir string\n    if info.IsDir(); len(params) &gt; 2 {\n        baseDir = params[2]\n    } else {\n        baseDir = filepath.Base(params[0])\n    }\n\n    if baseDir != \"\" {\n        baseDir += \"/\"\n    }\n\n    filepath.Walk(params[0], func(path string, info os.FileInfo, err error) error {\n        if err != nil {\n            return err\n        }\n\n        if info.IsDir() {\n            return nil\n        }\n\n        header, err := zip.FileInfoHeader(info)\n        if err != nil {\n            return err\n        }\n\n        if baseDir != \"\" {\n            header.Name = filepath.Join(strings.TrimPrefix(path, baseDir))\n        }\n\n        header.Method = zip.Deflate\n\n        writer, err := archive.CreateHeader(header)\n        if err != nil {\n            return err\n        }\n\n        file, err := os.Open(path)\n        if err != nil {\n            return err\n        }\n        defer file.Close()\n        _, err = io.Copy(writer, file)\n        return err\n    })\n\n    return err\n}\n</code></pre>\n\n<p>The logic of the zip is working as expected, zip should be according to the jar spec</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1528303554, "post_id": 50725367, "comment_id": 88459305, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/27803654/explanation-of-checking-if-value-implements-interface\">Explanation of checking if value implements interface</a>"}], "answers": [{"comments": [{"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1528304835, "post_id": 50725801, "comment_id": 88460001, "body": "This is the better answer, Savash. I will delete mine."}, {"owner": {"reputation": 1278, "user_id": 108826, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/861ed516fb54db2217b7e90aee1d2d3f?s=128&d=identicon&r=PG&f=1", "display_name": "S2201", "link": "https://stackoverflow.com/users/108826/s2201"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1528305787, "post_id": 50725801, "comment_id": 88460503, "body": "@TehSphinX,  your answer was very close and led me to the same solution that ThnderCat posted. Thanks!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 7, "last_activity_date": 1528306506, "last_edit_date": 1528306506, "creation_date": 1528304463, "answer_id": 50725801, "question_id": 50725367, "link": "https://stackoverflow.com/questions/50725367/how-to-check-if-a-value-implements-an-interface/50725801#50725801", "title": "How to check if a value implements an interface", "body": "<p>The types do not satisfy the <code>Comparator</code> interface.  The types have a <code>Same</code> method, but those methods do not have argument type <code>Comparator</code>.  The argument types must match to satisfy an interface.</p>\n\n<p>Change the the methods and interface to take the same argument type. Use a type assertion to check that receiver and argument have the same type and to get argument as the receiver's type.</p>\n\n<pre><code> type Comparator interface {\n    Same(interface{}) bool\n }\n\nfunc (mt MyType) Same(other interface{}) bool {\n    mtOther, ok := other.(MyType)\n    if !ok {\n        return false\n    }\n    return return mt.MyField == mtOther.MyField\n}\n</code></pre>\n\n<p>Use the following to compare two values:</p>\n\n<pre><code>func same(a, b interface{}) bool {\n  c, ok := a.(Comparator)\n  if !ok {\n     return false\n  }\n  return c.Same(b)\n}\n</code></pre>\n\n<p>If the types the application works with have the <code>Compare</code> method, then there's no need to declare the <code>Comparator</code> interface or use the <code>same</code> function in the previous snippet of code. For example, the <code>Comparator</code> interface is not required for the following:</p>\n\n<pre><code>var mt MyType\nvar other interface{}\n\neq := mt.Same(other)\n</code></pre>\n"}], "owner": {"reputation": 1278, "user_id": 108826, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/861ed516fb54db2217b7e90aee1d2d3f?s=128&d=identicon&r=PG&f=1", "display_name": "S2201", "link": "https://stackoverflow.com/users/108826/s2201"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2550, "favorite_count": 0, "accepted_answer_id": 50725801, "answer_count": 1, "score": 2, "last_activity_date": 1528306506, "creation_date": 1528302845, "last_edit_date": 1528304362, "question_id": 50725367, "link": "https://stackoverflow.com/questions/50725367/how-to-check-if-a-value-implements-an-interface", "title": "How to check if a value implements an interface", "body": "<p>I want to compare my type by the specific way. For this purpose, I create the function <code>MyType.Same(other MyType) bool</code> for each type.</p>\n\n<p>In some generic function, I want to check if the parameter has a function \"Same\" and invoke it if yes.</p>\n\n<p>How can I do it in a generic way for different types?</p>\n\n<pre><code>type MyType struct {\n   MyField string\n   Id string // ignored by comparison\n}\n\nfunc (mt MyType) Same(other MyType) bool {\n    return mt.MyField == other.MyField\n}\n\n// MyOtherType... Same(other MyOtherType)\n\n\ntype Comparator interface {\n    Same(Camparator) bool // or Same(interface{}) bool\n}\n\nmyType = new(MyType)\n_, ok := reflect.ValueOf(myType).Interface().(Comparator) // ok - false\n\nmyOtherType = new(myOtherType)\n_, ok := reflect.ValueOf(myOtherType).Interface().(Comparator) // ok - false\n</code></pre>\n"}, {"tags": ["pointers", "go", "gob"], "answers": [{"comments": [{"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1528303325, "post_id": 50725461, "comment_id": 88459184, "body": "Is erroring out really a better implementation than just ignoring these values? With the current state of things, is the best practice to recursively scan through my struct to see if there are any nil map values, and delete those keys if so? If this check is required, it seems like it should be the responsibility of the encoding/gob package, not the user."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 1, "creation_date": 1528303500, "post_id": 50725461, "comment_id": 88459286, "body": "@rampatowl You shouldn&#39;t be storing <code>nil</code> pointers in the map in the first place. It is rarely useful, and if you want to encode it with <code>gob</code>, it&#39;s forbidden to have such values."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1528306844, "last_edit_date": 1528306844, "creation_date": 1528303174, "answer_id": 50725461, "question_id": 50725102, "link": "https://stackoverflow.com/questions/50725102/gob-cant-encode-map-with-a-nil-pointer-value/50725461#50725461", "title": "Gob can&#39;t encode map with a nil pointer value", "body": "<p>The <code>gob</code> encoded stream has no notion of pointers. If you encode a pointer value such as <code>*int</code>, the pointed value will be sent, that is, a value of type <code>int</code>. This transformation is reversed at the decoder side if needed, e.g. if an <code>int</code> value is found in the stream for which an <code>*int</code> value is to be set, a pointer (of type <code>*int</code>) will be set pointing to the decoded <code>int</code> value.</p>\n\n<p>So if a pointer value itself is <code>nil</code>, there is no value that the <code>gob</code> package could encode instead of the pointer value, a <code>nil</code> pointer points to nothing. Dereferencing a <code>nil</code> pointer is a runtime panic.</p>\n\n<p>This is also documented at <a href=\"https://golang.org/pkg/encoding/gob/#hdr-Basics\" rel=\"nofollow noreferrer\">gob: Basics:</a></p>\n\n<blockquote>\n  <p>Pointers are not transmitted, but the things they point to are transmitted; that is, the values are flattened. <strong>Nil pointers are not permitted, as they have no value.</strong></p>\n</blockquote>\n"}], "owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 788, "favorite_count": 0, "accepted_answer_id": 50725461, "answer_count": 1, "score": 2, "last_activity_date": 1528306844, "creation_date": 1528301889, "last_edit_date": 1528303208, "question_id": 50725102, "link": "https://stackoverflow.com/questions/50725102/gob-cant-encode-map-with-a-nil-pointer-value", "title": "Gob can&#39;t encode map with a nil pointer value", "body": "<p>Gob's Encode returns an error when I try to encode a map to pointers if one of the values is nil. This seems to contradict the docs (but I may be misinterpreting the meaning):</p>\n\n<blockquote>\n  <p>In slices and arrays, as well as maps, all elements, even zero-valued elements, are transmitted, even if all the elements are zero.</p>\n</blockquote>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/gob\"\n)\n\ntype Dog struct {\n    Name string\n}\n\nfunc main() {\n    m0 := make(map[string]*Dog)\n    m0[\"apple\"] = nil\n\n    // Encode m0 to bytes\n    var network bytes.Buffer\n    enc := gob.NewEncoder(&amp;network)\n    err := enc.Encode(m0)\n    if err != nil {\n        panic(err) // Output: panic: gob: encodeReflectValue: nil element\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>panic: gob: encodeReflectValue: nil element\n</code></pre>\n\n<p>Is there a good reason for gob to fail in this case? It seems that either of the two obvious options are preferable to failure: 1) don't encode any keys with values that are zero-valued or 2) encode all keys even if the values are zero-valued. With the current state of things, is the best practice to recursively scan through my struct to see if there are any nil map values, and delete those keys if so? If this check is required, it seems like it should be the responsibility of the encoding/gob package, not the user.</p>\n\n<p>Further, the rule isn't simply \"gob can't encode maps where a key has a value of nil\" because if the value type is a slice, then nil is accepted:</p>\n\n<pre><code>func main() {\n    m0 := make(map[string][]string)\n    m0[\"apple\"] = nil\n\n    // Encode m0 to bytes\n    var network bytes.Buffer\n    enc := gob.NewEncoder(&amp;network)\n    err := enc.Encode(m0) // err is nil\n    if err != nil {\n        panic(err) // doesn't panic\n    }\n}\n</code></pre>\n"}, {"tags": ["arrays", "go", "memory"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1528300612, "post_id": 50724527, "comment_id": 88457760, "body": "Try doing the <code>Unmarshal</code> to <code>s</code> instead of <code>&amp;s</code>."}], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 1994455, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb5316a571294c975321ab9c72e5d221?s=128&d=identicon&r=PG&f=1", "display_name": "nergal", "link": "https://stackoverflow.com/users/1994455/nergal"}, "edited": false, "score": 0, "creation_date": 1528301045, "post_id": 50724785, "comment_id": 88458023, "body": "Oh, I was so close! I tried that one time but then I missed to add by reference. Works fine! Thanks!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1528302615, "last_edit_date": 1528302615, "creation_date": 1528300766, "answer_id": 50724785, "question_id": 50724527, "link": "https://stackoverflow.com/questions/50724527/golang-array-in-struct-issue/50724785#50724785", "title": "Golang array in struct issue", "body": "<p>The application is unmarshaling to the variable <code>s</code> defined in the loop. Unmarshal to the slice element instead:</p>\n\n<pre><code>    for i, s := range spaces.Items { \n        if s.Id == space_id {\n            err := json.Unmarshal(f, &amp;spaces.Items[i]) // &lt;-- pass pointer to element\n            if err != nil {\n               // handle error\n            }\n            break\n        }\n    }\n</code></pre>\n"}], "owner": {"reputation": 143, "user_id": 1994455, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb5316a571294c975321ab9c72e5d221?s=128&d=identicon&r=PG&f=1", "display_name": "nergal", "link": "https://stackoverflow.com/users/1994455/nergal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 50724785, "answer_count": 1, "score": 3, "last_activity_date": 1528302615, "creation_date": 1528300001, "question_id": 50724527, "link": "https://stackoverflow.com/questions/50724527/golang-array-in-struct-issue", "title": "Golang array in struct issue", "body": "<p>I have problems using a array of structs inside another struct. The issue is that when I fill the structure with data from JSON data in the function below, it is filled correctly. When I directly try to access the data outside of the loop within a new loop the data is not there. So I guess that I'm filling the copied data structure instead of the reference to it so it's only valid inside the first loop. Though I have tried to allocate memory for it and still the same issue. </p>\n\n<p>I guess that I failed somewhere and need directions. See some comments below in the code snippet.</p>\n\n<pre><code>type Spaces struct {\n    Items []*Space `json:\"items\"`\n}\n\ntype Space struct {\n    Id string `json:\"id\"`\n    Messages []Message `json:\"items\"`\n}\n\ntype Messages struct {\n    Items []Message  `json:\"items\"`\n}\n\n// spaces are marshalled first so that there is a array of spaces\n// with Id set. Then the function below is called.\nfunc FillSpaces(space_id string) {\n    for _,s := range spaces.Items {\n        if s.Id == space_id {\n            // I tried to allocate with: s.Messages = &amp;Messages{} without any change.\n            json.Unmarshal(f, &amp;s) // f is JSON data\n            fmt.Printf(\" %s := %v\\n\", s.Id, len(s.Messages))) // SomeId := X messages (everything seems fine!)\n            break\n        }\n    }\n    // Why is the messages array empty here when it was not empty above?\n    for _,s := range spaces.Items {\n        if s.Id == space_id {\n            fmt.Printf(\"%v\", len(s.Messages))) // Length is 0!?\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "reflection", "slice", "gob"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1528299716, "post_id": 50724254, "comment_id": 88457198, "body": "Guessing it&#39;s something to do with a <code>nil</code> slice and an empty slice being treated the same in most places, but possibly not within <code>DeepEqual</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1528300607, "post_id": 50724438, "comment_id": 88457757, "body": "Thanks for the explanation! So the main problem is that gob treats nil slices and empty slices the same, but DeepEqual does not. Do you think there is a good reason for this, or should one of the packages be changed? Wondering if I should submit a git issue"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1528300677, "post_id": 50724438, "comment_id": 88457797, "body": "@rampatowl <code>gob</code> does not treat <code>nil</code> and empty slices the same, but it does not allocate a slice if the &quot;existing&quot; one is enough to hold the encoded elements. If this is an issue for you, use <code>nil</code> slices in place of empty ones before encoding. I don&#39;t think these are flawed. <code>gob</code> does so to minimize allocations (and therefore improve performance)."}, {"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1528301943, "post_id": 50724438, "comment_id": 88458471, "body": "Gotcha, thanks. I&#39;m surprised that the encoding works when a map value is <code>nil</code>, because in the case where the value type is a pointer, this gives me a <code>gob: encodeReflectValue: nil element</code> error. In case you have any insights about this contradiction, I posted a separate question here: <a href=\"https://stackoverflow.com/questions/50725102/gob-cant-encode-map-with-a-nil-pointer-value\" title=\"gob cant encode map with a nil pointer value\">stackoverflow.com/questions/50725102/&hellip;</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1528305332, "last_edit_date": 1528305332, "creation_date": 1528299723, "answer_id": 50724438, "question_id": 50724254, "link": "https://stackoverflow.com/questions/50724254/deepequal-incorrect-after-serializing-map-into-gob/50724438#50724438", "title": "DeepEqual incorrect after serializing map into gob", "body": "<p>This is because you encode an empty slice, and during decoding the <a href=\"https://golang.org/pkg/encoding/gob/\" rel=\"nofollow noreferrer\"><code>encoding/gob</code></a> package only allocates a slice if the one provided (the target to decode into) is not big enough to accomodate the encoded values. This is documented at: <a href=\"https://golang.org/pkg/encoding/gob/#hdr-Types_and_Values\" rel=\"nofollow noreferrer\">gob: Types and Values:</a></p>\n\n<blockquote>\n  <p>In general, if allocation is required, the decoder will allocate memory. If not, it will update the destination variables with values read from the stream.</p>\n</blockquote>\n\n<p>Since there are 0 elements encoded, and a <code>nil</code> slice is perfectly capable of accomodating 0 elements, no slice will be allocated. We can verify this if we print the result of comparing the slices to <code>nil</code>:</p>\n\n<pre><code>fmt.Println(m0[\"apple\"] == nil, m2[\"apple\"] == nil)\n</code></pre>\n\n<p>Output of the above is (try it on the <a href=\"https://play.golang.org/p/jUf2gN_l5rU\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>true false\n</code></pre>\n\n<p>Note that the <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\"><code>fmt</code></a> package prints <code>nil</code> slice values and empty slices the same way: as <code>[]</code>, you cannot rely on its output to judge if a slices is <code>nil</code> or not.</p>\n\n<p>And <a href=\"https://golang.org/pkg/reflect/#DeepEqual\" rel=\"nofollow noreferrer\"><code>reflect.DeepEqual()</code></a> treats a <code>nil</code> slice and an empty but non-<code>nil</code> slice different (non-deep equal):</p>\n\n<blockquote>\n  <p>Note that a non-nil empty slice and a nil slice (for example, []byte{} and []byte(nil)) are not deeply equal.</p>\n</blockquote>\n"}], "owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 0, "accepted_answer_id": 50724438, "answer_count": 1, "score": 2, "last_activity_date": 1528305332, "creation_date": 1528299141, "last_edit_date": 1528300380, "question_id": 50724254, "link": "https://stackoverflow.com/questions/50724254/deepequal-incorrect-after-serializing-map-into-gob", "title": "DeepEqual incorrect after serializing map into gob", "body": "<p>I've encountered some strange behavior with reflect.DeepEqual. I have an object of type <code>map[string][]string</code>, with one key whose value is an empty slice. When I use gob to encode this object, and then decode it into another map, these two maps are not equal according to reflect.DeepEqual (even though the content is identical).</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"bytes\"\n    \"encoding/gob\"\n    \"reflect\"\n)\n\nfunc main() {\n    m0 := make(map[string][]string)\n    m0[\"apple\"] = []string{}\n\n    // Encode m0 to bytes\n    var network bytes.Buffer\n    enc := gob.NewEncoder(&amp;network)\n    enc.Encode(m0)\n\n    // Decode bytes into a new map m2\n    dec := gob.NewDecoder(&amp;network)\n    m2 := make(map[string][]string)\n    dec.Decode(&amp;m2)\n\n    fmt.Printf(\"%t\\n\", reflect.DeepEqual(m0, m2)) // false\n    fmt.Printf(\"m0: %+v != m2: %+v\\n\", m0, m2) // they look equal to me!\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>false\nm0: map[apple:[]] != m2: map[apple:[]]\n</code></pre>\n\n<p>A couple notes from follow-up experiments:</p>\n\n<p>If I make the value of <code>m0[\"apple\"]</code> a nonempty slice, for example <code>m0[\"apple\"] = []string{\"pear\"}</code>, then DeepEqual returns true.</p>\n\n<p>If I keep the value as an empty slice but I construct the identical map from scratch rather than with gob, then DeepEqual returns true:</p>\n\n<pre><code>m1 := make(map[string][]string)\nm1[\"apple\"] = []string{}\nfmt.Printf(\"%t\\n\", reflect.DeepEqual(m0, m1)) // true!\n</code></pre>\n\n<p>So it's not strictly an issue with how DeepEqual handles empty slices; it's some strange interaction between that and gob's serialization.</p>\n"}, {"tags": ["go", "compilation", "cgo"], "comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1528301439, "post_id": 50724187, "comment_id": 88458223, "body": "I don&#39;t think that header files get compiled at all by themselves. Header files gets included in some <code>.c</code> or <code>.cpp</code> or similar files and are only compiled within this context. Thus it is relevant that this context is right. See also <a href=\"https://stackoverflow.com/questions/1713214/how-to-use-c-in-go\">How to use C++ in Go?</a>."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1528303360, "post_id": 50724187, "comment_id": 88459205, "body": "<a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\"><code>cgo</code> supports compilation of C++ code directly</a>\u2014subject to a <code>cc</code>-compatible C++ compiler being available, of course\u2014directly, so nothing special is required; just name your source files properly."}], "owner": {"reputation": 562, "user_id": 317751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/950d9217c63ac4c1934f30bc3c2f3e07?s=128&d=identicon&r=PG", "display_name": "Andreas Raster", "link": "https://stackoverflow.com/users/317751/andreas-raster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1528298948, "creation_date": 1528298948, "question_id": 50724187, "link": "https://stackoverflow.com/questions/50724187/how-to-handle-wrongly-named-includes-in-cgo", "title": "How to handle wrongly named includes in cgo?", "body": "<p>I ran into a third party library that is written in a mixture of C/C++ where most of its headers have a .h filename suffix where a .hpp suffix would be more appropriate.</p>\n\n<p>Using this third party library from cgo should be possible since it makes almost no use of the higher level C++ abstractions, but the header files need to be compiled by a C++ compiler, otherwise the compilation process fails.</p>\n\n<p>I can make cgo work by forcing it to use a C++ compiler for C code like this:</p>\n\n<pre><code>env CC=g++ go build\n</code></pre>\n\n<p>but as soon as I actually start using the library from go code this approach does not work because cgo generates C code which can not be compiled when CC is set as g++. If I only generate the the _cgo_export.c and _cgo_export.h files with:</p>\n\n<pre><code>env CC=g++ go tool cgo\n</code></pre>\n\n<p>and then manually compile them with gcc, the compilation works fine.</p>\n\n<p>So my question here is about what options I have to tell cgo about which files to compile as C++ files, and which files to compile as C files?</p>\n\n<p>Is there a way to specifically inform cgo about the wrongly named C++ headers and that it should compile only those files with a C++ instead of a C compiler?</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1528297061, "post_id": 50723465, "comment_id": 88455360, "body": "you can use struct directly without interface and create a slice of struct in your fetch function to unmarshal the data"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528298808, "post_id": 50723465, "comment_id": 88456581, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/34440646/how-to-create-a-generic-function-to-unmarshal-all-types\" title=\"how to create a generic function to unmarshal all types\">stackoverflow.com/questions/34440646/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1528298425, "creation_date": 1528298425, "answer_id": 50724021, "question_id": 50723465, "link": "https://stackoverflow.com/questions/50723465/create-instance-of-slice-using-reflection-at-run-time/50724021#50724021", "title": "Create instance of slice using reflection at run time", "body": "<p>Declare <code>fetch</code> to take an interface{} argument:</p>\n\n<pre><code>func fetch(url string, itemList interface{}) (error) {\n    var myClient = &amp;http.Client{}\n    r, err := myClient.Get(url)\n    body, err := ioutil.ReadAll(r.Body)\n    defer r.Body.Close()\n    err = json.Unmarshal(body, itemList)\n    .....\n}\n</code></pre>\n\n<p>Call it with a pointer to a slice of the appropriate type:</p>\n\n<pre><code>var details []carDetail\nerr := fetch(u, &amp;details)\n</code></pre>\n\n<p>With this approach, the json.Umarshal function does all the heavy lifting.</p>\n"}], "owner": {"reputation": 4133, "user_id": 2135526, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/75e764233b7968d0f9fb8e04f31230cf?s=128&d=identicon&r=PG", "display_name": "Naresh", "link": "https://stackoverflow.com/users/2135526/naresh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "accepted_answer_id": 50724021, "answer_count": 1, "score": 0, "last_activity_date": 1528484046, "creation_date": 1528296934, "last_edit_date": 1528484046, "question_id": 50723465, "link": "https://stackoverflow.com/questions/50723465/create-instance-of-slice-using-reflection-at-run-time", "title": "Create instance of slice using reflection at run time", "body": "<p>I was trying to pass the slice of structs i.e. <code>[]carDetail</code> or <code>[]bikeDetail</code> which implement the <code>IMapping</code> interface in the   <code>func fetch(url string, itemList []IMapping) (error)</code>. But then came across this <a href=\"https://stackoverflow.com/questions/12994679/golang-slice-of-struct-slice-of-interface-it-implements\">link</a>. GoLang doesn't support it. So, changed the signature to be <code>func fetch(url string, itemList IMapping) (error)</code>. Now, I am trying to pass the <code>carDetail</code> or <code>bikeDetail</code> struct in the function and in the <code>fetch</code> function trying to create the slice of struct using reflection. So, how can I do that? Which further can be passed in the <code>json.Unmarshal</code> method to map the json to struct.</p>\n\n<pre><code>type IMapping interface {\n        GetId() int\n    }\n\n    type carDetail struct {\n        ModelId    int    `json:\"modelId\"`\n        CarName  string `json:\"carName\"`\n    }\n    func (m *carDetail) GetId() int {\n        return m.ModelID\n    }\n\n    type bikeDetail struct {\n        ModelId    int    `json:\"modelId\"`\n        BikeName  string `json:\"bikeName\"`\n    }\n\n    func (m *bikeDetail) GetId() int {\n        return m.ModelID\n    }\n\n    func fetch(url string, itemList IMapping) (error) {\n\n        var myClient = &amp;http.Client{}\n        r, err := myClient.Get(url)\n        body, err := ioutil.ReadAll(r.Body)\n        defer r.Body.Close()\n\n        // how to create slice at run time using reflection say objVehicle\n\n        err = json.Unmarshal(body, &amp;objVehicle)\n\n        .....\n    }\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1528296486, "creation_date": 1528296486, "answer_id": 50723335, "question_id": 50723053, "link": "https://stackoverflow.com/questions/50723053/interaction-between-multiple-programs-in-golang/50723335#50723335", "title": "Interaction Between Multiple Programs In Golang", "body": "<p>Your subprocess is using <code>ReadString('\\n')</code>, but you aren't writing a <code>\\n</code> character, nor are you flushing the buffered writer.</p>\n\n<p>This will write the expected data to the pipe:</p>\n\n<pre><code>inwriter.WriteString(\"Pong\\n\")\ninwriter.Flush()\n</code></pre>\n"}], "owner": {"reputation": 499, "user_id": 9903859, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8956511dc438a5e2302451a556171723?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas", "link": "https://stackoverflow.com/users/9903859/nicholas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 0, "accepted_answer_id": 50723335, "answer_count": 1, "score": 0, "last_activity_date": 1528296486, "creation_date": 1528295671, "question_id": 50723053, "link": "https://stackoverflow.com/questions/50723053/interaction-between-multiple-programs-in-golang", "title": "Interaction Between Multiple Programs In Golang", "body": "<p>I'm trying to have two golang programs communicating using pipes, each running concurrently e.g:</p>\n\n<pre><code>1 go run master/main/main.go \n\n2 master/main/main.go calls slave.exe (built go program)\n\n3 slave.exe prints out \"Ping\"\n\n4 master/main/main.go reads \"Ping\" and writes \"Pong\"\n\n5 slave.exe reads \"Pong\" and prints out \"Message recieved: Pong\"\n</code></pre>\n\n<p>The program reaches step 4 but it does not receive another message from slave.exe. </p>\n\n<p>In master/main/main.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/exec\"\n    \"bufio\"\n)\n\nfunc main() {\n    // Run compiled slave project:\n    c := exec.Command(\"main\", insert_path_to_exe_here)\n\n    out, _ := c.StdoutPipe()\n    in, _ := c.StdinPipe()\n\n    c.Start() // Using Start() instead of Run() because Run() waits for program to finish before moving on.\n\n    inwriter := bufio.NewWriter(in)\n    outreader := bufio.NewReader(out)\n\n    // This should print \"Ping\".\n    fmt.Println(outreader.ReadString('\\n'))\n\n    inwriter.WriteString(\"Pong\")\n\n    // This should print \"Message received: Pong\"\n    fmt.Println(outreader.ReadString('\\n'))\n\n}\n</code></pre>\n\n<p>In slave/main/main.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"bufio\"\n    \"os\"\n)\n\nfunc main() {\n    fmt.Println(\"Ping\")\n    reader := bufio.NewReader(os.Stdin)\n\n    s, _ := reader.ReadString('\\n')\n\n    fmt.Println(\"Message received: \", s)\n}\n</code></pre>\n\n<p>To run:</p>\n\n<ul>\n<li>Build slave/main/main.go</li>\n<li>Replace insert_path_to_exe_here with the path to the built executable and replace \"main\" with the name of the executable.</li>\n<li>Run master/main/main.go</li>\n</ul>\n"}, {"tags": ["go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 2, "last_activity_date": 1528294257, "creation_date": 1528294257, "answer_id": 50722573, "question_id": 50722481, "link": "https://stackoverflow.com/questions/50722481/what-is-the-meaning-of-constructornil/50722573#50722573", "title": "What is the meaning of ([]Constructor)(nil)", "body": "<p>It copies the <code>constructors</code> argument into a new slice, assigned it to a field in the <code>Chain</code> literal, and returns the new struct.</p>\n\n<p>It is equivalent to</p>\n\n<pre><code>func New(constructors ...Constructor) Chain {\n    var tmp []Constructor\n    tmp = append(tmp, constructors...)\n    return Chain{tmp}\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 21, "user_id": 6460847, "user_type": "registered", "profile_image": "https://graph.facebook.com/1540487831/picture?type=large", "display_name": "Floxiandl", "link": "https://stackoverflow.com/users/6460847/floxiandl"}, "edited": false, "score": 0, "creation_date": 1528386855, "post_id": 50722681, "comment_id": 88498715, "body": "Oh yes, it&#39;s a simple cast! Somehow I didn&#39;t recognize it as such, i thought it was some strange expression i was not aware of. Thank you very much!"}], "tags": [], "owner": {"reputation": 4481, "user_id": 1264974, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6558cf06df3ccf1c49329f38fd843b7d?s=128&d=identicon&r=PG", "display_name": "justinas", "link": "https://stackoverflow.com/users/1264974/justinas"}, "is_accepted": false, "score": 2, "last_activity_date": 1528297223, "last_edit_date": 1528297223, "creation_date": 1528294545, "answer_id": 50722681, "question_id": 50722481, "link": "https://stackoverflow.com/questions/50722481/what-is-the-meaning-of-constructornil/50722681#50722681", "title": "What is the meaning of ([]Constructor)(nil)", "body": "<p>The author of alice here, just randomly clicked on this question. :)</p>\n\n<p>The other answers explain what the <code>append(nil, ...)</code> does - I use it throughout the library to copy the slices that the user passes in.</p>\n\n<p>Now, Go does not allow to simply use <code>append(nil, someElement)</code> because the type of <code>nil</code> is unknown. <code>([]Constructor)(nil)</code> is casting <code>nil</code> to the type <code>[]Constructor</code> in order to avoid this. This is a type conversion, same as, say, <code>int64(123)</code> or <code>(*int)(nil)</code>.</p>\n\n<p>This is a minimal example where the compiler errors out because of an untyped nil:</p>\n\n<pre><code>a := ([]int)(nil)\na = append(a, 1, 2, 3) // works fine, a is of type []int\nvar b []int\nb = append(b, 1, 2, 3) // works fine, b is of type []int\nc := nil\nc = append(c, 1, 2, 3) // compiler error: the type of c is unknown\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 6460847, "user_type": "registered", "profile_image": "https://graph.facebook.com/1540487831/picture?type=large", "display_name": "Floxiandl", "link": "https://stackoverflow.com/users/6460847/floxiandl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1528308749, "creation_date": 1528294019, "last_edit_date": 1528308749, "question_id": 50722481, "link": "https://stackoverflow.com/questions/50722481/what-is-the-meaning-of-constructornil", "title": "What is the meaning of ([]Constructor)(nil)", "body": "<p>I was reading the source code of the Middleware's chaining software Alice and found the expression:</p>\n\n<pre><code>func New(constructors ...Constructor) Chain {\n    return Chain{append(([]Constructor)(nil), constructors...)}\n}\n</code></pre>\n\n<p>I have no problem with the code at all, except that i have never seen the expression <code>([]Slice)(nil)</code> before. Does anybody have any information about this sort of expression?</p>\n"}, {"tags": ["arrays", "go", "time"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1528294445, "post_id": 50722413, "comment_id": 88453569, "body": "You&#39;re creating a slice of just the <code>time.Time</code> values, and then sorting them; you&#39;re getting exactly the behavior you&#39;ve implemented. If you want to sort a slice of the entire data structure and not just the time values, then you should be sorting a slice of that structure."}, {"owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "edited": false, "score": 1, "creation_date": 1528294527, "post_id": 50722413, "comment_id": 88453628, "body": "implement the sort interface (Less, Swap, Len) on a slice of your struct <code>[]TimeStruct</code>  instead of on the custom time type."}, {"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "reply_to_user": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "edited": false, "score": 1, "creation_date": 1528295125, "post_id": 50722413, "comment_id": 88454052, "body": "@Slabgorb Since go 1.8 it is easier to implement sort.Slice: <a href=\"https://godoc.org/sort#Slice\" rel=\"nofollow noreferrer\">godoc.org/sort#Slice</a>"}, {"owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "reply_to_user": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1528310323, "post_id": 50722413, "comment_id": 88462877, "body": "@mbuechmann cool stuff, can get rid of some boilerplate in my code, thanks"}], "owner": {"reputation": 11, "user_id": 9903682, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-0PP5qhyHuh0/AAAAAAAAAAI/AAAAAAAAAAs/6gSi93sZbp4/photo.jpg?sz=128", "display_name": "Saint Crypto", "link": "https://stackoverflow.com/users/9903682/saint-crypto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 42, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1528293816, "creation_date": 1528293816, "question_id": 50722413, "link": "https://stackoverflow.com/questions/50722413/time-sorting-while-remembering-data", "title": "Time sorting while remembering data", "body": "<p>I'm having a problem with sorting different arrays according to time in Go. I've read tutorial about how to sort it in relation to timeslices, but in the examples I've found it only takes into account the time itself, meaning any other data I sent with it will not be able to sort. </p>\n\n<p>I'm my example I have a struct with an a date (time.Time) and an id (int) and I want to be able to sort all structs related to their dates in a shared list while still being able to access their ID.</p>\n\n<p>I have three classes.\nAccount: Adds Timestructs that keeps track of the instance date and id and adds it do the global list.\nController: Owns the global list and also takes care of calling the sorting functionality.\nTimeSlice: The default timeslice class with len,less and swap.</p>\n\n<p>So to clarify, how do I sort the time in a way that I still can access other information about such as the ID of the Account? </p>\n\n<pre><code>//Account.go\nfunc (i *InstanceController) InitAccount() *Account {\n        account := new(Account)\n        i.IncrementIDs(account) //Sets account id\n        t := TimeStruct{date: account.Created, id: account.ID}\n        i.AccountStamps[account.ID] = t\n}\n\n//Controller.go\ntype InstanceController struct {\n    AccountList map[int]*Account\n    ID          int\n    AccountStamps map[int]TimeStruct\n}\n\nfunc InitInstanceController() *InstanceController {\n    ic := new(InstanceController)\n    ic.ID = 0\n    ic.AccountList = make(map[int]*Account)\n\n    ic.AccountStamps = make(map[int]*TimeStruct)\n    return ic\n}\n\n//TimeSlice.go\npackage account\n\nimport \"fmt\"\nimport \"time\"\nimport \"sort\"\n\ntype timeSlice []time.Time\n\nfunc (s timeSlice) Less(i, j int) bool { return s[i].Before(s[j]) }\nfunc (s timeSlice) Swap(i, j int)      { s[i], s[j] = s[j], s[i] }\nfunc (s timeSlice) Len() int           { return len(s) }\n\nvar past = time.Date(2010, time.May, 18, 23, 0, 0, 0, time.Now().Location())\nvar present = time.Now()\nvar future = time.Now().Add(24 * time.Hour)\n\nvar dateSlice timeSlice = []time.Time{present, future, past}\n\nfunc funcers() {\n\n    fmt.Println(\"Past : \", past)\n    fmt.Println(\"Present : \", present)\n    fmt.Println(\"Future : \", future)\n\n    fmt.Println(\"Before sorting : \", dateSlice)\n\n    sort.Sort(dateSlice)\n\n    fmt.Println(\"After sorting : \", dateSlice)\n\n    sort.Sort(sort.Reverse(dateSlice))\n\n    fmt.Println(\"After REVERSE sorting : \", dateSlice)\n\n}\n\nfunc SortTimeSlice(t timeSlice) {\n    fmt.Println(\"Before sorting : \", t)\n    sort.Sort(t)\n    fmt.Println(\"After sorting : \", t)\n}\n\ntype TimeStruct struct {\n    date time.Time\n    id   int\n}\n\nfunc (ic *InstanceController) AddTimeStruct(t TimeStruct) {\n        ic.AccountStamps[t.id] = t\n}\n\nfunc (ic *InstanceController) AppendToListForSort(ts []TimeStruct) {\n    newList := []time.Time{}\n    for k, v := range ts {\n        newList = append(v.date)\n    }\n    sort.Sort(newList)\n}\n</code></pre>\n"}, {"tags": ["go", "dependencies", "version"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1528294301, "post_id": 50722260, "comment_id": 88453480, "body": "It uses the git tags, not GitHub releases."}, {"owner": {"reputation": 487, "user_id": 1046689, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8b1ae6144171fe41123612c3b1a7f839?s=128&d=identicon&r=PG", "display_name": "kitified", "link": "https://stackoverflow.com/users/1046689/kitified"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1528295838, "post_id": 50722260, "comment_id": 88454556, "body": "@Adrian GitHub releases <a href=\"https://stackoverflow.com/questions/18506508/whats-the-difference-between-tag-and-release\"><i>are</i> git tags</a>. Not all tags are releases, but all releases have a corresponding tag."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1528297805, "post_id": 50722260, "comment_id": 88455881, "body": "Yes. It still uses git tags though, not GitHub releases."}], "tags": [], "owner": {"reputation": 98839, "user_id": 3848, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/W10YY.jpg?s=128&g=1", "display_name": "Motti", "link": "https://stackoverflow.com/users/3848/motti"}, "is_accepted": false, "score": -1, "last_activity_date": 1528293326, "creation_date": 1528293326, "answer_id": 50722260, "question_id": 50722197, "link": "https://stackoverflow.com/questions/50722197/how-do-i-find-the-version-of-a-go-package/50722260#50722260", "title": "How do I find the version of a go package", "body": "<p>I'm an idiot, missed the <code>releases</code> link...</p>\n\n<p><a href=\"https://i.stack.imgur.com/aYCiT.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/aYCiT.png\" alt=\"screenshot\"></a></p>\n"}], "owner": {"reputation": 98839, "user_id": 3848, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/W10YY.jpg?s=128&g=1", "display_name": "Motti", "link": "https://stackoverflow.com/users/3848/motti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1528293326, "creation_date": 1528293142, "question_id": 50722197, "link": "https://stackoverflow.com/questions/50722197/how-do-i-find-the-version-of-a-go-package", "title": "How do I find the version of a go package", "body": "<p>I'm using <a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">dep</a> and I want to add new dependencies in the <code>Gopkg.toml</code> file but I don't how to find the correct version. </p>\n\n<p>I see that someone already added a dependency to <a href=\"http://github.com/fatih/color\" rel=\"nofollow noreferrer\"><code>fatih/color</code></a> from github and specified version <code>1.5.0</code>. How was this value found? </p>\n\n<p>For example I'm adding a dependency on <a href=\"https://github.com/pkg/errors\" rel=\"nofollow noreferrer\"><code>pkg/errors</code></a>, what is it's current version?</p>\n"}, {"tags": ["go", "prometheus"], "answers": [{"comments": [{"owner": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "edited": false, "score": 0, "creation_date": 1528290107, "post_id": 50721065, "comment_id": 88450534, "body": "Figured it out literally the moment you posted. I will adjust this."}], "tags": [], "owner": {"reputation": 24634, "user_id": 83591, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CuiTl.jpg?s=128&g=1", "display_name": "brian-brazil", "link": "https://stackoverflow.com/users/83591/brian-brazil"}, "is_accepted": true, "score": 2, "last_activity_date": 1528289978, "creation_date": 1528289978, "answer_id": 50721065, "question_id": 50720747, "link": "https://stackoverflow.com/questions/50720747/prometheus-histogram-vector-all-buckets-fill-equally/50721065#50721065", "title": "Prometheus Histogram Vector: All buckets fill equally?", "body": "<p>Prometheus histogram buckets are cumulative, so in this case all the requests took less than or equal to 125ms.</p>\n\n<p>In this case your choice of buckets may not be the best, you might want to make some of the buckets smaller.</p>\n"}, {"tags": [], "owner": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "is_accepted": false, "score": 2, "last_activity_date": 1528289985, "creation_date": 1528289985, "answer_id": 50721070, "question_id": 50720747, "link": "https://stackoverflow.com/questions/50720747/prometheus-histogram-vector-all-buckets-fill-equally/50721070#50721070", "title": "Prometheus Histogram Vector: All buckets fill equally?", "body": "<p>This is not an error. Notice the rule for filling the bucket is <code>le=...</code>, meaning <em>less or equal</em>. Since all 6 requests succeeded quickly, all buckets were filled.</p>\n"}], "owner": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 895, "favorite_count": 0, "accepted_answer_id": 50721065, "answer_count": 2, "score": 0, "last_activity_date": 1528289985, "creation_date": 1528289103, "question_id": 50720747, "link": "https://stackoverflow.com/questions/50720747/prometheus-histogram-vector-all-buckets-fill-equally", "title": "Prometheus Histogram Vector: All buckets fill equally?", "body": "<p>I intend to use a Prometheus Histogram vector to monitor the execution time of request handlers in Go.</p>\n\n<p>I register it so:</p>\n\n<pre><code>var RequestTimeHistogramVec = prometheus.NewHistogramVec(\n    prometheus.HistogramOpts{\n        Name:    \"request_duration_seconds\",\n        Help:    \"Request duration distribution\",\n        Buckets: []float64{0.125, 0.25, 0.5, 1, 1.5, 2, 3, 4, 5, 7.5, 10, 20},\n    },\n    []string{\"endpoint\"},\n)\n\nfunc init() {\n    prometheus.MustRegister(RequestTimeHistogramVec)\n}\n</code></pre>\n\n<p>I use it so:</p>\n\n<pre><code>startTime := time.Now()\n// handle request here\nmetrics.RequestTimeHistogramVec.WithLabelValues(\"get:\" + endpointName).Observe(time.Since(startTime).Seconds())\n</code></pre>\n\n<p>When I do a HTTP GET to the <code>/metrics</code> endpoint after using my endpoint a couple of times, I get - amongst other things - the following:</p>\n\n<pre><code># HELP request_duration_seconds Request duration distribution\n# TYPE request_duration_seconds histogram\nrequest_duration_seconds_bucket{endpoint=\"get:/position\",le=\"0.125\"} 6\nrequest_duration_seconds_bucket{endpoint=\"get:/position\",le=\"0.25\"} 6\nrequest_duration_seconds_bucket{endpoint=\"get:/position\",le=\"0.5\"} 6\nrequest_duration_seconds_bucket{endpoint=\"get:/position\",le=\"1\"} 6\nrequest_duration_seconds_bucket{endpoint=\"get:/position\",le=\"1.5\"} 6\nrequest_duration_seconds_bucket{endpoint=\"get:/position\",le=\"2\"} 6\nrequest_duration_seconds_bucket{endpoint=\"get:/position\",le=\"3\"} 6\nrequest_duration_seconds_bucket{endpoint=\"get:/position\",le=\"4\"} 6\nrequest_duration_seconds_bucket{endpoint=\"get:/position\",le=\"5\"} 6\nrequest_duration_seconds_bucket{endpoint=\"get:/position\",le=\"7.5\"} 6\nrequest_duration_seconds_bucket{endpoint=\"get:/position\",le=\"10\"} 6\nrequest_duration_seconds_bucket{endpoint=\"get:/position\",le=\"20\"} 6\nrequest_duration_seconds_bucket{endpoint=\"get:/position\",le=\"+Inf\"} 6\nrequest_duration_seconds_sum{endpoint=\"get:/position\"} 0.022002387\nrequest_duration_seconds_count{endpoint=\"get:/position\"} 6\n</code></pre>\n\n<p>From the looks of it, all buckets are filled by the same amount, equal to the total amount of times I used my endpoint (6 times).</p>\n\n<p>Why does this happen and how may I fix it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1528288998, "post_id": 50720339, "comment_id": 88449849, "body": "It&#39;s not the same - <code>thing</code> is type <code>[2]byte</code>, not type <code>[]byte</code>. That is, it&#39;s an <i>array</i>, not a <i>slice</i>. The semantics are not the same."}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 1, "creation_date": 1528296879, "post_id": 50720339, "comment_id": 88455257, "body": "@manugup1 allow me to point something over the code-design that may not right: if you know that you have <code>[2]byte</code> as elements of the slice, why, in your first example, are returing <code>[]byte</code>? If you return a <code>[2]byte</code> (an array) the algorithm works as expected. See for youself what i&#39;m trying to say: <a href=\"https://play.golang.org/p/wOGaJ9Pwtck\" rel=\"nofollow noreferrer\">play.golang.org/p/wOGaJ9Pwtck</a>. Nevertheless this is a great example for understaning the slice internals...."}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 1, "creation_date": 1528297540, "post_id": 50720339, "comment_id": 88455683, "body": "BTW: this example goes straith to the matter: <a href=\"https://play.golang.org/p/GelDPKlNFO-\" rel=\"nofollow noreferrer\">play.golang.org/p/GelDPKlNFO-</a>"}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1528385250, "post_id": 50720339, "comment_id": 88497710, "body": "@manugulp1 yesterday i saw here a comment that give me thanks for providing more insight about the actual problem. You shouldn&#39;t erase comments like that, actually they help, by giving me positive feedback and encouraging me to keep contribuiting. Don&#39;t forget this place is, after all, a CoP (Community of Practices)."}, {"owner": {"reputation": 2101, "user_id": 191799, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/040b77e27e69c24ee87cc6a7dc342f44?s=128&d=identicon&r=PG", "display_name": "manugupt1", "link": "https://stackoverflow.com/users/191799/manugupt1"}, "reply_to_user": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 1, "creation_date": 1528401090, "post_id": 50720339, "comment_id": 88505898, "body": "@Victor I have not removed any comment (at least not intentionally)! In fact, that comment was what helped me understand it the concept really well. I was surprised it was gone later."}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1528402286, "post_id": 50720339, "comment_id": 88506488, "body": "Whoa... that&#39;s strange, i mean, nobody removes comments (and as a matter of code of conduct the remover shall explain to you why, in order to avoid next time to repeat the &quot;error&quot;, if any...)... anyway, leaving that aside i would like to add that we all do great job in this post, we all share a lot of acknowledge, colaborate towards a common goal: to learn."}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1528402352, "post_id": 50720339, "comment_id": 88506524, "body": "I leave you with a  <i>very special case</i> to study at home regarding slices affairs : <a href=\"https://play.golang.org/p/KwskY77tM-Y\" rel=\"nofollow noreferrer\">play.golang.org/p/KwskY77tM-Y</a>. Ja enjoy it!! :D"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 2, "last_activity_date": 1528289159, "creation_date": 1528289159, "answer_id": 50720771, "question_id": 50720339, "link": "https://stackoverflow.com/questions/50720339/golang-slice-matches-with-the-last-element/50720771#50720771", "title": "golang slice [:] matches with the last element", "body": "<p>In one case, an individual <code>thing</code> is an array (<code>[2]byte</code>), and in the other, it's a slice (<code>[]byte</code>). In the first case, you're slicing an array into <code>match</code>, which gives you a new slice pointing at your loop iteration variable. In the second case, you're re-slicing an existing slice, so your new slice points at that slice's underlying array, even after the loop changes out the local slice variable.</p>\n\n<p>Because your loop keeps running after you find your match, you find your match, slice it, then keep iterating, changing the value of the local loop iterator. If you did:</p>\n\n<pre><code>    if i == idx {\n        return thing[:]\n    }\n</code></pre>\n\n<p>instead, the issue disappears: <a href=\"https://play.golang.org/p/Uq4DbEGlGX8\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Uq4DbEGlGX8</a></p>\n"}, {"comments": [{"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1528295841, "post_id": 50720947, "comment_id": 88454561, "body": "i guess this would be an accepted answer, but may i inquire &quot;how continuning iterating affect the returning result?&quot; what is going on (that i don&#39;t see) in step (2)? Is there a kind of clousure here?? Guess no clousures here... sure is something related to the <i>sliceHeader</i> struct... really don&#39;t kwow and let me wondering..."}, {"owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "reply_to_user": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 2, "creation_date": 1528297576, "post_id": 50720947, "comment_id": 88455710, "body": "It&#39;s a tricky behavior. <code>match = thing[:]</code> - here slice <code>match</code> collects refer to array. On each iteration <code>thing</code> variable has the same address - try <code>fmt.Printf(&quot;Pointer %p \\n&quot;, &amp;thing)</code>. On the end of the loop <code>thing</code> is the last element, and thus <code>match</code> refers to its value."}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1528298495, "post_id": 50720947, "comment_id": 88456369, "body": "well, thanks for the insight...i really don&#39;t see it coming... it has the same address, but different value... what is the meaning of that? ."}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1528298852, "post_id": 50720947, "comment_id": 88456617, "body": "For me it looks like that in each iteration the <code>thing</code>  (i mean, the [2]byte array used in each iteration) gets overwrited (by the correspondant values of n-th element)  thus modifyingt the underlying array to which the slice refers (as the <code>match = thing[:]</code>statement reflects) . So the problem is that we are slicing the <b>sole array</b> (i.e. short declared variable named &quot;thing&quot;) used to <b>store the values in each iteration</b>?"}], "tags": [], "owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "is_accepted": true, "score": 2, "last_activity_date": 1528314014, "last_edit_date": 1528314014, "creation_date": 1528289619, "answer_id": 50720947, "question_id": 50720339, "link": "https://stackoverflow.com/questions/50720339/golang-slice-matches-with-the-last-element/50720947#50720947", "title": "golang slice [:] matches with the last element", "body": "<p>Two cases are <strong><em>not</em></strong> the same.</p>\n\n<p><em>In the first case</em>, you are working with <code>[][2]byte</code> (slice of arrays) not with <code>[][]byte</code> (slice of slices).</p>\n\n<pre><code>var match []byte\nfor i, thing := range things { // (2) change array on each iteration\n    fmt.Printf(\"Thing %v\", thing)\n    if i == idx {\n        match = thing[:] // (1) slice refers to array   \n    }\n}\nreturn match // (3) here match slice refers to the last item of things\n</code></pre>\n\n<p>One of solutions here is adding <code>break</code> statement after <code>match = thing[:]</code>. It ends the loop and <code>match</code> will refer to expected array.</p>\n\n<p>Just to clarify what is the actual issue here, the problem is that you are creating an slice that refers to an array that is overwritted in each <em>n-iteration</em> with the values of the correspondant <em>n-th element</em> of the slice of 2 bytes array. <strong>So if you don't stop iterating the slice will get the values of the last element</strong>.</p>\n\n<p>Using a <code>for .. := range</code> \"hides\" a little bit this fact. I guess if you write the same code with a <code>for i;i&lt;n;i++</code>, you could get a better understanding of what is actually happening: <a href=\"https://play.golang.org/p/z3hCskZ9ezV\" rel=\"nofollow noreferrer\">https://play.golang.org/p/z3hCskZ9ezV</a></p>\n"}], "owner": {"reputation": 2101, "user_id": 191799, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/040b77e27e69c24ee87cc6a7dc342f44?s=128&d=identicon&r=PG", "display_name": "manugupt1", "link": "https://stackoverflow.com/users/191799/manugupt1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1630, "favorite_count": 0, "accepted_answer_id": 50720947, "answer_count": 2, "score": 3, "last_activity_date": 1528314014, "creation_date": 1528287894, "last_edit_date": 1528294353, "question_id": 50720339, "link": "https://stackoverflow.com/questions/50720339/golang-slice-matches-with-the-last-element", "title": "golang slice [:] matches with the last element", "body": "<p>I am working on a sample program in golang which is as follows</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype thing [2]byte\n\nfunc walk(things []thing, idx int) []byte {\n    var match []byte\n    for i, thing := range things {\n        if i == idx {\n            match = thing[:]\n        }\n    }\n    return match\n}\n\n\nfunc main() {\n    ta := []thing{ thing{'W','A'}, thing{'O','R'} }\n    m := walk(ta, 0)\n\n    tb := []thing{ thing{'C','A'}, thing{'W','Y'}, thing{'N','V'} }\n    n := walk(tb, 1)\n\n    fmt.Printf(\"m = %s\\n\", m)\n    fmt.Printf(\"n = %s\\n\", n)\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>m = OR\nn = NV\n</code></pre>\n\n<p>I am not sure why this is the case when type thing [2]byte is an array of size 2 and ta is type []thing.</p>\n\n<p>Now when you write the same code as this using [][]byte</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc walk(things [][]byte, idx int) []byte {\n    var match []byte\n    for i, thing := range things {\n        if i == idx {\n            match = thing[:]\n        }\n    }\n    return match\n}\n\nfunc main() {\n    ta := [][]byte{[]byte{'W', 'A'}, []byte{'O', 'R'}}\n    m := walk(ta, 0)\n\n    tb := [][]byte{[]byte{'C', 'A'}, []byte{'W', 'Y'}, []byte{'N', 'V'}}\n    n := walk(tb, 1)\n\n    fmt.Printf(\"m = %s\\n\", m)\n    fmt.Printf(\"n = %s\\n\", n)\n}\n</code></pre>\n\n<p>The output is </p>\n\n<pre><code>m = WA\nn = WY\n</code></pre>\n\n<p>I am confused by these different behaviours of slices? \nPrinting out <code>ta[:]</code> when <code>ta is type thing []byte</code> and <code>ta[:] when ta is [][]byte</code> is the same</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1528286955, "post_id": 50719868, "comment_id": 88448484, "body": "Please post a <a href=\"https://stackoverflow.com/help/mcve\">minimal, verifiable and complete example</a>. The code given won&#39;t even compile (e.g. it references <code>obj.InnerStruct</code> when the field is <code>obj.MyData</code>). Test your sample code before posting it."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1528286920, "creation_date": 1528286920, "answer_id": 50720042, "question_id": 50719868, "link": "https://stackoverflow.com/questions/50719868/refer-by-address-in-range-function/50720042#50720042", "title": "Refer by address in range function", "body": "<p>You can't access by address, but you can get the index from <code>range</code> instead, and assign to the slice directly:</p>\n\n<pre><code>    for i := range obj.MyData {\n        obj.MyData[i].Var2 = callToPopulateValue()\n    }\n</code></pre>\n\n<p>Alternately, you can just use a slice of pointer values:</p>\n\n<pre><code>type OuterStruct struct {\n    opName   string\n    MyDAta   []*InnerStruct\n    LogDir   string\n}\n\nfunc (obj *OuterStruct) Setup2() {\n    for _, innerObj := range obj.MyData {\n        innerObj.Var2 = callToPopulateValue()\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 923, "user_id": 2822921, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/a240cddfed87fa7da86cb9e4b1d6ef05?s=128&d=identicon&r=PG&f=1", "display_name": "Ashwin", "link": "https://stackoverflow.com/users/2822921/ashwin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "accepted_answer_id": 50720042, "answer_count": 1, "score": -3, "last_activity_date": 1528286920, "creation_date": 1528286300, "last_edit_date": 1528286873, "question_id": 50719868, "link": "https://stackoverflow.com/questions/50719868/refer-by-address-in-range-function", "title": "Refer by address in range function", "body": "<p>I have a <code>OuterStruct</code> structure defined as given below. I am using the function to initialize the <code>OuterStruct -&gt; InnerStruct</code> values <code>Name and Var1</code> in <code>setup1()</code> and <code>Var1</code> in <code>setup2()</code>.</p>\n\n<p>The value assigned in setup2() is <code>nil</code> always because it is referring it by value. How to use refer my address here ?</p>\n\n<pre><code>type InnerStruct struct {\n    Name  string\n    Var1  *api.Var1\n    Var2  *ap1.Var2\n}\n\ntype OuterStruct struct {\n    opName   string\n    MyData   []InnerStruct\n    LogDir   string\n}\n\nfunc (obj *OuterStruct) Setup2() {\n    for _, innerObj := range obj.InnerStruct {   // Here is the prob becuase of using refer by value\n        innerObj.Var2 = callToPopulateValue()\n    }\n}\n\nfunc Setup1() {\n    innerStructList := []InnerStruct\n\n    myStruct := InnerStruct{}\n    myStruct.Name = \"name1\"\n    myStruct.Var1 = callToPopulateValue()\n    innerStructList = append(innerStructList, myStruct)\n\n    finalStruct = &amp;OuterStruct {\n        opName: \"structName\",\n        MyData: innerStructList,\n        LogDir: \"/path/for/my/logs\",\n    }\n\n    finalStruct.Setup2()\n}\n</code></pre>\n"}, {"tags": ["go", "struct", "runtime"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1528285414, "post_id": 50719384, "comment_id": 88447435, "body": "There&#39;s a number of ways to handle variadic schemas in golang. It&#39;s kind of hard to comment on what you can/can&#39;t/shouldn&#39;t do without seeing the actual data, or for that matter, what you&#39;ve tried so far"}, {"owner": {"reputation": 184, "user_id": 5539494, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/de5558aed62a14232df48682aff5f875?s=128&d=identicon&r=PG&f=1", "display_name": "ks2bmallik", "link": "https://stackoverflow.com/users/5539494/ks2bmallik"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1528287593, "post_id": 50719384, "comment_id": 88448932, "body": "@EliasVanOotegem My bad, I should have added it earlier. Can you suggest something now, please?"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1528288127, "post_id": 50719384, "comment_id": 88449267, "body": "But what are you trying to do? Unmarshal, marshal? How many different types have you got to content with? Are there any fields in particular that all data has in common (eg schema, title, type, ...) that you can use? Have you looked in to creating your own type + implement  JSONMarshaller and JSONUnmarshaller interfaces on that? Have you looked at the RawMessage type, and considered using custom marshalling effectively doing the marshalling in 2 stages?"}], "answers": [{"comments": [{"owner": {"reputation": 184, "user_id": 5539494, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/de5558aed62a14232df48682aff5f875?s=128&d=identicon&r=PG&f=1", "display_name": "ks2bmallik", "link": "https://stackoverflow.com/users/5539494/ks2bmallik"}, "edited": false, "score": 0, "creation_date": 1528290809, "post_id": 50720856, "comment_id": 88450991, "body": "Thanks for your help. This is what I needed."}], "tags": [], "owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "is_accepted": true, "score": 2, "last_activity_date": 1528289353, "creation_date": 1528289353, "answer_id": 50720856, "question_id": 50719384, "link": "https://stackoverflow.com/questions/50719384/parsing-jsonschema-to-struct-type-in-golang/50720856#50720856", "title": "Parsing JSONSchema to struct type in golang", "body": "<p>So it looks like you're trying to implement your own json marshalling. That's no biggie: the standard json package already supports that. Just have your type implement the <code>MarshalJSON</code> and <code>UnmarshalJSON</code> functions (cf first example on <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">the docs</a>). Assuming some fields will be shared (eg schema, id, type), you can create a unified type like this:</p>\n\n<pre><code>// poor naming, but we need this level of wrapping here\ntype Data struct {\n    Metadata\n}\n\ntype Metadata struct {\n    Schema string `json:\"$schema\"`\n    Type string `json:\"type\"`\n    Description string `json:\"description\"`\n    Id string `json:\"id\"`\n    Properties json.RawMessage `json:\"properties\"`\n    Address *Address `json:\"-\"`\n    // other types go here, too\n}\n</code></pre>\n\n<p>Now all properties will be unmarshalled into a <code>json.RawMessage</code> field (essentially this is a <code>[]byte</code> field). What you can do in your custom unmarshall function now is something like this:</p>\n\n<pre><code>func (d *Data) UnmarshalJSON(b []byte) error {\n    meta := Metadata{}\n    // unmarshall common fields\n    if err := json.Unmarshal(b, &amp;meta); err != nil {\n        return err\n    }\n    // Assuming the Type field contains the value that allows you to determine what data you're actually unmarshalling\n    switch meta.Type {\n    case \"address\":\n        meta.Address = &amp;Address{} // initialise field\n        if err := json.Unmarshal([]byte(meta.Properties), meta.Address); err != nil {\n            return err\n        }\n    case \"name\":\n        meta.Name = &amp;Name{}\n        if err := json.Unmarshal([]byte(meta.Properties), meta.Name); err != nil {\n            return err\n        }\n    default:\n        return errors.New(\"unknown message type\")\n    }\n    // all done\n    d.Metadata = meta // assign to embedded\n    // optionally: clean up the Properties field, as it contains raw JSON, and is exported\n    d.Metadata.Properties = json.RawMessage{}\n    return nil\n}\n</code></pre>\n\n<p>You can do pretty much the same thing for marshalling. First work out what type you're actually working with, then marshal that object into the properties field, and <em>then</em> marhsal the entire structure</p>\n\n<pre><code>func (d Data) MarshalJSON() ([]byte, error) {\n    var (\n        prop []byte\n        err error\n    )\n    switch {\n    case d.Metadata.Address != nil:\n        prop, err = json.Marshal(d.Address)\n    case d.Metadata.Name != nil:\n        prop, err = json.Marshal(d.Name) // will only work if field isn't masked, better to be explicit\n    default:\n        err = errors.New(\"No properties to marshal\") // handle in whatever way is best\n    }\n    if err != nil {\n        return nil, err\n    }\n    d.Metadata.Properties = json.RawMessage(prop)\n    return json.Marshal(d.Metadata) // marshal the unified type here\n}\n</code></pre>\n"}], "owner": {"reputation": 184, "user_id": 5539494, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/de5558aed62a14232df48682aff5f875?s=128&d=identicon&r=PG&f=1", "display_name": "ks2bmallik", "link": "https://stackoverflow.com/users/5539494/ks2bmallik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2557, "favorite_count": 1, "accepted_answer_id": 50720856, "answer_count": 1, "score": 0, "last_activity_date": 1528289353, "creation_date": 1528284752, "last_edit_date": 1528287852, "question_id": 50719384, "link": "https://stackoverflow.com/questions/50719384/parsing-jsonschema-to-struct-type-in-golang", "title": "Parsing JSONSchema to struct type in golang", "body": "<p>So, my use case consists of parsing varying JSON schemas into new struct types, which will be further used with an ORM to fetch data from a SQL database. Being compiled in nature, I believe there will not be an out-of-the-box solution in go, but is there any hack available to do this, without creating a separate go process. I tried with reflection, but could not find a satisfactory approach.</p>\n\n<p>Currently, I am using <a href=\"https://github.com/a-h/generate\" rel=\"nofollow noreferrer\">a-h generate</a> library which does generate the structs, but I am stuck at how to load these new struct types in go runtime.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Example JSON Schema:</p>\n\n<pre><code>{\n  \"$schema\": \"http://json-schema.org/draft-07/schema#\",\n  \"title\": \"Address\",\n  \"id\": \"Address\",\n  \"type\": \"object\",\n  \"description\": \"address\",\n  \"properties\": {\n    \"houseName\": {\n      \"type\": \"string\",\n      \"description\": \"House Name\",\n      \"maxLength\": 30\n    },\n    \"houseNumber\": {\n      \"type\": \"string\",\n      \"description\": \"House Number\",\n      \"maxLength\": 4\n    },\n    \"flatNumber\": {\n      \"type\": \"string\",\n      \"description\": \"Flat\",\n      \"maxLength\": 15\n    },\n    \"street\": {\n      \"type\": \"string\",\n      \"description\": \"Address 1\",\n      \"maxLength\": 40\n    },\n    \"district\": {\n      \"type\": \"string\",\n      \"description\": \"Address 2\",\n      \"maxLength\": 30\n    },\n    \"town\": {\n      \"type\": \"string\",\n      \"description\": \"City\",\n      \"maxLength\": 20\n    },\n    \"county\": {\n      \"type\": \"string\",\n      \"description\": \"County\",\n      \"maxLength\": 20\n    },\n    \"postcode\": {\n      \"type\": \"string\",\n      \"description\": \"Postcode\",\n      \"maxLength\": 8\n    }\n  }\n}\n</code></pre>\n\n<p>Now, in the above-mentioned library, there is a command line tool, which generates the text for struct type for above json as below:</p>\n\n<pre><code>// Code generated by schema-generate. DO NOT EDIT.\n\npackage main\n\n// Address address\ntype Address struct {\n  County string `json:\"county,omitempty\"`\n  District string `json:\"district,omitempty\"`\n  FlatNumber string `json:\"flatNumber,omitempty\"`\n  HouseName string `json:\"houseName,omitempty\"`\n  HouseNumber string `json:\"houseNumber,omitempty\"`\n  Postcode string `json:\"postcode,omitempty\"`\n  Street string `json:\"street,omitempty\"`\n  Town string `json:\"town,omitempty\"`\n}\n</code></pre>\n\n<p>Now, the issue is that how to use this struct type without re-compilation in the program. There is a hack, where I can start a new go process, but that doesn't seem a good way to do it. One other way is to write my own parser for unmarshalling JSON schema, something like:</p>\n\n<pre><code>b := []byte(`{\"Name\":\"Wednesday\",\"Age\":6,\"Parents\":[\"Gomez\",\"Morticia\"]}`)\nvar f interface{}\njson.Unmarshal(b, &amp;f)\nm := f.(map[string]interface{})\nfor k, v := range m {\n    switch vv := v.(type) {\n    case string:\n        fmt.Println(k, \"is string\", vv)\n    case float64:\n        fmt.Println(k, \"is float64\", vv)\n    case int:\n        fmt.Println(k, \"is int\", vv)\n    case []interface{}:\n        fmt.Println(k, \"is an array:\")\n        for i, u := range vv {\n            fmt.Println(i, u)\n        }\n    default:\n        fmt.Println(k, \"is of a type I don't know how to handle\")\n    }\n}\n</code></pre>\n\n<p>Can someone please suggest some pointers to look for. Thanks.</p>\n"}, {"tags": ["go", "vnc"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1528284017, "post_id": 50718652, "comment_id": 88446580, "body": "<i>Questions seeking debugging help (&quot;why isn&#39;t this code working?&quot;) must include the desired behavior, a specific problem or error <b>and the shortest code necessary to reproduce it in the question itself</b>.</i>"}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 0, "last_activity_date": 1528292008, "creation_date": 1528292008, "answer_id": 50721837, "question_id": 50718652, "link": "https://stackoverflow.com/questions/50718652/golang-vnc-connetion-error-out-of-memory/50721837#50721837", "title": "golang vnc connetion error - out of memory", "body": "<p><a href=\"https://github.com/golang/go/wiki/Performance#memory-profiler\" rel=\"nofollow noreferrer\">Profile memory usage</a> of your program:</p>\n\n<blockquote>\n  <p>Memory profiler shows what functions allocate heap memory. You can collect it in similar ways as CPU profile: with <code>go test --memprofile</code> (<a href=\"http://golang.org/cmd/go/#hdr-Description_of_testing_flags\" rel=\"nofollow noreferrer\">http://golang.org/cmd/go/#hdr-Description_of_testing_flags</a>), with <code>net/http/pprof</code> via <a href=\"http://myserver:6060:/debug/pprof/heap\" rel=\"nofollow noreferrer\">http://myserver:6060:/debug/pprof/heap</a> or by calling <code>runtime/pprof.WriteHeapProfile</code>.</p>\n  \n  <p>&lt;\u2026></p>\n</blockquote>\n"}], "owner": {"reputation": 65, "user_id": 8629072, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d5731c78f87782981828c2e3b18f5fb?s=128&d=identicon&r=PG&f=1", "display_name": "Stefano Conte", "link": "https://stackoverflow.com/users/8629072/stefano-conte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1528292008, "creation_date": 1528282568, "last_edit_date": 1528283442, "question_id": 50718652, "link": "https://stackoverflow.com/questions/50718652/golang-vnc-connetion-error-out-of-memory", "title": "golang vnc connetion error - out of memory", "body": "<p>I have vnc application wited in go, the problem is after same time execution crash, with the message out of memory. </p>\n\n<p>The complete log is here: <a href=\"https://ghostbin.com/paste/3wpcm\" rel=\"nofollow noreferrer\">https://ghostbin.com/paste/3wpcm</a></p>\n\n<p>the complete code of client.go where exist this error is this: <a href=\"https://ghostbin.com/paste/bgn7s\" rel=\"nofollow noreferrer\">https://ghostbin.com/paste/bgn7s</a></p>\n\n<p>does anyone know why this application is out of memory? my Linux machine has 16gb ram memory.</p>\n"}, {"tags": ["http", "go", "heroku", "https"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1528281962, "creation_date": 1528281962, "answer_id": 50718457, "question_id": 50717939, "link": "https://stackoverflow.com/questions/50717939/how-to-serve-golang-app-on-heroku-using-http-instead-of-https/50718457#50718457", "title": "How to serve Golang app on Heroku using http instead of https?", "body": "<p>Delete the <code>'s'</code> from the URL when you try to access your app, that's all it takes.</p>\n\n<p>Just make sure you start the Go web server in normal (HTTP) mode. The HTTPS layer is added by the Heroku platform, but your app is still available via both HTTP and HTTPS protocol.</p>\n\n<p>So for example if you access your app using the URL:</p>\n\n<pre><code>https://myapp.herokuapp.com\n</code></pre>\n\n<p>You may also use</p>\n\n<pre><code>http://myapp.herokuapp.com\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 8432728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2018870880ec8d8741f21a6236395212?s=128&d=identicon&r=PG&f=1", "display_name": "Mohamad Ali Mhaidly", "link": "https://stackoverflow.com/users/8432728/mohamad-ali-mhaidly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 50718457, "answer_count": 1, "score": -5, "last_activity_date": 1528281962, "creation_date": 1528280301, "question_id": 50717939, "link": "https://stackoverflow.com/questions/50717939/how-to-serve-golang-app-on-heroku-using-http-instead-of-https", "title": "How to serve Golang app on Heroku using http instead of https?", "body": "<p>I need to host a golang app on heroku and reach it using http instead of https.\nAny idea how I can do it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1528277649, "post_id": 50716464, "comment_id": 88442434, "body": "Also see related: <a href=\"https://stackoverflow.com/questions/39450120/golang-map-in-order-range-loop/39450454#39450454\">Golang map in order range loop</a>"}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1528277659, "post_id": 50716464, "comment_id": 88442446, "body": "And if you are intensive on look-ups &amp; want the result really fast without iterating then you should add a key-value pair for each of the percentage values in the map. That should take care of it esp as your inputs are always integers."}], "answers": [{"comments": [{"owner": {"reputation": 135, "user_id": 7257730, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c1bd41700acde973da38ab341916e13b?s=128&d=identicon&r=PG&f=1", "display_name": "John Mack", "link": "https://stackoverflow.com/users/7257730/john-mack"}, "edited": false, "score": 0, "creation_date": 1528276566, "post_id": 50716525, "comment_id": 88441684, "body": "This is amazing thank you very much, I will mark as excepted in 9 mins :)"}], "tags": [], "owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "is_accepted": true, "score": 2, "last_activity_date": 1528276659, "last_edit_date": 1528276659, "creation_date": 1528276361, "answer_id": 50716525, "question_id": 50716464, "link": "https://stackoverflow.com/questions/50716464/golang-for-looping-through-map-is-not-returning-inconsistant-values/50716525#50716525", "title": "Golang for looping through map is not returning inconsistant values", "body": "<p>When looping over maps in golang the order of the returned elements is random. This is the reason for the inconsistent behavior. See \"Iteration order\" in the official blog: <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow noreferrer\">https://blog.golang.org/go-maps-in-action</a></p>\n\n<p>If you want a stable order, you have to maintain the keys in another structure:</p>\n\n<pre><code>keys := []int{25, 50, 100}\n\nfor _, key := range keys {\n    if pm.Delimiters[key].Probability &gt;= input {\n        return pm.Delimiters[key]\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 135, "user_id": 7257730, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c1bd41700acde973da38ab341916e13b?s=128&d=identicon&r=PG&f=1", "display_name": "John Mack", "link": "https://stackoverflow.com/users/7257730/john-mack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 342, "favorite_count": 0, "closed_date": 1528277523, "accepted_answer_id": 50716525, "answer_count": 1, "score": 1, "last_activity_date": 1528276659, "creation_date": 1528276201, "question_id": 50716464, "link": "https://stackoverflow.com/questions/50716464/golang-for-looping-through-map-is-not-returning-inconsistant-values", "closed_reason": "Duplicate", "title": "Golang for looping through map is not returning inconsistant values", "body": "<p>I am writing a probability model that will take any number of \"Outcome\"s, then when a number is rolled and passed into the model the correct \"Outcome\" will be returned;</p>\n\n<p>Essentially the logic is a map of outcomes with indexes representing that outcomes particular weight.</p>\n\n<p>Outcome One 25%\nOutcome Two 25%\nOutcome Three 50%</p>\n\n<p>these values will translate to;</p>\n\n<pre><code>outcomes := make(map[int]Outcome)\noutcomes[25] = Outcome{\"Outcome One\", 25}\noutcomes[50] = Outcome{\"Outcome One\", 25}\noutcomes[100] = Outcome{\"Outcome One\", 50}\n</code></pre>\n\n<p>I have a function that then takes an input lets say 10, and loops around outcomes until the index is larger than the input;</p>\n\n<p>Expected</p>\n\n<pre><code>input: 10, output: Outcome{\"Outcome One\", 25}\ninput: 30, output: Outcome{\"Outcome Two\", 25}\ninput: 60, output: Outcome{\"Outcome Two\", 50}\n</code></pre>\n\n<p>However in my unit tests for an input of 10, I get a combination of \"Outcome One\" and \"Outcome Two\", I think the problem lies within my for loop.</p>\n\n<pre><code>ProbabilityMatrix_test.go\n\nvar outcome1 = Outcome{\"Outcome One\", 25}\nvar outcome2 = Outcome{\"Outcome Two\", 25}\nvar outcome3 = Outcome{\"Outcome Three\", 50}\n\nprobabilityMatrix := ProbabilityMatrix{}\nprobabilityMatrix.SetUp()\n\nprobabilityMatrix.AddOutcome(outcome1)\nprobabilityMatrix.AddOutcome(outcome2)\nprobabilityMatrix.AddOutcome(outcome3)\n\noutcome := probabilityMatrix.RollA(10)\n\nif outcome != outcome1 {\n    t.Errorf(\"%s\", probabilityMatrix.Delimiters)\n    t.Errorf(\"incorrect outcome, got %s, expected %s\", outcome.Name, outcome1.Name)\n}\n</code></pre>\n\n<p>The below code returns Outcome One, around 75% of the time (correct), and Outcome Two 25%</p>\n\n<pre><code>package RealisticTemperatureGenerator\n\ntype Outcome struct {\n    Name        string\n    Probability int\n}\n\ntype ProbabilityMatrix struct {\n    Delimiters     map[int]Outcome\n    DefaultOutcome Outcome\n    Total          int\n}\n\nfunc (pm *ProbabilityMatrix) SetUp() {\n    pm.Delimiters = make(map[int]Outcome)\n    pm.Total = 0\n}\n\nfunc (pm *ProbabilityMatrix) AddOutcome(outcome Outcome) {\n\n    pm.DefaultOutcome = outcome\n    currentIndex := outcome.Probability + pm.Total\n    pm.Delimiters[currentIndex] = outcome\n    pm.Total = currentIndex\n}\n\nfunc (pm *ProbabilityMatrix) RollA(input int) Outcome {\n  return pm.WalkDelimiters(input)\n}\n\n// Problem Possibly here\nfunc (pm ProbabilityMatrix) WalkDelimiters(input int) Outcome {\n\n  for key, _ := range pm.Delimiters {\n      if pm.Delimiters[key].Probability &gt;= input {\n        return pm.Delimiters[key]\n      }\n  }\n  return pm.DefaultOutcome\n}\n</code></pre>\n"}, {"tags": ["sql", "postgresql", "go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 204, "user_id": 7488661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSqnY.jpg?s=128&g=1", "display_name": "rtut", "link": "https://stackoverflow.com/users/7488661/rtut"}, "edited": false, "score": 0, "creation_date": 1528467905, "post_id": 50717397, "comment_id": 88533121, "body": "Link that helped me with the solution of the question: <a href=\"https://gowalker.org/github.com/lib/pq#Float64Array_Value\" rel=\"nofollow noreferrer\">gowalker.org/github.com/lib/pq#Float64Array_Value</a>"}], "tags": [], "owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "is_accepted": true, "score": 1, "last_activity_date": 1528280641, "last_edit_date": 1528280641, "creation_date": 1528278779, "answer_id": 50717397, "question_id": 50716285, "link": "https://stackoverflow.com/questions/50716285/how-save-float32-array-to-double-precision-from-gorm/50717397#50717397", "title": "How save float32 array to double precision from gorm", "body": "<p>I've encountered a problem like this. \nI suggest you make you own type for your array that implements</p>\n\n<blockquote>\n  <p>type Valuer interface</p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n  <p>type Scanner interface</p>\n</blockquote>\n\n<p>from <code>database/sql</code> package.</p>\n\n<p>Also you could try <code>pq.Float64Array</code> type instead of float slice (I know that is float64, but it is the only type they have) from <code>github.com/lib/pq</code>.</p>\n"}], "owner": {"reputation": 204, "user_id": 7488661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSqnY.jpg?s=128&g=1", "display_name": "rtut", "link": "https://stackoverflow.com/users/7488661/rtut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 709, "favorite_count": 0, "accepted_answer_id": 50717397, "answer_count": 1, "score": 1, "last_activity_date": 1539070564, "creation_date": 1528275622, "last_edit_date": 1539070564, "question_id": 50716285, "link": "https://stackoverflow.com/questions/50716285/how-save-float32-array-to-double-precision-from-gorm", "title": "How save float32 array to double precision from gorm", "body": "<p>I try save float32 in golang to db (postgresql). I use gorm. My Field in struct:</p>\n\n<pre><code>    Cluster [512]float32 `gorm:\"column:cluster;type:float[]\"`\n</code></pre>\n\n<p>When i save to db, log mode show me right sql, but write error: </p>\n\n<blockquote>\n  <p>converting argument $3 type: unsupported type [512]float32, a array</p>\n</blockquote>\n\n<p>\u0421an anyone have an idea how to tell the postgres what to do?\nThank you!</p>\n"}, {"tags": ["shell", "docker", "go", "docker-compose", "dockerfile"], "comments": [{"owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "edited": false, "score": 0, "creation_date": 1528291377, "post_id": 50716262, "comment_id": 88451436, "body": "It appears that you&#39;re trying to execute a directory. What directory has the docker-compose.yml?"}], "answers": [{"comments": [{"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1528302832, "post_id": 50721936, "comment_id": 88458916, "body": "1+ Can you please elaborate or better, provide example :) how should I improve my dockerfile /compose ? im a bit new to this topic .thanks!"}, {"owner": {"reputation": 5914, "user_id": 134848, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a52afd6c788eb27121003a9a8a4a9333?s=128&d=identicon&r=PG", "display_name": "krystan honour", "link": "https://stackoverflow.com/users/134848/krystan-honour"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1528377049, "post_id": 50721936, "comment_id": 88491687, "body": "of course, i added to the answer, obviously check this works for you but it gives you an idea."}], "tags": [], "owner": {"reputation": 5914, "user_id": 134848, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a52afd6c788eb27121003a9a8a4a9333?s=128&d=identicon&r=PG", "display_name": "krystan honour", "link": "https://stackoverflow.com/users/134848/krystan-honour"}, "is_accepted": true, "score": 2, "last_activity_date": 1528377022, "last_edit_date": 1528377022, "creation_date": 1528292293, "answer_id": 50721936, "question_id": 50716262, "link": "https://stackoverflow.com/questions/50716262/docker-permission-error-while-up/50721936#50721936", "title": "Docker permission error while up", "body": "<p>Your cmd line is incorrect it should read:</p>\n\n<pre><code>CMD ${SOURCES}/book-store\n</code></pre>\n\n<p>you are trying to execute a directory</p>\n\n<p>Also just as an aside this container is running as root, you should really make it run as a user you create that doesn't have root privs.</p>\n\n<p>You could do this with a Dockerfile that looked a bit like this:</p>\n\n<pre><code>FROM golang:1.9.6-alpine\n\nRUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add --no-cache bash git\n\nRUN go get github.com/gin-gonic/gin\n\nENV SOURCES /go/src/book-store\nCOPY . ${SOURCES}\n\nRUN addgroup goapi &amp;&amp; \\\n  adduser -D -S -G goapi goapi &amp;&amp; \\\n  cd ${SOURCES} &amp;&amp; \\\n  CGO_ENABLED=0 go build &amp;&amp; \\\n  chmod +x /go/src/book-store &amp;&amp; \\\n  chown -R goapi:goapi /go\n\nUSER goapi\n\nWORKDIR ${SOURCES}\nCMD ${SOURCES}/book-store\nEXPOSE 8080\n</code></pre>\n\n<p>hope this helps.</p>\n"}], "owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 1, "accepted_answer_id": 50721936, "answer_count": 1, "score": 1, "last_activity_date": 1528377022, "creation_date": 1528275566, "last_edit_date": 1528280439, "question_id": 50716262, "link": "https://stackoverflow.com/questions/50716262/docker-permission-error-while-up", "title": "Docker permission error while up", "body": "<p>Im using the following <code>dockerfile</code> to <code>build and run</code> go application\nthe application name is <code>book-store</code> and it's located under <code>go/src/book-store</code> in my local <code>mac</code>.</p>\n\n<pre><code>go\n-src\n--book-store\n--main.go\n</code></pre>\n\n<p>Now i've create the following docker file</p>\n\n<pre><code>FROM golang:1.9.6-alpine\n\nRUN apk update &amp;&amp; apk upgrade &amp;&amp; apk add --no-cache bash git\n\nRUN go get github.com/gin-gonic/gin\n\n\nENV SOURCES /go/src/book-store\nCOPY . ${SOURCES}\n\n\nRUN cd ${SOURCES} &amp;&amp; CGO_ENABLED=0 go build\n\nRUN chmod +x /go/src/book-store\n\nWORKDIR ${SOURCES}\nCMD ${SOURCES}\nEXPOSE 8080\n</code></pre>\n\n<p>in addition i've create this docker compose </p>\n\n<pre><code>version: '2'\nservices: \n  book-store-web:\n    build: .\n    image: book-store:1.0.1\n    environment: \n    - PORT=8080\n    ports: \n    - \"8080:8080\"\n</code></pre>\n\n<p>Now I use </p>\n\n<p><code>docker-compose build</code></p>\n\n<p>which created image successfully, and now I want to run the image with \n<code>docker-compose up</code> </p>\n\n<p>And I got the following error:</p>\n\n<pre><code>Creating book-store_book-store-web_1 ... done\nAttaching to book-store_book-store-web_1\nbook-store-web_1  | /bin/sh: /go/src/book-store: Permission denied\nbook-store_book-store-web_1 exited with code 126\n</code></pre>\n\n<p><strong>Any idea what could be wrong here ?</strong></p>\n\n<p>I've added the <code>RUN chmod +x /go/src/book-store</code> to overcome the permission issue without success...</p>\n"}, {"tags": ["ssl", "go", "certificate", "skip"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1528277173, "post_id": 50716173, "comment_id": 88442096, "body": "Probably nothing. A pure server error. Skimming crypto/tls for options about how to not read ASN.1 at all might be helpful."}], "owner": {"reputation": 59, "user_id": 9902243, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XmZBD_x_jqg/AAAAAAAAAAI/AAAAAAAAABY/K98gO8CjpUY/photo.jpg?sz=128", "display_name": "dino123", "link": "https://stackoverflow.com/users/9902243/dino123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3552, "favorite_count": 0, "answer_count": 0, "score": 5, "last_activity_date": 1528275503, "creation_date": 1528275324, "last_edit_date": 1528275503, "question_id": 50716173, "link": "https://stackoverflow.com/questions/50716173/golang-tls-ssl-skip-certificate-verification-failing", "title": "golang TLS/SSL skip certificate verification failing", "body": "<p>I'm trying to skip certificate verification while trying to do a https request to a server. The client.Do() fails with the following error:</p>\n\n<blockquote>\n  <p>tls: failed to parse certificate from server: asn1: syntax error:\n  PrintableString contains invalid character</p>\n</blockquote>\n\n<p><strong>Code Snippet:</strong></p>\n\n<pre><code>    var jsonStr = []byte(`{\"grant_type\":\"client_credentials\"}`)\n    req, err := http.NewRequest(\"POST\", url, bytes.NewBuffer(jsonStr))\n    fmt.Println(\"req:&gt;\", req)\n\n    //req.Header.Set(\"Content-Type\", \"application/json\")\n    req.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n    req.SetBasicAuth(\"opennms\", \"test123~\")\n\n    tr := &amp;http.Transport{\n            TLSClientConfig: &amp;tls.Config{InsecureSkipVerify: true},\n    }\n    client := &amp;http.Client{Transport: tr}\n\n    //client := &amp;http.Client{}\n    resp, err := client.Do(req)\n    fmt.Println(\"resp:&gt;\", resp)\n    if err != nil {\n            panic(err)\n    }\n    defer resp.Body.Close()\n\n    body, _ := ioutil.ReadAll(resp.Body)\n    fmt.Println(\"response Body:\", string(body))\n</code></pre>\n\n<p>What am I missing here?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1528273809, "post_id": 50715657, "comment_id": 88439945, "body": "What have you actually tried? If you have made an attempt and can&#39;t work a part out then that&#39;s fine. But right now the question is looking like &quot;write my code for me&quot;, so please make it better. Mind you, I would err towards &quot;No&quot; considering the project has not been updated for some time. Usually this requires updates in the driver implementation to accept the <code>arrayFilters</code> in the options block."}, {"owner": {"reputation": 174, "user_id": 5324750, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6d1f2ff3eac6208f7ed2e98c1f17bac?s=128&d=identicon&r=PG&f=1", "display_name": "Prashanth Hegde", "link": "https://stackoverflow.com/users/5324750/prashanth-hegde"}, "reply_to_user": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1528274135, "post_id": 50715657, "comment_id": 88440147, "body": "Hi @NeilLunn, as i said, i have tried to update the collection using mongo shell and succeeded, but mgo&#39;s update function will accept only two parameters. is there is any workaround or any suggestions is appreciated."}, {"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 1, "creation_date": 1528274482, "post_id": 50715657, "comment_id": 88440346, "body": "I don&#39;t think you can as the signature for the <code>Update</code> in mgo does not appear to allow passing such an option. There is an officially supported <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">MongoDB Go Driver now</a>. There are examples of <code>arrayFilters</code> with positional filtered updates in the unit tests. But it would mean converting your project from using mgo to using the alternate driver. The other &quot;possibility&quot; could be to issue the raw database command for the update. But I would really not recommend that, and you&#39;re probably better off switching drivers."}, {"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1528280827, "post_id": 50715657, "comment_id": 88444544, "body": "Another option is to wait when it is implemented in the legacy driver <a href=\"https://github.com/globalsign/mgo/issues/179\" rel=\"nofollow noreferrer\">github.com/globalsign/mgo/issues/179</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 12022587, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAhDe67eWuF2NfDpsCeZG5YXk_bT_6Dvjf-ucB0=k-s128", "display_name": "user12022587", "link": "https://stackoverflow.com/users/12022587/user12022587"}, "is_accepted": false, "score": 0, "last_activity_date": 1567736101, "creation_date": 1567736101, "answer_id": 57814930, "question_id": 50715657, "link": "https://stackoverflow.com/questions/50715657/how-to-use-array-filters-of-mongodb-3-6-in-mgo-framework/57814930#57814930", "title": "How to use array filters of mongodb 3.6 in mgo framework?", "body": "<p><a href=\"https://github.com/laoluan/mgo\" rel=\"nofollow noreferrer\">https://github.com/laoluan/mgo</a><br>\nI modified the mgo version</p>\n\n<pre><code>_ = session.DB(\"youdbname\").C(\"test4\").UpdateUseAf(\n    bson.M{},\n    bson.M{\"$set\": bson.M{\"QP.$[i].CompulsoryNos.$[j].PerformanceCriteria.$[k].Skills\": \"Talented\"}},\n    []bson.M{\n        {\"i.qpCode\" : \"ID_1\"},\n        {\"j.NosCode\" : \"Code_1\"},\n        {\"k.Skills\" : \"skills_1\"},\n    },\n)\n</code></pre>\n"}], "owner": {"reputation": 174, "user_id": 5324750, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6d1f2ff3eac6208f7ed2e98c1f17bac?s=128&d=identicon&r=PG&f=1", "display_name": "Prashanth Hegde", "link": "https://stackoverflow.com/users/5324750/prashanth-hegde"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 892, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1567736101, "creation_date": 1528273687, "question_id": 50715657, "link": "https://stackoverflow.com/questions/50715657/how-to-use-array-filters-of-mongodb-3-6-in-mgo-framework", "title": "How to use array filters of mongodb 3.6 in mgo framework?", "body": "<p>Hi i have a situation where i have to update objects in nested array in mongodb collection using mgo framework of Go. As of now mongodb version 3.6 support this using ArrayFilters as a 3rd parameter in Collection.Update().The mgo Collection.Update() function only supports 2 parameters, one to find and another for update. How can i use arrayfilters in mgo's Collection.Update()</p>\n\n<p>This is my object look like</p>\n\n<pre><code>{\n  \"TPID\": \"\",\n  \"TPName\":\"\",\n  \"TCID\":\"\",\n  \"TCName\":\"\",\n  \"BatchId\":\"\",\n  \"BatchName\":\"\",\n  \"QP\":[{\n    \"qpCode\":\"\",\n       \"jobRole\":\"\",\n       \"Sector\":\"\",\n       \"SectorID\":\"\",\n\n    \"CompulsoryNos\":[{\n    \"NosCode\":\"\",\n    \"TotalMarks\":\"\",\n           \"OutOf\":\"\",\n           \"Theory\":\"\",\n           \"SkillsPracticals\":\"\",\n\n            \"PerformanceCriteria\":[{\n            \"CriteriaDesc\":\"\",\n            \"OutOf\":\"\",\n            \"Theory\":\"\",\n            \"Skills\":\"\"\n            }]\n    }]\n\n  }]\n\n\n}\n</code></pre>\n\n<p>and this was my approach in mongo shell(version 3.6)</p>\n\n<pre><code>db.test4.update({},\n{\"$set\" : \n{\"QP.$[i].CompulsoryNos.$[j].PerformanceCriteria.$[k].Skills\" : \n\"Talented\"}},\n{\"arrayFilters\" : [{\"i.qpCode\" : \"ID_1\"},{\"j.NosCode\" : \"Code_1\"}, \n{\"k.Skills\" : \"skills_1\"}]})\n</code></pre>\n\n<p>is there is any way to implement the same query using mgo?</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "is_accepted": true, "score": 2, "last_activity_date": 1528273978, "last_edit_date": 1528273978, "creation_date": 1528270665, "answer_id": 50714751, "question_id": 50714455, "link": "https://stackoverflow.com/questions/50714455/convert-json-member-string-to-json-object/50714751#50714751", "title": "Convert JSON member string to JSON object", "body": "<p>You are doing fine, just a few remarks: Remove the quote before and after the square brackets, and you should make Data of type []Pets (which struct I would call Pet, because every item contains a single Pet). The square-brackets are part of the JSON construct. And then you don't need to escape the quotes, because they become JSON identifiers.</p>\n\n<p>In your way, it becomes a single long string, which, clearly, is not what you intent to have.</p>\n\n<p>These are the structures that fit on your second JSON </p>\n\n<pre><code>type ResponseStatus struct {\n   StatusCode int    \n   Message    string \n   Data       []Pet  `json:\"data\"`\n}\n\ntype Pet struct {\n   Id   int    `json:\"id\"`\n   Name string `json:\"name\"`\n   Age  int    `json:\"age\"`\n   Type string `json:\"type\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 7231501, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CV5Vu.jpg?s=128&g=1", "display_name": "deadsquad", "link": "https://stackoverflow.com/users/7231501/deadsquad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 385, "favorite_count": 0, "accepted_answer_id": 50714751, "answer_count": 1, "score": 1, "last_activity_date": 1565534111, "creation_date": 1528269743, "last_edit_date": 1565534111, "question_id": 50714455, "link": "https://stackoverflow.com/questions/50714455/convert-json-member-string-to-json-object", "title": "Convert JSON member string to JSON object", "body": "<p>I have this struct:</p>\n\n<pre><code>type ResponseStatus struct {\n    StatusCode int\n    Message    string\n    Data       string `json:\"data\"`\n}\n\ntype Pets struct {\n    Id   int    `json:\"id\"`\n    Name string `json:\"name\"`\n    Age  int    `json:\"age\"`\n    Type string `json:\"type\"`\n}\n</code></pre>\n\n<p>and this is my json result:</p>\n\n<pre><code>{\n    \"StatusCode\": 200,\n    \"Message\": \"Hello framework - OK\",\n    \"data\": \"[{\\\"id\\\":1,\\\"name\\\":\\\"george\\\",\\\"age\\\":2,\\\"type\\\":\\\"dog\\\"},{\\\"id\\\":2,\\\"name\\\":\\\"walter\\\",\\\"age\\\":1,\\\"type\\\":\\\"rabbit\\\"},{\\\"id\\\":3,\\\"name\\\":\\\"tom\\\",\\\"age\\\":1,\\\"type\\\":\\\"cat\\\"},{\\\"id\\\":4,\\\"name\\\":\\\"doggo\\\",\\\"age\\\":5,\\\"type\\\":\\\"dog\\\"},{\\\"id\\\":5,\\\"name\\\":\\\"torto\\\",\\\"age\\\":3,\\\"type\\\":\\\"turtle\\\"},{\\\"id\\\":6,\\\"name\\\":\\\"jerry\\\",\\\"age\\\":1,\\\"type\\\":\\\"hamster\\\"},{\\\"id\\\":7,\\\"name\\\":\\\"garf\\\",\\\"age\\\":2,\\\"type\\\":\\\"cat\\\"},{\\\"id\\\":8,\\\"name\\\":\\\"milo\\\",\\\"age\\\":4,\\\"type\\\":\\\"dog\\\"},{\\\"id\\\":9,\\\"name\\\":\\\"kimi\\\",\\\"age\\\":2,\\\"type\\\":\\\"cat\\\"},{\\\"id\\\":10,\\\"name\\\":\\\"buck\\\",\\\"age\\\":1,\\\"type\\\":\\\"rabbit\\\"}]\"\n}\n</code></pre>\n\n<p>How can I escaped double quotes in my result data as JSON like this:</p>\n\n<pre><code>{\n  \"StatusCode\": 200,\n  \"Message\": \"Hello framework - OK\",\n  \"data\": [\n    {\"id\": 1,\"name\": \"george\",\"age\": 2,\"type\": \"dog\"},\n    {\"id\": 2,\"name\": \"walter\",\"age\": 1,\"type\": \"rabbit\"},\n    {\"id\": 3,\"name\": \"tom\",\"age\": 1,\"type\": \"cat\"},\n    {\"id\": 4,\"name\": \"doggo\",\"age\": 5,\"type\": \"dog\"},\n    {\"id\": 5,\"name\": \"torto\",\"age\": 3,\"type\": \"turtle\"},\n    {\"id\": 6,\"name\": \"jerry\",\"age\": 1,\"type\": \"hamster\"},\n    {\"id\": 7,\"name\": \"garf\",\"age\": 2,\"type\": \"cat\"},\n    {\"id\": 8,\"name\": \"milo\",\"age\": 4,\"type\": \"dog\"},\n    {\"id\": 9,\"name\": \"kimi\",\"age\": 2,\"type\": \"cat\"},\n    {\"id\": 10,\"name\": \"buck\",\"age\": 1,\"type\": \"rabbit\"}\n  ]\n}\n</code></pre>\n"}, {"tags": ["go", "apache-kafka"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528269013, "post_id": 50713893, "comment_id": 88437164, "body": "When the brokers are down how could you receive events? With no brokers: Who would handle the messages? Could you elaborate?"}, {"owner": {"reputation": 1920, "user_id": 848547, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ea2a180c1dfdcd5a12176c633fa0ed2d?s=128&d=identicon&r=PG", "display_name": "sivann", "link": "https://stackoverflow.com/users/848547/sivann"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528269145, "post_id": 50713893, "comment_id": 88437237, "body": "@Volker, the events don&#39;t come from the server, according to the docs they come from the library goroutines and librdkafka. There are KafkaError error events like &quot;RD_KAFKA_RESP_ERR__FAIL&quot;  and RD_KAFKA_RESP_ERR__TRANSPORT . Check the docs. I amended the post. There should be a way for the app to detect connection failures."}, {"owner": {"reputation": 1920, "user_id": 848547, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ea2a180c1dfdcd5a12176c633fa0ed2d?s=128&d=identicon&r=PG", "display_name": "sivann", "link": "https://stackoverflow.com/users/848547/sivann"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528270106, "post_id": 50713893, "comment_id": 88437801, "body": "@volker, I elaborated, can you please remove the downvote so someone gives more attention to this."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528270620, "post_id": 50713893, "comment_id": 88438087, "body": "I&#39;m sorry, your problem description is still cryptic to me. Could you try and describe the actual setup in detail? You are talking about &quot;server&quot; and &quot;library&quot; and events coming from the somewhere? Are &quot;events&quot; Kafka messages in a topic. For such complicated problems you really should provide <b>much</b> <b>more</b> (a factor of 3 t o10) information."}, {"owner": {"reputation": 1920, "user_id": 848547, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ea2a180c1dfdcd5a12176c633fa0ed2d?s=128&d=identicon&r=PG", "display_name": "sivann", "link": "https://stackoverflow.com/users/848547/sivann"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528271254, "post_id": 50713893, "comment_id": 88438444, "body": "@volker just run the linked example with no brokers. It doesn&#39;t catch the errors like ALL_BROKERS_DOWN. It doesn&#39;t get any simpler than that. This is a question about a specific kafka library."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528273024, "post_id": 50713893, "comment_id": 88439472, "body": "Linkes code and examples are not appropriate on SO. If you have a question about code you should include it. If this is a problem with a certain product you should ask the vendor."}, {"owner": {"reputation": 1920, "user_id": 848547, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ea2a180c1dfdcd5a12176c633fa0ed2d?s=128&d=identicon&r=PG", "display_name": "sivann", "link": "https://stackoverflow.com/users/848547/sivann"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528274827, "post_id": 50713893, "comment_id": 88440544, "body": "@Volker  No need to get hostlie because the question is not coding 101. No code links? Ask the vendor? Really? Anyway no point in continuing discussion."}, {"owner": {"reputation": 124, "user_id": 1494073, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c234e7a38d57a07c30e26cd667a915a?s=128&d=identicon&r=PG", "display_name": "Brain Monkey", "link": "https://stackoverflow.com/users/1494073/brain-monkey"}, "edited": false, "score": 0, "creation_date": 1535063419, "post_id": 50713893, "comment_id": 90939779, "body": "@sivann Did you ever figure this out. I am also using the trying to capture errors from confluent-kafka-go such as timeout to attempt to reconnect"}], "answers": [{"tags": [], "owner": {"reputation": 1920, "user_id": 848547, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ea2a180c1dfdcd5a12176c633fa0ed2d?s=128&d=identicon&r=PG", "display_name": "sivann", "link": "https://stackoverflow.com/users/848547/sivann"}, "is_accepted": true, "score": 0, "last_activity_date": 1535444071, "creation_date": 1535444071, "answer_id": 52053123, "question_id": 50713893, "link": "https://stackoverflow.com/questions/50713893/how-to-get-events-for-kafka-broker-errors-using-confluent-kafka-go/52053123#52053123", "title": "How to get events for kafka broker errors using confluent-kafka-go", "body": "<p>It seems there was no way to receive the errors, I have opened an issue and the fix  will be released soon in v0.11.5:</p>\n\n<p><a href=\"https://github.com/confluentinc/confluent-kafka-go/issues/200\" rel=\"nofollow noreferrer\">https://github.com/confluentinc/confluent-kafka-go/issues/200</a></p>\n"}], "owner": {"reputation": 1920, "user_id": 848547, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ea2a180c1dfdcd5a12176c633fa0ed2d?s=128&d=identicon&r=PG", "display_name": "sivann", "link": "https://stackoverflow.com/users/848547/sivann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 806, "favorite_count": 0, "accepted_answer_id": 52053123, "answer_count": 1, "score": 3, "last_activity_date": 1535444071, "creation_date": 1528267768, "last_edit_date": 1528352837, "question_id": 50713893, "link": "https://stackoverflow.com/questions/50713893/how-to-get-events-for-kafka-broker-errors-using-confluent-kafka-go", "title": "How to get events for kafka broker errors using confluent-kafka-go", "body": "<p>I'm writing a producer in go, using the <a href=\"https://github.com/confluentinc/confluent-kafka-go/blob/master/examples/producer_channel_example/producer_channel_example.go\" rel=\"nofollow noreferrer\">channel producer example</a> of confluent-kafka-go library. When I run my app with brokers working then I get the produced events by reading from  <code>range producer.Events()</code> .</p>\n\n<p>But when the brokers are down, I get  logs like the following from the kafka library printed in stderr, but I cannot find a way for my app to register for those errors so I can detect them:</p>\n\n<pre><code>%3|1528267290.204|FAIL|rdkafka#producer-1| [thrd:xxx.xxx.com:9092/bootstrap]: xxx.xxx.com:9092/bootstrap: Connect to ipv4#xxx.xxx.xxx.xxx:9092 failed: Connection refused\n%3|1528267290.204|ERROR|rdkafka#producer-1| [thrd:xxx.xxx.com:9092/bootstrap]: 1/1 brokers are down\n</code></pre>\n\n<p>How can I receive those events from the library ? To clarify I'm interested in errors like RD_KAFKA_RESP_ERR__FAIL  described in the <a href=\"https://godoc.org/github.com/confluentinc/confluent-kafka-go/kafka\" rel=\"nofollow noreferrer\">docs</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1528267951, "post_id": 50713681, "comment_id": 88436516, "body": "<a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">blog.golang.org/go-slices-usage-and-internals</a>"}, {"owner": {"reputation": 440, "user_id": 2594180, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/maj12.jpg?s=128&g=1", "display_name": "shawn", "link": "https://stackoverflow.com/users/2594180/shawn"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528269422, "post_id": 50713681, "comment_id": 88437399, "body": "@mkopriva Slice internals parts can answer my questions very well. 1. slice is a descriptor of an array segment. 2. The capacity is the number of elements in the underlying array (beginning at the element referred to by the slice pointer). Thanks"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1528285681, "post_id": 50713681, "comment_id": 88447608, "body": "It is explained to an extent <a href=\"https://tour.golang.org/moretypes/8\" rel=\"nofollow noreferrer\">a couple pages early in the Tour</a>. Slicing and re-slicing still leave you with the same underlying array, and the values in that array have not changed, so there is no reason to expect the values in the slice (which is just a view of that array) to change."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1528285579, "post_id": 50714202, "comment_id": 88447543, "body": "This answer is a little misleading - the pointer address changes because the start index changed, but it still points at the same underlying array the entire time."}, {"owner": {"reputation": 21865, "user_id": 350613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bded62396ea66c84bd10e91c718dea9?s=128&d=identicon&r=PG", "display_name": "Robin Moffatt", "link": "https://stackoverflow.com/users/350613/robin-moffatt"}, "edited": false, "score": 0, "creation_date": 1593072107, "post_id": 50714202, "comment_id": 110652489, "body": "When I run the same code snippet I get a different <code>ptr</code> address for <i>each</i> step (not just the final one as shown in the answer). Why would that be? <a href=\"https://gist.github.com/rmoff/bdf119be932186fca146b899d3b9f505\" rel=\"nofollow noreferrer\">gist.github.com/rmoff/bdf119be932186fca146b899d3b9f505</a>"}], "tags": [], "owner": {"reputation": 602, "user_id": 6638523, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lb7L5.jpg?s=128&g=1", "display_name": "Xian Shu", "link": "https://stackoverflow.com/users/6638523/xian-shu"}, "is_accepted": true, "score": 3, "last_activity_date": 1528286859, "last_edit_date": 1528286859, "creation_date": 1528268917, "answer_id": 50714202, "question_id": 50713681, "link": "https://stackoverflow.com/questions/50713681/extend-the-length-and-keep-the-value/50714202#50714202", "title": "Extend the length and keep the value", "body": "<p>Because the first time extending does not change the slice's pointer address. So <code>s</code> also points to the <code>[2 3 5 7 11 13]</code> address.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nfunc main() {\n    s := []int{2, 3, 5, 7, 11, 13}\n    printSlice(s)\n\n    // Slice the slice to give it zero length.\n    s = s[:0]\n    printSlice(s)\n\n    // Extend its length.\n    s = s[:4]\n    printSlice(s)\n\n    // Drop its first two values.\n    s = s[2:]\n    printSlice(s)\n}\n\nfunc printSlice(s []int) {\n    fmt.Printf(\"len=%d cap=%d %v array ptr: %v \\n\", len(s), cap(s), s,(*unsafe.Pointer)(unsafe.Pointer(&amp;s)))\n}\n</code></pre>\n\n<p>the terminal shows:</p>\n\n<pre><code>len=6 cap=6 [2 3 5 7 11 13] array ptr: 0xc04200a2a0\nlen=0 cap=6 [] array ptr: 0xc04200a2a0\nlen=4 cap=6 [2 3 5 7] array ptr: 0xc04200a2a0\nlen=2 cap=4 [5 7] array ptr: 0xc04200a2b0\n</code></pre>\n\n<p>you see, the third step changes the <code>ptr</code> address because of first item is changed. so you know...</p>\n"}], "owner": {"reputation": 440, "user_id": 2594180, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/maj12.jpg?s=128&g=1", "display_name": "shawn", "link": "https://stackoverflow.com/users/2594180/shawn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 1, "accepted_answer_id": 50714202, "answer_count": 1, "score": 1, "last_activity_date": 1528286859, "creation_date": 1528266959, "question_id": 50713681, "link": "https://stackoverflow.com/questions/50713681/extend-the-length-and-keep-the-value", "title": "Extend the length and keep the value", "body": "<p>I follow the tour of Go to learning GOLANG.</p>\n\n<p>And  I have a question at this step: <a href=\"https://tour.golang.org/moretypes/11\" rel=\"nofollow noreferrer\">https://tour.golang.org/moretypes/11</a></p>\n\n<pre><code>  package main\n\n  import \"fmt\"\n\n  func main() {\n    s := []int{2, 3, 5, 7, 11, 13}\n    printSlice(s)\n\n    // Step1 Slice the slice to give it zero length.\n    s = s[:0]\n    printSlice(s)\n\n    // Step2 Extend its length.\n    // Why after extend the length of the slice, the value in this slice is still  [2 3 5 7]\n    s = s[:4]\n    printSlice(s)\n\n    // Step 3 Drop its first two values.\n    s = s[2:]\n    printSlice(s)\n  }\n\n  func printSlice(s []int) {\n    fmt.Printf(\"len=%d cap=%d %v\\n\", len(s), cap(s), s)\n  }\n</code></pre>\n\n<p>The output:</p>\n\n<pre><code>len=6 cap=6 [2 3 5 7 11 13]\nlen=0 cap=6 []\nlen=4 cap=6 [2 3 5 7]\nlen=2 cap=4 [5 7]\n</code></pre>\n\n<p>Why after extending the length of the slice at the second step, the value in this slice is still [2 3 5 7]? I think the value in this slice is [0 0 0 0] because I have sliced the origin slice at the first step.</p>\n\n<p>And I have another question is that why the third step can change the capacity of the slice but the first second cannot.</p>\n"}, {"tags": ["go", "gcc", "cygwin"], "answers": [{"comments": [{"owner": {"reputation": 530, "user_id": 2394541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f9b9b9399b329591f7be92da1c5e442?s=128&d=identicon&r=PG", "display_name": "tim18", "link": "https://stackoverflow.com/users/2394541/tim18"}, "edited": false, "score": 0, "creation_date": 1528288042, "post_id": 50712950, "comment_id": 88449216, "body": "If go could be compiled for Windows, it is likely to be easier in cygwin than in mingw.  Conversely, if it builds in mingw without extra patches, it should be relatively easy in cygwin.  You can confirm it isn&#39;t included in cygwin by its absence from --enable-languages in &#39;gcc -v&#39;"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 530, "user_id": 2394541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f9b9b9399b329591f7be92da1c5e442?s=128&d=identicon&r=PG", "display_name": "tim18", "link": "https://stackoverflow.com/users/2394541/tim18"}, "edited": false, "score": 0, "creation_date": 1528292210, "post_id": 50712950, "comment_id": 88452043, "body": "@tim18: &quot;If go could be compiled for Windows.&quot; Go is compiled for Windows."}], "tags": [], "owner": {"reputation": 6281, "user_id": 5105383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2YCB5.jpg?s=128&g=1", "display_name": "matzeri", "link": "https://stackoverflow.com/users/5105383/matzeri"}, "is_accepted": false, "score": -1, "last_activity_date": 1528263824, "creation_date": 1528263824, "answer_id": 50712950, "question_id": 50712718, "link": "https://stackoverflow.com/questions/50712718/how-to-install-gcc-for-go-on-windows-10/50712950#50712950", "title": "How to install GCC for Go on Windows 10?", "body": "<p>Cygwin setup as default installs only a minimal set of packages, the core ones.\nIf you need additional one as a compiler you need to specifically require it</p>\n\n<p><a href=\"https://cygwin.com/cygwin-ug-net/setup-net.html#setup-packages\" rel=\"nofollow noreferrer\">https://cygwin.com/cygwin-ug-net/setup-net.html#setup-packages</a></p>\n\n<p>In your case as <code>go</code> is unlikey a cygwin program, you can not use the cygwin compiler to extend your <code>go</code> language. You could try the <code>mingw64</code> project</p>\n\n<p><a href=\"https://mingw-w64.org/\" rel=\"nofollow noreferrer\">https://mingw-w64.org/</a></p>\n"}, {"comments": [{"owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "edited": false, "score": 0, "creation_date": 1533824252, "post_id": 50724939, "comment_id": 90497387, "body": "If you&#39;re using an IDE like VS Code, it want&#39;s to have gcc in the path so it can give better error reporting while you&#39;re writing code, which is super useful even if you&#39;re only really compiling in the subsystem like I do"}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": false, "score": -1, "last_activity_date": 1528301308, "creation_date": 1528301308, "answer_id": 50724939, "question_id": 50712718, "link": "https://stackoverflow.com/questions/50712718/how-to-install-gcc-for-go-on-windows-10/50724939#50724939", "title": "How to install GCC for Go on Windows 10?", "body": "<p>First I would ask you if you are developing on windows or if you are only trying to compile your code for windows.</p>\n\n<p>If you are developing on windows I strongly suggest installing the \"Windows Subsystem for Linux\" and running go in there. This will make your live a lot easier when it comes to running/compiling cgo stuff.\nNote: Installing mingw is the alternative but that will make your hair go grey.</p>\n\n<p>If you need to compile for windows (windows is your target system) then I suggest using <a href=\"https://github.com/karalabe/xgo\" rel=\"nofollow noreferrer\">xgo</a>. It uses docker containers to compile to many different OS' in a single command.</p>\n\n<p>Summary:\nYou can easily compile for windows without cgo, but when cgo is involved use unix for development and xgo for build (automation).</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1594734"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 6990, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1528301308, "creation_date": 1528262370, "question_id": 50712718, "link": "https://stackoverflow.com/questions/50712718/how-to-install-gcc-for-go-on-windows-10", "title": "How to install GCC for Go on Windows 10?", "body": "<p>I want to use external library on Go programming language and i am using this command for instance :</p>\n\n<pre><code>go get github.com/alecthomas/gozmq\n</code></pre>\n\n<p>from command line, but it gives such an error:</p>\n\n<p>github.com/pebbe/zmq4\nexec: \"gcc\": executable file not found in %PATH%</p>\n\n<p>i tried to install Cygwin, but it doesn't fixed the error</p>\n"}, {"tags": ["debugging", "go", "profile"], "comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 1, "creation_date": 1528261251, "post_id": 50712292, "comment_id": 88433888, "body": "Consider interacting with the provider (or author) of that Go program, and give him some bug report"}, {"owner": {"reputation": 2371, "user_id": 4140668, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/50c0905a6e33a9fa6f7e050c09ed1277?s=128&d=identicon&r=PG", "display_name": "lz96", "link": "https://stackoverflow.com/users/4140668/lz96"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1528263586, "post_id": 50712292, "comment_id": 88434628, "body": "@BasileStarynkevitch Unfortunately the source code is already lost due to power outage :("}, {"owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "edited": false, "score": 2, "creation_date": 1528265663, "post_id": 50712292, "comment_id": 88435411, "body": "My hard disks keep their state on power outage. Forget this project, start a new one, life is short"}, {"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 2, "creation_date": 1528267519, "post_id": 50712292, "comment_id": 88436253, "body": "For your next programming project, use some <a href=\"https://en.wikipedia.org/wiki/Version_control\" rel=\"nofollow noreferrer\">version control</a> system like <a href=\"http://git-scm.com/\" rel=\"nofollow noreferrer\">git</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1528285262, "post_id": 50712292, "comment_id": 88447346, "body": "Memory pressure will cause GC to run anyway, and it generally runs pretty frequently with an active program. If you&#39;re seeing a lot of memory usage, it&#39;s either because a) the program is actually using the memory, so it can&#39;t be freed by GC, or b) the program has run GC already and freed the memory, but the OS hasn&#39;t seen the need to reclaim it."}], "answers": [{"comments": [{"owner": {"reputation": 2371, "user_id": 4140668, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/50c0905a6e33a9fa6f7e050c09ed1277?s=128&d=identicon&r=PG", "display_name": "lz96", "link": "https://stackoverflow.com/users/4140668/lz96"}, "edited": false, "score": 0, "creation_date": 1528263522, "post_id": 50712414, "comment_id": 88434603, "body": "What about hacking by creating a user-land thread sharing the same memory/fd space running <code>runtime.GC()</code>? Is it feasible?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 2371, "user_id": 4140668, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/50c0905a6e33a9fa6f7e050c09ed1277?s=128&d=identicon&r=PG", "display_name": "lz96", "link": "https://stackoverflow.com/users/4140668/lz96"}, "edited": false, "score": 0, "creation_date": 1528263813, "post_id": 50712414, "comment_id": 88434698, "body": "Not sure (I haven&#39;t tested it). Even articles like <a href=\"https://medium.com/samsara-engineering/running-go-on-low-memory-devices-536e1ca2fe8f\" rel=\"nofollow noreferrer\">medium.com/samsara-engineering/&hellip;</a> or thread like <a href=\"https://www.reddit.com/r/golang/comments/6zqk1v/any_recommendation_for_golang_gc_tuning_resources/\" rel=\"nofollow noreferrer\">reddit.com/r/golang/comments/6zqk1v/&hellip;</a> need the program sources to debug anything."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1528260843, "last_edit_date": 1528260843, "creation_date": 1528260431, "answer_id": 50712414, "question_id": 50712292, "link": "https://stackoverflow.com/questions/50712292/invoke-runtime-gc-memprofile-without-modifying-source-code/50712414#50712414", "title": "Invoke runtime.GC()/memprofile without modifying source code", "body": "<p>I don't think so.</p>\n\n<p>Even reacting to a signal (like SIGQUIT) would require to code it, as <a href=\"https://stackoverflow.com/a/27398062/6309\">seen here</a>.</p>\n\n<p>With only the executable (no <code>.a</code>, no sources), you would <a href=\"https://stackoverflow.com/a/50574158/6309\">only have <code>go tool objdump</code></a>.</p>\n"}], "owner": {"reputation": 2371, "user_id": 4140668, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/50c0905a6e33a9fa6f7e050c09ed1277?s=128&d=identicon&r=PG", "display_name": "lz96", "link": "https://stackoverflow.com/users/4140668/lz96"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 1, "answer_count": 1, "score": -4, "last_activity_date": 1528260843, "creation_date": 1528259565, "question_id": 50712292, "link": "https://stackoverflow.com/questions/50712292/invoke-runtime-gc-memprofile-without-modifying-source-code", "title": "Invoke runtime.GC()/memprofile without modifying source code", "body": "<p>I have a compiled Go program, which sometimes occupies large amount of memory. Unfortunately, I don't have its source code, so it is impossible to modify it to add a <code>runtime/pprof</code> server. I was wondering is there any way to invoke <code>runtime.GC()</code> or generate a heap dump without modifying the source code?</p>\n"}, {"tags": ["go", "vim", "iterm2", "tui"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1528262178, "post_id": 50711439, "comment_id": 88434194, "body": "Sounds like you&#39;re looking for <a href=\"https://github.com/tmux/tmux\" rel=\"nofollow noreferrer\">tmux</a>."}, {"owner": {"reputation": 39, "user_id": 9411050, "user_type": "registered", "profile_image": "https://graph.facebook.com/563449257348698/picture?type=large", "display_name": "kthatoto", "link": "https://stackoverflow.com/users/9411050/kthatoto"}, "edited": false, "score": 0, "creation_date": 1528266806, "post_id": 50711439, "comment_id": 88435910, "body": "I tried this   1. <code>:vsplit</code> in vim   2. <code>:terminal</code> on one screen   3. Run go program. In this case, I think go is running on vim.   But I want to run vim on go."}, {"owner": {"reputation": 39, "user_id": 9411050, "user_type": "registered", "profile_image": "https://graph.facebook.com/563449257348698/picture?type=large", "display_name": "kthatoto", "link": "https://stackoverflow.com/users/9411050/kthatoto"}, "edited": false, "score": 0, "creation_date": 1528268742, "post_id": 50711439, "comment_id": 88437020, "body": "If I use tmux, it will be I use tmux before running go app. I want to start with running go app and running vim on this go app."}], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 9411050, "user_type": "registered", "profile_image": "https://graph.facebook.com/563449257348698/picture?type=large", "display_name": "kthatoto", "link": "https://stackoverflow.com/users/9411050/kthatoto"}, "edited": false, "score": 0, "creation_date": 1528957438, "post_id": 50849495, "comment_id": 88704391, "body": "Thank you for your great advice!! I won&#39;t support advanced functionality, so I&#39;ll try to use the libraries."}, {"owner": {"reputation": 170455, "user_id": 149341, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/omfTQ.png?s=128&g=1", "display_name": "duskwuff -inactive-", "link": "https://stackoverflow.com/users/149341/duskwuff-inactive"}, "reply_to_user": {"reputation": 39, "user_id": 9411050, "user_type": "registered", "profile_image": "https://graph.facebook.com/563449257348698/picture?type=large", "display_name": "kthatoto", "link": "https://stackoverflow.com/users/9411050/kthatoto"}, "edited": false, "score": 0, "creation_date": 1528961954, "post_id": 50849495, "comment_id": 88706762, "body": "Don&#39;t expect it to be easy. This embedding is likely to remain the single largest source of complexity in your application, especially if you need to interface libvterm (which is a C library) to a Go application. Anything else you are doing will pale in comparison."}], "tags": [], "owner": {"reputation": 170455, "user_id": 149341, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/omfTQ.png?s=128&g=1", "display_name": "duskwuff -inactive-", "link": "https://stackoverflow.com/users/149341/duskwuff-inactive"}, "is_accepted": false, "score": 0, "last_activity_date": 1528949479, "creation_date": 1528949479, "answer_id": 50849495, "question_id": 50711439, "link": "https://stackoverflow.com/questions/50711439/how-to-use-vim-in-a-part-of-terminal-with-go/50849495#50849495", "title": "How to use Vim in a part of Terminal with Go", "body": "<p>What you're trying to do is inordinately difficult to do, and I would advise against it.</p>\n\n<p>The only way to embed a terminal application like you're describing is to essentially implement a terminal emulator within your application and display its output within your application. There are libraries which can make this easier -- like <a href=\"http://www.leonerd.org.uk/code/libvterm/\" rel=\"nofollow noreferrer\">libvterm</a>, which vim uses to implement the <code>:terminal</code> command -- but even so, doing this will be difficult, particularly if you want to support advanced terminal functionality in the embedded editor (like mouse support).</p>\n\n<p>A more common idiom for making an editor available in a terminal application is to launch the editor as a subprocess on demand, allowing it to \"take over\" the entire terminal while a file is being edited. Once the editor exits, your application can resume.</p>\n"}], "owner": {"reputation": 39, "user_id": 9411050, "user_type": "registered", "profile_image": "https://graph.facebook.com/563449257348698/picture?type=large", "display_name": "kthatoto", "link": "https://stackoverflow.com/users/9411050/kthatoto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 156, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1528949479, "creation_date": 1528252046, "last_edit_date": 1528265345, "question_id": 50711439, "link": "https://stackoverflow.com/questions/50711439/how-to-use-vim-in-a-part-of-terminal-with-go", "title": "How to use Vim in a part of Terminal with Go", "body": "<p>I'm trying to create TUI app with Go.<br>\nI'll make this app like dashboard.<br>\nAnd I want to use Vim as a part of Terminal(iTerm2) screen.  </p>\n\n<p><img src=\"https://i.stack.imgur.com/7u8di.png\" alt=\"1\"></p>\n\n<p>And I want to use local vim env(NeoVim, Local vimrc and plugins).</p>\n\n<p>How do I use local vim with go?<br>\nOr are there go libraries to use local vim?</p>\n\n<p>My English isn't so good so feel free to ask me if there is anything unclear.<br>\nThank you.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1528263486, "creation_date": 1528263486, "answer_id": 50712891, "question_id": 50711414, "link": "https://stackoverflow.com/questions/50711414/go-readstring-issues-the-filename-directory-name-or-volume-label-syntax-is-in/50712891#50712891", "title": "Go ReadString issues: The filename, directory name, or volume label syntax is incorrect", "body": "<p>Start with basic debugging techniques: check for errors and check input.</p>\n\n<hr>\n\n<p>Replace </p>\n\n<pre><code>text, _ := reader.ReadString('\\n')\n</code></pre>\n\n<p>with </p>\n\n<pre><code>text, err := reader.ReadString('\\n')\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Printf(\"%q\\n\", text)\n</code></pre>\n\n<p>For example,</p>\n\n<p><code>so1.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"strings\"\n    //\"io/ioutil\"\n    \"os\"\n)\n\nfunc main() {\n    fmt.Print(\"Enter filename to create: \")\n\n    reader := bufio.NewReader(os.Stdin)\n\n    text, err := reader.ReadString('\\n')\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"%q\\n\", text)\n\n    text = strings.TrimSuffix(text, \"\\n\")\n\n    if len(text) &gt; 3 {\n        //newFile, err := os.Create(text)\n        fmt.Println(\"Name:\" + text)\n        createFile(text)\n    } else {\n        fmt.Println(\"invalid filename\")\n    }\n\n}\n\nfunc createFile(fileName string) {\n    var newFile *os.File\n    var err error\n\n    fmt.Println(fileName)\n\n    newFile, err = os.Create(fileName)\n    if err != nil {\n        log.Fatal(err)\n    }\n    newFile.Close()\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>&gt;go run so1.go\nEnter filename to create: test.file\n\"test.file\\r\\n\"\nName:test.file\ntest.file\n: The filename, directory name, or volume label syntax is incorrect.\nexit status 1\n</code></pre>\n\n<p>On Windows, the line is terminated with \"<code>\\r\\n</code>\".</p>\n\n<hr>\n\n<p>Replace </p>\n\n<pre><code>text = strings.TrimSuffix(text, \"\\n\")\n</code></pre>\n\n<p>with</p>\n\n<pre><code>text = strings.TrimSuffix(text, \"\\n\")\ntext = strings.TrimSuffix(text, \"\\r\")\n</code></pre>\n\n<p>For example,</p>\n\n<p><code>so2.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"strings\"\n    //\"io/ioutil\"\n    \"os\"\n)\n\nfunc main() {\n    fmt.Print(\"Enter filename to create: \")\n\n    reader := bufio.NewReader(os.Stdin)\n\n    text, err := reader.ReadString('\\n')\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"%q\\n\", text)\n\n    text = strings.TrimSuffix(text, \"\\n\")\n    text = strings.TrimSuffix(text, \"\\r\")\n\n    if len(text) &gt; 3 {\n        //newFile, err := os.Create(text)\n        fmt.Println(\"Name:\" + text)\n        createFile(text)\n    } else {\n        fmt.Println(\"invalid filename\")\n    }\n\n}\n\nfunc createFile(fileName string) {\n    var newFile *os.File\n    var err error\n\n    fmt.Println(fileName)\n\n    newFile, err = os.Create(fileName)\n    if err != nil {\n        log.Fatal(err)\n    }\n    newFile.Close()\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>&gt;go run so2.go\nEnter filename to create: test.file\n\"test.file\\r\\n\"\nName:test.file\ntest.file\n</code></pre>\n\n<hr>\n\n<p>Now that the program works, remove this debugging statement:</p>\n\n<pre><code>fmt.Printf(\"%q\\n\", text)\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 9900753, "user_type": "registered", "profile_image": "https://graph.facebook.com/1585785942/picture?type=large", "display_name": "user9900753", "link": "https://stackoverflow.com/users/9900753/user9900753"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2238, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1552317988, "creation_date": 1528251845, "last_edit_date": 1552317988, "question_id": 50711414, "link": "https://stackoverflow.com/questions/50711414/go-readstring-issues-the-filename-directory-name-or-volume-label-syntax-is-in", "title": "Go ReadString issues: The filename, directory name, or volume label syntax is incorrect", "body": "<p>can anyone figure this out? I think the problem might be in the readstring() argument when being passed to the create file function. I tried resolving it by stripping '\\n' but the error remains. Is there a workaround other than readstring()? Because I think it's the one causing issues. Thank you </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"bufio\"\n    \"log\"\n    \"strings\"\n    //\"io/ioutil\"\n    \"os\"\n)\n\nfunc main() {\n    fmt.Print(\"Enter filename to create: \")\n\n    reader := bufio.NewReader(os.Stdin)\n\n    text, _ := reader.ReadString('\\n')\n    text = strings.TrimSuffix(text, \"\\n\")\n\n\n    if len(text) &gt; 3 {\n        //newFile, err := os.Create(text)\n        fmt.Println(\"Name:\"+text)\n        createFile(text)\n    } else {\n        fmt.Println(\"invalid filename\")\n    }\n\n}\n\nfunc createFile(fileName string){\n    var newFile *os.File\n    var err error\n\n\n    fmt.Println(fileName)\n\n    newFile, err = os.Create(fileName)\n    if err != nil {\n        log.Fatal(err)\n    }\n    newFile.Close()\n}\n</code></pre>\n\n<hr>\n\n<p>Ok for those who are new to this problem, I've manage to find a workaround using scanf. So consider this problem solved. </p>\n"}, {"tags": ["json", "go", "interface", "unmarshalling"], "comments": [{"owner": {"reputation": 310996, "user_id": 908494, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7e41acaa8f6a0e0f5a7c645e93add55a?s=128&d=identicon&r=PG", "display_name": "abarnert", "link": "https://stackoverflow.com/users/908494/abarnert"}, "edited": false, "score": 0, "creation_date": 1528247782, "post_id": 50710160, "comment_id": 88430912, "body": "The actual value behind the <code>interface{}</code> is a <code>map[string]interface{}</code>, not a <code>Table</code>, so you can&#39;t cast it, type assertion or not. Meanwhile, consider how you&#39;d write realistic code if this <i>did</i> work\u2014for each <code>object</code> in <code>h.objects</code>, you&#39;d have to type-assert the <code>object</code> to a <code>map[string]interface{}</code>, access its <code>ObjectType</code> field, type assert that to string, then use a switch statement to decide which type to unmarshal to, which is not going to be significantly prettier, or more type-safe, than just staying with the non-typed decoding and manually pulling out the strings."}, {"owner": {"reputation": 310996, "user_id": 908494, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7e41acaa8f6a0e0f5a7c645e93add55a?s=128&d=identicon&r=PG", "display_name": "abarnert", "link": "https://stackoverflow.com/users/908494/abarnert"}, "edited": false, "score": 0, "creation_date": 1528248903, "post_id": 50710160, "comment_id": 88431116, "body": "Meanwhile, what you&#39;re really trying to do is unmarshaling JSON to sum types: a <code>House</code> contains an array of <code>Chair | Table</code> values. Which is something Go doesn&#39;t have any way to represent. In a different language, you&#39;d simulate it with inheritance, with duck typing, or with tagged unions and type switching; in Go, you need to halfway-simulate all three. <a href=\"https://medium.com/@haya14busa/sum-union-variant-type-in-go-and-static-check-tool-of-switch-case-handling-3bfc61618b1e\" rel=\"nofollow noreferrer\">This blog post</a> seems to cover most of the bases."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528258386, "post_id": 50710160, "comment_id": 88433110, "body": "Best advice: Do not do that. Write your own JSON unmarshaler which handles the conversion to the appropriate type."}, {"owner": {"reputation": 740, "user_id": 4488456, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4146daa51bdb93084db63bbf9b5d5c43?s=128&d=identicon&r=PG", "display_name": "jordan2175", "link": "https://stackoverflow.com/users/4488456/jordan2175"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528326211, "post_id": 50710160, "comment_id": 88469273, "body": "@Volker can you give an example of how to do that?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528342767, "post_id": 50710160, "comment_id": 88472964, "body": "<a href=\"https://golang.org/pkg/encoding/json/#example__customMarshalJSON\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#example__customMarshalJSON</a> Why is it so complicated to take a look at the official, complete, readable documentation which is full of examples. All you have to do is implement the other way around. You&#39;ll find tons of examples in the wild."}], "answers": [{"comments": [{"owner": {"reputation": 154, "user_id": 8913763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ICicn.jpg?s=128&g=1", "display_name": "VadimFilin", "link": "https://stackoverflow.com/users/8913763/vadimfilin"}, "edited": false, "score": 0, "creation_date": 1556293629, "post_id": 50710854, "comment_id": 98401955, "body": "Not an answer. What if it must be interface array?"}], "tags": [], "owner": {"reputation": 4567, "user_id": 1318734, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/S3JJ2.gif?s=128&g=1", "display_name": "rofls", "link": "https://stackoverflow.com/users/1318734/rofls"}, "is_accepted": false, "score": 1, "last_activity_date": 1528246564, "last_edit_date": 1592644375, "creation_date": 1528246564, "answer_id": 50710854, "question_id": 50710160, "link": "https://stackoverflow.com/questions/50710160/how-to-unmarshal-json-in-to-array-of-interface-and-use/50710854#50710854", "title": "How to unmarshal JSON in to array of interface and use", "body": "<p>I'm not sure if this is practical, since this is a simplified version of your scenario. However, one way to do this is combine the two object types to a new one, <code>Object</code>, and then unmarshal them directly to <code>Object</code> instead of using <code>interface{}</code>:</p>\n<pre><code>package main\n\nimport (\n    &quot;encoding/json&quot;\n    &quot;fmt&quot;\n)\n\ntype Object struct {\n    ObjectType string\n    ID         string\n    Brand      string\n    Location   string\n}\n\ntype House struct {\n    Name    string\n    Objects []Object\n}\n\nfunc returnJSONBlob() []byte {\n    s := []byte(`\n{\n  &quot;Name&quot;: &quot;house1&quot;,\n  &quot;Objects&quot;: [\n    {\n      &quot;ObjectType&quot;: &quot;chair&quot;,\n      &quot;ID&quot;: &quot;1234&quot;,\n      &quot;Brand&quot;: &quot;Blue Inc.&quot;\n    },\n    {\n      &quot;ObjectType&quot;: &quot;table&quot;,\n      &quot;ID&quot;: &quot;5678&quot;,\n      &quot;Location&quot;: &quot;Kitchen&quot;\n    }\n  ]\n}\n    `)\n    return s\n}\n\nfunc main() {\n    var h House\n    data := returnJSONBlob()\n    err := json.Unmarshal(data, &amp;h)\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(h.Objects[0].Brand)\n    fmt.Println(h.Objects[1].Location)\n\n}\n</code></pre>\n<p>Prints:</p>\n<blockquote>\n<p>Blue Inc.</p>\n<p>Kitchen</p>\n</blockquote>\n<p>Example here: <a href=\"https://play.golang.org/p/91F4UrQlSjJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/91F4UrQlSjJ</a></p>\n"}], "owner": {"reputation": 740, "user_id": 4488456, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4146daa51bdb93084db63bbf9b5d5c43?s=128&d=identicon&r=PG", "display_name": "jordan2175", "link": "https://stackoverflow.com/users/4488456/jordan2175"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2220, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1528246564, "creation_date": 1528240465, "question_id": 50710160, "link": "https://stackoverflow.com/questions/50710160/how-to-unmarshal-json-in-to-array-of-interface-and-use", "title": "How to unmarshal JSON in to array of interface and use", "body": "<p>I am having difficulty understanding how to correctly unmarshal some JSON data that goes in to an array of type inteface and then use it. I tried to make this example code as simple as possible to illustrate the problem I am having. The code can be found in the playground here: <a href=\"https://play.golang.org/p/U85J_lBJ7Zr\" rel=\"nofollow noreferrer\">https://play.golang.org/p/U85J_lBJ7Zr</a></p>\n\n<p>The output looks like:</p>\n\n<blockquote>\n  <p>[map[ObjectType:chair ID:1234 Brand:Blue Inc.] map[ID:5678\n  Location:Kitchen ObjectType:table]] {  } false {  } false</p>\n</blockquote>\n\n<p>Code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype Chair struct {\n    ObjectType string\n    ID string\n    Brand string\n}\n\ntype Table struct {\n    ObjectType string\n    ID string\n    Location string\n}\n\ntype House struct {\n    Name string\n    Objects []interface{}\n}\n\n\n\nfunc main() {\n    var h House\n    data := returnJSONBlob()\n    err := json.Unmarshal(data, &amp;h)\n    if err != nil {\n       fmt.Println(err)\n    }\n    fmt.Println(h.Objects)\n    s1, ok := h.Objects[0].(Table)\n    fmt.Println(s1, ok)\n    s2, ok := h.Objects[0].(Chair)\n    fmt.Println(s2, ok)\n\n}\n\nfunc returnJSONBlob() []byte {\n    s := []byte(`\n{\n  \"Name\": \"house1\",\n  \"Objects\": [\n    {\n      \"ObjectType\": \"chair\",\n      \"ID\": \"1234\",\n      \"Brand\": \"Blue Inc.\"\n    },\n    {\n      \"ObjectType\": \"table\",\n      \"ID\": \"5678\",\n      \"Location\": \"Kitchen\"\n    }\n  ]\n}\n    `)\n    return s\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1528238709, "post_id": 50709826, "comment_id": 88428900, "body": "If you have too many values to iterate over efficiently, then you need a different data structure. Go can&#39;t magically fix a <code>O(n^{2})</code> algorithm."}], "answers": [{"tags": [], "owner": {"reputation": 493, "user_id": 6111465, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/72fJG.png?s=128&g=1", "display_name": "gammazero", "link": "https://stackoverflow.com/users/6111465/gammazero"}, "is_accepted": true, "score": 2, "last_activity_date": 1528242197, "last_edit_date": 1528242197, "creation_date": 1528241803, "answer_id": 50710343, "question_id": 50709826, "link": "https://stackoverflow.com/questions/50709826/nested-loops-in-golang/50710343#50710343", "title": "Nested loops in golang", "body": "<p>One way you may be able to speed this up it is lookup items in the cart using a map, instead of iterating through them.  Create the map like this:</p>\n\n<pre><code>cartMap := make(map[string]*CartType, len(cartSession.Cart))\nfor i := range cartSession.Cart {\n    cartMap[cartSession.Cart[i].Name] = cartSession.Cart[i]\n}\n</code></pre>\n\n<p>Then after building the map, you can look in the cart to see if it contains the affected and affectee, like this:</p>\n\n<pre><code>for i := range promotions {\n    // See if affected item is in cart                                      \n    affected := promotions[i].Affected\n    cartItem, ok := cartMap[affected.Name]\n    if !ok {\n        // Did not find affected                                            \n        continue\n    }\n    // See if affectee is in cart                                           \n    affectee := promotions[i].Affectee\n    if _, ok = cartMap[affectee.Name]; !ok {\n        // Did not find affectee                                            \n        continue\n    }\n    // Apply promotion                                                      \n    if affected.CostPtg != 0 {\n        cartItem.Cost *= affected.CostPtg\n    } else {\n        cartItem.Cost = affected.CostFixed\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 3221, "user_id": 830230, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/YMFTp.jpg?s=128&g=1", "display_name": "Naguib Ihab", "link": "https://stackoverflow.com/users/830230/naguib-ihab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1856, "favorite_count": 1, "accepted_answer_id": 50710343, "answer_count": 1, "score": 0, "last_activity_date": 1528242197, "creation_date": 1528237779, "question_id": 50709826, "link": "https://stackoverflow.com/questions/50709826/nested-loops-in-golang", "title": "Nested loops in golang", "body": "<p>I have two arrays: Cart and Promotions, I need to find out what promotions can be applied to the cart.</p>\n\n<p>Promotions consist of Affectee and Affected, so what I do is search in my Cart array to see if I have any Affectee and if I do then I search for any Affected and then apply the promo. This however, forces me to implement three nested loops which is not ideal for an API that has a 3 second timeout.</p>\n\n<p>I'm wondering if golang's arrays has something or if there's a way I can make this faster</p>\n\n<p>Here's my code:</p>\n\n<pre><code>  OUTER:\n  for i, item := range cartSession.Cart {\n    for _, promo := range promotions {\n      if item.Name == promo.Affected.Name {\n        // If an item in the cart can be affected by the promo\n        // then start investigating if we have the affectee\n        if item.Name == promo.Affectee.Name {\n          // If the item is the affected and affectee\n          if promo.Affected.CostPtg != 0 {\n            cartSession.Cart[i].Cost *= promo.Affected.CostPtg\n          } else {\n            cartSession.Cart[i].Cost = promo.Affected.CostFixed\n          }\n          continue OUTER\n        } else {\n          for _, subItem := range cartSession.Cart {\n            if subItem.Name == promo.Affectee.Name {\n              // We have both the affected &amp; affectee\n              // time to apply the promo affect\n              if promo.Affected.CostPtg != 0 {\n                cartSession.Cart[i].Cost *= promo.Affected.CostPtg\n              } else {\n                cartSession.Cart[i].Cost = promo.Affected.CostFixed\n              }\n              continue OUTER\n            }\n          }\n        }\n      }\n    }\n  }\n</code></pre>\n"}, {"tags": ["go", "web3", "truffle", "go-ethereum"], "answers": [{"comments": [{"owner": {"reputation": 1275, "user_id": 3581006, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/Ja6DE.png?s=128&g=1", "display_name": "bergben", "link": "https://stackoverflow.com/users/3581006/bergben"}, "edited": false, "score": 0, "creation_date": 1528232808, "post_id": 50708643, "comment_id": 88426953, "body": "Thank you for that idea. Unfortunately it prints 0 for votes. I was guessing that it is because of the DTO Struct. The ToString() sets res to 0x0. Neither of the structs values makes sense to be 12345 as the smart contract function would return..."}], "tags": [], "owner": {"reputation": 5800, "user_id": 6163736, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/TKHBG.jpg?s=128&g=1", "display_name": "stacksonstacks", "link": "https://stackoverflow.com/users/6163736/stacksonstacks"}, "is_accepted": false, "score": 0, "last_activity_date": 1528231417, "creation_date": 1528231417, "answer_id": 50708643, "question_id": 50708257, "link": "https://stackoverflow.com/questions/50708257/truffle-with-golang-web3/50708643#50708643", "title": "Truffle with Golang Web3", "body": "<p>The client library returns a <a href=\"https://github.com/regcostajr/go-web3/blob/master/dto/request-result.go#L35\" rel=\"nofollow noreferrer\">DTO struct</a> which is why you can see a bunch of fields printed in the output.</p>\n\n<p>Looks like the <code>ToInt()</code> receiver tries to cast to <code>int64</code> whereas your contract returns <code>unint32</code>. Try casting the result to <code>unint32</code> explicitly.  </p>\n\n<pre><code>if result != nil &amp;&amp; err == nil {\n    res := result.ToString()\n    votes, err := strconv.ParseUint(res, 10, 32)\n    if err != nil {\n        // do something with error\n    }\n    fmt.Printf(\"result: %d\\n\", votes)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 26, "user_id": 7740726, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11e3c7c0ca51148f31ba05163c6582bf?s=128&d=identicon&r=PG&f=1", "display_name": "Reginaldo Costa", "link": "https://stackoverflow.com/users/7740726/reginaldo-costa"}, "is_accepted": true, "score": 1, "last_activity_date": 1528264059, "creation_date": 1528264059, "answer_id": 50712988, "question_id": 50708257, "link": "https://stackoverflow.com/questions/50708257/truffle-with-golang-web3/50712988#50712988", "title": "Truffle with Golang Web3", "body": "<p>You are not setting the contract address in your go file: <a href=\"https://github.com/regcostajr/go-web3/blob/master/test/eth/eth-contract_test.go#L75\" rel=\"nofollow noreferrer\">https://github.com/regcostajr/go-web3/blob/master/test/eth/eth-contract_test.go#L75</a></p>\n"}], "owner": {"reputation": 1275, "user_id": 3581006, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/Ja6DE.png?s=128&g=1", "display_name": "bergben", "link": "https://stackoverflow.com/users/3581006/bergben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 875, "favorite_count": 0, "accepted_answer_id": 50712988, "answer_count": 2, "score": 0, "last_activity_date": 1528264059, "creation_date": 1528229706, "last_edit_date": 1528230242, "question_id": 50708257, "link": "https://stackoverflow.com/questions/50708257/truffle-with-golang-web3", "title": "Truffle with Golang Web3", "body": "<p>I am using <a href=\"https://github.com/regcostajr/go-web3\" rel=\"nofollow noreferrer\">this Ethereum Go Client</a> and trying to call and get the response of a Smart Contract function.</p>\n\n<p>The function in the smart contract is very simple (for testing now): </p>\n\n<pre><code>  function getVotesForImgIds() external view returns(uint32){\n    return 12345;\n  }\n</code></pre>\n\n<p>I am using truffle to deploy the contract: </p>\n\n<pre><code>truffle compile\ntruffle migrate\n</code></pre>\n\n<p>My Go server is very basic too, here is the important part in the main func: </p>\n\n<pre><code>abi := getVotesContractJson()[\"abi\"] //works fine\n\njsonAbi, err := json.Marshal(abi)\nif err != nil {\n    log.Fatal(err)\n}\n\nvar connection = web3.NewWeb3(providers.NewHTTPProvider(\"127.0.0.1:8545\", 10, false))\ncontract, err := connection.Eth.NewContract(string(jsonAbi))\nif err != nil {\n    log.Fatal(err)\n}\n//contract works\n\ntransaction := new(dto.TransactionParameters)\ntransaction.Gas = big.NewInt(4000000)\n\nresult, err := contract.Call(transaction, \"getVotesForImgIds\")\nif result != nil &amp;&amp; err == nil {\n    fmt.Println(\"result: \", result)\n    // --------------------&gt;\n    //this will print: result:  &amp;{87 2.0 0x0 &lt;nil&gt; }\n} else {\n    log.Fatal(\"call error:\", err)\n}\n</code></pre>\n\n<p>Why does this result in <code>&amp;{87 2.0 0x0 &lt;nil&gt; }</code> ? How can I get the real value returned by the smart contract? I tried all the result.ToInt() etc. already... </p>\n"}, {"tags": ["docker", "go"], "answers": [{"comments": [{"owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "edited": false, "score": 0, "creation_date": 1528232371, "post_id": 50708472, "comment_id": 88426752, "body": "Thanks and if I want to use the latest alpine , is there a way to use someting else instead go-wrapper to make it work?"}, {"owner": {"reputation": 2620, "user_id": 6489829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a56125658a5592143ade081194b89d6f?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Gore", "link": "https://stackoverflow.com/users/6489829/jack-gore"}, "reply_to_user": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "edited": false, "score": 0, "creation_date": 1528232732, "post_id": 50708472, "comment_id": 88426915, "body": "You should either manually <code>go get</code> your dependencies yourself and then  <code>go install</code> or use a package manager like <a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">dep</a> or <a href=\"https://github.com/Masterminds/glide\" rel=\"nofollow noreferrer\">glide</a> to install the dependencies for you."}], "tags": [], "owner": {"reputation": 2620, "user_id": 6489829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a56125658a5592143ade081194b89d6f?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Gore", "link": "https://stackoverflow.com/users/6489829/jack-gore"}, "is_accepted": true, "score": 6, "last_activity_date": 1528230599, "creation_date": 1528230599, "answer_id": 50708472, "question_id": 50707946, "link": "https://stackoverflow.com/questions/50707946/docker-for-golang-application/50708472#50708472", "title": "Docker for golang application", "body": "<p><code>go-wrapper</code> has been deprecated and removed from the images using <code>go</code> version 10 and above. See <a href=\"https://github.com/docker-library/golang/pull/205\" rel=\"noreferrer\">here</a>. </p>\n\n<p>If you are fine using <code>go v1.9</code> you can use the following image: <code>golang:1.9.6-alpine3.7</code>.</p>\n\n<p>So your <code>Dockerfile</code> will be:</p>\n\n<pre><code>FROM golang:1.9.6-alpine3.7\nWORKDIR /go/src/app\nCOPY . .\nRUN apk add --no-cache git\nRUN go-wrapper download   # \"go get -d -v ./...\"\nRUN go-wrapper install    # \"go install -v ./...\"\n\n#final stage\nFROM alpine:latest\nRUN apk --no-cache add ca-certificates\nCOPY --from=builder /go/bin/app /app\nENTRYPOINT ./app\nLABEL Name=cloud-native-go Version=0.0.1\nEXPOSE 3000\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 12417447, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/006a2e5c1714a03189c07dd546e542dd?s=128&d=identicon&r=PG&f=1", "display_name": "Nilo", "link": "https://stackoverflow.com/users/12417447/nilo"}, "is_accepted": false, "score": 0, "last_activity_date": 1609676725, "creation_date": 1609676725, "answer_id": 65549823, "question_id": 50707946, "link": "https://stackoverflow.com/questions/50707946/docker-for-golang-application/65549823#65549823", "title": "Docker for golang application", "body": "<pre><code>FROM golang:alpine\n\n# important!\nENV GO111MODULE=on\nENV CGO_ENABLED=0\nENV GOOS=linux\nENV GOARCH=amd64\nENV GOFLAGS=-mod=vendor\nENV APP_USER app\nENV APP_HOME /go/src/microservices\n\nRUN mkdir /nameApp\nADD . /nameApp\nWORKDIR /nameApp\n\n//compile your project\nRUN go mod vendor\nRUN go build\n\n//open the port 8000\nEXPOSE 8000\nCMD [ &quot;/nameApp/nameApp&quot; ]\n</code></pre>\n"}], "owner": {"reputation": 987, "user_id": 7571053, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3acddcbb4ffa065f60b021cdf35965af?s=128&d=identicon&r=PG&f=1", "display_name": "Jenny Hilton", "link": "https://stackoverflow.com/users/7571053/jenny-hilton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2821, "favorite_count": 2, "accepted_answer_id": 50708472, "answer_count": 2, "score": 6, "last_activity_date": 1609676725, "creation_date": 1528228420, "last_edit_date": 1528228724, "question_id": 50707946, "link": "https://stackoverflow.com/questions/50707946/docker-for-golang-application", "title": "Docker for golang application", "body": "<p>i've golang application which I want to build docker image for it\nthe application folder called <code>cloud-native-go</code> and the dockerfile is under the root project\nAny idea what is wrong here ?</p>\n\n<pre><code>FROM golang:alpine3.7\nWORKDIR /go/src/app\nCOPY . .\nRUN apk add --no-cache git\nRUN go-wrapper download   # \"go get -d -v ./...\"\nRUN go-wrapper install    # \"go install -v ./...\"\n\n#final stage\nFROM alpine:latest\nRUN apk --no-cache add ca-certificates\nCOPY --from=builder /go/bin/app /app\nENTRYPOINT ./app\nLABEL Name=cloud-native-go Version=0.0.1\nEXPOSE 3000\n</code></pre>\n\n<p><strong>The error is :</strong></p>\n\n<pre><code>Step 5/12 : RUN go-wrapper download   # \"go get -d -v ./...\"\n ---&gt; Running in 70c2e00f332d\n/bin/sh: go-wrapper: not found\n</code></pre>\n\n<p>i Build it with </p>\n\n<p><code>docker build -t cloud-native-go:1.0.0 .</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1528223633, "post_id": 50706582, "comment_id": 88422674, "body": "Make sure <i>all</i> your dependencies are vendored in a single vendor directory for the project."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1528224990, "post_id": 50706582, "comment_id": 88423336, "body": "@Isha make sure that your vendor folder also contains the <code>golang.org&#47;x&#47;text&#47;internal&#47;language&#47;compact</code> package."}, {"owner": {"reputation": 769, "user_id": 3128700, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001574200763/picture?type=large", "display_name": "jaede", "link": "https://stackoverflow.com/users/3128700/jaede"}, "edited": false, "score": 0, "creation_date": 1546419271, "post_id": 50706582, "comment_id": 94843688, "body": "Did you get it fixed?"}, {"owner": {"reputation": 11, "user_id": 4157664, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P0P7n.jpg?s=128&g=1", "display_name": "Isha", "link": "https://stackoverflow.com/users/4157664/isha"}, "reply_to_user": {"reputation": 769, "user_id": 3128700, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001574200763/picture?type=large", "display_name": "jaede", "link": "https://stackoverflow.com/users/3128700/jaede"}, "edited": false, "score": 0, "creation_date": 1546526853, "post_id": 50706582, "comment_id": 94885410, "body": "@jaede yes. The issue was that I had the <code>golang.org&#47;x&#47;text&#47;internal&#47;language&#47;compact</code> (and some others) already vendored but I had older versions. Trying to vendor the localization packages was bringing in new versions which were incompatible with the existing packages I had."}], "owner": {"reputation": 11, "user_id": 4157664, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P0P7n.jpg?s=128&g=1", "display_name": "Isha", "link": "https://stackoverflow.com/users/4157664/isha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 109, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1528222808, "creation_date": 1528222808, "question_id": 50706582, "link": "https://stackoverflow.com/questions/50706582/type-issues-when-using-a-golang-library", "title": "type issues when using a golang library", "body": "<p>I have a project that is vendoring golang.org/x/text libraries. My directory structure looks like:</p>\n\n<pre><code>projectname/\n    server/\n        localization.go\n\n    vendor/\n        golang.org\n            x/\n                text/\n                    language/\n                    message/\n                    internal/\n                    currency/\n                    ...\n</code></pre>\n\n<p>Within <code>localization.go</code> I'm trying to use <code>message</code> library in this way:</p>\n\n<pre><code>import (\n    \"golang.org/x/text/language\"\n    \"golang.org/x/text/message\"\n)\n\nfunc formatCurrency() string {\n    p := message.NewPrinter(language.BrazilianPortuguese)\n    // do something with p\n    return \"placeholder\"\n}\n</code></pre>\n\n<p>However this is failing to compile with the error:  </p>\n\n<pre><code>Building... \n# github.com/orgname/projectname/vendor/golang.org/x/text/internal/number\n../../vendor/golang.org/x/text/internal/number/number.go:150:41: cannot convert t (type \n\"github.com/orgname/projectname/vendor/golang.org/x/text/language\".Tag) to type compact.Tag\n\n2018/06/05 18:17:26 compile failed:  [] exit status 2\n\nmake: *** [all] Error 1\n</code></pre>\n\n<p><code>vendor/golang.org/x/text/internal/number/number.go</code> has its imports like:  </p>\n\n<pre><code>import (\n    \"unicode/utf8\"\n\n    \"golang.org/x/text/internal/language/compact\"\n    \"golang.org/x/text/language\"\n)\n</code></pre>\n\n<p>I'm stuck on why number.go is having a type issue since all the libraries necessary are in the vendor directory and how to resolve it. Thank you for reading!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1528221712, "post_id": 50706238, "comment_id": 88421737, "body": "It means nothing. If the author ascribed some other meaning to the function, you would have to ask the author."}, {"owner": {"reputation": 1275, "user_id": 1621584, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/8b6a478246788ac00b9d365390af5ec5?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/1621584/jeff"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1528221839, "post_id": 50706238, "comment_id": 88421800, "body": "When you say it means nothing, would the code not work?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1528221993, "post_id": 50706238, "comment_id": 88421884, "body": "It works just fine, you can test it out yourself. It&#39;s just a function called <code>main</code>, and nothing else. Without the actual code, we have no idea what the intent was, but you can&#39;t compile a non main package as a main package."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1528223572, "post_id": 50706238, "comment_id": 88422640, "body": "The entry point to a Go program is the function <code>main()</code> in the package <code>main</code>. A function <code>main</code> in any other package is just a function called <code>main</code>. It&#39;s not a reserved keyword."}, {"owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "edited": false, "score": 1, "creation_date": 1528232722, "post_id": 50706238, "comment_id": 88426912, "body": "Good question Jeff, I advise you to be careful with trusting confusing code. Code should always be as simple and unambiguous as possible"}], "answers": [{"comments": [{"owner": {"reputation": 1041, "user_id": 5419599, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/SbCyV.png?s=128&g=1", "display_name": "Wildcard", "link": "https://stackoverflow.com/users/5419599/wildcard"}, "edited": false, "score": 0, "creation_date": 1547596132, "post_id": 50707201, "comment_id": 95243515, "body": "I would guess this is overall a bad practice, then?  Or is it?"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 4, "last_activity_date": 1528225190, "creation_date": 1528225190, "answer_id": 50707201, "question_id": 50706238, "link": "https://stackoverflow.com/questions/50706238/golang-func-main-in-packages-other-than-main/50707201#50707201", "title": "Golang func main() in packages other than main?", "body": "<p>The Go programming language is defined by its specification.</p>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a> </p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Program_execution\" rel=\"nofollow noreferrer\">Program execution</a></p>\n  \n  <p>A complete program is created by linking a single, unimported package\n  called the <em>main</em> package with all the packages it imports,\n  transitively. The <em>main</em> package must have package name <code>main</code> and declare\n  a function <code>main</code> that takes no arguments and returns no value.</p>\n\n<pre><code>func main() { \u2026 }\n</code></pre>\n  \n  <p>Program execution begins by initializing the <em>main</em> package and then\n  invoking the function <code>main</code>. When that function invocation returns, the\n  program exits. It does not wait for other (<em>non-main</em>) goroutines to\n  complete.</p>\n</blockquote>\n\n<hr>\n\n<p>The function name <code>main</code> has no special significance outside <code>package main</code>.</p>\n"}], "owner": {"reputation": 1275, "user_id": 1621584, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/8b6a478246788ac00b9d365390af5ec5?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/1621584/jeff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2485, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1539494561, "creation_date": 1528221409, "last_edit_date": 1539494561, "question_id": 50706238, "link": "https://stackoverflow.com/questions/50706238/golang-func-main-in-packages-other-than-main", "title": "Golang func main() in packages other than main?", "body": "<p>In the case, for example, of <code>helloworld</code>, the name of the package is main and there is also a <code>func main()</code> statement. But I have also seen code which <code>func main()</code> which is in some other package. The code, however, seems like it might be used as a standalone program. So what does it mean to have a <code>func main()</code> with a package statement other than <code>package main</code>?</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1528214966, "post_id": 50704319, "comment_id": 88418358, "body": "These are an implementation detail. You can follow the discussion in the  relevant issues: <a href=\"https://github.com/golang/protobuf/issues/276\" rel=\"nofollow noreferrer\">github.com/golang/protobuf/issues/276</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2151, "user_id": 414544, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e3b393a43f087897332658031daefda1?s=128&d=identicon&r=PG&f=1", "display_name": "luben", "link": "https://stackoverflow.com/users/414544/luben"}, "edited": false, "score": 0, "creation_date": 1561715436, "post_id": 50750848, "comment_id": 100163514, "body": "In some cases these fields prevent us from using the generated types for runtime BigQuery schema inference and inserts, because there are no corresponding table columns for them. So we can&#39;t just leave them and pretend they&#39;re not there."}, {"owner": {"reputation": 4055, "user_id": 2598037, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWCTo.jpg?s=128&g=1", "display_name": "Carl Mastrangelo", "link": "https://stackoverflow.com/users/2598037/carl-mastrangelo"}, "reply_to_user": {"reputation": 2151, "user_id": 414544, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e3b393a43f087897332658031daefda1?s=128&d=identicon&r=PG&f=1", "display_name": "luben", "link": "https://stackoverflow.com/users/414544/luben"}, "edited": false, "score": 0, "creation_date": 1561740599, "post_id": 50750848, "comment_id": 100175380, "body": "Sounds like the schema inference should be updated to ignore those fields.  Maybe file a bug?"}, {"owner": {"reputation": 2151, "user_id": 414544, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e3b393a43f087897332658031daefda1?s=128&d=identicon&r=PG&f=1", "display_name": "luben", "link": "https://stackoverflow.com/users/414544/luben"}, "edited": false, "score": 0, "creation_date": 1561843113, "post_id": 50750848, "comment_id": 100194884, "body": "There is a filed bug already since a year, but it&#39;s still open: <a href=\"https://github.com/googleapis/google-cloud-go/issues/1119\" rel=\"nofollow noreferrer\">github.com/googleapis/google-cloud-go/issues/1119</a>"}], "tags": [], "owner": {"reputation": 4055, "user_id": 2598037, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWCTo.jpg?s=128&g=1", "display_name": "Carl Mastrangelo", "link": "https://stackoverflow.com/users/2598037/carl-mastrangelo"}, "is_accepted": true, "score": 13, "last_activity_date": 1528745596, "last_edit_date": 1528745596, "creation_date": 1528409531, "answer_id": 50750848, "question_id": 50704319, "link": "https://stackoverflow.com/questions/50704319/xxx-type-in-generated-pb-go-file/50750848#50750848", "title": "XXX_* type in generated *.pb.go file", "body": "<p>The <code>XXX_</code> types are used by the Protobuf library to store unknown fields.  When you decode a proto, there may be additional fields in the serialized data that the library doesn't know what to do with.  This can happen, for instance, when the reader and writer of the data are using different copies of the proto file.  This is a feature to help with backwards compatibility between clients and serves built at different times.</p>\n\n<p>Additionally, the XXX fields allow you to expose <a href=\"https://developers.google.com/protocol-buffers/docs/proto#extensions\" rel=\"noreferrer\">extensions</a>, which were part of Proto2.  They were removed in Proto3 in favor of <a href=\"https://developers.google.com/protocol-buffers/docs/proto3#any\" rel=\"noreferrer\">Any</a>, but the library still needs to support them.  </p>\n\n<p>As for what you should do with these?   I would just leave them alone, and don't reference them.  You don't need to set them, and you don't need to read them.  The Go protobuf library will handle them for you.  </p>\n"}, {"tags": [], "owner": {"reputation": 111, "user_id": 7988409, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44c641096840249c7ee9afece9fa3592?s=128&d=identicon&r=PG&f=1", "display_name": "derekjones562", "link": "https://stackoverflow.com/users/7988409/derekjones562"}, "is_accepted": false, "score": 1, "last_activity_date": 1569358530, "creation_date": 1569358530, "answer_id": 58088012, "question_id": 50704319, "link": "https://stackoverflow.com/questions/50704319/xxx-type-in-generated-pb-go-file/58088012#58088012", "title": "XXX_* type in generated *.pb.go file", "body": "<p>If you want to specifically exclude them when generating, you can add this to your file </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import \"github.com/gogo/protobuf/gogoproto/gogo.proto\";\noption (gogoproto.goproto_unkeyed_all) = false;\noption (gogoproto.goproto_unrecognized_all) = false;\noption (gogoproto.goproto_sizecache_all) = false;\n</code></pre>\n\n<p>edit: Styling</p>\n"}, {"tags": [], "owner": {"reputation": 971, "user_id": 2202757, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/U5NGN.jpg?s=128&g=1", "display_name": "sh0umik", "link": "https://stackoverflow.com/users/2202757/sh0umik"}, "is_accepted": false, "score": 1, "last_activity_date": 1572544872, "creation_date": 1572544872, "answer_id": 58648979, "question_id": 50704319, "link": "https://stackoverflow.com/questions/50704319/xxx-type-in-generated-pb-go-file/58648979#58648979", "title": "XXX_* type in generated *.pb.go file", "body": "<p>The official protobuffer generator for golang still includes the XXX_ fields and the issue is still open and decisions are pending on wether to remove it ot not but you can use the <code>gogo</code> third party generator. I am using it for a long time without a problem. Just use the <code>gogofaster_out</code></p>\n\n<p><a href=\"https://github.com/gogo/protobuf\" rel=\"nofollow noreferrer\">https://github.com/gogo/protobuf</a><br>\nHere are the section that discussed about exclude the XXX_ fields </p>\n\n<blockquote>\n  <p>More Speed and more generated code</p>\n  \n  <p>Fields without pointers cause less time in the garbage collector. More\n  code generation results in more convenient methods.</p>\n  \n  <p>Other binaries are also included:</p>\n</blockquote>\n\n<pre><code>protoc-gen-gogofast (same as gofast, but imports gogoprotobuf)\nprotoc-gen-gogofaster (same as gogofast, without XXX_unrecognized, less pointer fields)\nprotoc-gen-gogoslick (same as gogofaster, but with generated string, gostring and equal methods)\n</code></pre>\n\n<p>Installing any of these binaries is easy. Simply run:</p>\n\n<blockquote>\n  <p>go get github.com/gogo/protobuf/proto<br>\n  go get github.com/gogo/protobuf/{binary}<br>\n  go get github.com/gogo/protobuf/gogoproto</p>\n</blockquote>\n\n<p>After installing the lib use </p>\n\n<pre><code>protoc --gogofaster_out=plugins=grpc\n</code></pre>\n"}], "owner": {"reputation": 1198, "user_id": 3713720, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4d320b7a47c87d63d0b6765d31296c13?s=128&d=identicon&r=PG&f=1", "display_name": "Cliff", "link": "https://stackoverflow.com/users/3713720/cliff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9909, "favorite_count": 3, "accepted_answer_id": 50750848, "answer_count": 3, "score": 9, "last_activity_date": 1572544872, "creation_date": 1528214078, "question_id": 50704319, "link": "https://stackoverflow.com/questions/50704319/xxx-type-in-generated-pb-go-file", "title": "XXX_* type in generated *.pb.go file", "body": "<p>I'm working on a <a href=\"https://ewanvalentine.io/microservices-in-golang-part-1/\" rel=\"noreferrer\">tutorial</a> about gRPC. When I generated the <code>.pb.go</code> file, I'm getting some <code>XXX_*</code> type in my struct. </p>\n\n<p>This is my <code>consignment.proto</code> file:</p>\n\n<pre><code>syntax = \"proto3\";\n\npackage go.micro.srv.consignment; \n\nservice ShippingService {\n    rpc CreateConsignment(Consignment) returns (Response) {}\n}\n\nmessage Consignment {\n    string id = 1;\n    string description = 2;\n    int32 weight = 3;\n    repeated Container containers = 4;\n    string vessel_id = 5;\n}\n\nmessage Container {\n    string id = 1;\n    string customer_id = 2;\n    string origin = 3;\n    string user_id = 4;\n}\n\nmessage Response {\n    bool created = 1;\n    Consignment consignment = 2;\n}\n</code></pre>\n\n<p>This is the struct in the <code>.pb.go</code> file. Can someone tell me why are there 3 <code>XXX</code> types in my <code>struct</code>? Shouldn't the struct be reflecting what I'm defining in my <code>proto</code>?</p>\n\n<pre><code>type Consignment struct {\n    Id                   string       `protobuf:\"bytes,1,opt,name=id\" json:\"id,omitempty\"`\n    Description          string       `protobuf:\"bytes,2,opt,name=description\" json:\"description,omitempty\"`\n    Weight               int32        `protobuf:\"varint,3,opt,name=weight\" json:\"weight,omitempty\"`\n    Containers           []*Container `protobuf:\"bytes,4,rep,name=containers\" json:\"containers,omitempty\"`\n    VesselId             string       `protobuf:\"bytes,5,opt,name=vessel_id,json=vesselId\" json:\"vessel_id,omitempty\"`\n    XXX_NoUnkeyedLiteral struct{}     `json:\"-\"`\n    XXX_unrecognized     []byte       `json:\"-\"`\n    XXX_sizecache        int32        `json:\"-\"`\n}\n</code></pre>\n"}, {"tags": ["opengl", "go", "framebuffer", "deferred-rendering"], "comments": [{"owner": {"reputation": 18064, "user_id": 2579738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oXata.png?s=128&g=1", "display_name": "BDL", "link": "https://stackoverflow.com/users/2579738/bdl"}, "edited": false, "score": 0, "creation_date": 1528211115, "post_id": 50703024, "comment_id": 88415984, "body": "The texture attribute stride looks wrong. Shouldn&#39;t that also be 4*4 instead of 3*4?"}, {"owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "reply_to_user": {"reputation": 18064, "user_id": 2579738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oXata.png?s=128&g=1", "display_name": "BDL", "link": "https://stackoverflow.com/users/2579738/bdl"}, "edited": false, "score": 0, "creation_date": 1528211742, "post_id": 50703024, "comment_id": 88416415, "body": "@BDL it was exactly that. <i>facepalm</i>. Will be happy to accept if you post as answer."}], "answers": [{"tags": [], "owner": {"reputation": 18064, "user_id": 2579738, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oXata.png?s=128&g=1", "display_name": "BDL", "link": "https://stackoverflow.com/users/2579738/bdl"}, "is_accepted": true, "score": 1, "last_activity_date": 1528211820, "creation_date": 1528211820, "answer_id": 50703561, "question_id": 50703024, "link": "https://stackoverflow.com/questions/50703024/rendering-is-different-to-single-pass-rendering/50703561#50703561", "title": "Rendering is different to single pass rendering", "body": "<p>The stride of the texture coordinate pointer is wrong. It should be 4*4 instead of 3*4 since the start of two consecutive vertices is 4 floats away from each other.</p>\n"}], "owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 50703561, "answer_count": 1, "score": 0, "last_activity_date": 1528215182, "creation_date": 1528210247, "last_edit_date": 1528215182, "question_id": 50703024, "link": "https://stackoverflow.com/questions/50703024/rendering-is-different-to-single-pass-rendering", "title": "Rendering is different to single pass rendering", "body": "<p>I've started updating my code to allow for multipass rendering. I'm fairly certain I'm doing framebuffers right but somehow I'm not getting the results I want. The code I'm using is based off the following tutorial: <a href=\"https://learnopengl.com/Advanced-OpenGL/Framebuffers\" rel=\"nofollow noreferrer\">https://learnopengl.com/Advanced-OpenGL/Framebuffers</a></p>\n\n<p>When I render to the default buffer I get exactly what I expect:\n<a href=\"https://i.stack.imgur.com/ivxZB.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ivxZB.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>However when I render that to a non-default framebuffer texture and place it on a quad, I get this very puzzling result:\n<a href=\"https://i.stack.imgur.com/MkCjG.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/MkCjG.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>So my initial thinking is that there is something wrong with how I'm drawing the quad that my non-default framebuffer texture is placed on (the one spanning to all four corners of the window). But when rendering only that, with wireframes enabled, I getting exactly what I expect (and what the tutorial confirms I will get):\n<a href=\"https://i.stack.imgur.com/iaIlY.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/iaIlY.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>So that leaves me thinking there are two possible issues with my code:</p>\n\n<h1>Wrong Framebuffer Configuration</h1>\n\n<p>When the non-default framebuffer draws everything to the texture, it is in some strange orientation and scale that results in everything rendering completely wrong (even though everything is perfect when rendered to the default framebuffer). Perhaps some previous buffer isn't cleared or there is something in the configuration that adjusts how the framebuffer renders onto the texture.</p>\n\n<h1>Quad Texture is Wrapping</h1>\n\n<p>The texture is too small and when wrapped on the quad that is much bigger, it repeats the output and apparently somehow rotates... Notice how the objects are pulled skew when it crosses the diagonal line to the top-right triangle of the quad. This must be related to some issue...</p>\n\n<h2>Code (in the order it executes):</h2>\n\n<p><em>framebuffer configuration</em></p>\n\n<pre><code>gl.GenFramebuffers(1, &amp;o.fbo)                                                                                         \ngl.BindFramebuffer(gl.FRAMEBUFFER, o.fbo)                                                                             \n\ngl.GenTextures(1, &amp;o.cbo)                                                                                             \ngl.BindTexture(gl.TEXTURE_2D, o.cbo)                                                                                  \ngl.TexImage2D(gl.TEXTURE_2D, 0, gl.RGB, int32(o.screenWidth), int32(o.screenHeight), 0, gl.RGB, gl.UNSIGNED_BYTE, nil)\ngl.TexParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR)                                                     \ngl.TexParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.LINEAR)                                                     \ngl.FramebufferTexture2D(gl.FRAMEBUFFER, gl.COLOR_ATTACHMENT0, gl.TEXTURE_2D, o.cbo, 0)                                \n\ngl.GenRenderbuffers(1, &amp;o.rbo)                                                                                        \ngl.BindRenderbuffer(gl.RENDERBUFFER, o.rbo)                                                                           \ngl.RenderbufferStorage(gl.RENDERBUFFER, gl.DEPTH24_STENCIL8, int32(o.screenWidth), int32(o.screenHeight))             \ngl.FramebufferRenderbuffer(gl.FRAMEBUFFER, gl.DEPTH_STENCIL_ATTACHMENT, gl.RENDERBUFFER, o.rbo)                       \nif gl.CheckFramebufferStatus(gl.FRAMEBUFFER) != gl.FRAMEBUFFER_COMPLETE {                                             \n    log.Fatal(\"Framebuffer incomplete\")                                                                               \n}                                                                                                                     \ngl.BindFramebuffer(gl.FRAMEBUFFER, 0)                                                                                 \n\n...\n</code></pre>\n\n<p><em>first pass draw</em></p>\n\n<pre><code>gl.BindFramebuffer(gl.FRAMEBUFFER, o.fbo)                            \ngl.Enable(gl.DEPTH_TEST)                                             \n\ngl.ClearColor(clearColor.R, clearColor.G, clearColor.B, clearColor.A)\ngl.Clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)                  \n\ngl.UseProgram(o.shaderProgram)                                       \n\n...\n</code></pre>\n\n<p><em>draw each object</em></p>\n\n<pre><code>gl.DrawElements(gl.TRIANGLES, 6, gl.UNSIGNED_BYTE, gl.PtrOffset(0))\ngl.UniformMatrix4fv(model_uni, 1, false, &amp;model[0])                \ngl.BindVertexArray(0)                                              \n\n...\n</code></pre>\n\n<p><em>second pass draw</em></p>\n\n<pre><code>gl.BindFramebuffer(gl.FRAMEBUFFER, 0)                              \ngl.Disable(gl.DEPTH_TEST)                                          \n\ngl.ClearColor(1, 1, 1, 1)                                          \ngl.Clear(gl.COLOR_BUFFER_BIT)                                      \ngl.UseProgram(o.screenShaderProgram)                               \ngl.BindVertexArray(o.quadVAO)                                      \ngl.BindTexture(gl.TEXTURE_2D, o.cbo)                               \ngl.DrawElements(gl.TRIANGLES, 6, gl.UNSIGNED_BYTE, gl.PtrOffset(0))\n\no.window.SwapBuffers()                                             \nglfw32.PollEvents()                                                \n</code></pre>\n\n<p><em>quad vao</em></p>\n\n<pre><code>vertices := []float32{                                                                   \n    1.0, 1.0, 1.0, 1.0, // 0 top right                                                   \n    1.0, -1.0, 1.0, 0.0, // 1 bot right                                                  \n    -1.0, -1.0, 0.0, 0.0, // 2 bot left                                                  \n    -1.0, 1.0, 0.0, 1.0, // 3 top left                                                   \n}                                                                                        \nindicies := []uint8{                                                                     \n    0, 1, 3,                                                                             \n    1, 2, 3,                                                                             \n}                                                                                        \n\nvar vertexArrayID uint32                                                                 \ngl.GenVertexArrays(1, &amp;vertexArrayID)                                                    \ngl.BindVertexArray(vertexArrayID)                                                        \n\n// Vertex buffer                                                                         \nvar vertexBuffer uint32                                                                  \ngl.GenBuffers(1, &amp;vertexBuffer)                                                          \ngl.BindBuffer(gl.ARRAY_BUFFER, vertexBuffer)                                             \ngl.BufferData(gl.ARRAY_BUFFER, len(vertices)*4, gl.Ptr(vertices), gl.STATIC_DRAW)        \n\n// Element buffer                                                                        \nvar elementBuffer uint32                                                                 \ngl.GenBuffers(1, &amp;elementBuffer)                                                         \ngl.BindBuffer(gl.ELEMENT_ARRAY_BUFFER, elementBuffer)                                    \ngl.BufferData(gl.ELEMENT_ARRAY_BUFFER, len(indicies)*4, gl.Ptr(indicies), gl.STATIC_DRAW)\n\n// Linking vertex attributes                                                             \ngl.VertexAttribPointer(0, 2, gl.FLOAT, false, 4*4, gl.PtrOffset(0))                      \ngl.EnableVertexAttribArray(0)                                                            \n\n// Linking texture attributes                                                            \ngl.VertexAttribPointer(1, 2, gl.FLOAT, false, 3*4, gl.PtrOffset(2*4))                    \ngl.EnableVertexAttribArray(1)                                                            \n\no.quadVAO = vertexArrayID                                                                \n\n// Unbind Vertex array object                                                            \ngl.BindVertexArray(0)                                                                    \n</code></pre>\n"}, {"tags": ["go", "udp", "goroutine"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 2, "creation_date": 1528208626, "post_id": 50702463, "comment_id": 88414364, "body": "If you run above code using simple print message there is no error <a href=\"https://play.golang.org/p/ZEQDjYFdWgp\" rel=\"nofollow noreferrer\">play.golang.org/p/ZEQDjYFdWgp</a> in using go routine. Are you running only single go routine as mentioned or there are others too"}, {"owner": {"reputation": 8219, "user_id": 135605, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7c56ff86a79852b167d84b3838756fba?s=128&d=identicon&r=PG", "display_name": "somejkuser", "link": "https://stackoverflow.com/users/135605/somejkuser"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1528208724, "post_id": 50702463, "comment_id": 88414424, "body": "Im extremely new can you provide an answer with possibly whats going wrong?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1528208768, "post_id": 50702463, "comment_id": 88414451, "body": "I have added a link to code to regenerate an error but there is not as such when you are running your go routine. Run the code in my comment link"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1528208822, "post_id": 50702463, "comment_id": 88414499, "body": "@jkushner: first, don&#39;t ignore errors. If your goroutines are blocked, the stack trace will show you where."}, {"owner": {"reputation": 8219, "user_id": 135605, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7c56ff86a79852b167d84b3838756fba?s=128&d=identicon&r=PG", "display_name": "somejkuser", "link": "https://stackoverflow.com/users/135605/somejkuser"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528212999, "post_id": 50702463, "comment_id": 88417185, "body": "@JimB im getting an error here: <code>n, _, _, _, _ := conn.ReadMsgUDP(buffr, buffw) </code> I did notice that my port wasnt correct so there was no server interaction, unfortunately though i cannot get serve interaction until tomorrow. Do you think the issue was not having server communication?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1528213601, "post_id": 50702463, "comment_id": 88417541, "body": "@jkushner: well, you can&#39;t read a message if there is no message (and BTW, you probably don&#39;t need <code>ReadMsgUDP</code>, use <code>Read</code>, or <code>ReadFrom*</code>). Either way, this code provided can&#39;t produce a deadlock, and the stack trace from your original error will provide you with the exact points that are blocking."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1528302473, "post_id": 50702463, "comment_id": 88458761, "body": "If you are not getting any answer when trying to read in this line <code>n, _, _, _, _ := conn.ReadMsgUDP(buffr, buffw)</code>, it will block indefinitely. Then <code>routine</code> is asleep and so is <code>main</code> because it is waiting in <code>wg.Wait()</code>. Then all routines are asleep."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1528308834, "post_id": 50702463, "comment_id": 88462137, "body": "@TehSphinX: blocked reading on a network connection does <i>not</i> put the goroutine into a sleep state, and cannot cause the aforementioned fatal error. Otherwise network code would crash like this all the time, since most of your time is usually spent waiting on reads."}, {"owner": {"reputation": 8219, "user_id": 135605, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7c56ff86a79852b167d84b3838756fba?s=128&d=identicon&r=PG", "display_name": "somejkuser", "link": "https://stackoverflow.com/users/135605/somejkuser"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528311340, "post_id": 50702463, "comment_id": 88463374, "body": "@JimB then why is it failing on <code>ReadMsgUDP</code> specifically with the only issue i see is no connection established"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528314552, "post_id": 50702463, "comment_id": 88464851, "body": "@jkushner: I don&#39;t understand. <code>ReadMsgUDP</code> is likely to fail, because you&#39;re using a &quot;connected&quot; UDP socket, so the first write gets an ICMP failure back, then the read call returns that response as an error (which you&#39;re ignoring here). If you remove the first Write call, or use a normal udp socket, Read will block indefinitely. None of this is really related to a deadlock."}], "answers": [{"comments": [{"owner": {"reputation": 8219, "user_id": 135605, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7c56ff86a79852b167d84b3838756fba?s=128&d=identicon&r=PG", "display_name": "somejkuser", "link": "https://stackoverflow.com/users/135605/somejkuser"}, "edited": false, "score": 0, "creation_date": 1528213127, "post_id": 50703797, "comment_id": 88417262, "body": "i dont see anything going on here that hasnt been done"}], "tags": [], "owner": {"reputation": 73, "user_id": 4506589, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/d37ed6a48f20f830ee4b2c54447a5636?s=128&d=identicon&r=PG", "display_name": "Ton", "link": "https://stackoverflow.com/users/4506589/ton"}, "is_accepted": false, "score": -5, "last_activity_date": 1528212441, "creation_date": 1528212441, "answer_id": 50703797, "question_id": 50702463, "link": "https://stackoverflow.com/questions/50702463/all-goroutines-asleep-when-executing-goroutine-anyways/50703797#50703797", "title": "All goroutines asleep when executing goroutine anyways", "body": "<p>Try</p>\n\n<pre><code>func main(){\n var wg &amp;sync.WaitGroup\n wg.Add(1)\n go routine(wg)\n ...\n wg.Wait()\n}\nfunc routine(wg *sync.WaitGroup){\n ...\n defer wg.Done()\n}\n</code></pre>\n"}], "owner": {"reputation": 8219, "user_id": 135605, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7c56ff86a79852b167d84b3838756fba?s=128&d=identicon&r=PG", "display_name": "somejkuser", "link": "https://stackoverflow.com/users/135605/somejkuser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 77, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1528212441, "creation_date": 1528208403, "question_id": 50702463, "link": "https://stackoverflow.com/questions/50702463/all-goroutines-asleep-when-executing-goroutine-anyways", "title": "All goroutines asleep when executing goroutine anyways", "body": "<p>I'm receiving the following error and I don't understand why:</p>\n\n<p><code>Send: Query Herefatal error: all goroutines are asleep - deadlock!</code></p>\n\n<p>You can see im calling a function <code>routine</code> i created using goroutine. I really dont have any more details to provide.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"sync\"\n)\n\nconst (\n    udphost       = \"127.0.0.1\"\n    udpport       = \":150\"\n    StopCharacter = \"\\r\\n\\r\\n\"\n)\n\nvar wg sync.WaitGroup\n\nfunc routine() {\n    defer wg.Done()\n    // establish connection address parts\n    schemaUri := udphost + udpport\n    udpAddr, err := net.ResolveUDPAddr(\"udp4\", schemaUri)\n\n    // make connection\n    conn, err := net.DialUDP(\"udp\", nil, udpAddr)\n    fmt.Printf(\"%v\", conn)\n\n    // defer close\n    defer conn.Close()\n\n    // handle connection errors\n    if err != nil {\n        fmt.Println(\"Erorr Establishing UDP Connection\")\n        return\n    }\n\n    // input query\n    message := \"Query Here\"\n\n    // Write query to server\n    conn.Write([]byte(message))\n    conn.Write([]byte(StopCharacter))\n    fmt.Printf(\"Send: %s\", message)\n\n    // Read response from server\n    buffr := make([]byte, 1024)\n    buffw := make([]byte, 1024)\n    n, _, _, _, _ := conn.ReadMsgUDP(buffr, buffw)\n\n    fmt.Printf(\"Receive: %s\", n)\n\n    // parse message\n    msg := string(buffr[0:n])\n    fmt.Println(msg)\n}\n\nfunc main() {\n    wg.Add(1) \n    go routine()\n    wg.Wait() \n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "oauth", "google-compute-engine"], "answers": [{"comments": [{"owner": {"reputation": 457, "user_id": 4489733, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/10714df646d369c5a41225156d051cac?s=128&d=identicon&r=PG&f=1", "display_name": "mbudge", "link": "https://stackoverflow.com/users/4489733/mbudge"}, "edited": false, "score": 0, "creation_date": 1528273624, "post_id": 50705334, "comment_id": 88439820, "body": "We might have to replace pubsub push handlers with pull subscriptions and enable IAP. Tho we are going to test using google.DefaultClient(ctx, googleapis.com/auth/cloud-platform) with scope &quot;googleapis.com/auth/cloud-platform&quot;, which should have access to &quot;All resources&quot; godoc.org/golang.org/x/oauth2/google#example-ComputeTokenSou&zwnj;&#8203;rce"}, {"owner": {"reputation": 457, "user_id": 4489733, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/10714df646d369c5a41225156d051cac?s=128&d=identicon&r=PG&f=1", "display_name": "mbudge", "link": "https://stackoverflow.com/users/4489733/mbudge"}, "edited": false, "score": 0, "creation_date": 1528273649, "post_id": 50705334, "comment_id": 88439839, "body": "As shown in your link: Scope    Meaning <a href=\"https://www.googleapis.com/auth/cloud-platform\" rel=\"nofollow noreferrer\">googleapis.com/auth/cloud-platform</a>    Full access to all resources and services in the specified Cloud Platform project."}], "tags": [], "owner": {"reputation": 485, "user_id": 9738014, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-dcVB5Ht0uNg/AAAAAAAAAAI/AAAAAAAAAF8/lEmJyVsG6-s/photo.jpg?sz=128", "display_name": "Samuel N", "link": "https://stackoverflow.com/users/9738014/samuel-n"}, "is_accepted": false, "score": 2, "last_activity_date": 1528217786, "creation_date": 1528217786, "answer_id": 50705334, "question_id": 50702420, "link": "https://stackoverflow.com/questions/50702420/http-requests-from-compute-engine-to-app-engine-standard-with-compute-engine-def/50705334#50705334", "title": "HTTP requests from compute engine to app-engine standard with compute engine default service account", "body": "<p>When making secure HTTP requests from Compute Engine to App Engine app, you have to make use of a user authorization flow [1], because you want users in GAE app to grant access to requests coming from GCE. The App Engine Users API works just for apps running on App Engine platform. I assume yours runs on a GCE instance.</p>\n\n<p>HTTP requests coming from other GCP services such as GCE in this case need to be routed directly, where the URL includes the name or ID of a resource [2].</p>\n\n<p>e.g</p>\n\n<pre><code>http://[VERSION_ID].[SERVICE_ID].[MY_PROJECT_ID].appspot.com\n\nhttps://[VERSION_ID]-dot-[SERVICE_ID]-dot-[MY_PROJECT_ID].appspot.com)\n</code></pre>\n\n<p>Take a look at this documentation to know how to provide access scope in your requests to the user information your app requires [3].</p>\n\n<p>Hope this helps point in the right direction.</p>\n\n<p>[1] <a href=\"https://cloud.google.com/compute/docs/api/how-tos/authorization\" rel=\"nofollow noreferrer\">https://cloud.google.com/compute/docs/api/how-tos/authorization</a></p>\n\n<p>[2] <a href=\"https://cloud.google.com/appengine/docs/standard/go/communicating-between-services\" rel=\"nofollow noreferrer\">https://cloud.google.com/appengine/docs/standard/go/communicating-between-services</a></p>\n\n<p>[3] <a href=\"https://cloud.google.com/compute/docs/api/how-tos/authorization#user_auth_flow\" rel=\"nofollow noreferrer\">https://cloud.google.com/compute/docs/api/how-tos/authorization#user_auth_flow</a></p>\n"}], "owner": {"reputation": 457, "user_id": 4489733, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/10714df646d369c5a41225156d051cac?s=128&d=identicon&r=PG&f=1", "display_name": "mbudge", "link": "https://stackoverflow.com/users/4489733/mbudge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 337, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1528217786, "creation_date": 1528208302, "question_id": 50702420, "link": "https://stackoverflow.com/questions/50702420/http-requests-from-compute-engine-to-app-engine-standard-with-compute-engine-def", "title": "HTTP requests from compute engine to app-engine standard with compute engine default service account", "body": "<p>We want to make secure HTTP requests from compute engine to appengine standard, which authenticate using the Appengine Users API</p>\n\n<p>Users API: <a href=\"https://cloud.google.com/appengine/docs/standard/go/users/\" rel=\"nofollow noreferrer\">https://cloud.google.com/appengine/docs/standard/go/users/</a></p>\n\n<p>GAE standard handler (secured with Users Api - login: required): </p>\n\n<pre><code>handlers:\n- url: /securehandler/.*\n  script: _go_app\n  login: required\n  secure: always\n</code></pre>\n\n<p>We tried using this library to make an authenticated HTTPS request from our compute engine Go application to the above GAE handler:</p>\n\n<p><a href=\"https://godoc.org/golang.org/x/oauth2/google#ComputeTokenSource\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/oauth2/google#ComputeTokenSource</a></p>\n\n<pre><code>client := &amp;http.Client{\n    Transport: &amp;oauth2.Transport{\n        // Fetch from Google Compute Engine's metadata server to retrieve\n        // an access token for the provided account.\n        // If no account is specified, \"default\" is used.\n        Source: google.ComputeTokenSource(\"\"),\n    },\n}\nclient.Get(\"https://myapp.appspot.com/securehandler/search\")\n</code></pre>\n\n<p>We get a 403 Forbidden HTTP error.</p>\n\n<p>Our default compute engine service account has App Engine Admin\n&amp; Editor permissions in IAM.</p>\n\n<p>Google support told us we should be able to make requests to GAE standard handlers with the default compute engine service account.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "ssh", "sftp", "chroot", "isolation"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1528206902, "post_id": 50701863, "comment_id": 88413106, "body": "Please include the relevant code in the body of the question."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528221103, "post_id": 50701863, "comment_id": 88421397, "body": "You can&#39;t fork or chroot the main process, so that leaves you with the option of running the sftp server in a subprocess."}, {"owner": {"reputation": 1, "user_id": 9897860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b648d66cc738d7f74afcf7341430ee3?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastien D.", "link": "https://stackoverflow.com/users/9897860/sebastien-d"}, "edited": false, "score": 0, "creation_date": 1528285018, "post_id": 50701863, "comment_id": 88447204, "body": "How I can run sftp in a subprocess, and run ssh server on main process?  The sftp protocol relies on ssh channel. I have tried to forward ssh channel in a subprocess and it does not seem to work fine."}], "owner": {"reputation": 1, "user_id": 9897860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b648d66cc738d7f74afcf7341430ee3?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastien D.", "link": "https://stackoverflow.com/users/9897860/sebastien-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 379, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1528212501, "creation_date": 1528206785, "last_edit_date": 1528212501, "question_id": 50701863, "link": "https://stackoverflow.com/questions/50701863/chroot-for-multiple-sftp-clients-in-golang", "title": "Chroot for multiple SFTP clients in golang", "body": "<p>I use Golang as SFTP server for my application and I would like to isolate my clients with a different root directory.</p>\n\n<p>This application allows multiple client connection but I would like to serve  custom root directory for each clients (for better isolation).</p>\n\n<p>In golang I tried to fork the process but it does not seem to be possible: <a href=\"https://stackoverflow.com/questions/28370646/how-do-i-fork-a-go-process\">Fork a go process</a></p>\n\n<p>I have tried <code>syscall.Chroot</code> into a goroutine but the all binary is being chrooted... In the meantime, this prevent other clients from using the service as the binary is chrooted by the current user.</p>\n\n<p>If you have a possible solution for my problem, I would be very happy to read you.</p>\n\n<pre><code>func main() {\n    if listener, err := net.Listen(\"tcp\", fmt.Sprintf(\"0.0.0.0:%d\", sshServer.Port)); err == nil {\n        for {\n           if nConn, err := listener.Accept(); err == nil {\n                // ...\n                if sshConn, chans, reqs, err := ssh.NewServerConn(nConn, &amp;sshServer.Config); err == nil {\n                    // ...\n                    // Accept all channels\n                    go handleChannels(chans)\n                }\n            }\n        }\n    }\n}\n...\nfunc handleChannels(chans &lt;-chan ssh.NewChannel) {\n    // Service the incoming Channel channel.\n    for newChannel := range chans {\n        // ...\n        if err := syscall.Chroot(chrootPath); err != nil {\n            panic(err)\n        }\n\n        if err := os.Chdir(\"/\"); err != nil {\n            panic(err)\n        }\n\n        channel, requests, errChannel := newChannel.Accept()\n        if err := server.Serve(); err == io.EOF {\n            server.Close()\n        }\n    }\n}\n</code></pre>\n\n<p>Libs used:</p>\n\n<ul>\n<li>golang.org/x/crypto/ssh</li>\n<li>github.com/pkg/sftp</li>\n</ul>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 7330, "user_id": 4830196, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xcatD.jpg?s=128&g=1", "display_name": "Ryan Wilson", "link": "https://stackoverflow.com/users/4830196/ryan-wilson"}, "edited": false, "score": 0, "creation_date": 1528205111, "post_id": 50701215, "comment_id": 88411736, "body": "Is there an object or dynamic type you could declare your struct array as, so that the type can be determined at runtime?"}, {"owner": {"reputation": 4338, "user_id": 1061193, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d7ffbfe3211751d0cfe8c9fcda306c2b?s=128&d=identicon&r=PG", "display_name": "drum", "link": "https://stackoverflow.com/users/1061193/drum"}, "reply_to_user": {"reputation": 7330, "user_id": 4830196, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xcatD.jpg?s=128&g=1", "display_name": "Ryan Wilson", "link": "https://stackoverflow.com/users/4830196/ryan-wilson"}, "edited": false, "score": 0, "creation_date": 1528205169, "post_id": 50701215, "comment_id": 88411787, "body": "@RyanWilson I&#39;m not sure how to do that but that&#39;s the struct I created."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1528205211, "post_id": 50701215, "comment_id": 88411822, "body": "<code>go doc json.Number</code>"}, {"owner": {"reputation": 4338, "user_id": 1061193, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d7ffbfe3211751d0cfe8c9fcda306c2b?s=128&d=identicon&r=PG", "display_name": "drum", "link": "https://stackoverflow.com/users/1061193/drum"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528205471, "post_id": 50701215, "comment_id": 88412025, "body": "@Volker How does that help me? I have both <code>string</code>s and <code>Number</code>s."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528206491, "post_id": 50701215, "comment_id": 88412810, "body": "Then use json.RawMessage and postprocess."}, {"owner": {"reputation": 991, "user_id": 1061927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc0ad4a66f66d793ea39a35ddacbcb45?s=128&d=identicon&r=PG", "display_name": "Dynom", "link": "https://stackoverflow.com/users/1061927/dynom"}, "edited": false, "score": 0, "creation_date": 1528207057, "post_id": 50701215, "comment_id": 88413230, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/13364181/how-to-unmarshall-an-array-of-different-types-correctly\">How to unmarshall an array of different types correctly?</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528207099, "post_id": 50701215, "comment_id": 88413259, "body": "@drum did you consider using <code>interface{}</code> <a href=\"https://play.golang.org/p/9_XUZvVYWyJ\" rel=\"nofollow noreferrer\">play.golang.org/p/9_XUZvVYWyJ</a> ?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1528207242, "post_id": 50701215, "comment_id": 88413356, "body": "you can use <code>interface</code> if you are not confirmed of the type"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528207324, "post_id": 50701215, "comment_id": 88413410, "body": "@drum or as Volker suggested <code>json.Number</code>? <a href=\"https://play.golang.org/p/xGaJIfNN5Ll\" rel=\"nofollow noreferrer\">play.golang.org/p/xGaJIfNN5Ll</a>"}, {"owner": {"reputation": 4338, "user_id": 1061193, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d7ffbfe3211751d0cfe8c9fcda306c2b?s=128&d=identicon&r=PG", "display_name": "drum", "link": "https://stackoverflow.com/users/1061193/drum"}, "edited": false, "score": 0, "creation_date": 1528209516, "post_id": 50701215, "comment_id": 88414947, "body": "<code>interface{}</code> and <code>json.RawMessage</code> works for my use case."}], "answers": [{"tags": [], "owner": {"reputation": 16, "user_id": 9898443, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "JOSE ENRIQUE NARVAEZ GAGO", "link": "https://stackoverflow.com/users/9898443/jose-enrique-narvaez-gago"}, "is_accepted": true, "score": 0, "last_activity_date": 1528211053, "creation_date": 1528211053, "answer_id": 50703292, "question_id": 50701215, "link": "https://stackoverflow.com/questions/50701215/how-to-unmarshal-json-array-of-different-datatypes/50703292#50703292", "title": "How to unmarshal JSON array of different datatypes?", "body": "<p>You can set the type of the field Values to []interface{}, but you might have to use some type assertions.</p>\n\n<p>Here is a link to a playground where I use the data you provided: <a href=\"https://play.golang.org/p/ahePgggr8o1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ahePgggr8o1</a></p>\n\n<p>I will paste the code here anyways:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype Thing struct {\n    ID      string   `json:\"id\"`\n    Values  []interface{} `json:\"values,omitempty\"`\n}\n\nfunc print(values []interface{}) {\n    for _, v := range values{\n        switch value := v.(type){\n        case string:\n            fmt.Println(\"String\", value)\n        case int:\n            fmt.Println(\"Integer\", value)\n        case float64:\n            fmt.Println(\"Floats\", value)\n        default:\n            fmt.Printf(\"I don't know about type %T!\\n\", v)\n        }\n    }\n}\n\nfunc main() {\n    var t1, t2 Thing\n    data := []byte(\"{ \\\"id\\\": \\\"abc\\\", \\\"values\\\": [1,2,3]}\")\n    data2 := []byte(\"{ \\\"id\\\": \\\"def\\\", \\\"values\\\": [\\\"elephant\\\", \\\"tomato\\\", \\\"arrow\\\"]}\")\n    _ = json.Unmarshal(data, &amp;t1)\n    _ = json.Unmarshal(data2, &amp;t2)\n    print(t1.Values)\n    print(t2.Values)\n}   \n</code></pre>\n"}], "owner": {"reputation": 4338, "user_id": 1061193, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d7ffbfe3211751d0cfe8c9fcda306c2b?s=128&d=identicon&r=PG", "display_name": "drum", "link": "https://stackoverflow.com/users/1061193/drum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 1, "accepted_answer_id": 50703292, "answer_count": 1, "score": -1, "last_activity_date": 1528211053, "creation_date": 1528204969, "last_edit_date": 1528206819, "question_id": 50701215, "link": "https://stackoverflow.com/questions/50701215/how-to-unmarshal-json-array-of-different-datatypes", "title": "How to unmarshal JSON array of different datatypes?", "body": "<p>Part of the JSON I'm trying to unmarshal has an array that can contain either strings or ints. How would I go about parsing this?</p>\n\n<pre><code>{\n    \"id\": \"abc\",\n    \"values\": [1,2,3]\n},\n{\n    \"id\": \"def\",\n    \"values\": [\"elephant\", \"tomato\", \"arrow\"]\n},\n{\n    //etc...\n}\n</code></pre>\n\n<p>I tried the following:</p>\n\n<pre><code>type Thing struct {\n    ID      string   `json:\"id\"`\n    Values  []string `json:\"values,string,omitempty\"`\n}\n</code></pre>\n\n<p>Get the following error:</p>\n\n<pre><code>panic: json: cannot unmarshal array into Go struct field Thing.values of type string\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda", "aws-lambda-go"], "answers": [{"tags": [], "owner": {"reputation": 407, "user_id": 1261057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/456e2da0d8fa5f2d68c6e0f3e0f24e22?s=128&d=identicon&r=PG", "display_name": "Ivan", "link": "https://stackoverflow.com/users/1261057/ivan"}, "is_accepted": true, "score": 12, "last_activity_date": 1568032514, "last_edit_date": 1568032514, "creation_date": 1528205957, "answer_id": 50701572, "question_id": 50700979, "link": "https://stackoverflow.com/questions/50700979/exec-format-error-when-running-aws-golang-lambda/50701572#50701572", "title": "exec format error when running AWS Golang Lambda", "body": "<p>The issue is that main() function is not declared in <code>main</code> package, which is mandatory by Golang <a href=\"https://golang.org/ref/spec#Program_execution\" rel=\"noreferrer\">language spec</a></p>\n"}, {"comments": [{"owner": {"reputation": 1176, "user_id": 163072, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/fF890.jpg?s=128&g=1", "display_name": "influent", "link": "https://stackoverflow.com/users/163072/influent"}, "edited": false, "score": 0, "creation_date": 1549923953, "post_id": 53735778, "comment_id": 96072077, "body": "hmm build in Windows 10 only works for me when &quot;GOOS=&quot;, and then I have to set &quot;GOARCH=amd64 GOOS=linux&quot; to get build-lambda-zip.exe to work"}, {"owner": {"reputation": 1176, "user_id": 163072, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/fF890.jpg?s=128&g=1", "display_name": "influent", "link": "https://stackoverflow.com/users/163072/influent"}, "edited": false, "score": 0, "creation_date": 1549925436, "post_id": 53735778, "comment_id": 96072577, "body": "running &quot;go get -u golang.org/x/crypto/md4&quot; fixed the issue for me, not sure why I had to do that"}], "tags": [], "owner": {"reputation": 605, "user_id": 4156975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c000f292a92b894afabbb352e8709667?s=128&d=identicon&r=PG", "display_name": "Toshinori Sugita", "link": "https://stackoverflow.com/users/4156975/toshinori-sugita"}, "is_accepted": false, "score": 37, "last_activity_date": 1544586467, "creation_date": 1544586467, "answer_id": 53735778, "question_id": 50700979, "link": "https://stackoverflow.com/questions/50700979/exec-format-error-when-running-aws-golang-lambda/53735778#53735778", "title": "exec format error when running AWS Golang Lambda", "body": "<p>You have to build with <code>GOARCH=amd64 GOOS=linux</code>.\nWherever you build your binary, the binary for Lambda is run on Amazon Linux.</p>\n\n<p>So , try this build command.</p>\n\n<p><code>GOARCH=amd64 GOOS=linux go build handler.go</code></p>\n"}], "owner": {"reputation": 407, "user_id": 1261057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/456e2da0d8fa5f2d68c6e0f3e0f24e22?s=128&d=identicon&r=PG", "display_name": "Ivan", "link": "https://stackoverflow.com/users/1261057/ivan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8364, "favorite_count": 1, "accepted_answer_id": 50701572, "answer_count": 2, "score": 16, "last_activity_date": 1568032514, "creation_date": 1528204349, "last_edit_date": 1528206318, "question_id": 50700979, "link": "https://stackoverflow.com/questions/50700979/exec-format-error-when-running-aws-golang-lambda", "title": "exec format error when running AWS Golang Lambda", "body": "<p>I have a go application, structured like this:</p>\n\n<p>cmd<br/>|<br/>reports<br/>|<br/>main.go</p>\n\n<p>main.go imports <code>internal/reports</code> package and has a single function, main(), which delegates call to <code>aws-lambda-go/lambda.Start()</code> function.</p>\n\n<p>Code is build running the commands (snippet):</p>\n\n<pre><code>cd internal/reports &amp;&amp; go build handler.go\ncd ../..\ngo build -o reports ../cmd/reports/main.go &amp;&amp; chmod +x reports &amp;&amp; zip reports.zip reports\n</code></pre>\n\n<p><code>reports.zip</code> is uploaded to AWS Lambda, which in turns throws an error when <code>Test</code> button is pressed:</p>\n\n<pre><code>{\n  \"errorMessage\": \"fork/exec /var/task/reports: exec format error\",\n  \"errorType\": \"PathError\"\n}\n</code></pre>\n\n<p><code>reports</code> is set as Lambda's <code>Handler</code>.</p>\n\n<p>Also, code is build on Ubuntu 14.04 machine, as a part of <code>aws/codebuild/ubuntu-base:14.04</code> Docker Image, on <strong>AWS CodeBuild</strong>. There should be no environment issues here, even though the error suggests a cross-platform problem.</p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["mongodb", "go", "gridfs", "fileserver"], "comments": [{"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 0, "creation_date": 1528197919, "post_id": 50698848, "comment_id": 88406941, "body": "Why should it be any different? The GridFS implementations all make the output &quot;look like a file&quot;. So it&#39;s just the same as reading any file handle and returning the content."}], "answers": [{"comments": [{"owner": {"reputation": 132, "user_id": 4876035, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-s_DbjLLdh_M/AAAAAAAAAAI/AAAAAAAAG8A/oU9HnzSh4Is/photo.jpg?sz=128", "display_name": "Wim", "link": "https://stackoverflow.com/users/4876035/wim"}, "edited": false, "score": 0, "creation_date": 1528198730, "post_id": 50699037, "comment_id": 88407430, "body": "I was thinking about that but had hoped that there would be another solution with which I could serve the file directly..."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 132, "user_id": 4876035, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-s_DbjLLdh_M/AAAAAAAAAAI/AAAAAAAAG8A/oU9HnzSh4Is/photo.jpg?sz=128", "display_name": "Wim", "link": "https://stackoverflow.com/users/4876035/wim"}, "edited": false, "score": 0, "creation_date": 1528202164, "post_id": 50699037, "comment_id": 88409747, "body": "@WimVanLaer Once you have the <code>GridFile</code> open, it&#39;s a single line: <code>http.ServeContent()</code>. What simpler do you wish for? Obviously how a source is opened is specific to the source. You may create a utility function to which you just pass the <code>w</code>, <code>r</code> and <code>name</code> params if you need to use this in multiple places."}, {"owner": {"reputation": 132, "user_id": 4876035, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-s_DbjLLdh_M/AAAAAAAAAAI/AAAAAAAAG8A/oU9HnzSh4Is/photo.jpg?sz=128", "display_name": "Wim", "link": "https://stackoverflow.com/users/4876035/wim"}, "edited": false, "score": 0, "creation_date": 1528203485, "post_id": 50699037, "comment_id": 88410595, "body": "oh I forgot that the GridFile implements the seeker file, misread that part... my bad"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1528198739, "last_edit_date": 1528198739, "creation_date": 1528198333, "answer_id": 50699037, "question_id": 50698848, "link": "https://stackoverflow.com/questions/50698848/how-to-serve-a-file-from-mongodb-with-golang/50699037#50699037", "title": "How to serve a file from mongodb with golang", "body": "<p>Tip: Recommended to use <a href=\"https://github.com/globalsign/mgo\" rel=\"nofollow noreferrer\"><code>github.com/globalsign/mgo</code></a> instead of <code>gopkg.in/mgo.v2</code> (the latter is not maintained anymore).</p>\n\n<hr>\n\n<p>The <a href=\"https://godoc.org/github.com/globalsign/mgo#GridFS.Open\" rel=\"nofollow noreferrer\"><code>mgo.GridFile</code></a> type implements <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\"><code>io.Reader</code></a>, so you could use <a href=\"https://golang.org/pkg/io/#Copy\" rel=\"nofollow noreferrer\"><code>io.Copy()</code></a> to copy its content into the <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow noreferrer\"><code>http.ResponseWriter</code></a>.</p>\n\n<p>But since <code>mgo.GridFile</code> also implements <a href=\"https://golang.org/pkg/io/#Seeker\" rel=\"nofollow noreferrer\"><code>io.Seeker</code></a>, you may take advantage of <a href=\"https://golang.org/pkg/net/http/#ServeContent\" rel=\"nofollow noreferrer\"><code>http.ServeContent()</code></a>. Quoting its doc:</p>\n\n<blockquote>\n  <p>The main benefit of ServeContent over io.Copy is that it handles Range requests properly, sets the MIME type, and handles If-Match, If-Unmodified-Since, If-None-Match, If-Modified-Since, and If-Range requests.</p>\n</blockquote>\n\n<p>Example handler serving a file:</p>\n\n<pre><code>func serveFromDB(w http.ResponseWriter, r *http.Request) {\n    var gridfs *mgo.GridFS // Obtain GridFS via Database.GridFS(prefix)\n\n    name := \"somefile.pdf\"\n    f, err := gridfs.Open(name)\n    if err != nil {\n        log.Printf(\"Failed to open %s: %v\", name, err)\n        http.Error(w, \"something went wrong\", http.StatusInternalServerError)\n        return\n    }\n    defer f.Close()\n\n    http.ServeContent(w, r, name, time.Now(), f) // Use proper last mod time\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 324, "user_id": 5388438, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-8vDH5qSd-Ks/AAAAAAAAAAI/AAAAAAAAAEs/uEKhkeq_B2k/photo.jpg?sz=128", "display_name": "Irrfan23", "link": "https://stackoverflow.com/users/5388438/irrfan23"}, "is_accepted": false, "score": 0, "last_activity_date": 1604773253, "creation_date": 1604773253, "answer_id": 64730982, "question_id": 50698848, "link": "https://stackoverflow.com/questions/50698848/how-to-serve-a-file-from-mongodb-with-golang/64730982#64730982", "title": "How to serve a file from mongodb with golang", "body": "<p>its old but i got another solution with goMongo driver by importing<br />\n<code>&quot;go.mongodb.org/mongo-driver/mongo/gridfs&quot;</code></p>\n<pre><code>var bucket *gridfs.Bucket //creates a bucket\ndbConnection, err := db.GetDBCollection() //connect db with your your\nif err != nil {\n    log.Fatal(err)\n}\nbucket, err = gridfs.NewBucket(dbConnection)\nif err != nil {\n    log.Fatal(err)\n}\nname := &quot;br100_update.txt&quot;\ndownloadStream, err := bucket.OpenDownloadStreamByName(name)\nif err != nil {\n    log.Printf(&quot;Failed to open %s: %v&quot;, name, err)\n    http.Error(w, &quot;something went wrong&quot;, http.StatusInternalServerError)\n    return\n}\ndefer func() {\n    if err := downloadStream.Close(); err != nil {\n        log.Fatal(err)\n    }\n}()\n\n// Use SetReadDeadline to force a timeout if the download does not succeed in \n// 2 seconds.\n if err = downloadStream.SetReadDeadline(time.Now().Add(2 * time.Second)); err \n  != nil {\n  log.Fatal(err)\n }\n</code></pre>\n<p>// this code below use to read the file</p>\n<pre><code> fileBuffer := bytes.NewBuffer(nil)\n if _, err := io.Copy(fileBuffer, downloadStream); err != nil {\n  log.Fatal(err)\n</code></pre>\n<p>}</p>\n"}], "owner": {"reputation": 132, "user_id": 4876035, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-s_DbjLLdh_M/AAAAAAAAAAI/AAAAAAAAG8A/oU9HnzSh4Is/photo.jpg?sz=128", "display_name": "Wim", "link": "https://stackoverflow.com/users/4876035/wim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 886, "favorite_count": 4, "accepted_answer_id": 50699037, "answer_count": 2, "score": 1, "last_activity_date": 1604773253, "creation_date": 1528197729, "question_id": 50698848, "link": "https://stackoverflow.com/questions/50698848/how-to-serve-a-file-from-mongodb-with-golang", "title": "How to serve a file from mongodb with golang", "body": "<p>I am working on a go project where I need to serve files stored in mongodb. The files are stored in a GridFs. I use gopkg.in/mgo.v2 as package to connect and query the db.</p>\n\n<p>I can retrieve the file from the db, that is not hard.</p>\n\n<pre><code>f, err := s.files.OpenId(id)\n</code></pre>\n\n<p>But how can I serve that file with http?\nI work with the JulienSchmidt router to handle all the other restfull requests.\nThe solutions I find always use static files, not files from a db.</p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["go", "memory", "mutex"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1528198419, "post_id": 50698689, "comment_id": 88407239, "body": "Never, literally never ever make a sync.WhateverMutex a field of a struct. Always use a *sync.WahteverMutex because you <b>must</b> <b>not</b> copy a sync.Mutex. And during append to a slice elements may be copied. Also: You must prevent <i>all</i> modifications while appending, so individual protection must include a read lock on MyUsers. Probably you should redesign, but hard to tell."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1528203482, "post_id": 50698689, "comment_id": 88410588, "body": "@Volker: Mutex values are extremely common and idiomatic, both embedded and as a named field. Also, <code>go vet</code> warns about copying mutex values if you don&#39;t use a pointer to the struct. I don&#39;t think there&#39;s actually a single <code>*sync.Mutex</code> field in the entire std library."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1528205115, "post_id": 50698689, "comment_id": 88411737, "body": "@JimB Yes, if the struct containing the Mutex is always passed via a pointer this is fine. OP&#39;s <code>var MyUsers []User</code> and <code>var MyUsers []User</code>do not fall under this category. I admit the advise was too strong."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1528205290, "post_id": 50698689, "comment_id": 88411878, "body": "@Volker: yes, the <code>[]User</code> type is the issue here, though literally writing <i>any</i> test at all will fail when the mutex is copied, so I would hope one never gets very far with that."}], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 3284667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c29f95ccace2f22a5566c6b827c96d8?s=128&d=identicon&r=PG&f=1", "display_name": "user3284667", "link": "https://stackoverflow.com/users/3284667/user3284667"}, "edited": false, "score": 1, "creation_date": 1528301157, "post_id": 50700318, "comment_id": 88458075, "body": "Thanks for the advice.  I have changed the slice to store pointers instead of values, I have also changed the mutex to be a pointer inside the struct.  This post and everyones comments above (thanks Jim and Volker also) has made me understand and also taught me that i should really think about what types to use during situations like these, rather then just rushing and writing out fields without actually thinking about each specific field and what ill be doing with it."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 3, "last_activity_date": 1528202422, "creation_date": 1528202422, "answer_id": 50700318, "question_id": 50698689, "link": "https://stackoverflow.com/questions/50698689/managing-slices-with-mutex-for-performance-in-golang/50700318#50700318", "title": "Managing slices with mutex for performance in golang", "body": "<p>As you already noticed, it is not safe cause <code>append</code> might need to allocate a new array if capacity is exceeded, and this will cause the elements to be copied into the new array.</p>\n\n<p>However, you could store pointers in your <code>MyUsers</code> slice instead of values:</p>\n\n<pre><code>var MyUsers []*User\n</code></pre>\n\n<p>If you do this, then there wouldn't be an issue when allocating a new array since the pointers will be moved around, but still pointing to the same underlying <code>User</code> structs.</p>\n\n<p>Also, as noted in the comments, it'd be better to use a pointer to the <code>Mutex</code> in the <code>User</code> struct just in case:</p>\n\n<pre><code>Mutex *sync.RWMutex\n</code></pre>\n\n<p>But it'd be even better if you design your code so that you never make a copy of a <code>User</code> object and you always pass the pointers around.</p>\n"}], "owner": {"reputation": 61, "user_id": 3284667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c29f95ccace2f22a5566c6b827c96d8?s=128&d=identicon&r=PG&f=1", "display_name": "user3284667", "link": "https://stackoverflow.com/users/3284667/user3284667"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1244, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1528202422, "creation_date": 1528197204, "last_edit_date": 1528197756, "question_id": 50698689, "link": "https://stackoverflow.com/questions/50698689/managing-slices-with-mutex-for-performance-in-golang", "title": "Managing slices with mutex for performance in golang", "body": "<p>I have a struct as follows.</p>\n\n<pre><code>type User struct {\n    Mutex sync.RWMutex\n    Username string\n    Stuff map[string]string\n}\n</code></pre>\n\n<p>I also have the following globally </p>\n\n<pre><code>var MyUsers []User\nvar UserMutex sync.RWMutex\n</code></pre>\n\n<p>Since my application is accessing the MyUsers slice thousands of times per second, I thought this would be the best way to manage performance. If i want to modify a seperate MyUsers element, then i lock that specific element with:</p>\n\n<pre><code>MyUsers[x].Mutex.Lock()\n</code></pre>\n\n<p>Then perform any modifications and unlock it.</p>\n\n<p>My question is, Is this a safe way of doing this? I have the normal global UserMutex to lock the slice only when I am appending to the slice... But when appending to a slice, are all of the existing elements moved in memory? </p>\n\n<p>What happens if 1 thread appends to the slice, at the same time whilst another thread is modifying an element? Can this happen in the setup above?</p>\n\n<p>Could i potentially, allocate a big enough slice using make() so that any append()'s wont effect the place in memory?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1528194892, "post_id": 50697914, "comment_id": 88404948, "body": "<code>item := *Item{}</code> should be <code>item := &amp;Item{}</code>"}], "answers": [{"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1528199224, "post_id": 50698006, "comment_id": 88407756, "body": "This may be obvious but just to be sure OP ought to also update the return type from <code>Item</code> to <code>*Item</code> in the <code>Handler</code>s declaration."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1528201819, "post_id": 50698006, "comment_id": 88409544, "body": "@mkopriva: Updated, included the <code>UnmarshalMap</code> bit so <code>item</code> is being passed correctly based on how the var is initialised"}, {"owner": {"reputation": 707, "user_id": 4570472, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16ce4584a6641e5c7ed1141ba7fd6800?s=128&d=identicon&r=PG&f=1", "display_name": "Rylan Schaeffer", "link": "https://stackoverflow.com/users/4570472/rylan-schaeffer"}, "edited": false, "score": 1, "creation_date": 1548704451, "post_id": 50698006, "comment_id": 95629093, "body": "Can someone explain <i>why</i> one cannot merely <code>return nil, err</code> without first declaring <code>item := &amp;Item{}</code> or <code>item := Item{}</code>?"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "reply_to_user": {"reputation": 707, "user_id": 4570472, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/16ce4584a6641e5c7ed1141ba7fd6800?s=128&d=identicon&r=PG&f=1", "display_name": "Rylan Schaeffer", "link": "https://stackoverflow.com/users/4570472/rylan-schaeffer"}, "edited": false, "score": 0, "creation_date": 1548704820, "post_id": 50698006, "comment_id": 95629263, "body": "@RylanSchaeffer because <code>item</code> is passed as an argument to <code>UnmarshalMap</code>. If you don&#39;t declare it, you can&#39;t use it (ie pass it as an argument). You need the variable before you use it. If you don&#39;t want to allocate any memory unless you need to, just replace <code>item := Item{}</code>, with <code>var item Item</code>, pass it as <code>&amp;item</code> to the <code>UnmarshalMap</code> call, and return <code>&amp;item</code> on success, <code>nil</code> on error. <code>var item Item</code> won&#39;t allocate the object unless until it&#39;s needed, it&#39;s mentioned in the language spec somewhere."}], "tags": [], "owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "is_accepted": true, "score": 45, "last_activity_date": 1528201786, "last_edit_date": 1528201786, "creation_date": 1528195046, "answer_id": 50698006, "question_id": 50697914, "link": "https://stackoverflow.com/questions/50697914/return-nil-for-a-struct-in-go/50698006#50698006", "title": "Return nil for a struct in Go", "body": "<p>You're assigning your <code>item</code> variable wrong. You said you tried <code>item := *Item{}</code>, whereas the way to create a pointer is either through the use of the <code>new</code> builtin, or to create a literal, and the address-of operator (<code>&amp;</code>). The latter is the approach you'll most commonly see in golang. There are some cases where one would use <code>new</code>, but in this case, I'd go for the second approach:</p>\n\n<p>So either:</p>\n\n<pre><code>item := &amp;Item{}\n// or\nitem := new(Item)\n</code></pre>\n\n<p>Lastly, you can keep the code as-is, and just return a pointer at the end:</p>\n\n<pre><code>item := Item{}\n// some code here\nreturn &amp;item, nil\n</code></pre>\n\n<p>In case where you have to return an error, you can still have <code>return nil, err</code></p>\n\n<p>So putting everything together:</p>\n\n<pre><code>// return *Item instead of Item\nfunc Handler(request Request) (*Item, error) {\n   // your code here, eg:\n   item := Item{}\n   if err := dynamodbattribute.UnmarshalMap(result.Item, &amp;item); err != nil {\n        return nil, err\n    }\n    return &amp;item, nil\n}\n</code></pre>\n\n<p>Alternatively, assign <code>item</code> as a pointer from the start</p>\n\n<pre><code>func Handler(request Request) (*Item, error) {\n   // your code here, eg:\n   item := &amp;Item{}\n   if err := dynamodbattribute.UnmarshalMap(result.Item, item); err != nil {\n        return nil, err\n    }\n    return item, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 3221, "user_id": 830230, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/YMFTp.jpg?s=128&g=1", "display_name": "Naguib Ihab", "link": "https://stackoverflow.com/users/830230/naguib-ihab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32808, "favorite_count": 0, "accepted_answer_id": 50698006, "answer_count": 1, "score": 29, "last_activity_date": 1566150204, "creation_date": 1528194738, "last_edit_date": 1566150204, "question_id": 50697914, "link": "https://stackoverflow.com/questions/50697914/return-nil-for-a-struct-in-go", "title": "Return nil for a struct in Go", "body": "<p>I am connecting to a database, getting a row and then sending it back to the user. What I want to do though is have a <code>return</code> statement if I can't find that row or if I have an error.</p>\n\n<p>Because I'm returning a struct I can't return nil and I get that error <code>cannot use nil as type Item in return argument</code> (Item is my struct)</p>\n\n<p>I read online that if I use a pointer in the return statement and return *Item instead of Item then I'd be able to pass nil, when I try to create <code>item := *Item{}</code> I get the following error <code>invalid indirect of Item literal (type Item)</code></p>\n\n<p>I think there are a few solutions to this but I can't find any, what I really want to know is:</p>\n\n<ul>\n<li>How to return a pointer *Item instead of Item</li>\n<li>Is there another way to return nil for a struct?</li>\n</ul>\n\n<p>Here's my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/aws/aws-lambda-go/lambda\"\n\n  \"github.com/aws/aws-sdk-go/aws\"\n  \"github.com/aws/aws-sdk-go/aws/session\"\n  \"github.com/aws/aws-sdk-go/service/dynamodb\"\n  \"github.com/aws/aws-sdk-go/service/dynamodb/dynamodbattribute\"\n)\n\ntype Request struct {\n    Name string `json:\"name\"`\n}\n\ntype Item struct {\n  Name string `json:\"name\"`\n  Stock int `json:\"stock\"`\n  Price float64 `json:\"price\"`\n}\n\nfunc Handler(request Request) (Item, error) {\n  sess, err := session.NewSession(&amp;aws.Config{\n    Region: aws.String(\"us-west-2\")},\n  )\n\n  // Create DynamoDB client\n  svc := dynamodb.New(sess)\n\n  result, err := svc.GetItem(&amp;dynamodb.GetItemInput{\n    TableName: aws.String(\"Inventory\"),\n    Key: map[string]*dynamodb.AttributeValue{\n      \"name\": {\n          S: aws.String(request.Name),\n      },\n    },\n  })\n\n  if err != nil {\n    fmt.Println(err.Error())\n//     return nil, err\n  }\n\n  item := Item{}\n\n  err = dynamodbattribute.UnmarshalMap(result.Item, &amp;item)\n\n  if err != nil {\n    panic(fmt.Sprintf(\"Failed to unmarshal Record, %v\", err))\n//     return nil, err\n  }\n\n  if item.Name == \"\" {\n      fmt.Println(\"Could not find item\")\n//       return nil, nil\n  }\n\n  fmt.Println(\"Found item:\")\n  fmt.Println(\"Name:  \", item.Name)\n  fmt.Println(\"Stock: \", item.Stock)\n  fmt.Println(\"Price:  \", item.Price)\n\n    return item, nil\n}\n\nfunc main() {\n    lambda.Start(Handler)\n}\n</code></pre>\n"}, {"tags": ["arrays", "go", "multidimensional-array", "go-gin"], "comments": [{"owner": {"reputation": 1104, "user_id": 6438430, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5VRc3dZXdns/AAAAAAAAAAI/AAAAAAAAAeI/nemPXRtg3JU/photo.jpg?sz=128", "display_name": "Ashish Tiwari", "link": "https://stackoverflow.com/users/6438430/ashish-tiwari"}, "edited": false, "score": 0, "creation_date": 1528197261, "post_id": 50696418, "comment_id": 88406540, "body": "Hi sid, what is  exact requirement ? can you explain bit more ?"}, {"owner": {"reputation": 3, "user_id": 3156981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62001ae82580350d4b49cb4121fc8eb5?s=128&d=identicon&r=PG&f=1", "display_name": "Sandip", "link": "https://stackoverflow.com/users/3156981/sandip"}, "reply_to_user": {"reputation": 1104, "user_id": 6438430, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5VRc3dZXdns/AAAAAAAAAAI/AAAAAAAAAeI/nemPXRtg3JU/photo.jpg?sz=128", "display_name": "Ashish Tiwari", "link": "https://stackoverflow.com/users/6438430/ashish-tiwari"}, "edited": false, "score": 0, "creation_date": 1528197645, "post_id": 50696418, "comment_id": 88406768, "body": "Hi Ashish, i am using Golang&#39;s GIN framework for development of REST API&#39;s. In which i am facing the problem in making the associative array. For a reference  i have mentioned my PHP code which i want to convert in go format."}], "answers": [{"tags": [], "owner": {"reputation": 1104, "user_id": 6438430, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5VRc3dZXdns/AAAAAAAAAAI/AAAAAAAAAeI/nemPXRtg3JU/photo.jpg?sz=128", "display_name": "Ashish Tiwari", "link": "https://stackoverflow.com/users/6438430/ashish-tiwari"}, "is_accepted": true, "score": 2, "last_activity_date": 1528285090, "last_edit_date": 1528285090, "creation_date": 1528204603, "answer_id": 50701083, "question_id": 50696418, "link": "https://stackoverflow.com/questions/50696418/how-to-create-multidimensional-key-value-array-slice-in-golang/50701083#50701083", "title": "How to create Multidimensional Key Value array/slice in GoLang", "body": "<p>Hope below code will help you out. Make struct according to your JSON. </p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"encoding/json\"\n    \"fmt\"\n)   \n\ntype Resp struct {\n    Spf Param `json:\"spf\"`\n}   \n\ntype Param struct {\n    Is_verified    int            `json:\"is_verified\"`\n    Spf_matched    int            `json:\"spf_matched\"`\n    Required_value string         `json:\"required_value\"`\n    Current_value  map[int]string `json:\"current_value\"`\n}   \n\nfunc main() {\n\n    str := make(map[int]string)\n\n    str[0] = \"v=spf1 a -all,\"\n    resp := Resp{Spf: Param{Is_verified: 0, Spf_matched: 0, Required_value: \"v=spf1 a  include:32782.pppp.com ~all\", Current_value: str}}\n    js, _ := json.Marshal(resp)\n    fmt.Printf(\"%s\", js) \n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 3156981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62001ae82580350d4b49cb4121fc8eb5?s=128&d=identicon&r=PG&f=1", "display_name": "Sandip", "link": "https://stackoverflow.com/users/3156981/sandip"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1505, "favorite_count": 0, "closed_date": 1528224201, "accepted_answer_id": 50701083, "answer_count": 1, "score": -4, "last_activity_date": 1597431003, "creation_date": 1528190167, "last_edit_date": 1597431003, "question_id": 50696418, "link": "https://stackoverflow.com/questions/50696418/how-to-create-multidimensional-key-value-array-slice-in-golang", "closed_reason": "Needs details or clarity", "title": "How to create Multidimensional Key Value array/slice in GoLang", "body": "<p>I have a <code>PHP</code> script in which i'hv created some array formats (data structures) which i want to convert the same array structure using <code>Golang</code>.</p>\n\n<p>Below is the array structure of my PHP script</p>\n\n<pre><code>   $response['spf']['current_value']  = $spfValue; // this will  be the array of strings\n   $response['spf']['required_value'] = \"v=spf1 a include:32782.pppp.com ~all\";            \n   $response['spf']['is_verified']    = $isValidSpf; //this will be int\n   $response['spf']['spf_matched']    = $isMatched;  //this will be int\n   print_r($response);\n</code></pre>\n\n<p>The outut of above script will be <code>Array</code> of key named SPF\n<pre></p>\n\n<code>[spf] =&gt; Array\n    (\n        [current_value] =&gt; Array\n            (\n                [0] =&gt; v=spf1 a -all,\n            )\n        [required_value] =&gt; v=spf1 a  include:32782.pppp.com ~all\n        [is_verified] =&gt; 0\n        [spf_matched] =&gt; 0\n    )\n</code></pre>\n\n<p>As i am a new in <code>golang</code> , Need some golang code which will return same output as per <code>PHP</code> script</p>\n"}, {"tags": ["http", "go", "tcp"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1528185739, "post_id": 50694559, "comment_id": 88399378, "body": "Well, the HTTO request will fail and the error will be one from package net indicating that dial failed. So: No, there is nothing to add: It already &quot;terminates&quot; the request if it doesnt find anything on the IP layer? Could you be more specific what doesn&#39;t work with the code shown?"}, {"owner": {"reputation": 39, "user_id": 9207347, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f98c9c48679234b547ba919ff7911dc5?s=128&d=identicon&r=PG&f=1", "display_name": "subhashree sahoo", "link": "https://stackoverflow.com/users/9207347/subhashree-sahoo"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528187826, "post_id": 50694559, "comment_id": 88400632, "body": "I am sending a packet to an apache server and i expect to receive an ACK within 2-3 seconds. But the http request is unable to process within that time."}, {"owner": {"reputation": 39, "user_id": 9207347, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f98c9c48679234b547ba919ff7911dc5?s=128&d=identicon&r=PG&f=1", "display_name": "subhashree sahoo", "link": "https://stackoverflow.com/users/9207347/subhashree-sahoo"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528188761, "post_id": 50694559, "comment_id": 88401142, "body": "But my http request is stuck in the ip layer with a searching process that exceeds my ACK time. Is there any feature or API for fire and forget in http to implement directly. (Without using any channeling mechanism)"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1528188860, "post_id": 50694559, "comment_id": 88401208, "body": "Okay. You need a http.Transport and fill in DialContext. Also take a look at package net. Please update the question."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1528198097, "post_id": 50694559, "comment_id": 88407060, "body": "Please update the question as suggested."}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1528192723, "post_id": 50695182, "comment_id": 88403619, "body": "This answer is incorrect: the timeout you&#39;re referring to works on a layer <i>above</i> TCP/IP, and covers not only the connection time but also the time to do the request (and fetch the server&#39;s response). It means that if you set it to, say, 3 seconds (as the OP wanted) and the <i>connection</i> will happen to complete in this time frame, the timeout will then have any possibility to reap the request in the middle of the actual data exchange."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1528193748, "post_id": 50695182, "comment_id": 88404226, "body": "To say that in other words: as I understood, the OP wanted to &quot;fail fast&quot; if the server appears to be dead\u2014while having a more generous timeout (or none at all) for the request to it to proceed normaly in the opposite case."}, {"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1528197875, "post_id": 50695182, "comment_id": 88406910, "body": "This could be, but this was merely suggested within comments after I posted this answer. Perhaps the OP should clarify."}], "tags": [], "owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "is_accepted": false, "score": 2, "last_activity_date": 1528186465, "last_edit_date": 1528186465, "creation_date": 1528186102, "answer_id": 50695182, "question_id": 50694559, "link": "https://stackoverflow.com/questions/50694559/terminate-http-request-from-ip-layer-using-golang/50695182#50695182", "title": "Terminate http request from IP layer using golang", "body": "<p>The default http Client has no timeout. You can create an explicit http.Client yourself and set the timeout:</p>\n\n<pre><code>var cl = &amp;http.Client{\n    Timeout: time.Second * 10,\n}\n\nresp, err := cl.Do(req)\n\nif err != nil {\n    // err will be set on timeout\n    return errors.Wrap(err, \"http request error\")\n}\ndefer resp.Body.Close()\n</code></pre>\n\n<p>If the server does not answer any more in the middle of a request, you can handle the timeout.</p>\n"}, {"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 1, "last_activity_date": 1528193404, "creation_date": 1528193404, "answer_id": 50697507, "question_id": 50694559, "link": "https://stackoverflow.com/questions/50694559/terminate-http-request-from-ip-layer-using-golang/50697507#50697507", "title": "Terminate http request from IP layer using golang", "body": "<p>Use a non-default <code>http.Transport</code> with its <code>DialContext</code> field set to a function which uses a custom context with the properly configured timeout/deadline.  Another option is to use a custom <code>net.Dialer</code>.</p>\n\n<p>Something like this:</p>\n\n<pre><code>cli := http.Client{\n    Transport: &amp;http.Transport{\n        DialContext: func (ctx context.Context, network, address string) (net.Conn, error) {\n            dialer := net.Dialer{\n                Timeout: 3 * time.Second,\n            }\n            return dialer.DialContext(ctx, network, address)\n        },\n    },\n}\n\nreq, err := http.NewRequest(...)\nresp, err := cli.Do(req)\n</code></pre>\n\n<p>Note that as per the <code>net.Dialer</code>'s docs the context passed to its <code>DialContext</code> might trump the timeout set on the dialer itself\u2014this is\nexactly what we need: the dialer's <code>Timeout</code> field controls exactly the\n\"dialing\" (TCP connection establishment) while you might also arm your\nHTTP request with a context (using <code>http.Request.WithContext</code>) controlling\nthe timeout of the whole request, and also be able to cancel it at any time (including the dialing step).</p>\n\n<p><a href=\"https://play.golang.org/p/tO058F954Cu\" rel=\"nofollow noreferrer\">Playground example</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1528299943, "post_id": 50708580, "comment_id": 88457329, "body": "Good tips, but the <code>IdleConnTimeout</code> appears to be offbeat here: it controls for how long a successfully established TCP connection will remain live <i>after the request which created it has completed</i> (and both sides during it agreed to keep the connection alive). A good think to tinker with for the case of many client requests going to the same server in a quick succession, but I think this has little to do with the OP&#39;s situation, so it&#39;s better not to confuse them more that they already are ;-)"}, {"owner": {"reputation": 113, "user_id": 9362398, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "brun", "link": "https://stackoverflow.com/users/9362398/brun"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1528383271, "post_id": 50708580, "comment_id": 88496313, "body": "@kostix some of the items listed in the example which were not directly spoke of I put in for illustrative purposes, to show the OP there are a number of items within the Transport documentation to familiarize themselves with."}], "tags": [], "owner": {"reputation": 113, "user_id": 9362398, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "brun", "link": "https://stackoverflow.com/users/9362398/brun"}, "is_accepted": false, "score": 1, "last_activity_date": 1528231151, "creation_date": 1528231151, "answer_id": 50708580, "question_id": 50694559, "link": "https://stackoverflow.com/questions/50694559/terminate-http-request-from-ip-layer-using-golang/50708580#50708580", "title": "Terminate http request from IP layer using golang", "body": "<p>The Transport @kostix refers to is definitely what you're looking for in this case.  Transports as well as Clients are safe for concurrent use as well.  But please <a href=\"https://golang.org/src/net/http/transport.go\" rel=\"nofollow noreferrer\">read about the Transport</a> (and I also advise reading about the Client as well) as there are a number of different ways to affect how you handle idle connections, not just the pre-mentioned DialContext.</p>\n\n<p>As you may want to set your <code>ResponseHeaderTimeout</code>:</p>\n\n<blockquote>\n  <p>ResponseHeaderTimeout, if non-zero, specifies the amount of\n    time to wait for a server's response headers after fully\n    writing the request (including its body, if any). This\n    time does not include the time to read the response body.</p>\n</blockquote>\n\n<p>Or, if you are using a secure connection, you may want to set your <code>TLSHandshakeTimeout</code>:</p>\n\n<blockquote>\n  <p>TLSHandshakeTimeout specifies the maximum amount of time waiting to\n    wait for a TLS handshake. Zero means no timeout.</p>\n</blockquote>\n\n<p>For readability and maintainability, I suggest also maybe creating a function to build your Client, something along the lines of:</p>\n\n<pre><code>func buildClient(timeout time.Duration) *http.Client {\n    tr := &amp;http.Transport{\n        IdleConnTimeout:       timeout,\n        ResponseHeaderTimeout: timeout,\n        TLSHandshakeTimeout:   timeout,\n    }\n    client := &amp;http.Client{\n        Transport: tr,\n        Timeout:   timeout,\n    }\n    return client\n}\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 9207347, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f98c9c48679234b547ba919ff7911dc5?s=128&d=identicon&r=PG&f=1", "display_name": "subhashree sahoo", "link": "https://stackoverflow.com/users/9207347/subhashree-sahoo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 342, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1528231151, "creation_date": 1528184069, "question_id": 50694559, "link": "https://stackoverflow.com/questions/50694559/terminate-http-request-from-ip-layer-using-golang", "title": "Terminate http request from IP layer using golang", "body": "<p>I am making an http post request to a server using golang. Suppose the server is currently turned off (Means the machine on which the server runs is turned off) then the request is stuck at the IP layer. So my program execution is unable to proceed further. It is unable to proceed to the Application layer. So is there any way in golang to stop this. \nI am using the following code.</p>\n\n<pre><code>req, err := http.NewRequest(\"POST\", url, bytes.NewReader(b))\n       if err != nil {\n               return errors.Wrap(err, \"new request error\")\n       }\nresp, err := http.DefaultClient.Do(req)\n       if err != nil {\n               return errors.Wrap(err, \"http request error\")\n       }\n       defer resp.Body.Close()\n</code></pre>\n\n<p>Is there anything that can be added to this, to terminate the request if it doesn't find anything from the IP layer.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1528202867, "last_edit_date": 1528202867, "creation_date": 1528182939, "answer_id": 50694225, "question_id": 50693622, "link": "https://stackoverflow.com/questions/50693622/broadcast-server-end-messages-to-clients-using-websockets/50694225#50694225", "title": "Broadcast server end messages to clients using Websockets", "body": "<p>It looks like you are starting from the <a href=\"https://github.com/gorilla/websocket/tree/master/examples/chat\" rel=\"nofollow noreferrer\">Gorilla chat example</a>. In that example, use <code>hub.broadcast &lt;- message</code> to broadcast a message to all clients where <code>hub</code> is the <code>*Hub</code> created in <code>main()</code>.</p>\n\n<p>There's no need to create a client connection to send message originated from the server. </p>\n\n<p>Here's a modified version of the main() that broadcasts \"hello\" to all clients every second:</p>\n\n<pre><code>func broadcast(hub *Hub) {\n    m := []byte(\"hello\")\n    for range time.NewTicker(time.Second).C {\n        hub.broadcast &lt;- m\n    }\n}\n\nfunc main() {\n    flag.Parse()\n    hub := newHub()\n    go hub.run()\n    go broadcast(hub)\n    http.HandleFunc(\"/\", serveHome)\n    http.HandleFunc(\"/ws\", func(w http.ResponseWriter, r *http.Request) {\n        serveWs(hub, w, r)\n    })\n    err := http.ListenAndServe(*addr, nil)\n    if err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 6629606, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-iKfIfx9UYZ8/AAAAAAAAAAI/AAAAAAAAAFQ/J-TsF-3BVE4/photo.jpg?sz=128", "display_name": "cobalt27", "link": "https://stackoverflow.com/users/6629606/cobalt27"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 621, "favorite_count": 0, "accepted_answer_id": 50694225, "answer_count": 1, "score": 1, "last_activity_date": 1528313552, "creation_date": 1528180821, "last_edit_date": 1528313552, "question_id": 50693622, "link": "https://stackoverflow.com/questions/50693622/broadcast-server-end-messages-to-clients-using-websockets", "title": "Broadcast server end messages to clients using Websockets", "body": "<p>I am new to Golang, I am trying to a create a WebSocket server which will broadcast messages to the connected clients. The messages here will be generated from the server side(by creating a default client).</p>\n\n<p>Here is my client.go</p>\n\n<pre><code>c, _, err := websocket.DefaultDialer.Dial(u.String(), nil)\nif err != nil {\n    log.Fatal(\"dial:\", err)\n}\ndefer c.Close()\ndone := make(chan struct{})\nnew_chan := make(chan string)\n//defer new_chan.Stop()\ngo func() {\n    for {\n        new_chan &lt;- \"my message\"\n    }\n}()\n\nhub := newHub()\ngo hub.run()\nclient := &amp;Client{hub: hub, ws: c, send: make(chan []byte, 256)}\n\nfor {\n    select {\n    case &lt;-done:\n        return\n    case t := &lt;-new_chan:\n        err := c.WriteMessage(websocket.TextMessage, []byte(t))\n        if err != nil {\n            log.Println(\"write:\", err)\n            return\n        }\n        log.Printf(t)\n        client.hub.broadcast &lt;- bytes.TrimSpace(bytes.Replace([]byte(t), newline, space, -1))\n    }\n}\n</code></pre>\n\n<p>this function will generate the messages and try to broadcast to other clients.</p>\n\n<p>server.go will add the clients to the hub</p>\n\n<pre><code>func echo(w http.ResponseWriter, r *http.Request) {\nc, err := upgrader.Upgrade(w, r, nil)\nif err != nil {\n    log.Print(\"upgrade:\", err)\n    return\n}\nhub := newHub()\ngo hub.run()\n\nclient := &amp;Client{hub: hub, ws: c, send: make(chan []byte, 256)}\nclient.hub.register &lt;- client\n\ngo client.writePump()\n</code></pre>\n\n<p>writePump() here will listen to the client.send channel and broadcast messages\nNow the connected client's hub is different is from the hub of the client at the server. So when I try to send messages, I am not receiving anything.\nHow can I make it belong to the same hub(context)?</p>\n"}, {"tags": ["unit-testing", "go", "google-api", "client", "google-api-client"], "answers": [{"tags": [], "owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "is_accepted": true, "score": 0, "last_activity_date": 1528182370, "creation_date": 1528182370, "answer_id": 50694044, "question_id": 50693560, "link": "https://stackoverflow.com/questions/50693560/unit-testing-googles-go-api-client/50694044#50694044", "title": "Unit Testing Google&#39;s Go API Client", "body": "<p>Make the base url in your servicemanagement service configurable or overwritable, and if that is hidden for you, then your code is not written for test convenience, change that, and if not possible, complain to who is responsible. If that does not help, take a deep breath, and write a mock service, which is mostly not needed to be very complicated</p>\n"}, {"tags": [], "owner": {"reputation": 3629, "user_id": 1744107, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/91748b7203b0ef849403e8099da4528f?s=128&d=identicon&r=PG", "display_name": "Rambatino", "link": "https://stackoverflow.com/users/1744107/rambatino"}, "is_accepted": false, "score": 0, "last_activity_date": 1552359032, "creation_date": 1552359032, "answer_id": 55113407, "question_id": 50693560, "link": "https://stackoverflow.com/questions/50693560/unit-testing-googles-go-api-client/55113407#55113407", "title": "Unit Testing Google&#39;s Go API Client", "body": "<p>What I'd recommend is creating your own interface that wraps the google api client and extract the methods that you're interested in.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type MyWrapperClient interface {\n   SomeMethodWithCorrectReturnType() \n} \n\ntype myWrapperClient struct {\n  *GCloudService.Client // or whatever \n}\n</code></pre>\n\n<p>In the directory I'd then run:</p>\n\n<p><code>mockery -name=MyWrapperClient</code> inside the directory (after installing mockery)</p>\n\n<p>and then you can access your mocked version. Then on object creation substitute your mock in for your client - as the interface and the mock have the same methods they are interchangeable. Then you can test whether methods are called with specific params - leaving the google api client code alone.</p>\n\n<p>More information on the mockery library is here: <a href=\"https://github.com/vektra/mockery\" rel=\"nofollow noreferrer\">https://github.com/vektra/mockery</a></p>\n\n<p>This article solves your same problem and it's absolutely fantastic in explaining how to mock and abstract your concerns away.</p>\n\n<p><a href=\"https://medium.com/agrea-technogies/mocking-dependencies-in-go-bb9739fef008\" rel=\"nofollow noreferrer\">https://medium.com/agrea-technogies/mocking-dependencies-in-go-bb9739fef008</a></p>\n"}], "owner": {"reputation": 13, "user_id": 9302276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a0a6617fa1ae59228a528f6b24f30e7?s=128&d=identicon&r=PG&f=1", "display_name": "Hannah", "link": "https://stackoverflow.com/users/9302276/hannah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 726, "favorite_count": 0, "accepted_answer_id": 50694044, "answer_count": 2, "score": 1, "last_activity_date": 1552359032, "creation_date": 1528180608, "question_id": 50693560, "link": "https://stackoverflow.com/questions/50693560/unit-testing-googles-go-api-client", "title": "Unit Testing Google&#39;s Go API Client", "body": "<p>I am currently writing a workflow in Go that uses Google's <a href=\"https://github.com/google/google-api-go-client\" rel=\"nofollow noreferrer\">API go client</a>.  I'm relatively new to Go and am having trouble unit testing the client's services. Here is an example method that enables an API in a Google Cloud Project. </p>\n\n<pre><code>func (gcloudService *GCloudService) EnableApi(projectId string, apiId string) error {\n  service, err := servicemanagement.New(gcloudService.Client)\n  if err != nil {\n      return err\n  }\n\n  requestBody := &amp;servicemanagement.EnableServiceRequest{\n      ConsumerId: consumerId(projectId),\n  }\n\n  _, err = service.Services.Enable(apiId, requestBody).Do()\n  if err != nil {\n      return err\n  }\n\n  return nil\n}\n</code></pre>\n\n<p><code>GCloudService</code> is a simple struct that holds a Client.</p>\n\n<pre><code>type GCloudService struct {\n   Client *http.Client\n}\n</code></pre>\n\n<p>This is my attempt at testing this method.</p>\n\n<pre><code>var (\n  mux    *http.ServeMux\n  client *http.Client\n  server *httptest.Server\n)\n\nfunc setup() {\n  // test server\n  mux = http.NewServeMux()\n  server = httptest.NewServer(mux)\n\n  // client configured to use test server\n  client = server.Client()\n}\n\nfunc teardown() {\n  server.Close()\n}\n\nfunc TestGCloudService_EnableApi(t *testing.T) {\n  setup()\n  defer teardown()\n\n  projectName := \"test\"\n  apiId := \"api\"\n\n  testGcloudService := &amp;GCloudService{\n     Client: client,\n  }\n\n  path := fmt.Sprintf(\"/v1/services/{%s}:enable\", apiId)\n\n  mux.HandleFunc(path,\n    func(w http.ResponseWriter, r *http.Request) {\n        // test things...\n    })\n\n  err := testGcloudService.EnableApi(projectName, apiId)\n  if err != nil {\n      t.Errorf(\"EnableApi returned error: %v\", err)\n  }\n}\n</code></pre>\n\n<p>However, when I run this test it still hits the real Google endpoint instead of my localhost server because EnableApi uses the servicemanagement service which is configured with the API's base URL. How do I refactor this to call my server instead of the API? I am hoping to avoid mocking the entire servicemanagement service if possible.</p>\n"}, {"tags": ["amazon-web-services", "go"], "answers": [{"tags": [], "owner": {"reputation": 2644, "user_id": 818510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7ea3e2231b2ee182e14b2d002638b371?s=128&d=identicon&r=PG", "display_name": "user818510", "link": "https://stackoverflow.com/users/818510/user818510"}, "is_accepted": true, "score": 2, "last_activity_date": 1528217824, "creation_date": 1528217824, "answer_id": 50705343, "question_id": 50691728, "link": "https://stackoverflow.com/questions/50691728/aws-single-session-or-multiple-sessions/50705343#50705343", "title": "AWS single session OR multiple sessions?", "body": "<p>It's recommended to reuse the session if possible.</p>\n\n<p>From the AWS Go SDK <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/aws/session/\" rel=\"nofollow noreferrer\">docs</a>:</p>\n\n<blockquote>\n  <p>Sessions should be cached when possible, because <strong>creating a new\n  Session will load all configuration values from the environment, and\n  config files each time the Session is created.</strong> Sharing the Session\n  value across all of your service clients will ensure the configuration\n  is loaded the fewest number of times possible.</p>\n</blockquote>\n"}], "owner": {"reputation": 136, "user_id": 8451486, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3WNzH.jpg?s=128&g=1", "display_name": "Deepak Kumar", "link": "https://stackoverflow.com/users/8451486/deepak-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 502, "favorite_count": 1, "accepted_answer_id": 50705343, "answer_count": 1, "score": 1, "last_activity_date": 1528217824, "creation_date": 1528170681, "question_id": 50691728, "link": "https://stackoverflow.com/questions/50691728/aws-single-session-or-multiple-sessions", "title": "AWS single session OR multiple sessions?", "body": "<p>I am creating an application in Golang hosted on AWS cloud, that uses multiple AWS services i.e. S3, DynamoDB, Parameter Store.</p>\n\n<p>Currently Individual modules handing each AWS service has their own AWS session.</p>\n\n<pre><code>awsSession, err := session.NewSession(&amp;aws.Config{Region: aws.String(os.Getenv(\"AWS_REGION\"))})\n</code></pre>\n\n<p>From performance perspective, is this a correct way, or having a single session created in the main program and passing the reference to individual module will be a better approach?</p>\n"}, {"tags": ["pointers", "for-loop", "go"], "comments": [{"owner": {"reputation": 3183, "user_id": 216345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ffc76b5c6c4607d55b0796da63d67f0?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/216345/thomas"}, "edited": false, "score": 1, "creation_date": 1528164570, "post_id": 50690996, "comment_id": 88391902, "body": "If you use the value from range it is a copy at a different memory location. If you use a[idx] you are editing the memory in the slice."}], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 3, "last_activity_date": 1528165897, "last_edit_date": 1528165897, "creation_date": 1528164724, "answer_id": 50691072, "question_id": 50690996, "link": "https://stackoverflow.com/questions/50690996/a-little-bit-confuse-about-the-iteration-values-of-golang-for-loop/50691072#50691072", "title": "A little bit confuse about the iteration values of golang for loop", "body": "<p>When you write:</p>\n\n<pre><code>a := make([]int, 3)\n\na[0], a[1], a[2] = 1, 2, 3\n\nfor i, val := range a {\n    println(a[i], \"vs.\", val)\n    println(&amp;a[i], \"vs.\", &amp;val)\n}\n</code></pre>\n\n<p>The variable <code>val</code> is assigned <strong>a copy</strong> of the value in <code>a[i]</code>.</p>\n\n<p>It is basically the same as doing it like this:</p>\n\n<pre><code>var val int\nfor i := range a {\n    val = a[i]\n    println(a[i], \"vs.\", val)\n    println(&amp;a[i], \"vs.\", &amp;val)\n}\n</code></pre>\n\n<p>So depending on what you are doing then:</p>\n\n<blockquote>\n  <p>It looks like the same thing but it isn't, right?</p>\n</blockquote>\n\n<p>If you use the variable to read the value, then <em>it is</em> the same thing.</p>\n\n<p>But if you assign to it, take it's pointer value, etc, <em>it is not</em>.</p>\n"}], "owner": {"reputation": 125, "user_id": 5938111, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VFCoIVrCRdo/AAAAAAAAAAI/AAAAAAAAABU/_4_CWwMV4kY/photo.jpg?sz=128", "display_name": "Ti\u1ebfn Nguy\u1ec5n Ho&#224;ng", "link": "https://stackoverflow.com/users/5938111/ti%e1%ba%bfn-nguy%e1%bb%85n-ho%c3%a0ng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 50691072, "answer_count": 1, "score": -1, "last_activity_date": 1528165897, "creation_date": 1528163874, "question_id": 50690996, "link": "https://stackoverflow.com/questions/50690996/a-little-bit-confuse-about-the-iteration-values-of-golang-for-loop", "title": "A little bit confuse about the iteration values of golang for loop", "body": "<p>This question is relate to <a href=\"https://stackoverflow.com/questions/15945030/change-values-while-iterating-in-golang\">this</a> and <a href=\"https://stackoverflow.com/a/15952415/5938111\">this answer</a></p>\n\n<p>All of these question &amp; answer all make sense to me except one little thing. </p>\n\n<p>If the 2nd value of for loop is a[i], then what is the different between the <code>a[i]</code> from the for loop and the <code>a[i]</code> as we write? It looks like the same thing but it isn't, right?</p>\n\n<p>Please help me clear this out. Thanks guys!</p>\n"}, {"tags": ["azure", "go"], "answers": [{"tags": [], "owner": {"reputation": 260, "user_id": 3761716, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iY3GQ.jpg?s=128&g=1", "display_name": "MarStr", "link": "https://stackoverflow.com/users/3761716/marstr"}, "is_accepted": true, "score": 1, "last_activity_date": 1528302184, "creation_date": 1528302184, "answer_id": 50725186, "question_id": 50690925, "link": "https://stackoverflow.com/questions/50690925/sdk-for-getting-metric-statistics/50725186#50725186", "title": "SDK for getting metric statistics", "body": "<p>The operations you're mentioning can be found in the package:</p>\n\n<p><a href=\"https://github.com/Azure/azure-sdk-for-go/blob/514bddd77de93dd0349ada5fbe250077ddc619ff/services/monitor/mgmt/2018-03-01/insights/metrics.go\" rel=\"nofollow noreferrer\">github.com/Azure/azure-sdk-for-go/services/monitor/mgmt/2018-03-01/insights</a></p>\n\n<p>In general though, if you're ever able to find a link to the REST documentation, the Azure SDK for Go can be searched for the URL of the operation. For yours in particular, I searched \"/providers/micorosoft.insights/metrics\" and was able to zero in on the operation.</p>\n"}], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 50725186, "answer_count": 1, "score": 1, "last_activity_date": 1528302184, "creation_date": 1528163138, "last_edit_date": 1592644375, "question_id": 50690925, "link": "https://stackoverflow.com/questions/50690925/sdk-for-getting-metric-statistics", "title": "SDK for getting metric statistics", "body": "<p>AWS Cloudwatch has an api which allows fetching metric statistics:</p>\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_GetMetricStatistics.html\" rel=\"nofollow noreferrer\">CloudWatch GetMetricStatistics REST</a></li>\n<li><a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/cloudwatch/#CloudWatch.GetMetricStatistics\" rel=\"nofollow noreferrer\">CloudWatch GetMetricStatistics Go implementation</a></li>\n</ul>\n<p>I have been able to find the REST definition for azure which appears to have similar functionality:</p>\n<ul>\n<li><a href=\"https://docs.microsoft.com/en-us/rest/api/monitor/metrics/list\" rel=\"nofollow noreferrer\">Azure list metric values REST</a></li>\n</ul>\n<p>but I can't find the Go implementation. <a href=\"https://godoc.org/github.com/Azure/azure-sdk-for-go\" rel=\"nofollow noreferrer\"><code>azure-sdk-for-go</code></a> has a lot of code in it, but I can't find the code for listing metric values.</p>\n<hr />\n<p>Some more details:\nI am trying to get status code statistics for an application gateway.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3183, "user_id": 216345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ffc76b5c6c4607d55b0796da63d67f0?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/216345/thomas"}, "edited": false, "score": 0, "creation_date": 1528164507, "post_id": 50690507, "comment_id": 88391887, "body": "Cool, I didn&#39;t know about that!"}, {"owner": {"reputation": 6313, "user_id": 328115, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9a029d2d948f128443f996fa12b3d3a1?s=128&d=identicon&r=PG", "display_name": "dolmen", "link": "https://stackoverflow.com/users/328115/dolmen"}, "edited": false, "score": 0, "creation_date": 1558093708, "post_id": 50690507, "comment_id": 98996776, "body": "The playground now supports multiple files (ex: <a href=\"https://play.golang.org/p/KLZR7NlVZNX\" rel=\"nofollow noreferrer\">play.golang.org/p/KLZR7NlVZNX</a>) but I don&#39;t yet see a way to download each file individually. <a href=\"https://play.golang.org/p/KLZR7NlVZNX.go\" rel=\"nofollow noreferrer\">play.golang.org/p/KLZR7NlVZNX.go</a> just dumps the whole content."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1528181904, "last_edit_date": 1528181904, "creation_date": 1528159015, "answer_id": 50690507, "question_id": 50690446, "link": "https://stackoverflow.com/questions/50690446/how-to-retrieve-golang-code-from-shared-play-golang-org-url/50690507#50690507", "title": "how to retrieve golang code from shared play.golang.org url", "body": "<p>To get the text of a shared playground program, append \".go\" to the URL.  For example, you can get the text of the program at <a href=\"https://play.golang.org/p/HmnNoBf0p1z\" rel=\"noreferrer\">https://play.golang.org/p/HmnNoBf0p1z</a> with <a href=\"https://play.golang.org/p/HmnNoBf0p1z.go\" rel=\"noreferrer\">https://play.golang.org/p/HmnNoBf0p1z.go</a>.</p>\n\n<p>You can upload a program by posting the program text to <a href=\"https://play.golang.org/share\" rel=\"noreferrer\">https://play.golang.org/share</a>. The response is the ID of the shared program. This program uploads stdin to the playground and prints the ID of the uploaded program to stdout:</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n)\n\nfunc main() {\n    req, err := http.NewRequest(\"POST\", \"https://play.golang.org/share\", os.Stdin)\n    if err != nil {\n        log.Fatal(err)\n    }\n    resp, err := http.DefaultClient.Do(req)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer resp.Body.Close()\n    io.Copy(os.Stdout, resp.Body)\n}  \n</code></pre>\n\n<p>Assuming the above program is in upload.go, the following shell script prints <code>HmnNoBf0p1z</code>.</p>\n\n<pre><code>go run upload.go &lt;&lt; EOF\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n}\nEOF\n</code></pre>\n\n<p>If you want to download the program as a file using a browser, then add the query <code>?download=true</code> to the .go URL. Example: <a href=\"https://play.golang.org/p/HmnNoBf0p1z.go?download=true\" rel=\"noreferrer\">https://play.golang.org/p/HmnNoBf0p1z.go?download=true</a></p>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 2, "last_activity_date": 1528178938, "creation_date": 1528178938, "answer_id": 50693137, "question_id": 50690446, "link": "https://stackoverflow.com/questions/50690446/how-to-retrieve-golang-code-from-shared-play-golang-org-url/50693137#50693137", "title": "how to retrieve golang code from shared play.golang.org url", "body": "<p>There are two ways that I know one of which is described by @ThunderCat. Another simple solution is go to the URL <a href=\"https://play.golang.org/p/HmnNoBf0p1z\" rel=\"nofollow noreferrer\">https://play.golang.org/p/HmnNoBf0p1z</a> and Press <code>Ctrl+save</code> on the page it will be downloaded as a <code>.go</code> file. </p>\n"}], "owner": {"reputation": 802, "user_id": 2018909, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/10ebdad579fc333db3830e893baf977e?s=128&d=identicon&r=PG", "display_name": "srini", "link": "https://stackoverflow.com/users/2018909/srini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 352, "favorite_count": 1, "accepted_answer_id": 50690507, "answer_count": 2, "score": 3, "last_activity_date": 1528181904, "creation_date": 1528158431, "question_id": 50690446, "link": "https://stackoverflow.com/questions/50690446/how-to-retrieve-golang-code-from-shared-play-golang-org-url", "title": "how to retrieve golang code from shared play.golang.org url", "body": "<p>I need to read golang code from the play.golang.org link and save to a .go file. I'm wondering if there is any public API support for play.golang.org. I googled but no hints. Has anyone attempted anything similar? </p>\n"}, {"tags": ["algorithm", "go", "probability", "dice"], "comments": [{"owner": {"reputation": 121669, "user_id": 56778, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/34b152ef95a49568ce45df38cd87e54b?s=128&d=identicon&r=PG", "display_name": "Jim Mischel", "link": "https://stackoverflow.com/users/56778/jim-mischel"}, "edited": false, "score": 2, "creation_date": 1528158917, "post_id": 50690348, "comment_id": 88390784, "body": "<a href=\"https://www.lucamoroni.it/the-dice-roll-sum-problem/\" rel=\"nofollow noreferrer\">The dice roll sum problem</a> gives a good explanation of the problem with N 6-sided dice. You should be able to generalize it to n-sided dice, provided you understand that article. Also see <a href=\"http://mathworld.wolfram.com/Dice.html\" rel=\"nofollow noreferrer\">mathworld.wolfram.com/Dice.html</a>, which the first article references."}, {"owner": {"reputation": 51, "user_id": 9894672, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Aaron Small", "link": "https://stackoverflow.com/users/9894672/aaron-small"}, "reply_to_user": {"reputation": 121669, "user_id": 56778, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/34b152ef95a49568ce45df38cd87e54b?s=128&d=identicon&r=PG", "display_name": "Jim Mischel", "link": "https://stackoverflow.com/users/56778/jim-mischel"}, "edited": false, "score": 0, "creation_date": 1528161369, "post_id": 50690348, "comment_id": 88391257, "body": "whew! that&#39;s going to require some detailed study... thanks for the pointer."}, {"owner": {"reputation": 121669, "user_id": 56778, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/34b152ef95a49568ce45df38cd87e54b?s=128&d=identicon&r=PG", "display_name": "Jim Mischel", "link": "https://stackoverflow.com/users/56778/jim-mischel"}, "edited": false, "score": 0, "creation_date": 1528165560, "post_id": 50690348, "comment_id": 88392067, "body": "Yeah, it&#39;s a mouthful. But considering the alternative . . ."}, {"owner": {"reputation": 14582, "user_id": 871096, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/39b6e181c797ef3ab2119322f7cac20b?s=128&d=identicon&r=PG", "display_name": "Robert Dodier", "link": "https://stackoverflow.com/users/871096/robert-dodier"}, "edited": false, "score": 1, "creation_date": 1528218440, "post_id": 50690348, "comment_id": 88420188, "body": "@AaronSmall The distribution of the sum of independent dice is the convolution of the distribution of the number on each die. In this case, the polynomial multiplication gives the same result as convolution, but convolution is the more general concept (and not any more complicated). See: <a href=\"https://en.wikipedia.org/wiki/Convolution\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Convolution</a>"}, {"owner": {"reputation": 14582, "user_id": 871096, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/39b6e181c797ef3ab2119322f7cac20b?s=128&d=identicon&r=PG", "display_name": "Robert Dodier", "link": "https://stackoverflow.com/users/871096/robert-dodier"}, "reply_to_user": {"reputation": 121669, "user_id": 56778, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/34b152ef95a49568ce45df38cd87e54b?s=128&d=identicon&r=PG", "display_name": "Jim Mischel", "link": "https://stackoverflow.com/users/56778/jim-mischel"}, "edited": false, "score": 1, "creation_date": 1528218748, "post_id": 50690348, "comment_id": 88420358, "body": "@JimMischel I dunno about <a href=\"https://www.lucamoroni.it/the-dice-roll-sum-problem/\" rel=\"nofollow noreferrer\">lucamoroni.it/the-dice-roll-sum-problem</a> , it seems needlessly complex. Just to get the sum of dice doesn&#39;t require all the combinatorics."}, {"owner": {"reputation": 121669, "user_id": 56778, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/34b152ef95a49568ce45df38cd87e54b?s=128&d=identicon&r=PG", "display_name": "Jim Mischel", "link": "https://stackoverflow.com/users/56778/jim-mischel"}, "reply_to_user": {"reputation": 14582, "user_id": 871096, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/39b6e181c797ef3ab2119322f7cac20b?s=128&d=identicon&r=PG", "display_name": "Robert Dodier", "link": "https://stackoverflow.com/users/871096/robert-dodier"}, "edited": false, "score": 1, "creation_date": 1528228429, "post_id": 50690348, "comment_id": 88424941, "body": "@RobertDodier It&#39;s a thorough review of the subject, with emphasis on understanding the math behind it. Yes, it&#39;s needlessly complex if all you want is a formula."}, {"owner": {"reputation": 14582, "user_id": 871096, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/39b6e181c797ef3ab2119322f7cac20b?s=128&d=identicon&r=PG", "display_name": "Robert Dodier", "link": "https://stackoverflow.com/users/871096/robert-dodier"}, "edited": false, "score": 1, "creation_date": 1528229046, "post_id": 50690348, "comment_id": 88425216, "body": "@AaronSmall can you help me understand how to intend to use DropHighest and DropLowest. Do you mean that faces higher than DropHighest and lower than DropLowest are excluded? Or that, of all the dice, whatever they are showing, the DropHighest highest ones are excluded, and the DropLowest lowest ones are excluded? (If it&#39;s the latter, how are ties handled?) Thanks for any info."}, {"owner": {"reputation": 51, "user_id": 9894672, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Aaron Small", "link": "https://stackoverflow.com/users/9894672/aaron-small"}, "reply_to_user": {"reputation": 14582, "user_id": 871096, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/39b6e181c797ef3ab2119322f7cac20b?s=128&d=identicon&r=PG", "display_name": "Robert Dodier", "link": "https://stackoverflow.com/users/871096/robert-dodier"}, "edited": false, "score": 0, "creation_date": 1528229693, "post_id": 50690348, "comment_id": 88425546, "body": "@RobertDodier, Drops represent counts of dropped dice, so it ties don&#39;t matter.   6d6-L == 6d6-L1 == &quot;roll 6 6 sided dice, discard the lowest, and sum the remaining&quot; means that one die will be dropped from the summation and it will have a face equal to the lowest face rolled in the set.  6d6-H2 == &quot;roll 6 6 sided dice, discard the highest 2, and sum the remaining&quot; means that 2 dice will be dropped from the summation. They will have a sum of faces equal to the sum of the highest 2 dice rolled in the set."}, {"owner": {"reputation": 14582, "user_id": 871096, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/39b6e181c797ef3ab2119322f7cac20b?s=128&d=identicon&r=PG", "display_name": "Robert Dodier", "link": "https://stackoverflow.com/users/871096/robert-dodier"}, "edited": false, "score": 1, "creation_date": 1528241511, "post_id": 50690348, "comment_id": 88429598, "body": "@AaronSmall OK, do I understand correctly then that if 3 dice are tied for highest, let&#39;s say with value 5, then two of the 5&#39;s are removed, and one 5 remains in the ones that are added up?"}, {"owner": {"reputation": 51, "user_id": 9894672, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Aaron Small", "link": "https://stackoverflow.com/users/9894672/aaron-small"}, "reply_to_user": {"reputation": 14582, "user_id": 871096, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/39b6e181c797ef3ab2119322f7cac20b?s=128&d=identicon&r=PG", "display_name": "Robert Dodier", "link": "https://stackoverflow.com/users/871096/robert-dodier"}, "edited": false, "score": 0, "creation_date": 1528243099, "post_id": 50690348, "comment_id": 88429990, "body": "@RobertDodier, that is correct."}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 9894672, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Aaron Small", "link": "https://stackoverflow.com/users/9894672/aaron-small"}, "edited": false, "score": 0, "creation_date": 1528216611, "post_id": 50691723, "comment_id": 88419239, "body": "This seems to be what most of what I asked for. I&#39;m still a little puzzled on how it works, so I&#39;m aggressively renaming variables to try to understand.  I imagine that if I sum the probabilities between the target and the max I will get the probability of exceeding the target and hat the inverse holds true for getting less than the target.  I&#39;m still stumped on how I change the distribution to account for &quot;Drop Highest&quot; and &quot;Drop Lowest&quot;"}, {"owner": {"reputation": 51837, "user_id": 2144669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e7393f439028063515255b63ed94cfd?s=128&d=identicon&r=PG", "display_name": "David Eisenstat", "link": "https://stackoverflow.com/users/2144669/david-eisenstat"}, "reply_to_user": {"reputation": 51, "user_id": 9894672, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Aaron Small", "link": "https://stackoverflow.com/users/9894672/aaron-small"}, "edited": false, "score": 1, "creation_date": 1528218208, "post_id": 50691723, "comment_id": 88420064, "body": "@AaronSmall We&#39;re figuring out the probability distribution for 1 y-sided die, then 2 y-sided dice, then 3, etc. We can imagine rolling x y-sided dice as rolling a y-sided die and a weirdo composite die that represents the sum of (x-1) y-sided dice. If the composite rolled a (say) 4, it doesn&#39;t matter if it was 1+3 or 2+2 or 3+1 -- these possibilities are all equivalent in the final accounting."}, {"owner": {"reputation": 51, "user_id": 9894672, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Aaron Small", "link": "https://stackoverflow.com/users/9894672/aaron-small"}, "edited": false, "score": 0, "creation_date": 1528224299, "post_id": 50691723, "comment_id": 88423018, "body": "That seems perfectly true, except I want to support the case where the combinations do matter so that I can only select a subset of the dice rolled. A common RPG scenario would be &quot;roll 4d6-L&quot; or &quot;Roll 4 6 sided dice, discard the lowest face, sum the remaining.&quot;  Here is an example: <a href=\"https://anydice.com/program/1033e\" rel=\"nofollow noreferrer\">anydice.com/program/1033e</a>  In that case, I&#39;m not sure how to proceed."}, {"owner": {"reputation": 51837, "user_id": 2144669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e7393f439028063515255b63ed94cfd?s=128&d=identicon&r=PG", "display_name": "David Eisenstat", "link": "https://stackoverflow.com/users/2144669/david-eisenstat"}, "reply_to_user": {"reputation": 51, "user_id": 9894672, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Aaron Small", "link": "https://stackoverflow.com/users/9894672/aaron-small"}, "edited": false, "score": 1, "creation_date": 1528224674, "post_id": 50691723, "comment_id": 88423187, "body": "@AaronSmall The combinatorics get significantly more complicated. Let me think about how to write it up."}], "tags": [], "owner": {"reputation": 51837, "user_id": 2144669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e7393f439028063515255b63ed94cfd?s=128&d=identicon&r=PG", "display_name": "David Eisenstat", "link": "https://stackoverflow.com/users/2144669/david-eisenstat"}, "is_accepted": false, "score": 1, "last_activity_date": 1528200294, "last_edit_date": 1528200294, "creation_date": 1528170649, "answer_id": 50691723, "question_id": 50690348, "link": "https://stackoverflow.com/questions/50690348/calculate-probability-of-a-fair-dice-roll-in-non-exponential-time/50691723#50691723", "title": "Calculate probability of a fair dice roll (in non-exponential time)", "body": "<p>You can compute the distribution of sums of <code>x</code> <code>y</code>-sided dice by multiplying out the following polynomial in variable <code>Z</code>:</p>\n\n<pre><code>(Z + Z^2 + ... + Z^x)^y / x^y.\n</code></pre>\n\n<p>For example, for two six-sided dice:</p>\n\n<pre><code>(Z + Z^2 + ... + Z^6)^2 / 6^2\n  = (Z + Z^2 + ... + Z^6) * (Z + Z^2 + ... + Z^6) / 36\n  = (Z^2 + 2Z^3 + 3Z^4 + 4Z^5 + 5Z^6 + 6Z^7 + 5Z^8 + 4Z^9 + 3Z^10 + 2Z^11 + Z^12) / 36,\n</code></pre>\n\n<p>so you can read off the probability of getting sum <code>6</code> as the coefficient of <code>Z^6</code> (<code>5/36</code>).</p>\n\n<p>For three \"two-sided\" dice:</p>\n\n<pre><code>(Z + Z^2)^3 / 2^3 = (Z + Z^2) * (Z + Z^2) * (Z + Z^2) / 8\n                  = (Z^2 + 2Z^3 + Z^4) (Z + Z^2) / 8\n                  = (Z^3 + 3Z^4 + 3Z^5 + Z^6) / 8,\n</code></pre>\n\n<p>so the probability of getting sum <code>4</code> is the coefficient of <code>Z^4</code> (<code>3/8</code>).</p>\n\n<p>You can use the school algorithm to get a polynomial algorithm for this problem. Lightly tested Go code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc dieRolls(x, y int) map[int]float64 {\n    d := map[int]float64{0: 1.0}\n    for i := 0; i &lt; x; i++ {\n        d1 := make(map[int]float64)\n        for j := 1; j &lt;= y; j++ {\n            for k, v := range d {\n                d1[k+j] += v / float64(y)\n            }\n        }\n        d = d1\n    }\n    return d\n}\n\nfunc main() {\n    for k, v := range dieRolls(2, 6) {\n        fmt.Printf(\"%d %g\\n\", k, v)\n    }\n    fmt.Printf(\"\\n\")\n    for k, v := range dieRolls(3, 2) {\n        fmt.Printf(\"%d %g\\n\", k, v)\n    }\n}\n</code></pre>\n\n<p>Run the code: <a href=\"https://play.golang.org/p/O9fsWy6RZKL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/O9fsWy6RZKL</a></p>\n"}, {"comments": [{"owner": {"reputation": 51, "user_id": 9894672, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Aaron Small", "link": "https://stackoverflow.com/users/9894672/aaron-small"}, "edited": false, "score": 0, "creation_date": 1528227988, "post_id": 50707817, "comment_id": 88424731, "body": "This is awesome, thank you. I will dig in today and try to port to go. I guess I&#39;ll have to build my own dynamic programming libraries..."}, {"owner": {"reputation": 51, "user_id": 9894672, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Aaron Small", "link": "https://stackoverflow.com/users/9894672/aaron-small"}, "edited": false, "score": 0, "creation_date": 1528242904, "post_id": 50707817, "comment_id": 88429941, "body": "Your implementation is a thing of beauty. Porting to Go really made me miss Python :P  <a href=\"https://play.golang.org/p/cpD51opQf5h\" rel=\"nofollow noreferrer\">play.golang.org/p/cpD51opQf5h</a>"}, {"owner": {"reputation": 14582, "user_id": 871096, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/39b6e181c797ef3ab2119322f7cac20b?s=128&d=identicon&r=PG", "display_name": "Robert Dodier", "link": "https://stackoverflow.com/users/871096/robert-dodier"}, "edited": false, "score": 1, "creation_date": 1531195839, "post_id": 50707817, "comment_id": 89492896, "body": "@david-eisenstat I have to say I&#39;m pretty impressed by your solution. I tinkered with this problem off and on for a month and eventually came up with a somewhat different solution, which is great, but I see you were able to pull together a brief, general solution very quickly. My hat&#39;s off to you, keep up the good work."}], "tags": [], "owner": {"reputation": 51837, "user_id": 2144669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e7393f439028063515255b63ed94cfd?s=128&d=identicon&r=PG", "display_name": "David Eisenstat", "link": "https://stackoverflow.com/users/2144669/david-eisenstat"}, "is_accepted": true, "score": 3, "last_activity_date": 1528227819, "creation_date": 1528227819, "answer_id": 50707817, "question_id": 50690348, "link": "https://stackoverflow.com/questions/50690348/calculate-probability-of-a-fair-dice-roll-in-non-exponential-time/50707817#50707817", "title": "Calculate probability of a fair dice roll (in non-exponential time)", "body": "<p>Here's some code that handles dropping low and high rolls. Sorry for switching to Python, but I needed easy bignums and a memoization library to keep my sanity. I think the complexity is something like <code>O(count^3 sides^2 drop_highest)</code>.</p>\n\n<p>The way this code works is to divide the space of possibilities for rolling <code>count</code> dice each with <code>sides</code> sides by how many dice are showing the maximum number (<code>count_showing_max</code>). There are <code>binomial(count, count_showing_max)</code> ways to achieve such a roll on uniquely labeled dice, hence the <code>multiplier</code>. Given <code>count_showing_max</code>, we can figure out how many maxed dice get dropped for being high and how many get dropped for being low (it happens) and add this sum to the outcomes for the remaining dice.</p>\n\n<pre><code>#!/usr/bin/env python3\nimport collections\nimport functools\nimport math\n\n\n@functools.lru_cache(maxsize=None)\ndef binomial(n, k):\n    return math.factorial(n) // (math.factorial(k) * math.factorial(n - k))\n\n\n@functools.lru_cache(maxsize=None)\ndef outcomes(count, sides, drop_highest, drop_lowest):\n    d = collections.Counter()\n    if count == 0:\n        d[0] = 1\n    elif sides == 0:\n        pass\n    else:\n        for count_showing_max in range(count + 1):  # 0..count\n            d1 = outcomes(count - count_showing_max, sides - 1,\n                          max(drop_highest - count_showing_max, 0),\n                          drop_lowest)\n            count_showing_max_not_dropped = max(\n                min(count_showing_max - drop_highest,\n                    count - drop_highest - drop_lowest), 0)\n            sum_showing_max = count_showing_max_not_dropped * sides\n            multiplier = binomial(count, count_showing_max)\n            for k, v in d1.items():\n                d[sum_showing_max + k] += multiplier * v\n    return d\n\n\ndef main(*args):\n    d = outcomes(*args)\n    denominator = sum(d.values()) / 100\n    for k, v in sorted(d.items()):\n        print(k, v / denominator)\n\n\nif __name__ == '__main__':\n    main(5, 6, 2, 2)\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 9894672, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Aaron Small", "link": "https://stackoverflow.com/users/9894672/aaron-small"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 744, "favorite_count": 1, "accepted_answer_id": 50707817, "answer_count": 2, "score": 4, "last_activity_date": 1528243011, "creation_date": 1528157353, "last_edit_date": 1528243011, "question_id": 50690348, "link": "https://stackoverflow.com/questions/50690348/calculate-probability-of-a-fair-dice-roll-in-non-exponential-time", "title": "Calculate probability of a fair dice roll (in non-exponential time)", "body": "<p>Variations on this are pretty common questions, but all my google-fu has left me stumped. I would like to calculate the odds of a fair dice roll, but I want to do it <strong>efficiently</strong>. There are lots of examples out there of how to do this, but all the algorithms I've found are too computationally expensive (exponential time) to work for large numbers of dice with many sides.</p>\n\n<p><strong>The Simple Problem:</strong> Calculate the odds of a roll of n, on x y sided dice. </p>\n\n<p><strong>The Simple Solution:</strong> Create the n-ary Cartesian product of the roll, sum each product, count the number of times the sum is the target, do a little division and voila.</p>\n\n<p><strong>Example of a Simple Solution in Go:</strong> <a href=\"https://play.golang.org/p/KNUS4YBQC0g\" rel=\"nofollow noreferrer\">https://play.golang.org/p/KNUS4YBQC0g</a></p>\n\n<p>The Simple Solution works perfectly. I extended it to allow for cases like dropping the highest/lowest n faces, and the results hold up to spot testing.</p>\n\n<p>But consider <code>{Count: 20,Sides: 20,DropHighest: 0,DropLowest:0, Target: 200}</code>.</p>\n\n<p>If I evaluated that with the previous solution, my \"table\" would have 104 some odd septillion cells and will max the CPU pretty easily.</p>\n\n<p>Is there a more efficient way to calculate probability for large numbers of dice with many sides? If so, can it account for more complex selection of \"success\" conditions like dropping some dice?</p>\n\n<p>I'm convinced it's possible due to the existence of this beautiful website: <a href=\"https://anydice.com/program/969\" rel=\"nofollow noreferrer\">https://anydice.com/program/969</a></p>\n\n<p>EDIT:</p>\n\n<p>The solution that worked best for me was David Eisenstat's answer, which I ported to go: <a href=\"https://play.golang.org/p/cpD51opQf5h\" rel=\"nofollow noreferrer\">https://play.golang.org/p/cpD51opQf5h</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528156478, "post_id": 50690207, "comment_id": 88390254, "body": "The playground link is good, but please include the code in the question."}, {"owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "edited": false, "score": 0, "creation_date": 1528162988, "post_id": 50690207, "comment_id": 88391558, "body": "Change line 25 to x.Set(reflect.ValueOf(WeekDay(&quot;sunday&quot;)) )"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1528157482, "last_edit_date": 1528157482, "creation_date": 1528156237, "answer_id": 50690227, "question_id": 50690207, "link": "https://stackoverflow.com/questions/50690207/how-do-i-reflectively-create-an-instance-of-enum-in-golang/50690227#50690227", "title": "How do i reflectively create an instance of enum in golang?", "body": "<p>Use <code>reflect.New(t).Elem()</code> to get a value and <a href=\"https://godoc.org/reflect#Value.SetString\" rel=\"nofollow noreferrer\"><code>SetString</code></a> to set the value.</p>\n\n<pre><code>// t is the reflect.Type for a Weekday\nt := reflect.TypeOf(WeekDay(\"sunday\"))\n\n// v is reflect.Value for a WeekDay, initialized to the zero value \"\"\nv := reflect.New(t).Elem()\n\n// Set the value of v to \"sunday\"\nv.SetString(\"sunday\")\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/qvoVIN2Ro7x\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qvoVIN2Ro7x</a></p>\n"}], "owner": {"reputation": 455, "user_id": 2033450, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6552571bdbfa7d31353b64f6fdec053a?s=128&d=identicon&r=PG", "display_name": "Sreenidhi Sreesha", "link": "https://stackoverflow.com/users/2033450/sreenidhi-sreesha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 688, "favorite_count": 0, "accepted_answer_id": 50690227, "answer_count": 1, "score": 0, "last_activity_date": 1610658995, "creation_date": 1528156057, "last_edit_date": 1610658995, "question_id": 50690207, "link": "https://stackoverflow.com/questions/50690207/how-do-i-reflectively-create-an-instance-of-enum-in-golang", "title": "How do i reflectively create an instance of enum in golang?", "body": "<p>I'm trying to create an instance of enum from its reflect.Type and value\n<a href=\"https://play.golang.org/p/PqklMe_Z4WX\" rel=\"nofollow noreferrer\">https://play.golang.org/p/PqklMe_Z4WX</a></p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;reflect&quot;\n)\ntype WeekDay string\nconst (\n    SUNDAY WeekDay = &quot;sunday&quot;\n    MONDAY WeekDay = &quot;monday&quot;\n)\nfunc (day WeekDay) WeekDay() bool {\n    switch day {\n    case SUNDAY, MONDAY:\n        return true\n    default:\n        return false\n    }\n}\n\nfunc main() {\n    rt := reflect.TypeOf(WeekDay(&quot;sunday&quot;))\n    x := reflect.New(rt)\n    x = x.Elem()\n    x.Set(reflect.ValueOf(&quot;sunday&quot;))\n    fmt.Println(x.Interface())\n}\n</code></pre>\n<p>Is there a way to create an instance of enum in golang with its type and possible value of constant?</p>\n"}, {"tags": ["json", "mongodb", "go", "marshalling"], "answers": [{"tags": [], "owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "is_accepted": true, "score": 3, "last_activity_date": 1528182980, "last_edit_date": 1528182980, "creation_date": 1528148051, "answer_id": 50689097, "question_id": 50688879, "link": "https://stackoverflow.com/questions/50688879/go-convert-type-when-marshaling-to-json/50689097#50689097", "title": "Go Convert type when marshaling to json", "body": "<p>You should write your own (un)marshalling function in which you process your conversions/conditions and handle it as argument in calling the json (un)marshalling. </p>\n\n<pre><code>type Whatever struct {\n   someField int\n}\n\nfunc (w Whatever) MarshalJSON() ([]byte, error) {\n    return json.Marshal(struct{\n        SomeField int `json:\"some_field\"`\n    }{\n        SomeField: w.someField,\n    })\n}\n\nfunc (w Whatever) MarshalJSON() ([]byte, error) {\n   return json.Marshal(map[string]interface{}{\n       \"some_field\": w.SomeField,\n   })\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3271, "user_id": 7607701, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-0eLxeTB_SdQ/AAAAAAAAAAI/AAAAAAAAABg/XZT1oaa0wqA/photo.jpg?sz=128", "display_name": "Aaron N. Brock", "link": "https://stackoverflow.com/users/7607701/aaron-n-brock"}, "edited": false, "score": 0, "creation_date": 1528166664, "post_id": 50689429, "comment_id": 88392238, "body": "I&#39;m using the same struct to retrieve data from MongoDB, so I don&#39;t really have control over the types in the struct.  (Or at least, I&#39;d have to deal with this same issue from the other end)"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528171258, "post_id": 50689429, "comment_id": 88393184, "body": "This is <b>not</b> an alias! <code>Id</code>is just a named type with <code>objectid.ObjectId</code>being the underlying type. This is not aliasing!"}, {"owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528180851, "post_id": 50689429, "comment_id": 88396600, "body": "@Volker Thanks, fixed."}], "tags": [], "owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "is_accepted": false, "score": 3, "last_activity_date": 1528180812, "last_edit_date": 1528180812, "creation_date": 1528149979, "answer_id": 50689429, "question_id": 50688879, "link": "https://stackoverflow.com/questions/50688879/go-convert-type-when-marshaling-to-json/50689429#50689429", "title": "Go Convert type when marshaling to json", "body": "<p>You can declare a named type to <code>objectid.ObjectId</code> that would implement the <code>json.Marshaler</code> interface to override the standard marshaling and output the hex  string instead:</p>\n\n<pre><code>type Id objectid.ObjectId\n\nfunc (id Id) MarshalJSON() ([]byte, error) {\n    return json.Marshal(objectid.ObjectId(id).Hex())\n}\n</code></pre>\n\n<p>And use it instead of <code>objectid.ObjectId</code> in your structs:</p>\n\n<pre><code>type Greeting struct {\n    Id Id\n    Greeting string\n}\n</code></pre>\n\n<p>Now, as you marshal a <code>Greeting</code>, the json package would marshal the <code>Greeting</code> field as expected, but the since the <code>Id</code> field implements <code>json.Marshaler</code>, it would be marshaled by <code>Id.MarshalJSON</code> which would output <code>id.Hex()</code>.</p>\n\n<p>You can do the same for unmarshaling by implementing the <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\"><code>json.Unmarshaler</code></a> interface for <code>Id</code>.</p>\n"}], "owner": {"reputation": 3271, "user_id": 7607701, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-0eLxeTB_SdQ/AAAAAAAAAAI/AAAAAAAAABg/XZT1oaa0wqA/photo.jpg?sz=128", "display_name": "Aaron N. Brock", "link": "https://stackoverflow.com/users/7607701/aaron-n-brock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1172, "favorite_count": 0, "accepted_answer_id": 50689097, "answer_count": 2, "score": 1, "last_activity_date": 1528182980, "creation_date": 1528146907, "question_id": 50688879, "link": "https://stackoverflow.com/questions/50688879/go-convert-type-when-marshaling-to-json", "title": "Go Convert type when marshaling to json", "body": "<p>My question is very similar to <a href=\"https://stackoverflow.com/questions/9452897/how-to-decode-json-with-type-convert-from-string-to-float64-in-golang\">this one</a>, however instead of converting a <code>float64</code> to a <code>string</code> which is handled using the <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">string tag</a>.  In my case I'm trying to convert a <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/bson/objectid#ObjectID\" rel=\"nofollow noreferrer\"><code>ObjectID</code></a> to a string using it's <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/bson/objectid#ObjectID.Hex\" rel=\"nofollow noreferrer\"><code>.Hex()</code></a> method.  And, vice versa using the <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/bson/objectid#FromHex\" rel=\"nofollow noreferrer\"><code>.FromHex()</code></a> function on the way back.</p>\n\n<p>However, more generically how do I convert from type <code>X</code> to type <code>Y</code> &amp; back during the <code>Marshal</code> &amp; <code>Unmarshal</code>ing?</p>\n\n<p>My Example:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"fmt\"\n    \"encoding/json\"\n    \"github.com/mongodb/mongo-go-driver/bson/objectid\"\n)\n\ntype Greeting struct {\n    Id          *objectid.ObjectID  `json:\"id\"`\n    Greeting    string              `json:\"greeting,omitempty\"`\n}\n\n\nfunc main() {\n    // Create ObjectID\n    id, err := objectid.FromHex(\"5b14dd20f6418c8443a5ffec\")\n    if err != nil { log.Fatal(err) }\n\n    // Create Greeting\n    g := Greeting{&amp;id, \"Hello, World!\"}\n\n    // Marshal to json\n    j, err := json.Marshal(g)\n    if err != nil { log.Fatal(err) }\n\n    // Print Json\n    fmt.Printf(\"Json: %s\", string(j))\n\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Json: {\"id\":[91,20,221,32,246,65,140,132,67,165,255,236],\"greeting\":\"Hello, World!\"}\n</code></pre>\n\n<p>Whereas, what I'd like is:</p>\n\n<pre><code>Json: {\"id\":\"5b14dd20f6418c8443a5ffec\",\"greeting\":\"Hello, World!\"}\n</code></pre>\n"}, {"tags": ["templates", "go"], "comments": [{"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "edited": false, "score": 0, "creation_date": 1528145009, "post_id": 50688031, "comment_id": 88386704, "body": "Yeah... I had to write my own package to solve this issue <a href=\"https://github.com/biz/templates\" rel=\"nofollow noreferrer\">https://github.com/biz/templates</a>. The package creates a template per &quot;view&quot; that has access to any &quot;partial&quot; that is defined. There is also support for funcs that get added to all of the templates."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528146236, "post_id": 50688031, "comment_id": 88387206, "body": "Calling <code>t.ExecuteTemplate(w, &quot;foo&quot;, data)</code> will execute only the <code>foo</code> template and the templates that <code>foo</code> explicitly invokes. It will not execute the rest of the templates in <code>t</code>&#39;s parse.Tree. You can use one template instance per &quot;page&quot; and call <code>Execute</code> instead of <code>ExecuteTemplate</code>."}, {"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528147065, "post_id": 50688031, "comment_id": 88387494, "body": "@mkopriva this technique won&#39;t work if you want to redefine a <code>block</code> in multiple templates."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "edited": false, "score": 0, "creation_date": 1528147327, "post_id": 50688031, "comment_id": 88387582, "body": "@jmaloney that&#39;s why I wrote &quot;one template instance per page&quot;, i.e. each instance would parse its own redefinition of the base block."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1528155385, "last_edit_date": 1528155385, "creation_date": 1528146739, "answer_id": 50688848, "question_id": 50688031, "link": "https://stackoverflow.com/questions/50688031/using-template-blocks-in-combination-with-template-functions-in-golang/50688848#50688848", "title": "Using Template Blocks in Combination with Template Functions in Golang", "body": "<p>Use the following to add template functions to what you already have working:</p>\n\n<pre><code>t, err := template.New(\"base.html\").Funcs(sprig.FuncMap()).ParseFiles(\"./templates/base.html\", \"./templates/blogpost.html\")\n</code></pre>\n"}], "owner": {"reputation": 350, "user_id": 1430384, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c64f478d2405de67e933f924d8b7d07?s=128&d=identicon&r=PG", "display_name": "Johannes Gehrs", "link": "https://stackoverflow.com/users/1430384/johannes-gehrs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2497, "favorite_count": 0, "accepted_answer_id": 50688848, "answer_count": 1, "score": 0, "last_activity_date": 1528155385, "creation_date": 1528142825, "last_edit_date": 1528143249, "question_id": 50688031, "link": "https://stackoverflow.com/questions/50688031/using-template-blocks-in-combination-with-template-functions-in-golang", "title": "Using Template Blocks in Combination with Template Functions in Golang", "body": "<p>I'm looking to use template blocks in Golang to get a \"template inheritance\" style overwrite logic. </p>\n\n<p>I have a <code>base.html</code> template which is something like this:</p>\n\n<pre><code>&lt;title&gt;{{block \"title\" .}}Default Title{{end}}&lt;/title&gt;\n&lt;body&gt;{{block \"content\" .}}This is the default body.{{end}}&lt;/body&gt;\n</code></pre>\n\n<p>And then I have a template <code>blogpost.html</code> like so:</p>\n\n<pre><code>{{define \"title\"}}Blog Post Title{{end}}\n{{define \"content\"}}Lorem Ipsum...{{end}}\n</code></pre>\n\n<p>All of this works flawlessly as long as I just use <code>ParseFiles</code> and then execute the template</p>\n\n<pre><code>t, err := template.ParseFiles(\"./templates/base.html\", \"./templates/blogpost.html\")\nt.Execute(t, viewModel)\n</code></pre>\n\n<p>The way I did it was calling <code>ParseFiles</code> once for every template I needed to render. E. g. I did not call templates by name.</p>\n\n<p>However, I now want to also use Template Functions. Now I need to call <code>template.New</code> to get an empty template, assign a name, add the template functions and parse the files (<code>Funcs</code> \"<a href=\"https://golang.org/pkg/html/template/#Template.Funcs\" rel=\"nofollow noreferrer\">must be called before the template is parsed</a>\") :</p>\n\n<pre><code>tpl := template.Must(\n    template.New(\"somename\").Funcs(sprig.FuncMap()).ParseGlob(\"*.html\")\n)\n</code></pre>\n\n<p>This seems to be incompatible with my idea of template inheritance. I have to <code>ExecTemplate</code>with my <code>base.html</code> as a parameter in order to get any output. However, I'd like to load <em>one</em> base template and many content templates. Then call the content templates by name.</p>\n\n<p>Am I misunderstanding the way that Golang templates and/or Blocks are intended to be used? What's an elegant and idiomatic way to perform this kind of task?</p>\n"}, {"tags": ["generics", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1528138652, "post_id": 50686965, "comment_id": 88383891, "body": "Contains on a map is <code>_, ok := m[key]</code>.   Are there other methods that you want to add?"}, {"owner": {"reputation": 464, "user_id": 9319868, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tvNq9bb_utY/AAAAAAAAAAI/AAAAAAAAAHQ/_NxCEx1tPZg/photo.jpg?sz=128", "display_name": "Lev Knoblock", "link": "https://stackoverflow.com/users/9319868/lev-knoblock"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528138886, "post_id": 50686965, "comment_id": 88384002, "body": "@ThunderCat isEmpty, replace, basically everything that a java hashmap has."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1528141152, "post_id": 50686965, "comment_id": 88385010, "body": "isEmpty: <code>len(m) == 0</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1528141182, "post_id": 50686965, "comment_id": 88385023, "body": "Do you actually need &quot;everything a java hashmap has&quot; or are you just trying to recreate a Java class in Go because you think you might need those methods at some point?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1528141214, "post_id": 50686965, "comment_id": 88385037, "body": "The commonly used Java methods translate to simple Go expressions and statements.  isEmpty: <code>len(m) == 0</code>,  replace: <code>if _, ok := m[key]; ok { m[key] = newV }</code>"}, {"owner": {"reputation": 464, "user_id": 9319868, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tvNq9bb_utY/AAAAAAAAAAI/AAAAAAAAAHQ/_NxCEx1tPZg/photo.jpg?sz=128", "display_name": "Lev Knoblock", "link": "https://stackoverflow.com/users/9319868/lev-knoblock"}, "edited": false, "score": 0, "creation_date": 1528141313, "post_id": 50686965, "comment_id": 88385080, "body": "I actually do need most of those methods. All the ones that I mentioned in the question, definitely, and maybe a couple more, although I&#39;m not 100% sure about those &quot;couple more&quot; yet."}], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 2, "last_activity_date": 1528139272, "last_edit_date": 1528139272, "creation_date": 1528138733, "answer_id": 50687121, "question_id": 50686965, "link": "https://stackoverflow.com/questions/50686965/golang-generic-ish-hashmap/50687121#50687121", "title": "Golang Generic-ish Hashmap", "body": "<p>Golang does not have generics, as you say.</p>\n\n<p>But the maps can be declared using your own types, so you don't necessarily need to write your own \"generic\" hashmap to use things like \"contains\" or \"is empty\".</p>\n\n<p>Example (assuming some Icon and Colour types already exist, as well as the <code>GetTheIcon</code> function that returns some icon):</p>\n\n<pre><code>// this one will map Icon -&gt; Colour\niconToColours := make(map[Icon]Colour)\n\nmyIcon := GetTheIcon()\n// second return argument is true if the key was found in the map\n_, iconIsContained := iconToColours[myIcon]\n\n// check if the map is empty\nisEmpty := (len(iconToColours) == 0)\n</code></pre>\n\n<p>See more here:</p>\n\n<p><a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow noreferrer\">https://blog.golang.org/go-maps-in-action</a> </p>\n"}, {"comments": [{"owner": {"reputation": 464, "user_id": 9319868, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tvNq9bb_utY/AAAAAAAAAAI/AAAAAAAAAHQ/_NxCEx1tPZg/photo.jpg?sz=128", "display_name": "Lev Knoblock", "link": "https://stackoverflow.com/users/9319868/lev-knoblock"}, "edited": false, "score": 0, "creation_date": 1528173186, "post_id": 50688234, "comment_id": 88393681, "body": "Problem with that is, in Java I can write a class to be generic, and not have to rewrite it 50 times for 50 different types. If I had to make a new prefix tree class for every single type I put into it, for example, then that&#39;d be a huge issue. Hence, java generics may not be &quot;real&quot;, but they&#39;re definitely still useful. It doesn&#39;t matter how the compiler understands generics, the point is to not rewrite the <i>exact same thing</i> for every potential instance, and that&#39;s a very valuable thing to have."}, {"owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "reply_to_user": {"reputation": 464, "user_id": 9319868, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tvNq9bb_utY/AAAAAAAAAAI/AAAAAAAAAHQ/_NxCEx1tPZg/photo.jpg?sz=128", "display_name": "Lev Knoblock", "link": "https://stackoverflow.com/users/9319868/lev-knoblock"}, "edited": false, "score": 0, "creation_date": 1528176752, "post_id": 50688234, "comment_id": 88394764, "body": "Of course generics is useful, else it would not exist, although, I do not miss them very much in Go.  You solve problems in another way in Go. There are different philosophies behind the design of Go. Generics are left out with reason. But it takes a complete blog instead of a few lines comment to explain that, and it is already explained many times. Just google for &quot;generic in go&quot;. Take a look and you find why, and also you can find replacements. Good luck,"}, {"owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "reply_to_user": {"reputation": 464, "user_id": 9319868, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tvNq9bb_utY/AAAAAAAAAAI/AAAAAAAAAHQ/_NxCEx1tPZg/photo.jpg?sz=128", "display_name": "Lev Knoblock", "link": "https://stackoverflow.com/users/9319868/lev-knoblock"}, "edited": false, "score": 0, "creation_date": 1528177789, "post_id": 50688234, "comment_id": 88395185, "body": "Qk, one example. In Java you create a list with a type-generic, and in this way you can use the items of the list as that type. In Go you work with slices instead, and they are already of a specific type. So you can use the items of the slice as that type. To be more generic, if desired, you can make slices of interfaces instead of structs, and in this way you can put more types of structs in a slice, as long as the same interface is applicable. There are also type-assertions to be more type specific if needed. See? But there is more to explain. Work with it, you will learn. It is fun.."}], "tags": [], "owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "is_accepted": false, "score": -2, "last_activity_date": 1528150231, "last_edit_date": 1528150231, "creation_date": 1528143823, "answer_id": 50688234, "question_id": 50686965, "link": "https://stackoverflow.com/questions/50686965/golang-generic-ish-hashmap/50688234#50688234", "title": "Golang Generic-ish Hashmap", "body": "<p>To create functions like contains for maps, you do not need generics. Go can handle this very well, there are more ways to do this, depending on use case some ways can have better performance. You can, for example, consider writing a hashcode function</p>\n\n<p>But there is something more to it to consider.</p>\n\n<p>In Java generics is just code sugar. In runtime, maps or lists in Java have the same functionality as in Golang. The object which becomes visible in a map-action will have features that belong to that object. This is the same in Java and Golang. So in golang you don't have the syntactic sugar, so you have to remember yourself which objects you can excpect in maps, lists, etc.</p>\n\n<p>Read here about syntactic sugar in Java. It will help you accept the choices the Go-designers made.</p>\n\n<p><a href=\"https://www.cordinc.com/blog/2010/09/java-generics-are-not-real-gen.html\" rel=\"nofollow noreferrer\">https://www.cordinc.com/blog/2010/09/java-generics-are-not-real-gen.html</a></p>\n"}], "owner": {"reputation": 464, "user_id": 9319868, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-tvNq9bb_utY/AAAAAAAAAAI/AAAAAAAAAHQ/_NxCEx1tPZg/photo.jpg?sz=128", "display_name": "Lev Knoblock", "link": "https://stackoverflow.com/users/9319868/lev-knoblock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 856, "favorite_count": 0, "accepted_answer_id": 50687121, "answer_count": 2, "score": 0, "last_activity_date": 1528150231, "creation_date": 1528138075, "last_edit_date": 1528139276, "question_id": 50686965, "link": "https://stackoverflow.com/questions/50686965/golang-generic-ish-hashmap", "title": "Golang Generic-ish Hashmap", "body": "<p>I'm trying to make a wrapper in go for the map[] type so that I can add some methods like contains() (this almost makes me miss java). However, I don't know how I can do anything like generics in java.</p>\n\n<p>While almost everything I've read says that golang doesn't have generic types, there must be a better way than writing a separate struct for every single possible combination of structs and values that I'm using.</p>\n\n<p>Here's what I'm trying to do, even though the code doesn't work: </p>\n\n<pre><code>func newMap(key interface{}, val interface{}) {\n    keytype := key.(type)\n    valtype := val.(type)\n\n    return hashmap{map[keytype]valtype}\n}\n\ntype hashmap struct {\n    hashmap     map[]\n}\n</code></pre>\n\n<p>Any help/explanation on how to do this would be appreciated.</p>\n\n<p>EDIT: Contains isn't the only thing I'm trying to replicate, hence the desire to make a \"generic\" hashmap. replace(), isEmpty(), all that fun stuff as well.</p>\n"}, {"tags": ["go", "goland"], "answers": [{"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": false, "score": 0, "last_activity_date": 1530821348, "creation_date": 1530821348, "answer_id": 51199121, "question_id": 50686863, "link": "https://stackoverflow.com/questions/50686863/golang-autoreload-on-goland-jetbrains-ide/51199121#51199121", "title": "Golang autoreload on Goland (Jetbrains IDE)?", "body": "<p>The \"Go Build\" run configuration does not have an auto-reload feature (as opposed to the \"Go Test\" one which does).</p>\n\n<p>You can use the builtin Terminal (ALT+F12), to run the command you mentioned and even use a different tab for that.</p>\n\n<p>If you need this feature, please open an issue on <a href=\"https://youtrack.jetbrains.com/issues/Go\" rel=\"nofollow noreferrer\">the tracker</a>.</p>\n"}], "owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1201, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1530821706, "creation_date": 1528137629, "last_edit_date": 1530821706, "question_id": 50686863, "link": "https://stackoverflow.com/questions/50686863/golang-autoreload-on-goland-jetbrains-ide", "title": "Golang autoreload on Goland (Jetbrains IDE)?", "body": "<p>I'm currently using <a href=\"https://github.com/codegangsta/gin\" rel=\"nofollow noreferrer\">gin</a> to autoreload my app, but I wanted to know if it was possible to autoreload directly from Goland IDE?</p>\n\n<p>this is the command I always use to autoreload:</p>\n\n<pre><code>gin --all --immediate --path . --build .\n</code></pre>\n\n<p>I have googled for documentation but can't find any info about livereload from Goland IDE. </p>\n"}, {"tags": ["go", "shutdown"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1528137844, "post_id": 50686745, "comment_id": 88383522, "body": "If you already have the code to call <code>Shutdown</code> when the heartbeat doesn&#39;t arrive, how is it any different than calling the cancelation func for a context?"}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528137920, "post_id": 50686745, "comment_id": 88383547, "body": "I was hoping (under the impression) that I could get the cancellation to be called automatically so that I would not need the separate heartbeat URL."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1528138040, "post_id": 50686745, "comment_id": 88383604, "body": "Closing a browser alone doesn&#39;t do anything on the server. Without a request of some sort, there&#39;s no magic to notify the context that it&#39;s canceled."}], "answers": [{"comments": [{"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 1, "creation_date": 1528140848, "post_id": 50687594, "comment_id": 88384909, "body": "Thanks. I&#39;ll have to try that."}, {"owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "reply_to_user": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1528141073, "post_id": 50687594, "comment_id": 88384983, "body": "@Ralph Do note that while this can reduce your bandwidth usage considerably (useful for mobile), this still requires you to send something over the connection every so often to prevent the connection from timing out. I&#39;m not sure how long is the timeout though."}, {"owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "edited": false, "score": 0, "creation_date": 1528141285, "post_id": 50687594, "comment_id": 88385064, "body": "I can probably find that online or test it out (maybe try a couple of minutes between pings)."}], "tags": [], "owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "is_accepted": true, "score": 3, "last_activity_date": 1528140804, "creation_date": 1528140804, "answer_id": 50687594, "question_id": 50686745, "link": "https://stackoverflow.com/questions/50686745/shutting-down-a-go-server-on-browser-close/50687594#50687594", "title": "Shutting down a Go server on browser close", "body": "<p>Instead of sending a \"heartbeat\" request every so often, you could take advantage of <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events\" rel=\"nofollow noreferrer\">server-sent events</a>.</p>\n\n<p>Server-sent events is a web technology where the browser makes a HTTP request and keeps the connection open to receive events from the server. This could replace your need for repeated heartbeat requests by having the server shutdown when the connection to the event source is closed.</p>\n\n<p>Here's a basic server implementation in Go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/heartbeat\", func(w http.ResponseWriter, r *http.Request) {\n        w.Header().Set(\"Content-Type\", \"text/event-stream\")\n        w.Header().Set(\"Cache-Control\", \"no-cache\")\n        w.Header().Set(\"Connection\", \"keep-alive\")\n\n        flusher, ok := w.(http.Flusher)\n        if !ok {\n            http.Error(w, \"your browser doesn't support server-sent events\")\n            return\n        }\n\n        // Send a comment every second to prevent connection timeout.\n        for {\n            _, err := fmt.Fprint(w, \": ping\")\n            if err != nil {\n                log.Fatal(\"client is gone, shutting down\")\n                return\n            }\n            flusher.Flush()\n            time.Sleep(time.Second)\n        }\n    })\n    fmt.Println(http.ListenAndServe(\":1323\", nil))\n}\n</code></pre>\n\n<p>See <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events\" rel=\"nofollow noreferrer\">using server-sent events</a> for a guide on the client side.</p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1528145988, "last_edit_date": 1528145988, "creation_date": 1528145424, "answer_id": 50688576, "question_id": 50686745, "link": "https://stackoverflow.com/questions/50686745/shutting-down-a-go-server-on-browser-close/50688576#50688576", "title": "Shutting down a Go server on browser close", "body": "<p>Open a websocket connection from the page. On the server, exit when the websocket connection is closed:</p>\n\n<pre><code>func wsHandler(w http.ResponseWriter, r *http.Request) {\n    conn, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        log.Println(err)\n        return\n    }\n    defer c.Close()\n\n    // Shutdown on exit from handler\n    defer server.Shutdown(context.Background())\n\n    // Read  messages from client. NextReader returns an error\n    // when the client shuts down.\n    for {\n        if _, _, err := c.NextReader(); err != nil {\n            break\n        }\n    }\n }\n</code></pre>\n\n<p>Add this line of code to the client application:</p>\n\n<pre><code> var conn = new WebSocket(\"ws://\" + document.location.host + \"/ws\");\n</code></pre>\n\n<p>Ensure that <code>conn</code> has lifetime of the page.</p>\n\n<p>This is somewhat similar to the SSE solution suggested in another answer, but has the advantage of working in more browsers.</p>\n\n<p>There's no need to send a heartbeat because this is on local host.</p>\n"}], "owner": {"reputation": 29052, "user_id": 96233, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/85735330505ef1c84896fcb86491bd0b?s=128&d=identicon&r=PG", "display_name": "Ralph", "link": "https://stackoverflow.com/users/96233/ralph"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 520, "favorite_count": 2, "accepted_answer_id": 50687594, "answer_count": 2, "score": 2, "last_activity_date": 1529250673, "creation_date": 1528137119, "last_edit_date": 1529250673, "question_id": 50686745, "link": "https://stackoverflow.com/questions/50686745/shutting-down-a-go-server-on-browser-close", "title": "Shutting down a Go server on browser close", "body": "<p>I wrote a small checkbook ledger in Go as a server that runs in localhost and opens the default browser to a small web app front-end (<a href=\"https://bitbucket.org/grkuntzmd/checks-and-balances\" rel=\"nofollow noreferrer\">https://bitbucket.org/grkuntzmd/checks-and-balances</a>).</p>\n\n<p>To automatically shut down the server when the browser tab is closed, I have the browser call a \"heartbeat\" URL every few seconds. If that heartbeat does not arrive, the server uses <a href=\"https://golang.org/pkg/net/http/#Server.Shutdown\" rel=\"nofollow noreferrer\"><code>(*Server) Shutdown</code></a> to stop running.</p>\n\n<p>Is there any way to do the same thing using contexts (<a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/context/</a>)? It is my understanding from watching <a href=\"https://www.youtube.com/watch?v=LSzR0VEraWw\" rel=\"nofollow noreferrer\">this</a> episode of JustForFunc that a context passed down to a handler will be notified if the client cancels a request.</p>\n"}, {"tags": ["performance", "docker", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528136763, "post_id": 50686570, "comment_id": 88383027, "body": "Have you tried profiling the app to see where the time is being spent?"}, {"owner": {"reputation": 179, "user_id": 9006220, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oZtv7.jpg?s=128&g=1", "display_name": "adtac", "link": "https://stackoverflow.com/users/9006220/adtac"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528137338, "post_id": 50686570, "comment_id": 88383318, "body": "@JimB do you have any tool you want me to try with? Trying to profile the running Docker process with pprof now. I have a strong suspicion it&#39;s network related, but I&#39;m not sure."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528137897, "post_id": 50686570, "comment_id": 88383536, "body": "Use pprof. It would be good to <i>know</i> it&#39;s network related, rather than guessing."}, {"owner": {"reputation": 179, "user_id": 9006220, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oZtv7.jpg?s=128&g=1", "display_name": "adtac", "link": "https://stackoverflow.com/users/9006220/adtac"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528138738, "post_id": 50686570, "comment_id": 88383932, "body": "@JimB Docker&#39;s disk I/O was the bottleneck. Added an answer on how changing to an in-memory sqlite3 database solved all perf issues."}], "answers": [{"tags": [], "owner": {"reputation": 179, "user_id": 9006220, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oZtv7.jpg?s=128&g=1", "display_name": "adtac", "link": "https://stackoverflow.com/users/9006220/adtac"}, "is_accepted": false, "score": 1, "last_activity_date": 1528176018, "last_edit_date": 1528176018, "creation_date": 1528138667, "answer_id": 50687094, "question_id": 50686570, "link": "https://stackoverflow.com/questions/50686570/huge-performance-hit-on-a-simple-go-server-with-docker/50687094#50687094", "title": "Huge performance hit on a simple Go server with Docker", "body": "<p>Using an in-memory sqlite3 database completely solved all performance issues!</p>\n\n<pre><code>db, err = sql.Open(\"sqlite3\", \"file=dco.sqlite3?mode=memory\")\n</code></pre>\n\n<p>I knew there was a disk I/O penalty hit associated with Docker's abstractions (even on Linux; I've heard it's worse on macOS), but I didn't know it would be ~16x.</p>\n\n<p><strong>Edit:</strong> Using an in-memory database isn't really an option most of the time. So I found another sqlite-specific solution. Before all database operations, do this to switch sqlite to WAL mode instead of the default rollback journal:</p>\n\n<pre><code>PRAGMA journal_mode=WAL;\nPRAGMA synchronous=NORMAL;\n</code></pre>\n\n<p>This dramatically improved the Docker version's performance to over 2.7k requests/sec!</p>\n"}], "owner": {"reputation": 179, "user_id": 9006220, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oZtv7.jpg?s=128&g=1", "display_name": "adtac", "link": "https://stackoverflow.com/users/9006220/adtac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 556, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1528176018, "creation_date": 1528136373, "last_edit_date": 1528137153, "question_id": 50686570, "link": "https://stackoverflow.com/questions/50686570/huge-performance-hit-on-a-simple-go-server-with-docker", "title": "Huge performance hit on a simple Go server with Docker", "body": "<p>I've tried several things to get to the root of this, but I'm clueless.</p>\n\n<p><a href=\"http://ix.io/1cjN/go\" rel=\"nofollow noreferrer\">Here's the Go program.</a> It's just one file and has a <code>/api/sign</code> endpoint that accepts POST requests. These POST requests have three fields in the body, and they are logged in a sqlite3 database. Pretty basic stuff.</p>\n\n<p><a href=\"http://ix.io/1cjR\" rel=\"nofollow noreferrer\">I wrote a simple Dockerfile to containerize it.</a> Uses <code>golang:1.7.4</code> to build the binary and copies it over to <code>alpine:3.6</code> for the final image. Once again, nothing fancy.</p>\n\n<p>I use <a href=\"https://github.com/wg/wrk\" rel=\"nofollow noreferrer\"><code>wrk</code></a> to benchmark performance. With 8 threads and 1k connections for 50 seconds (<code>wrk -t8 -c1000 -d50s -s post.lua http://server.com/api/sign</code>) and <a href=\"http://ix.io/1cjT/lua\" rel=\"nofollow noreferrer\">a lua script</a> to create the post requests, I measured the number of requests per second between different situations. In all situations, I run <code>wrk</code> from my laptop and the server is in DigitalOcean VPS (2 vCPUs, 2 GB RAM, SSD, Debian 9.4) that's very close to me.</p>\n\n<ul>\n<li><p>Directly running the binary produced <strong>2979 requests/sec</strong>.</p></li>\n<li><p>Docker (<code>docker run -it -v $(pwd):/data -p 8080:8080 image</code>) produced <strong>179 requests/sec</strong>.</p></li>\n</ul>\n\n<p>As you can see, the Docker version is over 16x slower than running the binary directly. Everything else is the same during both experiments.</p>\n\n<p>I've tried the following things and there is practically no improvement in performance in the Docker version:</p>\n\n<ul>\n<li><p>Tried using host networking instead of bridge. There was a slight increase to around 190 requests/sec, but it's still miserable.</p></li>\n<li><p>Tried increasing the limit on the number of file descriptors in the container version with <code>--ulimit nofile=262144:262144</code>. No improvement.</p></li>\n<li><p>Tried different go versions, nothing.</p></li>\n<li><p>Tried <code>debian:9.4</code> for the final image instead of <code>alpine:3.7</code> in the hope that it's musl that's performing terribly. Nothing here either.</p></li>\n<li><p>(Edit) Tried running the container without a mounted volume and there's still no performance improvement.</p></li>\n</ul>\n\n<p>I'm out of ideas at this point. Any help would be much appreciated!</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 0, "last_activity_date": 1528142277, "creation_date": 1528142277, "answer_id": 50687934, "question_id": 50686566, "link": "https://stackoverflow.com/questions/50686566/golang-template-double-parent-context/50687934#50687934", "title": "golang template double parent context", "body": "<p>From <a href=\"https://golang.org/pkg/text/template/#hdr-Variables\" rel=\"nofollow noreferrer\">https://golang.org/pkg/text/template/#hdr-Variables</a>:</p>\n\n<blockquote>\n  <p>A template invocation does not inherit variables from the point of its\n  invocation.</p>\n</blockquote>\n\n<p>However you can emulate globals by registering a function.</p>\n\n<pre><code>t := template.Must(template.New(\"main\").\n     Funcs(template.FuncMap{\n         \"Global\": func() string {return \"true\"},\n     }).\n     Parse(`...`))\n</code></pre>\n\n<p>Then in your template code you just use <code>{{Global}}</code> whereever you need to access the \"global\" value.</p>\n\n<p><a href=\"https://play.golang.org/p/oOmWqOIKFx5\" rel=\"nofollow noreferrer\">https://play.golang.org/p/oOmWqOIKFx5</a></p>\n"}], "owner": {"reputation": 629, "user_id": 3737786, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/aa0d239b2b0aaba3206246d52a87f268?s=128&d=identicon&r=PG&f=1", "display_name": "bsbak", "link": "https://stackoverflow.com/users/3737786/bsbak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1528142277, "creation_date": 1528136357, "last_edit_date": 1528140348, "question_id": 50686566, "link": "https://stackoverflow.com/questions/50686566/golang-template-double-parent-context", "title": "golang template double parent context", "body": "<p>I am trying to access variable from double parent context. \nMy code is:</p>\n\n<p><code>dot</code> is <code>ColumnBlock</code>:</p>\n\n<pre><code>// template content\n&lt;h4&gt;{{.Global}}&lt;/h4&gt; // he is fine\n...\n&lt;div class=\"row\"&gt;\n    &lt;div class=\"col-12\"&gt;{{template \"column\" .LeftColumn}}&lt;/div&gt;\n    &lt;div class=\"col-12\"&gt;{{template \"column\" .RightColumn}}&lt;/div&gt;\n&lt;/div&gt;\n\n// template column\n{{range .Columns}}\n&lt;div id=\"x-{{$.Kind}}-{{.ID}}\"&gt;{{.Text}} - {{$.Global}}&lt;/div&gt; // here Global is unavailable.\n{{end}}\n</code></pre>\n\n<p>go:</p>\n\n<pre><code>type Column struct {\n    ID int\n    Text string\n}\n\ntype ColumnList struct {\n    Kind string\n    Columns []Column\n}\n\ntype ColumnBlock struct {\n    Global bool\n    LeftColumn ColumnList\n    RightColumn ColumnList\n}\n</code></pre>\n\n<p>How can i access <code>.Global</code> variable from <code>column template</code>?</p>\n\n<p>Example: <a href=\"https://play.golang.org/p/kpPPMT8al5y\" rel=\"nofollow noreferrer\">PLAYGROUND</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528171489, "post_id": 50685339, "comment_id": 88393227, "body": "Well, as <code>InList</code> does not use the <code>*Service</code> you should not make it a method of Service at all: A plain function would do. And please: Do not name receivers <code>this</code>."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1528131190, "creation_date": 1528131190, "answer_id": 50685370, "question_id": 50685339, "link": "https://stackoverflow.com/questions/50685339/go-test-function-with-pointer-reference/50685370#50685370", "title": "Go test function with pointer reference", "body": "<p>You have to call a method on an <em>instance</em> of its receiver type. So, for a method defined on <code>*Service</code>, you must call it on an <em>instance of</em> <code>*Service</code>:</p>\n\n<pre><code>var foo *Service\nfoo = &amp;Service{}\nfoo.InList(personID, personIDs)\n</code></pre>\n\n<p>However, in your case, there's no reason for this to be a method; it doesn't seem to have anything at all to do with its receiver (it never references it), so it could just be a regular function. Also note that it's unidiomatic to name the receiver <code>this</code> in Go.</p>\n\n<p>I also highly recommend at least taking the <a href=\"https://tour.golang.org/methods/1\" rel=\"nofollow noreferrer\">Go tour</a>, which covers writing methods in detail, with interactive examples.</p>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1528131589, "post_id": 50685429, "comment_id": 88380578, "body": "While technically accurate, this is not a construct one sees very often in the wild. It&#39;s more common to call a method on an actual <code>nil</code> pointer than to call a method as a function like this."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1528131606, "last_edit_date": 1528131606, "creation_date": 1528131408, "answer_id": 50685429, "question_id": 50685339, "link": "https://stackoverflow.com/questions/50685339/go-test-function-with-pointer-reference/50685429#50685429", "title": "Go test function with pointer reference", "body": "<p>The correct syntax for the <a href=\"https://golang.org/ref/spec#Method_expressions\" rel=\"nofollow noreferrer\">method expression</a> is:</p>\n\n<pre><code>ok := (*Service).InList(nil, personID, personIDs)\n</code></pre>\n\n<p>This snippet adds <code>nil</code> as the receiver argument and uses parentheses to specify the type correctly.</p>\n\n<p>The approached used in the question is not idiomatic. Either call a method on a value </p>\n\n<pre><code>s := Service{}\nok := s.InList(personID, personIDs)\n</code></pre>\n\n<p>or convert the method to a function.</p>\n"}, {"tags": [], "owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "is_accepted": false, "score": 0, "last_activity_date": 1528145682, "creation_date": 1528145682, "answer_id": 50688634, "question_id": 50685339, "link": "https://stackoverflow.com/questions/50685339/go-test-function-with-pointer-reference/50688634#50688634", "title": "Go test function with pointer reference", "body": "<p>If you do not reference the receiver object, then you should not have one, keep your code as simple as possible.</p>\n\n<p>There are three ways of writing a method or function, with each its own purpose.</p>\n\n<ol>\n<li>without receiver, when no receiver is referenced in the function ( we call this a function )</li>\n<li>a value receiver, the receiver is referenced, but not changed in the method ( we call this a method )</li>\n<li>a pointer receiver, something in the receiver will be changed in the method</li>\n</ol>\n"}], "owner": {"reputation": 1412, "user_id": 2752065, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/0ce2fdf5a902f6b23843d59e02c06c4a?s=128&d=identicon&r=PG&f=1", "display_name": "elcharrua", "link": "https://stackoverflow.com/users/2752065/elcharrua"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1978, "favorite_count": 0, "accepted_answer_id": 50685370, "answer_count": 3, "score": -1, "last_activity_date": 1528145682, "creation_date": 1528131079, "question_id": 50685339, "link": "https://stackoverflow.com/questions/50685339/go-test-function-with-pointer-reference", "title": "Go test function with pointer reference", "body": "<p>I'm working on unit tests on a Go project, and I'm new to Go. So to start I wanted to test something easy. And I started with this function:</p>\n\n<pre><code>func (this *Service) InList(idPerson string, personsId []string) bool {\n    for _, personsId := range personsId {\n        if id == idPerson {\n            return true\n        }\n    }\n\n    return false\n}\n</code></pre>\n\n<p>Service is a struct defined on top of the class.</p>\n\n<p>This is the test I wrote:</p>\n\n<pre><code>func TestValidatePersonID(t *testing.T) {\n   personID := \"12345\"\n\n   personIDs := []string{\"12345\", \"123456t\", \"1234567a\"}\n\n   ok := *Service.InList(personID, personIDs)\n\n   if !ok {\n      t.Errorf(\"Id %v not found\", personID)\n   }\n}\n</code></pre>\n\n<p>If i try to Call Service without * I get the error: </p>\n\n<blockquote>\n  <p>invalid method expresion (needs pointer reciever)</p>\n</blockquote>\n\n<p>If i try to call the function (*Service).inList, it says I'm missing an argument. I'm new to Go if anyone could point to me what I'm doing wrong and how Could I get a pointer receiver of that Service in my test?. I would appreciatte it.</p>\n"}, {"tags": ["arrays", "sorting", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1528129996, "post_id": 50685035, "comment_id": 88379777, "body": "If something won&#39;t compile or run, include any errors generated in your question."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528171546, "post_id": 50685035, "comment_id": 88393247, "body": "&quot;But code sharing is always good.&quot; From wrong assumptions follows arbitrary falsehood."}, {"owner": {"reputation": 5455, "user_id": 555493, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7f71360d1b97bf28012fffa173ec0eb0?s=128&d=identicon&r=PG", "display_name": "U Avalos", "link": "https://stackoverflow.com/users/555493/u-avalos"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528475759, "post_id": 50685035, "comment_id": 88537512, "body": "OK @volker, maybe not always but in this context yes! I&#39;d hate to work on code where I&#39;m copy/pasting reverse loops all over the place (in fact, that&#39;s what prompted this question). DRY anyone?"}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1528130444, "post_id": 50685140, "comment_id": 88379992, "body": "You don&#39;t have to use the interface any more. You can just use <a href=\"https://golang.org/pkg/sort/#Slice\" rel=\"nofollow noreferrer\">sort.Slice</a>."}, {"owner": {"reputation": 5455, "user_id": 555493, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7f71360d1b97bf28012fffa173ec0eb0?s=128&d=identicon&r=PG", "display_name": "U Avalos", "link": "https://stackoverflow.com/users/555493/u-avalos"}, "edited": false, "score": 0, "creation_date": 1528131176, "post_id": 50685140, "comment_id": 88380354, "body": "Ah sort.Reverse expects an ordering. How does this compare to a <code>for</code> loop? It&#39;s a shame a built-in &quot;array&quot; interface doesn&#39;t exist, so that you could just write a generic for loop."}, {"owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "reply_to_user": {"reputation": 5455, "user_id": 555493, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7f71360d1b97bf28012fffa173ec0eb0?s=128&d=identicon&r=PG", "display_name": "U Avalos", "link": "https://stackoverflow.com/users/555493/u-avalos"}, "edited": false, "score": 1, "creation_date": 1528131579, "post_id": 50685140, "comment_id": 88380569, "body": "@UAvalos This isn&#39;t unique to Go. When you want to sort an array of objects, you must specify the ordering since the sort function can&#39;t tell by which field or fields you want to sort. Even in python you must say: <code>people.sort(lambda person: person.name)</code> which isn&#39;t very far from Go&#39;s <code>sort.Slice</code> shorthand."}, {"owner": {"reputation": 5455, "user_id": 555493, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7f71360d1b97bf28012fffa173ec0eb0?s=128&d=identicon&r=PG", "display_name": "U Avalos", "link": "https://stackoverflow.com/users/555493/u-avalos"}, "edited": false, "score": 0, "creation_date": 1528167757, "post_id": 50685140, "comment_id": 88392425, "body": "Even in python? Not true in Javascript. Not true in Java. You&#39;ve misunderstood the comments if you think you must specify a sort function... (Reverse literally means the array in reverse, no sort ordering required)"}], "tags": [], "owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "is_accepted": false, "score": 1, "last_activity_date": 1528131247, "last_edit_date": 1528131247, "creation_date": 1528130368, "answer_id": 50685140, "question_id": 50685035, "link": "https://stackoverflow.com/questions/50685035/how-to-reverse-an-arbitrary-array-in-go/50685140#50685140", "title": "How to reverse an arbitrary array in go?", "body": "<p><code>[]A</code> is not an int slice, it's a slice of structs and you must implement a <code>sort.Interface</code> to describe how to sort it.</p>\n\n<p>Here's a working example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\ntype A struct {\n    X int\n}\n\ntype ByX []A\n\nfunc (a ByX) Len() int           { return len(a) }\nfunc (a ByX) Swap(i, j int)      { a[i], a[j] = a[j], a[i] }\nfunc (a ByX) Less(i, j int) bool { return a[i].X &lt; a[j].X }\n\nfunc main() {\n    x := make([]A, 0)\n    x = append(x, A{1})\n    x = append(x, A{2})\n    sort.Sort(sort.Reverse(ByX(x)))\n    fmt.Println(x)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/uMncReY6NvQ\" rel=\"nofollow noreferrer\">Try it on the Go playground</a>.</p>\n\n<p>Alternatively, you can call <code>sort.Slice</code> and provide it with only the <code>Less</code> function:</p>\n\n<pre><code>sort.Slice(x, func(i, j int) bool { return x[i].X &gt; x[j].X })\n</code></pre>\n\n<p>You should notice that the less function is different. Since we want to sort in reverse and the shorthand <code>sort.Slice</code> isn't compatible with <code>sort.Reverse</code>, we had to modify the less function to return the opposite (<code>&gt;</code> instead of <code>&lt;</code>).</p>\n"}], "owner": {"reputation": 5455, "user_id": 555493, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7f71360d1b97bf28012fffa173ec0eb0?s=128&d=identicon&r=PG", "display_name": "U Avalos", "link": "https://stackoverflow.com/users/555493/u-avalos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 704, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1528475953, "creation_date": 1528129912, "last_edit_date": 1528475953, "question_id": 50685035, "link": "https://stackoverflow.com/questions/50685035/how-to-reverse-an-arbitrary-array-in-go", "title": "How to reverse an arbitrary array in go?", "body": "<p>Of course, one can always write a for loop. But code sharing is usually always good. So is there a way to write a method that sorts <em>any</em> array? Also, performance, so I'm guessing that rules out reflection.</p>\n\n<p><code>sort.Reverse</code> doesn't seem to work. The following will not compile:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\ntype A struct {\n    X int\n}\n\nfunc main() {\nx := make([]A, 0)\nx = append(x, A{1})\nx = append(x, A{2})\nsort.Reverse(sort.IntSlice(x))\nfmt.Println(x)\n}\n</code></pre>\n"}, {"tags": ["go", "sqlx"], "owner": {"reputation": 131, "user_id": 7064987, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60b685ddf11a70fab0556afbbcb47c1b?s=128&d=identicon&r=PG&f=1", "display_name": "carousel", "link": "https://stackoverflow.com/users/7064987/carousel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 962, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1528164456, "creation_date": 1528128824, "last_edit_date": 1528164456, "question_id": 50684778, "link": "https://stackoverflow.com/questions/50684778/i-got-an-error-when-i-use-sqlx-transaction-tx-namedquery", "title": "I got an error when I use sqlx transaction,tx.NamedQuery()", "body": "<p>I got an error when I use sqlx transaction,tx.NamedQuery() to run a transaction with postgresql.\nSometimes I need the first sql's returning id to execute the other sql, so I used tx.NamedQuery not tx.NamedExec(). The code works correctly if I use tx.NamedExec().</p>\n\n<p>Here is the code, thank you</p>\n\n<p>`</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    _ \"github.com/lib/pq\" // PostgreSQL\n    \"github.com/jmoiron/sqlx\"\n    \"github.com/lib/pq\"\n    \"fmt\"\n)\n\ntype Test struct {\n    Id   int           `json:\"id\" db:\"id\" form:\"id\"`\n    Name string        `json:\"name\" db:\"name\" form:\"name\"`\n    Role pq.Int64Array `json:\"role\" db:\"role\" form:\"role\"`\n}\n\nfunc main() {\n    db, err := sqlx.Connect(\"postgres\", \"user=postgres password=*** dbname=*** sslmode=disable\")\n    if err != nil {\n        log.Panicln(err)\n    }\n    defer db.Close()\n    db.SetMaxOpenConns(1)\n    tx, err := db.Beginx()\n    test := Test{Name: \"name\", Role: []int64{1, 2, 3}}\n    _, err1 := tx.NamedQuery(`INSERT  INTO test(name,role) VALUES (:name,:role)returning id`, test)\n    fmt.Println(err1)\n    _, err1 = tx.NamedQuery(`INSERT  INTO test(name,role) VALUES (:name,:role)returning id`, test)\n    fmt.Println(err1)\n    _, err1 = tx.NamedQuery(`INSERT  INTO test(name,role) VALUES (:name,:role)returning id`, test)\n    fmt.Println(err1)\n    _, err1 = tx.NamedQuery(`INSERT  INTO test(name,role) VALUES (:name,:role)returning id`, test)\n    fmt.Println(err1)\n    _, err1 = tx.NamedQuery(`INSERT  INTO test(name,role) VALUES (:name,:role)returning id`, test)\n    fmt.Println(err1)\n    tx.Commit()\n}\n</code></pre>\n\n<p>`</p>\n\n<p>output:</p>\n\n<pre><code>   &lt;nil&gt;\npq: unexpected Parse response 'D'\ndriver: bad connection\ndriver: bad connection\ndriver: bad connection\n\nProcess finished with exit code 0\n</code></pre>\n"}, {"tags": ["pointers", "variables", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 6, "creation_date": 1528127409, "post_id": 50684401, "comment_id": 88378493, "body": "What was the result of your test?"}, {"owner": {"reputation": 3132, "user_id": 3960815, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/QKWIX.jpg?s=128&g=1", "display_name": "basic", "link": "https://stackoverflow.com/users/3960815/basic"}, "edited": false, "score": 1, "creation_date": 1528127430, "post_id": 50684401, "comment_id": 88378501, "body": "Kinda seems like a homework question. Have you tested it?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1528127571, "post_id": 50684401, "comment_id": 88378582, "body": "Exported functions don&#39;t operate any differently than non-exported."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1528129280, "post_id": 50684401, "comment_id": 88379450, "body": "You have all the code necessary to find the answer, why not just run it and find out?"}], "answers": [{"tags": [], "owner": {"reputation": 34, "user_id": 2063628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30c950e7ed20c68544e20c9f5a7a9191?s=128&d=identicon&r=PG", "display_name": "Drahoslav", "link": "https://stackoverflow.com/users/2063628/drahoslav"}, "is_accepted": true, "score": 0, "last_activity_date": 1528138694, "creation_date": 1528138694, "answer_id": 50687109, "question_id": 50684401, "link": "https://stackoverflow.com/questions/50684401/when-i-pass-a-variable-into-a-private-method-in-golang-does-it-create-a-new-ins/50687109#50687109", "title": "When I pass a variable into a private method in golang, does it create a new instance?", "body": "<p>None. It won't compile because neither <code>'foo'</code> nor <code>'bar'</code> is a single character. But let's say you used double quotes instead. </p>\n\n<p>In Golang, arguments are passed by value (they are copied to the new place in memory - stack or heap), and it does not matter whether it is a private or a public method or arbitrary function. The new instance is modified. The result of your example will be <code>\"foo\"</code>.</p>\n\n<p>In order to modify variable lying outside of the function, you have to explicitly pass the pointer pointing to such variable.</p>\n\n<pre><code>func modify(s *string) {\n  *s = \"bar\"\n}\n\n...\n\nvar a = \"foo\"\nmodify(&amp;a)\nprintln(a) // will print \"bar\"\n</code></pre>\n\n<p>In this case pointer itself is passed by values (it is copied) but its value (the address of <code>a</code>) still points to the same variable. So the <code>a</code> can by modified through the pointer.</p>\n"}], "owner": {"reputation": 3, "user_id": 9866442, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Charles Yu", "link": "https://stackoverflow.com/users/9866442/charles-yu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 50687109, "answer_count": 1, "score": -7, "last_activity_date": 1528863626, "creation_date": 1528127361, "last_edit_date": 1528863626, "question_id": 50684401, "link": "https://stackoverflow.com/questions/50684401/when-i-pass-a-variable-into-a-private-method-in-golang-does-it-create-a-new-ins", "title": "When I pass a variable into a private method in golang, does it create a new instance?", "body": "<p>If I have main function:</p>\n\n<pre><code>var a = \"foo\"\nmodify(a)\nfmt.Println(a)\n</code></pre>\n\n<p>where</p>\n\n<pre><code>func modify(s string) error {\n  s = \"bar\"\n}\n</code></pre>\n\n<p>will the result be <code>\"foo\"</code> or <code>\"bar\"</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528122350, "post_id": 50682810, "comment_id": 88375305, "body": "Use that property by using <a href=\"https://golang.org/pkg/net/url/#Values.Add\" rel=\"nofollow noreferrer\"><code>Values.Add</code></a>"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 6, "last_activity_date": 1528122307, "creation_date": 1528122307, "answer_id": 50682831, "question_id": 50682810, "link": "https://stackoverflow.com/questions/50682810/why-are-golang-http-arguments-url-query-map-of-lists/50682831#50682831", "title": "Why are Golang http arguments (URL.Query()) map of lists?", "body": "<p>It is a list because it is allowed to send multiple copies of the same query string parameter in a URL, and yes, you can send query string parameters in requests.</p>\n\n<p>E.g. for a URL like <code>http://example.com/?foo=1&amp;foo=2</code>, <code>Query()</code> would return:</p>\n\n<pre><code>{\"foo\": [\"1\",\"2\"]}\n</code></pre>\n"}], "owner": {"reputation": 66, "user_id": 6172414, "user_type": "registered", "profile_image": "https://graph.facebook.com/10201462073349937/picture?type=large", "display_name": "Lucca Portes", "link": "https://stackoverflow.com/users/6172414/lucca-portes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 567, "favorite_count": 0, "accepted_answer_id": 50682831, "answer_count": 1, "score": -1, "last_activity_date": 1528122307, "creation_date": 1528122247, "question_id": 50682810, "link": "https://stackoverflow.com/questions/50682810/why-are-golang-http-arguments-url-query-map-of-lists", "title": "Why are Golang http arguments (URL.Query()) map of lists?", "body": "<p>When we call</p>\n\n<pre><code>r.URL.Query()\n</code></pre>\n\n<p>Inside a http route handler handler in Go, it returns a map[string][]string. I am wondering why is it a list and if I can use this property somehow when sending requests.</p>\n"}, {"tags": ["docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 503, "user_id": 5883716, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KSJl1k8-4sI/AAAAAAAAAAI/AAAAAAAAAJg/Fx5J5OlEiO0/photo.jpg?sz=128", "display_name": "Carlos Frias", "link": "https://stackoverflow.com/users/5883716/carlos-frias"}, "edited": false, "score": 0, "creation_date": 1528120820, "post_id": 50680615, "comment_id": 88374321, "body": "Could you provide the logs for the foobar_container? <code>docker-compose logs foobar_container</code>"}, {"owner": {"reputation": 503, "user_id": 5883716, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KSJl1k8-4sI/AAAAAAAAAAI/AAAAAAAAAJg/Fx5J5OlEiO0/photo.jpg?sz=128", "display_name": "Carlos Frias", "link": "https://stackoverflow.com/users/5883716/carlos-frias"}, "edited": false, "score": 0, "creation_date": 1528122521, "post_id": 50680615, "comment_id": 88375424, "body": "<code>foobar.sh</code> isn&#39;t executed inside the container, as far as the files you provided. Is there something missing?"}, {"owner": {"reputation": 4130, "user_id": 3790954, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/31b63ac22b1c2eacee316b23c8c580b0?s=128&d=identicon&r=PG&f=1", "display_name": "Escher", "link": "https://stackoverflow.com/users/3790954/escher"}, "reply_to_user": {"reputation": 503, "user_id": 5883716, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KSJl1k8-4sI/AAAAAAAAAAI/AAAAAAAAAJg/Fx5J5OlEiO0/photo.jpg?sz=128", "display_name": "Carlos Frias", "link": "https://stackoverflow.com/users/5883716/carlos-frias"}, "edited": false, "score": 1, "creation_date": 1528122872, "post_id": 50680615, "comment_id": 88375660, "body": "Yes, I didn&#39;t show the &quot;master&quot; setup script that pulls the latest code from the repository, runs <code>docker-compose up</code>, and then executes the build scripts for each container (including <code>foohar.sh</code>). Gimme a minute on the logs; I&#39;ve found a postgres connection issue in foobar&#39;s log."}, {"owner": {"reputation": 503, "user_id": 5883716, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KSJl1k8-4sI/AAAAAAAAAAI/AAAAAAAAAJg/Fx5J5OlEiO0/photo.jpg?sz=128", "display_name": "Carlos Frias", "link": "https://stackoverflow.com/users/5883716/carlos-frias"}, "edited": false, "score": 0, "creation_date": 1528123179, "post_id": 50680615, "comment_id": 88375872, "body": "Is that the order of execution? because it should execute <code>foobar.sh</code> before executing the <code>dockerize</code> command. If you run <code>docker-compose up</code>, dockerize command executes. Could you share it? at least the pertinent parts."}, {"owner": {"reputation": 4130, "user_id": 3790954, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/31b63ac22b1c2eacee316b23c8c580b0?s=128&d=identicon&r=PG&f=1", "display_name": "Escher", "link": "https://stackoverflow.com/users/3790954/escher"}, "reply_to_user": {"reputation": 503, "user_id": 5883716, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KSJl1k8-4sI/AAAAAAAAAAI/AAAAAAAAAJg/Fx5J5OlEiO0/photo.jpg?sz=128", "display_name": "Carlos Frias", "link": "https://stackoverflow.com/users/5883716/carlos-frias"}, "edited": false, "score": 0, "creation_date": 1528123449, "post_id": 50680615, "comment_id": 88376049, "body": "Ugh you&#39;re right. I can&#39;t run <code>main</code> until <code>main.go</code> is built, so I can&#39;t run <code>main</code> from <code>dockerize</code>. It&#39;s only working because I happen to have built a local binary which is getting copied into the container."}], "answers": [{"comments": [{"owner": {"reputation": 4130, "user_id": 3790954, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/31b63ac22b1c2eacee316b23c8c580b0?s=128&d=identicon&r=PG&f=1", "display_name": "Escher", "link": "https://stackoverflow.com/users/3790954/escher"}, "edited": false, "score": 1, "creation_date": 1528126584, "post_id": 50683400, "comment_id": 88377981, "body": "Thanks! With your astute comments about logs and order of execution I was able to resolve several obscure bugs (certain db tables missing that were created by other applications, etc) and get it working."}, {"owner": {"reputation": 503, "user_id": 5883716, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KSJl1k8-4sI/AAAAAAAAAAI/AAAAAAAAAJg/Fx5J5OlEiO0/photo.jpg?sz=128", "display_name": "Carlos Frias", "link": "https://stackoverflow.com/users/5883716/carlos-frias"}, "reply_to_user": {"reputation": 4130, "user_id": 3790954, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/31b63ac22b1c2eacee316b23c8c580b0?s=128&d=identicon&r=PG&f=1", "display_name": "Escher", "link": "https://stackoverflow.com/users/3790954/escher"}, "edited": false, "score": 0, "creation_date": 1528128090, "post_id": 50683400, "comment_id": 88378861, "body": "nice to hear it! Keep it up!"}], "tags": [], "owner": {"reputation": 503, "user_id": 5883716, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KSJl1k8-4sI/AAAAAAAAAAI/AAAAAAAAAJg/Fx5J5OlEiO0/photo.jpg?sz=128", "display_name": "Carlos Frias", "link": "https://stackoverflow.com/users/5883716/carlos-frias"}, "is_accepted": true, "score": 1, "last_activity_date": 1528124160, "creation_date": 1528124160, "answer_id": 50683400, "question_id": 50680615, "link": "https://stackoverflow.com/questions/50680615/cant-get-dep-and-dockerize-working-together-in-docker-compose-but-they-work-se/50683400#50683400", "title": "Can&#39;t get dep and dockerize working together in docker-compose (but they work separately). Why?", "body": "<p>There are a couple of things I found, first the execution order, you must ensure the <code>foobar.sh</code> gets executed first. As another recommendation, I wouldn't override the entire <code>/go</code> folder inside the container using volumes, instead use another subfolder, e.g <code>/go/github.com/my-project</code>.\nI got an app running using this configuration, based on yours:</p>\n\n<p><code>build_foobar/Dockerfile.foobar</code>:</p>\n\n<pre><code>FROM golang:latest\nWORKDIR /go\nRUN apt-get update &amp;&amp; apt-get install -y wget mosquitto-clients net-tools\nENV DOCKERIZE_VERSION v0.6.0\nRUN wget https://github.com/jwilder/dockerize/releases/download/$DOCKERIZE_VERSION/dockerize-linux-amd64-$DOCKERIZE_VERSION.tar.gz \\\n        &amp;&amp; tar -C /usr/local/bin -xzvf dockerize-linux-amd64-$DOCKERIZE_VERSION.tar.gz \\\n        &amp;&amp; rm dockerize-linux-amd64-$DOCKERIZE_VERSION.tar.gz\nADD foobar.sh /foobar.sh\n# RUN go build main.go\nRUN chmod +x /foobar.sh\n</code></pre>\n\n<p><code>build_foobar/foobar.sh</code>:</p>\n\n<pre><code>#!/bin/bash\n\n# mkdir -p /go/bin # required directory that may have been overwriten by docker-compose `volumes` param\necho \"++++++++ Downloading Golang dependencies ... ++++++++\"\ncd /go/src/foobar\ncurl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh\necho \"++++++++ Installing Golang dependencies ... ++++++++\"\ndep ensure\necho \"++++++++ Testing MQTT message broker ... ++++++++\"\nuntil [[ $(mosquitto_sub -h \"mosquitto\" -t '$SYS/#' -C 1 | cut -c 1-9) = \"mosquitto\" ]]; do\n    echo \"++++++++ Message broker is not ready. Waiting one second... ++++++++\"\n    sleep 1\ndone\necho \"++++++++ Building application... ++++++++\" \ngo build main.go\n\ndockerize -wait tcp://mosquitto:1883 -wait tcp://postgres:5432 -timeout 200s /go/src/foobar/main\n</code></pre>\n\n<p><code>foobar/main.go</code>: place your app main file</p>\n\n<p><code>docker-compose.yml</code>:</p>\n\n<pre><code>version: '3.3'\nservices:\n  foobar_container:\n    image: foobar_image\n    container_name: foobar\n    build:\n      context: ./build_foobar\n      dockerfile: Dockerfile.foobar\n    # command: dockerize -wait tcp://mosquitto:1883 -wait tcp://postgres:5432 -timeout 200s /go/src/foobar/main\n    # command: /bin/bash\n    command: /foobar.sh\n    volumes:\n      - ./foobar:/go/src/foobar\n    stdin_open: true\n    tty: true\n    external_links:\n      - mosquitto\n      - postgres\n    depends_on:\n      - mosquitto\n      - postgres\n    ports:\n      - 1833\n      - 8001\n  mosquitto:\n    image: eclipse-mosquitto\n  postgres:\n    image: postgres\n</code></pre>\n"}], "owner": {"reputation": 4130, "user_id": 3790954, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/31b63ac22b1c2eacee316b23c8c580b0?s=128&d=identicon&r=PG&f=1", "display_name": "Escher", "link": "https://stackoverflow.com/users/3790954/escher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 291, "favorite_count": 0, "accepted_answer_id": 50683400, "answer_count": 1, "score": 1, "last_activity_date": 1528124160, "creation_date": 1528115201, "last_edit_date": 1528122511, "question_id": 50680615, "link": "https://stackoverflow.com/questions/50680615/cant-get-dep-and-dockerize-working-together-in-docker-compose-but-they-work-se", "title": "Can&#39;t get dep and dockerize working together in docker-compose (but they work separately). Why?", "body": "<p>I have a curious situation where my docker-compose build won't complete when I use <code>dockerize</code> to wait for databases etc to be ready, and use <code>dep</code> to load my Go dependencies.</p>\n\n<p>Here's an extract from docker-compose.yml (there are mosquitto, postgres, and python containers in addition to the golang container shown below) </p>\n\n<pre><code>version '3.3'\nservices:\n\n   foobar_container:\n     image: foobar_image\n     container_name: foobar\n     build:\n      context: ./build_foobar\n      dockerfile: Dockerfile.foobar\n     #command: dockerize -wait tcp://mosquitto:1883 -wait tcp://postgres:5432 -timeout 200s /go/src/foobar/main\n     volumes:\n       - ./foobar:/go\n     stdin_open: true\n     tty: true\n     external_links:\n       - mosquitto\n       - postgres\n     ports:\n       - 1833\n       - 8001\n     depends_on:\n       - mosquitto\n       - postgres\n</code></pre>\n\n<p>Here's my Dockerfile.foobar</p>\n\n<pre><code>FROM golang:latest\n WORKDIR /go\n RUN apt-get update &amp;&amp; apt-get install -y wget mosquitto-clients net-tools\n ENV DOCKERIZE_VERSION v0.6.0\n RUN wget https://github.com/jwilder/dockerize/releases/download/$DOCKERIZE_VERSION/dockerize-linux-amd64-$DOCKERIZE_VERSION.tar.gz \\\n   &amp;&amp; tar -C /usr/local/bin -xzvf dockerize-linux-amd64-$DOCKERIZE_VERSION.tar.gz \\\n   &amp;&amp; rm dockerize-linux-amd64-$DOCKERIZE_VERSION.tar.gz\n ADD foobar.sh /foobar.sh\n #RUN go build main.go\n RUN chmod +x /foobar.sh\n</code></pre>\n\n<p>Here's my build script foobar.sh:</p>\n\n<pre><code>#!/bin/bash\n\nmkdir -p /go/bin # required directory that may have been overwriten by docker-compose `volumes` param\necho \"++++++++ Downloading Golang dependencies ... ++++++++\"\ncd /go/src/foobar\ncurl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh\necho \"++++++++ Installing Golang dependencies ... ++++++++\"\ndep ensure\necho \"++++++++ Testing MQTT message broker ... ++++++++\"\nuntil [[ $(mosquitto_sub -h \"mosquitto\" -t '$SYS/#' -C 1 | cut -c 1-9) = \"mosquitto\" ]]; do\n    echo \"++++++++ Message broker is not ready. Waiting one second... ++++++++\"\n    sleep 1\ndone\necho \"++++++++ Building application... ++++++++\" \ngo build main.go\n</code></pre>\n\n<p>If I uncomment the <code>command</code> line of <code>docker-compose.yml</code> my <code>foobar.sh</code> won't run past the <code>curl</code> line. No error is outputted, the execution just stops.\nIf I comment from <code>curl</code> onwards, and uncomment the <code>command</code> line, I can setup to completion (however the <code>foobar</code> container needs to me started manually). My python container (which depends on all postgres, go, and mosquitto containers) sets up fine.</p>\n\n<p>What's going wrong?</p>\n"}, {"tags": ["go", "runtime-error", "panic"], "comments": [{"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 3, "creation_date": 1528113738, "post_id": 50680127, "comment_id": 88369657, "body": "You&#39;ve shadowed the global map1 by your function definition."}, {"owner": {"reputation": 769, "user_id": 1814087, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/Oo4uE.jpg?s=128&g=1", "display_name": "nikhil", "link": "https://stackoverflow.com/users/1814087/nikhil"}, "reply_to_user": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 0, "creation_date": 1528113891, "post_id": 50680127, "comment_id": 88369750, "body": "@DenysS&#233;guret how do i make it work if i just want to return it with return statement??i.e instead of using return true,map1,nil can I use only return"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528114067, "post_id": 50680127, "comment_id": 88369850, "body": "@nikhil You cannot. Not doable, don&#39;t try. Redesign."}, {"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 0, "creation_date": 1528114101, "post_id": 50680127, "comment_id": 88369868, "body": "@nikhil hard to explain in comment so I make an answer. I&#39;ll delete it if I didn&#39;t understand what you&#39;re trying to do."}, {"owner": {"reputation": 769, "user_id": 1814087, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/Oo4uE.jpg?s=128&g=1", "display_name": "nikhil", "link": "https://stackoverflow.com/users/1814087/nikhil"}, "edited": false, "score": 0, "creation_date": 1528114520, "post_id": 50680127, "comment_id": 88370122, "body": "why question is downvoted?"}, {"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 1, "creation_date": 1528115227, "post_id": 50680127, "comment_id": 88370541, "body": "@nikhil I didn&#39;t downvote but I can guess 2 reasons. <b>1)</b> you posted an unformated code (always use go format before asking) <b>2)</b> the design of your code is suspect"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1528117752, "post_id": 50680127, "comment_id": 88372168, "body": "@nikhil Two more reason: 3) The title is missleading as the problem is completely unrelated to testing for whatever definition of testing and 4) Shadowing is normal in Go but shadowing a global with a named return is obvious a no go."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1528121170, "post_id": 50680127, "comment_id": 88374547, "body": "One more reason: your code doesn&#39;t even compile."}], "answers": [{"tags": [], "owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "is_accepted": true, "score": 4, "last_activity_date": 1528114070, "creation_date": 1528114070, "answer_id": 50680254, "question_id": 50680127, "link": "https://stackoverflow.com/questions/50680127/global-variable-not-accessible-to-methods-when-used-with-testing/50680254#50680254", "title": "global variable not accessible to methods when used with testing", "body": "<p>From your comments it looks like you didn't really want to shadow the global variable <code>map1</code>, you just want to return it.</p>\n\n<p>So you probably want</p>\n\n<pre><code>func f()(req *http.Request) (bool, map[string]string, error) {\n    map1[\"key\"]=\"value\"\n    return true, map1, nil\n}\n</code></pre>\n\n<p>Returning three arguments, and a global variable among them, looks strange though. There's probably something ill designed.</p>\n"}], "owner": {"reputation": 769, "user_id": 1814087, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/Oo4uE.jpg?s=128&g=1", "display_name": "nikhil", "link": "https://stackoverflow.com/users/1814087/nikhil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 50680254, "answer_count": 1, "score": -2, "last_activity_date": 1528138407, "creation_date": 1528113628, "last_edit_date": 1592644375, "question_id": 50680127, "link": "https://stackoverflow.com/questions/50680127/global-variable-not-accessible-to-methods-when-used-with-testing", "title": "global variable not accessible to methods when used with testing", "body": "<p>I am facing problem while using <code>Golang</code> Testing.Global variable not accessible to methods.\nFollowing is the code snippet</p>\n<p>test1.go</p>\n<pre><code>var map1 = make(map[string]string)\n\nfunc f()(req *http.Request) (ismime bool, map1 map[string]string, err \nerror) {\n map1[&quot;key&quot;]=&quot;value&quot;\nreturn true,map1,nil\n}\n</code></pre>\n<p>I am getting following errors</p>\n<blockquote>\n<p><code>panic: assignment to entry in nil map [recovered]</code></p>\n<p><code>panic: assignment to entry in nil map</code></p>\n</blockquote>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 382, "user_id": 9353387, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3G2gD.jpg?s=128&g=1", "display_name": "Isaa\u0441 Weisberg", "link": "https://stackoverflow.com/users/9353387/isaa%d1%81-weisberg"}, "edited": false, "score": 0, "creation_date": 1528109803, "post_id": 50678949, "comment_id": 88367338, "body": "You need to have a global reference to the server object, refer to it in one of your route handlers"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1528115607, "post_id": 50678949, "comment_id": 88370795, "body": "What are the values of <code>incoming</code>?"}, {"owner": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 0, "creation_date": 1528115725, "post_id": 50678949, "comment_id": 88370876, "body": "&quot;incomming&quot;:&quot;/a&quot;"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1528119798, "post_id": 50678949, "comment_id": 88373645, "body": "You shouldn&#39;t name a function <code>append</code> as it conflicts with the <a href=\"https://golang.org/ref/spec#Appending_and_copying_slices\" rel=\"nofollow noreferrer\">built-in function <code>append</code></a>."}, {"owner": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 0, "creation_date": 1528119917, "post_id": 50678949, "comment_id": 88373719, "body": "Don&#39;t know reason, but when i moved code of append inside for loop its working"}], "answers": [{"tags": [], "owner": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "is_accepted": true, "score": 0, "last_activity_date": 1528120006, "creation_date": 1528120006, "answer_id": 50682122, "question_id": 50678949, "link": "https://stackoverflow.com/questions/50678949/dynamically-add-routes-in-golang-http/50682122#50682122", "title": "Dynamically add routes in golang http", "body": "<pre><code>func main() {\n\n    configLoader()\n\n    dispatchMux := http.NewServeMux()\n\n    for _, site := range ServerConfigData.Sites {\n\n        //Previously code of append function\n        parsedURL, _ := url.Parse(site.Forward)\n        fmt.Println(site.Incomming)\n        dispatchMux.Handle(site.Incomming, httputil.NewSingleHostReverseProxy(parsedURL))\n\n    }    \n    // Start the server    \n    color.Green(\"Server Spinned Up on 2096\")\n    http.ListenAndServe(\":80\", dispatchMux)\n}\n</code></pre>\n"}], "owner": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 810, "favorite_count": 0, "accepted_answer_id": 50682122, "answer_count": 1, "score": 0, "last_activity_date": 1528120006, "creation_date": 1528109693, "question_id": 50678949, "link": "https://stackoverflow.com/questions/50678949/dynamically-add-routes-in-golang-http", "title": "Dynamically add routes in golang http", "body": "<p>I am trying to read routes from json and appending them to mux , but instead of appending it seems to overwrite routes. </p>\n\n<p>Code snippet</p>\n\n<pre><code> func main() {\n\n    configLoader()\n\n    dispatchMux := http.NewServeMux()\n\n    for _, site := range ServerConfigData.Sites {\n        append(dispatchMux, site.Incomming, site.Forward)\n    }\n\n    // Start the server\n\n    color.Green(\"Server Spinned Up on 2096\")\n    http.ListenAndServe(\":2096\", dispatchMux)\n}\n\n // Route Appender\n func append(mux *http.ServeMux, incomming, forward string) {\n        color.Yellow(\"Starting \", incomming, \" on \", forward, \"\\n\")\n        parsedURL, _ := url.Parse(forward)\n        mux.Handle(incomming, httputil.NewSingleHostReverseProxy(parsedURL))\n}\n</code></pre>\n"}, {"tags": ["testing", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1528107682, "post_id": 50678312, "comment_id": 88366043, "body": "Did you try <code>go test .&#47;...</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "is_accepted": false, "score": 0, "last_activity_date": 1528115244, "last_edit_date": 1592644375, "creation_date": 1528115244, "answer_id": 50680626, "question_id": 50678312, "link": "https://stackoverflow.com/questions/50678312/how-to-go-test-multiple-packages/50680626#50680626", "title": "how to go test Multiple packages", "body": "<p>You can test all packages in the current directory and all subdirectories with <code>./...</code>.</p>\n<p>From the documentation:</p>\n<blockquote>\n<p>To make common patterns more convenient, there are two special cases. First, /... at the end of the pattern can match an empty string, so that net/... matches both net and packages in its subdirectories, like net/http.</p>\n<p>Second, any slash-separated pattern element containing a wildcard never participates in a match of the &quot;vendor&quot; element in the path of a vendored package, so that ./... does not match packages in subdirectories of ./vendor or ./mycode/vendor, but ./vendor/... and ./mycode/vendor/... do.</p>\n<p>Note, however, that a directory named vendor that itself contains code is not a vendored package: cmd/vendor would be a command named vendor, and the pattern cmd/... matches it. See golang.org/s/go15vendor for more about vendoring.</p>\n</blockquote>\n"}], "owner": {"reputation": 9, "user_id": 7920302, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc44aa014d72fe47aaa5d783312cc8d2?s=128&d=identicon&r=PG&f=1", "display_name": "dean", "link": "https://stackoverflow.com/users/7920302/dean"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 705, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1528115244, "creation_date": 1528107551, "last_edit_date": 1528109265, "question_id": 50678312, "link": "https://stackoverflow.com/questions/50678312/how-to-go-test-multiple-packages", "title": "how to go test Multiple packages", "body": "<p>In my project, there are hundred packages. So where I run: </p>\n\n<pre><code>$(foreach i,$(TEST_PKGS),go test $(i) -test.short -v)\n</code></pre>\n\n<p>it will take almost a hour.\nIf I run: <code>go test $(TEST_PKGS)</code>, it will cost a large memory.\nHow to handle it this problem?</p>\n"}, {"tags": ["html", "templates", "go"], "comments": [{"owner": {"reputation": 293, "user_id": 3799061, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d6be43888ffbde83daf4bc285a84bde9?s=128&d=identicon&r=PG", "display_name": "Prasanna", "link": "https://stackoverflow.com/users/3799061/prasanna"}, "edited": false, "score": 0, "creation_date": 1528104779, "post_id": 50677366, "comment_id": 88364358, "body": "I could spot some differences using <a href=\"https://www.diffchecker.com/alBa7wdF\" rel=\"nofollow noreferrer\">https://www.diffchecker.com/alBa7wdF</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1528105428, "post_id": 50677366, "comment_id": 88364719, "body": "<code>template.ParseFiles()</code> returns an error. You omit it and you&#39;re doomed. Never omit errors! Ever! Also don&#39;t parse templates in handlers, see <a href=\"https://stackoverflow.com/questions/28451675/it-takes-too-much-time-when-using-template-package-to-generate-a-dynamic-web-p/28453523#28453523\">It takes too much time when using \u201ctemplate\u201d package to generate a dynamic web page to client in golang</a>."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9891151, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e78db6bcd6b440b02e9c4168c8c0bbe3?s=128&d=identicon&r=PG&f=1", "display_name": "Snessub", "link": "https://stackoverflow.com/users/9891151/snessub"}, "edited": false, "score": 0, "creation_date": 1528106931, "post_id": 50677573, "comment_id": 88365631, "body": "Thanks a lot! I feel dumb now :D"}], "tags": [], "owner": {"reputation": 41, "user_id": 6303663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e55d682e08e4a6b2667d36e83ddb50f2?s=128&d=identicon&r=PG&f=1", "display_name": "IvanV", "link": "https://stackoverflow.com/users/6303663/ivanv"}, "is_accepted": true, "score": 0, "last_activity_date": 1528105193, "creation_date": 1528105193, "answer_id": 50677573, "question_id": 50677366, "link": "https://stackoverflow.com/questions/50677366/why-is-my-go-code-not-working-for-every-template/50677573#50677573", "title": "Why is my go-code not working for every template?", "body": "<p>You have some syntax errors. There's an extra <code>{</code> in title and extra <code>\"</code> at the end of <code>RentedEq</code> in clients.html.</p>\n\n<p>Fixing this should fix the panic.</p>\n"}], "owner": {"reputation": 1, "user_id": 9891151, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e78db6bcd6b440b02e9c4168c8c0bbe3?s=128&d=identicon&r=PG&f=1", "display_name": "Snessub", "link": "https://stackoverflow.com/users/9891151/snessub"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 0, "accepted_answer_id": 50677573, "answer_count": 1, "score": -1, "last_activity_date": 1528105193, "creation_date": 1528104495, "question_id": 50677366, "link": "https://stackoverflow.com/questions/50677366/why-is-my-go-code-not-working-for-every-template", "title": "Why is my go-code not working for every template?", "body": "<p>I am new to go and try to set up a website with some templates. On some sites I get <code>ERR_EMPTY_RESPONSE</code> in Chrome and this error in the cmd: <br/></p>\n\n<pre><code>2018/06/04 10:55:22 http: panic serving [::1]:9954: runtime error: invalid memory address or nil pointer dereference\ngoroutine 178 [running]:\nnet/http.(*conn).serve.func1(0xc042050000)\n        C:/Go/src/net/http/server.go:1726 +0xd7\npanic(0x71dca0, 0x955b10)\n        C:/Go/src/runtime/panic.go:502 +0x237\nhtml/template.(*Template).escape(0x0, 0x0, 0x0)\n        C:/Go/src/html/template/template.go:95 +0x35\nhtml/template.(*Template).Execute(0x0, 0x7c17c0, 0xc04221a000, 0x732d60, 0xc042222200, 0xc042450590, 0x9)\n        C:/Go/src/html/template/template.go:119 +0x36\nmain.clientsHandler(0x7c42c0, 0xc04221a000, 0xc042254000)\n        C:/Users/KevinZielke/Documents/Studium/MT/WEB/Praktikum/server/server.go:114 +0x1fc\nnet/http.HandlerFunc.ServeHTTP(0x798580, 0x7c42c0, 0xc04221a000, 0xc042254000)\n        C:/Go/src/net/http/server.go:1947 +0x4b\nnet/http.(*ServeMux).ServeHTTP(0x9648c0, 0x7c42c0, 0xc04221a000, 0xc042254000)\n        C:/Go/src/net/http/server.go:2337 +0x137\nnet/http.serverHandler.ServeHTTP(0xc04204ca90, 0x7c42c0, 0xc04221a000, 0xc042254000)\n        C:/Go/src/net/http/server.go:2694 +0xc3\nnet/http.(*conn).serve(0xc042050000, 0x7c4480, 0xc042130080)\n        C:/Go/src/net/http/server.go:1830 +0x658\ncreated by net/http.(*Server).Serve\n        C:/Go/src/net/http/server.go:2795 +0x282\n</code></pre>\n\n<p>It seems something goes wrong on <code>tmpl.Execute</code>.\nThe strange thing is, that the exact same code works for some sites and for some it doesn't.</p>\n\n<p>I reduced my code on 2 site-examples. <code>Cart</code> works. <code>Clients</code> doesn't.</p>\n\n<pre><code>package main\n\nimport (\n  \"html/template\"\n  \"log\"\n  \"net/http\"\n)\n\ntype User struct{\n  Name string\n  Role string\n  Pic string\n  RentedEq string\n  Expire string\n  Status string\n  Id int\n}\ntype Eq struct{\n  Name string\n  Desc string\n  Rentdate string\n  Turnbackdate string\n  Pic string\n  Count int\n  User string\n}\n}\ntype Clients struct{\n  User User\n  Users []User\n}\ntype Cart struct{\n  User User\n  Carts []Eq\n}\n\nfunc main() {\n  fs := http.FileServer(http.Dir(\"static\"))\n  http.Handle(\"/static/\", http.StripPrefix(\"/static/\", fs))\n\n  http.HandleFunc(\"/cart/\", cartHandler)\n  http.HandleFunc(\"/clients/\", clientsHandler)\n\n  log.Println(\"Listening...\")\n  http.ListenAndServe(\":3000\", nil)\n}\nfunc clientsHandler(w http.ResponseWriter, r *http.Request) {\n  data := Clients{\n    User: User{Name : \"Dr. Acula\", Role : \"Admin\", Pic : \"../static/pics/dummy.png\",},\n    Users: []User{\n      {Name: \"Peter Pan\", RentedEq: \"Kamera 1\", Expire: \"05.06.2019\"},\n      {Name: \"Petra Pan\", RentedEq: \"Kamera 3\", Expire: \"08.10.2019\"},\n    },\n  }\n  tmpl, _ := template.ParseFiles(\"./template/clients.html\")\n  err := tmpl.Execute(w, data)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n}\nfunc cartHandler(w http.ResponseWriter, r *http.Request) {\n  data := Cart{\n    User: User{Name : \"Peter Pan\", Role : \"Benutzer\", Pic : \"../static/pics/dummy.png\",},\n    Carts: []Eq{\n      {Name: \"Kamera 1\", Desc: \"schie\u00dft Fotos\", Pic: \"../static/pics/dummy.png\", Count:1, Turnbackdate:\"12.08.2018\",},\n      {Name: \"Kamera 2\", Desc: \"schie\u00dft auch Fotos\", Pic: \"../static/pics/dummy.png\", Count:3, Turnbackdate:\"22.10.2018\",},\n    },\n  }\n  tmpl, _ := template.ParseFiles(\"./template/cart.html\")\n  err := tmpl.Execute(w, data)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n}\n</code></pre>\n\n<p>And these are the templates:\nCart:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\" dir=\"ltr\"&gt;\n\n&lt;head&gt;\n  &lt;meta charset=\"utf-8\"&gt;\n  &lt;link rel=\"stylesheet\" href=\"../static/css/bootstrap-4.1.0-dist/css/bootstrap.min.css\" /&gt;\n  &lt;link rel=\"stylesheet\" href=\"../static/css/custom.css\" /&gt;\n  &lt;title&gt;Warenkorb - borgdir.media&lt;/title&gt;\n&lt;/head&gt;\n\n&lt;body class=\"container-fluid col-10\"&gt;\n\n  &lt;header class=\"container-fluid\"&gt;\n    &lt;div class=\"row\"&gt;\n      &lt;div class=\"col-4 k\"&gt;\n        &lt;a class=\"\" href=\"/equipment\"&gt;&lt;h1&gt;borgdir.media&lt;/h1&gt;&lt;/a&gt;\n      &lt;/div&gt;\n      &lt;div class=\"col-1 k text-center\"&gt;\n        &lt;a class=\"\" href=\"/equipment\"&gt;Equpiment&lt;/a&gt;\n      &lt;/div&gt;\n      &lt;div class=\"col-1 k text-center\"&gt;\n        &lt;a href=\"/my-equipment\"&gt;Meine Ger\u00e4te&lt;/a&gt;\n      &lt;/div&gt;\n      &lt;div class=\"col-1 k text-center\"&gt;\n        &lt;a href=\"/\"&gt;Logout&lt;/a&gt;\n      &lt;/div&gt;\n      &lt;div class=\"col-1 k text-center\"&gt;\n        &lt;a href=\"/cart\"&gt;&lt;img class=\"img-fluid\" src=\"../static/icons/cart.png\" alt=\"Warenkorb\"&gt;&lt;/img&gt;&lt;/a&gt;\n      &lt;/div&gt;\n\n      &lt;div class=\"col-3 k text-right\"&gt;\n        &lt;a href=\"/profil\"&gt;{{.User.Name}}&lt;/br&gt;{{.User.Role}}&lt;/a&gt;\n      &lt;/div&gt;\n      &lt;div class=\"col-1 k\"&gt;\n        &lt;img class=\"img-fluid\" src={{.User.Pic}}&gt;&lt;/img&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/header&gt;\n\n  &lt;div&gt;\n    &lt;h2&gt;Warenkorb&lt;/h2&gt;\n\n    &lt;div class=\"container-fluid\"&gt;\n      &lt;table class=\"table\"&gt;\n        &lt;tr class=\"d-flex\"&gt;\n          &lt;th class=\"col-3\"&gt;Equipment&lt;/th&gt;\n          &lt;th class=\"col-4\"&gt;Beschreibung&lt;/th&gt;\n          &lt;th class=\"col-2 text-center\"&gt;Anzahl&lt;/th&gt;\n          &lt;th class=\"col-2 text-center\"&gt;R\u00fcckgabe bis&lt;/th&gt;\n          &lt;th class=\"col-1\"&gt;L\u00f6schen&lt;/th&gt;\n        &lt;/tr&gt;\n        {{range .Carts}}\n        &lt;tr class=\"d-flex\"&gt;\n          &lt;th class=\"col-3\"&gt;&lt;img class=\"img-fluid\" src={{.Pic}}&gt;&lt;/img&gt;{{.Name}}&lt;/th&gt;\n          &lt;th class=\"col-4\"&gt;{{.Desc}}&lt;/th&gt;\n          &lt;th class=\"col-2\"&gt;{{.Count}}&lt;/th&gt;\n          &lt;th class=\"col-2\"&gt;{{.Turnbackdate}}&lt;/th&gt;\n          &lt;th class=\"col-1\"&gt;&lt;button&gt;&lt;img class=\"img-fluid\" src=\"../icons/delete.png\"&gt;&lt;/img&gt;&lt;/button&gt;&lt;/th&gt;\n        &lt;/tr&gt;\n        {{end}}\n      &lt;/table&gt;\n      &lt;br&gt;\n      &lt;input type=\"submit\" value=\"Jetzt ausleihen\"&gt;\n    &lt;/div&gt;\n\n  &lt;/div&gt;\n&lt;/body&gt;\n&lt;/body&gt;\n\n&lt;/html&gt;\n</code></pre>\n\n<p>Clients:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\" dir=\"ltr\"&gt;\n\n&lt;head&gt;\n  &lt;meta charset=\"utf-8\"&gt;\n  &lt;link rel=\"stylesheet\" href=\"../static/css/bootstrap-4.1.0-dist/css/bootstrap.min.css\" /&gt;\n  &lt;link rel=\"stylesheet\" href=\"../static/css/custom.css\" /&gt;\n  &lt;title&gt;}Kunden verwalten - borgdir.media&lt;/title&gt;\n&lt;/head&gt;\n\n&lt;body class=\"container-fluid col-10\"&gt;\n\n  &lt;header class=\"container-fluid\"&gt;\n    &lt;div class=\"row\"&gt;\n      &lt;div class=\"col-4 k\"&gt;\n        &lt;a class=\"\" href=\"/admin-equipment\"&gt;&lt;h1&gt;borgdir.media&lt;/h1&gt;&lt;/a&gt;\n      &lt;/div&gt;\n      &lt;div class=\"col-1 k text-center\"&gt;\n        &lt;a class=\"\" href=\"/admin-equipment\"&gt;Equpiment&lt;/a&gt;\n      &lt;/div&gt;\n      &lt;div class=\"col-1 k text-center\"&gt;\n        &lt;a href=\"/clients\"&gt;Kunden&lt;/a&gt;\n      &lt;/div&gt;\n      &lt;div class=\"col-1 k text-center\"&gt;\n        &lt;a href=\"/\"&gt;Logout&lt;/a&gt;\n      &lt;/div&gt;\n\n      &lt;div class=\"col-3 k text-right\"&gt;\n        &lt;a href=\"/profil\"&gt;{{.User.Name}}&lt;/br&gt;{{.User.Role}}&lt;/a&gt;\n      &lt;/div&gt;\n      &lt;div class=\"col-1 k\"&gt;\n        &lt;img class=\"img-fluid\" src={{.User.Pic}}&gt;&lt;/img&gt;\n      &lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/header&gt;\n\n  &lt;div&gt;\n    &lt;h2&gt;Kunden&lt;/h2&gt;\n\n    &lt;div class=\"row col-12\"&gt;\n      &lt;div&gt;\n        Kategorie&lt;/br&gt;\n        &lt;input type=\"text\" name=\"suche\" value=\"Suche\"&gt;\n      &lt;/div&gt;\n      &lt;select&gt;\n         &lt;option value=\"Alle\"&gt;Alle&lt;/option&gt;\n         &lt;option value=\"keine\"&gt;keine&lt;/option&gt;\n        &lt;/select&gt;\n      &lt;input type=\"submit\" value=\"Suchen\"&gt;\n    &lt;/div&gt;\n\n    &lt;div class=\"container-fluid\"&gt;\n      &lt;table class=\"table\"&gt;\n        &lt;tr class=\"d-flex\"&gt;\n          &lt;th class=\"col-4\"&gt;Equipment&lt;/th&gt;\n          &lt;th class=\"col-5\"&gt;Ausgeliehenes Equipment&lt;/th&gt;\n          &lt;th class=\"col-3\"&gt;Status&lt;/th&gt;\n        &lt;/tr&gt;\n        {{range .Users}}\n        &lt;tr class=\"d-flex\"&gt;\n          &lt;th class=\"col-4\"&gt;{{.Name}}&lt;/th&gt;\n          &lt;th class=\"col-5\"&gt;{{.RentedEq\"}}&lt;/th&gt;\n          &lt;th class=\"col-2\"&gt;Konto aktiv bis:&lt;/br&gt;{{.Expire}}&lt;/th&gt;\n          &lt;th class=\"col-1\"&gt;&lt;button&gt;&lt;img class=\"img-fluid\" src=\"../static/icons/edit.png\"&gt;&lt;/img&gt;&lt;/button&gt;&lt;/th&gt;\n        &lt;/tr&gt;\n        {{end}}\n      &lt;/table&gt;\n    &lt;/div&gt;\n\n  &lt;/div&gt;\n&lt;/body&gt;\n&lt;/body&gt;\n\n&lt;/html&gt;\n</code></pre>\n\n<p>I checked it all a lot. I just don't see the difference.</p>\n"}, {"tags": ["http", "go"], "answers": [{"tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": true, "score": 9, "last_activity_date": 1528104670, "last_edit_date": 1528104670, "creation_date": 1528104295, "answer_id": 50677304, "question_id": 50676817, "link": "https://stackoverflow.com/questions/50676817/does-the-http-request-automatically-retry/50677304#50677304", "title": "Does the http request automatically retry?", "body": "<p>No, you will need to implement your own retry method, this is a basic example that could give you an idea:</p>\n\n<p><a href=\"https://play.golang.org/p/_o5AgePDEXq\" rel=\"noreferrer\">https://play.golang.org/p/_o5AgePDEXq</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    var (\n        err      error\n        response *http.Response\n        retries  int = 3\n    )\n    for retries &gt; 0 {\n        response, err = http.Get(\"https://non-existent\")\n        // response, err = http.Get(\"https://google.com/robots.txt\")\n        if err != nil {\n            log.Println(err)\n            retries -= 1\n        } else {\n            break\n        }\n    }\n    if response != nil {\n        defer response.Body.Close()\n        data, err := ioutil.ReadAll(response.Body)\n        if err != nil {\n            log.Fatal(err)\n        }\n        fmt.Printf(\"data = %s\\n\", data)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 563, "user_id": 6298537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QrLr3.jpg?s=128&g=1", "display_name": "yashjain12yj", "link": "https://stackoverflow.com/users/6298537/yashjain12yj"}, "edited": false, "score": 0, "creation_date": 1602660734, "post_id": 61725999, "comment_id": 113787478, "body": "What if I want to give some timeout to a request, like we do in Default http.Client tr := &amp;http.Transport{ IdleConnTimeout: 30 * time.Second, } client := &amp;http.Client{Transport: tr} Here we can give IdleConnTimeout, can we do the same with go-retryablehttp?"}, {"owner": {"reputation": 751, "user_id": 7418388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/caa8d6f3cc0df001ff2f66aeed93fc85?s=128&d=identicon&r=PG&f=1", "display_name": "nishith", "link": "https://stackoverflow.com/users/7418388/nishith"}, "reply_to_user": {"reputation": 563, "user_id": 6298537, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QrLr3.jpg?s=128&g=1", "display_name": "yashjain12yj", "link": "https://stackoverflow.com/users/6298537/yashjain12yj"}, "edited": false, "score": 0, "creation_date": 1603081116, "post_id": 61725999, "comment_id": 113912649, "body": "@yashjain12yj: You can set Timeout on Client.HTTPClient.Timeout  Can checkout <a href=\"https://godoc.org/github.com/hashicorp/go-retryablehttp#Client\" rel=\"nofollow noreferrer\">godoc.org/github.com/hashicorp/go-retryablehttp#Client</a> formore reference"}], "tags": [], "owner": {"reputation": 751, "user_id": 7418388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/caa8d6f3cc0df001ff2f66aeed93fc85?s=128&d=identicon&r=PG&f=1", "display_name": "nishith", "link": "https://stackoverflow.com/users/7418388/nishith"}, "is_accepted": false, "score": 5, "last_activity_date": 1589187948, "creation_date": 1589187948, "answer_id": 61725999, "question_id": 50676817, "link": "https://stackoverflow.com/questions/50676817/does-the-http-request-automatically-retry/61725999#61725999", "title": "Does the http request automatically retry?", "body": "<p>You can use more cleaner implementation of retrying by using retryablehttp\n<a href=\"https://github.com/hashicorp/go-retryablehttp\" rel=\"noreferrer\">https://github.com/hashicorp/go-retryablehttp</a> which handles most of the conditions\n<br>This is provides customisation for retry policy, backoffs etc.</p>\n"}], "owner": {"reputation": 71, "user_id": 2433953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/57c850fb19acb28a42b7147e938bdca3?s=128&d=identicon&r=PG", "display_name": "user2433953", "link": "https://stackoverflow.com/users/2433953/user2433953"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7738, "favorite_count": 2, "accepted_answer_id": 50677304, "answer_count": 2, "score": 5, "last_activity_date": 1589187948, "creation_date": 1528102644, "last_edit_date": 1528103591, "question_id": 50676817, "link": "https://stackoverflow.com/questions/50676817/does-the-http-request-automatically-retry", "title": "Does the http request automatically retry?", "body": "<p>I am trying to push my data to apache server using GoLang. Suppose my apache server is temporarily stopped. Then will my http request retry automatically.\nI am using this statement</p>\n\n<pre><code>resp, err := http.DefaultClient.Do(req)\n    if err != nil {\n        return errors.Wrap(err, \"http request error\")\n    }\n</code></pre>\n\n<p>I am unable to proceed further coz what is think is my execution is stuck here. And I am repeatedly getting this error.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1528100648, "post_id": 50676035, "comment_id": 88362019, "body": "Don&#39;t do that. JSON is the wire format. You work and manipulate Go variables of  type Message and you double the field and serialize once you have the value you want to serialize. Never think if JSON as a &quot;data format&quot;."}, {"owner": {"reputation": 3271, "user_id": 7607701, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-0eLxeTB_SdQ/AAAAAAAAAAI/AAAAAAAAABg/XZT1oaa0wqA/photo.jpg?sz=128", "display_name": "Aaron N. Brock", "link": "https://stackoverflow.com/users/7607701/aaron-n-brock"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528130614, "post_id": 50676035, "comment_id": 88380088, "body": "@Volker In my use case it&#39;s not that json is being used as a &quot;data format&quot; it&#39;s that the rest API has to serve up the &quot;display&quot; of a number rather then how it&#39;s stored internally."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1528100585, "last_edit_date": 1528100585, "creation_date": 1528100284, "answer_id": 50676129, "question_id": 50676035, "link": "https://stackoverflow.com/questions/50676035/perform-operation-on-field-when-marshalled-struct-to-json/50676129#50676129", "title": "Perform Operation on field when Marshalled struct to json", "body": "<p>Implement <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"nofollow noreferrer\"><code>json.Marshaler</code></a> on your struct, which is to define a custom marshaling logic, which may double the <code>DoubleMe</code> field.</p>\n\n<p>See this example:</p>\n\n<pre><code>type Message struct {\n    DoubleMe int    `json:\"double_me\"`\n    Message  string `json:\"message\"`\n}\n\nfunc (m Message) MarshalJSON() ([]byte, error) {\n    m.DoubleMe *= 2\n\n    type Message2 Message\n    return json.Marshal(Message2(m))\n}\n\nfunc main() {\n    m := Message{5, \"Hello, World!\"}\n    data, err := json.Marshal(m)\n    fmt.Println(string(data), err)\n    fmt.Println(\"Original:\", m)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/_4MwoZBE1DW\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{\"double_me\":10,\"message\":\"Hello, World!\"} &lt;nil&gt;\nOriginal: {5 Hello, World!}\n</code></pre>\n\n<p>Some notes:</p>\n\n<ul>\n<li><p>If you need this to work backwards too (e.g. when unmarshaling, divide the value by 2), also implement <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\"><code>json.Unmarshaler</code></a> (left to the reader as an exercise).</p></li>\n<li><p>Even though we doubled the field, after the marshaling, the original value did not change. This is because the method has a non-pointer receiver, so inside the method only a copy is acquired and modified, but not the original value. If we would've used pointer receiver, we would have to take care of restoring it.</p></li>\n<li><p>Also note that a new type <code>Message2</code> is created and used inside the <code>MarshalJSON()</code> method. This is because we also used the <code>json</code> package to do the \"usual\" marshaling once we applied our custom logic. But if we would pass <code>m</code> to <code>json.Marshal()</code>, that would be an endless \"recursion\", because the <code>json</code> package would again call this <code>MarshalJSON()</code> method. Instead we created a <code>Message2</code> type having <code>Message</code> as its underlying type. This means <code>Message2</code> has zero methods (it does not implement <code>json.Marshaler</code>), so passing a value of <code>Message2</code> to <code>json.Marshal()</code> will not call this method again, and since it has <code>Message</code> as its underlying type, we can simply convert a value of type <code>Message</code> to <code>Message2</code>.</p></li>\n</ul>\n"}], "owner": {"reputation": 3271, "user_id": 7607701, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-0eLxeTB_SdQ/AAAAAAAAAAI/AAAAAAAAABg/XZT1oaa0wqA/photo.jpg?sz=128", "display_name": "Aaron N. Brock", "link": "https://stackoverflow.com/users/7607701/aaron-n-brock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "accepted_answer_id": 50676129, "answer_count": 1, "score": 0, "last_activity_date": 1528100585, "creation_date": 1528099892, "question_id": 50676035, "link": "https://stackoverflow.com/questions/50676035/perform-operation-on-field-when-marshalled-struct-to-json", "title": "Perform Operation on field when Marshalled struct to json", "body": "<p>I have the following struct:</p>\n\n<pre><code>type Message struct {\n    DoubleMe    int     `json:\"double_me\"`\n    Message     string  `json:\"message\"`\n}\n</code></pre>\n\n<p>And a instance of it:</p>\n\n<pre><code>m := Message{5, \"Hello, World!\"}\n</code></pre>\n\n<p>My goal is to perform some operation to the <code>DoubleMe</code> field when it's marshaled to json, for example doubling it.  So the output would be:</p>\n\n<pre><code>{\"double_me\":10,\"message\":\"Hello, World!\"}\n</code></pre>\n\n<p>How can I achieve this?</p>\n"}, {"tags": ["debugging", "go", "gdb", "lldb"], "answers": [{"tags": [], "owner": {"reputation": 26934, "user_id": 8316315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44d833a8a46fea39d7bfca1540ea9c07?s=128&d=identicon&r=PG&f=1", "display_name": "Florian Weimer", "link": "https://stackoverflow.com/users/8316315/florian-weimer"}, "is_accepted": true, "score": 1, "last_activity_date": 1530341259, "creation_date": 1530341259, "answer_id": 51112477, "question_id": 50676025, "link": "https://stackoverflow.com/questions/50676025/how-gdb-print-address-of-a-var-in-go-program/51112477#51112477", "title": "How gdb print address of a var in go program?", "body": "<p>You can either disable the Python pretty-printers for Go, then you will get this:</p>\n\n<pre><code>(gdb) print key\n$1 = {array = 0xc42003de10 \"abc\", len = 3, cap = 32}\n</code></pre>\n\n<p>Or you can temporarily switch to the C language, like this:</p>\n\n<pre><code>(gdb) set language c\nWarning: the current language does not match this frame.\n(gdb) print key\n$1 =  []uint8 = {97 'a', 98 'b', 99 'c'}\n(gdb) print (char *)key\n$2 = 0xc420043e10 \"abc\"\n(gdb) \n</code></pre>\n\n<p>This assumes that Go arrays are interpreted by GDB in a certain way in C mode, but it seems to be to work in this case.</p>\n"}], "owner": {"reputation": 860, "user_id": 976371, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/948a98554e5882037f0feac8a21bef56?s=128&d=identicon&r=PG", "display_name": "jiamo", "link": "https://stackoverflow.com/users/976371/jiamo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 157, "favorite_count": 1, "accepted_answer_id": 51112477, "answer_count": 1, "score": 0, "last_activity_date": 1530341259, "creation_date": 1528099830, "last_edit_date": 1528100457, "question_id": 50676025, "link": "https://stackoverflow.com/questions/50676025/how-gdb-print-address-of-a-var-in-go-program", "title": "How gdb print address of a var in go program?", "body": "<p>I success install gdb 8.0.1 and make it run in mac os x. When debug this program I don't see the address of <code>key</code>.</p>\n\n<pre><code>package main\n\nfunc main(){\n    m := map[string]int{\n        \"abc\":123,\n    }\n\n    key := []byte(\"abc\")\n    x, ok := m[string(key)]\n    println(x, ok)\n}\n</code></pre>\n\n<p>Here is what I have done with gdb:</p>\n\n<pre><code>go build -gcflags \"-N\" test_append.go\ngdb test_append\n(gdb) b 9\nBreakpoint 1 at 0x104d4b4: file /Users/jiamo/go/src/test/test_append.go, line 9.\n(gdb) c\nThe program is not being run.\n(gdb) run\nStarting program: /Users/jiamo/go/src/test/test_append\nThread 3 hit Breakpoint 1, main.main () at /Users/jiamo/go/src/test/test_append.go:9\n9       x, ok := m[string(key)]\n(gdb) info locals\nkey =  []uint8 = {97 'a', 98 'b', 99 'c'}\nm = map[string]int = {[\"abc\"] = 123}\nok = false\nx = 17195648\n(gdb) p key\n$1 =  []uint8 * = {97 'a', 98 'b', 99 'c'}\n(gdb) p &amp;key\n$2 =  []uint8 * = {97 'a', 98 'b', 99 'c'}\n</code></pre>\n\n<p>I give a look at lldb. (lldb need b on <code>main.main</code> then b on line)</p>\n\n<pre><code>(lldb) b main.main\nBreakpoint 1: where = test_append`main.main + 50 at test_append.go:4, address = 0x000000000104d372\n(lldb) run\n(lldb) b 9\n(lldb) c\n(lldb) fr v\n    ([]uint8) key = (len 3, cap 32) {\n    [0] = 97\n    [1] = 98\n    [2] = 99\n    }\n    # no address too\n\n(lldb) p key\n([]uint8) key = (len 3, cap 32) {\n[0] = 97\n[1] = 98\n[2] = 99\n}\n(lldb) p &amp;key\n(*[]uint8)  = 0x000000c420055e10 (len 0, cap 0)   \n# now it can show the address, \n# And I am not sure why it becomes (len 0, cap 0) \n</code></pre>\n\n<p>And my question is how can show the address of <code>key</code> in gdb?</p>\n"}, {"tags": ["go", "methods", "interface", "type-assertion"], "comments": [{"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 1, "creation_date": 1528091721, "post_id": 50674117, "comment_id": 88357843, "body": "If the methods haven&#39;t been exported then <b>they don&#39;t exist</b> outside the package."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 2, "creation_date": 1528091775, "post_id": 50674117, "comment_id": 88357861, "body": "Instead of all this waste of time casting interfaces, create an interface that&#39;s actually useful for what you want to do, and just call the interface. That&#39;s what they&#39;re <b>for</b>."}, {"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1528091796, "post_id": 50674117, "comment_id": 88357870, "body": "The methods are exported with first letter as uppercase: Foo(), Bar."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 1, "creation_date": 1528091844, "post_id": 50674117, "comment_id": 88357897, "body": "Sorry. Unexported structs don&#39;t exist either."}, {"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1528091986, "post_id": 50674117, "comment_id": 88357956, "body": "Should I use embedded interface as in <code>type J interface { I; Bar() string }</code> and use that in <code>main</code> then?"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 1, "creation_date": 1528092952, "post_id": 50674117, "comment_id": 88358322, "body": "Or add it to I. Yeah that should work."}], "answers": [{"comments": [{"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1528099746, "post_id": 50675154, "comment_id": 88361542, "body": "Thanks for confirming this!"}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 2, "last_activity_date": 1528096532, "creation_date": 1528096532, "answer_id": 50675154, "question_id": 50674117, "link": "https://stackoverflow.com/questions/50674117/is-type-assertion-the-only-way-to-get-back-at-the-struct-pointer-when-dealing-wi/50675154#50675154", "title": "Is Type Assertion the only way to get back at the struct pointer when dealing with interfaces?", "body": "<p>Yes. Type Assertion the only way to get back at the struct pointer when dealing with interfaces.</p>\n"}, {"comments": [{"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 1, "creation_date": 1528099993, "post_id": 50675615, "comment_id": 88361677, "body": "The type assertion with an anonymous interface is pretty slick. I didn&#39;t know you could do that."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1528099940, "last_edit_date": 1528099940, "creation_date": 1528098163, "answer_id": 50675615, "question_id": 50674117, "link": "https://stackoverflow.com/questions/50674117/is-type-assertion-the-only-way-to-get-back-at-the-struct-pointer-when-dealing-wi/50675615#50675615", "title": "Is Type Assertion the only way to get back at the struct pointer when dealing with interfaces?", "body": "<p>Yes, in the general case you need <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> (or a <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"nofollow noreferrer\">type switch</a>) to get back the wrapped value in an interface value.</p>\n\n<p>But you do not need to get back the stored, concrete value from an interface to be able to call other methods it has (and which are not part of the interface type).</p>\n\n<p>You may type-assert another interface value from an interface value, another interface value whose type contains the methods you do want to call.</p>\n\n<p>See this example:</p>\n\n<pre><code>type Foo interface {\n    Bar() string\n}\n\ntype fooImpl struct{}\n\nfunc (fooImpl) Bar() string { return \"Bar from fooImpl\" }\n\nfunc (fooImpl) Baz() string { return \"Baz from fooImpl\" }\n\nfunc main() {\n    var f Foo = &amp;fooImpl{}\n\n    if x, ok := f.(interface{ Baz() string }); ok {\n        fmt.Println(x.Baz())\n    } else {\n        fmt.Println(\"f does not have a Baz() method!\")\n    }\n}\n</code></pre>\n\n<p><code>Foo</code> only has a <code>Bar()</code> method. We have a variable <code>f</code> of type <code>Foo</code>, the concrete type it stores is <code>*fooImpl</code>, which also has another method: <code>fooImpl.Baz()</code>.</p>\n\n<p>So we can type-assert a value of type <code>interface{ Baz() string }</code> from it, and simply call <code>Baz()</code> on the result.</p>\n\n<p>The output of the above is (try it on the <a href=\"https://play.golang.org/p/vsMcvWriMn1\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Baz from fooImpl\n</code></pre>\n\n<p>Type-asserting an interface from another interface value does not require to export the type of the wrapped value.</p>\n\n<p>You may also create a new type for the interface type you type assert, anonymous type is not a requirement:</p>\n\n<pre><code>type MyFoo interface{ Baz() string }\n\nif x, ok := f.(MyFoo); ok {\n    fmt.Println(x.Baz())\n} else {\n    fmt.Println(\"f does not have a Baz() method!\")\n}\n</code></pre>\n\n<p>Output is the same (try it on the <a href=\"https://play.golang.org/p/i-XpldOlWsu\" rel=\"nofollow noreferrer\">Go Playground</a>).</p>\n\n<p>Hell, you can even \"extend\" <code>Foo</code> with the additional methods, and type-assert an \"extended\" interface:</p>\n\n<pre><code>type MyFoo interface {\n    Foo\n    Baz() string\n}\n\nif x, ok := f.(MyFoo); ok {\n    fmt.Println(x.Bar())\n    fmt.Println(x.Baz())\n} else {\n    fmt.Println(\"f does not have a Baz() method!\")\n}\n</code></pre>\n\n<p>Now in this example <code>x</code> is both a <code>Foo</code> and a value that has a <code>Baz()</code> method. Output (try it on the <a href=\"https://play.golang.org/p/7_bIYKRRfU2\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Bar from fooImpl\nBaz from fooImpl\n</code></pre>\n"}], "owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1094, "favorite_count": 0, "accepted_answer_id": 50675615, "answer_count": 2, "score": 0, "last_activity_date": 1528099940, "creation_date": 1528091506, "last_edit_date": 1528098612, "question_id": 50674117, "link": "https://stackoverflow.com/questions/50674117/is-type-assertion-the-only-way-to-get-back-at-the-struct-pointer-when-dealing-wi", "title": "Is Type Assertion the only way to get back at the struct pointer when dealing with interfaces?", "body": "<p>Consider the following code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n// 5\ntype I interface {\n    Foo() string\n}\n\ntype a struct {\n    i int\n}\n\nfunc (s a) Foo() string {\n    return \"We are here!\"\n}\n\nfunc (s a) Bar() string {\n    return \"Major Tom!\"\n}\n// 20\nfunc main() {\n    var x I = &amp;a{i: 42}\n    fmt.Println(x.Foo())\n    fmt.Println(x.(*a).Bar())\n}\n</code></pre>\n\n<p>The last statement of main gives me back the underlying struct but i need to export this struct to get back at it. </p>\n\n<p>If I am using a package in a library where the only symbol exported is the interface (big I, little a in our example above between lines 5-20), then I am unable to cast the interface to the original type when I am in another package or file. </p>\n\n<p>Because the original struct is stored in the interface, is there a simple way to get back its reference and use methods that haven't been declared in the interface and only attached to the struct.</p>\n"}, {"tags": ["go", "cassandra", "protocol-buffers"], "answers": [{"comments": [{"owner": {"reputation": 485, "user_id": 2735056, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000287825225/picture?type=large", "display_name": "Nhan Nguyen", "link": "https://stackoverflow.com/users/2735056/nhan-nguyen"}, "edited": false, "score": 0, "creation_date": 1528091362, "post_id": 50673679, "comment_id": 88357710, "body": "<code>ptypes.Timestamp()</code> return a <code>time.Time</code> while <code>google.protobuf.Timestamp</code> generated <code>*timestamp.Timestamp</code> as field&#39;s data type, and the field created_at in my cassandra is in type timestamp. Could you provide more details about data type in proto file?"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "reply_to_user": {"reputation": 485, "user_id": 2735056, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000287825225/picture?type=large", "display_name": "Nhan Nguyen", "link": "https://stackoverflow.com/users/2735056/nhan-nguyen"}, "edited": false, "score": 0, "creation_date": 1528118453, "post_id": 50673679, "comment_id": 88372672, "body": "Edited for clarity - hopefully."}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 3, "last_activity_date": 1528120096, "last_edit_date": 1528120096, "creation_date": 1528088635, "answer_id": 50673679, "question_id": 50673531, "link": "https://stackoverflow.com/questions/50673531/how-to-work-with-google-protobuf-timestamp-and-cassandra/50673679#50673679", "title": "How to work with google.protobuf.timestamp and cassandra", "body": "<p>I just ran into the same thing last week. You need to use <a href=\"https://github.com/golang/protobuf/blob/master/ptypes/timestamp.go#L79\" rel=\"nofollow noreferrer\">ptypes</a></p>\n\n<pre><code>ts, err := ptypes.Timestamp(result.GetDateDone())\nif err != nil {\n    ts = time.Now().UTC()\n}\nerr = trr.cassandra.Execute(query,\n    result.TaskID,\n    result.TaskName,\n    result.Status,\n    result.Result,\n    ts,\n    result.Traceback,\n    result.Children,\n)\n</code></pre>\n\n<p>Here result is a proto message defined by:</p>\n\n<pre><code>message TaskResult {\n    string TaskID = 1;\n    string TaskName = 2;\n    string Status = 3;\n    bytes Result = 4;\n    google.protobuf.Timestamp DateDone = 5;\n    bytes Traceback = 6;\n    bytes Children = 7;\n}\n</code></pre>\n\n<p>And the column family has a field</p>\n\n<pre><code>date_done timestamp,\n</code></pre>\n"}], "owner": {"reputation": 485, "user_id": 2735056, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000287825225/picture?type=large", "display_name": "Nhan Nguyen", "link": "https://stackoverflow.com/users/2735056/nhan-nguyen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2216, "favorite_count": 1, "accepted_answer_id": 50673679, "answer_count": 1, "score": 2, "last_activity_date": 1528120096, "creation_date": 1528087584, "question_id": 50673531, "link": "https://stackoverflow.com/questions/50673531/how-to-work-with-google-protobuf-timestamp-and-cassandra", "title": "How to work with google.protobuf.timestamp and cassandra", "body": "<p>I'm using \"google/protobuf/timestamp.proto\" to define timestamp type in golang struct:</p>\n\n<pre><code>import \"google/protobuf/timestamp.proto\";    \nmessage User {\n    string id = 1; \n    ...\n    google.protobuf.Timestamp created_at = 12;\n    google.protobuf.Timestamp updated_at = 13;\n    google.protobuf.Timestamp last_login = 14;\n}\n</code></pre>\n\n<p>and when insert to cassandra using cqlx:</p>\n\n<pre><code>req.CreatedAt = ptypes.TimestampNow()\n// I also try with:\n// req.CreatedAt = &amp;timestamp.Timestamp{Seconds: time.Now().Unix(), Nanos: int32(time.Now().Nanosecond())}\n</code></pre>\n\n<p>I always get this error message: can not marshal timestamp.Timestamp into timestamp. Anyone have work with this please help</p>\n"}, {"tags": ["multithreading", "go", "parallel-processing", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 4, "last_activity_date": 1528081439, "creation_date": 1528081439, "answer_id": 50672956, "question_id": 50672891, "link": "https://stackoverflow.com/questions/50672891/how-can-i-stop-the-goroutine-in-the-new-object/50672956#50672956", "title": "How can I stop the goroutine in the New Object?", "body": "<p>Add a \"done\" channel. The goroutine checks the channel on each iteration and exits when the channel is closed.  The main goroutine closes the channel when done.</p>\n\n<pre><code>type obj struct {\n    done chan struct{}  // done is closed when goroutine should exit\n}\n\nfunc getObj() *obj {\n    b := &amp;obj{done: make(chan struct{})}\n    go func() {\n        i := 0\n        for {\n            select {\n            case &lt;-b.done:\n                // Channel was closed, exit the goroutine\n                return\n            default:\n                // Channel not closed, keep going\n            }\n            fmt.Println(i)\n            time.Sleep(time.Second)\n            i++\n        }\n    }()\n    return b\n}\n\nfunc main() {\n    b := getObj()\n    fmt.Println(b)\n    time.Sleep(time.Duration(3) * time.Second)\n    close(b.done) // Signal goroutine to exit\n    fmt.Println(\"before\")\n    time.Sleep(time.Duration(10) * time.Second)\n    fmt.Println(\"after\")\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/rNfBiwzwQK6\" rel=\"nofollow noreferrer\">Playground example</a></p>\n"}], "owner": {"reputation": 47, "user_id": 7045336, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-klm0eqBcyhQ/AAAAAAAAAAI/AAAAAAAAABM/8s6JB6E-2qU/photo.jpg?sz=128", "display_name": "Yafei Chang", "link": "https://stackoverflow.com/users/7045336/yafei-chang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1528081439, "creation_date": 1528080774, "question_id": 50672891, "link": "https://stackoverflow.com/questions/50672891/how-can-i-stop-the-goroutine-in-the-new-object", "title": "How can I stop the goroutine in the New Object?", "body": "<p>The code is as follows:</p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n    \"runtime\"\n    \"runtime/debug\"\n)\n\ntype obj struct {\n}\n\nfunc getObj() *obj{\n    b := new(obj)\n    go func() {\n        i := 0\n        for {\n            println(i)\n            time.Sleep(time.Second)\n            i++\n        }\n    }()\n    return b\n}\n\n\nfunc main() {\n    b := getObj()\n    println(b)\n    time.Sleep(time.Duration(3)*time.Second)\n    b = nil\n    runtime.GC()\n    debug.FreeOSMemory()\n    println(\"before\")\n    time.Sleep(time.Duration(10)*time.Second)\n    println(\"after\")\n}\n</code></pre>\n\n<p>I create an obj, after using it, I want to close the goroutine in the obj, and delete the obj to free the memory.\nI tried the <code>runtime.GC()</code> and <code>debug.FreeOSMemory()</code>, but it doesn't work.</p>\n"}, {"tags": ["json", "go", "struct", "unmarshalling"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1528079810, "post_id": 50672766, "comment_id": 88355322, "body": "Explain more about why  custom unmarshal is a problem. The best solution is to declare a type for Labels and write a custom <a href=\"https://godoc.org/encoding/json#Unmarshaler.UnmarshalJSON\" rel=\"nofollow noreferrer\">unmarshal method</a> for that type."}, {"owner": {"reputation": 327, "user_id": 6184739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca7f834e25f1fdebf197777e453af355?s=128&d=identicon&r=PG&f=1", "display_name": "harpratap", "link": "https://stackoverflow.com/users/6184739/harpratap"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528088930, "post_id": 50672766, "comment_id": 88357016, "body": "@ThunderCat The labels array will be a dynamic one which could change over time, it&#39;s like a generic KV pair. If today I write a custom decoder for &quot;owner&quot; key, it may not exist later, or may have many additional keys like &quot;class&quot; or &quot;domain&quot;."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528116599, "post_id": 50672766, "comment_id": 88371391, "body": "The unmarshal function will transform key value pairs from the JSON to a Go map.  In doing so, the unmarshal function does not need to know what the keys are."}], "answers": [{"comments": [{"owner": {"reputation": 327, "user_id": 6184739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca7f834e25f1fdebf197777e453af355?s=128&d=identicon&r=PG&f=1", "display_name": "harpratap", "link": "https://stackoverflow.com/users/6184739/harpratap"}, "edited": false, "score": 0, "creation_date": 1528089068, "post_id": 50673027, "comment_id": 88357054, "body": "Label field is a generic one, I&#39;m not sure of the fact that l[0] will always be owner. It is possible for l[1] to be owner and l[0] to be group. Or maybe neither of these two."}], "tags": [], "owner": {"reputation": 1, "user_id": 8693167, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-41thwf27XBU/AAAAAAAAAAI/AAAAAAAAAKk/Em9TGlsq6DU/photo.jpg?sz=128", "display_name": "ryutah", "link": "https://stackoverflow.com/users/8693167/ryutah"}, "is_accepted": false, "score": 0, "last_activity_date": 1528082292, "creation_date": 1528082292, "answer_id": 50673027, "question_id": 50672766, "link": "https://stackoverflow.com/questions/50672766/unmarshalling-json-arrays-as-json-objects/50673027#50673027", "title": "Unmarshalling json arrays as json objects", "body": "<p>How about to define custom <code>[]Label</code> type and add function on it.</p>\n\n<p>For instance</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>type Labels []Label\n\nfunc (l Labels) Owner() string {\n    if len(l) &gt; 1 {\n        return l[0].Value\n    }\n    return \"\"\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 327, "user_id": 6184739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca7f834e25f1fdebf197777e453af355?s=128&d=identicon&r=PG&f=1", "display_name": "harpratap", "link": "https://stackoverflow.com/users/6184739/harpratap"}, "edited": false, "score": 0, "creation_date": 1528092349, "post_id": 50674049, "comment_id": 88358094, "body": "Thank you so much! Still trying to wrap my brain around the logic behind  the Unmarshal function. What exactly does byte contain here? Is it the labels array or just one json object of that array? What&#39;s inside a? Edit: Nevermind, printing inside the unmarshal function explained everything. Thanks again."}], "tags": [], "owner": {"reputation": 27119, "user_id": 8753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NLxHO.jpg?s=128&g=1", "display_name": "laz", "link": "https://stackoverflow.com/users/8753/laz"}, "is_accepted": true, "score": 1, "last_activity_date": 1528091769, "last_edit_date": 1528091769, "creation_date": 1528091188, "answer_id": 50674049, "question_id": 50672766, "link": "https://stackoverflow.com/questions/50672766/unmarshalling-json-arrays-as-json-objects/50674049#50674049", "title": "Unmarshalling json arrays as json objects", "body": "<p>With the constraints you have here, this is about as close as you will get (<a href=\"https://play.golang.org/p/CDIg8s4ZkVj\" rel=\"nofollow noreferrer\">run in playground</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    j := `\n        {\n            \"id\": \"42\",\n            \"name\": \"Marvin\",\n            \"labels\": [\n                {\n                    \"key\": \"owner\",\n                    \"value\": \"harry\"\n                },\n                {\n                    \"key\": \"group\",\n                    \"value\": \"student\"\n                }\n            ]\n        }`\n\n    d := StudentDetails{}\n    err := json.Unmarshal([]byte(j), &amp;d)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(d.Labels[\"owner\"])\n    fmt.Println(d.Labels[\"group\"])\n}\n\ntype StudentDetails struct {\n    Id     string `json:\"id\"`\n    Name   string `json:\"name\"`\n    Labels Labels `json:\"labels\"`\n}\n\ntype Labels map[string]string\n\nfunc (l *Labels) UnmarshalJSON(b []byte) error {\n    a := []map[string]string{}\n    err := json.Unmarshal(b, &amp;a)\n    if err != nil {\n        return err\n    }\n\n    t := map[string]string{}\n    for _, m := range a {\n        t[m[\"key\"]] = m[\"value\"]\n    }\n    *l = t\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 327, "user_id": 6184739, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca7f834e25f1fdebf197777e453af355?s=128&d=identicon&r=PG&f=1", "display_name": "harpratap", "link": "https://stackoverflow.com/users/6184739/harpratap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 50674049, "answer_count": 2, "score": -1, "last_activity_date": 1528091769, "creation_date": 1528079533, "question_id": 50672766, "link": "https://stackoverflow.com/questions/50672766/unmarshalling-json-arrays-as-json-objects", "title": "Unmarshalling json arrays as json objects", "body": "<p>I have to unmarshal a series of Json objects, but one of the objects contain a json array which is not really structured in a good way.</p>\n\n<pre><code>\"labels\": [\n    {\n      \"key\": \"owner\",\n      \"value\": \"harry\"\n    },\n    {\n      \"key\": \"group\",\n      \"value\": \"student\"\n    }\n  ]\n</code></pre>\n\n<p>I am unmarshalling it using this struct -</p>\n\n<pre><code>type StudentDetails struct {\nId        string         `json:\"id\"`\nName      string         `json:\"name\"`\nLabels    []Label   `json:\"labels,omitempty\"`\n}\ntype Label struct {\nKey string `json:\"key\"`\nValue string `json:\"value\"`\n}\n</code></pre>\n\n<p>And I have to access it using x.Labels[0].key == \"owner\" inside a for loop which is very annoying. \nI want to be able to do x.Labels.Owner == \"harry\" instead. How do I go about achieving this? The rest of JSON is unmarshalled fine using the default unmarshal function, so I don't think writing custom function will be good option. </p>\n"}, {"tags": ["string", "http", "go"], "answers": [{"tags": [], "owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "is_accepted": true, "score": 3, "last_activity_date": 1528088293, "creation_date": 1528088293, "answer_id": 50673631, "question_id": 50672525, "link": "https://stackoverflow.com/questions/50672525/garbled-string-while-do-http-request-in-go/50673631#50673631", "title": "Garbled string while do http request in Go", "body": "<p>Go strings can hold any type of characters, but when printing them the chars are interpreted as utf-8.</p>\n\n<p>You can try adding:</p>\n\n<pre><code>req.Header.Add(\"Accept-Charset\",\"utf-8\")\n</code></pre>\n\n<p>If that does not work, you can try using this package to convert from whatever charset it is to utf-8:</p>\n\n<p><a href=\"https://godoc.org/golang.org/x/text/encoding\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/text/encoding</a></p>\n\n<p>The charset depends on the page you are requesting.  If it is html, the charset is sometimes specified like this in the response headers:</p>\n\n<pre><code>Content-Type: text/html; charset=utf-8\n</code></pre>\n\n<p>So you need to figure out what the charset is.</p>\n"}, {"comments": [{"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1592497643, "post_id": 53365557, "comment_id": 110453706, "body": "I can&#39;t find &quot;Reopen With Encoding&quot; option on visual studio, could you tell where it is?"}, {"owner": {"reputation": 867, "user_id": 6531129, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3741d495ced91c057769a904b8ee6c26?s=128&d=identicon&r=PG&f=1", "display_name": "AESTHETICS", "link": "https://stackoverflow.com/users/6531129/aesthetics"}, "reply_to_user": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "edited": false, "score": 0, "creation_date": 1592735239, "post_id": 53365557, "comment_id": 110525506, "body": "On bottom right there is label showing current encoding. After clicking of the label (for example &quot;UTF-8&quot;) on top appears option &quot;Reopen with Encoding&quot; if file has been already saved. <a href=\"https://imgur.com/a/jRTvO9e\" rel=\"nofollow noreferrer\">imgur.com/a/jRTvO9e</a>"}], "tags": [], "owner": {"reputation": 867, "user_id": 6531129, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3741d495ced91c057769a904b8ee6c26?s=128&d=identicon&r=PG&f=1", "display_name": "AESTHETICS", "link": "https://stackoverflow.com/users/6531129/aesthetics"}, "is_accepted": false, "score": 2, "last_activity_date": 1542575858, "creation_date": 1542575858, "answer_id": 53365557, "question_id": 50672525, "link": "https://stackoverflow.com/questions/50672525/garbled-string-while-do-http-request-in-go/53365557#53365557", "title": "Garbled string while do http request in Go", "body": "<p>In my case website did not respond with the charset within a Content-Type and did not replied with requested: <code>req.Header.Add(\"Accept-Charset\", \"utf-8\")</code></p>\n\n<p>I opended up file in Visual Studio Code and have been switching encoding to find out which one works best \"Reopen With Encoding\".</p>\n\n<p>Once i figured out which encoding it was i simply used function:</p>\n\n<pre><code>dec := charmap.Windows1250.NewDecoder()\noutput, _ := dec.Bytes(body)\n</code></pre>\n\n<p>from: <code>\"golang.org/x/text/encoding/charmap\"</code></p>\n\n<p>Full code example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"io/ioutil\"\n    \"golang.org/x/text/encoding/charmap\"\n)\n\nfunc main() {\n\n    client := &amp;http.Client{}\n\n    req, err := http.NewRequest(\"GET\", \"example.com\", nil)\n\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    resp, err := client.Do(req)\n\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    defer resp.Body.Close()\n\n    body, err := ioutil.ReadAll(resp.Body)\n\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    dec := charmap.Windows1250.NewDecoder()\n\n    output, err:= dec.Bytes(body)\n\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    // do something with output\n\n}\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 9889908, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1c1ed8d17ab7c9c3a4a1538b9d18e11?s=128&d=identicon&r=PG&f=1", "display_name": "felix", "link": "https://stackoverflow.com/users/9889908/felix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1843, "favorite_count": 1, "accepted_answer_id": 50673631, "answer_count": 2, "score": 1, "last_activity_date": 1542575858, "creation_date": 1528076712, "question_id": 50672525, "link": "https://stackoverflow.com/questions/50672525/garbled-string-while-do-http-request-in-go", "title": "Garbled string while do http request in Go", "body": "<p>I met a Garbled string question when do Get request in Go, the code is:</p>\n\n<pre><code>req , err:= http.NewRequest(httpMethod, url,strings.NewReader(\"\"))\nreq.Header.Add(\"Accept\",\"application/json\")\nresp, err := http.DefaultClient.Do(req)\nbody,err := ioutil.ReadAll(resp.Body)\nret := string(body)\nlog.Warningf(\"ret: %+v\", ret)\n</code></pre>\n\n<p>if the ret contains only english, it's correct, if contains Chinese, it has garbled string, how to solve this problem, thanks all!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 305, "user_id": 9110660, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vbJGa.png?s=128&g=1", "display_name": "Vla Mai", "link": "https://stackoverflow.com/users/9110660/vla-mai"}, "edited": false, "score": 0, "creation_date": 1528067830, "post_id": 50671809, "comment_id": 88353336, "body": "fmt.Println(f, math.Round(f/.0001)/10000)"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 6, "creation_date": 1528067831, "post_id": 50671809, "comment_id": 88353337, "body": "Basic computer floating point: The <i>actual</i> value is stored in binary base-2. What you are displaying is in base-10. Any value that is not perfectly divisible by 2 cannot be exact in binary floating point. It is never, ever exactly the fraction you think you have."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1528090900, "post_id": 50671809, "comment_id": 88357567, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/39544571/golang-round-to-nearest-0-05/39544897#39544897\">Golang Round to Nearest 0.05</a>."}], "answers": [{"comments": [{"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "edited": false, "score": 0, "creation_date": 1528071635, "post_id": 50671958, "comment_id": 88353949, "body": "but then that gives me a string not a float"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "reply_to_user": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "edited": false, "score": 0, "creation_date": 1528071827, "post_id": 50671958, "comment_id": 88353980, "body": "@MarissaLevy I didn&#39;t know what you needed. If you need a float, then you need the Round method, as you did."}, {"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "edited": false, "score": 0, "creation_date": 1528071962, "post_id": 50671958, "comment_id": 88354003, "body": "No worries...I guess I wasn&#39;t very specific."}], "tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": true, "score": 4, "last_activity_date": 1528069506, "creation_date": 1528069506, "answer_id": 50671958, "question_id": 50671809, "link": "https://stackoverflow.com/questions/50671809/cannot-round-to-nearest-0001/50671958#50671958", "title": "Cannot round to nearest .0001", "body": "<pre><code>        fmt.Printf(\"%f %b %0.4f\\n\", f, f, math.Round(f/.0001)*.0001)\n</code></pre>\n\n<p>Try using that. The <code>%0.4f</code> will format it to 4 decimal places. In fact if you only need the string, use that instead of your Round function.</p>\n\n<p>The <code>%b</code> will show you the real value. In Go that will display a large decimal (base-10) value, a p, then the exponent in powers of 2. So when it displays <code>5695309707476992p-55</code> you can find the floating point by doing <code>5695309707476992  / 2^55</code></p>\n"}], "owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 2, "accepted_answer_id": 50671958, "answer_count": 1, "score": 0, "last_activity_date": 1528069506, "creation_date": 1528067589, "question_id": 50671809, "link": "https://stackoverflow.com/questions/50671809/cannot-round-to-nearest-0001", "title": "Cannot round to nearest .0001", "body": "<p>I have the following:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\nfunc main() {\n    nums := []float64{\n        0.15807659924030304, 0.10901273787021637, 0.04955724626779556, 0.05886702239513397,\n    }\n\n    for _, f := range nums {\n        fmt.Println(f, math.Round(f/.0001)*.0001)\n    }\n}\n</code></pre>\n\n<p>output is:</p>\n\n<pre><code>0.15807659924030304 0.15810000000000002\n0.10901273787021637 0.109\n0.04955724626779556 0.049600000000000005\n0.05886702239513397 0.0589\n</code></pre>\n\n<p>Why are some ending up with > 4 decimal places? How do I correct it?</p>\n\n<p><a href=\"https://play.golang.org/p/kLvVjmsjq6Y\" rel=\"nofollow noreferrer\">https://play.golang.org/p/kLvVjmsjq6Y</a></p>\n"}, {"tags": ["go", "2d", "slice"], "comments": [{"owner": {"reputation": 3521, "user_id": 2304215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W708V.png?s=128&g=1", "display_name": "chrk", "link": "https://stackoverflow.com/users/2304215/chrk"}, "edited": false, "score": 1, "creation_date": 1528063707, "post_id": 50671367, "comment_id": 88352537, "body": "<code>s = append(s[:1], s[2:]...)</code> ?"}, {"owner": {"reputation": 305, "user_id": 9110660, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vbJGa.png?s=128&g=1", "display_name": "Vla Mai", "link": "https://stackoverflow.com/users/9110660/vla-mai"}, "edited": false, "score": 2, "creation_date": 1528063808, "post_id": 50671367, "comment_id": 88352557, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/34102704/golang-how-to-delete-an-element-from-a-2d-slice\">GoLang: How to delete an element from a 2D slice?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4513, "user_id": 3416272, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/xL2ZJ.jpg?s=128&g=1", "display_name": "Md Johirul Islam", "link": "https://stackoverflow.com/users/3416272/md-johirul-islam"}, "is_accepted": false, "score": 2, "last_activity_date": 1528065225, "last_edit_date": 1528065225, "creation_date": 1528064853, "answer_id": 50671535, "question_id": 50671367, "link": "https://stackoverflow.com/questions/50671367/golang-how-to-remove-a-row-from-a-matrix/50671535#50671535", "title": "Golang - How to remove a row from a matrix?", "body": "<p>You can try the following:</p>\n\n<pre><code>i := 1\ns = append(s[:i],s[i+1:]...)\n</code></pre>\n\n<p>You can try the working code in the  <a href=\"https://play.golang.org/p/GAXbDxKdjrg\" rel=\"nofollow noreferrer\">Golang playground</a></p>\n\n<p>Another alternative way is to use the following:</p>\n\n<pre><code>i := 1\ns = s[:i+copy(s[i:], s[i+1:])]\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/CMdcXf4g07Y\" rel=\"nofollow noreferrer\">Golang Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "is_accepted": true, "score": 2, "last_activity_date": 1528065736, "last_edit_date": 1528065736, "creation_date": 1528064932, "answer_id": 50671545, "question_id": 50671367, "link": "https://stackoverflow.com/questions/50671367/golang-how-to-remove-a-row-from-a-matrix/50671545#50671545", "title": "Golang - How to remove a row from a matrix?", "body": "<p>The formula to delete row at index <code>i</code> is:</p>\n\n<pre><code>s = append(s[:i], s[i+1:])\n</code></pre>\n\n<p>Here's a working example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    s := [][]int{\n        {0, 1, 2, 3},\n        {4, 5, 6, 7}, // This will be removed.\n        {8, 9, 10, 11},\n    }\n\n    // Delete row at index 1 without modifying original slice by\n    // appending to a new slice.\n    s2 := append([][]int{}, append(s[:1], s[2:]...)...)\n    fmt.Println(s2)\n\n    // Delete row at index 1. Original slice is modified.\n    s = append(s[:1], s[2:]...)\n    fmt.Println(s)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/6ZmrmwJ32cY\" rel=\"nofollow noreferrer\">Try it in the Go playground</a>.</p>\n\n<p>I recommend you to read <a href=\"https://github.com/golang/go/wiki/SliceTricks\" rel=\"nofollow noreferrer\">Go Slice Tricks</a>. Some of the tricks can be applied to multidimensional slices as well.</p>\n"}], "owner": {"reputation": 441, "user_id": 6451721, "user_type": "registered", "accept_rate": 79, "profile_image": "https://lh4.googleusercontent.com/-4pC3WCmF5xE/AAAAAAAAAAI/AAAAAAAAAFI/NjnGhmZoI6w/photo.jpg?sz=128", "display_name": "Fer Vargas", "link": "https://stackoverflow.com/users/6451721/fer-vargas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 640, "favorite_count": 0, "accepted_answer_id": 50671545, "answer_count": 2, "score": 0, "last_activity_date": 1566831465, "creation_date": 1528063445, "last_edit_date": 1566831465, "question_id": 50671367, "link": "https://stackoverflow.com/questions/50671367/golang-how-to-remove-a-row-from-a-matrix", "title": "Golang - How to remove a row from a matrix?", "body": "<p>So I have this 2D slice, for example:</p>\n\n<pre><code>s := [][]int{\n    {0, 1, 2, 3},\n    {4, 5, 6, 7},\n    {8, 9, 10, 11},\n}\n\nfmt.Println(s)\n\n//Outputs: [[0 1 2 3] [4 5 6 7] [8 9 10 11]]\n</code></pre>\n\n<p>How can I remove a full row from this 2D slice, so that the result would look like this if I decide to remove the middle row:</p>\n\n<pre><code>[[0 1 2 3] [8 9 10 11]]\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 0, "last_activity_date": 1528057050, "creation_date": 1528057050, "answer_id": 50670609, "question_id": 50670428, "link": "https://stackoverflow.com/questions/50670428/cant-remove-null-terminator-from-byte-array/50670609#50670609", "title": "Can&#39;t remove Null terminator from byte array?", "body": "<p>From your logs, the offending character seems to be found at position <code>2102</code>, while the whole array has <code>2615</code> elements.</p>\n\n<p>So it looks <code>Trim</code> won't solve it since the problem is not necessarily the final character of the array.</p>\n\n<p>Did you try removing all occurrences, using <code>Replace</code> for example?</p>\n\n<pre><code>byteRespTrim = bytes.Replace(byteRespTrim, []byte(\"\\x00\"), []byte{}, -1)\n</code></pre>\n"}], "owner": {"reputation": 886, "user_id": 939963, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/05d2c4c6364775f365fecf75e61b3228?s=128&d=identicon&r=PG", "display_name": "thisguy123", "link": "https://stackoverflow.com/users/939963/thisguy123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 358, "favorite_count": 0, "accepted_answer_id": 50670609, "answer_count": 1, "score": 0, "last_activity_date": 1528057050, "creation_date": 1528055548, "question_id": 50670428, "link": "https://stackoverflow.com/questions/50670428/cant-remove-null-terminator-from-byte-array", "title": "Can&#39;t remove Null terminator from byte array?", "body": "<p>I'm using <a href=\"https://github.com/elliottsam/winrm-dns-client\" rel=\"nofollow noreferrer\">this library</a> in Go (on OSX) to interact with a windows DNS server.</p>\n\n<p>When running the below snippet, I get an error about a null terminator.</p>\n\n<pre><code> $ ~/go/bin/winrm-dns-client create -d domain.com -n node-0 -t A -v 10.90.61.30\n2018/06/03 12:40:22 Error creating DNS record: Reading record: Reading record: Unmarshalling response: Unmarshalling json: invalid character '\\x00' after array element\n</code></pre>\n\n<p>My suspicion is that there's a null terminator added <a href=\"https://github.com/elliottsam/winrm-dns-client/blob/master/dns/helpers.go#L69\" rel=\"nofollow noreferrer\">here</a> when the helper method calls <code>sprintf</code> to concat json responses into an array.</p>\n\n<p>However, even after adding a <code>bytes.Trim</code> like shown below... I still get a null terminator error and it seems that the null terminator still exists... </p>\n\n<pre><code>func unmarshalResponse(resp string) ([]interface{}, error) {\n    var data interface{}\n    byteRespTrim := []byte(resp)\n    fmt.Print(\"found a null terminator at -- \")\n    fmt.Println(bytes.Index(byteRespTrim, []byte(\"\\x00\")))\n    fmt.Print(\"total length = \")\n    fmt.Println(len(byteRespTrim))\n    byteRespTrim = bytes.Trim(byteRespTrim, \"\\x00\")\n    fmt.Print(\"after trim found a null terminator at -- \")\n    loc := bytes.Index(byteRespTrim, []byte(\"\\x00\"))\n    fmt.Print(loc)\n</code></pre>\n\n<p>When calling I get the below </p>\n\n<pre><code>(master)\u26a1 % ./windows-dns-test create -d domain.com -n openshift-node-0 -t A -v 10.90.61.30                       \nfound a null terminator at -- 2102\ntotal length = 2615\nafter trim found a null terminator at -- 2102\n</code></pre>\n"}, {"tags": ["json", "go", "jsonparser"], "answers": [{"comments": [{"owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "edited": false, "score": 0, "creation_date": 1528058927, "post_id": 50670513, "comment_id": 88351436, "body": "Thanks, that&#39;s exactly what I was missing! It&#39;s a pity that <code>.DisallowUnknownFields()</code> doesn&#39;t return <code>json.Decoder</code> to chain those calls."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 4, "last_activity_date": 1528056325, "creation_date": 1528056325, "answer_id": 50670513, "question_id": 50670422, "link": "https://stackoverflow.com/questions/50670422/why-doesnt-json-parsing-fail-with-completely-different-type-passed-to-decode/50670513#50670513", "title": "Why doesn&#39;t JSON parsing fail with completely different type passed to Decode()?", "body": "<p>That's the expected behaviour of <code>Decode</code> (as documented in the <code>Unmarshal</code> function):</p>\n\n<p><a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/json/#Unmarshal</a></p>\n\n<blockquote>\n  <p>By default, object keys which don't have a corresponding struct field are ignored.</p>\n</blockquote>\n\n<p>You can however use the <code>DisallowUnknownFields()</code> function (as described in the docs as well) to have it fail if the input JSON has fields not contained in the destination struct.</p>\n\n<pre><code>dec := json.NewDecoder(r)\ndec.DisallowUnknownFields()\n</code></pre>\n\n<p>In that case, you'll get an error as you expect.</p>\n\n<p>Modified playground here: <a href=\"https://play.golang.org/p/A0f6dxTXV34\" rel=\"nofollow noreferrer\">https://play.golang.org/p/A0f6dxTXV34</a></p>\n"}], "owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 50670513, "answer_count": 1, "score": -1, "last_activity_date": 1528056325, "creation_date": 1528055516, "question_id": 50670422, "link": "https://stackoverflow.com/questions/50670422/why-doesnt-json-parsing-fail-with-completely-different-type-passed-to-decode", "title": "Why doesn&#39;t JSON parsing fail with completely different type passed to Decode()?", "body": "<p>I have the following data structures which I'd like to parse from an API:</p>\n\n<pre><code>type OrderBook struct {\n    Pair       string           `json:\"pair\"`\n    UpdateTime int64            `json:\"update_time\"`\n}\n\ntype depthResponse struct {\n    Result OrderBook `json:\"result\"`\n    // doesn't matter here\n    //Cmd    string              `json:\"-\"`\n}\n</code></pre>\n\n<p>and when I parse the following:</p>\n\n<pre><code>data := `{\"error\":{\"code\":\"3016\",\"msg\":\"\u4ea4\u6613\u5bf9\u9519\u8bef\"},\"cmd\":\"depth\"}`\n</code></pre>\n\n<p>It doesn't fail. Why?</p>\n\n<p>Full source code (<a href=\"https://play.golang.org/p/XfX3ZSMBvjh\" rel=\"nofollow noreferrer\" title=\"playground\">playground</a>)</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"strings\"\n)\n\ntype OrderBook struct {\n    Pair       string           `json:\"pair\"`\n    UpdateTime int64            `json:\"update_time\"`\n}\n\ntype depthResponse struct {\n    Result OrderBook `json:\"result\"`\n}\n\nfunc main() {\n    data := `{\"error\":{\"code\":\"3016\",\"msg\":\"\u4ea4\u6613\u5bf9\u9519\u8bef\"},\"cmd\":\"depth\"}`\n    r := strings.NewReader(data)\n\n    var resp depthResponse\n    if err := json.NewDecoder(r).Decode(&amp;resp); err != nil {\n        log.Fatalf(\"We should end up here: %v\", err)\n    }\n\n    fmt.Printf(\"%+v\\n\", resp)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 0, "creation_date": 1528054238, "post_id": 50670134, "comment_id": 88350183, "body": "I&#39;m already running <code>go run main.go</code> in the relative folder. I tried <code>os.Chdir</code> and it doesn&#39;t seem to find all directories and files in the chosen folder, but just on one level."}, {"owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "reply_to_user": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 0, "creation_date": 1528054437, "post_id": 50670134, "comment_id": 88350247, "body": "@P.Nick What do you mean by one level? Does it list all files in &quot;./myfolder&quot; but not in it&#39;s subdirectories?"}, {"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 0, "creation_date": 1528054539, "post_id": 50670134, "comment_id": 88350277, "body": "If I have <code>&#47;myfolder&#47;one&#47;two&#47;file.go</code> it will only print <code>myfolder&#47;one</code> even though it has multiple folders and also a file."}, {"owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "reply_to_user": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 0, "creation_date": 1528054791, "post_id": 50670134, "comment_id": 88350345, "body": "@P.Nick This is expected behavior. Listing a directory isn&#39;t a recursive operation. You must walk a directory if you want to list it recursively. See <a href=\"https://golang.org/pkg/path/filepath/#Walk\" rel=\"nofollow noreferrer\">filepath.Walk</a>"}, {"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 0, "creation_date": 1528054962, "post_id": 50670134, "comment_id": 88350400, "body": "Thanks! You&#39;ve been of much help!"}, {"owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "reply_to_user": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 0, "creation_date": 1528055171, "post_id": 50670134, "comment_id": 88350465, "body": "@P.Nick Glad to have helped ;-)"}], "tags": [], "owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "is_accepted": true, "score": 0, "last_activity_date": 1528055276, "last_edit_date": 1528055276, "creation_date": 1528053626, "answer_id": 50670134, "question_id": 50669983, "link": "https://stackoverflow.com/questions/50669983/scan-for-files-in-current-directory-only-with-ioutils-readdir-when-imported-thro/50670134#50670134", "title": "Scan for files in current directory only with ioutils ReadDir when imported through another file", "body": "<p>The current directory is not the directory of the source files, but rather the current directory of whoever executes the program.</p>\n\n<p>If you're executing the program from a shell (be it bash or the Windows command line), the program inherits the current directory from your shell.</p>\n\n<p>You must change the current directory with <code>cd myfolder</code> before executing the program or call <code>os.Chdir(\"myfolder\")</code> in your Go source file. (<code>os.Chdir</code> doesn't affect your shell's current directory)</p>\n\n<p>If you want to list a directory recursively, you must walk it. See <a href=\"https://golang.org/pkg/path/filepath/#Walk\" rel=\"nofollow noreferrer\">filepath.Walk</a>.</p>\n"}], "owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "accepted_answer_id": 50670134, "answer_count": 1, "score": 0, "last_activity_date": 1528055276, "creation_date": 1528052722, "question_id": 50669983, "link": "https://stackoverflow.com/questions/50669983/scan-for-files-in-current-directory-only-with-ioutils-readdir-when-imported-thro", "title": "Scan for files in current directory only with ioutils ReadDir when imported through another file", "body": "<p>I'm having an issue with ioutils.ReadDir, for some reason it's scanning for all files in the project root instead of in the current directory only.</p>\n\n<p>./main.go</p>\n\n<pre><code>import (\n    \"myfolder/myfile\"\n)\n\nfunc main() {\n    myfile.MyFunction()\n}\n</code></pre>\n\n<p>./myfolder/myfile.go</p>\n\n<pre><code>package myfile\n\nfunc MyFunction() {\n    files, err := ioutil.ReadDir(\".\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    for _, f := range files {\n        fi, err := os.Stat(f.Name())\n        if err != nil {\n            log.Fatal(err)\n            return\n        }\n\n        switch mode := fi.Mode(); {\n        case mode.IsDir():\n            fmt.Printf(\"%#s  is a folder\\n\", f.Name())\n        case mode.IsRegular():\n            fmt.Printf(\"%#s is a file\\n\", f.Name())\n        }\n    }\n}\n</code></pre>\n\n<p>I'm not really sure why it is behaving like this, I'm new to Go. My guess is because it's being imported through main.go. How can I make it only search for folders and files in <code>./myfolder</code>?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 5931, "user_id": 1354934, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/6428552a6061416e628aaef84edfd425?s=128&d=identicon&r=PG", "display_name": "user1354934", "link": "https://stackoverflow.com/users/1354934/user1354934"}, "edited": false, "score": 0, "creation_date": 1528050667, "post_id": 50669511, "comment_id": 88349147, "body": "Thanks.  I guess the duplication issue is always gonna be a problem right?  What if I just create a new map, like <code>map[*Employee]struct{}</code> and build up that by iterating over each Company.Projects[e.Project] ?  That way, I am guaranteed to not get duplicates for my keys, and iterate over that?"}, {"owner": {"reputation": 5931, "user_id": 1354934, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/6428552a6061416e628aaef84edfd425?s=128&d=identicon&r=PG", "display_name": "user1354934", "link": "https://stackoverflow.com/users/1354934/user1354934"}, "edited": false, "score": 0, "creation_date": 1528051547, "post_id": 50669511, "comment_id": 88349398, "body": "Just asking because the de-dupe would be costly as well haha."}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "reply_to_user": {"reputation": 5931, "user_id": 1354934, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/6428552a6061416e628aaef84edfd425?s=128&d=identicon&r=PG", "display_name": "user1354934", "link": "https://stackoverflow.com/users/1354934/user1354934"}, "edited": false, "score": 0, "creation_date": 1528098030, "post_id": 50669511, "comment_id": 88360740, "body": "Yes, if you are talking about a <code>Get</code> where the list returned is essentially a set, then yes, you could use a map to dedupe. Feel free to modify the example above in anyway that would benefit you. There&#39;s no reason to say that the return types of <code>Get</code> must be slices. They could easily be other datastructures."}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 0, "last_activity_date": 1528049440, "creation_date": 1528049440, "answer_id": 50669511, "question_id": 50669176, "link": "https://stackoverflow.com/questions/50669176/given-two-maps-how-to-find-the-common-keys-between-the-two/50669511#50669511", "title": "Given two maps, how to find the common keys between the two?", "body": "<p>If I understand correctly, in an idea world you'd like to be able to lookup <em>\"employees for a given project\"</em> as well as <em>\"projects for a given employee\"</em>?</p>\n\n<p>Without knowing the context that you will be using this code in; e.g. more writes than reads, more reads than writes, what the space vs. time complexity requirements are.</p>\n\n<p>If you are aiming for O(1) lookup for projects for an employee and O(1) lookup for employees for a project, then I would suggest creating your own datastructure to be able to facilitate this. This is the smallest interface that would work:</p>\n\n<pre><code>type ProjectEmployees interface {\n    RegisterProjectEmployee(p *Project, e *Employee)\n    GetEmployees(p *Project) []*Employees\n    GetProjects(e *Employee) []*Project\n}\n</code></pre>\n\n<p>I haven't listed a full implementation below as it would be trivial to work out, but you'd implement this interface with a struct that store 2 maps. </p>\n\n<p>The tradeoff is that you have a larger write / update cost, and data duplication, the benefit is O(1) lookups in both directions <code>Project &lt;--&gt; Employee</code>.</p>\n\n<pre><code>type projecEmployeesMap struct {\n    pe map[*Project][]*Employee\n    ep map[*Employee][]*Project\n}\n\nfunc (p *projectEmployeesMap) RegisterProjectEmployee(p *Project, e *Employee) {\n    p.pe[p] = append(p.pe[p], e) // store the mapping project -&gt; employees\n    p.ep[e] = append(p.ep[e], p) // store the mapping employees --&gt; project\n}\n</code></pre>\n\n<p>The get methods should be easy to implement with simple map lookups</p>\n"}], "owner": {"reputation": 5931, "user_id": 1354934, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/6428552a6061416e628aaef84edfd425?s=128&d=identicon&r=PG", "display_name": "user1354934", "link": "https://stackoverflow.com/users/1354934/user1354934"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 108, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1528049440, "creation_date": 1528047334, "question_id": 50669176, "link": "https://stackoverflow.com/questions/50669176/given-two-maps-how-to-find-the-common-keys-between-the-two", "title": "Given two maps, how to find the common keys between the two?", "body": "<p>I have two structs, Employee and Project.</p>\n\n<pre><code>type Employee struct {\n    ID        int\n    Projects map[*Departments]struct{}\n}\n\ntype Project struct {\n        ID        int\n}\n</code></pre>\n\n<p>I have a Company struct that has the following:</p>\n\n<pre><code>type Company struct {\n  Projects     map[*Project]map[*Employee]struct{}\n  Employees       map[*Employee]struct{}\n}\n</code></pre>\n\n<p>Given <code>e *Employee</code> and <code>c *Company</code> (<code>func (c *Company) getEmployeesOnSameProject(e *Employee) []*Employee { }</code> )and knowing that an employee can belong to multiple projects, I am having a difficult time figuring out how to get the employees across projects.</p>\n\n<p><code>e.Projects</code> might be something like -</p>\n\n<pre><code>eProjects {\n  P1\n  P2\n} \n</code></pre>\n\n<p><code>c.Projects</code> might be something like -</p>\n\n<pre><code>cProjects {\n  P1 {\n    E1\n    E2\n  }\n  P2 {\n    E1\n    E2\n    E3\n    E4\n  }\n}\n</code></pre>\n\n<p>If I am E1, how can I easily get the other employees on the same projects (P1 and P2) as me without having a nested for loop? </p>\n"}, {"tags": ["go", "websocket", "rpc", "json-rpc", "gorilla"], "comments": [{"owner": {"reputation": 249, "user_id": 1849118, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/5xRnS.jpg?s=128&g=1", "display_name": "fpawel", "link": "https://stackoverflow.com/users/1849118/fpawel"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528049950, "post_id": 50669173, "comment_id": 88348929, "body": "It is possible and I already made such a client. But I would like to avoid the boilerplate associated with the manual implementation of the protocol, which is perfectly implemented in the standard library, and use <code>*rpc.Client</code> instead."}, {"owner": {"reputation": 249, "user_id": 1849118, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/5xRnS.jpg?s=128&g=1", "display_name": "fpawel", "link": "https://stackoverflow.com/users/1849118/fpawel"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528050561, "post_id": 50669173, "comment_id": 88349112, "body": "\u0410 good suggestion, thank you."}, {"owner": {"reputation": 249, "user_id": 1849118, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/5xRnS.jpg?s=128&g=1", "display_name": "fpawel", "link": "https://stackoverflow.com/users/1849118/fpawel"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528093757, "post_id": 50669173, "comment_id": 88358669, "body": "@ThunderCat, maybe do you mean <a href=\"https://godoc.org/net/rpc#ClientCodec\" rel=\"nofollow noreferrer\">ClientCodec</a>?"}, {"owner": {"reputation": 249, "user_id": 1849118, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/5xRnS.jpg?s=128&g=1", "display_name": "fpawel", "link": "https://stackoverflow.com/users/1849118/fpawel"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528097105, "post_id": 50669173, "comment_id": 88360263, "body": "What about <a href=\"https://gist.github.com/fpawel/ba3738ed6309d917530de4342c12ce4a\" rel=\"nofollow noreferrer\">that</a>? Does this seem acceptable? I used protected ReadJSON / WriteJSON ."}], "answers": [{"tags": [], "owner": {"reputation": 249, "user_id": 1849118, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/5xRnS.jpg?s=128&g=1", "display_name": "fpawel", "link": "https://stackoverflow.com/users/1849118/fpawel"}, "is_accepted": false, "score": 2, "last_activity_date": 1528361630, "last_edit_date": 1528361630, "creation_date": 1528172672, "answer_id": 50692024, "question_id": 50669173, "link": "https://stackoverflow.com/questions/50669173/how-to-set-up-a-gorilla-websocket-connection-to-acts-as-json-rpc-client-for-brow/50692024#50692024", "title": "How to set up a gorilla/websocket connection to acts as JSON-RPC client for browsers applications?", "body": "<p>I provide <a href=\"https://godoc.org/github.com/powerman/rpc-codec/jsonrpc2#NewClient\" rel=\"nofollow noreferrer\">NewClient</a> with <a href=\"https://godoc.org/io#ReadWriteCloser\" rel=\"nofollow noreferrer\">io.ReadWriteCloser</a> implementation which convert read/writes to <a href=\"https://godoc.org/github.com/gorilla/websocket#Conn\" rel=\"nofollow noreferrer\">websocket</a> operations, thanks to <a href=\"https://github.com/powerman\" rel=\"nofollow noreferrer\">powerman</a>.\n    </p>\n\n<pre><code>package jsonrpc2ws\n\nimport (\n    \"github.com/powerman/rpc-codec/jsonrpc2\"\n    \"github.com/gorilla/websocket\"\n    \"encoding/json\"\n    \"io\"\n    \"sync\"\n)\n\nfunc NewClient(ws *websocket.Conn) *jsonrpc2.Client {\n    c := &amp;client{\n        ws:ws,\n    }\n    c.initRead()\n    c.initWrite()\n    return jsonrpc2.NewClient(c)\n}\n\ntype client struct {\n    w *io.PipeWriter\n    r *io.PipeReader\n    ws *websocket.Conn\n\n    err error      // io error\n    mu sync.Mutex  // protects err\n}\n\n\nfunc (x *client) error() (err error) {\n    x.mu.Lock()\n    err = x.err\n    x.mu.Unlock()\n    return\n}\n\nfunc (x *client) setError (err error) {\n    x.mu.Lock()\n    if x.err != nil {\n        x.err = err\n    }\n    x.mu.Unlock()\n}\n\nfunc (x *client) initRead(){\n    var w *io.PipeWriter\n    x.r, w = io.Pipe()\n    go func(){\n        _,b,err := x.ws.ReadMessage()\n        for  ; x.error() == nil &amp;&amp; err == nil; _,b,err = x.ws.ReadMessage(){\n            _,err = w.Write(b)\n        }\n        x.setError(err)\n        w.Close()\n    } ()\n}\n\nfunc (x *client) initWrite(){\n    var r *io.PipeReader\n    r,x.w = io.Pipe()\n    go func(){\n        dec := json.NewDecoder(r)\n        var b json.RawMessage\n        err := dec.Decode(&amp;b)\n        for  ; x.error() == nil &amp;&amp;  err == nil; err = dec.Decode(&amp;b){\n            err = x.ws.WriteMessage(websocket.TextMessage, b)\n        }\n        x.setError(err)\n        r.Close()\n    } ()\n}\n\nfunc (x *client) Write(p []byte) (int, error){\n    if x.error() != nil {\n        return 0, x.error()\n    }\n    return x.w.Write(p)\n}\n\nfunc (x *client) Read(p []byte) (int, error){\n    if x.error() != nil {\n        return 0, x.error()\n    }\n    return x.r.Read(p)\n}\n\nfunc (x *client) Close() error{\n    x.ws.Close()\n    x.w.Close()\n    x.r.Close()\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 249, "user_id": 1849118, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/5xRnS.jpg?s=128&g=1", "display_name": "fpawel", "link": "https://stackoverflow.com/users/1849118/fpawel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1060, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1528361630, "creation_date": 1528047311, "question_id": 50669173, "link": "https://stackoverflow.com/questions/50669173/how-to-set-up-a-gorilla-websocket-connection-to-acts-as-json-rpc-client-for-brow", "title": "How to set up a gorilla/websocket connection to acts as JSON-RPC client for browsers applications?", "body": "<p>I have a frontend <a href=\"https://gist.github.com/fpawel/6953dfafef1591300c62e1a1ea1db97c\" rel=\"nofollow noreferrer\">aplication</a>, that connects to websocket and try to serve  json-rpc2 to call client side from server. What is the best way to create <code>*rpc.Client</code> for it in a server application written in Go with \"github.com/gorilla/websocket\"? I tried to use <code>UnderlyingConn()</code> of <code>*websocket.Conn</code>: <code>jsonrpc2.NewClient(conn.UnderlyingConn())</code>, but it does not work.</p>\n"}]