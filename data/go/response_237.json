[{"tags": ["file", "go"], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1564126201, "post_id": 57192535, "comment_id": 100935191, "body": "This is how you can do it. You could use the special form of type assertion in case someone runs this on a platform where this fails: <code>if stat, ok := file_sys.(*syscall.Stat_t); ok { fmt.Println(stat.Gid) }</code>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1569914975, "post_id": 57192535, "comment_id": 102740055, "body": "Or alternatively you may directly call <a href=\"https://golang.org/pkg/syscall/#Stat\" rel=\"nofollow noreferrer\"><code>syscall.Stat()</code></a> which returns <a href=\"https://golang.org/pkg/syscall/#Stat_t\" rel=\"nofollow noreferrer\"><code>*syscall.Stat_t</code></a> but that is not available on all target OSes (e.g. on Window)."}], "tags": [], "owner": {"reputation": 463, "user_id": 1547214, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ea9bd7fcb2ba1bd6246d92369751df8f?s=128&d=identicon&r=PG", "display_name": "Elle Fie", "link": "https://stackoverflow.com/users/1547214/elle-fie"}, "is_accepted": true, "score": 4, "last_activity_date": 1564011632, "creation_date": 1564011632, "answer_id": 57192535, "question_id": 57192329, "link": "https://stackoverflow.com/questions/57192329/how-can-i-get-a-files-group-id-gid-in-go/57192535#57192535", "title": "How can I get a file&#39;s group ID (GID) in Go?", "body": "<p>The <a href=\"https://golang.org/pkg/reflect/#TypeOf\" rel=\"nofollow noreferrer\"><code>reflect</code></a> module showed that the data type for <code>Sys()</code>'s return is <code>*syscall.Stat_t</code>, so this seems to work to get the Gid of a file as a string:</p>\n\n<pre><code>file_info, _ := os.Stat(abspath)\nfile_sys := file_info.Sys()\nfile_gid := fmt.Sprint(file_sys.(*syscall.Stat_t).Gid)\n</code></pre>\n\n<p>Please let me know if there is a better way to do this.</p>\n"}], "owner": {"reputation": 463, "user_id": 1547214, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ea9bd7fcb2ba1bd6246d92369751df8f?s=128&d=identicon&r=PG", "display_name": "Elle Fie", "link": "https://stackoverflow.com/users/1547214/elle-fie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 744, "favorite_count": 0, "accepted_answer_id": 57192535, "answer_count": 1, "score": 5, "last_activity_date": 1564011632, "creation_date": 1564009630, "last_edit_date": 1564010037, "question_id": 57192329, "link": "https://stackoverflow.com/questions/57192329/how-can-i-get-a-files-group-id-gid-in-go", "title": "How can I get a file&#39;s group ID (GID) in Go?", "body": "<p><code>os.Stat()</code> returns a <a href=\"https://golang.org/pkg/os/#FileInfo\" rel=\"nofollow noreferrer\"><code>FileInfo</code></a> object, which has a <code>Sys()</code> method that returns an <code>Interface{}</code> with no methods.</p>\n\n<p>Though I am able to <code>fmt.Printf()</code> it to \"see\" the \"Gid\", I am unable to access \"Gid\" programmatically.</p>\n\n<p>How do I retrieve the \"Gid\" of a file here?</p>\n\n<pre><code>file_info, _ := os.Stat(abspath)\nfile_sys := file_info.Sys()\nfmt.Printf(\"File Sys() is: %+v\", file_sys)\n</code></pre>\n\n<p>Prints:</p>\n\n<pre><code>File Sys() is: &amp;{Dev:31 Ino:5031364 Nlink:1 Mode:33060 Uid:1616 Gid:31 X__pad0:0 Rdev:0 Size:32 Blksize:32768 Blocks:0 Atim:{Sec:1564005258 Nsec:862700000} Mtim:{Sec:1563993023 Nsec:892256000} Ctim:{Sec:1563993023 Nsec:893251000} X__unused:[0 0 0]}\n</code></pre>\n\n<p>Note: I do not need a portable solution, it just has to work on Linux (notable because <a href=\"https://github.com/golang/go/issues/14753\" rel=\"nofollow noreferrer\"><code>Sys()</code></a> is known to be flaky).</p>\n\n<p>Possibly related: <a href=\"https://stackoverflow.com/questions/38185916/convert-interface-to-map-in-golang\">Convert interface{} to map in Golang</a></p>\n"}, {"tags": ["go", "garbage-collection", "unsafe-pointers"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1564013990, "post_id": 57192245, "comment_id": 100894763, "body": "If you have a pointer to something, the GC is not going to free it. Are you experiencing a problem?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1564060997, "post_id": 57192245, "comment_id": 100913500, "body": "Second that - the GC is pretty reliable, so unless you&#39;re actually experiencing a problem, this seems like debugging a hypothetical and therefore unnecessary."}], "answers": [{"tags": [], "owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "is_accepted": false, "score": 1, "last_activity_date": 1564040623, "creation_date": 1564040623, "answer_id": 57196767, "question_id": 57192245, "link": "https://stackoverflow.com/questions/57192245/need-help-to-understand-garbage-collection-in-golang/57196767#57196767", "title": "Need help to understand garbage collection in GoLang", "body": "<p>To understand what GC might do to your variables, first you need to know how and where Go allocates them. Here is a good reading about <a href=\"https://www.ardanlabs.com/blog/2017/05/language-mechanics-on-escape-analysis.html\" rel=\"nofollow noreferrer\">escape analysis</a>, that is how Go compiler decides where allocate memory, between stack or heap.</p>\n\n<p>Long story short, GC will free memory only if it is not referenced by your Go program. </p>\n\n<p>In your example, the reference to loaded data by <code>data, _ := ioutil.ReadFile(filename)</code> is passed to <code>t.Data = *(*[]*MyDataType) (t.readFileData(p))</code> ultimately. Therefore, they will be referenced as long as <code>(t *T)</code> struct is referenced as well. As far as I can see from your code, the loaded data will be garbage-collected along with <code>(t *T)</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 2, "creation_date": 1564043462, "post_id": 57197454, "comment_id": 100903629, "body": "Edit your question for follow-ups."}], "tags": [], "owner": {"reputation": 11, "user_id": 8282766, "user_type": "registered", "profile_image": "https://graph.facebook.com/1171737196287220/picture?type=large", "display_name": "Ladislav Macoun", "link": "https://stackoverflow.com/users/8282766/ladislav-macoun"}, "is_accepted": false, "score": -2, "last_activity_date": 1564043101, "creation_date": 1564043101, "answer_id": 57197454, "question_id": 57192245, "link": "https://stackoverflow.com/questions/57192245/need-help-to-understand-garbage-collection-in-golang/57197454#57197454", "title": "Need help to understand garbage collection in GoLang", "body": "<p>According to the <a href=\"https://golang.org/pkg/reflect/#SliceHeader\" rel=\"nofollow noreferrer\">reflect docs</a>, I've to keep a separate pointer to  <code>data *[]byte</code>, to avoid garbage collection. So the solution is to add a <code>referencePtr</code> to </p>\n\n<pre><code>type T struct {\n   header              Header\n   data                   []*MyDataType\n   referencePtr      *[]byte\n}\n</code></pre>\n\n<p>which will point to my data inside the Read function</p>\n\n<pre><code>func (t *T) Read(p []byte) (int, error) {\n    t.referencePtr = &amp;p\n    t.Header = *(*Header) (t.readFileHeader(p))\n    t.Data = *(*[]*MyDataType) (t.readFileData(p))\n}\n</code></pre>\n\n<p>or is this unnecessary?</p>\n"}], "owner": {"reputation": 11, "user_id": 8282766, "user_type": "registered", "profile_image": "https://graph.facebook.com/1171737196287220/picture?type=large", "display_name": "Ladislav Macoun", "link": "https://stackoverflow.com/users/8282766/ladislav-macoun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 283, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1564043101, "creation_date": 1564008912, "question_id": 57192245, "link": "https://stackoverflow.com/questions/57192245/need-help-to-understand-garbage-collection-in-golang", "title": "Need help to understand garbage collection in GoLang", "body": "<p>I'm a little bit confused with GoLang's garbage collector.</p>\n\n<p>Consider this following code, where I implement reader interface for my type T.</p>\n\n<pre><code>type T struct {\n   header Header\n   data   []*MyDataType\n}\n\nfunc (t *T) Read(p []byte) (int, error) {\n    t.Header = *(*Header) (t.readFileHeader(p))\n    t.Data = *(*[]*MyDataType) (t.readFileData(p))\n}\n</code></pre>\n\n<p>wherein the reader functions I will cast the data to MyDataType using the <code>unsafe.Pointer</code> which will point to slice created with the reflect module (this is more complicated, but for the sake of the example this should be enough)</p>\n\n<pre><code>func (t *T) readFileData(data []byte, idx int, ...) unsafe.Pointer {\n    ...\n    return unsafe.Pointer(&amp;reflect.SliceHeader{Data : uintptr(unsafe.Pointer(&amp;data[idx])), ...}) \n}\n</code></pre>\n\n<p>and If I am gonna read the data in different function</p>\n\n<pre><code>func (d *Dummy) foo() {\n    data, _ := ioutil.ReadFile(filename)\n    d.t.Read(data) &lt;---will GC free data?\n}\n</code></pre>\n\n<p>Now I'm confused if it is possible, that the GC will free loaded data from file after exiting the <code>foo</code> function. Or the data will be freed after the <code>d.t</code> is freed.</p>\n"}, {"tags": ["go", "encoding", "gob"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1564004408, "post_id": 57191549, "comment_id": 100892749, "body": "Register the type reported in the error message: <code>gob.Register([]*baseball.Athlete{})</code>"}, {"owner": {"reputation": 11316, "user_id": 86731, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/876564dd7625975a8e9029fde0b48af0?s=128&d=identicon&r=PG", "display_name": "BryanWheelock", "link": "https://stackoverflow.com/users/86731/bryanwheelock"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1564061728, "post_id": 57191549, "comment_id": 100913937, "body": "gob.Register([]*baseball.Athlete)   throws error: type []*baseball.Athlete is not an expression"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1564061938, "post_id": 57191549, "comment_id": 100914059, "body": "You are missing the {}.  Copy and paste from my comment."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1564062209, "post_id": 57191549, "comment_id": 100914230, "body": "To your side note at the end - I&#39;d call it &quot;slice <i>of</i> pointer to Athlete&quot;. &quot;Slice <i>that is a pointer</i> to Athlete&quot; implies the slice is a pointer, which it isn&#39;t, it&#39;s a slice."}], "owner": {"reputation": 11316, "user_id": 86731, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/876564dd7625975a8e9029fde0b48af0?s=128&d=identicon&r=PG", "display_name": "BryanWheelock", "link": "https://stackoverflow.com/users/86731/bryanwheelock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 269, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1564062010, "creation_date": 1564003990, "last_edit_date": 1564062010, "question_id": 57191549, "link": "https://stackoverflow.com/questions/57191549/i-registered-the-type-but-still-get-error-gob-type-not-registered-for-interfac", "title": "I registered the type but still get error &quot;gob: type not registered for interface:&quot;", "body": "<p>I can't seem to figure out why a custom struct is not Registered with encoding/gob</p>\n\n<p>This error happens when I attempt to save the Gorilla session:   </p>\n\n<pre><code>could not save session: securecookie: error - caused by: securecookie: error - caused by: gob: type not registered for interface: []*baseball.Athlete\n</code></pre>\n\n<p>Here is the struct </p>\n\n<pre><code>type Athlete struct {\n    AuthID      string\n    DisplayName string\n    Email       string\n    Coach       string\n}\n</code></pre>\n\n<p>I'm Registering the struct with init() fuction   </p>\n\n<pre><code>gob.Register(&amp;baseball.Athlete{})\n</code></pre>\n\n<p>In an auth function I attempt to save a session containing the entity.</p>\n\n<pre><code>athlete := make([]*baseball.Athlete, 0)\n_, err = q.GetAll(ctx, &amp;athlete)\n\nif len(athlete) == 0 {\n\n    athlete := &amp;baseball.Athlete{\n        AuthID:      id_token.Sub, // I'm using id_token.sub which is unigue to Google, not sure if other Oauth2 providers have equivalent\n        Email:       id_token.Email,\n    }\n\n    _, err := datastore.Put(ctx, datastore.NewIncompleteKey(ctx, \"Athlete\", nil), athlete)\n    if err != nil {\n        return appErrorf(err, \"authgo: new Athlete put failed: %v\", err)\n    }\n}\n\noauthFlowSession.Values[currentAthleteKey] = athlete\n\nlog.Printf(\"$#$#$#$#$#$2 in auth.go athlete is type: %T\", athlete)\nif err := oauthFlowSession.Save(r, w); err != nil {\n    return appErrorf(err, \"could not save session: %v\", err)\n}\n</code></pre>\n\n<p>Here is the server log of the error:   </p>\n\n<pre><code>2019/07/24 21:05:56 athlete is type []*baseball.Athlete\n2019/07/24 21:05:56 Handler error: status code: 500, message: could not save session: securecookie: error - caused by: securecookie: error - caused by: gob: type not registered for interface: []*baseball.Athlete, underlying err: securecookie.MultiError{securecookie.cookieError{typ:1, msg:\"\", cause:securecookie.cookieError{typ:1, msg:\"\", cause:(*errors.errorString)(0xc4201f8a60)}}}\n</code></pre>\n\n<p>Different Variations:<br>\ngob.Register([]*baseball.Athlete) ==>  error: type []*baseball.Athlete is not an expression</p>\n\n<p>Side question, how would you say \"[]*baseball.Athlete\" ?  </p>\n\n<p>I'm guessing, \"slice that is a pointer to struct baseball.Athlete\"</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1564003539, "post_id": 57191410, "comment_id": 100892487, "body": "Both your attempts should work. The error is most likely somewhere else. If you want help, post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 21, "user_id": 8904959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bf6368282a289f6bf13bb585beb7c23?s=128&d=identicon&r=PG&f=1", "display_name": "Amit", "link": "https://stackoverflow.com/users/8904959/amit"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1564003781, "post_id": 57191410, "comment_id": 100892564, "body": "I have added the definition of structs. will that help? Since I am using struct from another package ( oradatabase) . Could that be an issue?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1564004636, "post_id": 57191410, "comment_id": 100892809, "body": "Show the Go code that executes the template."}], "owner": {"reputation": 21, "user_id": 8904959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8bf6368282a289f6bf13bb585beb7c23?s=128&d=identicon&r=PG&f=1", "display_name": "Amit", "link": "https://stackoverflow.com/users/8904959/amit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1564043736, "creation_date": 1564003217, "last_edit_date": 1564043736, "question_id": 57191410, "link": "https://stackoverflow.com/questions/57191410/cant-access-a-template-value-or-struct-value-inside-range-in-go-template", "title": "Can&#39;t access a template value or struct value inside range in Go template", "body": "<p>I am passing a struct while executing a template. I can't access the string variable inside struct while iterating through slice variable which is part of same struct. </p>\n\n<p>I tried using $ as per the prefix while accessing the variable.\nI also tried creating a variable in the template itself and calling it inside range. I can't see that this new variable is accessible outside the range but not inside.</p>\n\n<pre><code>package main\ntype landing_page Struct {\n    Login_user string\n    Versions_tagged []oradatabase.Tag_versions\n}\n\npackage oradatabase\n// partial code\ntype Tag_version struct {\n     User_id string,\n     Rel_name string\n}\n</code></pre>\n\n<p>All these structs are initialized and has value assigned correctly as I can access the values outside range within template without any issue.</p>\n\n<pre class=\"lang-html prettyprint-override\"><code>template : landing_page.html\nTrial - 1\n---------\n&lt;table&gt;\n&lt;thead&gt;&lt;tr&gt;\n&lt;th&gt;h1&lt;/th&gt;\n&lt;th&gt;h2&lt;/th&gt;\n&lt;th&gt;h3&lt;/th&gt;\n&lt;/tr&gt;\n&lt;/thead&gt;\n&lt;tbody&gt;\n{{ range .Versions_tagged}}\n&lt;tr&gt;\n&lt;td&gt;{{.User_id}}&lt;/td&gt;\n&lt;td&gt;{{.Rel_Name}}&lt;/td&gt;\n&lt;td&gt;{{$.Login_user}}&lt;/td&gt;\n&lt;/tr&gt;\n{{end}}\n&lt;/tbody&gt;\n&lt;/table&gt;\n\nTrial -2\n---------\n{{ $login_user := .Login_user}}\n&lt;table&gt;\n&lt;thead&gt;&lt;tr&gt;\n&lt;th&gt;h1&lt;/th&gt;\n&lt;th&gt;h2&lt;/th&gt;\n&lt;th&gt;h3&lt;/th&gt;\n&lt;/tr&gt;\n&lt;/thead&gt;\n&lt;tbody&gt;\n{{ range .Versions_tagged}}\n&lt;tr&gt;\n&lt;td&gt;{{.User_id}}&lt;/td&gt;\n&lt;td&gt;{{.Rel_Name}}&lt;/td&gt;\n&lt;td&gt;{{$login_user}}&lt;/td&gt;\n&lt;/tr&gt;\n{{end}}\n&lt;/tbody&gt;\n&lt;/table&gt;\n</code></pre>\n\n<p>With both these trial - the login_user inside range is coming is null ( no value) while is accessible outside. Can't figure out what's wrong.\nGo version :1.11.4</p>\n\n<p>The value of variable Login_user should be available inside the range in template. There is no error on console. It simply doesn't print anything for Login_user inside range and loop also terminate as that stage.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 452, "user_id": 4334369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/164mz.jpg?s=128&g=1", "display_name": "sieberts", "link": "https://stackoverflow.com/users/4334369/sieberts"}, "edited": false, "score": 0, "creation_date": 1564088778, "post_id": 57191279, "comment_id": 100926595, "body": "How would the API know which fields do not apply, can you explain with an example?"}, {"owner": {"reputation": 487, "user_id": 6762056, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/3gveB.jpg?s=128&g=1", "display_name": "sioesi", "link": "https://stackoverflow.com/users/6762056/sioesi"}, "reply_to_user": {"reputation": 452, "user_id": 4334369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/164mz.jpg?s=128&g=1", "display_name": "sieberts", "link": "https://stackoverflow.com/users/4334369/sieberts"}, "edited": false, "score": 0, "creation_date": 1564089925, "post_id": 57191279, "comment_id": 100926964, "body": "In this case, those that come from the new API comes with the PRICE field, which will not come for the old books."}], "answers": [{"tags": [], "owner": {"reputation": 452, "user_id": 4334369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/164mz.jpg?s=128&g=1", "display_name": "sieberts", "link": "https://stackoverflow.com/users/4334369/sieberts"}, "is_accepted": false, "score": 0, "last_activity_date": 1564090937, "creation_date": 1564090937, "answer_id": 57210479, "question_id": 57191279, "link": "https://stackoverflow.com/questions/57191279/match-two-arrays-with-differents-struct/57210479#57210479", "title": "Match two arrays with differents struct", "body": "<p>If you want to be lazy about it: unmarshal them to an array of the generic type map[string]interface{} in stead of a Book-type. </p>\n\n<pre><code>var books []map[string]interface{}\nerr := json.Unmarshal(response, &amp;books)\n</code></pre>\n\n<p>Ofcourse this makes it harder to access concrete book properties, but it's not impossible.</p>\n"}], "owner": {"reputation": 487, "user_id": 6762056, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/3gveB.jpg?s=128&g=1", "display_name": "sioesi", "link": "https://stackoverflow.com/users/6762056/sioesi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1564090937, "creation_date": 1564002485, "last_edit_date": 1564002876, "question_id": 57191279, "link": "https://stackoverflow.com/questions/57191279/match-two-arrays-with-differents-struct", "title": "Match two arrays with differents struct", "body": "<p>I have the following </p>\n\n<pre><code>type Book struct {\n    Name  string\n    Pages int\n}\n\ntype Library struct {\n    Books []Book \n}\n</code></pre>\n\n<p>And from an api I get all the Books and transform them like this:</p>\n\n<pre><code>var books []Book\njson.Unmarshal(response, &amp;books)\n</code></pre>\n\n<p>But now I receive another list of <code>Books</code> from another api, but they come with different properties, which is why I add a <code>MetaData</code> property to differentiate them.</p>\n\n<pre><code>type Book struct {\n    Name     string\n    Page    int\n    Metadata MetaData\n}\n\ntype MetaData struct {\n    Type     string `json:\"type\"`\n    Price string `json:\"price,omitempty\"`\n}\n</code></pre>\n\n<p>Then together both arrangements in one and return as json.</p>\n\n<pre><code>books = append(response.Books, response2.Books...)\n</code></pre>\n\n<p>And I add <code>omitempty</code> so that when they don't come, don't show them in the json, this is working fine.  However, every time I want to add a new field / property I have to modify my book api and the extra api that I mentioned above. I wanted to know if there is any possibility that a struct has multiple fields or accepts them rather and does not show them in case they do not apply.  You must say that I cannot modify the answers for the same format, and that they are all providers and it is out of my reach. The idea is to gather amabs answers and deliver only one to the front.</p>\n"}, {"tags": ["go", "libxml2"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1564001523, "post_id": 57191012, "comment_id": 100891802, "body": "You&#39;re missing iconv.h, as the error says. A quick Google search for &quot;iconv.h: No such file or directory&quot; will tell you you need to install libiconv."}, {"owner": {"reputation": 13, "user_id": 11794552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef4df0bee34dc919939524543c40029f?s=128&d=identicon&r=PG&f=1", "display_name": "Liza", "link": "https://stackoverflow.com/users/11794552/liza"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1564065785, "post_id": 57191012, "comment_id": 100916410, "body": "Hi, I have  the libiconv downloaded and I read in few posts that we probably need to build it too. But I am using a package which should have precomplied libxml2- github.com/lestrrat-go/libxml2. Also, My go code (the one which uses this library) is running just fine , it is only during debugging I am getting this error. This is very strange to me."}], "owner": {"reputation": 13, "user_id": 11794552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef4df0bee34dc919939524543c40029f?s=128&d=identicon&r=PG&f=1", "display_name": "Liza", "link": "https://stackoverflow.com/users/11794552/liza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 278, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1564043770, "creation_date": 1564001251, "last_edit_date": 1564043770, "question_id": 57191012, "link": "https://stackoverflow.com/questions/57191012/how-to-complie-libxml2-in-golang", "title": "How to complie libxml2 in golang", "body": "<p>I have a Go application which uses libxml2 library - github.com/lestrrat-go/libxml2. </p>\n\n<p>On running my main.go file. I do not get any issues while on debugging I get:</p>\n\n<pre><code>github.com/lestrrat-go/libxml2/clib\nIn file included from \n    C:/msys64/usr/include/libxml2/libxml/parser.h:810:0,\n   from C:/msys64/usr/include/libxml2/libxml/HTMLparser.h:16,\n   from ..\\..\\github.com\\lestrrat-go\\libxml2\\clib\\clib.go:28:\n   C:/msys64/usr/include/libxml2/libxml/encoding.h:28:19: fatal \n   error: iconv.h: No such file or directory\n   compilation terminated.\n   exit status 2\n   Process exiting with code: 1\n</code></pre>\n\n<p>Any suggestions on how to resolve this?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 4931739, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/0f933c7a3c37f7fe11bb22e4fe841470?s=128&d=identicon&r=PG&f=1", "display_name": "Kaushal Shah", "link": "https://stackoverflow.com/users/4931739/kaushal-shah"}, "edited": false, "score": 0, "creation_date": 1563987822, "post_id": 57187946, "comment_id": 100886013, "body": "Umm.. That&#39;s not correct. I tried it. It gives &quot;Cannot use Example.Id type uint as type uint64"}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "reply_to_user": {"reputation": 49, "user_id": 4931739, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/0f933c7a3c37f7fe11bb22e4fe841470?s=128&d=identicon&r=PG&f=1", "display_name": "Kaushal Shah", "link": "https://stackoverflow.com/users/4931739/kaushal-shah"}, "edited": false, "score": 0, "creation_date": 1563987864, "post_id": 57187946, "comment_id": 100886029, "body": "@KaushalShah my fault, you need to convert it to <code>uint64</code> explicitly."}, {"owner": {"reputation": 49, "user_id": 4931739, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/0f933c7a3c37f7fe11bb22e4fe841470?s=128&d=identicon&r=PG&f=1", "display_name": "Kaushal Shah", "link": "https://stackoverflow.com/users/4931739/kaushal-shah"}, "edited": false, "score": 0, "creation_date": 1563988004, "post_id": 57187946, "comment_id": 100886094, "body": "Ah! Your edited answer works. Thank you. But I see this as a workaround. What happens if this code is run on 32 bit machine?"}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "reply_to_user": {"reputation": 49, "user_id": 4931739, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/0f933c7a3c37f7fe11bb22e4fe841470?s=128&d=identicon&r=PG&f=1", "display_name": "Kaushal Shah", "link": "https://stackoverflow.com/users/4931739/kaushal-shah"}, "edited": false, "score": 1, "creation_date": 1563988134, "post_id": 57187946, "comment_id": 100886149, "body": "All builtin types must be available regardless of the architecture."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1563988246, "post_id": 57187946, "comment_id": 100886204, "body": "The uint64 type is available on all architectures and is guaranteed to have a size greater than or equal to the uint type. The code works the same on all architectures."}, {"owner": {"reputation": 49, "user_id": 4931739, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/0f933c7a3c37f7fe11bb22e4fe841470?s=128&d=identicon&r=PG&f=1", "display_name": "Kaushal Shah", "link": "https://stackoverflow.com/users/4931739/kaushal-shah"}, "edited": false, "score": 0, "creation_date": 1563988511, "post_id": 57187946, "comment_id": 100886337, "body": "I see. Then follow-up question would be: would using uint64() on 32 bit machine give a value different than what we would get on 64 bit machine?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1563988593, "post_id": 57187946, "comment_id": 100886374, "body": "No. Math is math. If it gave a different answer, it would be fundamentally broken."}], "tags": [], "owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "is_accepted": true, "score": 3, "last_activity_date": 1563987578, "creation_date": 1563987578, "answer_id": 57187946, "question_id": 57187889, "link": "https://stackoverflow.com/questions/57187889/how-to-convert-uint-type-into-string-type-in-golang/57187946#57187946", "title": "How to convert &quot;uint&quot; type into &quot;string&quot; type in Golang?", "body": "<p>Use <a href=\"https://golang.org/pkg/strconv/#FormatUint\" rel=\"nofollow noreferrer\"><code>strconv.FormatUint()</code></a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    var n uint = 123\n    var s string = strconv.FormatUint(uint64(n), 10)\n    fmt.Printf(\"s=%s\\n\", s)\n}\n</code></pre>\n\n<p>(<a href=\"https://play.golang.org/p/e5QLSgxD17-\" rel=\"nofollow noreferrer\">Go Playground</a>)</p>\n"}], "owner": {"reputation": 49, "user_id": 4931739, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/0f933c7a3c37f7fe11bb22e4fe841470?s=128&d=identicon&r=PG&f=1", "display_name": "Kaushal Shah", "link": "https://stackoverflow.com/users/4931739/kaushal-shah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2058, "favorite_count": 0, "accepted_answer_id": 57187946, "answer_count": 1, "score": -1, "last_activity_date": 1563987617, "creation_date": 1563987331, "last_edit_date": 1563987617, "question_id": 57187889, "link": "https://stackoverflow.com/questions/57187889/how-to-convert-uint-type-into-string-type-in-golang", "title": "How to convert &quot;uint&quot; type into &quot;string&quot; type in Golang?", "body": "<p>I'm working on a piece of code that returns uint data type. I need to convert uint datatype into string for further processing.</p>\n\n<p>I've already tried strconv package and none of the functions accept uint. Golang Documentation: <a href=\"https://golang.org/ref/spec#Numeric_types\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Numeric_types</a> states that uint are platform dependent. Is that the reason we don't have any standard functions for conversion?</p>\n\n<pre><code>type Example{\n    Id uint    //value 3\n    name string\n}\n</code></pre>\n\n<p>Need to extract Id into a string.</p>\n\n<p>Expected: \"3\"\nActual: N/A</p>\n"}, {"tags": ["go", "rfc"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1563985545, "post_id": 57187435, "comment_id": 100884936, "body": "<code>init</code>, like <code>main</code>, is a special function. If you want to be able to call its functionality from elsewhere, put it in a different function, and call that function from <code>init</code>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1563985560, "post_id": 57187435, "comment_id": 100884944, "body": "<code>init()</code> functions are special as <a href=\"https://golang.org/ref/spec#Package_initialization\" rel=\"nofollow noreferrer\">described in the specification</a>. A function with that name cannot be called by application code.  Fix your application by using a different name for the function.  Note that the above program has another issue: there&#39;s not guarantee that the goroutine will execute before the program exits."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563985648, "post_id": 57187435, "comment_id": 100884981, "body": "<a href=\"https://golang.org/ref/spec#Package_initialization\" rel=\"nofollow noreferrer\">As the spec says</a>: &quot;the init identifier can be used only to declare init functions, yet the identifier itself is not declared. Thus init functions cannot be referred to from anywhere in a program.&quot; This is intentional on the part of the language designers."}, {"owner": {"reputation": 27, "user_id": 11773659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c95b2a6d9ae29d17848c70e1251282e?s=128&d=identicon&r=PG&f=1", "display_name": "Kipli Antonio Carle Mene", "link": "https://stackoverflow.com/users/11773659/kipli-antonio-carle-mene"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1563986109, "post_id": 57187435, "comment_id": 100885212, "body": "that&#39;s totally different question @tim-cooper"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1563987335, "last_edit_date": 1563987335, "creation_date": 1563985686, "answer_id": 57187503, "question_id": 57187435, "link": "https://stackoverflow.com/questions/57187435/calling-init-function-from-another-function/57187503#57187503", "title": "Calling init function from another function", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Package_initialization\" rel=\"nofollow noreferrer\">Package initialization</a></p>\n  \n  <p>the init identifier can be used only to declare init functions, yet\n  the identifier itself is not declared. Thus init functions cannot be\n  referred to from anywhere in a program.</p>\n</blockquote>\n\n<hr>\n\n<p>To accomplish your objective, call a function.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc init() {\n    f(\"init\")\n}\n\nfunc f(s string) {\n    fmt.Printf(\"f(%q)\\n\", s)\n}\n\nfunc main() {\n    f(\"main\")\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/isyrCIeYCV4\" rel=\"nofollow noreferrer\">https://play.golang.org/p/isyrCIeYCV4</a></p>\n\n<p>Output:</p>\n\n<pre><code>f(\"init\")\nf(\"main\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 10903895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d2c2adefc4952b41b4d62cdbd268f5?s=128&d=identicon&r=PG&f=1", "display_name": "art of go", "link": "https://stackoverflow.com/users/10903895/art-of-go"}, "is_accepted": false, "score": -1, "last_activity_date": 1564019794, "creation_date": 1564019794, "answer_id": 57193257, "question_id": 57187435, "link": "https://stackoverflow.com/questions/57187435/calling-init-function-from-another-function/57193257#57193257", "title": "Calling init function from another function", "body": "<p>init can not called, it will run when package loaded.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc init() {\n    fmt.Println(\"Hello, playground\")\n}\nfunc main(){\n}\n</code></pre>\n\n<p>result: Hello, playground</p>\n"}], "owner": {"reputation": 27, "user_id": 11773659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c95b2a6d9ae29d17848c70e1251282e?s=128&d=identicon&r=PG&f=1", "display_name": "Kipli Antonio Carle Mene", "link": "https://stackoverflow.com/users/11773659/kipli-antonio-carle-mene"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 411, "favorite_count": 1, "accepted_answer_id": 57187503, "answer_count": 2, "score": -3, "last_activity_date": 1564019794, "creation_date": 1563985429, "last_edit_date": 1563985558, "question_id": 57187435, "link": "https://stackoverflow.com/questions/57187435/calling-init-function-from-another-function", "title": "Calling init function from another function", "body": "<p>why i can't call <code>init</code> function from the other function, <code>init()</code> is just function right, why i can't just call the <code>init</code> function, should i change golang RFC to make it happend</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc init() {\n    fmt.Println(\"Hello, playground\")\n}\n\nfunc main() {\n    go init()\n    fmt.Println(\"Hello, playground\")\n}\n</code></pre>\n\n<p>error : </p>\n\n<pre><code>./prog.go:12:8: undefined: init\n</code></pre>\n"}, {"tags": ["go", "go-modules", "vgo"], "answers": [{"comments": [{"owner": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "edited": false, "score": 1, "creation_date": 1576137227, "post_id": 57186981, "comment_id": 104803054, "body": "Module not in go.mod but still in vendor dir!"}, {"owner": {"reputation": 1090, "user_id": 4411354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M3Gcz.png?s=128&g=1", "display_name": "jesugmz", "link": "https://stackoverflow.com/users/4411354/jesugmz"}, "reply_to_user": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "edited": false, "score": 0, "creation_date": 1587664407, "post_id": 57186981, "comment_id": 108607628, "body": "@sope have you execute it with the GOFLAG -mode=vendor? <a href=\"https://github.com/golang/go/wiki/Modules#how-do-i-use-vendoring-with-modules-is-vendoring-going-away\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/&hellip;</a>"}, {"owner": {"reputation": 9542, "user_id": 8068625, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4spqa.png?s=128&g=1", "display_name": "Henry Woody", "link": "https://stackoverflow.com/users/8068625/henry-woody"}, "edited": false, "score": 0, "creation_date": 1609218272, "post_id": 57186981, "comment_id": 115779111, "body": "Seems to remove code generating modules (that aren&#39;t used directly in the code, only in <code>&#47;&#47;go:generate</code> comments) is there a way to preserve those modules?"}], "tags": [], "owner": {"reputation": 1090, "user_id": 4411354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M3Gcz.png?s=128&g=1", "display_name": "jesugmz", "link": "https://stackoverflow.com/users/4411354/jesugmz"}, "is_accepted": true, "score": 56, "last_activity_date": 1592416775, "last_edit_date": 1592416775, "creation_date": 1563983877, "answer_id": 57186981, "question_id": 57186705, "link": "https://stackoverflow.com/questions/57186705/how-to-remove-an-installed-package-using-go-modules/57186981#57186981", "title": "How to remove an installed package using go modules", "body": "<p>Found it <a href=\"https://blog.golang.org/using-go-modules#TOC_7.\" rel=\"noreferrer\">https://blog.golang.org/using-go-modules#TOC_7.</a></p>\n\n<p><code>go mod tidy</code></p>\n\n<p>So basically, once the package is not being imported in any package you can perform a <code>go mod tidy</code> and it will safely remove the unused depencies.</p>\n\n<p>And if you are vendoring the dependencies, then run the command below to make the module changes be applied in the vendor folder:</p>\n\n<p><code>go mod vendor</code></p>\n"}], "owner": {"reputation": 1090, "user_id": 4411354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M3Gcz.png?s=128&g=1", "display_name": "jesugmz", "link": "https://stackoverflow.com/users/4411354/jesugmz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 21292, "favorite_count": 6, "accepted_answer_id": 57186981, "answer_count": 1, "score": 25, "last_activity_date": 1592416775, "creation_date": 1563982937, "last_edit_date": 1581473666, "question_id": 57186705, "link": "https://stackoverflow.com/questions/57186705/how-to-remove-an-installed-package-using-go-modules", "title": "How to remove an installed package using go modules", "body": "<p>I've installed a package using go modules (go get in Go 1.13) and now I want to remove it. In the <a href=\"https://github.com/golang/go/wiki/vgo\" rel=\"noreferrer\">documentation</a> there is nothing about this and in <a href=\"https://golang.org/pkg/cmd/go/internal/get/\" rel=\"noreferrer\">go get docu</a> neither.</p>\n\n<p>Removing the package from go.mod manually doesn't solve the issue so it remains in go.sum.</p>\n\n<p>How should I remove a package in a clean way?</p>\n"}, {"tags": ["go", "clang", "llvm"], "answers": [{"tags": [], "owner": {"reputation": 29966, "user_id": 637669, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0227e5d5eaceb8ae2f751df38d421764?s=128&d=identicon&r=PG", "display_name": "arrowd", "link": "https://stackoverflow.com/users/637669/arrowd"}, "is_accepted": true, "score": 1, "last_activity_date": 1563997195, "creation_date": 1563997195, "answer_id": 57190165, "question_id": 57186224, "link": "https://stackoverflow.com/questions/57186224/failure-while-building-llgollvm/57190165#57190165", "title": "Failure while building llgo+llvm", "body": "<p>You seem to lack RAM for linking. Try running <code>make</code> without <code>-j</code> argument, switching <code>CMAKE_BUILD_TYPE</code> to <code>Release</code> and using <code>gold</code> or <code>lld</code> instead of BFD <code>ld</code>.</p>\n"}], "owner": {"reputation": 71, "user_id": 9335121, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0683c4d47cf4d70cc07baeafd58fa53?s=128&d=identicon&r=PG&f=1", "display_name": "Moeketsi Raselimo", "link": "https://stackoverflow.com/users/9335121/moeketsi-raselimo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 647, "favorite_count": 0, "accepted_answer_id": 57190165, "answer_count": 1, "score": 0, "last_activity_date": 1563997195, "creation_date": 1563981376, "last_edit_date": 1563982489, "question_id": 57186224, "link": "https://stackoverflow.com/questions/57186224/failure-while-building-llgollvm", "title": "Failure while building llgo+llvm", "body": "<p>I was trying to build the llvm project from the sources. I'm interested in using (instrumenting) the go frontend. I followed steps from <a href=\"https://github.com/llvm-mirror/llgo\" rel=\"nofollow noreferrer\">llgo repo</a>. It fails when executing </p>\n\n<blockquote>\n  <p>make install</p>\n</blockquote>\n\n<p>at 91%. </p>\n\n<pre><code>[ 91%] Linking CXX executable ../../bin/dsymutil\n[ 91%] Building CXX object tools/clang/lib/StaticAnalyzer/Checkers/CMakeFiles/obj.clangStaticAnalyzerCheckers.dir/VforkChecker.cpp.o\n[ 91%] Building CXX object tools/clang/lib/Sema/CMakeFiles/obj.clangSema.dir/SemaStmt.cpp.o\n[ 91%] Building CXX object tools/clang/lib/Sema/CMakeFiles/obj.clangSema.dir/SemaStmtAsm.cpp.o\ncollect2: fatal error: ld terminated with signal 9 [Killed]\ncompilation terminated.\ntools/llc/CMakeFiles/llc.dir/build.make:212: recipe for target 'bin/llc' failed\nmake[2]: *** [bin/llc] Error 1\nmake[2]: *** Deleting file 'bin/llc'\nCMakeFiles/Makefile2:68154: recipe for target 'tools/llc/CMakeFiles/llc.dir/all' failed\nmake[1]: *** [tools/llc/CMakeFiles/llc.dir/all] Error 2\n[ 91%] Building CXX object tools/clang/lib/StaticAnalyzer/Checkers/CMakeFiles/obj.clangStaticAnalyzerCheckers.dir/VLASizeChecker.cpp.o\n[ 91%] Building CXX object tools/clang/lib/Sema/CMakeFiles/obj.clangSema.dir/SemaStmtAttr.cpp.o\n[ 91%] Building CXX object tools/clang/lib/StaticAnalyzer/Checkers/CMakeFiles/obj.clangStaticAnalyzerCheckers.dir/ValistChecker.cpp.o\n[ 91%] Built target llvm-cfi-verify\n[ 91%] Building CXX object tools/clang/lib/StaticAnalyzer/Checkers/CMakeFiles/obj.clangStaticAnalyzerCheckers.dir/VirtualCallChecker.cpp.o\n[ 91%] Building CXX object tools/clang/lib/Sema/CMakeFiles/obj.clangSema.dir/SemaTemplate.cpp.o\n[ 91%] Building CXX object tools/clang/lib/Sema/CMakeFiles/obj.clangSema.dir/SemaTemplateDeduction.cpp.o\n[ 91%] Building CXX object tools/clang/lib/Sema/CMakeFiles/obj.clangSema.dir/SemaTemplateInstantiate.cpp.o\n[ 91%] Building CXX object tools/clang/lib/Sema/CMakeFiles/obj.clangSema.dir/SemaTemplateInstantiateDecl.cpp.o\n[ 91%] Building CXX object tools/clang/lib/Sema/CMakeFiles/obj.clangSema.dir/SemaTemplateVariadic.cpp.o\n[ 91%] Built target obj.clangStaticAnalyzerCheckers\n[ 91%] Building CXX object tools/clang/lib/Sema/CMakeFiles/obj.clangSema.dir/SemaType.cpp.o\ncollect2: fatal error: ld terminated with signal 9 [Killed]\ncompilation terminated.\ntools/bugpoint/CMakeFiles/bugpoint.dir/build.make:419: recipe for target 'bin/bugpoint' failed\nmake[2]: *** [bin/bugpoint] Error 1\nmake[2]: *** Deleting file 'bin/bugpoint'\nCMakeFiles/Makefile2:67602: recipe for target 'tools/bugpoint/CMakeFiles/bugpoint.dir/all' failed\nmake[1]: *** [tools/bugpoint/CMakeFiles/bugpoint.dir/all] Error 2\n[ 91%] Building CXX object tools/clang/lib/Sema/CMakeFiles/obj.clangSema.dir/TypeLocBuilder.cpp.o\n[ 91%] Built target obj.clangSema\n[ 91%] Built target dsymutil\nMakefile:151: recipe for target 'all' failed\nmake: *** [all] Error 2\n</code></pre>\n\n<p>Alternatively, I followed <a href=\"https://solarianprogrammer.com/2013/01/17/building-clang-libcpp-ubuntu-linux/\" rel=\"nofollow noreferrer\">building clang 8, llvm 8 on ubuntu 18.04</a>. I managed to build clang+llvm. I tried to build llgo but failed terribly. What am I missing?</p>\n\n<p>I'm  using Ubuntu 18.04.2 LTS.</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1563982368, "post_id": 57185912, "comment_id": 100883250, "body": "what&#39;s your <code>GO111MODULE</code> env var value?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1563982408, "post_id": 57185912, "comment_id": 100883278, "body": "Duplicat.use the replacr directive."}, {"owner": {"reputation": 1, "user_id": 7617721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db0fe01f623e35b55fe015df52f92095?s=128&d=identicon&r=PG&f=1", "display_name": "Lucia", "link": "https://stackoverflow.com/users/7617721/lucia"}, "reply_to_user": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1564001981, "post_id": 57185912, "comment_id": 100891970, "body": "@dm03514 I don&#39;t have that env var set, but maybe it&#39;s not needed? Since I&#39;m using go version 1.12.7"}, {"owner": {"reputation": 1, "user_id": 7617721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db0fe01f623e35b55fe015df52f92095?s=128&d=identicon&r=PG&f=1", "display_name": "Lucia", "link": "https://stackoverflow.com/users/7617721/lucia"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1564002030, "post_id": 57185912, "comment_id": 100891991, "body": "@Volker what do you mean?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1564036785, "post_id": 57185912, "comment_id": 100900080, "body": "@Lucia <a href=\"https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/&hellip;</a>"}, {"owner": {"reputation": 1, "user_id": 7617721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db0fe01f623e35b55fe015df52f92095?s=128&d=identicon&r=PG&f=1", "display_name": "Lucia", "link": "https://stackoverflow.com/users/7617721/lucia"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1564057723, "post_id": 57185912, "comment_id": 100911491, "body": "@Volker I&#39;m sorry but I still don&#39;t get what&#39;s wrong. I did read that section before but I&#39;m surely missing something. I&#39;m using the <code>replace</code> directives in my main module (maps)."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 7617721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db0fe01f623e35b55fe015df52f92095?s=128&d=identicon&r=PG&f=1", "display_name": "Lucia", "link": "https://stackoverflow.com/users/7617721/lucia"}, "is_accepted": true, "score": 0, "last_activity_date": 1564057978, "creation_date": 1564057978, "answer_id": 57202062, "question_id": 57185912, "link": "https://stackoverflow.com/questions/57185912/problem-when-trying-to-use-local-submodules/57202062#57202062", "title": "Problem when trying to use local submodules", "body": "<p>Silly me, there was a typo in the import path at <code>/maps/main.go</code>: <code>\"github/X/go-log-util\"</code>. .com was missing! :)</p>\n"}], "owner": {"reputation": 1, "user_id": 7617721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db0fe01f623e35b55fe015df52f92095?s=128&d=identicon&r=PG&f=1", "display_name": "Lucia", "link": "https://stackoverflow.com/users/7617721/lucia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 57202062, "answer_count": 1, "score": -1, "last_activity_date": 1564057978, "creation_date": 1563980406, "question_id": 57185912, "link": "https://stackoverflow.com/questions/57185912/problem-when-trying-to-use-local-submodules", "title": "Problem when trying to use local submodules", "body": "<p>I'm trying to use go modules with some local code that hasn't been pushed to github yet (golang version is 1.12.7)</p>\n\n<p>So far I have 3 modules that are all under the same parent root (sibiling folders). <code>maps</code> and <code>go-database-util</code> are already pushed, but the module should be using whatever is in my local (and I haven't yet created a git repo for <code>go-log-util</code>), so I don't think this is relevant.</p>\n\n<pre><code>/maps\n    go.mod\n    go.sum\n    main.go\n    /api\n        ...more files (just a regular package, not a module)\n\n/go-database-util\n    db.go\n    go.mod\n    go.sum\n\n/go-log-util\n    log.go\n    go.mod\n    go.sum\n</code></pre>\n\n<p>Both <code>go-database-util</code> and <code>go-log-util</code> are libraries, no main package is provided. Interestingly, <code>go-database-util</code> works fine when imported into /maps/main.go, but that's not the case when attempting to import <code>go-log-util</code>. This is what I get\nwhen trying to <code>go build</code> <code>maps</code>:</p>\n\n<p><code>build github.com/X/maps: cannot load github/X/go-log-util: cannot find module providing package github/X/go-log-util</code></p>\n\n<p>What is going on here? I have been struggling with moving from <code>go dep</code> to go modules but no luck so far.</p>\n\n<p>The relevant code is as follows.</p>\n\n<p>Many thanks! :)</p>\n\n<p><code>/maps/main.go</code></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n    \"time\"\n\n    log \"github/X/go-log-util\"\n\n    dbUtil \"github.com/X/go-database-util\"\n    \"github.com/X/maps/api\"\n    \"github.com/gorilla/mux\"\n    \"github.com/jinzhu/gorm\"\n    \"github.com/namsral/flag\"\n    \"github.com/sirupsen/logrus\"\n    \"github.com/urfave/negroni\"\n)\n\ntype configuration struct {\n    Addr       string\n    LogLevel   string\n    DBSettings dbUtil.Settings\n}\n\nvar (\n    config configuration\n    db     *gorm.DB\n)\n\nfunc main() {\n    loadConfig()\n    flag.Parse()\n    logrus.Infof(\"Using config: %#v\", config)\n    var err error\n    db, err = dbUtil.Setup(config.DBSettings)\n    if err != nil {\n        logrus.Fatal(err)\n    }\n\n    n := negroni.New()\n    n.Use(negroni.HandlerFunc(log.LoggingMiddleware))\n    router := mux.NewRouter()\n    userRoutes := mux.NewRouter()\n    userRoutes.HandleFunc(\"/api/maps/info\", api.HandleRead).Methods(\"GET\")\n    n.UseHandler(router)\n    srv := &amp;http.Server{\n        Handler: n,\n        Addr:    config.Addr,\n    }\n\n    setupCleanupHandler()\n    logrus.Fatal(srv.ListenAndServe())\n}\n\nfunc loadConfig() {\n    flag.StringVar(&amp;config.Addr, \"addr\", \"localhost:8080\", \"HTTP service address\")\n    flag.StringVar(&amp;config.LogLevel, \"log-level\", \"debug\",\n        \"Application logging level (debug, info, warning, error, fatal, panic)\")\n\n    var dbPassword string\n    var connMaxLifetime int\n    flag.StringVar(&amp;config.DBSettings.Host, \"db-host\", \"\", \"DB host\")\n    flag.StringVar(&amp;config.DBSettings.User, \"maps-db-username\", \"\", \"DB user\")\n    flag.StringVar(&amp;config.DBSettings.DBName, \"maps-db-name\", \"X\", \"DB name\")\n    flag.StringVar(&amp;dbPassword, \"maps-db-password\", \"\", \"DB password\")\n    flag.IntVar(&amp;config.DBSettings.MaxIdleConns, \"db-max-idle-conns\", 10, \"DB max idle connections\")\n    flag.IntVar(&amp;config.DBSettings.MaxOpenConns, \"db-max-open-conns\", 100, \"DB max open connections\")\n    flag.BoolVar(&amp;config.DBSettings.LogEnabled, \"db-enable-log\", false, \"Enable detailed gorm log\")\n    flag.IntVar(&amp;connMaxLifetime, \"db-max-lifetime-conns\", 5, \"DB max connection lifetime (minutes)\")\n    config.DBSettings.Password = &amp;dbPassword\n    config.DBSettings.ConnMaxLifetime = time.Duration(connMaxLifetime) * time.Minute\n}\n\nfunc healthHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"OK SO\")\n}\n\nfunc setupCleanupHandler() {\n    sigs := make(chan os.Signal, 2)\n    signal.Notify(sigs, os.Interrupt, syscall.SIGTERM)\n    go func() {\n        &lt;-sigs\n        logrus.Info(\"Server shutdown, cleaning up resources\")\n        db.Close()\n        os.Exit(1)\n    }()\n}\n</code></pre>\n\n<p><code>/maps/go.mod</code></p>\n\n<pre><code>module github.com/X/maps\n\ngo 1.12\n\nrequire (\n    github.com/X/go-database-util v0.0.0\n    github.com/X/go-log-util v0.0.0\n    github.com/gorilla/mux v1.6.2\n    github.com/jinzhu/gorm v1.9.10\n    github.com/namsral/flag v1.7.4-pre\n    github.com/sirupsen/logrus v1.4.2\n    github.com/urfave/negroni v1.0.0\n)\n\nreplace github.com/X/go-log-util =&gt; ../go-log-util\n\nreplace github.com/X/go-database-util =&gt; ../go-database-util\n</code></pre>\n\n<p><code>/go-database-util/db.mod</code></p>\n\n<pre><code>// Package db provides utility functions to perform database related tasks.\n// While most of the code is generic, it assumes to be working using a postgres driver.\npackage db\n\nimport (\n    \"fmt\"\n    \"time\"\n\n    \"github.com/jinzhu/gorm\"\n    // required in order to load postgres driver.\n    _ \"github.com/jinzhu/gorm/dialects/postgres\"\n    \"github.com/sirupsen/logrus\"\n)\n\n// Settings store a database main configuration options.\ntype Settings struct {\n    Host     string\n    User     string\n    DBName   string\n    Password *string\n\n    MaxIdleConns    int\n    MaxOpenConns    int\n    ConnMaxLifetime time.Duration\n\n    LogEnabled bool\n}\n\n// Setup configures the settings for database connections.\nfunc Setup(s Settings) (*gorm.DB, error) {\n    connURL := fmt.Sprintf(\"host=%s user=%s dbname=%s sslmode=disable password=%s\",\n        s.Host, s.User, s.DBName, *s.Password)\n    db, err := gorm.Open(\"postgres\", connURL)\n    if err != nil {\n        return nil, err\n    }\n\n    db.DB().SetMaxIdleConns(s.MaxIdleConns)\n    db.DB().SetMaxOpenConns(s.MaxOpenConns)\n\n    // broken connections may not be detected; would need a dedicate goroutine\n    // setting this to just a few seconds / minutes will solve a lot of issues\n    // see https://github.com/go-sql-driver/mysql/issues/529\n    db.DB().SetConnMaxLifetime(s.ConnMaxLifetime)\n    db.LogMode(s.LogEnabled)\n    logger := logrus.New()\n    db.SetLogger(logger)\n    return db, nil\n}\n</code></pre>\n\n<p><code>go-database-util/go.mod</code></p>\n\n<pre><code>module github.com/X/go-database-util\n\ngo 1.12\n\nrequire (\n    github.com/jinzhu/gorm v1.9.10\n    github.com/sirupsen/logrus v1.4.2\n)\n</code></pre>\n\n<p><code>go-log-util/log.go</code></p>\n\n<pre><code>package log\n\nimport (\n    \"context\"\n    \"net/http\"\n    \"os\"\n\n    \"github.com/sirupsen/logrus\"\n)\n\nconst (\n    // RequestIDHeader is the header name for the request id.\n    RequestIDHeader = \"X-Request-Id\"\n    // UserIDKey is the key for the user id inside the logger fields.\n    UserIDKey = \"UserID\"\n)\n\n// RequestContext returns a new context with the argument context fields\n// and a request id.\nfunc RequestContext(ctx context.Context, req *http.Request) context.Context {\n    requestID := req.Header.Get(RequestIDHeader)\n    reqContext := context.WithValue(ctx, RequestIDHeader, requestID)\n    return reqContext\n}\n\n// L returns logrus entry with context information.\nfunc L(ctx context.Context) *logrus.Entry {\n    logger := logrus.New()\n    Configure(logger)\n\n    l := logrus.Fields{\n        RequestIDHeader: RequestID(ctx),\n    }\n\n    if id := UserID(ctx); id != 0 {\n        l[UserIDKey] = id\n    }\n\n    return logger.WithFields(l)\n}\n\n// RequestID returns the request id from the context.\nfunc RequestID(ctx context.Context) string {\n    if id, ok := ctx.Value(RequestIDHeader).(string); ok {\n        return id\n    }\n    return \"\"\n}\n\n// UserID returns the user id from the context.\nfunc UserID(ctx context.Context) uint64 {\n    if id, ok := ctx.Value(UserIDKey).(uint64); ok {\n        return id\n    }\n    return 0\n}\n\n// Setup initializes and sets configuration options for the logger.\nfunc Setup(logLevel string, logger *logrus.Logger) {\n\n    logger.Formatter = &amp;logrus.TextFormatter{\n        FullTimestamp: true,\n    }\n\n    logger.Out = os.Stdout\n    level, _ := logrus.ParseLevel(logLevel)\n    logger.Level = level\n}\n\n// Configure initializes and set configuration options for the logger.\nfunc Configure(logger *logrus.Logger) {\n\n    logger.Formatter = &amp;logrus.TextFormatter{\n        FullTimestamp: true,\n    }\n\n    logger.Out = os.Stdout\n    logger.Level = logrus.StandardLogger().Level\n}\n\n// LoggingMiddleware creates a middleware that logs useful information from an\n// *http.Request\nfunc LoggingMiddleware(w http.ResponseWriter, r *http.Request, next http.HandlerFunc) {\n    ctx := RequestContext(r.Context(), r)\n    logFields := logrus.Fields{\n        \"remoteAddr\":      r.RemoteAddr,\n        \"method\":          r.Method,\n        \"url\":             r.URL,\n        \"x-forwarded-for\": r.Header.Get(\"X-Forwarded-For\"),\n    }\n\n    L(ctx).WithFields(logFields).Info(\"Incoming request\")\n    next(w, r.WithContext(ctx))\n}\n</code></pre>\n\n<p><code>go-log-util/go.mod</code></p>\n\n<pre><code>module github.com/X/go-log-util\n\ngo 1.12\n\nrequire github.com/sirupsen/logrus v1.4.2\n</code></pre>\n"}, {"tags": ["reactjs", "amazon-web-services", "go", "environment-variables"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1563975349, "post_id": 57184201, "comment_id": 100878963, "body": "&quot;not sure how to set environment variables in ec2&quot; - the same way. A virtual machine is just a machine, running an operating system. You set the environment variables however you normally would for whatever operating system it is. Type &quot;set environment variables in &quot; and whatever OS you&#39;re running into a search engine and you should have your answer in seconds."}, {"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1563975900, "post_id": 57184201, "comment_id": 100879291, "body": "typically people create a shell wrapper script on the target aws machine  which will populate the needed env vars export commands then launch your go binary"}], "answers": [{"comments": [{"owner": {"reputation": 193, "user_id": 11766408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec295cea34bc4a92fe14a67082d53407?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc", "link": "https://stackoverflow.com/users/11766408/jpskgc"}, "edited": false, "score": 0, "creation_date": 1563985557, "post_id": 57186745, "comment_id": 100884943, "body": "Thanks for reply. So would you have any recommendation for client side? Axios and Firebase codes are set in client side."}, {"owner": {"reputation": 12118, "user_id": 663360, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8d913eec72e7837bb2712a06ea5f25c5?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Stormacq", "link": "https://stackoverflow.com/users/663360/s%c3%a9bastien-stormacq"}, "reply_to_user": {"reputation": 193, "user_id": 11766408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec295cea34bc4a92fe14a67082d53407?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc", "link": "https://stackoverflow.com/users/11766408/jpskgc"}, "edited": false, "score": 0, "creation_date": 1563988826, "post_id": 57186745, "comment_id": 100886471, "body": "I would use AWS Secret Manager to retrieve your configuration data : <a href=\"https://docs.aws.amazon.com/secretsmanager/latest/userguide/intro.html\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/secretsmanager/latest/userguide/intro.ht&zwnj;&#8203;ml</a>"}], "tags": [], "owner": {"reputation": 12118, "user_id": 663360, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8d913eec72e7837bb2712a06ea5f25c5?s=128&d=identicon&r=PG", "display_name": "S&#233;bastien Stormacq", "link": "https://stackoverflow.com/users/663360/s%c3%a9bastien-stormacq"}, "is_accepted": false, "score": 0, "last_activity_date": 1563983085, "creation_date": 1563983085, "answer_id": 57186745, "question_id": 57184201, "link": "https://stackoverflow.com/questions/57184201/how-to-set-env-variables-for-react-go-in-aws-ec2/57186745#57186745", "title": "How to set env variables for react &amp; go in aws ec2", "body": "<p>In the shell script you are using to launch your server on EC2, add the environment variable definition, for example :</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>export ENV_VAR_1=value_1\nexport ENV_VAR_2=value_2\n\n... start your server ...\n</code></pre>\n\n<p>Note that this will only work for the server side.  The React App is made of Javascript running in the client's browser and you can not control the environment variables there.</p>\n\n<p>If I understand well, the <code>Axios</code> code extract above is part of the React front end.  You can not have <code>process.env</code> there as this is executed on customer machine.</p>\n"}, {"tags": [], "owner": {"reputation": 193, "user_id": 11766408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec295cea34bc4a92fe14a67082d53407?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc", "link": "https://stackoverflow.com/users/11766408/jpskgc"}, "is_accepted": true, "score": 0, "last_activity_date": 1566375467, "creation_date": 1566375467, "answer_id": 57587281, "question_id": 57184201, "link": "https://stackoverflow.com/questions/57184201/how-to-set-env-variables-for-react-go-in-aws-ec2/57587281#57587281", "title": "How to set env variables for react &amp; go in aws ec2", "body": "<p>I use elastic beanstalk and set environment variables there.</p>\n"}], "owner": {"reputation": 193, "user_id": 11766408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec295cea34bc4a92fe14a67082d53407?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc", "link": "https://stackoverflow.com/users/11766408/jpskgc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1151, "favorite_count": 0, "accepted_answer_id": 57587281, "answer_count": 2, "score": 0, "last_activity_date": 1566375467, "creation_date": 1563975222, "last_edit_date": 1563978836, "question_id": 57184201, "link": "https://stackoverflow.com/questions/57184201/how-to-set-env-variables-for-react-go-in-aws-ec2", "title": "How to set env variables for react &amp; go in aws ec2", "body": "<p>I've made React &amp; Go product in local.\nAnd I'm going to deploy it to AWS EC2.</p>\n\n<p>To work in AWS EC2, I need to set environment variables for some secret information.</p>\n\n<p>I've already set env variables for local environment. But I'm not sure about\nenv variables working for production environment(AWS EC2).</p>\n\n<p>I already set <code>env.</code> file for local environment.\nBut not sure how to set environment variables in ec2.</p>\n\n<p>I use environment variables for axios, firebase and mysql.</p>\n\n<pre><code>//axios\n   const client = axios.create({\n      baseURL: process.env.REACT_APP_API_URL,\n    });\n    client\n      .get('/api/articles')\n      .then(response =&gt; {\n        this.setState({articles: response.data});\n      })\n      .catch(response =&gt; console.log('ERROR!! occurred in Backend.'));\n</code></pre>\n\n<pre><code>//firebases\nconst firebaseConfig = {\n  apiKey: process.env.REACT_APP_FIREBASE_API_KEY,\n  authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\n  databaseURL: process.env.REACT_APP_FIREBASE_DATABASE_URL,\n  projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,\n  storageBucket: '',\n  messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.REACT_APP_FIREBASE_APP_ID,\n};\n\nfirebase.initializeApp(firebaseConfig);\n\nexport default firebase;\n</code></pre>\n\n<pre><code>//mysql\n    err := godotenv.Load()\n    if err != nil {\n        //TODO production\n\n    }\n    db, err := sql.Open(\"mysql\", os.Getenv(\"MYSQL_USER\")+\":\"+os.Getenv(\"MYSQL_PASSWORD\")+\"@tcp(localhost:3306)/article\")\n    if err != nil {\n        panic(err.Error())\n    }\n\n    defer db.Close()\n\n    err = db.Ping()\n    if err != nil {\n        panic(err.Error())\n    }\n</code></pre>\n\n<p>Here is the github.\n<a href=\"https://github.com/jpskgc/article\" rel=\"nofollow noreferrer\">https://github.com/jpskgc/article</a></p>\n\n<p>I'm going to deploy this React &amp; Golang product in AWS EC2.\nBut I'm not sure how to set environment variables.</p>\n"}, {"tags": ["go", "output", "exec"], "answers": [{"comments": [{"owner": {"reputation": 133, "user_id": 9362384, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Me5D7ndvXKM/AAAAAAAAAAI/AAAAAAAAADg/noEOiJQPv-E/photo.jpg?sz=128", "display_name": "Melody Anoni", "link": "https://stackoverflow.com/users/9362384/melody-anoni"}, "edited": false, "score": 0, "creation_date": 1563974908, "post_id": 57184075, "comment_id": 100878735, "body": "Thanks for the response! I&#39;ve tried that, but the output is the same error because spaces must be separated by a comma"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 133, "user_id": 9362384, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Me5D7ndvXKM/AAAAAAAAAAI/AAAAAAAAADg/noEOiJQPv-E/photo.jpg?sz=128", "display_name": "Melody Anoni", "link": "https://stackoverflow.com/users/9362384/melody-anoni"}, "edited": false, "score": 3, "creation_date": 1563975490, "post_id": 57184075, "comment_id": 100879046, "body": "What do you mean &quot;spaces must be separated by a comma&quot;? Are you sure you&#39;ve tried it exactly as quoted in the answer? Also, have you tried actually <i>printing the error you receive</i> to see the specific error?"}, {"owner": {"reputation": 133, "user_id": 9362384, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Me5D7ndvXKM/AAAAAAAAAAI/AAAAAAAAADg/noEOiJQPv-E/photo.jpg?sz=128", "display_name": "Melody Anoni", "link": "https://stackoverflow.com/users/9362384/melody-anoni"}, "edited": false, "score": 0, "creation_date": 1563976015, "post_id": 57184075, "comment_id": 100879368, "body": "so if you want to run the command <code>git -v</code> it needs to be separated like <code>cmd := exec.Command(&quot;git&quot;, &quot;-v&quot;)</code>. Similarly here. I want to run <code>mdls -name kMDItemVersion &#47;Applications&#47;Bot\\ Framework\\ Emulator.app</code> so it must be separated like have in the first block of code in my question."}, {"owner": {"reputation": 133, "user_id": 9362384, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Me5D7ndvXKM/AAAAAAAAAAI/AAAAAAAAADg/noEOiJQPv-E/photo.jpg?sz=128", "display_name": "Melody Anoni", "link": "https://stackoverflow.com/users/9362384/melody-anoni"}, "edited": false, "score": 0, "creation_date": 1563976121, "post_id": 57184075, "comment_id": 100879442, "body": "also edited my question to show the explicit error and did try again exactly what you input"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 133, "user_id": 9362384, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Me5D7ndvXKM/AAAAAAAAAAI/AAAAAAAAADg/noEOiJQPv-E/photo.jpg?sz=128", "display_name": "Melody Anoni", "link": "https://stackoverflow.com/users/9362384/melody-anoni"}, "edited": false, "score": 2, "creation_date": 1563977099, "post_id": 57184075, "comment_id": 100880114, "body": "No, it really doesn&#39;t. You need to separate <i>arguments</i>, completely regardless of the <i>spaces</i>. You have an argument which contains spaces; <i>in a shell</i>, you would have to enclose that argument in quotes or escape the spaces with backslashes. You aren&#39;t using a shell here though, so you need do neither."}, {"owner": {"reputation": 133, "user_id": 9362384, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Me5D7ndvXKM/AAAAAAAAAAI/AAAAAAAAADg/noEOiJQPv-E/photo.jpg?sz=128", "display_name": "Melody Anoni", "link": "https://stackoverflow.com/users/9362384/melody-anoni"}, "edited": false, "score": 0, "creation_date": 1563981193, "post_id": 57184075, "comment_id": 100882624, "body": "Sorry, I don&#39;t know what was going wrong. I tried it once more now and it worked. Thanks for your help"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1563978090, "last_edit_date": 1563978090, "creation_date": 1563974808, "answer_id": 57184075, "question_id": 57184022, "link": "https://stackoverflow.com/questions/57184022/how-to-execute-a-command-with-backslashes-in-go/57184075#57184075", "title": "How to execute a command with backslashes in go", "body": "<p>The backslashes you need in command line are to escape the spaces to prevent them from being treated as argument separators <em>by the shell</em>. Since there is no shell involved executing this way in Go, you don't need them. You can just:</p>\n\n<pre><code>exec.Command(`mdls`, `-name`, `kMDItemVersion`, `/Applications/Bot Framework Emulator.app`)\n</code></pre>\n"}], "owner": {"reputation": 133, "user_id": 9362384, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Me5D7ndvXKM/AAAAAAAAAAI/AAAAAAAAADg/noEOiJQPv-E/photo.jpg?sz=128", "display_name": "Melody Anoni", "link": "https://stackoverflow.com/users/9362384/melody-anoni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 324, "favorite_count": 0, "accepted_answer_id": 57184075, "answer_count": 1, "score": -2, "last_activity_date": 1586350246, "creation_date": 1563974617, "last_edit_date": 1563976094, "question_id": 57184022, "link": "https://stackoverflow.com/questions/57184022/how-to-execute-a-command-with-backslashes-in-go", "title": "How to execute a command with backslashes in go", "body": "<p>I want to return the output of an app version using go</p>\n\n<p>Why does the below fail?</p>\n\n<pre><code>emulatorCmd := exec.Command(`mdls`, `-name`, `kMDItemVersion`, `/Applications/Bot\\`, `Framework\\`, `Emulator.app`)\nemulatorVersion, err := emulatorCmd.Output()\nif err != nil {                      \n   log.Fatalf(\"cmd.Run() failed in emulator\", err)                       \n   fmt.Println(\"Looks like you don't have the Bot Emulator installed yet, download here: https://github.com/Microsoft/BotFramework-Emulator/releases/tag/v4.5.2\")\n} else {\n   fmt.Println(\"Emulator:\", string(emulatorVersion))\n\n}\n</code></pre>\n\n<p>Giving:</p>\n\n<pre><code>cmd.Run() failed in emulator%!(EXTRA *exec.ExitError=exit status 1)\n</code></pre>\n\n<p>But when I replace the command with an app that has no spaces in the name (thus, doesn't require backslashes) like </p>\n\n<pre><code>exec.Command(`mdls`, `-name`, `kMDItemVersion`, `/Applications/FaceTime.app`)\n</code></pre>\n\n<p>It's successful, giving:</p>\n\n<pre><code>Emulator: kMDItemVersion = \"5.0\"\n</code></pre>\n\n<p>I tried putting it all in one string, but spaces in the command need to be separated by a comma. Also tried using two '\\' backslashes and now even using back ticks does not work. </p>\n\n<p>Also looked at the go string literals page but didn't find something relevant to this problem:\n<a href=\"https://golang.org/ref/spec#raw_string_lit\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#raw_string_lit</a></p>\n"}, {"tags": ["api", "go", "video"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1563976699, "post_id": 57183682, "comment_id": 100879834, "body": "1) No, <code>Output</code> <a href=\"https://github.com/nytimes/encoding-wrapper/blob/f85273aef92827e577651a10d53f567f5b16e8e4/encodingcom/client.go#L155\" rel=\"nofollow noreferrer\">is there</a>; 2) The &quot;aac&quot; extension looks a bit odd; since you have two codecs listed (both A fnd V), I&#39;d expect the extension to indicate container format (like <code>mp4</code> or <code>avi</code> or <code>mkv</code>)."}, {"owner": {"reputation": 1100, "user_id": 1584736, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/7b8c4392528b20b47726142f7a20c7cd?s=128&d=identicon&r=PG", "display_name": "ngw", "link": "https://stackoverflow.com/users/1584736/ngw"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1563977113, "post_id": 57183682, "comment_id": 100880125, "body": "edited with new format. The old one was basically cut and paste from the tests"}, {"owner": {"reputation": 1100, "user_id": 1584736, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/7b8c4392528b20b47726142f7a20c7cd?s=128&d=identicon&r=PG", "display_name": "ngw", "link": "https://stackoverflow.com/users/1584736/ngw"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1563980062, "post_id": 57183682, "comment_id": 100881960, "body": "And output is there but it looks like it doesn&#39;t contain the path of the file"}], "owner": {"reputation": 1100, "user_id": 1584736, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/7b8c4392528b20b47726142f7a20c7cd?s=128&d=identicon&r=PG", "display_name": "ngw", "link": "https://stackoverflow.com/users/1584736/ngw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 37, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563977083, "creation_date": 1563973528, "last_edit_date": 1563977083, "question_id": 57183682, "link": "https://stackoverflow.com/questions/57183682/using-encoding-com-golang-wrapper", "title": "Using encoding.com golang wrapper", "body": "<p>I'm rather new to both golang and encoding.com and I'm trying to use <a href=\"https://github.com/nytimes/encoding-wrapper\" rel=\"nofollow noreferrer\">the encoding.com API wrapper</a> to transcode a simple video file, but I'm rather confused by the format to use.</p>\n\n<p>When looking at the tests I can see how to call the <code>AddMedia</code> function (<a href=\"https://github.com/nytimes/encoding-wrapper/blob/master/encodingcom/media_test.go#L9-L39\" rel=\"nofollow noreferrer\">https://github.com/nytimes/encoding-wrapper/blob/master/encodingcom/media_test.go#L9-L39</a>) but unfortunately it doesn't work for me.</p>\n\n<pre><code>package main\n\nimport (\"github.com/NYTimes/encoding-wrapper/encodingcom\")\n\nfunc main() {\n  client, err := encodingcom.NewClient(\"https://manage.encoding.com\", \"123\", \"key\")\n\n  format := encodingcom.Format{\n      Output:       []string{\"https://key:secret@bucket.s3.amazonaws.com/aladin.ogg\"},\n      VideoCodec:   \"libtheora\",\n      AudioCodec:   \"libvorbis\",\n      Bitrate:      \"400k\",\n      AudioBitrate: \"64k\",     \n  }\n\n  addMediaResponse, err := client.AddMedia([]string{\"https://samples.mplayerhq.hu/h264/Aladin.mpg\"},\n        []encodingcom.Format{format}, \"us-east-1\")\n  }\n}\n</code></pre>\n\n<p>The error \"raised\" is</p>\n\n<pre><code>APIError.Errors.Errors0: Output format 'https://key:secret@bucket.s3.amazonaws.com/aladin.aac' is not allowed! (format #0)\nAPIError.Message:\n</code></pre>\n\n<p>and I really don't get it, the <code>Output</code> element in the Format looks missplaced, am I reading the test wrong? Using the API builder the format parameter should receive only the format, for example \"ogg\", and there's a \"destination\" parameter for S3. It also doesn't specify if the url must be urlencoded, but honestly I don't think so. Still keys and secrets can contain for example the char '/'</p>\n\n<p>Any more experienced gopher?</p>\n"}, {"tags": ["http", "go", "proxy", "fileserver"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 2895708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06f1992c1a0a9fa79aa4a0547fe0a72a?s=128&d=identicon&r=PG&f=1", "display_name": "i cant code", "link": "https://stackoverflow.com/users/2895708/i-cant-code"}, "edited": false, "score": 0, "creation_date": 1563982108, "post_id": 57185809, "comment_id": 100883115, "body": "Oh... Okay. As for the issue of deleting temporary files I was thinking on wrapping the file into a readcloser interface which deletes files after closing."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 3, "user_id": 2895708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06f1992c1a0a9fa79aa4a0547fe0a72a?s=128&d=identicon&r=PG&f=1", "display_name": "i cant code", "link": "https://stackoverflow.com/users/2895708/i-cant-code"}, "edited": false, "score": 0, "creation_date": 1563983820, "post_id": 57185809, "comment_id": 100884054, "body": "I would suggest to change DecryptFileFromReader to take an io.Writer instead of a filename, then you don&#39;t need a temporary file at all. That&#39;s a different question though. If you decide to ask it, make sure to include the gist of DecryptFileFromReader in the question."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 0, "last_activity_date": 1563980103, "creation_date": 1563980103, "answer_id": 57185809, "question_id": 57183532, "link": "https://stackoverflow.com/questions/57183532/reverse-proxy-serve-file-after-it-has-been-decrypted/57185809#57185809", "title": "reverse proxy serve file after it has been decrypted", "body": "<p>The response body is an io.ReadCloser, so it is reasonable to assume that the reverse proxy calls Close. And indeed it does, as you can see by running the following program:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"net/http\"\n    \"net/http/httptest\"\n    \"net/http/httputil\"\n    \"net/url\"\n    \"runtime/debug\"\n)\n\ntype dbg struct{ io.ReadCloser }\n\nfunc (d dbg) Close() error {\n    fmt.Println(\"Close() called:\")\n    debug.PrintStack()\n\n    return d.ReadCloser.Close()\n}\n\nfunc main() {\n    // srv simulates \"software B\"\n    srv := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.Write([]byte(\"Hello, world\"))\n    }))\n\n    target, _ := url.Parse(srv.URL)\n    p := httputil.NewSingleHostReverseProxy(target)\n\n    // To modify the response, use the aptly named ModifyResponse field; no\n    // need to implement a RoundTripper.\n    p.ModifyResponse = func(res *http.Response) error {\n        res.Body = dbg{res.Body}\n        return nil\n    }\n\n    req := httptest.NewRequest(\"GET\", \"http://example.com/hello\", nil)\n    rec := httptest.NewRecorder()\n\n    p.ServeHTTP(rec, req)\n}\n\n// Output:\n// Close() called:\n// goroutine 1 [running]:\n// runtime/debug.Stack(0x10, 0x0, 0x0)\n//         /usr/local/go/src/runtime/debug/stack.go:24 +0x9d\n// runtime/debug.PrintStack()\n//         /usr/local/go/src/runtime/debug/stack.go:16 +0x22\n// main.dbg.Close(0x75b780, 0xc00013e140, 0xc000152000, 0x7f61fc523088)\n//         /tmp/tmp.H9O7cizbkv/main.go:17 +0x7f\n// net/http/httputil.(*ReverseProxy).ServeHTTP(0xc0000ac0f0, 0x75e460, 0xc000032440, 0xc00010a000)\n//         /usr/local/go/src/net/http/httputil/reverseproxy.go:311 +0x8a6\n// main.main()\n//         /tmp/tmp.H9O7cizbkv/main.go:41 +0x152\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 2895708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06f1992c1a0a9fa79aa4a0547fe0a72a?s=128&d=identicon&r=PG&f=1", "display_name": "i cant code", "link": "https://stackoverflow.com/users/2895708/i-cant-code"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "accepted_answer_id": 57185809, "answer_count": 1, "score": 0, "last_activity_date": 1563980103, "creation_date": 1563973053, "question_id": 57183532, "link": "https://stackoverflow.com/questions/57183532/reverse-proxy-serve-file-after-it-has-been-decrypted", "title": "reverse proxy serve file after it has been decrypted", "body": "<p>I need to put an *os.File into the request.Body but I don't know how to handle the closure of the file descriptor (and the elimination of the temporary file). I cannot use http.ServeFile to serve the file. </p>\n\n<p>I have 3 softwares:\nA) User interface ( that I cannot edit )\nB) Backend which serves files\nC) An http reverse proxy whose role is to sign the requests coming from  A going to B, to encrypt files going from A to B, and decrypto files going from B to A.</p>\n\n<p>The software A is expected to receive the body of the decrypted file content. I know it would be easier just to decrypt the file in a directory using B and then have A open it, but unfortunately I cannot edit A which expects the file in the request body.</p>\n\n<p>the work flow of the softwares is the following: software A sends a request to C which signs the request and forwards it to B, then C proceeds to decrypt the file and has to serve the decrypted content to A in a the request body.</p>\n\n<pre><code>type transportPageServeFile struct {\n    http.RoundTripper\n    // vault handles encryption and decryption of files\n    vault *vault.Container\n}\n\nfunc (t *transportPageServeFile) RoundTrip(req *http.Request) (resp *http.Response, err error) {\n    resp, err = t.RoundTripper.RoundTrip(req)\n    if err != nil {\n        return nil, errors.Wrap(err, \"transportPageServeFile\")\n    }\n    // create temporary destination dir for the decrypted file\n    dstDir, err := utils.MkTmpDir()\n    if err != nil {\n        return nil, errors.Wrap(err, \"transportPageServeFile\")\n    }\n    defer os.RemoveAll(dstDir) // i'm deleting the directory where the temporary file is stored, deleting it before it even gets transmitted to software A\n    fileName := req.Header.Get(api.FileNameHeader)\n    decryptedFileDst := fmt.Sprintf(\"%s/%s\", dstDir, fileName)\n    // DecryptFileFromReader takes a reader and decrypts the file, saving it in the decided destination\n    err = t.vault.DecryptFileFromReader(resp.Body, decryptedFileDst)\n    if err != nil {\n        return nil, errors.Wrap(err, \"transportPageServeFile\")\n    }\n    defer resp.Body.Close()\n    // now open the saved decrypted file\n    decryptedFile, err := os.Open(decryptedFileDst)\n    if err != nil {\n        return nil, errors.Wrap(err,\"transportPageServeFile\")\n    }\n    defer decryptedFile.Close() // close file before serving the content?\n    resp.Body = decryptedFile\n    return resp, nil\n}\n// pageServeFile is the handler of /serveFile\nfunc (rpc *RPC) pageServeFile(c *gin.Context) {\n    transport := &amp;transportPageServeFile{RoundTripper:http.DefaultTransport, vault:rpc.vault}\n    target, err := url.Parse(rpc.apiEndpoint)\n    if err != nil {\n        rpc.onError(c, errors.Wrapf(err, \"pageServeFile\"))\n        return\n    }\n    proxy := httputil.NewSingleHostReverseProxy(target)\n    proxy.Transport = transport\n    proxy.ServeHTTP(c.Writer, c.Request)\n}\n</code></pre>\n\n<p>How do I copy the file in the request body (using a reader) and when/how do I close the file descriptor once the response is forwarded?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1563972370, "post_id": 57183183, "comment_id": 100877279, "body": "If you are asking whether there&#39;s a function in the standard library that parses your particular format then no, there is not."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563978944, "post_id": 57183183, "comment_id": 100881297, "body": "Whether your string is decryptable depends on the format that EncryptText uses. We don&#39;t know what that format is. Where did you get that function? You need to ask the author of that function."}], "answers": [{"tags": [], "owner": {"reputation": 151, "user_id": 10531220, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xUChwkOk7Ps/AAAAAAAAAAI/AAAAAAAAAAA/ABtNlbB5PVdVy6F4f526BZTUAHLAhogbLQ/mo/photo.jpg?sz=128", "display_name": "WiththeWind", "link": "https://stackoverflow.com/users/10531220/withthewind"}, "is_accepted": false, "score": 0, "last_activity_date": 1563979731, "creation_date": 1563979731, "answer_id": 57185684, "question_id": 57183183, "link": "https://stackoverflow.com/questions/57183183/decrypt-string-with-variable-in-go/57185684#57185684", "title": "Decrypt String with variable in Go", "body": "<p>As stated there are not any functions in the standard library to parse your format. It seems that you use semicolons and colons as a delimiter for this format. With that in mind we can create custom code to parse through it.</p>\n\n<pre><code>splitString = strings.Split(str, \";\")\n\nexample.Login = GetLastIndex(splitString[0])\nexample.Email = GetLastIndex(splitString[1])\nexample.Age = GetLastIndex(splitString[2])\n\nfunc GetLastIndex(str string) string {\n    return str[strings.LastIndex(str, \":\")+1:]\n}\n</code></pre>\n\n<p>Playground example: <a href=\"https://play.golang.org/p/UTrazkQ5EI-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/UTrazkQ5EI-</a></p>\n"}], "owner": {"reputation": 1, "user_id": 11830282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d16bd8c51b88b5051f5aeec62c4ea90?s=128&d=identicon&r=PG&f=1", "display_name": "Go09", "link": "https://stackoverflow.com/users/11830282/go09"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 93, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1563979731, "creation_date": 1563971981, "last_edit_date": 1563978961, "question_id": 57183183, "link": "https://stackoverflow.com/questions/57183183/decrypt-string-with-variable-in-go", "title": "Decrypt String with variable in Go", "body": "<p>I am trying to decrypt a string that contains the variables of my structure.\nI want my variables in my string to be replaced by the correct value after decryption.</p>\n\n<p>My result is that I get the string with the variables and not replaced by their value.</p>\n\n<p>How to do that ?</p>\n\n<p>Here is my code.</p>\n\n<pre><code>type (\nTest struct {\n    Login   string `form:\"login\"`\n    Email string `form:\"email\"`\n    Age  string `form:\"age\"`\n})\n</code></pre>\n\n<p>Inside my function</p>\n\n<pre><code>tst:= Test{}\ntextToEncrypt := \n\"login:tst.Login;email:tst.Email;timestampunix:1563804616\"\ntextEncrypted := service.EncryptText(textToEncrypt, keysToEncrypt)\n</code></pre>\n\n<p>After he encrypt, I have an encrypt string, until here it's OK.</p>\n\n<p>When I call my Decrypt Function, he return the string like above , but I want the value of the variable inside the string, the value of the variable struct?</p>\n\n<p>It's possible?</p>\n"}, {"tags": ["go", "gitlab", "go-modules"], "answers": [{"tags": [], "owner": {"reputation": 107, "user_id": 9046942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b5eea38564140c63551de5b568944ce?s=128&d=identicon&r=PG&f=1", "display_name": "Roger Coll", "link": "https://stackoverflow.com/users/9046942/roger-coll"}, "is_accepted": false, "score": 0, "last_activity_date": 1564065638, "creation_date": 1564065638, "answer_id": 57204620, "question_id": 57182988, "link": "https://stackoverflow.com/questions/57182988/gitlab-ci-and-go-modules/57204620#57204620", "title": "Gitlab CI and Go modules", "body": "<p>Be sure you upload the last go.sum file. Just before uploading to master for the ci execution run <code>go get</code>, upload to master and run the ci. </p>\n"}, {"tags": [], "owner": {"reputation": 2653, "user_id": 11210494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f24d82ad87e7e92592ede8c31c52748e?s=128&d=identicon&r=PG&f=1", "display_name": "typical182", "link": "https://stackoverflow.com/users/11210494/typical182"}, "is_accepted": false, "score": 0, "last_activity_date": 1564769775, "creation_date": 1564769775, "answer_id": 57331637, "question_id": 57182988, "link": "https://stackoverflow.com/questions/57182988/gitlab-ci-and-go-modules/57331637#57331637", "title": "Gitlab CI and Go modules", "body": "<p>The primary error seems to be:</p>\n\n<pre><code>go: google.golang.org/appengine@v1.6.1: unrecognized import path\n \"google.golang.org/appengine\" (parse \n https://google.golang.org/appengine?go-get=1: no go-import meta tags ())\n</code></pre>\n\n<p>I would try running <code>go get -v google.golang.org/appengine</code> and <code>curl -v https://google.golang.org/appengine?go-get=1</code> from within your CI environment to see what they show. </p>\n\n<p>This is what I get for <code>go get -v google.golang.org/appengine</code>:</p>\n\n<pre><code>$ go get -v google.golang.org/appengine\nFetching https://google.golang.org/appengine?go-get=1\nParsing meta tags from https://google.golang.org/appengine?go-get=1 (status code 200)\nget \"google.golang.org/appengine\": found meta tag\n get.metaImport{Prefix:\"google.golang.org/appengine\",\n VCS:\"git\", RepoRoot:\"https://github.com/golang/appengine\"}\n at https://google.golang.org/appengine?go-get=1\n</code></pre>\n\n<p>Perhaps you have some network connectivity, firewall, or HTTP proxy issue.</p>\n"}, {"tags": [], "owner": {"reputation": 841, "user_id": 5505164, "user_type": "registered", "profile_image": "https://graph.facebook.com/1483647971940832/picture?type=large", "display_name": "Roman Shishkin", "link": "https://stackoverflow.com/users/5505164/roman-shishkin"}, "is_accepted": false, "score": 0, "last_activity_date": 1581591074, "creation_date": 1581591074, "answer_id": 60206088, "question_id": 57182988, "link": "https://stackoverflow.com/questions/57182988/gitlab-ci-and-go-modules/60206088#60206088", "title": "Gitlab CI and Go modules", "body": "<p>You should download modules before compilation. Assuming your project already has go modules files <code>go.mod</code> and <code>go.sum</code> try to update <code>.gitlab-ci.yml</code> this way</p>\n\n<pre><code>build:\n  stage: compile\n  image: golang:1.13\n  script:\n    - go get -d -v\n    - go build -o binary\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 11830325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90a2c705eda24b593b7e10133034bfdd?s=128&d=identicon&r=PG&f=1", "display_name": "Alsopa", "link": "https://stackoverflow.com/users/11830325/alsopa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1643, "favorite_count": 1, "answer_count": 3, "score": 1, "last_activity_date": 1581591074, "creation_date": 1563971367, "last_edit_date": 1563971865, "question_id": 57182988, "link": "https://stackoverflow.com/questions/57182988/gitlab-ci-and-go-modules", "title": "Gitlab CI and Go modules", "body": "<p>I have a Go project and I want write a Gitlab CI file my project but I see error loading module requirements. This is my gitlab CI file:</p>\n\n<pre><code>stages:\n  - compile\nbuild:\n  stage: compile\n  image: golang:1.12\n  script:\n    - go build -o binary\n</code></pre>\n\n<pre><code>error :\nRunning with gitlab-runner 11.8.0 (4745a6f3)\n  on Runner #6 e0e0c446\nUsing Docker executor with image golang:1.12 ...\nPulling docker image golang:1.12 ...\nUsing docker image sha256:be63d15101cb68aea1841b45201b08a1a486c1a60a029bbf0ddb284ab646b0b7 for golang:1.12 ...\nRunning on runner-e0e0c446-project-753-concurrent-0 via runner-01.tool.afra.snapp.infra...\nCloning repository...\nCloning into '/builds/Alsopa/echo-training'...\nChecking out ab3994cc as develop...\nSkipping Git submodules setup\n$ go build -o binary\ngo: finding github.com/labstack/gommon v0.2.9\ngo: finding github.com/labstack/echo v3.3.10+incompatible\ngo: finding github.com/go-sql-driver/mysql v1.4.1\ngo: google.golang.org/appengine@v1.6.1: unrecognized import path \"google.golang.org/appengine\" (parse https://google.golang.org/appengine?go-get=1: no go-import meta tags ())\ngo: error loading module requirements\nERROR: Job failed: exit code 1\n</code></pre>\n"}, {"tags": ["file", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1563969272, "post_id": 57182105, "comment_id": 100875415, "body": "<code>Read</code> returns how many bytes have been read and thats your position. Could you state your problem clearer?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1563970057, "post_id": 57182105, "comment_id": 100875848, "body": "You should track the position by incrementing the <code>content_size</code> variable. Alternatively you could use <code>Seek(0, 1)</code> to get the current offset."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1563971039, "creation_date": 1563971039, "answer_id": 57182871, "question_id": 57182105, "link": "https://stackoverflow.com/questions/57182105/how-to-get-current-position-of-file/57182871#57182871", "title": "How to get current position of file", "body": "<p>The function <a href=\"https://godoc.org/os#File.Seek\" rel=\"nofollow noreferrer\">File.Seek</a> returns the resulting offset in the file. To get the current offset, seek zero bytes from the current position:</p>\n\n<pre><code> offset, err := f.Seek(0, os.SEEK_CUR)\n</code></pre>\n"}], "owner": {"reputation": 2740, "user_id": 5155835, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/3d51608584fba7f32d1dc74d120b89ef?s=128&d=identicon&r=PG&f=1", "display_name": "user5155835", "link": "https://stackoverflow.com/users/5155835/user5155835"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 450, "favorite_count": 0, "closed_date": 1563971178, "accepted_answer_id": 57182871, "answer_count": 1, "score": 1, "last_activity_date": 1563971039, "creation_date": 1563968564, "last_edit_date": 1563970409, "question_id": 57182105, "link": "https://stackoverflow.com/questions/57182105/how-to-get-current-position-of-file", "closed_reason": "Duplicate", "title": "How to get current position of file", "body": "<p>I'm reading a file part by part and want to print the File Position (Byte Position). Example code snippet:</p>\n\n<pre><code>inFile *os.File\ninFile, err := os.Open(myfile)\nsize := make([]byte, some_size)\ncontent_size, err := inFile.Read(size)\n</code></pre>\n\n<p>Now this is done in a loop with various buffer sizes. So do I have to maintain a variable where I'll add up the content size obtained as return data from Read? </p>\n\n<p>Instead, can I get the position (Bytes) of the file pointer after all the Read operations are done? How can I get this current position of the file?</p>\n"}, {"tags": ["go", "go-cobra"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1563967153, "post_id": 57181589, "comment_id": 100874250, "body": "At <code>init</code>-time no flag parsing has happened jet."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563973914, "post_id": 57183092, "comment_id": 100878185, "body": "It does not execute at compile time. Nothing executes at compile time. It executes at runtime, but before <code>main</code> executes. <a href=\"https://golang.org/ref/spec#Program_initialization_and_execution\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Program_initialization_and_execution</a>"}], "tags": [], "owner": {"reputation": 1161, "user_id": 6013663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4a7b2e785ad782e5103fd679b9ec849?s=128&d=identicon&r=PG", "display_name": "Masudur Rahman", "link": "https://stackoverflow.com/users/6013663/masudur-rahman"}, "is_accepted": true, "score": -1, "last_activity_date": 1563981936, "last_edit_date": 1563981936, "creation_date": 1563971714, "answer_id": 57183092, "question_id": 57181589, "link": "https://stackoverflow.com/questions/57181589/failed-to-get-flag-value/57183092#57183092", "title": "Failed to get flag value", "body": "<p>You can't print the value of token in <code>init()</code> function as the <code>init()</code> function executes in run time when the package is called for the first time. The value is not yet assigned. </p>\n\n<p>So, you have to declare the variable globally and use it in the <code>Run</code> method of the <code>rootCmd</code> command.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var token string\n\nvar rootCmd = &amp;cobra.Command{\n    Use:    \"consoleplay\",\n    Run: func(cmd *cobra.Command, args []string) {\n        fmt.Println(token)\n    },\n}\n\nfunc init() {\n    rootCmd.Flags().StringVarP(&amp;token, \"token\", \"t\", \"\", \"usage\")\n}\n</code></pre>\n"}], "owner": {"reputation": 6454, "user_id": 2153777, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/L67zf.jpg?s=128&g=1", "display_name": "E235", "link": "https://stackoverflow.com/users/2153777/e235"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 942, "favorite_count": 0, "accepted_answer_id": 57183092, "answer_count": 1, "score": -4, "last_activity_date": 1563981936, "creation_date": 1563966820, "question_id": 57181589, "link": "https://stackoverflow.com/questions/57181589/failed-to-get-flag-value", "title": "Failed to get flag value", "body": "<p>I created a small Go application with the <a href=\"https://github.com/spf13/cobra\" rel=\"nofollow noreferrer\">https://github.com/spf13/cobra</a> library.  </p>\n\n<p>I created a new flag, <code>-t</code> or <code>--token</code>, and when I pass this argument I want the application to print it.  </p>\n\n<p>This is what I did:  </p>\n\n<pre><code>func init() {\n    fmt.Println(\"[*] Inside init()\")\n    var token string\n    rootCmd.PersistentFlags().StringVarP(&amp;token, \"token\", \"t\", \"\", \"Service account Token (JWT) to insert\")\n    fmt.Println(token)\n}  \n</code></pre>\n\n<p>But it doesn't print it when I run the application like that:  </p>\n\n<pre><code>.\\consoleplay.exe --token \"hello.token\"  \n</code></pre>\n\n<p>How can I print the value of the flags.  </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563971683, "post_id": 57180659, "comment_id": 100876830, "body": "See <a href=\"https://stackoverflow.com/questions/57023943/update-array-elements-if-the-array-in-passed-as-val-and-then-converted-to-inter#answer-57024131\" title=\"update array elements if the array in passed as val and then converted to inter%23answer 57024131\">stackoverflow.com/questions/57023943/&hellip;</a> for a generic function that decodes a mongo cursor to a slice of any type."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 11829553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c8c9e4e34aef11ee249bbf9febfdab5?s=128&d=identicon&r=PG&f=1", "display_name": "GoOrNotToGo", "link": "https://stackoverflow.com/users/11829553/goornottogo"}, "edited": false, "score": 0, "creation_date": 1564046323, "post_id": 57181389, "comment_id": 100905231, "body": "Thanks! <code>v := reflect.New(reflect.TypeOf(model)).Interface()</code> was exactly what i was missing. Was trying different ways of simple assignment like <code>tmp := model</code>.  Still can&#39;t get it working though. When looping through result type assertion doesn&#39;t work: <code>if time, ok := v.(store.Time); ok {</code> is false.  I guess I will switch to cursor implementation and return a cursor instead of result array. This way no &quot;reflect&quot; is needed at all"}, {"owner": {"reputation": 3, "user_id": 11829553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c8c9e4e34aef11ee249bbf9febfdab5?s=128&d=identicon&r=PG&f=1", "display_name": "GoOrNotToGo", "link": "https://stackoverflow.com/users/11829553/goornottogo"}, "edited": false, "score": 0, "creation_date": 1564047261, "post_id": 57181389, "comment_id": 100905727, "body": "Figured out that return array is a list of pointers, so correct type assert should look: <code>if time, ok := v.(*store.Time); ok {</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 3, "user_id": 11829553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c8c9e4e34aef11ee249bbf9febfdab5?s=128&d=identicon&r=PG&f=1", "display_name": "GoOrNotToGo", "link": "https://stackoverflow.com/users/11829553/goornottogo"}, "edited": false, "score": 0, "creation_date": 1564048236, "post_id": 57181389, "comment_id": 100906274, "body": "Did you pass in a pointer to <code>Search</code> or a non-pointer? Before appending to result did you call the <code>Elem</code> method on <code>reflect.ValueOf(v)</code> or not?"}, {"owner": {"reputation": 3, "user_id": 11829553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c8c9e4e34aef11ee249bbf9febfdab5?s=128&d=identicon&r=PG&f=1", "display_name": "GoOrNotToGo", "link": "https://stackoverflow.com/users/11829553/goornottogo"}, "edited": false, "score": 0, "creation_date": 1564051375, "post_id": 57181389, "comment_id": 100908103, "body": "Passing a pointer.   Before appending calling <code>reflect.ValueOf(v).Elem().Interface()</code>. Full code: <code>v := reflect.New(reflect.TypeOf(model)).Interface() \t\tif err := cursor.Decode(v); err != nil { \t\t\tlog.Fatal(err) \t\t} \t\tmodelDeref := reflect.ValueOf(v).Elem().Interface() \t\tresult = append(result, modelDeref)</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 3, "user_id": 11829553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c8c9e4e34aef11ee249bbf9febfdab5?s=128&d=identicon&r=PG&f=1", "display_name": "GoOrNotToGo", "link": "https://stackoverflow.com/users/11829553/goornottogo"}, "edited": false, "score": 0, "creation_date": 1564051559, "post_id": 57181389, "comment_id": 100908204, "body": "that&#39;s the problem then, reflect.New returns a pointer to a value of the given type, which if it is a pointer already, will result in a pointer to a pointer. You don&#39;t need to pass in a pointer, but if you want to then you should call <code>reflect.New(reflect.TypeOf(model).Elem()).Interface()</code>."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 0, "last_activity_date": 1563966486, "last_edit_date": 1563966486, "creation_date": 1563966162, "answer_id": 57181389, "question_id": 57180659, "link": "https://stackoverflow.com/questions/57180659/go-empty-interface-type-assertion-and-creating-a-copy/57181389#57181389", "title": "Go empty interface type assertion and creating a copy", "body": "<p>You're decoding into the same pointer, so you'll always end up with a slice containing elements whose value is the same as the one you decoded last.</p>\n\n<p>You should instead, on each iteration, initialize a new instance of the model's type and then decode into that.</p>\n\n<pre><code>result, _ := mongodb.Search(store.Time{}, ...) // pass in non-pointer type to make life easier\n\n// ...\n\nfunc Search(model interface{}, filter interface{}) (result ModelCollection, err error) {\n    collection := Database.Collection(resolveCollectionName(model))\n\n    var cursor *mongo.Cursor\n    cursor, err = collection.Find(Context, filter)\n    if err != nil {\n        log.Fatal(err)\n    } \n\n    for cursor.Next(Context) {\n        v := reflect.New(reflect.TypeOf(model)).Interface() // get a new pointer instance\n        if err := cursor.Decode(v); err != nil { // decode\n            log.Fatal(err)\n        }\n\n        md := reflect.ValueOf(v).Elem().Interface()\n        result = append(result, md) // append non-pointer value\n    }\n\n    return\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 11829553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c8c9e4e34aef11ee249bbf9febfdab5?s=128&d=identicon&r=PG&f=1", "display_name": "GoOrNotToGo", "link": "https://stackoverflow.com/users/11829553/goornottogo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 299, "favorite_count": 0, "accepted_answer_id": 57181389, "answer_count": 1, "score": 0, "last_activity_date": 1563968991, "creation_date": 1563963803, "last_edit_date": 1563968991, "question_id": 57180659, "link": "https://stackoverflow.com/questions/57180659/go-empty-interface-type-assertion-and-creating-a-copy", "title": "Go empty interface type assertion and creating a copy", "body": "<p>Can't figure out how to modify a struct type variable passed as pointer to a function that takes in an empty interface</p>\n\n<p>I am creating a kind of library that works with MongoDB database through official go driver. I am passing a struct pointer which then gets filled with data from database (MongoDB <code>cursor.Decode</code>). This works fine for a single document, but when I try to return an array of documents, only the parent documents are correct, but children(embedded) stay same for all the elements in array (probably store reference and not the actual value).</p>\n\n<p>Actual code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// passing model pointer to search function\nresult, _ := mongodb.Search(&amp;store.Time{}, \n                mongodb.D{mongodb.E(\"transdate\", \n                    mongodb.D{mongodb.E(\"$gte\", timeSearch.DateFrom), mongodb.E(\"$lte\", timeSearch.DateTo)})})\n\n...\nfunc Search(model interface{}, filter interface{}) (result ModelCollection, err error) {\n    collection := Database.Collection(resolveCollectionName(model))\n\n    var cursor *mongo.Cursor\n    cursor, err = collection.Find(Context, filter)\n    if err != nil {\n        log.Fatal(err)\n    } \n\n    for cursor.Next(Context) {\n        if err := cursor.Decode(model); err != nil {\n            log.Fatal(err)\n        }\n        modelDeref := reflect.ValueOf(model).Elem().Interface()\n        result = append(result, modelDeref)\n    }\n\n    return\n}\n</code></pre>\n\n<p>Here is the closest playground example I could come up with. I replaced MongoDB <code>cursor.Decode()</code> with my own Decoding function, but this doesn't even update parent properties. Children stay same though</p>\n\n<p><a href=\"https://play.golang.org/p/lswJJY0yl80\" rel=\"nofollow noreferrer\">https://play.golang.org/p/lswJJY0yl80</a></p>\n\n<p>Expected: </p>\n\n<blockquote>\n  <p>result:[{A:1 Children:[{B:11}]} {A:2 Children:[{B:22}]}]</p>\n</blockquote>\n\n<p>Actual: </p>\n\n<blockquote>\n  <p>result:[{A:init Children:[{B:22}]} {A:init Children:[{B:22}]}]</p>\n</blockquote>\n"}, {"tags": ["mongodb", "go", "mongodb-query", "mongo-go"], "comments": [{"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1564714438, "post_id": 57179869, "comment_id": 101129612, "body": "Hi, you could check the values before constructing the <code>bson.D</code>, and pass the correct <code>bson.D</code> into <code>Find</code>."}, {"owner": {"reputation": 60, "user_id": 9714875, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PpLWv.png?s=128&g=1", "display_name": "fperson", "link": "https://stackoverflow.com/users/9714875/fperson"}, "reply_to_user": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1564721834, "post_id": 57179869, "comment_id": 101131042, "body": "@WanBachtiar, Hi, that day I ended up writing 43 lines if-else if-else statement (which is really bad and ugly code). can i do something like <a href=\"https://stackoverflow.com/a/31996372/9714875\">this</a>"}, {"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1564967335, "post_id": 57179869, "comment_id": 101190320, "body": "Yes, you can just build the struct as needed. This is better than sending empty values query predicates to the database."}], "owner": {"reputation": 60, "user_id": 9714875, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PpLWv.png?s=128&g=1", "display_name": "fperson", "link": "https://stackoverflow.com/users/9714875/fperson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 96, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563961289, "creation_date": 1563961289, "question_id": 57179869, "link": "https://stackoverflow.com/questions/57179869/how-to-check-in-a-mongodb-query-if-a-variable-from-driver-is-equal-to-something", "title": "How to check in a MongoDB query if a variable from driver is equal to something", "body": "<p>I'm writing a rest api in golang which uses MongoDB. I get some parameters (query, type, tags) from my endpoint url query. Sometimes <i>type</i> and <i>tags</i> are empty (e.g. they are optional). Right now here is my query:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    cursor, err := collection.Find(ctx, bson.D{\n        {\"type\", eventType},\n        {\"tags\", bson.D{{\"$in\", tags}}},\n        {\"$or\",\n            bson.A{\n                bson.D{{\"title\", primitive.Regex{Pattern: \".*\" + query + \".*\", Options: \"i\"}}},\n                bson.D{{\"description\", primitive.Regex{Pattern: \".*\" + query + \".*\", Options: \"i\"}}},\n            }},\n    })\n</code></pre>\n\n<p>I want to have something like if-condition inside of the query or have an $or query operator which checks if a variable is empty. Something like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    cursor, err := collection.Find(ctx, bson.D{\n        {\"$or\", bson.D{{\"type\", eventType}, eventType==\"\"}},\n        {\"$or\", bson.D{{\"tags\", bson.D{{\"$in\", tags}}}, tags==[]}},\n        {\"$or\",\n            bson.A{\n                bson.D{{\"title\", primitive.Regex{Pattern: \".*\" + query + \".*\", Options: \"i\"}}},\n                bson.D{{\"description\", primitive.Regex{Pattern: \".*\" + query + \".*\", Options: \"i\"}}},\n            }},\n    })\n</code></pre>\n\n<p>And my variables are extracted this way:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    vars := request.URL.Query()\n    query := vars.Get(\"q\")\n    eventType := vars.Get(\"type\")\n    tags := strings.Split(vars.Get(\"tags\"), \",\")\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1650, "user_id": 4399634, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001746244457/picture?type=large", "display_name": "frankegoesdown", "link": "https://stackoverflow.com/users/4399634/frankegoesdown"}, "edited": false, "score": 0, "creation_date": 1563961343, "post_id": 57179858, "comment_id": 100870901, "body": "<a href=\"https://golang.org/pkg/testing/#T.SkipNow\" rel=\"nofollow noreferrer\">golang.org/pkg/testing/#T.SkipNow</a>"}, {"owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "reply_to_user": {"reputation": 1650, "user_id": 4399634, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001746244457/picture?type=large", "display_name": "frankegoesdown", "link": "https://stackoverflow.com/users/4399634/frankegoesdown"}, "edited": false, "score": 0, "creation_date": 1563961858, "post_id": 57179858, "comment_id": 100871182, "body": "@frankegoesdown 3q, but it&#39;s inaccessible\u2026\u2026"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1563964514, "post_id": 57179858, "comment_id": 100872770, "body": "How about build tags? Anyway: Your requirement looks fishy."}], "answers": [{"tags": [], "owner": {"reputation": 2788, "user_id": 989991, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/x05ME.png?s=128&g=1", "display_name": "joakim", "link": "https://stackoverflow.com/users/989991/joakim"}, "is_accepted": false, "score": 0, "last_activity_date": 1564002391, "creation_date": 1564002391, "answer_id": 57191262, "question_id": 57179858, "link": "https://stackoverflow.com/questions/57179858/how-to-test-ignoring-some-test-files-in-golang/57191262#57191262", "title": "How to test ignoring some test files in golang?", "body": "<p>You can use the <code>run</code> flag to pass a regex/pattern ala:</p>\n\n<p><code>go test -run YourRegex</code></p>\n"}], "owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1564002391, "creation_date": 1563961241, "question_id": 57179858, "link": "https://stackoverflow.com/questions/57179858/how-to-test-ignoring-some-test-files-in-golang", "title": "How to test ignoring some test files in golang?", "body": "<p>I used to use <code>go test ./...</code> in CI. This will test all <code>xxx_test.go</code> files. But now I want this testcase to ignore some test files in a folder which is ended with <code>-TestClient</code>. What to do?</p>\n\n<p>For example:</p>\n\n<pre><code>XFolderTestClient\n    | -- xxx_test.go                    x\n    | -- xxx2_test.go                   x\n\n\nAnotherFolder\n    | -- yyy.go                         \u221a\n...\n</code></pre>\n\n<p>I only want to ignore test files in folders  ending with TestClient.</p>\n\n<p>3Q~</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1563963361, "post_id": 57179731, "comment_id": 100872060, "body": "No, this is not normally possible in Go. Technically, you could do something similar using reflection, but that will make your code slow and hard to read. Please avoid reflection at all costs."}], "answers": [{"tags": [], "owner": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "is_accepted": true, "score": 1, "last_activity_date": 1563964006, "creation_date": 1563964006, "answer_id": 57180726, "question_id": 57179731, "link": "https://stackoverflow.com/questions/57179731/write-a-function-to-get-a-slice-of-string-keys-from-a-map-no-matter-what-value-t/57180726#57180726", "title": "Write a function to get a slice of string keys from a map no matter what value type the map is", "body": "<p>You can make use <code>MapKeys</code> in <code>reflect</code> package to do that(ref: <a href=\"https://golang.org/pkg/reflect/#Value.MapKeys\" rel=\"nofollow noreferrer\">https://golang.org/pkg/reflect/#Value.MapKeys</a>). </p>\n\n<blockquote>\n  <p>MapKeys returns a slice containing all the keys present in the map, in unspecified order. It panics if v's Kind is not Map. It returns an empty slice if v represents a nil map.</p>\n</blockquote>\n\n<p>An example is given below (playground link: <a href=\"https://play.golang.org/p/xhDtmbGUyz0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/xhDtmbGUyz0</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    fmt.Println(mapLowCaseKeys(map[string]float64{\n        \"key1\" : 1.2,\n    }))\n\n    fmt.Println(mapLowCaseKeys(map[string]interface{} {\n        \"key1\" : 1.2,\n        \"key2\" : map[string]string{\"kk\": \"3\"},\n    }))\n\n    fmt.Println(mapLowCaseKeys(map[int]float64{\n         11 : 1.2,\n    }))\n\n    fmt.Println(mapLowCaseKeys(nil))\n}\n\nfunc mapLowCaseKeys(v interface{}) []string {\n    keys := []string{}\n    value := reflect.ValueOf(v)\n    if value.Kind() == reflect.Map {\n        for _, v := range value.MapKeys() {\n            if v.Kind() == reflect.String {\n                keys = append(keys, v.String())\n            }\n        }\n        return keys\n    } else {\n        fmt.Println(\"it is not a map!!\")\n        return keys\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 700, "user_id": 5484988, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AESxW.jpg?s=128&g=1", "display_name": "Li Jinyao", "link": "https://stackoverflow.com/users/5484988/li-jinyao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 57180726, "answer_count": 1, "score": 0, "last_activity_date": 1563964006, "creation_date": 1563960879, "last_edit_date": 1563963351, "question_id": 57179731, "link": "https://stackoverflow.com/questions/57179731/write-a-function-to-get-a-slice-of-string-keys-from-a-map-no-matter-what-value-t", "title": "Write a function to get a slice of string keys from a map no matter what value type the map is", "body": "<p>I want to write a function to get all keys from a map as a slice of string which key type is string and the value could be any other type.</p>\n\n<p>Like this but can have any kind of map[string]... as input.</p>\n\n<pre><code>func mapLowCaseKeys(v map[string]string) []string {\n    keys := make([]string, len(v))\n    i := 0\n    for key := range v {\n        keys[i] = strings.ToLower(key)\n        i++\n    }\n    return keys\n}\n</code></pre>\n\n<p>Actually I want achive <code>Object.keys()</code> in Javascript.</p>\n\n<p>I've tried use <code>map[string]interface{}</code> as the function's paramter type but it can't just pass any specific map to that function, is this possible in golang?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1563959881, "post_id": 57179112, "comment_id": 100870113, "body": "<a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Method_sets</a> and <a href=\"https://golang.org/ref/spec#Selectors\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Selectors</a> point 3."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563960001, "post_id": 57179112, "comment_id": 100870183, "body": "Related, possible duplicate: <a href=\"https://stackoverflow.com/q/27775376/13860\">stackoverflow.com/q/27775376/13860</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2859, "user_id": 6225565, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iqBej.jpg?s=128&g=1", "display_name": "Shalauddin Ahamad Shuza", "link": "https://stackoverflow.com/users/6225565/shalauddin-ahamad-shuza"}, "is_accepted": true, "score": 2, "last_activity_date": 1563962929, "creation_date": 1563962929, "answer_id": 57180413, "question_id": 57179112, "link": "https://stackoverflow.com/questions/57179112/a-confusion-about-interface-assignments/57180413#57180413", "title": "A confusion about interface assignments", "body": "<ol>\n<li><p><code>worker=u</code> and <code>work=&amp;u</code> are valid because <code>User</code> implement all methods of <code>Worker</code> in this case only <code>Work</code> method with values for receivers. Value methods can be invoked on both value and pointer.</p></li>\n<li><p><code>worker=p</code> is invalid as <code>People</code> implements <code>Work</code> method with with pointer for receivers. So if you assign any value of <code>People</code> to <code>Worker</code> pointer then if will not <code>Work</code> method. That's why it is invalid.</p></li>\n<li><p><code>worker=&amp;p</code> is valid as <code>People</code> implements <code>Work</code> method.</p></li>\n<li><p>User and People are two different struct that implement same interface <code>Worker</code>. This ensures that both have a method named <code>Work</code> but the implementation may be different.</p></li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Worker interface {\n    Work()\n}\n\ntype User struct {\n    name string\n}\n\nfunc (u User) Work() {\n    fmt.Printf(\"Name : %s\\n\", u.name)\n}\n\ntype People struct {\n    name string\n}\n\nfunc (p *People) Work() {\n    fmt.Printf(\"Name : %s\\n\", p.name)\n}\n\nfunc main() {\n    var worker Worker\n\n    u := User{name: \"uuu\"}\n    worker = u  // valid\n    worker = &amp;u // valid\n    worker.Work()\n\n    p := People{name: \"pppp\"}\n    // worker = p  // invalid\n    worker = &amp;p // valid\n    worker.Work()\n}\n</code></pre>\n"}], "owner": {"reputation": 85, "user_id": 7424067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52df97ebd6435722cfdfbcec021c2846?s=128&d=identicon&r=PG&f=1", "display_name": "wangyongjun", "link": "https://stackoverflow.com/users/7424067/wangyongjun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "closed_date": 1564020008, "accepted_answer_id": 57180413, "answer_count": 1, "score": -2, "last_activity_date": 1563962929, "creation_date": 1563958984, "last_edit_date": 1563959961, "question_id": 57179112, "link": "https://stackoverflow.com/questions/57179112/a-confusion-about-interface-assignments", "closed_reason": "Duplicate", "title": "A confusion about interface assignments", "body": "<p>I am very confused about the following Go code. Who can tell me why</p>\n\n<ol>\n<li><code>worker=u</code> and <code>work=&amp;u</code> are valid? </li>\n<li><code>worker=p</code> is valid? </li>\n<li><code>worker=&amp;p</code> is invalid? </li>\n<li>What is difference between User and People?</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Worker interface {\n    Work()\n}\n\ntype User struct {\n    name string\n}\n\nfunc (u User) Work() {\n\n}\n\ntype People struct {\n    name string\n}\n\nfunc (p *People) Work() {\n\n}\n\nfunc main() {\n    var worker Worker\n\n    u := User{name:\"xxx\"}\n    worker = u  // valid\n    worker = &amp;u  // valid\n\n    p := People{name:\"xxx\"}\n    worker = p  // invalid\n    worker = &amp;p  // valid\n\n}\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1563959827, "post_id": 57179104, "comment_id": 100870080, "body": "This is neither the proper way to benchmark such stuff nor is your reasoning about what should run faster or slower sound. What is the actual problem you are facing?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1563960783, "post_id": 57179104, "comment_id": 100870590, "body": "Your two methods don&#39;t even do exactly the same thing."}, {"owner": {"reputation": 1, "user_id": 9683480, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sLs8x_BZ4UE/AAAAAAAAAAI/AAAAAAAAAj4/tuErGfn6cPE/photo.jpg?sz=128", "display_name": "ddgg", "link": "https://stackoverflow.com/users/9683480/ddgg"}, "edited": false, "score": 0, "creation_date": 1563960836, "post_id": 57179104, "comment_id": 100870624, "body": "I mean both parts do the same computing, but multiple goroutines needs context switch that takes some extra time."}, {"owner": {"reputation": 1, "user_id": 9683480, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sLs8x_BZ4UE/AAAAAAAAAAI/AAAAAAAAAj4/tuErGfn6cPE/photo.jpg?sz=128", "display_name": "ddgg", "link": "https://stackoverflow.com/users/9683480/ddgg"}, "edited": false, "score": 0, "creation_date": 1563960979, "post_id": 57179104, "comment_id": 100870692, "body": "Both finished 10 times 100000000 adds."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1563961031, "post_id": 57179104, "comment_id": 100870718, "body": "yea, but your concurrent version has extra allocations and GC, and the overhead of a waitgroup, and the overhead of a defer."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1563968650, "post_id": 57179104, "comment_id": 100875103, "body": "Your measurements contradict your conclusion. The version with a single goroutine <i>is</i> faster, by 3 milliseconds. Not that this is a statistically relevant difference."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9683480, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sLs8x_BZ4UE/AAAAAAAAAAI/AAAAAAAAAj4/tuErGfn6cPE/photo.jpg?sz=128", "display_name": "ddgg", "link": "https://stackoverflow.com/users/9683480/ddgg"}, "edited": false, "score": 0, "creation_date": 1563961855, "post_id": 57179761, "comment_id": 100871180, "body": "Thanks a lot, they do have some different"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1563968389, "post_id": 57179761, "comment_id": 100874939, "body": "The point about GC isn&#39;t justified here. There&#39;s no way that the Go runtime allocates an integer that&#39;s only used locally on the heap."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1563970259, "last_edit_date": 1563970259, "creation_date": 1563960959, "answer_id": 57179761, "question_id": 57179104, "link": "https://stackoverflow.com/questions/57179104/why-single-goroutine-run-slower-than-multiple-goroutines-when-runtime-gomaxprocs/57179761#57179761", "title": "Why single goroutine run slower than multiple goroutines when runtime.GOMAXPROCS(1)?", "body": "<p>Your concurrent version several things the non-concurrent version does, which will make it slower:</p>\n\n<ol>\n<li>It's creating a new <code>sum</code> value, which must be allocated. Your non-concurrent version just resets the existing value. This probably has a minimal impact, but is a difference.</li>\n<li>You're using a waitgroup. Obviously this adds overhead.</li>\n<li>The <code>defer</code> in <code>defer wg.Done()</code> also adds overhead, roughly equivalent to an extra function call.</li>\n</ol>\n\n<p>There may well be other subtle differences, too.</p>\n\n<p>So in short: Your benchmarks are just invalid, because you're comparing apples with oranges.</p>\n\n<p>More important: This isn't a useful benchmark in the first place, because it's a completely artificial workload.</p>\n"}], "owner": {"reputation": 1, "user_id": 9683480, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sLs8x_BZ4UE/AAAAAAAAAAI/AAAAAAAAAj4/tuErGfn6cPE/photo.jpg?sz=128", "display_name": "ddgg", "link": "https://stackoverflow.com/users/9683480/ddgg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 125, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1563970259, "creation_date": 1563958969, "last_edit_date": 1563960658, "question_id": 57179104, "link": "https://stackoverflow.com/questions/57179104/why-single-goroutine-run-slower-than-multiple-goroutines-when-runtime-gomaxprocs", "title": "Why single goroutine run slower than multiple goroutines when runtime.GOMAXPROCS(1)?", "body": "<p>I just want to try how fast goroutine switch context, so I wrote the code below. To my surprise, multiple gorountines run faster than the edition that does not need to switch context (I set the program to run in only one CPU core).</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    runtime.GOMAXPROCS(1)\n    t_start := time.Now()\n    sum := 0\n    for j := 0; j &lt; 10; j++ {\n        sum = 0\n        for i := 0; i &lt; 100000000; i++ {\n            sum += i\n        }\n    }\n    fmt.Println(\"single goroutine takes \", time.Since(t_start))\n\n    var wg sync.WaitGroup\n    t_start = time.Now()\n\n    for j := 0; j &lt; 10; j++ {\n        wg.Add(1)\n        go func() {\n            sum := 0\n            for i := 0; i &lt; 100000000; i++ {\n                sum += i\n            }\n            defer wg.Done()\n        }()\n    }\n    wg.Wait()\n    fmt.Println(\"multiple goroutines take \", time.Since(t_start))\n}\n</code></pre>\n\n<p>A single goroutine takes 251.690788ms, multiple goroutines take 254.067156ms</p>\n\n<p>The single goroutine should run faster, because single goroutine does not need to change context. However, the answer is opposite, single mode always slower. What happened in this program? </p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "edited": false, "score": 0, "creation_date": 1563961645, "post_id": 57178721, "comment_id": 100871052, "body": "JSON uses key for property name, not for property value. Your expected json stream might refer to a struct like Day <code>json:&quot;2019-07-22&quot;</code>. As you can see, does it read fine?"}, {"owner": {"reputation": 900, "user_id": 2761930, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c838e9dc1d38f75c5c559078f242e493?s=128&d=identicon&r=PG&f=1", "display_name": "kuba_ceg", "link": "https://stackoverflow.com/users/2761930/kuba-ceg"}, "reply_to_user": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "edited": false, "score": 0, "creation_date": 1563961869, "post_id": 57178721, "comment_id": 100871192, "body": "Well it will work but I have to change those dates basing on data from database"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1563967792, "creation_date": 1563967792, "answer_id": 57181896, "question_id": 57178721, "link": "https://stackoverflow.com/questions/57178721/anonymus-struct-after-json-serialization-in-go/57181896#57181896", "title": "Anonymus struct after json serialization in go", "body": "<p>To achieve the json you want your <code>Response</code> type should be a map of maps.</p>\n\n<pre><code>type Response map[string]map[string]Entry\n\ntype Entry struct {\n    Type string `json:\"type\"`\n    Id   int    `json:\"id\"`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.com/p/4GBEZi_TS9m\" rel=\"nofollow noreferrer\">https://play.golang.com/p/4GBEZi_TS9m</a></p>\n"}], "owner": {"reputation": 900, "user_id": 2761930, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c838e9dc1d38f75c5c559078f242e493?s=128&d=identicon&r=PG&f=1", "display_name": "kuba_ceg", "link": "https://stackoverflow.com/users/2761930/kuba-ceg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "accepted_answer_id": 57181896, "answer_count": 1, "score": -3, "last_activity_date": 1563967792, "creation_date": 1563957656, "question_id": 57178721, "link": "https://stackoverflow.com/questions/57178721/anonymus-struct-after-json-serialization-in-go", "title": "Anonymus struct after json serialization in go", "body": "<p>I want achieve such format for output json</p>\n\n<pre><code>{\n    \"2019-07-22\": {\n        \"something\": {\n            \"type\": \"ENTRY\",\n            \"id\": 1766617,\n        },\n        \"something2\": {\n            \"type\": \"ENTRY\",\n            \"id\": 1766617,\n        },\n    },\n    \"2019-07-23\": {\n        \"something\": {\n            \"type\": \"ENTRY\",\n            \"id\": 1766618,\n        },\n        \"something2\": {\n            \"type\": \"ENTRY\",\n            \"id\": 1766620,\n        },\n    },\n}\n</code></pre>\n\n<p>So far I've split those data into 3 structs:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Response struct {\n    Days map[string]Day\n}\n\ntype Day struct {\n    Entries map[string]Entry\n}\n\ntype Entry struct {\n    type            string `json:\"type\"`\n    Id              int    `json:\"id\"`\n}\n</code></pre>\n\n<p>After serialize into json I have structure with field names and nested json objects which is wrong:</p>\n\n<pre><code>{\n    \"Days\": {\n        \"2019-07-22\": {\n            \"Entries\": {\n                \"something\": {\n                    \"type\": \"ENTRY\",\n                    \"id\": 1766617\n                },\n                \"something2\": {\n                    \"type\": \"ENTRY\",\n                    \"id\": 1766617\n                }\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Is there possibility to skip those field names in <code>Response:Days</code> and <code>Day:Entries</code> fields? I will not deserialize json into structs so only problem is serialization. I can't change json structure because of BC breakes.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 4, "last_activity_date": 1563955778, "creation_date": 1563955778, "answer_id": 57178190, "question_id": 57178032, "link": "https://stackoverflow.com/questions/57178032/trying-to-end-goroutine-using-closech-but-end-up-running-infinitely/57178190#57178190", "title": "Trying to end goroutine using close(ch) but end up running infinitely", "body": "<p>The problem is the scope of your <code>break</code>:</p>\n\n<pre><code>func runner(id int, ch &lt;-chan struct{}, wg *sync.WaitGroup) {\n    for {\n        select {\n            case &lt;-time.Tick(time.Second):\n                fmt.Println(\"worker \", id)\n            case &lt;- ch:\n                fmt.Println(\"closing worker \", id)\n                break\n        }\n    }\n\n    wg.Done()\n}\n</code></pre>\n\n<p>You want to break out of the for loop, but you're actually only breaking out of the <code>select</code>.  To remedy this, you have two choices:</p>\n\n<ol>\n<li><p>Add a label to your for loop, and break from it explicitly:</p>\n\n<pre><code>func runner(id int, ch &lt;-chan struct{}, wg *sync.WaitGroup) {\nloop:  // &lt;---------- add a label\n    for {\n        select {\n        case &lt;-time.Tick(time.Second):\n            fmt.Println(\"worker \", id)\n        case &lt;-ch:\n            fmt.Println(\"closing worker \", id)\n            break loop  // &lt;---------- and break from it explicitly\n        }\n    }\n\n    wg.Done()\n}\n</code></pre></li>\n<li><p>Probably a more idiomatic and robust solution, simply return when you're done. This means the <code>wg.Done()</code> call must be deferred.</p>\n\n<pre><code>func runner(id int, ch &lt;-chan struct{}, wg *sync.WaitGroup) {\n    defer wg.Done() // &lt;--- Defer the wg.Done() call, so it happens on return\n    for {\n        select {\n        case &lt;-time.Tick(time.Second):\n            fmt.Println(\"worker \", id)\n        case &lt;-ch:\n            fmt.Println(\"closing worker \", id)\n            return   // &lt;--- replace `break` with `return`\n        }\n    }\n}\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 1, "user_id": 2874156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/431036f1fe96fe98c7ad0366bc21cbbd?s=128&d=identicon&r=PG", "display_name": "prantoran", "link": "https://stackoverflow.com/users/2874156/prantoran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563955874, "creation_date": 1563955277, "last_edit_date": 1563955874, "question_id": 57178032, "link": "https://stackoverflow.com/questions/57178032/trying-to-end-goroutine-using-closech-but-end-up-running-infinitely", "title": "Trying to end goroutine using close(ch) but end up running infinitely", "body": "<p>I am trying to end multiple goroutines once another goroutine closes a channel. However, I am ending up into infinite loop after close signal is received. I can't figure out why.</p>\n\n<p>I know that it is possible using context.Context but I was trying out by closing channels.</p>\n\n<p>Go Playground: <a href=\"https://play.golang.org/p/C6pcYgGLnG9\" rel=\"nofollow noreferrer\">https://play.golang.org/p/C6pcYgGLnG9</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"sync\"\n)\n\n\nfunc runner(id int, ch &lt;-chan struct{}, wg *sync.WaitGroup) {\n    for {\n        select {\n            case &lt;-time.Tick(time.Second):\n                fmt.Println(\"worker \", id)\n            case &lt;- ch:\n                fmt.Println(\"closing worker \", id)\n                break\n        }\n    }\n\n    wg.Done()\n\n}\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    ch := make(chan struct{})\n    var wg sync.WaitGroup\n\n    wg.Add(1)\n    go runner(1, ch, &amp;wg)\n\n    wg.Add(1)\n    go runner(2, ch, &amp;wg)\n\n    time.Sleep(5*time.Second)\n\n    close(ch)\n\n    wg.Wait()\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-platform", "google-cloud-datastore"], "answers": [{"tags": [], "owner": {"reputation": 1823, "user_id": 7644371, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-K8-GVAQWClY/AAAAAAAAAAI/AAAAAAAAAKY/44LvrIzzJVw/photo.jpg?sz=128", "display_name": "Jim Morrison", "link": "https://stackoverflow.com/users/7644371/jim-morrison"}, "is_accepted": false, "score": 0, "last_activity_date": 1563982266, "creation_date": 1563982266, "answer_id": 57186492, "question_id": 57176397, "link": "https://stackoverflow.com/questions/57176397/not-able-to-sort-entities-of-datastore-kind-in-golang/57186492#57186492", "title": "Not able to sort entities of datastore kind in golang", "body": "<p>It sounds like you don't have any values of Salience indexed.   The <code>.Order(\"-Salience\")</code> uses an index on the Salience value, so any entities that don't have a value for Salience indexed will not show up in the results.  That said, the value in Cloud Datastore seems to be <code>salience</code>, so you should try <code>.Order(\"-salience\")</code>.</p>\n\n<p>Things you can try in the cloud console:</p>\n\n<ul>\n<li><code>select * from Rule order by salience desc</code></li>\n<li><code>select * from Rule order by Salience desc</code></li>\n</ul>\n\n<p>If neither give results then you don't have any values of Salience indexed and you'll have to rewrite your entities.</p>\n"}], "owner": {"reputation": 63, "user_id": 10295084, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dz3VS2iO3Vw/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaNqlIuT0hmgmE7g-2JS52hKPZ_uyQ/mo/photo.jpg?sz=128", "display_name": "Aniruddha Dwivedi", "link": "https://stackoverflow.com/users/10295084/aniruddha-dwivedi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563982266, "creation_date": 1563949068, "last_edit_date": 1563951722, "question_id": 57176397, "link": "https://stackoverflow.com/questions/57176397/not-able-to-sort-entities-of-datastore-kind-in-golang", "title": "Not able to sort entities of datastore kind in golang", "body": "<p>In my application, I use go 1.11 as backend. It performs CRUD operations in google datastore. I can retrieve entities from a particular kind but in an unpredictable order. I am using below datastore module:</p>\n\n<pre><code>\"cloud.google.com/go/datastore\"\n</code></pre>\n\n<p>My struct for this is:</p>\n\n<pre><code>type RuleDS struct {\n    Id              string          `json:\"id\" datastore:\"id\"`\n    Name            string          `json:\"name\" datastore:\"name\"`\n    Salience        int             `json:\"salience\" datastore:\"salience\"`\n    CreatedAt       time.Time       `json:\"createdAt\" datastore:\"createdAt\"`\n}\n</code></pre>\n\n<p>My code to sort entities in order is as below:</p>\n\n<pre><code>    var rulesDSArr  []RuleDS\n    query := datastore.NewQuery(\"Rule\").Order(\"-Salience\")\n    _, errDS := s.DataLayer.GetAll(ctx, query, &amp;rulesDSArr)\n    if errDS!= nil{\n      log.Errorf(ctx,\"Error while getting rules : %v\",errDS)\n    }\n</code></pre>\n\n<p>I also checked logs where query formed is:</p>\n\n<pre><code>&amp;{kind:Rule ancestor:&lt;nil&gt; filter:[] order:[{FieldName:Salience Direction:true}] projection:[] distinct:false distinctOn:[] keysOnly:false eventual:false limit:-1 offset:0 start:[] end:[] namespace: trans:&lt;nil&gt; err:&lt;nil&gt;}\n</code></pre>\n\n<p>In google datastore, I have tried by making Salience property indexed as well as nonindexed but nothing worked for me. I don't know what I am doing wrong here due to which I get null as a result. If I remove <code>.Order(\"-Salience\")</code> from query statement, I get all rules again.</p>\n"}, {"tags": ["python", "go", "capitalize"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1563949144, "post_id": 57176236, "comment_id": 100864727, "body": "Related: <a href=\"https://stackoverflow.com/questions/18559587/confusing-toupper-and-totitle\" title=\"confusing toupper and totitle\">stackoverflow.com/questions/18559587/&hellip;</a>"}, {"owner": {"reputation": 6486, "user_id": 1116230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55a894894150db28d6641f0c57e48bac?s=128&d=identicon&r=PG", "display_name": "Nico Haase", "link": "https://stackoverflow.com/users/1116230/nico-haase"}, "edited": false, "score": 0, "creation_date": 1563978391, "post_id": 57176236, "comment_id": 100880910, "body": "And what&#39;s the question? Anything not working with the given code?"}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563953513, "post_id": 57176292, "comment_id": 100866794, "body": "<code>Title()</code> does not capitalize the first letter of a string--it capitalizes the first letter of each word."}, {"owner": {"reputation": 1025, "user_id": 7253829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qe9lZ.jpg?s=128&g=1", "display_name": "waymobetta", "link": "https://stackoverflow.com/users/7253829/waymobetta"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563976113, "post_id": 57176292, "comment_id": 100879435, "body": "Good point, it was fine for the sake of his example but would fail in other cases with multi-word strings. Thanks, edited"}], "tags": [], "owner": {"reputation": 1025, "user_id": 7253829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qe9lZ.jpg?s=128&g=1", "display_name": "waymobetta", "link": "https://stackoverflow.com/users/7253829/waymobetta"}, "is_accepted": true, "score": 1, "last_activity_date": 1563975902, "last_edit_date": 1563975902, "creation_date": 1563948583, "answer_id": 57176292, "question_id": 57176236, "link": "https://stackoverflow.com/questions/57176236/why-totitle-does-not-capitalize-a-lower-cased-word-in-go/57176292#57176292", "title": "Why toTitle does not capitalize a lower cased word in Go?", "body": "<p>In Python, the <code>capitalize()</code> method converts the first character of a string to capital (uppercase) letter.</p>\n\n<p>If you are seeking to do the same with Go, you can range over the string contents, then leverage the <code>unicode</code> package method <a href=\"https://golang.org/pkg/unicode/#ToUpper\" rel=\"nofollow noreferrer\">ToUpper</a> to convert the first rune in the string to uppercase, then cast it to a string, then concatenate that with the rest of the original string.</p>\n\n<p>For the sake of your example, however, (since your string is just one word) see the <a href=\"https://golang.org/pkg/strings/#Title\" rel=\"nofollow noreferrer\">Title</a> method from the <code>strings</code> package.</p>\n\n<p>example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n    \"unicode\"\n)\n\nfunc main() {\n    s := \"ALIREZA foo bar\"\n    loweredVal := strings.ToLower(s)\n    fmt.Println(\"loweredVal:\", loweredVal)\n    toTitle := capFirstChar(loweredVal)\n    fmt.Println(\"toTitle:\", toTitle)\n}\n\nfunc capFirstChar(s string) string {\n    for index, value := range s {\n        return string(unicode.ToUpper(value)) + s[index+1:]\n    }\n    return \"\"\n}\n</code></pre>\n"}], "owner": {"reputation": 5203, "user_id": 1061008, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/1465c4d9e6e9a18c5b0f8bf8e2f93b09?s=128&d=identicon&r=PG&f=1", "display_name": "Alireza", "link": "https://stackoverflow.com/users/1061008/alireza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 679, "favorite_count": 0, "accepted_answer_id": 57176292, "answer_count": 1, "score": 0, "last_activity_date": 1564032787, "creation_date": 1563948267, "last_edit_date": 1564032787, "question_id": 57176236, "link": "https://stackoverflow.com/questions/57176236/why-totitle-does-not-capitalize-a-lower-cased-word-in-go", "title": "Why toTitle does not capitalize a lower cased word in Go?", "body": "<p>I need to implement the capitalize method of python in Go. I know that first I have to lowercase it and then use <code>toTitle</code> on it. Have a look at the sample code :</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    s := \"ALIREZA\"\n    loweredVal:=strings.ToLower(s)\n    fmt.Println(\"loweredVal:\", loweredVal)\n    toTitle := strings.ToTitle(loweredVal)\n    fmt.Println(\"toTitle:\", toTitle)\n}\n</code></pre>\n"}, {"tags": ["go", "scheduling"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1563954526, "post_id": 57176229, "comment_id": 100867318, "body": "Setting these variables inside the program is <i>too</i> <i>late</i> . Use runtime.GOMAXPROCS to change GOMAXPROCS from inside your code. No way to switch debugging on/off once your code runs."}, {"owner": {"reputation": 765, "user_id": 1773471, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ef9230d2cad16eeaef167c2b782ebe36?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/1773471/steve"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1563961767, "post_id": 57176229, "comment_id": 100871127, "body": "stackoverflow shall give poster a chance of knowing why his posts were downvoted! One who downvotes the post shall give a reason also"}], "answers": [{"tags": [], "owner": {"reputation": 12147, "user_id": 4378400, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/6wsSe.jpg?s=128&g=1", "display_name": "Yury Fedorov", "link": "https://stackoverflow.com/users/4378400/yury-fedorov"}, "is_accepted": true, "score": 3, "last_activity_date": 1563954628, "creation_date": 1563954628, "answer_id": 57177841, "question_id": 57176229, "link": "https://stackoverflow.com/questions/57176229/why-calling-setenv-from-code-not-working/57177841#57177841", "title": "Why Calling Setenv from code Not Working?", "body": "<p><a href=\"https://golang.org/cmd/go/#hdr-Environment_variables\" rel=\"nofollow noreferrer\"><code>go</code> command documentation</a> mentions that <code>go</code> examines some environment variables:</p>\n\n<blockquote>\n  <p>The go command, and the tools it invokes, examine a few different environment variables.</p>\n</blockquote>\n\n<p>So, env variables are checked before the program starts, i.e in build time. When you set these variables from code, the program already runs.</p>\n\n<p>It works from the IDE since the variables are applied before the compilation, therefore the code runs with all the changes you need.</p>\n"}], "owner": {"reputation": 765, "user_id": 1773471, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/ef9230d2cad16eeaef167c2b782ebe36?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/1773471/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 675, "favorite_count": 0, "accepted_answer_id": 57177841, "answer_count": 1, "score": 0, "last_activity_date": 1563961660, "creation_date": 1563948249, "last_edit_date": 1563961660, "question_id": 57176229, "link": "https://stackoverflow.com/questions/57176229/why-calling-setenv-from-code-not-working", "title": "Why Calling Setenv from code Not Working?", "body": "<p>I have a simple test project which is expected to print goroutine scheduling messages while it is running. </p>\n\n<p>Setting the env from Goland configuration it works. but it doesn't from code like below, the app doesn't print scheduling infomation. Anybody explains what happens ehre?</p>\n\n<pre><code>func TestScheduler1() {\n\n    var wg sync.WaitGroup\n    wg.Add(10)\n\n    for i := 0; i &lt; 10; i++ {\n        go work(&amp;wg)\n    }\n\n    wg.Wait()\n    // Wait to see the global run queue deplete.\n    time.Sleep(3 * time.Second)\n}\n\nfunc work(wg *sync.WaitGroup) {\n    time.Sleep(time.Second)\n\n    var counter int\n    for i := 0; i &lt; 1e10; i++ {\n        counter++\n    }\n\n    wg.Done()\n}\n</code></pre>\n\n<p>init function is like:</p>\n\n<pre><code> func init()  {\n    os.Setenv(\"GOMAXPROCS\", \"1\")\n    os.Setenv(\"GODEBUG\", os.Getenv(\"GODEBUG\") + \"schedtrace=1000,scheddetail=1\")\n}\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda", "serverless-framework", "aws-sam"], "comments": [{"owner": {"reputation": 1013, "user_id": 6236510, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/dO5N1.jpg?s=128&g=1", "display_name": "ambigus9", "link": "https://stackoverflow.com/users/6236510/ambigus9"}, "edited": false, "score": 0, "creation_date": 1596308984, "post_id": 57172699, "comment_id": 111773152, "body": "Did you find any solution?"}], "owner": {"reputation": 73, "user_id": 11624875, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-il4jwOFeJG0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reBGx-wqrosy6a9NBqE_XyhU9XlDg/mo/photo.jpg?sz=128", "display_name": "Jovana Kosti\u0107", "link": "https://stackoverflow.com/users/11624875/jovana-kosti%c4%87"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 316, "favorite_count": 2, "answer_count": 0, "score": 2, "last_activity_date": 1563919686, "creation_date": 1563918841, "last_edit_date": 1563919686, "question_id": 57172699, "link": "https://stackoverflow.com/questions/57172699/running-lambda-function-written-in-go-on-aws-error-while-loading-shared-librar", "title": "Running Lambda Function written in Go on AWS - error while loading shared libraries", "body": "<p>My question is similar to: <a href=\"https://stackoverflow.com/questions/57096379/libtensorflow-so-cannot-open-shared-object-file-no-such-file-or-directory\">libtensorflow.so: cannot open shared object file: No such file or directory</a> but I do not see an answer for it, so I would appreciate any kind of help.</p>\n\n<p>Once I print my <strong>LD_LIBRARY_PATH</strong> I get the following output:</p>\n\n<pre><code>/lib64:/usr/lib64:/var/runtime:/var/runtime/lib:/var/task:/var/task/lib:/opt/lib\n</code></pre>\n\n<p>I have created and deployed TensorFlow Lambda Layer.</p>\n\n<p>To my knowledge Lambda Layers should be cached in /opt/bin directory, right? But on documentation:<a href=\"https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-layers.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/serverless-application-model/latest/developerguide/serverless-sam-cli-layers.html</a> I see that default cache directory is <code>~/.aws-sam/layers-pkg</code>.</p>\n\n<p>Once I try to run my Lambda function with AWS SAM, and once I uncomment code which uses package in which I import tensorflow with go library, I get the following error:</p>\n\n<pre><code>error while loading shared libraries: libtensorflow.so.1: cannot open shared object file: No such file or directory\n</code></pre>\n\n<p>I have even tried to include these libraries in <strong>lib</strong> directory, and I've made that lib directory as part of <strong>LD_LIBRARY_PATH</strong>. Same result.</p>\n"}, {"tags": ["api", "http", "go", "cookies"], "comments": [{"owner": {"reputation": 139, "user_id": 10823323, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xGXmOtSm0mo/AAAAAAAAAAI/AAAAAAAACL8/tApDcsTBpwA/photo.jpg?sz=128", "display_name": "Thomas Teixeira", "link": "https://stackoverflow.com/users/10823323/thomas-teixeira"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563919388, "post_id": 57172415, "comment_id": 100858585, "body": "@CeriseLim&#243;n Okay, I&#39;ll try the path tips. I edited my post with some code, hope it&#39;s more useful now."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 5, "last_activity_date": 1563974116, "last_edit_date": 1563974116, "creation_date": 1563927258, "answer_id": 57173672, "question_id": 57172415, "link": "https://stackoverflow.com/questions/57172415/how-to-send-cookie-through-redirection-in-golang/57173672#57173672", "title": "How to send cookie through redirection in golang?", "body": "<p>If a set cookie header does not specify a path, then the browser defaults the path to the path of the request. To make a cookie available across an entire site, explicitly set the path to \"/\".</p>\n\n<pre><code>cookie := http.Cookie{\n    Name: \"jwt-token\",\n    Value: strToken, \n    Path: \"/\",\n}\n</code></pre>\n\n<p>Cookies cannot be set cross domain. If the auth handler in the question is not served from the domain komfy.now.sh, then the cookie cannot be set directly. The workaround is to send the token through a query parameter to an endpoint on the target domain. The handler for that endpoint sets the cookie and possibly redirects to the final URL.</p>\n"}], "owner": {"reputation": 139, "user_id": 10823323, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xGXmOtSm0mo/AAAAAAAAAAI/AAAAAAAACL8/tApDcsTBpwA/photo.jpg?sz=128", "display_name": "Thomas Teixeira", "link": "https://stackoverflow.com/users/10823323/thomas-teixeira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2267, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1563974116, "creation_date": 1563917069, "last_edit_date": 1563919361, "question_id": 57172415, "link": "https://stackoverflow.com/questions/57172415/how-to-send-cookie-through-redirection-in-golang", "title": "How to send cookie through redirection in golang?", "body": "<p>I'm working on an api, and after I authenticate an user, I would like to redirect him to the main page, passing through a cookie, which contain a jwt token.</p>\n\n<p>I'm using the http.Redirect function and already try:\n- Set the cookie to the ResponseWriter and send it through the redirect function but all it does it's setting a cookie on the authentication page but it doesn't pass it through the redirection, so the home page doesn't receive it.\n- Add the cookie to the request I first receive with the handler function and resent it through the redirect function. This doesn't work at all.\n- Create a new request and send it through the redirect function once again. This also doesn't work.</p>\n\n<p>That's the code I use with the SetCookie function, which is the one that work out the best:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>strToken := CreateToken(user)\nurlAuthRedirect := \"https://komfy.now.sh\"\n\ncookie := http.Cookie{\n    Name: \"jwt-token\",\n    Value: strToken, \n}\n\nhttp.SetCookie(resp, &amp;cookie) \nhttp.Redirect(\n    resp, // ResponseWriter\n    req, // Request\n    urlAuthRedirect, \n    http.StatusSeeOther)\n</code></pre>\n\n<p>Does any of you guys have an idea in order to pass the cookie from the authentication endpoint to the home page ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1563916213, "post_id": 57171860, "comment_id": 100857691, "body": "Nope. You&#39;re printing it from <code>Read</code> (right before the <code>return</code>) and again in <code>main</code> (you&#39;re copying the read bytes to stdout)."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563916331, "post_id": 57171860, "comment_id": 100857732, "body": "The Read method does not modify the caller&#39;s slice."}, {"owner": {"reputation": 844, "user_id": 6158618, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/be0fd6bf3448b482073b0bcdd2f8d781?s=128&d=identicon&r=PG&f=1", "display_name": "bitscuit", "link": "https://stackoverflow.com/users/6158618/bitscuit"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563917358, "post_id": 57171860, "comment_id": 100858041, "body": "@CeriseLim&#243;n what do you mean? Is the line <code>b = []byte(result)</code> not modifying the buffer, b?"}, {"owner": {"reputation": 844, "user_id": 6158618, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/be0fd6bf3448b482073b0bcdd2f8d781?s=128&d=identicon&r=PG&f=1", "display_name": "bitscuit", "link": "https://stackoverflow.com/users/6158618/bitscuit"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563917451, "post_id": 57171860, "comment_id": 100858063, "body": "@Adrian can you clarify what you are trying to say? I know I am printing it from Read, that print statement is for debugging purposes to see if the method is modifying the buffer, b, or not, which from the output, it looks like it is (at least inside the Read method)."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563921724, "post_id": 57171860, "comment_id": 100859158, "body": "The assignment changes local variable b. It does not modify the backing array of the caller\u2019s slice.  If this does not make sense, then jump to the tour pages about slices. The simple solution is to read in to the caller\u2019s slice, rotate bytes in that slice and return."}], "answers": [{"comments": [{"owner": {"reputation": 844, "user_id": 6158618, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/be0fd6bf3448b482073b0bcdd2f8d781?s=128&d=identicon&r=PG&f=1", "display_name": "bitscuit", "link": "https://stackoverflow.com/users/6158618/bitscuit"}, "edited": false, "score": 1, "creation_date": 1563917708, "post_id": 57172348, "comment_id": 100858140, "body": "This still doesn&#39;t work as intended. If I were to add that error check and comment out the <code>fmt.Println(string(b))</code> line, I wouldn&#39;t see the decoded message. Also, I would expect that the EOF error would already come from the strings Reader, which is passed to the caller anyways from the last return. Or is it just good practice for the wrapper to also handle the EOF error?"}], "tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": -1, "last_activity_date": 1563916685, "creation_date": 1563916685, "answer_id": 57172348, "question_id": 57171860, "link": "https://stackoverflow.com/questions/57171860/tour-of-go-rot13reader-buffer-not-being-updated-after-read-function-finishes/57172348#57172348", "title": "Tour of Go rot13Reader buffer not being updated after Read function finishes", "body": "<p>I am not too sure, so please take the below with between a few grains to several pounds of salt.</p>\n\n<p>First you should add an error check as early as possible:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>n, err := reader.r.Read(b)\nif err != nil &amp;&amp; err == io.EOF {\n    fmt.Printf(\"\\n%s, %d bytes read\", err, n)\n    return n, err\n}\n</code></pre>\n\n<p>With this added, the output is the one you would expect:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>You cracked the code!\nLbh penpxrq gur pbqr!\nEOF, 0 bytes read\n</code></pre>\n\n<p>The reason here is that a reader is supposed to return io.EOF in case there is nothing to read any more.</p>\n\n<p>So why did you experience said strange behavior? A quick look in the source code of <code>io.Copy</code> reveals that <a href=\"https://golang.org/src/io/io.go?s=12796:12856#L390\" rel=\"nofollow noreferrer\"><code>b</code> is allocated once and reused</a>. But since <code>b</code> was not modified (no bytes were read) and you accessed it for reading from it, it still held the same values as before. I would argue that the underlying <code>io.Reader</code> should clear <code>b</code> in case nothing is read, as per principle of least surprise, though.</p>\n"}, {"comments": [{"owner": {"reputation": 844, "user_id": 6158618, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/be0fd6bf3448b482073b0bcdd2f8d781?s=128&d=identicon&r=PG&f=1", "display_name": "bitscuit", "link": "https://stackoverflow.com/users/6158618/bitscuit"}, "edited": false, "score": 0, "creation_date": 1563976730, "post_id": 57173185, "comment_id": 100879861, "body": "Yea I realized my silly mistake after reading the comment from @CeriseLim&#243;n. Finding it weird that Go decided to use return parameters instead of just returning the slice."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1563923853, "last_edit_date": 1563923853, "creation_date": 1563922533, "answer_id": 57173185, "question_id": 57171860, "link": "https://stackoverflow.com/questions/57171860/tour-of-go-rot13reader-buffer-not-being-updated-after-read-function-finishes/57173185#57173185", "title": "Tour of Go rot13Reader buffer not being updated after Read function finishes", "body": "<p>In Go, all arguments are passed by value, as if by assignment to the parameter or receiver (a shallow copy).</p>\n\n<p>In Go, a slice is implemented as</p>\n\n<pre><code>type slice struct {\n    array unsafe.Pointer\n    len   int\n    cap   int\n}\n</code></pre>\n\n<p>When the slice is passed by value, after you return, you will not see any changes you make to the copy of the <code>struct</code> fields. You will only see any changes to elements of the underlying array.</p>\n\n<hr>\n\n<p>In your case, you overwrite <code>b</code> (<code>array</code>, <code>cap</code>, <code>len</code>), a copy.</p>\n\n<pre><code>b = []byte(result)\n</code></pre>\n\n<p>The copy is is discarded when you return.</p>\n\n<hr>\n\n<p>What you want to do is change elements of <code>b</code>'s <code>array</code>.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"os\"\n    \"strings\"\n)\n\nfunc rot13(b byte) byte {\n    switch {\n    case b &gt;= 'A' &amp;&amp; b &lt;= 'Z':\n        return 'A' + (b-'A'+13)%26\n    case b &gt;= 'a' &amp;&amp; b &lt;= 'z':\n        return 'a' + (b-'a'+13)%26\n    }\n    return b\n}\n\ntype rot13Reader struct {\n    r io.Reader\n}\n\nfunc (reader *rot13Reader) Read(b []byte) (int, error) {\n    n, err := reader.r.Read(b)\n    b = b[:n]\n    for i := range b {\n        b[i] = rot13(b[i])\n    }\n    return n, err\n}\n\nfunc main() {\n    s := strings.NewReader(\"Lbh penpxrq gur pbqr!\")\n    r := rot13Reader{s}\n    io.Copy(os.Stdout, &amp;r)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/0LDYmzrrgty\" rel=\"nofollow noreferrer\">https://play.golang.org/p/0LDYmzrrgty</a></p>\n\n<p>Output:</p>\n\n<pre><code>You cracked the code!\n</code></pre>\n\n<hr>\n\n<p><a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">The Go Blog: Go Slices: usage and internals</a></p>\n"}], "owner": {"reputation": 844, "user_id": 6158618, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/be0fd6bf3448b482073b0bcdd2f8d781?s=128&d=identicon&r=PG&f=1", "display_name": "bitscuit", "link": "https://stackoverflow.com/users/6158618/bitscuit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 1, "accepted_answer_id": 57173185, "answer_count": 2, "score": 2, "last_activity_date": 1563923853, "creation_date": 1563914363, "question_id": 57171860, "link": "https://stackoverflow.com/questions/57171860/tour-of-go-rot13reader-buffer-not-being-updated-after-read-function-finishes", "title": "Tour of Go rot13Reader buffer not being updated after Read function finishes", "body": "<p>Here is my implementation of the exercise using strings.Map (the rot13 function is straight out of golang's docs). The issue is that the buffer does not seem to be modified after the Read function returns. Here is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"os\"\n    \"strings\"\n    \"fmt\"\n)\n\ntype rot13Reader struct {\n    r io.Reader\n}\n\nfunc (reader *rot13Reader) Read(b []byte) (int, error) {\n    rot13 := func(r rune) rune {\n        switch {\n        case r &gt;= 'A' &amp;&amp; r &lt;= 'Z':\n            return 'A' + (r-'A'+13)%26\n        case r &gt;= 'a' &amp;&amp; r &lt;= 'z':\n            return 'a' + (r-'a'+13)%26\n        }\n        return r\n    }\n    n, err := reader.r.Read(b)\n    result := []byte(strings.Map(rot13, string(b)))\n    b = []byte(result)\n    fmt.Println(string(b))\n    return n, err\n}\n\nfunc main() {\n    s := strings.NewReader(\"Lbh penpxrq gur pbqr!\")\n    r := rot13Reader{s}\n    io.Copy(os.Stdout, &amp;r)\n}\n</code></pre>\n\n<p>and the output:</p>\n\n<pre><code>You cracked the code!\nLbh penpxrq gur pbqr!You cracked the code!\n</code></pre>\n\n<p>Clearly the buffer has been modified in the Read function, but it does not seem to be the case after it returns. If I were to comment out the <code>fmt.Println(string(b))</code>, the output would just be:</p>\n\n<pre><code>Lbh penpxrq gur pbqr!\n</code></pre>\n\n<p>Is there something quirky about Readers and Writers that I should know about?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1563899952, "post_id": 57168652, "comment_id": 100850872, "body": "Are you sure the goroutines don&#39;t each have a pointer to a separate copy of the struct?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1563900367, "post_id": 57168652, "comment_id": 100851051, "body": "Is it possible that two <code>Readings</code> are sharing the same <code>values</code> map?"}, {"owner": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "edited": false, "score": 0, "creation_date": 1563900841, "post_id": 57168652, "comment_id": 100851260, "body": "Both right. I had copied a readings, was calling Add on copy and MarshalJson on original. The values was shared, itself being not deep copied?"}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 1, "creation_date": 1563912043, "post_id": 57168652, "comment_id": 100856045, "body": "@andig: maps are reference values, they don&#39;t get automatically copied (<a href=\"https://stackoverflow.com/questions/23057785/how-to-copy-a-map\">stackoverflow.com/questions/23057785/how-to-copy-a-map</a>)"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563914487, "post_id": 57168652, "comment_id": 100857104, "body": "If you also copied the sync.Mutex, note that a mutex cannot be copied after first use.  The <code>go vet</code> command flags this error."}], "answers": [{"comments": [{"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 1, "creation_date": 1563912117, "post_id": 57168949, "comment_id": 100856069, "body": "This answer, in itself, is not very helpful because it just repeats a comment. I&#39;d suggest to either (1) close the question or (2) significantly enhance the answer to show the code that caused the problem, so that others could learn from it in the future"}], "tags": [], "owner": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "is_accepted": false, "score": 0, "last_activity_date": 1563900882, "creation_date": 1563900882, "answer_id": 57168949, "question_id": 57168652, "link": "https://stackoverflow.com/questions/57168652/how-can-i-find-a-data-race-in-mutex-protected-struct/57168949#57168949", "title": "How can I find a data race in mutex-protected struct?", "body": "<p>Both comments are right. I had copied a readings, was calling Add on copy and MarshalJson on original. The values was shared, itself being not deep copied.</p>\n"}], "owner": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1563900882, "creation_date": 1563899676, "question_id": 57168652, "link": "https://stackoverflow.com/questions/57168652/how-can-i-find-a-data-race-in-mutex-protected-struct", "title": "How can I find a data race in mutex-protected struct?", "body": "<p>I have a struct containing a map that is accessed from different goroutines protected by mutex:</p>\n\n<pre><code>type Readings struct {\n    sync.Mutex\n    Timestamp time.Time\n    values    map[meters.Measurement]float64\n}\n</code></pre>\n\n<p>Still, it has a data race between <code>Add</code> (write) and <code>MarshalJSON</code> (read). The latter performs structure conversion:</p>\n\n<pre><code>func (r *Readings) Add(q QuerySnip) {\n    r.Lock()\n    defer r.Unlock()\n\n    r.Timestamp = q.Timestamp\n    if r.values == nil {\n        r.values = make(map[meters.Measurement]float64)\n    }\n\n    r.values[q.Measurement] = q.Value\n}\n\nfunc (r *Readings) MarshalJSON() ([]byte, error) {\n    r.Lock()\n    defer r.Unlock()\n\n    res := map[string]interface{}{\n        \"Timestamp\": r.Timestamp,\n        \"Unix\":      r.Timestamp.Unix(),\n    }\n\n    if r.values == nil {\n        return json.Marshal(res)\n    }\n\n    for m, v := range r.values {\n        res[m.String()] = v\n    }\n\n    return json.Marshal(res)\n}\n</code></pre>\n\n<p>This is the race:</p>\n\n<pre><code>WARNING: DATA RACE\nWrite at 0x00c000294900 by goroutine 11:\nruntime.mapassign_fast64()\n    /usr/local/opt/go/libexec/src/runtime/map_fast64.go:92 +0x0\ngithub.com/volkszaehler/mbmd/server.(*Readings).Add()\n    ...\n\nPrevious read at 0x00c000294900 by goroutine 25:\nruntime.mapiterinit()\n    /usr/local/opt/go/libexec/src/runtime/map.go:804 +0x0\ngithub.com/volkszaehler/mbmd/server.(*Readings).MarshalJSON()\n    /Users/andig/htdocs/mbmd/server/datagram.go:126 +0x304\ngithub.com/volkszaehler/mbmd/server.(*data).MarshalJSON()\n    ...\n</code></pre>\n\n<p>I don't understand what might by racey here and I'm not able to replicate the race behaviour moving the code into a standalone test case.</p>\n\n<p>It there any advise for further diagnosis?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1563901724, "post_id": 57168416, "comment_id": 100851635, "body": "You know you can use pre-declared error variables like for example the <a href=\"https://golang.org/pkg/io/#pkg-variables\" rel=\"nofollow noreferrer\">io</a> package does, and then compare the returned error against the variables like for example <a href=\"https://github.com/golang/go/blob/f90e89e675443731e36c2de4bcd3cdd7316d3dfc/src/compress/zlib/reader.go#L103\" rel=\"nofollow noreferrer\">here</a>. Now when you change the error message, no code that compares against the pre-declared variables will break."}], "answers": [{"comments": [{"owner": {"reputation": 759, "user_id": 3942851, "user_type": "registered", "accept_rate": 47, "profile_image": "https://lh4.googleusercontent.com/-nIkq4wdsg6g/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMtFLuG4ftgrUKJVYOo8SEwFsosuQ/mo/photo.jpg?sz=128", "display_name": "sfdcnoob", "link": "https://stackoverflow.com/users/3942851/sfdcnoob"}, "edited": false, "score": 0, "creation_date": 1563901297, "post_id": 57168505, "comment_id": 100851453, "body": "Hi Eli, this is very helpful.  What if I want to convert the fmt.Errorf  to my custom error type?"}, {"owner": {"reputation": 759, "user_id": 3942851, "user_type": "registered", "accept_rate": 47, "profile_image": "https://lh4.googleusercontent.com/-nIkq4wdsg6g/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMtFLuG4ftgrUKJVYOo8SEwFsosuQ/mo/photo.jpg?sz=128", "display_name": "sfdcnoob", "link": "https://stackoverflow.com/users/3942851/sfdcnoob"}, "edited": false, "score": 1, "creation_date": 1563901899, "post_id": 57168505, "comment_id": 100851699, "body": "I guess I could do return &amp;MyError(fmt.Sprintf(&quot;&quot;))"}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "reply_to_user": {"reputation": 759, "user_id": 3942851, "user_type": "registered", "accept_rate": 47, "profile_image": "https://lh4.googleusercontent.com/-nIkq4wdsg6g/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMtFLuG4ftgrUKJVYOo8SEwFsosuQ/mo/photo.jpg?sz=128", "display_name": "sfdcnoob", "link": "https://stackoverflow.com/users/3942851/sfdcnoob"}, "edited": false, "score": 0, "creation_date": 1563911758, "post_id": 57168505, "comment_id": 100855913, "body": "@sfdcnoob: <code>fmt.Errorf</code> just does <code>return errors.New(Sprintf(format, a...))</code>"}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 1, "last_activity_date": 1563899482, "last_edit_date": 1563899482, "creation_date": 1563899112, "answer_id": 57168505, "question_id": 57168416, "link": "https://stackoverflow.com/questions/57168416/how-to-write-a-golang-validation-function-so-that-client-is-able-to-handle-elega/57168505#57168505", "title": "how to write a golang validation function so that client is able to handle elegantly?", "body": "<p><code>error</code> is an interface, so you can dynamically check - <a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">using type assertions</a> - some specific types and act accordingly.</p>\n\n<p>Here's a code snippet that may be useful (<a href=\"https://play.golang.org/p/nggXzaLX3Cg\" rel=\"nofollow noreferrer\">playground link</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n)\n\ntype MyError struct {\n    msg string\n    id  int\n}\n\nfunc (me MyError) Error() string {\n    return me.msg\n}\n\nfunc checkErr(e error) {\n    if me, ok := e.(MyError); ok {\n        fmt.Println(\"found MyError\", me)\n    } else {\n        fmt.Println(\"found error\", e)\n    }\n}\n\nfunc main() {\n    checkErr(errors.New(\"something bad\"))\n    checkErr(MyError{msg: \"MyError bad\"})\n}\n</code></pre>\n\n<p>The first line in <code>checkErr</code> is the ticket here - it checks if <code>e</code> is of some special underlying type.</p>\n"}, {"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 0, "last_activity_date": 1563915246, "creation_date": 1563915246, "answer_id": 57172056, "question_id": 57168416, "link": "https://stackoverflow.com/questions/57168416/how-to-write-a-golang-validation-function-so-that-client-is-able-to-handle-elega/57172056#57172056", "title": "how to write a golang validation function so that client is able to handle elegantly?", "body": "<p>While the use of typed errors surely has its place and can be used, there are different approaches.</p>\n\n<p>As for the validation part, I prefer not to reinvent the wheel and use [govalidator][gh:govalidator]. Custom validations can be easily added and if your validation needs are not rather complicated, it may already give you what you need.</p>\n\n<p>However, as per the second part your question consists of, the elegant handling of errors, there is an alternative to an implementation of the Error interface: predefined variables which you can directly compare, as shown in the switch statement in the example program below.</p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"log\"\n\n    \"github.com/asaskevich/govalidator\"\n)\n\n// Error Examples\nvar (\n    NoUrlError        = errors.New(\"Not an URL\")\n    NotLowerCaseError = errors.New(\"Not all lowercase\")\n)\n\nfunc init() {\n    govalidator.SetFieldsRequiredByDefault(true)\n}\n\n// Request is your rather abstract domain model\ntype Request struct {\n    A string `valid:\"-\"`\n    B string `valid:\"uppercase\"`\n    // Note the custom error message\n    C string `valid:\"url,lowercase~ALL lowercase!!!\"`\n    D string `valid:\"length(3|10),lowercase\"`\n    E string `valid:\"email,optional\"`\n}\n\n// Validate takes the whole request and validates it against the struct tags.\nfunc (r Request) Validate() (bool, error) {\n    return govalidator.ValidateStruct(r)\n}\n\n// ValidC does a custom validation of field C.\nfunc (r Request) ValidC() (bool, error) {\n\n    if !govalidator.IsURL(r.C) {\n        return false, NoUrlError\n    }\n\n    if !govalidator.IsLowerCase(r.C) {\n        return false, NotLowerCaseError\n    }\n\n    return true, nil\n}\n\nfunc main() {\n\n    // Setup some Requests\n    r1 := Request{C: \"asdf\"}\n    r2 := Request{C: \"http://www.example.com\"}\n    r3 := Request{C: \"http://WWW.EXAMPLE.com\"}\n    r4 := Request{B: \"HELLO\", C: \"http://world.com\", D: \"foobarbaz\", E: \"you@example.com\"}\n\n    for i, r := range []Request{r1, r2, r3, r4} {\n        log.Printf(\"=== Request %d ===\", i+1)\n        log.Printf(\"\\tValidating struct:\")\n\n        // Validate the whole struct...\n        if isValid, err := r.Validate(); !isValid {\n            log.Printf(\"\\tRequest %d is invalid:\", i+1)\n\n            // ... and iterate over the validation errors\n            for k, v := range govalidator.ErrorsByField(err) {\n                log.Printf(\"\\t\\tField %s: %s\", k, v)\n            }\n        } else {\n            log.Printf(\"\\t\\tValid!\")\n        }\n\n        log.Println(\"\\tValidating URL\")\n\n        valid, e := r.ValidC()\n\n        if !valid {\n            switch e {\n            // Here you got your comparison against a predefined error\n            case NoUrlError:\n                log.Printf(\"\\t\\tRequest %d: No valid URL!\", i)\n            case NotLowerCaseError:\n                log.Printf(\"\\t\\tRequest %d: URL must be all lowercase!\", i)\n            }\n        } else {\n            log.Printf(\"\\t\\tValid!\")\n        }\n    }\n}\n</code></pre>\n\n<p>Imho, a custom implementation only makes sense if you want to add behavior. But then, this would first call for a custom interface and an according implementation as a secondary necessity:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"errors\"\n    \"log\"\n)\n\ntype CustomReporter interface {\n    error\n    LogSomeCoolStuff()\n}\n\ntype PrefixError struct {\n    error\n    Prefix string\n}\n\nfunc (p PrefixError) LogSomeCoolStuff() {\n    log.Printf(\"I do cool stuff with a prefix: %s %s\", p.Prefix, p.Error())\n}\n\nfunc report(r CustomReporter) {\n    r.LogSomeCoolStuff()\n}\n\nfunc isCustomReporter(e error) {\n    if _, ok := e.(CustomReporter); ok {\n        log.Println(\"Error is a CustomReporter\")\n    }\n}\n\nfunc main() {\n    p := PrefixError{error: errors.New(\"AN ERROR!\"), Prefix: \"Attention -\"}\n    report(p)\n    isCustomReporter(p)\n\n}\n</code></pre>\n\n<p><strong><kbd><a href=\"https://play.golang.org/p/nSesibNKxf4\" rel=\"nofollow noreferrer\">Run on playground</a></kbd></strong></p>\n\n<p>So, in short: If you want to make sure that the user can identify the kind of error use a variable, say <code>yourpackage.ErrSomethingWentWrong</code>. Only if you want to ensure a behavior implement a custom interface. Creating the type just for positively identifying a semantic <em>value</em> is not the way to do it. Again, imho.</p>\n"}, {"tags": [], "owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "is_accepted": false, "score": 0, "last_activity_date": 1563962744, "creation_date": 1563962744, "answer_id": 57180344, "question_id": 57168416, "link": "https://stackoverflow.com/questions/57168416/how-to-write-a-golang-validation-function-so-that-client-is-able-to-handle-elega/57180344#57180344", "title": "how to write a golang validation function so that client is able to handle elegantly?", "body": "<p>I do it like:</p>\n\n<ul>\n<li>normal cases:</li>\n</ul>\n\n<p>request is well formated and server side handle it well.</p>\n\n<p>status :200, body:<code>{\"message\":\"success\"}</code></p>\n\n<ul>\n<li>client bad request:</li>\n</ul>\n\n<p>client sent a bad request , maybe lack of args.It should be fixed by your client mate, and avoid appearing when online.</p>\n\n<p>status:400, body: <code>{\"message\":\"error reasson\"}</code></p>\n\n<ul>\n<li>client normal request but not success:</li>\n</ul>\n\n<p>maybe users use api to get award times more than default value.The request is normal but should be limit.</p>\n\n<p>status:200, body: <code>{\"message\":\"success\", \"tip\":\"Dear,you've finish it\", \"tip_id\":1}</code></p>\n\n<ul>\n<li>server inner error:</li>\n</ul>\n\n<p>some bugs or unnavoided error happened on server side.</p>\n\n<p>status\uff1a500 body: <code>{\"message\":\"error_stack_trace\", \"error_id\":\"XKZS-KAKZ-SKD-ZKAQ\"}</code></p>\n\n<p>Above all, client should divide response.status into three possible values(200,400,500) and has different handle ways.</p>\n\n<p>On 200 case, show anythings client want or <code>tip</code>.\nOn 400 case, show <code>message</code>.\nOn 500 case, show <code>error_id</code>.</p>\n"}], "owner": {"reputation": 759, "user_id": 3942851, "user_type": "registered", "accept_rate": 47, "profile_image": "https://lh4.googleusercontent.com/-nIkq4wdsg6g/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMtFLuG4ftgrUKJVYOo8SEwFsosuQ/mo/photo.jpg?sz=128", "display_name": "sfdcnoob", "link": "https://stackoverflow.com/users/3942851/sfdcnoob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 651, "favorite_count": 0, "accepted_answer_id": 57168505, "answer_count": 3, "score": 0, "last_activity_date": 1563962744, "creation_date": 1563898778, "last_edit_date": 1563899511, "question_id": 57168416, "link": "https://stackoverflow.com/questions/57168416/how-to-write-a-golang-validation-function-so-that-client-is-able-to-handle-elega", "title": "how to write a golang validation function so that client is able to handle elegantly?", "body": "<pre><code>type Request struct{\n  A string\n  B string\n  C string\n  D string\n  //...\n}\n\nfunc validator(req *Request)error{\n\n  if req.A == \"\" &amp;&amp; req.B != \"\"{\n    return errors.New(\"Error 1 !!\")\n  }\n\n  //...\n\n\n}\n</code></pre>\n\n<p>I have some existing code like above which is already being used so I can not change the function signature.</p>\n\n<p>I am writing a caller function which has to throttle some types of errors.\nAll existing errors are created using either errors.New(\"some string\") or fmt.Errorf(\"some string\").\nWhat I can do is </p>\n\n<pre><code>if err.Error() == \"Error 1 !!\" {\n    return nil\n  }\n</code></pre>\n\n<p>But this is not ideal. If on the server side, the message changes, client side breaks.</p>\n\n<p>I thought about naming all the errors on the server side like:</p>\n\n<pre><code>const ErrorType1 =  \"Error 1 !!\"\n</code></pre>\n\n<p>But it's difficult to name each error.</p>\n\n<p>Any better solutions?</p>\n"}, {"tags": ["go", "flags", "go-cobra"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1563896758, "post_id": 57167774, "comment_id": 100849319, "body": "It&#39;s in the examples in the readme at the page you linked: <a href=\"https://github.com/spf13/cobra#working-with-flags\" rel=\"nofollow noreferrer\">github.com/spf13/cobra#working-with-flags</a> so e.g. use <code>StringVarP</code> in place of <code>StringVar</code> or <code>StringP</code> instead of <code>String</code>."}], "answers": [{"tags": [], "owner": {"reputation": 12967, "user_id": 1168588, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/BxNie.jpg?s=128&g=1", "display_name": "PaulProgrammer", "link": "https://stackoverflow.com/users/1168588/paulprogrammer"}, "is_accepted": true, "score": 0, "last_activity_date": 1563896794, "creation_date": 1563896794, "answer_id": 57167873, "question_id": 57167774, "link": "https://stackoverflow.com/questions/57167774/how-to-use-a-flag-with-two-different-names-short-and-long/57167873#57167873", "title": "How to use a flag with two different names (short and long)", "body": "<p>The answer is an example in the documentation.  This example uses both <code>--projectbase</code> and <code>-b</code>:</p>\n\n<pre><code>rootCmd.PersistentFlags().StringVarP(&amp;projectBase, \"projectbase\", \"b\", \"\", \"base project directory eg. github.com/spf13/\")\n</code></pre>\n"}], "owner": {"reputation": 6454, "user_id": 2153777, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/L67zf.jpg?s=128&g=1", "display_name": "E235", "link": "https://stackoverflow.com/users/2153777/e235"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 572, "favorite_count": 0, "accepted_answer_id": 57167873, "answer_count": 1, "score": 0, "last_activity_date": 1563896794, "creation_date": 1563896455, "question_id": 57167774, "link": "https://stackoverflow.com/questions/57167774/how-to-use-a-flag-with-two-different-names-short-and-long", "title": "How to use a flag with two different names (short and long)", "body": "<p>I am using <a href=\"https://github.com/spf13/cobra\" rel=\"nofollow noreferrer\">https://github.com/spf13/cobra</a> to work with flags.  </p>\n\n<p>I want my CLI to have flag with two names:  <code>-t</code> or <code>--token</code>.  </p>\n\n<p>I currently used it like that:  </p>\n\n<pre><code>rootCmd.PersistentFlags().String(\"token\", \"\", \"Token to insert\")  \n</code></pre>\n\n<p>But it prints me the flags like that:  </p>\n\n<pre><code>Flags:\n\n      -h, --help           help for myapp\n          --token string   Token to insert  \n</code></pre>\n\n<p>I want it to be like that:  </p>\n\n<pre><code>Flags:\n\n      -h, --help           help for myapp\n      -t, --token string   Token to insert   \n</code></pre>\n\n<p>How can I do it?<br>\nI didn't find it on google, I tried to search for multiple names for a flag but without success.  </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1563895165, "post_id": 57166695, "comment_id": 100848386, "body": "Why is this tagged with sqlite?"}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 1, "creation_date": 1563898561, "post_id": 57166695, "comment_id": 100850237, "body": "Could you please clarify your question by providing a sketch of the code you&#39;d like to write? I&#39;m not sure what you&#39;re asking"}], "answers": [{"tags": [], "owner": {"reputation": 24, "user_id": 5627808, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-a68EYpAhOO4/AAAAAAAAAAI/AAAAAAAAAHo/dX0BlzR3DBQ/photo.jpg?sz=128", "display_name": "Hayhay G", "link": "https://stackoverflow.com/users/5627808/hayhay-g"}, "is_accepted": true, "score": 0, "last_activity_date": 1563894734, "creation_date": 1563894734, "answer_id": 57167270, "question_id": 57166695, "link": "https://stackoverflow.com/questions/57166695/why-it-is-showing-missing-before-newline-in-composite-literal/57167270#57167270", "title": "Why it is showing `missing &#39;,&#39; before newline in composite literal`", "body": "<p>So you want to able to change the variable names dynamically?</p>\n\n<p>There isnt any way of doing this. I suggest if you really need somthing like that you would use a Map.</p>\n\n<pre><code>Data     map[String]String\n</code></pre>\n\n<p>Im not exactly sure what you need this for, or if this helps.</p>\n"}], "owner": {"reputation": 13, "user_id": 11661209, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-3LPEjiE9qqE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc7fUE6SJaofCTdbC8hBQM9QLGHzQ/mo/photo.jpg?sz=128", "display_name": "Shubham Agarawal", "link": "https://stackoverflow.com/users/11661209/shubham-agarawal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 594, "favorite_count": 0, "closed_date": 1563954160, "accepted_answer_id": 57167270, "answer_count": 1, "score": -3, "last_activity_date": 1564149037, "creation_date": 1563893007, "last_edit_date": 1564149037, "question_id": 57166695, "link": "https://stackoverflow.com/questions/57166695/why-it-is-showing-missing-before-newline-in-composite-literal", "closed_reason": "Needs details or clarity", "title": "Why it is showing `missing &#39;,&#39; before newline in composite literal`", "body": "<p>Why my vscode is showing this error\n<code>missing ',' before newline in composite literal</code></p>\n\n<p>My code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>if title == \"\" &amp;&amp; desc != \"\" {\n            msgs = database.UpdateNotification(&amp;Notify, map[string]interface{}{\n                \"Description\": changedDesc,\n            }); msgs != nil {\n                log.Info(\"error while deleting notification\")\n            }```\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 2, "last_activity_date": 1563894139, "creation_date": 1563894139, "answer_id": 57167080, "question_id": 57166480, "link": "https://stackoverflow.com/questions/57166480/golang-http-server-graceful-shutdown-after-a-signal/57167080#57167080", "title": "golang http server graceful shutdown after a signal", "body": "<p>In <code>func simpleServiceStarter()</code> you declare local <code>simpleHTTPServer := &amp;http.Server</code> which shadow global</p>\n\n<pre><code>var (\n    simpleHTTPServer      http.Server\n</code></pre>\n\n<p>this local variable can't be referenced outside of <code>func simpleServiceStarter()</code> scope. Just do <code>simpleHTTPServer = &amp;http.Server</code> (without colon) inside <code>func simpleServiceStarter()</code></p>\n"}], "owner": {"reputation": 155, "user_id": 8287030, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d60020766c26e9acb8c0f898921333f9?s=128&d=identicon&r=PG&f=1", "display_name": "cpuNram", "link": "https://stackoverflow.com/users/8287030/cpunram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 558, "favorite_count": 0, "accepted_answer_id": 57167080, "answer_count": 1, "score": 2, "last_activity_date": 1563900224, "creation_date": 1563892296, "last_edit_date": 1563900224, "question_id": 57166480, "link": "https://stackoverflow.com/questions/57166480/golang-http-server-graceful-shutdown-after-a-signal", "title": "golang http server graceful shutdown after a signal", "body": "<p>I am trying to write code that gracefully shutdown the http server on signal.</p>\n\n<p>My code has two go routines - <code>signalHandler()</code> and <code>simpleServiceStarter()</code> - one for signal handling and another for http server. On receiving a signal, the handler should shutdown http server \nso <code>simpleServiceStarter()</code> breaks from <code>ListenAndServe()</code>. Below is my code. </p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n    \"time\"\n)\n\nvar (\n    simpleHTTPServer      http.Server\n    sigChan               chan os.Signal\n    simpleServiceShutdown chan bool\n)\n\nfunc simpleServiceStarter() {\n    mux := http.NewServeMux()\n    simpleHTTPServer := &amp;http.Server{\n        Addr:           \":9000\",\n        Handler:        mux,\n        ReadTimeout:    10 * time.Second,\n        WriteTimeout:   10 * time.Second,\n        MaxHeaderBytes: 1 &lt;&lt; 20,\n    }\n    fmt.Printf(\"\\nstarting http server on :9000 \")\n    err := simpleHTTPServer.ListenAndServe()\n    if err != http.ErrServerClosed {\n        fmt.Printf(\"error starting simple service or closing listener - %v\\n\", err)\n    }\n    fmt.Printf(\"simple service http server shutdown completed - %v\\n\", err)\n\n    // communicate with main thread\n    simpleServiceShutdown &lt;- true\n}\n\nfunc signalHandler() {\n    // Handle SIGINT and SIGHUP.\n    signal.Notify(sigChan, syscall.SIGINT, syscall.SIGHUP)\n\n    sig := &lt;-sigChan\n    fmt.Printf(\"\\nsignalHandler() received signal: %v\\n\", sig)\n\n    // gracefully shutdown http server\n    err := simpleHTTPServer.Shutdown(context.Background())\n    fmt.Printf(\"simple service shutdown on signal %v, error: %v\\n\", sig, err)\n    close(sigChan)\n\n}\n\nfunc main() {\n    // block all async signals to this server. And we register only SIGINT and SIGHUP for now.\n    signal.Ignore()\n\n    sigChan = make(chan os.Signal, 1)\n    simpleServiceShutdown = make(chan bool)\n    go signalHandler()\n\n    go simpleServiceStarter()\n    &lt;-simpleServiceShutdown // wait server to shutdown\n    close(simpleServiceShutdown)\n}\n\n</code></pre>\n\n<p>After sending the signal, the server is not breaking and still waiting.</p>\n\n<pre><code>Run the program as:\n$ ./simpleHttp \n\nstarting http server on :9000 \nsignalHandler() received signal: interrupt\nsimple service shutdown on signal interrupt, error: &lt;nil&gt;\n$\n\nFrom another terminal send the signal as:\ntester 30202  4379  0 09:14 pts/8    00:00:00 ./simpleHttp\nkill -s SIGINT 30202\n\n</code></pre>\n\n<p>I am using <code>go1.12.6 linux/amd64</code>.</p>\n"}, {"tags": ["go"], "owner": {"reputation": 2074, "user_id": 688071, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1229375604/picture?type=large", "display_name": "Godzilla74", "link": "https://stackoverflow.com/users/688071/godzilla74"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 156, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1563891980, "creation_date": 1563891980, "question_id": 57166373, "link": "https://stackoverflow.com/questions/57166373/gorm-and-foreign-key-associations", "title": "GORM and foreign key associations", "body": "<p>GORM doesn't seem to be honoring my attempt to associate tables based on their foreign key, while the primary key association I have works.  </p>\n\n<p>I have 3 structs, that correlate to 3 separate DB tables.  Their relation is as follows:</p>\n\n<ul>\n<li>Inventory.CustID relates to Customer.CustID <em>(this association works)</em></li>\n<li>GroupRules.RuleContent related to Customer.H1 <em>(this does not)</em></li>\n</ul>\n\n<p>So, my structs are:</p>\n\n<pre><code>type Customer struct {\n    CustID       sql.NullInt64  `gorm:\"primary_key;Column:CUST_ACCT_ID\"`\n    PlanTypeCd   sql.NullString `gorm:\"Column:PLAN_TYPE_CD\"`\n    H6           sql.NullString `gorm:\"Column:H6_CUST_ACCT_NBR\"`\n    H1           sql.NullString `gorm:\"Column:H1_CUST_ACCT_NBR\"`\n    AddressLine1 sql.NullString `gorm:\"Column:ADDRESS_LINE_1\"`\n    AddressLine2 sql.NullString `gorm:\"Column:ADDRESS_LINE_2\"`\n    City         sql.NullString `gorm:\"Column:ADDRESS_CTY_NME\"`\n    State        sql.NullString `gorm:\"Column:ADDRESS_ST_PRVN_CD\"`\n    Zip          sql.NullString `gorm:\"Column:ADDRESS_PSTL_CD\"`\n    Country      sql.NullString `gorm:\"Column:ADDRESS_CTRY_CD\"`\n}\n\ntype Inventory struct {\n    CustID            sql.NullInt64  `gorm:\"primary_key;Column:CUST_ACCT_ID\"`\n    CmpntTypeCd       sql.NullString `gorm:\"Column:CMPNT_TYPE_CD\"`\n    AccsBdwdCd        sql.NullString `gorm:\"Column:ACCS_BDWD_CD\"`\n    PrivateLineNumber sql.NullString `gorm:\"Column:PRIVATE_LINE_NBR\"`\n    NtwkUsrAdr        sql.NullString `gorm:\"Column:NTWK_USR_ADR\"`\n    Customer          Customer  `gorm:\"association_foreignkey;Column:CUST_ACCT_ID\"`\n}\n\ntype GroupRule struct {\n    RuleID           sql.NullInt64  `gorm:\"primary_key;Column:RuleID\"`\n    RuleType         sql.NullString `gorm:\"Column:RuleType\"`\n    RuleContent      sql.NullString `gorm:\"Column:RuleContent\"`\n    RuleLogic        sql.NullString `gorm:\"Column:RuleLogic\"`\n    GroupdID         sql.NullString `gorm:\"Column:GroupID\"`\n    IsActive         sql.NullBool   `gorm:\"Column:isActive\"`\n    LastMatchCount   sql.NullInt64  `gorm:\"Column:LastMatchCount\"`\n    LastMatchPortIds sql.NullString `gorm:\"Column:LastMatchPortIDs\"`\n    Creator          sql.NullInt64  `gorm:\"Column:Creator\"`\n    ExcludeRule      sql.NullBool   `gorm:\"Column:ExcludeRule\"`\n    Customer         Customer  `gorm:\"association_foreignkey;Column:H1_CUST_ACCT_ID\"`\n}\n</code></pre>\n\n<p>Then, my coded relations:</p>\n\n<pre><code>cust := Customer{}\ninv := Inventory{}\ngroups := GroupRule{}\n\nDB, e := db.DB{}\n// turn on logging\nDB.LogMode(true)\n\n// Select * From customers;\nDB.Find(&amp;cust)\n// gorm association between customers and inventory\nDB.Model(&amp;cust).Related(&amp;inv, \"CUST_ACCT_ID\")\n// gorm association between customers and group rules (does not work)\nDB.Model(&amp;cust).Related(&amp;groups, \"RuleContent\")\n</code></pre>\n\n<p>The last association is not working.  Instead, it's still trying to run it's SQL query using the <code>CUST_ACCT_ID</code> from <code>Customer</code> instead of the foreign key of <code>H1_CUST_ACCT_ID</code>.</p>\n\n<p>Log output:</p>\n\n<pre><code>// Customer/Inventory relation lookup\nSELECT * FROM `Inventory`  WHERE (`CUST_ACCT_ID` = '1439457')\n\n// Customer/GroupRule relation lookup\nSELECT * FROM `FON_GroupRules`  WHERE (`RuleContent` = '1439457') \n</code></pre>\n\n<p>In the 2nd lookup, the query should be something like `RuleContent = '9928332').</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563888189, "post_id": 57165116, "comment_id": 100844011, "body": "Are you exclusively using 32bit systems? Most things are 64bit, and will have a different memory layout."}, {"owner": {"reputation": 2763, "user_id": 2074467, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8e3be260bc0d9477984286415c2179ad?s=128&d=identicon&r=PG", "display_name": "replay", "link": "https://stackoverflow.com/users/2074467/replay"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563888605, "post_id": 57165116, "comment_id": 100844305, "body": "@JimB, no the code is running on 32 and 64 bit systems"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563888650, "post_id": 57165116, "comment_id": 100844332, "body": "ah nevermind, you changed the types in the question to have specific sizes."}, {"owner": {"reputation": 2763, "user_id": 2074467, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8e3be260bc0d9477984286415c2179ad?s=128&d=identicon&r=PG", "display_name": "replay", "link": "https://stackoverflow.com/users/2074467/replay"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563889024, "post_id": 57165116, "comment_id": 100844574, "body": "ah yes, sorry about that"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 1, "creation_date": 1563898172, "post_id": 57165116, "comment_id": 100850062, "body": "Here&#39;s another way of looking at this which may or may not be useful for you. Can you write <code>takeKeyValues</code> to take an interface instead of <code>[]uint32</code>? That interface could have a method to get a value given an index and also a method to give a length if you need that. Then, you could define <code>[]KeyValue</code> as a type and define those methods on that type."}, {"owner": {"reputation": 2763, "user_id": 2074467, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8e3be260bc0d9477984286415c2179ad?s=128&d=identicon&r=PG", "display_name": "replay", "link": "https://stackoverflow.com/users/2074467/replay"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1563903623, "post_id": 57165116, "comment_id": 100852466, "body": "@AndySchweig thx, that&#39;s a good idea, i haven&#39;t thought of that. I&#39;m not sure if I&#39;ll end up doing that because <code>takeKeyValues()</code> is a library function which is not that easy to modify, but I&#39;ll keep it in mind."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1563889336, "creation_date": 1563889336, "answer_id": 57165532, "question_id": 57165116, "link": "https://stackoverflow.com/questions/57165116/properties-of-slice-of-structs-as-function-argument-without-allocating-slice/57165532#57165532", "title": "Properties of slice of structs as function argument without allocating slice", "body": "<p>There is no safe way to arbitrarily reinterpret the memory layout of the your data. It's up to you whether the performance gain is worth the use of an unsafe type conversion.</p>\n\n<p>Since the fields of <code>KeyValue</code> are of equal size and the struct has no padding, you can convert the underlying array of <code>KeyValue</code> elements to an array of <code>uint32</code>.</p>\n\n<pre><code>takeKeyValues((*[1 &lt;&lt; 30]uint32)(unsafe.Pointer(&amp;s[0]))[:len(s)*2])\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Jjkv9pdFITu\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Jjkv9pdFITu</a></p>\n"}, {"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 0, "last_activity_date": 1563890966, "creation_date": 1563890966, "answer_id": 57166049, "question_id": 57165116, "link": "https://stackoverflow.com/questions/57165116/properties-of-slice-of-structs-as-function-argument-without-allocating-slice/57166049#57166049", "title": "Properties of slice of structs as function argument without allocating slice", "body": "<p>I a bit puzzled by what you want. If the slice is dynamic, you have to <em>grow it dynamically</em> as you add elements to it (at the call site).</p>\n\n<p>Go does not have <code>alloca(3)</code>, but I may propose another approach:</p>\n\n<ol>\n<li>Come up with an upper limit of the elements you'd need.</li>\n<li>Declare variable of the array type of that size (not a slice).</li>\n<li>\"Patch\" as many elements you want (starting at index 0) in that array.</li>\n<li>\"Slice\" the array and pass the slice to the callee.</li>\n</ol>\n\n<p>Slicing an array does not copy memory \u2014 it just takes the address of the array's first element.</p>\n\n<p>Something like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func caller(actualSize int) {\n  const MaxLen = 42\n\n  if actualSize &gt; MaxLen {\n    panic(\"actualSize &gt; MaxLen\")\n  }\n\n  var kv [MaxLen]KeyValue\n\n  for i := 0; i &lt; actualSize; i++ {\n    kv[i].Key, kv[i].Value = 100, 200\n  }\n\n  callee(kv[:actualSize])\n}\n\nfunc callee(kv []KeyValue) {\n  // ...\n}\n</code></pre>\n\n<p>But note that when the Go compiler sees <code>var kv [MaxLen]KeyValue</code>, it does not <em>have to</em> allocate it on the stack. Basically, I beleive the language spec does not tell anything about the stack vs heap.</p>\n"}, {"tags": [], "owner": {"reputation": 521, "user_id": 2260733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gicBs.png?s=128&g=1", "display_name": "Damien Legros", "link": "https://stackoverflow.com/users/2260733/damien-legros"}, "is_accepted": false, "score": 1, "last_activity_date": 1563891079, "creation_date": 1563891079, "answer_id": 57166091, "question_id": 57165116, "link": "https://stackoverflow.com/questions/57165116/properties-of-slice-of-structs-as-function-argument-without-allocating-slice/57166091#57166091", "title": "Properties of slice of structs as function argument without allocating slice", "body": "<p>As an alternative to JimB's answer, you can also use the <code>reflect</code> (reflect.SliceHeader) and <code>unsafe</code> (unsafe.Pointer) packages to achieve this.</p>\n\n<p><a href=\"https://play.golang.org/p/RLrMgoWgI7t\" rel=\"nofollow noreferrer\">https://play.golang.org/p/RLrMgoWgI7t</a></p>\n\n<pre><code>s := []KeyValue{{0, 100}, {1, 101}, {2, 102}, {3, 103}}\nvar data []uint32\nsh := (*reflect.SliceHeader)(unsafe.Pointer(&amp;data))\nsh.Data = uintptr(unsafe.Pointer(&amp;s[0]))\nsh.Len = len(s) * 2\nsh.Cap = sh.Len\nfmt.Println(data)\n</code></pre>\n"}], "owner": {"reputation": 2763, "user_id": 2074467, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/8e3be260bc0d9477984286415c2179ad?s=128&d=identicon&r=PG", "display_name": "replay", "link": "https://stackoverflow.com/users/2074467/replay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 57165532, "answer_count": 3, "score": 1, "last_activity_date": 1563891079, "creation_date": 1563888005, "question_id": 57165116, "link": "https://stackoverflow.com/questions/57165116/properties-of-slice-of-structs-as-function-argument-without-allocating-slice", "title": "Properties of slice of structs as function argument without allocating slice", "body": "<p>I have a slice of structs that looks like:</p>\n\n<pre><code>type KeyValue struct {\n  Key   uint32\n  Value uint32\n}\n\nvar mySlice []Keyvalue\n</code></pre>\n\n<p>This slice <code>mySlice</code> can have a variable length.</p>\n\n<p>I would like to pass all elements of this slice into a function with this signature:</p>\n\n<pre><code>takeKeyValues(keyValue []uint32)\n</code></pre>\n\n<p>Now I could easily allocate a slice of <code>[]uint32</code>, populate it with all the keys/values of the elements in <code>mySlice</code> and then pass that slice as an argument into <code>takeKeyValues()</code>...</p>\n\n<p>But I'm trying to find a way of doing that without any heap allocations, by directly passing all the keys/values on the stack. Is there some syntax trick which allows me to do that?</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1563887922, "post_id": 57164484, "comment_id": 100843862, "body": "Can you provide some context, code, or any additional details? It&#39;s not clear what you&#39;re trying to do or why you would need your Go code to get a notification when an upload is initiated."}, {"owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563888572, "post_id": 57164484, "comment_id": 100844279, "body": "I didn&#39;t think it mattered since all I&#39;ve asked is in the first line of the question, is there a way to know when the upload has started and when has it finished on AWS?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1563888792, "post_id": 57164484, "comment_id": 100844425, "body": "OK, but you&#39;ve already stated that you&#39;re getting notifications when it finishes, so yes, obviously there&#39;s a way to be notified when it&#39;s finished. I&#39;m not aware of any way to be notified by S3 when an upload is started, but again, context could be helpful here, as it is with most technical questions."}, {"owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563889069, "post_id": 57164484, "comment_id": 100844605, "body": "the client sends a request to the backend to upload files, the backend replies with an AWS presigned url for upload, then waits for the upload to be completed through this presigned url, my problem is that the waiting goroutine stands waiting for the upload to be completed and might stand there forever on failure, i could set a timeout for the goroutine but then i have no way to know if the client is still uploading (large files, slow internet etc) or has failed to upload or never used the url."}, {"owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563889108, "post_id": 57164484, "comment_id": 100844639, "body": "maybe there is a way to be notified when the said presigned url has expired then i could tell the goroutine to quit on that event."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563889543, "post_id": 57164484, "comment_id": 100844914, "body": "Why does the goroutine wait at all? I would think the more straightforward design would be to issue the URL and finish, and allow a separate listener to get the notification that an upload was completed. There&#39;s no reason to have one routine do both and wait in between. If you feel you really must wait, just use a timeout to stop waiting when business logic determines it&#39;s safe to assume the upload isn&#39;t going to happen."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1563889681, "post_id": 57164484, "comment_id": 100845003, "body": "Honestly, separating the URL generation from the upload completion has numerous benefits - e.g. what if you have to restart your service while an upload is in progress? What if you have to scale out and run multiple instances of the service, and the one that issued the upload URL isn&#39;t the one that gets the completion notification for it? What if you have two uploads going at once?"}, {"owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563891940, "post_id": 57164484, "comment_id": 100846436, "body": "You are indeed right, my idea was to finish the operation using one api endpoint while in reality having the operation split in two endpoints, one in which you require the presigned urls to upload and the other one in which you confirm that the upload is finished seems like a better way to do things.  As for why I set the goroutine to wait is because the backend has some more stuff to do that can be done only if the upload is succesful."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563894281, "post_id": 57164484, "comment_id": 100847896, "body": "Then it can do that in response to the upload completion notification you&#39;re already getting - there&#39;s no reason for the logic that creates the URL to wait at all."}, {"owner": {"reputation": 1976, "user_id": 11758843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Xe6xW.jpg?s=128&g=1", "display_name": "abdullahkhawer", "link": "https://stackoverflow.com/users/11758843/abdullahkhawer"}, "edited": false, "score": 0, "creation_date": 1600870029, "post_id": 57164484, "comment_id": 113225342, "body": "@mrclx, If you liked any answer and it worked for you, kindly approve it and upvote it as well as recommended by Stack Overflow. Thanks."}], "answers": [{"tags": [], "owner": {"reputation": 1976, "user_id": 11758843, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Xe6xW.jpg?s=128&g=1", "display_name": "abdullahkhawer", "link": "https://stackoverflow.com/users/11758843/abdullahkhawer"}, "is_accepted": false, "score": 1, "last_activity_date": 1563893868, "creation_date": 1563893868, "answer_id": 57166983, "question_id": 57164484, "link": "https://stackoverflow.com/questions/57164484/how-to-get-notification-when-upload-has-started-and-when-it-has-finished/57166983#57166983", "title": "How to get notification when upload has started and when it has finished", "body": "<p>You can create an <strong>AWS CloudWatch rule</strong> for S3 by specifying <em>Simple Storage Service (S3)</em> as Service Name, <em>Object Level Operations</em> as Event Type, <em>PutObject</em> as Specific operation(s) and <em></em> as Specific bucket(s) by name after creating a trail in <strong>AWS CloudTrail</strong> for S3's <em>PutObject</em> operation and specifying your desired target, for example, AWS Lambda function or AWS SNS topic to record the start time of an object upload on AWS S3 bucket.</p>\n\n<p>As soon as the <strong>PutObject API operation</strong> (someone uploads an object) will be performed, it will be <strong>recorded in AWS CloudTrail</strong> if the trail is created already.</p>\n\n<p>Note: You can also use <em>CreateMultipartUpload</em> or <em>UploadPart</em> as Specific operation(s) if required.</p>\n"}], "owner": {"reputation": 164, "user_id": 5547972, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/68a17ce3ae9f0a137e697049ba19f0be?s=128&d=identicon&r=PG&f=1", "display_name": "mrclx", "link": "https://stackoverflow.com/users/5547972/mrclx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1563893868, "creation_date": 1563885870, "last_edit_date": 1563887677, "question_id": 57164484, "link": "https://stackoverflow.com/questions/57164484/how-to-get-notification-when-upload-has-started-and-when-it-has-finished", "title": "How to get notification when upload has started and when it has finished", "body": "<p>I need to know if there's a way to get a notification from AWS S3 when the upload has started.</p>\n\n<p>As of now I've set up aws lambda which notifies my backend when the PUT operation is finished, but I have no way to know when it has started (if it has started at all). This is required because my goroutine waits for the upload to be finished but I have no way to know when it has started, I could put a timeout on the goroutine but it would be tricky for large files and slow internet connections of clients because my backend would consider the operation failed when in reality the client might still be uploading the file.</p>\n"}, {"tags": ["go", "time-complexity"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1563882324, "post_id": 57163339, "comment_id": 100840572, "body": "I&#39;s not the <code>Sequence</code> traversal, which is <code>O(n)</code>, but building the <code>str</code> piecemeal: on each <code>+=</code> the <code>str</code> is copied anew with sufficient allocation of the free space at the end of the new memory block, and then the result of <code>fmt.Sprintf(elem)</code> is appended. That is <code>O(n&#178;)</code> in terms of memory."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1563882367, "post_id": 57163339, "comment_id": 100840596, "body": "In a reasonably up-to-date Go, use <a href=\"https://golang.org/pkg/strings/#Builder\" rel=\"nofollow noreferrer\"><code>strings.Builder</code></a> to carry out tasks like this."}, {"owner": {"reputation": 198, "user_id": 10337548, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-AC4f6TsfoNY/AAAAAAAAAAI/AAAAAAAAAAc/kfipxaAx18Q/photo.jpg?sz=128", "display_name": "Yuval Meshorer", "link": "https://stackoverflow.com/users/10337548/yuval-meshorer"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1563882691, "post_id": 57163339, "comment_id": 100840775, "body": "Thank you for answering and for suggesting a better replacement."}], "answers": [{"comments": [{"owner": {"reputation": 198, "user_id": 10337548, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-AC4f6TsfoNY/AAAAAAAAAAI/AAAAAAAAAAc/kfipxaAx18Q/photo.jpg?sz=128", "display_name": "Yuval Meshorer", "link": "https://stackoverflow.com/users/10337548/yuval-meshorer"}, "edited": false, "score": 0, "creation_date": 1563882551, "post_id": 57163486, "comment_id": 100840693, "body": "Thank you, that answers it! Will mark this answer as correct shortly."}], "tags": [], "owner": {"reputation": 13136, "user_id": 4081336, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/XXiEG.jpg?s=128&g=1", "display_name": "Leandro Caniglia", "link": "https://stackoverflow.com/users/4081336/leandro-caniglia"}, "is_accepted": true, "score": 11, "last_activity_date": 1563882266, "creation_date": 1563882266, "answer_id": 57163486, "question_id": 57163339, "link": "https://stackoverflow.com/questions/57163339/why-is-this-piece-of-code-in-go-on%c2%b2-and-not-on/57163486#57163486", "title": "Why is this piece of code in Go O(n&#178;) and not O(n)?", "body": "<p>Every time you concatenate <code>str += fmt.Sprint(elem)</code> you create a new <code>String</code> that has to transfer (copy) the characters of the prev <code>str</code> into the new one. In step 1 you copy 1 char, in step 2, 2, etc. This gives <code>n(n+1)/2</code> copies. Hence the complexity is <code>O(n^2)</code>.</p>\n"}], "owner": {"reputation": 198, "user_id": 10337548, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-AC4f6TsfoNY/AAAAAAAAAAI/AAAAAAAAAAc/kfipxaAx18Q/photo.jpg?sz=128", "display_name": "Yuval Meshorer", "link": "https://stackoverflow.com/users/10337548/yuval-meshorer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 1, "accepted_answer_id": 57163486, "answer_count": 1, "score": 9, "last_activity_date": 1563882266, "creation_date": 1563881824, "question_id": 57163339, "link": "https://stackoverflow.com/questions/57163339/why-is-this-piece-of-code-in-go-on%c2%b2-and-not-on", "title": "Why is this piece of code in Go O(n&#178;) and not O(n)?", "body": "<p>I'm in the middle of reading <a href=\"https://golang.org/doc/effective_go.html\" rel=\"noreferrer\">Effective Go</a>, and there is a piece of code which I think is <code>O(n)</code> complexity yet it is <code>O(n\u00b2)</code>. Why is this <code>for range</code> loop considered to be <code>O(n\u00b2)</code>?</p>\n\n<p>It is found <a href=\"https://golang.org/doc/effective_go.html#interfaces\" rel=\"noreferrer\">here (under #interfaces)</a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Sequence []int\n...\nfunc (s Sequence) String() string {\n    ...\n    for i, elem := range s { // Loop is O(N\u00b2); will fix that in next example.\n        if i &gt; 0 {\n            str += \" \"\n        }\n        str += fmt.Sprint(elem)\n    }\n    ...\n}\n</code></pre>\n\n<p>The reason I think it is <code>O(n)</code> is because there is only one iteration over <code>s</code>, and the <code>if</code> statement and <code>fmt.Sprint</code> should not be in <code>O(n)</code> complexity.</p>\n"}, {"tags": ["api", "go", "websocket", "timeout", "mattermost"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563895709, "post_id": 57162551, "comment_id": 100848691, "body": "Run the program with the <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">race detector</a> and fix any issues.  Describe in more detail what the program is doing when it has stopped responding.  Is it blocked on the select in the question or somewhere else? If you don&#39;t know what the progrm is doing, then dump the goroutine stacks by ending the program a SIGQUIT."}], "owner": {"reputation": 11, "user_id": 11824079, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/234a45cb9794c1c1071e272bb3b9df7f?s=128&d=identicon&r=PG&f=1", "display_name": "gabkub", "link": "https://stackoverflow.com/users/11824079/gabkub"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 217, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1563974082, "creation_date": 1563879373, "last_edit_date": 1563974082, "question_id": 57162551, "link": "https://stackoverflow.com/questions/57162551/websocket-ping-timeout-freezes-the-mattermost-bot", "title": "Websocket ping timeout freezes the Mattermost &quot;bot&quot;", "body": "<p>I'm creating a Mattermost bot. It stops responding after the websocket connection receives a ping timeout (PingTimeoutChannel) after random periods of time (1 minute, 8 minutes, 2 hours etc.). Mattermost server is v.5.13, API v.4.</p>\n\n<p>The bot connects to the Mattermost API by creating new Client4. Next it logs in as the user and after it creates a Websocket client with the authorization token received. It starts listening on all channels and when it receives an event which is a message directed to him (@botname) it responds automatically (creates model.post).</p>\n\n<p>I chose to use simple username/password authentication for logging in, just as it is in the Mattermost sample bot. However, I tried to rewrite it to the personal access token authentication (as in <a href=\"https://stackoverflow.com/questions/51795115/whats-the-official-way-of-logging-in-with-a-personal-access-token-using-the-cli\">here</a>) because I'd thought it'd solve the timeout problem. However, this solution doesn't work anymore, it gives the \"Invalid or expired session error, please login again\" while trying to login that way.</p>\n\n<p>So I dropped this idea and started searching where the timeout happens. The server pings are ok, the websocket's are not. I tried many ways, to the point where I just reconnect (by creating new Mattermost API and Websocket clients again). The bot still does not respond. I've run out of ideas.</p>\n\n<p>Websocket connection (skipped error handling):</p>\n\n<pre><code>    if config.BotCfg.Port == \"443\" {\n        protocol = \"https\"\n        secure = true\n    }\n\n        config.ConnectionCfg.Client = model.NewAPIv4Client(fmt.Sprintf(\"%s://%s:%s\", protocol, config.BotCfg.Server, config.BotCfg.Port))\n\n\n    user,resp := config.ConnectionCfg.Client.Login(config.BotCfg.BotName, config.BotCfg.Password)\n\n    setBotTeam()\n\n    if limit.Users == nil {\n        limit.SetUsersList()\n    }\n\n    ws := \"ws\"\n    if secure {\n        ws = \"wss\"\n    }\n\n    if Websocket != nil {\n        Websocket.Close()\n    }\n\n    websocket, err := model.NewWebSocketClient4(fmt.Sprintf(\"%s://%s:%s\", ws, config.BotCfg.Server, config.BotCfg.Port), config.ConnectionCfg.Client.AuthToken)\n</code></pre>\n\n<p>Listening function:</p>\n\n<pre><code>        for {\n            select {\n\n            case &lt;-connection.Websocket.PingTimeoutChannel:\n                logs.WriteToFile(\"Websocket ping timeout. Connecting again.\")\n                log.Println(\"Websocket ping timeout. Connecting again.\")\n                mux.Lock()\n                connection.Connect()\n                mux.Unlock()\n\n            case event := &lt;-connection.Websocket.EventChannel:\n                mux.Lock()\n                if event != nil {\n                    if event.IsValid() &amp;&amp; isMessage(event.Event){\n                        handleEvent(event)\n                    }\n                }\n                mux.Unlock()\n            }\n        }\n    }()\n    // block to the go function\n    select {}\n</code></pre>\n\n<p>I expect the bot to run continuously.\nIf you have any suggestions how to fix this issue, I'd really appreciate that!</p>\n\n<p>Edit: As <a href=\"https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n\">Cerise</a> suggested, I added the SIGQUIT to the exit function and ran a race detector. Fixed the data race issue by deleting one if from the case event := [...]. Race detector doesn't report any issues anymore, however the bot still stops responding after some time.</p>\n\n<p>I found out that the first time PingTimeout occurs, the peer stops responding until I restart the app. The reconnection of Websocket doesn't help. However, I don't actually know how to solve this problem or does the solution even exist.</p>\n"}, {"tags": ["go", "time", "offset", "utc"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1563878695, "post_id": 57162166, "comment_id": 100838467, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/26285735/subtracting-time-duration-from-time-in-go\">Subtracting time.Duration from time in Go</a>"}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 0, "creation_date": 1563879655, "post_id": 57162166, "comment_id": 100839023, "body": "How about <code>t.UTC()</code> try <a href=\"https://play.golang.org/p/mqeJh6c9SWJ\" rel=\"nofollow noreferrer\">this: <code>fmt.Println(t.UTC())</code></a>"}, {"owner": {"reputation": 591, "user_id": 5217585, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/717337419278e215621981e14a85f361?s=128&d=identicon&r=PG&f=1", "display_name": "udayakumar", "link": "https://stackoverflow.com/users/5217585/udayakumar"}, "reply_to_user": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 0, "creation_date": 1563879883, "post_id": 57162166, "comment_id": 100839164, "body": "@Adam, It is okay but I need IST current time changed to Indonesia time using UTC+7."}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 3, "creation_date": 1563880159, "post_id": 57162166, "comment_id": 100839315, "body": "To make your question clear, you need to add sample inputs and desired outputs."}], "answers": [{"tags": [], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "is_accepted": false, "score": 3, "last_activity_date": 1564520423, "last_edit_date": 1564520423, "creation_date": 1563880682, "answer_id": 57162973, "question_id": 57162166, "link": "https://stackoverflow.com/questions/57162166/how-to-add-or-sub-utc-offset-value-in-current-time/57162973#57162973", "title": "How to add or sub UTC offset value in current time", "body": "<p>Use <code>time.LoadLocation()</code> to get location information of particular timezone. Then use the <code>.In()</code> method of time object, to convert the current time into expected timezone.</p>\n\n<p>Example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>now := time.Now()\nfmt.Println(\"My place\", now)\n// 2019-07-23 18:14:23.6036439 +0700 +07\n\nlocSingapore, _ := time.LoadLocation(\"Asia/Singapore\")\nnowInSingapore := now.In(locSingapore)\nfmt.Println(\"Singapore\", nowInSingapore)\n// 2019-07-23 19:14:23.6036439 +0800\n\nlocLondon, _ := time.LoadLocation(\"Europe/London\")\nnowInLondon := now.In(locLondon)\nfmt.Println(\"London\", nowInLondon)\n// 2019-07-23 12:14:23.6036439 +0100 BST\n</code></pre>\n\n<p>Explanations:</p>\n\n<ul>\n<li>From code above we can see that <code>time.Now()</code> timezone is <code>+7</code>, it's because I live in West Indonesia.</li>\n<li>But <code>nowInSingapore</code> timezone is <code>+8</code>, it's because the <code>now</code> object are adjusted into singapore timezone.</li>\n<li>And the last one, <code>nowInLondon</code> is showing another different timezone, <code>+1</code>.</li>\n</ul>\n\n<p>And if we compare all of those time, it's essentially same time.</p>\n\n<blockquote>\n  <p><code>18:14:23 WIB (GMT +7)</code> == <code>19:14:23 GMT +8</code> == <code>12:14:23 BST (GMT +1)</code></p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 591, "user_id": 5217585, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/717337419278e215621981e14a85f361?s=128&d=identicon&r=PG&f=1", "display_name": "udayakumar", "link": "https://stackoverflow.com/users/5217585/udayakumar"}, "is_accepted": false, "score": 0, "last_activity_date": 1563947834, "creation_date": 1563947834, "answer_id": 57176152, "question_id": 57162166, "link": "https://stackoverflow.com/questions/57162166/how-to-add-or-sub-utc-offset-value-in-current-time/57176152#57176152", "title": "How to add or sub UTC offset value in current time", "body": "<p>I Solved the issue.</p>\n\n<pre><code>now := time.Now()\n\nfmt.Println(\"now:\", now.Format(\"2006-01-02T15:04:05\"))\n\nUTC_String_Value := \"UTC+7\"\n\nUTC_Split_Value := strings.Split(UTC_String_Value, \"+\")\n\n\ncount, err := strconv.Atoi(UTC_Split_Value [1])\nif err != nil {\n    fmt.Println(err)\n}\n\nresp := now.Add(time.Duration(-count) * time.Hour).Format(\"2006-01-02T15:04:05\") \n//Subract the utc offset value 7 (hours)\n\n\nfmt.Println(\"now:\", now.Format(\"2006-01-02T15:04:05\"))\nfmt.Println(\"resp:\", resp)\n</code></pre>\n\n<p>Output</p>\n\n<pre><code>now: 2019-07-24T11:25:17\nresp: 2019-07-24T04:25:17\n</code></pre>\n"}], "owner": {"reputation": 591, "user_id": 5217585, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/717337419278e215621981e14a85f361?s=128&d=identicon&r=PG&f=1", "display_name": "udayakumar", "link": "https://stackoverflow.com/users/5217585/udayakumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1564520423, "creation_date": 1563878109, "last_edit_date": 1563881102, "question_id": 57162166, "link": "https://stackoverflow.com/questions/57162166/how-to-add-or-sub-utc-offset-value-in-current-time", "title": "How to add or sub UTC offset value in current time", "body": "<p>How can I add or subtract UTC offset (Another time location) value in my current time in GoLang. I tried this link but no use (<a href=\"https://stackoverflow.com/questions/26285735/subtracting-time-duration-from-time-in-go\">example</a>)</p>\n\n<p>Example</p>\n\n<ol>\n<li>My input is \"UTC+7\". I don't know the location. Now I'm in India. </li>\n<li>Now I'm getting India (IST) time. Ex: 2019-07-23T15:23:08, Here I need to add UTC+7 in IST. It's possible?</li>\n</ol>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1563878313, "post_id": 57161404, "comment_id": 100838275, "body": "There is no <code>Save</code> <i>function</i> declared, at least not in the code you shared. You have a <code>Save</code> method declared on the <code>*Database</code> type, therefore you you have to first initialize the receiver type and call the method using a selector expression."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1563878375, "post_id": 57161404, "comment_id": 100838310, "body": "If your experience with Go is very minimal you should go through the whole <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">Tour of Go</a>."}], "answers": [{"tags": [], "owner": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "is_accepted": false, "score": 1, "last_activity_date": 1563885138, "creation_date": 1563885138, "answer_id": 57164292, "question_id": 57161404, "link": "https://stackoverflow.com/questions/57161404/unable-to-use-function-in-another-package-in-go-app/57164292#57164292", "title": "Unable to use function in another package in Go app", "body": "<p>Let's consider that we have a package called <code>demo</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package demo\n\ntype DataBase struct {\n    A int\n    B int\n}\n\n// function example\nfunc DemoFunc(x int) int {\n    y := x + x\n    return  y\n}\n\n// method example\nfunc (db *DataBase) DemoMethod(x int) int  {\n    y:= db.A + db.B + x\n    return y\n}\n</code></pre>\n\n<p>To access a function or a method from main code, we can do the following,</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    dm \"github.com/kamolhasan/stackOverflow/demo\"\n)\n\nfunc main()  {\n    // Now if you want to use the function\n    // DemoFunc() from demo package\n    // You can use it like following\n    value := dm.DemoFunc(34)\n    fmt.Println(value)\n\n    // If you want to use DemoMethod()\n    // from demo package, you need to declare the object first\n    // then call the method like following\n    DB := dm.DataBase{\n        A: 5,\n        B: 10,\n    }\n    value = DB.DemoMethod(34)\n    fmt.Println(value)\n}\n</code></pre>\n\n<p>All you need to solve your problem is, declare an object of <code>*Database</code> type and use the object to call the method. Do something like bellow:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var obj db.Database\nerr := obj.Save(b)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 521, "user_id": 2260733, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gicBs.png?s=128&g=1", "display_name": "Damien Legros", "link": "https://stackoverflow.com/users/2260733/damien-legros"}, "is_accepted": false, "score": 0, "last_activity_date": 1563886060, "creation_date": 1563886060, "answer_id": 57164531, "question_id": 57161404, "link": "https://stackoverflow.com/questions/57161404/unable-to-use-function-in-another-package-in-go-app/57164531#57164531", "title": "Unable to use function in another package in Go app", "body": "<p>The <code>Save()</code> function is attached to a <code>Database</code> struct, not at the package level</p>\n"}], "owner": {"reputation": 31, "user_id": 11520025, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7AtiGk9hnW0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd0RHuJmWPDFAW3vQ0vqKc-e5LMeQ/mo/photo.jpg?sz=128", "display_name": "Jelle Dijkstra", "link": "https://stackoverflow.com/users/11520025/jelle-dijkstra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 241, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1563886060, "creation_date": 1563875577, "question_id": 57161404, "link": "https://stackoverflow.com/questions/57161404/unable-to-use-function-in-another-package-in-go-app", "title": "Unable to use function in another package in Go app", "body": "<p>I have a go app depending on a few packages. However when I try to build my app it says the functions in an imported package are undefined.</p>\n\n<p>File in main package (batch.go) using the functions:</p>\n\n<pre><code>package main\n\nimport (\n    \"reflect\"\n\n    db \"bitbucket.org/b***/go-db\"\n)\n\n// NewBatch creates a new batch\nfunc NewBatch(orderID, employeeID int64) *Batch {\n    return &amp;Batch{\n        OrderID:    orderID,\n        EmployeeID: employeeID,\n        Flag:       true,\n    }\n}\n\n// InsertBatch inserts a batch and all the underlying order lines and additions\nfunc InsertBatch(b *Batch) (*Batch, error) {\n    err := db.Save(b)\n\n    InsertOrderLines(b.ID, b.OrderLines)\n\n    return b, err\n}\n</code></pre>\n\n<p>File in sonicdb (aliased as db) with the functions:</p>\n\n<pre><code>package sonicdb\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"reflect\"\n    \"strings\"\n)\n\n// Scalar holds a scalar value of a database query, i.e. a count on a table\ntype Scalar struct {\n    N int64 `db:\"n\"`\n}\n\n// Repository interface\ntype Repository interface {\n    Get(sql string) ([]interface{}, error)\n    GetAndBind(sql string, i interface{}) ([]interface{}, error)\n    View(from string, criteria []Clause, selectors ...string) ([]interface{}, error)\n    Find(i interface{}, id int64) (interface{}, error)\n    FindAll(i interface{}) ([]interface{}, error)\n    FindBy(i interface{}, criteria []Clause) ([]interface{}, error)\n    FindByOrdered(i interface{}, criteria []Clause, ordering map[string]string) ([]interface{}, error)\n    FindOneBy(i interface{}, criteria []Clause) (interface{}, error)\n    FindOneByOrdered(i interface{}, criteria []Clause, ordering map[string]string) (interface{}, error)\n    First(i interface{}, criteria []Clause) (interface{}, error)\n    Count(i interface{}, criteria []Clause) (int64, error)\n    Save(i interface{}) error\n    Update(i interface{}) error\n    UpdateBy(i interface{}, criteria []Clause) (int64, error)\n    UpdateFields(i interface{}, fields []*Field) error\n    DeleteBy(i interface{}, criteria []Clause) (int64, error)\n    OneToOne(rv reflect.Value, c interface{}, join string) error\n    OneToMany(parent reflect.Value, child interface{}, mappedBy string) error\n    Relations(parent reflect.Value) interface{}\n    MarshalObject(i interface{}) (interface{}, error)\n}\n\n// Save handles a save action for a model\nfunc (db *Database) Save(i interface{}) error {\n    id, err := doInsert(db.DB, i)\n    if err != nil {\n        return err\n    }\n\n    rv := reflect.ValueOf(i)\n    if rv.Type().Kind() == reflect.Ptr {\n        rv = rv.Elem()\n    }\n    for j := 0; j &lt; rv.NumField(); j++ {\n        field := rv.Field(j)\n        fieldType := rv.Type().Field(j)\n\n        if !field.CanAddr() {\n            return fmt.Errorf(\"field `%s` cannot be addressed\", fieldType.Name)\n        }\n\n        if !field.CanSet() {\n            return fmt.Errorf(\"field `%s` cannot be set\", fieldType.Name)\n        }\n\n        if index, ok := fieldType.Tag.Lookup(\"index\"); ok &amp;&amp; index == \"pk\" {\n            field.SetInt(id)\n        }\n    }\n\n    return nil\n}\n\n</code></pre>\n\n<p>Errors:</p>\n\n<pre><code>./batch.go:20:9: undefined: sonicdb.Save\n</code></pre>\n\n<p>The bitbucket.org packages are imported with 'go get bitbucket.org/name' and are now located in '~/go/src/bitbucket.org/name', which should be correct.</p>\n\n<p>The packages ran on the computer of the previous developer of this project but since I took over, it will not build. It is probably an easy fix but my experience with Go is very minimal. What am I doing wrong?</p>\n"}, {"tags": ["go", "kubernetes", "storage"], "answers": [{"tags": [], "owner": {"reputation": 4962, "user_id": 11560878, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ESrYf.png?s=128&g=1", "display_name": "Wytrzyma\u0142y Wiktor", "link": "https://stackoverflow.com/users/11560878/wytrzyma%c5%82y-wiktor"}, "is_accepted": false, "score": 0, "last_activity_date": 1563875604, "creation_date": 1563875604, "answer_id": 57161415, "question_id": 57159924, "link": "https://stackoverflow.com/questions/57159924/how-to-get-the-real-actual-storage-usage-of-pods-on-kubernetes/57161415#57161415", "title": "How to get the real &amp; actual storage usage of pods on Kubernetes?", "body": "<p>There is a way but it might not be a 'straight forward' one.\nIf pods are running in Linux you can execute:</p>\n\n<pre><code>kubectl exec -it &lt;pod&gt; cat /proc/1/io\n</code></pre>\n\n<p>It will return stats regarding the main IO processes. Here is the description of those:</p>\n\n<pre><code>rchar\n-----\n\nI/O counter: chars read\nThe number of bytes which this task has caused to be read from storage. This\nis simply the sum of bytes which this process passed to read() and pread().\nIt includes things like tty IO and it is unaffected by whether or not actual\nphysical disk IO was required (the read might have been satisfied from\npagecache)\n\n\nwchar\n-----\n\nI/O counter: chars written\nThe number of bytes which this task has caused, or shall cause to be written\nto disk. Similar caveats apply here as with rchar.\n\n\nread_bytes\n----------\n\nI/O counter: bytes read\nAttempt to count the number of bytes which this process really did cause to\nbe fetched from the storage layer. Done at the submit_bio() level, so it is\naccurate for block-backed filesystems. &lt;please add status regarding NFS and\nCIFS at a later time&gt;\n\n\nwrite_bytes\n-----------\n\nI/O counter: bytes written\nAttempt to count the number of bytes which this process caused to be sent to\nthe storage layer. This is done at page-dirtying time.\n</code></pre>\n\n<p>You can also get info regarding disk usage of a particular container. It was already described <a href=\"https://stackoverflow.com/questions/53328104/how-to-get-containers-disk-usage-in-kubernetes-without-docker-command\">here</a>.</p>\n\n<p>Please let me know if that helped.</p>\n"}, {"tags": [], "owner": {"reputation": 235, "user_id": 6160175, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca0f9156f6530e315631edce5b41f74?s=128&d=identicon&r=PG&f=1", "display_name": "MelDev", "link": "https://stackoverflow.com/users/6160175/meldev"}, "is_accepted": false, "score": 0, "last_activity_date": 1565169286, "creation_date": 1565169286, "answer_id": 57390928, "question_id": 57159924, "link": "https://stackoverflow.com/questions/57159924/how-to-get-the-real-actual-storage-usage-of-pods-on-kubernetes/57390928#57390928", "title": "How to get the real &amp; actual storage usage of pods on Kubernetes?", "body": "<p>this is very tricky, \nprometheus is scraping some kubelet metrics and just created a grafana dashboard with below parameters and worked : \nQuery : \n  kubelet_volume_stats_used_bytes / kubelet_volume_stats_capacity_bytes * 100\ngrafana legend : \n  {{ namespace }} | {{ persistentvolumeclaim }}</p>\n"}], "owner": {"reputation": 235, "user_id": 6160175, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ca0f9156f6530e315631edce5b41f74?s=128&d=identicon&r=PG&f=1", "display_name": "MelDev", "link": "https://stackoverflow.com/users/6160175/meldev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 421, "favorite_count": 2, "answer_count": 2, "score": 3, "last_activity_date": 1565169286, "creation_date": 1563870707, "last_edit_date": 1563884469, "question_id": 57159924, "link": "https://stackoverflow.com/questions/57159924/how-to-get-the-real-actual-storage-usage-of-pods-on-kubernetes", "title": "How to get the real &amp; actual storage usage of pods on Kubernetes?", "body": "<p>Is there any straight-forward way to get the actual storage usage of pods on Kubernetes? </p>\n\n<p>I've tried to do so using Prometheus, but only the amount of storage allocated to every pod is exposed, not what is really consumed by my application (pods).</p>\n\n<p>I need a way to see how much storage every pod is consuming and reporting that to Prometheus or Grafana.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1563873264, "post_id": 57159758, "comment_id": 100835424, "body": "Your question is not clear, could you just minimize your question with a simple example, so we could understand better. Thank you."}, {"owner": {"reputation": 9, "user_id": 11823216, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-avSYK0SKFag/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd9-EopeosBgNjnZ3oYrf4av7SW4Q/photo.jpg?sz=128", "display_name": "Sobat Binangkit", "link": "https://stackoverflow.com/users/11823216/sobat-binangkit"}, "reply_to_user": {"reputation": 1209, "user_id": 8256506, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PlvCt.png?s=128&g=1", "display_name": "nilsocket", "link": "https://stackoverflow.com/users/8256506/nilsocket"}, "edited": false, "score": 0, "creation_date": 1563873965, "post_id": 57159758, "comment_id": 100835855, "body": "The error is generated in line handler, ok := sym.(func(interface{}) (interface{}, int, error))"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1563874090, "post_id": 57159758, "comment_id": 100835945, "body": "<i>&quot;Can we type cast a specific type (which is loaded from a library) to a more generic type?</i>&quot; No, we can&#39;t."}, {"owner": {"reputation": 9, "user_id": 11823216, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-avSYK0SKFag/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd9-EopeosBgNjnZ3oYrf4av7SW4Q/photo.jpg?sz=128", "display_name": "Sobat Binangkit", "link": "https://stackoverflow.com/users/11823216/sobat-binangkit"}, "edited": false, "score": 0, "creation_date": 1563874118, "post_id": 57159758, "comment_id": 100835965, "body": "which is happen when I try to type cast function I got from library by means of golang plugin library, to a function definition which has empty interface as a parameter and return type."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1563874495, "post_id": 57159758, "comment_id": 100836160, "body": "Also note that <code>v.(T)</code> is a type assertion, not a type cast. There&#39;s no type casting in Go."}], "owner": {"reputation": 9, "user_id": 11823216, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-avSYK0SKFag/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rd9-EopeosBgNjnZ3oYrf4av7SW4Q/photo.jpg?sz=128", "display_name": "Sobat Binangkit", "link": "https://stackoverflow.com/users/11823216/sobat-binangkit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563872295, "creation_date": 1563870128, "last_edit_date": 1563872295, "question_id": 57159758, "link": "https://stackoverflow.com/questions/57159758/type-casting-function-loaded-from-a-library-to-function-with-empty-interface-par", "title": "Type casting function loaded from a library to function with empty interface parameter", "body": "<p>I'm developing a simple plugin system for a web application so that the handler could be loaded and set to a particular path at application startup time. When I use handler with known type, both by the main web app and the module library, everything work as expected. For example when using func(echo.Context) error as the handler signature (I'm using echo labstack framework).</p>\n\n<p>But when I use function signature with empty interface to cater more dynamic client needs such as func(interface{}) (interface{}, int, error), the type conversion is not working.</p>\n\n<p>Can we type cast a specific type (which is loaded from a library) to a more generic type? Or maybe there are other ways to accomplish this? </p>\n\n<pre><code>p, err := plugin.Open(libname)    \nsym, err := p.Lookup(handlerName)\nhandler, ok := sym.(func(interface{}) (interface{}, int, error))\n</code></pre>\n\n<p>Error Message -> invalid type assertion: sym.() (non-interface type \n    func(main.HelloConfig) (interface{}, int, error) on left)</p>\n"}, {"tags": ["go", "dependencies"], "answers": [{"tags": [], "owner": {"reputation": 397, "user_id": 1234577, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hDdLD.jpg?s=128&g=1", "display_name": "masadi zainul", "link": "https://stackoverflow.com/users/1234577/masadi-zainul"}, "is_accepted": false, "score": 0, "last_activity_date": 1563882739, "creation_date": 1563882739, "answer_id": 57163637, "question_id": 57159707, "link": "https://stackoverflow.com/questions/57159707/how-can-i-check-one-package-direct-depends-indirect-depends-on-another/57163637#57163637", "title": "How can I check one package direct depends / indirect depends on another?", "body": "<p>You can use this tool to show golang package dependency :\n<a href=\"https://github.com/hirokidaichi/goviz\" rel=\"nofollow noreferrer\">https://github.com/hirokidaichi/goviz</a> </p>\n"}, {"comments": [{"owner": {"reputation": 556, "user_id": 4782509, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0PLn2.jpg?s=128&g=1", "display_name": "Frank Wang", "link": "https://stackoverflow.com/users/4782509/frank-wang"}, "edited": false, "score": 0, "creation_date": 1564137681, "post_id": 57216833, "comment_id": 100941017, "body": "good tool and good feature for go1.11. But, how can I use it to solve my problem? Your answer seams to print dependencies of project."}, {"owner": {"reputation": 95, "user_id": 8893337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3ed98c5b3212f50965bdcd10c311be9?s=128&d=identicon&r=PG&f=1", "display_name": "qweqweqweqweqw", "link": "https://stackoverflow.com/users/8893337/qweqweqweqweqw"}, "reply_to_user": {"reputation": 556, "user_id": 4782509, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0PLn2.jpg?s=128&g=1", "display_name": "Frank Wang", "link": "https://stackoverflow.com/users/4782509/frank-wang"}, "edited": false, "score": 0, "creation_date": 1564363768, "post_id": 57216833, "comment_id": 100993189, "body": "then you can switch package directory, do then same thing what i just tell you, after you get what you want, remove <code>go.mod</code> &amp; <code>go.sum</code>"}, {"owner": {"reputation": 556, "user_id": 4782509, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0PLn2.jpg?s=128&g=1", "display_name": "Frank Wang", "link": "https://stackoverflow.com/users/4782509/frank-wang"}, "edited": false, "score": 0, "creation_date": 1564473426, "post_id": 57216833, "comment_id": 101032220, "body": "Rule of GO111MODULE in &#39;go help mod&#39; gives me some pain, because our project is under GOPATH for history reason. Do you use &#39;go mod&#39; for your project, it seams to be designed for go project outside of GOPATH?"}, {"owner": {"reputation": 95, "user_id": 8893337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3ed98c5b3212f50965bdcd10c311be9?s=128&d=identicon&r=PG&f=1", "display_name": "qweqweqweqweqw", "link": "https://stackoverflow.com/users/8893337/qweqweqweqweqw"}, "reply_to_user": {"reputation": 556, "user_id": 4782509, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0PLn2.jpg?s=128&g=1", "display_name": "Frank Wang", "link": "https://stackoverflow.com/users/4782509/frank-wang"}, "edited": false, "score": 0, "creation_date": 1564542534, "post_id": 57216833, "comment_id": 101060927, "body": "<code>export GO111MODULE=on</code>, go modules will not open as default, you have to manually open it by set env, no matter it&#39;s gopath object or not, once you had go file in your directory, you can generate go.mod by go modules commands"}], "tags": [], "owner": {"reputation": 95, "user_id": 8893337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3ed98c5b3212f50965bdcd10c311be9?s=128&d=identicon&r=PG&f=1", "display_name": "qweqweqweqweqw", "link": "https://stackoverflow.com/users/8893337/qweqweqweqweqw"}, "is_accepted": false, "score": 1, "last_activity_date": 1564132543, "creation_date": 1564132543, "answer_id": 57216833, "question_id": 57159707, "link": "https://stackoverflow.com/questions/57159707/how-can-i-check-one-package-direct-depends-indirect-depends-on-another/57216833#57216833", "title": "How can I check one package direct depends / indirect depends on another?", "body": "<p>use go modules to magnage your dependencies</p>\n\n<pre><code>&gt; go init # initialize go modules \n&gt; go mod download # download dependencies\n</code></pre>\n\n<p>now you had <code>go.mod</code> file, it included all the dependencies from your go project</p>\n\n<pre><code>&gt; cat go.mod | egrep -v \"(indirect)|(^\\module)|(require)|(\\))\" # list all direct dependencies\n&gt; cat go.mod | egrep \"indirect\" # list all indirect dependencies\n</code></pre>\n"}], "owner": {"reputation": 556, "user_id": 4782509, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0PLn2.jpg?s=128&g=1", "display_name": "Frank Wang", "link": "https://stackoverflow.com/users/4782509/frank-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 880, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1564132543, "creation_date": 1563869938, "last_edit_date": 1563872448, "question_id": 57159707, "link": "https://stackoverflow.com/questions/57159707/how-can-i-check-one-package-direct-depends-indirect-depends-on-another", "title": "How can I check one package direct depends / indirect depends on another?", "body": "<h1>As titled.</h1>\n\n<p>My solution would be </p>\n\n<pre><code>cd $PATH_4_PACKAGE_ONE\ngo list -f '{{ join .Deps \"\\n\" }}' | grep \"$PATH_4_PACKAGE_TWO\"\n</code></pre>\n\n<ol>\n<li>Is there a better solution?</li>\n<li>What if I want find packages in an list of packages depends on any packages from another list of packages?</li>\n</ol>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1563868788, "post_id": 57159355, "comment_id": 100833001, "body": "First you&#39;ll have to define exactly what you mean by &quot;non-alphanumeric of any language.&quot; Not all languages even use an alphabet in writing, such as Chinese. Do you want to convert all Chinese writing to <code>-</code>? Or do you just want to preserve the undecorated Latin alphabet?"}, {"owner": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563868981, "post_id": 57159355, "comment_id": 100833110, "body": "Well, I don&#39;t care about Chinese/Japanese/Korean and so on. The languages that concern me are European, Arabic and Persian which are either left-to-right or right-to-left."}], "answers": [{"comments": [{"owner": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "edited": false, "score": 0, "creation_date": 1563870047, "post_id": 57159385, "comment_id": 100833655, "body": "The regex should also convert space to <code>-</code> so what I was looking for is <code>[^\\p{L}0-9\\s]+|[\\040]</code>. Please update and I&#39;ll accept. Thanks"}, {"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "reply_to_user": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "edited": false, "score": 0, "creation_date": 1563870102, "post_id": 57159385, "comment_id": 100833676, "body": "Why not <code>[^\\p{L}0-9]+</code> without space in excluded set?"}, {"owner": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "edited": false, "score": 0, "creation_date": 1563870286, "post_id": 57159385, "comment_id": 100833788, "body": "As I said, I&#39;d like to make slugs out of the strings, so spaces need to be replaced with <code>-</code>."}, {"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "reply_to_user": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "edited": false, "score": 1, "creation_date": 1563870417, "post_id": 57159385, "comment_id": 100833840, "body": "Like this: <a href=\"https://regex101.com/r/ydHeBf/2/\" rel=\"nofollow noreferrer\">regex101.com/r/ydHeBf/2</a>? I think see what you mean, but I think we could use a simpler regex here :)"}, {"owner": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "edited": false, "score": 0, "creation_date": 1563872947, "post_id": 57159385, "comment_id": 100835237, "body": "Right, this is more elegant!"}, {"owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "reply_to_user": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "edited": false, "score": 0, "creation_date": 1563873282, "post_id": 57159385, "comment_id": 100835437, "body": "Edited, take a look"}], "tags": [], "owner": {"reputation": 21613, "user_id": 580346, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ba17945a06aac247b06548d5afe341e8?s=128&d=identicon&r=PG", "display_name": "mrzasa", "link": "https://stackoverflow.com/users/580346/mrzasa"}, "is_accepted": true, "score": 1, "last_activity_date": 1563873270, "last_edit_date": 1563873270, "creation_date": 1563868781, "answer_id": 57159385, "question_id": 57159355, "link": "https://stackoverflow.com/questions/57159355/how-to-replace-all-non-alphanumeric-of-any-languages/57159385#57159385", "title": "How to replace all non-alphanumeric of any languages?", "body": "<p>Why do you use <code>~</code> at the beginning? If you want to se negated set, use <code>^</code> inside of the brackets: <code>[^...]</code>. Also if you want to replace whitespaces, don't include <code>\\s</code> in the negated set definition:</p>\n\n<pre><code>[^\\p{L}0-9]+\n</code></pre>\n\n<p><a href=\"https://regex101.com/r/ydHeBf/2/\" rel=\"nofollow noreferrer\">Demo</a></p>\n"}], "owner": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 57159385, "answer_count": 1, "score": 0, "last_activity_date": 1563873270, "creation_date": 1563868686, "last_edit_date": 1563868871, "question_id": 57159355, "link": "https://stackoverflow.com/questions/57159355/how-to-replace-all-non-alphanumeric-of-any-languages", "title": "How to replace all non-alphanumeric of any languages?", "body": "<p>Using regex in golang, I'd like to replace all non-alphanumeric characters of any languages with <code>-</code>, in order to make pretty urls:</p>\n\n<p><a href=\"https://play.golang.org/p/CTPw2W13GlP\" rel=\"nofollow noreferrer\">Here</a> is one of many regex that I've tried:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"regexp\"\n)\n\nconst sample = `\u0633\u0644\u0627\u0645 \u062f\u0646\u06cc\u0627 hello world 1 %^&amp;`\n\nfunc main() {\n    var re = regexp.MustCompile(`~[\\p{L}0-9\\s]+`)\n    s := re.ReplaceAllString(sample, `-`)\n    fmt.Println(s)\n} \n</code></pre>\n\n<p>The output should be:\n<code>\u0633\u0644\u0627\u0645-\u062f\u0646\u06cc\u0627-hello-world-1</code></p>\n\n<p>But it does not work. How can I fix it?</p>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1563867049, "post_id": 57158847, "comment_id": 100832120, "body": "That&#39;s what middleware is for. See <a href=\"https://godoc.org/github.com/gorilla/mux#Router.Use\" rel=\"nofollow noreferrer\"><code>Use()</code></a>."}, {"owner": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1563867435, "post_id": 57158847, "comment_id": 100832313, "body": "Thanks. Duplicate once you know that you want to use a middleware :)"}], "owner": {"reputation": 11904, "user_id": 608395, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/624618628f058b51b353c2e0d4735733?s=128&d=identicon&r=PG", "display_name": "andig", "link": "https://stackoverflow.com/users/608395/andig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 20, "favorite_count": 0, "closed_date": 1563867163, "answer_count": 0, "score": 0, "last_activity_date": 1563867105, "creation_date": 1563866920, "last_edit_date": 1563867105, "question_id": 57158847, "link": "https://stackoverflow.com/questions/57158847/how-do-decorate-mux-subrouter-similar-to-http-handler", "closed_reason": "Duplicate", "title": "How do decorate mux subrouter similar to http.Handler?", "body": "<p>I'm using gorilla/mux as HTTP router. While all routes should be gzip-compressed,\nI'd like to decorate the <code>/api</code> routes with JSON headers. I have the handler:</p>\n\n<pre><code>// jsonHandler decorates response with JSON and CORS headers\nfunc jsonHandler(h http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n        // w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n        h.ServeHTTP(w, r)\n    })\n}\n</code></pre>\n\n<p>and the router:</p>\n\n<pre><code>router := mux.NewRouter().StrictSlash(true)\nrouter.HandleFunc(\"/\", h.mkIndexHandler(mc))\n\n// api\napi := router.PathPrefix(\"/api\").Subrouter()\napi.HandleFunc(\"/last\", h.allValuesHandler(mc, mc.Current))\n...\n\nsrv := http.Server{\n    Addr:    url,\n    Handler: handlers.CompressHandler(router),\n}\n</code></pre>\n\n<p>Is it possible to \"decorate\" the api <code>SubRouter</code> with the json headers other than adding them to each individual handler function similar to what <code>handlers.CompressHandler</code> does for the mux root router?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1563867616, "last_edit_date": 1563867616, "creation_date": 1563866597, "answer_id": 57158757, "question_id": 57155776, "link": "https://stackoverflow.com/questions/57155776/go-vet-warning-about-ignoring-context-cancel-function/57158757#57158757", "title": "Go vet warning about ignoring context cancel function", "body": "<blockquote>\n  <p>... <code>the cancel function returned by context.WithTimeout should be called, not discarded, to avoid a context leak</code>.</p>\n  \n  <p>How do I fix the problem or avoid the go vet error message, if there is no problem?</p>\n</blockquote>\n\n<p>By calling, not discarding the <code>cancel</code> function, <a href=\"https://golang.org/pkg/context/#example_WithTimeout\" rel=\"nofollow noreferrer\">as documented</a>:</p>\n\n<pre><code>context, cancel := context.WithTimeout(context.Background(), ForceShutdownAfter*time.Second)\ndefer cancel()\n</code></pre>\n"}], "owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 426, "favorite_count": 0, "accepted_answer_id": 57158757, "answer_count": 1, "score": -3, "last_activity_date": 1563867616, "creation_date": 1563847676, "question_id": 57155776, "link": "https://stackoverflow.com/questions/57155776/go-vet-warning-about-ignoring-context-cancel-function", "title": "Go vet warning about ignoring context cancel function", "body": "<p>I am passing a timeout context to Server.Shutdown (http package). I don't see that I would ever need to call the cancel function returned so I ignore it.  But when I run go vet it says <code>the cancel function returned by context.WithTimeout should be called, not discarded, to avoid a context leak</code>.</p>\n\n<p>How do I fix the problem or avoid the go vet error message, if there is no problem?</p>\n\n<pre><code>    go signalShutdown(server, stopCh)\n\n    if err := server.ListenAndServeTLS(cert, key); err != http.ErrServerClosed {\n        log.Fatalf(\"ListenAndServeTLS() error: %v\\n\", err)\n    }\n    // Note: exit here does not terminate main()\n}\n\n// signalShutdown waits for a notification from the OS that the http server\n// should be shutdown, then gracefully stops it.\nfunc signalShutdown(server *http.Server, stopCh &lt;-chan struct{}) {\n    const ForceShutdownAfter = 10 // Shutdown context times out after this many seconds\n\n    // Setup chan to receive notification of when server should shut down\n    quitCh := make(chan os.Signal, 1)\n    signal.Notify(quitCh, os.Interrupt, syscall.SIGINT, syscall.SIGTERM)\n\n    // Wait until we get a notification to stop the server\n    select {\n    case &lt;-quitCh:\n        log.Println(\"WEB : OS signal received on\", server.Addr)\n    case &lt;-stopCh:\n        log.Println(\"WEB : Shutdown message received on\", server.Addr)\n    }\n\n    context, _ := context.WithTimeout(context.Background(), ForceShutdownAfter*time.Second)\n\n    // Tell the server to shutdown but only after blocking new connections and waiting for the\n    // existing connections to finish (OR if context expires - see ForceShutdownAfter above)\n    if err := server.Shutdown(context); err != nil {\n        log.Fatalf(\"Shutdown() error: %v\", err)\n    }\n\n    os.Exit(0)\n}\n</code></pre>\n"}, {"tags": ["arrays", "go", "slice"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1563860949, "post_id": 57155164, "comment_id": 100829487, "body": "1. What is &quot;a byte array of integers&quot;? A byte array is of bytes. 2. <code>0.0.1</code>, <code>0.0.2</code> and <code>0.0.3</code> are not integers. 3. You&#39;re using slices, not arrays."}], "answers": [{"comments": [{"owner": {"reputation": 133, "user_id": 9362384, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Me5D7ndvXKM/AAAAAAAAAAI/AAAAAAAAADg/noEOiJQPv-E/photo.jpg?sz=128", "display_name": "Melody Anoni", "link": "https://stackoverflow.com/users/9362384/melody-anoni"}, "edited": false, "score": 0, "creation_date": 1563845235, "post_id": 57155394, "comment_id": 100826167, "body": "Thanks for your help! Did you log it and get <code>0.0.3</code>? I tried this and it returned <code>outstring is%!(EXTRA string=0.0.1 0.0.2)  outstring array is %!(EXTRA []string=[0.0.1 0.0.2 ])  Last tag is:</code> where the last tag is nothing"}], "tags": [], "owner": {"reputation": 1446, "user_id": 1930817, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/66Aja.jpg?s=128&g=1", "display_name": "guzmonne", "link": "https://stackoverflow.com/users/1930817/guzmonne"}, "is_accepted": false, "score": 0, "last_activity_date": 1563843825, "creation_date": 1563843825, "answer_id": 57155394, "question_id": 57155164, "link": "https://stackoverflow.com/questions/57155164/how-to-return-the-last-element-in-a-byte-array-of-integers/57155394#57155394", "title": "How to return the last element in a byte array of integers", "body": "<p>The combined output of the <code>git tag</code> command is a list of <code>tags</code> separated by a new line. When you execute the <code>cmd.CombinedOutput()</code> it returns this value but as a <code>[]byte</code>. Now, I believe that what you actually want is a list of strings. So, what you can do is convert the <code>out</code> byte array into a string, and then split it by <code>\\n</code> using the <code>strings.Split()</code> function. Then you can access the last <code>tag</code> by its index.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"strings\"\n)\n\nfunc main() {\n  cmd: = exec.Command(\"git\", \"tag\")\n  out, err: = cmd.CombinedOutput()\n  if err != nil {\n      log.Fatalf(\"cmd.Run() failed with %s\\n\", err)\n  }\n  fmt.Printf(\"Variable Type:\\n%s\\n\", reflect.TypeOf(out))\n  fmt.Printf(\"Variable:\\n%s\\n\", (out))\n\n  outString := string(out)\n  outStringArray := strings.Split(outString, \"\\n\")\n  fmt.Printf(\"Last tag is: %s\", outStringArray[len(outStringArray) - 1])\n}\n</code></pre>\n\n<p>You should see <code>Last tag is: 0.0.3</code> printed in the console in your example.</p>\n\n<p>I hope it helps.</p>\n"}, {"comments": [{"owner": {"reputation": 133, "user_id": 9362384, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Me5D7ndvXKM/AAAAAAAAAAI/AAAAAAAAADg/noEOiJQPv-E/photo.jpg?sz=128", "display_name": "Melody Anoni", "link": "https://stackoverflow.com/users/9362384/melody-anoni"}, "edited": false, "score": 0, "creation_date": 1563849260, "post_id": 57155580, "comment_id": 100826880, "body": "Thank you, this makes perfect sense. Just stared go last week so I found it quite frustrating that it has taken me literally hours to figure out how to do something that I&#39;ve been able to do so simply before. A problem with me, I guess. Not the language."}, {"owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "reply_to_user": {"reputation": 133, "user_id": 9362384, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Me5D7ndvXKM/AAAAAAAAAAI/AAAAAAAAADg/noEOiJQPv-E/photo.jpg?sz=128", "display_name": "Melody Anoni", "link": "https://stackoverflow.com/users/9362384/melody-anoni"}, "edited": false, "score": 0, "creation_date": 1563938975, "post_id": 57155580, "comment_id": 100861938, "body": "No need to be hard on yourself. If there&#39;s a problem here it might be lack of patience, although that is understandable if you found yourself using a new language without wanting to do it (forced because of job, etc)."}], "tags": [], "owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "is_accepted": true, "score": 5, "last_activity_date": 1563845820, "creation_date": 1563845820, "answer_id": 57155580, "question_id": 57155164, "link": "https://stackoverflow.com/questions/57155164/how-to-return-the-last-element-in-a-byte-array-of-integers/57155580#57155580", "title": "How to return the last element in a byte array of integers", "body": "<p>The reason you see: <code>%!(EXTRA uint8=10)</code> is you are calling <code>Printf</code> without a format option. You should just call <code>fmt.Println</code> instead.</p>\n\n<p><code>10</code> is the encoding of the newline character.</p>\n\n<p>Now, the meat of your question:</p>\n\n<p>You have a byte array (slice).</p>\n\n<p>You are trying to interpret it as lines (strings separated by '\\n').</p>\n\n<p>Interpreting a byte array as a string is easy (assuming the bytes do in fact represent a utf-8 string):</p>\n\n<pre><code>// assume buf is []byte\nvar text = string(buf)\n</code></pre>\n\n<p>You want to treat this as a list of strings. Since <code>git tag</code> returns lines, you can split by '\\n' or you can just call <code>strings.Fields</code> which splits by generic whitespace (including newlines); documented here: <a href=\"https://golang.org/pkg/strings/#Fields\" rel=\"noreferrer\">https://golang.org/pkg/strings/#Fields</a></p>\n\n<pre><code>var parts = strings.Fields(text)\n</code></pre>\n\n<p>Now you can easily just get the last element:</p>\n\n<pre><code>parts[len(parts)-1]\n</code></pre>\n\n<p>But for safety you should check the list has some elements, otherwise you will crash on out-of-bounds access.</p>\n\n<pre><code>cmd := exec.Command(\"git\", \"tag\")\nbufOut, err := cmd.Output()\nif err != nil {\n    log.Fatalf(\"cmd.Run() failed with %s\\n\", err)\n}\ntextOut := string(bufOut)\nparts := strings.Fields(textOut)\nif len(parts) == 0 {\n    log.Fatal(\"No tags\")\n}\nreleaseVersion := parts[len(parts)-1]\nfmt.Println(\"release version:\", releaseVersion)\n</code></pre>\n\n<blockquote>\n  <p>WHY DOES THIS GOT TO BE SO COMPLEX? IN JAVASCRIPT I CAN JUST DO pop()</p>\n</blockquote>\n\n<p>It's not really that complex. This is just how computers work. When a program runs, it has a standard output which is essentially a byte stream.</p>\n\n<p>I'm guessing javascript does this step for you automatically:</p>\n\n<pre><code>textOut := string(bufOut)\nparts := strings.Fields(textOut)\n</code></pre>\n\n<p>i.e. converting the program output to a list of strings separated by new lines.</p>\n"}], "owner": {"reputation": 133, "user_id": 9362384, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Me5D7ndvXKM/AAAAAAAAAAI/AAAAAAAAADg/noEOiJQPv-E/photo.jpg?sz=128", "display_name": "Melody Anoni", "link": "https://stackoverflow.com/users/9362384/melody-anoni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 807, "favorite_count": 0, "accepted_answer_id": 57155580, "answer_count": 2, "score": -6, "last_activity_date": 1563860895, "creation_date": 1563840903, "last_edit_date": 1563860895, "question_id": 57155164, "link": "https://stackoverflow.com/questions/57155164/how-to-return-the-last-element-in-a-byte-array-of-integers", "title": "How to return the last element in a byte array of integers", "body": "<p>In Go, I want to find the last element in an array of integers. </p>\n\n<p>I have a list:</p>\n\n<pre><code>    [0.0.1, 0.0.2, 0.0.3]\n</code></pre>\n\n<p>I just want:</p>\n\n<pre><code>    0.0.3\n</code></pre>\n\n<p>Every time I try to return the last element the console returns</p>\n\n<pre><code>    %!(EXTRA uint8=10)\n</code></pre>\n\n<p>Which I assume means I need to convert a byte array to a slice?</p>\n\n<p>Here's my code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>cmd := exec.Command(\"git\", \"tag\")\nout, err := cmd.CombinedOutput()\nif err != nil {\n    log.Fatalf(\"cmd.Run() failed with %s\\n\", err)\n}\nfmt.Printf(\"Variable Type:\\n%s\\n\", reflect.TypeOf(out))\nfmt.Printf(\"Variable:\\n%s\\n\", (out))\n\nslice := out[0: len(out)]\nreleaseVersion := slice[len(slice) - 1]\nfmt.Printf(\"release version:\", releaseVersion)\n</code></pre>\n\n<p>Here's the output:</p>\n\n<pre><code>Variable Type:\n[]uint8\n\nVariable:\n0.0.1\n0.0.2\n0.0.3\n\nrelease version:%!(EXTRA uint8=10)\n</code></pre>\n"}, {"tags": ["go", "uuid", "guid"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1563839884, "post_id": 57154909, "comment_id": 100825273, "body": "Generate UUIDs from a single source. Relying on multiple sources is asking for trouble, unless you want to add some unique &quot;salt&quot; to each source."}, {"owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "edited": false, "score": 0, "creation_date": 1563848622, "post_id": 57154909, "comment_id": 100826768, "body": "When you say multiple instances will be run, do you mean on different systems?  Use <code>uuid.NewV1()</code> to guarantee different UUIDs on different systems (based on MAC address).  Otherwise use <code>NewV3()</code> and make sure you pass a unique name."}, {"owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "edited": false, "score": 1, "creation_date": 1563848866, "post_id": 57154909, "comment_id": 100826816, "body": "BTW Your formatting requirements are just a matter of getting dashes in the right place, using string slice operations."}, {"owner": {"reputation": 397, "user_id": 1234577, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hDdLD.jpg?s=128&g=1", "display_name": "masadi zainul", "link": "https://stackoverflow.com/users/1234577/masadi-zainul"}, "edited": false, "score": 0, "creation_date": 1563882987, "post_id": 57154909, "comment_id": 100840971, "body": "for UUID i think not might be unique if you want to run parallel, solution for that you can use another combination to make it unique and the ID to be quite long char (if the spec can modify)"}], "answers": [{"comments": [{"owner": {"reputation": 455, "user_id": 3543477, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/8878da151e113c7a7bcaccd7952a6b51?s=128&d=identicon&r=PG&f=1", "display_name": "user3543477", "link": "https://stackoverflow.com/users/3543477/user3543477"}, "edited": false, "score": 0, "creation_date": 1565890658, "post_id": 57165514, "comment_id": 101495686, "body": "Thankyou Adrian, your answer helped. I also generated an uuid and reformatted it into the required way which is the second part of the solution for my problem."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1563889279, "last_edit_date": 1592644375, "creation_date": 1563889279, "answer_id": 57165514, "question_id": 57154909, "link": "https://stackoverflow.com/questions/57154909/how-to-generate-a-uuid-in-a-specific-pattern/57165514#57165514", "title": "How to generate a UUID in a specific pattern", "body": "<p>UUIDs are 128 bits; that's a space large enough that collisions are staggeringly unlikely.</p>\n<p>From <a href=\"https://en.wikipedia.org/wiki/Universally_unique_identifier\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Universally_unique_identifier</a>:</p>\n<blockquote>\n<p>When generated according to the standard methods, UUIDs are for practical purposes unique, without depending for their uniqueness on a central registration authority or coordination between the parties generating them, unlike most other numbering schemes. While the probability that a UUID will be duplicated is not zero, it is close enough to zero to be negligible.</p>\n<p>Thus, anyone can create a UUID and use it to identify something with near certainty that the identifier does not duplicate one that has already been, or will be, created to identify something else. Information labeled with UUIDs by independent parties can therefore be later combined into a single database or transmitted on the same channel, with a negligible probability of duplication.</p>\n</blockquote>\n<p>The whole point of UUIDs, the reason they are so large, is to avoid collisions without synchronization. Per the same article, in order to reach a 50% chance of a collision would require:</p>\n<blockquote>\n<p>generating 1 billion UUIDs per second for about 85 years, and a file containing this many UUIDs, at 16 bytes per UUID, would be about 45 exabytes, many times larger than the largest databases currently in existence, which are on the order of hundreds of petabytes.</p>\n</blockquote>\n"}], "owner": {"reputation": 455, "user_id": 3543477, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/8878da151e113c7a7bcaccd7952a6b51?s=128&d=identicon&r=PG&f=1", "display_name": "user3543477", "link": "https://stackoverflow.com/users/3543477/user3543477"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1289, "favorite_count": 1, "accepted_answer_id": 57165514, "answer_count": 1, "score": 1, "last_activity_date": 1563889279, "creation_date": 1563838203, "last_edit_date": 1563866797, "question_id": 57154909, "link": "https://stackoverflow.com/questions/57154909/how-to-generate-a-uuid-in-a-specific-pattern", "title": "How to generate a UUID in a specific pattern", "body": "<p>I am trying to generate a UUID in Go in a specific pattern. The program that I am working on requires various uuids to be generated similar to an existing uuid string. So the program would read an existing uuid (whose format can change in the future) and generate a new uuid in the same format to replace the existing one. </p>\n\n<p>I have used the \"github.com/satori/go.uuid\" package to generate an uuid. The sample code that I am using is below which I found online. </p>\n\n<p>As multiple instances of this programs would be deployed in parallel, I would like to avoid collisions or duplication in the uuids generated. </p>\n\n<pre><code>    package main\n\nimport (\n\"fmt\"\n\"github.com/satori/go.uuid\"\n)\n\nfunc main() {\n    // Creating UUID Version 4\n    // panic on error\n    u1 := uuid.Must(uuid.NewV4(), nil)\n    fmt.Printf(\"UUIDv4: %s\\n\", u1)\n\n    // or error handling\n    u2:= uuid.NewV4()\n\n    fmt.Printf(\"UUIDv4: %s\\n\", u2)\n\n    /* Formats needed: \n    2286664c688130096c9ce9008e4d97fb\n    6abb173a-b134-49f2-aa88-9dff5dab12a1 (This is obtained from the above code)\n    C8-3C-9C-64-61-70-62-B9-34-AC-9A-20-C9-EF-1D-6D\n    */\n}\n</code></pre>\n"}, {"tags": ["javascript", "go", "webassembly"], "comments": [{"owner": {"reputation": 2041, "user_id": 1333724, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/acc5cea42dca926af89f94eb56fbbdbb?s=128&d=identicon&r=PG", "display_name": "maxm", "link": "https://stackoverflow.com/users/1333724/maxm"}, "edited": false, "score": 0, "creation_date": 1563904704, "post_id": 57154587, "comment_id": 100852956, "body": "what version of go are you using?"}, {"owner": {"reputation": 73, "user_id": 9785509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ho1Ph.png?s=128&g=1", "display_name": "Kamil Xovitz", "link": "https://stackoverflow.com/users/9785509/kamil-xovitz"}, "reply_to_user": {"reputation": 2041, "user_id": 1333724, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/acc5cea42dca926af89f94eb56fbbdbb?s=128&d=identicon&r=PG", "display_name": "maxm", "link": "https://stackoverflow.com/users/1333724/maxm"}, "edited": false, "score": 0, "creation_date": 1563922009, "post_id": 57154587, "comment_id": 100859213, "body": "1.12.7 linux/amd64"}, {"owner": {"reputation": 2041, "user_id": 1333724, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/acc5cea42dca926af89f94eb56fbbdbb?s=128&d=identicon&r=PG", "display_name": "maxm", "link": "https://stackoverflow.com/users/1333724/maxm"}, "edited": false, "score": 2, "creation_date": 1563975364, "post_id": 57154587, "comment_id": 100878975, "body": "I&#39;m not entirely sure what&#39;s going on, but it looks like you&#39;re using the wasm_exec at master and you should likely be using the wasm_exec that ships with 1.12. It should be located at <code>&quot;$(go env GOROOT)&#47;misc&#47;wasm&#47;wasm_exec.js&quot;</code>"}, {"owner": {"reputation": 73, "user_id": 9785509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ho1Ph.png?s=128&g=1", "display_name": "Kamil Xovitz", "link": "https://stackoverflow.com/users/9785509/kamil-xovitz"}, "reply_to_user": {"reputation": 2041, "user_id": 1333724, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/acc5cea42dca926af89f94eb56fbbdbb?s=128&d=identicon&r=PG", "display_name": "maxm", "link": "https://stackoverflow.com/users/1333724/maxm"}, "edited": false, "score": 1, "creation_date": 1564007117, "post_id": 57154587, "comment_id": 100893478, "body": "That was it. It works with applicable version."}], "owner": {"reputation": 73, "user_id": 9785509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ho1Ph.png?s=128&g=1", "display_name": "Kamil Xovitz", "link": "https://stackoverflow.com/users/9785509/kamil-xovitz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 571, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1563835222, "creation_date": 1563835222, "question_id": 57154587, "link": "https://stackoverflow.com/questions/57154587/panic-syscall-js-value-call-property-makefuncwrapper-is-not-a-function-got", "title": "panic: syscall/js: Value.Call: property _makeFuncWrapper is not a function, got undefined", "body": "<p>I'm trying to implement in go compiled to webassembly event listener for html button. \nI got js library included:\n<a href=\"https://github.com/golang/go/blob/master/misc/wasm/wasm_exec.js\" rel=\"nofollow noreferrer\">wasm_exec.js</a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    dom \"github.com/siongui/godom/wasm\"\n    \"syscall/js\"\n)\n\nfunc main() {\n\n    // Create a channel that doesn't let our Go program exit\n    c := make(chan bool)\n\n    app := dom.Document.GetElementById(\"app\")     \n    button := dom.Document.CreateElement(\"button\")\n    text := dom.Document.CreateElement(\"span\")\n\n    // Set button text\n    button.Set(\"textContent\", \"Click on me\")\n\n    // Callback for click event\n    var cb js.Func\n    cb = js.FuncOf(func(this js.Value, args []js.Value) interface{} {\n        text.Set(\"textContent\", \"Button was clicked\")\n        return nil\n    })\n\n    js.Global().Get(\"body\").Call(\"getElementById\", \"test01\").Call(\"addEventListener\", \"click\", cb)\n\n    // Add event listener to a button\n    button.Call(\"addEventListener\", \"click\", cb)\n\n    app.Call(\"appendChild\", text)\n    app.Call(\"appendChild\", button)\n\n    &lt;-c\n\n}\n</code></pre>\n\n<p>This go code compiles.\nBut wasm breaks during execution, and all I get in browser console is:</p>\n\n<pre><code>panic: syscall/js: Value.Call: property _makeFuncWrapper is not a function, got undefined wasm_exec.js:41:14\nwasm_exec.js:41:14\ngoroutine 1 [running]: wasm_exec.js:41:14\nsyscall/js.Value.Call(0x7ff8000000000007, 0x207fa, 0x10, 0xc036ed0, 0x1, 0x1, 0x10) wasm_exec.js:41:14\n    /home/kamil/utils/go/src/syscall/js/js.go:299 +0x87 wasm_exec.js:41:14\nsyscall/js.FuncOf(0xc01e030, 0xc01e030, 0xb) wasm_exec.js:41:14\n    /home/kamil/utils/go/src/syscall/js/func.go:46 +0xa wasm_exec.js:41:14\nmain.main() wasm_exec.js:41:14\n    /home/kamil/projects/go-wasm/index.go:23 +0x14 wasm_exec.js:41:14\nexit code: 2\n</code></pre>\n\n<p>Any ideas what I'm doing wrong?</p>\n"}, {"tags": ["go", "amazon-s3", "aws-sdk", "aws-cli"], "comments": [{"owner": {"reputation": 4760, "user_id": 819019, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MiYfP.jpg?s=128&g=1", "display_name": "Taterhead", "link": "https://stackoverflow.com/users/819019/taterhead"}, "edited": false, "score": 2, "creation_date": 1564563260, "post_id": 57154247, "comment_id": 101068564, "body": "is your go code running on aws compute (ec2, lambda)?  If so, what are the ec2 instance types and specs?  Or is your go code running on a computer outside of AWS boundry?"}, {"owner": {"reputation": 101, "user_id": 8143761, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0022b8722e6bea163b17f3cfa97a2d1?s=128&d=identicon&r=PG&f=1", "display_name": "quintin", "link": "https://stackoverflow.com/users/8143761/quintin"}, "reply_to_user": {"reputation": 4760, "user_id": 819019, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MiYfP.jpg?s=128&g=1", "display_name": "Taterhead", "link": "https://stackoverflow.com/users/819019/taterhead"}, "edited": false, "score": 0, "creation_date": 1564595475, "post_id": 57154247, "comment_id": 101086930, "body": "The code is running on a computer outside of AWS - my laptop. The <code>sync</code> command is definitely faster in this environment. I also ran it on a <code>c5.xlarge</code>. My script was slightly slower than the <code>sync</code> command but it got to a point where I just went with the longer running time. In other words, the time delta was better on the EC2 instance."}, {"owner": {"reputation": 4760, "user_id": 819019, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MiYfP.jpg?s=128&g=1", "display_name": "Taterhead", "link": "https://stackoverflow.com/users/819019/taterhead"}, "edited": false, "score": 1, "creation_date": 1564597418, "post_id": 57154247, "comment_id": 101087763, "body": "Another advantage running it inside the AWS boundary is cost.  Because you are billed for all data transferee outside the AWS boundary."}, {"owner": {"reputation": 101, "user_id": 8143761, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0022b8722e6bea163b17f3cfa97a2d1?s=128&d=identicon&r=PG&f=1", "display_name": "quintin", "link": "https://stackoverflow.com/users/8143761/quintin"}, "reply_to_user": {"reputation": 4760, "user_id": 819019, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MiYfP.jpg?s=128&g=1", "display_name": "Taterhead", "link": "https://stackoverflow.com/users/819019/taterhead"}, "edited": false, "score": 0, "creation_date": 1564598680, "post_id": 57154247, "comment_id": 101088329, "body": "Good point. I was only really testing a subset of data on my laptop, then did the big transfer (~3 million files) on the EC2 instance."}], "answers": [{"comments": [{"owner": {"reputation": 101, "user_id": 8143761, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0022b8722e6bea163b17f3cfa97a2d1?s=128&d=identicon&r=PG&f=1", "display_name": "quintin", "link": "https://stackoverflow.com/users/8143761/quintin"}, "edited": false, "score": 0, "creation_date": 1564595643, "post_id": 57274761, "comment_id": 101087004, "body": "The only difference I can tell is using the <code>s3manager.DownloadObjectsIterator</code>? I tried that initially but I did not end up using it because it is practically the same process except it uses multiple goroutines to download one file, instead of multiple goroutines to download multiple files. They are a lot of small files, so I figured only one goroutine per file was necessary, and that I should shoot off multiple requests at once for multiple files. I think the real speed advantage is those concurrent GET requests."}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 2, "last_activity_date": 1564499537, "last_edit_date": 1564499537, "creation_date": 1564499093, "answer_id": 57274761, "question_id": 57154247, "link": "https://stackoverflow.com/questions/57154247/how-to-achieve-performance-of-aws-cli-sync-command-in-aws-sdk/57274761#57274761", "title": "How to Achieve Performance of AWS CLI Sync Command in AWS SDK", "body": "<p>Have you tried using <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/s3manager/\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/service/s3/s3manager/</a>?</p>\n\n<pre><code>iter := new(s3manager.DownloadObjectsIterator)\nvar files []*os.File\ndefer func() {\n    for _, f := range files {\n        f.Close()\n    }\n}()\n\nerr := client.ListObjectsV2PagesWithContext(ctx, &amp;s3.ListObjectsV2Input{\n    Bucket: aws.String(bucket),\n    Prefix: aws.String(prefix),\n}, func(output *s3.ListObjectsV2Output, last bool) bool {\n    for _, object := range output.Contents {\n        nm := filepath.Join(dstdir, *object.Key)\n        err := os.MkdirAll(filepath.Dir(nm), 0755)\n        if err != nil {\n            panic(err)\n        }\n\n        f, err := os.Create(nm)\n        if err != nil {\n            panic(err)\n        }\n\n        log.Println(\"downloading\", *object.Key, \"to\", nm)\n\n        iter.Objects = append(iter.Objects, s3manager.BatchDownloadObject{\n            Object: &amp;s3.GetObjectInput{\n                Bucket: aws.String(bucket),\n                Key:    object.Key,\n            },\n            Writer: f,\n        })\n        files = append(files, f)\n    }\n\n    return true\n})\nif err != nil {\n    panic(err)\n}\n\ndownloader := s3manager.NewDownloader(s)\nerr = downloader.DownloadWithIterator(ctx, iter)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 101, "user_id": 8143761, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0022b8722e6bea163b17f3cfa97a2d1?s=128&d=identicon&r=PG&f=1", "display_name": "quintin", "link": "https://stackoverflow.com/users/8143761/quintin"}, "is_accepted": true, "score": 0, "last_activity_date": 1564595831, "creation_date": 1564595831, "answer_id": 57296503, "question_id": 57154247, "link": "https://stackoverflow.com/questions/57154247/how-to-achieve-performance-of-aws-cli-sync-command-in-aws-sdk/57296503#57296503", "title": "How to Achieve Performance of AWS CLI Sync Command in AWS SDK", "body": "<p>I ended up settling for my script in the initial post. I tried 20 goroutines and that seemed to work pretty well. On my laptop, the initial script is definitely slower than the command line (i7 8-thread, 16 GB RAM, NVME) versus the CLI. However, on the EC2 instance, the difference was small enough that it was not worth my time to optimize it further. I used a <code>c5.xlarge</code> instance in the same region as the S3 server.</p>\n"}], "owner": {"reputation": 101, "user_id": 8143761, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0022b8722e6bea163b17f3cfa97a2d1?s=128&d=identicon&r=PG&f=1", "display_name": "quintin", "link": "https://stackoverflow.com/users/8143761/quintin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 412, "favorite_count": 2, "accepted_answer_id": 57296503, "answer_count": 2, "score": 2, "last_activity_date": 1564595831, "creation_date": 1563832508, "last_edit_date": 1564414198, "question_id": 57154247, "link": "https://stackoverflow.com/questions/57154247/how-to-achieve-performance-of-aws-cli-sync-command-in-aws-sdk", "title": "How to Achieve Performance of AWS CLI Sync Command in AWS SDK", "body": "<p>The <code>aws s3 sync</code> command in the CLI can download a large collection of files very quickly, and I can not achieve the same performance with the AWS Go SDK. I have millions of files in the bucket so this is critical to me. I need to use the list pages command as well so that I can add a prefix which is not supported well by the <code>sync</code> CLI command.</p>\n\n<p>I have tried using multiple goroutines (10 up to 1000) to make requests to the server, but the time is just so much slower compared to the CLI. It takes about 100 ms per file to run the Go <code>GetObject</code> function which is unacceptable for the number of files that I have. I know that the AWS CLI also uses the Python SDK in the backend, so how does it have so much better performance (I tried my script in boto as well as Go).</p>\n\n<p>I am using <code>ListObjectsV2Pages</code> and <code>GetObject</code>. My region is the same as the S3 server's.</p>\n\n<pre><code>    logMtx := &amp;sync.Mutex{}\n    logBuf := bytes.NewBuffer(make([]byte, 0, 100000000))\n\n    err = s3c.ListObjectsV2Pages(\n        &amp;s3.ListObjectsV2Input{\n            Bucket:  bucket,\n            Prefix:  aws.String(\"2019-07-21-01\"),\n            MaxKeys: aws.Int64(1000),\n        },\n        func(page *s3.ListObjectsV2Output, lastPage bool) bool {\n            fmt.Println(\"Received\", len(page.Contents), \"objects in page\")\n            worker := make(chan bool, 10)\n            for i := 0; i &lt; cap(worker); i++ {\n                worker &lt;- true\n            }\n            wg := &amp;sync.WaitGroup{}\n            wg.Add(len(page.Contents))\n            objIdx := 0\n            objIdxMtx := sync.Mutex{}\n            for {\n                &lt;-worker\n                objIdxMtx.Lock()\n                if objIdx == len(page.Contents) {\n                    break\n                }\n                go func(idx int, obj *s3.Object) {\n                    gs := time.Now()\n                    resp, err := s3c.GetObject(&amp;s3.GetObjectInput{\n                        Bucket: bucket,\n                        Key:    obj.Key,\n                    })\n                    check(err)\n                    fmt.Println(\"Get: \", time.Since(gs))\n\n                    rs := time.Now()\n                    logMtx.Lock()\n                    _, err = logBuf.ReadFrom(resp.Body)\n                    check(err)\n                    logMtx.Unlock()\n                    fmt.Println(\"Read: \", time.Since(rs))\n\n                    err = resp.Body.Close()\n                    check(err)\n                    worker &lt;- true\n                    wg.Done()\n                }(objIdx, page.Contents[objIdx])\n                objIdx += 1\n                objIdxMtx.Unlock()\n            }\n            fmt.Println(\"ok\")\n            wg.Wait()\n            return true\n        },\n    )\n    check(err)\n</code></pre>\n\n<p>Many results look like:</p>\n\n<pre><code>Get:  153.380727ms\nRead:  51.562\u00b5s\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 99, "user_id": 5180644, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/0d9c38a6bfdadb33c2ffce6615ab8f97?s=128&d=identicon&r=PG&f=1", "display_name": "utkarsh sharma", "link": "https://stackoverflow.com/users/5180644/utkarsh-sharma"}, "edited": false, "score": 0, "creation_date": 1564001147, "post_id": 57154607, "comment_id": 100891660, "body": "I went through all the suggestions, but what I was hoping for was a way to define a function.  All the above-mentioned methods are only good if the function is already defined. Thanks for responding."}, {"owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "reply_to_user": {"reputation": 99, "user_id": 5180644, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/0d9c38a6bfdadb33c2ffce6615ab8f97?s=128&d=identicon&r=PG&f=1", "display_name": "utkarsh sharma", "link": "https://stackoverflow.com/users/5180644/utkarsh-sharma"}, "edited": false, "score": 0, "creation_date": 1564510122, "post_id": 57154607, "comment_id": 101051965, "body": "As far as I know, that may not works. May I ask you, why u need to do that ? can u give some example in another language that u used like in python or something."}], "tags": [], "owner": {"reputation": 13087, "user_id": 2062973, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/GD1pm.png?s=128&g=1", "display_name": "James", "link": "https://stackoverflow.com/users/2062973/james"}, "is_accepted": false, "score": 2, "last_activity_date": 1563835405, "creation_date": 1563835405, "answer_id": 57154607, "question_id": 57154013, "link": "https://stackoverflow.com/questions/57154013/can-we-dynamically-create-a-function-in-go/57154607#57154607", "title": "Can we dynamically create a function in go?", "body": "<p>If you don't like this as an answer I can move to the comment section, but it's rather long that's why I put here in the answer section.</p>\n\n<ol>\n<li><p><a href=\"https://golang.org/doc/faq#How_do_I_get_dynamic_dispatch_of_methods\" rel=\"nofollow noreferrer\">Dynamically Dispatched Method</a>: The only way to have dynamically dispatched methods is through an interface. Methods on a struct or any other concrete type are always resolved statically. </p></li>\n<li><p><a href=\"http://tleyden.github.io/blog/2016/12/20/understanding-function-closures-in-go/\" rel=\"nofollow noreferrer\">Closure</a>: Go supports anonymous functions, which can form closures. Anonymous functions are useful when you want to define a function inline without having to name it.</p></li>\n<li><p><a href=\"https://stackoverflow.com/questions/14116840/dynamically-call-method-on-interface-regardless-of-receiver-type\">Dyncamically call method on Interface:</a></p></li>\n</ol>\n\n<p>Please let me know if that helps you to understand the concept in golang. </p>\n"}], "owner": {"reputation": 99, "user_id": 5180644, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/0d9c38a6bfdadb33c2ffce6615ab8f97?s=128&d=identicon&r=PG&f=1", "display_name": "utkarsh sharma", "link": "https://stackoverflow.com/users/5180644/utkarsh-sharma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563889365, "creation_date": 1563831079, "last_edit_date": 1563889365, "question_id": 57154013, "link": "https://stackoverflow.com/questions/57154013/can-we-dynamically-create-a-function-in-go", "title": "Can we dynamically create a function in go?", "body": "<p>I'm trying to create a service where a user needs to operate over a data and can manipulate it in numerous ways, so I'm not aware of the manipulations at the time of compiling of my program. One way to achieve this is to give the user a function with data as param. Which landed me in the following direction.</p>\n\n<ol>\n<li>Dynamically create a function</li>\n<li>Dynamically linking a function after compiling it separately. </li>\n</ol>\n\n<p>I'm open to suggestions. If you have other ways to achieve the end goal.</p>\n"}, {"tags": ["go", "go-packages"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1563828327, "post_id": 57153162, "comment_id": 100822082, "body": "What do you mean by &quot;Any vgo command&quot;? If you&#39;re using <code>go1.13beta1</code>, what are you doing with <code>vgo</code>?"}, {"owner": {"reputation": 2124, "user_id": 3006170, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/wFSLc.jpg?s=128&g=1", "display_name": "Svitlana", "link": "https://stackoverflow.com/users/3006170/svitlana"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563900364, "post_id": 57153162, "comment_id": 100851047, "body": "Thank you, Jim. I meant: <code>vgo build</code> , <code>vgo get</code> it parsed my go.mod and gives this error.   I switched to 1.12 as I cannot debug with delve in <code>go1.13beta1</code>, but the error is still the same. Any suggestion - and I am not golang pro, so if you can explain a bit your answers - I would appreciate it :-).   Currently switched to deb - working perfectly... I may stay here despite all the suggestions from pro.   Thank you"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563901482, "post_id": 57153162, "comment_id": 100851544, "body": "<code>vgo</code> was an proof of concept before module support was added to go. Don\u2019t use it any more."}, {"owner": {"reputation": 2124, "user_id": 3006170, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/wFSLc.jpg?s=128&g=1", "display_name": "Svitlana", "link": "https://stackoverflow.com/users/3006170/svitlana"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563906796, "post_id": 57153162, "comment_id": 100853868, "body": "so just go get is the best option?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1563908779, "post_id": 57153162, "comment_id": 100854668, "body": "Yes, the <code>go</code> command supports modules in 1.12 and 1.13 (with some support in older versions too). Read <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/Modules</a> for a quick reference to how to use modules."}, {"owner": {"reputation": 2124, "user_id": 3006170, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/wFSLc.jpg?s=128&g=1", "display_name": "Svitlana", "link": "https://stackoverflow.com/users/3006170/svitlana"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563980343, "post_id": 57153162, "comment_id": 100882129, "body": "ok, thank you! Just fell in love with dep - until I get a serious problem will stick with it."}], "owner": {"reputation": 2124, "user_id": 3006170, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/wFSLc.jpg?s=128&g=1", "display_name": "Svitlana", "link": "https://stackoverflow.com/users/3006170/svitlana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 517, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563826608, "creation_date": 1563826608, "question_id": 57153162, "link": "https://stackoverflow.com/questions/57153162/vgo-build-triggers-unknown-directive-go", "title": "Vgo build triggers &quot;unknown directive: go&quot;?", "body": "<p>Any vgo command shows the same error with parsing go.mod file.\n<code>unknown directive: go\n</code></p>\n\n<p>Here is my go.mod file: </p>\n\n<pre><code>module github.com/SvitlanaShepitsena/surf\n\ngo 1.13\n\nrequire (\n    github.com/PuerkitoBio/goquery v1.5.0\n    github.com/headzoo/surf v1.0.0 // indirect\n    github.com/headzoo/ut v0.0.0-20181013193318-a13b5a7a02ca // indirect\n    gopkg.in/headzoo/surf.v1 v1.0.0\n)\n</code></pre>\n\n<p>I am using  <code>go1.13beta1</code> version.</p>\n"}, {"tags": ["go", "console-application"], "comments": [{"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563820830, "post_id": 57151617, "comment_id": 100818978, "body": "@Adrian: FWIW I don&#39;t think the linked question answers this particular issue. The OP knows how to catch signals, but is confused about stdio behavior in handlers. OP: calling Scanf inside a signal handler is undefined behavior - don&#39;t do that. You&#39;re collecting user input anyway, so have a &quot;quit&quot; command that asks these questions. If you truly care about special behavior during SIGINT, block it around stdio calls"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 0, "creation_date": 1563821485, "post_id": 57151617, "comment_id": 100819295, "body": "@EliBendersky there is no such thing as &quot;inside a signal handler&quot; because there is no first-class discrete notion of a &quot;signal handler&quot; - anything that receives on the channel registered to receive signals can handle them, including <code>main()</code>. Where are you getting the notion that using stdin after receiving a signal is &quot;undefined behavior&quot; or something you shouldn&#39;t do?"}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563824627, "post_id": 57151617, "comment_id": 100820622, "body": "@Adrian: The problem is when the signal interrupts a system call like <code>read</code> (as happens in this case). The artifacts the OP observes are a direct result of that. There&#39;s some discussion of these issues on SO (<a href=\"https://stackoverflow.com/questions/8281763/scanf-loop-and-signal-handler\" title=\"scanf loop and signal handler\">stackoverflow.com/questions/8281763/&hellip;</a>) and more info the man pages"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563825179, "post_id": 57151617, "comment_id": 100820799, "body": "That doesn&#39;t seem to be what&#39;s happening in this case; what&#39;s happening is an application logic problem (the same scan is still pending when sigint is received so the user input is mishandled). The raw signal handler is within the go stdlib and has already returned when the Go code receives the signal on the channel; the Go code does not need to be concerned with the same warnings shown in the linked answer because none of the Go code is truly a &quot;signal handler&quot; in a true sense."}, {"owner": {"reputation": 1, "user_id": 11236690, "user_type": "registered", "profile_image": "https://graph.facebook.com/1229097163907232/picture?type=large", "display_name": "Ivan Golovnyov", "link": "https://stackoverflow.com/users/11236690/ivan-golovnyov"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563870319, "post_id": 57151617, "comment_id": 100833798, "body": "@Adrian, it&#39;s not duplicate question, your link don&#39;t solve my problem"}, {"owner": {"reputation": 1, "user_id": 11236690, "user_type": "registered", "profile_image": "https://graph.facebook.com/1229097163907232/picture?type=large", "display_name": "Ivan Golovnyov", "link": "https://stackoverflow.com/users/11236690/ivan-golovnyov"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563871270, "post_id": 57151617, "comment_id": 100834276, "body": "@Adrian, Cause my case have some command fmt.Printf(&quot;\\nReally quit? [y/n] &gt; &quot;). Your cases don&#39;t have confirmation"}], "owner": {"reputation": 1, "user_id": 11236690, "user_type": "registered", "profile_image": "https://graph.facebook.com/1229097163907232/picture?type=large", "display_name": "Ivan Golovnyov", "link": "https://stackoverflow.com/users/11236690/ivan-golovnyov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 25, "favorite_count": 0, "closed_date": 1563820654, "answer_count": 0, "score": 0, "last_activity_date": 1563961658, "creation_date": 1563819218, "last_edit_date": 1563961658, "question_id": 57151617, "link": "https://stackoverflow.com/questions/57151617/scan-input-in-signal-handler-when-another-scan-is-active", "closed_reason": "Duplicate", "title": "Scan input in signal handler, when another Scan is active", "body": "<p>I write a console quiz on golang, and I must do next case:\nIn case user try to close the app with Ctrl+C, confirmation should be asked.\nBut problem appears, when I ask confirm Really quit? [y/n] I enter y - and it takes this as an answer to the last Scan (in which the answer to the test question was expected).</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"strconv\"\n  //\"bufio\"\n  \"os\"\n  \"syscall\"\n  \"os/signal\"\n  //\"runtime\"\n)\n\nfunc main() {\nc := make(chan os.Signal, 1)\nsignal.Notify(c, syscall.SIGINT) //os.Interrupt\ngo func() {\n  for {\n    select {\n    case &lt;-c:\n      fmt.Printf(\"\\nReally quit? [y/n] &gt; \")\n      var choice string\n      fmt.Scan(&amp;choice)\n\n      if choice == \"y\" {\n        os.Exit(0)\n      }\n    }\n  }\n}()\n        fmt.Println(\"hello\")\n\n    var text string\n    //k:\n    for {\n      fmt.Println(\"What ...?\")  \n      fmt.Scan(&amp;text)//waiting user's answer\n      inp, err := strconv.Atoi(text)\n      if err != nil {\n        fmt.Println(text, \"Invalid number for exit!\")\n        //goto k\n      } else {\n        fmt.Println(inp)\n        os.Exit(0)\n      }\n    }\n\n}\n</code></pre>\n\n<p>I also tried using this:</p>\n\n<pre><code>    var reader = bufio.NewReader(os.Stdin)\n    func myScan() string {   \n        text, _ := reader.ReadString('\\n')\n    return text\n    }\n</code></pre>\n\n<p>I expect then I confirm quit by press \"y\" and after that Enter, program shut down. But program scan \"y\" like a answer on question</p>\n"}, {"tags": ["go", "concurrency", "threadpool", "goroutine"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563816075, "post_id": 57150543, "comment_id": 100816997, "body": "It&#39;s not needed. 1-3 don&#39;t really apply to goroutines, because they&#39;re lightweight and handled intelligently by the scheduler. 4 would only seem to apply if you&#39;re already using a <code>ThreadPool</code>, so since they don&#39;t exist, it seems unnecessary."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563816116, "post_id": 57150543, "comment_id": 100817012, "body": "&quot;Why doesn&#39;t Go offer an equivalent to Threadpool&quot; -- it does. It&#39;s called &quot;the go runtime&quot;"}, {"owner": {"reputation": 708, "user_id": 989827, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2dc4984b386fa22692c93300cfcdb394?s=128&d=identicon&r=PG", "display_name": "jeremie", "link": "https://stackoverflow.com/users/989827/jeremie"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563816607, "post_id": 57150543, "comment_id": 100817202, "body": "@Adrian, can you elaborate, I don&#39;t see how lightness has to do with 3. 3 is about prioritization."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563816990, "post_id": 57150543, "comment_id": 100817358, "body": "Yes, it&#39;s nothing to do with lightness. Go has a single scheduling model, so &quot;customizing the type of scheduling&quot; is a concept that simply does not apply go goroutines."}], "answers": [{"comments": [{"owner": {"reputation": 708, "user_id": 989827, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2dc4984b386fa22692c93300cfcdb394?s=128&d=identicon&r=PG", "display_name": "jeremie", "link": "https://stackoverflow.com/users/989827/jeremie"}, "edited": false, "score": 0, "creation_date": 1563826633, "post_id": 57150716, "comment_id": 100821375, "body": "The need to prioritize some task over other ones should still exist. It&#39;s pretty common that in case of burst, you&#39;d rather do a certain type of work than another no?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 708, "user_id": 989827, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2dc4984b386fa22692c93300cfcdb394?s=128&d=identicon&r=PG", "display_name": "jeremie", "link": "https://stackoverflow.com/users/989827/jeremie"}, "edited": false, "score": 1, "creation_date": 1563828649, "post_id": 57150716, "comment_id": 100822217, "body": "@jeremie: If you need that level of control, you&#39;ll have to do it at the OS level (i.e with two processes, with different priorities). But I wouldn&#39;t say it&#39;s common. In fact, I&#39;d say it&#39;s exceedingly rare."}, {"owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "reply_to_user": {"reputation": 708, "user_id": 989827, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2dc4984b386fa22692c93300cfcdb394?s=128&d=identicon&r=PG", "display_name": "jeremie", "link": "https://stackoverflow.com/users/989827/jeremie"}, "edited": false, "score": 0, "creation_date": 1564588578, "post_id": 57150716, "comment_id": 101083760, "body": "@jeremie This example could be modified relatively easily to handle priorities. Instead of a simple FIFO channel, you could create a struct that represents the job and its priority, and then create a list that is accessed using a mutex. When enqueuing a job you compare the priorities so the highest priority job remains at the head of the queue. As mentioned, there are libraries which give you a lot more control. Goroutines are intentionally very generalized because they can serve any purpose -- a task queue is just one possible usage."}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 5, "last_activity_date": 1563815248, "creation_date": 1563815248, "answer_id": 57150716, "question_id": 57150543, "link": "https://stackoverflow.com/questions/57150543/is-go-offering-an-equivalent-to-threadpool/57150716#57150716", "title": "Is Go offering an equivalent to Threadpool", "body": "<p>As you've guessed, due to (1) being mostly a non-issue in Go, thread/worker pools are much less needed. (2) is also possible to address with techniques like rate limiting and resource semaphores. As for (3), the Go runtime does the goroutine scheduling, so customizing this isn't easy, or idiomatic.</p>\n\n<p>That said, thread/worker pools are extremely easy to implement in Go. Here's a simple example from <a href=\"https://gobyexample.com/worker-pools\" rel=\"noreferrer\">gobyexample</a>:</p>\n\n<pre><code>// In this example we'll look at how to implement\n// a _worker pool_ using goroutines and channels.\n\npackage main\n\nimport \"fmt\"\nimport \"time\"\n\n// Here's the worker, of which we'll run several\n// concurrent instances. These workers will receive\n// work on the `jobs` channel and send the corresponding\n// results on `results`. We'll sleep a second per job to\n// simulate an expensive task.\nfunc worker(id int, jobs &lt;-chan int, results chan&lt;- int) {\n    for j := range jobs {\n        fmt.Println(\"worker\", id, \"started  job\", j)\n        time.Sleep(time.Second)\n        fmt.Println(\"worker\", id, \"finished job\", j)\n        results &lt;- j * 2\n    }\n}\n\nfunc main() {\n\n    // In order to use our pool of workers we need to send\n    // them work and collect their results. We make 2\n    // channels for this.\n    jobs := make(chan int, 100)\n    results := make(chan int, 100)\n\n    // This starts up 3 workers, initially blocked\n    // because there are no jobs yet.\n    for w := 1; w &lt;= 3; w++ {\n        go worker(w, jobs, results)\n    }\n\n    // Here we send 5 `jobs` and then `close` that\n    // channel to indicate that's all the work we have.\n    for j := 1; j &lt;= 5; j++ {\n        jobs &lt;- j\n    }\n    close(jobs)\n\n    // Finally we collect all the results of the work.\n    // This also ensures that the worker goroutines have\n    // finished. An alternative way to wait for multiple\n    // goroutines is to use a [WaitGroup](waitgroups).\n    for a := 1; a &lt;= 5; a++ {\n        &lt;-results\n    }\n}\n</code></pre>\n\n<p>And if you google a bit, you'll find a bunch of 3rd-party packages implementing this pattern for various uses. As you could guess, there's no single best way to do this, so you'll pick whatever is important for your specific use case.</p>\n"}], "owner": {"reputation": 708, "user_id": 989827, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2dc4984b386fa22692c93300cfcdb394?s=128&d=identicon&r=PG", "display_name": "jeremie", "link": "https://stackoverflow.com/users/989827/jeremie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 377, "favorite_count": 0, "accepted_answer_id": 57150716, "answer_count": 1, "score": -2, "last_activity_date": 1563825913, "creation_date": 1563814426, "last_edit_date": 1563825913, "question_id": 57150543, "link": "https://stackoverflow.com/questions/57150543/is-go-offering-an-equivalent-to-threadpool", "title": "Is Go offering an equivalent to Threadpool", "body": "<p>I'm coming from Java/Scala and started using Go recently. In Java/Scala threadpools are pretty common and they'll be used for at least 4 different reasons. </p>\n\n<ol>\n<li>Reuse worker already instantiated</li>\n<li>Resource management. When we have multiple threadpools we can ensure that if there is a burst in one part of the system, it doesn't stop the other parts from running. </li>\n<li>Customize the type of scheduling we'd want (fork/join, classic, scheduled, etc ...) </li>\n<li>Customize <a href=\"https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/RejectedExecutionHandler.html\" rel=\"nofollow noreferrer\">rejection</a> policy. </li>\n</ol>\n\n<p>Since Goroutines are so light <strong>1</strong> is not needed, and even though it would be nice to provide one, we could create some kind of worker pool without too much trouble to address <strong>2</strong>. </p>\n\n<p>However, I feel that in Go we cannot address <strong>3</strong> and <strong>4</strong>. </p>\n\n<p>Is it because it's not needed or is it just a missing functionalty?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563813513, "post_id": 57150285, "comment_id": 100815955, "body": "It looks like that mysql driver is calling <code>log</code> directly, which libraries generally should never do. Unfortunately there is not a lot you can do to prevent that in a single, third-party function call, short of forking the library."}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1563813718, "post_id": 57150285, "comment_id": 100816027, "body": "@Adrian It uses <code>errLog</code> which <i>defaults</i> to some Logger but can be set manually: <a href=\"https://github.com/go-sql-driver/mysql/blob/749ddf1598b47e3cd909414bda735fe790ef3d30/errors.go#L49\" rel=\"nofollow noreferrer\">github.com/go-sql-driver/mysql/blob/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 956, "user_id": 1065306, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/349bdbe6b8212de4cd9fb7a88f0568f2?s=128&d=identicon&r=PG", "display_name": "Nicolas Payart", "link": "https://stackoverflow.com/users/1065306/nicolas-payart"}, "edited": false, "score": 0, "creation_date": 1563870117, "post_id": 57150791, "comment_id": 100833688, "body": "That&#39;s it! For my case, Implementing a custom logger with <code>mysql.SetLogger</code> as described in this issue: <a href=\"https://github.com/go-sql-driver/mysql/issues/956#issuecomment-487807780\" rel=\"nofollow noreferrer\">github.com/go-sql-driver/mysql/issues/&hellip;</a> did the job. thanks"}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 2, "last_activity_date": 1563816229, "last_edit_date": 1563816229, "creation_date": 1563815553, "answer_id": 57150791, "question_id": 57150285, "link": "https://stackoverflow.com/questions/57150285/catch-stderr-output-in-golang/57150791#57150791", "title": "Catch stdErr output in golang", "body": "<p>As the comment by @tkausi suggests, you ought to set a custom logger for the <code>go-sql-driver</code> package with <a href=\"https://godoc.org/github.com/go-sql-driver/mysql#SetLogger\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/go-sql-driver/mysql#SetLogger</a></p>\n\n<p>Your custom logger can then do whatever makes sense for your application, including \"swallowing\" these logging statements and not displaying anything in case of no errors.</p>\n\n<hr>\n\n<p>To answer the question's title, you can capture <code>os.Stderr</code> with something like this:</p>\n\n<pre><code>func doPrint() {\n    fmt.Fprintf(os.Stderr, \"output\")\n}\n\nfunc main() {\n    old := os.Stderr\n    r, w, _ := os.Pipe()\n    os.Stderr = w\n\n    doPrint()\n\n    w.Close()\n    var buf bytes.Buffer\n    io.Copy(&amp;buf, r)\n    os.Stderr = old\n\n    fmt.Println(\"Captured:\", buf.String())\n}\n</code></pre>\n"}], "owner": {"reputation": 956, "user_id": 1065306, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/349bdbe6b8212de4cd9fb7a88f0568f2?s=128&d=identicon&r=PG", "display_name": "Nicolas Payart", "link": "https://stackoverflow.com/users/1065306/nicolas-payart"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 57150791, "answer_count": 1, "score": 0, "last_activity_date": 1563816229, "creation_date": 1563813364, "question_id": 57150285, "link": "https://stackoverflow.com/questions/57150285/catch-stderr-output-in-golang", "title": "Catch stdErr output in golang", "body": "<p>I have written a go program to monitor some MySQL databases.</p>\n\n<p>In the following example, I simply display \"Connection Success!\" when the connection is successful or \"Connection Error:\" followed by the error message in case of failure.</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\nfunc main() {\n    err := mysqlConnect()\n    if err != nil {\n        fmt.Println(\"Connection Error:\", err)\n    } else {\n        fmt.Println(\"Connection Success!\")\n    }\n}\n\nfunc mysqlConnect() error {\n\n    db, err := sql.Open(\"mysql\", \"myuser:mypwd@tcp(10.2.0.3:3306)/mysql\")\n    if err != nil {\n        return err\n    }\n    defer db.Close()\n\n    err = db.Ping()\n    if err != nil {\n        return err\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>This works as expected, but in some cases, some error message appears while executing db.Ping() and is displayed to stdErr:</p>\n\n<p>For example:</p>\n\n<pre><code>$ go run main.go\n[mysql] 2019/07/22 18:01:59 auth.go:293: unknown auth plugin:dialog\nConnection Error: this authentication plugin is not supported\n</code></pre>\n\n<p>The last line is my expected message, but the previous line is displayed when calling db.Ping().</p>\n\n<p>I would like to catch/hide this message <code>[mysql] 2019/07/22 18:01:59 auth.go:293: unknown auth plugin:dialog</code>, as I already gets a clean error message that I can handle as I wish (displaying it or not).</p>\n\n<p>How can I prevent such an error message from appearing (in code I mean, not at the calling time)?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1563812667, "post_id": 57149795, "comment_id": 100815618, "body": "<a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Composite_literals</a> and a related question with a good answer: <a href=\"https://stackoverflow.com/questions/45122905/how-do-struct-and-struct-work-in-go\" title=\"how do struct and struct work in go\">stackoverflow.com/questions/45122905/&hellip;</a>"}, {"owner": {"reputation": 3329, "user_id": 7438973, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/bbf9cd835054e12d27a93ef23194fd1b?s=128&d=identicon&r=PG&f=1", "display_name": "nagendra547", "link": "https://stackoverflow.com/users/7438973/nagendra547"}, "edited": false, "score": 0, "creation_date": 1563847547, "post_id": 57149795, "comment_id": 100826592, "body": "This is a good question, not sure why so many dislike for it."}, {"owner": {"reputation": 826, "user_id": 1916886, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4be82530d3d8f943467b762692020e02?s=128&d=identicon&r=PG", "display_name": "ramires.cabral", "link": "https://stackoverflow.com/users/1916886/ramires-cabral"}, "edited": false, "score": 0, "creation_date": 1571530394, "post_id": 57149795, "comment_id": 103272273, "body": "Upvote, I had the very same doubt. Also don&#39;t understand the downvotes..."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 5, "last_activity_date": 1563811552, "creation_date": 1563811552, "answer_id": 57149857, "question_id": 57149795, "link": "https://stackoverflow.com/questions/57149795/what-does-the-double-curly-brace-mean-in-interface/57149857#57149857", "title": "What does the double curly brace mean in []interface{}{}", "body": "<p><code>[]interface{}</code> is the type: a slice <code>[]</code> of empty interface <code>interface{}</code> (which is actually an anonymous inline type declaration). The second set of braces instantiates an instance of that type, so <code>[]interface{}{}</code> is an empty slice of empty interface, <code>[]interface{}{\"aa\",\"bb\"}</code> is a slice of empty interface with two items. That could also be <code>[]string{\"aa\",\"bb\"}</code>, a slice of string with two items, which is the same thing with a different type (<code>string</code> in place of <code>interface{}</code>).</p>\n\n<p>You could also have a non-empty interface, like <code>[]interface{SomeFunc()}{}</code> being an empty slice of <code>interface{SomeFunc()}</code>, a non-empty anonymous interface type. Or you could do it with an anonymous struct type, like <code>[]struct{Foo string}{{\"bar\"},{\"baz\"}}</code>. Here there's even more braces - the first pair around the type definition body, the second pair around the slice literal, and within that, one pair each around two struct literals.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 5, "last_activity_date": 1563812658, "creation_date": 1563812658, "answer_id": 57150132, "question_id": 57149795, "link": "https://stackoverflow.com/questions/57149795/what-does-the-double-curly-brace-mean-in-interface/57150132#57150132", "title": "What does the double curly brace mean in []interface{}{}", "body": "<p><code>interface{}</code> is the empty interface type</p>\n\n<p><code>[]interface{}</code> is a slice of type empty interface</p>\n\n<p><code>interface{}{}</code> is an empty interface type composite literal</p>\n\n<p><code>[]interface{}{}</code> is a slice of type empty interface composite literals</p>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"noreferrer\">Interface types</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"noreferrer\">Slice types</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"noreferrer\">Composite literals</a></p>\n</blockquote>\n\n<hr>\n\n<p>Take the Go Tour: <a href=\"https://tour.golang.org/welcome/1\" rel=\"noreferrer\">A Tour of Go</a></p>\n"}], "owner": {"reputation": 173, "user_id": 3454396, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d600f837fdd8fe8703615d59dac7ff8d?s=128&d=identicon&r=PG&f=1", "display_name": "user3454396", "link": "https://stackoverflow.com/users/3454396/user3454396"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 870, "favorite_count": 1, "accepted_answer_id": 57149857, "answer_count": 2, "score": -1, "last_activity_date": 1563812658, "creation_date": 1563811305, "question_id": 57149795, "link": "https://stackoverflow.com/questions/57149795/what-does-the-double-curly-brace-mean-in-interface", "title": "What does the double curly brace mean in []interface{}{}", "body": "<p>Please note this is double curly braces in this format{}{}, and not nested curly braces {{}}.  I am also unsure if this is an empty interface issue, a slice issue or a struct issue. I am guessing it is a combination of at least two of these.</p>\n\n<p>I am learning Golang and I have reached empty interfaces. I see I need to declare a slice of empty interfaces as</p>\n\n<pre><code>[]interface{}{}\n</code></pre>\n\n<p>or for instance</p>\n\n<pre><code>[]interface{}{\"aa\",\"bb\"}\n</code></pre>\n\n<p>I don't just want to blindly start using it. Whereas I understand the idea of empty interfaces, and that an interface contains two portions of data, the value and the type, I just don't understand the {}{} structure? I learned that slices are created with make() or for instance\n    []int{}</p>\n\n<p>What is the extra {} for when using empty interfaces?</p>\n\n<p>Thank you</p>\n\n<p>I have googled it, and went through my tutorials. I also compared it to what I know about structs as I suspect a interface is a struct. My attempts to google golang interfaces yields mainly normal interfaces, with which I have no problem.</p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 1, "creation_date": 1563801932, "post_id": 57146925, "comment_id": 100809192, "body": "Is the last snippet what you <i>want</i> to get or what you <i>actually</i> get?"}, {"owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 2, "creation_date": 1563802008, "post_id": 57146925, "comment_id": 100809236, "body": "&quot;How to get a similar result?&quot; \u2013 similar <i>to what</i>?"}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 0, "creation_date": 1563816923, "post_id": 57146925, "comment_id": 100817332, "body": "You don&#39;t show where this output gets generated from, so it&#39;s really hard to know what does the grouping. My guess is that there is some logic doing the grouping later on, and the grouped output is printed. If you print out each scanned line as you read it from the DB, you should see a raw approximation of the pg table"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "reply_to_user": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 0, "creation_date": 1563849295, "post_id": 57146925, "comment_id": 100826887, "body": "@EliBendersky at the moment there is no grouping. I want output as in the example above. Do you have any ideas how I can make it?"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "reply_to_user": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1563849411, "post_id": 57146925, "comment_id": 100826901, "body": "@mkrieger1 hello! In the end of the post you can notice JSON output which I want to generate in my golang application. How to get this kind of result? Do you have any ideas?"}], "answers": [{"tags": [], "owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "is_accepted": true, "score": 0, "last_activity_date": 1563856956, "creation_date": 1563856956, "answer_id": 57156801, "question_id": 57146925, "link": "https://stackoverflow.com/questions/57146925/how-to-group-postgres-data-correctly/57156801#57156801", "title": "How to group Postgres data correctly", "body": "<p>Well, I can't say that it's elegant way, but finally I solve my task:</p>\n\n<pre><code>// Create struct called \"Series\".\ntype Series struct {\n    Name string `json:\"name\"`\n    Data []float64 `json:\"data\"`\n}\n\n// Create struct called \"Specification\".\ntype Specification struct {\n    Category string `json:\"category\"`\n    Questions []string `json:\"questions\"`\n    Series []Series `json:\"series\"`\n}\n\n// Initialize an array of struct.\nvar specifications []Specification\n\n// Initialize several variables.\nvar catogoryName string\nvar arrayQuestionText []string\nvar arrayAgreePercent []float64\nvar arrayDisagreePercent []float64\n\n\nfor rows.Next() {\n    // Check the change in the name of the category.\n    if entry.Category == catogoryName {\n        // Add new elements to arrays.\n        arrayQuestionText = append(arrayQuestionText, entry.QuestionText)\n        arrayDisagreePercent = append(arrayDisagreePercent, entry.DisagreePercent)\n        arrayAgreePercent = append(arrayAgreePercent, entry.AgreePercent)\n    } else {\n        if len(catogoryName) &gt; 0 {\n            // Fill the struct with data.\n            specification := Specification{\n                Category: catogoryName,\n                Questions: arrayQuestionText,\n                Series: []Series{\n                    {\n                        Name: \"Agree, %\",\n                        Data: arrayAgreePercent,\n                    },\n                    {\n                        Name: \"Disagree, %\",\n                        Data: arrayDisagreePercent,\n                    },\n                },\n            }\n\n            // Add new struct to array.\n            specifications = append(specifications, specification)\n        }\n    }\n    // Update data in arrays.\n    catogoryName = entry.Category\n    arrayQuestionText = nil\n    arrayQuestionText = append(arrayQuestionText, entry.QuestionText)\n    arrayDisagreePercent = nil\n    arrayDisagreePercent = append(arrayDisagreePercent, entry.DisagreePercent)\n    arrayAgreePercent = nil\n    arrayAgreePercent = append(arrayAgreePercent, entry.AgreePercent)\n}\n</code></pre>\n"}], "owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 57156801, "answer_count": 1, "score": -1, "last_activity_date": 1563856956, "creation_date": 1563801357, "last_edit_date": 1563849040, "question_id": 57146925, "link": "https://stackoverflow.com/questions/57146925/how-to-group-postgres-data-correctly", "title": "How to group Postgres data correctly", "body": "<p>In PostgreSQL, I have such table:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>| QUESTION_TEXT                          | CATEGORY | AGREE_PERCENT | DISAGREE_PERCENT |\n|----------------------------------------|----------|---------------|------------------|\n| Do you support the President's policy? | Policy   | 50            | 50               |\n| Do you support Democrats?              | Policy   | 32            | 68               |\n| Do you support the Lannisters?         | Cinema   | 45            | 55               |\n| Do you support Spielberg's work?       | Cinema   | 60            | 40               |\n</code></pre>\n\n<p>In my Go application with the help of <a href=\"http://gorm.io/\" rel=\"nofollow noreferrer\">gorm library</a> I make SQL request to PostgreSQL database like that:</p>\n\n<pre><code>type Entry struct {\n     QuestionText string `json:\"question_text\"`\n     Category string `json:\"category\"`\n     AgreePercent float64 `json:\"agree_percent\"`\n     DisagreePercent float64 `json:\"disagree_percent\"`\n}\n\nrows, _ := database.DBGORM.Raw(\"SELECT * FROM SPECIFICATION\").Rows()\n\nfor rows.Next() {\n     entry := &amp;Entry{}\n\n     if err = rows.Scan(&amp;entry.QuestionText, &amp; entry.Category,  &amp;entry.AgreePercent, &amp;entry.DisagreePercent); err != nil {\n          utils.Logger().Println(err)   \n     }\n}\n</code></pre>\n\n<p>How to get a similar result? As you can see each object inside the array is grouped by value in the <code>category</code> column:</p>\n\n<pre><code>[\n     {\n          category: \"Policy\",\n          questions: [\"Do you support the President's policy?\", \"Do you support Democrats?\"],\n          series: [\n               {\n                    name: \"Agree, %\",\n                    data: [50, 32]\n               },\n               {\n                    name: \"Disagree, %\",\n                    data: [50, 68]\n               },\n          ] \n     },\n     {\n          category: \"Cinema\",\n          questions: [\"Do you support the Lannisters?\", \"Do you support Spielberg's work?\"],\n          series: [\n               {\n                    name: \"Agree, %\",\n                    data: [45, 60]\n               },\n               {\n                    name: \"Disagree, %\",\n                    data: [55, 40]\n               },\n          ] \n     },\n]\n</code></pre>\n"}, {"tags": ["go", "reflect"], "comments": [{"owner": {"reputation": 1, "user_id": 11819009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7b225b68d5486c0d702b68e2054f6fe?s=128&d=identicon&r=PG&f=1", "display_name": "wusuoweimain", "link": "https://stackoverflow.com/users/11819009/wusuoweimain"}, "edited": false, "score": 0, "creation_date": 1563847127, "post_id": 57146301, "comment_id": 100826518, "body": "Thank you very much. It works."}], "answers": [{"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1563810077, "post_id": 57146921, "comment_id": 100814364, "body": "Just FYI, <code>Elem</code> does not &quot;achieve setability&quot;, calling Elem on a non-settable value will not make it settable. Instead, in this case, Elem returns the <code>reflect.Value</code> representation of the <i>struct</i> value pointed to by <code>&amp;t</code>. This is necessary because calling <code>FieldByName</code> on a <code>reflect.Value</code> representation of a <i>pointer</i> will panic since pointers do not have fields."}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 3, "last_activity_date": 1563812305, "last_edit_date": 1563812305, "creation_date": 1563801336, "answer_id": 57146921, "question_id": 57146301, "link": "https://stackoverflow.com/questions/57146301/using-reflect-how-to-set-value-to-a-struct-field-pointer/57146921#57146921", "title": "Using reflect, how to set value to a struct field (pointer)", "body": "<pre><code>type ts struct {\n    B *int    //field must be exported\n}\n\nfunc main() {\n    var t ts\n    foo := 5\n    a := &amp;foo\n    //Use Elem() to indirect through the pointer and get struct field\n    //Use reflect.ValueOf(a) to satisfy Set() signature\n    reflect.ValueOf(&amp;t).Elem().FieldByName(\"B\").Set(reflect.ValueOf(a))\n    fmt.Println(*t.B)\n}\n</code></pre>\n\n<p>Playground <a href=\"https://play.golang.org/p/gZt0ahTZMIi\" rel=\"nofollow noreferrer\">https://play.golang.org/p/gZt0ahTZMIi</a></p>\n"}], "owner": {"reputation": 1, "user_id": 11819009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7b225b68d5486c0d702b68e2054f6fe?s=128&d=identicon&r=PG&f=1", "display_name": "wusuoweimain", "link": "https://stackoverflow.com/users/11819009/wusuoweimain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 836, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1563812305, "creation_date": 1563799333, "question_id": 57146301, "link": "https://stackoverflow.com/questions/57146301/using-reflect-how-to-set-value-to-a-struct-field-pointer", "title": "Using reflect, how to set value to a struct field (pointer)", "body": "<p>I try to set  value to  a struct field (pointer field) by reflect, but  failed.</p>\n\n<ol>\n<li>I get the name of a struct field,  so use FieldByName to get the field</li>\n<li>The field is a pointer.</li>\n<li>I try to use FieldByName().Set  FieldByName().SetPointer to set value.</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type t struct {\n    b *int\n}\n\nfunc main() {\n    t := new(ts)\n    a := new(int)\n    ss := reflect.ValueOf(t).FieldByName(\"b\").Set(a)\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type t struct {\n    b *int\n}\n\nfunc main() {\n    t := new(ts)\n    a := new(int)\n    ss := reflect.ValueOf(t).FieldByName(\"b\").SetPointer(a)\n}\n\n</code></pre>\n\n<p>First code:\n=======>\n./test.go:14:50: cannot use a (type *int) as type reflect.Value in argument to reflect.ValueOf(t).FieldByName(\"b\").Set\n./test.go:14:50: reflect.ValueOf(t).FieldByName(\"b\").Set(a) used as value</p>\n\n<p>Second code:\n=======>\n./test.go:14:57: cannot use a (type *int) as type unsafe.Pointer in argument to reflect.ValueOf(t).FieldByName(\"b\").SetPointer\n./test.go:14:57: reflect.ValueOf(t).FieldByName(\"b\").SetPointer(a) used as value</p>\n\n<p>I want to use reflect to make  the pointer field (name \"b\")  alloced a space and set a value.</p>\n"}, {"tags": ["go", "go-modules", "go-micro"], "comments": [{"owner": {"reputation": 516, "user_id": 669789, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6ef19f6d112f25ef31d12d7414c4e677?s=128&d=identicon&r=PG", "display_name": "Sabarish", "link": "https://stackoverflow.com/users/669789/sabarish"}, "edited": false, "score": 0, "creation_date": 1578426495, "post_id": 57146199, "comment_id": 105432394, "body": "Is this issue resolved? I too get same error in intellij IDE with go plugin"}], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 0, "last_activity_date": 1563803039, "creation_date": 1563803039, "answer_id": 57147400, "question_id": 57146199, "link": "https://stackoverflow.com/questions/57146199/build-command-line-arguments-cannot-load-local-package-cannot-find-module-prov/57147400#57147400", "title": "build command-line-arguments: cannot load local package: cannot find module providing package", "body": "<p>How does the <code>go.mod</code> file of <code>repoA</code> look?</p>\n\n<p>Imports should always be absolute, e.g.:</p>\n\n<pre><code>import \"github.com/Himanshu/repoB\"\n</code></pre>\n\n<p>Then, in <code>repoA</code>'s <code>go.mod</code> file you can add a <code>replace</code> directive to point \"github.com/Himanshu/repoB\" to a local path (could be relative).</p>\n\n<p>Make sure to read the relevant parts of the <a href=\"https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive\" rel=\"nofollow noreferrer\">Modules wiki</a> and the <a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">official blog post on modules</a></p>\n"}, {"tags": [], "owner": {"reputation": 516, "user_id": 669789, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/6ef19f6d112f25ef31d12d7414c4e677?s=128&d=identicon&r=PG", "display_name": "Sabarish", "link": "https://stackoverflow.com/users/669789/sabarish"}, "is_accepted": false, "score": 0, "last_activity_date": 1578433623, "creation_date": 1578433623, "answer_id": 59636516, "question_id": 57146199, "link": "https://stackoverflow.com/questions/57146199/build-command-line-arguments-cannot-load-local-package-cannot-find-module-prov/59636516#59636516", "title": "build command-line-arguments: cannot load local package: cannot find module providing package", "body": "<p>After doing couple of things the issue got resolved with my IntelliJ. </p>\n\n<ol>\n<li>Initialize the go module in the project and  </li>\n<li>Refer package with absolute path.</li>\n</ol>\n\n<p>I have 2 folders -> repoA and repoB which are present in folder c:\\goprograms. Run <code>go mod init examplegoprogram.com/app</code>. Now, I see go.mod file in goprograms folder with content <code>module examplegoprogram.com/app</code>. In repoA, you can now refer repoB as <code>import \"examplegoprogram.com/app/repoB\"</code></p>\n\n<p>If you are using new Intellij Ultimate, enable go modules under Project settings <code>Alt + Ctrl + S</code> Languages &amp; Frameworks -> Go -> Go Modules</p>\n"}], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 4892, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1578433623, "creation_date": 1563798941, "question_id": 57146199, "link": "https://stackoverflow.com/questions/57146199/build-command-line-arguments-cannot-load-local-package-cannot-find-module-prov", "title": "build command-line-arguments: cannot load local package: cannot find module providing package", "body": "<p>I am unable to load local package using go mod. I have seperate go.mod files for repoA and repoB. I have found no solution anywhere. OS is windows.</p>\n\n<pre><code>$&gt; go version\ngo version go1.12.7 windows/amd64\n</code></pre>\n\n<p>I have two modules with repository, when I run main file from <strong>repoA</strong>. It will try to find module/package of <strong>repoB</strong>, then it throws an error saying </p>\n\n<blockquote>\n  <p>cannot find module providing package</p>\n</blockquote>\n\n<p>My repo structure :-</p>\n\n<pre><code>\ufffd\ufffd\ufffd\ufffdrepoA\n\ufffd   \ufffd\ufffd\ufffd\ufffdproto\n\ufffd   \ufffd   \ufffd\ufffd\ufffd\ufffdsystem\n\ufffd   \ufffd\ufffd\ufffd\ufffdsauth\n\ufffd   \ufffd\ufffd\ufffd\ufffdshandle\n\ufffd   \ufffd\ufffd\ufffd\ufffdsmodel\n\ufffd   \ufffd\ufffd\ufffd\ufffdsresponse\n\ufffd\ufffd\ufffd\ufffdrepoB\n    \ufffd\ufffd\ufffd\ufffdcommon\n    \ufffd\ufffd\ufffd\ufffdconfig\n    \ufffd\ufffd\ufffd\ufffdproto\n        \ufffd\ufffd\ufffd\ufffdaccount\n        \ufffd\ufffd\ufffd\ufffdauth\n        \ufffd\ufffd\ufffd\ufffdsession\n</code></pre>\n"}, {"tags": ["go", "go-modules"], "answers": [{"comments": [{"owner": {"reputation": 2576, "user_id": 631612, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/b7d2a769fa193f9efa36668148deb9f5?s=128&d=identicon&r=PG", "display_name": "quanta", "link": "https://stackoverflow.com/users/631612/quanta"}, "edited": false, "score": 0, "creation_date": 1563801218, "post_id": 57144920, "comment_id": 100808781, "body": "2 things: 1. it didn&#39;t work (same error as above). 2. Even if it works, it&#39;s just a hack. What if I have 100 dependent projects, I have to update all of them when release a new tag?"}, {"owner": {"reputation": 1650, "user_id": 4399634, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001746244457/picture?type=large", "display_name": "frankegoesdown", "link": "https://stackoverflow.com/users/4399634/frankegoesdown"}, "reply_to_user": {"reputation": 2576, "user_id": 631612, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/b7d2a769fa193f9efa36668148deb9f5?s=128&d=identicon&r=PG", "display_name": "quanta", "link": "https://stackoverflow.com/users/631612/quanta"}, "edited": false, "score": 0, "creation_date": 1563801906, "post_id": 57144920, "comment_id": 100809173, "body": "@quanta I Update answer. Try it"}, {"owner": {"reputation": 1650, "user_id": 4399634, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001746244457/picture?type=large", "display_name": "frankegoesdown", "link": "https://stackoverflow.com/users/4399634/frankegoesdown"}, "reply_to_user": {"reputation": 2576, "user_id": 631612, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/b7d2a769fa193f9efa36668148deb9f5?s=128&d=identicon&r=PG", "display_name": "quanta", "link": "https://stackoverflow.com/users/631612/quanta"}, "edited": false, "score": 0, "creation_date": 1563802182, "post_id": 57144920, "comment_id": 100809352, "body": "@quanta last Examle is: 1. remove <code>go.mod</code> and <code>go.sum</code> 2. <code>go cache clean</code> 3. <code>go mod vendor</code>  It helps me in similar situatuon"}, {"owner": {"reputation": 2576, "user_id": 631612, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/b7d2a769fa193f9efa36668148deb9f5?s=128&d=identicon&r=PG", "display_name": "quanta", "link": "https://stackoverflow.com/users/631612/quanta"}, "edited": false, "score": 0, "creation_date": 1563802503, "post_id": 57144920, "comment_id": 100809552, "body": "Why <code>go mod vendor</code>? The problem is when I run <code>go get -v ...@v3.0.2</code> it happened again."}], "tags": [], "owner": {"reputation": 1650, "user_id": 4399634, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001746244457/picture?type=large", "display_name": "frankegoesdown", "link": "https://stackoverflow.com/users/4399634/frankegoesdown"}, "is_accepted": false, "score": 0, "last_activity_date": 1563802468, "last_edit_date": 1563802468, "creation_date": 1563794248, "answer_id": 57144920, "question_id": 57143771, "link": "https://stackoverflow.com/questions/57143771/go-mod-has-post-v0-module-path-git-example-com-owner-repo-v3-at-revision/57144920#57144920", "title": "go.mod has post-v0 module path &quot;git.example.com/owner/repo/v3&quot; at revision ...?", "body": "<p>for example you can replace repository with this hack: <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/Modules</a></p>\n\n<pre><code>require {\n...\n}\n\nreplace git.example.com/owner.repo v0.1.2 =&gt; git.example.com/owner.repo v3.0.2\n</code></pre>\n\n<p>or you can use <code>go get</code> at the commit hash you want:</p>\n\n<p><code>go get git.example.com/owner.repo@af044c0995fe</code></p>\n\n<p><code>go get</code> will correctly update the dependency files (go.mod, go.sum).</p>\n\n<p>For more information: <a href=\"https://github.com/golang/go/wiki/Modules#how-to-upgrade-and-downgrade-dependencies\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/Modules#how-to-upgrade-and-downgrade-dependencies</a></p>\n\n<p>or for last example you should clean cache</p>\n\n<ol>\n<li>remove <code>go.mod</code> and <code>go.sum</code></li>\n<li><code>go cache clean</code></li>\n<li><code>go mod vendor</code></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 6986, "user_id": 1017224, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fcba4f17c4b26be422b6ef62679b0ae?s=128&d=identicon&r=PG", "display_name": "flesk", "link": "https://stackoverflow.com/users/1017224/flesk"}, "edited": false, "score": 0, "creation_date": 1578519149, "post_id": 57159514, "comment_id": 105469365, "body": "Thank you! This finally saved me from a ton of frustration. :D"}], "tags": [], "owner": {"reputation": 2576, "user_id": 631612, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/b7d2a769fa193f9efa36668148deb9f5?s=128&d=identicon&r=PG", "display_name": "quanta", "link": "https://stackoverflow.com/users/631612/quanta"}, "is_accepted": true, "score": 4, "last_activity_date": 1564914824, "last_edit_date": 1564914824, "creation_date": 1563869227, "answer_id": 57159514, "question_id": 57143771, "link": "https://stackoverflow.com/questions/57143771/go-mod-has-post-v0-module-path-git-example-com-owner-repo-v3-at-revision/57159514#57159514", "title": "go.mod has post-v0 module path &quot;git.example.com/owner/repo/v3&quot; at revision ...?", "body": "<p>Please pay attention to my <code>go get</code> command:</p>\n\n<pre><code>go get -v git.example.com/owner/repo@v3.0.2\n</code></pre>\n\n<p>It should be:</p>\n\n<pre><code>go get -v git.example.com/owner/repo/v3@v3.0.2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2653, "user_id": 11210494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f24d82ad87e7e92592ede8c31c52748e?s=128&d=identicon&r=PG&f=1", "display_name": "typical182", "link": "https://stackoverflow.com/users/11210494/typical182"}, "is_accepted": false, "score": 0, "last_activity_date": 1564875408, "last_edit_date": 1564875408, "creation_date": 1564873252, "answer_id": 57342643, "question_id": 57143771, "link": "https://stackoverflow.com/questions/57143771/go-mod-has-post-v0-module-path-git-example-com-owner-repo-v3-at-revision/57342643#57342643", "title": "go.mod has post-v0 module path &quot;git.example.com/owner/repo/v3&quot; at revision ...?", "body": "<p>Expanding on the <a href=\"https://stackoverflow.com/a/57159514/11210494\">answer</a> from @quanta...</p>\n\n<p>You are doing:</p>\n\n<p><code>go get -v git.example.com/owner/repo@v3.0.2</code></p>\n\n<p>Because it is a v3 module, the <code>go get</code> command should include a <code>/v3</code> before the <code>@</code>:</p>\n\n<p><code>go get -v git.example.com/owner/repo/v3@v3.0.2</code></p>\n\n<p>Once a v3.x.y package is a module with its own go.mod, then whenenver you are operating with <a href=\"https://github.com/golang/go/wiki/Modules#when-do-i-get-old-behavior-vs-new-module-based-behavior\" rel=\"nofollow noreferrer\">modules enabled</a>, you pretty much always include the <code>/v3</code> whenever you reference the v3.x.y module, including in:</p>\n\n<ul>\n<li>arguments to <code>go get</code> on the command line</li>\n<li>import statements in <code>.go</code> code for the consumer</li>\n<li><code>require</code> statements in a consumer's go.mod</li>\n<li><code>replace</code> or <code>exclude</code> statements in a consumer's go.mod</li>\n<li>the <code>module</code> line of the v3 module's go.mod file</li>\n<li>internal import statements in <code>.go</code> code inside the v3 module importing other packages in the v3 module</li>\n<li>etc.</li>\n</ul>\n\n<p>One way to think about it is that the module's name is now effectively <code>git.example.com/owner/repo/v3</code>, where its name includes the trailing <code>/v3</code>.</p>\n\n<p>If you are a consumer of a <code>vN</code> module and need to update your import paths in your <code>.go</code> files to include the <code>vN</code>, then \n<a href=\"https://github.com/marwan-at-work/mod\" rel=\"nofollow noreferrer\">github.com/marwan-at-work/mod</a> is a commonly used tool from the community that automates adding the <code>/vN</code> in all the required spots.  Separately, it also automates placing the <code>/vN</code> in all the required spots if you are a module author for a v2+ module.</p>\n\n<p>From the <a href=\"https://github.com/golang/go/wiki/Modules#semantic-import-versioning\" rel=\"nofollow noreferrer\">\"Semantic Import Versioning\"</a> section of the Go modules wiki:</p>\n\n<blockquote>\n  <p>If the module is version v2 or higher, the major version of the module <em>must</em> be included as a /vN at the end of the module paths used in go.mod files (e.g., <code>module github.com/my/mod/v2</code>, <code>require github.com/my/mod/v2 v2.0.0</code>) and in the package import path (e.g., <code>import \"github.com/my/mod/v2/mypkg\"</code>).</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 596, "user_id": 1983554, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8f5a8f555ba614299c1e0de8688d15cc?s=128&d=identicon&r=PG", "display_name": "Karl Pokus", "link": "https://stackoverflow.com/users/1983554/karl-pokus"}, "is_accepted": false, "score": 0, "last_activity_date": 1571814620, "creation_date": 1571814620, "answer_id": 58517300, "question_id": 57143771, "link": "https://stackoverflow.com/questions/57143771/go-mod-has-post-v0-module-path-git-example-com-owner-repo-v3-at-revision/58517300#58517300", "title": "go.mod has post-v0 module path &quot;git.example.com/owner/repo/v3&quot; at revision ...?", "body": "<p>I may have had a similiar issue where I updated a module to use the /v2 import path but go getting the module always returned an error about invalid go.mod</p>\n\n<p>The solution was to <code>go get -u github.com/&lt;me&gt;/&lt;pkg&gt;/v2</code></p>\n"}], "owner": {"reputation": 2576, "user_id": 631612, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/b7d2a769fa193f9efa36668148deb9f5?s=128&d=identicon&r=PG", "display_name": "quanta", "link": "https://stackoverflow.com/users/631612/quanta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1339, "favorite_count": 2, "accepted_answer_id": 57159514, "answer_count": 4, "score": 4, "last_activity_date": 1571814620, "creation_date": 1563790488, "last_edit_date": 1563836714, "question_id": 57143771, "link": "https://stackoverflow.com/questions/57143771/go-mod-has-post-v0-module-path-git-example-com-owner-repo-v3-at-revision", "title": "go.mod has post-v0 module path &quot;git.example.com/owner/repo/v3&quot; at revision ...?", "body": "<p>My coworker pushed a tag <code>v3.0.1</code> before updating <code>go.mod</code> to have <code>/v3</code> suffix (<a href=\"https://github.com/golang/go/wiki/Modules#releasing-modules-v2-or-higher\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/Modules#releasing-modules-v2-or-higher</a>). I have updated module path (<code>go.mod</code>) and all import paths (<code>*.go</code>) to fix it, tagged as <code>v3.0.2</code>.</p>\n\n<p>Now the problem is:</p>\n\n<pre><code>go get -v git.example.com/owner/repo@v3.0.2\ngo: finding git.example.com/owner/repo v3.0.2\ngo: git.example.com/owner/repo@v0.0.0-20190722053407-d85c4f69ad17: go.mod has post-v0 module path \"git.example.com/owner/repo/v3\" at revision \nd85c4f69ad17\n</code></pre>\n\n<p>Found this: <a href=\"https://stackoverflow.com/questions/52050146/go-build-keeps-complaining-that-go-mod-has-post-v0-module-path\">go build keeps complaining that: go.mod has post-v0 module path</a></p>\n\n<p>So, I deleted both <code>v3.0.0</code> and <code>v3.0.1</code> tags, pointed it to the latest commit, re-pushed but the problem still stand.</p>\n\n<p>I noticed that <code>go.mod</code> still refered to the old version as an indirect dependency:</p>\n\n<pre><code>require (\n    git.example.com/owner.repo v0.1.2 // indirect\n</code></pre>\n\n<p>Even if I changed it to <code>/v3 v3.0.2</code> it will be restored to <code>v0.1.12</code> automatically.</p>\n\n<p>Why?</p>\n\n<p>Did I miss something?</p>\n\n<hr>\n\n<p><strong>Tue Jul 23 05:54:56 +07 2019</strong></p>\n\n<pre><code>rm go.*\ngo mod init git.example.com/dependent/project\ngo mod tidy\n</code></pre>\n\n<p>and <code>go.mod</code> is updated correctly now:</p>\n\n<pre><code>require (\n-       git.example.com/owner/repo v0.1.2\n+       git.example.com/owner/repo/v3 v3.0.2\n</code></pre>\n\n<p>but <code>go get -v git.example.com/owner/repo@v3.0.2</code> still returned the error:</p>\n\n<pre><code>go: finding git.example.com/owner/repo v3.0.2\ngo: git.example.com/owner/repo@v0.0.0-20190722053407-d85c4f69ad17: go.mod has post-v0 module path \"git.example.com/owner/repo/v3\" at revision \nd85c4f69ad17\n</code></pre>\n\n<p>(<code>d85c4f69ad17</code> is the latest commit in <code>master</code>)</p>\n\n<p>I noticed that there are both <code>v0.1.2</code> and <code>v3.0.2</code> in <code>go.sum</code>:</p>\n\n<pre><code>git.example.com/owner/repo v0.1.2 h1:mCGJEmyrFDTCGkRfUIORpqdrNkSONQ6K+AcTNgxqveY=\ngit.example.com/owner/repo v0.1.2/go.mod h1:FfUKnyPrARCtAXQZ3BQVJI7h2eJ0UpQBMLg4bNs4Kdc=\ngit.example.com/owner/repo/v3 v3.0.2 h1:mJtDKLeiP8vMRSZo08i/k/KDbIoZTlKW2aWu7DUBvMM=\ngit.example.com/owner/repo/v3 v3.0.2/go.mod h1:64LE0ts0Lk9InIQyhPYGmnxs6LZIl6H4Iorl1EXfqxo=\n</code></pre>\n"}, {"tags": ["c++", "opencv", "go", "video-streaming"], "comments": [{"owner": {"reputation": 11, "user_id": 5165911, "user_type": "registered", "profile_image": "https://graph.facebook.com/1455783024726236/picture?type=large", "display_name": "ywq", "link": "https://stackoverflow.com/users/5165911/ywq"}, "edited": false, "score": 0, "creation_date": 1563786547, "post_id": 57142625, "comment_id": 100800348, "body": "When open videoCaputure by local file path, I can get the frame success: vc, err := gocv.OpenVideoCapture(srcVideoPath)"}], "owner": {"reputation": 11, "user_id": 5165911, "user_type": "registered", "profile_image": "https://graph.facebook.com/1455783024726236/picture?type=large", "display_name": "ywq", "link": "https://stackoverflow.com/users/5165911/ywq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 119, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1563845197, "creation_date": 1563786504, "last_edit_date": 1563845197, "question_id": 57142625, "link": "https://stackoverflow.com/questions/57142625/got-a-nil-frame-using-opencv-invoked-by-gocv", "title": "Got a nil frame using opencv invoked by gocv", "body": "<p>I am using <strong>opencv</strong> called from <strong>gocv</strong> to read a video via url which is a http request, and the http response body returns the video whose type is byte array. There is no problems in video file. I could get the video's fps and the totol frames number, but when I try to read the <strong>first frame</strong> or <strong>second frame</strong>, in return, I get a unexpected <strong>nil</strong>\u3002</p>\n\n<p>but when I read the video from a given local file path, I can read the sencond frame as expected.</p>\n\n<p>I am using c++ function to call this interface\uff0chowever, the c++ function returns <strong>nil</strong> too. So could I just say that the videocaputure is not supported via a url? </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>url := \"http://localhost:8080/video\"\n\nvc, err := gocv.OpenVideoCapture(url)\n\nif nil != err {\n    log.Fatal(\"open video capture failed: \", err)\n}\ndefer vc.Close()\n\nif !vc.IsOpened() {\n    log.Fatal(\"vc is not open\")\n}\nframes := 2\nvc.Set(gocv.VideoCapturePosFrames, float64(frames))\nframe := gocv.NewMat()\ndefer frame.Close()\n\n// when I read video by srcPath, the vc.Read can read the frame\n// when I read video by url, the vc.Read can't read the frame, and the error is the frame is nil\nvc.Read(&amp;frame)\n\nif frame.Empty() {\n    log.Fatal(\"frame is empty\")\n}\n</code></pre>\n\n<p>I expect the output is\uff1aread the frame success</p>\n\n<p>The output is frame is nil, I can't get the frame</p>\n\n<pre><code>[mov,mp4,m4a,3gp,3g2,mj2 @ 0x19fd880] stream 1, offset 0xf50: partial file\n...\n...\n[mov,mp4,m4a,3gp,3g2,mj2 @ 0x26ee880] stream 1, offset 0xf50: partial file\n[mov,mp4,m4a,3gp,3g2,mj2 @ 0x26ee880] stream 1, offset 0xf50: partial file\n[mov,mp4,m4a,3gp,3g2,mj2 @ 0x26ee880] stream 1, offset 0xf50: partial file\n[mov,mp4,m4a,3gp,3g2,mj2 @ 0x26ee880] stream 1, offset 0xf50: partial file\n[mov,mp4,m4a,3gp,3g2,mj2 @ 0x26ee880] stream 1, offset 0xf50: partial file\n[mov,mp4,m4a,3gp,3g2,mj2 @ 0x26ee880] stream 1, offset 0xf50: partial file\n[mov,mp4,m4a,3gp,3g2,mj2 @ 0x26ee880] stream 1, offset 0xf50: partial file\n2019/07/22 17:06:47 testMyVideo.go:37: frame is empty\nexit status 1\n\n\n</code></pre>\n"}, {"tags": ["go", "printing"], "answers": [{"tags": [], "owner": {"reputation": 3488, "user_id": 477035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cYpss.jpg?s=128&g=1", "display_name": "RedGrittyBrick", "link": "https://stackoverflow.com/users/477035/redgrittybrick"}, "is_accepted": false, "score": 0, "last_activity_date": 1563805586, "creation_date": 1563805586, "answer_id": 57148150, "question_id": 57142208, "link": "https://stackoverflow.com/questions/57142208/how-to-print-with-golang/57148150#57148150", "title": "How to print with golang?", "body": "<p>Possible areas to check</p>\n\n<ul>\n<li><p>jadefox goprint package might not perform rasterisation, or at least not for your \"CUSTOM K80\" printer. It might therefore pass the raw file contents to the printer for it to rasterise.</p></li>\n<li><p>your printer might not support PDF internally. Many mid range and higher-end laser printers do. Cheaper printers often don't. Printers that don't parse PDF may instead treat the received data as plain ASCII text.</p></li>\n</ul>\n"}], "owner": {"reputation": 1, "user_id": 5275835, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/q83LC.jpg?s=128&g=1", "display_name": "Chaeos", "link": "https://stackoverflow.com/users/5275835/chaeos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 383, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563805586, "creation_date": 1563785098, "last_edit_date": 1563794474, "question_id": 57142208, "link": "https://stackoverflow.com/questions/57142208/how-to-print-with-golang", "title": "How to print with golang?", "body": "<p>I am trying to print on printer with go, but printer only prints strange characters ... I don't know how can I solve it.</p>\n\n<p>If I print string it works, if I try print pdf on external software it works, only fail on go.</p>\n\n<p>I used \"github.com/jadefox10200/goprint\"</p>\n\n<pre><code>printerHandle, err := goprint.GoOpenPrinter(\"CUSTOM K80\")   \nif err != nil {log(\"Failed to open printer\")}\ndefer goprint.GoClosePrinter(printerHandle)\n\nerr = goprint.GoPrint(printerHandle, \"hello.pdf\")\nif err != nil { log(\"during the func sendToPrinter, there was an error\") }\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>&gt; %PDF-1.3 3 0 obj &lt;&lt;/Type /Page /Parent 1 0 R /Resources 2 0 R\n&gt; /Contents 4 0 R&gt;&gt; endobj 4 0 obj &lt;&lt;/Filter /FlateDecode /Length 215&gt;&gt;\n&gt; stream\n&gt; x\ufffd\u03ffJ4A\ufffd|\ufffd\ufffd\ufffd\uf4be\ufffd\ufffd?\ufffd\udad4\uddfb\ufffd\ufffdA\ufffd\ufffd\ufffd\u038c\ufffd\ufffd!\ufffdp&gt;\ufffd\ufffdbf\ufffdIS\ufffd*\u0193cl\ufffd))\ue389\ufffd\ufffd\ufffd}_\ufffd\ufffdp^Fj\ufffdz\ufffd\ufffd\u03e5\ufffd\ufffd\u04a6\ufffd\ufffd\ufffd,\ufffdK\ufffdc\ufffd^221\ufffdfs\ufffdF\ufffd\ufffdr\ufffd5\ufffd\ufffd\ufffd\ufffd\ufffd\ufffda9\u0646\ufffdx9/\\5+\ufffd\ufffd\ufffd\u03b1\ufffd\ufffd$\ufffd\u05e4\ufffd\ufffdP+\ufffdiU\ufffd}-\ufffd\ufffda\ufffd}\ufffd\ufffdJ,\ufffd($\u04d1-B\ufffd$\ufffd\n&gt; \ufffd\ufffdC:\u064f\ufffd\ufffd\ufffde \ufffd\ufffd?\ufffd[\ufffdc\ufffd;^oxk\ufffddfs\ufffd  \ufffd\ufffd\ufffdqN^ endstream endobj 1 0 obj\n&gt; &lt;&lt;/Type /Pages /Kids [3 0 R ] /Count 1 /MediaBox [0 0 175.75 255.12]\n&gt; endobj 5 0 obj &lt;&lt;/Type /Font /BaseFont /Helvetica-Bold /Subtype /Type1\n&gt; /Encoding /WinAnsiEncoding\n&gt; &gt;&gt; endobj 6 0 obj &lt;&lt;/Type /Font /BaseFont /Helvetica /Subtype /Type1 /Encoding /WinAnsiEncoding\n&gt; &gt;&gt; endobj 2 0 obj &lt;&lt; /ProcSet [/PDF /Text /ImageB /ImageC /ImageI] /Font &lt;&lt; /Ff5d2de5f3a71699ae4b2d83179e62d09e6fc4126 5 0 R\n&gt; /F0a76705d18e0494dd24cb573e53aa0a8c710ec99 6 0 R\n&gt; &gt;&gt; /XObject &lt;&lt;\n&gt; &gt;&gt; /ColorSpace &lt;&lt;\n&gt; &gt;&gt;\n&gt; &gt;&gt; endobj 7 0 obj &lt;&lt; /Producer (FPDF 1.7) /Title (\ufffd\ufffd T e s t   P D F) /CreationDate (D:20190722103543)\n&gt; &gt;&gt; endobj 8 0 obj &lt;&lt; /Type /Catalog /Pages 1 0 R\n&gt; &gt;&gt; endobj xref 0 9 0000000000 65535 f 0000000372 00000 n 0000000656 00000 n 0000000009 00000 n 0000000087 00000 n 0000000459 00000 n\n&gt; 0000000560 00000 n 0000000866 00000 n 0000000969 00000 n trailer &lt;&lt;\n&gt; /Size 9 /Root 8 0 R /Info 7 0 R\n&gt; &gt;&gt; startxref 1018 %%EOF\n</code></pre>\n"}, {"tags": ["go", "amazon-s3"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563785392, "post_id": 57142035, "comment_id": 100799726, "body": "What do you mean by &quot;I&#39;m not able to figure that one out&quot;? This is not a useful problem description. What exact problem are you facing?"}], "answers": [{"tags": [], "owner": {"reputation": 379, "user_id": 2918731, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/6mtoN.png?s=128&g=1", "display_name": "TheLebDev", "link": "https://stackoverflow.com/users/2918731/thelebdev"}, "is_accepted": false, "score": -1, "last_activity_date": 1563784664, "creation_date": 1563784664, "answer_id": 57142093, "question_id": 57142035, "link": "https://stackoverflow.com/questions/57142035/how-to-upload-file-to-s3-bucket-directory/57142093#57142093", "title": "How to upload file to S3 Bucket/directory", "body": "<p>I figured out a not-so-common gem that might be useful to a lot of people, the <code>path.Join</code> function.</p>\n\n<p>So mainly, the <code>Key</code> object of <code>PutObjectInput</code> parameter inside <code>PutObject</code> function call will have a value of <code>aws.String(path.Join(path_to_directory, fileName)</code> instead of <code>aws.String(fileName)</code></p>\n"}], "owner": {"reputation": 379, "user_id": 2918731, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/6mtoN.png?s=128&g=1", "display_name": "TheLebDev", "link": "https://stackoverflow.com/users/2918731/thelebdev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 742, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1563785326, "creation_date": 1563784498, "last_edit_date": 1563785326, "question_id": 57142035, "link": "https://stackoverflow.com/questions/57142035/how-to-upload-file-to-s3-bucket-directory", "title": "How to upload file to S3 Bucket/directory", "body": "<p>I need to upload a file to my S3 Bucket, inside a specific directory. I've used the aws-sdk-go package and was able to upload the file using <code>PutObject</code> function inside my bucket. The file will be located in <code>bucket/root</code> directory.</p>\n\n<p>What I need to do is to upload it inside <code>bucket/root/subDirectory</code> and I'm not able to figure that one out.</p>\n\n<p><strong>Current Upload Function</strong></p>\n\n<pre><code>_, s3Err := s3.New(s).PutObject(&amp;s3.PutObjectInput{\n        Bucket:               aws.String(envs.InitAWSEnvs().AWSS3Name),\n        Key:                  aws.String(fileDir),\n        ACL:                  aws.String(\"private\"),\n        Body:                 bytes.NewReader(buffer),\n        ContentLength:        aws.Int64(size),\n        ContentType:          aws.String(http.DetectContentType(buffer)),\n        ContentDisposition:   aws.String(\"attachment\"),\n        ServerSideEncryption: aws.String(\"AES256\"),\n    })\n</code></pre>\n"}, {"tags": ["docker", "go", "logging", "kubernetes"], "answers": [{"comments": [{"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1563783718, "post_id": 57141772, "comment_id": 100798915, "body": "Thanks, in this way I was able to change the env, but the log-level doesnt changed..."}, {"owner": {"reputation": 106, "user_id": 10449790, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-2iYb-jm0BR4/AAAAAAAAAAI/AAAAAAAAAAc/sT7DhdiJkTA/photo.jpg?sz=128", "display_name": "Shahaf Shavit", "link": "https://stackoverflow.com/users/10449790/shahaf-shavit"}, "reply_to_user": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1563783924, "post_id": 57141772, "comment_id": 100799014, "body": "Seems like the log level will be updated only when you initialise a new logger. So you are dependant on restarting the container. Maybe add a mechanism that gets the log level from the env var for each log."}], "tags": [], "owner": {"reputation": 106, "user_id": 10449790, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-2iYb-jm0BR4/AAAAAAAAAAI/AAAAAAAAAAc/sT7DhdiJkTA/photo.jpg?sz=128", "display_name": "Shahaf Shavit", "link": "https://stackoverflow.com/users/10449790/shahaf-shavit"}, "is_accepted": false, "score": 0, "last_activity_date": 1563783638, "creation_date": 1563783638, "answer_id": 57141772, "question_id": 57141689, "link": "https://stackoverflow.com/questions/57141689/change-log-level-on-runtime-for-containers/57141772#57141772", "title": "Change log level on runtime for containers", "body": "<p>You can run the command <code>kubectl exec -it &lt;container_name&gt; bash</code> and use the command line inside the container to change the environment variable .\nYou can do it by running the command <code>export LOG_LEVEL=debug</code> or <code>export LOG_LEVEL=error</code> inside the container.</p>\n"}, {"comments": [{"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1563784750, "post_id": 57141954, "comment_id": 100799395, "body": "Thanks, why we shouldn&#39;t be this in prod? sometimes when you re-start a pod you dont see the error in the new pod instance ..."}, {"owner": {"reputation": 156, "user_id": 2964619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/04d1826f88e70d3e8c5e87c36de598be?s=128&d=identicon&r=PG&f=1", "display_name": "Todai", "link": "https://stackoverflow.com/users/2964619/todai"}, "reply_to_user": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1563785228, "post_id": 57141954, "comment_id": 100799640, "body": "It&#39;s just not good practice to have to restart pods in a production environment to change the log-level.  However, your prod environment should be monitoring / logging the bare minimum for you to be able to at least get an idea of what&#39;s wrong. But maybe that&#39;s not a realistic scenario?"}, {"owner": {"reputation": 156, "user_id": 2964619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/04d1826f88e70d3e8c5e87c36de598be?s=128&d=identicon&r=PG&f=1", "display_name": "Todai", "link": "https://stackoverflow.com/users/2964619/todai"}, "reply_to_user": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1563785385, "post_id": 57141954, "comment_id": 100799721, "body": "Bottom line is, you shouldn&#39;t <i>have</i> to remote onto a server to change an application&#39;s log-level.  The log-level should be something static for each environment, so that you know it&#39;s not been tampered with. Especially in a clustered environment where logs have a tendency to disappear due to pods dying. How else are you going to have any form of confidence in what has broken?"}, {"owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 0, "creation_date": 1563787458, "post_id": 57141954, "comment_id": 100800852, "body": "if customer is reporting a bug I can ask him to run some script/command to change the log level and in this way I&#39;ve precise info of what happining in the pod, otherwise restart the pod will not reflect this info as it was before the restard due to many things such is user interacation with the app etc"}, {"owner": {"reputation": 156, "user_id": 2964619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/04d1826f88e70d3e8c5e87c36de598be?s=128&d=identicon&r=PG&f=1", "display_name": "Todai", "link": "https://stackoverflow.com/users/2964619/todai"}, "reply_to_user": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "edited": false, "score": 1, "creation_date": 1563788334, "post_id": 57141954, "comment_id": 100801349, "body": "Why would you ever ask a customer to run a script to find out about information in <b>your</b> production environment?   If that&#39;s something that you need to debug an issue on your end, you have bigger problems than you are letting on.. :/"}], "tags": [], "owner": {"reputation": 156, "user_id": 2964619, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/04d1826f88e70d3e8c5e87c36de598be?s=128&d=identicon&r=PG&f=1", "display_name": "Todai", "link": "https://stackoverflow.com/users/2964619/todai"}, "is_accepted": false, "score": 0, "last_activity_date": 1563784209, "creation_date": 1563784209, "answer_id": 57141954, "question_id": 57141689, "link": "https://stackoverflow.com/questions/57141689/change-log-level-on-runtime-for-containers/57141954#57141954", "title": "Change log level on runtime for containers", "body": "<p>First off, understand this should happen on the <strong>application</strong> level. I.e. it's not something that Kubernetes is supposed to do for you.</p>\n\n<p>That being said, you could have your application checking an environment variable's value (you are already doing this), and depending on what that value is, it can set the application's log-level. <strong>In other words, let the application code poll an environment variable to see if it has changed.</strong> </p>\n\n<p>You can inject environment variables like Shahaf suggests, but that requires you to <code>exec</code> into the pod, which may not always be possible or good practice.</p>\n\n<p>I would suggest you run <code>kubectl set env rs [REPLICASET_NAME] SOME_ENVIRONMENT_VAR=1</code>.</p>\n\n<p>All of this being said, you need to consider <em>why</em> this is important. Kubernetes is built under the principle that \"<em>pods should be treated like cattle, not pets</em>\". Meaning when a pod is no longer useful, or out of sync, it should be terminated and a new one, that represents the code's current state, should be booted up in its stead.</p>\n\n<p>Regardless of how you go about doing what you need to do, you REALLY shouldn't be doing this in production, or even in staging. </p>\n\n<p>Instead let your app's underlying environment variables set a log-level that is appropriate for that environment. </p>\n"}, {"tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": false, "score": 3, "last_activity_date": 1563791540, "creation_date": 1563791540, "answer_id": 57144103, "question_id": 57141689, "link": "https://stackoverflow.com/questions/57141689/change-log-level-on-runtime-for-containers/57144103#57144103", "title": "Change log level on runtime for containers", "body": "<p>As a general Un*x statement, you cannot change an environment variable in a process after it has started.  (You can <strong>setenv</strong>(3) your own environment, and you can specify a new process's environment when you <strong>execve</strong>(2) it, but once it's started, you can't change it again.)</p>\n\n<p>This restriction carries through to higher levels.  If you've <code>docker run</code> a container, its <code>-e</code> option to set an environment variable is one of the things you have to delete and recreate a container to change.  The <code>env:</code> is one of the many immutable parts of a Kubernetes Pod specification; you also can't change it without deleting and recreating the pod.</p>\n\n<p>If you've deployed the pod via a Deployment (and you really should), you can change the environment variable setting in the Deployment spec (edit the YAML file in source control and <code>kubectl apply -f</code> it, or directly <code>kubectl edit</code>).  This will cause Kubernetes to start new pods with the new log value and shut down old ones, in that order, doing a zero-downtime update.  <em>Deleting and recreating pods like this is totally normal</em> and happens whenever you want to, for example, change the image inside the deployment to have today's build.</p>\n\n<p>If your application is capable of noticing changes to config files it's loaded (and it would have to be specially coded to do that) one other path that could work for you is to <a href=\"https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/#add-configmap-data-to-a-volume\" rel=\"nofollow noreferrer\">mount a ConfigMap into a container</a>; if you change the ConfigMap contents, the files the container sees will change but it will not restart.  I wouldn't go out of my way to write this just to avoid restarting a pod, though.</p>\n"}], "owner": {"reputation": 659, "user_id": 11154975, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80600b309fa55c4e26eec31d7e083fd0?s=128&d=identicon&r=PG&f=1", "display_name": "Jhon D", "link": "https://stackoverflow.com/users/11154975/jhon-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5635, "favorite_count": 3, "answer_count": 3, "score": 1, "last_activity_date": 1563791540, "creation_date": 1563783295, "last_edit_date": 1563784340, "question_id": 57141689, "link": "https://stackoverflow.com/questions/57141689/change-log-level-on-runtime-for-containers", "title": "Change log level on runtime for containers", "body": "<p>im using <a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\"><code>logrus</code></a> for logging for out applications which run on K8S\nwe have env variable which we can set the <code>log-level</code> and change it when we restart out application\nour applications is running with docker containers on k8s\nNow we want to change the log-level on runtime, i.e. don\u2019t restart the container and change it \nwhen it\u2019s running and with this we can change it from <code>error</code> to <code>debug</code>, I think this \nis legitimic request but didn\u2019t find any reference or any open source which doing this, any idea? </p>\n\n<pre><code>package logs\n\nimport (\n    \"fmt\"\n    \"os\"\n\n    \"github.com/sirupsen/logrus\"\n)\n\nconst (\n    AppLogLevel = \u201cAPP_LOG_LEVEL\"\n    DefLvl = \"info\"\n)\n\n\nvar Logger *logrus.Logger\n\n\nfunc NewLogger() *logrus.Logger {\n\n    var level logrus.Level\n    lvl := getLogLevel()\n    // In case level doesn't set will not print any message\n    level = logLevel(lvl)\n    logger := &amp;logrus.Logger{\n        Out:   os.Stdout,\n        Level: level,\n    }\n    Logger = logger\n    return Logger\n}\n\n// use from env\nfunc getLogLevel() string {\n    lvl, _ := os.LookupEnv(AppLogLevel)\n    if lvl != \"\" {\n        return lvl\n    }\n    return DefLvl\n}\n\nfunc logLevel(lvl string) logrus.Level {\n\n    switch lvl {\n    case \"debug\":\n        // Used for tracing\n        return logrus.DebugLevel\n    case \"info\":\n        return logrus.InfoLevel\n    case \"error\":\n        return logrus.ErrorLevel\n    case \"fatal\":\n        return logrus.FatalLevel\n    default:\n        panic(fmt.Sprintf(\"the specified %s log level is not supported\", lvl))\n    }\n}\n</code></pre>\n\n<p>I know how to change the log level but I need a way to infuance the logger to change the level</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1563780548, "post_id": 57141004, "comment_id": 100797392, "body": "Why is lt like what? Randomized order? Or why do you get the error?"}, {"owner": {"reputation": 45, "user_id": 11066315, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-pMnJ9r9eaVs/AAAAAAAAAAI/AAAAAAAAABY/u50VQVWjGiw/photo.jpg?sz=128", "display_name": "Franken Frank", "link": "https://stackoverflow.com/users/11066315/franken-frank"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1563780657, "post_id": 57141004, "comment_id": 100797448, "body": "Which one? The expected result is random because the routines for insertion finish at different time I believe"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1563780771, "post_id": 57141004, "comment_id": 100797503, "body": "What do you mean, &quot;which one&quot;? Which error? The one you&#39;re getting, &quot;fatal error: concurrent map writes&quot;."}, {"owner": {"reputation": 45, "user_id": 11066315, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-pMnJ9r9eaVs/AAAAAAAAAAI/AAAAAAAAABY/u50VQVWjGiw/photo.jpg?sz=128", "display_name": "Franken Frank", "link": "https://stackoverflow.com/users/11066315/franken-frank"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1563780985, "post_id": 57141004, "comment_id": 100797616, "body": "Ah my bad, I got what you mean now. Yeah my question is why sometimes it runs normally and sometimes it raises errors"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1563781048, "post_id": 57141004, "comment_id": 100797657, "body": "Because it&#39;s not safe to write to a map concurrently. You need an explicit synchronization of some sort (a mutex, for example)"}, {"owner": {"reputation": 45, "user_id": 11066315, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-pMnJ9r9eaVs/AAAAAAAAAAI/AAAAAAAAABY/u50VQVWjGiw/photo.jpg?sz=128", "display_name": "Franken Frank", "link": "https://stackoverflow.com/users/11066315/franken-frank"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1563781148, "post_id": 57141004, "comment_id": 100797711, "body": "So there&#39;s no way to insert many values into a map or array at the same time?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1563781479, "post_id": 57141004, "comment_id": 100797891, "body": "No, there isn&#39;t."}], "answers": [{"tags": [], "owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "is_accepted": false, "score": 1, "last_activity_date": 1563781936, "last_edit_date": 1563781936, "creation_date": 1563781609, "answer_id": 57141289, "question_id": 57141004, "link": "https://stackoverflow.com/questions/57141004/problem-with-map-insertion-using-goroutine/57141289#57141289", "title": "Problem with map insertion using goroutine", "body": "<p>First of all, you have a race condition on your map. You are sharing it across multiple goroutines without using any synchronization mechanism. Protect it with a <a href=\"https://golang.org/pkg/sync/#Mutex\" rel=\"nofollow noreferrer\"><code>sync.Mutex</code></a>.</p>\n\n<p>Then, you cannot expect any given order when storing values  in  a map. In fact, Go's map <a href=\"http://%20https://golang.org/ref/spec#Map_types\" rel=\"nofollow noreferrer\">spec</a> says: </p>\n\n<blockquote>\n  <p>A map is an unordered group of elements of one type</p>\n</blockquote>\n\n<p>If order matters for your application, then use a slice.</p>\n"}], "owner": {"reputation": 45, "user_id": 11066315, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-pMnJ9r9eaVs/AAAAAAAAAAI/AAAAAAAAABY/u50VQVWjGiw/photo.jpg?sz=128", "display_name": "Franken Frank", "link": "https://stackoverflow.com/users/11066315/franken-frank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1563781936, "creation_date": 1563780365, "last_edit_date": 1563781037, "question_id": 57141004, "link": "https://stackoverflow.com/questions/57141004/problem-with-map-insertion-using-goroutine", "title": "Problem with map insertion using goroutine", "body": "<p>I'm new to Golang and learning to use goroutine. I'm trying to insert into a map[int]string concurrently many strings by goroutines</p>\n\n<pre><code>   package main\n\n   import (\n       \"fmt\"\n       \"sync\"\n   )\n\n   func input(m map[int]string, i int, wg *sync.WaitGroup){\n       m[i] = fmt.Sprintf(\"line %d\\n\", i+1)\n       fmt.Print(m[i])\n       wg.Done()\n   }\n\n   func GetMap(m map[int]string, wg *sync.WaitGroup) {\n        wg.Add(5)\n        for i:=0; i&lt;5; i++{\n             go input(m, i, wg)\n        }\n        wg.Wait()\n   }\n\n   func main(){\n       var wg sync.WaitGroup\n       m1 := make(map[int]string)\n       GetMap(m1, &amp;wg)\n       fmt.Print(m1)\n   } \n</code></pre>\n\n<p><strong>Expected:</strong><br>\nline 1<br>\nline 2<br>\nline 5<br>\nline 3<br>\nline 4<br>\nmap[0:line 1<br>\n 1:line 2<br>\n 2:line 3<br>\n 3:line 4<br>\n 4:line 5<br>\n]<br>\n<strong>Results</strong>: It's different every time, sometimes it's the expected result sometimes it's like this:<br>\nline 5<br>\nfatal error: concurrent map writes<br>\nline 1<br>\nline 2<br>\nSo why is the result different every time i recompile? Thank you </p>\n"}, {"tags": ["javascript", "go", "browser", "websocket", "http-headers"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1563779613, "post_id": 57140691, "comment_id": 100796941, "body": "Could you please show full code of golang server? Perhaps you&#39;re fetching headers in the wrong way."}, {"owner": {"reputation": 475, "user_id": 5800846, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_7fn8xrZVkw/AAAAAAAAAAI/AAAAAAAAAAA/tBjQuGoMUoA/photo.jpg?sz=128", "display_name": "Igor Shmukler", "link": "https://stackoverflow.com/users/5800846/igor-shmukler"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1563779909, "post_id": 57140691, "comment_id": 100797099, "body": "Thank you for taking a look. Not positive that more code here will help, but I added a couple more lines. Since everything else is running, assuming that <code>ws</code> is valid. Right? I am able to receive messages from this WebSocket - <code>ws</code> a few lines further down."}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1563780219, "post_id": 57140691, "comment_id": 100797254, "body": "Please add more relevant code, it still unclear which library you&#39;re using, how all setuped and all other stuff."}, {"owner": {"reputation": 475, "user_id": 5800846, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_7fn8xrZVkw/AAAAAAAAAAI/AAAAAAAAAAA/tBjQuGoMUoA/photo.jpg?sz=128", "display_name": "Igor Shmukler", "link": "https://stackoverflow.com/users/5800846/igor-shmukler"}, "reply_to_user": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1563780833, "post_id": 57140691, "comment_id": 100797535, "body": "I am using <code>&quot;golang.org&#47;x&#47;net&#47;websocket&quot;</code>, The thing is setup with <code>http.NewServeMux()</code> and <code>mux.Handle()</code>. Is it possible to add headers to a WebSocket connection after it has been established?"}], "answers": [{"comments": [{"owner": {"reputation": 475, "user_id": 5800846, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_7fn8xrZVkw/AAAAAAAAAAI/AAAAAAAAAAA/tBjQuGoMUoA/photo.jpg?sz=128", "display_name": "Igor Shmukler", "link": "https://stackoverflow.com/users/5800846/igor-shmukler"}, "edited": false, "score": 0, "creation_date": 1563781164, "post_id": 57141138, "comment_id": 100797717, "body": "This is what I thought. Thank you"}], "tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": true, "score": 3, "last_activity_date": 1563781003, "creation_date": 1563781003, "answer_id": 57141138, "question_id": 57140691, "link": "https://stackoverflow.com/questions/57140691/websockets-and-http-headers/57141138#57141138", "title": "WebSockets and HTTP headers", "body": "<blockquote>\n  <p>Is it possible to alter WebSocket connection headers, after the\n  connection has been established?</p>\n</blockquote>\n\n<p>You can't set a cookie upon receipt of a WebSocket message. Once the WebSocket connection has been established, it's an open TCP socket and the protocol is no longer http, thus there is no built-in way to exchange cookies.</p>\n\n<p>You can use authorizathion on the first http request, where both sides establish protocol for exchange data.</p>\n"}], "owner": {"reputation": 475, "user_id": 5800846, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_7fn8xrZVkw/AAAAAAAAAAI/AAAAAAAAAAA/tBjQuGoMUoA/photo.jpg?sz=128", "display_name": "Igor Shmukler", "link": "https://stackoverflow.com/users/5800846/igor-shmukler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1701, "favorite_count": 1, "accepted_answer_id": 57141138, "answer_count": 1, "score": -1, "last_activity_date": 1563781003, "creation_date": 1563779066, "last_edit_date": 1563779745, "question_id": 57140691, "link": "https://stackoverflow.com/questions/57140691/websockets-and-http-headers", "title": "WebSockets and HTTP headers", "body": "<p>I am trying to figure out how to add a header with an authorization token to a WebSocket connection, after it has been established. Basically, to use a cookie in order to validate each message in the connection.</p>\n\n<p>There is a great discussion at <a href=\"https://stackoverflow.com/questions/4361173/http-headers-in-websockets-client-api\">HTTP headers in Websockets client API</a> already, yet it did not really help me.</p>\n\n<p>One of the the suggestions there was to do:</p>\n\n<pre><code>document.cookie = 'X-Authorization=' + token + '; path=/';\n</code></pre>\n\n<p>Unfortunately, it did not help me.</p>\n\n<pre><code>func handler(ws *websocket.Conn, h *Hub) {\n    go h.run()\n    h.addClientChan &lt;- ws\n    for {\n        config := ws.Config()\n        fmt.Println(\"Headers length:\", len(config.Header))\n        ...\n</code></pre>\n\n<p>Shows a map with 0 elements before and after I add the cookie.</p>\n\n<p>Is it possible to alter WebSocket connection headers, after the connection has been established?</p>\n\n<p>Do I even need to add an authorization token to a WebSocket connection, provided I authenticate each time, or is it only useful to re-establish a connection and just a useless check after the fact?</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-platform"], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 10295084, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dz3VS2iO3Vw/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaNqlIuT0hmgmE7g-2JS52hKPZ_uyQ/mo/photo.jpg?sz=128", "display_name": "Aniruddha Dwivedi", "link": "https://stackoverflow.com/users/10295084/aniruddha-dwivedi"}, "edited": false, "score": 0, "creation_date": 1563877025, "post_id": 57142259, "comment_id": 100837537, "body": "Hi you are right as the version string length is of 40 characters and maximum length allowed was of 48 characters long, I changed my service name &quot;ad-rule&quot; making a whole string of length 47. This worked for me, however, I don&#39;t know how drone settings uses Github commit number and how can I change it to make string shorter."}], "tags": [], "owner": {"reputation": 7659, "user_id": 4926605, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ed159f0e91d9ee0484cc64771993cb1?s=128&d=identicon&r=PG&f=1", "display_name": "LundinCast", "link": "https://stackoverflow.com/users/4926605/lundincast"}, "is_accepted": false, "score": 0, "last_activity_date": 1563785259, "creation_date": 1563785259, "answer_id": 57142259, "question_id": 57139608, "link": "https://stackoverflow.com/questions/57139608/google-app-engine-error-gcloud-app-deploy-invalid-argument-combined-version/57142259#57142259", "title": "Google App Engine Error: (gcloud.app.deploy) INVALID_ARGUMENT: Combined version and service (module) name is too long", "body": "<p>The error message indicates that the Combined version and service name should be 48 characters maximum. Yours, \"adlib-rules-mgr\" and \"5e4890f35a4f21a08853298d362f7f68b26a945e\" add up to 55 characters and thus is rejected.</p>\n\n<p>It seems your drone.io setting uses the Github commit number as version name for your App Engine app. I'm not familiar with drone.io myself but you should set a shorter name for your version. </p>\n"}], "owner": {"reputation": 63, "user_id": 10295084, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-dz3VS2iO3Vw/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaNqlIuT0hmgmE7g-2JS52hKPZ_uyQ/mo/photo.jpg?sz=128", "display_name": "Aniruddha Dwivedi", "link": "https://stackoverflow.com/users/10295084/aniruddha-dwivedi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 198, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563798740, "creation_date": 1563773035, "last_edit_date": 1563798740, "question_id": 57139608, "link": "https://stackoverflow.com/questions/57139608/google-app-engine-error-gcloud-app-deploy-invalid-argument-combined-version", "title": "Google App Engine Error: (gcloud.app.deploy) INVALID_ARGUMENT: Combined version and service (module) name is too long", "body": "<p>I am working on one application whose UI part is written in React and redux, middle layer using golang and it is using Google Cloud Datastore as NoSQL service. I have to deploy this service using drone.io. When I try to deploy my service, I get below error:</p>\n\n<pre><code>ERROR: (gcloud.app.deploy) INVALID_ARGUMENT: Combined version and service (module) name is too long.  The combined length must be less than 48 characters.\n</code></pre>\n\n<p>My front end service name is too short(adlib-rules-mgr). Other details are as below-</p>\n\n<pre><code>descriptor:      [/drone/src/github.com/nytm/adtech-adlib-web/app.yaml]\nsource:          [/drone/src/github.com/nytm/adtech-adlib-web]\ntarget project:  [nyt-adtech-dev]\ntarget service:  [adlib-rules-mgr]\ntarget version:  [5e4890f35a4f21a08853298d362f7f68b26a945e]\ntarget url:      [https://adlib-rules-mgr-dot-nyt-adtech-dev.appspot.com]\n</code></pre>\n\n<p>Please help me to understand what I am doing wrong and how this issue can be fixed?</p>\n"}, {"tags": ["go", "tidb"], "comments": [{"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "edited": false, "score": 3, "creation_date": 1563770113, "post_id": 57139190, "comment_id": 100793988, "body": "<code>Node</code> and <code>DDLNode</code> is not variable name. its variable type."}, {"owner": {"reputation": 299, "user_id": 8921064, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-N1ClvgObQjA/AAAAAAAAAAI/AAAAAAAAAEw/w6Qo47dkh-Q/photo.jpg?sz=128", "display_name": "Alex Nguyen", "link": "https://stackoverflow.com/users/8921064/alex-nguyen"}, "reply_to_user": {"reputation": 3224, "user_id": 6878708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/567e055e3d71ce025d8560333e48dfb9?s=128&d=identicon&r=PG&f=1", "display_name": "nightfury1204", "link": "https://stackoverflow.com/users/6878708/nightfury1204"}, "edited": false, "score": 0, "creation_date": 1563770518, "post_id": 57139190, "comment_id": 100794068, "body": "@nightfury1204 oh I see it, thanks"}], "owner": {"reputation": 299, "user_id": 8921064, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-N1ClvgObQjA/AAAAAAAAAAI/AAAAAAAAAEw/w6Qo47dkh-Q/photo.jpg?sz=128", "display_name": "Alex Nguyen", "link": "https://stackoverflow.com/users/8921064/alex-nguyen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "closed_date": 1563770536, "answer_count": 0, "score": 0, "last_activity_date": 1563769705, "creation_date": 1563769705, "question_id": 57139190, "link": "https://stackoverflow.com/questions/57139190/why-declare-the-same-variables-in-golang", "closed_reason": "Duplicate", "title": "Why declare the same variables in Golang?", "body": "<p>I found this code in the <a href=\"https://github.com/pingcap/parser/blob/master/ast/ddl.go\" rel=\"nofollow noreferrer\">pingcap/parser</a>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var (\n    _ DDLNode = &amp;AlterTableStmt{}\n    _ DDLNode = &amp;CreateDatabaseStmt{}\n    _ DDLNode = &amp;CreateIndexStmt{}\n    _ DDLNode = &amp;CreateTableStmt{}\n    _ DDLNode = &amp;CreateViewStmt{}\n    _ DDLNode = &amp;DropDatabaseStmt{}\n    _ DDLNode = &amp;DropIndexStmt{}\n    _ DDLNode = &amp;DropTableStmt{}\n    _ DDLNode = &amp;RenameTableStmt{}\n    _ DDLNode = &amp;TruncateTableStmt{}\n\n    _ Node = &amp;AlterTableSpec{}\n    _ Node = &amp;ColumnDef{}\n    _ Node = &amp;ColumnOption{}\n    _ Node = &amp;ColumnPosition{}\n    _ Node = &amp;Constraint{}\n    _ Node = &amp;IndexColName{}\n    _ Node = &amp;ReferenceDef{}\n)\n</code></pre>\n\n<p>I can see there are many variables that have the same name <code>DDLNode</code> and <code>Node</code>. I know the underscore <code>_</code> is the blank identifier in Golang, but why using them there.</p>\n\n<p>Any idea what is the purpose of this work?</p>\n\n<p>Thanks for your help.</p>\n"}, {"tags": ["go", "hugo"], "answers": [{"tags": [], "owner": {"reputation": 646, "user_id": 5675288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c0f0dd2b465ca3030c73cd42ff68463?s=128&d=identicon&r=PG&f=1", "display_name": "scientific_explorer", "link": "https://stackoverflow.com/users/5675288/scientific-explorer"}, "is_accepted": false, "score": 0, "last_activity_date": 1563770974, "creation_date": 1563770974, "answer_id": 57139342, "question_id": 57138939, "link": "https://stackoverflow.com/questions/57138939/range-function-gives-an-extra-output-in-my-template/57139342#57139342", "title": "Range function gives an extra output in my template", "body": "<p>I changed my <code>archives.html</code> to the following, with some help from <a href=\"https://github.com/yihui/hugo-lithium/blob/master/layouts/_default/list.html\" rel=\"nofollow noreferrer\">hugo-lithium</a>. It works for my use case now. But I still don't understand why the <strong>0001</strong> came up in the first place. So I will not be marking my answer as correct for now.</p>\n\n<pre><code>{{ partial \"header.html\" . }}\n\n&lt;div class=\"article-meta\"&gt;\n&lt;h1&gt;&lt;span class=\"title\"&gt;{{ .Title | markdownify }}&lt;/span&gt;&lt;/h1&gt;\n{{ with .Params.author }}&lt;h2 class=\"author\"&gt;{{ . }}&lt;/h2&gt;{{ end }}\n{{ if (gt .Params.date 0) }}&lt;h2 class=\"date\"&gt;{{ .Date.Format \"2006/01/02\" }}&lt;/h2&gt;{{ end     }}\n&lt;/div&gt;\n\n\n{{ range (where .Site.RegularPages \"Section\" \"!=\" \"\").GroupByDate \"2006\" }}\n  &lt;h2&gt;{{ .Key }}&lt;/h2&gt;\n  &lt;ul&gt;\n  {{ range .Pages }}\n  &lt;li&gt;\n    &lt;span class=\"date\"&gt;{{ .Date.Format \"2006/02/02\" }}&lt;/span&gt;\n    &lt;a href=\"{{ .RelPermalink }}\"&gt;{{ .Title }}&lt;/a&gt;\n  &lt;/li&gt;\n  {{ end }}\n  &lt;/ul&gt;\n{{ end }}\n\n\n\n{{ partial \"footer.html\" . }}\n</code></pre>\n"}], "owner": {"reputation": 646, "user_id": 5675288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c0f0dd2b465ca3030c73cd42ff68463?s=128&d=identicon&r=PG&f=1", "display_name": "scientific_explorer", "link": "https://stackoverflow.com/users/5675288/scientific-explorer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 43, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563770974, "creation_date": 1563767066, "question_id": 57138939, "link": "https://stackoverflow.com/questions/57138939/range-function-gives-an-extra-output-in-my-template", "title": "Range function gives an extra output in my template", "body": "<p>I am following <a href=\"https://davidtranscend.com/blog/how-to-create-an-archives-page-with-hugo/\" rel=\"nofollow noreferrer\">this</a> link to figure out how to create an archives page. I am using the <a href=\"https://github.com/yihui/hugo-xmin\" rel=\"nofollow noreferrer\">hugo-xmin</a> theme with slight modifications.</p>\n\n<p>As far as I understand, <code>range</code> goes through the pages and should print them out. But, I am getting an additional <code>0001</code> also. I don't understand why. I'm still a beginner to Hugo and Go.</p>\n\n<p>My <strong>output</strong> (circled portion in red not what I want)</p>\n\n<p><a href=\"https://i.stack.imgur.com/EYhrX.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/EYhrX.png\" alt=\"enter image description here\"></a></p>\n\n<p>My <code>archives.html</code></p>\n\n<pre><code>{{ partial \"header.html\" . }}\n\n&lt;div class=\"article-meta\"&gt;\n&lt;h1&gt;&lt;span class=\"title\"&gt;{{ .Title | markdownify }}&lt;/span&gt;&lt;/h1&gt;\n{{ with .Params.author }}&lt;h2 class=\"author\"&gt;{{ . }}&lt;/h2&gt;{{ end }}\n{{ if (gt .Params.date 0) }}&lt;h2 class=\"date\"&gt;{{ .Date.Format \"2006/01/02\" }}&lt;/h2&gt;{{ end     }}\n&lt;/div&gt;\n\n\n\n&lt;main class=\"content\" role=\"main\"&gt;\n    &lt;div class=\"inner\"&gt;\n{{ range (.Site.RegularPages.GroupByDate \"2006\") }}\n&lt;h3&gt;{{ .Key }}&lt;/h3&gt;\n&lt;ul&gt;\n  {{ range (where .Pages \"Type\" \"post\") }}\n  &lt;li&gt;\n    &lt;span class=\"date\"&gt;{{ .Date.Format \"2006/01/02\" }}&lt;/span&gt;\n    &lt;a href=\"{{ .RelPermalink }}\"&gt;{{ .Title }}&lt;/a&gt;\n  &lt;/li&gt;\n  {{ end }}\n&lt;/ul&gt;\n{{ end }}\n&lt;/div&gt;\n&lt;/main&gt;\n\n\n{{ partial \"footer.html\" . }}\n</code></pre>\n\n<p>My <code>archives.md</code></p>\n\n<pre><code>---\ntitle: \"Archives\"\nlayout: \"archives\"\ndraft: false\n---\n\nThis is archives\n</code></pre>\n\n<p>My directory structure</p>\n\n<pre><code>.\n\u251c\u2500\u2500 archetypes\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 default.md\n\u251c\u2500\u2500 config.toml\n\u251c\u2500\u2500 content\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 about.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 archives.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 _index.md\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 post\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 first_post.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 sample_code.md\n\u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 test_math.md\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 reading.md\n\u251c\u2500\u2500 data\n\u251c\u2500\u2500 layouts\n\u251c\u2500\u2500 static\n\u2514\u2500\u2500 themes\n    \u2514\u2500\u2500 mytheme\n        \u251c\u2500\u2500 archetypes\n        \u2502\u00a0\u00a0 \u2514\u2500\u2500 default.md\n        \u251c\u2500\u2500 layouts\n        \u2502\u00a0\u00a0 \u251c\u2500\u2500 404.html\n        \u2502\u00a0\u00a0 \u251c\u2500\u2500 archives.html\n        \u2502\u00a0\u00a0 \u251c\u2500\u2500 _default\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 archives.html\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 list.html\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 single.html\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 terms.html\n        \u2502\u00a0\u00a0 \u251c\u2500\u2500 index.html\n        \u2502\u00a0\u00a0 \u2514\u2500\u2500 partials\n        \u2502\u00a0\u00a0     \u251c\u2500\u2500 foot_custom.html\n        \u2502\u00a0\u00a0     \u251c\u2500\u2500 footer.html\n        \u2502\u00a0\u00a0     \u251c\u2500\u2500 head_custom.html\n        \u2502\u00a0\u00a0     \u2514\u2500\u2500 header.html\n        \u251c\u2500\u2500 LICENSE.md\n        \u251c\u2500\u2500 static\n        \u2502\u00a0\u00a0 \u251c\u2500\u2500 css\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u251c\u2500\u2500 fonts.css\n        \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 style.css\n        \u2502\u00a0\u00a0 \u2514\u2500\u2500 js\n        \u2514\u2500\u2500 theme.toml\n\n15 directories, 25 files\n</code></pre>\n"}, {"tags": ["arrays", "go", "slice"], "comments": [{"owner": {"reputation": 726, "user_id": 387670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de92c7f1d6b452b9e2b3f38c11967cb8?s=128&d=identicon&r=PG", "display_name": "sahaj", "link": "https://stackoverflow.com/users/387670/sahaj"}, "edited": false, "score": 0, "creation_date": 1563764791, "post_id": 57138697, "comment_id": 100793023, "body": "What do you mean by achieve this? as an output?"}, {"owner": {"reputation": 3, "user_id": 8386359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3470d138fc5f8ba51c61c699a8fe42f6?s=128&d=identicon&r=PG&f=1", "display_name": "Sirmorrison", "link": "https://stackoverflow.com/users/8386359/sirmorrison"}, "reply_to_user": {"reputation": 726, "user_id": 387670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de92c7f1d6b452b9e2b3f38c11967cb8?s=128&d=identicon&r=PG", "display_name": "sahaj", "link": "https://stackoverflow.com/users/387670/sahaj"}, "edited": false, "score": 0, "creation_date": 1563764916, "post_id": 57138697, "comment_id": 100793052, "body": "Yes. Thats what i want to have as an output."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 3, "creation_date": 1563765752, "post_id": 57138697, "comment_id": 100793219, "body": "The XY problem is asking about your attempted solution rather than your actual problem: <a href=\"http://xyproblem.info/\" rel=\"nofollow noreferrer\">The XY Problem</a>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563799976, "post_id": 57138697, "comment_id": 100808057, "body": "You can&#39;t, and it would be useless if you could. Can you update your question to indicate what you&#39;re actually trying to accomplish? There&#39;s certainly a way to do it, but what you&#39;re describing is impossible."}], "answers": [{"tags": [], "owner": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "is_accepted": false, "score": 1, "last_activity_date": 1563769475, "creation_date": 1563769475, "answer_id": 57139172, "question_id": 57138697, "link": "https://stackoverflow.com/questions/57138697/how-to-unpack-a-slice/57139172#57139172", "title": "How to unpack a slice", "body": "<p>I am considering that the thing you want is <code>dynamic variable allocation</code>. I guess you cannot do so. Instead you can use <code>Go Map</code> to store your data as <code>key-value</code> format.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    mySlice := []int{1, 2, 3, 4, 5, 6, 7, 8, 9, 10}\n    myVariables := make(map[string]int)\n    ch := 'a'\n    for _, value := range mySlice {\n        key := fmt.Sprintf(\"%c\", ch)\n        myVariables[key] = value\n        ch++\n    }\n    fmt.Println(myVariables)\n}\n\n</code></pre>\n\n<p>The output will be:</p>\n\n<pre><code>map[a:1 b:2 c:3 d:4 e:5 f:6 g:7 h:8 i:9 j:10]\n</code></pre>\n\n<p>You can also generate the key name randomly, visit <a href=\"https://www.calhoun.io/creating-random-strings-in-go/\" rel=\"nofollow noreferrer\">here</a> for details</p>\n"}], "owner": {"reputation": 3, "user_id": 8386359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3470d138fc5f8ba51c61c699a8fe42f6?s=128&d=identicon&r=PG&f=1", "display_name": "Sirmorrison", "link": "https://stackoverflow.com/users/8386359/sirmorrison"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 353, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1563769475, "creation_date": 1563764652, "last_edit_date": 1563765437, "question_id": 57138697, "link": "https://stackoverflow.com/questions/57138697/how-to-unpack-a-slice", "title": "How to unpack a slice", "body": "<p>How can i unpack a slice in golang?</p>\n\n<p>I have a slice,</p>\n\n<pre><code>var a = [1,2,3,4,5, ...n ]\n</code></pre>\n\n<p>What i want to achieve is to be able to generate new variables dynamically for the length of the slice.\nThe output should look something like this</p>\n\n<pre><code>Var a = 1, b= 2, c=3, n=last number in slice\n</code></pre>\n"}, {"tags": ["regex", "go", "grafana", "prometheus", "re2"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 6553328, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/omcAX.jpg?s=128&g=1", "display_name": "Emma", "link": "https://stackoverflow.com/users/6553328/emma"}, "is_accepted": false, "score": 0, "last_activity_date": 1563765928, "last_edit_date": 1592644375, "creation_date": 1563765928, "answer_id": 57138833, "question_id": 57138246, "link": "https://stackoverflow.com/questions/57138246/regex-grafana-variables-convert-hyphen-separated-ips-to-dot-separated-ips/57138833#57138833", "title": "Regex: Grafana Variables convert hyphen separated IPs to Dot separated IPs", "body": "<p>It seems to me the one you have designed should be working fine:</p>\n<h3>Test</h3>\n<pre><code>package main\n\nimport (\n    &quot;regexp&quot;\n    &quot;fmt&quot;\n)\n\nfunc main() {\n    var re = regexp.MustCompile(`(?m)([0-9]{2,3})-([0-9]{2,3})-([0-9]{2,3})-([0-9]{2,3})`)\n    var str = `kube_node_info{container_runtime_version=&quot;docker://18.6.1&quot;,endpoint=&quot;http&quot;,instance=&quot;10.11.111.111:8080&quot;,job=&quot;kube-state-metrics&quot;,kernel_version=&quot;xxxxx&quot;,kubelet_version=&quot;xxxx&quot;,kubeproxy_version=&quot;xxxx&quot;,namespace=&quot;infra&quot;,node=&quot;ip-10-11-111-111.us-sdlls-as.compute.internal&quot;,os_image=&quot;Amazon Linux 2&quot;,pod=&quot;prometheus-operator-kube-state-metrics-sdfgsjdkgl-saldjl&quot;,service=&quot;prometheus-operator-kube-state-metrics&quot; \n\nkube_node_info{container_runtime_version=&quot;docker://18.6.1&quot;,endpoint=&quot;http&quot;,instance=&quot;10.11.111.111:8080&quot;,job=&quot;kube-state-metrics&quot;,kernel_version=&quot;xxxxx&quot;,kubelet_version=&quot;xxxx&quot;,kubeproxy_version=&quot;xxxx&quot;,namespace=&quot;infra&quot;,node=&quot;ip-10-11-111-111.us-sdlls-as.compute.internal&quot;,os_image=&quot;Amazon Linux 2&quot;,pod=&quot;prometheus-operator-kube-state-metrics-sdfgsjdkgl-saldjl&quot;,service=&quot;prometheus-operator-kube-state-metrics&quot; \n\n`\n    var substitution = &quot;$1.$2.$3.$4&quot;\n    \n    fmt.Println(re.ReplaceAllString(str, substitution))\n}\n</code></pre>\n<p>The expression is explained on the top right panel of <a href=\"https://regex101.com/r/DCR9XO/1/\" rel=\"nofollow noreferrer\">regex101.com</a>, if you wish to explore/simplify/modify it, and in <a href=\"https://regex101.com/r/DCR9XO/1/debugger\" rel=\"nofollow noreferrer\">this link</a>, you can watch how it would match against some sample inputs, if you like.</p>\n"}, {"tags": [], "owner": {"reputation": 8251, "user_id": 2912665, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/XrRhd.jpg?s=128&g=1", "display_name": "CinCout", "link": "https://stackoverflow.com/users/2912665/cincout"}, "is_accepted": false, "score": -1, "last_activity_date": 1563768772, "creation_date": 1563768772, "answer_id": 57139102, "question_id": 57138246, "link": "https://stackoverflow.com/questions/57138246/regex-grafana-variables-convert-hyphen-separated-ips-to-dot-separated-ips/57139102#57139102", "title": "Regex: Grafana Variables convert hyphen separated IPs to Dot separated IPs", "body": "<p>Your regex must work fine. However, the character sets are redundant since you are only using digits per set. Hence, they can be removed:</p>\n\n<p><code>(\\d{2,3})-(\\d{2,3})-(\\d{2,3})-(\\d{2,3})</code></p>\n\n<p>The captured data can then be substituted as:</p>\n\n<p><code>$1.$2.$3.$4</code></p>\n\n<p><a href=\"https://regex101.com/r/fbrsjg/1\" rel=\"nofollow noreferrer\">Demo</a></p>\n"}, {"tags": [], "owner": {"reputation": 99, "user_id": 6333264, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TxrcwjksT2U/AAAAAAAAAAI/AAAAAAAABA8/BE8P960oOgc/photo.jpg?sz=128", "display_name": "supa_command", "link": "https://stackoverflow.com/users/6333264/supa-command"}, "is_accepted": true, "score": -1, "last_activity_date": 1563864628, "creation_date": 1563864628, "answer_id": 57158225, "question_id": 57138246, "link": "https://stackoverflow.com/questions/57138246/regex-grafana-variables-convert-hyphen-separated-ips-to-dot-separated-ips/57158225#57158225", "title": "Regex: Grafana Variables convert hyphen separated IPs to Dot separated IPs", "body": "<p>The actual intent was to capture the IP of the instance and list all of them as a dynamic variable via a query and then enable all the node metrics via the IPs. This was a bad approach since lot of prometheus node-metrics are exported with label <code>node=ip-XX-XX-XXX-XXX-&lt;region&gt;-.compute.internal</code> (where XX are digits). Also grafana variables reports match of only the 1st sub-group - ideally it should be all the subgroups.</p>\n\n<p>However, even if i were to capture the subgroup say XX.XX.XXX.XXX this would mean for every metric that I need to capture and graph I would need to address for matches for all the IPs in the EKS nodes - this is not possible especially if we want to enable \"All\" variable in which grafana replaces the variable call with regex of all the variables matches. Ex. if my k8s node had following IPs:\n* 10.10.0.1\n* 10.10.0.2\n* 10.10.0.3\nand I call this variable as Node\nGrafana will list following variables:\n* All\n* 10.10.0.1\n* 10.10.0.2\n* 10.10.0.3\nOn selecting <code>All</code> grafana will do replace of $Node to <code>./*(10.10.0.1|10.10.0.2|10.10.0.3)*/</code> However if i had a Query for getting the node info : <code>kube_pod_info{node=~\"$Node\"}</code> -> this would fail because node name is in a different format we may try and solve it by using <code>label_replace</code> but again we cannot address using <code>$Node</code> in case <code>All</code> variable is used.</p>\n\n<p>Conclusion : use the variable <code>$Node</code> (i.e. \n* ip-10-10-0-1.us-sdlls-as.compute.internal\n* ip-10-10-0-2.us-sdlls-as.compute.internal\n* ip-10-10-0-3.us-sdlls-as.compute.internal\n) - <em>as-is</em> this would make all other panels much more convenient and easy to configure.</p>\n"}], "owner": {"reputation": 99, "user_id": 6333264, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TxrcwjksT2U/AAAAAAAAAAI/AAAAAAAABA8/BE8P960oOgc/photo.jpg?sz=128", "display_name": "supa_command", "link": "https://stackoverflow.com/users/6333264/supa-command"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1362, "favorite_count": 0, "accepted_answer_id": 57158225, "answer_count": 3, "score": 1, "last_activity_date": 1563864628, "creation_date": 1563759233, "last_edit_date": 1563765986, "question_id": 57138246, "link": "https://stackoverflow.com/questions/57138246/regex-grafana-variables-convert-hyphen-separated-ips-to-dot-separated-ips", "title": "Regex: Grafana Variables convert hyphen separated IPs to Dot separated IPs", "body": "<p>I am trying to created a variable in Grafana using a custom query to scan the nodes in EKS cluster. Currently the node variable is stored as \"hyphen\" separated strings (ex. 10-109-22-102); i intend it to be reported as \"dot\" separated strings (ex. 10.109.22.102). Is this even possible by regex?</p>\n\n<p>Grafana <a href=\"https://grafana.com/docs/reference/templating/#variables\" rel=\"nofollow noreferrer\">variables</a> support creating of live variables by scraping a given metric and then extracting a value in the reported metric using regex. I am currently scraping a metric:</p>\n\n<blockquote>\n  <p>kube_node_info{container_runtime_version=\"docker://18.6.1\",endpoint=\"http\",instance=\"10.11.111.111:8080\",job=\"kube-state-metrics\",kernel_version=\"xxxxx\",kubelet_version=\"xxxx\",kubeproxy_version=\"xxxx\",namespace=\"infra\",node=\"ip-10-11-111-111.us-sdlls-as.compute.internal\",os_image=\"Amazon\n  Linux\n  2\",pod=\"prometheus-operator-kube-state-metrics-sdfgsjdkgl-saldjl\",service=\"prometheus-operator-kube-state-metrics\"}</p>\n</blockquote>\n\n<p>I am currently using regex: <code>/.*node=\"ip-([^\"]*).us-*/</code> to extract the \"hyphen\" separated IPs. I have also tried using other match groups ex: <code>([\\d]{2,3})-([\\d]{2,3})-([\\d]{2,3})-([\\d]{2,3})</code> however this returns only first match-group in grafana (in this case <code>10</code>) as the only option.</p>\n\n<p>Expected output should be:</p>\n\n<pre><code>10.11.111.111\n</code></pre>\n"}, {"tags": ["go", "scanf"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563743533, "post_id": 57136639, "comment_id": 100789717, "body": "I count 8 formatting directives, and 7 arguments"}, {"owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563743677, "post_id": 57136639, "comment_id": 100789743, "body": "@JimB My bad. That doesn&#39;t really change the outcome."}], "answers": [{"comments": [{"owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "edited": false, "score": 1, "creation_date": 1563794886, "post_id": 57137241, "comment_id": 100805087, "body": "Thanks. Yeah, I kinda missed that it mentioned <code>successive space-separated values into successive arguments</code>. I thought that it&#39;s possible to customize that behavior the same way as in <a href=\"https://golang.org/pkg/bufio/#Scanner.Split\" rel=\"nofollow noreferrer\">Scanner.Split</a>"}], "tags": [], "owner": {"reputation": 763, "user_id": 6789498, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RYF7A.jpg?s=128&g=1", "display_name": "esote", "link": "https://stackoverflow.com/users/6789498/esote"}, "is_accepted": true, "score": 3, "last_activity_date": 1563745908, "creation_date": 1563745908, "answer_id": 57137241, "question_id": 57136639, "link": "https://stackoverflow.com/questions/57136639/why-do-i-get-input-does-not-match-format-when-i-use-fmt-fscanf/57137241#57137241", "title": "Why do I get &quot;input does not match format&quot; when I use fmt.Fscanf?", "body": "<p>The error comes from how <a href=\"https://golang.org/pkg/fmt/#Fscanf\" rel=\"nofollow noreferrer\"><code>Fscanf</code></a> parses <em>space-separated</em> strings. This becomes an issue when reading the date and HTTP string:</p>\n\n<p>When it reads the date, instead of reading <code>09/May/2018:16:00:39 +0000</code> it will read until the first space: <code>09/May/2018:16:00:39</code> then expect <code>]</code>.</p>\n\n<p>To fix this, it would make sense to parse the string as <code>[%s %s]</code>, but this would fail more subtly. It would parse the timezone as <code>+0000]</code> because it stops at the first space, not according to the format string. The same issue occurs with the HTTP string: it stops parsing after the verb <code>GET</code>, then after the route <code>/report</code>, but when reading the protocol it reads <code>HTTP/1.0\"</code> not <code>HTTP/1.0</code>.</p>\n\n<p>A working solution is as follows:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"strings\"\n)\n\nfunc main() {\n    var host, user, date, tzOffset, verb, route, proto string\n    var code, size int\n\n    r := strings.NewReader(`127.0.0.1 - james [09/May/2018:16:00:39 +0000] \"GET /report HTTP/1.0\" 200 123`)\n\n    _, err := fmt.Fscanf(r, `%s - %s %s %s %s %s %s %d %d`,\n        &amp;host, &amp;user, &amp;date, &amp;tzOffset, &amp;verb, &amp;route, &amp;proto, &amp;code,\n        &amp;size)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    date = date[1:] + \" \" + tzOffset[:len(tzOffset)-1]\n    httpString := verb[1:] + \" \" + route + \" \" + proto[:len(proto)-1]\n\n    fmt.Println(host, user, date, httpString, code, size)\n}\n</code></pre>\n\n<p>Here we ignore the brackets and quotes around the date and HTTP string when parsing, then remove them afterwards.</p>\n\n<p>Output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>127.0.0.1 james 09/May/2018:16:00:39 +0000 GET /report HTTP/1.0 200 123\n</code></pre>\n"}], "owner": {"reputation": 18004, "user_id": 675100, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/jTqPB.png?s=128&g=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/675100/patryk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 491, "favorite_count": 0, "accepted_answer_id": 57137241, "answer_count": 1, "score": 1, "last_activity_date": 1563745908, "creation_date": 1563739871, "last_edit_date": 1563743657, "question_id": 57136639, "link": "https://stackoverflow.com/questions/57136639/why-do-i-get-input-does-not-match-format-when-i-use-fmt-fscanf", "title": "Why do I get &quot;input does not match format&quot; when I use fmt.Fscanf?", "body": "<p>I'm trying to use <code>fmt.Fscanf</code> but I'm having hard time figuring out how. Having the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    var host, user, date, httpStr string\n    var code, size int\n\n    r := strings.NewReader(`127.0.0.1 - james [09/May/2018:16:00:39 +0000] \"GET /report HTTP/1.0\" 200 123`)\n\n    _, err := fmt.Fscanf(r, `%s - %s [%s], \"%s\" %d %d`,\n        &amp;host, &amp;user, &amp;date, &amp;httpStr, &amp;code, &amp;size)\n    if err != nil {\n        fmt.Printf(\"Failed to parse log line, error: %+v\\n\", err)\n        panic(err)\n    }\n\n    fmt.Println(host, user, date, httpStr, code, size)\n\n}\n</code></pre>\n\n<p>Go playground: <a href=\"https://play.golang.org/p/zGxc6MXOF3a\" rel=\"nofollow noreferrer\">https://play.golang.org/p/zGxc6MXOF3a</a></p>\n\n<p>I get:</p>\n\n<pre><code>Failed to parse log line, error: input does not match format\npanic: input does not match format\n\ngoroutine 1 [running]:\nmain.main()\n        .../fscanf/main.go:19 +0x57b\nexit status 2\n</code></pre>\n\n<p>Why?</p>\n"}, {"tags": ["tensorflow", "go"], "comments": [{"owner": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "edited": false, "score": 0, "creation_date": 1563734582, "post_id": 57135551, "comment_id": 100787790, "body": "What was the value of the <code>GO111MODULE</code> environment variable when you entered the command, and what was your working directory?"}, {"owner": {"reputation": 51, "user_id": 7832506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4f75f8bd8bc4f6658548b74bf1ba53f?s=128&d=identicon&r=PG&f=1", "display_name": "T. Watzl", "link": "https://stackoverflow.com/users/7832506/t-watzl"}, "reply_to_user": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "edited": false, "score": 0, "creation_date": 1563824765, "post_id": 57135551, "comment_id": 100820658, "body": "So my <code>GO111MODULE</code> variable seems to be not set.  At first I had the project located inside <code>$GOPATH&#47;src</code> and later moved it out to the home directory.  And I also upgraded go to 1.12.7, but without success."}, {"owner": {"reputation": 51, "user_id": 7832506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4f75f8bd8bc4f6658548b74bf1ba53f?s=128&d=identicon&r=PG&f=1", "display_name": "T. Watzl", "link": "https://stackoverflow.com/users/7832506/t-watzl"}, "reply_to_user": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "edited": false, "score": 0, "creation_date": 1563825773, "post_id": 57135551, "comment_id": 100821010, "body": "Is it possible that the issue is caused by the unusual* repo structure of tensorflow where the go project is not at the root of the repository?  *with unusual I mean unusual for go projects"}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 7832506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4f75f8bd8bc4f6658548b74bf1ba53f?s=128&d=identicon&r=PG&f=1", "display_name": "T. Watzl", "link": "https://stackoverflow.com/users/7832506/t-watzl"}, "is_accepted": false, "score": 0, "last_activity_date": 1563879215, "creation_date": 1563879215, "answer_id": 57162502, "question_id": 57135551, "link": "https://stackoverflow.com/questions/57135551/how-to-import-the-tensorflow-go-packages-when-using-go-modules-in-a-project/57162502#57162502", "title": "How to import the tensorflow go packages when using go modules in a project?", "body": "<p>So for now I use a dirty workaround to get around this issue. I just ripped out go modules from my project entirely by removing <code>go.mod</code> and <code>go.sum</code> files and setting <code>GO111MODULE=off</code>.</p>\n\n<p>It is not the best solution, hence I do not accept the answer, but for now I can continue working.</p>\n"}], "owner": {"reputation": 51, "user_id": 7832506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4f75f8bd8bc4f6658548b74bf1ba53f?s=128&d=identicon&r=PG&f=1", "display_name": "T. Watzl", "link": "https://stackoverflow.com/users/7832506/t-watzl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 340, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1563879215, "creation_date": 1563730807, "last_edit_date": 1563825574, "question_id": 57135551, "link": "https://stackoverflow.com/questions/57135551/how-to-import-the-tensorflow-go-packages-when-using-go-modules-in-a-project", "title": "How to import the tensorflow go packages when using go modules in a project?", "body": "<p>So I have a project and I am using go modules. However I need to use the tensorflow package, but it seems tensorflow is not yet supporting go modules. Is there a way to import those two dependencies despite the lack of module definitions?</p>\n\n<p>The following 2 imports seem to cause the problems:  </p>\n\n<pre><code>tf \"github.com/tensorflow/tensorflow/tensorflow/go\"\n\"github.com/tensorflow/tensorflow/tensorflow/go/op\"  \n</code></pre>\n\n<p>When I try to download the packages I get the following output:</p>\n\n<pre><code>$ go get -u \"github.com/tensorflow/tensorflow/tensorflow/go/op\"\ngo: finding github.com/tensorflow/tensorflow/tensorflow/go/op latest\ngo: finding github.com/tensorflow/tensorflow/tensorflow/go latest\ngo: finding github.com/tensorflow/tensorflow/tensorflow latest\ngo get github.com/tensorflow/tensorflow/tensorflow/go/op: no matching versions for query \"latest\"\n</code></pre>\n\n<p>However in my test project which still used the old way of importing packages everything worked just fine.</p>\n\n<p>Edit: </p>\n\n<p>After some testing I realized that the issue only happens with the go packages of tensorflow. All others, even if not originally written with go modules, work just fine.</p>\n\n<p>I corrected the imports in the original question, as well as the title.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1563756481, "post_id": 57135170, "comment_id": 100791754, "body": "please read all the comments in below answer - you are missing an action it suggests"}], "answers": [{"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1563728294, "post_id": 57135201, "comment_id": 100786280, "body": "<a href=\"https://godoc.org/net/http#Request.RequestURI\" rel=\"nofollow noreferrer\">RequestURI</a> is a <code>string</code> which has no <code>Get</code> method."}, {"owner": {"reputation": 21, "user_id": 4764670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e237b9d23940c1445069836a33b5b7ab?s=128&d=identicon&r=PG&f=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/4764670/victor"}, "edited": false, "score": 0, "creation_date": 1563728427, "post_id": 57135201, "comment_id": 100786317, "body": "It works like a charm ! Thank you very much, you gave me the answer very quickly"}, {"owner": {"reputation": 9542, "user_id": 8068625, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4spqa.png?s=128&g=1", "display_name": "Henry Woody", "link": "https://stackoverflow.com/users/8068625/henry-woody"}, "reply_to_user": {"reputation": 21, "user_id": 4764670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e237b9d23940c1445069836a33b5b7ab?s=128&d=identicon&r=PG&f=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/4764670/victor"}, "edited": false, "score": 2, "creation_date": 1563729029, "post_id": 57135201, "comment_id": 100786443, "body": "@Victor if this post answered your question, consider <a href=\"https://stackoverflow.com/help/accepted-answer\">accepting the answer</a> so that others can find it in the future."}, {"owner": {"reputation": 21, "user_id": 4764670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e237b9d23940c1445069836a33b5b7ab?s=128&d=identicon&r=PG&f=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/4764670/victor"}, "reply_to_user": {"reputation": 9542, "user_id": 8068625, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4spqa.png?s=128&g=1", "display_name": "Henry Woody", "link": "https://stackoverflow.com/users/8068625/henry-woody"}, "edited": false, "score": 0, "creation_date": 1567428713, "post_id": 57135201, "comment_id": 101950944, "body": "@HenryWoody I have just done this.  I am still a newby in stackoverflow, thank you for your comment"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1563736862, "last_edit_date": 1563736862, "creation_date": 1563727937, "answer_id": 57135201, "question_id": 57135170, "link": "https://stackoverflow.com/questions/57135170/getting-all-of-the-url-in-go/57135201#57135201", "title": "Getting all of the url in Go", "body": "<p>Use <a href=\"https://godoc.org/net/http#Request.RequestURI\" rel=\"nofollow noreferrer\">Request.RequestURI</a> to get the request URI.</p>\n\n<pre><code>func lang(w http.ResponseWriter, r *http.Request) {\n        message := r.RequestURI\n        w.Write([]byte(message))\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 4764670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e237b9d23940c1445069836a33b5b7ab?s=128&d=identicon&r=PG&f=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/4764670/victor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 57135201, "answer_count": 1, "score": -1, "last_activity_date": 1563736862, "creation_date": 1563727758, "last_edit_date": 1563728467, "question_id": 57135170, "link": "https://stackoverflow.com/questions/57135170/getting-all-of-the-url-in-go", "title": "Getting all of the url in Go", "body": "<p>I would like to create a function which print the name of the url.\nIt is not working when the url has a '?' character.</p>\n\n<p>Thank you for your help</p>\n\n<pre><code>func lang(w http.ResponseWriter, r *http.Request) {\n        message := r.URL.Path\n        w.Write([]byte(message))\n}\n</code></pre>\n"}, {"tags": ["function", "go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563725317, "post_id": 57134569, "comment_id": 100785662, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/24425987/why-is-my-goroutine-not-executed\">Why is my goroutine not executed?</a> and <a href=\"https://stackoverflow.com/questions/28958192/no-output-from-goroutine-in-go\">No output from goroutine in Go</a>."}], "answers": [{"tags": [], "owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "is_accepted": false, "score": 5, "last_activity_date": 1563731769, "last_edit_date": 1563731769, "creation_date": 1563723179, "answer_id": 57134607, "question_id": 57134569, "link": "https://stackoverflow.com/questions/57134569/why-are-these-goroutines-not-printing-to-the-console/57134607#57134607", "title": "Why are these goroutines not printing to the console?", "body": "<blockquote>\n  <p>How can I view these prints with the actual \"concurrent\" behavior?</p>\n</blockquote>\n\n<p>Have <code>main</code> wait or otherwise do something once it spawns the goroutines. As it is now, it simply returns which terminates the program (and your goroutines with it).</p>\n"}, {"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1563735855, "post_id": 57135173, "comment_id": 100788072, "body": "one solution involves errgroup <a href=\"https://godoc.org/golang.org/x/sync/errgroup\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/sync/errgroup</a>"}], "tags": [], "owner": {"reputation": 46, "user_id": 11815704, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/4635da44566b1dcf133c959012334e75?s=128&d=identicon&r=PG", "display_name": "nooryg", "link": "https://stackoverflow.com/users/11815704/nooryg"}, "is_accepted": true, "score": 3, "last_activity_date": 1563727776, "creation_date": 1563727776, "answer_id": 57135173, "question_id": 57134569, "link": "https://stackoverflow.com/questions/57134569/why-are-these-goroutines-not-printing-to-the-console/57135173#57135173", "title": "Why are these goroutines not printing to the console?", "body": "<p>To get the expected result, wait for the goroutines to complete before exiting the program.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nvar wg sync.WaitGroup\n\nfunc print1() {\n    fmt.Println(\"print 1\")\n    wg.Done()\n}\n\nfunc print2() {\n    fmt.Println(\"print 2\")\n    wg.Done()\n}\n\nfunc print3() {\n    fmt.Println(\"print 3\")\n    wg.Done()\n}\n\nfunc main() {\n\n    for i := 0; i &lt; 3; i++ {\n        wg.Add(1)\n        go print1()\n    }\n\n    for i := 0; i &lt; 3; i++ {\n        wg.Add(1)\n        go print2()\n    }\n\n    for i := 0; i &lt; 3; i++ {\n        wg.Add(1)\n        go print3()\n    }\n\n    wg.Wait()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/mf2Uoqfdb3Z\" rel=\"nofollow noreferrer\">https://play.golang.org/p/mf2Uoqfdb3Z</a></p>\n"}], "owner": {"reputation": 707, "user_id": 8343916, "user_type": "registered", "accept_rate": 7, "profile_image": "https://www.gravatar.com/avatar/54d382e5c2f991df05e0f0138af7e5a9?s=128&d=identicon&r=PG&f=1", "display_name": "claudioz", "link": "https://stackoverflow.com/users/8343916/claudioz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 624, "favorite_count": 0, "closed_date": 1563735903, "accepted_answer_id": 57135173, "answer_count": 2, "score": -5, "last_activity_date": 1563735870, "creation_date": 1563722871, "last_edit_date": 1563735870, "question_id": 57134569, "link": "https://stackoverflow.com/questions/57134569/why-are-these-goroutines-not-printing-to-the-console", "closed_reason": "Duplicate", "title": "Why are these goroutines not printing to the console?", "body": "<p>I can't explain the behavior of goruotines in certain cases. I try to make an easy example.\nThis is my own file \"<code>main.go</code>\":</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc print1() {\n    fmt.Println(\"print 1\")\n}\n\nfunc print2() {\n    fmt.Println(\"print 2\")\n}\n\nfunc print3() {\n    fmt.Println(\"print 3\")\n}\n\nfunc main() {\n\n    for i:=0; i&lt;3; i++ {\n        go print1()\n    }\n\n    for i:=0; i&lt;3; i++ {\n        go print2()\n    }\n\n    for i:=0; i&lt;3; i++ {\n        go print3()\n    }\n\n}\n</code></pre>\n\n<p>I would expect the 3 functions (each invoked three times in a cycle) are performed concurrently, with the result that the order of the print numbers is unpredictable.\nI can't understand why the program compiles and executes without any error but it doesn't print anything on the console!\nIn practice, it is as if the function calls inside the for are not executed. If I remove the <code>go</code> clauses, the prints are displayed on the console. I came to the conclusion that parallel threads do not have the right to print on my console. How can I view these prints with the actual \"concurrent\" behavior?</p>\n"}, {"tags": ["go", "concurrency"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 3475004, "user_type": "registered", "profile_image": "https://graph.facebook.com/100006259861701/picture?type=large", "display_name": "beginner", "link": "https://stackoverflow.com/users/3475004/beginner"}, "edited": false, "score": 0, "creation_date": 1563722819, "post_id": 57134272, "comment_id": 100785061, "body": "Thank you. Not sure that i understand you correctly,  the term &quot;receiver are ready&quot; in statement &quot;communication on an unbuffered channel does not proceed until both the sender and receiver are ready.&quot; is understood as &quot;receiver is created  and waiting&quot;. So i understood the root cause is I  sent value 0 to channel quit, so it blocks the creating of  the receiver fibonacci. Is my understanding correct ?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 35, "user_id": 3475004, "user_type": "registered", "profile_image": "https://graph.facebook.com/100006259861701/picture?type=large", "display_name": "beginner", "link": "https://stackoverflow.com/users/3475004/beginner"}, "edited": false, "score": 0, "creation_date": 1563725106, "post_id": 57134272, "comment_id": 100785636, "body": "The sender and receiver are goroutines.  A goroutine is ready when it executes the the channel operation."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1563725045, "last_edit_date": 1563725045, "creation_date": 1563720603, "answer_id": 57134272, "question_id": 57134195, "link": "https://stackoverflow.com/questions/57134195/go-routines-are-deadlock-when-sending-value-to-channel-outside-the-go-routines/57134272#57134272", "title": "Go routines are deadlock when sending value to channel outside the go routines", "body": "<p>The <code>quit</code> channel is an unbuffered channel.  Communication on an unbuffered channel does not proceed until both a sending and receiving goroutine are ready. The statement <code>quit &lt;- 0</code> blocks before the application executes the function to receive the value.  A receiving goroutine will never be ready</p>\n\n<p>Fix by closing the channel:</p>\n\n<pre><code>c := make(chan int)\nquit := make(chan int)\ngo func() {\n    fmt.Println(&lt;-c)\n}()\nclose(quit)\nfibonacci(c, quit)\n</code></pre>\n\n<p>... or by making the channel buffered</p>\n\n<pre><code>c := make(chan int, 1) // &lt;- note size 1\nquit := make(chan int)\ngo func() { \n    fmt.Println(&lt;-c) \n}()\nquit &lt;- 0   \nfibonacci(c, quit)\n</code></pre>\n\n<p>In this scenario, <code>fibonacci</code> will quit before yielding a value.</p>\n"}], "owner": {"reputation": 35, "user_id": 3475004, "user_type": "registered", "profile_image": "https://graph.facebook.com/100006259861701/picture?type=large", "display_name": "beginner", "link": "https://stackoverflow.com/users/3475004/beginner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 57134272, "answer_count": 1, "score": -1, "last_activity_date": 1563725045, "creation_date": 1563719963, "question_id": 57134195, "link": "https://stackoverflow.com/questions/57134195/go-routines-are-deadlock-when-sending-value-to-channel-outside-the-go-routines", "title": "Go routines are deadlock when sending value to channel outside the go routines", "body": "<p>I tried changing a little bit on the code when learning Go select statement in  Golang tour: <a href=\"https://tour.golang.org/concurrency/5\" rel=\"nofollow noreferrer\">https://tour.golang.org/concurrency/5</a>. However, i got issue: </p>\n\n<pre><code>fatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan send]:\nmain.main()\n        concurrency.go:26 +0xa3\n\ngoroutine 33 [chan receive]:\nmain.main.func1(0xc000088000)\n        concurrency.go:24 +0x42\ncreated by main.main\n        concurrency.go:23 +0x89\nexit status 2\n</code></pre>\n\n<p>Here is the code i tried and got the issue</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func fibonacci(c, quit chan int) {\n    x, y := 0, 1\n    for {\n        select {\n            case c &lt;- x:  //sending value x into channel c\n                x, y = y, x+y\n            case &lt;-quit:    //receive value from quit\n                fmt.Println(\"quit\")\n        return\n        }\n    }\n}\n\nfunc main() {\n    //create two channels\n    c := make(chan int)\n    quit := make(chan int)\n    go func() { //spin off the second function in order to let consume from c , so fibonaci can continue to work\n        fmt.Println(&lt;-c)    //read value from channel c\n    }()\n    //Try moving the statement that send value to channel quit in order to \n    //return function fibonacci\n    quit &lt;- 0   \n    fibonacci(c, quit)\n}\n</code></pre>\n\n<p>At first, i thought that the result will be same with result of  below code </p>\n\n<pre><code>//function fibonacci is same with the first one\nfunc fibonacci(c, quit chan int) {\n    x, y := 0, 1\n    for {\n        select {\n            case c &lt;- x:  //sending value x into channel c\n                x, y = y, x+y\n            case &lt;-quit:    //receive value from quit\n                fmt.Println(\"quit\")\n        return\n        }\n    }\n}\n\nfunc main() {\n    //create two channels\n    c := make(chan int)\n    quit := make(chan int)\n    go func() { //spin off the second function in order to let consume from c , so fibonaci can continue to work\n        fmt.Println(&lt;-c)    //read value from channel c\n        quit &lt;- 0 //CHANGE: move the statement inside the closure function \n    }()\n\n    fibonacci(c, quit)\n}\n</code></pre>\n\n<p>The output is </p>\n\n<pre><code>0\nquit\n</code></pre>\n\n<p>Can you please explain what's the root cause of deadlock when executing the first example? \nAnd what are differences when  sending value to quit channel in the go routines with sending value to quit channel in the main thread. </p>\n\n<p>Thank you guys.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1563718691, "post_id": 57133957, "comment_id": 100783970, "body": "in the standard api there is no such things like a New of net connection. instead, there is a Dial function, that returns an established connection (<a href=\"https://golang.org/pkg/net/#Dial\" rel=\"nofollow noreferrer\">golang.org/pkg/net/#Dial</a>), or an error. it seems to me you are reinventing the wheel."}, {"owner": {"reputation": 4849, "user_id": 3234803, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/FEjsw.png?s=128&g=1", "display_name": "Zizheng Tai", "link": "https://stackoverflow.com/users/3234803/zizheng-tai"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1563718754, "post_id": 57133957, "comment_id": 100783991, "body": "@mh-cbon The connection type is just an example, my question is about any type that needs blocking initiation in general."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1563718845, "post_id": 57133957, "comment_id": 100784016, "body": "Set the expectations for #1 by naming the function \u201cDial\u201d."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1563718871, "post_id": 57133957, "comment_id": 100784019, "body": "i see. Follow the std api, don t use surprising constructor, prefer package methods with clear meaning. I believe there is no constructor that panics in the std api, or returns an error, but i m not 100% sure of that, at least, for my own i would not."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1563747799, "post_id": 57133957, "comment_id": 100790489, "body": "@mh-cbon &quot;or returns an error&quot; --- <a href=\"https://golang.org/pkg/database/sql/#Open\" rel=\"nofollow noreferrer\">golang.org/pkg/database/sql/#Open</a> It totally is okay to return an error from a constructor, from the software design perspective they don&#39;t have any special properties from other functions."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1563800437, "post_id": 57133957, "comment_id": 100808331, "body": "&quot;A blocking constructor might be surprising.&quot; No, a non-blocking constructor would be surprising - what would it do, return a channel and then return the newly-created instance on the channel async? Though from context I&#39;m guessing you don&#39;t actually mean just &quot;blocking&quot;, you mean something like &quot;a constructor that blocks indefinitely&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1563747483, "post_id": 57137284, "comment_id": 100790433, "body": "One may also add a context to make it cancellable."}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1563753764, "post_id": 57137284, "comment_id": 100791334, "body": "@zerkms: true. In the <code>net</code> package <code>DialContext</code> does that"}, {"owner": {"reputation": 4849, "user_id": 3234803, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/FEjsw.png?s=128&g=1", "display_name": "Zizheng Tai", "link": "https://stackoverflow.com/users/3234803/zizheng-tai"}, "edited": false, "score": 1, "creation_date": 1563771851, "post_id": 57137284, "comment_id": 100794378, "body": "Thanks for the explanation. After reading some code in the stdlib, I&#39;m gradually realizing that there really isn&#39;t a concept of &quot;constructor&quot; in Go. It&#39;s just a creator function."}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 3, "last_activity_date": 1563746458, "creation_date": 1563746458, "answer_id": 57137284, "question_id": 57133957, "link": "https://stackoverflow.com/questions/57133957/blocking-constructor-in-go/57137284#57137284", "title": "Blocking constructor in Go", "body": "<p>As the comments suggest, there's nothing wrong with a blocking constructor, but the naming of the function should reflect the fact that it may block. The documentation should, too.</p>\n\n<p>In the standard library, if you want to create a new socket and connect to some server you can do it in a single call: <code>net.Dial</code></p>\n\n<pre><code>func Dial(network, address string) (Conn, error)\n</code></pre>\n\n<p>It's a blocking operation that returns a new <code>Conn</code>.</p>\n\n<p>So it's idiomatic to do this in Go, you should just name it right. I agree with your intuition that #2 is less great for usability.</p>\n"}], "owner": {"reputation": 4849, "user_id": 3234803, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/FEjsw.png?s=128&g=1", "display_name": "Zizheng Tai", "link": "https://stackoverflow.com/users/3234803/zizheng-tai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 57137284, "answer_count": 1, "score": 0, "last_activity_date": 1563746458, "creation_date": 1563718208, "question_id": 57133957, "link": "https://stackoverflow.com/questions/57133957/blocking-constructor-in-go", "title": "Blocking constructor in Go", "body": "<p>Assume I have a type <code>Connection</code>, which represents say a TCP connection. Establishing a connection is a blocking operation. I see two ways to design its interface, and my question is which of them is more idiomatic in Go:</p>\n\n<ol>\n<li><code>func NewConnection(...) (*Connection, error)</code> blocks and returns an established connection.\n\n<ul>\n<li>Pros: Can't have invalid <code>Connection</code>s hanging around. Any <code>Connection</code> in memory is an established, valid connection.</li>\n<li>Cons: A blocking constructor might be surprising.</li>\n</ul></li>\n<li><code>func NewConnection(...) Connection</code> immediately returns a fresh connection, and we need to call a blocking <code>func (c *Connection) Establish() error</code> to actually establish the connection.\n\n<ul>\n<li>Pros: Nonblocking constructor seems more \"normal\" to me.</li>\n<li>Cons: People might forget to call <code>Establish</code>. This is trivial in this case, but in case where the type is complicated and we need to do a lot of configuration on it (and might even need to call things in certain order), this leaves the programmer much greater opportunity to screw up.</li>\n</ul></li>\n</ol>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 1, "creation_date": 1563698227, "post_id": 57130942, "comment_id": 100779322, "body": "What are you doing with errDecode from.                     <code>errDecode := json.NewDecoder(r.Body).Decode(&amp;data)</code> ?"}, {"owner": {"reputation": 3, "user_id": 10240779, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_wkUBbeTrI4/AAAAAAAAAAI/AAAAAAAAAd8/tkm0dUWJ32w/photo.jpg?sz=128", "display_name": "James Rizaldi", "link": "https://stackoverflow.com/users/10240779/james-rizaldi"}, "reply_to_user": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1563698842, "post_id": 57130942, "comment_id": 100779468, "body": "Define error if decode fail, I am not give all the code, I have handle this errDecode"}, {"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 1, "creation_date": 1563700611, "post_id": 57130942, "comment_id": 100779849, "body": "The code you left out may be important. <code>data</code> is already a pointer. what is the line at audioo_api/handler/profile.go:73 and what post request middleware you have?"}, {"owner": {"reputation": 3, "user_id": 10240779, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_wkUBbeTrI4/AAAAAAAAAAI/AAAAAAAAAd8/tkm0dUWJ32w/photo.jpg?sz=128", "display_name": "James Rizaldi", "link": "https://stackoverflow.com/users/10240779/james-rizaldi"}, "reply_to_user": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1563703944, "post_id": 57130942, "comment_id": 100780563, "body": "in line 73, I call method p.repo.Updateprofile(). in this method, the &quot;data&quot; appear if I fmt.println(data) same as input in body request. You can see I block if username already exist, so far in this line code the server work well the response &quot;Username already exist&quot;, but if passed the the server responses invali address BUT the data successfull updated in my DB. OMG :("}, {"owner": {"reputation": 3, "user_id": 10240779, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_wkUBbeTrI4/AAAAAAAAAAI/AAAAAAAAAd8/tkm0dUWJ32w/photo.jpg?sz=128", "display_name": "James Rizaldi", "link": "https://stackoverflow.com/users/10240779/james-rizaldi"}, "reply_to_user": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1563704745, "post_id": 57130942, "comment_id": 100780773, "body": "I tried to not use middleware authorized but, still the error still the same"}, {"owner": {"reputation": 397, "user_id": 1234577, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hDdLD.jpg?s=128&g=1", "display_name": "masadi zainul", "link": "https://stackoverflow.com/users/1234577/masadi-zainul"}, "edited": false, "score": 0, "creation_date": 1563883398, "post_id": 57130942, "comment_id": 100841288, "body": "the root problem you can see at your question , at <code>audioo_api&#47;handler&#47;profile.go:73</code> this one make it panic and the what make panic we need figure out the code at thoose line, but for the learning you must check if the data type is pointer better you check first is nil or not, if you just pass, it could be something happen to panic if you access the value inside"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 10240779, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_wkUBbeTrI4/AAAAAAAAAAI/AAAAAAAAAd8/tkm0dUWJ32w/photo.jpg?sz=128", "display_name": "James Rizaldi", "link": "https://stackoverflow.com/users/10240779/james-rizaldi"}, "edited": false, "score": 0, "creation_date": 1563704347, "post_id": 57131799, "comment_id": 100780678, "body": "if I change data = new(models.EditProfile), the &quot;data&quot; from r.body not carried away. and this error still appear"}, {"owner": {"reputation": 146, "user_id": 4420958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/212cadd0a6448c307c19ac240248efd7?s=128&d=identicon&r=PG", "display_name": "Denis Volin", "link": "https://stackoverflow.com/users/4420958/denis-volin"}, "reply_to_user": {"reputation": 3, "user_id": 10240779, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_wkUBbeTrI4/AAAAAAAAAAI/AAAAAAAAAd8/tkm0dUWJ32w/photo.jpg?sz=128", "display_name": "James Rizaldi", "link": "https://stackoverflow.com/users/10240779/james-rizaldi"}, "edited": false, "score": 0, "creation_date": 1563794262, "post_id": 57131799, "comment_id": 100804751, "body": "Have you changed the <code>Decode</code> part as well, I mean, have you removed the reference?   And if yes, then there&#39;s something wrong with the caller of your <code>Profile.UpdateProfile</code> method, check why it receives the <code>Request</code> with <code>nil</code> <code>Body</code> field.  Can you give a bit more details on the setup, specifically, what is the source of the <code>Request</code>, do you have control over that code, and if so, can you specify the line where the <code>Request</code> value is created and how, when it is being used to call <code>Profile.UpdateProfile</code> method?"}], "tags": [], "owner": {"reputation": 146, "user_id": 4420958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/212cadd0a6448c307c19ac240248efd7?s=128&d=identicon&r=PG", "display_name": "Denis Volin", "link": "https://stackoverflow.com/users/4420958/denis-volin"}, "is_accepted": true, "score": 0, "last_activity_date": 1563700678, "last_edit_date": 1563700678, "creation_date": 1563700298, "answer_id": 57131799, "question_id": 57130942, "link": "https://stackoverflow.com/questions/57130942/panic-runtime-error-invalid-memory-address-or-nil-pointer-dereference-r-bod/57131799#57131799", "title": "panic: runtime error: invalid memory address or nil pointer dereference || r.body model", "body": "<p>According to the package documentation for Body io.ReadCloser: </p>\n\n<blockquote>\n  <p>For client requests, a nil body means the request has no body, such as a GET request. For server requests, the Request Body is always non-nil.</p>\n</blockquote>\n\n<p>You say, it's a server, so, it's always non-nil, thus the error is in the <code>Decode</code> call where you pass a pointer to the nil pointer. </p>\n\n<p><code>data</code> is a <code>nil</code> pointer, <code>&amp;data</code> is a pointer to a <code>nil</code> pointer.</p>\n\n<p>Solution if data is a non interface type, unless <code>models</code> package explicitly forbids <code>new(EditProfile)</code>:</p>\n\n<pre><code>    data = new(models.EditProfile)\n    errDecode := json.NewDecoder(r.Body).Decode(data)\n</code></pre>\n\n<p>If data is an interface, allocate a real value for it first, and again pass without a reference to <code>Decode</code>: <code>errDecode := json.NewDecoder(r.Body).Decode(data)</code></p>\n\n<p>And in the latter case also double check if you declare the right type <code>*models.EditProfile</code>.</p>\n"}], "owner": {"reputation": 3, "user_id": 10240779, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_wkUBbeTrI4/AAAAAAAAAAI/AAAAAAAAAd8/tkm0dUWJ32w/photo.jpg?sz=128", "display_name": "James Rizaldi", "link": "https://stackoverflow.com/users/10240779/james-rizaldi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 295, "favorite_count": 0, "accepted_answer_id": 57131799, "answer_count": 1, "score": 0, "last_activity_date": 1563700678, "creation_date": 1563691401, "last_edit_date": 1592644375, "question_id": 57130942, "link": "https://stackoverflow.com/questions/57130942/panic-runtime-error-invalid-memory-address-or-nil-pointer-dereference-r-bod", "title": "panic: runtime error: invalid memory address or nil pointer dereference || r.body model", "body": "<p>I have problem newbie Go Programming like: invalid memory address or nil pointer dereference</p>\n<p>Sometime I can resolve the problem, but this is make me confuse.\nthis is the code in Handler level, I tried to implement ###p.repo.UpdateProfile()\nand data from r.body decode</p>\n<pre><code>//UpdateProfile handler\nfunc (p *Profile) UpdateProfile(w http.ResponseWriter, r *http.Request) {\n    var (\n        errForm   models.ErrorForm\n        resp      models.Response\n        respError models.ErrorResponse\n        errField  models.ErrField\n        data      *models.EditProfile\n    )\n\n    userid := r.Context().Value(viper.GetString(&quot;token.userid&quot;))\n        \n        errDecode := json.NewDecoder(r.Body).Decode(&amp;data)\n\n    errPayload := p.repo.UpdateProfile(r.Context(), data, userid)\n\n    if errPayload.Error() == &quot;username_exist&quot; {\n        respError.Message = &quot;username already taken&quot;\n        respError.Status = 422\n        lib.ResJSON(w, respError.Status, respError)\n        return\n    }\n    lib.Catch(errPayload)\n\n    resp.Data = &quot;&quot;\n    resp.Message = &quot;Success&quot;\n    resp.Status = 200\n\n    lib.ResJSON(w, resp.Status, resp)\n}\n</code></pre>\n<h2>and the Method like:</h2>\n<pre><code>\nfunc (m *mysqlProfileRepo) UpdateProfile(ctx context.Context, p *models.EditProfile, userid interface{}) error {\n    query := &quot;&quot;\n    var checkexist int\n\n    row1, err1 := m.Conn.QueryContext(ctx, query, p.Username)\n    if err1 != nil {\n        return err1\n    }\n\n    for row1.Next() {\n        if errSc1 := row1.Scan(&amp;checkexist); errSc1 != nil {\n            return errors.New(&quot;error_scan_db&quot;)\n        }\n    }\n\n    if checkexist != 0 {\n        return errors.New(&quot;username_exist&quot;)\n    }\n\n    query1 := &quot;&quot;\n    query2 := &quot;&quot;\n\n    stmts := []*lib.PipelineStmt{\n        lib.NewPipelineStmt(query1, p.Image, p.Location, p.Link, p.Bio, p.Birthday, userid),\n        lib.NewPipelineStmt(query2, p.Username, p.Fullname, userid),\n    }\n\n    errTrx := lib.WithTransaction(m.Conn, func(tx lib.Transaction) error {\n        _, errRunPipe := lib.RunPipeline(tx, stmts...)\n        return errRunPipe\n    })\n\n    if errTrx != nil {\n        return errTrx\n    }\n\n    return nil\n}\n</code></pre>\n<h3>MyCode work well in database, the data successfully updated, but the response server is</h3>\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n2019/07/21 13:27:36 goroutine 8 [running]:\nruntime/debug.Stack(0xc00028e100, 0x16b1a20, 0xc000094040)\n    /usr/local/Cellar/go/1.12.6/libexec/src/runtime/debug/stack.go:24 +0x9d\ngithub.com/go-chi/chi/middleware.Recoverer.func1.1(0xc00028e100, 0x16b6be0, 0xc000256280)\n    /Users/rizaldinurmuhammad/go/src/github.com/go-chi/chi/middleware/recoverer.go:25 +0x9c\npanic(0x155e7a0, 0x1a66a10)\n    /usr/local/Cellar/go/1.12.6/libexec/src/runtime/panic.go:522 +0x1b5\naudioo_api/handler.(*Profile).UpdateProfile(0xc000020030, 0x16b6be0, 0xc000256280, 0xc00028e200)\n    /Users/rizaldinurmuhammad/go/src/audioo_api/handler/profile.go:73 +0x524\nnet/http.HandlerFunc.ServeHTTP(0xc000020050, 0x16b6be0, 0xc000256280, 0xc00028e200)\n    /usr/local/Cellar/go/1.12.6/libexec/src/net/http/server.go:1995 +0x44\naudioo_api/lib/mid.Authenticate.func1.1(0x16b6be0, 0xc000256280, 0xc00028e100)\n    /Users/rizaldinurmuhammad/go/src/audioo_api/lib/mid/auth.go:48 +0x71e\nnet/http.HandlerFunc.ServeHTTP(0xc00000e0a0, 0x16b6be0, 0xc000256280, 0xc00028e100)\n    /usr/local/Cellar/go/1.12.6/libexec/src/net/http/server.go:1995 +0x44\ngithub.com/go-chi/chi.(*ChainHandler).ServeHTTP(0xc000066140, 0x16b6be0, 0xc000256280, 0xc00028e100)\n    /Users/rizaldinurmuhammad/go/src/github.com/go-chi/chi/chain.go:31 +0x52\ngithub.com/go-chi/chi.(*Mux).routeHTTP(0xc0000a5f80, 0x16b6be0, 0xc000256280, 0xc00028e100)\n    /Users/rizaldinurmuhammad/go/src/github.com/go-chi/chi/mux.go:425 +0x27f\nnet/http.HandlerFunc.ServeHTTP(0xc000020040, 0x16b6be0, 0xc000256280, 0xc00028e100)\n    /usr/local/Cellar/go/1.12.6/libexec/src/net/http/server.go:1995 +0x44\ngithub.com/go-chi/chi.(*Mux).ServeHTTP(0xc0000a5f80, 0x16b6be0, 0xc000256280, 0xc00028e100)\n    /Users/rizaldinurmuhammad/go/src/github.com/go-chi/chi/mux.go:70 +0x451\ngithub.com/go-chi/chi.(*Mux).Mount.func1(0x16b6be0, 0xc000256280, 0xc00028e100)\n    /Users/rizaldinurmuhammad/go/src/github.com/go-chi/chi/mux.go:292 +0x127\nnet/http.HandlerFunc.ServeHTTP(0xc00000e0e0, 0x16b6be0, 0xc000256280, 0xc00028e100)\n    /usr/local/Cellar/go/1.12.6/libexec/src/net/http/server.go:1995 +0x44\ngithub.com/go-chi/chi.(*Mux).routeHTTP(0xc0000a59e0, 0x16b6be0, 0xc000256280, 0xc00028e100)\n    /Users/rizaldinurmuhammad/go/src/github.com/go-chi/chi/mux.go:425 +0x27f\nnet/http.HandlerFunc.ServeHTTP(0xc0001db880, 0x16b6be0, 0xc000256280, 0xc00028e100)\n    /usr/local/Cellar/go/1.12.6/libexec/src/net/http/server.go:1995 +0x44\ngithub.com/go-chi/chi.(*Mux).ServeHTTP(0xc0000a59e0, 0x16b6be0, 0xc000256280, 0xc00028e100)\n    /Users/rizaldinurmuhammad/go/src/github.com/go-chi/chi/mux.go:70 +0x451\ngithub.com/go-chi/chi.(*Mux).Mount.func1(0x16b6be0, 0xc000256280, 0xc00028e100)\n    /Users/rizaldinurmuhammad/go/src/github.com/go-chi/chi/mux.go:292 +0x127\nnet/http.HandlerFunc.ServeHTTP(0xc00000e180, 0x16b6be0, 0xc000256280, 0xc00028e100)\n    /usr/local/Cellar/go/1.12.6/libexec/src/net/http/server.go:1995 +0x44\ngithub.com/go-chi/chi.(*Mux).routeHTTP(0xc0000a5920, 0x16b6be0, 0xc000256280, 0xc00028e100)\n    /Users/rizaldinurmuhammad/go/src/github.com/go-chi/chi/mux.go:425 +0x27f\nnet/http.HandlerFunc.ServeHTTP(0xc000020090, 0x16b6be0, 0xc000256280, 0xc00028e100)\n    /usr/local/Cellar/go/1.12.6/libexec/src/net/http/server.go:1995 +0x44\naudioo_api/lib/mid.Limit.func1(0x16b6be0, 0xc000256280, 0xc00028e100)\n    /Users/rizaldinurmuhammad/go/src/audioo_api/lib/mid/limit.go:79 +0xe5\nnet/http.HandlerFunc.ServeHTTP(0xc00000e1a0, 0x16b6be0, 0xc000256280, 0xc00028e100)\n    /usr/local/Cellar/go/1.12.6/libexec/src/net/http/server.go:1995 +0x44\ngithub.com/go-chi/cors.(*Cors).Handler.func1(0x16b6be0, 0xc000256280, 0xc00028e100)\n    /Users/rizaldinurmuhammad/go/src/github.com/go-chi/cors/cors.go:201 +0x1a4\nnet/http.HandlerFunc.ServeHTTP(0xc00000e1c0, 0x16b6be0, 0xc000256280, 0xc00028e100)\n    /usr/local/Cellar/go/1.12.6/libexec/src/net/http/server.go:1995 +0x44\ngithub.com/go-chi/chi/middleware.Recoverer.func1(0x16b6be0, 0xc000256280, 0xc00028e100)\n    /Users/rizaldinurmuhammad/go/src/github.com/go-chi/chi/middleware/recoverer.go:35 +0x9f\nnet/http.HandlerFunc.ServeHTTP(0xc00000e1e0, 0x16b6be0, 0xc000256280, 0xc00028e100)\n    /usr/local/Cellar/go/1.12.6/libexec/src/net/http/server.go:1995 +0x44\ngithub.com/go-chi/chi/middleware.RedirectSlashes.func1(0x16b6be0, 0xc000256280, 0xc00028e100)\n    /Users/rizaldinurmuhammad/go/src/github.com/go-chi/chi/middleware/strip.go:53 +0x202\nnet/http.HandlerFunc.ServeHTTP(0xc00000e200, 0x16b6be0, 0xc000256280, 0xc00028e100)\n    /usr/local/Cellar/go/1.12.6/libexec/src/net/http/server.go:1995 +0x44\ngithub.com/go-chi/chi/middleware.(*Compressor).Handler.func1.1(0x1f69180, 0xc000256240, 0xc00028e100)\n    /Users/rizaldinurmuhammad/go/src/github.com/go-chi/chi/middleware/compress.go:190 +0x254\nnet/http.HandlerFunc.ServeHTTP(0xc00000e2c0, 0x1f69180, 0xc000256240, 0xc00028e100)\n    /usr/local/Cellar/go/1.12.6/libexec/src/net/http/server.go:1995 +0x44\ngithub.com/go-chi/chi/middleware.RequestLogger.func1.1(0x16b78a0, 0xc000226000, 0xc00028e000)\n    /Users/rizaldinurmuhammad/go/src/github.com/go-chi/chi/middleware/logger.go:46 +0x291\nnet/http.HandlerFunc.ServeHTTP(0xc00009a210, 0x16b78a0, 0xc000226000, 0xc00028e000)\n    /usr/local/Cellar/go/1.12.6/libexec/src/net/http/server.go:1995 +0x44\ngithub.com/go-chi/chi.(*Mux).ServeHTTP(0xc0000a5920, 0x16b78a0, 0xc000226000, 0xc000154000)\n    /Users/rizaldinurmuhammad/go/src/github.com/go-chi/chi/mux.go:82 +0x294\nnet/http.serverHandler.ServeHTTP(0xc00009c410, 0x16b78a0, 0xc000226000, 0xc000154000)\n    /usr/local/Cellar/go/1.12.6/libexec/src/net/http/server.go:2774 +0xa8\nnet/http.(*conn).serve(0xc0002ce640, 0x16b8aa0, 0xc000067340)\n    /usr/local/Cellar/go/1.12.6/libexec/src/net/http/server.go:1878 +0x851\ncreated by net/http.(*Server).Serve\n    /usr/local/Cellar/go/1.12.6/libexec/src/net/http/server.go:2884 +0x2f4\n\n</code></pre>\n<h3>I have tried to change context to implement database but the response still the same.</h3>\n<p>I wonder this problem related in r.body, but I dont know how to figure out</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4392, "user_id": 5215131, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-2C8rv6T-3m8/AAAAAAAAAAI/AAAAAAAAAP0/ALwPPtWwxac/photo.jpg?sz=128", "display_name": "Florian Zwoch", "link": "https://stackoverflow.com/users/5215131/florian-zwoch"}, "edited": false, "score": 1, "creation_date": 1563697364, "post_id": 57129662, "comment_id": 100779122, "body": "That&#39;s up to the OS to do - or prevent. You will need to check your OS&#39;s API for some functionality that allows intercepting these events when the application is not in focus."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 11664721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c444c2837a00645d6a1664daf2b555fe?s=128&d=identicon&r=PG&f=1", "display_name": "liangzi", "link": "https://stackoverflow.com/users/11664721/liangzi"}, "edited": false, "score": 0, "creation_date": 1563796817, "post_id": 57140154, "comment_id": 100806217, "body": "Thanks Reply Yes, the program can&#39;t run in the background. This is also the problem I want to solve. I don\u2019t know why, I don\u2019t know how to solve it."}], "tags": [], "owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "is_accepted": false, "score": 0, "last_activity_date": 1563776414, "creation_date": 1563776414, "answer_id": 57140154, "question_id": 57129662, "link": "https://stackoverflow.com/questions/57129662/a-go-code-program-failed-to-run-in-the-background/57140154#57140154", "title": "A go code program failed to run in the background", "body": "<p>If the program is running in the background it will not get any input from the keyboard.</p>\n\n<p>Also since <code>n</code> depends on user input it would be easy for it to exceed the number of sound files and you would get an index out of bounds error at run-time.  You should do something like this:</p>\n\n<pre><code>    if fpath, _ := filepath.Glob(\"./wav/*.wav\"); len(fpath) &gt; 0 {\n        n := int(char)%len(fpath)\n           name := fpath[n]\n        ...\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11664721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c444c2837a00645d6a1664daf2b555fe?s=128&d=identicon&r=PG&f=1", "display_name": "liangzi", "link": "https://stackoverflow.com/users/11664721/liangzi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1563776414, "creation_date": 1563671040, "last_edit_date": 1563692515, "question_id": 57129662, "link": "https://stackoverflow.com/questions/57129662/a-go-code-program-failed-to-run-in-the-background", "title": "A go code program failed to run in the background", "body": "<p>Go code running in the background</p>\n\n<p>I am a beginner of the go language.\nI wrote a small program that made a keyboard sound.\nAfter <code>go build main.go</code>, you can hear the sound of the button in the current shell.\nBut when running <code>./main</code> in the background or when re-opening a new shell will not hear the button sound.\nThis is what I need help with.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/eiannone/keyboard\"\n    \"github.com/faiface/beep\"\n    \"github.com/faiface/beep/speaker\"\n    \"github.com/faiface/beep/wav\"\n    \"os\"\n    \"time\"\n    \"log\"\n    \"path/filepath\"\n\n)\n\nfunc main(){\n\n    env:= os.Getenv(\"HOME\")\n    fmt.Println(env)\n\n    err := keyboard.Open()\n    if err != nil {\n\n        panic(err)\n    }\n    defer keyboard.Close()\n    for {\n        char, key, err := keyboard.GetKey()\n        if err != nil {\n            log.Fatal(err)\n        }else if (key == keyboard.KeyEsc){\n            break\n        }\n\n        n := int(char)\n        path := \"./wav/*.wav\"\n        fpath,_ := filepath.Glob(path)\n        name := fpath[n]\n\n        f, err := os.Open(name)\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        streamer, format, err := wav.Decode(f)\n        if err != nil {\n            log.Fatal(err)\n        }\n        defer streamer.Close()\n\n        speaker.Init(format.SampleRate, format.SampleRate.N(time.Second/10))\n\n        done := make(chan bool)\n        speaker.Play(beep.Seq(streamer, beep.Callback(func() {\n            done &lt;- true\n        })))\n\n        &lt;-done\n\n    }\n\n}\n\n</code></pre>\n\n<p>I want it to run in the background. I can hear the corresponding sound after pressing the keyboard.</p>\n"}, {"tags": ["go", "sdl"], "comments": [{"owner": {"reputation": 15473, "user_id": 744720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65030f1bd22dbb4d1e6976cfac08a1c5?s=128&d=identicon&r=PG", "display_name": "keltar", "link": "https://stackoverflow.com/users/744720/keltar"}, "edited": false, "score": 0, "creation_date": 1563702092, "post_id": 57129424, "comment_id": 100780160, "body": "How do you update state array? Is your event update locked to graphics thread?"}, {"owner": {"reputation": 1, "user_id": 9811166, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-t9zkiCDljSM/AAAAAAAAAAI/AAAAAAAAALc/eWlLGr3h7Gc/photo.jpg?sz=128", "display_name": "Yiwei Zhuang", "link": "https://stackoverflow.com/users/9811166/yiwei-zhuang"}, "reply_to_user": {"reputation": 15473, "user_id": 744720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65030f1bd22dbb4d1e6976cfac08a1c5?s=128&d=identicon&r=PG", "display_name": "keltar", "link": "https://stackoverflow.com/users/744720/keltar"}, "edited": false, "score": 0, "creation_date": 1563824244, "post_id": 57129424, "comment_id": 100820488, "body": "@keltar: I only call GetkeyboardState() once at the very the beginning before the main game loop and assign it to keyState which I thought should be a []uint8. Then I do not modify it anymore because I think every input is directly updated through the address. I just read the keyState through the GetInput() function and check which key has been pressed at the beginning of the main game loop like the code above. I did not use an event to check keyboard input and if it is locked, why could I go back to normal through pressing the &quot;wired key&quot; again? I was confused."}, {"owner": {"reputation": 15473, "user_id": 744720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65030f1bd22dbb4d1e6976cfac08a1c5?s=128&d=identicon&r=PG", "display_name": "keltar", "link": "https://stackoverflow.com/users/744720/keltar"}, "edited": false, "score": 1, "creation_date": 1563854232, "post_id": 57129424, "comment_id": 100827704, "body": "To get keyboard state array updated you have to trigger SDL&#39;s internal event processing, e.g. via <code>SDL_PumpEvents</code> (or <code>SDL_PollEvent</code>, which calls pump internally)."}], "owner": {"reputation": 1, "user_id": 9811166, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-t9zkiCDljSM/AAAAAAAAAAI/AAAAAAAAALc/eWlLGr3h7Gc/photo.jpg?sz=128", "display_name": "Yiwei Zhuang", "link": "https://stackoverflow.com/users/9811166/yiwei-zhuang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 132, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563666827, "creation_date": 1563666827, "question_id": 57129424, "link": "https://stackoverflow.com/questions/57129424/getkeyboardstate-always-shows-some-keys-were-pressed-even-though-they-were-not", "title": "GetKeyBoardState() always shows some keys were pressed even though they were not after randomly pressing keyboard for a while", "body": "<p>I am currently learning Go and trying to make a game which allows players to press several buttons at the same time. Right now, my code works for a while, but sometimes when I randomly press, the GetKeyboardState() always records one or more keys as pressed. The weird key only can be released when I press the key again. Then everything goes correctly again.\nFor example, I randomly press Up, Down, Left, Right, and right shift bottom on the keyboard to control the character in the game. Suddenly, the character always tries to go right and if I press Up or Down arrow, the character will just go to the top right or the bottom right. Only if I press the right arrow button again, the character can stop go right.</p>\n\n<p>I thought maybe the game goes too fast so I limit the fps under 90 but the situation still exists.</p>\n\n<p>Also, I tried to print out the keyboard status and it always shows the weird bottom was pressed when the situation happened even if I did not touch my keyboard.</p>\n\n<pre><code>func GetInput(keyState []uint8, prevKeyState []uint8) []Input {\n   input := make([]Input, 0)\n   if keyState[sdl.SCANCODE_UP] != 0 {\n       input = append(input, Input{Up})\n   }\n       ...\n   // Handle Down, Right, Left\n   if keyState[sdl.SCANCODE_RSHIFT] == 0 &amp;&amp; prevKeyState[sdl.SCANCODE_RSHIFT] != 0 {\n       input = append(input, Input{RShift})\n   }\n   if keyState[sdl.SCANCODE_B] == 0 &amp;&amp; prevKeyState[sdl.SCANCODE_B] != 0 \n       {\n       input = append(input, Input{Debug})\n   }\n\n   // something like prevKeyState = keystate\n   return input\n}\n</code></pre>\n\n<p>How I use it</p>\n\n<pre><code>keyState := sdl.GetKeyboardState()\nprevKeyState := make([]uint8, len(keyState))\nfor {\n    ...\n    input := ui.GetInput(keyState, prevKeyState)\n    HandleInput(input, board)\n    ...\n}\n</code></pre>\n"}, {"tags": ["algorithm", "go", "fibonacci"], "comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1601455746, "post_id": 57129276, "comment_id": 113410762, "body": "Does this answer your question another way? <a href=\"https://stackoverflow.com/a/64133793/12817546\">stackoverflow.com/a/64133793/12817546</a>"}], "answers": [{"tags": [], "owner": {"reputation": 22202, "user_id": 696391, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VrUwT.jpg?s=128&g=1", "display_name": "samgak", "link": "https://stackoverflow.com/users/696391/samgak"}, "is_accepted": true, "score": 1, "last_activity_date": 1563665201, "creation_date": 1563665201, "answer_id": 57129316, "question_id": 57129276, "link": "https://stackoverflow.com/questions/57129276/what-should-i-change-in-the-code-to-generate-a-fibonacci-sequence-starting-from/57129316#57129316", "title": "What should I change in the code to generate a fibonacci sequence starting from 0 1 1", "body": "<p>Change your function to return res to this:</p>\n\n<pre><code> return func () int {\n\n    res := y\n    y = z\n    z = res + z\n\n    return res\n\n}\n</code></pre>\n\n<p>This way you output the initial values first, and calculate the next values. Your current solution overwrites the initial values before they are returned.</p>\n"}, {"comments": [{"owner": {"reputation": 11799, "user_id": 9259778, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R157q.jpg?s=128&g=1", "display_name": "Nurbol Alpysbayev", "link": "https://stackoverflow.com/users/9259778/nurbol-alpysbayev"}, "edited": false, "score": 0, "creation_date": 1563667042, "post_id": 57129324, "comment_id": 100775217, "body": "Interesting, but was a bit hard for me as a go newbie :-) However, your answer finally gave me the real use case of using multiple variable assignment (<code>f, a, b = a, b, a+b</code>)"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1563666060, "last_edit_date": 1563666060, "creation_date": 1563665231, "answer_id": 57129324, "question_id": 57129276, "link": "https://stackoverflow.com/questions/57129276/what-should-i-change-in-the-code-to-generate-a-fibonacci-sequence-starting-from/57129324#57129324", "title": "What should I change in the code to generate a fibonacci sequence starting from 0 1 1", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n// fibonacci returns a function that returns\n// successive Fibonacci numbers.\nfunc fibonacci() func() int {\n    a, b := 0, 1\n    return func() (f int) {\n        if a &lt; 0 {\n            panic(\"overflow\")\n        }\n        f, a, b = a, b, a+b\n        return f\n    }\n}\n\nfunc main() {\n    f := fibonacci()\n    for i := 0; i &lt; 10; i++ {\n        fmt.Println(f())\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/uYHEK_ZgE6K\" rel=\"nofollow noreferrer\">https://play.golang.org/p/uYHEK_ZgE6K</a></p>\n\n<p>Output:</p>\n\n<pre><code>0\n1\n1\n2\n3\n5\n8\n13\n21\n34\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11799, "user_id": 9259778, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R157q.jpg?s=128&g=1", "display_name": "Nurbol Alpysbayev", "link": "https://stackoverflow.com/users/9259778/nurbol-alpysbayev"}, "edited": false, "score": 1, "creation_date": 1563666912, "post_id": 57129325, "comment_id": 100775205, "body": "Nice, thanks! But I slightly prefer the other answer because it doesn&#39;t introduce the new variable"}], "tags": [], "owner": {"reputation": 8201, "user_id": 3690024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e2d5067f52318f0ed4db9eca0b2cda1?s=128&d=identicon&r=PG", "display_name": "AJNeufeld", "link": "https://stackoverflow.com/users/3690024/ajneufeld"}, "is_accepted": false, "score": 1, "last_activity_date": 1563665238, "creation_date": 1563665238, "answer_id": 57129325, "question_id": 57129276, "link": "https://stackoverflow.com/questions/57129276/what-should-i-change-in-the-code-to-generate-a-fibonacci-sequence-starting-from/57129325#57129325", "title": "What should I change in the code to generate a fibonacci sequence starting from 0 1 1", "body": "<p>If you added:</p>\n\n<pre><code>x := y\n</code></pre>\n\n<p>and changed the return statement to</p>\n\n<pre><code>return x\n</code></pre>\n\n<p>you would be returning the initial <code>y := 0</code> value, instead of the computed <code>res := y + z</code>, so returning the values 2 earlier in the sequence, giving you <code>0, 1, 1, 2, 3, 5, ...</code></p>\n\n<p>(But I wouldn\u2019t consider the <code>-1, 1</code> initializer a hack.)</p>\n"}], "owner": {"reputation": 11799, "user_id": 9259778, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R157q.jpg?s=128&g=1", "display_name": "Nurbol Alpysbayev", "link": "https://stackoverflow.com/users/9259778/nurbol-alpysbayev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 1, "accepted_answer_id": 57129316, "answer_count": 3, "score": -1, "last_activity_date": 1563666060, "creation_date": 1563664637, "question_id": 57129276, "link": "https://stackoverflow.com/questions/57129276/what-should-i-change-in-the-code-to-generate-a-fibonacci-sequence-starting-from", "title": "What should I change in the code to generate a fibonacci sequence starting from 0 1 1", "body": "<p>I've searched older questions, there are tons of them. However I couldn't find the answer to my case.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\nfunc fibonacci() func() int {\n    y := 0\n    z := 1\n\n    return func () int {\n\n        res := y + z\n        y = z\n        z = res\n\n        return res\n\n    }\n}\n\nfunc main() {\n    f := fibonacci()\n    for i := 0; i &lt; 10; i++ {\n        fmt.Println(f())\n    }\n}\n</code></pre>\n\n<p>This produces 1 2 3 5 8 </p>\n\n<p>What should I change (as little as possible) to get 0 1 1 2 3 5 8 ?</p>\n\n<p>Actually I managed to solve that if initial <code>y</code> and <code>z</code> were like this:</p>\n\n<pre><code>    y := -1\n    z := 1\n</code></pre>\n\n<p>But that's a fortunate hack, and I want a logical solution.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563664998, "post_id": 57129057, "comment_id": 100774998, "body": "The JSON decoder has no knowledge of the types used to create the JSON.   Can you decode to <code>map[string]Gallery</code> or <code>struct { Gallery Gallery }</code> instead of  <code>map[string]interface{}</code>?"}, {"owner": {"reputation": 1, "user_id": 11107795, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6ofzP.png?s=128&g=1", "display_name": "JNN", "link": "https://stackoverflow.com/users/11107795/jnn"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563827901, "post_id": 57129057, "comment_id": 100821928, "body": "Well, both map[string]Gallery and struct {Gallery Gallery] will work if all types were defined as Gallery. The idea behind the map is to hold multiple struct names and their associated struct types. This is why I thought using an interface{} will become a place-holder for any struct type. Just to add: I will actually be entering values into a JSON file manually and then using this JSON to create a map and compare the struct name as key and associated type (entered as value in the map) against a user input. I basically need a way to pass name/value to the program via an external file, e.g. JSON"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563829206, "post_id": 57129057, "comment_id": 100822453, "body": "Your comment describes a map containing struct types.  Did you mean struct values?  Does a given key uniquely identify the desired type of the value?"}, {"owner": {"reputation": 1, "user_id": 11107795, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6ofzP.png?s=128&g=1", "display_name": "JNN", "link": "https://stackoverflow.com/users/11107795/jnn"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1563916926, "post_id": 57129057, "comment_id": 100857916, "body": "By values, I mean entries into the map. I don&#39;t mean struct values. To clarify a map defined as map[string]interface{}: the key part of the map [string] will represent the name of the struct and the value part of the map interface{} will represent the the type of the struct. E.g. to add a struct Gallery to the map, I will define it as: type Gallery struct{}. then to put this in the map, it will be: myMap[&quot;Gallery&quot;]=Gallery{}      I really don&#39;t need the values of the struct fields. I need just the struct names and its type."}], "owner": {"reputation": 1, "user_id": 11107795, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6ofzP.png?s=128&g=1", "display_name": "JNN", "link": "https://stackoverflow.com/users/11107795/jnn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 487, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563661702, "creation_date": 1563661702, "question_id": 57129057, "link": "https://stackoverflow.com/questions/57129057/convert-a-mapstringinterface-to-json-and-same-json-to-mapstringinterface", "title": "convert a map[string]interface{} to JSON and same JSON to map[string]interface{} (preserve interface{} types)", "body": "<p>I am putting structs names and types into a map, Marshal this map into a JSON and Unmarshal this JSON back into a map which I can extract the types of each struct the same as before.</p>\n\n<p>Here is what tried:\n1 - have predefined structs\n2 - define a map[string]interface{}\n3 - populate this map with the struct name as key and struct type as interface() value.\n4 - Marshaled this map into a JSON.\n5 - Define a new map[string]interface{}\n6 - Unmarshal the JSON into this new map for later use in the program.\nMy hope is to preserve the the reflect types of the interface{} the same.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"reflect\"\n)\n\n// Gallery :\ntype Gallery struct {\n    ID     int\n    Name   string\n    Images []Image\n}\n\n// Image :\ntype Image struct {\n    Source string\n    Height int\n    Width  int\n}\n\nfunc main() {\n    myMap := make(map[string]interface{})\n    myMap[\"Gallery\"] = Gallery{}\n\n    // encode this map into JSON, jStr:\n    jStr, err := json.Marshal(&amp;myMap)\n    if err != nil {\n        fmt.Println(err)\n    }\n        // print the JSON string, just for testing.\n    fmt.Printf(\"jStr is: %v \\n\", string(jStr))\n\n    // create a newMap and populate it with the JSON jStr\n    newMap := make(map[string]interface{})\n    err = json.Unmarshal(jStr, &amp;newMap)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Println()\n\n    // iterate over myMap and inspect the reflect type of v\n    for k, v := range myMap {\n        fmt.Printf(\"myMap: k is: %v \\t v is: %v \\n\", k, v) \n        fmt.Printf(\"myMap: reflect.TypeOf(v) is: %v \\n\", reflect.TypeOf(v).Kind())\n\n    }\n    fmt.Println()\n\n    // iterate over newMap and inspect the reflect type of v\n    for k, v := range newMap {\n        fmt.Printf(\"newMap: k is: %v \\t v is: %v \\n\", k, v) \n        fmt.Printf(\"newMap: reflect.TypeOf(v) is: %v \\n\", reflect.TypeOf(v).Kind())\n\n    fmt.Println()\n}\n</code></pre>\n\n<p>The reflect.TypeOf(v).Kind() for both maps should be struct. But it is not the case. for myMap, the Kind is struct (which is correct), but for newMap, the Kind is map which is NOT correct. What am I missing here. Here is the full code on play.golang.org:  <a href=\"https://play.golang.org/p/q8BBLlw3fMA\" rel=\"nofollow noreferrer\">https://play.golang.org/p/q8BBLlw3fMA</a></p>\n"}, {"tags": ["go", "intellij-idea", "goland", "go-modules"], "answers": [{"tags": [], "owner": {"reputation": 414, "user_id": 2618437, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/SmZfj.jpg?s=128&g=1", "display_name": "Benjamin", "link": "https://stackoverflow.com/users/2618437/benjamin"}, "is_accepted": true, "score": 2, "last_activity_date": 1563653330, "creation_date": 1563653330, "answer_id": 57128197, "question_id": 57128196, "link": "https://stackoverflow.com/questions/57128196/in-intellij-imports-are-not-loading-even-though-go-modules-integration-is-enabl/57128197#57128197", "title": "In IntelliJ imports are not loading, even though go modules integration is enabled", "body": "<p>The reason this approach does not work, has to do with the configuration in IntelliJ. That is why it will work from command line, just not in IntelliJ.</p>\n\n<p>There are two ways to fix this:</p>\n\n<ol>\n<li>Go into Preferences -> Languages &amp; Frameworks -> Go -> Go Modules (vgo) and make sure the box 'Vendoring mode' is not checked.</li>\n<li>Make sure you have a folder called 'vendor' in your IntelliJ project. Now the box 'Vendoring mode' can be safely checked.</li>\n</ol>\n\n<p>With the first approach the dependencies defined in your <code>go.mod</code> file might be re-downloaded, for example when the go project is run from a place where these dependencies are not in the local package registry.</p>\n\n<p>With the second approach the dependencies are put in the 'vendor' folder and do not necessarily need to be re-downloaded, they are sort of made part of the project.</p>\n"}], "owner": {"reputation": 414, "user_id": 2618437, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/SmZfj.jpg?s=128&g=1", "display_name": "Benjamin", "link": "https://stackoverflow.com/users/2618437/benjamin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 757, "favorite_count": 0, "accepted_answer_id": 57128197, "answer_count": 1, "score": 1, "last_activity_date": 1563653330, "creation_date": 1563653330, "question_id": 57128196, "link": "https://stackoverflow.com/questions/57128196/in-intellij-imports-are-not-loading-even-though-go-modules-integration-is-enabl", "title": "In IntelliJ imports are not loading, even though go modules integration is enabled", "body": "<p>When using IntelliJ IDEA with the Go plugin, or GoLand and using Go 1.11 or newer, you can enable Go modules by going to Preferences -> Languages &amp; Frameworks -> Go -> Go Modules (vgo) and check the box 'Enable Go Modules (vgo) integration'.</p>\n\n<p>When you have a project which was properly initialised by <code>go mod init</code>, and therefore has a <code>go.mod</code> and <code>go.sum</code> file, it will download the dependencies when building from command line with <code>go build</code> or from IntelliJ by pressing the green play icon.</p>\n\n<p>However, the import statements to remote dependencies might still be red, even though they seem to have been downloaded and appear in the <code>go.mod</code> file.</p>\n\n<p>Curiously enough, the go project will actually run from the command line, just not from within IntelliJ. Why is this and how can I fix this?</p>\n"}, {"tags": ["go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 3, "last_activity_date": 1563634196, "creation_date": 1563634196, "answer_id": 57125798, "question_id": 57125730, "link": "https://stackoverflow.com/questions/57125730/what-is-the-idiomatic-way-to-reset-some-properties-of-a-struct/57125798#57125798", "title": "What is the idiomatic way to reset some properties of a struct?", "body": "<p>Creating a <code>reset</code> method seems absolutely fine. As a general rule - make it as explicit as possible. It's much better to spend an extra few seconds resetting all the fields explicitly than hours afterward when debugging and missing out un-reset fields. Be sure to add a test for the <code>reset</code> method to ensure it resets all the data you care about.</p>\n"}], "owner": {"reputation": 55, "user_id": 8431001, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23396f07b186686733ca6899622e5a26?s=128&d=identicon&r=PG&f=1", "display_name": "920smmsmsms", "link": "https://stackoverflow.com/users/8431001/920smmsmsms"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1563634196, "creation_date": 1563633644, "question_id": 57125730, "link": "https://stackoverflow.com/questions/57125730/what-is-the-idiomatic-way-to-reset-some-properties-of-a-struct", "title": "What is the idiomatic way to reset some properties of a struct?", "body": "<p>Is there an idiomatic way to reset the properties of a struct? For the sake of example, let's say that I'm creating a Scanner (aka: Lexer):</p>\n\n<pre><code>type Scanner struct {\n  src,\n  tokens string // let's pretend that tokens is a string.\n  pos int\n}\n</code></pre>\n\n<p>And my <code>Scanner</code> has two methods: <code>Init</code> and <code>Scan</code>. Besides that, the package also exports a <code>NewScanner</code> function that the user can create a new Scanner passing custom tokens:</p>\n\n<pre><code>func NewScanner(tokens string) *Scanner {\n    return &amp;Scanner{tokens: tokens}\n}\n</code></pre>\n\n<p>Now the problem arises. The <code>Init</code> method accepts the <code>src</code>:</p>\n\n<pre><code>func (s *Scanner) Init(src string) {\n    s.src = src\n}\n</code></pre>\n\n<p>And then the user would be able to call <code>s.Scan()</code> and get the tokens. What if the user wants to reset the position? I'm assuming I should reset the position to <code>0</code> in the <code>Init</code> method:</p>\n\n<pre><code>func (s *Scanner) Init(src string) {\n    s.src = src\n    s.pos = 0\n}\n</code></pre>\n\n<p>All good. My questions are:</p>\n\n<ol>\n<li><p>Should I create a <code>reset</code> method or reset the properties in the <code>Init</code> method? Is there a rule for that? Coming from a Java world, I would create a <code>Reset</code> method, but Go could be different.</p></li>\n<li><p>Is there a better way to reset only some properties? Let's say that I have more than just <code>src</code>, and <code>pos</code> to reset, it will be very ugly to do:</p>\n\n<p>s.property1 = 0\ns.property2 = \"\"\ns.property3 = \"\"</p></li>\n</ol>\n\n<p>I'm sure you got the idea.</p>\n\n<p>I thought about using:</p>\n\n<pre><code>func (s *Scanner) Init(src string) {\n    s = &amp;Scanner{src, s.tokens, 0, /* other properties */ }\n}\n</code></pre>\n\n<p>But I'm not sure if this is a bad practice in Go, since it's going to cause a re-allocation, right?</p>\n"}, {"tags": ["api", "go", "go-chi"], "comments": [{"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 0, "creation_date": 1563635336, "post_id": 57125612, "comment_id": 100768802, "body": "May I ask why you&#39;re using <code>go-chi</code> instead of the default router in <code>net&#47;http</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 191, "user_id": 8398189, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d37abcdaec57a9964ad1ad12fe9999a?s=128&d=identicon&r=PG", "display_name": "Igor Tulmentyev", "link": "https://stackoverflow.com/users/8398189/igor-tulmentyev"}, "is_accepted": true, "score": 1, "last_activity_date": 1563636084, "creation_date": 1563636084, "answer_id": 57126057, "question_id": 57125612, "link": "https://stackoverflow.com/questions/57125612/how-to-get-parameters-from-url-in-http-handler/57126057#57126057", "title": "How to get parameters from URL in HTTP handler", "body": "<p>You can extract query params from a request by calling the getter <code>r.URL.Query().Get(\"paramName\")</code></p>\n\n<p>Extracting cur1 and cur2 for your task will be something like that:</p>\n\n<pre><code>r.Get(\"/get_rates\", func(w http.ResponseWriter, r *http.Request) {\n        cur1 := r.URL.Query().Get(\"cur1\")\n        cur2 := r.URL.Query().Get(\"cur2\")\n        w.Write([]byte(\"cur1=\" + cur1 + \"; cur2=\" + cur2))\n})\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 11809258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ddacbb88d051a0412d3947798845cec?s=128&d=identicon&r=PG&f=1", "display_name": "DonPepemon", "link": "https://stackoverflow.com/users/11809258/donpepemon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1844, "favorite_count": 0, "accepted_answer_id": 57126057, "answer_count": 1, "score": 0, "last_activity_date": 1563636084, "creation_date": 1563632794, "last_edit_date": 1563634006, "question_id": 57125612, "link": "https://stackoverflow.com/questions/57125612/how-to-get-parameters-from-url-in-http-handler", "title": "How to get parameters from URL in HTTP handler", "body": "<p>I'm working on a web service application with endpoint/crypto/rates accepting as an input two \u201csymbols\u201d of currencies. The web service should search for currency exchange data between these characters in the database, and if there is no value in the database, or the timestamp value differs from the current by more than 1 minute, make a request to the service API:\n<a href=\"https://min-api.cryptocompare.com/documentation\" rel=\"nofollow noreferrer\">https://min-api.cryptocompare.com/documentation</a>\nSo, I created the struct and the go-chi router. But I don't know how to build a working handler to get parameters from URL, for example: <a href=\"https://min-api.cryptocompare.com/data/price?fsym=BTC&amp;tsyms=USD\" rel=\"nofollow noreferrer\">https://min-api.cryptocompare.com/data/price?fsym=BTC&amp;tsyms=USD</a> </p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/go-chi/chi\"\n    \"net/http\"\n)\n\ntype Crypto struct {\n    Cur1 string\n    Cur2 string\n    Rate float64\n    Timestamp int64\n}\nfunc main() {\n    port := \":3000\"\n    r := chi.NewRouter()\n    r.Get(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        w.Write([]byte(\"Connected\"))\n    })\n\n    http.ListenAndServe(port, r)\n</code></pre>\n\n<p>I think I can try to create Cur1 for first value on the handler body:</p>\n\n<pre><code>cur1 = r.FormValue(\"cur1\")\n</code></pre>\n\n<p>Similarly for second value: </p>\n\n<pre><code>Cur2 = r.FormValue(\"cur2\") \n</code></pre>\n\n<p>The final request will be: ~/get_rates?cur1=eth&amp;cur2=btc</p>\n"}, {"tags": ["go", "goland"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1563634188, "post_id": 57125611, "comment_id": 100768551, "body": "Do not use <i>relative</i> imports!"}], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 2, "last_activity_date": 1563634755, "last_edit_date": 1563634755, "creation_date": 1563634310, "answer_id": 57125815, "question_id": 57125611, "link": "https://stackoverflow.com/questions/57125611/golang-import-package-from-root-directory/57125815#57125815", "title": "Golang import package from root directory", "body": "<p>The only recommended/canonical way to do imports is with full paths. If your code lives in <code>github.com/Uranus/myproject</code>, then in <code>endpoints/users.go</code> you should import <code>repository</code> thus:</p>\n\n<pre><code>import \"github.com/Uranus/myproject/repository\"\n</code></pre>\n\n<p>Note that it doesn't actually have to be on github. Using modules, you can have any import path you like while developing locally, as long as it's the module name in your <code>go.mod</code> file.</p>\n\n<p>Follow the examples from <a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">this official Go blog post</a> and you'll know what to do.</p>\n"}], "owner": {"reputation": 23, "user_id": 11424320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bdc13f9a1ff62ba9248ed8eee65cd742?s=128&d=identicon&r=PG&f=1", "display_name": "Uranus", "link": "https://stackoverflow.com/users/11424320/uranus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1152, "favorite_count": 0, "accepted_answer_id": 57125815, "answer_count": 1, "score": -2, "last_activity_date": 1563634755, "creation_date": 1563632787, "last_edit_date": 1563633581, "question_id": 57125611, "link": "https://stackoverflow.com/questions/57125611/golang-import-package-from-root-directory", "title": "Golang import package from root directory", "body": "<p>I'm trying to create a clean architecture API in Go but I'm confused with package logic. Here's the structure of the project.</p>\n\n<pre><code>    main.go                &lt;- package main\n    \u251c\u2500\u2500 delivery/\n    \u2502   \u251c\u2500\u2500 endpoints/\n    \u2502   \u2502   \u251c\u2500\u2500 users.go   &lt;- package endpoints (I want to import ./repository here)\n    \u2502   \u2502   \u2514\u2500\u2500 home.go    &lt;- package endpoints\n    \u2502   \u251c\u2500\u2500 router.go      &lt;- package delivery\n    \u2502   \u251c\u2500\u2500 middleware.go  &lt;- package delivery\n    \u251c\u2500\u2500 repository/\n    \u2502   \u251c\u2500\u2500 database.go    &lt;- package repository\n    \u2502   \u2514\u2500\u2500 fetchUsers.go  &lt;- package repository\n</code></pre>\n\n<p>In <code>router.go</code> file I can access and import endpoints like this <code>import \"./endpoints\"</code>, but when I try to import repository package inside <code>users.go</code> or inside <code>home.go</code> I get an error. Is there a way to access repository from files that are in endpoints folder?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1563630472, "post_id": 57125254, "comment_id": 100767698, "body": "Yes, the struct will be copied, but that is <i>not</i> what is usually referred to as a &quot;deep copy&quot;. This is a simple struct, with no internal pointers. Only the value passed in will be copied."}, {"owner": {"reputation": 11799, "user_id": 9259778, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R157q.jpg?s=128&g=1", "display_name": "Nurbol Alpysbayev", "link": "https://stackoverflow.com/users/9259778/nurbol-alpysbayev"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1563630528, "post_id": 57125254, "comment_id": 100767713, "body": "@JimB And if it wasn&#39;t a simple struct (but with nested structs) then it would be deep copy, right?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1563631170, "post_id": 57125254, "comment_id": 100767831, "body": "<i>&quot;Does golang deep-copy the whole receiver value?&quot;</i> No, all you get is a &quot;shallow&quot; copy."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1563631377, "post_id": 57125254, "comment_id": 100767886, "body": "@NurbolAlpysbayev: nested struct values would be copied, because it&#39;s part of the value. Think about the memory layout of the struct, and what&#39;s being passed in. Pointers are not dereferenced, so only the pointer values would be copied. Same goes for maps and slices."}, {"owner": {"reputation": 11799, "user_id": 9259778, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R157q.jpg?s=128&g=1", "display_name": "Nurbol Alpysbayev", "link": "https://stackoverflow.com/users/9259778/nurbol-alpysbayev"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1563631688, "post_id": 57125254, "comment_id": 100767944, "body": "@mkopriva I think what you mean is that pointer fields will be copied as pointers, not the values they point to. But value fields will be fully copied."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1563633589, "post_id": 57125254, "comment_id": 100768402, "body": "@NurbolAlpysbayev what I meant is what I wrote, &quot;shallow copy&quot;, that&#39;s it. What <i>you</i> mean by &quot;shallow&quot; and &quot;deep&quot; copy, however, is not entirely clear to me but it seems you might be mixing it up a bit. This is also indicated by both answers that had to specifically point out the &quot;depth&quot; of the copy."}, {"owner": {"reputation": 11799, "user_id": 9259778, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R157q.jpg?s=128&g=1", "display_name": "Nurbol Alpysbayev", "link": "https://stackoverflow.com/users/9259778/nurbol-alpysbayev"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1563635178, "post_id": 57125254, "comment_id": 100768774, "body": "@Mkopriva it&#39;s not clear for you probably because you are not too familiar with js or PHP objects. There all objects behave as pointers and so  copying object value is impossible (you could traverse the object field by field though to make copying)"}], "answers": [{"comments": [{"owner": {"reputation": 11799, "user_id": 9259778, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R157q.jpg?s=128&g=1", "display_name": "Nurbol Alpysbayev", "link": "https://stackoverflow.com/users/9259778/nurbol-alpysbayev"}, "edited": false, "score": 1, "creation_date": 1563629993, "post_id": 57125270, "comment_id": 100767594, "body": "Wow, Eli Bendersky, I&#39;ve learnt parsing from your great article on eli.thegreenplace.net (I&#39;ve read it like 20 times). Thank you!"}, {"owner": {"reputation": 11799, "user_id": 9259778, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R157q.jpg?s=128&g=1", "display_name": "Nurbol Alpysbayev", "link": "https://stackoverflow.com/users/9259778/nurbol-alpysbayev"}, "edited": false, "score": 0, "creation_date": 1563630489, "post_id": 57125270, "comment_id": 100767703, "body": "So the same applies to parameters? Eli, I am sorry if I am bothering too much instead of reading the docs (I do but I often miss things), but what are other places where the copying happens? I&#39;ll add this to the question."}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "reply_to_user": {"reputation": 11799, "user_id": 9259778, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R157q.jpg?s=128&g=1", "display_name": "Nurbol Alpysbayev", "link": "https://stackoverflow.com/users/9259778/nurbol-alpysbayev"}, "edited": false, "score": 0, "creation_date": 1563631336, "post_id": 57125270, "comment_id": 100767876, "body": "You can think of the receiver as a special kind of parameter here (like <code>self</code> in Python). By value copies parameters and receivers"}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 3, "last_activity_date": 1563631425, "last_edit_date": 1563631425, "creation_date": 1563629935, "answer_id": 57125270, "question_id": 57125254, "link": "https://stackoverflow.com/questions/57125254/does-golang-deep-copy-the-whole-receiver-value/57125270#57125270", "title": "Does golang deep-copy the whole receiver value?", "body": "<p>Yes, a copy is made. Use pointer receivers if the value is large, you care about avoiding copies, and there are no other considerations (like <em>wanting</em> a copy for various reasons).</p>\n\n<p>The <a href=\"https://golang.org/doc/faq#methods_on_values_or_pointers\" rel=\"nofollow noreferrer\">Go FAQ has a useful entry</a> on value vs. pointer receivers.</p>\n\n<p>Note that a copy is made, but you say \"deep copy\" so be careful here - usually deep copy implies recursive copies including what pointers point to (like copying a whole tree). The copy here is a shallow copy. If <code>Vertex</code> has pointer fields, the <em>values</em> of these pointers will be copied, but not what they point to. There is plenty of discussion of shallow vs. deep copies in Go online; for example <a href=\"https://stackoverflow.com/questions/46790190/quicker-way-to-deepcopy-objects-in-golang\">this SO question</a>. If there are struct fields, the <em>values</em> of these will also be copied, so it's \"deep\" in the sense of struct nesting, but not \"deep\" in the sense of pointers.</p>\n"}, {"comments": [{"owner": {"reputation": 11799, "user_id": 9259778, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R157q.jpg?s=128&g=1", "display_name": "Nurbol Alpysbayev", "link": "https://stackoverflow.com/users/9259778/nurbol-alpysbayev"}, "edited": false, "score": 0, "creation_date": 1563632206, "post_id": 57125513, "comment_id": 100768080, "body": "Interesting example with time. Currently I am not fully understanding it, but I am sure soon, after some experimenting with the time package I&#39;ll get it, and this example will come in handy."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 11799, "user_id": 9259778, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R157q.jpg?s=128&g=1", "display_name": "Nurbol Alpysbayev", "link": "https://stackoverflow.com/users/9259778/nurbol-alpysbayev"}, "edited": false, "score": 0, "creation_date": 1563632513, "post_id": 57125513, "comment_id": 100768156, "body": "@NurbolAlpysbayev: <code>time.Time</code> is a small <code>struct</code>. Pointers introduce a level of indirection, a cost.  Modern hardware performs many optimizations."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1563633912, "last_edit_date": 1563633912, "creation_date": 1563631826, "answer_id": 57125513, "question_id": 57125254, "link": "https://stackoverflow.com/questions/57125254/does-golang-deep-copy-the-whole-receiver-value/57125513#57125513", "title": "Does golang deep-copy the whole receiver value?", "body": "<blockquote>\n  <p>Does [Go] deep-copy the whole receiver value?</p>\n</blockquote>\n\n<hr>\n\n<p>No. Go does not perform a deep copy, only a shallow copy. </p>\n\n<p>In Go, all arguments are passed by value, as if by assignment to the parameter or receiver.</p>\n\n<hr>\n\n<blockquote>\n  <p>therefore, we should use pointer receivers instead of value receivers.</p>\n</blockquote>\n\n<hr>\n\n<p>Not true,</p>\n\n<p>For example, from the Go standard library:</p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">Package time</a></p>\n\n<pre><code>import \"time\"\n</code></pre>\n  \n  <p><a href=\"https://golang.org/pkg/time/#Time\" rel=\"nofollow noreferrer\">type Time</a></p>\n\n<pre><code>type Time struct {\n  wall uint64\n  ext  int64\n  loc *Location\n}\n</code></pre>\n  \n  <p>A Time represents an instant in time with nanosecond precision.</p>\n  \n  <p>Programs using times should typically store and pass them as values,\n  not pointers. That is, time variables and struct fields should be of\n  type time.Time, not *time.Time.</p>\n</blockquote>\n"}], "owner": {"reputation": 11799, "user_id": 9259778, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/R157q.jpg?s=128&g=1", "display_name": "Nurbol Alpysbayev", "link": "https://stackoverflow.com/users/9259778/nurbol-alpysbayev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 608, "favorite_count": 1, "accepted_answer_id": 57125270, "answer_count": 2, "score": 1, "last_activity_date": 1563633912, "creation_date": 1563629831, "last_edit_date": 1563630598, "question_id": 57125254, "link": "https://stackoverflow.com/questions/57125254/does-golang-deep-copy-the-whole-receiver-value", "title": "Does golang deep-copy the whole receiver value?", "body": "<p>I am almost sure of that but I want to be 100% sure. Because this seems weird after JS/PHP.</p>\n\n<pre><code>type Vertex struct {\n    X, Y float64\n}\n\nfunc (v Vertex) Scale(f float64) {\n    v.X = v.X * f\n    v.Y = v.Y * f\n}\n</code></pre>\n\n<p>So is it true that a <em>deep copy</em> (emphasize on this) of <code>v Vertex</code> parameter will be made on every <code>Scale</code> invocation? And therefore, we should use pointer receivers instead of value receivers in order to avoid the deep-copying?</p>\n\n<p>And the same applies to parameters, right? What are other places where the copying happens?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1563629472, "post_id": 57125155, "comment_id": 100767486, "body": "So what problem are you having? What is the output you see? What do you expect instead?"}, {"owner": {"reputation": 11, "user_id": 11812122, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7-8porJNkE0/AAAAAAAAAAI/AAAAAAAAY7U/IHoUyJBtjbA/photo.jpg?sz=128", "display_name": "John Hall", "link": "https://stackoverflow.com/users/11812122/john-hall"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563716619, "post_id": 57125155, "comment_id": 100783451, "body": "I was just trying to return the exit code."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1563735432, "post_id": 57125155, "comment_id": 100787988, "body": "You didn&#39;t answer my question. What problem are you having?"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 11812122, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7-8porJNkE0/AAAAAAAAAAI/AAAAAAAAY7U/IHoUyJBtjbA/photo.jpg?sz=128", "display_name": "John Hall", "link": "https://stackoverflow.com/users/11812122/john-hall"}, "edited": false, "score": 0, "creation_date": 1563716565, "post_id": 57125521, "comment_id": 100783440, "body": "Thanks, Marten, that really helped."}], "tags": [], "owner": {"reputation": 2208, "user_id": 2172752, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c16c7a34114664cf0cd1c5cab0b02e4?s=128&d=identicon&r=PG", "display_name": "MartenCatcher", "link": "https://stackoverflow.com/users/2172752/martencatcher"}, "is_accepted": true, "score": 1, "last_activity_date": 1563632278, "last_edit_date": 1563632278, "creation_date": 1563631882, "answer_id": 57125521, "question_id": 57125155, "link": "https://stackoverflow.com/questions/57125155/how-to-pass-os-exec-output-to-gin-get/57125521#57125521", "title": "how to pass os/exec output to gin get", "body": "<p>If adding a full response of your command suitable to you, you can do it with following code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Powershell(c *gin.Context) {\n    cmd := exec.Command(\"powershell\",\"-file\",\"C:\\\\temp\\\\test.ps1\")\n\n    stdout, err := cmd.Output()\n    if err != nil {\n        c.JSON(200, gin.H{\n            \"Message\": \"Error occurs\",\n            \"Finished\": err,\n        })\n    } else {\n        c.JSON(200, gin.H{\n            \"Message\": string(stdout),\n            \"Finished\": nil,\n        })\n    }\n}\n</code></pre>\n\n<p>But if you want to get just a numeric code you can follow <a href=\"https://stackoverflow.com/questions/10385551/get-exit-code-go\">this answer</a>. I cannot test this solution in windows and cannot guarantee it will work in your case.</p>\n"}], "owner": {"reputation": 11, "user_id": 11812122, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-7-8porJNkE0/AAAAAAAAAAI/AAAAAAAAY7U/IHoUyJBtjbA/photo.jpg?sz=128", "display_name": "John Hall", "link": "https://stackoverflow.com/users/11812122/john-hall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 268, "favorite_count": 0, "accepted_answer_id": 57125521, "answer_count": 1, "score": 0, "last_activity_date": 1563632278, "creation_date": 1563628933, "last_edit_date": 1563629377, "question_id": 57125155, "link": "https://stackoverflow.com/questions/57125155/how-to-pass-os-exec-output-to-gin-get", "title": "how to pass os/exec output to gin get", "body": "<p>I want to pass the exit code of an OS command to the URL. I'm using gin but I'm open to any way.</p>\n\n<p>I just want to pass the err to the HTTP response.</p>\n\n<p>As of yet, I'm not able to find an example for putting os output into HTTP response example so I've come here in the hope someone knows.</p>\n\n<pre><code>package main\nimport (\n        \"fmt\"\n        \"github.com/gin-gonic/gin\"\n        \"os/exec\"\n)\nfunc Homepage(c *gin.Context) {\n        c.JSON(200, gin.H{\n            \"message\": \"Hello World\"\n        }\n}\n\nfunc Powershell(c *gin.Context) {\n    // Run this powershell program from Go.\n    cmd := exec.Command(\"powershell\",\"-file\",\"C:\\\\temp\\\\test.ps1\")\n    // Wait for the Powershell program to exit.\n    err := cmd.Run()\n    //fmt.Println(\"Finished:\", err)}\n\n\n    c.JSON(200, gin.H{\n      \"Message\": \"This is the PowerShell exit code not the script exit code\",\n      \"Finished:\", err\n\n}\n\nfunc main() {\n    fmt.Println(\"hello world\")\n    r := gin.Default()\n    r.GET(\"/\", Homepage)\n    r.GET(\"/app\", Powershell)\n    r.Run()\n}\n</code></pre>\n\n<p>So far everything I've tried just error on the get /app</p>\n"}, {"tags": ["docker", "go", "pipe"], "comments": [{"owner": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "edited": false, "score": 1, "creation_date": 1563604636, "post_id": 57122019, "comment_id": 100762443, "body": "Have you tried reading <code>os.Stdin</code> when Docker is in interactive mode with the flags <code>--interactive</code> or <code>-i</code>?"}, {"owner": {"reputation": 131, "user_id": 1660776, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/776b548bcea4ce6c1e64a81f4f3807bb?s=128&d=identicon&r=PG&f=1", "display_name": "Whispererli", "link": "https://stackoverflow.com/users/1660776/whispererli"}, "reply_to_user": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "edited": false, "score": 0, "creation_date": 1563631134, "post_id": 57122019, "comment_id": 100767826, "body": "Hi Martin, thanks and yes using the interactive mode works. I logged in to the docker with -it and run &quot;/program1 | /logShipper&quot; command is not blocking. So is that the way I&#39;m starting the container cause the issue? I&#39;m run it with /bin/sh -c &quot;/program1 | /logShipper&quot;"}, {"owner": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "edited": false, "score": 0, "creation_date": 1563631907, "post_id": 57122019, "comment_id": 100767997, "body": "Interactive mode keeps <code>stdin</code> open even if not attached; I think your issues is how Docker is interacting with the host&#39;s <code>stdin</code> when not in interactive mode."}, {"owner": {"reputation": 131, "user_id": 1660776, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/776b548bcea4ce6c1e64a81f4f3807bb?s=128&d=identicon&r=PG&f=1", "display_name": "Whispererli", "link": "https://stackoverflow.com/users/1660776/whispererli"}, "reply_to_user": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "edited": false, "score": 0, "creation_date": 1563635703, "post_id": 57122019, "comment_id": 100768872, "body": "Thanks, will check that path:-)"}], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 1660776, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/776b548bcea4ce6c1e64a81f4f3807bb?s=128&d=identicon&r=PG&f=1", "display_name": "Whispererli", "link": "https://stackoverflow.com/users/1660776/whispererli"}, "edited": false, "score": 1, "creation_date": 1563635771, "post_id": 57125562, "comment_id": 100768889, "body": "Thanks for the example and idea! Will try it."}], "tags": [], "owner": {"reputation": 146, "user_id": 4420958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/212cadd0a6448c307c19ac240248efd7?s=128&d=identicon&r=PG", "display_name": "Denis Volin", "link": "https://stackoverflow.com/users/4420958/denis-volin"}, "is_accepted": false, "score": 0, "last_activity_date": 1563632421, "creation_date": 1563632421, "answer_id": 57125562, "question_id": 57122019, "link": "https://stackoverflow.com/questions/57122019/blocked-when-read-from-os-stdin-when-pipe-the-output-in-docker/57125562#57125562", "title": "Blocked when read from os.Stdin when PIPE the output in docker", "body": "<p>I'm not sure about the way the Docker handles output, but I suggest that you extract the file descriptor with <code>os.Stdin.Fd()</code> and then resort to using <a href=\"https://godoc.org/golang.org/x/sys/unix\" rel=\"nofollow noreferrer\">golang.org/x/sys/unix</a> package as follows:</p>\n\n<pre><code>// Long way, for short one jump\n// down straight to it.\n//\n// retrieve the file descriptor\n// cast it to int, because Fd method\n// returns uintptr\nfd := int(os.Stdin.Fd())\n\n// extract file descriptor flags\n// it's safe to drop the error, since if it's there\n// and it's not nil, you won't be able to read from\n// Stdin anyway, unless it's a notice\n// to try again, which mostly should not be \n// the case\nflags, _ := unix.FcntlInt(fd, unix.F_GETFL, 0)\n\n// check if the nonblocking reading in enabled\nnb := flags &amp; unix.O_NONBLOCK != 0\n\n// if this is the case, just enable it with\n// unix.SetNonblock which is also a\n// -- SHORT WAY HERE --\nerr = unix.SetNonblock(fd, true)\n\n</code></pre>\n\n<p>The difference between the long and a <a href=\"https://godoc.org/golang.org/x/sys/unix#SetNonblock\" rel=\"nofollow noreferrer\">short way</a> is that the long way will definitely tell you, if the problem is in the nonblocking state absence or not.</p>\n\n<p>If this is not the case. Then I have no other ideas personally. </p>\n"}], "owner": {"reputation": 131, "user_id": 1660776, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/776b548bcea4ce6c1e64a81f4f3807bb?s=128&d=identicon&r=PG&f=1", "display_name": "Whispererli", "link": "https://stackoverflow.com/users/1660776/whispererli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 113, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563636968, "creation_date": 1563599859, "last_edit_date": 1563636968, "question_id": 57122019, "link": "https://stackoverflow.com/questions/57122019/blocked-when-read-from-os-stdin-when-pipe-the-output-in-docker", "title": "Blocked when read from os.Stdin when PIPE the output in docker", "body": "<p>I'm trying to pipe the output(logs) of a program to a Go program which aggregates/compress the output and uploads to S3. The command to run the program is \"/program1 | /logShipper\". The logShipper is written in Go and it's simply read from os.Stdin and write to a local file. The local file will be processed by another goroutine and upload to S3 periodically. There are some existing docker log drivers but we are running the container on a fully managed provider and the log processing charge is pretty expensive, so we want to bypass the existing solution and just upload to S3.</p>\n\n<p>The main logic of the logShipper is simply read from the os.Stdin and write to some file. It's work correctly when running on the local machine but when running in docker the goroutine blocked at reader.ReadString('\\n') and never return.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>go func() {\n    reader := bufio.NewReader(os.Stdin)\n    mu.Lock()\n    output = openOrCreateOutputFile(&amp;uploadQueue, workPath)\n    mu.Unlock()\n    for {\n    text, _ := reader.ReadString('\\n')\n    now := time.Now().Format(\"2006-01-02T15:04:05.000000000Z\")\n    mu.Lock()\n    output.file.Write([]byte(fmt.Sprintf(\"%s %s\", now, text)))\n    mu.Unlock()\n     }\n}()\n</code></pre>\n\n<p>I did some research online but not find why it's not working. One possibility I'm thinking is might docker redirect the stdout to somewhere so the PIPE not working the same way as it's running on a Linux box? (As looks like it can't read anything from program1) Any help or suggestion why it not working is welcome. Thanks.</p>\n\n<p>Edit:\nAfter doing more research I realized it's a bad practice to handle the logs in this way. I should more rely on the docker's log driver to handle the log aggregate and shipping. However, I'm still interested to find out why it's not read anything from the PIPE source program.</p>\n"}, {"tags": ["string", "go", "split"], "answers": [{"tags": [], "owner": {"reputation": 66, "user_id": 4208381, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tj9G7.jpg?s=128&g=1", "display_name": "Gustavo Paiva", "link": "https://stackoverflow.com/users/4208381/gustavo-paiva"}, "is_accepted": false, "score": 0, "last_activity_date": 1563596681, "creation_date": 1563596681, "answer_id": 57121799, "question_id": 57121438, "link": "https://stackoverflow.com/questions/57121438/split-string-along-regex-but-keep-matches/57121799#57121799", "title": "Split string along regex, but keep matches", "body": "<p>I don't think this is possible with the current regexp package, but the <code>Split</code> could be easily extended to such behavior. </p>\n\n<p>This should work for your case:</p>\n\n<pre><code>func Split(re *regexp.Regexp, s string, n int) []string {\n    if n == 0 {\n        return nil\n    }\n\n    matches := re.FindAllStringIndex(s, n)\n    strings := make([]string, 0, len(matches))\n\n    beg := 0\n    end := 0\n    for _, match := range matches {\n        if n &gt; 0 &amp;&amp; len(strings) &gt;= n-1 {\n            break\n        }\n\n        end = match[0]\n        if match[1] != 0 {\n            strings = append(strings, s[beg:end])\n        }\n        beg = match[1]\n        // This also appends the current match\n        strings = append(strings, s[match[0]:match[1]])\n    }\n\n    if end != len(s) {\n        strings = append(strings, s[beg:])\n    }\n\n    return strings\n}\n\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 11645900, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-X1Kv8kh5Obs/AAAAAAAAAAI/AAAAAAAAABo/4hwzSKHgtWU/photo.jpg?sz=128", "display_name": "Jian-Hua He", "link": "https://stackoverflow.com/users/11645900/jian-hua-he"}, "is_accepted": false, "score": 0, "last_activity_date": 1563597393, "creation_date": 1563597393, "answer_id": 57121849, "question_id": 57121438, "link": "https://stackoverflow.com/questions/57121438/split-string-along-regex-but-keep-matches/57121849#57121849", "title": "Split string along regex, but keep matches", "body": "<p>Dumb solutions. Add separator in the string and split with separator.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n    \"strings\"\n)\n\nfunc main() {\n    re := regexp.MustCompile(`\\d+`)\n    input := \"ab1cd2ef3\"\n    sep := \"|\"\n\n    indexes := re.FindAllStringIndex(input, -1)\n    fmt.Println(indexes)\n\n    move := 0\n    for _, v := range indexes {\n        p1 := v[0] + move\n        p2 := v[1] + move\n        input = input[:p1] + sep + input[p1:p2] + sep + input[p2:]\n        move += 2\n    }\n\n    result := strings.Split(input, sep)\n\n    fmt.Println(result)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 360, "user_id": 11657235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc87a6abdda3e88df2ae16e278e7864?s=128&d=identicon&r=PG&f=1", "display_name": "Milo Banks", "link": "https://stackoverflow.com/users/11657235/milo-banks"}, "edited": false, "score": 0, "creation_date": 1563665329, "post_id": 57123908, "comment_id": 100775043, "body": "Can I do the same for multiple separators? It seems like I cant. <code>( \\(\\)|[^ \\(\\)]+)</code>"}, {"owner": {"reputation": 726, "user_id": 387670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de92c7f1d6b452b9e2b3f38c11967cb8?s=128&d=identicon&r=PG", "display_name": "sahaj", "link": "https://stackoverflow.com/users/387670/sahaj"}, "reply_to_user": {"reputation": 360, "user_id": 11657235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc87a6abdda3e88df2ae16e278e7864?s=128&d=identicon&r=PG&f=1", "display_name": "Milo Banks", "link": "https://stackoverflow.com/users/11657235/milo-banks"}, "edited": false, "score": 0, "creation_date": 1563700790, "post_id": 57123908, "comment_id": 100779878, "body": "It is just regex to match tokens. So as long as you can represent token separately using regex, you can have multiple of those separated by <code>|</code>. If you can provide some sample string, it will be easier to understand."}], "tags": [], "owner": {"reputation": 726, "user_id": 387670, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de92c7f1d6b452b9e2b3f38c11967cb8?s=128&d=identicon&r=PG", "display_name": "sahaj", "link": "https://stackoverflow.com/users/387670/sahaj"}, "is_accepted": true, "score": 1, "last_activity_date": 1563633380, "last_edit_date": 1563633380, "creation_date": 1563618987, "answer_id": 57123908, "question_id": 57121438, "link": "https://stackoverflow.com/questions/57121438/split-string-along-regex-but-keep-matches/57123908#57123908", "title": "Split string along regex, but keep matches", "body": "<p>The kind of regex support in the link you have pointed out is NOT available in Go regex package. You can read the <a href=\"https://github.com/golang/go/issues/18868\" rel=\"nofollow noreferrer\">related discussion</a>. </p>\n\n<p>What you want to achieve (as per the sample given) can be done using regex to match digits or non-digits.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    str := \"ab1cd2ef3\"\n    r := regexp.MustCompile(`(\\d|[^\\d]+)`)\n    fmt.Println(r.FindAllStringSubmatch(str, -1))\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/L-ElvkDky53\" rel=\"nofollow noreferrer\">https://play.golang.org/p/L-ElvkDky53</a></p>\n\n<p>Output:</p>\n\n<pre><code>[[ab ab] [1 1] [cd cd] [2 2] [ef ef] [3 3]]\n</code></pre>\n"}], "owner": {"reputation": 360, "user_id": 11657235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc87a6abdda3e88df2ae16e278e7864?s=128&d=identicon&r=PG&f=1", "display_name": "Milo Banks", "link": "https://stackoverflow.com/users/11657235/milo-banks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 471, "favorite_count": 1, "accepted_answer_id": 57123908, "answer_count": 3, "score": 3, "last_activity_date": 1563633380, "creation_date": 1563590980, "last_edit_date": 1563622476, "question_id": 57121438, "link": "https://stackoverflow.com/questions/57121438/split-string-along-regex-but-keep-matches", "title": "Split string along regex, but keep matches", "body": "<p>I want to split a string on a regular expresion, but preserve the matches.</p>\n\n<p>I have tried splitting the string on a regex, but it throws away the matches. I have also tried using <a href=\"https://stackoverflow.com/questions/2910536/regex-split-string-but-keep-separators\">this</a>, but I am not very good at translating code from language to language, let alone C#.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>re := regexp.MustCompile(`\\d`)\narray := re.Split(\"ab1cd2ef3\", -1)\n</code></pre>\n\n<p>I need the value of array to be [\"ab\", \"1\", \"cd\", \"2\", \"ef\", \"3\"], but the value of array is [\"ab\", \"cd\", \"ef\"]. No errors.</p>\n"}, {"tags": ["docker", "go", "kubernetes"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 1, "creation_date": 1563585913, "post_id": 57121033, "comment_id": 100760319, "body": "Recreating pods is pretty normal.  Usually making this sort of change you&#39;d change the deployment, and let it create a new pod and destroy the old one."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1563699433, "post_id": 57121033, "comment_id": 100779576, "body": "You are approaching k8s the wrong way, imho. At its very core, it is an orchestrator of runtimes, network layers, storage and last but not least, computing. Let k8s do its job and do not try to fine tune stuff like that. You should rather see <code>requests</code> as k8sese for \u201eHey, this pod absolutely needs this to run\u201c and <code>limits</code> as \u201eif we hit this limit, TSHTF and you should not allow more\u201c. If you need to do Ressource management manually, your cluster is VERY likely too small for your workloads. Remember, when a node fails, the others need to be able to run the loads of the failed one."}], "answers": [{"tags": [], "owner": {"reputation": 66, "user_id": 4208381, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tj9G7.jpg?s=128&g=1", "display_name": "Gustavo Paiva", "link": "https://stackoverflow.com/users/4208381/gustavo-paiva"}, "is_accepted": false, "score": 1, "last_activity_date": 1563586921, "last_edit_date": 1563586921, "creation_date": 1563585596, "answer_id": 57121087, "question_id": 57121033, "link": "https://stackoverflow.com/questions/57121033/how-to-change-k8ss-pods-limts-without-killing-the-original-pod/57121087#57121087", "title": "How to change k8s&#39;s pods limts without killing the original pod?", "body": "<p>I do no think this is possible, there is an old issue tracking such thing on the kubernetes github (<a href=\"https://github.com/kubernetes/kubernetes/issues/9043\" rel=\"nofollow noreferrer\">https://github.com/kubernetes/kubernetes/issues/9043</a>) from 2015 and it is open.</p>\n\n<p>Also, you should not rely on pod not being recreated while using kubernetes. Applications should be able to stateless to a point where if it dies in mid of a process, it could handle this failure and start it from the begin once it is started again.</p>\n\n<p>I understand the idea behind trying to optimize the resource usage to it maximum but you should be also worried about a reliable process.</p>\n\n<p>I think you should check out the Kubernetes' Vertical Pod Autoscaler, as it automates the resources of a pod depending on its usage. Maybe that could be an alternative: <a href=\"https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler\" rel=\"nofollow noreferrer\">https://github.com/kubernetes/autoscaler/tree/master/vertical-pod-autoscaler</a></p>\n"}, {"tags": [], "owner": {"reputation": 717, "user_id": 11704063, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48b62597f27ad0730e59137e495b061c?s=128&d=identicon&r=PG&f=1", "display_name": "Subramanian Manickam", "link": "https://stackoverflow.com/users/11704063/subramanian-manickam"}, "is_accepted": false, "score": 0, "last_activity_date": 1563612196, "last_edit_date": 1563612196, "creation_date": 1563609945, "answer_id": 57122882, "question_id": 57121033, "link": "https://stackoverflow.com/questions/57121033/how-to-change-k8ss-pods-limts-without-killing-the-original-pod/57122882#57122882", "title": "How to change k8s&#39;s pods limts without killing the original pod?", "body": "<p>You have to find the container ID's those running inside the pods and run this below command to increase the resources.</p>\n\n<pre><code>docker update --cpu-shares NewValue -m NewValue DockerContainerID\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2332, "user_id": 169545, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/055c47019b27276a208db0417b700157?s=128&d=identicon&r=PG", "display_name": "Michel Gokan Khan", "link": "https://stackoverflow.com/users/169545/michel-gokan-khan"}, "edited": false, "score": 0, "creation_date": 1567484996, "post_id": 57147898, "comment_id": 101965602, "body": "Is there any way to disable this default &quot;kill and recreate&quot; behaviour of Kubernetes after performing &quot;docker update&quot; command? I know this is not a correct way of working with Kubernetes but I&#39;m asking this for a research project. In this project, killing and recreating pods is a very timely expensive task as we need to do it several times..."}, {"owner": {"reputation": 2031, "user_id": 11602913, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/839532642263a2cdea4da6d557d71d64?s=128&d=identicon&r=PG&f=1", "display_name": "mebius99", "link": "https://stackoverflow.com/users/11602913/mebius99"}, "reply_to_user": {"reputation": 2332, "user_id": 169545, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/055c47019b27276a208db0417b700157?s=128&d=identicon&r=PG", "display_name": "Michel Gokan Khan", "link": "https://stackoverflow.com/users/169545/michel-gokan-khan"}, "edited": false, "score": 0, "creation_date": 1567496641, "post_id": 57147898, "comment_id": 101969557, "body": "No. &quot;If a Container exceeds its memory limit, it might be terminated. If it is restartable, the kubelet will restart it, as with any other type of runtime failure. If a Container exceeds its memory request, it is likely that its Pod will be evicted whenever the node runs out of memory&quot;. &quot;Evicted&quot; means &quot;kill on this host and recreate on another host&quot;. Kubernetes is not aware about other techniques by design. I am quoting from here <a href=\"https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#how-pods-with-resource-limits-are-run\" rel=\"nofollow noreferrer\">How Pods with resource limits are run</a>"}, {"owner": {"reputation": 2332, "user_id": 169545, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/055c47019b27276a208db0417b700157?s=128&d=identicon&r=PG", "display_name": "Michel Gokan Khan", "link": "https://stackoverflow.com/users/169545/michel-gokan-khan"}, "edited": false, "score": 0, "creation_date": 1567531491, "post_id": 57147898, "comment_id": 101987563, "body": "hmmm...maybe for my particular case I can find a way to \u201cdisable\u201d the k8s kubelet, does the docker update, perform my task (its a benchmark), enable kubelet again. I don\u2019t care if it kills it after that...any suggestions on how to do it?"}], "tags": [], "owner": {"reputation": 2031, "user_id": 11602913, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/839532642263a2cdea4da6d557d71d64?s=128&d=identicon&r=PG&f=1", "display_name": "mebius99", "link": "https://stackoverflow.com/users/11602913/mebius99"}, "is_accepted": true, "score": 1, "last_activity_date": 1563818061, "last_edit_date": 1563818061, "creation_date": 1563804623, "answer_id": 57147898, "question_id": 57121033, "link": "https://stackoverflow.com/questions/57121033/how-to-change-k8ss-pods-limts-without-killing-the-original-pod/57147898#57147898", "title": "How to change k8s&#39;s pods limts without killing the original pod?", "body": "<p>The clue is you want to change limits <strong>without killing the pod</strong>. </p>\n\n<p>This is not the way Kubernetes works, as <a href=\"https://stackoverflow.com/users/1296707/markus-w-mahlberg\">Markus W Mahlberg</a> explained in his comment above. In Kubernetes there is no \"hot plug CPU/memory\" or \"live migration\" facilities the convenient hypervisors provide. Kubernetes treats pods as ephemeral instances and does not take care about keeping them running. Whether you need to change resource limits for the application, change the app  configuration, install app updates or repair misbehaving application, the <strong>\"kill-and-recreate\"</strong> approach is applied to pods. </p>\n\n<p>Unfortunately, the solutions suggested here will not work for you: </p>\n\n<ul>\n<li>Increasing limits for the running container within the pod ( <code>docker update</code> command ) will lead to breaching the pod limits and killing the pod by Kubernetes. </li>\n<li>Vertical Pod Autoscaler is part of Kubernetes project and relies on the \"kill-and-recreate\" approach as well.</li>\n</ul>\n\n<p>If you really need to keep the containers running and managing allocated resource limits for them \"on-the-fly\", perhaps Kubernetes is not suitable solution in this particular case. Probably you should consider using pure Docker or a VM-based solution. </p>\n"}], "owner": {"reputation": 23, "user_id": 11810567, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/689c4f793b7e8c4d75d21182ebf0a602?s=128&d=identicon&r=PG&f=1", "display_name": "scofieldmao", "link": "https://stackoverflow.com/users/11810567/scofieldmao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1036, "favorite_count": 0, "accepted_answer_id": 57147898, "answer_count": 3, "score": 1, "last_activity_date": 1563818061, "creation_date": 1563584795, "question_id": 57121033, "link": "https://stackoverflow.com/questions/57121033/how-to-change-k8ss-pods-limts-without-killing-the-original-pod", "title": "How to change k8s&#39;s pods limts without killing the original pod?", "body": "<p>Requst:limits of a pod may be set to low at the beginning, to make full use of node's resource, we need to set the limits higher. However, when the resource of node is not enough, to make the node's still work well, we need to set the limits lower. It is better not to kill the pod, because it may influence the cluster. </p>\n\n<p>Background:I am currently a beginner in k8s and docker, my mentor give me this requests. Can this requests fullfill normaly? Or is it better way to solve this kind of problem? Thanks for your helps!\nAll I tried:I am trying to do by editing the Cgroups, but I can only do this in a container, so may be container should be use in privileged mode.</p>\n\n<p>I expect a resonable plan for this requests.\nThanks...</p>\n"}, {"tags": ["c", "go", "gcc", "dll", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "is_accepted": true, "score": 0, "last_activity_date": 1563746401, "creation_date": 1563746401, "answer_id": 57137279, "question_id": 57120689, "link": "https://stackoverflow.com/questions/57120689/what-is-correct-go-build-mode-for-windows-dll-file/57137279#57137279", "title": "What is correct go build mode for Windows DLL file?", "body": "<p>I ended up just getting rid of this extra c file and calling the methods I needed from Go like <a href=\"https://github.com/golang/go/wiki/WindowsDLLs\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/WindowsDLLs</a> explains. Works great. </p>\n"}], "owner": {"reputation": 4263, "user_id": 148736, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/98ce675339d7e7c8269349943d6a0823?s=128&d=identicon&r=PG", "display_name": "Andrew Arrow", "link": "https://stackoverflow.com/users/148736/andrew-arrow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 0, "accepted_answer_id": 57137279, "answer_count": 1, "score": 0, "last_activity_date": 1563746401, "creation_date": 1563580233, "question_id": 57120689, "link": "https://stackoverflow.com/questions/57120689/what-is-correct-go-build-mode-for-windows-dll-file", "title": "What is correct go build mode for Windows DLL file?", "body": "<p>These two steps:</p>\n\n<pre><code>gcc -c main.c\ngcc -o a.exe main.o MyThing.dll\n</code></pre>\n\n<p>Work great to make windows exe that can call methods inside MyThing.dll. Note gcc main.c without the -c would give error like:</p>\n\n<p><code>undefined reference to MyThing_method</code></p>\n\n<p>But when trying to get this same system working in a Golang program using cgo I get same undefined reference errors like I did with gcc without the -c. I've read:</p>\n\n<p><a href=\"https://github.com/golang/go/wiki/WindowsDLLs\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/WindowsDLLs</a></p>\n\n<p>And would love to try and use <code>syscall.NewLazyDLL</code> but my issue is my foo.go file is calling C.SomeMethod() and inside that method it makes calls to the methods inside the DLL. So it seems I need a way to </p>\n\n<p><code>go build -buildmode=c-share -o MyThing.dll</code></p>\n\n<p>But I can't seem to get the right sequence. Am I right that if I can do this in the simple C program, there must be a way to do this from Golang?</p>\n"}, {"tags": ["memory-leaks", "go"], "comments": [{"owner": {"reputation": 146, "user_id": 4420958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/212cadd0a6448c307c19ac240248efd7?s=128&d=identicon&r=PG", "display_name": "Denis Volin", "link": "https://stackoverflow.com/users/4420958/denis-volin"}, "edited": false, "score": 0, "creation_date": 1563662797, "post_id": 57128430, "comment_id": 100774694, "body": "I beg you pardon, but why do you need some way when you just can read your code.  Basically all var, new, {}, &amp;{} and const allocate memory this way or another. The compiler decides which case should be heap allocated and which is stack one."}, {"owner": {"reputation": 3, "user_id": 4180315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c60539f6fa15599c98b74f6321358a8?s=128&d=identicon&r=PG&f=1", "display_name": "alok aggarwal", "link": "https://stackoverflow.com/users/4180315/alok-aggarwal"}, "reply_to_user": {"reputation": 146, "user_id": 4420958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/212cadd0a6448c307c19ac240248efd7?s=128&d=identicon&r=PG", "display_name": "Denis Volin", "link": "https://stackoverflow.com/users/4420958/denis-volin"}, "edited": false, "score": 0, "creation_date": 1563817720, "post_id": 57128430, "comment_id": 100817657, "body": "@Denis, the codebase is very large. Not sure its practical to read all the code to find out the leaks."}, {"owner": {"reputation": 146, "user_id": 4420958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/212cadd0a6448c307c19ac240248efd7?s=128&d=identicon&r=PG", "display_name": "Denis Volin", "link": "https://stackoverflow.com/users/4420958/denis-volin"}, "edited": false, "score": 0, "creation_date": 1563862253, "post_id": 57128430, "comment_id": 100829932, "body": "Yeah, @alokaggarwal, sorry you&#39;ve got the point.  And GoMetaLinter much helps by the way =)"}], "answers": [{"tags": [], "owner": {"reputation": 146, "user_id": 4420958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/212cadd0a6448c307c19ac240248efd7?s=128&d=identicon&r=PG", "display_name": "Denis Volin", "link": "https://stackoverflow.com/users/4420958/denis-volin"}, "is_accepted": true, "score": 0, "last_activity_date": 1563663047, "creation_date": 1563663047, "answer_id": 57129168, "question_id": 57128430, "link": "https://stackoverflow.com/questions/57128430/memory-tracking-in-a-go-program/57129168#57129168", "title": "Memory tracking in a go program", "body": "<p>May be you'll find some help here: <a href=\"https://golang.org/pkg/runtime/pprof/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/runtime/pprof/</a></p>\n"}], "migrated_from": {"other_site": {"markdown_extensions": ["Prettify"], "launch_date": 1250553600, "open_beta_date": 1247529600, "site_state": "normal", "high_resolution_icon_url": "https://cdn.sstatic.net/Sites/superuser/Img/apple-touch-icon@2.png", "twitter_account": "super_user", "favicon_url": "https://cdn.sstatic.net/Sites/superuser/Img/favicon.ico", "icon_url": "https://cdn.sstatic.net/Sites/superuser/Img/apple-touch-icon.png", "audience": "computer enthusiasts and power users", "site_url": "https://superuser.com", "api_site_parameter": "superuser", "logo_url": "https://cdn.sstatic.net/Sites/superuser/Img/logo.png", "name": "Super User", "site_type": "main_site"}, "on_date": 1563655244, "question_id": 1461954}, "owner": {"reputation": 3, "user_id": 4180315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c60539f6fa15599c98b74f6321358a8?s=128&d=identicon&r=PG&f=1", "display_name": "alok aggarwal", "link": "https://stackoverflow.com/users/4180315/alok-aggarwal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "accepted_answer_id": 57129168, "answer_count": 1, "score": 0, "last_activity_date": 1563663047, "creation_date": 1563574365, "question_id": 57128430, "link": "https://stackoverflow.com/questions/57128430/memory-tracking-in-a-go-program", "title": "Memory tracking in a go program", "body": "<p>The memory consumption in my go program is steadily growing over time.\nIs there a way I can find out which code lines are allocating the memory?My go binary is running in an Ubuntu virtual machine.</p>\n"}, {"tags": ["javascript", "google-chrome", "go", "google-chrome-extension", "proxy"], "comments": [{"owner": {"reputation": 3, "user_id": 6878602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b6739761de47bfd12390be949e30378?s=128&d=identicon&r=PG&f=1", "display_name": "Egor Miloserdov", "link": "https://stackoverflow.com/users/6878602/egor-miloserdov"}, "reply_to_user": {"reputation": 42531, "user_id": 3959875, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wJdGu.png?s=128&g=1", "display_name": "wOxxOm", "link": "https://stackoverflow.com/users/3959875/woxxom"}, "edited": false, "score": 0, "creation_date": 1563634231, "post_id": 57120031, "comment_id": 100768561, "body": "@wOxxOm There is no &quot;code&quot; using this proxy. It just setting Chrome property proxy in <code>chrome.proxy.settings.set</code> and then Chrome processing it."}, {"owner": {"reputation": 42531, "user_id": 3959875, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wJdGu.png?s=128&g=1", "display_name": "wOxxOm", "link": "https://stackoverflow.com/users/3959875/woxxom"}, "edited": false, "score": 0, "creation_date": 1563634542, "post_id": 57120031, "comment_id": 100768620, "body": "The <a href=\"https://developer.chrome.com/extensions/proxy#type-ProxyServer\" rel=\"nofollow noreferrer\">default <code>scheme</code> for singleProxy mode is <code>http</code></a> so I guess you should specify <code>https</code> there."}, {"owner": {"reputation": 3, "user_id": 6878602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b6739761de47bfd12390be949e30378?s=128&d=identicon&r=PG&f=1", "display_name": "Egor Miloserdov", "link": "https://stackoverflow.com/users/6878602/egor-miloserdov"}, "reply_to_user": {"reputation": 42531, "user_id": 3959875, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wJdGu.png?s=128&g=1", "display_name": "wOxxOm", "link": "https://stackoverflow.com/users/3959875/woxxom"}, "edited": false, "score": 0, "creation_date": 1563635220, "post_id": 57120031, "comment_id": 100768779, "body": "Thanks for idea, I also noticed that url to stackoverflow with <code>http</code> as well."}, {"owner": {"reputation": 3, "user_id": 6878602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b6739761de47bfd12390be949e30378?s=128&d=identicon&r=PG&f=1", "display_name": "Egor Miloserdov", "link": "https://stackoverflow.com/users/6878602/egor-miloserdov"}, "reply_to_user": {"reputation": 42531, "user_id": 3959875, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wJdGu.png?s=128&g=1", "display_name": "wOxxOm", "link": "https://stackoverflow.com/users/3959875/woxxom"}, "edited": false, "score": 0, "creation_date": 1563639891, "post_id": 57120031, "comment_id": 100769867, "body": "@wOxxOm Still not working. I added in <code>Go</code> <code>User-Agent</code> header, in <code>JavaScript</code> add <code>scheme : https</code> field to config object for proxy."}], "owner": {"reputation": 3, "user_id": 6878602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b6739761de47bfd12390be949e30378?s=128&d=identicon&r=PG&f=1", "display_name": "Egor Miloserdov", "link": "https://stackoverflow.com/users/6878602/egor-miloserdov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 827, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1563639730, "creation_date": 1563573763, "last_edit_date": 1563639730, "question_id": 57120031, "link": "https://stackoverflow.com/questions/57120031/setting-up-proxy-in-chrome-by-my-extension", "title": "Setting up proxy in Chrome by my extension", "body": "<p>I'm trying to make Chrome extension which turns on-off proxy in browser. I wrote some code in javascript using documentation about chrome extensions, and what is interesting, some times extension works right. </p>\n\n<p>Here is some code in Golang, which iterates through list of https proxy addresses, makes http requests to www.stackoverflow using this proxy addresses and if response status code is 2xx (because some of addresses are invalid, deprecated, unavailable, banned and etc), it marks proxy address correct and prints it. </p>\n\n<p>The second block of the code sets <code>chrome.proxy.settings</code> property with found 'good' proxy address. By now I'm just copy-pasting it by hands.</p>\n\n<p><strong>The question is:</strong> Why is Golang sorts out \"bad\" proxy address, gives me list of \"good\" proxies, but Chrome, when I trying to set any of this \"good\" proxies gives me <code>ERR_PROXY_CONNECTION_FAILED</code>?</p>\n\n<p><strong>EDIT</strong>: in <code>Go</code> add <code>User-Agent</code> header, in <code>JavaScript</code> add <code>scheme : https</code> field to <code>config</code> object for proxy. \nStill not working.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// checkProxy returns true if proxy adress a is valid and\n// response by http request with this proxy is ok (2xx)\n//185.132.179.108:1080\n//185.132.179.107:1080\nfunc checkProxy(a string) (string, bool) {\n    proxyUrl, err := url.Parse(\"http://\" + a)\n    httpClient := &amp;http.Client{     \n        Transport: &amp;http.Transport{\n            Proxy: http.ProxyURL(proxyUrl),\n        },\n    }\n    req, err := http.NewRequest(\"GET\", \"http://stackoverflow.com\", nil)\n    if err != nil {\n        return \"\", false\n    }\n    req.Header.Add(\"User-Agent\", \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.169 Safari/537.36\")\n    response, err := httpClient.Do(req)\n    if err != nil {\n        return \"\", false\n    }   \n    if response.StatusCode &lt;= 200 &amp;&amp; response.StatusCode &gt;= 299 {\n        return \"\", false\n    } else {\n        return a, true\n    }\n}\n</code></pre>\n\n<pre><code>\nfunction setProxySettings(iip, pport) {\n    var config = {\n        mode: \"fixed_servers\",\n        rules: {\n            //https://www.proxy-list.download/HTTPS\n            // host: \"107.191.63.8\",\n            // port: 32482\n            singleProxy: {\n                scheme: \"https\",\n                host: iip,\n                port: parseInt(pport)\n            },\n        }\n    };\n    chrome.proxy.settings.set({\n            value: config,\n            scope: 'regular'\n        },\n        function () {});\n}\n</code></pre>\n"}, {"tags": ["go", "go-sqlite3"], "answers": [{"tags": [], "owner": {"reputation": 10233, "user_id": 15947, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/83941efbdc5db60168254d29859053eb?s=128&d=identicon&r=PG", "display_name": "Steve Hanov", "link": "https://stackoverflow.com/users/15947/steve-hanov"}, "is_accepted": true, "score": 0, "last_activity_date": 1563972645, "last_edit_date": 1563972645, "creation_date": 1563564921, "answer_id": 57118728, "question_id": 57118674, "link": "https://stackoverflow.com/questions/57118674/go-sqlite3-with-journal-mode-wal-gives-database-is-locked-error/57118728#57118728", "title": "go-sqlite3 with journal_mode=WAL gives &#39;database is locked&#39; error", "body": "<p>If you want to enable journal_mode=WAL, you should add it to the connection string:</p>\n\n<pre><code>\"file:mydbfile.db?cache=shared&amp;mode=rwc&amp;_journal_mode=WAL\"\n</code></pre>\n\n<p>As part of opening the database, go-sqlite3 will execute PRAGMA statements to set various defaults. One of these defaults is setting the journal_mode=DELETE. However, if another process has the database opened, the mode cannot be changed back to DELETE. Executing this statement fails with \"database is locked\" and so you will see the open operation fail with that error.</p>\n\n<p>The complete list of connection string parameters is listed at <a href=\"https://github.com/mattn/go-sqlite3\" rel=\"nofollow noreferrer\">https://github.com/mattn/go-sqlite3</a></p>\n"}], "owner": {"reputation": 10233, "user_id": 15947, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/83941efbdc5db60168254d29859053eb?s=128&d=identicon&r=PG", "display_name": "Steve Hanov", "link": "https://stackoverflow.com/users/15947/steve-hanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 899, "favorite_count": 1, "accepted_answer_id": 57118728, "answer_count": 1, "score": 0, "last_activity_date": 1563972645, "creation_date": 1563564712, "last_edit_date": 1563972547, "question_id": 57118674, "link": "https://stackoverflow.com/questions/57118674/go-sqlite3-with-journal-mode-wal-gives-database-is-locked-error", "title": "go-sqlite3 with journal_mode=WAL gives &#39;database is locked&#39; error", "body": "<p>In go, I open a sqlite3 database using the mattn/go-sqlite3 module. I set the database journalling mode to WAL immediately after opening using a PRAGMA journal_mode=WAL.</p>\n\n<p>However, if I try to open the database from a second process while the first is running, the second cannot open it and instead gets the \"database is locked\" error. This happens even if I did not perform any transactions.</p>\n\n<p>The connection string I am using is:</p>\n\n<pre><code>\"file:mydbfile.db?cache=shared&amp;mode=rwc\"\n</code></pre>\n\n<p>(I intend to answer my own question, since it took a long time to debug)</p>\n"}]