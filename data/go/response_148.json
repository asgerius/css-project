[{"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1510182124, "post_id": 47191154, "comment_id": 81331793, "body": "<i>everything</i> is by value, so the interface gets copied, not the value you put in it. Regardless, <code>panic</code> itself isn&#39;t cheap, and you probably should&#39;t be using it if performance is a real concern. Are you cure there&#39;s not a better way to do what you want?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1510183391, "post_id": 47191154, "comment_id": 81332244, "body": "Just handle every <code>error</code> as it comes (or return it to the caller) and you never have the need to <code>panic</code>."}, {"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1510188122, "post_id": 47191154, "comment_id": 81333528, "body": "This is a bit tongue in cheek, but does performance really matter when you are aborting your program?"}, {"owner": {"reputation": 3436, "user_id": 307614, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/671aed37f0d4a6668053a70a75f5c715?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/307614/dave"}, "edited": false, "score": 1, "creation_date": 1510200278, "post_id": 47191154, "comment_id": 81336481, "body": "Fair comments all; this was more for my curiosity than for any real world application. One application that does come to mind is an http.Handler, which recovers from any panic <i>per request</i>, and might have some performance impact there."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1510201811, "post_id": 47191154, "comment_id": 81336865, "body": "Just as long as you aren&#39;t trying to use <code>panic</code> as a pseudo <code>try</code> <code>catch</code>. Might throw a fit haha. It has some select use-cases as such, but should by no means become a try/catch replacement."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1510229346, "post_id": 47191154, "comment_id": 81351259, "body": "Why do you care about the performance of <code>panic</code>? Trying to prove that Go can even crash faster than nodejs?"}, {"owner": {"reputation": 3436, "user_id": 307614, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/671aed37f0d4a6668053a70a75f5c715?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/307614/dave"}, "edited": false, "score": 0, "creation_date": 1510242168, "post_id": 47191154, "comment_id": 81360644, "body": "Wow, my question seems to have upset some folks. Enough for at least 3 people to downvote it that it &quot;doesn&#39;t show any research effort, is unclear or not useful&quot;. So much for my curiosity. I&#39;ve edited to try clarify my reasons for asking."}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1510201676, "post_id": 47191896, "comment_id": 81336835, "body": "I wonder why <code>BenchmarkPanicVal1K</code> doesn&#39;t alloc. Is there a bug in the code? Doesn&#39;t appear so, but it should also have 1024 B/op, no?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1510202101, "post_id": 47191896, "comment_id": 81336945, "body": "@RayfenWindspear: <code>B&#47;op</code> and <code>allocs&#47;op</code> are for heap allocations. By design, I benchmarked 1K and 4K allocations to illustrate stack versus heap allocation."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1510202231, "post_id": 47191896, "comment_id": 81336986, "body": "Is there some significance with 1024 bytes then that makes it allocate on the stack? I feel like I&#39;m missing something."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1510202321, "post_id": 47191896, "comment_id": 81337015, "body": "@RayfenWindspear: Go gc is an optimizing compiler."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1510202368, "post_id": 47191896, "comment_id": 81337031, "body": "OK, I figured it was some sort of optimization wizardry. Thanks"}, {"owner": {"reputation": 3436, "user_id": 307614, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/671aed37f0d4a6668053a70a75f5c715?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/307614/dave"}, "edited": false, "score": 0, "creation_date": 1510243026, "post_id": 47191896, "comment_id": 81361294, "body": "So, you declare your own <code>panic</code> function at the start of this code, and I guess part of my original question was: is there some special behaviour that a regular panic has, or does it just get its parameters by value like everything else.  But this code was easy enough to adapt to add a &quot;testPanic&quot; function which does a panic + deferred recover, and benchmark that. And I get the same kind of results. So, thanks for this."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1510187630, "last_edit_date": 1510187630, "creation_date": 1510186480, "answer_id": 47191896, "question_id": 47191154, "link": "https://stackoverflow.com/questions/47191154/implications-of-panic-with-struct-vs-pointer/47191896#47191896", "title": "Implications of panic() with struct vs pointer?", "body": "<p>It depends on how many times <code>panic</code>s are executed, on value or pointer argument, on the size of the <code>struct</code>, and so on. In Go, arguments are passed by value. Interface values are represented as a two-word pair giving a pointer to information about the type stored in the interface and a pointer to a copy of the associated data. </p>\n\n<p>Use the Go testing package benchmark facilities. For example,</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nvar sink int\n\nfunc panic(interface{}) {}\n\nfunc BenchmarkPanicVal1K(b *testing.B) {\n    var large struct{ big [1024]byte }\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        panic(large)\n    }\n}\n\nfunc BenchmarkPanicPtr1K(b *testing.B) {\n    var large struct{ big [1024]byte }\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        panic(&amp;large)\n    }\n}\n\nfunc BenchmarkPanicVal4K(b *testing.B) {\n    var large struct{ big [4096]byte }\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        panic(large)\n    }\n}\n\nfunc BenchmarkPanicPtr4K(b *testing.B) {\n    var large struct{ big [4096]byte }\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        panic(&amp;large)\n    }\n}\n\nfunc BenchmarkIfaceVal1K(b *testing.B) {\n    var iface interface{}\n    var large struct{ big [1024]byte }\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        iface = large\n    }\n    _ = iface\n}\n\nfunc BenchmarkIfacePtr1K(b *testing.B) {\n    var iface interface{}\n    var large struct{ big [1024]byte }\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        iface = &amp;large\n    }\n    _ = iface\n}\nfunc BenchmarkIfaceVal4K(b *testing.B) {\n    var iface interface{}\n    var large struct{ big [4096]byte }\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        iface = large\n    }\n    _ = iface\n}\n\nfunc BenchmarkIfacePtr4K(b *testing.B) {\n    var iface interface{}\n    var large struct{ big [4096]byte }\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        iface = &amp;large\n    }\n    _ = iface\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ gotest panic_test.go -bench=.\n\nBenchmarkPanicVal1K-4      20000000      70.3 ns/op        0 B/op    0 allocs/op\nBenchmarkPanicPtr1K-4    2000000000       0.36 ns/op       0 B/op    0 allocs/op\nBenchmarkPanicVal4K-4       1000000    1483 ns/op       4096 B/op    1 allocs/op\nBenchmarkPanicPtr4K-4    2000000000       0.36 ns/op       0 B/op    0 allocs/op\n\n\nBenchmarkIfaceVal1K-4       5000000     378 ns/op       1024 B/op    1 allocs/op\nBenchmarkIfacePtr1K-4    2000000000       0.36 ns/op       0 B/op    0 allocs/op\nBenchmarkIfaceVal4K-4       1000000    1469 ns/op       4096 B/op    1 allocs/op\nBenchmarkIfacePtr4K-4    2000000000       0.36 ns/op       0 B/op    0 allocs/op\n</code></pre>\n\n<p>References:</p>\n\n<p><a href=\"https://research.swtch.com/interfaces\" rel=\"nofollow noreferrer\">Go Data Structures: Interfaces</a> </p>\n"}], "owner": {"reputation": 3436, "user_id": 307614, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/671aed37f0d4a6668053a70a75f5c715?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/307614/dave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 1, "accepted_answer_id": 47191896, "answer_count": 1, "score": -3, "last_activity_date": 1510242371, "creation_date": 1510181912, "last_edit_date": 1510242371, "question_id": 47191154, "link": "https://stackoverflow.com/questions/47191154/implications-of-panic-with-struct-vs-pointer", "title": "Implications of panic() with struct vs pointer?", "body": "<p>What are the implications, if any, of calling <code>panic(x)</code> with a large struct, versus calling <code>panic(&amp;x)</code> with a pointer to that struct instead?</p>\n\n<p>Does the <code>interface{}</code> that you pass to panic get copied over each time the stack unwinds a level, or is there some other magic going on?</p>\n\n<p>EDIT: An example of where this could be important is inside <code>http.Serve</code>, where it will recover from any panic and serve a suitable message. If I panic with a really large struct, this could have some performance impact as the stack frames unwind and cause undue load to my webserver.</p>\n"}, {"tags": ["go", "network-programming"], "comments": [{"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 2, "creation_date": 1510184941, "post_id": 47190864, "comment_id": 81332670, "body": "This is TCP? With TCP, from a user-space application perspective, <b>there are no packets</b>. The network stack can and will deliver TCP data to your application in <b>any</b> number of bytes, regardless of how you <b>think</b> the packets are arranged."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 2, "creation_date": 1510185656, "post_id": 47190864, "comment_id": 81332855, "body": "Also, if you do a lot of network programming you should get used to using Wireshark or Ethereal or other network analyzers. For example in this case I bet you&#39;re hitting your 10 ms timeout because of TCP slow start, MSS discovery, etc. Like here: <a href=\"https://en.wikipedia.org/wiki/Path_MTU_Discovery\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Path_MTU_Discovery</a>"}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 7355692, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a5189c70c8f4bad4239eaea01d878e25?s=128&d=identicon&r=PG&f=1", "display_name": "AnirbanMukherjee", "link": "https://stackoverflow.com/users/7355692/anirbanmukherjee"}, "edited": false, "score": 0, "creation_date": 1510216080, "post_id": 47192479, "comment_id": 81342830, "body": "Hi, thanks for the answer. I am trying to make a non-blocking i/o server. So I need to timeout the read as soon as possible. @zan lynx mentioned aptly that the reason for 10msec timeout could be tcp slow start. Mss discovery may be not because the packet I am checking is part of an existing tcp session. So mss discovery should not happen again for this packet. Do you have an alternate suggestion so that I could still have a non blocking read () ?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510239143, "post_id": 47192479, "comment_id": 81358352, "body": "There is no inherently non-blocking IO in Go, but you can do asynchronous IO in order to not block other parts of the program. See <a href=\"https://stackoverflow.com/a/36117724/7426\">this answer</a> for a good explanation."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 81, "user_id": 7355692, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a5189c70c8f4bad4239eaea01d878e25?s=128&d=identicon&r=PG&f=1", "display_name": "AnirbanMukherjee", "link": "https://stackoverflow.com/users/7355692/anirbanmukherjee"}, "edited": false, "score": 0, "creation_date": 1510239574, "post_id": 47192479, "comment_id": 81358677, "body": "@AnirbanMukherjee  Use goroutines to create servers that do not block on i/o of a single connection.  This answers your question as stated. Perhaps ask a different question about the design of your server."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1510191550, "last_edit_date": 1510191550, "creation_date": 1510191204, "answer_id": 47192479, "question_id": 47190864, "link": "https://stackoverflow.com/questions/47190864/bufio-readbytes-buffer-size/47192479#47192479", "title": "bufio readbytes buffer size", "body": "<p>The amount of data read by the <code>ReadBytes</code> method is not limited by the size of the bufio.Reader's read buffer. </p>\n\n<p>The problem is not with buffering, but with i/o timeouts. The <code>ReadBytes</code> function reads until the delimiter is found or read on the underlying io.Reader returns an error. In the example given in the question, <code>ReadBytes</code> returned twice with i/o timeout errors before reading the entire message:</p>\n\n<pre><code>ReadBytes \n  read 1440 bytes\n  timeout on read to underlying io.Reader, return error\nReadBytes\n  read 4096 bytes\n  timeout on read to underlying i.Reader, return error\nReadBytes\n  read 2732 bytes to EOT\n  return success\n</code></pre>\n\n<p>Fix the problem by increasing or eliminating the read deadline. For example:</p>\n\n<pre><code>conn.SetReadDeadline(time.Now().Add(time.Second))\n</code></pre>\n\n<p>Here's a simpler version of the server application that works as expected. The read deadline is removed in this example. </p>\n\n<pre><code>func main() {\n    ln, err := net.Listen(\"tcp\", \":8080\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    conn, err := ln.Accept()\n    if err != nil {\n        log.Fatal(err)\n    }\n    reader := bufio.NewReader(conn)\n    for {\n        buf, err := reader.ReadBytes('\\x04')\n        if err != nil {\n            log.Fatal(err)\n        }\n        log.Printf(\"Received %d bytes\\n\", len(buf))\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 7355692, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a5189c70c8f4bad4239eaea01d878e25?s=128&d=identicon&r=PG&f=1", "display_name": "AnirbanMukherjee", "link": "https://stackoverflow.com/users/7355692/anirbanmukherjee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3351, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1510191550, "creation_date": 1510180470, "last_edit_date": 1510181592, "question_id": 47190864, "link": "https://stackoverflow.com/questions/47190864/bufio-readbytes-buffer-size", "title": "bufio readbytes buffer size", "body": "<p>I am trying to understand the behavior of bufio ReadBytes when it receives large packets. I am running a simple Golang TCP server on eth0 of a unix machine with MTU=9001. The client is a separate machine (not directly connected to the server) is running a python client program on eth0 with MTU=1500. My client python program is trying to send some large sized packets, which gets fragmented in the client machine as expected, and is sent out in IP packets with max TCP MSS=1440. Uptil this, all is good. The packets arrive on the server machine, and I would expect the server machine to reassemble the packet at OSI Layer4. So, to my understanding, my Golang socket buffer should get 1 large size packet (already reassembled). My Golang server program using bufio.ReadBytes('\\x04') to read till EOT character in the message. My client program explicitly adds an EOT character to the end of each packet's payload.</p>\n\n<p>In the server, I see packets being received with inconsistent sizes. Per the official documentation of ReadBytes(), it should read all data in the input buffer until the 'delim' character is read in. I am not able to understand the max. buffer capacity in the bufio package used for reader objects, and would appreciate any help from anyone.</p>\n\n<p>My client program snippet:</p>\n\n<pre><code>while True:\n    l = random.randint(1400, 10000)\n    data=(\"t\"*l + '\\x04').encode()\n    try:\n        if sock.send(data)==0:\n            print(\"Server closed connection\")\n        else:\n            print(\"Data send done. Intended length=\", l, \" bytes\")\n    except:\n       print (\"Exception when sending data. Trace=\" + traceback.format_exc())\n    time.sleep(10)\n    sock.close()\n</code></pre>\n\n<p>Server program snippet:</p>\n\n<pre><code>reader := bufio.NewReader(conn)\nreadbuf := make([]byte, 1500)\nerr := io.EOF\nfor sockConnected {\n    conn.SetReadDeadline(time.Now().Add(10 * time.Millisecond))\n    readbuf, err = reader.ReadBytes('\\x04')\n    switch {\n    case err == io.EOF || err == io.ErrUnexpectedEOF:\n        log.Println(\"Socket closed. EOF / ErrUnexpectedEOF read in\")\n        sockConnected = false\n    case err == nil:\n        //log.Println(\"No error on read\")\n    case strings.HasSuffix(err.Error(), \"i/o timeout\"):\n        //log.Println(\"Timed out read\")\n    default:\n        log.Println(\"Some other error occurred.Reason=\" + err.Error())\n    }\n    if len(readbuf) == 0 {\n        continue\n    } else {\n        //log.Printf(\"Received from client=%v\", string(readbuf))\n        log.Printf(\"Recvd Bytes count=%v\", len(readbuf))\n    }\n}\n</code></pre>\n\n<p>One sample packet sent from the client to the server:</p>\n\n<ol>\n<li><p>from the client :</p>\n\n<blockquote>\n  <p>Data send done. Intended length= 8267  bytes</p>\n</blockquote>\n\n<p>=> 8268 bytes including trailing EOT char.</p></li>\n<li><p>on the server :</p>\n\n<blockquote>\n  <p>2017/11/08 21:55:42.551604 Recvd Bytes count=1440</p>\n  \n  <p>2017/11/08 21:55:42.561897 Recvd Bytes count=4096</p>\n  \n  <p>2017/11/08 21:55:42.569405 Recvd Bytes count=2732</p>\n</blockquote>\n\n<p>=> 3 different ReadBytes() got triggered to consume 8268 bytes.</p>\n\n<p>=> the first and second calls returned different sizes of data. I was hoping them to be the same, if there was 1 single constant buffer being used as the input buffer for bufio.</p></li>\n</ol>\n\n<p>Any help here please ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2981, "user_id": 6206947, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ef3bb38797a3bd7c6e2b92797e9b80dc?s=128&d=identicon&r=PG", "display_name": "nicovank", "link": "https://stackoverflow.com/users/6206947/nicovank"}, "edited": false, "score": 1, "creation_date": 1510177548, "post_id": 47189825, "comment_id": 81329805, "body": "I never used <code>robotgo</code>, but isn&#39;t <code>mdata</code> the current active window, that you are setting again as the active window?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1510177685, "post_id": 47189825, "comment_id": 81329873, "body": "Yeah, I would expect that <code>mdata := robotgo.GetActive(); robotgo.SetActive(mdata)</code> would do nothing."}], "owner": {"reputation": 3782, "user_id": 839211, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/THWvr.jpg?s=128&g=1", "display_name": "Felipe", "link": "https://stackoverflow.com/users/839211/felipe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 718, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1510175712, "creation_date": 1510175712, "question_id": 47189825, "link": "https://stackoverflow.com/questions/47189825/golang-how-to-set-window-on-top", "title": "Golang how to set window on top", "body": "<p>I am developing an app that opens a portable browser to a specific page. The thing is that every once in a while I would like to switch the focus to the browser window, so that it will appear on top of the screen if it is minimized or if there is a window on top of it.</p>\n\n<p>I've tried to do this using <a href=\"https://github.com/go-vgo/robotgo\" rel=\"nofollow noreferrer\">robotgo</a>, by setting the active PID to my browser's PID and setting it as active, but that didn't work:</p>\n\n<pre><code>robotgo.ActivePID(26360)\nhandle := robotgo.GetHandle()\nfmt.Println(\"handle: %s\", handle)\n\nmdata := robotgo.GetActive()\n\nrobotgo.SetActive(mdata)\n</code></pre>\n\n<p>Is there a way to do this?</p>\n\n<p>Note: since I am opening this browser process myself using <code>exec.Command</code>, I have its PID, so I don't have to search for it.</p>\n\n<p>Note 2: I am running this program on Windows.</p>\n"}, {"tags": ["go", "go-reflect"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510177892, "post_id": 47189707, "comment_id": 81329973, "body": "By way of explanation: as the error indicates, <code>Elem()</code> gives you a <code>reflect.Value</code>, which is a <code>reflect</code> <i>representation</i> of the value, <i>not</i> the value itself. You can call <code>Interface()</code> on a <code>reflect.Value</code> to get the value itself (typed as <code>interface{}</code>), which you can then cast to the underlying type as shown in the answer."}, {"owner": {"reputation": 1484, "user_id": 652890, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/a8b98e420be5deb62abf74b84682e729?s=128&d=identicon&r=PG", "display_name": "allthenutsandbolts", "link": "https://stackoverflow.com/users/652890/allthenutsandbolts"}, "edited": false, "score": 0, "creation_date": 1510197507, "post_id": 47189707, "comment_id": 81335782, "body": "This works fine. When I try to cast it, the cast fails, the reason being, there is a type which cannot be exported so I have to figure out how I can handle that.  Thanks for your help"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1510178407, "last_edit_date": 1510178407, "creation_date": 1510175229, "answer_id": 47189707, "question_id": 47189580, "link": "https://stackoverflow.com/questions/47189580/converting-value-to-a-struct/47189707#47189707", "title": "Converting Value to a Struct", "body": "<p>Assert the type on the result of calling the <a href=\"https://godoc.org/reflect#Value.Interface\" rel=\"nofollow noreferrer\">reflect.Value Interface() method</a>.  The Interface() method returns the actual value.</p>\n\n<pre><code>p := valueField.Elem().Interface().(path.Path)\n</code></pre>\n\n<p>The path field must be exported to access the value:</p>\n\n<pre><code>type pathObject struct {\n    s      *gizmo.Session\n    finals bool\n    Path   *path.Path\n}\n</code></pre>\n\n<p>Try this simpler code:</p>\n\n<pre><code>func getPath(v interface{}) *path.Path {\n    r := reflect.Indirect(reflect.ValueOf(v))\n    f := r.FieldByName(\"Path\")\n    return f.Interface().(*path.Path)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/li86OSc0KI\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 1484, "user_id": 652890, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/a8b98e420be5deb62abf74b84682e729?s=128&d=identicon&r=PG", "display_name": "allthenutsandbolts", "link": "https://stackoverflow.com/users/652890/allthenutsandbolts"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 469, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1510178505, "creation_date": 1510174681, "last_edit_date": 1510178505, "question_id": 47189580, "link": "https://stackoverflow.com/questions/47189580/converting-value-to-a-struct", "title": "Converting Value to a Struct", "body": "<p>I have a Struct which is as follows</p>\n\n<pre><code>type pathObject struct {\n    s      *gizmo.Session\n    finals bool\n    path   *path.Path\n}\n</code></pre>\n\n<p>I'm getting this struct and I need to extract the path object but I keep getting an compilation error</p>\n\n<p>Here is my code for conversion</p>\n\n<pre><code>r := reflect.ValueOf(v)\n\nfor i := 0; i &lt; val.NumField(); i++ {\n    valueField := val.Field(i)\n    typeField := val.Type().Field(i)\n    val.Interface()\n\n    if typeField.Name == \"path\" {\n        log.Printf(\"typeName %v\\n\", typeField.Name)\n        log.Printf(\"value %v\\n\", valueField)\n\n        f := reflect.Indirect(r).FieldByName(\"path\")\n\n        log.Printf(\"CanInterface %v\\n\", valueField.Elem())\n        p := valueField.Elem().(path.Path)\n\n        //patObject := reflect.Indirect(valueField).FieldByName(\"path\")\n\n    }\n    //f := valueField.Interface()\n    //val := reflect.ValueOf(f)\n    //slog.Printf(\"default %v\\n\", val)\n}\n</code></pre>\n\n<p>I get an compiltion error on this line \np := valueField.Elem().(path.Path) saying</p>\n\n<pre><code>invalid type assertion: valueField.Elem().(path.Path) (non-interface type reflect.Value on left)\n</code></pre>\n\n<p>Any clues how I can get past the error and get it to convert?</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1510172131, "post_id": 47188765, "comment_id": 81327013, "body": "You could Unmarshal to a <code>map[string]interface{}</code> then manually map whatever fields the struct actually has, removing them as you go. That would leave you with a map of the fields that were unmapped. Would that be of any use?"}, {"owner": {"reputation": 9345, "user_id": 4237316, "user_type": "registered", "accept_rate": 47, "profile_image": "https://graph.facebook.com/100004533998341/picture?type=large", "display_name": "Harald Nordgren", "link": "https://stackoverflow.com/users/4237316/harald-nordgren"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1510172256, "post_id": 47188765, "comment_id": 81327074, "body": "Possibly. Could you provide a working example as an answer?"}], "answers": [{"comments": [{"owner": {"reputation": 9345, "user_id": 4237316, "user_type": "registered", "accept_rate": 47, "profile_image": "https://graph.facebook.com/100004533998341/picture?type=large", "display_name": "Harald Nordgren", "link": "https://stackoverflow.com/users/4237316/harald-nordgren"}, "edited": false, "score": 0, "creation_date": 1510180278, "post_id": 47190050, "comment_id": 81331074, "body": "Maybe I should have mentioned this in my original post, but in my real-world business scenario <code>field1</code> is of type <code>time.Time</code> and this now causes problems when unmarshalling. Do you know any way to get around this?"}, {"owner": {"reputation": 9345, "user_id": 4237316, "user_type": "registered", "accept_rate": 47, "profile_image": "https://graph.facebook.com/100004533998341/picture?type=large", "display_name": "Harald Nordgren", "link": "https://stackoverflow.com/users/4237316/harald-nordgren"}, "edited": false, "score": 0, "creation_date": 1510218827, "post_id": 47190050, "comment_id": 81344373, "body": "Marking this as accepted since it answers the original question in an elegant way. Thanks!"}, {"owner": {"reputation": 9345, "user_id": 4237316, "user_type": "registered", "accept_rate": 47, "profile_image": "https://graph.facebook.com/100004533998341/picture?type=large", "display_name": "Harald Nordgren", "link": "https://stackoverflow.com/users/4237316/harald-nordgren"}, "edited": false, "score": 0, "creation_date": 1510219030, "post_id": 47190050, "comment_id": 81344476, "body": "Regarding <code>Time</code>, I&#39;m not too happy about having to parse the time a second time. I would much rather be able to use the implicit parsing inside the <code>json</code> library, where you don&#39;t have to specify a format string, for example. Since my data comes from multiple sources (MySQL and Postgres) with different formats on the time strings."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 1, "last_activity_date": 1510176782, "creation_date": 1510176782, "answer_id": 47190050, "question_id": 47188765, "link": "https://stackoverflow.com/questions/47188765/marshal-and-unmarshal-json-bodies-without-touching-all-fields/47190050#47190050", "title": "Marshal and unmarshal JSON bodies without touching all fields", "body": "<p>You would need to implement the <code>MarshalJSON</code> and <code>UnmarshalJSON</code> interfaces, and write your own logic to remap the fields to the appropriate spots:</p>\n\n<pre><code>func (t *Transaction) MarshalJSON() ([]byte, error) {\n    data := t.X\n    data[\"field1\"] = t.Field1\n    return json.Marshal(data)\n}\n\nfunc (t *Transaction) UnmarshalJSON(data []byte) error {\n    m := make(map[string]interface{})\n    json.Unmarshal(data, &amp;m)\n    t.Field1 = m[\"field1\"].(string)\n    delete(m, \"field1\")\n    t.X = m\n    return nil\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/KBGAsXB0xA\" rel=\"nofollow noreferrer\">https://play.golang.org/p/KBGAsXB0xA</a></p>\n"}, {"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 0, "last_activity_date": 1510177951, "creation_date": 1510177951, "answer_id": 47190319, "question_id": 47188765, "link": "https://stackoverflow.com/questions/47188765/marshal-and-unmarshal-json-bodies-without-touching-all-fields/47190319#47190319", "title": "Marshal and unmarshal JSON bodies without touching all fields", "body": "<p>If you want a generic solution (that would work with any struct without knowing the fields in advance), you can implement a function that would un-marshal the body into a struct and also return the \"leftover\" fields.</p>\n\n<p>For that you'd also need to implement a function that would convert any given struct to a map (to be used to then manipulate maps in a generic way instead of known-in-advance structs).</p>\n\n<p>Like so:</p>\n\n<pre><code>func structToMap(object interface{}) (map[string]interface{}, error) {\n    tempJson, err := json.Marshal(object)\n    if err != nil {\n       return nil, err\n    }\n    var theMap map[string]interface{}\n    err = json.Unmarshal(tempJson, &amp;theMap)\n    if err != nil {\n        return nil, err\n    }\n    return theMap, nil\n}\n</code></pre>\n\n<p>And then:</p>\n\n<pre><code>func unmarshalWithLeftovers(jsonBody []byte, target interface{}) (map[string]interface{}, error) {\n    err := json.Unmarshal(jsonBody, target)\n    if err != nil {\n        return nil, err\n    }\n    structMap, err := structToMap(target)\n    if err != nil {\n        return nil, err\n    }\n    var leftOvers map[string]interface{}\n    err = json.Unmarshal(jsonBody, &amp;leftOvers)\n    if err != nil {\n        return nil, err\n    }\n    for k, _ := range structMap {\n        delete(leftOvers, k)\n    }\n    return leftOvers, nil\n}\n</code></pre>\n\n<p>You can then combine the struct and the leftovers map in a similar fashion to re-marshal everything.</p>\n\n<p>See here a working example with the same type and json string that you used in your question:</p>\n\n<p><a href=\"https://play.golang.org/p/Fot6YVurHH\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Fot6YVurHH</a></p>\n"}], "owner": {"reputation": 9345, "user_id": 4237316, "user_type": "registered", "accept_rate": 47, "profile_image": "https://graph.facebook.com/100004533998341/picture?type=large", "display_name": "Harald Nordgren", "link": "https://stackoverflow.com/users/4237316/harald-nordgren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 825, "favorite_count": 1, "accepted_answer_id": 47190050, "answer_count": 2, "score": 3, "last_activity_date": 1510178015, "creation_date": 1510171733, "last_edit_date": 1510178015, "question_id": 47188765, "link": "https://stackoverflow.com/questions/47188765/marshal-and-unmarshal-json-bodies-without-touching-all-fields", "title": "Marshal and unmarshal JSON bodies without touching all fields", "body": "<p>I'm looking for a way to unmarshal a JSON body without having to specify targets for all fields. And then be a able to \"remarshal\" the body with implicit fields untouched.</p>\n\n<p>Something like this would be good, but doesn't work as a expected: (<a href=\"https://play.golang.org/p/fnVOKrmiFj\" rel=\"nofollow noreferrer\">https://play.golang.org/p/fnVOKrmiFj</a>)</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Transaction struct {\n    Field1  string                  `json:\"field1\"`\n    X       map[string]interface{}  `json:\"-\"`\n}\n\nfunc main() {\n    body := []byte(`{\"field1\": \"value1\", \"field2\": \"value2\"}`)\n    fmt.Printf(\"%+v\\n\", string(body))\n\n    var unmarshalledTransaction Transaction\n    json.Unmarshal(body, &amp;unmarshalledTransaction)\n    fmt.Printf(\"%+v\\n\", unmarshalledTransaction)\n\n    remarshalledTransaction, _ := json.Marshal(&amp;unmarshalledTransaction)\n    fmt.Printf(\"%+v\\n\", string(remarshalledTransaction))    \n}\n</code></pre>\n\n<p>Gives the output</p>\n\n<pre><code>{\"field1\": \"value1\", \"field2\": \"value2\"}\n{Field1:value1 X:map[]}\n{\"field1\":\"value1\"}\n</code></pre>\n\n<p>My expected result would be that <code>unmarshalledTransaction</code> contains the \"leftover\" fields in the <code>X</code> fields. And they are then restored when Marshalling again.</p>\n\n<p>Can this be done?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1510168921, "post_id": 47187680, "comment_id": 81325191, "body": "You&#39;re passing in two different <code>reflect.Kind</code>s, structs and slices, in case of slices you cannot use <code>NumField</code>, you have to iterate over its contents, make sure that those are structs and then you can call <code>NumField</code> on those."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1510169196, "post_id": 47187680, "comment_id": 81325371, "body": "You also logically want to do 2 different things here. In b and c you want to &quot;append&quot; a single value if the slice is empty, while in the other&#39;s you want to modify the values."}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1510171541, "post_id": 47187680, "comment_id": 81326692, "body": "@mkopriva how do I iterate over a slice of empty anonymous struct to get the field names?"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 4, "last_activity_date": 1510353865, "last_edit_date": 1510353865, "creation_date": 1510172179, "answer_id": 47188864, "question_id": 47187680, "link": "https://stackoverflow.com/questions/47187680/how-do-i-change-fields-a-slice-of-structs-using-reflect/47188864#47188864", "title": "How do I change fields a slice of structs using reflect?", "body": "<p>As stated in the comments, you cannot use <code>NumField</code> on a slice, since that method is allowed only for <code>reflect.Value</code>s that are of kind <code>reflect.Struct</code>.</p>\n\n<p>So if you want to handle both kinds you need to know which one was passed in.</p>\n\n<pre><code>if rv.Kind() == reflect.Struct {\n    changeStruct(rv)\n}\nif rv.Kind() == reflect.Slice {\n    changeSlice(rv)\n}\n</code></pre>\n\n<p>Now, if you want to append to an empty slice, you either have to pass in a pointer to the slice or you have to return the new slice.</p>\n\n<pre><code>change(&amp;b)\nchange(&amp;c)\n</code></pre>\n\n<p>Also, to be able to initialize that single element that you want to append you first need to know its type, to get the type of a slice's element you first get the slice's <code>reflect.Type</code> and then use its <code>Elem</code> method to get the type of the slice's element. With that type you can then use <code>reflect.New</code> to allocate a new value of that type and append it to the slice.  </p>\n\n<pre><code>var elem reflect.Value\n\n// rv is the slice\ntyp := rv.Type().Elem()\nif typ.Kind() == reflect.Ptr {\n    elem = reflect.New(typ.Elem())\n}\nif typ.Kind() == reflect.Struct {\n    elem = reflect.New(typ).Elem()\n}\n</code></pre>\n\n<p>To then loop over a slice you can use the <code>reflect.Value.Len</code> and <code>reflect.Value.Index</code> methods.</p>\n\n<pre><code>ln := rv.Len()\nfor i := 0; i &lt; ln; i++ {\n    changerv(rv.Index(i))\n}\n</code></pre>\n\n<hr>\n\n<p>The code:</p>\n\n<pre><code>func change(a interface{}) {\n    rv := reflect.ValueOf(a)\n    changerv(rv)\n}\n\nfunc changerv(rv reflect.Value) {\n    if rv.Kind() == reflect.Ptr {\n        rv = rv.Elem()\n    }\n\n    if rv.Kind() == reflect.Struct {\n        changeStruct(rv)\n    }\n    if rv.Kind() == reflect.Slice {\n        changeSlice(rv)\n    }\n}\n\n// assumes rv is a slice\nfunc changeSlice(rv reflect.Value) {\n    ln := rv.Len()\n    if ln == 0 &amp;&amp; rv.CanAddr() {\n        var elem reflect.Value\n\n        typ := rv.Type().Elem()\n        if typ.Kind() == reflect.Ptr {\n            elem = reflect.New(typ.Elem())\n        }\n        if typ.Kind() == reflect.Struct {\n            elem = reflect.New(typ).Elem()\n        }\n\n        rv.Set(reflect.Append(rv, elem))\n    }\n\n    ln = rv.Len()\n    for i := 0; i &lt; ln; i++ {\n        changerv(rv.Index(i))\n    }\n}\n\n// assumes rv is a struct\nfunc changeStruct(rv reflect.Value) {\n    if !rv.CanAddr() {\n        return\n    }\n    for i := 0; i &lt; rv.NumField(); i++ {\n        field := rv.Field(i)\n\n        switch field.Kind() {\n        case reflect.String:\n            field.SetString(\"fred\")\n        case reflect.Int:\n            field.SetInt(54)\n        default:\n            fmt.Println(\"unknown field\")\n        }\n    }\n}\n</code></pre>\n\n<p>The <a href=\"https://play.golang.org/p/UjkjLDt3vT\" rel=\"nofollow noreferrer\">playground</a>.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2531, "favorite_count": 1, "accepted_answer_id": 47188864, "answer_count": 1, "score": 1, "last_activity_date": 1510353865, "creation_date": 1510167894, "last_edit_date": 1510170930, "question_id": 47187680, "link": "https://stackoverflow.com/questions/47187680/how-do-i-change-fields-a-slice-of-structs-using-reflect", "title": "How do I change fields a slice of structs using reflect?", "body": "<p>I have the following <a href=\"https://play.golang.org/p/TlHCX29QZr\" rel=\"nofollow noreferrer\">https://play.golang.org/p/TlHCX29QZr</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype A struct {\n    Name string\n    Age  int\n}\n\nfunc change(a interface{}) {\n    aa := reflect.Indirect(reflect.ValueOf(a))\n\n    for i := 0; i &lt; aa.NumField(); i++ {\n        field := aa.Field(i)\n\n        switch field.Interface().(type) {\n        case string:\n            field.Set(reflect.ValueOf(\"fred\"))\n        case int:\n            field.Set(reflect.ValueOf(54))\n        default:\n            fmt.Println(\"unknown field\")\n        }\n    }\n}\n\nfunc main() {\n    a := &amp;A{\"bob\", 120}\n    b := []*A{}\n    c := []struct {\n        Alias  string\n        Months int\n    }{}\n\n    d := []struct {\n        First  string\n        Years int\n    }{\n        {\"james\", 22},\n        {\"ricky\", 32},\n        {\"bobby\", 12},\n        {\"rachel\", 82}, \n    }\n\n\n    change(a)\n    fmt.Println(a) // want &amp;A{\"fred\", 54}\n\n    change(b)\n    fmt.Println(b) // want []*A{&amp;A{\"fred\", 54}}\n\n    change(c)\n    fmt.Println(c) // want []struct{struct{\"fred\", 54}}\n\n    change(d)\n    fmt.Println(d) // want []struct{struct{\"fred\", 54}, struct{\"fred\", 54}, struct{\"fred\", 54}, struct{\"fred\", 54}}\n}\n</code></pre>\n\n<p>As you can see, some of the variables are an empty slice and some are not. For those that are empty, I need to add 1 struct of {\"fred\", 54}. For those slices that are not empty I need to change all values to {\"fred\", 54}. I do not know in advance what the fields are...only that if there is a string field the value should be \"fred\" and if an int field 54.</p>\n\n<p>I'm able to change the value of \"a\" but everything else fails with \"panic: reflect: call of reflect.Value.NumField on slice Value\". I'm not sure where to go on this. Thank you!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1510166555, "post_id": 47187280, "comment_id": 81323765, "body": "What is the unrecognized import path? Can you provide the full error output?"}, {"owner": {"reputation": 13885, "user_id": 1509695, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/04a3ca8cd41bf8e170b901072fcc667f?s=128&d=identicon&r=PG", "display_name": "matanster", "link": "https://stackoverflow.com/users/1509695/matanster"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510166599, "post_id": 47187280, "comment_id": 81323789, "body": "Right, sorry: <code>package yap&#47;app: unrecognized import path &quot;yap&#47;app&quot; (import path does not begin with hostname)</code>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1510166660, "post_id": 47187280, "comment_id": 81323825, "body": "Why are you trying to do go get on a local package. Please read the documentation of got get."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1510166707, "post_id": 47187280, "comment_id": 81323846, "body": "That means &quot;yap/app&quot; isn&#39;t found, and you can&#39;t get it because it doesn&#39;t start with a hostname. Your local sources need to be in GOPATH. (and you probably <i>should not</i> be setting GOROOT)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1510166721, "post_id": 47187280, "comment_id": 81323856, "body": "Wow, that project is terrible - their import paths are objectively wrong. Where they import <code>yap&#47;app</code>, they should be importing <code>github.com&#47;habeanf&#47;yap&#47;app</code>, etc. The only fix would be to clone the GitHub repo into <code>$GOPATH&#47;src&#47;yap</code> manually and then try to build it."}, {"owner": {"reputation": 13885, "user_id": 1509695, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/04a3ca8cd41bf8e170b901072fcc667f?s=128&d=identicon&r=PG", "display_name": "matanster", "link": "https://stackoverflow.com/users/1509695/matanster"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510166961, "post_id": 47187280, "comment_id": 81323994, "body": "Okay, I guess the project doesn&#39;t use standard clean way. @Adrian your suggestion indeed works. I&#39;ll learn more about go project structure and imports as I go, and PR to fix the build instructions of the specific project to at least include your instruction. Many thanks!"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1510167252, "post_id": 47187280, "comment_id": 81324167, "body": "Glad it worked for you - reposted as an answer. Sorry you got so many downvotes... the Go community on SO has largely tired of an endless stream of GOPATH/GOROOT/go get questions that boil down to simple user error, but that was not the case here. Good luck!"}, {"owner": {"reputation": 13885, "user_id": 1509695, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/04a3ca8cd41bf8e170b901072fcc667f?s=128&d=identicon&r=PG", "display_name": "matanster", "link": "https://stackoverflow.com/users/1509695/matanster"}, "edited": false, "score": 0, "creation_date": 1510167418, "post_id": 47187280, "comment_id": 81324275, "body": "Yeah I was expecting some :-))) but I think that when no answer explains why things work the way they do, a new and better one should ask for it. I re-edited the question to be more generic too. Again many thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 139, "user_id": 1393219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb82206667f4205c2160f96e36ea3318?s=128&d=identicon&r=PG", "display_name": "douche_satan", "link": "https://stackoverflow.com/users/1393219/douche-satan"}, "edited": false, "score": 2, "creation_date": 1568386700, "post_id": 47187500, "comment_id": 102269504, "body": "Ok. So if I have a mix of imports, some refering local &#39;code modules&#39;( eg. /home/mylib1) and some refering to &#39;upstream modules&#39;(eg. github.com/myself/mylib2), go get will fail because it tries to download the local  &#39;code modules&#39; using its local path as an absolute remote url?"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 6, "last_activity_date": 1510167195, "creation_date": 1510167195, "answer_id": 47187500, "question_id": 47187280, "link": "https://stackoverflow.com/questions/47187280/unrecognized-import-path-import-path-does-not-begin-with-hostname/47187500#47187500", "title": "unrecognized import path (import path does not begin with hostname)", "body": "<p><code>go get</code> downloads dependencies and packages by assuming that the import path (in the <code>import</code> statements in source code) identifies a URL where the package can be downloaded, e.g. github.com/habeanf/yap. It works so long as developers use imports correctly; unfortunately, the developer of the yap project did not.</p>\n\n<p>Where they import <code>yap/app</code>, they should be importing <code>github.com/habeanf/yap/app</code>, etc. The only fix would be to clone the GitHub repo into <code>$GOPATH/src/yap</code> manually and then try to build it. You might want to open a GitHub issue on that project and request that they fix the import paths so it can be built like a normal Go project.</p>\n"}, {"tags": [], "owner": {"reputation": 179, "user_id": 1372139, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/34057619850b08ec9333c8f541e45dec?s=128&d=identicon&r=PG", "display_name": "White Zebra", "link": "https://stackoverflow.com/users/1372139/white-zebra"}, "is_accepted": false, "score": 0, "last_activity_date": 1610214675, "creation_date": 1610214675, "answer_id": 65645796, "question_id": 47187280, "link": "https://stackoverflow.com/questions/47187280/unrecognized-import-path-import-path-does-not-begin-with-hostname/65645796#65645796", "title": "unrecognized import path (import path does not begin with hostname)", "body": "<p>I had the same problem with setting up the same project on windows (note: updated project documentation is <a href=\"https://nlp.biu.ac.il/%7Ertsarfaty/onlp/hebrew/documentation\" rel=\"nofollow noreferrer\">here</a>).</p>\n<p>Turns out GOPATH was set up for my username by GO installation while I updated the system environment GOPATH according to this description from the docs:</p>\n<blockquote>\n<p>Set $GOPATH environment variable to your workspace: export\nGOPATH=path/to/yapproj</p>\n</blockquote>\n<p>Removing GOPATH for my username solved the problem and I managed to build the application.</p>\n<p>I'm posting this to prevent others from spending too much time on this issue as I did.</p>\n"}], "owner": {"reputation": 13885, "user_id": 1509695, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/04a3ca8cd41bf8e170b901072fcc667f?s=128&d=identicon&r=PG", "display_name": "matanster", "link": "https://stackoverflow.com/users/1509695/matanster"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12939, "favorite_count": 2, "accepted_answer_id": 47187500, "answer_count": 2, "score": 8, "last_activity_date": 1610214675, "creation_date": 1510166399, "last_edit_date": 1510167969, "question_id": 47187280, "link": "https://stackoverflow.com/questions/47187280/unrecognized-import-path-import-path-does-not-begin-with-hostname", "title": "unrecognized import path (import path does not begin with hostname)", "body": "<p>I've installed go as per the custom installation clause of <a href=\"https://golang.org/doc/install?download=go1.9.2.linux-amd64.tar.gz\" rel=\"noreferrer\">the installation instructions</a>, as I have installed to a user directory, in order to accommodate having multiple versions of go. </p>\n\n<p>When I <code>go get .</code> from my go project's src directory, I get the error message type already mentioned above \u2015</p>\n\n<blockquote>\n  <p>unrecognized import path (import path does not begin with hostname)</p>\n</blockquote>\n\n<p>Can you please explain, why does go look for a hostname and how that should possibly be avoided in a typical project?</p>\n\n<p>As an aside, the problem was originally encountered by me in setting up the <a href=\"https://github.com/habeanf/yap/tree/9bd0606a7be454631bc8700fffe10a06c813963c\" rel=\"noreferrer\">following specific project and hash</a>, which the accepted answer still refers to.</p>\n"}, {"tags": ["json", "http", "go", "http-post", "httprequest"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1510164921, "post_id": 47186741, "comment_id": 81322823, "body": "Echo or something called by Echo is reading the request body before your handler is invoked.  Some frameworks automatically read url encoded forms. Print the content type on the server to confirm that it&#39;s set as you expect.  If you use net/http directly, then <code>json.NewDecoder(r.Body).Decode(&amp;v)</code> will do what you expect."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1510175114, "post_id": 47186741, "comment_id": 81328674, "body": "Can you show the full code of the handler? Also do you have any middleware that gets executed before your handler? As Cerise Limon already said, the error looks very much like the body reader&#39;s position is at its end when you try to read the json, that can happen when some other code read the body first without &quot;rewinding&quot; the reader back to the beginning. Or it could be that the request body is actually empty..."}, {"owner": {"reputation": 703, "user_id": 3521313, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/MqjzI.jpg?s=128&g=1", "display_name": "transistor", "link": "https://stackoverflow.com/users/3521313/transistor"}, "edited": false, "score": 0, "creation_date": 1510695554, "post_id": 47186741, "comment_id": 81542483, "body": "Thank you for your comments, you got me thinking and found a solution"}], "answers": [{"comments": [{"owner": {"reputation": 703, "user_id": 3521313, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/MqjzI.jpg?s=128&g=1", "display_name": "transistor", "link": "https://stackoverflow.com/users/3521313/transistor"}, "edited": false, "score": 0, "creation_date": 1510173892, "post_id": 47188093, "comment_id": 81327965, "body": "Thank you @dave, but I get an error: runtime error: invalid memory address or nil pointer dereference"}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": -1, "last_activity_date": 1510169293, "creation_date": 1510169293, "answer_id": 47188093, "question_id": 47186741, "link": "https://stackoverflow.com/questions/47186741/how-to-get-the-json-from-the-body-of-a-request-on-go/47188093#47188093", "title": "How to get the JSON from the Body of a Request on Go", "body": "<p>I believe you can do this:</p>\n\n<pre><code>m := make(map[string]interface{});\nif err := context.Bind(&amp;m); err != nil {\n    return result, err\n}\nfmt.Println(m)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 703, "user_id": 3521313, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/MqjzI.jpg?s=128&g=1", "display_name": "transistor", "link": "https://stackoverflow.com/users/3521313/transistor"}, "is_accepted": true, "score": 24, "last_activity_date": 1510695661, "creation_date": 1510695661, "answer_id": 47295689, "question_id": 47186741, "link": "https://stackoverflow.com/questions/47186741/how-to-get-the-json-from-the-body-of-a-request-on-go/47295689#47295689", "title": "How to get the JSON from the Body of a Request on Go", "body": "<p>TIL that <code>http.Response.Body</code> is a buffer, which means that once it has been read, it cannot be read again.</p>\n\n<p>It's like a stream of water, you can see it and measure it as it passes but once it's gone, it's gone.</p>\n\n<p>However, knowing this, there is a workaround, you need to \"catch\" the body and restore it:</p>\n\n<pre><code>// Read the Body content\nvar bodyBytes []byte\nif context.Request().Body != nil {\n    bodyBytes, _ = ioutil.ReadAll(context.Request().Body)\n}\n\n// Restore the io.ReadCloser to its original state\ncontext.Request().Body = ioutil.NopCloser(bytes.NewBuffer(bodyBytes))\n\n// Continue to use the Body, like Binding it to a struct:\norder := new(models.GeaOrder)\nerror := context.Bind(order)\n</code></pre>\n\n<p>Now, you can use <code>context.Request().Body</code> somewhere else.</p>\n\n<p>Sources:</p>\n\n<p><a href=\"http://grokbase.com/t/gg/golang-nuts/12adq8a2ys/go-nuts-re-reading-http-response-body-or-any-reader\" rel=\"noreferrer\">http://grokbase.com/t/gg/golang-nuts/12adq8a2ys/go-nuts-re-reading-http-response-body-or-any-reader</a></p>\n\n<p><a href=\"https://medium.com/@xoen/golang-read-from-an-io-readwriter-without-loosing-its-content-2c6911805361\" rel=\"noreferrer\">https://medium.com/@xoen/golang-read-from-an-io-readwriter-without-loosing-its-content-2c6911805361</a></p>\n"}], "owner": {"reputation": 703, "user_id": 3521313, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/MqjzI.jpg?s=128&g=1", "display_name": "transistor", "link": "https://stackoverflow.com/users/3521313/transistor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18308, "favorite_count": 7, "accepted_answer_id": 47295689, "answer_count": 2, "score": 7, "last_activity_date": 1510695661, "creation_date": 1510164429, "question_id": 47186741, "link": "https://stackoverflow.com/questions/47186741/how-to-get-the-json-from-the-body-of-a-request-on-go", "title": "How to get the JSON from the Body of a Request on Go", "body": "<p>I'm a newbie with Go, but so far I'm liking it very much.</p>\n\n<p>I have a problem I can't figure out. I'm migrating an API from Node to Go and there is this log where I have to capture the Body of a POST <strong><em>AS IT IS</em></strong> and save it to a <code>jsonb</code> type column in a Postgresql database. </p>\n\n<p>This means I can't use a <code>struct</code> or anything predetermined.</p>\n\n<p>The POST is made with body raw <code>Content-Type: application/json</code> like so:</p>\n\n<pre><code>{\n    \"debug\": false,\n    \"order_id_gea\": 326064,\n    \"increment_id_gea\": 200436102,\n    \"date\": \"2017-05-18T01:44:44+00:00\",\n    \"total_amount\": 10000.00,\n    \"currency\": \"MXN\",\n    \"payment_method\": \"Referencia bancaria\",\n    \"reference\": \"857374\",\n    \"buyer\": {\n        \"buyer_id_gea\": 1234,\n        \"full_name\": \"Juan Perez Martinez\",\n        \"email\": \"juanperez@gmail.com\",\n        \"phone\": \"5512341234\"\n    },\n    \"products\": [\n        {\n            \"sku\":\"PEP16114\",\n            \"price\": 10000.00,\n            \"currency\": \"MXN\",\n            \"student\": {\n                \"school_id_gea\": 172,\n                \"grade_id_gea\": 119,\n                \"level_id_gea\": 36,\n                \"name\": \"Benancio\",\n                \"last_name\": \"Perez\",\n                \"second_last_name\": \"Garcia\",\n                \"email\": \"benancio@gmail.com\"\n            }\n        }\n    ]\n}\n</code></pre>\n\n<p>On Node + Hapi is quite simple:</p>\n\n<pre><code>const payload = request.payload\n</code></pre>\n\n<p>and then I can access the JSON from <code>payload</code>.</p>\n\n<p>I am using Go with Echo, so <a href=\"https://godoc.org/github.com/labstack/echo#Context\" rel=\"noreferrer\"><code>context</code></a> is a wrapper where I can find <code>Request() *http.Request</code>.</p>\n\n<p>I have tried the following, but everytime the result is empty or an error because it is empty:</p>\n\n<pre><code>var v interface{}\nerr := json.NewDecoder(context.Request().Body).Decode(&amp;v)\nif err != nil {\n    return result, err\n}\nfmt.Println(v)\n</code></pre>\n\n<p>Result: EOF</p>\n\n<p>--</p>\n\n<pre><code>m := echo.Map{}\nif err := context.Bind(&amp;m); err != nil {\n    return result, err\n}\nfmt.Println(m)\n</code></pre>\n\n<p>Result code 400, message EOF </p>\n\n<p>--</p>\n\n<pre><code>body, error := ioutil.ReadAll(context.Request().Body)\nif error != nil {\n    return result, error\n}\nfmt.Println(body)\n</code></pre>\n\n<p>Result []</p>\n\n<p>--</p>\n\n<p>What am I missing and/or doing wrong? Thanks!</p>\n"}, {"tags": ["go", "viper-go"], "comments": [{"owner": {"reputation": 6026, "user_id": 828638, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/20a2e679ccb8601c45427bcedf815d50?s=128&d=identicon&r=PG", "display_name": "jordanpg", "link": "https://stackoverflow.com/users/828638/jordanpg"}, "edited": false, "score": 0, "creation_date": 1593618210, "post_id": 47185318, "comment_id": 110845933, "body": "From the docs: &quot;Viper can search multiple paths, but currently a single Viper instance only supports a single configuration file.&quot;  <a href=\"https://github.com/spf13/viper#reading-config-files\" rel=\"nofollow noreferrer\">github.com/spf13/viper#reading-config-files</a>"}], "answers": [{"comments": [{"owner": {"reputation": 160, "user_id": 7450304, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-GyiUxlZTOzw/AAAAAAAAAAI/AAAAAAAAFSI/Zb8FXn3DUkg/photo.jpg?sz=128", "display_name": "edupo", "link": "https://stackoverflow.com/users/7450304/edupo"}, "edited": false, "score": 0, "creation_date": 1531118990, "post_id": 47185439, "comment_id": 89458012, "body": "What if the configuration file name remains the same between different folders? For example having a global config for your app in your home and then a project specific config in the cwd. The one on your home can be called with a &#39;global&#39; prefix, but keeping the same name is simpler."}, {"owner": {"reputation": 3667, "user_id": 2810231, "user_type": "registered", "accept_rate": 42, "profile_image": "https://graph.facebook.com/100001501301898/picture?type=large", "display_name": "Justin", "link": "https://stackoverflow.com/users/2810231/justin"}, "reply_to_user": {"reputation": 160, "user_id": 7450304, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-GyiUxlZTOzw/AAAAAAAAAAI/AAAAAAAAFSI/Zb8FXn3DUkg/photo.jpg?sz=128", "display_name": "edupo", "link": "https://stackoverflow.com/users/7450304/edupo"}, "edited": false, "score": 0, "creation_date": 1541211375, "post_id": 47185439, "comment_id": 93150172, "body": "@edupo Just change the <code>ConfigPath</code> in each time you load a new config file, like the example above."}, {"owner": {"reputation": 6026, "user_id": 828638, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/20a2e679ccb8601c45427bcedf815d50?s=128&d=identicon&r=PG", "display_name": "jordanpg", "link": "https://stackoverflow.com/users/828638/jordanpg"}, "edited": false, "score": 0, "creation_date": 1593617500, "post_id": 47185439, "comment_id": 110845510, "body": "<code>viper.AddConfigPath</code> adds to the global search path, it does not replace it."}], "tags": [], "owner": {"reputation": 12722, "user_id": 393157, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PiD4P.png?s=128&g=1", "display_name": "svenwltr", "link": "https://stackoverflow.com/users/393157/svenwltr"}, "is_accepted": true, "score": 28, "last_activity_date": 1510160197, "creation_date": 1510160197, "answer_id": 47185439, "question_id": 47185318, "link": "https://stackoverflow.com/questions/47185318/multiple-config-files-with-go-viper/47185439#47185439", "title": "Multiple config files with go-viper", "body": "<p><code>viper</code> has <a href=\"https://godoc.org/github.com/spf13/viper#ReadInConfig\" rel=\"noreferrer\"><code>ReadInConfig</code></a> and <a href=\"https://godoc.org/github.com/spf13/viper#MergeInConfig\" rel=\"noreferrer\"><code>MergeInConfig</code></a>, which can called multiple times. Here is an (untested) example:</p>\n\n<pre><code>viper.SetConfigName(\"default\")\nviper.AddConfigPath(path)\nviper.ReadInConfig()\n\nif context != \"\" {\n    viper.SetConfigName(context)\n    viper.AddConfigPath(path)\n    viper.MergeInConfig()\n}\n\nviper.SetConfigName(\"config\")\nviper.AddConfigPath(\".\")\nviper.MergeInConfig()\n</code></pre>\n\n<p>It reads these files in this order:</p>\n\n<ul>\n<li><code>$path/default.[yaml|toml|json]</code></li>\n<li><code>$path/$context.[yaml|toml|json]</code></li>\n<li><code>./config.[yaml|toml|json]</code></li>\n</ul>\n"}], "owner": {"reputation": 443, "user_id": 948383, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/40d0367c1bec78fc750f133415c7eff0?s=128&d=identicon&r=PG", "display_name": "madshov", "link": "https://stackoverflow.com/users/948383/madshov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7804, "favorite_count": 5, "accepted_answer_id": 47185439, "answer_count": 1, "score": 11, "last_activity_date": 1510160197, "creation_date": 1510159836, "question_id": 47185318, "link": "https://stackoverflow.com/questions/47185318/multiple-config-files-with-go-viper", "title": "Multiple config files with go-viper", "body": "<p>Is it possible to load/merge multiple config files with Viper? Say I have a general config file containing configuration for my program, and client specific config files with configuration for each client, where one of them would be loaded, depending on the input to the program.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["windows", "go", "lint"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510155238, "post_id": 47182222, "comment_id": 81316383, "body": "Most Windows machines do not have a Unix terminal so this is likely of limited value to the asker."}, {"owner": {"reputation": 2508, "user_id": 1315125, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c9f929903506a6ee23b5f669c6a49077?s=128&d=identicon&r=PG", "display_name": "Igor L.", "link": "https://stackoverflow.com/users/1315125/igor-l"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510219034, "post_id": 47182222, "comment_id": 81344479, "body": "au contraire, I would say most programmers working on windows machines do have a Unix terminal (Git Bash) and use it instead of the limitted windows cmd prompt"}, {"owner": {"reputation": 2508, "user_id": 1315125, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c9f929903506a6ee23b5f669c6a49077?s=128&d=identicon&r=PG", "display_name": "Igor L.", "link": "https://stackoverflow.com/users/1315125/igor-l"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510221145, "post_id": 47182222, "comment_id": 81345841, "body": "The reason why my approach is not good is that you shouldn&#39;t have to scan the unwanted files"}], "tags": [], "owner": {"reputation": 2508, "user_id": 1315125, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c9f929903506a6ee23b5f669c6a49077?s=128&d=identicon&r=PG", "display_name": "Igor L.", "link": "https://stackoverflow.com/users/1315125/igor-l"}, "is_accepted": true, "score": 0, "last_activity_date": 1510151134, "creation_date": 1510151134, "answer_id": 47182222, "question_id": 47181674, "link": "https://stackoverflow.com/questions/47181674/how-to-disable-pkcs11-in-gometalinter/47182222#47182222", "title": "How to disable pkcs11 in gometalinter?", "body": "<p>This is a bit of a hack + a windows user will have to have a unix terminal:</p>\n\n<pre><code>gometalinter.v1 ./... --deadline 10000000ms  | awk '!/pkcs11/'\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2508, "user_id": 1315125, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c9f929903506a6ee23b5f669c6a49077?s=128&d=identicon&r=PG", "display_name": "Igor L.", "link": "https://stackoverflow.com/users/1315125/igor-l"}, "edited": false, "score": 0, "creation_date": 1510219142, "post_id": 47183770, "comment_id": 81344548, "body": "can u pls improve the quality of this answer by providing a working example? (I can accept the answer afterwards, right now it&#39;s more of a comment)"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1510155470, "creation_date": 1510155470, "answer_id": 47183770, "question_id": 47181674, "link": "https://stackoverflow.com/questions/47181674/how-to-disable-pkcs11-in-gometalinter/47183770#47183770", "title": "How to disable pkcs11 in gometalinter?", "body": "<p>It looks like you can use a <a href=\"https://github.com/alecthomas/gometalinter#configuration-file\" rel=\"nofollow noreferrer\">configuration file</a> for your project, per the <code>gometalinter</code> documentation. You can use the <code>Exclude</code> setting to set regular expressions that, if a message matches the pattern, the message will not be output.</p>\n"}], "owner": {"reputation": 2508, "user_id": 1315125, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c9f929903506a6ee23b5f669c6a49077?s=128&d=identicon&r=PG", "display_name": "Igor L.", "link": "https://stackoverflow.com/users/1315125/igor-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 47182222, "answer_count": 2, "score": 0, "last_activity_date": 1510155470, "creation_date": 1510149646, "question_id": 47181674, "link": "https://stackoverflow.com/questions/47181674/how-to-disable-pkcs11-in-gometalinter", "title": "How to disable pkcs11 in gometalinter?", "body": "<p>When unit test, or build my code, I have to use the following command:</p>\n\n<p><code>go test --tags nopkcs11</code></p>\n\n<p>I am using <a href=\"https://github.com/alecthomas/gometalinter\" rel=\"nofollow noreferrer\">https://github.com/alecthomas/gometalinter</a> on <strong>windows</strong> for linting.</p>\n\n<p>The gometalinter works well, but whenever I run linting, I can see a large number (hundreds) of messages like this:</p>\n\n<p><code>c:\\Users\\xxxxxxxxx\\workspace\\go\\src\\github.com\\hyperledger\\fabric\\bccsp\\pkcs11\\impl.go:70:24:warning: SessionHandle not declared by package pkcs11 (staticcheck)\nc:\\Users\\xxxxxxxxx\\workspace\\go\\src\\github.com\\hyperledger\\fabric\\bccsp\\pkcs11\\impl.go:70:24:warning: SessionHandle not declared by package pkcs11 (staticcheck)\nc:\\Users\\xxxxxxxxx\\workspace\\go\\src\\github.com\\hyperledger\\fabric\\bccsp\\pkcs11\\pkcs11.go:39:9:warning: New not declared by package pkcs11 (staticcheck)\nc:\\Users\\xxxxxxxxx\\workspace\\go\\src\\github.com\\hyperledger\\fabric\\bccsp\\pkcs11\\pkcs11.go:50:20:warning: cannot range over slots (invalid operand) (staticcheck)</code></p>\n\n<p>I run the metalinter in the following manner:</p>\n\n<p><code>$ gometalinter.v1 ./...</code></p>\n\n<p>Is there a way to disable <em>pkcs11</em> on gometalinter?</p>\n"}, {"tags": ["sql", "database", "testing", "go", "mocking"], "answers": [{"comments": [{"owner": {"reputation": 111, "user_id": 938617, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9b7dc6afae84f6d70817e2ecfb1710d?s=128&d=identicon&r=PG", "display_name": "Gabriel Ara&#250;jo", "link": "https://stackoverflow.com/users/938617/gabriel-ara%c3%bajo"}, "edited": false, "score": 0, "creation_date": 1510156977, "post_id": 47181677, "comment_id": 81317617, "body": "What I want is to figure out a way to make the test not depending on UserDao implementation, which uses db arbitrarily."}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 1, "last_activity_date": 1510149654, "creation_date": 1510149654, "answer_id": 47181677, "question_id": 47180636, "link": "https://stackoverflow.com/questions/47180636/how-do-i-stub-sqlmock-to-never-return-error/47181677#47181677", "title": "How do I stub sqlmock to never return error?", "body": "<p>You are missing the second item in your last return in <code>NewDao</code>:</p>\n\n<p><code>return &amp;Dao{client, product}</code></p>\n\n<p>should be:</p>\n\n<p><code>return &amp;Dao{client, product}, nil</code></p>\n\n<p>Return statements have to \"return\" all the things declared in the function header.</p>\n"}, {"comments": [{"owner": {"reputation": 111, "user_id": 938617, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9b7dc6afae84f6d70817e2ecfb1710d?s=128&d=identicon&r=PG", "display_name": "Gabriel Ara&#250;jo", "link": "https://stackoverflow.com/users/938617/gabriel-ara%c3%bajo"}, "edited": false, "score": 0, "creation_date": 1510196096, "post_id": 47187152, "comment_id": 81335453, "body": "Got it! Thanks! I need not to use newClientDao(db) function to create the client to make this test. I put a bad example for my question."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 0, "last_activity_date": 1510165901, "creation_date": 1510165901, "answer_id": 47187152, "question_id": 47180636, "link": "https://stackoverflow.com/questions/47180636/how-do-i-stub-sqlmock-to-never-return-error/47187152#47187152", "title": "How do I stub sqlmock to never return error?", "body": "<p>Your <code>Dao.Client</code> and <code>Dao.Product</code> methods themselves make no calls to any dependency and because of that there is nothing for you to mock. There is no point in using a mock for testing these two methods.</p>\n\n<p>And although testing one liners like these may not be the most sensible thing to do, if you want to test them anyway you just need to make sure that the value they return equals the value of the field that they're supposed to return.</p>\n\n<pre><code>func TestDaoClient(t *testing.T) {\n    var client ClientDao // TODO: prepare a client dao value for test\n\n    tests := []struct{\n        name string\n        dao *Dao\n        want ClientDao\n    }{{\n        name: \"should return client dao\",\n        dao: &amp;Dao{client: client},\n        want: client,\n    }, {\n        name: \"should return nil\",\n        dao: &amp;Dao{client: nil},\n        want: nil,\n    }}\n\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            if got := tt.dao.Client(); !reflect.DeepEqual(got, tt.want) {\n                t.Errorf(\"client got=%v, want=%v\", got, tt.want)\n            }\n        })    \n    }\n}\n</code></pre>\n\n<p>Now you can do the same for the <code>Dao.Product</code> method.</p>\n"}], "owner": {"reputation": 111, "user_id": 938617, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e9b7dc6afae84f6d70817e2ecfb1710d?s=128&d=identicon&r=PG", "display_name": "Gabriel Ara&#250;jo", "link": "https://stackoverflow.com/users/938617/gabriel-ara%c3%bajo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1510196708, "creation_date": 1510146629, "last_edit_date": 1510196708, "question_id": 47180636, "link": "https://stackoverflow.com/questions/47180636/how-do-i-stub-sqlmock-to-never-return-error", "title": "How do I stub sqlmock to never return error?", "body": "<p>I can not test the function <code>NewDao</code> that uses a database arbitrarily. I want to check whether the returned Dao have neither nil client nor nil product. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Dao struct {\n  client ClientDao\n  product ProductDao\n}\n\nfunc (d *Dao) Client() ClientDao {\n  return d.client\n}\n\nfunc (d *Dao) Product() ProductDao {\n  return d.product\n}\n\nfunc NewDao(db *sql.DB) (*Dao, error) {\n  if db == nil {\n    return nil, errors.New(\"Can't create a dao from nil database\")\n  }\n  client, err := newClientDao(db) // Uses db arbitrarily\n  if err != nil {\n    return nil, err\n  }\n  product, err := newProductDao(db) // Uses db arbitrarily\n  if err != nil {\n    return nil, err\n  }\n  return &amp;Dao{client, product}, nil\n}\n</code></pre>\n\n<p>I test <code>NewDao()</code> using sqlmock but it always fails because I don't know what the mock needs to expect.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestNewDao(t *testing.T) {\n  db, mock, err := sqlmock.New()\n  if err != nil {\n    t.Fatal(\"Can't create database for test dao\")\n  }\n\n  // How to set mock to expect anything and never fail?\n  // mock.ExpectQuery(any) ?\n\n  dao, err := NewDao(db)\n\n  // err is never nil, because mock has no expectations\n\n  if err != nil {\n    t.Fatal(\"Can't create dao for test dao.User %q\", err)\n  }\n  if dao.User() == nil {\n    t.Fatalf(\"User dao is nil\")\n  }\n  if dao.Client() == nil {\n    t.Fatalf(\"Client dao is nil\")\n  }\n}\n</code></pre>\n\n<hr>\n\n<p>Does any one know how to stub the sqlmock for achieving my purpose? Or can appoint an alternative to sqlmock lib?</p>\n"}, {"tags": ["go", "httpclient"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1510144858, "post_id": 47179899, "comment_id": 81308795, "body": "To resolve this issue you have to fix the status code. 8000 is not valid HTTP. If you cannot fix the underlying bug you cannot use package net/http&#39;s features (as you are no longer speaking HTTP): Use low level functions (e.g. in net) and reimplement what you need to handle your pseudo HTTP."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510155690, "post_id": 47179899, "comment_id": 81316681, "body": "Indeed, the problem here is the status code, not <code>net&#47;http</code>. Per the spec, HTTP status codes are all exactly 3 digits, which is why Go&#39;s client is implemented this way."}, {"owner": {"reputation": 5, "user_id": 2101845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dd1b229251c5ed7fd46b6bf6bae6544?s=128&d=identicon&r=PG", "display_name": "user2101845", "link": "https://stackoverflow.com/users/2101845/user2101845"}, "edited": false, "score": 0, "creation_date": 1510286063, "post_id": 47179899, "comment_id": 81380224, "body": "I do understand that the RFC spec says the status code has to be 3 digits. But the issue is that the service which I am trying to integrate is a very old legacy Bank api. And we dont have any control over that. Also I am not saying the issue is with the net/http. But I am asking if there is a way to bypass this validation for legacy codes."}], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 2101845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dd1b229251c5ed7fd46b6bf6bae6544?s=128&d=identicon&r=PG", "display_name": "user2101845", "link": "https://stackoverflow.com/users/2101845/user2101845"}, "edited": false, "score": 0, "creation_date": 1510286842, "post_id": 47180111, "comment_id": 81380426, "body": "Can you help me in understanding how to directly listen to the socket?"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1510292044, "post_id": 47180111, "comment_id": 81381872, "body": "Strictly speaking it\u2019s not an HTTP service because it violates basic protocol. You can make you own fork of golang http libraries and patch them. I am pretty sure nobody will accept this patch to mainstream because it means to break unknown number of clients obeying protocols. Thus you have to maintain it on your own. Fortunately patch is very little it won\u2019t be problem. Do not forget to make your tests and make sure all standard test keep working."}], "tags": [], "owner": {"reputation": 34449, "user_id": 301032, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/06b3210955831102992eb6b1d0a0e612?s=128&d=identicon&r=PG", "display_name": "richzilla", "link": "https://stackoverflow.com/users/301032/richzilla"}, "is_accepted": false, "score": 1, "last_activity_date": 1510220514, "last_edit_date": 1510220514, "creation_date": 1510145156, "answer_id": 47180111, "question_id": 47179899, "link": "https://stackoverflow.com/questions/47179899/golang-http-client-request-fails-on-custom-http-status-code/47180111#47180111", "title": "Golang Http Client request fails on Custom Http Status code", "body": "<p>From RFC 2616:</p>\n\n<blockquote>\n  <p>The Status-Code element is a 3-digit integer result code of the\n     attempt</p>\n</blockquote>\n\n<p>What you have there is not valid HTTP. If you can get hold of the socket directly, you could try parsing the raw TCP data.</p>\n"}, {"comments": [{"owner": {"reputation": 5, "user_id": 2101845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dd1b229251c5ed7fd46b6bf6bae6544?s=128&d=identicon&r=PG", "display_name": "user2101845", "link": "https://stackoverflow.com/users/2101845/user2101845"}, "edited": false, "score": 0, "creation_date": 1510286782, "post_id": 47180750, "comment_id": 81380410, "body": "The service I am integrating is not under my control to change the behaviour of the HTTP Server. The service is a legacy banking system and its tough to change a existing API from a bank&#39;s end.."}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1510146996, "creation_date": 1510146996, "answer_id": 47180750, "question_id": 47179899, "link": "https://stackoverflow.com/questions/47179899/golang-http-client-request-fails-on-custom-http-status-code/47180750#47180750", "title": "Golang Http Client request fails on Custom Http Status code", "body": "<p>If you wish you may use standard code for general information (ok, client error, server error, etc) and custom application codes transferred in payload for more details.</p>\n"}], "owner": {"reputation": 5, "user_id": 2101845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2dd1b229251c5ed7fd46b6bf6bae6544?s=128&d=identicon&r=PG", "display_name": "user2101845", "link": "https://stackoverflow.com/users/2101845/user2101845"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 474, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1510286691, "creation_date": 1510144555, "last_edit_date": 1510286691, "question_id": 47179899, "link": "https://stackoverflow.com/questions/47179899/golang-http-client-request-fails-on-custom-http-status-code", "title": "Golang Http Client request fails on Custom Http Status code", "body": "<p>We are rewriting an old integration with a service from python to golang. This service uses Custom status codes. For example the status code is 8000. But while I am trying to get the response it is giving me error as \u201cmalformed HTTP status code\u201d. Can some one help me to resolve this issue. Gone through the code and found the following piece of code that throws the error if the status code is not having length of 3.</p>\n\n<pre><code>   if len(statusCode) != 3 {\n    return nil, &amp;badStringError{\"malformed HTTP status code\", statusCode}\n}\n</code></pre>\n\n<p>EDIT:\nI do understand the RFC standard for HTTP status is 3 digits. But I am re-integrating a legacy code of a Banking system. So I cannot / dont have the access to change the service's implementation. </p>\n\n<p>To give more context, python's http library was not doing this validation.  (I am not saying that One language is superior to another, so please dont compare the languages/libraries) So wondering if there is any way to bypass this particular validation. \nThanks in advance for understanding..</p>\n"}, {"tags": ["mongodb", "ubuntu", "go", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1510148028, "last_edit_date": 1510148028, "creation_date": 1510145110, "answer_id": 47180097, "question_id": 47179890, "link": "https://stackoverflow.com/questions/47179890/too-many-open-files-in-mgo-go-server/47180097#47180097", "title": "too many open files in mgo go server", "body": "<p>This is not how you store and use a MongoDB connection in Go.</p>\n\n<p>You have to store an <a href=\"https://godoc.org/gopkg.in/mgo.v2#Session\" rel=\"nofollow noreferrer\"><code>mgo.Session</code></a>, not an <a href=\"https://godoc.org/gopkg.in/mgo.v2#Database\" rel=\"nofollow noreferrer\"><code>mgo.Database</code></a> instance. And whenever you need to interact with the MongoDB, you acquire a copy or a clone of the session (e.g. with <a href=\"https://godoc.org/gopkg.in/mgo.v2#Session.Copy\" rel=\"nofollow noreferrer\"><code>Session.Copy()</code></a> or <a href=\"https://godoc.org/gopkg.in/mgo.v2#Session.Clone\" rel=\"nofollow noreferrer\"><code>Session.Clone()</code></a>), and you close it when you don't need it (preferable using a <code>defer</code> statement). This will ensure you don't leak connections.</p>\n\n<p>You also <em>religiously</em> omit checking for errors, please don't do that. Whatever returns an <code>error</code>, do check it and act on it properly (the least you can do is print / log it).</p>\n\n<p>So basically what you need to do is something like this:</p>\n\n<pre><code>var session *mgo.Session\n\nfunc init() {\n    var err error\n    if session, err = mgo.Dial(\"localhost\"); err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc someHandler(w http.ResponseWriter, r *http.Request) {\n    sess := session.Copy()\n    defer sess.Close() // Must close!\n\n    c := sess.DB(\"mapdb\").C(\"tiles\")\n    // Do something with the collection, e.g.\n    var tile bson.M\n    if err := c.FindId(\"someTileID\").One(&amp;result); err != nil {\n        // Tile does not exist, send back error, e.g.:\n        log.Printf(\"Tile with ID not found: %v, err: %v\", \"someTileID\", err)\n        http.NotFound(w, r)\n        return\n    }\n    // Do something with tile\n}\n</code></pre>\n\n<p>See related questions:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/40999637/mgo-query-performance-seems-consistently-slow-500-650ms/41000876#41000876\">mgo - query performance seems consistently slow (500-650ms)</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/42492020/concurrency-in-gopkg-in-mgo-v2-mongo-go/42495522#42495522\">Concurrency in gopkg.in/mgo.v2 (Mongo, Go)</a></p>\n"}, {"tags": [], "owner": {"reputation": 3845, "user_id": 475978, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/40f04d8d5b169cee39e1ff9ce18b9cbf?s=128&d=identicon&r=PG&f=1", "display_name": "Prcela", "link": "https://stackoverflow.com/users/475978/prcela"}, "is_accepted": false, "score": 0, "last_activity_date": 1588771772, "creation_date": 1588771772, "answer_id": 61636461, "question_id": 47179890, "link": "https://stackoverflow.com/questions/47179890/too-many-open-files-in-mgo-go-server/61636461#61636461", "title": "too many open files in mgo go server", "body": "<p>You are missing:</p>\n\n<pre><code>defer r.Body.Close()\n</code></pre>\n\n<p>Make sure it is used before return statement.</p>\n"}], "owner": {"reputation": 764, "user_id": 160149, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/ee06835e17a71e6d8518c3e784e04c87?s=128&d=identicon&r=PG", "display_name": "jonydep", "link": "https://stackoverflow.com/users/160149/jonydep"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 915, "favorite_count": 2, "accepted_answer_id": 47180097, "answer_count": 2, "score": 3, "last_activity_date": 1588771772, "creation_date": 1510144520, "last_edit_date": 1510149537, "question_id": 47179890, "link": "https://stackoverflow.com/questions/47179890/too-many-open-files-in-mgo-go-server", "title": "too many open files in mgo go server", "body": "<p>I'm getting these errors in the logs:</p>\n\n<blockquote>\n  <p>Accept error: accept tcp [::]:80: accept4: too many open files;</p>\n</blockquote>\n\n<p>for a mongodb server on ubuntu, written in go using mgo. They start appearing after it's been running for about a day. </p>\n\n<p>code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"io\"\n    \"net/http\"\n\n    \"gopkg.in/mgo.v2/bson\"\n)\n\nvar (\n    Database *mgo.Database\n)\n\nfunc hello(w http.ResponseWriter, r *http.Request) {\n    io.WriteString(w, \"hello\")\n}\n\nfunc setTile(w http.ResponseWriter, r *http.Request) {\n    var requestJSON map[string]interface{}\n    err := json.NewDecoder(r.Body).Decode(&amp;requestJSON)\n    if err != nil {\n        http.Error(w, err.Error(), 400)\n        return\n    }\n\n    collection := Database.C(\"tiles\")\n\n    if requestJSON[\"tileId\"] != nil {\n        query := bson.M{\"tileId\": requestJSON[\"tileId\"]}\n        collection.RemoveAll(query)\n        collection.Insert(requestJSON)\n\n        w.WriteHeader(200)\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        js, _ := json.Marshal(map[string]string{\"result\": \"ok\"})\n        w.Write(js)\n    } else {\n        w.WriteHeader(200)\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        w.Write(js)\n    }\n}\n\nfunc getTile(w http.ResponseWriter, r *http.Request) {\n    var requestJSON map[string]interface{}\n    err := json.NewDecoder(r.Body).Decode(&amp;requestJSON)\n    if err != nil {\n        http.Error(w, err.Error(), 400)\n        return\n    }\n\n    collection := Database.C(\"tiles\")\n\n    var result []map[string]interface{}\n\n    if requestJSON[\"tileId\"] != nil {\n        query := bson.M{\"tileId\": requestJSON[\"tileId\"]}\n        collection.Find(query).All(&amp;result)\n    }\n\n    if len(result) &gt; 0 {\n        w.WriteHeader(200)\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        js, _ := json.Marshal(result[0])\n        w.Write(js)\n    } else {\n        w.WriteHeader(200)\n        w.Header().Set(\"Content-Type\", \"application/json\")\n        js, _ := json.Marshal(map[string]string{\"result\": \"tile id not found\"})\n        w.Write(js)\n    }\n}\n\nfunc main() {\n    session, _ := mgo.Dial(\"localhost\")\n    Database = session.DB(\"mapdb\")\n\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/\", hello)\n    mux.HandleFunc(\"/setTile\", setTile)\n    mux.HandleFunc(\"/getTile\", getTile)\n    http.ListenAndServe(\":80\", mux)\n}\n</code></pre>\n\n<p>Is there something in there that needs closing? Or is it structured wrong in some way?</p>\n\n<p>There seems to be lots of places to set the open file limits, so i'm not sure how to find out what the limits actually are. But it seems like increasing the limit isn't the problem anyway, surely something is being opened on every request and not closed.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 19, "last_activity_date": 1543078511, "last_edit_date": 1543078511, "creation_date": 1510143190, "answer_id": 47179455, "question_id": 47179024, "link": "https://stackoverflow.com/questions/47179024/how-to-check-if-a-request-was-cancelled/47179455#47179455", "title": "How to check if a request was cancelled", "body": "<p>You can check the context's error:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n)\n\nfunc main() {    \n    ctx, cancel := context.WithCancel(context.Background())\n    fmt.Println(ctx.Err())\n    cancel()\n    fmt.Println(ctx.Err())\n}\n</code></pre>\n\n<p>Prints</p>\n\n<pre><code>&lt;nil&gt;\ncontext canceled\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2217, "user_id": 2604708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b62fe48f9c75ebe5e3868f9d428c125?s=128&d=identicon&r=PG", "display_name": "Dirbaio", "link": "https://stackoverflow.com/users/2604708/dirbaio"}, "is_accepted": true, "score": 15, "last_activity_date": 1578516702, "last_edit_date": 1578516702, "creation_date": 1571136646, "answer_id": 58392933, "question_id": 47179024, "link": "https://stackoverflow.com/questions/47179024/how-to-check-if-a-request-was-cancelled/58392933#58392933", "title": "How to check if a request was cancelled", "body": "<p>The cleanest way to do this in Go 1.13+ is using the new <a href=\"https://golang.org/pkg/errors/#Is\" rel=\"noreferrer\"><code>errors.Is</code></a> function.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Create a context that is already canceled\nctx, cancel := context.WithCancel(context.Background())\ncancel()\n\n// Create the request with it\nr, _ := http.NewRequestWithContext(ctx, \"GET\", \"http://example.com\", nil)\n\n// Do it, it will immediately fail because the context is canceled.\n_, err := http.DefaultClient.Do(r)\nlog.Println(err) // Get http://example.com: context canceled\n\n// This prints false, because the http client wraps the context.Canceled\n// error into another one with extra information.\nlog.Println(err == context.Canceled)\n\n// This prints true, because errors.Is checks all the errors in the wrap chain,\n// and returns true if any of them matches.\nlog.Println(errors.Is(err, context.Canceled))\n</code></pre>\n"}], "owner": {"reputation": 1364, "user_id": 4193473, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/809c47adff3412cabfe219351122672d?s=128&d=identicon&r=PG&f=1", "display_name": "hgl", "link": "https://stackoverflow.com/users/4193473/hgl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12851, "favorite_count": 1, "accepted_answer_id": 58392933, "answer_count": 2, "score": 10, "last_activity_date": 1578516702, "creation_date": 1510141975, "last_edit_date": 1510150575, "question_id": 47179024, "link": "https://stackoverflow.com/questions/47179024/how-to-check-if-a-request-was-cancelled", "title": "How to check if a request was cancelled", "body": "<p>I have this simple code in which I try to check if the request was cancelled. But surprisingly, it prints <code>false</code> instead of <code>true</code> in go 1.9.</p>\n\n<p>I wonder what's the correct way to check that?</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    r, _ := http.NewRequest(\"GET\", \"http://example.com\", nil)\n    ctx, cancel := context.WithCancel(context.Background())\n    r = r.WithContext(ctx)\n    ch := make(chan bool)\n    go func() {\n        _, err := http.DefaultClient.Do(r)\n        log.Println(err == context.Canceled)\n        ch &lt;- true\n    }()\n    cancel()\n    &lt;-ch\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1510146165, "last_edit_date": 1510146165, "creation_date": 1510141872, "answer_id": 47178994, "question_id": 47178816, "link": "https://stackoverflow.com/questions/47178816/how-to-use-a-derived-type-for-sync-map/47178994#47178994", "title": "how to use a derived type for sync.Map", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">Struct types</a></p>\n  \n  <p>A struct is a sequence of named elements, called fields, each of\n  which has a name and a type. Field names may be specified explicitly\n  (IdentifierList) or implicitly (EmbeddedField). Within a struct,\n  non-blank field names must be unique.</p>\n\n<pre><code>StructType    = \"struct\" \"{\" { FieldDecl \";\" } \"}\" .\nFieldDecl     = (IdentifierList Type | EmbeddedField) [ Tag ] .\nEmbeddedField = [ \"*\" ] TypeName .\nTag           = string_lit .\n</code></pre>\n  \n  <p>A field declared with a type but no explicit field name is called an\n  embedded field. An embedded field must be specified as a type name T\n  or as a pointer to a non-interface type name *T, and T itself may not\n  be a pointer type. The unqualified type name acts as the field name.</p>\n  \n  <p>A field or method f of an embedded field in a struct x is called\n  promoted if x.f is a legal selector that denotes that field or method\n  f.</p>\n  \n  <p>Promoted fields act like ordinary fields of a struct except that they\n  cannot be used as field names in composite literals of the struct.</p>\n  \n  <p>Given a struct type S and a type named T, promoted methods are\n  included in the method set of the struct as follows:</p>\n  \n  <ul>\n  <li><p>If S contains an embedded field T, the method sets of S and *S both include promoted methods with receiver T. The method set of *S\n  also includes promoted methods with receiver *T.</p></li>\n  <li><p>If S contains an embedded field *T, the method sets of S and *S both include promoted methods with receiver T or *T.</p></li>\n  </ul>\n</blockquote>\n\n<hr>\n\n<p>Use an embedded field of a <code>struct</code>. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype myMap struct {\n    sync.Map\n}\n\nfunc (m *myMap) Add(key, value interface{}) bool {\n    _, loaded := m.LoadOrStore(key, value)\n    return !loaded\n}\n\nfunc main() {\n    x := &amp;myMap{}\n    k := \"test\"\n    ok := x.Add(k, 42)\n    fmt.Println(ok)\n    v, ok := x.Load(k)\n    fmt.Println(k, v, ok)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/YCNeiYVhlT\" rel=\"nofollow noreferrer\">https://play.golang.org/p/YCNeiYVhlT</a></p>\n\n<p>Output:</p>\n\n<pre><code>true\ntest 42 true\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Selectors\" rel=\"nofollow noreferrer\">Selectors</a></p>\n  \n  <p>For a primary expression x that is not a package name, the selector\n  expression</p>\n\n<pre><code>x.f\n</code></pre>\n  \n  <p>denotes the field or method f of the value x (or sometimes *x; see\n  below). The identifier f is called the (field or method) selector; it\n  must not be the blank identifier. The type of the selector expression\n  is the type of f. If x is a package name, see the section on qualified\n  identifiers.</p>\n  \n  <p>A selector f may denote a field or method f of a type T, or it may\n  refer to a field or method f of a nested embedded field of T. The\n  number of embedded fields traversed to reach f is called its depth in\n  T. The depth of a field or method f declared in T is zero. The depth\n  of a field or method f declared in an embedded field A in T is the\n  depth of f in A plus one.</p>\n  \n  <p>Rule 1:</p>\n  \n  <p>For a value x of type T or *T where T is not a pointer or interface\n  type, x.f denotes the field or method at the shallowest depth in T\n  where there is such an f. If there is not exactly one f with\n  shallowest depth, the selector expression is illegal.</p>\n</blockquote>\n\n<hr>\n\n<p>Sometimes, there is ambiguity in complex cases of nested embedding. If so, specify the full qualifiers explicitly. For example, <code>m.Map.LoadOrStore</code> and <code>x.Map.Load</code>.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype myMap struct {\n    sync.Map\n}\n\nfunc (m *myMap) Add(key, value interface{}) bool {\n    _, loaded := m.Map.LoadOrStore(key, value)\n    return !loaded\n}\n\nfunc main() {\n    x := &amp;myMap{}\n    k := \"test\"\n    ok := x.Add(k, 42)\n    fmt.Println(ok)\n    v, ok := x.Map.Load(k)\n    fmt.Println(k, v, ok)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": false, "score": 3, "last_activity_date": 1510143688, "creation_date": 1510143688, "answer_id": 47179635, "question_id": 47178816, "link": "https://stackoverflow.com/questions/47178816/how-to-use-a-derived-type-for-sync-map/47179635#47179635", "title": "how to use a derived type for sync.Map", "body": "<p>The line: <code>type myMap sync.Map</code> defines a new type based on an existing type.</p>\n\n<p>According to the <a href=\"https://golang.org/ref/spec#Type_declarations\" rel=\"nofollow noreferrer\">Language Specification</a>:</p>\n\n<blockquote>\n  <p>A defined type may have methods associated with it. It does not\n  inherit any methods bound to the given type</p>\n</blockquote>\n\n<p>It means, that <code>myMap</code> only inherits the fields of <code>sync.Map</code> (which is a <code>struct</code>) but not it's methods. It doesn't work like class inheritance in other languages.</p>\n\n<p>Specifically, <code>sync.Map</code> does not have any exported fields, so using it to define a new type is pointless. \nInstead you should define a <code>struct</code> type that contains <code>sync.Map</code> as a field. Then you'll have access to it's methods. @peterSO's answer shows how to do that.</p>\n"}], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3097, "favorite_count": 1, "accepted_answer_id": 47178994, "answer_count": 2, "score": -1, "last_activity_date": 1510146165, "creation_date": 1510141334, "question_id": 47178816, "link": "https://stackoverflow.com/questions/47178816/how-to-use-a-derived-type-for-sync-map", "title": "how to use a derived type for sync.Map", "body": "<p>My goal is to have a custom type the one I could derive and add extra methods, for example, when using a <a href=\"https://golang.org/ref/spec#Map_types\" rel=\"nofollow noreferrer\">map</a> this works:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype myMap map[string]string\n\nfunc (m *myMap) Add() {\n    _, ok := (*m)[\"test\"]\n    println(ok)\n}\n\nfunc main() {\n    x := &amp;myMap{}\n    fmt.Printf(\"x = %+v\\n\", x)\n}\n</code></pre>\n\n<p>But if want the same with <a href=\"https://godoc.org/golang.org/x/sync/syncmap\" rel=\"nofollow noreferrer\">sync.Map</a> how to do it? I am currently trying this: <a href=\"https://play.golang.org/p/8PjpPY-Sjq\" rel=\"nofollow noreferrer\">https://play.golang.org/p/8PjpPY-Sjq</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype myMap sync.Map\n\nfunc (m *myMap) Add() {\n    _, ok := (*m).Load(\"test\")\n    println(ok)\n}\n\nfunc main() {\n    x := &amp;myMap{}\n    fmt.Printf(\"x = %+v\\n\", x)\n}\n</code></pre>\n\n<p>But get this error:</p>\n\n<pre><code>(*m).Load undefined (type myMap has no field or method Load)\n</code></pre>\n\n<p>Any ideas? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 29107, "user_id": 122080, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/6fa1cdda524d49996a8bc6917328de3d?s=128&d=identicon&r=PG", "display_name": "Damien MATHIEU", "link": "https://stackoverflow.com/users/122080/damien-mathieu"}, "edited": false, "score": 1, "creation_date": 1510135114, "post_id": 47176423, "comment_id": 81302213, "body": "You may want to look into writing automated tests instead of manually debugging the app. Then, when making a change, you&#39;ll just have to rerun the tests, which is much less tedious."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8905467"}, "reply_to_user": {"reputation": 29107, "user_id": 122080, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/6fa1cdda524d49996a8bc6917328de3d?s=128&d=identicon&r=PG", "display_name": "Damien MATHIEU", "link": "https://stackoverflow.com/users/122080/damien-mathieu"}, "edited": false, "score": 0, "creation_date": 1510135203, "post_id": 47176423, "comment_id": 81302266, "body": "@DamienMATHIEU, i&#39;m not trying to debug, i&#39;m looking for tool/package to automatically, build and rerun my web app whenever I update my source file."}, {"owner": {"reputation": 29107, "user_id": 122080, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/6fa1cdda524d49996a8bc6917328de3d?s=128&d=identicon&r=PG", "display_name": "Damien MATHIEU", "link": "https://stackoverflow.com/users/122080/damien-mathieu"}, "edited": false, "score": 0, "creation_date": 1510136414, "post_id": 47176423, "comment_id": 81303130, "body": "my point is that with automated tests, you wouldn&#39;t need to build and rerun the app all the time. You&#39;d just need to rerun the tests."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1510155836, "post_id": 47176461, "comment_id": 81316776, "body": "There are several tools like this. <a href=\"https://github.com/tockins/realize\" rel=\"nofollow noreferrer\">github.com/tockins/realize</a> is another."}], "tags": [], "owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "is_accepted": true, "score": 5, "last_activity_date": 1510136078, "last_edit_date": 1510136078, "creation_date": 1510134766, "answer_id": 47176461, "question_id": 47176423, "link": "https://stackoverflow.com/questions/47176423/golang-web-app-automatically-build-and-run/47176461#47176461", "title": "Golang web app automatically build and run", "body": "<p>There is a very handy tool called <a href=\"https://github.com/pilu/fresh\" rel=\"nofollow noreferrer\">pilu/fresh</a> you might wanna check it out. We are personally using it on our project to automatically rebuild our code.</p>\n\n<p>It's a very nice tool because it allows you to customize the file types to watch, and ignore files inside specified directories.</p>\n\n<p>Hope this is what you're looking for.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8905467"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2212, "favorite_count": 0, "accepted_answer_id": 47176461, "answer_count": 1, "score": 3, "last_activity_date": 1510137192, "creation_date": 1510134666, "last_edit_date": 1510137192, "question_id": 47176423, "link": "https://stackoverflow.com/questions/47176423/golang-web-app-automatically-build-and-run", "title": "Golang web app automatically build and run", "body": "<p>I'm currently developing a simple web application. </p>\n\n<p>But I find it tedious to rebuild my app whenever I update my source files.</p>\n\n<p>Is there any way to automatically build and run my web app whenever i update my source files?</p>\n"}, {"tags": ["dictionary", "go", "key", "go-gorm", "hashable"], "answers": [{"comments": [{"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 2, "creation_date": 1510133817, "post_id": 47175617, "comment_id": 81301325, "body": "Excellent answer! Has Go someway to define own comparing function? Like <code>__hash__</code> in Python? this way I can make them comparable."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 1, "creation_date": 1510133996, "post_id": 47175617, "comment_id": 81301458, "body": "@EugeneLisitsky No it does not. You can&#39;t write custom comparator functions that would automatically be used by the Go runtime."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1510132906, "last_edit_date": 1510132906, "creation_date": 1510132291, "answer_id": 47175617, "question_id": 47175474, "link": "https://stackoverflow.com/questions/47175474/mapgorm-dbstruct-gives-invalid-map-key-type-gorm-db/47175617#47175617", "title": "map[gorm.DB]struct{}{} gives invalid map key type gorm.DB", "body": "<p>You can only use types as keys in a map that are <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"noreferrer\">comparable</a>. <a href=\"https://golang.org/ref/spec#Map_types\" rel=\"noreferrer\">Spec: Map types:</a></p>\n\n<blockquote>\n  <p>The <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"noreferrer\">comparison operators</a> == and != must be fully defined for operands of the key type; thus the key type must not be a function, map, or slice.</p>\n</blockquote>\n\n<p><code>gorm.DB</code> is a struct, and struct values are only comparable if all their fields are comparable:</p>\n\n<blockquote>\n  <p>Struct values are comparable if all their fields are comparable. Two struct values are equal if their corresponding non-<a href=\"https://golang.org/ref/spec#Blank_identifier\" rel=\"noreferrer\">blank</a> fields are equal.</p>\n</blockquote>\n\n<p>But <code>gorm.DB</code> has e.g. a <code>DB.values</code> field which is a map type, and maps are not comparble, and thus <code>gorm.DB</code> values are not comparable either, and so you can't use it as map keys.</p>\n\n<p>If you want to create a set of types, you should use <a href=\"https://golang.org/pkg/reflect/#Type\" rel=\"noreferrer\"><code>reflect.Type</code></a> as the map keys, which you can acquire using <a href=\"https://golang.org/pkg/reflect/#TypeOf\" rel=\"noreferrer\"><code>reflect.TypeOf()</code></a> from a value of that type.</p>\n\n<p>A little trick, if you want a <code>reflect.Type</code> without having to create a value of the type in question, you can start from a pointer value of that type (which may be <code>nil</code>), and use <code>Type.Elem()</code> to get the <code>reflect.Type</code> descriptor of the pointed type.</p>\n\n<p>For example, to get the <code>reflect.Type</code> descriptor of a struct type <code>Point struct{ X, Y int }</code> without actually creating / having a <code>Point</code>:</p>\n\n<pre><code>type Point struct{ X, Y int }\ntpoint := reflect.TypeOf((*Point)(nil)).Elem()\nfmt.Println(tpoint)\n</code></pre>\n\n<p>Which prints <code>main.Point</code>. Try it on the <a href=\"https://play.golang.org/p/Bo-IYcZ8a2\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p>See related questions:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/37916647/how-can-i-prevent-a-type-being-used-as-a-map-key/37919268#37919268\">How can I prevent a type being used as a map key?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/37900696/why-cant-go-slice-be-used-as-keys-in-go-maps-pretty-much-the-same-way-arrays-ca/37901853#37901853\">Why can&#39;t Go slice be used as keys in Go maps pretty much the same way arrays can be used as keys?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/34786552/set-of-structs-in-go/34786725#34786725\">Set of structs in Go</a></p>\n"}], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3897, "favorite_count": 1, "accepted_answer_id": 47175617, "answer_count": 1, "score": 5, "last_activity_date": 1527757262, "creation_date": 1510131872, "last_edit_date": 1527757262, "question_id": 47175474, "link": "https://stackoverflow.com/questions/47175474/mapgorm-dbstruct-gives-invalid-map-key-type-gorm-db", "title": "map[gorm.DB]struct{}{} gives invalid map key type gorm.DB", "body": "<p>I'd like to create a \"set\" of gorm types used in my application. So I'd like to define a <code>map</code> with my types <a href=\"https://github.com/jinzhu/gorm/blob/master/main.go#L13\" rel=\"nofollow noreferrer\"><code>gorm.DB</code></a> as keys and empty <code>structs{}</code> as flags:</p>\n\n<pre><code>var (\n    autoMigrations map[gorm.DB]struct{}\n)\n</code></pre>\n\n<p>But compiler doesn't allow me do this with error: <code>invalid map key type gorm.DB</code>. I can fool it using pointers to <code>gorm.DB</code>s like:</p>\n\n<pre><code>map[*gorm.DB]struct{}\n</code></pre>\n\n<p>But it's not a solution, because I need to make it unique and if my map gets filled like <code>db.AutoMigrate(&amp;Chat{})</code> I can get lots of similar object with different addresses.</p>\n\n<p>Another solution is to make a slice of <code>gorm.DB</code>:</p>\n\n<pre><code>autoMigrations []gorm.DB\n</code></pre>\n\n<p>But I have to filter elements on addition manually, which seems insane a little bit.</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore", "gcp"], "answers": [{"comments": [{"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 1, "creation_date": 1510236311, "post_id": 47175060, "comment_id": 81356138, "body": "@NagarajaSV, if it is working you also can upvote the answer."}, {"owner": {"reputation": 2857, "user_id": 1693158, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/BeQ2W.jpg?s=128&g=1", "display_name": "dustinmoris", "link": "https://stackoverflow.com/users/1693158/dustinmoris"}, "edited": false, "score": 0, "creation_date": 1604068387, "post_id": 47175060, "comment_id": 114242365, "body": "&gt; &quot;It is rare that you need to create a new context with a different namespace, ed.Ctx should already be a context with the right namespace.&quot;  Would you mind to expand on this to a Go newbie like myself? The <code>ctx</code> object I get from the <code>http.Request</code> and how would that already have the correct namespace?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2857, "user_id": 1693158, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/BeQ2W.jpg?s=128&g=1", "display_name": "dustinmoris", "link": "https://stackoverflow.com/users/1693158/dustinmoris"}, "edited": false, "score": 0, "creation_date": 1604069105, "post_id": 47175060, "comment_id": 114242802, "body": "@dustinmoris When this question and answer was written, the context wasn&#39;t <code>context.Context</code>, but an appengine-specific context that did contain the namespace."}, {"owner": {"reputation": 2857, "user_id": 1693158, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/BeQ2W.jpg?s=128&g=1", "display_name": "dustinmoris", "link": "https://stackoverflow.com/users/1693158/dustinmoris"}, "edited": false, "score": 2, "creation_date": 1604069535, "post_id": 47175060, "comment_id": 114243042, "body": "Thanks for clarifying. I Actually found how to set the namespace with the latest Go packages for the Google Firestore in Datastore mode here: <a href=\"https://github.com/googleapis/google-cloud-go/issues/460#issuecomment-266837286\" rel=\"nofollow noreferrer\">github.com/googleapis/google-cloud-go/issues/&hellip;</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1510133578, "last_edit_date": 1510133578, "creation_date": 1510130626, "answer_id": 47175060, "question_id": 47174559, "link": "https://stackoverflow.com/questions/47174559/how-to-query-a-entity-from-datastore-with-namespace-in-golang/47175060#47175060", "title": "How to query a entity from datastore with Namespace In golang?", "body": "<p>The namespace value is not part of the query (it's not a property of the query). The namespace comes from the context which you pass when executing the query, e.g. to <a href=\"https://cloud.google.com/appengine/docs/standard/go/datastore/reference#Query.GetAll\" rel=\"nofollow noreferrer\"><code>Query.GetAll()</code></a>.</p>\n\n<p>If you have a context (you do as you pass it to <code>q.GetAll()</code>), you can create a derivative context with a given namespace using the <a href=\"https://cloud.google.com/appengine/docs/standard/go/reference#Namespace\" rel=\"nofollow noreferrer\"><code>appengine.Namespace()</code></a> function.</p>\n\n<p>For example:</p>\n\n<pre><code>ctx2, err := appengine.Namespace(ed.Ctx, \"mynamespace\")\n// check err\n</code></pre>\n\n<p>And use this new context to pass to <code>Query.GetAll()</code>:</p>\n\n<pre><code>return q.GetAll(ctx2, &amp;expenses)\n</code></pre>\n\n<p>It is rare that you need to create a new context with a different namespace, <code>ed.Ctx</code> should already be a context with the right namespace. So when / where you create <code>ed.Ctx</code>, you should already apply the namespace there, so you can avoid \"accidental\" exposure of data of other tenants (which is a major security issue).</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6043285"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 615, "favorite_count": 0, "accepted_answer_id": 47175060, "answer_count": 1, "score": 2, "last_activity_date": 1510133578, "creation_date": 1510128710, "question_id": 47174559, "link": "https://stackoverflow.com/questions/47174559/how-to-query-a-entity-from-datastore-with-namespace-in-golang", "title": "How to query a entity from datastore with Namespace In golang?", "body": "<p>I am working on a multi tenant application, I need to query a particular user from a KIND and From Particular Namespace.</p>\n\n<p>I am able to get the values from default Namespace.the package i am using here is <code>\"google.golang.org/appengine/datastore\"</code></p>\n\n<pre><code>q := datastore.NewQuery(ENTITYNAME).Filter(\"Name =\", ed.Expense.Name)\n    var expenses []ExpenseEntiry\n    return q.GetAll(ed.Ctx, &amp;expenses)\n</code></pre>\n"}, {"tags": ["maven", "go", "build", "command"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1510130056, "post_id": 47173361, "comment_id": 81298928, "body": "What OS? Did you try passing <i>full path</i> of the specific location to the <code>exec.Command</code> argument, e.g. <code>your&#47;specific&#47;folder&#47;mvn</code>? Please provides your code snippets for executing the command, then if there is error, show us the error message."}, {"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 0, "creation_date": 1510141452, "post_id": 47173361, "comment_id": 81306599, "body": "Are you assuming that <code>maven</code> is already installed on the target machine or do you bundle the <code>maven</code> distribution with your software?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1510145168, "post_id": 47173361, "comment_id": 81309010, "body": "See also <a href=\"https://golang.org/pkg/os/#ExpandEnv\" rel=\"nofollow noreferrer\">os.ExpandEnv</a>."}], "answers": [{"tags": [], "owner": {"reputation": 2855, "user_id": 5105305, "user_type": "registered", "accept_rate": 58, "profile_image": "https://lh4.googleusercontent.com/-i8lMihc1yYc/AAAAAAAAAAI/AAAAAAAAAJE/ooPD4M12q8I/photo.jpg?sz=128", "display_name": "Kasun Siyambalapitiya", "link": "https://stackoverflow.com/users/5105305/kasun-siyambalapitiya"}, "is_accepted": true, "score": 0, "last_activity_date": 1510299225, "creation_date": 1510299225, "answer_id": 47217775, "question_id": 47173361, "link": "https://stackoverflow.com/questions/47173361/how-to-run-a-maven-build-from-go-lang-code/47217775#47217775", "title": "How to run a maven build from go lang code", "body": "<p>As with the comment by @putu and with specifying the required <code>maven</code> goals one by one as separate arguments to the <code>exe.Command()</code> I was able to run <code>maven</code> build without installing <code>maven</code> or setting <code>M2_HOME</code> in <code>$PATH</code> variable. Below is the code snippet for anyone trying to achieve the same.</p>\n\n<pre><code>// Use os package to run the maven build using location where maven(headless) resides\nfunc updateDistribution() error {\n    command := exec.Command(\"apache-maven-3.5.2/bin/mvn\", \"clean\", \"install\")\n    command.Dir = \".\"\n    output, err := command.Output()\n    if err != nil {\n        return err\n    }\n    fmt.Printf(\"%s\", output)\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 2855, "user_id": 5105305, "user_type": "registered", "accept_rate": 58, "profile_image": "https://lh4.googleusercontent.com/-i8lMihc1yYc/AAAAAAAAAAI/AAAAAAAAAJE/ooPD4M12q8I/photo.jpg?sz=128", "display_name": "Kasun Siyambalapitiya", "link": "https://stackoverflow.com/users/5105305/kasun-siyambalapitiya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 549, "favorite_count": 0, "accepted_answer_id": 47217775, "answer_count": 1, "score": 0, "last_activity_date": 1510299225, "creation_date": 1510124092, "question_id": 47173361, "link": "https://stackoverflow.com/questions/47173361/how-to-run-a-maven-build-from-go-lang-code", "title": "How to run a maven build from go lang code", "body": "<p>I am having the requirement of running a <code>maven</code> built using <code>go lang</code> without  installing <code>maven</code> to the running system. With the use of <code>os.exec</code> package in <code>go</code> I am able to run any program which is already defined in my <code>PATH</code> variable. But setting <code>M2_HOME</code> in <code>PATH</code> variable is not an option here and I am having the <code>maven</code> distribution extracted in specific location. According to the answer given in <a href=\"https://stackoverflow.com/questions/44457619/can-i-use-maven-without-setting-the-environment-variable\">here</a> it is possible to run a <code>maven</code> build by providing the specific location of <code>mvn</code>, how do I achieve the same from <code>go</code>.<br>\nThanks in advance</p>\n"}, {"tags": ["file", "go"], "comments": [{"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 2, "creation_date": 1510115124, "post_id": 47171514, "comment_id": 81292706, "body": "Can you provide me with the source of a makefile using <code>.&#47;...</code>?"}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1510115675, "post_id": 47171514, "comment_id": 81292868, "body": "Makefiles <i>are not bash</i> -- different language, different syntax, different tagging."}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1354, "user_id": 6412942, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c8302ba86cf28126f773c6f40573c175?s=128&d=identicon&r=PG&f=1", "display_name": "leopoodle", "link": "https://stackoverflow.com/users/6412942/leopoodle"}, "edited": false, "score": 0, "creation_date": 1510150495, "post_id": 47171730, "comment_id": 81312727, "body": "@SteveHe, I&#39;d stress that the <code>go build</code> and <code>go install</code> (and <code>go test</code>) invocations work on <i>go packages</i> rather than files (as opposed to <code>go run</code>). So the special construct <code>{path}&#47;...</code> means &quot;all the packages anchored as <code>{path}</code>, and that <code>{path}</code> is an <i>import path in a Go workspace.</i> The fact this spec makes the <code>go</code> tool traverse the hierarchy of directories is an implementation detail."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 8, "last_activity_date": 1510117002, "last_edit_date": 1592644375, "creation_date": 1510116207, "answer_id": 47171730, "question_id": 47171514, "link": "https://stackoverflow.com/questions/47171514/does-mean-all-subfolders/47171730#47171730", "title": "Does &quot;./...&quot; mean all subfolders?", "body": "<p>The import path pattern <code>./...</code> matches all packages in directories below the current directory, except those in vendor directories.</p>\n<p>The pattern is implemented by the <code>go</code> tool. The pattern is not interpreted by make, bash and any other tool that might invoke the <code>go</code> tool.</p>\n<p>The <a href=\"https://golang.org/cmd/go/#hdr-Description_of_package_lists\" rel=\"noreferrer\">documentation for the go command says</a>:</p>\n<blockquote>\n<p>An import path is a pattern if it includes one or more &quot;...&quot; wildcards, each of which can match any string, including the empty string and strings containing slashes. Such a pattern expands to all package directories found in the GOPATH trees with names matching the patterns.</p>\n<p>To make common patterns more convenient, there are two special cases. First, /... at the end of the pattern can match an empty string, so that net/... matches both net and packages in its subdirectories, like net/http. Second, any slash-separated pattern element containing a wildcard never participates in a match of the &quot;vendor&quot; element in the path of a vendored package, so that ./... does not match packages in subdirectories of ./vendor or ./mycode/vendor, but ./vendor/... and ./mycode/vendor/... do. Note, however, that a directory named vendor that itself contains code is not a vendored package: cmd/vendor would be a command named vendor, and the pattern cmd/... matches it. See golang.org/s/go15vendor for more about vendoring.</p>\n</blockquote>\n<p>and it <a href=\"https://golang.org/cmd/go/#hdr-Relative_import_paths_\" rel=\"noreferrer\">also says</a>:</p>\n<blockquote>\n<p>An import path beginning with ./ or ../ is called a relative path. The toolchain supports relative import paths as a shortcut in two ways.</p>\n<p>First, a relative path can be used as a shorthand on the command line. If you are working in the directory containing the code imported as &quot;unicode&quot; and want to run the tests for &quot;unicode/utf8&quot;, you can type &quot;go test ./utf8&quot; instead of needing to specify the full path. Similarly, in the reverse situation, &quot;go test ..&quot; will test &quot;unicode&quot; from the &quot;unicode/utf8&quot; directory. Relative patterns are also allowed, like &quot;go test ./...&quot; to test all subdirectories. See 'go help packages' for details on the pattern syntax.</p>\n<p>Second, if you are compiling a Go program not in a work space, you can use a relative path in an import statement in that program to refer to nearby code also not in a work space. This makes it easy to experiment with small multipackage programs outside of the usual work spaces, but such programs cannot be installed with &quot;go install&quot; (there is no work space in which to install them), so they are rebuilt from scratch each time they are built. To avoid ambiguity, Go programs cannot use relative import paths within a work space.</p>\n</blockquote>\n"}], "owner": {"reputation": 1354, "user_id": 6412942, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c8302ba86cf28126f773c6f40573c175?s=128&d=identicon&r=PG&f=1", "display_name": "leopoodle", "link": "https://stackoverflow.com/users/6412942/leopoodle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1510117002, "creation_date": 1510114693, "last_edit_date": 1510115908, "question_id": 47171514, "link": "https://stackoverflow.com/questions/47171514/does-mean-all-subfolders", "title": "Does &quot;./...&quot; mean all subfolders?", "body": "<p>I often see \"./...\" in makefile. I <em>think</em> it means it is all subfolders in the current directory. Could someone confirm and provide me the source where this syntax is explained?</p>\n\n<p>Example:</p>\n\n<pre><code>go generate ./...\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 2, "creation_date": 1510113880, "post_id": 47171341, "comment_id": 81292354, "body": "If you are doing <code>go run instance.go</code> the issue is that you can&#39;t run go files that are not in the main package. <code>webrun</code> is a package or library not an executable."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8408440"}, "reply_to_user": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1510114168, "post_id": 47171341, "comment_id": 81292441, "body": "I have it within a series of other files, what would I run? Here are a few of the files: ` app.yaml      dns.go   instance README.md   templates  util CONTRIBUTORS  LICENSE  instance.go  connectsk statkeeper  tmpimg`"}, {"owner": {"reputation": 6247, "user_id": 1307186, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/387ed5b468ef3d8d0d668ea772a4d043?s=128&d=identicon&r=PG", "display_name": "darethas", "link": "https://stackoverflow.com/users/1307186/darethas"}, "edited": false, "score": 0, "creation_date": 1510114181, "post_id": 47171341, "comment_id": 81292446, "body": "Could you add more information: more of the file, how you are trying to &quot;run this go file&quot; specifically, what commands you tried. Where is this package located on your filesystem?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8408440"}, "edited": false, "score": 0, "creation_date": 1510114436, "post_id": 47171341, "comment_id": 81292506, "body": "I&#39;m currently in the directory of /root/go/src/----------------/--------/instance - edited of course. That also contains the rest of the packages&#39; files. I&#39;ve tried running the file as if SH using ./instance , but that didn&#39;t work so I changed to ./instance.go . How do I run it?"}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1510114544, "post_id": 47171341, "comment_id": 81292531, "body": "You should have a file with <code>package main</code> that has a ` func main() {...` that function should be the start of your program, and that&#39;s the file you should <code>go run</code>. In that file you can import <code>dns.go</code> and any other <code>.go</code> file that you have."}, {"owner": {"reputation": 6990, "user_id": 329289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1536aecadab8356ff5e2d59da6c591?s=128&d=identicon&r=PG", "display_name": "Owen S.", "link": "https://stackoverflow.com/users/329289/owen-s"}, "edited": false, "score": 0, "creation_date": 1510164905, "post_id": 47171341, "comment_id": 81322817, "body": "Curious, though: what do you expect <code>instance.go</code> to run first, assuming you were able to run it as a program? Does it have a <code>main</code> already set up for you?"}, {"owner": {"reputation": 2251, "user_id": 1706188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39a7bfc74d6cbefae63b49d0b51e32ca?s=128&d=identicon&r=PG", "display_name": "user18853", "link": "https://stackoverflow.com/users/1706188/user18853"}, "edited": false, "score": 0, "creation_date": 1531366054, "post_id": 47171341, "comment_id": 89571072, "body": "Though this is a stupid question as hell. It reduced my time to detect the actual issue :P"}], "answers": [{"tags": [], "owner": {"reputation": 19682, "user_id": 790070, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/8SPP4.jpg?s=128&g=1", "display_name": "Timothy Jones", "link": "https://stackoverflow.com/users/790070/timothy-jones"}, "is_accepted": true, "score": 4, "last_activity_date": 1510115367, "creation_date": 1510115367, "answer_id": 47171617, "question_id": 47171341, "link": "https://stackoverflow.com/questions/47171341/golang-error-package-command-not-found/47171617#47171617", "title": "Golang Error : Package command not found", "body": "<p>These are not Go errors.</p>\n\n<p>However, I was able to reproduce your errors by trying to execute a go source file:</p>\n\n<pre><code>$ chmod +x in.go\n$ ./in.go\n./in.go: line 1: package: command not found\n./in.go: line 3: syntax error near unexpected token `newline'\n./in.go: line 3: `import ('\n</code></pre>\n\n<p>You can't do this with Go, since it is not interpreted. You need to compile your code to an executable before you can run it.</p>\n\n<p>You can read the help for how to <a href=\"https://golang.org/cmd/go/#hdr-Compile_and_run_Go_program\" rel=\"nofollow noreferrer\">compile and run a go program here</a>.</p>\n\n<p>In your case, </p>\n\n<pre><code>go run instance.go\n</code></pre>\n\n<p>will try to compile and run the source file you're executing, but as another commenter points out, code that is not in the <code>main</code> package is not designed to be executed directly. </p>\n\n<p>If this is your code, you need to write it inside <code>package main</code>, and if it is not, then you're probably trying to execute a library (which means it's not clear to me what you're trying to do).</p>\n"}, {"comments": [{"owner": {"reputation": 6990, "user_id": 329289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea1536aecadab8356ff5e2d59da6c591?s=128&d=identicon&r=PG", "display_name": "Owen S.", "link": "https://stackoverflow.com/users/329289/owen-s"}, "edited": false, "score": 3, "creation_date": 1510164817, "post_id": 47171872, "comment_id": 81322742, "body": "Note that <code>.&#47;</code> is not a syntax to run programs, as your explanation seems to imply \u2013 it&#39;s just a path prefix. Any program that can be located by the shell \u2013 <code>&#47;path&#47;to&#47;program</code>, or just <code>program</code> if the program happens to live in a directory on your <code>PATH</code> \u2013 can be run by simply making it the first word of a shell command. <code>.&#47;program</code> works instead of <code>program</code> because, unless you installed the program somewhere where the shell knows to look for it, the shell needs to be told exactly where it is. The current directory is not a place where the shell looks for programs by default."}], "tags": [], "owner": {"reputation": 2064, "user_id": 1927543, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ad92404d9739ea60c7c90e1a7d0c6742?s=128&d=identicon&r=PG", "display_name": "Karthikeyan", "link": "https://stackoverflow.com/users/1927543/karthikeyan"}, "is_accepted": false, "score": 0, "last_activity_date": 1510117042, "creation_date": 1510117042, "answer_id": 47171872, "question_id": 47171341, "link": "https://stackoverflow.com/questions/47171341/golang-error-package-command-not-found/47171872#47171872", "title": "Golang Error : Package command not found", "body": "<p>You can only ./ files which are runnable. Your go file is not runnable. You need to compile it to binary and do ./(dotslash) on it. </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8408440"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4514, "favorite_count": 0, "accepted_answer_id": 47171617, "answer_count": 2, "score": 0, "last_activity_date": 1510117042, "creation_date": 1510113576, "question_id": 47171341, "link": "https://stackoverflow.com/questions/47171341/golang-error-package-command-not-found", "title": "Golang Error : Package command not found", "body": "<p>I'm getting this error when running a .go file.</p>\n\n<pre><code>./instance.go: line 1: package: command not found\n./instance.go: line 3: syntax error near unexpected token `newline'\n./instance.go: line 3: `import ('\n</code></pre>\n\n<p>So far I've seen that the error normally means that GOPATH is not set, however, <code>echo \"$GOPATH\"</code> outputs <code>/root/go</code> and my path is currently <code>/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin:/usr/local/go/bin:/root/go/bin:/bin:/root/go/bin</code> .</p>\n\n<p>Here's the first few lines of instance.go:</p>\n\n<pre><code>package webrun\n\nimport (\n        \"context\"\n        \"crypto/hmac\"\n        \"crypto/rand\"\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 2343, "user_id": 4033050, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/8617552b81048f6c4b67c9ec04f413b1?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/4033050/seb"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1510096877, "post_id": 47168807, "comment_id": 81287980, "body": "@CeriseLim&#243;n thanks. Are you not using PastDayWeather ? and also forecast.Daily is a (type *Datablock). Is there a way to cast to a JSON or PastDayWeather? Sorry I am newby  to golang"}, {"owner": {"reputation": 2343, "user_id": 4033050, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/8617552b81048f6c4b67c9ec04f413b1?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/4033050/seb"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1510099432, "post_id": 47168807, "comment_id": 81288683, "body": "@CeriseLim&#243;n added the return type for forecast.Daily"}, {"owner": {"reputation": 3581, "user_id": 182699, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/78d29efe4ce872b2ebe6dd03f4d819c8?s=128&d=identicon&r=PG", "display_name": "nicky", "link": "https://stackoverflow.com/users/182699/nicky"}, "edited": false, "score": 0, "creation_date": 1510116154, "post_id": 47168807, "comment_id": 81292998, "body": "what is the structure of forecast.Daily, you need to use json Unmarshal"}], "answers": [{"comments": [{"owner": {"reputation": 2343, "user_id": 4033050, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/8617552b81048f6c4b67c9ec04f413b1?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/4033050/seb"}, "edited": false, "score": 0, "creation_date": 1510156012, "post_id": 47181985, "comment_id": 81316905, "body": "you are right, the only things is that I have to build the jsonTest. What I have  a method called &#39;weather&#39; let&#39;s say and I get the information from weather by doing weather.temperature."}, {"owner": {"reputation": 2343, "user_id": 4033050, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/8617552b81048f6c4b67c9ec04f413b1?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/4033050/seb"}, "edited": false, "score": 0, "creation_date": 1510156046, "post_id": 47181985, "comment_id": 81316931, "body": "I have to fill the jsonTest field value using the weather method"}], "tags": [], "owner": {"reputation": 98, "user_id": 8862808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41b7e30f64c8992897bd2668a35ede46?s=128&d=identicon&r=PG&f=1", "display_name": "lucas alcantara", "link": "https://stackoverflow.com/users/8862808/lucas-alcantara"}, "is_accepted": false, "score": 1, "last_activity_date": 1510150507, "creation_date": 1510150507, "answer_id": 47181985, "question_id": 47168807, "link": "https://stackoverflow.com/questions/47168807/create-a-json-array-and-json-object/47181985#47181985", "title": "Create a JSON array and JSON object", "body": "<p>if I understood right the code below can help you.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype PastWeekWeatherArray struct {\n    PastWeekWeather []PastDayWeather `json:\"pastWeekWeather\"`\n}\n\ntype PastDayWeather struct {\n    DayWeather string `json:\"dayWeather\"`\n}\n\nvar (\n    jsonTest = `{\n        \"pastWeekWeather\": [\n            {\"dayWeather\":\"10\"},\n            {\"dayWeather\":\"15\"}\n        ]   \n    }`\n)\n\nfunc main() {\n    array := PastWeekWeatherArray{make([]PastDayWeather, 0)}\n    err := json.Unmarshal([]byte(jsonTest), &amp;array)\n\n    fmt.Println(\"Error: \", err)\n\n    for _, v := range array.PastWeekWeather{\n        fmt.Println(\"Day: \", v.DayWeather)\n    }\n}\n</code></pre>\n\n<p>Pay attention that the tag json like <code>json:\"pastWeekWeather\"</code> needs to have the same name that I put in the variable name in jsonTest. \nAlso you can run the code <a href=\"https://play.golang.org/p/DjtRAVfLJ_\" rel=\"nofollow noreferrer\">here</a></p>\n"}], "owner": {"reputation": 2343, "user_id": 4033050, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/8617552b81048f6c4b67c9ec04f413b1?s=128&d=identicon&r=PG&f=1", "display_name": "Seb", "link": "https://stackoverflow.com/users/4033050/seb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5503, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1610957234, "creation_date": 1510095549, "last_edit_date": 1610957234, "question_id": 47168807, "link": "https://stackoverflow.com/questions/47168807/create-a-json-array-and-json-object", "title": "Create a JSON array and JSON object", "body": "<p>I am developing an app for Go. the app is getting JSON data back from a third party.</p>\n<p>I do not see how to create the json object and append it to a json array. What's happening is that I have a loop and each element received.</p>\n<p>below is the code:</p>\n<pre><code>type PastWeekWeatherArray struct {\n    PastWeekWeather []PastDayWeather `json:&quot;array&quot;`\n}\n\ntype PastDayWeather struct {\n    DayWeather string `json:&quot;day&quot;`\n}\n\nfunc get_weather(ctx context.Context, place string, date string) (string, error){\nvar msg PastWeekWeatherArray\n\nclient := darksky.New(apiKey)\n\nfor j:= 0; j &lt; 7; j++ {\n    forecast, err := client.get_data(j)\n    if(err != nil) {\n        fmt.Println(err.Error())\n        return &quot;&quot;,err\n    }\n    // forecast.Daily\n}\n</code></pre>\n<p>the data is contained in the forecast.Daily. this response need to be stored in 'PastDayWeather', json obect and then append to the PastWeekWeatherArray</p>\n<p><code>forecast.Daily</code> is returning a (type *Datablock), I would like to cast it or make it a JSON and then insert in the JSON Array.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1510092562, "post_id": 47168220, "comment_id": 81286396, "body": "Why not use a map instead of a struct?"}, {"owner": {"reputation": 562, "user_id": 3065652, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0b1e326bd6eb4decfad5266675ec3022?s=128&d=identicon&r=PG&f=1", "display_name": "rickydj", "link": "https://stackoverflow.com/users/3065652/rickydj"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1510093041, "post_id": 47168220, "comment_id": 81286623, "body": "I tried assigning type morekey map[string]struct_for_ip_port and creating another struct that took both &quot;some_url&quot; and &quot;morekey&quot; struct. It does not seem to be working. plus, &quot;morekey&quot; will have to referred via &quot;morekey&quot; rather than substituting &quot;morekey&quot; with the actual key name. That is not desired."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1510093495, "post_id": 47168220, "comment_id": 81286828, "body": "Can you show then an example of what you&#39;re looking for? If you want dynamic keys you need to use a map, so if a map doesn&#39;t suffice I don&#39;t understand what it is you want."}, {"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 1, "creation_date": 1510094133, "post_id": 47168220, "comment_id": 81287073, "body": "Have you tried the type: <code>map[string]map[string]interface{}</code>?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1510094460, "post_id": 47168220, "comment_id": 81287186, "body": "I&#39;m confused by the comment &#39;&quot;morekey&quot; will have to referred via &quot;morekey&quot; rather than substituting &quot;morekey&quot; with the actual key name. That is not desired.&#39; If you don&#39;t know the key until runtime, how will you refer to it using that key at compile time?"}, {"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1510094925, "post_id": 47168220, "comment_id": 81287343, "body": "Here is how to decode into a map: <a href=\"https://play.golang.org/p/yYpjRR-BKa\" rel=\"nofollow noreferrer\">play.golang.org/p/yYpjRR-BKa</a> - if that doesn&#39;t work for you, explain why it doesn&#39;t work and what you are trying to accomplish."}, {"owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "edited": false, "score": 0, "creation_date": 1510095915, "post_id": 47168220, "comment_id": 81287671, "body": "Is it enough to extract the IP and port and ignore the keys or do you actually need the later?"}], "answers": [{"tags": [], "owner": {"reputation": 78, "user_id": 8560592, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-qDkh8xXJ3SA/AAAAAAAAAAI/AAAAAAAAABc/7TINy6lMntQ/photo.jpg?sz=128", "display_name": "Ethan", "link": "https://stackoverflow.com/users/8560592/ethan"}, "is_accepted": false, "score": -3, "last_activity_date": 1510092747, "creation_date": 1510092747, "answer_id": 47168285, "question_id": 47168220, "link": "https://stackoverflow.com/questions/47168220/golang-json-decoding/47168285#47168285", "title": "GoLang JSON decoding", "body": "<p>You could create a struct for the Ip and Port and a separate one for one of the keys.</p>\n\n<pre><code>type data struct{\n    Ip   string\n    port string\n}\n\ntype DynamicKey map[string]data\n</code></pre>\n\n<p>Then once you decode the json and have the dynamic key, let's say for example it is (rando_key) you can do this</p>\n\n<pre><code>fmt.Println(DynamicKey[rando_key].Ip, DynamicKey[rando_key].port) \n</code></pre>\n\n<p>This is off course for only one of the keys but it is possible to repeat the process.</p>\n"}, {"tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": false, "score": 2, "last_activity_date": 1510098404, "last_edit_date": 1510098404, "creation_date": 1510097898, "answer_id": 47169200, "question_id": 47168220, "link": "https://stackoverflow.com/questions/47168220/golang-json-decoding/47169200#47169200", "title": "GoLang JSON decoding", "body": "<p>In Go field names of a struct have to be known at compile time. So, in your case a struct type is not appropriate. Alternatively, you can use a map. </p>\n\n<p>Let's say, that you are only interested in the IP and port values. Then you can ignore the keys of the JSON object altogether.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\nconst data = `{\n    \"out_key\": {\n        \"some_uri\": \"url\",\n        \"more_than_one_key_here\": {\n            \"Ip\": \"127.0.0.1\",\n            \"port\": \"80\"\n        }\n    }\n}`\n\nfunc main() {\n    m := make(map[string]map[string]interface{})\n    err := json.Unmarshal([]byte(data), &amp;m)\n    if err != nil {\n        log.Fatalf(\"failed to parse JSON: %v\", err)\n    }\n\n    for _, value := range m {\n        for _, value := range value {\n            m, ok := value.(map[string]interface{})\n            if ok {\n                fmt.Printf(\"IP: %s\\n\", m[\"Ip\"])\n                fmt.Printf(\"Port: %s\\n\", m[\"port\"])\n            }\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 562, "user_id": 3065652, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/0b1e326bd6eb4decfad5266675ec3022?s=128&d=identicon&r=PG&f=1", "display_name": "rickydj", "link": "https://stackoverflow.com/users/3065652/rickydj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1510098404, "creation_date": 1510092353, "last_edit_date": 1510094260, "question_id": 47168220, "link": "https://stackoverflow.com/questions/47168220/golang-json-decoding", "title": "GoLang JSON decoding", "body": "<p>Please read the question before flagging it.</p>\n\n<pre><code>  {\n      \"out_key\": {\n      \"some_uri\": \"url\",\n      \"more_than_one_key_here\": {\n           \"Ip\": \"127.0.0.1\",\n           \"port\": \"80\",\n       }\n    }\n  }\n</code></pre>\n\n<p><code>out_key</code> is dynamically created. There is no guessing the name of it.\nSimilarly, <code>more_than_one_key_here</code> is also dynamically created. <code>some_uri</code> will remain constant under <code>out_key</code>. In such a scenario, how do I create a struct for decoding the JSON?</p>\n"}, {"tags": ["html", "go", "go-templates"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510091500, "post_id": 47167889, "comment_id": 81285927, "body": "Are you serving the static files? I.e. is there another handler registered besides <code>index</code> which runs e.g. <code>http.FileServer</code>?"}, {"owner": {"reputation": 78, "user_id": 8560592, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-qDkh8xXJ3SA/AAAAAAAAAAI/AAAAAAAAABc/7TINy6lMntQ/photo.jpg?sz=128", "display_name": "Ethan", "link": "https://stackoverflow.com/users/8560592/ethan"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510091770, "post_id": 47167889, "comment_id": 81286063, "body": "No there is not, would I need that if I am using templates?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510091919, "post_id": 47167889, "comment_id": 81286129, "body": "It has nothing to do with templates; if you&#39;re loading the HTML from a server (eg a Go program), then the server also needs to expose any other assets referenced by the HTML (e.g. images etc). When you just load the HTML in the browser directly from disk, the browser loads the assets the same way."}], "answers": [{"tags": [], "owner": {"reputation": 78, "user_id": 8560592, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-qDkh8xXJ3SA/AAAAAAAAAAI/AAAAAAAAABc/7TINy6lMntQ/photo.jpg?sz=128", "display_name": "Ethan", "link": "https://stackoverflow.com/users/8560592/ethan"}, "is_accepted": true, "score": 0, "last_activity_date": 1510092263, "creation_date": 1510092263, "answer_id": 47168202, "question_id": 47167889, "link": "https://stackoverflow.com/questions/47167889/when-serving-html-templates-in-go-it-does-not-load-any-media/47168202#47168202", "title": "When serving .html templates in go, it does not load any media", "body": "<p>Answered by @Adrian in the comments, I simply wasn't loading the media assets via the go server for the html to use.</p>\n\n<pre><code>    http.Handle(\"/media/\",http.StripPrefix(\"/media/\",http.FileServer(http.Dir(\"static/media\"))))\n</code></pre>\n\n<p>Was all I needed</p>\n"}], "owner": {"reputation": 78, "user_id": 8560592, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-qDkh8xXJ3SA/AAAAAAAAAAI/AAAAAAAAABc/7TINy6lMntQ/photo.jpg?sz=128", "display_name": "Ethan", "link": "https://stackoverflow.com/users/8560592/ethan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "accepted_answer_id": 47168202, "answer_count": 1, "score": -2, "last_activity_date": 1510092263, "creation_date": 1510090848, "question_id": 47167889, "link": "https://stackoverflow.com/questions/47167889/when-serving-html-templates-in-go-it-does-not-load-any-media", "title": "When serving .html templates in go, it does not load any media", "body": "<p>I am currently working on a Go web server utilizing the builtin templates. </p>\n\n<p><br>The current issue I am having is that when I run the web server, it is serving the correct files but it does not load any media on the site.(Such as pictures and fonts) When I run the .html file <strong>as it is</strong> all media is loaded so I know it has something to do with my back end. Here is my code :</p>\n\n<pre><code>var templates = template.Must(template.ParseGlob(\"static/*.html\"))\n...\nfunc index(w http.ResponseWriter, r *http.Request) {\n    currentTime := time.Now().Local()\n    toSend := payload{\n        Date:   currentTime.Format(\"01-02-2006\"),\n        Status: \"Active\",\n    }\n    t, err := template.ParseFiles(\"static/index.html\")\n    if err != nil {\n        log.Fatalf(\"Error parsing template: %v\", err)\n    }\n    t.Execute(w, toSend)\n}\n...\n</code></pre>\n\n<p>And here is my file path:</p>\n\n<pre><code>app\n |-main.go\n |-static(contains static files)\n     |-media(contains all media)\n     |-index.html\n</code></pre>\n\n<p>This serves the templates perfectly fine with all the required data yet without any media. All help is appreciated thank you!</p>\n"}, {"tags": ["arrays", "json", "go", "data-structures"], "comments": [{"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 1, "creation_date": 1510084526, "post_id": 47166270, "comment_id": 81282563, "body": "Your JSON is incorrect. Second part of OrderDetails is a value without key, and is not a part of the array"}, {"owner": {"reputation": 11, "user_id": 3136356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d70a8b66418407dfa429fb5fd5507dcd?s=128&d=identicon&r=PG&f=1", "display_name": "user3136356", "link": "https://stackoverflow.com/users/3136356/user3136356"}, "reply_to_user": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1510085131, "post_id": 47166270, "comment_id": 81282868, "body": "updated with key in salesorderdetails structure"}, {"owner": {"reputation": 5268, "user_id": 302164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XucHp.png?s=128&g=1", "display_name": "miltonb", "link": "https://stackoverflow.com/users/302164/miltonb"}, "edited": false, "score": 1, "creation_date": 1510085270, "post_id": 47166270, "comment_id": 81282943, "body": "I would suggest to make use of a JSON validator like: <a href=\"https://jsonlint.com/\" rel=\"nofollow noreferrer\">jsonlint.com</a> or <a href=\"https://www.freeformatter.com/json-validator.html\" rel=\"nofollow noreferrer\">freeformatter.com/json-validator.html</a>.  I am not recommending either, I just grab one when I need it."}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1510085630, "post_id": 47166270, "comment_id": 81283137, "body": "P.S. in Golang please use Tab instead of 4 spaces :)"}, {"owner": {"reputation": 11, "user_id": 3136356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d70a8b66418407dfa429fb5fd5507dcd?s=128&d=identicon&r=PG&f=1", "display_name": "user3136356", "link": "https://stackoverflow.com/users/3136356/user3136356"}, "edited": false, "score": 0, "creation_date": 1510085718, "post_id": 47166270, "comment_id": 81283185, "body": "how can we print OrderDetails, How to loop? for example to display salesid im using fmt.Printf(&quot;%+v\\n &quot;, temp[0].Salesorder.SalesId)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1510087627, "post_id": 47166270, "comment_id": 81284107, "body": "If you don&#39;t know how to use simple loops in Go, I recommend the <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">Go tour</a> to learn the basics of the language."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 3136356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d70a8b66418407dfa429fb5fd5507dcd?s=128&d=identicon&r=PG&f=1", "display_name": "user3136356", "link": "https://stackoverflow.com/users/3136356/user3136356"}, "edited": false, "score": 0, "creation_date": 1510084839, "post_id": 47166422, "comment_id": 81282730, "body": "how can i give in a valid json then?"}, {"owner": {"reputation": 15349, "user_id": 2282538, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0a4fff09f1f0e3360daeabb30c2c06bb?s=128&d=identicon&r=PG", "display_name": "Tyler", "link": "https://stackoverflow.com/users/2282538/tyler"}, "reply_to_user": {"reputation": 11, "user_id": 3136356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d70a8b66418407dfa429fb5fd5507dcd?s=128&d=identicon&r=PG&f=1", "display_name": "user3136356", "link": "https://stackoverflow.com/users/3136356/user3136356"}, "edited": false, "score": 0, "creation_date": 1510086532, "post_id": 47166422, "comment_id": 81283585, "body": "It is really unclear what you are expecting for an output.  Does a single <code>SalesOrder</code> have multiple <code>OrderDetails</code>?"}, {"owner": {"reputation": 11, "user_id": 3136356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d70a8b66418407dfa429fb5fd5507dcd?s=128&d=identicon&r=PG&f=1", "display_name": "user3136356", "link": "https://stackoverflow.com/users/3136356/user3136356"}, "edited": false, "score": 0, "creation_date": 1510086742, "post_id": 47166422, "comment_id": 81283677, "body": "yes exactly, single SalesOrder have multiple OrderDetails"}, {"owner": {"reputation": 15349, "user_id": 2282538, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0a4fff09f1f0e3360daeabb30c2c06bb?s=128&d=identicon&r=PG", "display_name": "Tyler", "link": "https://stackoverflow.com/users/2282538/tyler"}, "reply_to_user": {"reputation": 11, "user_id": 3136356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d70a8b66418407dfa429fb5fd5507dcd?s=128&d=identicon&r=PG&f=1", "display_name": "user3136356", "link": "https://stackoverflow.com/users/3136356/user3136356"}, "edited": false, "score": 0, "creation_date": 1510086792, "post_id": 47166422, "comment_id": 81283701, "body": "I think the other answer addresses that for you"}], "tags": [], "owner": {"reputation": 15349, "user_id": 2282538, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0a4fff09f1f0e3360daeabb30c2c06bb?s=128&d=identicon&r=PG", "display_name": "Tyler", "link": "https://stackoverflow.com/users/2282538/tyler"}, "is_accepted": false, "score": 1, "last_activity_date": 1510084676, "creation_date": 1510084676, "answer_id": 47166422, "question_id": 47166270, "link": "https://stackoverflow.com/questions/47166270/how-to-unmarshal-json-and-fill-into-structures-in-golang/47166422#47166422", "title": "how to unmarshal json and fill into structures in golang", "body": "<p>What you are tying to decode is not valid JSON.  This would be valid:</p>\n\n<pre><code>{\n    \"Salesorder\": {\n        \"sales_id\": \"SOO1\",\n        \"customer_name\": \"CUST1\",\n        \"totalprice\": \"200\"\n    },\n    \"OrderDetails\": {\n        \"sales_id\": \"SOO1\",\n        \"item_name\": \"ITEM1\",\n        \"qty\": \"2\",\n        \"price\": \"100\"\n    }\n}\n</code></pre>\n\n<p>But what you are giving is this:</p>\n\n<pre><code>{\n    \"Salesorder\": {\n        \"sales_id\": \"SOO1\",\n        \"customer_name\": \"CUST1\",\n        \"totalprice\": \"200\"\n    },\n    \"OrderDetails\": {\n        \"sales_id\": \"SOO1\",\n        \"item_name\": \"ITEM1\",\n        \"qty\": \"2\",\n        \"price\": \"100\"\n    },\n    {   // Things become invalid here\n        \"sales_id\": \"SOO2\",\n        \"item_name\": \"ITEM2\",\n        \"qty\": \"3\",\n        \"price\": \"200\"\n    }\n}\n</code></pre>\n\n<p>It looks like you are trying to give a list of objects, in which case you need to wrap those objects in square brackets <code>[]</code> or you will have to give the second <code>OrderDetails</code> object its own key.</p>\n"}, {"comments": [{"owner": {"reputation": 11, "user_id": 3136356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d70a8b66418407dfa429fb5fd5507dcd?s=128&d=identicon&r=PG&f=1", "display_name": "user3136356", "link": "https://stackoverflow.com/users/3136356/user3136356"}, "edited": false, "score": 0, "creation_date": 1510085295, "post_id": 47166539, "comment_id": 81282954, "body": "how to print all the items in the structure"}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "reply_to_user": {"reputation": 11, "user_id": 3136356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d70a8b66418407dfa429fb5fd5507dcd?s=128&d=identicon&r=PG&f=1", "display_name": "user3136356", "link": "https://stackoverflow.com/users/3136356/user3136356"}, "edited": false, "score": 0, "creation_date": 1510085376, "post_id": 47166539, "comment_id": 81283017, "body": "what items? You have only 2 main keys: Salesorder and OrderDetails. Second one is an array"}, {"owner": {"reputation": 11, "user_id": 3136356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d70a8b66418407dfa429fb5fd5507dcd?s=128&d=identicon&r=PG&f=1", "display_name": "user3136356", "link": "https://stackoverflow.com/users/3136356/user3136356"}, "edited": false, "score": 0, "creation_date": 1510085491, "post_id": 47166539, "comment_id": 81283072, "body": "how can we print OrderDetails, How to loop? for example to display salesid im using fmt.Printf(&quot;%+v\\n &quot;, temp[0].Salesorder.SalesId)"}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "reply_to_user": {"reputation": 11, "user_id": 3136356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d70a8b66418407dfa429fb5fd5507dcd?s=128&d=identicon&r=PG&f=1", "display_name": "user3136356", "link": "https://stackoverflow.com/users/3136356/user3136356"}, "edited": false, "score": 0, "creation_date": 1510086286, "post_id": 47166539, "comment_id": 81283469, "body": "I&#39;ve updated my code, run the new one. I print a customer(s) and order&#39;s ItemName with Price"}], "tags": [], "owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "is_accepted": true, "score": 0, "last_activity_date": 1510086185, "last_edit_date": 1510086185, "creation_date": 1510085068, "answer_id": 47166539, "question_id": 47166270, "link": "https://stackoverflow.com/questions/47166270/how-to-unmarshal-json-and-fill-into-structures-in-golang/47166539#47166539", "title": "how to unmarshal json and fill into structures in golang", "body": "<p>Try this:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Order struct {\n    SalesId     string `json:\"sales_id\"`\n    Customer    string `json:\"customer_name\"`\n    TotalPrice  string `json:\"totalprice\"`\n}\n\ntype OrderDetails struct {\n    SalesId   string `json:\"sales_id\"`\n    ItemName  string `json:\"item_name\"`\n    Qty       string `json:\"qty\"`\n    Price     string `json:\"price\"`\n}\n\ntype Temp struct {\n    Salesorder Order                  `json:\"Salesorder\"`\n    Salesorderdetails []OrderDetails  `json:\"OrderDetails\"`\n}\n\nfunc main() {\n    jsonByteArray := []byte(`[{\"Salesorder\":{\"sales_id\":\"SOO1\",\"customer_name\":\"CUST1\",\"totalprice\":\"200\"}, \"OrderDetails\":[{\"sales_id\":\"SOO1\",\"item_name\":\"ITEM1\",\"qty\":\"2\",\"price\":\"100\"},{\"sales_id\":\"SOO2\",\"item_name\":\"ITEM2\",\"qty\":\"3\",\"price\":\"200\"}]}]`)\n\n    var temp []Temp\n\n    err := json.Unmarshal(jsonByteArray, &amp;temp)\n    if err != nil {\n        panic(err)\n    }\n\n    //fmt.Printf(\"%+v\\n\", temp)\n\n    // Printing all Orders with some details\n    for _, order := range temp {\n        fmt.Println(\"Customer:\", order.Salesorder.Customer)\n\n        for _, details := range order.Salesorderdetails {\n            fmt.Printf(\"    ItemName: %s, Price: %s\\n\", details.ItemName, details.Price)\n        }\n    }\n}\n</code></pre>\n\n<p>.. <strong>OrderDetails</strong> is an array now</p>\n"}], "owner": {"reputation": 11, "user_id": 3136356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d70a8b66418407dfa429fb5fd5507dcd?s=128&d=identicon&r=PG&f=1", "display_name": "user3136356", "link": "https://stackoverflow.com/users/3136356/user3136356"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 635, "favorite_count": 0, "accepted_answer_id": 47166539, "answer_count": 2, "score": -3, "last_activity_date": 1510086185, "creation_date": 1510084061, "last_edit_date": 1510085110, "question_id": 47166270, "link": "https://stackoverflow.com/questions/47166270/how-to-unmarshal-json-and-fill-into-structures-in-golang", "title": "how to unmarshal json and fill into structures in golang", "body": "<p>How to unmarshal the json and fill into structures. Like i'm having salesorder and salesorderdetails structures. In json i will have 1 record for salesorder and multiple items for salesorderdetails structure. </p>\n\n<p>Here is the go code i have tried with single item and for multiple items, but working only for single record for salesorderdetails structure. </p>\n\n<p><strong>Gocode:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Order struct {\n    SalesId             string `json:\"sales_id\"`\n    Customer string `json:\"customer_name\"`\n    TotalPrice   string `json:\"totalprice\"`\n}\ntype OrderDetails struct {\n    DetailId             string `json:\"detail_id\"`\n    SalesId             string `json:\"sales_id\"`\n    ItemName string `json:\"item_name\"`\n    Qty   string `json:\"qty\"`\n    Price   string `json:\"price\"`\n}\ntype Temp struct {\n\n    Salesorder Order  `json:\"Salesorder\"`\n    Salesorderdetails OrderDetails  `json:\"OrderDetails\"`\n}\n\nfunc main() {\n    jsonByteArray := []byte(`[{\"Salesorder\":{\"sales_id\":\"SOO1\",\"customer_name\":\"CUST1\",\"totalprice\":\"200\"}, \"OrderDetails\":{\"detailid\":\"1\",\"sales_id\":\"SOO1\",\"item_name\":\"ITEM1\",\"qty\":\"2\",\"price\":\"100\"}}]`)\n\n   //if i use above json it is working and if i use below json its not working\n//jsonByteArray := []byte(`[{\"Salesorder\":{\"sales_id\":\"SOO1\",\"customer_name\":\"CUST1\",\"totalprice\":\"200\"}, \"OrderDetails\":{\"detailid\":\"1\",\"sales_id\":\"SOO1\",\"item_name\":\"ITEM1\",\"qty\":\"2\",\"price\":\"100\"},{\"detailid\":\"2\",\"sales_id\":\"SOO2\",\"item_name\":\"ITEM2\",\"qty\":\"3\",\"price\":\"200\"}}]`)\n\n    var temp []Temp\n    err := json.Unmarshal(jsonByteArray, &amp;temp)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%+v\\n\", temp)\n    fmt.Printf(\"%+v\\n \", temp[0].Salesorder.SalesId)\n}\n</code></pre>\n\n<p><strong>Error while using multiple items:</strong></p>\n\n<pre><code>panic: invalid character '{' looking for beginning of object key string\n</code></pre>\n\n<p><strong>Output while using single item with success:</strong></p>\n\n<pre><code>[{Salesorder:{SalesId:SOO1 Customer:CUST1 TotalPrice:200} Salesorderdetails:{SalesId:SOO1 ItemName:ITEM1 Qty:2 Price:100}}]\nSOO1\n</code></pre>\n\n<p><strong>Fiddle:</strong> updated with key in salesorderdetails</p>\n\n<p><a href=\"https://play.golang.org/p/klIAoNi18r\" rel=\"nofollow noreferrer\">https://play.golang.org/p/klIAoNi18r</a></p>\n"}, {"tags": ["macos", "go", "proxy", "configuration"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510083473, "post_id": 47166111, "comment_id": 81281973, "body": "Breakpoints using what? Delve? When you say you &quot;run the code in debug&quot; do you mean <i>in the debugger</i>?"}, {"owner": {"reputation": 625, "user_id": 4469946, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/6c7ba5769a43415d0cf11613745602aa?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/4469946/jay"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510084489, "post_id": 47166111, "comment_id": 81282535, "body": "@Adrian I&#39;m using jetbrains GoLand IDE."}, {"owner": {"reputation": 3581, "user_id": 182699, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/78d29efe4ce872b2ebe6dd03f4d819c8?s=128&d=identicon&r=PG", "display_name": "nicky", "link": "https://stackoverflow.com/users/182699/nicky"}, "edited": false, "score": 0, "creation_date": 1510116492, "post_id": 47166111, "comment_id": 81293091, "body": "Uncheck Automatic proxy conf"}, {"owner": {"reputation": 625, "user_id": 4469946, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/6c7ba5769a43415d0cf11613745602aa?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/4469946/jay"}, "reply_to_user": {"reputation": 3581, "user_id": 182699, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/78d29efe4ce872b2ebe6dd03f4d819c8?s=128&d=identicon&r=PG", "display_name": "nicky", "link": "https://stackoverflow.com/users/182699/nicky"}, "edited": false, "score": 0, "creation_date": 1510404908, "post_id": 47166111, "comment_id": 81426185, "body": "@nicky this doesn&#39;t help, I noticed that the code works fine when using http requests but not https requests."}, {"owner": {"reputation": 3581, "user_id": 182699, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/78d29efe4ce872b2ebe6dd03f4d819c8?s=128&d=identicon&r=PG", "display_name": "nicky", "link": "https://stackoverflow.com/users/182699/nicky"}, "edited": false, "score": 0, "creation_date": 1510602357, "post_id": 47166111, "comment_id": 81495566, "body": "what is https conf, both runs in diff port http and https"}], "owner": {"reputation": 625, "user_id": 4469946, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/6c7ba5769a43415d0cf11613745602aa?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/4469946/jay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 340, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1510083375, "creation_date": 1510083375, "question_id": 47166111, "link": "https://stackoverflow.com/questions/47166111/configuring-proxy-settings-for-goproxy", "title": "Configuring proxy settings for goproxy", "body": "<p>I'm trying to use goproxy as an alternative to fiddler on mac OSX,</p>\n\n<p>I wrote the following code, and succeeded to run it:</p>\n\n<pre><code>package main\n\nimport (\n\"flag\"\n\"log\"\n\"net/http\"\n\"gopkg.in/elazarl/goproxy.v1\"\n)\n\nfunc main() {\n    verbose := flag.Bool(\"v\", false, \"should every proxy request be logged \nto stdout\")\n    addr := flag.String(\"addr\", \":8080\", \"proxy listen address\")\n\n    proxy := goproxy.NewProxyHttpServer()\n    proxy.Verbose = *verbose\n    proxy.OnResponse().DoFunc(func(resp *http.Response, ctx \n*goproxy.ProxyCtx) *http.Response {\n        contentType := resp.Header.Get(\"Content-Type\")\n        if contentType == \"application/javascript\" || contentType == \"application/x-javascript\" {\n        // Do something...\n        }\n        return resp\n    })\n    log.Fatal(http.ListenAndServe(*addr, proxy))\n }\n</code></pre>\n\n<p>According to goproxy documentation I need to configure web proxy &amp; secure web proxy:\n<a href=\"https://i.stack.imgur.com/XctX8.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/XctX8.png\" alt=\"enter image description here\"></a></p>\n\n<p>I have put multiple breakpoints and run the code in debug, tried to access a website but I can't get it to stop on the breakpoint..</p>\n\n<p>I think I'm missing something in the proxy settings maybe.</p>\n"}, {"tags": ["git", "go", "gogs"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1510082462, "post_id": 47165855, "comment_id": 81281473, "body": "Is this a build server or a server you&#39;re running a service on? If you&#39;re just deploying a service, deploy the binary instead of the source."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510082497, "post_id": 47165855, "comment_id": 81281487, "body": "&quot;...copy that module to the server? How would we do this?&quot; Well, by use if tar and scp?"}], "answers": [{"tags": [], "owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "is_accepted": false, "score": 0, "last_activity_date": 1510091515, "creation_date": 1510091515, "answer_id": 47168047, "question_id": 47165855, "link": "https://stackoverflow.com/questions/47165855/go-get-for-server-with-no-internet-access/47168047#47168047", "title": "go get for server with no internet access", "body": "<ol>\n<li><p>Most probably all the sources of all your projects and all external libraries are inside a <strong>$GOPATH</strong> dir. Just sync needed folders and you are done.</p></li>\n<li><p>Yes, that is possible. After pushing a Github repo clone to your Gogs server - all you need to do is to import a package (go get) from new location and in your sources you have to replace \"github.com\" with what you have, something like \"gogs.local\":</p></li>\n</ol>\n\n<p><code>import \"gogs.local/username/packagename\"</code></p>\n"}, {"tags": [], "owner": {"reputation": 3294, "user_id": 4848859, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Slzu.jpg?s=128&g=1", "display_name": "mayo", "link": "https://stackoverflow.com/users/4848859/mayo"}, "is_accepted": false, "score": 0, "last_activity_date": 1510102927, "creation_date": 1510102927, "answer_id": 47169913, "question_id": 47165855, "link": "https://stackoverflow.com/questions/47165855/go-get-for-server-with-no-internet-access/47169913#47169913", "title": "go get for server with no internet access", "body": "<p>You should use <a href=\"https://godoc.org/github.com/tools/godep\" rel=\"nofollow noreferrer\">Godep</a>, a dependency tool for go. </p>\n\n<blockquote>\n  <p><strong>How to use godep with a new project</strong></p>\n  \n  <p>Assuming you've got everything working already, so you can build your\n  project with go install and test it with go test, it's one command to\n  start using:</p>\n  \n  <p><code>$ godep save</code></p>\n  \n  <p>This will save a list of dependencies to the file <code>Godeps/Godeps.json</code> \n  and copy their source code into <code>vendor/</code></p>\n</blockquote>\n\n<p>So you will have inside your project the dependencies (if you do those steps in your development machine).</p>\n\n<p><hr>\nGithub: <a href=\"https://github.com/tools/godep\" rel=\"nofollow noreferrer\">github.com/tools/godep</a></p>\n"}], "owner": {"reputation": 3630, "user_id": 501827, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/5e494392686ab4dae5812f4f85af9255?s=128&d=identicon&r=PG", "display_name": "PrestonDocks", "link": "https://stackoverflow.com/users/501827/prestondocks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1183, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1510102927, "creation_date": 1510082351, "question_id": 47165855, "link": "https://stackoverflow.com/questions/47165855/go-get-for-server-with-no-internet-access", "title": "go get for server with no internet access", "body": "<p>Our server can not connect to the Internet because of security lock down.</p>\n\n<p>To be able to use GO with 3rd party modules, I see that we have to options</p>\n\n<p>1) Our laptops can connect to the internet. Is it possible to \"go get github....\" on the laptop and then copy that module to the server? How would we do this?</p>\n\n<p>2) We have a GOGS server on the network. Would it be possible to clone the github repository and then push it as a private repository to the GOGS server? What changes do we need to make to the GO configuration? (This would be the preferred option if it is possible)</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 2280, "user_id": 2094168, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/cf7f39f46237a00ea06cd9706be9efab?s=128&d=identicon&r=PG", "display_name": "2ank3th", "link": "https://stackoverflow.com/users/2094168/2ank3th"}, "edited": false, "score": 0, "creation_date": 1510082541, "post_id": 47165879, "comment_id": 81281512, "body": "This only works if the default is executed completely. I want the go routine to be stopped even before default completes it&#39;s work"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 2280, "user_id": 2094168, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/cf7f39f46237a00ea06cd9706be9efab?s=128&d=identicon&r=PG", "display_name": "2ank3th", "link": "https://stackoverflow.com/users/2094168/2ank3th"}, "edited": false, "score": 3, "creation_date": 1510083039, "post_id": 47165879, "comment_id": 81281760, "body": "@2ank3th if you need that - you should have asked it explicitly. The community cannot read your mind."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1510088971, "last_edit_date": 1510088971, "creation_date": 1510082443, "answer_id": 47165879, "question_id": 47165730, "link": "https://stackoverflow.com/questions/47165730/how-to-stop-a-goroutine-which-may-or-may-not-be-running/47165879#47165879", "title": "how to stop a goroutine which may or may not be running?", "body": "<p>Close the quit channel instead of sending a value. The loop will exit because receive on a closed channel returns a zero value. </p>\n\n<p>Also, declare the channel as <code>chan struct{}</code> to indicate that the channel values are unimportant to the program:</p>\n\n<pre><code>quit := make(chan struct{})\ngo func() {\n    for {\n        select {\n        case &lt;- quit:\n            return\n        default:\n            // Do other stuff and return if complete.\n        }\n    }\n}()\n\n// Do stuff\n\n// Quit goroutine\nclose(quit)\n</code></pre>\n\n<p>If you need to break out of \"other stuff\", then pass the quit channel to the \"other stuff\" and check every now and again with:</p>\n\n<pre><code>select {\ncase &lt;- quit:\n    return\ndefault:\n}\n... keep going\n</code></pre>\n\n<p>If you are doing anything more than the first snippet in this answer, then you should consider using the standard <a href=\"https://godoc.org/context\" rel=\"nofollow noreferrer\">context</a> package for cancelation signals.</p>\n"}], "owner": {"reputation": 2280, "user_id": 2094168, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/cf7f39f46237a00ea06cd9706be9efab?s=128&d=identicon&r=PG", "display_name": "2ank3th", "link": "https://stackoverflow.com/users/2094168/2ank3th"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 660, "favorite_count": 0, "accepted_answer_id": 47165879, "answer_count": 1, "score": -2, "last_activity_date": 1510088971, "creation_date": 1510081873, "last_edit_date": 1510082586, "question_id": 47165730, "link": "https://stackoverflow.com/questions/47165730/how-to-stop-a-goroutine-which-may-or-may-not-be-running", "title": "how to stop a goroutine which may or may not be running?", "body": "<p>I have a go func which I want to stop if running its running in default. The below approach get's blocked at <code>quit &lt;- true</code> if go func already returned. </p>\n\n<pre><code>quit := make(chan bool)\ngo func() {\n    for {\n        select {\n        case &lt;- quit:\n            return\n        default:\n            // Do other stuff and return if complete.\n        }\n    }\n}()\n\n// Do stuff\n\n// Quit goroutine\nquit &lt;- true\n</code></pre>\n"}, {"tags": ["go", "intellij-idea"], "comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1510083161, "post_id": 47165246, "comment_id": 81281816, "body": "Well, for one, your directory path doesn&#39;t match.  Your <code>ll</code> calls show eth-client in <code>$GOPATH&#47;src&#47;github.com&#47;eth-client</code>, but you&#39;re trying to import it as <code>github.com&#47;getamis&#47;eth-client</code>.  The import coloration clearly shows where it starts failing to find the directory in the import path."}], "answers": [{"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1510083183, "post_id": 47165652, "comment_id": 81281828, "body": "<code>go get</code> calls <code>git clone</code>.  You can do either.  <code>go get</code> just simplifies it a bit."}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1510095771, "post_id": 47165652, "comment_id": 81287625, "body": "This is probably unrelated. Also you should know that the IntelliJ CE plugin hasn&#39;t been updated in a year now and the development has moved into a dedicated Go IDE, <a href=\"https://www.jetbrains.com/go/\" rel=\"nofollow noreferrer\">jetbrains.com/go</a>"}], "tags": [], "owner": {"reputation": 10637, "user_id": 3102968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/1XKm3.png?s=128&g=1", "display_name": "joesan", "link": "https://stackoverflow.com/users/3102968/joesan"}, "is_accepted": false, "score": 2, "last_activity_date": 1510081554, "creation_date": 1510081554, "answer_id": 47165652, "question_id": 47165246, "link": "https://stackoverflow.com/questions/47165246/go-project-in-intellij-not-resolving-dependencies/47165652#47165652", "title": "Go Project in IntelliJ Not Resolving Dependencies", "body": "<p>I just realized that when I clone the project, I should not do a git clone but rather do: </p>\n\n<pre><code>go get -u github.com/golang/lint/golint\n</code></pre>\n\n<p>Not sure why this is so, but after doing this my IntelliJ was able to resolve every file on my project!</p>\n"}, {"tags": [], "owner": {"reputation": 2221, "user_id": 7359810, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh3.googleusercontent.com/-8MngnLBsx3E/AAAAAAAAAAI/AAAAAAAAetc/OsGMMV3Set4/photo.jpg?sz=128", "display_name": "Neha", "link": "https://stackoverflow.com/users/7359810/neha"}, "is_accepted": true, "score": -1, "last_activity_date": 1510240748, "creation_date": 1510240748, "answer_id": 47205437, "question_id": 47165246, "link": "https://stackoverflow.com/questions/47165246/go-project-in-intellij-not-resolving-dependencies/47205437#47205437", "title": "Go Project in IntelliJ Not Resolving Dependencies", "body": "<p>For golang projects, it's good to have Goland installed ( also a product of JetBrains )<a href=\"https://www.jetbrains.com/go/download/\" rel=\"nofollow noreferrer\">Goland Download</a>. Moreover for the above concern you can use:</p>\n\n<pre><code>go get *the_project_to_clone*\n</code></pre>\n"}], "owner": {"reputation": 10637, "user_id": 3102968, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/1XKm3.png?s=128&g=1", "display_name": "joesan", "link": "https://stackoverflow.com/users/3102968/joesan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6357, "favorite_count": 0, "accepted_answer_id": 47205437, "answer_count": 2, "score": 0, "last_activity_date": 1510240748, "creation_date": 1510080048, "question_id": 47165246, "link": "https://stackoverflow.com/questions/47165246/go-project-in-intellij-not-resolving-dependencies", "title": "Go Project in IntelliJ Not Resolving Dependencies", "body": "<p>I have IntelliJ CE and I just imported a Go project that I cloned from GitHub. On my Mac, I have some folder organization where I group projects that I work on based on the technologies. For example., in my Projects folder on my Mac, I have the following sub folders:</p>\n\n<pre><code>- go-projects\n- scala-projects\n- rust-projects\n- ruby-projects\n</code></pre>\n\n<p>So I obviously checked out the Go project in the go-projects folder which looks like this:</p>\n\n<pre><code>Joes-MacBook-Pro:go-projects joe$ ll\ntotal 0\ndrwxr-xr-x   3 joe  staff   102B Oct 28 07:51 bin/\ndrwxr-xr-x  19 joe  staff   646B Oct 24 06:48 golang-restful-starter-kit/\ndrwxr-xr-x   3 joe  staff   102B Oct 28 07:51 pkg/\ndrwxr-xr-x   3 joe  staff   102B Oct 27 10:23 src/\n</code></pre>\n\n<p>And if I get into the src folder, it looks like this:</p>\n\n<pre><code>Joes-MacBook-Pro:go-projects joe$ cd src\ntotal 0\ndrwxr-xr-x  6 joe  staff   204B Nov  7 19:14 github.com/\nJoes-MacBook-Pro:src joe$ cd github.com/\ntotal 0\ndrwxr-xr-x   3 joe  staff   102B Oct 28 08:20 btcsuite/\ndrwxr-xr-x  16 joe  staff   544B Nov  7 19:16 eth-client/\ndrwxr-xr-x   3 joe  staff   102B Oct 27 10:24 ethereum/\ndrwxr-xr-x   3 joe  staff   102B Oct 28 07:51 tools/\nJoes-MacBook-Pro:github.com joe$\n</code></pre>\n\n<p>Here is my Go related environment settings:</p>\n\n<pre><code># For Go projects, we set the GOPATH\nexport GOROOT=\"/usr/local/go\"\nexport GOPATH=\"/Users/joe/Projects/Private/go-projects\"\nexport GODEPS=\"/Users/joe/Projects/Private/go-projects/bin/godep\"\n</code></pre>\n\n<p>Now I import one of the Go project into IntelliJ and I get to see the following error saying that it is not able to resolve a directory as it can be seen in the screenshot below!</p>\n\n<p><a href=\"https://i.stack.imgur.com/3FEib.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/3FEib.png\" alt=\"enter image description here\"></a></p>\n\n<p>How can I get rid of this error? Any ideas?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1405, "user_id": 353563, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/1714b4723e834aaca7d746ce4219e711?s=128&d=identicon&r=PG", "display_name": "Sasa", "link": "https://stackoverflow.com/users/353563/sasa"}, "is_accepted": false, "score": 7, "last_activity_date": 1510079250, "creation_date": 1510079250, "answer_id": 47165010, "question_id": 47164944, "link": "https://stackoverflow.com/questions/47164944/in-golang-time-format-removes-trailing-zeros-from-fractional-part/47165010#47165010", "title": "In golang, Time.Format() removes trailing zeros from fractional part", "body": "<p>Ah, is was there in documentation. One should use 000 instead of 999 if you want to keep zeros.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"testing\"\n    \"time\"\n)\n\nfunc TestTimeFormatting(t *testing.T) {\n    timestamp := time.Date(2017, 1,2, 3, 4, 5, 600000*1000, time.UTC)\n    timestamp_string := timestamp.Format(\"2006-01-02T15:04:05.000-07:00\")\n    expected := \"2017-01-02T03:04:05.600+00:00\"\n\n    if expected != timestamp_string {\n        t.Errorf(\"Invalid timestamp formating, expected %v, got %v\", expected, timestamp_string)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1405, "user_id": 353563, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/1714b4723e834aaca7d746ce4219e711?s=128&d=identicon&r=PG", "display_name": "Sasa", "link": "https://stackoverflow.com/users/353563/sasa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1074, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1510079250, "creation_date": 1510078984, "question_id": 47164944, "link": "https://stackoverflow.com/questions/47164944/in-golang-time-format-removes-trailing-zeros-from-fractional-part", "title": "In golang, Time.Format() removes trailing zeros from fractional part", "body": "<p>How can I prevent go's Time.Format() from removing trailing zeros from fractional part? I have following unit tests that fails. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"testing\"\n    \"time\"\n)\n\nfunc TestTimeFormatting(t *testing.T) {\n    timestamp := time.Date(2017, 1,2, 3, 4, 5, 600000*1000, time.UTC)\n    timestamp_string := timestamp.Format(\"2006-01-02T15:04:05.999-07:00\")\n    expected := \"2017-01-02T03:04:05.600+00:00\"\n\n    if expected != timestamp_string {\n        t.Errorf(\"Invalid timestamp formating, expected %v, got %v\", expected, timestamp_string)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go test\n--- FAIL: TestTimeFormatting (0.00s)\n    main_test.go:14: Invalid timestamp formating, expected 2017-01-02T03:04:05.600+00:00, got 2017-01-02T03:04:05.6+00:00\nFAIL\nexit status 1\nFAIL    _/home/sasa/Bugs/go-formatter   0.001s\n</code></pre>\n\n<p>Any idea how to solve this?</p>\n"}, {"tags": ["json", "go", "io"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1510070152, "post_id": 47161998, "comment_id": 81273997, "body": "<code>makeAndSaveTbn</code> only conditionally sends to the channel. Try it properly with a <code>WaitGroup</code>, and log the steps when you encounter any problems."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1510070431, "post_id": 47161998, "comment_id": 81274187, "body": "io.Pipe specifies in its documentation that it&#39;s a synchronous pipe, and multiwriter simply loops over the writers provided and writes to them.  So all of them need to be receiving at the same time or the write will block on whichever isn&#39;t yet ready."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1510082690, "post_id": 47161998, "comment_id": 81281580, "body": "Sometimes concurrency is not the right tool."}, {"owner": {"reputation": 11, "user_id": 6607815, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6e1ec9b1fd744e21914ae9732d62303?s=128&d=identicon&r=PG&f=1", "display_name": "Johannes", "link": "https://stackoverflow.com/users/6607815/johannes"}, "edited": false, "score": 0, "creation_date": 1510170371, "post_id": 47161998, "comment_id": 81326068, "body": "Thanks for your input! Yeah, it looks like I either have to scratch the concurrency or buffer on all of the receivers."}, {"owner": {"reputation": 11, "user_id": 6607815, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6e1ec9b1fd744e21914ae9732d62303?s=128&d=identicon&r=PG&f=1", "display_name": "Johannes", "link": "https://stackoverflow.com/users/6607815/johannes"}, "edited": false, "score": 0, "creation_date": 1510172216, "post_id": 47161998, "comment_id": 81327056, "body": "But in principle, does anyone know of a good example on how to multiplex streaming a reader to different routines which execute at differs speeds? It does not seem like such an exotic thing to do."}], "owner": {"reputation": 11, "user_id": 6607815, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6e1ec9b1fd744e21914ae9732d62303?s=128&d=identicon&r=PG&f=1", "display_name": "Johannes", "link": "https://stackoverflow.com/users/6607815/johannes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1510069530, "creation_date": 1510069530, "question_id": 47161998, "link": "https://stackoverflow.com/questions/47161998/communication-between-asynch-i-o", "title": "Communication between asynch I/O", "body": "<p>I'm having a bit of an issue with using the io.MultiWriter together with channels to communicate between the different routines using the readers. I'm trying to build an upload function which receives a JSON, writes it to disk, but at the same time checks what mime type it is and creates a thumbnail. So</p>\n\n<pre><code>getUploadData(...)\n</code></pre>\n\n<p>Grabs the mime string from the JSON and writes it to the mimeChan channel, which is then received by</p>\n\n<pre><code>makeAndSaveTbn(...)\n</code></pre>\n\n<p>which will then make a different thumbnail depending on the mime.</p>\n\n<p>At the same time</p>\n\n<pre><code>saveOnDisk(...) \n</code></pre>\n\n<p>Just saves the file to disk. Since I'm streaming to three routines I am using the io.Pipes together with io.MultiWriter.</p>\n\n<p>Now the issue is simply that makeAndSaveTbn(...) never receives the message from the channel mimeChan and blocks the program. The writing to the channel works, if I remove the dependency on mimeChan and just receive it in ProcessUpload(...) it works. </p>\n\n<p>Is there maybe an issue with the io.Writers in a sense that they actually can't be read asynchronously ?</p>\n\n<p>Any ideas will be greatly appreciated, thanks for already reading this fare! </p>\n\n<p>My process upload function looks like this :</p>\n\n<pre><code>func ProcessUpload(r *File) (err error) {\n\nsr, sw := io.Pipe()\ntr, tw := io.Pipe()\npr, pw := io.Pipe()\n\nmimeChan := make(chan string, 1)\ndone := make(chan string)\ndefer close(done)\ndefer close(mimeChan)\n\ngo getUploadData(pr, mimeChan, done)\ngo saveOnDisk(sr, done)\ngo makeAndSaveTbn(tr, FileID, mimeChan, done)\n\ngo func() {\n    defer sw.Close()\n    defer tw.Close()\n    defer pw.Close()\n    mw := io.MultiWriter(pw, tw, sw)\n    _, err := io.Copy(mw, r)\n\n    if err != nil {\n        log.Error(err)\n    }\n}()\n\nfor c := 0; c &lt; 3; c++ {\n    log.Errorf(&lt;-done)\n}\n\n\nreturn err\n}\n</code></pre>\n\n<p>The mime checker looks like this:</p>\n\n<pre><code>func getUploadData(pr *io.PipeReader, mimeChan chan string, done chan string) {\n    var p uploadParams\n    err := json.NewDecoder(pr).Decode(&amp;p)\n    if err != nil {\n        log.Error(err)\n    }\n    log.Errorf(p.Mime)\n    done &lt;- \"getUploadData\"\n    mimeChan &lt;- p.Mime\n}\n</code></pre>\n\n<p>And the blocking function like this, it receives the channel in if string.Contains...: </p>\n\n<pre><code>func makeAndSaveTbn(tr *io.PipeReader, FileID string, mimeChan chan string, done chan string) {\n    if strings.ContainsAny(&lt;-mimeChan, \"image\") {\n        tbn, err := MakeThumbnail(tr)\n        if err != nil {\n            log.Error(err)\n        }\n    done &lt;- \"makeAndSaveTbn\"\n    }\n}\n</code></pre>\n"}, {"tags": ["sql", "go"], "comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1510069639, "post_id": 47161559, "comment_id": 81273582, "body": "Each scan is only going to pull one row.  Assuming the format of the row is a date to view/impression association, with the date being non-unique, use a map of string (or a time format, if you want to convert the date string) to the view/impression data for that date, and add the data to the relevant map entry on each query scan.  For ranges, just do a custom addition over the map.  Might be easier if you use a date format that can be made easily sequential (like Julian dates) rather than strings."}, {"owner": {"reputation": 42, "user_id": 7925568, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RN4td.png?s=128&g=1", "display_name": "Noy", "link": "https://stackoverflow.com/users/7925568/noy"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1510074766, "post_id": 47161559, "comment_id": 81277029, "body": "Thanks for the response. Not exactly sure how I&#39;d do that if the dates are sometimes duplicates and multiple columns. The views/impressions were an example, but here is what I have so far: <a href=\"https://gist.github.com/Noy/9596c8cae488631406018b53849a3294\" rel=\"nofollow noreferrer\">gist.github.com/Noy/9596c8cae488631406018b53849a3294</a>"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1510081609, "post_id": 47161559, "comment_id": 81281025, "body": "Well, your double loop is certainly less efficient than a map strategy.  Your double loop version will require a number of iterations approaching NumRows * NumUniqueDates.  A map-style strategy requires only NumRows iterations.  O(n) vs. O(n^2) scaling.  If you did it instead by, say, a slice using the day of the year as the index (which is similar to a map style, mechanically), compiling the summed stats between any particular dates becomes trivially easy to calculate."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1510082491, "post_id": 47161559, "comment_id": 81281486, "body": "Example: <a href=\"https://play.golang.org/p/HVCPkcMJzv\" rel=\"nofollow noreferrer\">play.golang.org/p/HVCPkcMJzv</a>"}, {"owner": {"reputation": 42, "user_id": 7925568, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RN4td.png?s=128&g=1", "display_name": "Noy", "link": "https://stackoverflow.com/users/7925568/noy"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1510083067, "post_id": 47161559, "comment_id": 81281776, "body": "Oh awesome. Thank you for that example. That makes a lot of sense actually. Appreciate the help."}, {"owner": {"reputation": 42, "user_id": 7925568, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RN4td.png?s=128&g=1", "display_name": "Noy", "link": "https://stackoverflow.com/users/7925568/noy"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1510084376, "post_id": 47161559, "comment_id": 81282458, "body": "gg man, thanks so much for the help. Learned a lot from this."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1510084518, "post_id": 47161559, "comment_id": 81282553, "body": "Going to go ahead and post it as an answer, so this question actually has one."}], "answers": [{"tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": true, "score": 0, "last_activity_date": 1510084944, "creation_date": 1510084944, "answer_id": 47166506, "question_id": 47161559, "link": "https://stackoverflow.com/questions/47161559/getting-multiple-date-ranges-between-sql-query-and-adding-up-the-data-accordingl/47166506#47166506", "title": "Getting multiple date ranges between SQL query and adding up the data accordingly", "body": "<p>So, the best bet in these cases is to use a map-style strategy to keep track.  For example, a map[date]data would allow you to keep a unique entry for each date.  Dates, however, have a beneficial optimization, in that they can easily be represented by integers (the day of the year), and the number of options is small enough to not be a memory issue.  This means we can use a slice instead of a map and get the benefits of ordering (Go maps are randomly ordered in a for loop) while still using it <em>like</em> a map.  For example:</p>\n\n<pre><code>type Data struct {\n    // fields\n}\n\nconst dateFormat = \"2006-01-02\" // only parse the date\n\ndayStats := make([]Data, 366) // account for leap years\n\nfor query.Next() {\n    var datestr string // can make this a time.Time, if your date format scans properly\n    var dr Data\n    if err := query.Scan(datestr, /* other fields */ ); err != nil {\n        log.Fatal(err)\n    }\n\n    date, err := time.Parse(datestr)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    dayStats[date.YearDay()].someField += dr.someField\n    dayStats[date.YearDay()].someOtherField += dr.someOtherField\n    // other fields...\n}\n</code></pre>\n\n<p>Now let's say we want to calculate the stats between a 01 October and 31 October:</p>\n\n<pre><code>start := time.Date(2017, time.October, 1, 0, 0, 0, 0, time.UTC)\nend := time.Date(2017, time.October, 31, 0, 0, 0, 0, time.UTC)\n\nvar total Data\nfor day := start.YearDay(); day &lt;= end.YearDay(); day++ {\n    total.someField += dayStats[day].someField\n    total.someOtherField += dayStats[day].someOtherField\n    // other fields...\n}\n</code></pre>\n"}], "owner": {"reputation": 42, "user_id": 7925568, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RN4td.png?s=128&g=1", "display_name": "Noy", "link": "https://stackoverflow.com/users/7925568/noy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 47166506, "answer_count": 1, "score": 0, "last_activity_date": 1510084944, "creation_date": 1510068379, "question_id": 47161559, "link": "https://stackoverflow.com/questions/47161559/getting-multiple-date-ranges-between-sql-query-and-adding-up-the-data-accordingl", "title": "Getting multiple date ranges between SQL query and adding up the data accordingly", "body": "<p>ran into a bit of an issue today.</p>\n\n<p>Basically, I need to select a certain range of dates after I have already completed the query <code>SELECT * FROM &lt;DB&gt;</code>.</p>\n\n<p>For example:</p>\n\n<pre><code>var (date string\n     views int\n     impressions int)\n\nfor query.Next() { \n    err := query.Scan(&amp;date, &amp;views, &amp;impressions)\n    // handle the err\n    // get the range of dates for each month\n    // add up all the views and impressions in that specific range\n}\n</code></pre>\n\n<p>The 'date' var will obviously be all of the dates in the database query.</p>\n\n<p>Dates are formatted as: <code>2017-10-01</code> (October 1st as an example) and there are about 300 in October and 100 in November.</p>\n\n<p>Basically from here, I need to add up all the values (views and impressions), but only per date range.</p>\n\n<p>So I would get something like:<br></p>\n\n<p><code>2017-10-01</code> to <code>2017-10-31</code> has <code>54</code> impressions<br>\n<code>2017-10-01</code> to <code>2017-10-07</code> has <code>5</code> impressions as an example.</p>\n\n<p>Any idea how I'd come about this issue?<br>\nHope I explained this alright and thanks in advanced.</p>\n"}, {"tags": ["javascript", "excel", "go", "xlsx"], "answers": [{"comments": [{"owner": {"reputation": 531, "user_id": 6724722, "user_type": "registered", "accept_rate": 47, "profile_image": "https://lh5.googleusercontent.com/-44hAeiAfcF8/AAAAAAAAAAI/AAAAAAAAAJk/0LWDwLuDIB4/photo.jpg?sz=128", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/6724722/dmitry"}, "edited": false, "score": 0, "creation_date": 1510114832, "post_id": 47165944, "comment_id": 81292618, "body": "Ok thanks thats something, but I still don&#39;t see page properties support like margins and page orientation."}], "tags": [], "owner": {"reputation": 12076, "user_id": 12719, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7035cec2436e927067addeeb5266bd36?s=128&d=identicon&r=PG", "display_name": "pgras", "link": "https://stackoverflow.com/users/12719/pgras"}, "is_accepted": false, "score": 0, "last_activity_date": 1510148665, "last_edit_date": 1510148665, "creation_date": 1510082699, "answer_id": 47165944, "question_id": 47161211, "link": "https://stackoverflow.com/questions/47161211/advansed-xlsx-spreadsheet-formatting/47165944#47165944", "title": "Advansed xlsx spreadsheet formatting", "body": "<p>I am myself looking for something similar to format docx documents and I have just started trying out <a href=\"https://github.com/baliance/gooxml\" rel=\"nofollow noreferrer\">gooxml</a>.</p>\n\n<p>Currently it has following capabilities for Excel:</p>\n\n<ul>\n<li>Read/Write/Edit</li>\n<li>Cell formatting including conditional formatting</li>\n<li>Cell validation (drop down combobox, rules, etc.)</li>\n<li>Retrieve cell values as formatted by Excel (e.g. retrieve a date or number as displayed in Excel)</li>\n<li>Formula Evaluation (100+ functions supported currently, more will be added as required)</li>\n<li>Embedded Images</li>\n<li>All chart types</li>\n</ul>\n\n<p><strong>Edit to answer comment:</strong>\nAs stated in the documentation, you may have to fall back to raw document manipulation should the library's API not cover a specific use case.</p>\n\n<p>See <a href=\"https://github.com/baliance/gooxml/blob/master/schema/soo/sml/CT_PageMargins.go\" rel=\"nofollow noreferrer\">CT_PageMargins.go</a> and <a href=\"https://github.com/baliance/gooxml/blob/master/schema/soo/sml/CT_PageSetup.go\" rel=\"nofollow noreferrer\">CT_PageSetup.go</a> for margin and orientation...</p>\n"}, {"tags": [], "owner": {"reputation": 531, "user_id": 6724722, "user_type": "registered", "accept_rate": 47, "profile_image": "https://lh5.googleusercontent.com/-44hAeiAfcF8/AAAAAAAAAAI/AAAAAAAAAJk/0LWDwLuDIB4/photo.jpg?sz=128", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/6724722/dmitry"}, "is_accepted": false, "score": 0, "last_activity_date": 1510149819, "creation_date": 1510149819, "answer_id": 47181729, "question_id": 47161211, "link": "https://stackoverflow.com/questions/47161211/advansed-xlsx-spreadsheet-formatting/47181729#47181729", "title": "Advansed xlsx spreadsheet formatting", "body": "<p>Well it seems I've learned the lesson - after trying to use \"super-hard-to-understand-and-use\" jsreport-xlsx module I've remembered about <a href=\"https://github.com/guyonroche/exceljs\" rel=\"nofollow noreferrer\">one lib</a> that didn't worked in Electron renderer and tried it to work from Electron main process.</p>\n\n<p>And it works! Sometime it may be a little treaky to make it create doc exactly you want but it's much better than XLSX-style I've used before and have all features I want.</p>\n\n<p>(it's second [and last I believe] time I've forget about Electron renderer is not Node.js, the true Node.js is main process)</p>\n"}], "owner": {"reputation": 531, "user_id": 6724722, "user_type": "registered", "accept_rate": 47, "profile_image": "https://lh5.googleusercontent.com/-44hAeiAfcF8/AAAAAAAAAAI/AAAAAAAAAJk/0LWDwLuDIB4/photo.jpg?sz=128", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/6724722/dmitry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 258, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1576399112, "creation_date": 1510067378, "last_edit_date": 1576399112, "question_id": 47161211, "link": "https://stackoverflow.com/questions/47161211/advansed-xlsx-spreadsheet-formatting", "title": "Advansed xlsx spreadsheet formatting", "body": "<p>Is there some JavaScript or Golang lib that allows to create <code>xlsx</code> files using some custom heavy formatting?</p>\n\n<p>I'm working on an Electron app and want to generate some reports but \n<a href=\"https://github.com/SheetJS/js-xlsx\" rel=\"nofollow noreferrer\">the most popular</a> library doesn't provide <strong>cell formatting</strong>, <a href=\"https://github.com/protobi/js-xlsx\" rel=\"nofollow noreferrer\">that fork</a> looses the ability to define page properties like <strong>margins</strong> and <strong>page orientation</strong> and <a href=\"https://godoc.org/github.com/360EntSecGroup-Skylar/excelize\" rel=\"nofollow noreferrer\">that Golang lib</a> as I see doesn't provide <strong>page properties</strong> too.</p>\n\n<p>Can anybody show some good alternatives or show me I'm wrong?\n(no C-like langs and Python please)</p>\n"}, {"tags": ["ubuntu", "go", "odbc", "cdata-drivers"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1510078856, "post_id": 47161073, "comment_id": 81279383, "body": "trying moving this import: <code>_ &quot;github.com&#47;alexbrainman&#47;odbc&quot;</code> after the standard one: <code>&quot;database&#47;sql&quot;</code>"}, {"owner": {"reputation": 721, "user_id": 6301014, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nx0QBGL0WTI/AAAAAAAAAAI/AAAAAAAAAGA/mtSKFZ6euxg/photo.jpg?sz=128", "display_name": "Jerod Johnson", "link": "https://stackoverflow.com/users/6301014/jerod-johnson"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1510085605, "post_id": 47161073, "comment_id": 81283119, "body": "I tried swapping the imports, no luck. Thanks @YandryPozo"}, {"owner": {"reputation": 1980, "user_id": 6375498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ade4f86c3426c9f67f1a54b270b398?s=128&d=identicon&r=PG&f=1", "display_name": "Seva", "link": "https://stackoverflow.com/users/6375498/seva"}, "edited": false, "score": 1, "creation_date": 1510135395, "post_id": 47161073, "comment_id": 81302415, "body": "It looks to me more like an issue with unixODBC and/or CData driver. Check your DSN with isql. Try to actually connect and query some data. Once unixODBC and below are sorted out, the go side should generally work without issues. I would also suspect that cryptic error message is ascii interpreted as utf-16 or something like that."}, {"owner": {"reputation": 1980, "user_id": 6375498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ade4f86c3426c9f67f1a54b270b398?s=128&d=identicon&r=PG&f=1", "display_name": "Seva", "link": "https://stackoverflow.com/users/6375498/seva"}, "edited": false, "score": 1, "creation_date": 1510137019, "post_id": 47161073, "comment_id": 81303565, "body": "If isql works, but go code still doesn&#39;t. You can also try checking what odbc libraries your go binary is linked against and compare it to isql."}, {"owner": {"reputation": 721, "user_id": 6301014, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nx0QBGL0WTI/AAAAAAAAAAI/AAAAAAAAAGA/mtSKFZ6euxg/photo.jpg?sz=128", "display_name": "Jerod Johnson", "link": "https://stackoverflow.com/users/6301014/jerod-johnson"}, "reply_to_user": {"reputation": 1980, "user_id": 6375498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ade4f86c3426c9f67f1a54b270b398?s=128&d=identicon&r=PG&f=1", "display_name": "Seva", "link": "https://stackoverflow.com/users/6375498/seva"}, "edited": false, "score": 0, "creation_date": 1510146342, "post_id": 47161073, "comment_id": 81309755, "body": "isql definitely works. I&#39;ll look into the linked libraries. Thanks, @Seva"}, {"owner": {"reputation": 721, "user_id": 6301014, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nx0QBGL0WTI/AAAAAAAAAAI/AAAAAAAAAGA/mtSKFZ6euxg/photo.jpg?sz=128", "display_name": "Jerod Johnson", "link": "https://stackoverflow.com/users/6301014/jerod-johnson"}, "reply_to_user": {"reputation": 1980, "user_id": 6375498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ade4f86c3426c9f67f1a54b270b398?s=128&d=identicon&r=PG&f=1", "display_name": "Seva", "link": "https://stackoverflow.com/users/6375498/seva"}, "edited": false, "score": 0, "creation_date": 1510156769, "post_id": 47161073, "comment_id": 81317459, "body": "@Seva, I&#39;ve compared the linked libraries and they are the same, any other thoughts?"}], "answers": [{"tags": [], "owner": {"reputation": 721, "user_id": 6301014, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nx0QBGL0WTI/AAAAAAAAAAI/AAAAAAAAAGA/mtSKFZ6euxg/photo.jpg?sz=128", "display_name": "Jerod Johnson", "link": "https://stackoverflow.com/users/6301014/jerod-johnson"}, "is_accepted": true, "score": 1, "last_activity_date": 1510170971, "last_edit_date": 1510170971, "creation_date": 1510169938, "answer_id": 47188283, "question_id": 47161073, "link": "https://stackoverflow.com/questions/47161073/unable-to-connect-to-3rd-party-odbc-driver-in-go-with-alexbrainman-odbc-on-linux/47188283#47188283", "title": "Unable to connect to 3rd party ODBC driver in Go with alexbrainman/odbc on Linux", "body": "<p>It turns out that I needed to ensure that the CData Driver was configured to use UTF-16 encoding, as is required by unixODBC. To do so, I edited the driver's INI file: </p>\n\n<p><em>/opt/cdata/cdata-odbc-driver-for-redis/lib/cdata.odbc.redis.ini</em></p>\n\n<pre><code>[Driver]\nDriverManagerEncoding = UTF-16\n</code></pre>\n\n<p>Once this was done the CData driver worked with the alexbrainman/odbc database driver (and other Go-related ODBC database drivers) as expected.</p>\n"}], "owner": {"reputation": 721, "user_id": 6301014, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nx0QBGL0WTI/AAAAAAAAAAI/AAAAAAAAAGA/mtSKFZ6euxg/photo.jpg?sz=128", "display_name": "Jerod Johnson", "link": "https://stackoverflow.com/users/6301014/jerod-johnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 420, "favorite_count": 0, "accepted_answer_id": 47188283, "answer_count": 1, "score": 0, "last_activity_date": 1590647914, "creation_date": 1510067010, "last_edit_date": 1592644375, "question_id": 47161073, "link": "https://stackoverflow.com/questions/47161073/unable-to-connect-to-3rd-party-odbc-driver-in-go-with-alexbrainman-odbc-on-linux", "title": "Unable to connect to 3rd party ODBC driver in Go with alexbrainman/odbc on Linux", "body": "<p>I'm attempting to connect to a data source with a 3rd party ODBC driver (downloadable <a href=\"http://www.cdata.com/drivers/redis/download/odbc\" rel=\"nofollow noreferrer\">here</a>) in Go using the <a href=\"https://github.com/alexbrainman/odbc\" rel=\"nofollow noreferrer\">alexbrainman ODBC driver</a>. I've tested the DSN in question using:</p>\n<pre><code>isql -v &quot;CData Redis Source&quot;\n</code></pre>\n<p>Everything works as expected there. And I know that I have unixODBC 2.3.1 installed (<code>isql --version</code>).</p>\n<h1>The Problem</h1>\n<p>When I try to run the following Go program, I get this error message, spawned from the <code>db.Ping()</code> call (which Google translate seems unable to translate):</p>\n<blockquote>\n<p>SQLDriverConnect: {\u3130\u30530} [unixODBC]\u6e49\u6176\u696c\u2064\u6f63\u6e6e\u6365\u6974\u6e6f\u7320\u7274\u6e69\u2067\u7973\u746e\u7861\u6120\u2074\u6e69\u6564\u2078\u315b\u3a5d</p>\n</blockquote>\n<p>My code:</p>\n<pre><code>package main\n\nimport (\n  _ &quot;github.com/alexbrainman/odbc&quot;\n  &quot;database/sql&quot;\n  &quot;log&quot;\n)\n\nfunc main() {\n  db, err := sql.Open(&quot;odbc&quot;,&quot;DSN=CData Redis Source&quot;)\n  if err != nil {\n    log.Fatal(err);\n  }\n  \n  var (\n    name string\n  )\n  \n  rows, err := db.Ping()\n  if err != nil {\n    log.Fatal(err)\n  }\n}\n</code></pre>\n<p>I see the same error if I do a <code>db.Query()</code> or a <code>db.Prepare()</code>.</p>\n<h1>The Details</h1>\n<ul>\n<li>Ubuntu 16.04.3 LTS</li>\n<li>unixODBC 2.3.1</li>\n<li>CData Software ODBC Driver for Redis</li>\n<li>go1.6.2 linux/amd64</li>\n<li>github.com/alexbrainman/odbc</li>\n</ul>\n<h1>The Request</h1>\n<p>I'd be happy with a translation of the error message to help me debug AND/OR some help in determining why my error message is not in English AND/OR an actual proposed solution to the error message.</p>\n"}, {"tags": ["go", "apache-kafka"], "comments": [{"owner": {"reputation": 21, "user_id": 1059866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d04858ecc193d0d4d5570be94d32d0?s=128&d=identicon&r=PG", "display_name": "PetrusJPrinsloo", "link": "https://stackoverflow.com/users/1059866/petrusjprinsloo"}, "edited": false, "score": 0, "creation_date": 1510102102, "post_id": 47160289, "comment_id": 81289338, "body": "I have gotten a bit further after some digging around on how these things are compiled and I added <a href=\"https://github.com/elodina/alligator/blob/master/mesos_allocation_kafka_module/librdkafka/rdkafka.pc\" rel=\"nofollow noreferrer\">rdkafka.pc</a> file to <code>&#47;usr&#47;shar&#47;pkgconfig</code>. This does not fix the issues yet. I need the proper <code>rdkafka.pc</code> file for this to work."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 1059866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d04858ecc193d0d4d5570be94d32d0?s=128&d=identicon&r=PG", "display_name": "PetrusJPrinsloo", "link": "https://stackoverflow.com/users/1059866/petrusjprinsloo"}, "edited": false, "score": 0, "creation_date": 1510071831, "post_id": 47160863, "comment_id": 81275154, "body": "Thanks, I&#39;ll give that a try and get back to you."}, {"owner": {"reputation": 21, "user_id": 1059866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d04858ecc193d0d4d5570be94d32d0?s=128&d=identicon&r=PG", "display_name": "PetrusJPrinsloo", "link": "https://stackoverflow.com/users/1059866/petrusjprinsloo"}, "edited": false, "score": 0, "creation_date": 1510090604, "post_id": 47160863, "comment_id": 81285500, "body": "What changes would you make to that script to have this run on Fedora? I&#39;m not even sure where to start, but I really need to get this working."}], "tags": [], "owner": {"reputation": 47278, "user_id": 18627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b31b9d123bff80f00317a1df0dd00e2?s=128&d=identicon&r=PG", "display_name": "Alex Ott", "link": "https://stackoverflow.com/users/18627/alex-ott"}, "is_accepted": false, "score": 0, "last_activity_date": 1510066405, "creation_date": 1510066405, "answer_id": 47160863, "question_id": 47160289, "link": "https://stackoverflow.com/questions/47160289/i-cant-seem-to-get-rdkafka-to-play-nice-with-the-confuent-kafka-go-package/47160863#47160863", "title": "I can&#39;t seem to get rdkafka to play nice with the confuent-kafka-go package", "body": "<p>I suggest that you install librdkafka from Confluent's repository as <a href=\"https://docs.confluent.io/current/installation/installing_cp.html#rhel-and-centos\" rel=\"nofollow noreferrer\">described in their documentation</a>.  But I think that you'll need to build librdkafka from source RPMs, like <a href=\"https://gist.github.com/alexott/76847779adf8adb2a488d835f0eabb35\" rel=\"nofollow noreferrer\">I'm doing for Ubuntu</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 1059866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d04858ecc193d0d4d5570be94d32d0?s=128&d=identicon&r=PG", "display_name": "PetrusJPrinsloo", "link": "https://stackoverflow.com/users/1059866/petrusjprinsloo"}, "is_accepted": false, "score": 0, "last_activity_date": 1510131908, "creation_date": 1510131908, "answer_id": 47175488, "question_id": 47160289, "link": "https://stackoverflow.com/questions/47160289/i-cant-seem-to-get-rdkafka-to-play-nice-with-the-confuent-kafka-go-package/47175488#47175488", "title": "I can&#39;t seem to get rdkafka to play nice with the confuent-kafka-go package", "body": "<p>So I got it working thanks to Remi. Adding the repo from <a href=\"https://rpms.remirepo.net/\" rel=\"nofollow noreferrer\">https://rpms.remirepo.net/</a> (I used the one for Fedora 26). Then just installing it using:</p>\n\n<p><code>sudo dnf --enablerepo=remi install librdkafka-devel</code></p>\n"}], "owner": {"reputation": 21, "user_id": 1059866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c2d04858ecc193d0d4d5570be94d32d0?s=128&d=identicon&r=PG", "display_name": "PetrusJPrinsloo", "link": "https://stackoverflow.com/users/1059866/petrusjprinsloo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1216, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1510131908, "creation_date": 1510064694, "question_id": 47160289, "link": "https://stackoverflow.com/questions/47160289/i-cant-seem-to-get-rdkafka-to-play-nice-with-the-confuent-kafka-go-package", "title": "I can&#39;t seem to get rdkafka to play nice with the confuent-kafka-go package", "body": "<p>this is my first question on StackOverflow. Usually I find a solution from someone else's question but this time the internet does not seem to have many answers.</p>\n\n<p>So I'm getting this message after using <code>go get</code> and every time I try and compile and run my application.</p>\n\n<pre><code># pkg-config --cflags rdkafka \nPackage rdkafka was not found in the pkg-config\nsearch path. Perhaps you should add the directory containing `rdkafka.pc'\nto the PKG_CONFIG_PATH environment variable Package 'rdkafka', required by \n'virtual:world', not found\n</code></pre>\n\n<p>I searched the issues on the <a href=\"https://github.com/confluentinc/confluent-kafka-go/issues/61\" rel=\"nofollow noreferrer\">github page</a> for the repo and found one thread related to this, but none of those solutions seem to work for me. I'm running fedora 26, I have go 1.9 installed.</p>\n\n<p>I've tried:</p>\n\n<ul>\n<li><code>dnf install</code></li>\n<li>Compiling from source as instructed on their README</li>\n<li><code>yum install</code> because I became desperate.</li>\n<li>Downloading and installing from the RPM</li>\n</ul>\n\n<p>Has anyone come accross this and maybe have an idea of how I can fix it?</p>\n"}, {"tags": ["json", "mongodb", "forms", "go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 2453, "user_id": 2647198, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/fhjZv.jpg?s=128&g=1", "display_name": "Vikram", "link": "https://stackoverflow.com/users/2647198/vikram"}, "is_accepted": false, "score": 0, "last_activity_date": 1510130926, "creation_date": 1510130926, "answer_id": 47175147, "question_id": 47158987, "link": "https://stackoverflow.com/questions/47158987/how-to-update-mongodb-fields-with-omitempty-flag-in-golang-structure/47175147#47175147", "title": "How to update Mongodb fields with omitempty flag in Golang structure", "body": "<p>You should use the pointer to use omitempty as follows</p>\n\n<pre><code>type Coupon struct {\n    Id               int    `json:\"id,omitempty\" bson:\"_id,omitempty\"`\n    Name             string `json:\"name,omitempty\" bson:\"name,omitempty\"`\n    Code             *string `json:\"code,omitempty\" bson:\"code,omitempty\"`\n    Description      string `json:\"description,omitempty\" bson:\"description,omitempty\"`\n    Status           *bool   `json:\"status\" bson:\"status\"`\n    MaxUsageLimit    int    `json:\"max_usage_limit,omitempty\" bson:\"max_usage_limit,omitempty\"`\n    SingleUsePerUser bool   `json:\"single_use_per_user,omitempty\" bson:\"single_use_per_user,omitempty\"`\n}\n</code></pre>\n\n<p>There is a good article to explain how points work <a href=\"https://willnorris.com/2014/05/go-rest-apis-and-pointers\" rel=\"nofollow noreferrer\">https://willnorris.com/2014/05/go-rest-apis-and-pointers</a></p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1510138476, "last_edit_date": 1510138476, "creation_date": 1510130974, "answer_id": 47175161, "question_id": 47158987, "link": "https://stackoverflow.com/questions/47158987/how-to-update-mongodb-fields-with-omitempty-flag-in-golang-structure/47175161#47175161", "title": "How to update Mongodb fields with omitempty flag in Golang structure", "body": "<p>A value of <code>bool</code> type has 2 possible values: <code>false</code> and <code>true</code>. And you want to \"communicate\" 3 different states with a <code>bool</code> field, namely to not update the field, to set the field to <code>false</code> and to set the field to <code>true</code>. This is obviously not possible.</p>\n\n<p>Same thing goes for <code>int</code> values: a value of <code>0</code> cannot represent 2 different choices, namely to not update the field and to set it to <code>0</code>.</p>\n\n<p>If you want to keep the <code>omitempty</code> options in the tag values, then to make it work, you have to change the fields to pointers:</p>\n\n<pre><code>type Coupon struct {\n    Id               *int    `json:\"id,omitempty\" bson:\"_id,omitempty\"`\n    Name             string `json:\"name,omitempty\" bson:\"name,omitempty\"`\n    Code             string `json:\"code,omitempty\" bson:\"code,omitempty\"`\n    Description      string `json:\"description,omitempty\" bson:\"description,omitempty\"`\n    Status           *bool   `json:\"status\" bson:\"status\"`\n    MaxUsageLimit    *int    `json:\"max_usage_limit,omitempty\" bson:\"max_usage_limit,omitempty\"`\n    SingleUsePerUser *bool   `json:\"single_use_per_user,omitempty\" bson:\"single_use_per_user,omitempty\"`\n}\n</code></pre>\n\n<p>The way it works is that if the pointer is <code>nil</code>, it will be left out (this is the <em>\"omitempty\"</em> option). If the field is a non-<code>nil</code> pointer, it will be updated to the pointed value.</p>\n\n<p>So for example if you want to exclude a <code>bool</code> field, then the <code>*bool</code> value should / will be <code>nil</code>. If you want to set / update it to <code>false</code>, it must be a pointer to a <code>false</code> value. If you want to set / update it to <code>true</code>, it must be a pointer to a <code>true</code> value.</p>\n\n<p>In general, any type whose <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"noreferrer\">zero value</a> is possible and should be counted with, you can only handle the \"it is being the zero value\" and \"it is missing from the input\" if you make it a pointer, and the <code>nil</code> value of the pointer will denote the \"missing from the input\" case, while a non-<code>nil</code> pointer to the zero value will denote the \"it is being the zero value\" case. So in the above example if the <code>string</code> fields could also take the empty string value (<code>\"\"</code>), then you have to also make them pointers.</p>\n\n<p>Note that you can also achieve this using custom marshaling and unmarshaling logic, but that is more cumbersome, and using pointers gives you this automatically.</p>\n"}], "owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4635, "favorite_count": 4, "accepted_answer_id": 47175161, "answer_count": 2, "score": 5, "last_activity_date": 1510211633, "creation_date": 1510060687, "last_edit_date": 1510211633, "question_id": 47158987, "link": "https://stackoverflow.com/questions/47158987/how-to-update-mongodb-fields-with-omitempty-flag-in-golang-structure", "title": "How to update Mongodb fields with omitempty flag in Golang structure", "body": "<p>I am working on a Coupon form in which I have some optional fields. </p>\n\n<p><strong>Introduction:</strong></p>\n\n<p>All the form field values are received as JSON and mapped into a Golang structure. In the structure, I have added an \"omitempty\" flag with every field. So only those form values are mapped which have some appropriate value, rest of the values like 0, \" \", false are ignored by the structure.</p>\n\n<p>Here is the Golang structure</p>\n\n<pre><code>type Coupon struct {\n    Id               int    `json:\"id,omitempty\" bson:\"_id,omitempty\"`\n    Name             string `json:\"name,omitempty\" bson:\"name,omitempty\"`\n    Code             string `json:\"code,omitempty\" bson:\"code,omitempty\"`\n    Description      string `json:\"description,omitempty\" bson:\"description,omitempty\"`\n    Status           bool   `json:\"status\" bson:\"status\"`\n    MaxUsageLimit    int    `json:\"max_usage_limit,omitempty\" bson:\"max_usage_limit,omitempty\"`\n    SingleUsePerUser bool   `json:\"single_use_per_user,omitempty\" bson:\"single_use_per_user,omitempty\"`\n}\n</code></pre>\n\n<p><strong>Problem:</strong></p>\n\n<ol>\n<li><p>When I save this form for the very first time, the form values that are appropriate are saved into the Mongodb.</p></li>\n<li><p>Now I want to update that form and suppose there is a check box, which was checked at the time of saving data. While updating form, the checkbox is unchecked and form is submitted to save. Now as I have applied \"omitempty\" flag in the structure, so its not mapping the empty value to the checkbox field. Since the value is not mapped into the structure, its not getting saved into the Database. </p></li>\n<li><p>When a user edits the form for the second time, it sees the same check box as checked. (But practically, the value should be updated to the DB and the check box should be displayed as unchecked.)</p></li>\n<li><p>I am using the same form data (in JSON format) in a REST API. In API, while updating form data, if I mention only those values which are required and don't pass the values which I don't want to update, then MongoDB is overriding the whole document with the provided required values(Even those values are also being overridden which I don't want to update as well as don't pass in the API).</p></li>\n</ol>\n\n<p><strong>Requirement:</strong></p>\n\n<p>In future, I want to expose the REST API, So I don't want this thing to be happened there. That is why I don't want to remove \"omitempty\" flag from the structure fields. </p>\n\n<p>Is there any way to save the empty form values or API data fields to the DB while using omitempty flag in the structure?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["git", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1510061038, "post_id": 47158686, "comment_id": 81267547, "body": "You can see the git command being executed, and the git output from that command which you could try manually, so it certainly seems like a git issue."}], "answers": [{"tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": true, "score": 2, "last_activity_date": 1510081344, "last_edit_date": 1510081344, "creation_date": 1510071607, "answer_id": 47162700, "question_id": 47158686, "link": "https://stackoverflow.com/questions/47158686/go-get-failed-first-then-worked/47162700#47162700", "title": "`go get` failed first, then worked", "body": "<p>This is caused by the repository in question using external libraries (in the vendor directory) as submodules, rather than as static vendoring, but not configuring those submodules within the .gitmodules file (which actually appears to be completely absent from that repo).  There is a known issue with <code>go get</code> and submodules:</p>\n\n<ul>\n<li><a href=\"https://github.com/golang/go/issues/12612\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/12612</a></li>\n<li><a href=\"https://github.com/golang/go/issues/12573\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/12573</a></li>\n</ul>\n\n<p>You may be able to file an issue on the repository in question and suggest they move to a static vendoring model (or use govendor's <code>fetch</code> utility or similar with an ignored <code>/vendor/*/</code> pattern).  They aren't the first repo to run into this issue:</p>\n\n<ul>\n<li><a href=\"https://github.com/digitalocean/doctl/issues/150\" rel=\"nofollow noreferrer\">https://github.com/digitalocean/doctl/issues/150</a></li>\n<li><a href=\"https://github.com/go-mgo/mgo/issues/307\" rel=\"nofollow noreferrer\">https://github.com/go-mgo/mgo/issues/307</a></li>\n<li><a href=\"https://github.com/ipfs/fs-repo-migrations/issues/26\" rel=\"nofollow noreferrer\">https://github.com/ipfs/fs-repo-migrations/issues/26</a></li>\n</ul>\n\n<p>Even github itself seems to generally recommend against using submodules anymore:</p>\n\n<p><a href=\"https://github.com/blog/2104-working-with-submodules\" rel=\"nofollow noreferrer\">https://github.com/blog/2104-working-with-submodules</a></p>\n\n<blockquote>\n  <p>Before you add a repository as a submodule, first check to see if you have a better alternative available. Git submodules work well enough for simple cases, but these days there are often better tools available for managing dependencies than what Git submodules can offer.</p>\n</blockquote>\n"}], "owner": {"reputation": 303, "user_id": 7218204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37f53b977ee47a6cf9a43b88615ddd89?s=128&d=identicon&r=PG&f=1", "display_name": "Dah", "link": "https://stackoverflow.com/users/7218204/dah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 47162700, "answer_count": 1, "score": -3, "last_activity_date": 1510081344, "creation_date": 1510059712, "question_id": 47158686, "link": "https://stackoverflow.com/questions/47158686/go-get-failed-first-then-worked", "title": "`go get` failed first, then worked", "body": "<p>The go command <code>go get github.com/cloudnativego/gogo-service/service</code> failed first, but then passed on the second run. </p>\n\n<p>Entire sequence of events:</p>\n\n<pre><code>   [23:47]$ go get github.com/cloudnativego/gogo-service/service\n    # cd /Users/../github.com/cloudnativego/gogo-service; git submodule update --init --recursive\n    No submodule mapping found in .gitmodules for path 'vendor/github.com/cloudfoundry-community/go-cfenv'\n    package github.com/cloudnativego/gogo-service/service: exit status 1\n   [23:48]$ go get github.com/cloudnativego/gogo-service/service\n   [23:49]$ #worked\n   [23:49]$ ll vendor/github.com/\n    total 0\n    drwxr-xr-x  3 _  staff  102 Nov  2 22:48 .\n    drwxr-xr-x  3 _  staff  102 Nov  2 22:48 ..\n    drwxr-xr-x  3 _  staff  102 Nov  2 22:48 codegangsta\n   [23:49]$\n</code></pre>\n\n<p>Is this a git issue or <code>go get</code> flakiness, or expected behavior?</p>\n"}, {"tags": ["networking", "go", "udp", "multicast", "udpclient"], "answers": [{"comments": [{"owner": {"reputation": 1160, "user_id": 1818122, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/Btws1.jpg?s=128&g=1", "display_name": "The_Cute_Hedgehog", "link": "https://stackoverflow.com/users/1818122/the-cute-hedgehog"}, "edited": false, "score": 0, "creation_date": 1510060958, "post_id": 47157501, "comment_id": 81267490, "body": "Thank you. How about taking the listener into a goroutine? Is it ok?"}, {"owner": {"reputation": 98, "user_id": 8862808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41b7e30f64c8992897bd2668a35ede46?s=128&d=identicon&r=PG&f=1", "display_name": "lucas alcantara", "link": "https://stackoverflow.com/users/8862808/lucas-alcantara"}, "reply_to_user": {"reputation": 1160, "user_id": 1818122, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/Btws1.jpg?s=128&g=1", "display_name": "The_Cute_Hedgehog", "link": "https://stackoverflow.com/users/1818122/the-cute-hedgehog"}, "edited": false, "score": 1, "creation_date": 1510061478, "post_id": 47157501, "comment_id": 81267871, "body": "Well, It depends. As you mentioned before your program does also others things and you don&#39;t want the application waiting just for the packets, right? if so, yeah you can put in a goroutine ;) otherwise, I think is better let in the main thread."}, {"owner": {"reputation": 1160, "user_id": 1818122, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/Btws1.jpg?s=128&g=1", "display_name": "The_Cute_Hedgehog", "link": "https://stackoverflow.com/users/1818122/the-cute-hedgehog"}, "edited": false, "score": 0, "creation_date": 1510067796, "post_id": 47157501, "comment_id": 81272230, "body": "After taking the listener into a goroutine, is it a good idea to spawn (call) another goroutine to process the received bytes inside the listener routine?"}, {"owner": {"reputation": 98, "user_id": 8862808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41b7e30f64c8992897bd2668a35ede46?s=128&d=identicon&r=PG&f=1", "display_name": "lucas alcantara", "link": "https://stackoverflow.com/users/8862808/lucas-alcantara"}, "reply_to_user": {"reputation": 1160, "user_id": 1818122, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/Btws1.jpg?s=128&g=1", "display_name": "The_Cute_Hedgehog", "link": "https://stackoverflow.com/users/1818122/the-cute-hedgehog"}, "edited": false, "score": 1, "creation_date": 1510068667, "post_id": 47157501, "comment_id": 81272832, "body": "I cannot see why not, but just pay attention to the concurrency that might have."}], "tags": [], "owner": {"reputation": 98, "user_id": 8862808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/41b7e30f64c8992897bd2668a35ede46?s=128&d=identicon&r=PG&f=1", "display_name": "lucas alcantara", "link": "https://stackoverflow.com/users/8862808/lucas-alcantara"}, "is_accepted": false, "score": 3, "last_activity_date": 1510056137, "creation_date": 1510056137, "answer_id": 47157501, "question_id": 47157025, "link": "https://stackoverflow.com/questions/47157025/how-can-i-receive-multicast-udp-packets-asynchronously-in-golang/47157501#47157501", "title": "How can I receive multicast UDP packets asynchronously in Golang?", "body": "<p>Well, I think you could put the listener into a for declaration and every time that you receive a package from the listener you could execute what do you want in a goroutine.</p>\n\n<p>an example can be <a href=\"http://www.minaandrawos.com/2016/05/14/udp-vs-tcp-in-golang/\" rel=\"nofollow noreferrer\">here</a> and look in the section <strong>SERVER IMPLEMENTATION</strong></p>\n"}], "owner": {"reputation": 1160, "user_id": 1818122, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/Btws1.jpg?s=128&g=1", "display_name": "The_Cute_Hedgehog", "link": "https://stackoverflow.com/users/1818122/the-cute-hedgehog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 590, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1510056137, "creation_date": 1510054815, "question_id": 47157025, "link": "https://stackoverflow.com/questions/47157025/how-can-i-receive-multicast-udp-packets-asynchronously-in-golang", "title": "How can I receive multicast UDP packets asynchronously in Golang?", "body": "<p>I am trying to create an application to receive multicast UDP packets. This application does not only listen for incoming packets but also does many other tasks as well. So, I wanted to keep receiving part async. \nI program in Golang.</p>\n\n<p>Any help would be appreciated, happy coding..</p>\n"}, {"tags": ["go", "hash", "hash-collision", "gob"], "answers": [{"comments": [{"owner": {"reputation": 769, "user_id": 1245992, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3920847cf9e236c2f3e950d73e915959?s=128&d=identicon&r=PG", "display_name": "Gellweiler", "link": "https://stackoverflow.com/users/1245992/gellweiler"}, "edited": false, "score": 0, "creation_date": 1510077218, "post_id": 47162608, "comment_id": 81278495, "body": "This won&#39;t work because Hash(&quot;12&quot;, &quot;3&quot;) and Hash(&quot;123&quot;) will create the same hash (play.golang.org/p/EXcMl_lTru). This is why I was using gob in the first place. I&#39;ve clarified the question."}, {"owner": {"reputation": 769, "user_id": 1245992, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3920847cf9e236c2f3e950d73e915959?s=128&d=identicon&r=PG", "display_name": "Gellweiler", "link": "https://stackoverflow.com/users/1245992/gellweiler"}, "edited": false, "score": 0, "creation_date": 1510077880, "post_id": 47162608, "comment_id": 81278877, "body": "With JSON there might be whitespace, special characters in strings can be escaped using backspace+hex or backspace+special. Non ascii characters might get escaped or not, in floats e can be written in lowercase or uppercase, ... All that doesn&#39;t matter when using it as storage format, but as a source for hashing that&#39;s a big problem."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 769, "user_id": 1245992, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3920847cf9e236c2f3e950d73e915959?s=128&d=identicon&r=PG", "display_name": "Gellweiler", "link": "https://stackoverflow.com/users/1245992/gellweiler"}, "edited": false, "score": 0, "creation_date": 1510078467, "post_id": 47162608, "comment_id": 81279176, "body": "It doesn&#39;t matter as a source files hashing because Go encodes JSON consistently."}, {"owner": {"reputation": 769, "user_id": 1245992, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3920847cf9e236c2f3e950d73e915959?s=128&d=identicon&r=PG", "display_name": "Gellweiler", "link": "https://stackoverflow.com/users/1245992/gellweiler"}, "edited": false, "score": 0, "creation_date": 1510079111, "post_id": 47162608, "comment_id": 81279516, "body": "Yeah but that might change between versions, just as the gob serializer. If I have to choose between one of them I&#39;m going to go with gob as it is closer to actual representation of data in go and also faster."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 769, "user_id": 1245992, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3920847cf9e236c2f3e950d73e915959?s=128&d=identicon&r=PG", "display_name": "Gellweiler", "link": "https://stackoverflow.com/users/1245992/gellweiler"}, "edited": false, "score": 0, "creation_date": 1510079201, "post_id": 47162608, "comment_id": 81279569, "body": "Which I mentioned in my answer, and noted that it&#39;s less likely to change than gob."}, {"owner": {"reputation": 769, "user_id": 1245992, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3920847cf9e236c2f3e950d73e915959?s=128&d=identicon&r=PG", "display_name": "Gellweiler", "link": "https://stackoverflow.com/users/1245992/gellweiler"}, "edited": false, "score": 0, "creation_date": 1510538947, "post_id": 47162608, "comment_id": 81463180, "body": "Turns out gob doesn&#39;t support maps and overall is quite limited. So I&#39;m sticking with JSON for now. I&#39;m still not really happy with this. But I suppose it should be fine. So +1"}, {"owner": {"reputation": 769, "user_id": 1245992, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3920847cf9e236c2f3e950d73e915959?s=128&d=identicon&r=PG", "display_name": "Gellweiler", "link": "https://stackoverflow.com/users/1245992/gellweiler"}, "edited": false, "score": 0, "creation_date": 1510698796, "post_id": 47162608, "comment_id": 81544034, "body": "JSON Encoder even sorts maps by key before serializing them. So seems to be okay."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1510071822, "last_edit_date": 1510071822, "creation_date": 1510071347, "answer_id": 47162608, "question_id": 47156856, "link": "https://stackoverflow.com/questions/47156856/hashing-multiple-values-in-golang/47162608#47162608", "title": "Hashing multiple values in golang", "body": "<p><a href=\"https://golang.org/pkg/hash/#Hash\" rel=\"nofollow noreferrer\">Hash providers implement <code>io.Writer</code></a>, meaning you can just write data to them as necessary - you don't have to do it all in a single call to <code>Sum</code>:</p>\n\n<pre><code>for _,ob := range objs {\n    fmt.Fprint(digester, ob)\n}\nreturn digester.Sum(nil)\n</code></pre>\n\n<p>Working playground example: <a href=\"https://play.golang.org/p/HtObhrmoaP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/HtObhrmoaP</a></p>\n\n<p>If you need to support non-primitive types, you can use something like:</p>\n\n<pre><code>fmt.Fprintf(digester, \"%+v\", ob)\n</code></pre>\n\n<p>Or even just:</p>\n\n<pre><code>json.NewEncoder(digester).Encode(&amp;objs)\n</code></pre>\n\n<p>Like <code>gob</code>, the output of <code>json</code> <em>may</em> change between Go versions, but it seems much less likely as JSON is a very stable format with a very stable implementation.</p>\n"}, {"tags": [], "owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "is_accepted": true, "score": 4, "last_activity_date": 1510090922, "creation_date": 1510090922, "answer_id": 47167912, "question_id": 47156856, "link": "https://stackoverflow.com/questions/47156856/hashing-multiple-values-in-golang/47167912#47167912", "title": "Hashing multiple values in golang", "body": "<p>Perhaps to add to add to Adrian's answer. If you add <code>fmt.Fprintf(digester, reflect.TypeOf(ob))</code> before each object. That would make Hash(\"12\", \"3\") and Hash(\"123\") different. </p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"crypto\"\n    _ \"crypto/md5\"\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    fmt.Printf(\"%x\\n\", Hash(\"12\", \"3\"))\n    fmt.Printf(\"%x\\n\", Hash(\"123\"))\n}\n\nfunc Hash(objs ...interface{}) []byte {\n    digester := crypto.MD5.New()\n    for _, ob := range objs {\n        fmt.Fprint(digester, reflect.TypeOf(ob))\n        fmt.Fprint(digester, ob)\n    }\n    return digester.Sum(nil)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>c3d5dcf1d7540d3e46e7d7b5a8c6e8ae\n787ca7e12a2fa991cea5051a64b49d0c\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/nufD3wTJkb\" rel=\"nofollow noreferrer\">https://play.golang.org/p/nufD3wTJkb</a></p>\n"}], "owner": {"reputation": 769, "user_id": 1245992, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/3920847cf9e236c2f3e950d73e915959?s=128&d=identicon&r=PG", "display_name": "Gellweiler", "link": "https://stackoverflow.com/users/1245992/gellweiler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2210, "favorite_count": 0, "accepted_answer_id": 47167912, "answer_count": 2, "score": 2, "last_activity_date": 1510090922, "creation_date": 1510054299, "last_edit_date": 1510076820, "question_id": 47156856, "link": "https://stackoverflow.com/questions/47156856/hashing-multiple-values-in-golang", "title": "Hashing multiple values in golang", "body": "<p>I'm currently working on an application in go that needs to cache different resources. Different types of resources have handlers that will know what data is relevant to determine, if we have to rebuild a resource or if we can fetch it from cache. For this purpose handlers shall generate a hash of all relevant data for caching. Depending on the context that data can be primitives (int, float, ...), strings, slices, structs and maps. So almost everything. The number of objects used for hashing might also vary.</p>\n\n<p>To calculate that hash in handlers, I've created a hashing function with variadic parameters of type <code>interface{}</code>.</p>\n\n<p>My current approach is this:</p>\n\n<pre><code>func Hash(objs ...interface{})([]byte) {\n    // Use MD5 because it's fast and is reasonably enough protected against accidental collisions.\n    // There is no scenario here where intentional created collisions could do harm.\n    digester := crypto.MD5.New()\n\n    encoder := gob.NewEncoder(digester)\n    encoder.Encode(objs) // In real life one would handle that error\n\n    return digester.Sum(make([]byte, 0))\n}\n</code></pre>\n\n<p>This works. But there are a few things that give me headaches with this implementation. Because I'm not sure that <a href=\"https://stackoverflow.com/a/33228913/1245992\">gob will always behave deterministic</a>, for the current version that seems to be the case, but as the referenced answer points out, there might be changes between versions.\nAccording to the documentation for gob, default values (0 for ints, empty strings, nil, ...) will be omitted when transporting structs. Also all int values will be transmitted as generic numbers. So unit64 and int will be the same. I can't think of an actual issue with this for my usecase, but this smells like a source for trouble.</p>\n\n<p>Now if I would write that function from scratch I would properly play it safe, traverse the structure with reflection and create a hashing tree. But I don't want to do that. </p>\n\n<p>I'm pretty sure I'm not the first one out there with these requirements, but I wasn't able to find any well tested go code on the web, that addresses this issue.</p>\n\n<p><strong>Appendix</strong></p>\n\n<p>Also see: <a href=\"https://crypto.stackexchange.com/questions/10058/how-to-hash-a-list-of-multiple-items\">https://crypto.stackexchange.com/questions/10058/how-to-hash-a-list-of-multiple-items</a></p>\n\n<p>This is not as trivial as it may seem. Simply concatenating data as pointed out by Adrian won't work, because then <code>Hash(\"12\", \"3\")</code> and <code>Hash(\"123\")</code> will generate the same hash. One possible solution is to prepend the length of data (and the number of elements of lists) before hashing or to create a tree of hashes, but I can't think of a reliable way to do either of that with complex data structures, without writing a lot of reflection code that handles all the different cases (integers, floats, strings, structs, slices, ...) and walks through the entire structure. I want to avoid that, because there are a lot of special cases that can be overseen doing so and it seems unnecessary complicated to me. This is why I tried to solve the problem using serialization, which will take care of most of the problems described above. I'm just not sure if there are not some drawbacks of using gob in this scenario and if there isn't a smarter solution to the problem.</p>\n"}, {"tags": ["amazon-web-services", "nginx", "go", "amazon-elastic-beanstalk"], "comments": [{"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1510063343, "post_id": 47156604, "comment_id": 81269147, "body": "<code>.ebextensions&#47;nginx&#47;conf.d&#47;rate-limit.conf</code> is correct. Probably some zipping issue? or file permission issue?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510071129, "post_id": 47156604, "comment_id": 81274647, "body": "This doesn&#39;t seem to have anything to do with Go or programming, this is an AWS question entirely - try ServerFault."}], "owner": {"reputation": 441, "user_id": 2449952, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/5b7ffab915e24bd47600d36242a553fb?s=128&d=identicon&r=PG", "display_name": "user2449952", "link": "https://stackoverflow.com/users/2449952/user2449952"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 139, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1510053557, "creation_date": 1510053557, "question_id": 47156604, "link": "https://stackoverflow.com/questions/47156604/elastic-beanstalk-nigix-configuration-for-golang-app", "title": "Elastic beanstalk Nigix Configuration for Golang app", "body": "<p>I am following standard EBS config structure to override NGINX configuration as below. <strong>.ebextensions/nginx/conf.d/rate-limit.conf</strong> <strong>.ebextensions/nginx/conf.d/elasticbeanstalk/error429.conf</strong></p>\n\n<p>Not able to see the changes after deployment. Even when I SSH to the respective ec2 I dont see the expected files in </p>\n\n<p><strong>/etc/nginx/ or /etc/nginx/conf.d/elasticbeanstalk/</strong>  </p>\n\n<p>folder structure -<br>\n.ebextensions<br>\n.elasticbeanstalk<br>\n main.go<br>\n ... ...etc</p>\n"}, {"tags": ["go", "architecture", "32bit-64bit"], "answers": [{"tags": [], "owner": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "is_accepted": false, "score": -1, "last_activity_date": 1510052384, "creation_date": 1510052384, "answer_id": 47156225, "question_id": 47156038, "link": "https://stackoverflow.com/questions/47156038/golang-force-computation-at-at-run-time-rather-than-compile-time/47156225#47156225", "title": "GoLang force computation at at run-time, rather than compile-time", "body": "<p>I have found a workaround... <code>5 * GiB</code> is a constant expression, so gets computed by the compiler.</p>\n\n<p>By splitting up into multiple statements, it no longer happens.</p>\n\n<pre><code>defaultBytes := 5\nThirdPartyDriverBytes = defaultBytes * GiB\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "edited": false, "score": 0, "creation_date": 1510072772, "post_id": 47162522, "comment_id": 81275746, "body": "<code>ThirdPartyDriverBytes</code> is of type <code>int</code>. Which means that will not compile on 32bit"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "edited": false, "score": 0, "creation_date": 1510072854, "post_id": 47162522, "comment_id": 81275800, "body": "Which is why I&#39;m saying it should be declared explicitly to be an <code>int64</code>. If you need 64 bits of capacity, you should explicitly declare a 64-bit type, rather than letting the compiler pick a size (and potentially pick one too small to hold the values you need)."}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1510104177, "post_id": 47162522, "comment_id": 81289849, "body": "<i>int64 is supported on 32-bit platforms. The generated code is more than the single instruction it would be on a 64-bit platform but is reasonably efficient.  It&#39;s the same thing that C compilers do to support long long (64-bit) on 32-bit platforms. Russ</i> <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/mtnn-01Dh_I\" rel=\"nofollow noreferrer\">reference</a>"}, {"owner": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "edited": false, "score": 0, "creation_date": 1510144598, "post_id": 47162522, "comment_id": 81308624, "body": "Without maintaining a fork of the 3rd party lib or potentially setups for other users if the lib updates to use int64, this is simply not possible. <code>if strconv.IntSize != 64 {</code> that&#39;s why im asserting int is 64 bit before running. unless I am missing something? see issue raised in lib here: <a href=\"https://github.com/go-mgo/mgo/issues/512\" rel=\"nofollow noreferrer\">github.com/go-mgo/mgo/issues/512</a>"}, {"owner": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "edited": false, "score": 0, "creation_date": 1510144740, "post_id": 47162522, "comment_id": 81308728, "body": "Now given that I am forced to use <code>int</code> by the driver, not <code>int64</code> I don&#39;t see how the above soln solves the problem."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510145919, "post_id": 47162522, "comment_id": 81309481, "body": "If you&#39;re forced to use <code>int</code>, and you need to support 32 bit platforms, and you need to store integers that overflow <code>int32</code>... Then there is no solution. One of those things has to budge."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1510071086, "creation_date": 1510071086, "answer_id": 47162522, "question_id": 47156038, "link": "https://stackoverflow.com/questions/47156038/golang-force-computation-at-at-run-time-rather-than-compile-time/47162522#47162522", "title": "GoLang force computation at at run-time, rather than compile-time", "body": "<p>Just explicitly type the variable to <code>int64</code> instead of the platform-dependent <code>int</code>:</p>\n\n<pre><code>var ThirdPartyDriverBytes int64\nconst (\n    _  int64 = iota // ignore zero iota\n    KiB = 1 &lt;&lt; (10 * iota)\n    MiB\n    GiB\n    TiB\n)\n</code></pre>\n\n<p>This is clearer than trying to work around the compiler inferring types from constant expressions.</p>\n"}], "owner": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 124, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1510071086, "creation_date": 1510051816, "question_id": 47156038, "link": "https://stackoverflow.com/questions/47156038/golang-force-computation-at-at-run-time-rather-than-compile-time", "title": "GoLang force computation at at run-time, rather than compile-time", "body": "<p>I am working on a project which should be available as either 64bit or 32bit.</p>\n\n<p>Due to 3rd party driver, I am forced to work with int, rather than int64.</p>\n\n<pre><code>const (\n    _   = iota // ignore zero iota\n    KiB = 1 &lt;&lt; (10 * iota)\n    MiB\n    GiB\n    TiB\n)\n\nfunc doSomething() (ok bool) {\n    if strconv.IntSize != 64 {\n        // exiting early from function because default int is not 64bit.\n\n        return false\n    }\n\n    ThirdPartyDriverBytes = 5 * GiB\n\n    return true\n}\n</code></pre>\n\n<p>Unfortunately the compiler complains, I get a <code>constant 5368709120 overflows int</code> error.</p>\n\n<p>How can I effectively work around this issue? Is there a way I can force this 5 * GiB calculation to occur at runtime?</p>\n"}, {"tags": ["go", "printf"], "comments": [{"owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "edited": false, "score": 1, "creation_date": 1510049883, "post_id": 47155070, "comment_id": 81260044, "body": "Why do you use <code>%#[1]s</code> instead of <code>%[1]s</code>?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510050028, "post_id": 47155070, "comment_id": 81260151, "body": "What do you expect the flag <code>#</code> to do with strings <code>s</code>? What in the package documentation makes you believe # modifies the verb <code>s</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 1318, "user_id": 47121, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4ac676590d75ff7f3cf5abe3295084b3?s=128&d=identicon&r=PG", "display_name": "Trev", "link": "https://stackoverflow.com/users/47121/trev"}, "edited": false, "score": 6, "creation_date": 1538669722, "post_id": 47155628, "comment_id": 92234276, "body": "great tip, but doesn&#39;t answer the question"}], "tags": [], "owner": {"reputation": 240, "user_id": 8800369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4f69be8fda374dc3075128df3a05f37?s=128&d=identicon&r=PG", "display_name": "Hein Oldewage", "link": "https://stackoverflow.com/users/8800369/hein-oldewage"}, "is_accepted": true, "score": 4, "last_activity_date": 1510050613, "creation_date": 1510050613, "answer_id": 47155628, "question_id": 47155070, "link": "https://stackoverflow.com/questions/47155070/golang-sprintf-formatting-a-string-and-using-it-multiple-times/47155628#47155628", "title": "Golang Sprintf formatting a string and using it multiple times", "body": "<p>Using <code>printf</code> to construct queries is a bad idea, it opens you up to SQL injection.</p>\n\n<p>See named parameters in the <a href=\"https://golang.org/pkg/database/sql/#Named\" rel=\"nofollow noreferrer\">sql</a> package.</p>\n"}, {"tags": [], "owner": {"reputation": 116, "user_id": 1696780, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe6116b69ce99e0ed9928b95e6dddb5b?s=128&d=identicon&r=PG&f=1", "display_name": "AleGra", "link": "https://stackoverflow.com/users/1696780/alegra"}, "is_accepted": false, "score": 2, "last_activity_date": 1510157655, "creation_date": 1510157655, "answer_id": 47184537, "question_id": 47155070, "link": "https://stackoverflow.com/questions/47155070/golang-sprintf-formatting-a-string-and-using-it-multiple-times/47184537#47184537", "title": "Golang Sprintf formatting a string and using it multiple times", "body": "<p>There is no # Sprintf flag for a string verb (the flag # is e.g. adding 0x for hex values: %#x). So remove it to make your go vet troubles disappear:</p>\n\n<pre><code>myStr := \"test\"\nstr := Sprintf(\"SELECT ... WHERE a = '%[1]s' or b = '%[1]s'\", myStr)\nfmt.Println(str)\n</code></pre>\n\n<p>But: If any part of your constructed query (myStr) comes from external input (i.e. user input), you really should follow Hein's advise and use named parameters.</p>\n"}], "owner": {"reputation": 487, "user_id": 3004786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mQ3jy.jpg?s=128&g=1", "display_name": "huehnerhose", "link": "https://stackoverflow.com/users/3004786/huehnerhose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3467, "favorite_count": 0, "accepted_answer_id": 47155628, "answer_count": 2, "score": 1, "last_activity_date": 1510157655, "creation_date": 1510049176, "question_id": 47155070, "link": "https://stackoverflow.com/questions/47155070/golang-sprintf-formatting-a-string-and-using-it-multiple-times", "title": "Golang Sprintf formatting a string and using it multiple times", "body": "<p>I try to generate a sql query using <code>Sprintf()</code> where I have to use the same variable two times</p>\n\n<pre><code>myStr := \"test\"\nstr := Sprintf(\"SELECT ... WHERE a = '%#[1]s' or b = '%#[1]s'\", myStr)\nfmt.Println(str)\n</code></pre>\n\n<p>This snippets outputs the expected string</p>\n\n<pre><code>SELECT ... WHERE a = 'test' or b = 'test'\n</code></pre>\n\n<p>but <code>go vet</code> says:</p>\n\n<pre><code>unrecognized printf flag for verb 's': '#' (vet)\n</code></pre>\n\n<p>And I am puzzled why. Switching the printf verb to <code>v</code> satisfies <code>go vet</code> but adds <code>\"</code> around my string. And I honestly doesn't see a mistake in using <code>%#[1]s</code>.</p>\n\n<p>Any thoughts?</p>\n"}, {"tags": ["go", "ide", "goland", "goimports"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1510048365, "post_id": 47154405, "comment_id": 81259009, "body": "&quot;goimports finds unused package and removes it from imports.&quot; Then simply use the package before saving. The &quot;normal&quot; action would be to just add code like <code>fancypkg.DoStuff()</code> and have goimports add <code>import &quot;wherever.com&#47;whatnot&#47;fancypkg&quot;</code>. So where exactly is the problem?"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1510048571, "post_id": 47154405, "comment_id": 81259162, "body": "Thank you. I thought about it, but it&#39;s also not very convenient - I have to type something before save, then <code>dep ensure</code> then refresh, then type normal way."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1510049823, "post_id": 47154405, "comment_id": 81260006, "body": "Well, adding new 3rd party packages is not <i>that</i> common and should be taken serious, so I doubt this &quot;inconvenience&quot; does matter."}], "answers": [{"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 3, "last_activity_date": 1510049446, "creation_date": 1510049446, "answer_id": 47155180, "question_id": 47154405, "link": "https://stackoverflow.com/questions/47154405/how-to-disable-removing-unused-imports/47155180#47155180", "title": "How to disable removing unused imports?", "body": "<p>The correct solution would be to invoke <code>dep ensure -add package/name</code> yourself and then just start using the package without manually importing it, the IDE will figure out that you want to use that package and will add the import automatically. The current behavior you are experiencing is exactly what's expected from the IDE since <code>goimports</code> is invoked on save and because the import is not used it will be automatically removed.</p>\n"}], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1424, "favorite_count": 1, "accepted_answer_id": 47155180, "answer_count": 1, "score": 2, "last_activity_date": 1568147582, "creation_date": 1510047467, "last_edit_date": 1568147582, "question_id": 47154405, "link": "https://stackoverflow.com/questions/47154405/how-to-disable-removing-unused-imports", "title": "How to disable removing unused imports?", "body": "<p>I use <code>goimports</code> to automatically reformat my code and make it clean and also keep import in order. But sometimes it works in an incomfortable way together with IDE autosave. Like in this scenario:</p>\n\n<ol>\n<li><p>I want to add new package to my code.</p></li>\n<li><p>Then I install it with <code>dep ensure</code> and refresh my IDE cache.</p></li>\n<li><p>I can comfortably use the package with IDE autocomplete and navigation.</p></li>\n</ol>\n\n<p>What happens with <code>goimports</code> and IDE?</p>\n\n<ol>\n<li>I add new package</li>\n<li>In order to run <code>dep ensure</code> I have to save a file</li>\n<li><code>goimports</code> finds unused package and removes it from imports. Not good.</li>\n</ol>\n\n<p>Workaround:</p>\n\n<p>A. Add new package manually with <code>dep ensure -add %packagename%</code></p>\n\n<p>B. Disable <code>goimports</code> and move to <code>gofmt</code> - so-so.</p>\n\n<p>C. Do not autoformat code on save - undesirable.</p>\n\n<p>How to setup things more convenient?</p>\n\n<p>P.S. Unsure about tag <code>godeps</code> but <code>DEP</code> is definitly wrong here.</p>\n"}, {"tags": ["docker", "go"], "answers": [{"comments": [{"owner": {"reputation": 923, "user_id": 3578245, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/kfvCZ.png?s=128&g=1", "display_name": "witoong623", "link": "https://stackoverflow.com/users/3578245/witoong623"}, "edited": false, "score": 0, "creation_date": 1510062479, "post_id": 47155286, "comment_id": 81268565, "body": "Thank you for your answer.  I&#39;m so sorry that my question cause you misunderstand.  I can decode JSON data from response that is not streaming, by streaming I mean Docker will send JSON stats data periodically without closing connection i.e. send data in same connection, and it will close connection only if (from what I understand) container get deleted.  ContainerState is my custom struct that have field match JSON return from [stats API]( <a href=\"https://docs.docker.com/engine/api/v1.32/#operation/ContainerStats\" rel=\"nofollow noreferrer\">docs.docker.com/engine/api/v1.32/#operation/ContainerStats</a>) but I didn&#39;t know that it have same name as struct in GO SDK.  I updated question."}, {"owner": {"reputation": 923, "user_id": 3578245, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/kfvCZ.png?s=128&g=1", "display_name": "witoong623", "link": "https://stackoverflow.com/users/3578245/witoong623"}, "edited": false, "score": 0, "creation_date": 1510111128, "post_id": 47155286, "comment_id": 81291637, "body": "Thank you very much, it works, in my case I call decode in loop and stop it when receive stop signal.  So, Does it mean that json.Decoder knows where JSON data start and end?, for example, JSON <code>{&quot;name&quot;:&quot;witoong623&quot;}</code> Does Decoder know that where is &quot;{&quot; at the beginning of JSON and where is &quot;}&quot; at the ending of data and decode right number of bytes?"}], "tags": [], "owner": {"reputation": 3171, "user_id": 4844421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CtVSq.jpg?s=128&g=1", "display_name": "Paul Boutes", "link": "https://stackoverflow.com/users/4844421/paul-boutes"}, "is_accepted": true, "score": 4, "last_activity_date": 1510066568, "last_edit_date": 1510066568, "creation_date": 1510049747, "answer_id": 47155286, "question_id": 47154036, "link": "https://stackoverflow.com/questions/47154036/decode-json-from-stream-of-data-docker-go-sdk/47155286#47155286", "title": "Decode JSON from stream of data Docker GO SDK", "body": "<p>In your case, you have multiple options: </p>\n\n<ul>\n<li>Map the result on a custom struct</li>\n<li>Map the result on a <code>map[string]interface{}</code></li>\n</ul>\n\n<p>If you want to map by using a custom struct you can do something like this:</p>\n\n<pre><code>type myStruct struct {\n    Id      string `json:\"id\"`\n    Read    string `json:\"read\"`\n    Preread string `json:\"preread\"`\n}\n\n// perform actions to retrieve logs in stats\n//...\n\nvar containerStats myStruct\njson.NewDecoder(stats.Body).Decode(&amp;containerStats)\nfmt.Println(containerStats.Id)\n</code></pre>\n\n<p>With this solution, you have to decide which fields you want to map.</p>\n\n<p>However, if you do not want to specify fields, you can perform something like this:</p>\n\n<pre><code>//Perform actions to retrieve logs in stats\n//...\n\nvar containerStats map[string]interface{}\njson.NewDecoder(stats.Body).Decode(&amp;containerStats)\nfmt.Println(containerStats[\"id\"])\n</code></pre>\n\n<p>To conclude, if you have to manipulate your data, I recommend you to use the first solution by using custom structure.</p>\n\n<hr>\n\n<p>EDITED: handle stream</p>\n\n<p>By passing <code>stream</code> parameter to <code>true</code>, the docker api will return an <code>io.ReadCloser</code> which will be updated. Then, it's up to the caller to close the <code>io.ReadCloser</code> returned.</p>\n\n<p>What you have to do is to perdiodically read the buffer value. </p>\n\n<pre><code>type myStruct struct {\n    Id       string `json:\"id\"`\n    Read     string `json:\"read\"`\n    Preread  string `json:\"preread\"`\n    CpuStats cpu `json:\"cpu_stats\"`\n}\n\ntype cpu struct {\n    Usage cpuUsage `json:\"cpu_usage\"`\n}\n\ntype cpuUsage struct {\n    Total float64 `json:\"total_usage\"`\n}\n\nfunc main() {\n    ctx, cancel := context.WithTimeout(context.Background(), 5 * time.Second)\n    cli, e := client.NewEnvClient()\n    if e != nil {\n        panic(e)\n    }\n    stats, e := cli.ContainerStats(ctx, \"container_id\", true)\n    if e != nil {\n        fmt.Errorf(\"%s\", e.Error())\n    }\n    decoder := json.NewDecoder(stats.Body)\n    var containerStats myStruct\n    for {\n        select {\n        case &lt;-ctx.Done():\n            stats.Body.Close()\n            fmt.Println(\"Stop logging\")\n            return\n        default:\n            if err := decoder.Decode(&amp;containerStats); err == io.EOF {\n                return\n            } else if err != nil {\n                cancel()\n            }\n            fmt.Println(containerStats.CpuStats.Usage.Total)\n        }\n    }\n}\n</code></pre>\n\n<p>In this example, we are decoding the <code>stats.Body</code> ReadCloser when new data arrives, printing the total cpu usage, and closing the stream after 5 seconds.</p>\n"}], "owner": {"reputation": 923, "user_id": 3578245, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/kfvCZ.png?s=128&g=1", "display_name": "witoong623", "link": "https://stackoverflow.com/users/3578245/witoong623"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 760, "favorite_count": 1, "accepted_answer_id": 47155286, "answer_count": 1, "score": 1, "last_activity_date": 1514470335, "creation_date": 1510046224, "last_edit_date": 1510062586, "question_id": 47154036, "link": "https://stackoverflow.com/questions/47154036/decode-json-from-stream-of-data-docker-go-sdk", "title": "Decode JSON from stream of data Docker GO SDK", "body": "<p>I want to use <a href=\"https://godoc.org/docker.io/go-docker#Client.ContainerStats\" rel=\"nofollow noreferrer\">Client.ContainerStats(ctx context.Context, containerID string, stream bool)</a> method to get streaming stats of a container.<br>\nFrom what I understand, if I pass <code>true</code> to <code>stream</code> parameter, Docker will not close connection and periodically sends JSON containing stats of a container. \nHowever, I don't know how decode JSON because I don't know where JSON data start and end.</p>\n\n<p>What I'm using right now is that I don't use stream option and just fetch data periodically then decode it like this.  </p>\n\n<pre><code>stats, err := dockerClient.ContainerStats(ctx, container.ContainerID, false)\nmsgBytes, _ := ioutil.ReadAll(stats.Body)\nvar containerStats ContainerStats\nerr = json.Unmarshal(msgBytes, &amp;containerStats)\n</code></pre>\n\n<p>What I'm looking for is a function that block when I call it, then when it receives JSON data (I mean complete JSON data that can be decoded) it will return struct containing data that was decoded from JSON and then I can call that function again to get next stat without having to make a new request to Docker.  </p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 260, "user_id": 3137420, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iPL8o.jpg?s=128&g=1", "display_name": "Fontinalis", "link": "https://stackoverflow.com/users/3137420/fontinalis"}, "edited": false, "score": 0, "creation_date": 1510049710, "post_id": 47152695, "comment_id": 81259936, "body": "But since it\u2019s duplicated, you can use a  db.Where(\u201cid = ?\u201d, 1).find(&amp;us) . If the \u201cid\u201d is a primary key, you can use db.Where(IDs).find(&amp;us)."}, {"owner": {"reputation": 1041, "user_id": 7730968, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kCdXw.png?s=128&g=1", "display_name": "kenfire", "link": "https://stackoverflow.com/users/7730968/kenfire"}, "edited": false, "score": 0, "creation_date": 1510907404, "post_id": 47152695, "comment_id": 81644286, "body": "Could you tell us more context and data examples ? This might help you : <a href=\"https://stackoverflow.com/questions/2594829/finding-duplicate-values-in-a-sql-table\" title=\"finding duplicate values in a sql table\">stackoverflow.com/questions/2594829/&hellip;</a>"}], "owner": {"reputation": 133, "user_id": 5813493, "user_type": "registered", "profile_image": "https://graph.facebook.com/737597616374738/picture?type=large", "display_name": "HarrisHan", "link": "https://stackoverflow.com/users/5813493/harrishan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 362, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1527757251, "creation_date": 1510041633, "last_edit_date": 1527757251, "question_id": 47152695, "link": "https://stackoverflow.com/questions/47152695/golang-gorm-find-return-the-two-duplicate-data", "title": "Golang gorm find return the two duplicate data", "body": "<pre><code>gorm.DB.Where(\"id in (?)\", IDs).Find(&amp;us)\n</code></pre>\n\n<p>If my IDs is <code>[]int{1,1}</code> and I want to return the two duplicate data\uff0cHow can I do?\nIn my project if the IDs is <code>[]int{1,1}</code> it only return to me one data</p>\n"}, {"tags": ["go", "middleware", "httprouter"], "comments": [{"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1510035344, "post_id": 47151085, "comment_id": 81251827, "body": "just a question, do you strictly need httprouter?"}, {"owner": {"reputation": 956, "user_id": 6402561, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/1aa8dd9d8c878efcce8226aab763c0d7?s=128&d=identicon&r=PG&f=1", "display_name": "a person", "link": "https://stackoverflow.com/users/6402561/a-person"}, "reply_to_user": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1510035432, "post_id": 47151085, "comment_id": 81251869, "body": "i&#39;m new to Go and I read some articles and read that for JSON api httprouter would be fast performance and easy to use."}, {"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1510035591, "post_id": 47151085, "comment_id": 81251947, "body": "how about your middlewares, are they of this signature <code>func(http.Handler) http.Handler</code>?"}, {"owner": {"reputation": 956, "user_id": 6402561, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/1aa8dd9d8c878efcce8226aab763c0d7?s=128&d=identicon&r=PG&f=1", "display_name": "a person", "link": "https://stackoverflow.com/users/6402561/a-person"}, "reply_to_user": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1510035694, "post_id": 47151085, "comment_id": 81251987, "body": "yes.  Well, I&#39;m returning <code>httprouter.Handle</code>, and passing in <code>handle</code> of type <code>httprouter.Handle</code>."}, {"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1510035785, "post_id": 47151085, "comment_id": 81252033, "body": "can you please provide a sample code?"}, {"owner": {"reputation": 956, "user_id": 6402561, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/1aa8dd9d8c878efcce8226aab763c0d7?s=128&d=identicon&r=PG&f=1", "display_name": "a person", "link": "https://stackoverflow.com/users/6402561/a-person"}, "reply_to_user": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1510035864, "post_id": 47151085, "comment_id": 81252065, "body": "yeah.  actually, i will update my post tomorrow.  gonna work on writing this ApplyMiddleware function for now and see if it actually maybe resolves my problem.  should I close?"}, {"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 2, "creation_date": 1510035903, "post_id": 47151085, "comment_id": 81252077, "body": "see if this package could help you <a href=\"https://github.com/justinas/alice\" rel=\"nofollow noreferrer\">github.com/justinas/alice</a>"}, {"owner": {"reputation": 956, "user_id": 6402561, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/1aa8dd9d8c878efcce8226aab763c0d7?s=128&d=identicon&r=PG&f=1", "display_name": "a person", "link": "https://stackoverflow.com/users/6402561/a-person"}, "reply_to_user": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1510036029, "post_id": 47151085, "comment_id": 81252146, "body": "Wooo.. that is probably exactly what I need!  Thanks!  I&#39;m gonna try that out.  I&#39;m still gonna give this ApplyMiddleware a shot first though haha :D  THanks!  Alice seems very promising."}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1510048866, "post_id": 47151085, "comment_id": 81259358, "body": "<a href=\"https://github.com/justinas/alice\" rel=\"nofollow noreferrer\">alice</a> works very nice, here I use it within a router <a href=\"https://violetear.org/post/middleware/\" rel=\"nofollow noreferrer\">violetear.org/post/middleware</a> hope can give you some ideas."}], "answers": [{"tags": [], "owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "is_accepted": true, "score": 3, "last_activity_date": 1510039218, "creation_date": 1510039218, "answer_id": 47152065, "question_id": 47151085, "link": "https://stackoverflow.com/questions/47151085/httprouter-pass-in-many-middleware-functions/47152065#47152065", "title": "httprouter pass in many middleware functions", "body": "<p>Here is an example how I did it:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/julienschmidt/httprouter\"\n    \"github.com/justinas/alice\"\n)\n\n// m1 is middleware 1\nfunc m1(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        //do something with m1\n        log.Println(\"m1 start here\")\n        next.ServeHTTP(w, r)\n        log.Println(\"m1 end here\")\n    })\n}\n\n// m2 is middleware 2\nfunc m2(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        //do something with m2\n        log.Println(\"m2 start here\")\n        next.ServeHTTP(w, r)\n        log.Println(\"m2 end here\")\n    })\n}\n\nfunc index(w http.ResponseWriter, r *http.Request) {\n    // get httprouter.Params from request context\n    ps := r.Context().Value(\"params\").(httprouter.Params)\n    fmt.Fprintf(w, \"Hello, %s\", ps.ByName(\"name\"))\n}\n\n// wrapper wraps http.Handler and returns httprouter.Handle\nfunc wrapper(next http.Handler) httprouter.Handle {\n    return func(w http.ResponseWriter, r *http.Request, ps httprouter.Params) {\n        //pass httprouter.Params to request context\n        ctx := context.WithValue(r.Context(), \"params\", ps)\n        //call next middleware with new context\n        next.ServeHTTP(w, r.WithContext(ctx))\n    }\n}\n\nfunc main() {\n    router := httprouter.New()\n\n    chain := alice.New(m1, m2)\n\n    //need to wrap http.Handler to be compatible with httprouter.Handle\n    router.GET(\"/user/:name\", wrapper(chain.ThenFunc(index)))\n\n    log.Fatal(http.ListenAndServe(\":9000\", router))\n}\n</code></pre>\n\n<p>Link to code (you can't run it from <code>play.golang.org</code> though): <a href=\"https://play.golang.org/p/BOCt97xcoY\" rel=\"nofollow noreferrer\">https://play.golang.org/p/BOCt97xcoY</a></p>\n"}], "owner": {"reputation": 956, "user_id": 6402561, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/1aa8dd9d8c878efcce8226aab763c0d7?s=128&d=identicon&r=PG&f=1", "display_name": "a person", "link": "https://stackoverflow.com/users/6402561/a-person"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1029, "favorite_count": 1, "accepted_answer_id": 47152065, "answer_count": 1, "score": 2, "last_activity_date": 1592531079, "creation_date": 1510035063, "last_edit_date": 1592531079, "question_id": 47151085, "link": "https://stackoverflow.com/questions/47151085/httprouter-pass-in-many-middleware-functions", "title": "httprouter pass in many middleware functions", "body": "<p>I'm coming from node express, and I was able to pass in as many middleware as possible, for example:  <code>routes.use('/*', ensureAuth, logImportant, ... n);</code></p>\n\n<p>How can I do something similar when using <code>r.GET(\"/\", HomeIndex)</code>?</p>\n\n<p>Am I forced to do something like <code>EnsureAuth(HomeIndex)</code>?  Because I can get that to work.  Unfortunately, I'm not sure what would be a good way to add as many middlewares as I want without chaining functions together.</p>\n\n<p>Is there a more elegant way so I could somehow use variadic type function to do <code>r.GET(\"/\", applyMiddleware(HomeIndex, m1, m2, m3, m4)</code>?  I'm trying that out right now, but I feel like there's a better way to do this.</p>\n\n<p>I've looked at the httprouter issues page, can't find anything :(</p>\n\n<p>Thanks! </p>\n"}, {"tags": ["java", "go", "protocol-buffers", "protoc"], "answers": [{"tags": [], "owner": {"reputation": 31, "user_id": 6820927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/001b78b0ef8fe92a4ce084ef489a84bf?s=128&d=identicon&r=PG&f=1", "display_name": "Anteoy", "link": "https://stackoverflow.com/users/6820927/anteoy"}, "is_accepted": false, "score": 0, "last_activity_date": 1510026986, "creation_date": 1510026986, "answer_id": 47149723, "question_id": 47149474, "link": "https://stackoverflow.com/questions/47149474/protoc-gen-java-code-use-inline-object-prompt-syntax-error/47149723#47149723", "title": "protoc-gen-java code use Inline object prompt syntax error", "body": "<p>I solved the problem. Fix it by:</p>\n\n<h2>reason:</h2>\n\n<pre><code>message CascadeStuGRPC {\n    RequestRStudentStruct requestRStudentStruct =1 ;\n    RequestRTeachingAssistantStruct requestRTeachingAssistantStruct = 2;\n    RequestRSchoolStruct    SchoolLogin = 3;\n    RequestRClassStruct     Class = 4;\n}\n\nmessage RepGetClassBySchoolD {\n    RequestRClassStruct    Class = 1;\n}\n</code></pre>\n\n<p>It's just because what I define two message with common name \"Class\",I have been using this in golang for a long time, and it will not go wrong,but in proto-gen-jave it,It will produce this error.</p>\n\n<h2>fix:</h2>\n\n<p>just fix it by another name like this:</p>\n\n<pre><code>message CascadeStuGRPC {\n    RequestRStudentStruct requestRStudentStruct =1 ;\n    RequestRTeachingAssistantStruct requestRTeachingAssistantStruct = 2;\n    RequestRSchoolStruct    SchoolLogin = 3;\n    RequestRClassStruct     ClassCa = 4;\n}\n\nmessage RepGetClassBySchoolD {\n    RequestRClassStruct    ClassSch = 1;\n}\n</code></pre>\n\n<p>it gen like this:</p>\n\n<pre><code> public com.class100.service.usercenter.RequestRClassStruct getClassCa() {\nreturn classCa_ == null ? com.class100.service.usercenter.RequestRClassStruct.getDefaultInstance() : classCa_;}\n</code></pre>\n\n<p>It gen getClassCa() not getClass(),This problem is solved.</p>\n"}], "owner": {"reputation": 31, "user_id": 6820927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/001b78b0ef8fe92a4ce084ef489a84bf?s=128&d=identicon&r=PG&f=1", "display_name": "Anteoy", "link": "https://stackoverflow.com/users/6820927/anteoy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1510026986, "creation_date": 1510025158, "question_id": 47149474, "link": "https://stackoverflow.com/questions/47149474/protoc-gen-java-code-use-inline-object-prompt-syntax-error", "title": "protoc-gen-java code use Inline object prompt syntax error", "body": "<h2>describe</h2>\n\n<p>I want to use java to call golang grpc.I used the old golang's consumer_proto.proto to gen java code</p>\n\n<h2>process</h2>\n\n<pre><code>protoc  --java_out=/home/xxx/src/main/java custom_proto.proto  \n\nprotoc --plugin=protoc-gen-grpc-java=/home/xxx/protoc-gen-grpc-java-1.7.0-linux-x86_64.exe --grpc-java_out=/home/xxx/main/java custom_proto.proto\n</code></pre>\n\n<h2>result</h2>\n\n<p>I success gen my proto java file.but I find use Inline object prompt syntax error,the problem is from:</p>\n\n<pre><code>message RepGetClassBySchoolD {\n     RequestRClassStruct     Class = 1;\n}\n</code></pre>\n\n<p>the error is:</p>\n\n<pre><code>getClass() in xx classes in 'java.lang.Object';attempting to use incompatible return type\n</code></pre>\n\n<p>when I run the code,The error is:</p>\n\n<pre><code>Error:(92, 62) java: com.xxx.RepGetClassBySchoolD getClass() Unable to cover java.lang.Object's getClass()\n</code></pre>\n\n<p>The method to be overwritten is final</p>\n\n<p>It happend at class RepGetClassBySchoolD:</p>\n\n<pre><code>public com.class100.service.usercenter.RequestRClassStruct getClass() {\nreturn class_ == null ? com.class100.service.usercenter.RequestRClassStruct.getDefaultInstance() : class_;\n</code></pre>\n\n<p>}</p>\n\n<p>Is there a way to make this work? Or any ideas? thanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1510019540, "post_id": 47148724, "comment_id": 81247508, "body": "You normally use a single GOPATH for all projects. See <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1510061200, "post_id": 47148724, "comment_id": 81267669, "body": "I didn\u2019t down vote the question, but this does seem like you should be starting be reading the official documentation first."}], "answers": [{"comments": [{"owner": {"reputation": 441, "user_id": 5260053, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh4.googleusercontent.com/-PB4V5H2o0t8/AAAAAAAAAAI/AAAAAAAAACA/d_G7amrFCfo/photo.jpg?sz=128", "display_name": "march_seven", "link": "https://stackoverflow.com/users/5260053/march-seven"}, "edited": false, "score": 0, "creation_date": 1510035078, "post_id": 47148795, "comment_id": 81251709, "body": "\uff0c so whenever there is a new project to setup\uff0c we also need to add the project directory into the GOPATH\uff0c is it\uff1f  but although the calc.go import &quot;os&quot; import &quot;fmt&quot; import &quot;calcproj/simplemath&quot; import &quot;strconv&quot;  why does it not work ?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 441, "user_id": 5260053, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh4.googleusercontent.com/-PB4V5H2o0t8/AAAAAAAAAAI/AAAAAAAAACA/d_G7amrFCfo/photo.jpg?sz=128", "display_name": "march_seven", "link": "https://stackoverflow.com/users/5260053/march-seven"}, "edited": false, "score": 4, "creation_date": 1510044522, "post_id": 47148795, "comment_id": 81256433, "body": "@march_seven No. Keep it simple. Do like How to Writing Go Code (<a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a>) tells you to do. Have one and only one entry in GOPATH. Everything from one &quot;project&quot; goes into $GOPATH/src/&lt;projectpath&gt;. You import stuff from &quot;project&quot; A into &quot;project&quot; B by <code>import &quot;projectpath-of-a&quot;</code>. Read How to Write GO code <i>now</i>. Then once more."}, {"owner": {"reputation": 441, "user_id": 5260053, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh4.googleusercontent.com/-PB4V5H2o0t8/AAAAAAAAAAI/AAAAAAAAACA/d_G7amrFCfo/photo.jpg?sz=128", "display_name": "march_seven", "link": "https://stackoverflow.com/users/5260053/march-seven"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1510101198, "post_id": 47148795, "comment_id": 81289116, "body": "@Volker as Frandk Bryce show the snippet upstairs\uff0c my project is set up into  src/calcproj\uff0c and there is two directory below  it \uff0c E:/Goworks/src/calcproj/calc/calc.go and E:/Goworks/src/calcproj/simplemath/add.go ; GOPATH is :E:/Goworks; but it seems not works. (while I delete calcporj directory , it is OK,)  but my purpose is that  calc directory and simplemath directory are the same project which need to put into the same directory.~~~ so could you tell me what is wrong with it ?thanks"}, {"owner": {"reputation": 6841, "user_id": 3960399, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/c5OVT.jpg?s=128&g=1", "display_name": "Frank Bryce", "link": "https://stackoverflow.com/users/3960399/frank-bryce"}, "edited": false, "score": 0, "creation_date": 1510107176, "post_id": 47148795, "comment_id": 81290536, "body": "You need to include &quot;calcproj/simplemath&quot; and &quot;calcproj/calc&quot; in your imports"}, {"owner": {"reputation": 441, "user_id": 5260053, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh4.googleusercontent.com/-PB4V5H2o0t8/AAAAAAAAAAI/AAAAAAAAACA/d_G7amrFCfo/photo.jpg?sz=128", "display_name": "march_seven", "link": "https://stackoverflow.com/users/5260053/march-seven"}, "edited": false, "score": 0, "creation_date": 1510197998, "post_id": 47148795, "comment_id": 81335926, "body": "@FrankBryce  add &quot;calcproj/simplemath&quot; in the calc.go is OK\uff0cbut when add  &quot;calcproj/calc&quot; in calc.go  imports,  there is a error show in the top of calc,go that package main ====&gt; &quot;can&#39;t load package :import cycle not allowed package calcproj/calc&quot;"}, {"owner": {"reputation": 6841, "user_id": 3960399, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/c5OVT.jpg?s=128&g=1", "display_name": "Frank Bryce", "link": "https://stackoverflow.com/users/3960399/frank-bryce"}, "edited": false, "score": 0, "creation_date": 1510325557, "post_id": 47148795, "comment_id": 81400863, "body": "You don&#39;t need to add a reference to the package that you&#39;re currently in"}], "tags": [], "owner": {"reputation": 6841, "user_id": 3960399, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/c5OVT.jpg?s=128&g=1", "display_name": "Frank Bryce", "link": "https://stackoverflow.com/users/3960399/frank-bryce"}, "is_accepted": false, "score": 1, "last_activity_date": 1510021267, "last_edit_date": 1592644375, "creation_date": 1510019799, "answer_id": 47148795, "question_id": 47148724, "link": "https://stackoverflow.com/questions/47148724/how-to-setup-or-maybe-storing-go-project-with-gopath/47148795#47148795", "title": "how to setup \uff08or maybe storing\uff09 Go project with GOPATH", "body": "<p>How does <code>GOPATH</code> work?  <code>GOPATH</code> is where go will look for local dependencies to build your application.  This is like the root namespace of your workspace where you are coding.  If you change your code location, you likely will want to change your <code>GOPATH</code>, too.</p>\n<p>What is the best way to setup the GO project across with <code>GOPATH</code>? <a href=\"https://github.com/golang/go/wiki/Setting-GOPATH#windows\" rel=\"nofollow noreferrer\">This wiki article has your answer</a></p>\n<p>I'd recommend going there and following breadcrumbs if it's moved since I've answered this.  However, in case it's not available as you're reading, this is a snippet</p>\n<blockquote>\n<p>Your workspace can be located wherever you like, but we'll use C:\\work in this example. Note that GOPATH must not be the same path as your Go installation.</p>\n<ul>\n<li>Create folder at C:\\work.</li>\n<li>Right click on &quot;Start&quot; and click on &quot;Control Panel&quot;. Select &quot;System and Security&quot;, then click on &quot;System&quot;.</li>\n<li>From the menu on the left, select the &quot;Advanced systems settings&quot;.</li>\n<li>Click the &quot;Environment Variables&quot; button at the bottom.</li>\n<li>Click &quot;New&quot; from the &quot;User variables&quot; section.</li>\n<li>Type GOPATH into the &quot;Variable name&quot; field.</li>\n<li>Type C:\\work into the &quot;Variable value&quot; field.</li>\n<li>Click OK.</li>\n</ul>\n</blockquote>\n<p>I think for your case, you are adding <code>C:\\workspace\\golang\\...\\projectname1;C:\\workspace\\golang\\...\\projectname2;...</code> instead of just using <code>C:\\workspace</code> as your <code>GOPATH</code>.  Keep in mind that this assumes you are using a common namespace for all of your projects, so you'll need to include the <code>\\golang\\...</code> part of the path in your <code>import</code> section.  If you want to exclude the <code>\\golang\\</code> part of your package paths, then include that in your <code>GOPATH</code>.</p>\n"}], "owner": {"reputation": 441, "user_id": 5260053, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh4.googleusercontent.com/-PB4V5H2o0t8/AAAAAAAAAAI/AAAAAAAAACA/d_G7amrFCfo/photo.jpg?sz=128", "display_name": "march_seven", "link": "https://stackoverflow.com/users/5260053/march-seven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 832, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1510021267, "creation_date": 1510019303, "question_id": 47148724, "link": "https://stackoverflow.com/questions/47148724/how-to-setup-or-maybe-storing-go-project-with-gopath", "title": "how to setup \uff08or maybe storing\uff09 Go project with GOPATH", "body": "<p>I am not clear of the relationship between GO project with GOPATH. although i have refer so many cases.</p>\n\n<p>I have found there are two solutions</p>\n\n<ol>\n<li>reset(or add something new) the GOPATH when there is a new project need to be add\nD:\\workspace\\golang\\calcproj;D:\\workspace\\golang\\golearning;D:\\workspace\\golang\\rpcclient;D:\\workspace\\golang\\rpcserver</li>\n</ol>\n\n<p><a href=\"https://i.stack.imgur.com/8LSeI.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/8LSeI.png\" alt=\"enter image description here\"></a></p>\n\n<ol start=\"2\">\n<li>just set a only one GOPATH forever, and just modified the code about import\nD:\\workspace\\golang</li>\n</ol>\n\n<p><a href=\"https://i.stack.imgur.com/ygzhv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ygzhv.png\" alt=\"enter image description here\"></a></p>\n\n<p>and when i try to follow the solution 2 to setup the project in Window OS, i always get a error info\uff1a<strong>can't load package: package calc:</strong></p>\n\n<p>my GOPATH : E:\\GoWorks \uff0c and Go Project file directory is like below\uff1a</p>\n\n<p><a href=\"https://i.stack.imgur.com/ua4y1.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ua4y1.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>i don't like the solution 1\uff0cbecause we need to change the GOPATH every time, when there is a new project~~</p>\n\n<p>Q1. but how to build a project as like the other solution\uff1f</p>\n\n<p>Q2. anyway how does GOPATH works \uff1f </p>\n\n<p>Q3. what is the best way to setup the GO project across with GOPATH</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 4, "last_activity_date": 1510017665, "last_edit_date": 1510017665, "creation_date": 1510017210, "answer_id": 47148420, "question_id": 47148391, "link": "https://stackoverflow.com/questions/47148391/golang-composite-literal-uses-unkeyed-fields/47148420#47148420", "title": "GOLANG: composite literal uses unkeyed fields", "body": "<p>I think you are wanting to do</p>\n\n<pre><code>t2 := catalog.Time(t)\n</code></pre>\n\n<p>You have declared <code>catalog.Time</code> as a type with an <a href=\"https://golang.org/ref/spec#Types\" rel=\"nofollow noreferrer\">underlying type</a> of <code>time.Time</code>, so to convert between them you need to do <code>catalog.Time(time.Time)</code>.</p>\n\n<p>Currently you have written it as if you had an <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow noreferrer\">embedded type</a>, which would only work if you had</p>\n\n<pre><code>type Time struct {\n    time.Time\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/zbwf6ZfvX3\" rel=\"nofollow noreferrer\">https://play.golang.org/p/zbwf6ZfvX3</a></p>\n"}], "owner": {"reputation": 97, "user_id": 3926117, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/97cab7a986695d1ccc6d2c8ec7ccbc85?s=128&d=identicon&r=PG&f=1", "display_name": "JimF", "link": "https://stackoverflow.com/users/3926117/jimf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5231, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1510017665, "creation_date": 1510017028, "question_id": 47148391, "link": "https://stackoverflow.com/questions/47148391/golang-composite-literal-uses-unkeyed-fields", "title": "GOLANG: composite literal uses unkeyed fields", "body": "<p>I've been given the following code:</p>\n\n<pre><code>package catalog\n...\ntype Time time.Time\nfunc (t Time) MarshalJSON() ([]byte, error) {\n   got := time.Time(t)\n   stamp := fmt.Sprintf(\"\\\"%s\\\"\", got.In(time.UTC).Format(\"2006-01-02T15:04:05.000Z\"))\n   return []byte(stamp), nil\n}\n</code></pre>\n\n<p>and I'm trying to use it like:</p>\n\n<pre><code>package main\n\nfunc main() {\n   ...\n   t := *a.StartTime  &lt;&lt;== This returns a time.Time\n   t2 := catalog.Time{t}\n}\n</code></pre>\n\n<p>And, I get the following error:</p>\n\n<pre><code>catalog.Time composite literal uses unkeyed fields\nimplicit assignment of unexported field 'wall' in catalog.Time literal\ncannot use t (type time.Time) as type uint64 in field value\ntoo few values in structure initializer\nimport (catalog \".../go-catalog-types.git\")\n</code></pre>\n\n<p>I've also tried: t2 := catalog.Time{Time: t} and several other variations.  Any suggestions?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["http", "go", "url-routing", "httprouter"], "answers": [{"comments": [{"owner": {"reputation": 89, "user_id": 7408217, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b9d13777f846f90a6a147e7f8e64fb7b?s=128&d=identicon&r=PG&f=1", "display_name": "o0o0o0o0o", "link": "https://stackoverflow.com/users/7408217/o0o0o0o0o"}, "edited": false, "score": 0, "creation_date": 1510035108, "post_id": 47148328, "comment_id": 81251723, "body": "Thank you this is exactly the only way I could see it working, but very helpful with the code example with how you integrate it with error checking etc. I&#39;ll look more into Go caching options as well, I assume Memcached / Redis."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1510017142, "last_edit_date": 1510017142, "creation_date": 1510016572, "answer_id": 47148328, "question_id": 47148240, "link": "https://stackoverflow.com/questions/47148240/correct-way-to-match-url-path-to-page-name-with-url-routing-in-go/47148328#47148328", "title": "Correct way to match URL path to page name with URL routing in Go?", "body": "<p>Here's how to do it with the net/http router assuming that everything after <code>/articles/animals/</code> in the path is the id of an article:</p>\n\n<p>Register the handler using a trailing slash for match on all paths with the prefix `/articles/animals/':</p>\n\n<pre><code>mux.HandleFunc(\"/articles/animals/\", animalHandler)\n</code></pre>\n\n<p>In the handler, strip the <code>/articles/animals/</code> to get the id of the article. Look up the article in the database. Respond with 404 if not there.</p>\n\n<pre><code>func animalHandler(w http.ResponseWriter, r *http.Request) {\n  id := strings.TrimPrefix(r.URL.Path, \"/articles/animals/\"))\n  article, err := queryArticleByID(id) \n  if err == errNotFound {\n     http.Error(w, \"internal error\", http.StatusNotFound)\n     return\n  } else if err != nil {\n     log.Println(err)\n     http.Error(w, \"internal error\", http.StatusInternalError)\n  }\n  ... render the article\n}\n</code></pre>\n\n<p>This example assumes that the <code>queryArticleByID()</code> function queries the database and returns <code>errNotFound</code> if no article is present for the give id.</p>\n\n<p>Regarding caching:  The <code>queryArticleByID()</code> can check a cache before querying the database. Any caching is independent of how routing is handled. </p>\n"}], "owner": {"reputation": 89, "user_id": 7408217, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b9d13777f846f90a6a147e7f8e64fb7b?s=128&d=identicon&r=PG&f=1", "display_name": "o0o0o0o0o", "link": "https://stackoverflow.com/users/7408217/o0o0o0o0o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1012, "favorite_count": 0, "accepted_answer_id": 47148328, "answer_count": 1, "score": 0, "last_activity_date": 1510017142, "creation_date": 1510015825, "question_id": 47148240, "link": "https://stackoverflow.com/questions/47148240/correct-way-to-match-url-path-to-page-name-with-url-routing-in-go", "title": "Correct way to match URL path to page name with URL routing in Go?", "body": "<p>I'm making a Go website (small service), and didn't know how a \npage URL was verified as correct or not found 404. Eventually I learned that http request routers / multiplexers exist.</p>\n\n<p>Example:</p>\n\n<pre><code>eg.com/articles/animals/Hippos-are-aquatic-and-land-dwelling    = go to page\neg.com/articles/animals/Hippos-are-typofrifjirj     = 404 not found page\n</code></pre>\n\n<p>Right now I only see one way to do this, you somehow have a list of articles the website has, and you pass it into the router somehow. How should you get that list of articles? </p>\n\n<p>For a dynamic relational database site:\nDo you query your database for article titles, and make that a map string? </p>\n\n<p>For static files on a static website: \nyou use some http fileserver dir function in the router or net/http?</p>\n\n<p>If so, for the database, does that mean you have to query your database every single time a page is visited? Or do you store the list of articles in a file or something and update it each time a new article is made?</p>\n\n<p>Also, I would plan to use https://github.com/julienschmidt/httprouter or similar.</p>\n"}, {"tags": ["json", "go", "visual-studio-code"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510003054, "post_id": 47145492, "comment_id": 81242157, "body": "Not 100% sure but judging by the way the question is written, they want a single environment variable <code>DEV_PROP</code> whose value is the JSON they gave."}, {"owner": {"reputation": 182, "user_id": 6314736, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W3D3Q.png?s=128&g=1", "display_name": "H4xorPL", "link": "https://stackoverflow.com/users/6314736/h4xorpl"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1510008871, "post_id": 47145492, "comment_id": 81244649, "body": "oh yeah, you are probably right. Then maybe escape quotes with backslashes <code>&quot;DEV_PROP&quot;:&quot; {  \\&quot;run\\&quot;: \\&quot;app.sh\\&quot;,    \\&quot;server_port\\&quot;: \\&quot;8081\\&quot;,  \\&quot;app_url\\&quot;:\\&quot;http:&#47;&#47;localhost:3000\\&quot; }&quot;</code>"}], "tags": [], "owner": {"reputation": 182, "user_id": 6314736, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/W3D3Q.png?s=128&g=1", "display_name": "H4xorPL", "link": "https://stackoverflow.com/users/6314736/h4xorpl"}, "is_accepted": true, "score": 1, "last_activity_date": 1510076537, "last_edit_date": 1510076537, "creation_date": 1510001174, "answer_id": 47145492, "question_id": 47145313, "link": "https://stackoverflow.com/questions/47145313/insert-debug-env-json-propety-vscode/47145492#47145492", "title": "insert debug env json propety VSCode", "body": "<p>Did you try this way?</p>\n\n<pre><code>{\n    \"name\": \"Launch\",\n    \"type\": \"go\",\n    \"request\": \"launch\",\n    \"mode\": \"debug\",\n    \"remotePath\": \"\",\n    \"port\": 2345,\n    \"host\": \"127.0.0.1\",\n    \"program\": \"${fileDirname}\",\n    \"env\": {\n        \"run\": \"app.sh\",  \n        \"server_port\": \"8081\",\n        \"app_url\":\"http://localhost:3000\"\n    },\n</code></pre>\n\n<p>As shown here <a href=\"http://techbrij.com/visual-studio-code-tasks-debugging\" rel=\"nofollow noreferrer\">http://techbrij.com/visual-studio-code-tasks-debugging</a></p>\n\n<p>Also by convention environment variables should be all UPPER_CASE as shown here <a href=\"https://stackoverflow.com/a/673940/6314736\">https://stackoverflow.com/a/673940/6314736</a></p>\n\n<p>So it should look like that:</p>\n\n<pre><code>{\n    \"name\": \"Launch\",\n    \"type\": \"go\",\n    \"request\": \"launch\",\n    \"mode\": \"debug\",\n    \"remotePath\": \"\",\n    \"port\": 2345,\n    \"host\": \"127.0.0.1\",\n    \"program\": \"${fileDirname}\",\n    \"env\": {\n        \"RUN\": \"app.sh\",  \n        \"SERVER_PORT\": \"8081\",\n        \"APP_URL\":\"http://localhost:3000\"\n    }\n}\n</code></pre>\n\n<p>Also if you want to have separate launch for dev environment just copy this object and change \"name\" property to whatever you like. It should be in Configuration array.</p>\n\n<p><strong>EDIT</strong>\nAs <a href=\"https://stackoverflow.com/users/7426/adrian\">Adrian</a> pointed out, my answer to this question was wrong.\nThe correct answer is to escape double quotes with backslashes.\n<code>\"env\":{ \n\"DEV_PROP\":\"\\\"run\\\":\\\"app.sh\\\",\\\"server_port\\\":\\\"8081\\\",\\\"app_url\\\":\\\"http\n://localhost:3000\\\"}\"\n}</code></p>\n\n<p>I've tested it and it works fine.\n<a href=\"https://i.stack.imgur.com/XAe5D.png\" rel=\"nofollow noreferrer\">Picture for proof</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8557463"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 47145492, "answer_count": 1, "score": 1, "last_activity_date": 1511357237, "creation_date": 1510000552, "last_edit_date": 1511357237, "question_id": 47145313, "link": "https://stackoverflow.com/questions/47145313/insert-debug-env-json-propety-vscode", "title": "insert debug env json propety VSCode", "body": "<p>I want to configure go debug env json properties like following</p>\n\n<pre><code>DEV_PROP=\n'{\n \"run\": \"app.sh\",  \n \"server_port\": \"8081\",\n \"app_url\":\"http://localhost:3000\"\n}'\n</code></pre>\n\n<p>Ive tried to enter the following to the env but I got error </p>\n\n<pre><code>\"configurations\": [\n\n    {\n        \"name\": \"Launch\",\n        \"type\": \"go\",\n        \"request\": \"launch\",\n        \"mode\": \"debug\",\n        \"remotePath\": \"\",\n        \"port\": 2345,\n        \"host\": \"127.0.0.1\",\n        \"program\": \"${fileDirname}\",\n        \"env\": {\n\n        },\n</code></pre>\n\n<p>when I insert the DEV_PROP to the env object I got lots of error, ive tried to play with quotas without success, any idea?</p>\n"}, {"tags": ["go", "abstract-syntax-tree"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1509997154, "post_id": 47144012, "comment_id": 81239018, "body": "Can you share a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>?"}, {"owner": {"reputation": 77578, "user_id": 32914, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/50facfccdffe2e9cabaa589205959d30?s=128&d=identicon&r=PG", "display_name": "Mason Wheeler", "link": "https://stackoverflow.com/users/32914/mason-wheeler"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1509999189, "post_id": 47144012, "comment_id": 81240030, "body": "@icza That would be difficult, as there&#39;s a large amount of code involved here, scattered over several files, and even reducing it down to something simple would still involve a lot of code"}], "owner": {"reputation": 77578, "user_id": 32914, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/50facfccdffe2e9cabaa589205959d30?s=128&d=identicon&r=PG", "display_name": "Mason Wheeler", "link": "https://stackoverflow.com/users/32914/mason-wheeler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1509995238, "creation_date": 1509995238, "question_id": 47144012, "link": "https://stackoverflow.com/questions/47144012/how-do-i-increase-the-size-of-a-token-file", "title": "How do I increase the size of a token.File?", "body": "<p>I'm working on a rewriter that uses <code>go/ast</code> to add some things to a file.  Everything is working well, except for the comments, which <code>go/ast</code> is notoriously awful at.  But part of the problem seems to be that it's actively conspiring against my efforts to fix it.</p>\n\n<p>I have an insertion near the end of the file that is larger than what was left in the file.  There are a couple other <code>func</code>s after that point, and they have comments on them.  I used a visitor to calculate the appropriate <code>Pos</code> for my update and then update the remaining nodes with a new <code>Pos</code> so that they wouldn't lose their association with their comments, but now the comments are getting moved to <em>above</em> my insertion!</p>\n\n<p>After tracing through the execution, what I found is that <code>func (s *FileSet) PositionFor</code> in <code>position.go</code> is returning 0 on the position of those remaining comments, because their new <code>Pos</code> is beyond the end of the associated <code>token.File</code> data.  Well, then it looks like I need to update the <code>size</code> on that <code>token.File</code>, but it's a lower-case field so I can't do that directly, and there doesn't appear to be any method that will do it for me.  <code>size</code> appears to be immutable, only set at construction time, which is odd because other parts of the <code>token.File</code> structs can be updated.</p>\n\n<p>How in the world do I resolve this?  I just want my comments to print where they're supposed to be, but every time I think I've fixed the problem, there's some other problem lurking behind it, and now I run into an immutable problem!</p>\n"}, {"tags": ["go", "tensorflow", "nlp", "rnn"], "answers": [{"comments": [{"owner": {"reputation": 1006, "user_id": 4666785, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/YXCzR.png?s=128&g=1", "display_name": "elcomendante", "link": "https://stackoverflow.com/users/4666785/elcomendante"}, "edited": false, "score": 0, "creation_date": 1510062334, "post_id": 47143569, "comment_id": 81268470, "body": "how would you use <code>tg.Cast</code> function to convert inputText to <code>tensorflow</code> type ?. Do i need to crate root first as <code>root := tg.NewRoot()</code> and then <code>A = tg.Cast(root, A, tf.Int32)</code> ? Function info specifies: <code>Cast casts the current tensor to the requested dtype</code>. Could you explain how to convert to <code>inputText</code> to current tensor ? and what is <code>root</code> role in the conversion?"}, {"owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "reply_to_user": {"reputation": 1006, "user_id": 4666785, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/YXCzR.png?s=128&g=1", "display_name": "elcomendante", "link": "https://stackoverflow.com/users/4666785/elcomendante"}, "edited": false, "score": 1, "creation_date": 1510062793, "post_id": 47143569, "comment_id": 81268784, "body": "The root is the root of your graph. Is required because you&#39;re describing a graph. However, if you want to convert <code>inputText</code> (Go variable) to a tensor (thus to a <code>tf.Output</code> variable that holds your <code>inputText</code>), you don&#39;t have to use <code>tg.Cast</code> (that works among tensors), but you have to use <code>tg.Const</code> in order to create a <code>tf.Output</code> from a Go value"}, {"owner": {"reputation": 1006, "user_id": 4666785, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/YXCzR.png?s=128&g=1", "display_name": "elcomendante", "link": "https://stackoverflow.com/users/4666785/elcomendante"}, "edited": false, "score": 0, "creation_date": 1510063920, "post_id": 47143569, "comment_id": 81269542, "body": "thx for that, but I think this is incorrect as <code>inputText := buffer.String()</code> and <code>inputTextTensor := tg.Const(root, inputText)</code> does not match type signature of `\t<code>results := model.Exec([]tf.Output{ model.Op(&quot;output&#47;node&#47;path&#47;op&quot;, 0), \t}, map[tf.Output]*tf.Tensor{ \t\tmodel.Op(&quot;input_data&quot;, 0): inputTextTensor, \t})</code>  with error: <code>cannot use inputTextTensor (type tensorflow.Output) as type *tensorflow.Tensor in map value</code>"}, {"owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "reply_to_user": {"reputation": 1006, "user_id": 4666785, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/YXCzR.png?s=128&g=1", "display_name": "elcomendante", "link": "https://stackoverflow.com/users/4666785/elcomendante"}, "edited": false, "score": 0, "creation_date": 1510064553, "post_id": 47143569, "comment_id": 81269973, "body": "My bad, sorry. If you are going to feed the graph you don&#39;t have to define a node in the graph (that&#39;s what <code>tg.Const</code> does) but you have to create a pointer to a <code>tf.Tensor</code> using  NewTensor: <a href=\"https://godoc.org/github.com/tensorflow/tensorflow/tensorflow/go#NewTensor\" rel=\"nofollow noreferrer\">godoc.org/github.com/tensorflow/tensorflow/tensorflow/&hellip;</a>"}], "tags": [], "owner": {"reputation": 23294, "user_id": 2891324, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07d27f03cd98b59774911f8dea5ee00b?s=128&d=identicon&r=PG", "display_name": "nessuno", "link": "https://stackoverflow.com/users/2891324/nessuno"}, "is_accepted": true, "score": 1, "last_activity_date": 1510064693, "last_edit_date": 1510064693, "creation_date": 1509993634, "answer_id": 47143569, "question_id": 47142976, "link": "https://stackoverflow.com/questions/47142976/how-to-execute-dl-rnn-model-on-text-in-golang/47143569#47143569", "title": "How to execute DL - RNN model on text in golang?", "body": "<p>You can use <a href=\"https://github.com/galeone/tfgo\" rel=\"nofollow noreferrer\">tfgo</a> to easily load into Go and use a trained tensorflow model: just export the trained model using <code>tf.saved_model.builder.SavedModelBuilder</code> as shown in the <code>tfgo</code> README.</p>\n\n<p>However, you just have to extract from the graph the input placeholder and then feed the network using it.</p>\n\n<p>Let's suppose you exported your model calling it <code>my_model</code> and tagged it with the tag <code>tag</code>. Also let's suppose that your input placeholder is named \"Placeholder\". Moreover, you have to know the name of your output node. Let's call it <code>output/node/path/op</code>. Then your code should look like:</p>\n\n<pre><code>import (\n        \"fmt\"\n        tg \"github.com/galeone/tfgo\"\n        tf \"github.com/tensorflow/tensorflow/tensorflow/go\"\n        \"flags\"\n)\n\nfunc main() {\n        model := tg.LoadModel(\"my_model\", []string{\"tag\"}, nil)\n\n        // Buffer input text\n        var buffer bytes.Buffer\n        args := os.Args[1:]\n\n        for _, arg := range args {\n            buffer.WriteString(arg + \" \")\n        }\n        // handle the retunred error below, if any\n        inputText, _ := tf.NewTensor(buffer.String())\n\n        results := model.Exec([]tf.Output{\n                model.Op(\"output/node/path/op\", 0),\n        }, map[tf.Output]*tf.Tensor{\n                model.Op(\"Placeholder\", 0): inputText,\n        })\n        // do something with results[0]\n}\n</code></pre>\n"}], "owner": {"reputation": 1006, "user_id": 4666785, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/YXCzR.png?s=128&g=1", "display_name": "elcomendante", "link": "https://stackoverflow.com/users/4666785/elcomendante"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 525, "favorite_count": 0, "accepted_answer_id": 47143569, "answer_count": 1, "score": 0, "last_activity_date": 1510064693, "creation_date": 1509991102, "question_id": 47142976, "link": "https://stackoverflow.com/questions/47142976/how-to-execute-dl-rnn-model-on-text-in-golang", "title": "How to execute DL - RNN model on text in golang?", "body": "<p>I have build <code>RNN</code> model in <code>tensor-flow</code> based on reddit/twitter conversations. I saved it in <code>pb</code>. Does anyone know how to pass raw text string through the model in <code>golang</code> and produce output?  </p>\n\n<pre><code>modeldir := \"/my_model.pb\"\n\n// Buffer input text\nvar buffer bytes.Buffer\n\nargs := os.Args[1:]\n\nfor _, arg := range args {\n    buffer.WriteString(arg + \" \")\n}\n\ninputText := buffer.String()\n\n// Load the serialized GraphDef from a file.\n\nmodel, err := ioutil.ReadFile(modeldir)\nif err != nil {\n    log.Fatal(err)\n}\n// Construct an in-memory graph from the serialized form.\ngraph := tf.NewGraph()\nif err := graph.Import(model, \"\"); err != nil {\n    log.Fatal(err)\n}\n// Create a session for inference over graph.\nsession, err := tf.NewSession(graph, nil)\nif err != nil {\n    log.Fatal(err)\n}\ndefer session.Close()\n</code></pre>\n"}, {"tags": ["string", "variables", "go", "split", "substring"], "comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1509985748, "post_id": 47141284, "comment_id": 81232806, "body": "That&#39;s pretty well how you do it, tbh.  That said, if you&#39;re getting it in as a comma-separated list, why aren&#39;t you manipulated it as a slice of ints?  You could convert in a loop that way.  Seems like a code smell issue.  Also, don&#39;t ignore the error returns from <code>Aoti</code> (though you may have just been doing that to compact your example code)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1509986004, "post_id": 47141284, "comment_id": 81232977, "body": "If you want the results in local variables <code>sw</code>, <code>rw</code>, and <code>pw</code>, then this is the way to do it. If you want a slice of values, the code would be cleaner, but you wouldn&#39;t have your set of local variables with individual values."}, {"owner": {"reputation": 576, "user_id": 2409784, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7f5f21a00e1779c1082d8c24fc877630?s=128&d=identicon&r=PG", "display_name": "Karol Babioch", "link": "https://stackoverflow.com/users/2409784/karol-babioch"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1509990069, "post_id": 47141284, "comment_id": 81235445, "body": "@Kaedys Yes, i&#39;m ignoring it only to keep it short. I&#39;m writing a program and the interface is specified in the this way and out of scope, so I have to deal with this format. sw, rw, pw have a special meaning and it makes more sense to keep them separately."}], "answers": [{"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1509985783, "post_id": 47141520, "comment_id": 81232836, "body": "Or a slice.  Since a map[int]int is functionally identical to a slice, except less efficient."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1509985952, "post_id": 47141520, "comment_id": 81232946, "body": "Also the code is invalid, and sets each element of the map equal to its key, which doesn&#39;t seem to be what&#39;s desired."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1509986749, "post_id": 47141520, "comment_id": 81233432, "body": "@Adrian, code is not invalid :) - it\u2019s an example how to deal with such values"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1509989033, "post_id": 47141520, "comment_id": 81234841, "body": "Again, both versions are examples, first illustrates the principle. Second - usage. I\u2019ve edited so people could easily understand."}, {"owner": {"reputation": 576, "user_id": 2409784, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7f5f21a00e1779c1082d8c24fc877630?s=128&d=identicon&r=PG", "display_name": "Karol Babioch", "link": "https://stackoverflow.com/users/2409784/karol-babioch"}, "edited": false, "score": 0, "creation_date": 1509990293, "post_id": 47141520, "comment_id": 81235552, "body": "I explicitly asked how to do this without slices ;)."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1509990913, "post_id": 47141520, "comment_id": 81235862, "body": "Ok ) I\u2019ve proposed to consider maps solution as they be useful when number of parameters grows and also keep semantics. If use like <code>map[string]int</code> like <code>V[&quot;sw&quot;]</code>"}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1509986592, "last_edit_date": 1509986592, "creation_date": 1509985742, "answer_id": 47141520, "question_id": 47141284, "link": "https://stackoverflow.com/questions/47141284/split-string-and-convert-the-substrings-to-integers-in-go/47141520#47141520", "title": "Split string and convert the substrings to integers in Go", "body": "<p>Best option is to use maps:</p>\n\n<pre><code>V = make(map[int]int)\n\n// in cycle\nfor i :=1; i &lt; 3; i ++ {\n    V[i], _ = strconv.AtoI(tmp[i])\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 576, "user_id": 2409784, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7f5f21a00e1779c1082d8c24fc877630?s=128&d=identicon&r=PG", "display_name": "Karol Babioch", "link": "https://stackoverflow.com/users/2409784/karol-babioch"}, "edited": false, "score": 0, "creation_date": 1509990315, "post_id": 47141682, "comment_id": 81235567, "body": "No, slices are not an option here."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1509986232, "creation_date": 1509986232, "answer_id": 47141682, "question_id": 47141284, "link": "https://stackoverflow.com/questions/47141284/split-string-and-convert-the-substrings-to-integers-in-go/47141682#47141682", "title": "Split string and convert the substrings to integers in Go", "body": "<p>If you're fine with a slice result, you could do it with slices:</p>\n\n<pre><code>tmp := strings.Split(*w, \",\")\nvalues := make([]int, 0, len(tmp))\nfor _, raw := range tmp {\n    v, err := strconv.Atoi(raw)\n    if err != nil {\n        log.Print(err)\n        continue\n    }\n    values = append(values, v)\n}\n</code></pre>\n\n<p>Working playground example: <a href=\"https://play.golang.org/p/Y-QHmHP8Iy\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Y-QHmHP8Iy</a></p>\n"}, {"comments": [{"owner": {"reputation": 576, "user_id": 2409784, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7f5f21a00e1779c1082d8c24fc877630?s=128&d=identicon&r=PG", "display_name": "Karol Babioch", "link": "https://stackoverflow.com/users/2409784/karol-babioch"}, "edited": false, "score": 0, "creation_date": 1509990236, "post_id": 47141791, "comment_id": 81235524, "body": "Seems like the cleanest solution, although it is very lenient. For instance <code>1,2,3,4</code> or <code>1,2,3,</code> is also recognized."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 576, "user_id": 2409784, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7f5f21a00e1779c1082d8c24fc877630?s=128&d=identicon&r=PG", "display_name": "Karol Babioch", "link": "https://stackoverflow.com/users/2409784/karol-babioch"}, "edited": false, "score": 0, "creation_date": 1509990568, "post_id": 47141791, "comment_id": 81235692, "body": "@KarolBabioch Yes, this may or may not be a problem. If you want it to be strict, see edited answer."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1509998230, "last_edit_date": 1509998230, "creation_date": 1509986634, "answer_id": 47141791, "question_id": 47141284, "link": "https://stackoverflow.com/questions/47141284/split-string-and-convert-the-substrings-to-integers-in-go/47141791#47141791", "title": "Split string and convert the substrings to integers in Go", "body": "<p>Parsing data out of a <code>string</code> with a specific format and storing the parsed values into variables is a perfect task for and is easily done using <a href=\"https://golang.org/pkg/fmt/#Sscanf\" rel=\"nofollow noreferrer\"><code>fmt.Sscanf()</code></a>:</p>\n\n<pre><code>src := \"1,2,3\"\n\nvar a, b, c int\n\nparsed, err := fmt.Sscanf(src, \"%d,%d,%d\", &amp;a, &amp;b, &amp;c)\nfmt.Println(parsed, err, a, b, c)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/5OZZ2OU2tR\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>3 &lt;nil&gt; 1 2 3\n</code></pre>\n\n<h3>Making it strict</h3>\n\n<p>As noted, this is very lenient, and will also successfully parse the <code>\"1,2,3,\"</code> and <code>\"1,2,3,4\"</code> inputs. This may or may not be a problem (depending on your case). If you want to make it strict, you can apply this little trick:</p>\n\n<pre><code>var temp int\nparsed, err := fmt.Sscanf(src+\",1\", \"%d,%d,%d,%d\", &amp;a, &amp;b, &amp;c, &amp;temp)\n</code></pre>\n\n<p>What we do is we append one more of the numbers that matches the input. If the original input does not end with a number (such as <code>\"1,2,3,\"</code>), parsing will fail with a non-<code>nil</code> error, and the above example gives:</p>\n\n<pre><code>3 expected integer 1 2 3\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/zRGXDaHMLv\" rel=\"nofollow noreferrer\">Go Playground</a>. Of course it will continue to parse \"valid\" inputs without any errors.</p>\n\n<p>Note that this still accepts the input <code>\"1,2,3,4\"</code>. We can \"reduce\" this trick to a single character, and we don't necessarily need a \"target\" variable to store it, it may simply be designated by the format string, like in this example:</p>\n\n<pre><code>parsed, err := fmt.Sscanf(src+\"~\", \"%d,%d,%d~\", &amp;a, &amp;b, &amp;c)\n</code></pre>\n\n<p>We append a special character <em>unlikely</em> to happen in the input, and we expect that special character in the format string. Attempting to parse an invalid input (such as <code>\"1,2,3,\"</code> or <code>\"1,2,3,4\"</code>) will result in an error such as:</p>\n\n<pre><code>3 input does not match format 1 2 3\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/fyBQPnVfJC\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 576, "user_id": 2409784, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7f5f21a00e1779c1082d8c24fc877630?s=128&d=identicon&r=PG", "display_name": "Karol Babioch", "link": "https://stackoverflow.com/users/2409784/karol-babioch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1937, "favorite_count": 0, "accepted_answer_id": 47141791, "answer_count": 3, "score": 6, "last_activity_date": 1509998230, "creation_date": 1509985032, "question_id": 47141284, "link": "https://stackoverflow.com/questions/47141284/split-string-and-convert-the-substrings-to-integers-in-go", "title": "Split string and convert the substrings to integers in Go", "body": "<p>I've got a single variable containing something like <code>1,2,3</code>. These are actually three values, that I want to have in three variables called <code>v1</code>, <code>v2</code>, <code>v3</code> (but <strong>not</strong> in an array).</p>\n\n<p>Right now I'm doing this in the following way:</p>\n\n<pre><code>tmp := strings.Split(*w, \",\")\nsw, _ := strconv.Atoi(tmp[0])\nrw, _ := strconv.Atoi(tmp[1])\npw, _ := strconv.Atoi(tmp[2])\n</code></pre>\n\n<p>This works, although it is very repetitive and does not <em>feel</em> right in Go.</p>\n\n<p>What would be a cleaner way to solve this issue?</p>\n"}, {"tags": ["go", "polymorphism"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1509985025, "post_id": 47141253, "comment_id": 81232317, "body": "Go has no inheritance, hence there is no &quot;is a&quot; type polymorphism."}, {"owner": {"reputation": 9243, "user_id": 1318181, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/1ZfAE.png?s=128&g=1", "display_name": "kylieCatt", "link": "https://stackoverflow.com/users/1318181/kyliecatt"}, "edited": false, "score": 0, "creation_date": 1510004770, "post_id": 47141253, "comment_id": 81243037, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/35595810/using-interfaces-to-create-a-queue-for-arbitrary-types\">Using Interfaces to Create a Queue for Arbitrary Types</a>"}], "answers": [{"tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": false, "score": 4, "last_activity_date": 1509985523, "creation_date": 1509985523, "answer_id": 47141447, "question_id": 47141253, "link": "https://stackoverflow.com/questions/47141253/go-inheritance-and-polymorphism/47141447#47141447", "title": "go inheritance and polymorphism", "body": "<p>Your primary problem is that you're using a <em>pointer</em> to an interface.  My answer to <a href=\"https://stackoverflow.com/questions/44370277/type-is-pointer-to-interface-not-interface-confusion/44372954#44372954\">this question</a> contains some details about the difference.  Suffice it to say, pointers to interfaces are almost always errors.</p>\n\n<p>If you store a <code>*Man</code> into a <code>Human</code> (NOT a <code>*Human</code>), it'll work just fine because interfaces can store pointers without a problem.  In fact, in general, you want to default to storing pointers in interfaces, as values stored in interfaces cannot access pointer methods of the type stored.  An interface is simply a bucket that holds a type, and it doesn't matter whether that type is a struct or a pointer to a struct.  A <em>pointer</em> to an interface, on the other hand, is <em>NOT</em> an interface, and doesn't have the same implicit fulfillment system that interfaces have.  It's much the same as being unable to use a <code>*func()</code> variable as a function.  It's a pointer, not a function.</p>\n\n<p>TL;DR: don't use pointers to interfaces.  It's almost never useful, and generally just reflects a misunderstanding of what interfaces are.</p>\n"}, {"tags": [], "owner": {"reputation": 647, "user_id": 857156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66412a85a83783c2061838e1b44a9bbb?s=128&d=identicon&r=PG", "display_name": "Dave Gray", "link": "https://stackoverflow.com/users/857156/dave-gray"}, "is_accepted": false, "score": 2, "last_activity_date": 1509985610, "creation_date": 1509985610, "answer_id": 47141478, "question_id": 47141253, "link": "https://stackoverflow.com/questions/47141253/go-inheritance-and-polymorphism/47141478#47141478", "title": "go inheritance and polymorphism", "body": "<p>It might help to think about interfaces as more similar to an API definition than a type. Things that satisfy the interface can already be structs or pointers, so you don't need to use an interface pointer. As stated in <a href=\"https://stackoverflow.com/a/44372954/857156\">this excellent answer</a>:</p>\n\n<blockquote>\n  <p>Pointers to interfaces are almost never useful. In fact, the Go runtime was specifically changed a few versions back to no longer automatically dereference interface pointers (like it does for structure pointers), to discourage their use. In the overwhelming majority of cases, a pointer to an interface reflects a misunderstanding of how interfaces are supposed to work.</p>\n</blockquote>\n"}], "owner": {"reputation": 19, "user_id": 8593538, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b548f622bbe7f8ebfd339819f7ddd29a?s=128&d=identicon&r=PG&f=1", "display_name": "jean-yves boisiaud", "link": "https://stackoverflow.com/users/8593538/jean-yves-boisiaud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 429, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1509985610, "creation_date": 1509984941, "question_id": 47141253, "link": "https://stackoverflow.com/questions/47141253/go-inheritance-and-polymorphism", "title": "go inheritance and polymorphism", "body": "<p>This code does not run correctly :</p>\n\n<pre><code>package main\nimport \"fmt\"\n\ntype Human interface {\n    myStereotype() string\n}\n\ntype Man struct {\n}\n\nfunc (m Man) myStereotype() string {\n    return \"I'm going fishing.\"\n}\n\ntype Woman struct {\n}\n\nfunc (m Woman) myStereotype() string {\n    return \"I'm going shopping.\"\n}\nfunc main() {\n    var m *Man\n    m = new (Man)\n    w := new (Woman)\n\n    var hArr []*Human\n\n    hArr = append(hArr, m)\n    hArr = append(hArr, w)\n\n    for n, _ := range (hArr) {\n\n        fmt.Println(\"I'm a human, and my stereotype is: \",\n                hArr[n].myStereotype())\n    }\n}\n</code></pre>\n\n<p>It exists with :</p>\n\n<pre><code>tmp/sandbox637505301/main.go:29:18: cannot use m (type *Man) as type *Human in append:\n*Human is pointer to interface, not interface\ntmp/sandbox637505301/main.go:30:18: cannot use w (type *Woman) as type *Human in append:\n*Human is pointer to interface, not interface\ntmp/sandbox637505301/main.go:36:67: hArr[n].myStereotype undefined (type *Human is pointer to interface, not interface)\n</code></pre>\n\n<p>But this one runs correctly (var hArr []*Human is rewritten into var hArr []Human) :</p>\n\n<pre><code>package main\nimport \"fmt\"\n\ntype Human interface {\n    myStereotype() string\n}\n\ntype Man struct {\n}\n\nfunc (m Man) myStereotype() string {\n    return \"I'm going fishing.\"\n}\n\ntype Woman struct {\n}\n\nfunc (m Woman) myStereotype() string {\n    return \"I'm going shopping.\"\n}\nfunc main() {\n    var m *Man\n    m = new (Man)\n    w := new (Woman)\n\n    var hArr []Human // &lt;== !!!!!! CHANGED HERE !!!!!!\n\n    hArr = append(hArr, m)\n    hArr = append(hArr, w)\n\n    for n, _ := range (hArr) {\n\n        fmt.Println(\"I'm a human, and my stereotype is: \",\n                hArr[n].myStereotype())\n    }\n}\n</code></pre>\n\n<p>Output is ok:</p>\n\n<pre><code>I'm a human, and my stereotype is:  I'm going fishing.\nI'm a human, and my stereotype is:  I'm going shopping.\n</code></pre>\n\n<p>And I do not understand why. As m and w are pointers, why when I define hArr as an array of pointers on Human the code fails ?</p>\n\n<p>Thank you for your explanation</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1509980019, "post_id": 47139633, "comment_id": 81228804, "body": "You don&#39;t unit test stdin, you make your implementation testable and independent from stdin."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1509980139, "post_id": 47139633, "comment_id": 81228906, "body": "Specifically, have the function take in an <code>io.Reader</code>, use <code>fmt.Fscanf</code>, and then pass it either stdin or an appropriate test Reader as necessary."}, {"owner": {"reputation": 1499, "user_id": 3508551, "user_type": "registered", "accept_rate": 37, "profile_image": "https://graph.facebook.com/100000637329350/picture?type=large", "display_name": "AspiringMat", "link": "https://stackoverflow.com/users/3508551/aspiringmat"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1509980336, "post_id": 47139633, "comment_id": 81229059, "body": "@Adrian I am fairly new to GO. Do you mind giving me a reference where to start with these classes?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1509980452, "post_id": 47139633, "comment_id": 81229146, "body": "I highly recommend reading the friendly manual: <a href=\"https://golang.org/pkg/io\" rel=\"nofollow noreferrer\">golang.org/pkg/io</a> and <a href=\"https://golang.org/pkg/fmt\" rel=\"nofollow noreferrer\">golang.org/pkg/fmt</a> would cover the interface and function I mentioned."}], "owner": {"reputation": 1499, "user_id": 3508551, "user_type": "registered", "accept_rate": 37, "profile_image": "https://graph.facebook.com/100000637329350/picture?type=large", "display_name": "AspiringMat", "link": "https://stackoverflow.com/users/3508551/aspiringmat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "closed_date": 1509980021, "answer_count": 0, "score": 0, "last_activity_date": 1509979913, "creation_date": 1509979913, "question_id": 47139633, "link": "https://stackoverflow.com/questions/47139633/how-to-write-unit-tests-for-function-that-reads-and-writes-to-stdio-in-go", "closed_reason": "Duplicate", "title": "How to write unit tests for function that reads and writes to STDIO in GO?", "body": "<p>I have a function in GO that takes input from stdio and writes to stdio. Is there a way to write unit tests for the function?</p>\n\n<p>An example function is:</p>\n\n<pre><code>func double() {\n    var in int\n    _, err = fmt.Scanf(\"%d\", &amp;in)\n    if err==nil{\n        fmt.Scanf(2*in)\n    }\n    else{\n        log.Fatal(\"Error Scanning input\")\n    }\n}\n</code></pre>\n\n<p>Note that in the real function I want to test, the I/O spans several lines so its not just as simple as making the result as an integer and return it. I am just giving the example here for reference.</p>\n"}, {"tags": ["go", "ssh", "sftp"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1509977161, "post_id": 47138572, "comment_id": 81226790, "body": "I don&#39;t understand what you&#39;re trying to do, you mention writing a server, but this is code is making a client connection. A fingerprint is just a hash of a key, it&#39;s not used for authentication. In order to authenticate with a key, you need that key. This can&#39;t compile anyway, since <code>ssh.NewPublicKey</code> returns an error value, which would show that you don&#39;t have a valid public key."}, {"owner": {"reputation": 145, "user_id": 2839879, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e72483da81e5db694ae54b45d99bfdd2?s=128&d=identicon&r=PG&f=1", "display_name": "tjg92", "link": "https://stackoverflow.com/users/2839879/tjg92"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1509977689, "post_id": 47138572, "comment_id": 81227153, "body": "My apologies. I&#39;m using the client to connect to a remote SFTP server. The provider has given us the fingerprint. And using Powershell with WinSCP all that was needed was to provide the fingerprint before. So I&#39;m trying to find out if it&#39;s possible to add the fingerprint to the client call."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1509979479, "post_id": 47138572, "comment_id": 81228421, "body": "The fingerprint has nothing to do with authentication, and it&#39;s not required. If you want to verify the fingerprint (though this is an old format), just hash the key data in a matching format and compare the string."}, {"owner": {"reputation": 145, "user_id": 2839879, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e72483da81e5db694ae54b45d99bfdd2?s=128&d=identicon&r=PG&f=1", "display_name": "tjg92", "link": "https://stackoverflow.com/users/2839879/tjg92"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1509980059, "post_id": 47138572, "comment_id": 81228837, "body": "@JimB Okay, and what is the best way to get the fingerprint from the connection? I can&#39;t seem to find anything on that. I know it&#39;s an old format but it&#39;s a step we take in authenticating our connection."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1509980308, "post_id": 47138572, "comment_id": 81229039, "body": "A fingerprint is just a hash of the key. Have you looked at the &quot;Fingerprint&quot; functions in the ssh package? <a href=\"https://godoc.org/golang.org/x/crypto/ssh#FingerprintLegacyMD5\" rel=\"nofollow noreferrer\">FingerprintLegacyMD5</a>  and <a href=\"https://godoc.org/golang.org/x/crypto/ssh#FingerprintSHA256\" rel=\"nofollow noreferrer\">FingerprintSHA256</a>"}], "owner": {"reputation": 145, "user_id": 2839879, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/e72483da81e5db694ae54b45d99bfdd2?s=128&d=identicon&r=PG&f=1", "display_name": "tjg92", "link": "https://stackoverflow.com/users/2839879/tjg92"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 475, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1509976508, "creation_date": 1509976508, "question_id": 47138572, "link": "https://stackoverflow.com/questions/47138572/using-a-given-rsa-fingerprint-in-sftp-connection-golang", "title": "Using a given RSA fingerprint in SFTP Connection Golang", "body": "<p>I am in the process of trying to write an sftp server in Go and my language knowledge is very limited and I can't seem to find this one answer. I have the RSA fingerprint already given to me to connect to the host but I can't seem to find anyone who gives the fingerprint. Everyone seems to generate the .pem files etc. But I just want to give it the key.</p>\n\n<p>I attemped to just add the fingerprint to the ssh.NewPublicKey() but that didn't seem to work. Does anyone have any references or suggestions? Here's the code below.</p>\n\n<p>I can do this pretty easily in powershell but I'm trying to get away from it and switch over to Golang.</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/pkg/sftp\"\n    \"golang.org/x/crypto/ssh\"\n)\n\nfunc main() {\n    addr := \"remote.server:00\"\n    hostKey := ssh.NewPublicKey(\"ssh-rsa 2048 00:11:22:33:44:55:66:77:88:99:00:aa:bb:cc:dd:ee\")\n    config := &amp;ssh.ClientConfig{\n        User: \"username\",\n        Auth: []ssh.AuthMethod{\n            ssh.Password(\"password\"),\n        },\n\n        HostKeyCallback: ssh.FixedHostKey(hostKey),\n    }\n    conn, err := ssh.Dial(\"tcp\", addr, config)\n    if err != nil {\n        panic(\"Failed to dial: \" + err.Error())\n    }\n    client, err := sftp.NewClient(conn)\n    if err != nil {\n        panic(\"Failed to create client: \" + err.Error())\n    }\n    // Close connection\n    defer client.Close()\n    cwd, err := client.Getwd()\n    println(\"Current working directory:\", cwd)\n} \n</code></pre>\n"}, {"tags": ["go", "oauth-2.0", "google-api", "google-oauth", "google-authentication"], "answers": [{"tags": [], "owner": {"reputation": 27119, "user_id": 8753, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NLxHO.jpg?s=128&g=1", "display_name": "laz", "link": "https://stackoverflow.com/users/8753/laz"}, "is_accepted": false, "score": 0, "last_activity_date": 1510203520, "creation_date": 1510203520, "answer_id": 47194193, "question_id": 47138186, "link": "https://stackoverflow.com/questions/47138186/does-the-golang-org-x-oauth2-google-library-support-service-to-service-authentic/47194193#47194193", "title": "Does the golang.org/x/oauth2/google library support service to service authentication?", "body": "<p>I'm not setup to test this at the moment but I believe something like this should work:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"context\"\n    \"io/ioutil\"\n    \"log\"\n\n    \"golang.org/x/oauth2/google\"\n    calendar \"google.golang.org/api/calendar/v3\"\n)\n\nfunc main() {\n    cred, err := ioutil.ReadFile(\"service_account.json\")\n    if err != nil {\n        log.Fatalf(\"Unable to read JSON credentials config %v\", err)\n    }\n\n    conf, err := google.JWTConfigFromJSON(cred, \"https://www.googleapis.com/auth/calendar\")\n    if err != nil {\n        log.Fatalf(\"Unable to obtain JWT conf %v\", err)\n    }\n\n    client := conf.Client(context.Background())\n    srv, err := calendar.New(client)\n    if err != nil {\n        log.Fatalf(\"Unable to retrieve calendar Client %v\", err)\n    }\n  ...\n}\n</code></pre>\n\n<p>The contents of <code>service_account.json</code> should be obtained from the service account configuration somehow, I'm not 100% sure about that part though.</p>\n"}], "owner": {"reputation": 18898, "user_id": 903011, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/6a8f2f5f292c75c5e81a6607530a0ab6?s=128&d=identicon&r=PG", "display_name": "WoJ", "link": "https://stackoverflow.com/users/903011/woj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 246, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1510203520, "creation_date": 1509975181, "last_edit_date": 1509978138, "question_id": 47138186, "link": "https://stackoverflow.com/questions/47138186/does-the-golang-org-x-oauth2-google-library-support-service-to-service-authentic", "title": "Does the golang.org/x/oauth2/google library support service to service authentication?", "body": "<p>I developped a Python backend service which connects to the Google Calendar API (v3), retrieves calendar entries and exposes them (they are retrieved by via an HTTP call). In order to do so, I use <a href=\"https://developers.google.com/identity/protocols/OAuth2ServiceAccount\" rel=\"nofollow noreferrer\">OAuth 2.0 for Server to Server Applications</a>.</p>\n\n<p>When developping my application a few years ago, the module provided by Google was not yet ported to Python 3 and I went the JWT way (\"HTTP/REST\" in the documentation linked above).</p>\n\n<p>I now would like to learn Go and start by porting this application.</p>\n\n<p>The <a href=\"https://developers.google.com/google-apps/calendar/quickstart/go\" rel=\"nofollow noreferrer\">Google Calendar API quickstart for Go</a> provides a full example, but it assumes that the authentication will include a consent screen from the user (3-legged oAuth). This is similar to the Python example, but there is also a Python version using the service to service approach.</p>\n\n<p><strong>Is this service to service authentication funtionality available in the Go library?</strong></p>\n\n<p>If it is not I will manually generate a JWT (as I do it now with the Python version of my code) but since I am just starting with Go, I would prefer using libraries as much as possible while I learn on the fly.</p>\n"}, {"tags": ["xml", "go", "comments"], "answers": [{"comments": [{"owner": {"reputation": 103, "user_id": 4526405, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a3c5334eb1fe30f08ca0e5a8af2e0c0?s=128&d=identicon&r=PG&f=1", "display_name": "NoName2", "link": "https://stackoverflow.com/users/4526405/noname2"}, "edited": false, "score": 0, "creation_date": 1509982158, "post_id": 47138252, "comment_id": 81230381, "body": "One more question is there anyway to break up the Comments into array for example Row below breaks up into array where as comments if I try [] will give me an error type Database struct {     \tComment string <code>xml:&quot;,comment&quot;</code>\t \t  Row []string  <code>xml:&quot;row&quot;</code> \t}"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 103, "user_id": 4526405, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a3c5334eb1fe30f08ca0e5a8af2e0c0?s=128&d=identicon&r=PG&f=1", "display_name": "NoName2", "link": "https://stackoverflow.com/users/4526405/noname2"}, "edited": false, "score": 0, "creation_date": 1509983801, "post_id": 47138252, "comment_id": 81231548, "body": "@NoName2 what question? Try to use it alike"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 103, "user_id": 4526405, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a3c5334eb1fe30f08ca0e5a8af2e0c0?s=128&d=identicon&r=PG&f=1", "display_name": "NoName2", "link": "https://stackoverflow.com/users/4526405/noname2"}, "edited": false, "score": 1, "creation_date": 1509985470, "post_id": 47138252, "comment_id": 81232635, "body": "I think no, they are accumulated in one field. But you may split at some meaningful places."}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 7, "last_activity_date": 1509975684, "last_edit_date": 1509975684, "creation_date": 1509975378, "answer_id": 47138252, "question_id": 47138185, "link": "https://stackoverflow.com/questions/47138185/unmarshal-xml-comments/47138252#47138252", "title": "Unmarshal XML Comments", "body": "<p>Have you tried  <a href=\"https://golang.org/pkg/encoding/xml/#Unmarshal\" rel=\"noreferrer\">https://golang.org/pkg/encoding/xml/#Unmarshal</a>?</p>\n\n<blockquote>\n  <p>If the XML element contains comments, they are accumulated in  the\n  first struct field that has tag \",comment\".  The struct  field may\n  have type []byte or string. If there is no such  field, the comments\n  are discarded.</p>\n</blockquote>\n\n<p>Here's usage example: <a href=\"https://golang.org/src/encoding/xml/example_test.go\" rel=\"noreferrer\">https://golang.org/src/encoding/xml/example_test.go</a></p>\n\n<pre><code>type Person struct {\n    XMLName   xml.Name `xml:\"person\"`\n    ...\n    Comment   string   `xml:\",comment\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 103, "user_id": 4526405, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2a3c5334eb1fe30f08ca0e5a8af2e0c0?s=128&d=identicon&r=PG&f=1", "display_name": "NoName2", "link": "https://stackoverflow.com/users/4526405/noname2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 482, "favorite_count": 0, "accepted_answer_id": 47138252, "answer_count": 1, "score": 2, "last_activity_date": 1509985913, "creation_date": 1509975181, "last_edit_date": 1509985913, "question_id": 47138185, "link": "https://stackoverflow.com/questions/47138185/unmarshal-xml-comments", "title": "Unmarshal XML Comments", "body": "<p>I am trying to unmarshal XML from RRD format.</p>\n\n<p>So I create my types etc, etc. which I am able to get the values from.</p>\n\n<p>But there are comments in the XML in this format <code>&lt;!-- 2017/01/01 --&gt;</code> and I need to extract this date. Is there any way of accessing this in GO ?</p>\n\n<p>Thanks. </p>\n\n<p>Updated question:</p>\n\n<p>Okay I did it works, but I want to split the comments into array.</p>\n\n<p>For example I have the following XML.</p>\n\n<pre><code>&lt;database&gt;\n&lt;!-- Random Info. --&gt;\n&lt;row&gt;10101&lt;/row&gt;\n&lt;!-- Random Info2 . --&gt;\n&lt;row&gt;10102&lt;/row&gt;\n&lt;/database&gt;\n</code></pre>\n\n<p>So I have the following.</p>\n\n<pre><code>type Database struct {\n          Comment string `xml:\",comment\"`   \n          Row []string  `xml:\"row\"`\n    }\n</code></pre>\n\n<p>Now when I print the row data I get it as an array whereas the comment is a string.\nI tried to make it an array but it throws an error cannot convert.\npanic: reflect.Set: value of type []uint8 is not assignable to type []string</p>\n\n<p>Obviously, I can split the string and get what I want. But is there any quicker way of doing this when creating type?</p>\n"}, {"tags": ["parsing", "go", "type-conversion"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1509982721, "last_edit_date": 1509982721, "creation_date": 1509974699, "answer_id": 47138048, "question_id": 47138003, "link": "https://stackoverflow.com/questions/47138003/multiple-value-strconv-parseint-in-single-value-context/47138048#47138048", "title": "multiple-value strconv.ParseInt() in single-value context", "body": "<p>The expression <code>uint64(...)</code> is a type <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">conversion</a>, and it cannot have multiple arguments (operands), but since <a href=\"https://golang.org/pkg/strconv/#ParseInt\" rel=\"nofollow noreferrer\"><code>strconv.ParseInt()</code></a> has 2 return values, you're basically passing both to the type conversion, which is not valid.</p>\n\n<p>Instead do this:</p>\n\n<pre><code>i, err := strconv.ParseInt(scanner.Text(), 64, 64)\n// Check err\ni2 := uint64(i)\n</code></pre>\n\n<p>Note that the base cannot be greater than <code>36</code>, so you'll definitely get an error as you're passing <code>64</code> as the base.</p>\n\n<p>Or use <a href=\"https://golang.org/pkg/strconv/#ParseUint\" rel=\"nofollow noreferrer\"><code>strconv.ParseUint()</code></a> which will return you an <code>uint</code> value right away:</p>\n\n<pre><code>i, err := strconv.ParseUint(scanner.Text(), 16, 64)\n// i is of type uint64, and ready to be used if err is nil\n</code></pre>\n\n<p>(Here I used a valid, <code>16</code> base. Use whatever you have to.)</p>\n\n<p>Also see related question+answer: <a href=\"https://stackoverflow.com/questions/28227095/go-multiple-value-in-single-value-context/28233172#28233172\">Go: multiple value in single-value context</a></p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 3, "last_activity_date": 1509975969, "creation_date": 1509975969, "answer_id": 47138415, "question_id": 47138003, "link": "https://stackoverflow.com/questions/47138003/multiple-value-strconv-parseint-in-single-value-context/47138415#47138415", "title": "multiple-value strconv.ParseInt() in single-value context", "body": "<blockquote>\n  <p>multiple-value strconv.ParseInt() in single-value context</p>\n</blockquote>\n\n<p><code>ParseInt</code> returns 2 values: integer and error. So you cannot use them in function argument where only one value allowed. You may first get <code>value</code> and <code>error</code> then use <code>value</code> in next operations.</p>\n"}], "owner": {"reputation": 3609, "user_id": 234580, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/4a69bb6433156df7a7190345bb1b6f9a?s=128&d=identicon&r=PG", "display_name": "Mangano", "link": "https://stackoverflow.com/users/234580/mangano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4518, "favorite_count": 0, "accepted_answer_id": 47138048, "answer_count": 2, "score": 2, "last_activity_date": 1509982721, "creation_date": 1509974568, "last_edit_date": 1509974997, "question_id": 47138003, "link": "https://stackoverflow.com/questions/47138003/multiple-value-strconv-parseint-in-single-value-context", "title": "multiple-value strconv.ParseInt() in single-value context", "body": "<p>I have the following code:</p>\n\n<pre><code>var i2 uint64;\nvar err error;\ni2, err = uint64(strconv.ParseInt(scanner.Text(), 64, 64));\n</code></pre>\n\n<p>And I received the error:</p>\n\n<pre><code>multiple-value strconv.ParseInt() in single-value context\n</code></pre>\n\n<p>According to everything I found on the Internet, this means that I am ignoring the two parameters returned by ParseInt, but I am using err.\nI know that maybe the mistake is very stupid, but I just started to learn Go and this confused me a lot.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 7, "creation_date": 1509970709, "post_id": 47136838, "comment_id": 81222850, "body": "Just the opposite: the second loop is significantly faster. <code>ns&#47;op</code> is nanoseconds per operation, the smaller the better."}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 4, "last_activity_date": 1509973969, "last_edit_date": 1509973969, "creation_date": 1509970803, "answer_id": 47136918, "question_id": 47136838, "link": "https://stackoverflow.com/questions/47136838/golang-foreach-difference/47136918#47136918", "title": "Golang foreach difference", "body": "<p>I think <code>Benchmark_foreach2-2</code> is about 2 times faster - it requires 1707214 nanoseconds per operation, and first one takes 3172323. So second one is <code>3172323 / 1707214 = 1.85</code> times faster.</p>\n\n<p>Reason: second doesn't need to take value from a memory again, it already used value in <code>v</code> variable.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1509973115, "last_edit_date": 1509973115, "creation_date": 1509972179, "answer_id": 47137312, "question_id": 47136838, "link": "https://stackoverflow.com/questions/47136838/golang-foreach-difference/47137312#47137312", "title": "Golang foreach difference", "body": "<p>The <code>test[k]</code> statement in <code>BenchmarkForeachK</code> takes time to randomly read the value, so <code>BenchmarkForeachK</code> takes more time than <code>BenchmarkForeachV</code>, 9362945 ns/op versus 4213940 ns/op   . </p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nfunc testMap() map[int]int {\n    test := make(map[int]int)\n    for i := 0; i &lt; 100000; i++ {\n        test[i] = 1\n    }\n    return test\n}\n\nfunc BenchmarkForeachK(b *testing.B) {\n    test := testMap()\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        for k := range test {\n            if test[k] != 1 {\n                panic(\"eh\")\n            }\n        }\n    }\n}\n\nfunc BenchmarkForeachV(b *testing.B) {\n    test := testMap()\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        for _, v := range test {\n            if v != 1 {\n                panic(\"heh\")\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go test foreach_test.go -bench=.\nBenchmarkForeachK-4    200    9362945 ns/op    0 B/op    0 allocs/op\nBenchmarkForeachV-4    300    4213940 ns/op    0 B/op    0 allocs/op\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 7004868, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/1d5526b70fb222c3382d80858d344857?s=128&d=identicon&r=PG&f=1", "display_name": "wenyi liu", "link": "https://stackoverflow.com/users/7004868/wenyi-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 2, "accepted_answer_id": 47136918, "answer_count": 2, "score": 2, "last_activity_date": 1509973969, "creation_date": 1509970512, "last_edit_date": 1509970617, "question_id": 47136838, "link": "https://stackoverflow.com/questions/47136838/golang-foreach-difference", "title": "Golang foreach difference", "body": "<pre><code>func Benchmark_foreach1(b *testing.B) {\n        var test map[int]int\n        test = make(map[int]int)\n            for i := 0; i &lt; 100000; i++ {\n                        test[i] = 1\n            }\n            for i := 0; i &lt; b.N; i++ {\n                    for i, _ := range test {\n                            if test[i] != 1 {\n                                    panic(\"ds\")\n                            }\n                    }\n            }\n}\n\nfunc Benchmark_foreach2(b *testing.B) {\n            var test map[int]int\n            test = make(map[int]int)\n            for i := 0; i &lt; 100000; i++ {\n                    test[i] = 1\n            }\n            for i := 0; i &lt; b.N; i++ {\n                    for _, v := range test {\n                            if v != 1 {\n                                    panic(\"heh\")\n                            }\n                    }\n            }\n}\n</code></pre>\n\n<p>run with result as below</p>\n\n<pre><code>goos: linux\ngoarch: amd64\nBenchmark_foreach1-2         500           3172323 ns/op\nBenchmark_foreach2-2        1000           1707214 ns/op\n</code></pre>\n\n<p>why is foreach-2 slow?</p>\n"}, {"tags": ["ubuntu", "go", "windows-10", "profiling", "windows-subsystem-for-linux"], "comments": [{"owner": {"reputation": 61508, "user_id": 78259, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/844c572938eaad1e44eb084fb39416f9?s=128&d=identicon&r=PG", "display_name": "Chas. Owens", "link": "https://stackoverflow.com/users/78259/chas-owens"}, "edited": false, "score": 0, "creation_date": 1509967065, "post_id": 47135559, "comment_id": 81220612, "body": "Looks like it does the same thing on Debian running by itself, so the Windows 10 thing is a red herring."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1509968342, "post_id": 47135559, "comment_id": 81221405, "body": "First you need to provide the binary as an argument to <code>pprof</code>. How long does your program run? You may not have enough samples to make a meaningful profile."}, {"owner": {"reputation": 61508, "user_id": 78259, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/844c572938eaad1e44eb084fb39416f9?s=128&d=identicon&r=PG", "display_name": "Chas. Owens", "link": "https://stackoverflow.com/users/78259/chas-owens"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1509970173, "post_id": 47135559, "comment_id": 81222538, "body": "@JimB add sleeps to the functions (over 10 second runtime now) and the binary to the tool command, still no output."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1509974434, "post_id": 47135559, "comment_id": 81224980, "body": "It\u2019s possible that SIGPROF just doesn\u2019t work in WSL, I\u2019m not sure how one would go about tracing that on windows."}], "answers": [{"comments": [{"owner": {"reputation": 61508, "user_id": 78259, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/844c572938eaad1e44eb084fb39416f9?s=128&d=identicon&r=PG", "display_name": "Chas. Owens", "link": "https://stackoverflow.com/users/78259/chas-owens"}, "edited": false, "score": 0, "creation_date": 1509970090, "post_id": 47136411, "comment_id": 81222485, "body": "I added sleeps to the functions and the defer. It ran for over 10 seconds and still no output in pprof."}, {"owner": {"reputation": 240, "user_id": 8800369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4f69be8fda374dc3075128df3a05f37?s=128&d=identicon&r=PG", "display_name": "Hein Oldewage", "link": "https://stackoverflow.com/users/8800369/hein-oldewage"}, "reply_to_user": {"reputation": 61508, "user_id": 78259, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/844c572938eaad1e44eb084fb39416f9?s=128&d=identicon&r=PG", "display_name": "Chas. Owens", "link": "https://stackoverflow.com/users/78259/chas-owens"}, "edited": false, "score": 1, "creation_date": 1510038750, "post_id": 47136411, "comment_id": 81253355, "body": "The profiler does not track time the CPU is not working. Have you tried increasing the max loop count?"}], "tags": [], "owner": {"reputation": 240, "user_id": 8800369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4f69be8fda374dc3075128df3a05f37?s=128&d=identicon&r=PG", "display_name": "Hein Oldewage", "link": "https://stackoverflow.com/users/8800369/hein-oldewage"}, "is_accepted": false, "score": 1, "last_activity_date": 1509969134, "creation_date": 1509969134, "answer_id": 47136411, "question_id": 47135559, "link": "https://stackoverflow.com/questions/47135559/why-is-the-profiler-not-working-for-me/47136411#47136411", "title": "Why is the profiler not working for me?", "body": "<p>Running on windows also produces no samples in the profiler. The following <a href=\"https://blog.golang.org/profiling-go-programs\" rel=\"nofollow noreferrer\">article</a> from the go blog states the following: </p>\n\n<pre><code>When CPU profiling is enabled, the Go program stops about 100 times per second and \nrecords a sample consisting of the program counters on the currently executing \ngoroutine's stack.\n</code></pre>\n\n<p>When running your code takes less that 2ms, so does not allow the profiler to take samples. Increase your loop count from 100 to 10000 and then you should see some samples in your output.</p>\n\n<p>On another note, remember to close your file <code>f</code>. Like so:</p>\n\n<pre><code>if err != nil {\n    log.Fatal(\"could not create CPU profile: \", err)\n}\ndefer f.Close()\n</code></pre>\n"}], "owner": {"reputation": 61508, "user_id": 78259, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/844c572938eaad1e44eb084fb39416f9?s=128&d=identicon&r=PG", "display_name": "Chas. Owens", "link": "https://stackoverflow.com/users/78259/chas-owens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 886, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1509978670, "creation_date": 1509966524, "question_id": 47135559, "link": "https://stackoverflow.com/questions/47135559/why-is-the-profiler-not-working-for-me", "title": "Why is the profiler not working for me?", "body": "<p>Given the following toy code, I would expect to be able to run</p>\n\n<pre><code>go tool pprof cpu.prof\n</code></pre>\n\n<p>and get useful information about waster1 and waster2, but when I run top in pprof, all I get is:</p>\n\n<pre><code>Showing nodes accounting for 0, 0% of 0 total\n      flat  flat%   sum%        cum   cum%\n</code></pre>\n\n<p>It is possible the problem is that I am using WSL to run Ubuntu on Windows 10.</p>\n\n<p>Here is the code I am using:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"runtime/pprof\"\n)\n\nfunc waster2() int {\n    j := 0;\n    for i := 0; i &lt; 100; i++ {\n        j += waster1()\n    }\n    return j\n}\n\nfunc waster1() int {\n    j := 0;\n    for i := 0; i &lt; 10000; i++ {\n        j++\n    }\n    return j\n}\n\nfunc main() {\n    f, err := os.Create(\"cpu.prof\")\n\n    if err != nil {\n        log.Fatal(\"could not create CPU profile: \", err)\n    }\n\n    if err := pprof.StartCPUProfile(f); err != nil {\n        log.Fatal(\"could not start CPU profile: \", err)\n    }\n\n    defer pprof.StopCPUProfile()\n\n    j := waster2()\n\n    fmt.Println(j)\n}\n</code></pre>\n"}, {"tags": ["go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 3, "creation_date": 1509965061, "post_id": 47134781, "comment_id": 81219511, "body": "this answer gives specific solution to the problem"}], "tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": false, "score": 14, "last_activity_date": 1509964225, "creation_date": 1509964225, "answer_id": 47134781, "question_id": 47134293, "link": "https://stackoverflow.com/questions/47134293/compare-structs-except-one-field-golang/47134781#47134781", "title": "Compare structs except one field golang", "body": "<p>Idiomatic way would be to implement your own <code>func (o MyStruct) Equal(o2 MyStruct) bool</code> method.</p>\n"}, {"comments": [{"owner": {"reputation": 2251, "user_id": 5238892, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b27ed4cd2a119f7efeaad687f11403cb?s=128&d=identicon&r=PG&f=1", "display_name": "Simin Jie", "link": "https://stackoverflow.com/users/5238892/simin-jie"}, "edited": false, "score": 0, "creation_date": 1555592756, "post_id": 47136278, "comment_id": 98170161, "body": "How to compare two interfaces except some fields? Because I can&#39;t <code>call of reflect.Value.FieldByName on interface Value</code>. The original requirement is that I need to compare two json string except some fields, so I unmarshal them to interfaces and compare the interfaces."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1509985866, "last_edit_date": 1509985866, "creation_date": 1509968764, "answer_id": 47136278, "question_id": 47134293, "link": "https://stackoverflow.com/questions/47134293/compare-structs-except-one-field-golang/47136278#47136278", "title": "Compare structs except one field golang", "body": "<h2>1. With embedding</h2>\n\n<p>One option would be to group fields that should take part in the comparison into a different struct which you can embed in your original. When doing the comparison, just compare the embedded fields:</p>\n\n<pre><code>type Person struct {\n    Name string\n    Age  int\n}\n\ntype Doc struct {\n    Person\n    Created time.Time\n}\n\nfunc main() {\n    d1 := Doc{\n        Person:  Person{\"Bob\", 21},\n        Created: time.Now(),\n    }\n    time.Sleep(time.Millisecond)\n    d2 := Doc{\n        Person:  Person{\"Bob\", 21},\n        Created: time.Now(),\n    }\n\n    fmt.Println(d1 == d2)               // false\n    fmt.Println(d1.Person == d2.Person) // true\n}\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/KNMfSXoj9P\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p>If the struct does not contain pointers, slices, maps etc., you can simply compare the embedded values using <code>==</code>. Otherwise use <code>reflect.DeepEqual()</code> to compare them.</p>\n\n<h2>2. Temporarily modifying the excludable fields</h2>\n\n<p>You may also choose to temporarily modify the fields you don't want to compare: <em>make them equal</em> so the comparison result will only depend on the rest of the fields:</p>\n\n<pre><code>a := test{\"testName\", time.Now().Format(time.StampMilli)}\ntime.Sleep(time.Millisecond)\nb := test{\"testName\", time.Now().Format(time.StampMilli)}\n\n// Save and make excluded fields equal:\nold := a.time\na.time = b.time\n\nfmt.Println(a.name == b.name)        // true\nfmt.Println(reflect.DeepEqual(a, b)) // true\n\n// Restore:\na.time = old\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/3OKJ6gi_Hl\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p>Another variation is to make a copy of one of the struct values, and modify and compare that to the other, so no need to restore the original, also this is \"more concurrent-friendly\":</p>\n\n<pre><code>// Make copies and make excluded fields equal:\na2 := a\na2.time = b.time\n\nfmt.Println(a2.name == b.name)        // true\nfmt.Println(reflect.DeepEqual(a2, b)) // true\n</code></pre>\n\n<p>Try this on the <a href=\"https://play.golang.org/p/rIOBVWBOhB\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<h2>3. Implement your own, custom comparison</h2>\n\n<p>If you can't or don't want to go with the above solutions, you can always create your own:</p>\n\n<pre><code>func compare(a, b test) bool {\n    return a.name == b.name\n}\n\n\nfmt.Println(a.name == b.name) // true\nfmt.Println(compare(a, b))    // true\n</code></pre>\n\n<p>Try this on the <a href=\"https://play.golang.org/p/LJ4cVhyGui\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p><strong>Notes:</strong></p>\n\n<p>This isn't \"friendly\" at first, as the custom <code>compare()</code> function requires you to check all involved fields, but its implementation may use the above methods, e.g. (try it on the <a href=\"https://play.golang.org/p/jRxOQyPXAM\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>func compare(a, b test) bool {\n    a.time = b.time // We're modifying a copy, so no need to make another copy\n    return reflect.DeepEqual(a, b)\n}\n</code></pre>\n\n<p>You could also pass pointers to <code>compare()</code> to avoid copying the original struct, e.g. (try it on the <a href=\"https://play.golang.org/p/4xI4P0VDRu\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>fmt.Println(a.name == b.name) // true\nfmt.Println(compare(&amp;a, &amp;b))  // true\n\nfunc compare(a, b *test) bool {\n    a2 := new(test)\n    *a2 = *a\n    a2.time = b.time\n    return reflect.DeepEqual(a2, b)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 3, "last_activity_date": 1509970595, "creation_date": 1509970595, "answer_id": 47136857, "question_id": 47134293, "link": "https://stackoverflow.com/questions/47134293/compare-structs-except-one-field-golang/47136857#47136857", "title": "Compare structs except one field golang", "body": "<p>If your fields are exported, you may use <code>reflect</code> to check them. E.g.:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Foo struct {\n    Name string\n    Date int\n}\n\nfunc (f *Foo) EqualExcept(other *Foo, ExceptField string) bool {\n    val := reflect.ValueOf(f).Elem()\n    otherFields := reflect.Indirect(reflect.ValueOf(other))\n\n    for i := 0; i &lt; val.NumField(); i++ {\n        typeField := val.Type().Field(i)\n        if typeField.Name == ExceptField {\n            continue\n        }\n\n        value := val.Field(i)\n        otherValue := otherFields.FieldByName(typeField.Name)\n\n        if value.Interface() != otherValue.Interface() {\n            return false\n        }\n    }\n    return true\n}\n\nfunc main() {\n    f := &amp;Foo{\n        \"Drew\",\n        30,\n    }\n\n    f2 := &amp;Foo{\n        \"Drew\",\n        50,\n    }\n\n    fmt.Println(f.EqualExcept(f2, \"Date\"))\n    fmt.Println(f.EqualExcept(f2, \"Name\"))\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/DlhE8aZGwa\" rel=\"nofollow noreferrer\">https://play.golang.org/p/DlhE8aZGwa</a></p>\n"}], "owner": {"reputation": 301, "user_id": 5561795, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Z0i3f53E6iY/AAAAAAAAAAI/AAAAAAAAEkg/VxUOEbN_GH4/photo.jpg?sz=128", "display_name": "Gaurav Raghuvanshy", "link": "https://stackoverflow.com/users/5561795/gaurav-raghuvanshy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12275, "favorite_count": 3, "accepted_answer_id": 47136278, "answer_count": 3, "score": 12, "last_activity_date": 1509985866, "creation_date": 1509962622, "question_id": 47134293, "link": "https://stackoverflow.com/questions/47134293/compare-structs-except-one-field-golang", "title": "Compare structs except one field golang", "body": "<p>I am comparing two structs and want to ignore a single field while doing so.</p>\n\n<pre><code>type test struct {\n  name string\n  time string\n} \n\nfunc main() {\n  a := test{\"testName\", time.Now().Format(time.UnixTime)}\n  // after some time\n  b := test{\"testName\", time.Now().Format(time.UnixTime)}\n\n  fmt.Println(a.Name == b.Name) \\\\ returns true Desired outcome\n  fmt.Println(reflect.DeepEqual(a,b)) \\\\ returns false\n\n}\n</code></pre>\n\n<p><code>reflect.DeepEqual()</code> does not allow for us to ignore a field and have manually done the comparison one field at a time.</p>\n\n<p>What is the idiomatic way to go about this?</p>\n"}, {"tags": ["string", "go"], "answers": [{"comments": [{"owner": {"reputation": 505, "user_id": 5230333, "user_type": "registered", "accept_rate": 70, "profile_image": "https://lh3.googleusercontent.com/-PIASg7N1v4c/AAAAAAAAAAI/AAAAAAAAAKY/f7HX6_eJ-LU/photo.jpg?sz=128", "display_name": "jm33_m0", "link": "https://stackoverflow.com/users/5230333/jm33-m0"}, "edited": false, "score": 0, "creation_date": 1509955850, "post_id": 47132281, "comment_id": 81214234, "body": "noted, i was just wondering if i can use less code to achieve this (in Go)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 505, "user_id": 5230333, "user_type": "registered", "accept_rate": 70, "profile_image": "https://lh3.googleusercontent.com/-PIASg7N1v4c/AAAAAAAAAAI/AAAAAAAAAKY/f7HX6_eJ-LU/photo.jpg?sz=128", "display_name": "jm33_m0", "link": "https://stackoverflow.com/users/5230333/jm33-m0"}, "edited": false, "score": 0, "creation_date": 1509956330, "post_id": 47132281, "comment_id": 81214482, "body": "@jm33_m0 Write a util function doing just this, and from there on you can do it with &quot;less&quot; code by calling this util function."}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1509963892, "post_id": 47132281, "comment_id": 81218860, "body": "@Volker, no you have not to. There are few other options - see my answer."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1509965288, "post_id": 47132281, "comment_id": 81219656, "body": "@AlexanderTrakhimenok Of course. Throwing regexps at any problem is a fine solution."}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 1, "creation_date": 1509968852, "post_id": 47132281, "comment_id": 81221731, "body": "@Volker, not at any problem. But in some cases it can be easier to code and have better performance. So I&#39;m not getting your sarcasm."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": -1, "last_activity_date": 1509955444, "creation_date": 1509955444, "answer_id": 47132281, "question_id": 47131996, "link": "https://stackoverflow.com/questions/47131996/go-how-to-check-if-a-string-contains-multiple-substrings/47132281#47132281", "title": "Go: how to check if a string contains multiple substrings?", "body": "<blockquote>\n  <p>[H]ow do I check multiple substrings without using <code>strings.Contains()</code> repeatedly?</p>\n</blockquote>\n\n<p>Not at all. You <em>have</em> to call Contains repeatedly.</p>\n"}, {"comments": [{"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 1, "creation_date": 1509963959, "post_id": 47133055, "comment_id": 81218903, "body": "Good answer, there is also at least 2 other options with using regex and custom scanner - see my answer."}], "tags": [], "owner": {"reputation": 7044, "user_id": 7670262, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3zdDY.jpg?s=128&g=1", "display_name": "Azeem", "link": "https://stackoverflow.com/users/7670262/azeem"}, "is_accepted": true, "score": 11, "last_activity_date": 1531892022, "last_edit_date": 1531892022, "creation_date": 1509958603, "answer_id": 47133055, "question_id": 47131996, "link": "https://stackoverflow.com/questions/47131996/go-how-to-check-if-a-string-contains-multiple-substrings/47133055#47133055", "title": "Go: how to check if a string contains multiple substrings?", "body": "<p>You can write your own utility function using <code>strings.Contains()</code> that can work for multiple sub-strings.</p>\n\n<p>Here's an example that returns Boolean (<code>true</code>/<code>false</code>) in case of complete / partial match and the total number of matches:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc checkSubstrings(str string, subs ...string) (bool, int) {\n\n    matches := 0\n    isCompleteMatch := true\n\n    fmt.Printf(\"String: \\\"%s\\\", Substrings: %s\\n\", str, subs)\n\n    for _, sub := range subs {\n        if strings.Contains(str, sub) {\n            matches += 1\n        } else {\n            isCompleteMatch = false\n        }\n    }\n\n    return isCompleteMatch, matches\n}\n\nfunc main() {\n    isCompleteMatch1, matches1 := checkSubstrings(\"Hello abc, xyz, abc\", \"abc\", \"xyz\")\n    fmt.Printf(\"Test 1: { isCompleteMatch: %t, Matches: %d }\\n\", isCompleteMatch1, matches1)\n\n    fmt.Println()\n\n    isCompleteMatch2, matches2 := checkSubstrings(\"Hello abc, abc\", \"abc\", \"xyz\")\n    fmt.Printf(\"Test 2: { isCompleteMatch: %t, Matches: %d }\\n\", isCompleteMatch2, matches2)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>String: \"Hello abc, xyz, abc\", Substrings: [abc xyz]\nTest 1: { isCompleteMatch: true, Matches: 2 }\n\nString: \"Hello abc, abc\", Substrings: [abc xyz]\nTest 2: { isCompleteMatch: false, Matches: 1 }\n</code></pre>\n\n<p>Here's the live example: <a href=\"https://play.golang.org/p/Xka0KfBrRD\" rel=\"noreferrer\">https://play.golang.org/p/Xka0KfBrRD</a></p>\n"}, {"comments": [{"owner": {"reputation": 7044, "user_id": 7670262, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3zdDY.jpg?s=128&g=1", "display_name": "Azeem", "link": "https://stackoverflow.com/users/7670262/azeem"}, "edited": false, "score": 0, "creation_date": 1509964961, "post_id": 47134680, "comment_id": 81219444, "body": "Nice one, Alex! Can we impose the checking of all the sub-strings using regex?"}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "reply_to_user": {"reputation": 7044, "user_id": 7670262, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3zdDY.jpg?s=128&g=1", "display_name": "Azeem", "link": "https://stackoverflow.com/users/7670262/azeem"}, "edited": false, "score": 1, "creation_date": 1509969011, "post_id": 47134680, "comment_id": 81221830, "body": "You can if they are in specific order. If they are in arbitrary order you still can but the regex could become pretty complicated for N &gt; 2 as you would need permutation of all possible options - will become messy pretty quickly."}, {"owner": {"reputation": 3266, "user_id": 1136066, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f53d5a0d9f4b971c536c9b9ed0be2341?s=128&d=identicon&r=PG", "display_name": "CodeGuru", "link": "https://stackoverflow.com/users/1136066/codeguru"}, "edited": false, "score": 0, "creation_date": 1538282985, "post_id": 47134680, "comment_id": 92085273, "body": "Great Suggestion!"}], "tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": false, "score": 8, "last_activity_date": 1509963852, "creation_date": 1509963852, "answer_id": 47134680, "question_id": 47131996, "link": "https://stackoverflow.com/questions/47131996/go-how-to-check-if-a-string-contains-multiple-substrings/47134680#47134680", "title": "Go: how to check if a string contains multiple substrings?", "body": "<p>Yes, you can do this without calling <code>strings.Contains()</code> multiple times.</p>\n\n<p>If you know substrings in advance the easiest way to check this with regular expression.  And if a string to check is long and you have quite a few substrings it can be more fast then calling multiple <code>strings.Contains</code></p>\n\n<p>Example <a href=\"https://play.golang.org/p/7PokxbOOo7\" rel=\"noreferrer\">https://play.golang.org/p/7PokxbOOo7</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nvar re = regexp.MustCompile(`first|second|third`)\n\nfunc main() {\n    fmt.Println(re.MatchString(\"This is the first example\"))\n    fmt.Println(re.MatchString(\"This is the second example after first\"))\n    fmt.Println(re.MatchString(\"This is the third example\"))\n    fmt.Println(re.MatchString(\"This is the forth example\"))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>true\ntrue\ntrue\nfalse\n</code></pre>\n\n<p>If the subs to check are dynamic it may be a bit more difficult to create regex as you need to escape special characters and regex compilation is not fast so <code>strings.Contains()</code> may be better in this case though it's better test if your code is performance critical.</p>\n\n<p><strong>Another good option</strong> could be to write your own scanner that can leverage common prefixes in substrings (<em>if any</em>) using <a href=\"https://en.wikipedia.org/wiki/Trie\" rel=\"noreferrer\">prefix tree</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 2, "last_activity_date": 1509968996, "creation_date": 1509968996, "answer_id": 47136363, "question_id": 47131996, "link": "https://stackoverflow.com/questions/47131996/go-how-to-check-if-a-string-contains-multiple-substrings/47136363#47136363", "title": "Go: how to check if a string contains multiple substrings?", "body": "<p>Another solution would be using a combination of <code>regexp</code> and <code>suffixarray</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"index/suffixarray\"\n    \"regexp\"\n    \"strings\"\n)\n\nfunc main() {\n    fmt.Println(contains(\"first secondthird\", \"first\", \"second\", \"third\"))\n    fmt.Println(contains(\"first secondthird\", \"first\", \"10th\"))\n}\n\nfunc contains(str string, subStrs ...string) bool {\n    if len(subStrs) == 0 {\n        return true\n    }\n    r := regexp.MustCompile(strings.Join(subStrs, \"|\"))\n    index := suffixarray.New([]byte(str))\n    res := index.FindAllIndex(r, -1)\n    exists := make(map[string]int)\n    for _, v := range subStrs {\n        exists[v] = 1\n    }\n    for _, pair := range res {\n        s := str[pair[0]:pair[1]]\n        exists[s] = exists[s] + 1\n    }\n    for _, v := range exists {\n        if v == 1 {\n            return false\n        }\n    }\n    return true\n}\n</code></pre>\n\n<p>(In <a href=\"https://play.golang.org/p/8MJQ6t1tSV\" rel=\"nofollow noreferrer\">Go Playground</a>)</p>\n"}], "owner": {"reputation": 505, "user_id": 5230333, "user_type": "registered", "accept_rate": 70, "profile_image": "https://lh3.googleusercontent.com/-PIASg7N1v4c/AAAAAAAAAAI/AAAAAAAAAKY/f7HX6_eJ-LU/photo.jpg?sz=128", "display_name": "jm33_m0", "link": "https://stackoverflow.com/users/5230333/jm33-m0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14461, "favorite_count": 1, "accepted_answer_id": 47133055, "answer_count": 4, "score": 7, "last_activity_date": 1531892022, "creation_date": 1509954156, "last_edit_date": 1509955286, "question_id": 47131996, "link": "https://stackoverflow.com/questions/47131996/go-how-to-check-if-a-string-contains-multiple-substrings", "title": "Go: how to check if a string contains multiple substrings?", "body": "<p><code>strings.Contains(str_to_check, substr)</code> takes only one argument as the substring to check, how do I check multiple substrings without using <code>strings.Contains()</code> repeatedly?</p>\n\n<p>eg. <code>strings.Contains(str_to_check, substr1, substr2)</code></p>\n"}, {"tags": ["go", "httprequest", "url-redirection"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1509950696, "post_id": 47131087, "comment_id": 81211920, "body": "Show your code. Are you using Go 1.5 or later?"}, {"owner": {"reputation": 484, "user_id": 6666017, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/Xeyin.jpg?s=128&g=1", "display_name": "StackB00m", "link": "https://stackoverflow.com/users/6666017/stackb00m"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1509950808, "post_id": 47131087, "comment_id": 81211965, "body": "@CeriseLim&#243;n  am using go1.9 and the code is here - <a href=\"https://pastebin.com/2yAaqtqG\" rel=\"nofollow noreferrer\">pastebin.com/2yAaqtqG</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1509981895, "post_id": 47131087, "comment_id": 81230208, "body": "Code looks correct in you are using Go version with URL.RawPath functionality (needed for the %2f).  The application correctly follows the redirects from the server.  I suggest using browser dev tools and <a href=\"https://godoc.org/net/http#Client.CheckRedirect\" rel=\"nofollow noreferrer\">CheckRedirect</a> hook in client app to view redirects and see what&#39;s different."}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 2, "last_activity_date": 1509972813, "creation_date": 1509972813, "answer_id": 47137501, "question_id": 47131087, "link": "https://stackoverflow.com/questions/47131087/not-able-to-get-exact-effective-final-url/47137501#47137501", "title": "Not able to get exact effective,final URL", "body": "<p>Other side behavior may depends on a lot of factors - for example of your User-Agent used, Cookies, IP and so on. Also sometimes it can change because of DDoS protection mechanism or things alike.</p>\n\n<p>You may modify your app and see how it passes redirect stages:</p>\n\n<p>Result:</p>\n\n<pre><code>getURL: http://swiggy.com//google.com/%2f..\nRedirecting: 301 https://swiggy.com/google.com/%2f..\nRedirecting: 301 https://www.swiggy.com/google.com/%2f..\nRedirecting: 303 https://www.swiggy.com/google.com/%2f../\nfinalURL: https://www.swiggy.com/google.com/%2f../\nReq Headers: map[Referer:[https://www.swiggy.com/google.com/%2f..]]\nResp Headers: map[Date:[Mon, 06 Nov 2017 12:51:20 GMT] Content-Type:[text/html; charset=utf-8] Content-Security-Policy-Report-Only:[default-src 'self';script-src https://chuknu.sokrati.com/15946/ https://www.google-analytics.com/ https://cdn.inspectlet.com/ https://tracking.sokrati.com/ https://connect.facebook.net/ https://bam.nr-data.net/ https://maps.googleapis.com/ https://js-agent.newrelic.com/ https://www.googletagmanager.com/ https://s3-ap-southeast-1.amazonaws.com/static.swiggy/ https://*.juspay.in https://connect.facebook.net/ https://www.googletagmanager.com/ *.swiggy.in *.swiggy.com https://chat2.hotline.io/ 'self' 'unsafe-inline' 'unsafe-eval' 'nonce-150997268072300';style-src https://fonts.googleapis.com/ https://www.swiggy.com/ https://s3-ap-southeast-1.amazonaws.com/static.swiggy/ https://chat2.hotline.io/ 'self' 'unsafe-inline' 'unsafe-eval';img-src https://res.cloudinary.com/swiggy/ https://www.google-analytics.com/ https://www.google.co.in/ https://www.facebook.com/ https://tracking.sokrati.com/ http://api.swiggy.in/ https://api.swiggy.com https://d3oxf4lkkqx2kx.cloudfront.net/ https://maps.googleapis.com/ https://maps.gstatic.com/ https://csi.gstatic.com/ https://fonts.gstatic.com/ https://stats.g.doubleclick.net/ https://googleads.g.doubleclick.net/ https://www.google.com/ data: 'self'; font-src https://www.swiggy.com/ https://fonts.gstatic.com/ data: 'self';connect-src https://hn.inspectlet.com/ https://www.swiggy.com/ https://www.facebook.com/tr/ https://*.juspay.in/txns https://sentry.swiggyapp.com/ 'self';frame-src https://www.facebook.com/tr/ https://chat2.hotline.io/ https://*.webpush.hotline.io 'self';report-uri /csp/log] Etag:[W/\"6f97-\"] Vary:[Accept-Encoding] X-Data-Origin:[dweb_cluster/port-dweb-06 naxsi/waf rate-limiter-plain/rate-limiter-plain] X-Xss-Protection:[1; mode=block] Strict-Transport-Security:[max-age=31536000; includeSubdomains; preload] X-Frame-Options:[Deny] Set-Cookie:[__SW=sjfsljfd; Path=/]]\n</code></pre>\n\n<p>Modified code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc CheckRedirect(r *http.Request, via []*http.Request) error {\n    fmt.Println(\"Redirecting:\", r.Response.StatusCode, r.URL)\n    return nil\n}\n\nfunc main() {\n    getURL := \"http://swiggy.com//google.com/%2f..\"\n    fmt.Println(\"getURL:\", getURL)\n    client := &amp;http.Client{\n        CheckRedirect: CheckRedirect,\n    }\n    resp, err := client.Get(getURL)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    finalURL := resp.Request.URL.String()\n    fmt.Println(\"finalURL:\", finalURL)\n    fmt.Println(\"Req Headers:\", resp.Request.Header)\n    fmt.Println(\"Resp Headers:\", resp.Header)\n}\n</code></pre>\n"}], "owner": {"reputation": 484, "user_id": 6666017, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/Xeyin.jpg?s=128&g=1", "display_name": "StackB00m", "link": "https://stackoverflow.com/users/6666017/stackb00m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 117, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1509972813, "creation_date": 1509950052, "question_id": 47131087, "link": "https://stackoverflow.com/questions/47131087/not-able-to-get-exact-effective-final-url", "title": "Not able to get exact effective,final URL", "body": "<p>Using the Golang's http.Get() i am able to get effective or final url after multiple redirects,but in few cases where there are 303 redirects and special characters in URL golang is being weird, i am not able to get the actual final url. Following is the example i am dealing with - \"<a href=\"http://swiggy.com//google.com/%2f\" rel=\"nofollow noreferrer\">http://swiggy.com//google.com/%2f</a>..\" , if we open this url in browser we get redirected to google, but i couldnt get the same using http.Get()</p>\n"}, {"tags": ["mongodb", "go", "full-text-search", "mgo", "full-text-indexing"], "answers": [{"tags": [], "owner": {"reputation": 346, "user_id": 5735210, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b84bfb2c8eb3cebfdf62f514bee0b864?s=128&d=identicon&r=PG&f=1", "display_name": "Cit5", "link": "https://stackoverflow.com/users/5735210/cit5"}, "is_accepted": false, "score": 1, "last_activity_date": 1509964744, "last_edit_date": 1509964744, "creation_date": 1509947188, "answer_id": 47130483, "question_id": 47130383, "link": "https://stackoverflow.com/questions/47130383/full-text-search-implementation-with-golang-and-mongodb-using-mgo/47130483#47130483", "title": "full text search implementation with Golang and MongoDB using mgo", "body": "<p>NEVER MIND! </p>\n\n<pre><code>var res = []bson.M{}\n</code></pre>\n\n<p>I know I know... I will go shoot myself now. haha! Thanks anyways!</p>\n"}], "owner": {"reputation": 346, "user_id": 5735210, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b84bfb2c8eb3cebfdf62f514bee0b864?s=128&d=identicon&r=PG&f=1", "display_name": "Cit5", "link": "https://stackoverflow.com/users/5735210/cit5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 923, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1509964744, "creation_date": 1509946651, "question_id": 47130383, "link": "https://stackoverflow.com/questions/47130383/full-text-search-implementation-with-golang-and-mongodb-using-mgo", "title": "full text search implementation with Golang and MongoDB using mgo", "body": "<p>I am trying to print the 6 objects I know contain my search term. I am able to see the query array of the right length/size/capacity. But when I iterate the array and print, they do not contain any information.</p>\n\n<p>My initial reaction is that maybe I have the wrong interface for my results.</p>\n\n<p>code snippet:</p>\n\n<pre><code>var sTerm = \"Google\"\nindex := mgo.Index{\n    Key: []string{\"product.maker\", \"product.product\"},\n}\n\nerr = col.EnsureIndex(index)\n//err = col.EnsureIndexKey(\"product.maker\")\ncheck(err)\n\n//query := col.Find(bson.M{\"$text\": bson.M{\"$search\": sTerm}})\nquery := col.Find(bson.M{\"product.maker\": sTerm})\n//query := col.Find(bson.M{\"product.maker\": &amp;bson.RegEx{Pattern: sTerm, Options: \"i\"}})\nfmt.Println(query)\n\nvar res []struct{ Value int }\nerr = query.All(&amp;res)\ncheck(err)\nfmt.Println(res)\nfor i := 0; i &lt; len(res); i++ {\n    fmt.Println(res[i])\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>&amp;{{0 0} 0xc042056d00 {{devbase.devices map[product.maker:Google] 0 0 &lt;nil&gt; 0 &lt;nil&gt; 0 {&lt;nil&gt; &lt;nil&gt; &lt;nil&gt; false false [] 0 0 } false []} 0.25 0}}\n[{0} {0} {0} {0} {0} {0}]\n{0}\n{0}\n{0}\n{0}\n{0}\n{0}\n</code></pre>\n\n<p>For now, I am hardcoding the search term, I have already set up a http handler function for the response and a Gorilla mux.</p>\n"}, {"tags": ["go", "cobra", "go-cobra"], "answers": [{"tags": [], "owner": {"reputation": 301, "user_id": 2457026, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4477aee50b5cc6988b12389f17484a1b?s=128&d=identicon&r=PG", "display_name": "fzlrhmn", "link": "https://stackoverflow.com/users/2457026/fzlrhmn"}, "is_accepted": true, "score": 2, "last_activity_date": 1510331397, "creation_date": 1510331397, "answer_id": 47227243, "question_id": 47130308, "link": "https://stackoverflow.com/questions/47130308/golang-cobra-subcommands-without-arguments-matching/47227243#47227243", "title": "golang cobra subcommands without arguments matching", "body": "<p>I've solved this. Just add new cobra command to <code>applicationCmd</code> like so</p>\n\n<pre><code>applicationCmd.AddCommand(yourNewCommand)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 301, "user_id": 2457026, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4477aee50b5cc6988b12389f17484a1b?s=128&d=identicon&r=PG", "display_name": "fzlrhmn", "link": "https://stackoverflow.com/users/2457026/fzlrhmn"}, "edited": false, "score": 0, "creation_date": 1510406149, "post_id": 47227848, "comment_id": 81426548, "body": "Yes exactly like that. Thanks!"}], "tags": [], "owner": {"reputation": 145, "user_id": 7471352, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/448a503438bdc7c5114bb1e7b95155da?s=128&d=identicon&r=PG&f=1", "display_name": "Aor", "link": "https://stackoverflow.com/users/7471352/aor"}, "is_accepted": false, "score": 6, "last_activity_date": 1510334012, "last_edit_date": 1510334012, "creation_date": 1510333489, "answer_id": 47227848, "question_id": 47130308, "link": "https://stackoverflow.com/questions/47130308/golang-cobra-subcommands-without-arguments-matching/47227848#47227848", "title": "golang cobra subcommands without arguments matching", "body": "<p>I went slightly overboard; but yes, appCmd.Addcommand(newCmd) is what you were looking for.</p>\n\n<p>(I had started working on this before you posted your answer, but I didn't want to scrap the code)</p>\n\n<pre><code>package main\n\nimport (\n\"github.com/spf13/cobra\"\n\"fmt\"\n)\n\nvar rootCmd = &amp;cobra.Command{\n    Use:   \"app\",\n    Run: func (cmd *cobra.Command, args []string) {\n    },\n}\n\nvar makeU = &amp;cobra.Command{\n    Use:   \"makeU\",\n    Short: \"makes a user\",\n    Long: \"Prints stuff about the user. You could also use the flags in your addPartner() function\",\n    Run: func (cmd *cobra.Command, args []string) {\n        fmt.Println(\"User's name: \" + uName)\n        fmt.Println(\"User's number: \" + uNumber)\n        fmt.Println(\"User's other stuff: \" + uOtherStuff)\n    },\n}\n\nvar makeP = &amp;cobra.Command{\n    Use:   \"makeP\",\n    Short: \"makes a partner\",\n    Long: \"Prints stuff about the partner. You could also use the flags in your addPartner() function\",\n    Run: func (cmd *cobra.Command, args []string) {\n        fmt.Println(\"Partner's name: \" + uName)\n        fmt.Println(\"Partner's number: \" + uNumber)\n        fmt.Println(\"Partner's other stuff: \" + uOtherStuff)\n    },\n}\n\n// adds commands\nfunc addCommands() {\n    rootCmd.AddCommand(makeU)\n    rootCmd.AddCommand(makeP)\n}\n\n// adds flags\nvar pName, pNumber, pOtherStuff string\nvar uName, uNumber, uOtherStuff string\nfunc init() {\n    makeU.Flags().StringVar(&amp;uName, \"username\", \"default\", \"--username=&lt;user's name&gt;\")\n    makeU.Flags().StringVar(&amp;uNumber, \"usernumber\", \"default\", \"--usernumber=&lt;user's number&gt;\")\n    makeU.Flags().StringVar(&amp;uOtherStuff, \"userother\", \"default\", \"--userother=&lt;user's other stuff&gt;\")\n    makeP.Flags().StringVar(&amp;pName, \"partnername\", \"default\", \"--partnername=&lt;partner's name&gt;\")\n    makeP.Flags().StringVar(&amp;pNumber, \"partnernumber\", \"default\", \"--partnernumber=&lt;partner's number&gt;\")\n    makeP.Flags().StringVar(&amp;pOtherStuff, \"partnerother\", \"default\", \"--partnerother=&lt;partner's other stuff&gt;\")\n}\n\n\nfunc main() {\n    addCommands()\n    rootCmd.Execute()\n}\n</code></pre>\n"}], "owner": {"reputation": 301, "user_id": 2457026, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4477aee50b5cc6988b12389f17484a1b?s=128&d=identicon&r=PG", "display_name": "fzlrhmn", "link": "https://stackoverflow.com/users/2457026/fzlrhmn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2338, "favorite_count": 1, "accepted_answer_id": 47227243, "answer_count": 2, "score": 6, "last_activity_date": 1510342749, "creation_date": 1509946279, "last_edit_date": 1510342749, "question_id": 47130308, "link": "https://stackoverflow.com/questions/47130308/golang-cobra-subcommands-without-arguments-matching", "title": "golang cobra subcommands without arguments matching", "body": "<p>i want to create golang CLI with <a href=\"https://github.com/spf13/cobra\" rel=\"noreferrer\">cobra</a>. For now, it runs well. I have created something like <code>foobar create --username johndoe</code>. But I need subcommands like <code>foobar create user --username johndoe</code>. There is <code>user</code> subcommand. </p>\n\n<p>I have created with arguments matching, </p>\n\n<pre><code>var applicationCmd = &amp;cobra.Command{\n   Use:   \"application\",\n   Short: \"Create/Read/Update application\",\n   Long: `You can create any user or partner.`,\n   Run: (cmd *cobra.Command, args []string) {\n        if len(args) &lt; 1 {\n            fmt.Printf(\"%sPlease choose any object that you want to change e.g (user, partner)%s\\n\", chalk.Red, chalk.Reset)\n        }\n        if stringUtil.Contains(args, \"user\") {\n            createUser()\n        }\n        if stringUtil.Contains(args, \"partner\") {\n            createPartner()\n        }\n   },\n}\n</code></pre>\n\n<p>but I think there is a better way to do it using cobra rather than using arguments matching like this. Any suggestion?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1509944491, "post_id": 47130003, "comment_id": 81209860, "body": "Use a slice of maps."}, {"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1509944681, "post_id": 47130003, "comment_id": 81209910, "body": "so if i understand it correctly, you needed an array of JSON?"}, {"owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 0, "creation_date": 1509945939, "post_id": 47130003, "comment_id": 81210269, "body": "yes. thanks . if you can please paste me some sample code.. i can take it forward"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1509950724, "post_id": 47130003, "comment_id": 81211931, "body": "I&#39;m voting to close this question as off-topic because SO is not a write code for me site."}, {"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1509951505, "post_id": 47130003, "comment_id": 81212232, "body": "@user2315104, check this out <a href=\"https://gobyexample.com/json\" rel=\"nofollow noreferrer\">gobyexample.com/json</a>, i&#39;m not sure though whether you have particular JSON structure in mind."}, {"owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 0, "creation_date": 1509952708, "post_id": 47130003, "comment_id": 81212741, "body": "thanks. i tried with this, but not getting how to define list of maps and then push values in that struct so that after encoding i can get the json"}], "answers": [{"comments": [{"owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "edited": false, "score": 0, "creation_date": 1509965256, "post_id": 47134260, "comment_id": 81219634, "body": "awesome .. got it"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 6, "creation_date": 1509982228, "post_id": 47134260, "comment_id": 81230423, "body": "Here&#39;s how to do it without the extra types: `\tmyMapSlice := []map[string]interface{}{{&quot;dn&quot;: &quot;abc&quot;, &quot;status&quot;: &quot;live&quot;},{&quot;version&quot;: 2, &quot;xyz&quot;: 3}}` <a href=\"https://play.golang.org/p/PU9oE-0vRR\" rel=\"nofollow noreferrer\">playground example</a>."}], "tags": [], "owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "is_accepted": true, "score": 20, "last_activity_date": 1509963879, "last_edit_date": 1509963879, "creation_date": 1509962510, "answer_id": 47134260, "question_id": 47130003, "link": "https://stackoverflow.com/questions/47130003/how-can-i-declare-list-of-maps-in-golang/47134260#47134260", "title": "How can i declare list of maps in golang", "body": "<p>As suggested by @Volker, you should use slice of maps:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\n// M is an alias for map[string]interface{}\ntype M map[string]interface{}\n\nfunc main() {\n    var myMapSlice []M\n\n    m1 := M{\"dn\": \"abc\", \"status\": \"live\"}\n\n    m2 := M{\"version\": 2, \"xyz\": 3}\n\n    myMapSlice = append(myMapSlice, m1, m2)\n\n    // or you could use `json.Marshal(myMapSlice)` if you want\n    myJson, _ := json.MarshalIndent(myMapSlice, \"\", \"    \")\n    fmt.Println(string(myJson))\n}\n</code></pre>\n\n<p>Outputs:</p>\n\n<pre><code>[\n    {\n        \"dn\": \"abc\",\n        \"status\": \"live\"\n    },\n    {\n        \"version\": 2,\n        \"xyz\": 3\n    }\n]\n</code></pre>\n\n<p>From the code, I've used an alias for <code>map[string]interface{}</code> to make it more convenient to initialize a map of interface.</p>\n\n<p>Link to code: <a href=\"https://play.golang.org/p/gu3xafnAyG\" rel=\"noreferrer\">https://play.golang.org/p/gu3xafnAyG</a></p>\n"}], "owner": {"reputation": 1294, "user_id": 2315104, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/67897548b9d55c6e2f8e3171fa7ca20d?s=128&d=identicon&r=PG", "display_name": "user2315104", "link": "https://stackoverflow.com/users/2315104/user2315104"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11740, "favorite_count": 6, "accepted_answer_id": 47134260, "answer_count": 1, "score": 9, "last_activity_date": 1509963879, "creation_date": 1509944390, "question_id": 47130003, "link": "https://stackoverflow.com/questions/47130003/how-can-i-declare-list-of-maps-in-golang", "title": "How can i declare list of maps in golang", "body": "<p>i am not getting how should i format the struct in golang so that i can get the list of maps (key/value pairs) in JSON format ?\nSo far i tried with this </p>\n\n<pre><code>package main\n\nimport (\n\"encoding/json\"\n\"fmt\"\n)\n\nfunc main() {\nmap1 := map[string]interface{}{\"dn\": \"abc\", \"status\": \"live\", \"version\": 2, \"xyz\": 3}\nmap2, _ := json.Marshal(map1)\nfmt.Println(string(map2))\n}\n</code></pre>\n\n<p>here it is just printing key/value pairs...</p>\n\n<blockquote>\n  <p>{\"dn\":\"abc\",\"status\":\"live\",\"version\":2,\"xyz\":3}</p>\n</blockquote>\n\n<p>but i need output something like this :</p>\n\n<blockquote>\n  <p>[{\"dn\":\"abc\",\"status\":\"live\"},{\"version\":2,\"xyz\":3}]</p>\n</blockquote>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1509939081, "post_id": 47128480, "comment_id": 81208681, "body": "Storing arbitrary value is easy. You can do it by defining the tag as <code>interface{}</code>. Perhaps I don&#39;t clearly understand your need, but I think <i>storing arbitrary value and expecting to be able to statically verify the type of the value</i> is not possible. If the tag will be passed as the function&#39;s argument, then it will be possible."}, {"owner": {"reputation": 113, "user_id": 1775551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a39f521e3531253869e967c721b7ba39?s=128&d=identicon&r=PG", "display_name": "callpraths", "link": "https://stackoverflow.com/users/1775551/callpraths"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1509983161, "post_id": 47128480, "comment_id": 81231079, "body": "Thanks. I ended up doing this. Accepted Andy&#39;s answer below because it has an example."}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 1775551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a39f521e3531253869e967c721b7ba39?s=128&d=identicon&r=PG", "display_name": "callpraths", "link": "https://stackoverflow.com/users/1775551/callpraths"}, "edited": false, "score": 0, "creation_date": 1509983282, "post_id": 47129324, "comment_id": 81231175, "body": "Thanks. The key here was to reiterate to myself that interfaces can be satisfied by pointers to structs. This trips me up still, coming from C/C++"}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 1, "last_activity_date": 1509938933, "creation_date": 1509938933, "answer_id": 47129324, "question_id": 47128480, "link": "https://stackoverflow.com/questions/47128480/golang-preferred-way-to-tag-a-struct-with-aribtrary-data/47129324#47129324", "title": "golang: Preferred way to tag a struct with aribtrary data", "body": "<p>If you need to support arbitrary data types, you'll need to use an empty interface:</p>\n\n<pre><code>type NodeWithTag struct {\n    Nexts []*NodeWithTag\n    Tag   interface{}\n}\n</code></pre>\n\n<p>You can assign any value to the <code>Tag</code> field. If you want to verify that the value is a certain type, say <code>MyType</code>, you can use a type assertion:</p>\n\n<pre><code>myVal, ok := node.Tag.(MyType)\n</code></pre>\n\n<p>If the value is of that type, <code>ok</code> will be true and <code>myVal</code> will contain the typed value.</p>\n"}], "owner": {"reputation": 113, "user_id": 1775551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a39f521e3531253869e967c721b7ba39?s=128&d=identicon&r=PG", "display_name": "callpraths", "link": "https://stackoverflow.com/users/1775551/callpraths"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 47129324, "answer_count": 1, "score": 1, "last_activity_date": 1509938933, "creation_date": 1509931543, "question_id": 47128480, "link": "https://stackoverflow.com/questions/47128480/golang-preferred-way-to-tag-a-struct-with-aribtrary-data", "title": "golang: Preferred way to tag a struct with aribtrary data", "body": "<p>tl;dr\nI have an arbitrary directed graph defined by a Node struct.\nI now want to be able to provide a way to write functions that walk this graph and \"tag\" each Node with metadata specific to that function.</p>\n\n<p>For example, consider a function to count the number of nodes:</p>\n\n<pre><code>type Node struct {\n    Nexts []*Node\n}\n\nfunc CountNodes(root *Node) int {\n    m := make(map[*Node]bool)\n    return countNodesHelper(root, m)\n}\n\nfunc countNodesHelper(root *Node, m map[*Node]bool) int {\n    _, seen := m[root]\n    if seen {\n        return 0\n    }\n    m[root] = true\n    c := 1\n    for _, child := range root.Nexts {\n        c += countNodesHelper(child, m)\n    }\n    return c\n}\n\nfunc main() {\n    n1 := &amp;Node{make([]*Node, 0, 1)}\n    n2 := &amp;Node{[]*Node{n1}}\n    n1.Nexts = append(n1.Nexts, n2)\n    fmt.Println(CountNodes(n1))\n}\n</code></pre>\n\n<p>I could rewrite this if I added a \"seen\" tag inside the struct:</p>\n\n<pre><code>type NodeWithTag struct {\n    Nexts []*NodeWithTag\n    Seen  bool\n}\n\nfunc CountNodesWithTag(root *NodeWithTag) int {\n    if root.Seen {\n        return 0\n    }\n    root.Seen = true\n    c := 1\n    for _, child := range root.Nexts {\n        c += CountNodesWithTag(child)\n    }\n    return c\n}\n\nfunc main() {\n    n1 := &amp;NodeWithTag{make([]*NodeWithTag, 0, 1), false}\n    n2 := &amp;NodeWithTag{[]*NodeWithTag{n1}, false}\n    n1.Nexts = append(n1.Nexts, n2)\n    fmt.Println(CountNodesWithTag(n1))\n}\n</code></pre>\n\n<p>But the Seen tag isn't enough for, say, a DFS on a tree where I also want to find backwards edges (you need to count up to 2 -- never seen, seen, seen a second time along a a single path). So, I want some way to allow the function's implementation to use it's own type to tag the struct with. A rough equivalent of:</p>\n\n<pre><code>type Node struct {\n  ...\n  // Not valid golang\n  void* tag\n}\n</code></pre>\n\n<p>but safer that a void* -- The function should be able to statically verify that the tag is the current type that it expects. Is there a way to do this / an alternative approach.</p>\n\n<p>The reason I want to associate the tag with the Node (rather than a separate map / store of the tags) is to allow easy parallelization of the functions that use such tags, farming out the nodes to different goroutines. In the first approach, the map would have to be shared between the goroutines, and this would quickly become a bottleneck because it will require synchronized access.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4676, "user_id": 454646, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4dcd9862c0c73c0eb1465d20668b4e55?s=128&d=identicon&r=PG", "display_name": "Michael Banzon", "link": "https://stackoverflow.com/users/454646/michael-banzon"}, "edited": false, "score": 4, "creation_date": 1509916050, "post_id": 47126587, "comment_id": 81203401, "body": "Can you be more specific with your question?"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 1, "creation_date": 1509924083, "post_id": 47126587, "comment_id": 81205541, "body": "Sample code would be useful to show what you&#39;re doing."}, {"owner": {"reputation": 775, "user_id": 1778335, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/8798166727db11f5ac3f00cb269ee21f?s=128&d=identicon&r=PG", "display_name": "James Haskell", "link": "https://stackoverflow.com/users/1778335/james-haskell"}, "edited": false, "score": 0, "creation_date": 1509945969, "post_id": 47126587, "comment_id": 81210278, "body": "The package I would like to use is: &quot;github.com/jinzhu/now&quot;.  I want to set the global var &quot;now.TimeFormats&quot; each time I call the package.  Or am I just flat out trying to use this package inappropriately and/or dangerously?  I can wrap access inside my own protected struct &amp; method using sync.Mutex... is that good enough?"}], "answers": [{"tags": [], "owner": {"reputation": 4294, "user_id": 804409, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/52840f12b18e63af6e43815f5c678075?s=128&d=identicon&r=PG", "display_name": "omu_negru", "link": "https://stackoverflow.com/users/804409/omu-negru"}, "is_accepted": false, "score": 0, "last_activity_date": 1509918249, "creation_date": 1509918249, "answer_id": 47126968, "question_id": 47126587, "link": "https://stackoverflow.com/questions/47126587/global-var-in-a-called-go-package/47126968#47126968", "title": "Global var in a called Go package", "body": "<p>Use the <a href=\"https://golang.org/pkg/sync/atomic/\" rel=\"nofollow noreferrer\">atomic</a> package with the <code>Value</code> type</p>\n"}, {"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 1, "last_activity_date": 1509936376, "last_edit_date": 1509936376, "creation_date": 1509923860, "answer_id": 47127665, "question_id": 47126587, "link": "https://stackoverflow.com/questions/47126587/global-var-in-a-called-go-package/47127665#47127665", "title": "Global var in a called Go package", "body": "<p>You could use the <a href=\"https://golang.org/pkg/sync/atomic/\" rel=\"nofollow noreferrer\">atomic</a> package, but beware the warning there:</p>\n\n<blockquote>\n  <p>These functions require great care to be used correctly. Except for\n  special, low-level applications, synchronization is better done with\n  channels or the facilities of the sync package. Share memory by\n  communicating; don't communicate by sharing memory.</p>\n</blockquote>\n\n<p>Or you could use sync.Mutex to protect the variable but this would require wrapping it in a struct or an access function to properly control access. </p>\n\n<p>There is a broader question though which you should attempt to answer - if you set this variable every time you access the package, why is it a package variable at all? Why not instead just pass it in to the function which needs it? Since it changes every time anyway, there's little point in a package variable quite apart from the synchronisation problems it poses.  </p>\n"}, {"comments": [{"owner": {"reputation": 775, "user_id": 1778335, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/8798166727db11f5ac3f00cb269ee21f?s=128&d=identicon&r=PG", "display_name": "James Haskell", "link": "https://stackoverflow.com/users/1778335/james-haskell"}, "edited": false, "score": 0, "creation_date": 1509946371, "post_id": 47128170, "comment_id": 81210398, "body": "Thanks.  Definitely will run race detector.  I&#39;m having second thoughts about using this package at all..."}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 1, "last_activity_date": 1509928727, "creation_date": 1509928727, "answer_id": 47128170, "question_id": 47126587, "link": "https://stackoverflow.com/questions/47126587/global-var-in-a-called-go-package/47128170#47128170", "title": "Global var in a called Go package", "body": "<p>Is this variable intended to be used this way? May be there\u2019re some specific setters/getters for it? Does documentation have some info about?</p>\n\n<p>I think code becomes very fragile because you do not control all accesses to the variable. You may serialize access from your code with a mutex. But another lib\u2019s code doesn\u2019t know about your it. Moreover it can change suddenly in new versions or bug fixes. </p>\n\n<p>So I prefer:</p>\n\n<ol>\n<li><p>To read about it in official docs</p></li>\n<li><p>If documentation allows, and I can\u2019t avoid to use it, protect access to the variable with sync/mutex/atomic/channel depending on a task. </p></li>\n<li><p>Prepare tests to cover different cases with the variable</p></li>\n<li><p>Run race condition detector as part of my CI tests. </p></li>\n</ol>\n"}], "owner": {"reputation": 775, "user_id": 1778335, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/8798166727db11f5ac3f00cb269ee21f?s=128&d=identicon&r=PG", "display_name": "James Haskell", "link": "https://stackoverflow.com/users/1778335/james-haskell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "accepted_answer_id": 47128170, "answer_count": 3, "score": 2, "last_activity_date": 1509946148, "creation_date": 1509915602, "last_edit_date": 1509946148, "question_id": 47126587, "link": "https://stackoverflow.com/questions/47126587/global-var-in-a-called-go-package", "title": "Global var in a called Go package", "body": "<p>I'm interested in using a Go package that uses a global variable which, for my application, is a key \"variable\".  Each time I call this package, I want to set that variable (it's exported).  And I'm calling it from various Go routines.  Is there a recommended strategy for sequencing/syncing my calls to that package so that my code isn't colliding on that global variable?</p>\n\n<p>Here's an example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n\n    \"github.com/jameshaskell/_sketches/globalvars/testlib\"\n)\n\nvar wg sync.WaitGroup\n\nfunc gr(i int) {\n    defer wg.Done()\n    testlib.GlobalVar = i\n    duration := time.Duration(i) * time.Millisecond\n    time.Sleep(duration)\n    fmt.Printf(\"   pause %d DONE\\n\", i)\n    fmt.Printf(\"      global var: %d should be: %d  TestFunc: %s\\n\", testlib.GlobalVar, i, testlib.TestFunc())\n}\n\nfunc main() {\n    for i := 0; i &lt;= 10; i += 1 {\n        wg.Add(1)\n        go gr(i)\n    }\n    wg.Wait()\n}\n</code></pre>\n\n<p>The package I'm trying to access would be like:</p>\n\n<pre><code>package testlib\n\nimport \"fmt\"\n\nvar GlobalVar int\n\nfunc TestFunc() string {\n    return fmt.Sprintf(\"GlobalVar: %d\\n\", GlobalVar)\n}\n</code></pre>\n\n<p>NOTE: the package I'm hoping to use (having the global var) isn't mine...</p>\n"}, {"tags": ["xml", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 860, "user_id": 4533179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://lh6.googleusercontent.com/-KNh9ARuyfuU/AAAAAAAAAAI/AAAAAAAAAKU/c_6Cw3NzpP4/photo.jpg?sz=128", "display_name": "jdstaerk", "link": "https://stackoverflow.com/users/4533179/jdstaerk"}, "edited": false, "score": 0, "creation_date": 1509915428, "post_id": 47126170, "comment_id": 81203201, "body": "Oh man that&#39;s embarrassing, don&#39;t know why I could come up with that. Thank you!"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 3, "last_activity_date": 1509912837, "creation_date": 1509912837, "answer_id": 47126170, "question_id": 47126080, "link": "https://stackoverflow.com/questions/47126080/unmarshalling-nested-xml-to-struct/47126170#47126170", "title": "Unmarshalling nested xml to struct", "body": "<pre><code>type Data struct {\n    People []Person `xml:\"person\"`\n}\n\ntype Person struct {\n    Name       string   `xml:\"name\"`\n    Gender     string   `xml:\"gender\"`\n    Somethings []string `xml:\"somethings&gt;thing\"`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/q2CKAfiiwQ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/q2CKAfiiwQ</a></p>\n"}], "owner": {"reputation": 860, "user_id": 4533179, "user_type": "registered", "accept_rate": 65, "profile_image": "https://lh6.googleusercontent.com/-KNh9ARuyfuU/AAAAAAAAAAI/AAAAAAAAAKU/c_6Cw3NzpP4/photo.jpg?sz=128", "display_name": "jdstaerk", "link": "https://stackoverflow.com/users/4533179/jdstaerk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 47126170, "answer_count": 1, "score": 1, "last_activity_date": 1509912837, "creation_date": 1509912292, "question_id": 47126080, "link": "https://stackoverflow.com/questions/47126080/unmarshalling-nested-xml-to-struct", "title": "Unmarshalling nested xml to struct", "body": "<p>How does one create a struct in Go for nested xml content?\nImagine this xml:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;people&gt;\n  &lt;person&gt;\n    &lt;name&gt;Pers1&lt;/name&gt;\n    &lt;gender&gt;female&lt;/gender&gt;\n    &lt;somethings&gt;\n      &lt;thing&gt;123&lt;/thing&gt;\n      &lt;thing&gt;321&lt;/thing&gt;\n    &lt;/somethings&gt;\n  &lt;/person&gt;\n  &lt;person&gt;\n    &lt;name&gt;Pers2&lt;/name&gt;\n    &lt;gender&gt;male&lt;/gender&gt;\n    &lt;somethings&gt;\n      &lt;thing&gt;111&lt;/thing&gt;\n      &lt;thing&gt;222&lt;/thing&gt;\n      &lt;thing&gt;333&lt;/thing&gt;\n    &lt;/somethings&gt;\n  &lt;/person&gt;\n  &lt;person&gt;\n    &lt;name&gt;Pers3&lt;/name&gt;\n    &lt;gender&gt;female&lt;/gender&gt;\n    &lt;somethings&gt;\n      &lt;thing&gt;978&lt;/thing&gt;\n    &lt;/somethings&gt;\n  &lt;/person&gt;\n  &lt;!-- And so on... --&gt;\n&lt;/people&gt;\n</code></pre>\n\n<p>I'm able to load the data but I can't manage to create a struct for this kind of nested data. Every trick you have would be good to know!</p>\n\n<p>Have a good day! :)</p>\n"}, {"tags": ["go", "append"], "answers": [{"comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1509906994, "post_id": 47124947, "comment_id": 81200401, "body": "The difference is 10% for me on Go 1.9.2."}, {"owner": {"reputation": 1657, "user_id": 2864464, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c606da71fcfa488180a8d81c8fdcc7b4?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Kohler", "link": "https://stackoverflow.com/users/2864464/alexander-kohler"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1509907684, "post_id": 47124947, "comment_id": 81200627, "body": "Thank you for adding the second PC\u2019s benchmarks! @Ryan interesting.. that makes me wonder if there were any changes to append between 1.9.2 and what appears to be develop of Go?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1509911897, "post_id": 47124947, "comment_id": 81201982, "body": "@Ryan: What result do you get from running my benchmark, which avoids confounding issues like memory managemant."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509912420, "post_id": 47124947, "comment_id": 81202173, "body": "Interesting, could this be a regression or something? I&#39;m on <code>go version go1.7.1 darwin&#47;amd64</code> and for indexing I get <code>592 ns&#47;op</code> while for append <code>1724 ns&#47;op</code> when running @peterSO&#39;s benchmark."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1509912627, "post_id": 47124947, "comment_id": 81202240, "body": "@peterSO: No difference in the new benchmark. Thanks for adding it!"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509913599, "post_id": 47124947, "comment_id": 81202571, "body": "@mkopriva: There is a large impovement from <code>go version go1.7.6</code> to <code>go version devel</code>. On <code>linux&#47;amd64</code>, <code>BenchmarkIndexing</code> 1082 ns/op to 736 ns/op and <code>BenchmarkAppending </code> 1955 ns/op to <code>733 ns&#47;op</code>. For example, the SSA back end now generates more compact, more efficient code, and provides optimizations such as bounds check elimination."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 8, "last_activity_date": 1509913048, "last_edit_date": 1509913048, "creation_date": 1509905727, "answer_id": 47124947, "question_id": 47124412, "link": "https://stackoverflow.com/questions/47124412/why-is-appending-on-a-preallocated-slice-quicker-than-indexing/47124947#47124947", "title": "Why is appending on a preallocated slice quicker than indexing?", "body": "<p>On computer one:</p>\n\n<pre><code>$ go test same_test.go -run=! -bench=. -benchmem -count=3\ngoos: linux\ngoarch: amd64\nBenchmarkIndex-4     1000000    1290 ns/op    0 B/op    0 allocs/op\nBenchmarkIndex-4     1000000    1290 ns/op    0 B/op    0 allocs/op\nBenchmarkIndex-4     1000000    1288 ns/op    0 B/op    0 allocs/op\nBenchmarkAppend-4    1000000    1299 ns/op    0 B/op    0 allocs/op\nBenchmarkAppend-4    1000000    1302 ns/op    0 B/op    0 allocs/op\nBenchmarkAppend-4    1000000    1301 ns/op    0 B/op    0 allocs/op\nPASS\nok      command-line-arguments  7.868s\n$ go version\ngo version devel +38c725b148 Sun Nov 5 17:30:11 2017 +0000 linux/amd64\n$ \n</code></pre>\n\n<p>The difference between <code>BenchmarkAppend</code> and <code>BenchmarkIndex</code> is:</p>\n\n<pre><code>((1299+1302+1301) - (1290+1290+1288)) * 100 / (1290+1290+1288) =  +0.879%\n</code></pre>\n\n<p>They are the same.</p>\n\n<p>On computer two:</p>\n\n<pre><code>$ go test same_test.go -run=! -bench=. -benchmem -count=3\ngoos: linux\ngoarch: amd64\nBenchmarkIndex-8     2000000    706 ns/op    0 B/op    0 allocs/op\nBenchmarkIndex-8     2000000    713 ns/op    0 B/op    0 allocs/op\nBenchmarkIndex-8     2000000    710 ns/op    0 B/op    0 allocs/op\nBenchmarkAppend-8    2000000    711 ns/op    0 B/op    0 allocs/op\nBenchmarkAppend-8    2000000    718 ns/op    0 B/op    0 allocs/op\nBenchmarkAppend-8    2000000    718 ns/op    0 B/op    0 allocs/op\nPASS\nok      command-line-arguments  12.945s\n$ go version\ngo version devel +38c725b148 Sun Nov 5 17:30:11 2017 +0000 linux/amd64\n$ \n</code></pre>\n\n<p>The difference between <code>BenchmarkAppend</code> and <code>BenchmarkIndex</code> is:</p>\n\n<pre><code>((711+718+718) - (706+713+710)) * 100 / (706+713+710) =  +0.845%\n</code></pre>\n\n<p>They are the same.</p>\n\n<hr>\n\n<p>Let's measure one thing at a time, indexing versus appending over a preallocated slice, which avoids confounding issues like memory management.</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nfunc BenchmarkIndexing(b *testing.B) {\n    existing := make([]int64, 1000, 1000)\n    init := make([]int64, 1000) // len 1000, cap 1000\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        init = init[:cap(init)]\n        for index, element := range existing {\n            init[index] = element\n        }\n    }\n}\n\nfunc BenchmarkAppending(b *testing.B) {\n    existing := make([]int64, 1000, 1000)\n    init := make([]int64, 0, 1000) // len 0, capacity 1000\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        init = init[:0]\n        for _, element := range existing {\n            init = append(init, element)\n        }\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go test same_test.go -run=! -bench=ing -benchmem -count=3\ngoos: linux\ngoarch: amd64\nBenchmarkIndexing-4     2000000    736 ns/op    0 B/op    0 allocs/op\nBenchmarkIndexing-4     2000000    735 ns/op    0 B/op    0 allocs/op\nBenchmarkIndexing-4     2000000    735 ns/op    0 B/op    0 allocs/op\nBenchmarkAppending-4    2000000    733 ns/op    0 B/op    0 allocs/op\nBenchmarkAppending-4    2000000    733 ns/op    0 B/op    0 allocs/op\nBenchmarkAppending-4    2000000    733 ns/op    0 B/op    0 allocs/op\nPASS\nok      command-line-arguments  13.303s\n$ go version\ngo version devel +38c725b148 Sun Nov 5 17:30:11 2017 +0000 linux/amd64\n$\n</code></pre>\n\n<p>The difference between <code>BenchmarkAppend</code> and <code>BenchmarkIndex</code> is:</p>\n\n<pre><code>((733+733+733) - (736+735+735)) * 100 / (736+735+735) =  \u22120.317%\n</code></pre>\n\n<p>They are the same.</p>\n"}], "owner": {"reputation": 1657, "user_id": 2864464, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c606da71fcfa488180a8d81c8fdcc7b4?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Kohler", "link": "https://stackoverflow.com/users/2864464/alexander-kohler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 244, "favorite_count": 1, "accepted_answer_id": 47124947, "answer_count": 1, "score": 3, "last_activity_date": 1509913048, "creation_date": 1509902718, "last_edit_date": 1509904923, "question_id": 47124412, "link": "https://stackoverflow.com/questions/47124412/why-is-appending-on-a-preallocated-slice-quicker-than-indexing", "title": "Why is appending on a preallocated slice quicker than indexing?", "body": "<p>I wrote the following Go benchmarks (Go1.9.2, Linux amd64) to test indexing vs appending:</p>\n\n<pre><code>func BenchmarkIndex(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        existing := make([]int64, 1000, 1000)\n        init := make([]int64, 1000) // len 1000, cap 1000\n        for index, element := range existing {\n            init[index] = element\n        }\n    }\n}\n\nfunc BenchmarkAppend(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        existing := make([]int64, 1000, 1000)\n        init := make([]int64, 0, 1000) // len 0, capacity 1000\n        for _, element := range existing {\n            init = append(init, element)\n        }\n    }\n}\n</code></pre>\n\n<p>And got the following results:</p>\n\n<pre><code>goos: linux\ngoarch: amd64\nBenchmarkIndex-4         1000000          2183 ns/op\nBenchmarkAppend-4        1000000          1933 ns/op\nPASS\n</code></pre>\n\n<p>I'm a little confused on why <code>append</code> seems to perform better than in general than indexing into the slice. Does it have anything to do with omitting the <code>index</code> inside the range? If not, what is append doing under the hood to make it quicker than just indexing?</p>\n\n<p>For reference, <a href=\"https://github.com/golang/go/blob/master/src/cmd/compile/internal/gc/ssa.go#L2167\" rel=\"nofollow noreferrer\">here is append's source</a>. Thanks! </p>\n"}, {"tags": ["function", "variables", "go", "scope"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509895033, "post_id": 47122976, "comment_id": 81196105, "body": "Your loop logic does not seem to match what you described as the desired behaviour. Breaking on <code>e == nil</code> does not equal to &quot;latest result&quot;, it&#39;s more like the &quot;first result that didn&#39;t fail&quot;. And if that&#39;s what you&#39;re looking for you can just <code>return</code> from inside the loop, which is a lot nicer than using a <code>break</code>; although what&#39;s nicer, or what&#39;s uglier is <b>subjective</b>."}, {"owner": {"reputation": 562, "user_id": 1066063, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/31VvD.jpg?s=128&g=1", "display_name": "nciao", "link": "https://stackoverflow.com/users/1066063/nciao"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509909914, "post_id": 47122976, "comment_id": 81201336, "body": "Edited for clarity (I actually meant &quot;first result that doesn&#39;t fail&quot;)."}, {"owner": {"reputation": 562, "user_id": 1066063, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/31VvD.jpg?s=128&g=1", "display_name": "nciao", "link": "https://stackoverflow.com/users/1066063/nciao"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509910033, "post_id": 47122976, "comment_id": 81201383, "body": "Not sure why this is getting downvoted - if it&#39;s a dupe, please call that out."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509910458, "post_id": 47122976, "comment_id": 81201529, "body": "While I did not downvote myself, my guess for why someone might downvote your post would be that; your first example code <i>actually works the way you want it to</i>, and the second part of your question could lead to subjective discussion on what&#39;s readable or uglier which SO is not the appropriate place for. <a href=\"https://play.golang.org/p/V5c-l3PXHE\" rel=\"nofollow noreferrer\">play.golang.org/p/V5c-l3PXHE</a>"}], "answers": [{"tags": [], "owner": {"reputation": 850, "user_id": 3894119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fbc11920a94562910843e3c6c39ddf31?s=128&d=identicon&r=PG&f=1", "display_name": "Andy Aldo", "link": "https://stackoverflow.com/users/3894119/andy-aldo"}, "is_accepted": true, "score": 6, "last_activity_date": 1528857067, "last_edit_date": 1528857067, "creation_date": 1509895036, "answer_id": 47123163, "question_id": 47122976, "link": "https://stackoverflow.com/questions/47122976/named-return-variable-not-getting-set-in-for-loop/47123163#47123163", "title": "Named return variable not getting set in for loop", "body": "<p>The code below seems to work (compiles). tested <a href=\"https://play.golang.org/p/eVMVDiQv0h\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n\n\n<pre><code>func (dbs *myClient) DoStuff() (response []byte, e error) {\n    for i:=0;i&lt;5;i+=1 {\n        response, e = dbs.doNetworkThing()\n        if e == nil {\n            break;\n        }\n    }\n    return\n}\n</code></pre>\n\n<p>What I did:</p>\n\n<ol>\n<li>I removed the <code>response</code> and <code>e</code> declaration as it is already declared the moment you named your return values.</li>\n<li>changed <code>:=</code> to <code>=</code> because (again) the variable is already declared</li>\n<li>changed <code>return response, e</code> to <code>return</code> since the return values are named</li>\n</ol>\n\n<p>Hope it helps! :)</p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1509908467, "creation_date": 1509908467, "answer_id": 47125412, "question_id": 47122976, "link": "https://stackoverflow.com/questions/47122976/named-return-variable-not-getting-set-in-for-loop/47125412#47125412", "title": "Named return variable not getting set in for loop", "body": "<p>In this particular example you may exit from the cycle: thus solving 2 tacks to break the loop and return values. </p>\n\n<pre><code>func (dbs *myClient) DoStuff() (response []byte, e error) {\n    for i:=0;i&lt;5;i+=1 {\n        response, e = dbs.doNetworkThing()\n        if e == nil {\n            return response, e\n        }\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 562, "user_id": 1066063, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/31VvD.jpg?s=128&g=1", "display_name": "nciao", "link": "https://stackoverflow.com/users/1066063/nciao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 47123163, "answer_count": 2, "score": 1, "last_activity_date": 1528857067, "creation_date": 1509893854, "last_edit_date": 1509910007, "question_id": 47122976, "link": "https://stackoverflow.com/questions/47122976/named-return-variable-not-getting-set-in-for-loop", "title": "Named return variable not getting set in for loop", "body": "<p>I have a GoLang function that tries to set some named return variables inside a <strong>FOR</strong> loop.  It looks something like this:</p>\n\n<pre><code>func (dbs *myClient) DoStuff() (response []byte, e error) {\n    for i:=0;i&lt;5;i+=1 {\n        response, e = dbs.doNetworkThing()\n        if e == nil {\n            break;\n        }\n    }\n    return response, e\n}\n</code></pre>\n\n<p>Basically what I'd like to do is set the return variables <code>response</code> and <code>e</code> to first result from doNetworkThing() that does not fail.</p>\n\n<p>The problem is that <code>response</code> and <code>e</code> get reset once I exit from the for loop.  What's the correct idiomatic way of doing something like this in GoLang?</p>\n\n<p>I really want to use named return variables since they make things easier to read (I would consider something like this to be an ugly solution).</p>\n\n<pre><code>// Seems to be an ugly solution - would prefer using named return vars\nfunc (dbs *myClient) DoStuff() ([]byte, error) {\n    var response []byte\n    var e error\n    for i:=0;i&lt;5;i+=1 {\n        response, e := dbs.doNetworkThing()\n        if e == nil {\n            break;\n        }\n    }\n    return response, e\n}\n</code></pre>\n"}, {"tags": ["pointers", "go"], "answers": [{"tags": [], "owner": {"reputation": 850, "user_id": 3894119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fbc11920a94562910843e3c6c39ddf31?s=128&d=identicon&r=PG&f=1", "display_name": "Andy Aldo", "link": "https://stackoverflow.com/users/3894119/andy-aldo"}, "is_accepted": false, "score": 1, "last_activity_date": 1509893871, "last_edit_date": 1592644375, "creation_date": 1509893871, "answer_id": 47122979, "question_id": 47122771, "link": "https://stackoverflow.com/questions/47122771/trouble-using-pointer-in-golang/47122979#47122979", "title": "trouble using pointer in Golang", "body": "<p>I am learning Go as well. I think the fact that you are using slice is what causing the unwanted behaviour <strong>(when I run the program the first function sorts the slice and the the second function uses that sorted slice)</strong>. As explained <a href=\"https://tour.golang.org/moretypes/8\" rel=\"nofollow noreferrer\">here</a>:</p>\n<blockquote>\n<p>A slice does not store any data, it just describes a section of an underlying array.</p>\n<p>Changing the elements of a slice modifies the corresponding elements of its underlying array.</p>\n<p>Other slices that share the same underlying array will see those changes.</p>\n</blockquote>\n<p>I don't think passing pointer will produce different results as slices point to the same array. What you can do is maybe receive an array instead of slice?</p>\n<p>Hope it helps! :)</p>\n"}, {"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 2, "last_activity_date": 1509896305, "creation_date": 1509896305, "answer_id": 47123388, "question_id": 47122771, "link": "https://stackoverflow.com/questions/47122771/trouble-using-pointer-in-golang/47123388#47123388", "title": "trouble using pointer in Golang", "body": "<p>Andy is correct</p>\n\n<p>As an alternative, you can copy the slice before sorting it, as in here (<a href=\"https://play.golang.org/p/HtfMZKAuji\" rel=\"nofollow noreferrer\">on Play</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"math/rand\"\n\n    \"time\"\n)\n\nfunc main() {\n    slice := generateSlice(4)\n    fmt.Println(BubleSort(copySlice(slice)))\n    fmt.Println(InsertionSort(copySlice(slice)))\n}\n\nfunc copySlice(src []int) []int {\n    dest := make([]int, len(src))\n    copy(dest, src)\n    return dest\n}\nfunc generateSlice(size int) []int {\n    slice := make([]int, size, size)\n    rand.Seed(time.Now().UnixNano())\n    for i := 0; i &lt; size; i++ {\n        slice[i] = rand.Intn(10)\n    }\n    return slice\n}\n\nfunc BubleSort(slice []int) []int {\n    fmt.Println(\"unsorted Buble\", slice)\n    for i := 1; i &lt;= len(slice); {\n        for j := 0; j &lt; len(slice)-i; {\n            if slice[j] &gt; slice[j+1] {\n                slice[j], slice[j+1] = slice[j+1], slice[j]\n            }\n            j++\n        }\n        i++\n    }\n    return slice\n}\n\nfunc InsertionSort(slice []int) []int {\n    fmt.Println(\"unsorted Insertion\", slice)\n    for i := 1; i &lt;= len(slice)-1; {\n        // Check j and j-1 and swap the smaller number to left in each itteartion to reach the first 2 elements of the slice\n        for j := i; j &gt;= 1; {\n            if slice[j] &lt; slice[j-1] {\n                slice[j], slice[j-1] = slice[j-1], slice[j]\n            }\n            j--\n        }\n        i++\n    }\n    return slice\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 8350355, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-A4z1scxNCG0/AAAAAAAAAAI/AAAAAAAAAYk/Na1axHyXRFA/photo.jpg?sz=128", "display_name": "Behrooz Ahadian", "link": "https://stackoverflow.com/users/8350355/behrooz-ahadian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 47123388, "answer_count": 2, "score": 0, "last_activity_date": 1509896305, "creation_date": 1509892637, "question_id": 47122771, "link": "https://stackoverflow.com/questions/47122771/trouble-using-pointer-in-golang", "title": "trouble using pointer in Golang", "body": "<p>I am new to golang, here I am using BubleSort and InsertionSort and generating a rando slice for the functions. Can I use pointers some how to hand both functions the unsorted slice? because when I run the program the first function sorts the slice and the the second function uses that sorted slice. I know there are different ways to give both functions the unsorted slice, but I want to see how can I use pointers to do this. Thank you.</p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n\n\"math/rand\"\n\n\"time\"\n)\n\nfunc main() {\nslice := generateSlice(4)\nfmt.Println(BubleSort(slice))\nfmt.Println(InsertionSort(slice))\n}\n\nfunc generateSlice(size int) []int {\nslice := make([]int, size, size)\nrand.Seed(time.Now().UnixNano())\nfor i := 0; i &lt; size; i++ {\n    slice[i] = rand.Intn(10)\n}\nreturn slice\n}\n\nfunc BubleSort(slice []int) []int {\nfmt.Println(\"unsorted Buble\", slice)\nfor i := 1; i &lt;= len(slice); {\n    for j := 0; j &lt; len(slice)-i; {\n        if slice[j] &gt; slice[j+1] {\n            slice[j], slice[j+1] = slice[j+1], slice[j]\n        }\n        j++\n    }\n    i++\n}\nreturn slice\n}\n\nfunc InsertionSort(slice []int) []int {\nfmt.Println(\"unsorted Insertion\", slice)\nfor i := 1; i &lt;= len(slice)-1; {\n    // Check j and j-1 and swap the smaller number to left in each \nitteartion to reach the first 2 elements of the slice\n    for j := i; j &gt;= 1; {\n        if slice[j] &lt; slice[j-1] {\n            slice[j], slice[j-1] = slice[j-1], slice[j]\n        }\n        j--\n    }\n    i++\n}\nreturn slice\n}\n</code></pre>\n"}, {"tags": ["go", "maps"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1509889934, "last_edit_date": 1509889934, "creation_date": 1509888805, "answer_id": 47122162, "question_id": 47121635, "link": "https://stackoverflow.com/questions/47121635/traverse-a-map-in-decreasing-order-of-values/47122162#47122162", "title": "Traverse a Map in decreasing order of values", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\ntype frequncy struct {\n    c string\n    f int\n}\n\nfunc frequencies(s string) []frequncy {\n    m := make(map[string]int)\n    for _, r := range s {\n        m[string(r)]++\n    }\n    a := make([]frequncy, 0, len(m))\n    for c, f := range m {\n        a = append(a, frequncy{c: c, f: f})\n    }\n    sort.Slice(a, func(i, j int) bool { return a[i].f &gt; a[j].f })\n    return a\n}\n\nfunc main() {\n    s := \"aaaaabcbcbcbzxyyxzzsoaz\"\n    fmt.Println(s)\n    f := frequencies(s)\n    fmt.Println(f)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/d9i3yL1x4K\" rel=\"nofollow noreferrer\">https://play.golang.org/p/d9i3yL1x4K</a></p>\n\n<p>Output:</p>\n\n<pre><code>aaaaabcbcbcbzxyyxzzsoaz\n[{a 6} {b 4} {z 4} {c 3} {x 2} {y 2} {s 1} {o 1}]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1509888952, "creation_date": 1509888952, "answer_id": 47122178, "question_id": 47121635, "link": "https://stackoverflow.com/questions/47121635/traverse-a-map-in-decreasing-order-of-values/47122178#47122178", "title": "Traverse a Map in decreasing order of values", "body": "<p>The two map approach you have in your example will break as soon as you have more than one key in <code>frequency</code> with the same value, say <code>\"a\":7</code> and <code>\"b\":7</code>, then you would lose data in <code>arranged</code> since keys have to be unique.</p>\n\n<p>To avoid this you could create a helper type that will hold the map's contents temporarily, just for sorting purposes. Something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\nvar m = map[string]int{\n    \"a\": 9,\n    \"b\": 7,\n    \"c\": 19,\n    \"d\": 11,\n}\n\ntype entry  struct {\n    val int\n    key string\n}\n\ntype entries []entry\n\nfunc (s entries) Len() int { return len(s) }\nfunc (s entries) Less(i, j int) bool { return s[i].val &lt; s[j].val }\nfunc (s entries) Swap(i, j int) { s[i], s[j] = s[j], s[i] }\n\nfunc main() {\n    var es entries\n    for k, v := range m {\n        es = append(es, entry{val: v, key: k})\n    }\n\n    sort.Sort(sort.Reverse(es))\n\n    for _, e := range es {\n        fmt.Printf(\"%q : %d\\n\", e.key, e.val)   \n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/TPb0zNCtXO\" rel=\"nofollow noreferrer\">https://play.golang.org/p/TPb0zNCtXO</a></p>\n"}], "owner": {"reputation": 2221, "user_id": 7359810, "user_type": "registered", "accept_rate": 88, "profile_image": "https://lh3.googleusercontent.com/-8MngnLBsx3E/AAAAAAAAAAI/AAAAAAAAetc/OsGMMV3Set4/photo.jpg?sz=128", "display_name": "Neha", "link": "https://stackoverflow.com/users/7359810/neha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1914, "favorite_count": 2, "accepted_answer_id": 47122178, "answer_count": 2, "score": 3, "last_activity_date": 1572887095, "creation_date": 1509885376, "last_edit_date": 1572887095, "question_id": 47121635, "link": "https://stackoverflow.com/questions/47121635/traverse-a-map-in-decreasing-order-of-values", "title": "Traverse a Map in decreasing order of values", "body": "<p>I'm trying to traverse a map in decreasing order of the values stored against keys. I've tried:</p>\n\n<pre><code>func frequencySort(s string) string {\n  var frequency map[string]int\n  chararray := strings.Split(s , \"\")\n  var a []int\n  var arranged map[int]string\n  for k , v := range frequency {\n      arranged[v] = k\n  }\n  for k := range arranged {\n      a = append(a , k)\n  }\n  sort.Sort(sort.Reverse(sort.IntSlice{a}))\n}\n</code></pre>\n\n<p>Let's say the Map structure is :</p>\n\n<pre><code>    \"a\" : 9\n    \"b\" : 7\n    \"c\" : 19\n    \"d\" : 11\n</code></pre>\n\n<p>and I'm trying to traverse it such that the output is :</p>\n\n<pre><code>\"c\" : 19\n\"d\" : 11\n\"a\" : 9\n\"b\" : 7\n</code></pre>\n"}, {"tags": ["go", "io"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509885224, "post_id": 47121464, "comment_id": 81192784, "body": "Not sure if this is faster but did you try <code>io.Copy</code> with <code>os.Stdout</code> as its first arguemnt and your <code>buf</code> value converted into <code>[]byte</code> and then using that with <code>bytes.NewReder</code> as the second argument to <code>io.Copy</code>? E.g.; <code>io.Copy(os.Stdout, bytes.NewReader([]byte(buf)))</code> but maybe do the conversion outside of the loop?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1509885505, "post_id": 47121464, "comment_id": 81192846, "body": "Just call <code>os.Stdout.Write()</code> with a big prepared slice, the least overhead."}, {"owner": {"reputation": 61508, "user_id": 78259, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/844c572938eaad1e44eb084fb39416f9?s=128&d=identicon&r=PG", "display_name": "Chas. Owens", "link": "https://stackoverflow.com/users/78259/chas-owens"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1509889988, "post_id": 47121464, "comment_id": 81194279, "body": "@icza using os.Stdout.Write(buf) I am still limited to around 1.5 gig per second (but I was able to reduce the buffer size to 16K instead of 64K)"}, {"owner": {"reputation": 61508, "user_id": 78259, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/844c572938eaad1e44eb084fb39416f9?s=128&d=identicon&r=PG", "display_name": "Chas. Owens", "link": "https://stackoverflow.com/users/78259/chas-owens"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509890284, "post_id": 47121464, "comment_id": 81194396, "body": "@mkopriva I am seeing similar performance for that as the os.Stdout.Write() solution, which is the same as mine (but mine has a larger buffer)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1509890661, "post_id": 47121464, "comment_id": 81194525, "body": "The &quot;3gig per second transfer rates&quot; implementations, did you test those implementations on your machine as well or you&#39;ve only read about them in the articles? I&#39;m not doubting what those articles say, I just wonder if your machine is as performant as those used by the authors of those articles."}, {"owner": {"reputation": 61508, "user_id": 78259, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/844c572938eaad1e44eb084fb39416f9?s=128&d=identicon&r=PG", "display_name": "Chas. Owens", "link": "https://stackoverflow.com/users/78259/chas-owens"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509891681, "post_id": 47121464, "comment_id": 81194850, "body": "@mkopriva I am starting to wonder the same thing. Or if they were doing things I am not."}, {"owner": {"reputation": 61508, "user_id": 78259, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/844c572938eaad1e44eb084fb39416f9?s=128&d=identicon&r=PG", "display_name": "Chas. Owens", "link": "https://stackoverflow.com/users/78259/chas-owens"}, "edited": false, "score": 1, "creation_date": 1509891796, "post_id": 47121464, "comment_id": 81194890, "body": "So far the best performance I have gotten is using syscall.Write(1, buf) with a 512K buffer (anything bigger and it slows down again). And that was only marginally better than the os.Stdout.Write(buf) with a 16K buffer."}, {"owner": {"reputation": 61508, "user_id": 78259, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/844c572938eaad1e44eb084fb39416f9?s=128&d=identicon&r=PG", "display_name": "Chas. Owens", "link": "https://stackoverflow.com/users/78259/chas-owens"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509893052, "post_id": 47121464, "comment_id": 81195332, "body": "@mkopriva Compiling some C code the the author claimed gets 10 GB per second on his/her machine yields a slower result than even my Go code. The Go code is faster than the stock Ubuntu yes (which the author was also claiming was 10 GB per second).  So I guess it is fast enough."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1509894086, "post_id": 47121464, "comment_id": 81195722, "body": "@Chas.Owens interesting that the C version is slower, probably something to do with how its implemented... anyway I&#39;m glad you&#39;ve got it sorted out."}, {"owner": {"reputation": 5380, "user_id": 146620, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4ba0c9119010302832e1d129b38228b?s=128&d=identicon&r=PG", "display_name": "Graham King", "link": "https://stackoverflow.com/users/146620/graham-king"}, "edited": false, "score": 0, "creation_date": 1510685832, "post_id": 47121464, "comment_id": 81537380, "body": "I&#39;m guessing you are doing something like <code>yes | pv --rate</code>. I think Linux pipes have a 64k buffer by default, which is probably why that&#39;s the fastest. Maybe you could adjust that? <a href=\"https://unix.stackexchange.com/questions/11946/how-big-is-the-pipe-buffer#11954\" title=\"how big is the pipe buffer%2311954\">unix.stackexchange.com/questions/11946/&hellip;</a>"}, {"owner": {"reputation": 3621, "user_id": 6188402, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/a8bdb7cbe81f5544f0ddc6ded12a23f1?s=128&d=identicon&r=PG&f=1", "display_name": "Washington Guedes", "link": "https://stackoverflow.com/users/6188402/washington-guedes"}, "edited": false, "score": 0, "creation_date": 1602967997, "post_id": 47121464, "comment_id": 113889107, "body": "Thanks @Chas.Owens for <a href=\"https://stackoverflow.com/questions/47121464/is-there-a-faster-way-to-write-to-stdout#comment81194890_47121464\">this comment</a> ... I got best performance with 1M buffer size using <code>os.Stdout.Write(buf)</code>"}], "owner": {"reputation": 61508, "user_id": 78259, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/844c572938eaad1e44eb084fb39416f9?s=128&d=identicon&r=PG", "display_name": "Chas. Owens", "link": "https://stackoverflow.com/users/78259/chas-owens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 974, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1509884272, "creation_date": 1509884272, "question_id": 47121464, "link": "https://stackoverflow.com/questions/47121464/is-there-a-faster-way-to-write-to-stdout", "title": "Is there a faster way to write to stdout?", "body": "<p>I am implementing Unix commands in Go as a way to learn more about Go.  I have read some articles where people have implemented yes in various and gotten up to 3 gig per second transfer rates.  Through trial an error I have gotten my Go implementation to around 1.5 gig per second:</p>\n\n<pre><code>package main\n\nimport (\n        f \"fmt\"\n        \"os\"\n        s \"strings\"\n)\n\nconst bufsize = 1024 * 64\n\nfunc main() {\n        atom := \"y\\n\"\n\n        if len(os.Args) &gt; 1 {\n                atom = s.Join(os.Args[1:], \" \") + \"\\n\"\n        }\n\n        buf := s.Repeat(atom, bufsize / len(atom))\n\n        for {\n                f.Print(buf)\n        }\n}\n</code></pre>\n\n<p>Is there a lower level/faster function to print to stdout?</p>\n"}, {"tags": ["function", "go", "2d", "slice"], "comments": [{"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 5, "creation_date": 1509882945, "post_id": 47120703, "comment_id": 81192125, "body": "Go has no generics."}, {"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1509883006, "post_id": 47120703, "comment_id": 81192141, "body": "You can google <code>golang generics</code> and find an appropriate solution"}, {"owner": {"reputation": 436, "user_id": 8345637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/teknC.png?s=128&g=1", "display_name": "Jonathan", "link": "https://stackoverflow.com/users/8345637/jonathan"}, "edited": false, "score": 0, "creation_date": 1509883201, "post_id": 47120703, "comment_id": 81192211, "body": "How many different kinds of 2d slices are you needing? If you only need a specific number, it may be better to just have that number of specified functions as generators for those types of 2d slices."}], "answers": [{"comments": [{"owner": {"reputation": 2063, "user_id": 1754322, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0a8d179064829f570635b9fd4712a812?s=128&d=identicon&r=PG", "display_name": "tuket", "link": "https://stackoverflow.com/users/1754322/tuket"}, "edited": false, "score": 0, "creation_date": 1509904614, "post_id": 47122041, "comment_id": 81199647, "body": "What a pity :-("}], "tags": [], "owner": {"reputation": 320, "user_id": 6402043, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh3.googleusercontent.com/-LX6LSiYkqPE/AAAAAAAAAAI/AAAAAAAAARg/_cO2uaBhukM/photo.jpg?sz=128", "display_name": "Blallo", "link": "https://stackoverflow.com/users/6402043/blallo"}, "is_accepted": false, "score": 0, "last_activity_date": 1509888002, "creation_date": 1509888002, "answer_id": 47122041, "question_id": 47120703, "link": "https://stackoverflow.com/questions/47120703/golang-return-2d-slice-for-any-type/47122041#47122041", "title": "GoLang: Return 2d slice for any type", "body": "<p>Just have two methods that give you an int or a string 2d slice. Golang has no generics.</p>\n"}, {"comments": [{"owner": {"reputation": 3789, "user_id": 5084982, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/1Y3cg.jpg?s=128&g=1", "display_name": "Le garcon", "link": "https://stackoverflow.com/users/5084982/le-garcon"}, "edited": false, "score": 0, "creation_date": 1571761760, "post_id": 47126933, "comment_id": 103345124, "body": "Why are you using <code>make</code> to create the <code>a</code> slice the length of  <code>c*r</code>. Won&#39;t it take less code to just make a slice the length of <code>c</code> inside the loop? Or is it bad to call <code>make</code> multiple times?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 3789, "user_id": 5084982, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/1Y3cg.jpg?s=128&g=1", "display_name": "Le garcon", "link": "https://stackoverflow.com/users/5084982/le-garcon"}, "edited": false, "score": 1, "creation_date": 1571896691, "post_id": 47126933, "comment_id": 103392816, "body": "@Legarcon : The amount of code is not relevant. Performance (CPU time, bytes allocated, and number of allocations) is relevant. Calling <code>make</code> costs. Calling <code>make</code> multiple times costs more. Here&#39;s a benchmark of performance (PeterSO) versus less code (LeGarcon): <code>garcon_test.go</code>: <a href=\"https://play.golang.org/p/wY53-UNxKdT\" rel=\"nofollow noreferrer\">play.golang.org/p/wY53-UNxKdT</a>. There is also better <a href=\"https://en.wikipedia.org/wiki/Locality_of_reference\" rel=\"nofollow noreferrer\">Locality of reference</a>."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1511110391, "last_edit_date": 1511110391, "creation_date": 1509918070, "answer_id": 47126933, "question_id": 47120703, "link": "https://stackoverflow.com/questions/47120703/golang-return-2d-slice-for-any-type/47126933#47126933", "title": "GoLang: Return 2d slice for any type", "body": "<p>Go doesn't have generics. For matrices, a similar problem, I have a <code>NewMatrix</code> function in a <code>matrix.go</code> file in my <code>snippet</code> folder. By design, I can simply copy it and do a global change of <code>[]int</code> to another type, for example, <code>[]float64</code>.</p>\n\n<p>You could improve your function by giving <code>w</code> slices a valid capacity.</p>\n\n<p>For example, </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc NewMatrix(r, c int) [][]int {\n    a := make([]int, c*r)\n    m := make([][]int, r)\n    lo, hi := 0, c\n    for i := range m {\n        m[i] = a[lo:hi:hi]\n        lo, hi = hi, hi+c\n    }\n    return m\n}\n\nfunc create2dSlice(w, h int) [][]int {\n    a := make([]int, w*h)\n    s := make([][]int, h)\n    lo, hi := 0, w\n    for i := range s {\n        s[i] = a[lo:hi:hi]\n        lo, hi = hi, hi+w\n    }\n    return s\n}\n\nfunc main() {\n    r, c := 2, 3\n    m := NewMatrix(r, c)\n    fmt.Println(m)\n    w, h := c, r\n    a := create2dSlice(w, h)\n    fmt.Println(a)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[[0 0 0] [0 0 0]]\n[[0 0 0] [0 0 0]]\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a> </p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">Slice expressions</a></p>\n  \n  <p>Slice expressions construct a substring or slice from a string, array,\n  pointer to array, or slice. There are two variants: a simple form that\n  specifies a low and high bound, and a full form that also specifies a\n  bound on the capacity. </p>\n  \n  <p>Full slice expressions</p>\n  \n  <p>For an array, pointer to array, or slice a (but not a string), the\n  primary expression</p>\n\n<pre><code>a[low : high : max]\n</code></pre>\n  \n  <p>constructs a slice of the same type, and with the same length and\n  elements as the simple slice expression <code>a[low : high]</code>. Additionally,\n  it controls the resulting slice's capacity by setting it to <code>max - low</code>.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 799, "user_id": 2980967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ecQ8D.jpg?s=128&g=1", "display_name": "dustinevan", "link": "https://stackoverflow.com/users/2980967/dustinevan"}, "is_accepted": false, "score": 0, "last_activity_date": 1509942008, "creation_date": 1509942008, "answer_id": 47129687, "question_id": 47120703, "link": "https://stackoverflow.com/questions/47120703/golang-return-2d-slice-for-any-type/47129687#47129687", "title": "GoLang: Return 2d slice for any type", "body": "<p>To go in to this a little more. The reason Go wants you to type this out is because it makes code more clear. When balancing code clarity and code repetition, Go sides with clarity. Many languages take the 'no repeated code' side of this balance, but reduced clarity is a tradeoff. You do have a few options though if it's super important.\n 1. Make an interface for all the possible return types. You could return [][]Number for example. \n 2. Make a struct that wraps the 2d array that has transfer methods, i.e. NumberArray.AsInts()\n 3. Return the empty interface and use reflection. </p>\n"}], "owner": {"reputation": 2063, "user_id": 1754322, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0a8d179064829f570635b9fd4712a812?s=128&d=identicon&r=PG", "display_name": "tuket", "link": "https://stackoverflow.com/users/1754322/tuket"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1619, "favorite_count": 1, "accepted_answer_id": 47126933, "answer_count": 3, "score": 2, "last_activity_date": 1511110391, "creation_date": 1509879116, "question_id": 47120703, "link": "https://stackoverflow.com/questions/47120703/golang-return-2d-slice-for-any-type", "title": "GoLang: Return 2d slice for any type", "body": "<p>I know how to create a 2D slice like this.</p>\n\n<pre><code>var data []int\ndata = make([]int, w*h)\nv := make([][]int, h)\nfor i := 0; i &lt; h; i++ {\n    v[i] = data[w*i : w*(i+1)]\n}\n</code></pre>\n\n<p>Since this is very verbose and I'm going to create many of these, I decided to refactor it into a function.</p>\n\n<pre><code>func create2dSlice(w, h int) [][]int {\n    var data []int\n    data = make([]int, w*h)\n    v := make([][]int, h)\n    for i := 0; i &lt; h; i++ {\n        v[i] = data[w*i : w*(i+1)]\n    }\n    return v\n}\n\nfunc main() {\n    a := create2dSlice(3, 2)\n}\n</code></pre>\n\n<p>This works only for integers. It there any way in golang to do this for other types reusing the same code?</p>\n\n<p>I come from C++ and I would expect to be able to do something like this.</p>\n\n<pre><code>create2dSlice&lt;int&gt;(w, h)\n</code></pre>\n"}, {"tags": ["postgresql", "docker", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "is_accepted": true, "score": 3, "last_activity_date": 1509880099, "last_edit_date": 1509880099, "creation_date": 1509879281, "answer_id": 47120730, "question_id": 47120505, "link": "https://stackoverflow.com/questions/47120505/gorm-docker-error-while-connection/47120730#47120730", "title": "Gorm + Docker error while connection", "body": "<p>You are unable to connect to your <code>psql</code> container because you haven't linked it. Take a look at <a href=\"https://docs.docker.com/compose/compose-file/#links\" rel=\"nofollow noreferrer\">Docker-Compose documentation on links</a>.</p>\n\n<p>Also, I'm assuming you aren't scheduling your container startup order. <code>Psql</code> container must start before <code>golang</code>'s one. Take a look at <a href=\"https://docs.docker.com/compose/startup-order/\" rel=\"nofollow noreferrer\">Docker Compose documentation on startup order</a>. You can use <a href=\"https://github.com/vishnubob/wait-for-it\" rel=\"nofollow noreferrer\">wait-for-it</a> to achieve such objective ast stated in the docs. Just <code>wget</code> it and save it in your project.</p>\n\n<p>I don't know the contents of your <code>Dockerfile</code> but I'll assume it's something like:</p>\n\n<pre><code>FROM golang:1.9\n\nRUN mkdir -p /go/src/github.com/pavel/gorm-psql\nWORKDIR /go/src/github.com/pavel/gorm-psql\n\nADD . /go/src/github.com/pavel/gorm-psql\n\nRUN go get -v\n</code></pre>\n\n<p>So, your <code>docker-compose.yml</code> should be edited to first run <code>wait-for-it.sh</code> and link <code>psql</code> container to your app with something like:</p>\n\n<pre><code>version: '3.3'\nservices:\n  db:\n    image: postgres\n    environment:\n      POSTGRES_DB: dnz-dev\n      POSTGRES_USER: dnz-dev\n      POSTGRES_PASSWORD: dnz-dev\n    ports:\n      - 6000:5432\n  api:\n    build: .\n    command: [\"./wait-for-it.sh\", \"db:6000\", \"--\", \"go\", \"run\", \"main.go\"]\n    volumes:\n      - .:/go/src/github.com/pavel/gorm-psql\n    ports:\n      - \"5000:3080\"\n    depends_on:\n      - db\n    links:\n      - db\n</code></pre>\n\n<p>If your <code>main</code> has another name just change it. Edit your <code>volumes</code> to point whatever path you need. I've set a standard one with <code>/go/src/github.com/pavel/gorm-psql</code>. I'm assuming you created a db named <code>dnz-dev</code>, if the name is different just edit it.</p>\n\n<pre><code>$ go env:\n\n. . .\nGOPATH=\"/home/pavel/go\"\nGOROOT=\"/usr/lib/go\"\n. . .\n</code></pre>\n\n<p>Just run <code>docker-compose up</code> and it should work just fine. I'm relying on <a href=\"https://hub.docker.com/_/postgres/\" rel=\"nofollow noreferrer\">postgresql</a> and <a href=\"https://hub.docker.com/_/golang/\" rel=\"nofollow noreferrer\">golang</a> latest images.</p>\n"}], "owner": {"reputation": 1670, "user_id": 6579556, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ddcf07d32c7d026a6e2fb697b8ae75f3?s=128&d=identicon&r=PG&f=1", "display_name": "Pavel", "link": "https://stackoverflow.com/users/6579556/pavel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1818, "favorite_count": 0, "accepted_answer_id": 47120730, "answer_count": 1, "score": 1, "last_activity_date": 1509880099, "creation_date": 1509877747, "question_id": 47120505, "link": "https://stackoverflow.com/questions/47120505/gorm-docker-error-while-connection", "title": "Gorm + Docker error while connection", "body": "<p>I trying connection to my postgresql database with Docker:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/postgres\"\n)\n\ntype Product struct {\n    gorm.Model\n    Code  string\n    Price uint\n}\n\nvar db *gorm.DB\n\nfunc init() {\n    connection := fmt.Sprintf(\"host=db sslmode=disable user=dnz-dev password=dnz-dev\")\n    db, err := gorm.Open(\"postgres\", connection)\n    if err != nil {\n        log.Fatalln(err)\n    }\n    defer db.Close()\n}\n\nfunc main() {\n    // Migrate the schema\n    db.AutoMigrate(&amp;Product{})\n}\n</code></pre>\n\n<p>and <code>docker-compose</code></p>\n\n<p>version: \"3.3\"</p>\n\n<pre><code>services:\n  db:\n    build: ./dnz-db\n    container_name: dnz-database\n    ports:\n      - \"6000:5432\"\n    volumes:\n      - ./dnz-db/data:/var/lib/postgresql/data\n    environment:\n      - POSTGRES_USER=dnz-dev\n      - POSTGRES_PASSWORD=dnz-dev\n\n  api:\n    build: ./dnz-api\n    container_name: dnz-api\n    volumes:\n      - ./dnz-api:/go/src/app\n    ports:\n      - \"5000:3000\"\n    depends_on:\n      - db\n</code></pre>\n\n<p>I run <code>docker-compose up --build</code> and I get this error: </p>\n\n<blockquote>\n  <p>Attaching to dnz-database, dnz-api dnz-api | 2017/11/05 10:23:46 dial\n  tcp 172.21.0.2:5432: getsockopt: connection refused dnz-api | exit\n  status 1 dnz-api exited with code 1</p>\n</blockquote>\n\n<p>What I doing wrong?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 1, "last_activity_date": 1509856597, "last_edit_date": 1509856597, "creation_date": 1509856132, "answer_id": 47118172, "question_id": 47117990, "link": "https://stackoverflow.com/questions/47117990/how-do-i-set-up-a-global-config-for-my-app-package-that-contains-things-like-db/47118172#47118172", "title": "How do I set up a global config for my app package that contains things like DB conn?", "body": "<p>You can make an <code>App</code> variable to keep there config and some other useful settings  for it eg Http time-out </p>\n\n<pre><code>var (\n      App struct {\n           DB         *sql.DB\n           Timeout time.Duration\n           ...\n      }\n)\n</code></pre>\n\n<p>Then make methods on this structure. This way config will be incapsulated in application instance. </p>\n"}, {"tags": [], "owner": {"reputation": 4976, "user_id": 99189, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e85341a6b300fd04dc33b1baa28b7fd8?s=128&d=identicon&r=PG", "display_name": "Jeremy Huiskamp", "link": "https://stackoverflow.com/users/99189/jeremy-huiskamp"}, "is_accepted": false, "score": 1, "last_activity_date": 1509872312, "creation_date": 1509872312, "answer_id": 47119829, "question_id": 47117990, "link": "https://stackoverflow.com/questions/47117990/how-do-i-set-up-a-global-config-for-my-app-package-that-contains-things-like-db/47119829#47119829", "title": "How do I set up a global config for my app package that contains things like DB conn?", "body": "<p>If you want to avoid globals, make your handlers structs instead of pure funcs:</p>\n\n<pre><code>type UserIndex struct {\n    cfg Config\n}\n\nfunc (u UserIndex) ServeHTTP(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\n    fmt.Fprint(w, \"test!\\n\")\n}\n</code></pre>\n\n<p>When setting up your routes, use <code>UserIndex{c}.ServeHTTP</code> instead of <code>UserIndex</code>.</p>\n\n<p>The core library <code>http</code> package differentiates between a <code>Handler</code> type and a <code>HandlerFunc</code> for this reason.  You appear to be using <code>github.com/julienschmidt/httprouter</code>, which doesn't make this distinction and doesn't provide an <code>interface</code> that matches its <code>httprouter.Handle</code> type, but you can still use a method on a struct to satisfy that type.</p>\n"}], "owner": {"reputation": 956, "user_id": 6402561, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/1aa8dd9d8c878efcce8226aab763c0d7?s=128&d=identicon&r=PG&f=1", "display_name": "a person", "link": "https://stackoverflow.com/users/6402561/a-person"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 47118172, "answer_count": 2, "score": 0, "last_activity_date": 1509872312, "creation_date": 1509853850, "last_edit_date": 1509854158, "question_id": 47117990, "link": "https://stackoverflow.com/questions/47117990/how-do-i-set-up-a-global-config-for-my-app-package-that-contains-things-like-db", "title": "How do I set up a global config for my app package that contains things like DB conn?", "body": "<p>I've structured my application in two packages so far - <code>main</code> and <code>app</code></p>\n\n<p>In my <code>main()</code> I start my server:</p>\n\n<pre><code>func main() {\n    router := app.CreateRouter(app.Routes())\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n}\n</code></pre>\n\n<p>In app, I have a <code>Config</code> struct which has a method <code>connectToDB</code>:</p>\n\n<pre><code>type Config struct {\n    DB *sql.DB\n}\n\nfunc (c *Config) connectToDB() {\n    connectionString := fmt.Sprintf(\"user=%s password=%s dbname=%s sslmode=disable\", os.Getenv(\"DB_USERNAME\"), os.Getenv(\"DB_PASSWORD\"), os.Getenv(\"DB_NAME\"))\n    var err error\n    c.DB, err = sql.Open(\"postgres\", connectionString)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc init() {\n    c := Config{}\n    c.connectToDB()\n}\n</code></pre>\n\n<p>However, I have various handlers and if I want to make use of <code>Config.DB</code>, how can I do that?</p>\n\n<p>For example, in app.UserIndex, how can I get to <code>Config.DB</code>?</p>\n\n<pre><code>func UserIndex(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\n    fmt.Fprint(w, \"test!\\n\")\n}\n</code></pre>\n\n<p>Now, one thing I can do is set a global variable, such as </p>\n\n<p><code>var c Config</code> </p>\n\n<p>Then, I can access c.DB anywhere in package <code>app</code>.  However, this feels bad..</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 704, "user_id": 4792552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a528513962a9c962ff32df92a1a350b?s=128&d=identicon&r=PG", "display_name": "Berkant Ipek", "link": "https://stackoverflow.com/users/4792552/berkant-ipek"}, "edited": false, "score": 1, "creation_date": 1553889921, "post_id": 47117898, "comment_id": 97568678, "body": "Is <code>Timeout</code> field counted as a counterpart for curl&#39;s <code>--connect-timeout</code>? Or is that like <code>--max-time</code>?"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 18, "last_activity_date": 1509853948, "last_edit_date": 1509853948, "creation_date": 1509852679, "answer_id": 47117898, "question_id": 47117850, "link": "https://stackoverflow.com/questions/47117850/how-to-set-timeout-while-doing-a-net-dialtcp-in-golang/47117898#47117898", "title": "How to set timeout while doing a net.DialTCP in golang?", "body": "<p>Use <a href=\"https://godoc.org/net#Dialer\" rel=\"noreferrer\">net.Dialer</a> with either the <a href=\"https://godoc.org/net#Dialer.Timeout\" rel=\"noreferrer\">Timeout</a> or <a href=\"https://godoc.org/net#Dialer.Deadline\" rel=\"noreferrer\">Deadline</a> fields set. </p>\n\n<pre><code>d := net.Dialer{Timeout: timeout}\nconn, err := d.Dial(\"tcp\", addr)\nif err != nil {\n   // handle error\n}\n</code></pre>\n\n<p>A variation is to call <a href=\"https://godoc.org/net#Dialer.DialContext\" rel=\"noreferrer\">Dialer.DialContext</a> with a <a href=\"https://godoc.org/context#WithDeadline\" rel=\"noreferrer\">deadline</a> or <a href=\"https://godoc.org/context#WithTimeout\" rel=\"noreferrer\">timeout</a> applied to the context.</p>\n\n<p>Type assert to <code>*net.TCPConn</code> if you specifically need that type instead of a <code>net.Conn</code>:</p>\n\n<pre><code>tcpConn, ok := conn.(*net.TCPConn)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1419, "user_id": 3788493, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/eLdB2.jpg?s=128&g=1", "display_name": "jeanluc", "link": "https://stackoverflow.com/users/3788493/jeanluc"}, "is_accepted": false, "score": 6, "last_activity_date": 1522538246, "creation_date": 1522538246, "answer_id": 49593356, "question_id": 47117850, "link": "https://stackoverflow.com/questions/47117850/how-to-set-timeout-while-doing-a-net-dialtcp-in-golang/49593356#49593356", "title": "How to set timeout while doing a net.DialTCP in golang?", "body": "<p>One can use <code>net.DialTimeout</code>:</p>\n\n<pre><code>func DialTimeout(network, address string, timeout time.Duration) (Conn, error)\n    DialTimeout acts like Dial but takes a timeout.\n\n    The timeout includes name resolution, if required. When using TCP, and the\n    host in the address parameter resolves to multiple IP addresses, the timeout\n    is spread over each consecutive dial, such that each is given an appropriate\n    fraction of the time to connect.\n\n    See func Dial for a description of the network and address parameters.\n</code></pre>\n"}], "owner": {"reputation": 14735, "user_id": 167814, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/53ee4a3bcfdb4e8f4c37991900ab48ef?s=128&d=identicon&r=PG", "display_name": "Abhijeet Rastogi", "link": "https://stackoverflow.com/users/167814/abhijeet-rastogi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14295, "favorite_count": 1, "accepted_answer_id": 47117898, "answer_count": 2, "score": 7, "last_activity_date": 1522538246, "creation_date": 1509852126, "question_id": 47117850, "link": "https://stackoverflow.com/questions/47117850/how-to-set-timeout-while-doing-a-net-dialtcp-in-golang", "title": "How to set timeout while doing a net.DialTCP in golang?", "body": "<p>As <code>net.DialTCP</code> seems like the only way to get <code>net.TCPConn</code>, I'm not sure how to set timeouts while doing the <code>DialTCP</code>. <a href=\"https://golang.org/pkg/net/#DialTCP\" rel=\"noreferrer\">https://golang.org/pkg/net/#DialTCP</a></p>\n\n<pre><code>func connectAddress(addr *net.TCPAddr, wg *sync.WaitGroup) error {\n    start := time.Now()\n    conn, err := net.DialTCP(\"tcp\", nil, addr)\n    if err != nil {\n        log.Printf(\"Dial failed for address: %s, err: %s\", addr.String(), err.Error())\n        return err\n    }\n    elasped := time.Since(start)\n    log.Printf(\"Connected to address: %s in %dms\", addr.String(), elasped.Nanoseconds()/1000000)\n    conn.Close()\n    wg.Done()\n    return nil\n}\n</code></pre>\n"}, {"tags": ["windows", "github", "go"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1509854522, "post_id": 47117571, "comment_id": 81186009, "body": "On Windows, replace <code>$GOPATH</code> (Linux) with <code>%GOPATH%</code> (Windows)."}, {"owner": {"reputation": 89, "user_id": 7408217, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b9d13777f846f90a6a147e7f8e64fb7b?s=128&d=identicon&r=PG&f=1", "display_name": "o0o0o0o0o", "link": "https://stackoverflow.com/users/7408217/o0o0o0o0o"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1509854740, "post_id": 47117571, "comment_id": 81186037, "body": "Yeah sorry I just realised this too, its kind of weird how a lot of documentation and stuff is for Linux cause its what actual servers run on and what not"}], "answers": [{"comments": [{"owner": {"reputation": 89, "user_id": 7408217, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b9d13777f846f90a6a147e7f8e64fb7b?s=128&d=identicon&r=PG&f=1", "display_name": "o0o0o0o0o", "link": "https://stackoverflow.com/users/7408217/o0o0o0o0o"}, "edited": false, "score": 0, "creation_date": 1509852205, "post_id": 47117754, "comment_id": 81185685, "body": "Alright ill go through your question now, thankyou. I upvoted but I dont have 15 points yet."}, {"owner": {"reputation": 89, "user_id": 7408217, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b9d13777f846f90a6a147e7f8e64fb7b?s=128&d=identicon&r=PG&f=1", "display_name": "o0o0o0o0o", "link": "https://stackoverflow.com/users/7408217/o0o0o0o0o"}, "edited": false, "score": 0, "creation_date": 1509854634, "post_id": 47117754, "comment_id": 81186023, "body": "Ok I did it and the install on windows thing was very helpful. With the package I had some problems still and I fixed them! I used go get golang.org/x/blog... with the three dots which apparently signifies get the whole repository (<a href=\"https://stackoverflow.com/questions/24095004/cant-load-package-package-no-buildable-go-source-files\" title=\"cant load package package no buildable go source files\">stackoverflow.com/questions/24095004/&hellip;</a>). Then I had problem where the two .css files werent being loaded because its localhost and the directory were wrong and the github repo has no css so I copied it from the actual site and made css files where localhost expects to find them. Thank you for helping me"}, {"owner": {"reputation": 89, "user_id": 7408217, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b9d13777f846f90a6a147e7f8e64fb7b?s=128&d=identicon&r=PG&f=1", "display_name": "o0o0o0o0o", "link": "https://stackoverflow.com/users/7408217/o0o0o0o0o"}, "edited": false, "score": 0, "creation_date": 1509855092, "post_id": 47117754, "comment_id": 81186103, "body": "Wow this is actually so cool, I have the whole golang.org website locally now including the playground, docs, and packages."}], "tags": [], "owner": {"reputation": 138, "user_id": 3233568, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1eae270fd5d6e6e8408736506ee24b45?s=128&d=identicon&r=PG&f=1", "display_name": "Josiah", "link": "https://stackoverflow.com/users/3233568/josiah"}, "is_accepted": true, "score": 2, "last_activity_date": 1509850885, "creation_date": 1509850885, "answer_id": 47117754, "question_id": 47117571, "link": "https://stackoverflow.com/questions/47117571/how-to-build-golang-blog-from-github/47117754#47117754", "title": "How to build Golang blog from github?", "body": "<p>I'll try to answer your questions. (Note that I am a Linux user, so there may be some discrepancies with the Windows commands below. You may want to follow these directions: <a href=\"http://www.wadewegner.com/2014/12/easy-go-programming-setup-for-windows/\" rel=\"nofollow noreferrer\">http://www.wadewegner.com/2014/12/easy-go-programming-setup-for-windows/</a> to setup the <code>GOROOT</code> environment variable.)</p>\n\n<ol>\n<li><p>For method 1, the <code>-u</code> flag tells <code>go</code> to <em>update</em> the source code. Since you haven't downloaded it before, it lets you know with the error you see. What you want to run is <code>go get golang.org/x/blog</code>.</p></li>\n<li><p>To build the package, you first want to change the directory (<code>cd</code>) to the package root, so <code>cd %GOPATH%\\src\\golang.org\\x\\blog</code> or <code>cd C:\\Users\\me\\go\\src\\golang.org\\x\\blog</code>. Next, you want to run <code>go build</code>. Then, you can run the output file, which should automatically be named <code>blog.exe</code>.</p></li>\n</ol>\n\n<p>Hopefully this helps! :)</p>\n"}], "owner": {"reputation": 89, "user_id": 7408217, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b9d13777f846f90a6a147e7f8e64fb7b?s=128&d=identicon&r=PG&f=1", "display_name": "o0o0o0o0o", "link": "https://stackoverflow.com/users/7408217/o0o0o0o0o"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 614, "favorite_count": 0, "accepted_answer_id": 47117754, "answer_count": 1, "score": 2, "last_activity_date": 1509850885, "creation_date": 1509848470, "last_edit_date": 1509849774, "question_id": 47117571, "link": "https://stackoverflow.com/questions/47117571/how-to-build-golang-blog-from-github", "title": "How to build Golang blog from github?", "body": "<p>Im not very good with Go and I am having a lot of problems with understanding how common website features are made, so I thought it would be good to see a real example. I tried building <a href=\"https://github.com/golang/blog\" rel=\"nofollow noreferrer\">https://github.com/golang/blog</a> but its not working.</p>\n\n<p>My gopath is apparently C:/Users/me/go as it should be.</p>\n\n<p>*Edit Except if I run  cd $GOPATH/src, it says C:\\src doesnt exist, it looks in C: not C:/Users</p>\n\n<p>Method 1. (running go get -u golang.org/x/blog)\nI open Powershell and run that in my Users/me/go/src directory and it says:</p>\n\n<pre><code>can't load package: package golang.org: no Go files in \nC:\\Users\\me\\go\\src\\golang.org\n</code></pre>\n\n<p>But it does download the source files. So its basically this step?\n'u can manually git clone the repository to $GOPATH/src/golang.org/x/blog.'</p>\n\n<p>Then I dont know where to run go build or what to run. I tried \n    go build -o blog.exe ./blog</p>\n\n<p>and it says\n    can't load package: package blog: cannot find package \"blog\" in any of:\n    C:\\Go\\src\\blog (from $GOROOT)\n    C:\\Users\\me\\go\\src\\blog (from $GOPATH)</p>\n\n<p>I tried running the same command in different directories of the project and doesnt work.</p>\n"}, {"tags": ["go", "arguments", "command-line-interface"], "answers": [{"tags": [], "owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "is_accepted": false, "score": 1, "last_activity_date": 1509879374, "creation_date": 1509879374, "answer_id": 47120745, "question_id": 47117360, "link": "https://stackoverflow.com/questions/47117360/requiring-a-positional-argument-with-go-flags/47120745#47120745", "title": "Requiring a positional argument with go-flags", "body": "<p>Would using os.Args help? Eg:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nconst Usage = `Usage:\n%s one two\n`\n\nfunc main() {\n\n    if len(os.Args) != 3 {\n        fmt.Printf(Usage, os.Args[0])\n        os.Exit(-1)\n    }\n\n    //run program\n}\n</code></pre>\n\n<p>os.Args hold the command-line arguments, starting with the program name.</p>\n\n<p><a href=\"https://play.golang.org/p/Le9EMxmw9k\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Le9EMxmw9k</a></p>\n"}], "owner": {"reputation": 26589, "user_id": 1032785, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/30816b3d787c2bd9d6f036318304f225?s=128&d=identicon&r=PG", "display_name": "jordanm", "link": "https://stackoverflow.com/users/1032785/jordanm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 820, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1509879374, "creation_date": 1509845786, "question_id": 47117360, "link": "https://stackoverflow.com/questions/47117360/requiring-a-positional-argument-with-go-flags", "title": "Requiring a positional argument with go-flags", "body": "<p>I am writing a CLI tool in go and have chosen github.com/jessevdk/go-flags for the CLI arg parsing. I am trying to figure out the best way to make a positional arg mandatory. Currently, I have the following:</p>\n\n<pre><code>func main() {\n    args, err := flags.Parse(&amp;opts)\n    if err != nil {\n        panic(err)\n    }\n\n    if len(args) &lt; 1 {\n        panic(\"An s3 bucket is required\")\n    }\n}\n</code></pre>\n\n<p>This works, but it doesn't result in help output being displayed, as would be the case with a flag being marked <code>\"required:true\"</code>. Is there a way to replicate that behavior by manually calling a \"print help\" function or setting a required number of positional arguments?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1509843803, "creation_date": 1509843803, "answer_id": 47117194, "question_id": 47117105, "link": "https://stackoverflow.com/questions/47117105/why-is-there-a-leading-space-when-i-expect-only-a-new-line-and-dont-seem-to-spe/47117194#47117194", "title": "Why is there a leading space when I expect only a new line and don&#39;t seem to specify a leading space", "body": "<p>The <a href=\"https://godoc.org/fmt#Println\" rel=\"nofollow noreferrer\">documentation for fmt.Println</a> says:</p>\n\n<blockquote>\n  <p>Spaces are always added between operands and a newline is appended.</p>\n</blockquote>\n\n<p>There is a leading space because fmt.Println adds a space between the \"\\n\" and \"new line here\" operands.</p>\n\n<p>The fmt.Println function adds spaces between operands for convenience. It saves adding a number of \" \" operands in typical use of the function.</p>\n\n<p>Change the code to <code>fmt.Println(x, \"\\nnew line here\")</code> to avoid the unwanted space.</p>\n"}], "owner": {"reputation": 613, "user_id": 6376924, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/8108cf5530c5687c887bb234aca2d93d?s=128&d=identicon&r=PG&f=1", "display_name": "atomsmasher", "link": "https://stackoverflow.com/users/6376924/atomsmasher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "accepted_answer_id": 47117194, "answer_count": 1, "score": 1, "last_activity_date": 1509843803, "creation_date": 1509842692, "question_id": 47117105, "link": "https://stackoverflow.com/questions/47117105/why-is-there-a-leading-space-when-i-expect-only-a-new-line-and-dont-seem-to-spe", "title": "Why is there a leading space when I expect only a new line and don&#39;t seem to specify a leading space", "body": "<p>The link: <a href=\"https://play.golang.org/p/1b5MbgIP2N\" rel=\"nofollow noreferrer\">https://play.golang.org/p/1b5MbgIP2N</a></p>\n\n<p>The code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    println(\"his power level is over 9000!!! KAKAROTO\")\n    println(test(2))\n}\n\nfunc test(x int) int {\n    fmt.Println(x, \"\\n\", \"new line here\")\n    fmt.Println(\"another line here\")\n    return x + 1\n}\n</code></pre>\n\n<p>for some reason unknown to me, there appears to be one single leading whitespace character in front of \"new\" when the function is run. This might be something really obvious but what is happening? I don't see that I'm explicitly adding a space anywhere</p>\n"}, {"tags": ["go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1509853519, "last_edit_date": 1509853519, "creation_date": 1509852064, "answer_id": 47117846, "question_id": 47117064, "link": "https://stackoverflow.com/questions/47117064/why-are-go-c-types-different-when-they-come-from-different-modules/47117846#47117846", "title": "Why are Go C types different when they come from different modules?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">Command cgo</a></p>\n  \n  <p><a href=\"https://golang.org/cmd/cgo/#hdr-Go_references_to_C\" rel=\"nofollow noreferrer\">Go references to C</a></p>\n  \n  <p>Cgo translates C types into equivalent unexported Go types. Because\n  the translations are unexported, a Go package should not expose C\n  types in its exported API: a C type used in one Go package is\n  different from the same C type used in another.</p>\n</blockquote>\n\n<p>You say, \"For some reason the compiler thinks that C.int is not equal to module.C.int.\" As the cgo command documentation explains, unexported Go types in different packages are not equal.</p>\n\n<p>Don't expose C types in an exported API. For example,</p>\n\n<p><code>module.go</code>:</p>\n\n<pre><code>package module\n\ntype T struct {\n    X int\n}\n</code></pre>\n\n<p><code>main.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sandbox/module\"\n)\n\nimport \"C\"\n\nfunc f() *module.T {\n    var x C.int = 42\n    return &amp;module.T{X: int(x)}\n}\n\nfunc main() {\n    fmt.Printf(\"value: %d\\n\", f().X)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>value: 42\n</code></pre>\n"}], "owner": {"reputation": 862, "user_id": 1656636, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/eK9if.jpg?s=128&g=1", "display_name": "Johannes P", "link": "https://stackoverflow.com/users/1656636/johannes-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 643, "favorite_count": 1, "accepted_answer_id": 47117846, "answer_count": 1, "score": 1, "last_activity_date": 1509853519, "creation_date": 1509842164, "last_edit_date": 1509844234, "question_id": 47117064, "link": "https://stackoverflow.com/questions/47117064/why-are-go-c-types-different-when-they-come-from-different-modules", "title": "Why are Go C types different when they come from different modules?", "body": "<p>In Go, I have a compile error due to incompatible types which I cannot explain. I'm using the <code>\"C\"</code> module. A minimum example consists of the following 2 files:</p>\n\n<pre><code>package module\n\nimport \"C\"\n\ntype T struct {\n    X C.int\n}\n</code></pre>\n\n<p>and a main program</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sandbox/module\"\n)\n\nimport \"C\"\n\nfunc f() *module.T {\n    var x C.int = 42\n    return &amp;module.T{X: x}\n}\n\nfunc main() {\n    fmt.Printf(\"value: %d\", f().X)\n}\n</code></pre>\n\n<p>This fails to compile with the message\n<code>./main.go:12: cannot use x (type C.int) as type module.C.int in field value</code>.</p>\n\n<p>For some reason the compiler thinks that <code>C.int</code> is not equal to <code>module.C.int</code>.</p>\n\n<p>It must have something to do with the <code>C</code> module and the fact that the code is spread across 2 modules because it suddenly works if I switch from <code>C.int</code> to plain <code>int</code>.</p>\n\n<p>Why does this piece of code not compile? What would be the proper solution to make it compile without squashing all code together in one module?</p>\n\n<p>I'm using the latest Go compiler 1.9.2 on Ubuntu 16.04.</p>\n"}, {"tags": ["go", "authorization", "jwt"], "comments": [{"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1509939522, "post_id": 47116910, "comment_id": 81208764, "body": "have you tried using <a href=\"https://github.com/go-kit/kit/tree/master/auth/jwt\" rel=\"nofollow noreferrer\">auth/jwt</a> package from go-kit?"}, {"owner": {"reputation": 1007, "user_id": 5727424, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Djr2s.jpg?s=128&g=1", "display_name": "David Lavieri", "link": "https://stackoverflow.com/users/5727424/david-lavieri"}, "reply_to_user": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1509974166, "post_id": 47116910, "comment_id": 81224800, "body": "Yes, but it handles authentication, what I need is authorization"}, {"owner": {"reputation": 15341, "user_id": 2228325, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/Vn6At.png?s=128&g=1", "display_name": "TonyGW", "link": "https://stackoverflow.com/users/2228325/tonygw"}, "edited": false, "score": 0, "creation_date": 1520140346, "post_id": 47116910, "comment_id": 85189678, "body": "I need a similar functionality, did you find any solution? thanks"}], "owner": {"reputation": 1007, "user_id": 5727424, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Djr2s.jpg?s=128&g=1", "display_name": "David Lavieri", "link": "https://stackoverflow.com/users/5727424/david-lavieri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 872, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1509974124, "creation_date": 1509840401, "last_edit_date": 1509974124, "question_id": 47116910, "link": "https://stackoverflow.com/questions/47116910/check-user-authorization-for-certain-service-methods-in-go-kit-with-jwt", "title": "Check user Authorization for certain Service methods in go-kit with JWT", "body": "<p>I'm fairly new to go-kit and micro-service architecture as well.</p>\n\n<p>I have a JWT that contains the authenticated user's id as a claim, and each service's method, I want to check if the user has permission to update its own <strong>client</strong> record, but it seems that wherever I put it, it feels wrong. What are the best practices to doing something like this?</p>\n\n<pre><code>// client.go\ntype Client struct {\n    ID     string `json:\"id\"`\n    UserID string `json:\"user_id\"`\n    // ...\n}\n\ntype ClientDataLayer interface {\n    Load(db *sql.DB, id string) *Client\n    Update(db *sql.DB, cl *Client) *Client\n    // ... more CRUD methods\n}\n</code></pre>\n\n<p>Doing it within a service middleware I would have to call another service's method which seems to break the purpose of the architecture:</p>\n\n<pre><code>// service.go\ntype Service interface {\n    UpdateClient(ctx context.Context, cl *Client) (*Client, error)\n    // ... more methods\n}\n\nfunc NewClientService(db *sql.DB, cdl ClientDataLayer) {\n    // ....\n}\n\ntype service struct {\n    db  *sql.DB\n    cdl ClientDataLayer\n}\n\nfunc (svc *service) UpdateClient(ctx context.Context, id string) (*Client, error) {\n    return nil, nil\n}\n\n// service middleware\ntype accessControl struct {\n    svc Service\n}\n\nfunc (ac *accessControl) UpdateClient(ctx context.Context, cl *Client) (*Client, error) {\n    // ... get token and claims from context\n    // scopes := jwt.Claims().Get(\"scopes\")\n\n    // Here I don't have the client's user_id, \n    // and it does not feel right to call another service's method\n    if !strings.Contains(scopes, \"client:write\") || cl.UserID != userID {\n        return nil, errors.New(\"forbidden\")\n    }\n\n    // ...\n    return nil, nil\n}\n</code></pre>\n\n<p>Doing it on the endpoint its pretty much the same</p>\n\n<pre><code>// transport.go\nfunc makeUpdateClientEndpoint(svc Service) endpoint.Endpoint {\n    return func(ctx context.Context, request interface{}) (interface{}, error) {\n        // type cast request\n        // ... get token and claims from context\n        // scopes := jwt.Claims().Get(\"scopes\")\n\n        // Same problem as before, I don't have the client's user_id\n\n        if !strings.Contains(scopes, \"client:write\") || cl.UserID != userID {\n            return nil, errors.New(\"forbidden\")\n        }\n\n        cl, _ := svc.UpdateClient(ctx, request.ClientID)\n\n        // ...\n\n        return nil, nil\n    }\n}\n</code></pre>\n\n<p>I probably could get away by using the ClientDataLayer to retrieve the client and checking the user's id. As a way to avoid messing with another service method to load the client because it may have middlewares for logging or metrics too. </p>\n\n<p>How could I achieve this without so much hassle where I feel like breaking the patterns?</p>\n"}, {"tags": ["api", "go", "client", "kubernetes", "kubernetes-go-client"], "answers": [{"tags": [], "owner": {"reputation": 12722, "user_id": 393157, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PiD4P.png?s=128&g=1", "display_name": "svenwltr", "link": "https://stackoverflow.com/users/393157/svenwltr"}, "is_accepted": false, "score": 2, "last_activity_date": 1509897194, "creation_date": 1509897194, "answer_id": 47123543, "question_id": 47116811, "link": "https://stackoverflow.com/questions/47116811/client-go-parse-kubernetes-json-files-to-k8s-structures/47123543#47123543", "title": "client-go: parse kubernetes json files to k8s structures", "body": "<p>This question is very similar to <a href=\"https://stackoverflow.com/questions/44306554/how-to-deserialize-kubernetes-yaml-file\">How to deserialize Kubernetes YAML file</a>, but this question is a bit outdated, since the package names changed.</p>\n\n<p>Also it doesn't directly use the go client, which means there might be another solution to this.</p>\n\n<p>Here is a example: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"k8s.io/kubernetes/pkg/api\"\n    _ \"k8s.io/kubernetes/pkg/api/install\"\n    _ \"k8s.io/kubernetes/pkg/apis/extensions/install\"\n    \"k8s.io/kubernetes/pkg/apis/extensions/v1beta1\"\n)\n\nvar json = `\n{\n  \"apiVersion\": \"extensions/v1beta1\",\n  \"kind\": \"Deployment\",\n  \"metadata\": null,\n  \"name\": \"my-nginx\",\n  \"replicas\": 2,\n  \"spec\": null,\n  \"template\": {\n    \"metadata\": {\n      \"labels\": {\n        \"run\": \"my-nginx\"\n      }\n    },\n    \"spec\": {\n      \"containers\": [\n        {\n          \"image\": \"nginx\",\n          \"name\": \"my-nginx\",\n          \"ports\": [\n            {\n              \"containerPort\": 80\n            }\n          ]\n        }\n      ]\n    }\n  }\n}\n`\n\nfunc main() {\n    // decode := api.Codecs.UniversalDecoder().Decode\n    decode := api.Codecs.UniversalDeserializer().Decode\n\n    obj, _, err := decode([]byte(json), nil, nil)\n    if err != nil {\n        fmt.Printf(\"%#v\", err)\n    }\n\n    deployment := obj.(*v1beta1.Deployment)\n\n    fmt.Printf(\"%#v\\n\", deployment)\n}\n</code></pre>\n\n<p><strong>Notes</strong></p>\n\n<ul>\n<li>the <code>.../install</code> packages are important, since they define which types can get decoded</li>\n<li>it's able to decode JSON, YAML and probably also all other supported file types</li>\n<li>not sure where the difference between <code>UniversalDecoder</code> and <code>UniversalDeserializer</code> is</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 4742660, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jL21MgC-UZE/AAAAAAAAAAI/AAAAAAAAAIg/KGR5fFmvivc/photo.jpg?sz=128", "display_name": "Nicolas Zin", "link": "https://stackoverflow.com/users/4742660/nicolas-zin"}, "is_accepted": false, "score": 3, "last_activity_date": 1509978703, "creation_date": 1509978703, "answer_id": 47139247, "question_id": 47116811, "link": "https://stackoverflow.com/questions/47116811/client-go-parse-kubernetes-json-files-to-k8s-structures/47139247#47139247", "title": "client-go: parse kubernetes json files to k8s structures", "body": "<p>Thanks svenwltr, I was not aware we can do like this.</p>\n\n<p>In the same time, I manage to find not a better approach but a different one:</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"os\"\n    \"io\"\n    \"path/filepath\"\n    \"log\"\n    \"encoding/json\"\n    //\"time\"\n\n    metav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n    \"k8s.io/client-go/kubernetes\"\n    \"k8s.io/client-go/tools/clientcmd\"\n    \"k8s.io/client-go/discovery\"\n    \"k8s.io/client-go/dynamic\"\n    \"k8s.io/apimachinery/pkg/util/yaml\"\n    \"k8s.io/apimachinery/pkg/runtime\"\n    \"k8s.io/apimachinery/pkg/runtime/schema\"\n    \"k8s.io/apimachinery/pkg/api/meta\"\n    \"k8s.io/apimachinery/pkg/apis/meta/v1/unstructured\"\n\n)\n\nfunc main() {\n    var kubeconfig *string\n    if home := homeDir(); home != \"\" {\n        kubeconfig = flag.String(\"kubeconfig\", filepath.Join(home, \".kube\", \"config\"), \"(optional) absolute path to the kubeconfig file\")\n    } else {\n        kubeconfig = flag.String(\"kubeconfig\", \"\", \"absolute path to the kubeconfig file\")\n    }\n    flag.Parse()\n\n    // use the current context in kubeconfig\n    config, err := clientcmd.BuildConfigFromFlags(\"\", *kubeconfig)\n    if err != nil {\n        panic(err.Error())\n    }\n\n    // create the clientset\n    clientset, err := kubernetes.NewForConfig(config)\n    if err != nil {\n        panic(err.Error())\n    }\n\n    f,err := os.Open(\"namespace.yaml\")\n    if err!=nil {\n        log.Fatal(err)\n    }\n    d := yaml.NewYAMLOrJSONDecoder(f,4096)\n    dd := clientset.Discovery()\n    apigroups,err := discovery.GetAPIGroupResources(dd)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    restmapper := discovery.NewRESTMapper(apigroups,meta.InterfacesForUnstructured)\n\n\n    for {\n        // https://github.com/kubernetes/apimachinery/blob/master/pkg/runtime/types.go\n        ext := runtime.RawExtension{}\n        if err := d.Decode(&amp;ext); err!=nil {\n            if err == io.EOF {\n                break\n            }\n            log.Fatal(err)\n        }\n        fmt.Println(\"raw: \",string(ext.Raw))\n        versions := &amp;runtime.VersionedObjects{}\n        //_, gvk, err := objectdecoder.Decode(ext.Raw,nil,versions)\n        obj, gvk, err := unstructured.UnstructuredJSONScheme.Decode(ext.Raw,nil,versions)\n        fmt.Println(\"obj: \",obj)\n\n        // https://github.com/kubernetes/apimachinery/blob/master/pkg/api/meta/interfaces.go\n        mapping, err := restmapper.RESTMapping(gvk.GroupKind(), gvk.Version)\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        restconfig := config\n        restconfig.GroupVersion = &amp;schema.GroupVersion {\n            Group: mapping.GroupVersionKind.Group,\n            Version: mapping.GroupVersionKind.Version,\n        } \n        dclient,err := dynamic.NewClient(restconfig)\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        // https://github.com/kubernetes/client-go/blob/master/discovery/discovery_client.go\n        apiresourcelist, err := dd.ServerResources()\n        if err != nil {\n            log.Fatal(err)\n        }\n        var myapiresource metav1.APIResource\n        for _,apiresourcegroup := range(apiresourcelist) {\n            if apiresourcegroup.GroupVersion == mapping.GroupVersionKind.Version {\n                for _,apiresource := range(apiresourcegroup.APIResources) {\n                    //fmt.Println(apiresource)\n\n                    if apiresource.Name == mapping.Resource &amp;&amp; apiresource.Kind == mapping.GroupVersionKind.Kind {\n                        myapiresource = apiresource\n                    }\n                }\n            }\n        }\n        fmt.Println(myapiresource)\n        // https://github.com/kubernetes/client-go/blob/master/dynamic/client.go\n\n        var unstruct unstructured.Unstructured\n        unstruct.Object = make(map[string]interface{})\n        var blob interface{}\n        if err := json.Unmarshal(ext.Raw,&amp;blob); err != nil {\n            log.Fatal(err)\n        }\n        unstruct.Object = blob.(map[string]interface{})\n        fmt.Println(\"unstruct:\",unstruct)\n        ns := \"default\"\n        if md,ok := unstruct.Object[\"metadata\"]; ok {\n            metadata := md.(map[string]interface{})\n            if internalns,ok := metadata[\"namespace\"]; ok {\n                ns = internalns.(string)\n            }\n        }\n        res := dclient.Resource(&amp;myapiresource,ns)\n        fmt.Println(res)\n        us,err := res.Create(&amp;unstruct)\n        if err != nil {\n            log.Fatal(err)\n        }\n        fmt.Println(\"unstruct response:\",us)\n\n\n    }\n}\n\nfunc homeDir() string {\n    if h := os.Getenv(\"HOME\"); h != \"\" {\n        return h\n    }\n    return os.Getenv(\"USERPROFILE\") // windows\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 73, "user_id": 2999195, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RI4RJ.jpg?s=128&g=1", "display_name": "Skipor", "link": "https://stackoverflow.com/users/2999195/skipor"}, "is_accepted": false, "score": 1, "last_activity_date": 1597056509, "creation_date": 1597056509, "answer_id": 63338697, "question_id": 47116811, "link": "https://stackoverflow.com/questions/47116811/client-go-parse-kubernetes-json-files-to-k8s-structures/63338697#63338697", "title": "client-go: parse kubernetes json files to k8s structures", "body": "<pre class=\"lang-golang prettyprint-override\"><code>   import (\n        v1 &quot;k8s.io/api/core/v1&quot;\n        &quot;k8s.io/apimachinery/pkg/runtime&quot;\n        &quot;k8s.io/apimachinery/pkg/runtime/serializer&quot;\n        &quot;k8s.io/client-go/kubernetes/scheme&quot;\n    )\n    \n    func decode(data []byte) (*v1.Namespace, error) {\n        decoder := serializer.NewCodecFactory(scheme.Scheme).UniversalDecoder()\n        object := &amp;v1.Namespace{}\n        err := runtime.DecodeInto(decoder, data, object)\n        if err != nil {\n            return nil, err\n        }\n        return object, nil\n    }\n</code></pre>\n<p>Pass <code>SchemeGroupVersion</code> generated for your CRDs to <code>UniversalDecoder</code> call, if needed.</p>\n<p>Use <code>runtime.Decode</code> instead of <code>runtime.DecodeInto</code> to decode unspecified object type.</p>\n"}], "owner": {"reputation": 71, "user_id": 4742660, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jL21MgC-UZE/AAAAAAAAAAI/AAAAAAAAAIg/KGR5fFmvivc/photo.jpg?sz=128", "display_name": "Nicolas Zin", "link": "https://stackoverflow.com/users/4742660/nicolas-zin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8503, "favorite_count": 0, "answer_count": 3, "score": 4, "last_activity_date": 1597056509, "creation_date": 1509839280, "last_edit_date": 1509840396, "question_id": 47116811, "link": "https://stackoverflow.com/questions/47116811/client-go-parse-kubernetes-json-files-to-k8s-structures", "title": "client-go: parse kubernetes json files to k8s structures", "body": "<p>i would like to parse kubernetes manifest file (json/yaml) and be able to convert them to k8s structures (to later on manipulate them)</p>\n\n<p>I know there is the NewYAMLOrJSONDecoder().Decode() function (<a href=\"https://github.com/kubernetes/apimachinery/blob/master/pkg/util/yaml/decoder.go\" rel=\"nofollow noreferrer\">https://github.com/kubernetes/apimachinery/blob/master/pkg/util/yaml/decoder.go</a>) to read a json/yaml file, but the next step is: how to convert them to k8s structure/type?</p>\n\n<p>i.e. if I read a yaml file with a Namespace object, how to convert it to a core/v1/namespace interface for example</p>\n\n<p>Regards,</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509836510, "post_id": 47116305, "comment_id": 81182933, "body": "<a href=\"http://www.gorillatoolkit.org/pkg/handlers\" rel=\"nofollow noreferrer\">gorillatoolkit.org/pkg/handlers</a>"}], "answers": [{"tags": [], "owner": {"reputation": 473, "user_id": 3314232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S3Bym.jpg?s=128&g=1", "display_name": "Saeed Falsafin", "link": "https://stackoverflow.com/users/3314232/saeed-falsafin"}, "is_accepted": false, "score": 0, "last_activity_date": 1509868386, "creation_date": 1509868386, "answer_id": 47119385, "question_id": 47116305, "link": "https://stackoverflow.com/questions/47116305/golang-request-middleware-library/47119385#47119385", "title": "Golang request middleware library?", "body": "<p>You can use <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow noreferrer\">Go Gin</a> HTTP web framework that supports middlewares as well as you want:</p>\n\n<p>Using middleware:</p>\n\n<pre><code>func main() {\n// Creates a router without any middleware by default\nr := gin.New()\n\n// Global middleware\n// Logger middleware will write the logs to gin.DefaultWriter even you set with GIN_MODE=release.\n// By default gin.DefaultWriter = os.Stdout\nr.Use(gin.Logger())\n\n// Recovery middleware recovers from any panics and writes a 500 if there was one.\nr.Use(gin.Recovery())\n\n// Per route middleware, you can add as many as you desire.\nr.GET(\"/benchmark\", MyBenchLogger(), benchEndpoint)\n\n// Authorization group\n// authorized := r.Group(\"/\", AuthRequired())\n// exactly the same as:\nauthorized := r.Group(\"/\")\n// per group middleware! in this case we use the custom created\n// AuthRequired() middleware just in the \"authorized\" group.\nauthorized.Use(AuthRequired())\n{\n    authorized.POST(\"/login\", loginEndpoint)\n    authorized.POST(\"/submit\", submitEndpoint)\n    authorized.POST(\"/read\", readEndpoint)\n\n    // nested group\n    testing := authorized.Group(\"testing\")\n    testing.GET(\"/analytics\", analyticsEndpoint)\n}\n\n// Listen and serve on 0.0.0.0:8080\nr.Run(\":8080\")\n}\n</code></pre>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 301, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1509868386, "creation_date": 1509834997, "question_id": 47116305, "link": "https://stackoverflow.com/questions/47116305/golang-request-middleware-library", "title": "Golang request middleware library?", "body": "<p>I'm using gorrilla mux for my mux for my routing setup.</p>\n\n<p>Is there any open source library that will provide some sort of request middleware?</p>\n\n<pre><code>router.HandleFunc(\"/products\", GetProducts).Methods(\"GET\")\n</code></pre>\n\n<p>So currently I have the GetProducts function that will return the products etc.  </p>\n\n<p>But this is a REST api that I am building, so I have to handle things like loading the user, verifying the 'api token' for the request etc.</p>\n\n<p>I don't want to do this for each and every method so I was hoping I there was some request middleware when I can do this before/after execution, along with adding things like <code>User</code>, <code>Permissions</code> to the context in each middleware function.</p>\n"}, {"tags": ["url", "go", "oauth-2.0"], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1509831853, "creation_date": 1509831853, "answer_id": 47115925, "question_id": 47115817, "link": "https://stackoverflow.com/questions/47115817/how-to-write-redirect-url-in-oauth-using-go/47115925#47115925", "title": "how to write Redirect URL in OAuth using go", "body": "<p>Heroku recommends using environment variables for most configuration, so you can use the <code>os</code> package to retrieve the redirect url from the environment.</p>\n\n<pre><code>func init() {\n    redirURL := os.Getenv(\"OAUTH_REDIRECT_URL\")\n\n    file, err := ioutil.ReadFile(\"./creds.json\")\n    if err != nil {\n        log.Printf(\"File error: %v\\n\", err)\n        os.Exit(1)\n    }\n    json.Unmarshal(file, &amp;cred)\n\n    conf = &amp;oauth2.Config{\n        ClientID:     cred.Cid,\n        ClientSecret: cred.Csecret,\n        RedirectURL:  redirURL,\n        Scopes: []string{\n            \"https://www.googleapis.com/auth/userinfo.email\", // You have to select your own scope from here -&gt; https://developers.google.com/identity/protocols/googlescopes#google_sign-in\n            \"https://www.googleapis.com/auth/calendar\", \"https://www.googleapis.com/auth/calendar.readonly\",\n        },\n        Endpoint: google.Endpoint,\n    }\n}\n</code></pre>\n\n<p>And then on your local machine set an environment variable like so:</p>\n\n<pre><code>export OAUTH_REDIRECT_URL=http://127.0.0.1:3000/auth\n</code></pre>\n\n<p>and on your heroku dyno set it to the value you need it to redirect to.</p>\n"}], "owner": {"reputation": 81, "user_id": 6500168, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/601b94035e1a7a2b6cc2c24f82f8c05e?s=128&d=identicon&r=PG&f=1", "display_name": "Amr Khalil", "link": "https://stackoverflow.com/users/6500168/amr-khalil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "accepted_answer_id": 47115925, "answer_count": 1, "score": 1, "last_activity_date": 1509831853, "creation_date": 1509830963, "question_id": 47115817, "link": "https://stackoverflow.com/questions/47115817/how-to-write-redirect-url-in-oauth-using-go", "title": "how to write Redirect URL in OAuth using go", "body": "<pre><code>func init() {\n    file, err := ioutil.ReadFile(\"./creds.json\")\n    if err != nil {\n        log.Printf(\"File error: %v\\n\", err)\n        os.Exit(1)\n    }\n    json.Unmarshal(file, &amp;cred)\n\n    conf = &amp;oauth2.Config{\n        ClientID:     cred.Cid,\n        ClientSecret: cred.Csecret,\n        RedirectURL:  \"http://127.0.0.1:3000/auth\",\n        Scopes: []string{\n            \"https://www.googleapis.com/auth/userinfo.email\", // You have to select your own scope from here -&gt; https://developers.google.com/identity/protocols/googlescopes#google_sign-in\n            \"https://www.googleapis.com/auth/calendar\", \"https://www.googleapis.com/auth/calendar.readonly\",\n        },\n        Endpoint: google.Endpoint,\n    }\n}\n</code></pre>\n\n<p>the above code is the init function in my code  the part <code>RedirectURL:  \"http://127.0.0.1:3000/auth\"</code>\nuses the localhost link but what happens if I deploy my site using heruko shouldn't the 127.0.0.1 be changed if yes how should I change it</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1670, "user_id": 6579556, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ddcf07d32c7d026a6e2fb697b8ae75f3?s=128&d=identicon&r=PG&f=1", "display_name": "Pavel", "link": "https://stackoverflow.com/users/6579556/pavel"}, "edited": false, "score": 0, "creation_date": 1509873205, "post_id": 47115874, "comment_id": 81189563, "body": "I updated my question in accordance with your recommendations"}, {"owner": {"reputation": 1670, "user_id": 6579556, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ddcf07d32c7d026a6e2fb697b8ae75f3?s=128&d=identicon&r=PG&f=1", "display_name": "Pavel", "link": "https://stackoverflow.com/users/6579556/pavel"}, "edited": false, "score": 0, "creation_date": 1509896610, "post_id": 47115874, "comment_id": 81196707, "body": "If I understood correctly then using suffixes would be a good idea?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 1670, "user_id": 6579556, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ddcf07d32c7d026a6e2fb697b8ae75f3?s=128&d=identicon&r=PG&f=1", "display_name": "Pavel", "link": "https://stackoverflow.com/users/6579556/pavel"}, "edited": false, "score": 0, "creation_date": 1509897304, "post_id": 47115874, "comment_id": 81196996, "body": "Whether packages or suffixes usually depends on how big the project is, but even then, it is still just a subjective opinion and you should decide for yourself, or with your team, which approach to use. As long as your code compiles and you follow the <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\">&quot;standard&quot; coding practices</a> (package vs suffix is not &quot;standardized&quot; afaik :)) then you should be ok."}, {"owner": {"reputation": 1670, "user_id": 6579556, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ddcf07d32c7d026a6e2fb697b8ae75f3?s=128&d=identicon&r=PG&f=1", "display_name": "Pavel", "link": "https://stackoverflow.com/users/6579556/pavel"}, "edited": false, "score": 0, "creation_date": 1509900638, "post_id": 47115874, "comment_id": 81198222, "body": "<i>Package vs suffix is not &quot;standardized&quot;</i> yes, but the best practice, it seems to me, is to divide into separate packages and I do not understand how to separate my code into several packages"}, {"owner": {"reputation": 1670, "user_id": 6579556, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ddcf07d32c7d026a6e2fb697b8ae75f3?s=128&d=identicon&r=PG&f=1", "display_name": "Pavel", "link": "https://stackoverflow.com/users/6579556/pavel"}, "edited": false, "score": 1, "creation_date": 1509904933, "post_id": 47115874, "comment_id": 81199756, "body": "Thank you very much, it helped me to understand =)"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1509902621, "last_edit_date": 1509902621, "creation_date": 1509831369, "answer_id": 47115874, "question_id": 47115731, "link": "https://stackoverflow.com/questions/47115731/how-to-split-my-resources-into-multiply-files/47115874#47115874", "title": "How to split my resources into multiply files", "body": "<p>Since your <code>db</code> var is defined at the <em>package level</em> it's basically a global for that package an can be referenced in any file that lives in that package.</p>\n\n<p>For example, in a project like this:</p>\n\n<pre><code>.\n\u2514\u2500\u2500 app\n    \u251c\u2500\u2500 a.go\n    \u251c\u2500\u2500 b.go\n    \u251c\u2500\u2500 c.go\n    \u2514\u2500\u2500 main.go\n</code></pre>\n\n<p>If <code>db</code> is defined inside main.go at the package level, as in your example, then code in files a.go, b.go, and c.go can use <code>db</code>.</p>\n\n<p>It works the other way as well, any resource handlers defined in a.go, b.go, and c.go can be reference in main.go. Which means that in each of those files you can define a function that takes a router, the gin router, and sets the corresponding handlers, then inside main.go's main function you call those functions passing in the router <code>r</code>.</p>\n\n<hr>\n\n<h3>Update</h3>\n\n<p>First off, you're calling <code>defer db.Close()</code> inside of you init function, which means that right after init returns your <code>db</code> gets closed which is absolutely not what you want. Using <code>defer db.Close()</code> in main is fine because main terminates when your app terminates, closing the db at that point makes sense, but when init terminates your app didn't even start properly, the main is just getting executed and you still need your <code>db</code>.</p>\n\n<p>If you want to use the <code>init</code> functions in each file to do initialization specific to that file, you have to ensure that whatever those init functions depend on, is initialized <strong>before they get executed</strong>.</p>\n\n<p>In your example all of your init functions depend on <code>db</code> and <code>r</code> so you need to make sure these two are not <code>nil</code>. I'm not exactly sure what, in Go, the order of execution is for multiple init functions in a single package but what I know for sure is that package level variable expressions get initialized before the init functions are executed.</p>\n\n<p>So what you can do is to use a function call to initialize the two package level variables like so:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/gin-gonic/gin\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/postgres\"\n)\n\nvar (\n    db = func() *gorm.DB {\n        db, err := gorm.Open(\"postgres\", fmt.Sprintf(\"host=localhost sslmode=disable user=postgres password=\"))\n        if err != nil {\n            // if you can't open a db connection you should stop the app,\n            // no point in continuing if you can't do anything useful.\n            panic(err)\n        }\n        return db\n    }() // &lt;- call the anon function to get the db.\n\n    r = gin.Default()\n)\n\nfunc main() {\n    // you can call defer db.Close() here but you don't really need to\n    // because after main exists, that is, your app terminates, db\n    // will be closed automatically.\n\n    r.Run(\":8080\")\n}\n</code></pre>\n\n<hr>\n\n<p>As to your second problem, in Go <code>init</code> is a <em>special case</em> and by that I mean that you can have multiple init functions inside a single package, and even inside a single file. This is not true of any other identifiers that you declare.</p>\n\n<p>That means that inside a package, and declared at the package level, you can have only one <code>db</code> identifier, one <code>get</code> identifier, only one <code>User</code> identifier, etc. Whether you use suffiex e.g. <code>getUser</code> or packages <code>user.Get</code> is entirely up to you.</p>\n\n<p>Note that you can redeclare an identifier <strong>in another scope</strong>, let's say you have <code>type User struct { ...</code> at the package level, and then a function declared in the same pacakge can inside its own scope declare a variable like so <code>var User = \"whatever\"</code>, although it's probably not the best idea it will compile.</p>\n\n<p>For more details see:\n<a href=\"https://golang.org/ref/spec#Package_initialization\" rel=\"nofollow noreferrer\">Package initialization</a></p>\n\n<hr>\n\n<h3>Update 2</h3>\n\n<p>If you want to split your code into multiple packages you just put your files into separate folders and make sure that the <code>package</code> declaration at the top of your file has the correct package name.</p>\n\n<p>Here's an example:</p>\n\n<pre><code>\u2514\u2500\u2500 app/\n    \u251c\u2500\u2500 main.go\n    \u251c\u2500\u2500 product/\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 product.go\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 product_test.go\n    \u2514\u2500\u2500 user/\n        \u251c\u2500\u2500 user.go\n        \u2514\u2500\u2500 user_test.go\n</code></pre>\n\n<p>Now your <code>app/user/user.go</code> code could look something like this.</p>\n\n<pre><code>package user\n\nimport (\n    \"github.com/gin-gonic/gin\"\n    \"github.com/jinzhu/gorm\"\n)\n\nvar db *gorm.DB\n\ntype User struct {\n    gorm.Model\n    Name string\n}\n\n// custom and exported Init function, this will not be called automatically\n// by the go runtime like the special `init` function and therefore must be called\n// manually by the package that imports this one.\nfunc Init(gormdb *gorm.DB, r *gin.Engine) {\n    db = gormdb // set package global\n\n    db.AutoMigrate(&amp;User{})\n\n    r.GET(\"/users\", get)\n}\n\nfunc get(c *gin.Context) {\n    var user User\n    db.First(&amp;user, 1)\n\n    c.JSON(200, gin.H{\n        \"user\": user,\n    })\n}\n</code></pre>\n\n<p>your <code>app/product/product.go</code> ...</p>\n\n<pre><code>package product\n\nimport (\n    \"github.com/gin-gonic/gin\"\n    \"github.com/jinzhu/gorm\"\n)\n\nvar db *gorm.DB\n\ntype Product struct {\n    gorm.Model\n    Code  string\n    Price uint\n}\n\n// custom and exported Init function, this will not be called automatically\n// by the go runtime like the special `init` function and therefore must be called\n// manually by the package that imports this one.\nfunc Init(gormdb *gorm.DB, r *gin.Engine) {\n    db = gormdb // set package global\n\n    db.AutoMigrate(&amp;Product{})\n\n    r.GET(\"/products\", get)\n}\n\nfunc get(c *gin.Context) {\n    var product Product\n    db.First(&amp;product, 1)\n\n    c.JSON(200, gin.H{\n        \"product\": product,\n    })\n}\n</code></pre>\n\n<p>And your entry point at <code>app/main.go</code> ...</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    // This assumes that the app/ folder lives directly in $GOPATH if that's\n    // not the case the import won't work.\n    \"app/product\"\n    \"app/user\"\n\n    \"github.com/gin-gonic/gin\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/postgres\"\n)\n\nfunc main() {\n    db, err := gorm.Open(\"postgres\", fmt.Sprintf(\"host=localhost sslmode=disable user=postgres password=\"))\n    if err != nil {\n        fmt.Println(err)\n    }\n    defer db.Close()\n\n    r := gin.Default()\n\n    // manually initialize imported packages\n    user.Init(db, r)\n    product.Init(db, r)\n\n    r.Run(\":8080\")\n}\n</code></pre>\n"}], "owner": {"reputation": 1670, "user_id": 6579556, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ddcf07d32c7d026a6e2fb697b8ae75f3?s=128&d=identicon&r=PG&f=1", "display_name": "Pavel", "link": "https://stackoverflow.com/users/6579556/pavel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 992, "favorite_count": 1, "accepted_answer_id": 47115874, "answer_count": 1, "score": 0, "last_activity_date": 1509902621, "creation_date": 1509830312, "last_edit_date": 1509873156, "question_id": 47115731, "link": "https://stackoverflow.com/questions/47115731/how-to-split-my-resources-into-multiply-files", "title": "How to split my resources into multiply files", "body": "<p>I'm trying to write a restful api on golang. For http router I use gin-gonic, to interact with the database I use gorm.\n    package main</p>\n\n<pre><code>import (\n    \"fmt\"\n\n    \"github.com/gin-gonic/gin\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/postgres\"\n)\n\nvar db *gorm.DB\n\ntype Person struct {\n    ID        uint   `json:\"id\"`\n    FirstName string `json:\"firstname\"`\n    LastName  string `json:\"lastname\"`\n}\n\nfunc main() {\n    // NOTE: See we\u2019re using = to assign the global var\n    // instead of := which would assign it only in this function\n    db, err := gorm.Open(\"postgres\", fmt.Sprintf(\"host=localhost sslmode=disable user=postgres password=\"))\n    if err != nil {\n        fmt.Println(err)\n    }\n    defer db.Close()\n    db.AutoMigrate(&amp;Person{})\n    r := gin.Default()\n    r.GET(\"/people/\", GetPeople)\n    r.GET(\"/people/:id\", GetPerson)\n    r.POST(\"/people\", CreatePerson)\n    r.Run(\":8080\")\n}\nfunc CreatePerson(c *gin.Context) {\n    var person Person\n    c.BindJSON(&amp;person)\n    db.Create(&amp;person)\n    c.JSON(200, person)\n}\nfunc GetPerson(c *gin.Context) {\n    id := c.Params.ByName(\"id\")\n    var person Person\n    if err := db.Where(\"id = ?\", id).First(&amp;person).Error; err != nil {\n        c.AbortWithStatus(404)\n        fmt.Println(err)\n    } else {\n        c.JSON(200, person)\n    }\n}\nfunc GetPeople(c *gin.Context) {\n    var people []Person\n    if err := db.Find(&amp;people).Error; err != nil {\n        c.AbortWithStatus(404)\n        fmt.Println(err)\n    } else {\n        c.JSON(200, people)\n    }\n}\n</code></pre>\n\n<p>How do I split the code into multiple files so that a separate resource is in a separate file? How to use the router and database in another file?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>With structure like this:</p>\n\n<pre><code>.\n\u2514\u2500\u2500 app\n    \u251c\u2500\u2500 users.go\n    \u251c\u2500\u2500 products.go\n    \u2514\u2500\u2500 main.go\n</code></pre>\n\n<p>I have 2 problems:</p>\n\n<ol>\n<li>db == nil in <code>products.go</code> and <code>users.go</code></li>\n<li>Redeclaration function (<code>get</code>, <code>create</code> ...) in different files, this solve by prefix in function declaration like <code>CreateUser</code>, <code>CreateProduct</code>, etc. But it may be solved by put code into another packages</li>\n</ol>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/gin-gonic/gin\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/postgres\"\n)\n\nvar (\n    db *gorm.DB\n    r  *gin.Engine\n)\n\nfunc init() {\n    db, err := gorm.Open(\"postgres\", fmt.Sprintf(\"host=localhost sslmode=disable user=postgres password=\"))\n    if err != nil {\n        fmt.Println(err)\n    }\n    defer db.Close()\n\n    r = gin.Default()\n}\n\nfunc main() {\n    r.Run(\":8080\")\n}\n</code></pre>\n\n<p><strong>products.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gin-gonic/gin\"\n    \"github.com/jinzhu/gorm\"\n)\n\ntype Product struct {\n    gorm.Model\n    Code  string\n    Price uint\n}\n\nfunc init() {\n    db.AutoMigrate(&amp;Product{}) // db -&gt; nil\n\n    r.GET(\"/products\", get)\n}\n\nfunc get(c *gin.Context) {\n    var product Product\n    db.First(&amp;product, 1)\n\n    c.JSON(200, gin.H{\n        \"product\": product,\n    })\n}\n</code></pre>\n\n<p><strong>users.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gin-gonic/gin\"\n    \"github.com/jinzhu/gorm\"\n)\n\ntype User struct {\n    gorm.Model\n    Name string\n}\n\nfunc init() {\n    db.AutoMigrate(&amp;User{}) // db -&gt; nil\n\n    r.GET(\"/users\", get)\n}\n\n// ./users.go:19: get redeclared in this block\n// previous declaration at ./products.go:20    \nfunc get(c *gin.Context) {\n    var user User\n    db.First(&amp;user, 1)\n\n    c.JSON(200, gin.H{\n        \"user\": user,\n    })\n}\n</code></pre>\n"}, {"tags": ["html", "go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8733557"}, "edited": false, "score": 0, "creation_date": 1509829023, "post_id": 47115541, "comment_id": 81180888, "body": "I did this because Go ignores single quotes. If you use double quotes, you will get an error. At least that is what has happened to me."}, {"owner": {"reputation": 79, "user_id": 8846381, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/78ed26586adf66252403f7b3bfc20ca5?s=128&d=identicon&r=PG&f=1", "display_name": "Rhys Clarke", "link": "https://stackoverflow.com/users/8846381/rhys-clarke"}, "edited": false, "score": 0, "creation_date": 1509829203, "post_id": 47115541, "comment_id": 81180954, "body": "My apologies didn&#39;t realize this was Golang.                                          You need to expose the directory which contain the image file, CSS or JS files with http.FileServer(http.Dir(&quot;./&quot;)) functions.  NOTE : Basically, the Golang&#39;s webserver will not be able to find the require files - image, CSS, JS - unless they are accessible by the client. Which usually is the Internet browser."}], "tags": [], "owner": {"reputation": 79, "user_id": 8846381, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/78ed26586adf66252403f7b3bfc20ca5?s=128&d=identicon&r=PG&f=1", "display_name": "Rhys Clarke", "link": "https://stackoverflow.com/users/8846381/rhys-clarke"}, "is_accepted": false, "score": -1, "last_activity_date": 1509829513, "last_edit_date": 1509829513, "creation_date": 1509828804, "answer_id": 47115541, "question_id": 47115482, "link": "https://stackoverflow.com/questions/47115482/how-do-you-insert-an-image-into-a-html-golang-file/47115541#47115541", "title": "How do you insert an image into a HTML Golang file?", "body": "<p>You just need to use the <code>&lt;img&gt;</code> tag but you have used ' instead of \" other than that the code appears fine, however i would consider using CSS instead of html to set image size. its not required but is more common.</p>\n\n<p><strong>Please ignore the above, i was incorrect!</strong></p>\n\n<p>The below code should help, its on <a href=\"https://www.socketloop.com/tutorials/golang-how-to-display-image-file-or-expose-css-js-files-from-localhost\" rel=\"nofollow noreferrer\">here</a></p>\n\n<pre><code>    func Home(w http.ResponseWriter, r *http.Request) {\n\n          //w.Write([]byte(fmt.Sprintf(\"Generating QR code\\n\")))\n\n          // generate a random string - preferbly 6 or 8 characters\n          randomStr := randStr(6, \"alphanum\")\n\n         // For Google Authenticator purpose\n         // for more details see\n         // https://github.com/google/google-authenticator/wiki/Key-Uri-Format\n         secret = base32.StdEncoding.EncodeToString([]byte(randomStr))\n         //w.Write([]byte(fmt.Sprintf(\"Secret : %s !\\n\", secret)))\n\n         // authentication link. Remember to replace SocketLoop with yours.\n         // for more details see\n         // https://github.com/google/google-authenticator/wiki/Key-Uri-Format\n         authLink := \"otpauth://totp/SocketLoop?secret=\" + secret + \"&amp;issuer=SocketLoop\"\n\n         // Encode authLink to QR codes\n         // qr.H = 65% redundant level\n         // see https://godoc.org/code.google.com/p/rsc/qr#Level\n\n         code, err := qr.Encode(authLink, qr.H)\n\n         if err != nil {\n                 fmt.Println(err)\n                 os.Exit(1)\n         }\n\n         imgByte := code.PNG()\n\n         // convert byte to image for saving to file\n         img, _, _ := image.Decode(bytes.NewReader(imgByte))\n\n         err = imaging.Save(img, \"./QRImgGA.png\")\n\n         if err != nil {\n                 fmt.Println(err)\n                 os.Exit(1)\n         }\n\n         // in real world application, the QRImgGA.png file should\n         // be a temporary file with dynamic name.\n         // for this tutorial sake, we keep it as static name.\n\n         w.Write([]byte(fmt.Sprintf(\"&lt;html&gt;&lt;body&gt;&lt;h1&gt;QR code for : %s&lt;/h1&gt;&lt;img src='http://localhost:8080/QRImgGA.png'&gt;\", authLink)))\n         w.Write([]byte(fmt.Sprintf(\"&lt;form action='http://localhost:8080/verify' method='post'&gt;Token : &lt;input name='token' id='token'&gt;&lt;input type='submit' value='Verify Token'&gt;&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;\")))\n }\n\n func main() {\n         http.HandleFunc(\"/\", Home)\n         http.HandleFunc(\"/verify\", Verify)\n\n         // this is for displaying the QRImgGA.png from the source directory\n         http.Handle(\"/QRImgGA.png\", http.FileServer(http.Dir(\"./\"))) //&lt;---------------- here!\n\n         http.ListenAndServe(\":8080\", nil)\n }\n\n\n  [1]: https://www.socketloop.com/tutorials/golang-how-to-display-image-file-or-expose-css-js-files-from-localhost\n</code></pre>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8733557"}, "edited": false, "score": 0, "creation_date": 1509830521, "post_id": 47115707, "comment_id": 81181371, "body": "I get this error in return, # command-line-arguments .\\web.go:22:46: cannot use http.StripPrefix(&quot;/assets/&quot;, http.FileServer(http.Dir(&quot;./assets&quot;))) (type http.Handler) as ty pe func(http.ResponseWriter, *http.Request) in argument to http.HandleFunc"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509830627, "post_id": 47115707, "comment_id": 81181404, "body": "My bad, change <code>http.HandleFunc</code> to <code>http.Handle</code> as in the updated answer."}, {"owner": {"user_type": "does_not_exist", "display_name": "user8733557"}, "edited": false, "score": 1, "creation_date": 1509830735, "post_id": 47115707, "comment_id": 81181444, "body": "Thanks for all of your help. This helped me a lot."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 2, "last_activity_date": 1509830595, "last_edit_date": 1509830595, "creation_date": 1509830088, "answer_id": 47115707, "question_id": 47115482, "link": "https://stackoverflow.com/questions/47115482/how-do-you-insert-an-image-into-a-html-golang-file/47115707#47115707", "title": "How do you insert an image into a HTML Golang file?", "body": "<p>First I recommend you put your image, css, js, and other assets into a separate folder than where your go app lives, a subfolder is fine as well, just keep them seprate from your go code.</p>\n\n<p>After you've done that you need to tell Go how and from where to serve these files.</p>\n\n<p>Here's an example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc index_handler(w http.ResponseWriter, r *http.Request) {\n    // MAIN SECTION HTML CODE\n    fmt.Fprintf(w, \"&lt;h1&gt;Whoa, Go is neat!&lt;/h1&gt;\")\n    fmt.Fprintf(w, \"&lt;title&gt;Go&lt;/title&gt;\")\n    fmt.Fprintf(w, \"&lt;img src='assets/gopher.jpeg' alt='gopher' style='width:235px;height:320px;'&gt;\")\n}\n\nfunc about_handler(w http.ResponseWriter, r *http.Request) {\n    // ABOUT SECTION HTML CODE\n    fmt.Fprintf(w, \"&lt;title&gt;Go/about/&lt;/title&gt;\")\n    fmt.Fprintf(w, \"Expert web design by JT Skrivanek\")\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", index_handler)\n    http.HandleFunc(\"/about/\", about_handler)\n    http.Handle(\"/assets/\", http.StripPrefix(\"/assets/\", http.FileServer(http.Dir(\"./assets\"))))\n    http.ListenAndServe(\":8000\", nil)\n}\n</code></pre>\n\n<p>This is assuming that your project structure looks like this:</p>\n\n<pre><code>\u2514\u2500\u2500 app\n    \u251c\u2500\u2500 assets\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 gopher.jpeg\n    \u2514\u2500\u2500 main.go\n</code></pre>\n\n<p>and that you've launched your app from the inside the <code>app</code> folder.</p>\n\n<p>Please also note that you then have to also change the HTML image link to reflect the change. E.g.; instead of <code>&lt;img src='gopher.jpeg' ...</code> you have <code>&lt;img src='assets/gopher.jpeg' ...</code></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8733557"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3773, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1509830595, "creation_date": 1509828480, "last_edit_date": 1509830572, "question_id": 47115482, "link": "https://stackoverflow.com/questions/47115482/how-do-you-insert-an-image-into-a-html-golang-file", "title": "How do you insert an image into a HTML Golang file?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc index_handler(w http.ResponseWriter, r *http.Request) {\n    // MAIN SECTION HTML CODE\n    fmt.Fprintf(w, \"&lt;h1&gt;Whoa, Go is neat!&lt;/h1&gt;\")\n    fmt.Fprintf(w, \"&lt;title&gt;Go&lt;/title&gt;\")\n    fmt.Fprintf(w, \"&lt;img src='gopher.jpeg' alt='gopher' style='width:235px;height:320px;'&gt;\")\n}\n\nfunc about_handler(w http.ResponseWriter, r *http.Request) {\n    // ABOUT SECTION HTML CODE\n    fmt.Fprintf(w, \"&lt;title&gt;Go/about/&lt;/title&gt;\")\n    fmt.Fprintf(w, \"Expert web design by -\")\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", index_handler)\n    http.HandleFunc(\"/about/\", about_handler)\n    http.ListenAndServe(\":8000\", nil)\n}\n</code></pre>\n\n<p>In my code I try to put an image on the screen. All this does is use the alt. I have the jpeg file in the same directory as my code. Is there something that i have to add since I am using Go? Thanks for the help.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509822645, "post_id": 47114406, "comment_id": 81178881, "body": "Because <code>json.Unmarshal</code> unmarshals a json value only once, and given the structure of <code>bb</code>, <code>person</code> takes precendence according to the rules which <code>Unmarshal</code> follows, whatever they may be."}, {"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509822708, "post_id": 47114406, "comment_id": 81178895, "body": "I guess that&#39;s my question...what is the &quot;rule&quot; that applies here?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509823167, "post_id": 47114406, "comment_id": 81179048, "body": "<code>bb.person.Last</code> vs <code>bb.alias.Person.First</code>, one&#39;s closer to the root than the other? Just guessing."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1509858035, "post_id": 47114406, "comment_id": 81186530, "body": "Try to simplify construction with type aliases. Looks like finally on has 2 fields with the same tag <code>json:&quot;person&quot;</code>. And unmarshallee fills first."}], "owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1509821818, "creation_date": 1509821818, "question_id": 47114406, "link": "https://stackoverflow.com/questions/47114406/is-there-a-reason-why-bb-person-gets-filled-but-a-person-does-not", "title": "Is there a reason why bb.person gets filled but a.Person does not?", "body": "<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Person struct {\n    First string `json:\"name\"`\n}\n\ntype person struct {\n    Last string `json:\"name\"`\n}\n\ntype A struct {\n    *Person `json:\"person\"`\n}\n\nfunc (a *A) UnmarshalJSON(b []byte) error {\n    type alias A\n\n    bb := struct {\n        *person `json:\"person\"`\n        *alias      \n    }{\n        alias: (*alias)(a),\n    }\n\n    if err := json.Unmarshal(b, &amp;bb); err != nil {\n        return err\n    }\n\n    fmt.Printf(\"%+v\\n\", bb.person)\n\n    return nil\n}\n\nfunc main() {\n    b := []byte(`{\"person\": {\"name\": \"bob\"}}`)\n    a := &amp;A{}\n\n    if err := json.Unmarshal(b, a); err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Printf(\"%+v\\n\", a.Person)\n}\n</code></pre>\n\n<p>results in:</p>\n\n<pre><code>&amp;{Last:bob}\n&lt;nil&gt;\n</code></pre>\n\n<p>Why does bb.person and a.Person have the same struct tag but only bb.person gets filled in? I haven't been able to find the appropriate documentation but why does this happen and is it guaranteed to always happen?</p>\n\n<p><a href=\"https://play.golang.org/p/Fvo_hg3U6r\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Fvo_hg3U6r</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user776942"}, "edited": false, "score": 1, "creation_date": 1509821990, "post_id": 47114392, "comment_id": 81178664, "body": "can you provide a quick example of &quot;now I have 15 methods that get &quot;http.ResponseWriter&quot;&quot;? I&#39;m unsure what you are doing."}, {"owner": {"reputation": 31, "user_id": 7952466, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-tL9cticSLFA/AAAAAAAAAAI/AAAAAAAAABE/nnt_qazYMYk/photo.jpg?sz=128", "display_name": "Gilcan Machado", "link": "https://stackoverflow.com/users/7952466/gilcan-machado"}, "edited": false, "score": 0, "creation_date": 1509831371, "post_id": 47114392, "comment_id": 81181628, "body": "I&#39;ve edited the question to put an example."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 0, "last_activity_date": 1509836678, "last_edit_date": 1509836678, "creation_date": 1509836281, "answer_id": 47116454, "question_id": 47114392, "link": "https://stackoverflow.com/questions/47114392/avoid-type-repetition-of-http-responsewriter-etc-in-go-lang/47116454#47116454", "title": "Avoid type repetition of http.ResponseWriter etc in Go Lang", "body": "<p>This is how handlers are usually written in Go since they have to have that specific signature to be able to accept the two parameter values that you need to be able to handle a request.</p>\n\n<p>Now if you're intent on reducing the amount of typing you can certainly get around this. There are probably many ways how to do that but one that comes to mind would look something like this.</p>\n\n<pre><code>type H struct {\n    w http.ResponseWriter\n    r *http.Request\n}\n\ntype HF func(H)\n\nfunc (f HF) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n        f(H{w:w, r:r})\n}\n\nfunc (h H) newStudent() {\n    p := studentPage{Title:\"New Student\"}\n    t, _ := template.ParseFiles(\"new_student.html\")\n    t.Execute(h.w, p)\n}\n\nfunc (h H) newTeacher() {\n    p := teacherPage{Title:\"New Teacher\"}\n    t, _ := template.ParseFiles(\"new_teacher.html\")\n    t.Execute(h.w, p)\n\n}\n\nfunc (h H) newClass() {\n    p := classPage{Title:\"New Class\"}\n    t, _ := template.ParseFiles(\"new_class.html\")\n    t.Execute(h.w, p)\n}\n\n// ...\n\nhttp.Handle(\"/students\", HF(H.newStudent))\nhttp.Handle(\"/teachers\", HF(H.newTeacher))\nhttp.Handle(\"/classes\", HF(H.newClass))\n</code></pre>\n\n<hr>\n\n<p>Personally I wouldn't recommend to change your handlers from the standard ones because you may loose some clarity when you do that, for example other developers might be confused when reading your code and seeing a non-standard handler.</p>\n"}], "owner": {"reputation": 31, "user_id": 7952466, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-tL9cticSLFA/AAAAAAAAAAI/AAAAAAAAABE/nnt_qazYMYk/photo.jpg?sz=128", "display_name": "Gilcan Machado", "link": "https://stackoverflow.com/users/7952466/gilcan-machado"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 47116454, "answer_count": 1, "score": -1, "last_activity_date": 1509836678, "creation_date": 1509821715, "last_edit_date": 1509831352, "question_id": 47114392, "link": "https://stackoverflow.com/questions/47114392/avoid-type-repetition-of-http-responsewriter-etc-in-go-lang", "title": "Avoid type repetition of http.ResponseWriter etc in Go Lang", "body": "<p>I'm studying Go and started a small web application.</p>\n\n<p>Amazing. But I've already got the very basics.</p>\n\n<p>So, what do you think would be a good documentation source for Go web application for real?</p>\n\n<p>For example, now I have 15 methods that get \"http.ResponseWriter\" and etc as parameter (tons of repetition I mean).</p>\n\n<p>I guess there's a better way of doing that.</p>\n\n<p>But I don't want to start programming Go with the exact mindset (solutions) of other languages (Python, Ruby, Perl etc).</p>\n\n<p>Not because it's wrong but because it can be (I don't know, that's the point) a mistake.</p>\n\n<p>Here's an example:</p>\n\n<pre><code>func newStudentHandler(w http.ResponseWriter, r *http.Request) {\n    p := studentPage{Title:\"New Student\"}\n    t, _ := template.ParseFiles(\"new_student.html\")\n    t.Execute(w, p)\n}\n\nfunc newTeacherHandler(w http.ResponseWriter, r *http.Request) {\n    p := teacherPage{Title:\"New Teacher\"}\n    t, _ := template.ParseFiles(\"new_teacher.html\")\n    t.Execute(w, p)\n\n}\n\nfunc newClassHandler(w http.ResponseWriter, r *http.Request) {\n    p := classPage{Title:\"New Class\"}\n    t, _ := template.ParseFiles(\"new_class.html\")\n    t.Execute(w, p)\n}\n</code></pre>\n\n<p>[]s\nGio</p>\n"}, {"tags": ["sql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509819979, "post_id": 47113755, "comment_id": 81177975, "body": "are you using mysql?"}, {"owner": {"reputation": 37, "user_id": 6729835, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4d588e17cf2999875673201cbc65078d?s=128&d=identicon&r=PG&f=1", "display_name": "rocco", "link": "https://stackoverflow.com/users/6729835/rocco"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509821449, "post_id": 47113755, "comment_id": 81178470, "body": "Yes, I&#39;m using mysql"}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 1, "creation_date": 1509826510, "post_id": 47113755, "comment_id": 81180102, "body": "One of these tools should help you <a href=\"https://github.com/variadico/scaneo\" rel=\"nofollow noreferrer\">github.com/variadico/scaneo</a> or <a href=\"https://github.com/drone/sqlgen\" rel=\"nofollow noreferrer\">github.com/drone/sqlgen</a> but looks like they don&#39;t have support :("}, {"owner": {"reputation": 37, "user_id": 6729835, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4d588e17cf2999875673201cbc65078d?s=128&d=identicon&r=PG&f=1", "display_name": "rocco", "link": "https://stackoverflow.com/users/6729835/rocco"}, "reply_to_user": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1509835895, "post_id": 47113755, "comment_id": 81182771, "body": "@YandryPozo thanks for this tools, but i was looking for something simple. Anyway I will keep this repos in mind :)"}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 6729835, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4d588e17cf2999875673201cbc65078d?s=128&d=identicon&r=PG&f=1", "display_name": "rocco", "link": "https://stackoverflow.com/users/6729835/rocco"}, "edited": false, "score": 0, "creation_date": 1509835494, "post_id": 47114434, "comment_id": 81182662, "body": "Thanks a lot! I was thinking about solution like this."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1509821965, "creation_date": 1509821965, "answer_id": 47114434, "question_id": 47113755, "link": "https://stackoverflow.com/questions/47113755/how-to-dynamically-generate-sql-query-column-names-and-values-from-arrays/47114434#47114434", "title": "How to dynamically generate SQL query column names and values from arrays?", "body": "<p>I assume your code examples are just pseudo code but I'll state the obvious just in case.</p>\n\n<pre><code>db.Query(\"insert into views (?,?,?,?,?,?) values (?,?,?,?,?,?)\", colNames..., values...)\n</code></pre>\n\n<p>This is invalid Go since you can only \"unpack\" the last argument to a function, and also invalid MySQL since you cannot use placeholders (<code>?</code>) for column names.</p>\n\n<pre><code>db.Query(\"insert into views \" + colNames + \" values\" + values)\n</code></pre>\n\n<p>This is also invalid Go since you cannot concatenate strings with slices.</p>\n\n<hr>\n\n<p>You could fromat the slices into strings that look like this:</p>\n\n<pre><code>colNamesString := \"(col1, col2, col3)\"\nvaluesString   := \"(val1, val2, val3)\"\n</code></pre>\n\n<p>and now your second code example becomes valid Go and would compile <strong>but don't do this.</strong> If you do this your app becomes vulnerable to SQL injection and that's something you definitely don't want.</p>\n\n<hr>\n\n<p>Instead do something like this:</p>\n\n<pre><code>// this can be a package level global and you'll need\n// one for each table. Keep in mind that Go maps that\n// are only read from are safe for concurrent use.\nvar validColNames = map[string]bool{\n     \"col1\": true,\n     \"col2\": true,\n     \"col3\": true,\n     // ...\n}\n\n// ...\n\nvar colNames, values []string\nvar phs string // placeholders for values\n\nfor k, v := range formData {\n    // check that column is valid\n    if !validColNames[k] {\n        return ErrBadColName\n    }\n    colNames = append(colNames, k)\n    values = append(values, v)\n    phs += \"?,\"\n}\n\nif len(phs) &gt; 0 {\n    phs = phs[:len(phs)-1] // drop the last comma\n}\nphs = \"(\" + phs + \")\"\n\ncolNamesString := \"(\" + strings.Join(colNames, \",\") + \")\"\nquery := \"insert into views \" + colNamesString + phs\ndb.Query(query, values...)\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 6729835, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4d588e17cf2999875673201cbc65078d?s=128&d=identicon&r=PG&f=1", "display_name": "rocco", "link": "https://stackoverflow.com/users/6729835/rocco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 47114434, "answer_count": 1, "score": 2, "last_activity_date": 1509821965, "creation_date": 1509818083, "question_id": 47113755, "link": "https://stackoverflow.com/questions/47113755/how-to-dynamically-generate-sql-query-column-names-and-values-from-arrays", "title": "How to dynamically generate SQL query column names and values from arrays?", "body": "<p>I have about 20 columns in one row and not all columns are required to be filled in when row created also i dont want to cardcode name of every column in SQL query and on http.post request on frontend. All values are from form. My code:</p>\n\n<pre><code>var colNames, values []string\n\nfor k, v := range formData {\n    colNames = append(colNames, k)\n    values = append(values, v)\n}\n</code></pre>\n\n<p>Now i have 2 arrays: one with column names and second with values to be inserted. I want to do something like this:</p>\n\n<pre><code>db.Query(\"insert into views (?,?,?,?,?,?) values (?,?,?,?,?,?)\", colNames..., values...)\n</code></pre>\n\n<p>or like this:</p>\n\n<pre><code>db.Query(\"insert into views \" + colNames + \" values\" + values)\n</code></pre>\n\n<p>Any suggestions? \nThanks!</p>\n"}, {"tags": ["html", "regex", "go"], "comments": [{"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1509820883, "post_id": 47113752, "comment_id": 81178259, "body": "Without recursion or balanced constructs, you cannot handle it with a regex. Go regex has none. A dedicated parser seems to be the only way here."}], "answers": [{"tags": [], "owner": {"reputation": 588, "user_id": 6107031, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1d3E0.png?s=128&g=1", "display_name": "Armatorix", "link": "https://stackoverflow.com/users/6107031/armatorix"}, "is_accepted": true, "score": 0, "last_activity_date": 1509840146, "creation_date": 1509840146, "answer_id": 47116882, "question_id": 47113752, "link": "https://stackoverflow.com/questions/47113752/parent-and-child-regex-matches/47116882#47116882", "title": "Parent and Child Regex Matches", "body": "<p>As it was said in comment, build your parser.\nHere you've got examples (next answer), and some more resources:\n<a href=\"https://stackoverflow.com/a/8422952/6107031\">https://stackoverflow.com/a/8422952/6107031</a></p>\n"}], "owner": {"reputation": 5, "user_id": 8886378, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qcrMR.jpg?s=128&g=1", "display_name": "Zachary C.", "link": "https://stackoverflow.com/users/8886378/zachary-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 453, "favorite_count": 0, "accepted_answer_id": 47116882, "answer_count": 1, "score": 0, "last_activity_date": 1509840146, "creation_date": 1509818075, "question_id": 47113752, "link": "https://stackoverflow.com/questions/47113752/parent-and-child-regex-matches", "title": "Parent and Child Regex Matches", "body": "<p>Regex has always been a weaker point for me, so I need some help.</p>\n\n<p>I'm basically try to have opening and closing 'tags' with the same regex allowed on the inside of these tags.</p>\n\n<p>So a tag may look like:<br>\n<code>&lt;: tagname(\"[capture1]\",\"[capture2]\",\"[capture3]\") :>[inner code]&lt;: endtagname :></code></p>\n\n<p>So one with child tags may be like:<br>\n<code>&lt;: tagname(\"[capture1]\",\"[capture2]\",\"[capture3]\") :>This is a tag: &lt;: tagname(\"[capture1]\",\"[capture2]\",\"[capture3]\") :>[inner code]&lt;: endtagname :> that was a tag&lt;: endtagname :></code></p>\n\n<p>So I've tried a few regex codes, but cannot figure out how to get the parent tag not to end on the child tag.</p>\n\n<p>So here is one of the regex expressions that I've tried:<br>\n<code>&lt;:[ ]?date[ ]?[(][ ]?'\"['\"],[ ]?'\"['\"],[ ]?'\"['\"][)][ ]?:>([\\s\\S\\t\\r]*)&lt;:[ ]?enddate[ ]?:></code></p>\n\n<p>This works for single level tags, but not for parent/child tags.</p>\n\n<p>Any help is appreciated.</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 2, "creation_date": 1509817175, "post_id": 47113588, "comment_id": 81176999, "body": "Open a manual and read overview of a package: <a href=\"https://golang.org/pkg/math/rand/\" rel=\"nofollow noreferrer\">golang.org/pkg/math/rand</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1509817353, "post_id": 47113588, "comment_id": 81177067, "body": "<a href=\"https://golang.org/pkg/math/rand/#Seed\" rel=\"nofollow noreferrer\">golang.org/pkg/math/rand/#Seed</a>"}, {"owner": {"reputation": 856, "user_id": 7192584, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b90bdfe56364b6607ce3eb29df1ee166?s=128&d=identicon&r=PG&f=1", "display_name": "Daksh", "link": "https://stackoverflow.com/users/7192584/daksh"}, "edited": false, "score": 0, "creation_date": 1509817499, "post_id": 47113588, "comment_id": 81177129, "body": "Thanks for pointing out, It&#39;s the first time I&#39;ve encountered this."}], "answers": [{"tags": [], "owner": {"reputation": 9038, "user_id": 3552932, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2ae3a039bdc0348c262791d699c168d9?s=128&d=identicon&r=PG", "display_name": "mleko", "link": "https://stackoverflow.com/users/3552932/mleko"}, "is_accepted": true, "score": 1, "last_activity_date": 1509818370, "last_edit_date": 1592644375, "creation_date": 1509818370, "answer_id": 47113811, "question_id": 47113588, "link": "https://stackoverflow.com/questions/47113588/why-does-the-rand-intn-function-from-math-rand-package-generate-the-same-seque/47113811#47113811", "title": "Why does the rand.Intn() function from math/rand package generate the same sequence of random numbers everytime I run the program?", "body": "<p>From <a href=\"https://golang.org/pkg/math/rand/#Seed\" rel=\"nofollow noreferrer\">documentation</a></p>\n<blockquote>\n<p>Use the Seed function to initialize the default Source if different behavior is required for each run.</p>\n<p>If Seed is not called, the generator behaves as if seeded by Seed(1).</p>\n</blockquote>\n<p>By default you get same seed every run.</p>\n<p>You can use current time as seed to get less deterministic sequences.</p>\n<pre><code>rand.Seed(time.Now().UTC().UnixNano())\n</code></pre>\n"}], "owner": {"reputation": 856, "user_id": 7192584, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b90bdfe56364b6607ce3eb29df1ee166?s=128&d=identicon&r=PG&f=1", "display_name": "Daksh", "link": "https://stackoverflow.com/users/7192584/daksh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 341, "favorite_count": 0, "accepted_answer_id": 47113811, "answer_count": 1, "score": 0, "last_activity_date": 1509818370, "creation_date": 1509817091, "question_id": 47113588, "link": "https://stackoverflow.com/questions/47113588/why-does-the-rand-intn-function-from-math-rand-package-generate-the-same-seque", "title": "Why does the rand.Intn() function from math/rand package generate the same sequence of random numbers everytime I run the program?", "body": "<p>I used the <b>rand.Intn(n int)</b> function to swap elements inside a slice, but everytime I ran the program, the output was the same random sequence of elements inside slice.</p>\n\n<p>What obvious thing am I missing here ?</p>\n"}, {"tags": ["multithreading", "go", "max", "goroutine"], "comments": [{"owner": {"reputation": 387, "user_id": 8073929, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-nsE-c1UQ4hI/AAAAAAAAAAI/AAAAAAAAACs/OiPhaFhy33o/photo.jpg?sz=128", "display_name": "Minato", "link": "https://stackoverflow.com/users/8073929/minato"}, "edited": false, "score": 0, "creation_date": 1509957146, "post_id": 47113585, "comment_id": 81214904, "body": "I know, I&#39;ve solved my problem as follows, although the performance may be low. start := len / numThread for thread := 0; thread &lt; len - 1; thread++ {      go find(thread * start, (thread + 1) * start) }"}], "answers": [{"tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": false, "score": 0, "last_activity_date": 1509818219, "creation_date": 1509818219, "answer_id": 47113786, "question_id": 47113585, "link": "https://stackoverflow.com/questions/47113585/how-to-run-the-maximum-number-of-goroutines/47113786#47113786", "title": "How to run the maximum number of goroutines", "body": "<p>I know I've seen and read references on job scheduling strategies, but I can't find a good one right now. But you've got some basic options:</p>\n\n<ul>\n<li>Split your work up ahead of time into equal chunks.</li>\n<li>Pick a chunk size and issue chunks to threads until done.</li>\n<li>Work stealing: create threads, issue chunks, threads that finish early steal work from other threads.</li>\n</ul>\n\n<p>All of these work in Go. To find the number of real threads the Go runtime has available, look at <a href=\"https://golang.org/pkg/runtime/#GOMAXPROCS\" rel=\"nofollow noreferrer\">https://golang.org/pkg/runtime/#GOMAXPROCS</a></p>\n\n<p>Also, just from experience, channels are tempting. But for best performance don't send single work items in a channel. Send array / slices of work items in each message instead. Otherwise the channel's locking overhead can become more time consuming than the actual work.</p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 3, "last_activity_date": 1509893406, "last_edit_date": 1509893406, "creation_date": 1509820307, "answer_id": 47114154, "question_id": 47113585, "link": "https://stackoverflow.com/questions/47113585/how-to-run-the-maximum-number-of-goroutines/47114154#47114154", "title": "How to run the maximum number of goroutines", "body": "<p>Maximizing throughput is about getting rid of bottlenecks. First of all find where is most time is lost.</p>\n\n<p>Sometimes running too many goroutines doesn\u2019t make things faster but makes them slower, because goroutines start to compete for resources. Usually the fastest configuration is one that uses resources in the most effective way: if things are limited by computation then it's best to set the number of running goroutines equal to the number of CPU cores. But if it is limited by IO then choose the optimal number by measuring its performance. </p>\n\n<p>Find the main thing that is slowing down your program - then make it faster. </p>\n"}, {"tags": [], "owner": {"reputation": 15599, "user_id": 73831, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4813b578ef6e0ca5ba25a77f57fdb5f1?s=128&d=identicon&r=PG", "display_name": "Sudhir Jonathan", "link": "https://stackoverflow.com/users/73831/sudhir-jonathan"}, "is_accepted": false, "score": 0, "last_activity_date": 1509823043, "creation_date": 1509823043, "answer_id": 47114620, "question_id": 47113585, "link": "https://stackoverflow.com/questions/47113585/how-to-run-the-maximum-number-of-goroutines/47114620#47114620", "title": "How to run the maximum number of goroutines", "body": "<p>The best way I can think of would be a fixed size worker pool of goroutines, as described in <a href=\"https://gobyexample.com/worker-pools\" rel=\"nofollow noreferrer\">https://gobyexample.com/worker-pools</a></p>\n"}], "owner": {"reputation": 387, "user_id": 8073929, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-nsE-c1UQ4hI/AAAAAAAAAAI/AAAAAAAAACs/OiPhaFhy33o/photo.jpg?sz=128", "display_name": "Minato", "link": "https://stackoverflow.com/users/8073929/minato"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1909, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1594555636, "creation_date": 1509817070, "last_edit_date": 1594555636, "question_id": 47113585, "link": "https://stackoverflow.com/questions/47113585/how-to-run-the-maximum-number-of-goroutines", "title": "How to run the maximum number of goroutines", "body": "<p>The code is like this:</p>\n\n<pre><code>func find(start int, end int){\n    for i := start; i &lt; end ; i++ {\n        // Do something...\n    }\n}\n\nfunc main() {\n    // Do something...\n    // For example, I know: len = 1500\n    // and run max goroutine are 3\n    // will be\n    go find(0, 500)\n    go find(500, 1000)\n    go find(1000, 1500)\n    // Do something...\n}\n</code></pre>\n\n<p>That is when I know in advance the maximum threads of goroutines and the length of \"length\".\nBut if I do not know how many threads can run at goroutine, and the length of \"length\". Is there any way to divide \"length\" into equal sections for thread processing?\nFor example: length = 10, max goroutine that can run is 2 and it will split length into 2 threads (10/2, each length is 5) to be able to handle simultaneously.</p>\n"}, {"tags": ["go", "network-programming"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1509839561, "post_id": 47113540, "comment_id": 81183635, "body": "Are you constructing the <code>*tls.Conn</code> yourself? Or do you get it ready-made before you pass it on to the API?"}, {"owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509840743, "post_id": 47113540, "comment_id": 81183850, "body": "Constructing myself"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1509840874, "creation_date": 1509840874, "answer_id": 47116947, "question_id": 47113540, "link": "https://stackoverflow.com/questions/47113540/golang-client-tls-conn-close-hook/47116947#47116947", "title": "golang: client tls.Conn Close hook", "body": "<p>If you're using <a href=\"https://golang.org/pkg/crypto/tls/#Client\" rel=\"nofollow noreferrer\">tls.Client</a> to construct the <code>*tls.Conn</code> then you can wrap the first argument to achieve your goal.</p>\n\n<pre><code>type CloseListener struct {\n    net.Conn // embed the original conn\n}\n\nfunc (c *CloseListener) Close() error {\n    err := c.Conn.Close()\n    // ... do your stuff ...\n    return err\n}\n\nconn := tls.Client(&amp;CloseListener{c}, &amp;tls.Config{ /* ... */ }) \n</code></pre>\n\n<p>If you look at how <a href=\"https://github.com/golang/go/blob/master/src/crypto/tls/conn.go#L1190-L1224\" rel=\"nofollow noreferrer\">tls.Conn's Close</a> is implemented you'll see that it should call your Close implementation unless there was some error.</p>\n"}], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 1, "accepted_answer_id": 47116947, "answer_count": 1, "score": 1, "last_activity_date": 1509840874, "creation_date": 1509816819, "last_edit_date": 1509826989, "question_id": 47113540, "link": "https://stackoverflow.com/questions/47113540/golang-client-tls-conn-close-hook", "title": "golang: client tls.Conn Close hook", "body": "<p>I am interacting with an http client API which accepts a <a href=\"https://golang.org/pkg/crypto/tls/#Conn\" rel=\"nofollow noreferrer\"><code>*tls.Conn</code></a>. I cannot change the API. I want some code to be executed when the connection is closed, but I don't see a way to do this. If I create a struct which embeds a <code>*tls.Conn</code> and I \"override\" <code>Close()</code>, the API won't accept the struct because go only follows the sub-type is-a relationship with interfaces - <code>tls.Conn</code> is <strong>not</strong> an interface.</p>\n\n<p>Is there any way to get around this - is there some standard hook I can use to be notified when the client connection is closed?</p>\n"}, {"tags": ["go", "xml-parsing"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509807174, "post_id": 47111878, "comment_id": 81173845, "body": "did you check the error returned from <code>xml.Unmarshal</code>? If you do you&#39;ll see that you have a bunch of errors in your struct tags but also in your xml."}, {"owner": {"reputation": 21, "user_id": 8885559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b72a1a4ddbdf03a6f8239ccaf3d9e2e5?s=128&d=identicon&r=PG&f=1", "display_name": "CaptainFrance", "link": "https://stackoverflow.com/users/8885559/captainfrance"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1509807338, "post_id": 47111878, "comment_id": 81173884, "body": "yes i have no error returned"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1509807410, "post_id": 47111878, "comment_id": 81173899, "body": "Are you sure about that? I&#39;ve copied your example code and there are a bunch of errors, all returned from <code>xml.Unmarshal</code>. After fixing them, the startedAt is unmarshaled correctly."}, {"owner": {"reputation": 21, "user_id": 8885559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b72a1a4ddbdf03a6f8239ccaf3d9e2e5?s=128&d=identicon&r=PG&f=1", "display_name": "CaptainFrance", "link": "https://stackoverflow.com/users/8885559/captainfrance"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1509808619, "post_id": 47111878, "comment_id": 81174251, "body": "thanks mkopriva, sorry when i said i have no error it&#39;s when i do the &quot;go build&quot;. I got some errors from Unmarshal returns ;)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1509817590, "post_id": 47111878, "comment_id": 81177158, "body": "It works fine on the <a href=\"https://play.golang.org/p/h-lq9dQeTV\" rel=\"nofollow noreferrer\">Playground</a>, once the struct tags are corrected and the XML file contents are well-formed. (Tip: you don&#39;t need to use <code>Label []label `xml:&quot;label&quot;`</code> and <code>XMLName xml.Name `xml:&quot;label&quot;`</code>. Pick one or the other. Copying your code above into the Playground results in an issue with the element name <code>lastUpdate</code> not matching the element name <code>lastupdate</code> in two different struct tags because of this.)"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 1, "creation_date": 1509817381, "post_id": 47113263, "comment_id": 81177076, "body": "There&#39;s nothing wrong with defining <code>StartedAt</code> as a string. Once the various errors are resolved, both in the XML data and the struct tags, it works fine. <a href=\"https://play.golang.org/p/h-lq9dQeTV\" rel=\"nofollow noreferrer\">Playground</a>"}, {"owner": {"reputation": 21, "user_id": 8885559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b72a1a4ddbdf03a6f8239ccaf3d9e2e5?s=128&d=identicon&r=PG&f=1", "display_name": "CaptainFrance", "link": "https://stackoverflow.com/users/8885559/captainfrance"}, "edited": false, "score": 0, "creation_date": 1509830520, "post_id": 47113263, "comment_id": 81181370, "body": "Thanks for your help. The problems comes from my XML file which was wrong. As said @mkopriva, my xml file is malformed, so i have to check the return of Unmarshal. My code works !!!! There is no problem :)"}], "tags": [], "owner": {"reputation": 790, "user_id": 6061721, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-McuUUypxZX8/AAAAAAAAAAI/AAAAAAAAABk/GgDkjrgVm0k/photo.jpg?sz=128", "display_name": "Libby", "link": "https://stackoverflow.com/users/6061721/libby"}, "is_accepted": false, "score": 0, "last_activity_date": 1509815114, "creation_date": 1509815114, "answer_id": 47113263, "question_id": 47111878, "link": "https://stackoverflow.com/questions/47111878/go-parsing-xml-file/47113263#47113263", "title": "Go parsing XML file", "body": "<p>It looks like you need to define <code>StartedAt</code> as more than just a string. <a href=\"https://stackoverflow.com/questions/38063179/xml-parsing-golang#38087733\">Take a look at this question and example</a>. You need to define <code>StartedAt</code> as it's own struct so you can access it's <code>innerxml</code> string.</p>\n\n<pre><code>type StartedAt struct {\n   Raw  string `xml:\",innerxml\"`\n}\n\ntype alert struct {\n   XMLName xml.Name `xml:\"alert\"`\n   Type             string     `xml:\"type,attr\"`\n   Identifier       string     `xml:\"identifier,attr\"`\n   DeclaredBy       string     `xml:\"declaredBy,attr\"`\n   StartedAt        StartedAt  `xml:\"startedAt\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 8885559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b72a1a4ddbdf03a6f8239ccaf3d9e2e5?s=128&d=identicon&r=PG&f=1", "display_name": "CaptainFrance", "link": "https://stackoverflow.com/users/8885559/captainfrance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 946, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1509815114, "creation_date": 1509806416, "question_id": 47111878, "link": "https://stackoverflow.com/questions/47111878/go-parsing-xml-file", "title": "Go parsing XML file", "body": "<p>i would like to parse a xml file and print values.</p>\n\n<pre><code>&lt;alerts time=\"2017-09-14T15:46:00+02:00\"&gt;\n  &lt;alert type=\"A\" identifier=\"123\" declaredBy=\"Bob\" /&gt;\n    &lt;startedAt&gt;20171010212210&lt;/startedAt&gt;\n    &lt;lastUpdate bySource=\"X\"&gt;\n      &lt;updatedAt&gt;20171010213655&lt;/updatedAt&gt;\n      &lt;eventConfirmation&gt;unconfirmed&lt;/eventConfirmation&gt;\n      &lt;additional&gt;\n        &lt;data name=\"numberOfOccurences\"&gt;1&lt;/data&gt;\n      &lt;/additional&gt;\n    &lt;/lastUpdate&gt;\n    &lt;labels&gt;\n      &lt;label language=\"FR\"&gt;attaque DNS&lt;/Label&gt;\n    &lt;/labels&gt;\n  &lt;/alert&gt;\n&lt;/alerts&gt;\n</code></pre>\n\n<p>in this example i have just one alert but i can have more. I wrote 2 packages</p>\n\n<pre><code>package alerts\n\nimport \"encoding/xml\"\n\n// Alert structure\ntype Alerts struct {\n    XMLName  xml.Name `xml:\"alerts\"`\n    Time     string   `xml:\"time,attr\"`\n    Alert    []alert  `xml:\"alert\"`\n}\n\ntype lastUpdate struct {\n    XMLName           xml.Name   `xml:\"lastUpdate\"`\n    BySource          string     `xml:\"bySource,attr\"`\n    UpdatedAt         string     `xml:\"updatedAt\"`\n    EventConfirmation string     `xml:\"eventConfirmation\"`\n    Additional        additional `xml:\"additional\"`\n}\n\ntype additional struct {\n    XMLName xml.Name `xml:\"additional\"`\n    Data    data     `xml:\"data\"`\n}\n\ntype data struct {\n    XMLName            xml.Name `xml:\"data\"`\n    NumberOfOccurences int      `xml:\"numberOfOccurences,attr\"`\n}\n\ntype labels struct {\n    XMLName xml.Name `xml:\"labels\"`\n    Label   []label  `xml:\"label\"`\n}\n\ntype label struct {\n    XMLName       xml.Name `xml:\"label\"`\n    Label         string   `xml:\"label\"`\n    LabelLanguage string   `xml:\"language,attr\"`\n}\n\ntype alert struct {\n    XMLName xml.Name `xml:\"alert\"`\n    Type             string     `xml:\"type,attr\"`\n    Identifier       string     `xml:\"identifier,attr\"`\n    DeclaredBy       string     `xml:\"declaredBy,attr\"`\n    StartedAt        string     `xml:\"startedAt\"`\n    Lastupdate       lastUpdate `xml:\"lastupdate\"`\n    Labels           labels     `xml:\"label\"`\n}\n</code></pre>\n\n<p>my second package</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n\n    \"github.com/user/xmlparser/alert\"\n    \"github.com/golang/glog\"\n)\n\nfunc main() {\n\n    //open XML file given in argument\n    xmlfile, err := os.Open(os.Args[1])\n    if err != nil {\n        glog.Fatalf(\"opening file %s - error : %s\", os.Args[1], err)\n    }\n\n    defer xmlfile.Close()\n\n    // read our opened xmlFile as a byte array.\n    byteValue, _ := ioutil.ReadAll(xmlfile)\n\n    // we initialize our alerts array\n    var al alerts.Alerts\n\n    // we unmarshal our byteArray which contains our\n    // xmlFiles content into 'al' which we defined above\n    xml.Unmarshal(byteValue, &amp;al)\n\n    for i := 0; i &lt; len(al.Alert); i++ {\n        fmt.Printf(\"Alert time : %s\\n\\n\", al.Time)\n\n        fmt.Println(\"Type: \" + al.Alert[i].Type)\n        fmt.Println(\"Identifier: \" + al.Alert[i].Identifier)\n        fmt.Println(\"declaredBy: \" + al.Alert[i].DeclaredBy)\n\n        fmt.Printf(\"startAt: %s\\n\", al.Alert[i].StartedAt)\n    }\n}\n</code></pre>\n\n<p>I can print Time, Type, Identifier and DeclaredBy but the variable StartedAt is empty. There is something that i don't understand. I think that my structure is not correctly defined.\nIf someone can help me ... Thanks !!!</p>\n"}, {"tags": ["c#", "go", "protocol-buffers"], "comments": [{"owner": {"reputation": 921791, "user_id": 23354, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/CrVFH.png?s=128&g=1", "display_name": "Marc Gravell", "link": "https://stackoverflow.com/users/23354/marc-gravell"}, "edited": false, "score": 0, "creation_date": 1509821108, "post_id": 47111679, "comment_id": 81178343, "body": "Are you using the binary layout? Or the json layout? It sounds like the binary, but the examples at the bottom are json. Is the data accidentally padded? If it is binary, does it work OK at <a href=\"https://protogen.marcgravell.com/decode\" rel=\"nofollow noreferrer\">protogen.marcgravell.com/decode</a> ? (you can use that page to verify binary from files, hex, or base-64) - note my hunch here is padding after the payload"}, {"owner": {"reputation": 23, "user_id": 8314409, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31e3e9aec2197cfea5e94f7b35ee0fa7?s=128&d=identicon&r=PG&f=1", "display_name": "Reza", "link": "https://stackoverflow.com/users/8314409/reza"}, "reply_to_user": {"reputation": 921791, "user_id": 23354, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/CrVFH.png?s=128&g=1", "display_name": "Marc Gravell", "link": "https://stackoverflow.com/users/23354/marc-gravell"}, "edited": false, "score": 0, "creation_date": 1509874294, "post_id": 47111679, "comment_id": 81189829, "body": "I send data like this from c#   <code>PRSData data = ... portobyf ; byte[] buf = ((Imessage)data).ToByteArray();</code>"}, {"owner": {"reputation": 921791, "user_id": 23354, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/CrVFH.png?s=128&g=1", "display_name": "Marc Gravell", "link": "https://stackoverflow.com/users/23354/marc-gravell"}, "edited": false, "score": 0, "creation_date": 1509874606, "post_id": 47111679, "comment_id": 81189894, "body": "great; now, if you take the hex, base-64 or file version of that and run it through /decode, it will tell you if the data is malformed. Knowledge of whether it is malformed or not is the first thing to get. However, in your golang code it isn&#39;t obvious how you get <code>m</code>, and in the c# code it isn&#39;t obvious what you do with <code>buf</code>, so it is also entirely possible that you&#39;re accidentally padding during transfer. Heck, a really simple test you can do: compare the length of <code>buf</code> with the length of <code>m</code>. If they aren&#39;t the same: fix it. Then check the <b>contents</b>."}, {"owner": {"reputation": 921791, "user_id": 23354, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/CrVFH.png?s=128&g=1", "display_name": "Marc Gravell", "link": "https://stackoverflow.com/users/23354/marc-gravell"}, "edited": false, "score": 0, "creation_date": 1509874659, "post_id": 47111679, "comment_id": 81189904, "body": "Ultimately, until you have checked that you received the right data (i.e. do <code>m</code> and <code>buf</code> contain exactly the same bytes), all bets are off."}, {"owner": {"reputation": 23, "user_id": 8314409, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31e3e9aec2197cfea5e94f7b35ee0fa7?s=128&d=identicon&r=PG&f=1", "display_name": "Reza", "link": "https://stackoverflow.com/users/8314409/reza"}, "reply_to_user": {"reputation": 921791, "user_id": 23354, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/CrVFH.png?s=128&g=1", "display_name": "Marc Gravell", "link": "https://stackoverflow.com/users/23354/marc-gravell"}, "edited": false, "score": 0, "creation_date": 1509883233, "post_id": 47111679, "comment_id": 81192221, "body": "Yes, you&#39;re right. the length of byte in c# is 1024 but in golang is 56.  In the code below the variable <b>size</b> is 56 bytes but in this line <b>m = (byte[])ar.AsyncState;</b> becomes 1024 bytes  &#39; int size = sckCommunication.EndReceiveFrom(ar, ref epRemote);              if (size &gt; 0)             {                                    // used to help us on getting the data                 byte[] m = new byte[numberBytes];                  // gets the data                 m = (byte[])ar.AsyncState;       } `"}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 8314409, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31e3e9aec2197cfea5e94f7b35ee0fa7?s=128&d=identicon&r=PG&f=1", "display_name": "Reza", "link": "https://stackoverflow.com/users/8314409/reza"}, "edited": false, "score": 0, "creation_date": 1509891864, "post_id": 47121403, "comment_id": 81194920, "body": "Thanks The problem solved I modified the line byte[] m = new byte[numberBytes]; to byte[] m = new byte[size];"}], "tags": [], "owner": {"reputation": 921791, "user_id": 23354, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/CrVFH.png?s=128&g=1", "display_name": "Marc Gravell", "link": "https://stackoverflow.com/users/23354/marc-gravell"}, "is_accepted": true, "score": 0, "last_activity_date": 1509883933, "creation_date": 1509883933, "answer_id": 47121403, "question_id": 47111679, "link": "https://stackoverflow.com/questions/47111679/googles-protobuf-from-golang-to-c-protocol-message-contained-an-invalid-tag/47121403#47121403", "title": "google&#39;s protobuf from golang to c# - Protocol message contained an invalid tag (zero)", "body": "<p>When reading from a socket into a buffer, you need to ensure that you correctly track <em>how much data you have</em>. In your example (comments), this is <code>size</code>, you you must make sure that any processing is restricted to that many bytes. Since you are using <code>MemoryStream</code>, you will note that there is a constructor that accepts the buffer and an offset (zero) and count (<code>size</code>).</p>\n\n<p>Note that if you are dealing with multiple messages on a single socket, you will also need to handle \"framing\" - TCP does not guarantee to receive data in the same chunks in which it was sent - just the same bytes in the same order.</p>\n"}], "owner": {"reputation": 23, "user_id": 8314409, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/31e3e9aec2197cfea5e94f7b35ee0fa7?s=128&d=identicon&r=PG&f=1", "display_name": "Reza", "link": "https://stackoverflow.com/users/8314409/reza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 558, "favorite_count": 1, "accepted_answer_id": 47121403, "answer_count": 1, "score": 2, "last_activity_date": 1509883933, "creation_date": 1509805081, "last_edit_date": 1509805909, "question_id": 47111679, "link": "https://stackoverflow.com/questions/47111679/googles-protobuf-from-golang-to-c-protocol-message-contained-an-invalid-tag", "title": "google&#39;s protobuf from golang to c# - Protocol message contained an invalid tag (zero)", "body": "<p>I don't have problem when i send a byte packet from c# to Golang using protobuf. But when i send a byte from Golang to c# get error.</p>\n\n<p>I use this code in c# to get protobuf sent by golang:</p>\n\n<pre><code> Stream stream = new MemoryStream(m);\n        PRSData data;\n        data = PRSData.Parser.ParseFrom(stream);\n        print(data);\n</code></pre>\n\n<p>Then i get this error in c#:</p>\n\n<blockquote>\n  <p>InvalidProtocolBufferException: Protocol message contained an invalid\n  tag (zero). Google.Protobuf.CodedInputStream.ReadTag ()</p>\n</blockquote>\n\n<p>Also the structure of protobuf that c# generates is right but the golang's one is incorrect</p>\n\n<p>The protobuf structure generated by c# is:</p>\n\n<pre><code>{ \"action\": \"move\", \"id\": \"player_361\", \"room\": \"SyONuNo0W\", \"pos\": { \"x\": 74.423, \"y\": -0.04, \"z\": 10.903 } }\n</code></pre>\n\n<p>The protobuf structure generated by golang is:</p>\n\n<pre><code>action:\"move\" id:\"player_361\" room:\"SyONuNo0W\" pos:&lt;x:74.423 y:-0.04 z:10.903 &gt;\n</code></pre>\n\n<p>Please help me working with protobuf in c# and Golang and truly conversions between them.</p>\n"}, {"tags": ["arrays", "go"], "answers": [{"tags": [], "owner": {"reputation": 2337, "user_id": 3827850, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/rCU6z.jpg?s=128&g=1", "display_name": "Ezio", "link": "https://stackoverflow.com/users/3827850/ezio"}, "is_accepted": true, "score": 6, "last_activity_date": 1509799158, "creation_date": 1509799158, "answer_id": 47110829, "question_id": 47110798, "link": "https://stackoverflow.com/questions/47110798/how-do-i-create-an-array-that-can-hold-multiple-data-types-in-golang/47110829#47110829", "title": "How do i create an array that can hold multiple data types in GoLang?", "body": "<p>You can do something like this \n<code>mixedArray := []interface{}{\"astring\", 10, &amp;Object{'hello'}}</code></p>\n\n<p>Most likely the values that you want to hold share some behavior, in that case what you should really do is create an interface and simply make the array content type that interface.</p>\n"}], "owner": {"reputation": 856, "user_id": 7192584, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b90bdfe56364b6607ce3eb29df1ee166?s=128&d=identicon&r=PG&f=1", "display_name": "Daksh", "link": "https://stackoverflow.com/users/7192584/daksh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1112, "favorite_count": 0, "accepted_answer_id": 47110829, "answer_count": 1, "score": 3, "last_activity_date": 1509799158, "creation_date": 1509798987, "question_id": 47110798, "link": "https://stackoverflow.com/questions/47110798/how-do-i-create-an-array-that-can-hold-multiple-data-types-in-golang", "title": "How do i create an array that can hold multiple data types in GoLang?", "body": "<p>While declaring an array or a slice I'm required to specify the <i>type</i> of data that I want to store in the array or list.</p>\n\n<p>How do I make an array that can hold data of multiple <i>types</i> ?</p>\n"}]