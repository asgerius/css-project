[{"tags": ["c", "go", "memory", "indexing", "malloc"], "comments": [{"owner": {"reputation": 12243, "user_id": 2192494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddd4f75b6e9293967ba3c81f89edd68a?s=128&d=identicon&r=PG", "display_name": "Lee Daniel Crocker", "link": "https://stackoverflow.com/users/2192494/lee-daniel-crocker"}, "edited": false, "score": 0, "creation_date": 1523490272, "post_id": 49785854, "comment_id": 86587234, "body": "So which line is it telling you has the error? Have you stepped through there with a debugger to see what the values are?"}, {"owner": {"reputation": 366, "user_id": 5228646, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/6Vc3O.png?s=128&g=1", "display_name": "JeanP", "link": "https://stackoverflow.com/users/5228646/jeanp"}, "reply_to_user": {"reputation": 12243, "user_id": 2192494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddd4f75b6e9293967ba3c81f89edd68a?s=128&d=identicon&r=PG", "display_name": "Lee Daniel Crocker", "link": "https://stackoverflow.com/users/2192494/lee-daniel-crocker"}, "edited": false, "score": 0, "creation_date": 1523490715, "post_id": 49785854, "comment_id": 86587337, "body": "Ill update the original with the lines. I thought i did but i guess I overlooked it."}, {"owner": {"reputation": 12243, "user_id": 2192494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ddd4f75b6e9293967ba3c81f89edd68a?s=128&d=identicon&r=PG", "display_name": "Lee Daniel Crocker", "link": "https://stackoverflow.com/users/2192494/lee-daniel-crocker"}, "edited": false, "score": 0, "creation_date": 1523491514, "post_id": 49785854, "comment_id": 86587535, "body": "Yeah, row_ptr is length 0. Also, it has no values in it when you read from it."}, {"owner": {"reputation": 2137, "user_id": 1212725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/152c2f757fe98760a1cca54a21f63a31?s=128&d=identicon&r=PG", "display_name": "bruceg", "link": "https://stackoverflow.com/users/1212725/bruceg"}, "edited": false, "score": 0, "creation_date": 1523493968, "post_id": 49785854, "comment_id": 86588011, "body": "you should probably be using a for loop with the range option for your golang code.  Something like this <code>for i, mcap := range y {</code>"}], "answers": [{"comments": [{"owner": {"reputation": 366, "user_id": 5228646, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/6Vc3O.png?s=128&g=1", "display_name": "JeanP", "link": "https://stackoverflow.com/users/5228646/jeanp"}, "edited": false, "score": 0, "creation_date": 1523546161, "post_id": 49787505, "comment_id": 86615087, "body": "This doesn&#39;t really help since im just using the dense matrix format thats all. I created the MVP functions myself."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 366, "user_id": 5228646, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/6Vc3O.png?s=128&g=1", "display_name": "JeanP", "link": "https://stackoverflow.com/users/5228646/jeanp"}, "edited": false, "score": 0, "creation_date": 1523559721, "post_id": 49787505, "comment_id": 86622752, "body": "@JeanP:  Some people are not going to look at problems with obsolete packages."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1523503690, "creation_date": 1523503690, "answer_id": 49787505, "question_id": 49785854, "link": "https://stackoverflow.com/questions/49785854/translating-c-to-golang-how-do-i-allocate-memory-to-match-c/49787505#49787505", "title": "Translating C to Golang. How do I allocate memory to match C?", "body": "<p>You are using <code>github.com/gonum/matrix/mat64</code>. It's obsolete:</p>\n\n<blockquote>\n  <p><a href=\"https://github.com/gonum/matrix/\" rel=\"nofollow noreferrer\">https://github.com/gonum/matrix/</a></p>\n  \n  <p>Gonum Matrix</p>\n  \n  <p>This repository is no longer maintained. Development has moved to\n  <a href=\"https://github.com/gonum/gonum\" rel=\"nofollow noreferrer\">https://github.com/gonum/gonum</a>.</p>\n</blockquote>\n"}], "owner": {"reputation": 366, "user_id": 5228646, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/6Vc3O.png?s=128&g=1", "display_name": "JeanP", "link": "https://stackoverflow.com/users/5228646/jeanp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 249, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1523503690, "creation_date": 1523489667, "last_edit_date": 1523490832, "question_id": 49785854, "link": "https://stackoverflow.com/questions/49785854/translating-c-to-golang-how-do-i-allocate-memory-to-match-c", "title": "Translating C to Golang. How do I allocate memory to match C?", "body": "<p>So I am in the process of translating a program I created in C. The goal of this program is to simply read a Matrix from a file, Compress the matrix in sparse row format, then calculate the matrix-vector product.</p>\n\n<p>Here is a snippet of the program in C.</p>\n\n<pre><code>//Read the MatrixMarket file and initialize a CSR formatted matrix.\ncsr_load_matrix(fileName, &amp;compressedSparseMatrix);\n//Set the correct values to the struct and create the memory allocation.\ndouble *x;\ndouble *y;\n\nx = malloc(compressedSparseMatrix.cols * sizeof(double));\ny = malloc(compressedSparseMatrix.rows * sizeof(double));\n\n//initialize the vector x\nfor(int i = 0; i &lt; compressedSparseMatrix.cols; i++){\n    x[i]= i+1;\n}\n\n//Calculate how long it takes to find the Matrix-Vector Product for the CSR Matrix.\n//Start the timer.\nclock_t begin = clock();\nfor (int i = 0; i &lt; iterations; i++) {\n    csrMVP(&amp;compressedSparseMatrix, x, y);\n}\nclock_t end = clock();\ndouble totalTimeSpent = (double) (end - begin) / CLOCKS_PER_SEC;\n</code></pre>\n\n<p>This is my Main.c and my csrMVP function is attached below:</p>\n\n<pre><code>int csrMVP(CSR_Matrix *funcMatrix, double *x, double *y){\n    unsigned int i, j;\n    unsigned int k = 0;\n    double *value = funcMatrix-&gt;val;\n    unsigned int *column = funcMatrix-&gt;col;\n    unsigned int *rowPointer = funcMatrix-&gt;ptr;\n    double hold;\n    for(i = 0; i &lt; funcMatrix-&gt;rows; i++){\n        hold = 0.0;\n        j = k;\n        k = rowPointer[i+1];\n        for(j; j &lt; k; j++){\n            y[i] = y[i] + value[j] * x[i];\n        }\n\n    }\n}\n</code></pre>\n\n<p>My program runs perfectly in C. The idea here is that I want to calculate the MVP 1000 times and see how fast/slow my compiler can do it.</p>\n\n<p>So now My next goal is to use concurrency in GoLang to compare how fast Golang can execute the MVP process 1000 times.</p>\n\n<p>Here is the start of my Golang program: (for the sake of space pretend <code>[]float64{...}</code> is a big matrix.)</p>\n\n<pre><code>func main(){\n    var interation int\n\n    m := mat64.NewDense(32, 32, []float64{...})\n\n    //csr_print_matrix(m)\n    //m.CSRPrint()\n\n    //var y []float64\n    y := make([]float64, 32)\n    x := make([]int, 32)\n    for i := range x {\n        x[i] = i + 1\n    }\n\n    interation = 2\n    start := time.Now()\n    for i := 0; i &lt; interation; i ++ {\n        m.CSRMVP(x, y)\n    }\n    elapsed := time.Since(start)\n    log.Printf(\"Matrix took %s\", elapsed)\n\n\n}\n</code></pre>\n\n<p>And my m.CSRMVP() func is:</p>\n\n<pre><code>func (m *Dense) CSRMVP(x []int, y []float64){\n    fmt.Println(\"Value of Y:\")\n    var j,end, newY int\n    var values []float64\n    var col_indices, row_ptr []int\n    values = m.mat.Data\n    end = 0\n\n    for i := 0; i &lt; m.capCols; i++{\n        y[i] = 0.0\n        newY = int(y[i])\n        j = end\n        end = row_ptr[i+1]\n        for ; j &lt; end; j++ {\n            newY = newY + int(values[j]) * x[col_indices[j]]\n            fmt.Print(newY)\n            y[i] = float64(newY)\n        }\n    }\n}\n</code></pre>\n\n<p>The issue appears to be a memory allocation problem with passing variables x and y.</p>\n\n<p>This is the output of my program running MVP just once.</p>\n\n<pre><code>panic: runtime error: index out of range\n\ngoroutine 1 [running]:\ngithub.com/gonum/matrix/mat64.(*Dense).CSRMVP(0xc42001e100, 0xc420055d50, 0x20, 0x20, 0xc420055e50, 0x20, 0x20)\n    /Users/jeanmac/go/src/github.com/gonum/matrix/mat64/dense.go:573 +0x215\nmain.main()\n    /Users/jeanmac/go/src/matrices/main.go:75 +0x16c\n</code></pre>\n\n<p>I am still learning Go as I go along. My goal was just to see what's faster. I believe my error is due to incorrect memory allocation for x and y. in C I call Malloc to create the memory I need for these variables and im not sure what the alternative is for Go.</p>\n\n<p>Line 573 in dense.go corresponding: \n<code>end = row_ptr[i+1]</code>\nLine 75 in main.go corresponding:\n<code>m.CSRMVP(x, y)</code> </p>\n"}, {"tags": ["postgresql", "go", "gorp"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523487800, "post_id": 49785569, "comment_id": 86586622, "body": "Can you add the code for Dbmap.Insert, please?"}, {"owner": {"reputation": 213, "user_id": 5188702, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/86edd035a7a436b0b6c815dd86ad81b7?s=128&d=identicon&r=PG&f=1", "display_name": "Errorum", "link": "https://stackoverflow.com/users/5188702/errorum"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523488216, "post_id": 49785569, "comment_id": 86586728, "body": "That&#39;s been part of the difficulty for me is finding anything about that.  From the <a href=\"https://godoc.org/github.com/coopernurse/gorp#DbMap.Insert\" rel=\"nofollow noreferrer\">Gorp docs</a>: Insert runs a SQL INSERT statement for each element in list. List items must be pointers."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523488785, "post_id": 49785569, "comment_id": 86586869, "body": "Since the error message says &quot;Scan error&quot; it is likely that not the INSERT itself is the problem. My first guess would be the &quot;last insert if&quot; thing. If memory serves, Postgres doesn&#39;t support that, so it makes sense that this would be nil. But I would also expect NullInt* to work then."}, {"owner": {"reputation": 213, "user_id": 5188702, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/86edd035a7a436b0b6c815dd86ad81b7?s=128&d=identicon&r=PG&f=1", "display_name": "Errorum", "link": "https://stackoverflow.com/users/5188702/errorum"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523489852, "post_id": 49785569, "comment_id": 86587143, "body": "It&#39;s looking like this might be a problem with an older version of Gorp.  I was using the coopernurse repo which is deprecated.  Updating now replaces all the scan errors with <code>column &quot;Guid&quot; of relation &quot;devices&quot; does not exist</code>... which is still frustrating but less cryptic."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1523490017, "post_id": 49785569, "comment_id": 86587172, "body": "Column names are case sensitive. Add explicit <code>db</code> tags."}, {"owner": {"reputation": 213, "user_id": 5188702, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/86edd035a7a436b0b6c815dd86ad81b7?s=128&d=identicon&r=PG&f=1", "display_name": "Errorum", "link": "https://stackoverflow.com/users/5188702/errorum"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523491125, "post_id": 49785569, "comment_id": 86587439, "body": "@Peter what are explicit db tags?  I&#39;ve been pretty careful with cases."}], "answers": [{"tags": [], "owner": {"reputation": 213, "user_id": 5188702, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/86edd035a7a436b0b6c815dd86ad81b7?s=128&d=identicon&r=PG&f=1", "display_name": "Errorum", "link": "https://stackoverflow.com/users/5188702/errorum"}, "is_accepted": true, "score": 0, "last_activity_date": 1523663601, "creation_date": 1523663601, "answer_id": 49826531, "question_id": 49785569, "link": "https://stackoverflow.com/questions/49785569/go-and-postgres-reinterpreting-integer-as-nil-type/49826531#49826531", "title": "Go and postgres reinterpreting integer as nil type", "body": "<p>The answer came down to case sensitivity interaction between Go and postgres.  Peter's comment essentially answers the question, but anyone reading this might want more explanation.  Go only exports objects that are capitalized, while postgres defaults to interpreting column names as lower case.  So I needed structs that were uppercase mapped to lowercase columns (unless I wanted to go through quoting every single uppercase column name).  To do this, use tags in your struct, essentially telling Go to call it one thing, while postgres calls it another.  Your new structs should looks like this:</p>\n\n<pre><code>type Device struct {\n        ID   int64 `db:\"id\"`\n        Guid string `db:\"guid\"`\n        Name string `db:\"name\"`\n}\n</code></pre>\n\n<p>Now just keep everything lowercase in postgres and you'll be set!</p>\n"}], "owner": {"reputation": 213, "user_id": 5188702, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/86edd035a7a436b0b6c815dd86ad81b7?s=128&d=identicon&r=PG&f=1", "display_name": "Errorum", "link": "https://stackoverflow.com/users/5188702/errorum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 418, "favorite_count": 0, "accepted_answer_id": 49826531, "answer_count": 1, "score": 1, "last_activity_date": 1523663601, "creation_date": 1523487560, "last_edit_date": 1523491611, "question_id": 49785569, "link": "https://stackoverflow.com/questions/49785569/go-and-postgres-reinterpreting-integer-as-nil-type", "title": "Go and postgres reinterpreting integer as nil type", "body": "<p>I'm trying to get some old code to pass its unit tests.  The test that's giving me problems is here:</p>\n\n<pre><code>func Test1(t *testing.T){\n //Code\n        testDevice := Device{\n                                 ID: 1,\n                                 Guid: \"C6\",\n                                 Name: \"test device\",\n                            }  \n                         err := Dbmap.Insert(&amp;testDevice)\n                         So(err, ShouldBeNil)\n //More code    \n}\n</code></pre>\n\n<p>When I run <code>go test</code>, this returns: </p>\n\n<p><code>'sql: Scan error on column index 0: converting driver.Value type &lt;nil&gt; (\"&lt;nil&gt;\") to a int64: invalid syntax'</code></p>\n\n<p>This is strange because I'm passing it 1, an integer.  The device struct is defined here: </p>\n\n<pre><code>type Device struct {\n        ID   int64 `db:\"id\"`\n        Guid string\n        Name string\n}\n</code></pre>\n\n<p>Here's the schema for the Postgres table it's inserting into:</p>\n\n<pre><code>CREATE TABLE devices(\nID INTEGER,\nGuid VARCHAR,\nName VARCHAR\n);\n</code></pre>\n\n<p>I've tried using the <code>sql.NillInt64</code> type, but that doesn't seem to fix the problem.  It feels like somehow, gorp, go, or postgres is interpreting the integer as a nil there.  As a final data point, this is all running in various Docker containers, though I don't think this problem is related to Docker. Any insights?</p>\n"}, {"tags": ["debugging", "go", "visual-studio-code", "delve"], "comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 3, "creation_date": 1523481127, "post_id": 49784519, "comment_id": 86584451, "body": "You can use the <code>--build-flags &#39;--tags=foo&#39;</code> to pass tags (or other build flags) to Delve. I don&#39;t know anything about VSCode, but if you can fill in flags to <code>dlv</code> anywhere then that&#39;s what you can use."}, {"owner": {"reputation": 361, "user_id": 1895825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06b730ac6bbc9a641b264c4ca4a99a7f?s=128&d=identicon&r=PG", "display_name": "Gopi Palamalai", "link": "https://stackoverflow.com/users/1895825/gopi-palamalai"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1565314532, "post_id": 49784519, "comment_id": 101324106, "body": "Thanks @MartinTournoij. That was useful."}], "owner": {"reputation": 1544, "user_id": 4996722, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/sddyE.jpg?s=128&g=1", "display_name": "OneMoreQuestion", "link": "https://stackoverflow.com/users/4996722/onemorequestion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 627, "favorite_count": 0, "closed_date": 1523550742, "answer_count": 0, "score": 3, "last_activity_date": 1523486544, "creation_date": 1523481031, "last_edit_date": 1523486544, "question_id": 49784519, "link": "https://stackoverflow.com/questions/49784519/how-to-debug-golang-with-build-tags-in-delve", "closed_reason": "Duplicate", "title": "How to debug Golang with build tags in Delve", "body": "<p>I am trying to debug Go code with VSCode's Delve. For my testing, I have to run <code>go test</code> with tags every time for every test. Above each of my test funtions, I see <em>run test</em> and <em>debug test</em> options, is there a way to configure <strong>launch.json</strong> so that the tags are added by default? </p>\n\n<p>I have not been able to find relevant documentation on this. </p>\n"}, {"tags": ["go", "channel", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1523481682, "post_id": 49784504, "comment_id": 86584652, "body": "chat is not called in both cases, only the second connection will trigger the chat fn. Once the chat fn is called, the server writes in both connections the motd. The code relies on the fact that a connection is all of the three : writable / readable and closable to send / receive and terminates the communication. imho, i don t really understand why the code might be non-deterministic, even though the order of the select is not deterministic the code will behave in that specific way."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1523485750, "post_id": 49784504, "comment_id": 86586030, "body": "The code will behave in one of two specific ways for each connection pair, and in both cases will chat be called. I suppose technically it is deterministic, because the select is <i>pseudo</i>-random, but for all intents and purposes it is unpredictable if chat is called by the first or second goroutine, and consequently the argument order is unpredictable as well."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1523554276, "post_id": 49784504, "comment_id": 86619909, "body": "I rephrase my initial post, both will block on the partner push, one will win, the other one will pull from partner and then start the chat. Its true that it could be one or the other that wins the race on partner push however logically speaking, can anything else happen in that code ? (thanks for commenting)"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 2, "last_activity_date": 1523481270, "last_edit_date": 1523481270, "creation_date": 1523480952, "answer_id": 49784504, "question_id": 49784085, "link": "https://stackoverflow.com/questions/49784085/golang-chat-server-select-statement/49784504#49784504", "title": "golang chat server/select statement", "body": "<pre><code>var partner = make(chan io.ReadWriteCloser)\n\nfunc match(c io.ReadWriteCloser) {\n    fmt.Fprint(c, \"waiting for a partner...\")\n    select {\n    case partner &lt;- c:\n        //now handled by the other goroutine\n    case p := &lt;-partner:\n        chat(p, c)\n    }\n    fmt.Printf(\"waiting\")\n}\n</code></pre>\n\n<p>The match function is called once, every time a client connects. I believe that much is clear.</p>\n\n<p>The first case of the select statement wants to sends the TCP connection down the partner channel. The second case wants to receive a TCP connection from the partner channel.</p>\n\n<p>If multiple cases of a select statements are ready to proceed, <a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"nofollow noreferrer\">the runtime picks one at random</a>.</p>\n\n<p>When match is called for the first time (let's call this M1), neither case can proceed because the channel is unbuffered; M1 blocks and waits. When match is called for the second time (M2), it is actually unpredictable what exactly happens next, but the effect is the same.</p>\n\n<p>Let's assume that M2 tries to proceed with the first case, sending the second connection to partner. This will work, because M1 is ready to receive it. So M2 proceeds with the first case, and M1 proceeds with the second case and calls <code>chat</code>.</p>\n\n<p>Let's now go back and assume that M2 tries to proceed with the second case, receiving another connection from partner. This also works, because M1 is ready to send the first connection. So in this case M1 proceeds with the first case, and M2 proceeds with the second case and calls <code>chat</code>.</p>\n\n<p>So chat is called in both cases, but the order of the arguments is not deterministic. In this case it works either way, because the communication is bi-directional and we don't care who came first.</p>\n\n<p>And then it just starts all over again.</p>\n"}], "owner": {"reputation": 152, "user_id": 6533234, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/795d09b41281a690026186a5e44e1b16?s=128&d=identicon&r=PG&f=1", "display_name": "casualprogrammer", "link": "https://stackoverflow.com/users/6533234/casualprogrammer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 198, "favorite_count": 0, "accepted_answer_id": 49784504, "answer_count": 1, "score": 1, "last_activity_date": 1523928121, "creation_date": 1523478959, "last_edit_date": 1523928121, "question_id": 49784085, "link": "https://stackoverflow.com/questions/49784085/golang-chat-server-select-statement", "title": "golang chat server/select statement", "body": "<p>I have the following piece of code that implements a simple tcp chat server written in go. I have trouble understanding where in the code the connection is sent through the \"partner channel\". I see that when the first user connects, the select statement just waits until the next user joins. But when the second user joins, how does the code send information through the channel and know to select which case? </p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>package main\r\n\r\nimport (\r\n\t\"io\"\r\n  \"net\"\r\n  \"log\"\r\n  \"fmt\"\r\n)\r\nconst listnAddr = \"localhost:4000\"\r\n\r\nfunc main(){\r\n  l , err := net.Listen(\"tcp\",listnAddr)\r\n  if err != nil {\r\n    log.Fatal(err)\r\n  }\r\n  for {\r\n    c , err := l.Accept()\r\n    if c!= nil{\r\n      fmt.Printf(\"ok\")\r\n    }\r\n    if err != nil {\r\n      log.Fatal(err)\r\n    }\r\n    go match(c)\r\n  }\r\n}\r\nvar partner = make(chan io.ReadWriteCloser)\r\n\r\nfunc match(c io.ReadWriteCloser){\r\n  fmt.Fprint(c,\"waiting for a partner...\")\r\n  select{\r\n    case partner &lt;- c:\r\n      //now handled by the other goroutine\r\n    case p := &lt;-partner:\r\n      chat(p,c)\r\n  }\r\n  fmt.Printf(\"waiting\")\r\n\r\n}\r\n\r\nfunc chat(a, b io.ReadWriteCloser) {\r\n    fmt.Fprintln(a, \"Found one! Say hi.\")\r\n    fmt.Fprintln(b, \"Found one! Say hi.\")\r\n    go io.Copy(a, b)\r\n    io.Copy(b, a)\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}, {"tags": ["go", "build", "linker", "ldflags"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523476380, "post_id": 49783327, "comment_id": 86582180, "body": "Works for me. <code>go build</code> without arguments writes a file called <code>$(basename $PWD)</code>. Is your working directory called &quot;go_playground&quot;?"}, {"owner": {"reputation": 4235, "user_id": 210029, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/5603b531354ca5e45c7adebaf6a7bdd3?s=128&d=identicon&r=PG&f=1", "display_name": "Marcus", "link": "https://stackoverflow.com/users/210029/marcus"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523476575, "post_id": 49783327, "comment_id": 86582294, "body": "holy crap, this is interesting. I&#39;m working from a symlinked directory - is this expected to affect the linker/ldflags? I never had any other problem."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523476798, "post_id": 49783327, "comment_id": 86582428, "body": "What I was trying to say was: make sure that <code>go build</code> actually writes the file named &quot;go_playground&quot;, and not one with another name. Or add <code>-o go_playground</code> to force the name."}, {"owner": {"reputation": 4235, "user_id": 210029, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/5603b531354ca5e45c7adebaf6a7bdd3?s=128&d=identicon&r=PG&f=1", "display_name": "Marcus", "link": "https://stackoverflow.com/users/210029/marcus"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523477081, "post_id": 49783327, "comment_id": 86582568, "body": "I get that, but I&#39;ve actually found the problem when reading your comment about the directory. If I execute the code above from a directory that is a <i>symlink</i> to the original directory, and build without specifying the name, the flag -X is not respected. If I do the same in the original directory, the flag -X is respected."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1523477574, "post_id": 49783327, "comment_id": 86582831, "body": "@Marcus: symlinks are not supported in GOPATH"}, {"owner": {"reputation": 4235, "user_id": 210029, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/5603b531354ca5e45c7adebaf6a7bdd3?s=128&d=identicon&r=PG&f=1", "display_name": "Marcus", "link": "https://stackoverflow.com/users/210029/marcus"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523478030, "post_id": 49783327, "comment_id": 86583061, "body": "@JimB thanks. What is specifically not supported? When compiled, the project works fine (the symlink is to the actual project path inside GOPATH) - this is the only problem I&#39;ve ever had due to symlinking (including for relatively large projects)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1523478236, "post_id": 49783327, "comment_id": 86583170, "body": "The <code>Go</code> tool doesn\u2019t always resolve symlinks to avoid the possibility of the same packing being linked in multiple times from different import paths. I\u2019m not exactly sure what the tool is doing in this case (you could see with the <code>-x</code> flag), but as a rule you just shouldn\u2019t have any symlinks to packages."}, {"owner": {"reputation": 4235, "user_id": 210029, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/5603b531354ca5e45c7adebaf6a7bdd3?s=128&d=identicon&r=PG&f=1", "display_name": "Marcus", "link": "https://stackoverflow.com/users/210029/marcus"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523512435, "post_id": 49783327, "comment_id": 86592747, "body": "@JimB Ah! Thanks."}, {"owner": {"reputation": 4235, "user_id": 210029, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/5603b531354ca5e45c7adebaf6a7bdd3?s=128&d=identicon&r=PG&f=1", "display_name": "Marcus", "link": "https://stackoverflow.com/users/210029/marcus"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523512497, "post_id": 49783327, "comment_id": 86592784, "body": "@JimB if you create an answer, I will mark it as accepted!"}], "owner": {"reputation": 4235, "user_id": 210029, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/5603b531354ca5e45c7adebaf6a7bdd3?s=128&d=identicon&r=PG&f=1", "display_name": "Marcus", "link": "https://stackoverflow.com/users/210029/marcus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 936, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1523477212, "creation_date": 1523475936, "last_edit_date": 1523477212, "question_id": 49783327, "link": "https://stackoverflow.com/questions/49783327/why-build-with-ldflag-x-works-only-when-the-filename-is-specified", "title": "Why `build` with ldflag `-X` works only when the filename is specified?", "body": "<p>I have the file <code>playground.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n)\n\nvar GitCommit string\n\nfunc main() {\n  fmt.Printf(\"Hello world, version: %s\\n\", GitCommit)\n}\n</code></pre>\n\n<p>why the behavior of the build ldflag <code>-X</code> depends on specifying the source filename?:</p>\n\n<pre><code># CASE 1\n$ go build -ldflags \"-X main.GitCommit=abc\" &amp;&amp; ./go_playground\nHello world, version: \n\n$ go tool nm go_playground\n52a900 D main.GitCommit\n\n# CASE 2\n$ go build -ldflags \"-X main.GitCommit=abc\" playground.go &amp;&amp; ./playground\nHello world, version: abc\n\n$ go tool nm playground\n5242f0 D main.GitCommit\n4c5678 R main.GitCommit.str\n</code></pre>\n\n<p>EDIT: it seems that the problem happens when case 1 is executed from a symlinked directory; when case 1 is executed from the original directory, the variable is passed. I'm not sure if this is expected, or it's a bug.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1523476031, "post_id": 49783039, "comment_id": 86581981, "body": "If you need <code>_meta</code> and a variable number of other properties at the same level use a <code>map[string]interface{}</code>."}], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 0, "last_activity_date": 1523479703, "creation_date": 1523479703, "answer_id": 49784222, "question_id": 49783039, "link": "https://stackoverflow.com/questions/49783039/how-to-create-custom-json-structure-ansible-inventory/49784222#49784222", "title": "How to create custom json structure (ansible inventory)", "body": "<p>You best bet is probably to let Ansible implement <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"nofollow noreferrer\">json.Marshaler</a> to \"flatten\" the JSON document on-the-fly.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    a := &amp;Ansible{\n            Metadata: Hostvars{\n                    Hosts: map[string]map[string]string{\n                            \"172.16.0.3\": map[string]string{\n                                    \"displayname\": \"server 1\",\n                            },\n                    },\n            },\n            Hosts: map[string]Group{\n                    \"group1\":  Group{Hosts: []string{\"172.16.0.3\", \"172.16.0.4\", \"172.16.0.5\"}},\n                    \"sandbox\": Group{Children: []string{\"server1\", \"server2\", \"server3\"}},\n                    \"server1\": Group{Hosts: []string{\"172.16.0.3\"}},\n            },\n    }\n\n    b, err := json.MarshalIndent(a, \"\", \"  \")\n    fmt.Println(string(b), err)\n}\n\ntype Ansible struct {\n    Metadata Hostvars\n    Hosts    map[string]Group\n}\n\ntype Hostvars struct {\n    Hosts map[string]map[string]string `json:\"hostvars\"`\n}\n\n// I don't *think* Ansible supports anything else in host groups, so it makes\n// sense to define it as a struct.\ntype Group struct {\n    Hosts    []string `json:\"hosts,omitempty\"`\n    Children []string `json:\"children,omitempty\"`\n}\n\n// MarshalJSON implements json.Marshaler\nfunc (a *Ansible) MarshalJSON() ([]byte, error) {\n    // Define a map that we will encode at the end of the function.\n    doc := make(map[string]interface{})\n\n    // Add all the groups.\n    for k, v := range a.Hosts {\n            doc[k] = v\n    }\n\n    // Add the _meta key.\n    doc[\"_meta\"] = a.Metadata\n\n    return json.Marshal(doc)\n}\n</code></pre>\n\n<p>Try it on the playground: <a href=\"https://play.golang.org/p/OKQHAG3vqIG\" rel=\"nofollow noreferrer\">https://play.golang.org/p/OKQHAG3vqIG</a></p>\n"}], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 861, "favorite_count": 1, "accepted_answer_id": 49784222, "answer_count": 1, "score": 0, "last_activity_date": 1523479703, "creation_date": 1523474776, "question_id": 49783039, "link": "https://stackoverflow.com/questions/49783039/how-to-create-custom-json-structure-ansible-inventory", "title": "How to create custom json structure (ansible inventory)", "body": "<p>I am obtaining data from the <a href=\"https://cloudstack.apache.org/api/apidocs-4.4/user/listVirtualMachines.html\" rel=\"nofollow noreferrer\">cloudstack API listVirtualMachines</a>, and trying to create a web service that will provide a <a href=\"http://docs.ansible.com/ansible/devel/user_guide/intro_dynamic_inventory.html\" rel=\"nofollow noreferrer\">dynamic ansible inventory</a> for certain hosts.</p>\n\n<p>In my first tries, currently I am fetching all the data by doing a connection request and then within a loop parse all the output:</p>\n\n<pre><code>vms, _ := cs.Request(&amp;cs.ListVirtualMachines{})\n\n// use for the metadata _meta['hostvars']['IP']['key'] = val\nhostvars := make(map[string]map[string]string)\n\n// used per each host ['name']['hosts'] = [list]\nhosts := make(map[string]map[string][]string)\n\nfor _, vm := range vms(*cs.ListVirtualMachinesResponse).VirtualMachine {\n  ip := vm.Nic[0].IPAddress.String()\n  if ip == \"\" {\n      continue\n  }\n  hostvars[ip] = map[string]string{\n      vm.DisplayName:            vm.DisplayName,\n      \"ansible_ssh_common_args\": \"-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null\",\n  }\n  if hosts[vm.DisplayName] == nil {\n      hosts[vm.DisplayName] = map[string][]string{}\n  }\n  hosts[vm.DisplayName][\"hosts\"] = append(hosts[vm.DisplayName][\"hosts\"], ip)\n}\n</code></pre>\n\n<p>My desired output needs this JSON format:</p>\n\n<pre><code>{\n    \"_meta\": {\n        \"hostvars\": {\n            \"172.16.0.3\": {\n                \"ansible_ssh_common_args\": \"-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null\",\n                \"displayname\": \"server 1\"\n            },\n            \"172.16.0.4\": {\n                \"ansible_ssh_common_args\": \"-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null\",\n                \"displayname\": \"server 2\"\n            },\n            \"172.16.0.5\": {\n                \"ansible_ssh_common_args\": \"-o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null\",\n                \"displayname\": \"server 3\"\n            }\n        }\n    },\n    \"group1\": {\n        \"hosts\": [\n            \"172.16.0.3\",\n            \"172.16.0.4\",\n            \"172.16.0.5\"\n        ]\n    },\n    \"sandbox\": {\n        \"children\": [\n            \"server1\",\n            \"server2\",\n            \"server3\"\n        ]\n    },\n    \"server1\": {\n        \"hosts\": [\n            \"172.16.0.3\"\n        ]\n    },\n    \"server2\": {\n        \"hosts\": [\n            \"172.16.0.4\"\n        ]\n    },\n    \"server3\": {\n        \"hosts\": [\n            \"172.16.0.5\"\n        ]\n    }\n}\n</code></pre>\n\n<p>My first try was to create a huge map:</p>\n\n<pre><code>inventory := map[string]map[string]map[string]string{}\n</code></pre>\n\n<p>But that was covering only the structure of the <code>_meta</code> key :</p>\n\n<pre><code>{\n    \"_meta\": {\n        \"hostvars\": {\n            \"x.x.x.x\": {\n                \"key\": \"value\"\n            },\n            \"x.x.x.y\": {\n                \"key\": \"value\"\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Later I came with a struct:</p>\n\n<pre><code>type Ansible struct {\n        Metadata Hostvars `json:\"_meta\"`\n        Hosts map[string]map[string][]string `json:\",inline\"` // want to remove the Hosts key\n}\n\ntype Hostvars struct {\n        Hosts map[string]map[string]string `json:\"hostvars\"`\n}\n\ninventory := &amp;Ansible{\n                Hostvars{hostvars},\n                hosts,\n}\n\n\nif err := json.NewEncoder(os.Stdout).Encode(inventory); err != nil {\n        log.Println(err)\n}\n</code></pre>\n\n<p>The problem with this approach is that the returned JSON is adding both keys <code>_meta</code> and <code>hosts</code>:</p>\n\n<pre><code>{\n    \"_meta\": {\n        \"hostvars\": {\n            \"x.x.x.x\": {\n                \"key\": \"value\"\n            },\n            \"x.x.x.y\": {\n                \"key\": \"value\"\n            }\n        }\n    },\n    \"hosts\": {    &lt;--- want to remove this \n        \"server1\": {\n            \"hosts\": [\n                \"172.16.0.3\"\n            ]\n        }\n        ...\n    }\n}\n</code></pre>\n\n<p>I would like to just have the key <code>_meta</code> and at the same level (inline) have each key for every hostname, something like:</p>\n\n<pre><code>{\n    \"_meta\": {...},\n    \"server1\": {\n        \"hosts\": []\n    },\n    \"group1\": {\n        \"hosts\": []\n    },\n    \"sandbox\": {\n        \"children\": []\n    }\n}\n</code></pre>\n\n<p>I have a guess this probably could be solved with a <code>map[string]interface{}</code> maybe that could allow a dynamic JSON object with dynamic key names/structure, don't know exactly, therefore, any help would be appreciated.</p>\n"}, {"tags": ["go", "google-cloud-pubsub"], "answers": [{"comments": [{"owner": {"reputation": 421, "user_id": 456157, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/76giS.jpg?s=128&g=1", "display_name": "Askar", "link": "https://stackoverflow.com/users/456157/askar"}, "edited": false, "score": 0, "creation_date": 1523480767, "post_id": 49783743, "comment_id": 86584320, "body": "Thanks so much Kamal!  It was a bit confusing to me since I did not notice any messages lost or delays on services.  It is good to know."}], "tags": [], "owner": {"reputation": 9109, "user_id": 1121288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/299e0ebf3759ba2e2e6f69fc30653016?s=128&d=identicon&r=PG", "display_name": "Kamal Aboul-Hosn", "link": "https://stackoverflow.com/users/1121288/kamal-aboul-hosn"}, "is_accepted": true, "score": 3, "last_activity_date": 1523477527, "creation_date": 1523477527, "answer_id": 49783743, "question_id": 49782432, "link": "https://stackoverflow.com/questions/49782432/catch-error-code-from-gcp-pub-sub/49783743#49783743", "title": "Catch error code from GCP pub/sub", "body": "<p>The <a href=\"https://cloud.google.com/pubsub/docs/reference/libraries#client-libraries-install-go\" rel=\"nofollow noreferrer\">Cloud Pub/Sub Go client library</a> will retry this transient error on its own, you shouldn't need to handle it. Internally, the client library uses <a href=\"https://cloud.google.com/pubsub/docs/reference/rpc/google.pubsub.v1#google.pubsub.v1.StreamingPullRequest\" rel=\"nofollow noreferrer\">StreamingPull</a>, where it sends a request and receives messages from the service as they are available. Occasionally, there can be a disconnection event requiring the connection to be reestablished. This is why you see the 503 error in the API dashboard. It should not be the case that your code sees an error in this scenario since the underlying library is handling it (including the use of exponential backoff, where relevant).</p>\n"}], "owner": {"reputation": 421, "user_id": 456157, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/76giS.jpg?s=128&g=1", "display_name": "Askar", "link": "https://stackoverflow.com/users/456157/askar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 779, "favorite_count": 0, "accepted_answer_id": 49783743, "answer_count": 1, "score": 0, "last_activity_date": 1523477527, "creation_date": 1523472414, "question_id": 49782432, "link": "https://stackoverflow.com/questions/49782432/catch-error-code-from-gcp-pub-sub", "title": "Catch error code from GCP pub/sub", "body": "<p>I am using go package for pub/sub.  On my API dashboard I see this error(google.pubsub.v1.Subscriber.StreamingPull - error code 503).  Per docs(<a href=\"https://cloud.google.com/pubsub/docs/reference/error-codes\" rel=\"nofollow noreferrer\">https://cloud.google.com/pubsub/docs/reference/error-codes</a>) it seems it is transient condition but better to implement  backoff strategy(<a href=\"https://cloud.google.com/storage/docs/exponential-backoff\" rel=\"nofollow noreferrer\">https://cloud.google.com/storage/docs/exponential-backoff</a>).   the question is I am not able to wrap my head where this error code is coming on Receive method.</p>\n\n<p>Here is func:</p>\n\n<pre><code>err = sub.Receive(ctx, func(ctx context.Context, m *pubsub.Message) {\n        // Dump message\n        // log.Printf(\"Got message: %s\", m.Data)\n\n        // Decoding coming message\n        err = json.NewDecoder(bytes.NewReader(m.Data)).Decode(&amp;msg)\n        if err != nil {\n            log.Printf(\"Error decoding - %v\", err)\n        }\n\n        // See streaming messages\n        log.Printf(\" %s : %s : Product updated for Product Id(%d) : Product Title(%s)\",\n            msg.AuthID,\n            msg.TraceID,\n            msg.Product.ID,\n            msg.Product.Title,\n        )\n\n        //\n        // Some business logic\n        //\n\n\n        // Acknowledge on recieve method\n        m.Ack()\n    })\n\n    if err != context.Canceled {\n        // if err != nil {\n        return errors.Wrap(err, \"Error occurred on recieve data from topic: blah\")\n    }\n</code></pre>\n"}, {"tags": ["go", "interface", "slice", "go-gorm"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1523472580, "post_id": 49782431, "comment_id": 86580179, "body": "<code>[]map[string]interface{}</code> is a slice of maps of strings to interfaces. Each element in the slice is a map. What are you actually trying to accomplish here?"}, {"owner": {"reputation": 3, "user_id": 8218809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be32c1c66c8fb8f1fdcb0ab70c203923?s=128&d=identicon&r=PG", "display_name": "Cemil &#199;elik", "link": "https://stackoverflow.com/users/8218809/cemil-%c3%87elik"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1523472678, "post_id": 49782431, "comment_id": 86580244, "body": "I&#39;m actually trying assign data to filters variable."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1523472748, "post_id": 49782431, "comment_id": 86580277, "body": "Yeah, that much is clear. Is <code>filters</code> actually supposed to be a slice of maps? How is it used? How do you decide how many maps go in it, and which values go into which maps in the slice?"}, {"owner": {"reputation": 3, "user_id": 8218809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be32c1c66c8fb8f1fdcb0ab70c203923?s=128&d=identicon&r=PG", "display_name": "Cemil &#199;elik", "link": "https://stackoverflow.com/users/8218809/cemil-%c3%87elik"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1523472780, "post_id": 49782431, "comment_id": 86580298, "body": "filters[0][&quot;email&quot;] = &quot;a@a.com&quot;, filters[0][&quot;count&quot;] = 10"}, {"owner": {"reputation": 3, "user_id": 8218809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be32c1c66c8fb8f1fdcb0ab70c203923?s=128&d=identicon&r=PG", "display_name": "Cemil &#199;elik", "link": "https://stackoverflow.com/users/8218809/cemil-%c3%87elik"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1523472933, "post_id": 49782431, "comment_id": 86580364, "body": "I&#39;m going to determine how many maps and which values."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1523473005, "post_id": 49782431, "comment_id": 86580401, "body": "And what do you mean by &quot;datas don&#39;t fill into variable&quot;? What is the actual problem you&#39;re having?"}, {"owner": {"reputation": 3, "user_id": 8218809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be32c1c66c8fb8f1fdcb0ab70c203923?s=128&d=identicon&r=PG", "display_name": "Cemil &#199;elik", "link": "https://stackoverflow.com/users/8218809/cemil-%c3%87elik"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1523473163, "post_id": 49782431, "comment_id": 86580474, "body": "When I debug, I see the values as empty at interface part. The values don&#39;t fill the variable."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523474465, "post_id": 49782431, "comment_id": 86581129, "body": "@Cemil&#199;elik can you print the values <code>email</code> and <code>count</code>. Because normally this should work as in <a href=\"https://play.golang.org/p/aPZgcaQnqbl\" rel=\"nofollow noreferrer\">playground</a>. Please elaborate more with code in your question"}, {"owner": {"reputation": 3, "user_id": 8218809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be32c1c66c8fb8f1fdcb0ab70c203923?s=128&d=identicon&r=PG", "display_name": "Cemil &#199;elik", "link": "https://stackoverflow.com/users/8218809/cemil-%c3%87elik"}, "edited": false, "score": 0, "creation_date": 1523474710, "post_id": 49782431, "comment_id": 86581256, "body": "I try to print email and count. There is no problem. I try playground now. You&#39;re right, working normally. Perhaps there is a problem on debug tool."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523474983, "post_id": 49782431, "comment_id": 86581416, "body": "Are you using delve debug in vs"}, {"owner": {"reputation": 3, "user_id": 8218809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be32c1c66c8fb8f1fdcb0ab70c203923?s=128&d=identicon&r=PG", "display_name": "Cemil &#199;elik", "link": "https://stackoverflow.com/users/8218809/cemil-%c3%87elik"}, "edited": false, "score": 0, "creation_date": 1523475137, "post_id": 49782431, "comment_id": 86581498, "body": "Yes I use delve debug."}, {"owner": {"reputation": 3, "user_id": 8218809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be32c1c66c8fb8f1fdcb0ab70c203923?s=128&d=identicon&r=PG", "display_name": "Cemil &#199;elik", "link": "https://stackoverflow.com/users/8218809/cemil-%c3%87elik"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523475226, "post_id": 49782431, "comment_id": 86581541, "body": "Very very strange. It printed to the console. So datas has been assigned seamlessly since from the start. But it didn&#39;t commit at delve debug screen. Thank you so much @himanshu"}, {"owner": {"reputation": 3, "user_id": 8218809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be32c1c66c8fb8f1fdcb0ab70c203923?s=128&d=identicon&r=PG", "display_name": "Cemil &#199;elik", "link": "https://stackoverflow.com/users/8218809/cemil-%c3%87elik"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1523475369, "post_id": 49782431, "comment_id": 86581623, "body": "Also thank you so much @Adrian"}], "answers": [{"tags": [], "owner": {"reputation": 836, "user_id": 197637, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a865c4dbd18c5da18c5ca1ee8acfd830?s=128&d=identicon&r=PG", "display_name": "gurbieta", "link": "https://stackoverflow.com/users/197637/gurbieta"}, "is_accepted": false, "score": 1, "last_activity_date": 1523485979, "creation_date": 1523485979, "answer_id": 49785342, "question_id": 49782431, "link": "https://stackoverflow.com/questions/49782431/i-cant-assign-data-to-mapstringinterface/49785342#49785342", "title": "I can&#39;t assign data to []map[string]interface{}", "body": "<p>You are making an slice of map[string]interface{}, when I suppose you want a map[string]interface{} (no slices), if that's the case you need something like this:</p>\n\n<pre><code>filters := map[string]interface{}{\n    \"email\": email,\n    \"count\": count,\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 8218809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be32c1c66c8fb8f1fdcb0ab70c203923?s=128&d=identicon&r=PG", "display_name": "Cemil &#199;elik", "link": "https://stackoverflow.com/users/8218809/cemil-%c3%87elik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 751, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1527756358, "creation_date": 1523472413, "last_edit_date": 1527756358, "question_id": 49782431, "link": "https://stackoverflow.com/questions/49782431/i-cant-assign-data-to-mapstringinterface", "title": "I can&#39;t assign data to []map[string]interface{}", "body": "<p>I want to prepare conditions data for gorm.</p>\n\n<pre><code>email := c.Query(\"email\")\ncount := c.Query(\"count\")\n\nfilters := []map[string]interface{}{\n    {\"email\": email},\n    {\"count\": count},\n}\n</code></pre>\n\n<p>I can take the datas at c.Query() lines.</p>\n\n<p>After process \"filters\" variable's assignment line, I see the values as empty on debug.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "edited": false, "score": 0, "creation_date": 1523468911, "post_id": 49780496, "comment_id": 86578286, "body": "Could <code>c.Validate()</code> call <code>c.Webserver.Validate()</code>? It seems like it, since <code>Validate</code> is called after <code>Load</code>. If so, it might help to define a Validater interface to reduce code duplication if the <code>Config</code> type has many elements. If you don&#39;t want to update the list of things to <code>Validate</code>, you would have to use reflection to get all of the elements of the <code>Config</code> type."}, {"owner": {"reputation": 2293, "user_id": 1098584, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7ab6b6d44e367a743580c3089026b7bc?s=128&d=identicon&r=PG", "display_name": "sontags", "link": "https://stackoverflow.com/users/1098584/sontags"}, "reply_to_user": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "edited": false, "score": 0, "creation_date": 1523516211, "post_id": 49780496, "comment_id": 86594690, "body": "@TylerBui-Palsulich You are right and I was overthinking the problem: My first attempt was based on a Validater interface. Also the component configs registerd itself to the global config, therefore changes to the global config where obsolete for new configs. The problem with is to unmarshal into an interface - I could not find a neat way to do so. My current implementation iterated over the struct fields via reflection which is not nice. Hardcode <code>c.Webserver.Validate()</code> into <code>c.Validate()</code> is simple, readable and explicit - and obvious. Sorry for that stupid question."}, {"owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "edited": false, "score": 0, "creation_date": 1523558901, "post_id": 49780496, "comment_id": 86622322, "body": "Great! I&#39;m glad it helped. Not a stupid question at all. I hadn&#39;t thought about this type of config idea before. I added an answer based on these comments to make sure the question doesn&#39;t show up as unanswered when others are searching/doing triage."}], "answers": [{"tags": [], "owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "is_accepted": true, "score": 1, "last_activity_date": 1523558788, "creation_date": 1523558788, "answer_id": 49803879, "question_id": 49780496, "link": "https://stackoverflow.com/questions/49780496/how-to-implement-a-fragmented-config-file-validation-in-go/49803879#49803879", "title": "How to implement a fragmented config file validation in go", "body": "<p>I'd recommend calling <code>c.Webserver.Validate()</code> from <code>c.Validate()</code>.</p>\n\n<p>The downside of this is you need to update <code>c.Validate()</code> every time you add a new config, which might be easy to forget. However, it is \"simple, readable and explicit\" (quoting from your comment).</p>\n\n<p>Alternatively, you could loop over every element of the config to see which ones match a <code>Validater</code> interface then call <code>Validate</code> on them. But, this would be much more complicated and more difficult to understand &amp; debug. The usual recommendation is to avoid reflection unless absolutely necessary.</p>\n"}], "owner": {"reputation": 2293, "user_id": 1098584, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/7ab6b6d44e367a743580c3089026b7bc?s=128&d=identicon&r=PG", "display_name": "sontags", "link": "https://stackoverflow.com/users/1098584/sontags"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 418, "favorite_count": 0, "accepted_answer_id": 49803879, "answer_count": 1, "score": 0, "last_activity_date": 1523558788, "creation_date": 1523465155, "last_edit_date": 1523466366, "question_id": 49780496, "link": "https://stackoverflow.com/questions/49780496/how-to-implement-a-fragmented-config-file-validation-in-go", "title": "How to implement a fragmented config file validation in go", "body": "<p>I try to configure a CLI app via config file (yaml). The app has several \"components\" (lets say a persistence layer, an integrated web server etc.). Those components are managed in subpackages to keep the code tidy. The configuration of those components is defined inside their packages\nand \"merged\" in a config package to a struct that represents the config file. See this code as a demo implementation:</p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n\n    yaml \"gopkg.in/yaml.v2\"\n)\n\n//\n// This would be in package 'webserver'\n// Only the Config part is shown, there would be a constructor and the implementation of\n// the webserver as well...\n//\n\n// WebserverConfig holds all required configuration params\ntype WebserverConfig struct {\n    Listen    string `yaml:\"listen\"`\n    Autostart bool   `yaml:\"autostart\"`\n}\n\n// Validate checks if all fields make sense and returns a list of error string if problems\n// are found\nfunc (wsc WebserverConfig) Validate() (error, []string) {\n    errs := []string{}\n    if wsc.Listen == \"\" {\n        errs = append(errs, \"Field 'listen' must not be empty.\")\n    }\n    if len(errs) &gt; 0 {\n        err := errors.New(\"Config of 'webserver' has errors\")\n        return err, errs\n    }\n    return nil, errs\n}\n\n// UnmarshalYAML implements a custom unmarshaller to make sure defaults are set\n// to meaningful values\nfunc (wsc *WebserverConfig) UnmarshalYAML(unmarshal func(interface{}) error) error {\n    type WebserverConfigDefaulted WebserverConfig\n    var defaults = WebserverConfigDefaulted{\n        Listen:    \":8080\",\n        Autostart: true,\n    }\n\n    out := defaults\n    err := unmarshal(&amp;out)\n    *wsc = WebserverConfig(out)\n    return err\n}\n\n//\n// This would be in package conf\n//\n//\n\n// Config is the global configuration composed of all component configuration sections\ntype Config struct {\n    Webserver WebserverConfig `yaml:\"webserver\"`\n}\n\n// Load reads the bytes into the global config\nfunc Load(data string) (Config, error) {\n    c := Config{}\n    err := yaml.Unmarshal([]byte(data), &amp;c)\n    if err != nil {\n        return c, fmt.Errorf(\"Error while unmarshalling configuration from yaml: %s\", err.Error())\n    }\n    return c, nil\n}\n\n// Validate should call each individual component configurations validate function (if it exists)\nfunc (c Config) Validate() error {\n    // TODO: IMPLEMPNT...\n    return nil\n}\n\n//\n// This is finally in main\n//\n//\n\nvar yamlFile = `---\nwebserver:\n  listen: \":9999\" \n`\n\nfunc main() {\n    c, err := Load(yamlFile)\n    if err != nil {\n        fmt.Println(err)\n    }\n    err = c.Validate()\n    if err != nil {\n        fmt.Println(err)\n    }\n}\n</code></pre>\n\n<p>Find it on the playground here (does not run because of the dep to yaml): <a href=\"https://play.golang.org/p/i3EAZJP7aYz\" rel=\"nofollow noreferrer\">https://play.golang.org/p/i3EAZJP7aYz</a></p>\n\n<p>QUESTION: At this point I have no idea how the global validation function <code>func (c Config) Validate() error</code> could be implemented to call all Validate funcs of the 'component configurations' (such as <code>func (wsc WebserverConfig) Validate() (error, []string)</code>). Any idea or hints?</p>\n"}, {"tags": ["rest", "http", "go", "response"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1523461077, "post_id": 49778912, "comment_id": 86573789, "body": "Show the code for <code>writeJSONResponse</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1523461140, "post_id": 49778912, "comment_id": 86573844, "body": "You sure nothing else is reading the response body before you pass it to <code>readResponseContent</code>?"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 2, "creation_date": 1523461439, "post_id": 49778912, "comment_id": 86574048, "body": "Are your use of underscores for error returns just to make your code smaller here?  Given that your code actually <i>does</i> check errors twice in there, I suspect not.  If those underscores are present in your actual code, <i>STOP IGNORING THE ERRORS</i>.  99.9% of issues I see with failures in json marshaling/unmarshaling are because people are ignoring their errors and missing a perfectly explanatory error return value."}, {"owner": {"reputation": 41, "user_id": 9631377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ad7c7abed16ba60adeb01aa6da4c4a9?s=128&d=identicon&r=PG", "display_name": "iz4vve", "link": "https://stackoverflow.com/users/9631377/iz4vve"}, "edited": false, "score": 1, "creation_date": 1523462695, "post_id": 49778912, "comment_id": 86574912, "body": "I&#39;m just using them to shorten the function here. I am checking that everything is as expected (proper file, proper copy, proper id, ...)."}, {"owner": {"reputation": 41, "user_id": 9631377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ad7c7abed16ba60adeb01aa6da4c4a9?s=128&d=identicon&r=PG", "display_name": "iz4vve", "link": "https://stackoverflow.com/users/9631377/iz4vve"}, "edited": false, "score": 0, "creation_date": 1523462756, "post_id": 49778912, "comment_id": 86574965, "body": "writeJSONResponse just takes a <code>[]byte</code>, sets the content type to json and writes the bytes"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1523465862, "post_id": 49778912, "comment_id": 86576743, "body": "There&#39;s no such thing as a &quot;blob&quot; type in MIME."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523465609, "post_id": 49780355, "comment_id": 86576618, "body": "This is more or less <a href=\"https://github.com/golang/go/blob/go1.10.1/src/net/http/request.go#L1266-L1284\" rel=\"nofollow noreferrer\">what http.Request.FormFile does</a>. It has nothing to do with an unexpected empty response."}, {"owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523466351, "post_id": 49780355, "comment_id": 86576970, "body": "I said because he is reading the body of the file like this bodyBytes, err := ioutil.ReadAll(resp.Body)"}], "tags": [], "owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "is_accepted": false, "score": 1, "last_activity_date": 1523464634, "creation_date": 1523464634, "answer_id": 49780355, "question_id": 49778912, "link": "https://stackoverflow.com/questions/49778912/empty-response-after-file-upload/49780355#49780355", "title": "Empty response after file upload", "body": "<p>The problem looks like you are forgetting the content-type of the form you are receiving, when you send json the contentt-type is aplication/json, when you upload a file, you should be using multipart/form-data, if that\u00b4s you\u00b4re case you read it in this way:</p>\n\n<pre><code>    import(\n       \"ioutil\"\n       \"net/http\"\n    )\n//check all posible errors, I\u00b4m assuming you just have one file per key\n    func handler(w http.ResponseWriter, r *http.Request) {\n        r.ParseMultipartForm(1000000) //1 MB in memory, the rest in disk\n        datas := r.MultipartForm\n        for k, headers := range datas.File {\n            auxiliar, _ := headers[0].Open() //first check len(headers) if it's correct\n            fileName:=headers[0].Filename\n            file, _ := ioutil.ReadAll(auxiliar)\n            // do what you need to do with the file\n    }\n}\nat the frontEnd you should have some javascript like this:\n\nfunction handleFile(url,file){\n  let data=new FormData();\n  data.append(\"key\",file); //this is the key when ranging over map at backEnd\n  fetch(url,{method:\"PUT\",body:data})\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 9631377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ad7c7abed16ba60adeb01aa6da4c4a9?s=128&d=identicon&r=PG", "display_name": "iz4vve", "link": "https://stackoverflow.com/users/9631377/iz4vve"}, "is_accepted": false, "score": 0, "last_activity_date": 1523480162, "creation_date": 1523480162, "answer_id": 49784327, "question_id": 49778912, "link": "https://stackoverflow.com/questions/49778912/empty-response-after-file-upload/49784327#49784327", "title": "Empty response after file upload", "body": "<p>Found the problem... A snippet of code in a separate function was consuming the Body right before the response is generated... </p>\n\n<p>Frustrations and mistakes of learning a new language :/</p>\n"}], "owner": {"reputation": 41, "user_id": 9631377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ad7c7abed16ba60adeb01aa6da4c4a9?s=128&d=identicon&r=PG", "display_name": "iz4vve", "link": "https://stackoverflow.com/users/9631377/iz4vve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 438, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1523480162, "creation_date": 1523460171, "last_edit_date": 1523460304, "question_id": 49778912, "link": "https://stackoverflow.com/questions/49778912/empty-response-after-file-upload", "title": "Empty response after file upload", "body": "<p>I have written a small REST api in Go and I am using the same functions to return a http.Response with a status code and a message:</p>\n\n<pre><code>type apiResponse struct {\n    Status  int    `json:\"status\"`\n    Message string `json:\"message\"`\n}\n</code></pre>\n\n<p>I am marshalling this into a json string and using <code>w.Write()</code> to put it in the response.</p>\n\n<p>The API has three endpoints, one of which lets the user upload a file. Two work perfectly fine and I'm getting the response I expect.\nThe upload endpoint returns a valid response with a <code>Content-Length</code> that matches the message I expect, but when I read it (using <code>ioutil.ReadAll</code>), it's empty!</p>\n\n<p>What am I doing wrong?</p>\n\n<p>This is the function to read the Body:</p>\n\n<pre><code>func readResponseContent(resp *http.Response) string {\n    defer resp.Body.Close()\n    fmt.Println(resp)\n    fmt.Println(resp.ContentLength)\n    bodyBytes, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        fmt.Println(\"Error in response: %s\", err.Error())\n        os.Exit(1)\n    }\n    bodyString := string(bodyBytes)\n    return bodyString\n}\n</code></pre>\n\n<p>and this is the handler:</p>\n\n<pre><code>func handleSubmission(w http.ResponseWriter, r *http.Request) {\n\nvar Buf bytes.Buffer\nfile, header, err := r.FormFile(audioUploadKey)\n\nif err != nil {\n    log.Printf(\"Error uploading file: %s\\n\", err.Error())\n    http.Error(w, err.Error(), http.StatusInternalServerError)\n    return\n}\ndefer file.Close()\n\njobID, _ := uuid.NewUUID()\n_ = os.MkdirAll(path.Join(jobsPath, jobID.String()), 0750)\n\nlog.Printf(\"Received file %s\\n\", header.Filename)\n\nio.Copy(&amp;Buf, file)\nfileOut, _ := os.Create(path.Join(jobsPath, jobID.String(), \n\nBuf.WriteTo(fileOut)\nBuf.Reset()\n\n// submit\n// DO STUFF with jobID\n\napiResp := apiResponse{Status:http.StatusCreated, Message:jobID.String()}\njsonResp, _ := json.Marshal(apiResp)\nwriteJSONResponse(w, jsonResp)\nreturn}\n</code></pre>\n"}, {"tags": ["go", "dependencies"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1523456525, "post_id": 49777536, "comment_id": 86570281, "body": "make changes to the project, then update the dependency in the vendor folder with one of dep&#39;s commands <a href=\"https://golang.github.io/dep/docs/daily-dep.html#updating-dependencies\" rel=\"nofollow noreferrer\">golang.github.io/dep/docs/daily-dep.html#updating-dependenci&zwnj;&#8203;es</a> (maybe you&#39;ll have to commit and even push? the changes before you do dep ensure -update, try and see)."}, {"owner": {"reputation": 2684, "user_id": 784519, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8ed38b4892e7d5f106d8dfde7a4df4fe?s=128&d=identicon&r=PG", "display_name": "davidkomer", "link": "https://stackoverflow.com/users/784519/davidkomer"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523456828, "post_id": 49777536, "comment_id": 86570507, "body": "Doesn&#39;t seem to work - <code>dep ensure</code> will replace it with the version on github it seems, not with my local version in GOPATH"}, {"owner": {"reputation": 2684, "user_id": 784519, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8ed38b4892e7d5f106d8dfde7a4df4fe?s=128&d=identicon&r=PG", "display_name": "davidkomer", "link": "https://stackoverflow.com/users/784519/davidkomer"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523456871, "post_id": 49777536, "comment_id": 86570556, "body": "I see you added about commit/push - right, but I want to see the changes live locally before commit/push. There could be temp debug messages, logs, etc."}, {"owner": {"reputation": 2684, "user_id": 784519, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8ed38b4892e7d5f106d8dfde7a4df4fe?s=128&d=identicon&r=PG", "display_name": "davidkomer", "link": "https://stackoverflow.com/users/784519/davidkomer"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1523456916, "post_id": 49777536, "comment_id": 86570598, "body": "I guess I could just delete the folder in <code>vendor</code> and make it a symlink, though that&#39;s a little scary since <code>dep</code> won&#39;t know about that"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1523456944, "post_id": 49777536, "comment_id": 86570619, "body": "don&#39;t do symlinks man"}, {"owner": {"reputation": 2684, "user_id": 784519, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8ed38b4892e7d5f106d8dfde7a4df4fe?s=128&d=identicon&r=PG", "display_name": "davidkomer", "link": "https://stackoverflow.com/users/784519/davidkomer"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523457274, "post_id": 49777536, "comment_id": 86570887, "body": "Need a solution here though ;)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1523457400, "post_id": 49777536, "comment_id": 86570997, "body": "If you don&#39;t care about what dm you&#39;re using ditch <code>dep</code> and use <code>govendor</code> instead. It allows you to update deps from <code>$GOPATH</code>."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1523461268, "post_id": 49777536, "comment_id": 86573931, "body": "Symlinks wouldn&#39;t work anyway, btw.  If you were working on package <code>foo</code>, and both your project and <code>foo</code> depended on and imported <code>bar</code>, then if you symlinked <code>foo</code> in, it would still be physically present in your actual GOPATH and would be using the version of <code>bar</code> present there (or failing to compile if it weren&#39;t present).  If you tried to pass a <code>bar.Baz</code> from your package to <code>foo</code>, you&#39;d get a type error.  Personally, we use govendor, which lets you update from GOPATH, but you can also simply move everything from the vendor folder to your GOPATH during development."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1523465967, "post_id": 49777536, "comment_id": 86576785, "body": "Don&#39;t just make your changes locally, make them and push them to the repo and let vendoring work normally."}, {"owner": {"reputation": 245, "user_id": 1496317, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8aaed7a968f12467148e2a8a8c4ac2c0?s=128&d=identicon&r=PG", "display_name": "tsdtsdtsd", "link": "https://stackoverflow.com/users/1496317/tsdtsdtsd"}, "edited": false, "score": 0, "creation_date": 1523466238, "post_id": 49777536, "comment_id": 86576914, "body": "I basically wouldn&#39;t vendor a package that I&#39;m still working on"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1523482258, "post_id": 49777536, "comment_id": 86584862, "body": "simply delete the corresponding folder from the <code>vendor</code>, git checkout the corresponding lib into your <code>gopath</code>, adjust its git position, do the actual code in both items, finally return to your dependency, bump/publish it, return to the main project, bump its dependencies, bump/publish it. So basically vendoring works well for dependencies that are truly independent, as soon as you have close concerns and/or life cycle, its a pain in the ass and having one master seems better."}], "owner": {"reputation": 2684, "user_id": 784519, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/8ed38b4892e7d5f106d8dfde7a4df4fe?s=128&d=identicon&r=PG", "display_name": "davidkomer", "link": "https://stackoverflow.com/users/784519/davidkomer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 149, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1523456383, "creation_date": 1523456383, "question_id": 49777536, "link": "https://stackoverflow.com/questions/49777536/how-to-develop-vendored-libraries", "title": "How to develop vendored libraries?", "body": "<p>I recently jumped back into an old Go project and migrated it to the <em>vendor</em> approach, using <code>dep</code></p>\n\n<p>It completed sucessfully and I now have a bunch of libs in the local projects <code>vendor/</code> directory. Great!</p>\n\n<p>However, I now want to work on one of those vendored libs, and see the changes in my main app live. The lib exists in its own project of course, doesn't live its life in this other apps vendor folder - and other local projects should be able to see the live changes too if necessary.</p>\n\n<p>I'm thinking something like <code>npm link</code>, to compare across ecosystems.</p>\n\n<p>How is this typically managed in Go?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9528667"}, "edited": false, "score": 0, "creation_date": 1523456470, "post_id": 49777482, "comment_id": 86570238, "body": "Thanks, my <code>main.go</code> file is in the same level of the \u2018cmd\u2019 \u2018vendor`folders  etc, where you suggest to put the global.go const ?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523456539, "post_id": 49777482, "comment_id": 86570293, "body": "At same level as <code>main.go</code> just make the struct exportable to export the variables."}, {"owner": {"user_type": "does_not_exist", "display_name": "user9528667"}, "edited": false, "score": 0, "creation_date": 1523456703, "post_id": 49777482, "comment_id": 86570417, "body": "thanks, it will be great if you can provide link to some git repo which follow this pattern. Thanks!"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523457420, "post_id": 49777482, "comment_id": 86571012, "body": "ok create a folder config which would contains a file. For more information on project layout Look at <a href=\"https://github.com/golang-standards/project-layout\" rel=\"nofollow noreferrer\">Project Layout</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user9528667"}, "edited": false, "score": 0, "creation_date": 1523458216, "post_id": 49777482, "comment_id": 86571607, "body": "you mean creating a file with structs under config ? any refernace please?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523458279, "post_id": 49777482, "comment_id": 86571664, "body": "I have mentioned a reference in my comments for project layout. Also there is a reason I am using a separate file Checkout my edited answer."}, {"owner": {"reputation": 1358, "user_id": 5275376, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a8bbb1e2df58ceebc9bbb5596bf823f3?s=128&d=identicon&r=PG&f=1", "display_name": "Shiva Kishore", "link": "https://stackoverflow.com/users/5275376/shiva-kishore"}, "edited": false, "score": 0, "creation_date": 1523459471, "post_id": 49777482, "comment_id": 86572599, "body": "This method would require to initialize the Constant struct right ? and the initialized object are to be exposed ?? that doesn&#39;t seem efficient... thoughts ??"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523459710, "post_id": 49777482, "comment_id": 86572790, "body": "No you need not to initialize anything. Take a go tour. Go lang not works like other OOP. There are no objects."}, {"owner": {"reputation": 1358, "user_id": 5275376, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a8bbb1e2df58ceebc9bbb5596bf823f3?s=128&d=identicon&r=PG&f=1", "display_name": "Shiva Kishore", "link": "https://stackoverflow.com/users/5275376/shiva-kishore"}, "edited": false, "score": 0, "creation_date": 1523519461, "post_id": 49777482, "comment_id": 86596492, "body": "hmmm but yet this confuses me a bit. you still have to do <code>c := Constants{const1:10, const2:100}</code> right ??"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 1, "last_activity_date": 1523458367, "last_edit_date": 1523458367, "creation_date": 1523456251, "answer_id": 49777482, "question_id": 49777328, "link": "https://stackoverflow.com/questions/49777328/sharing-constant-between-packages-in-golang/49777482#49777482", "title": "sharing constant between packages in golang", "body": "<p>I would suggest to declare struct with constant fields and import that struct in any package you wants to use the constants. </p>\n\n<pre><code>package cmd\ntype Constants struct{\n    const1 int\n    const2 int\n}\n</code></pre>\n\n<p>It would be better to have a separate file for constants. Create a file called global.go which contains all constant structs to be used in different packages that way your code would be cleaner.</p>\n\n<p><strong>Note:</strong> We require constants to be shared in multiple files, so it will be better to import the package containing constants. Rather than package containing methods and other details even if we do not need them.</p>\n"}, {"tags": [], "owner": {"reputation": 1358, "user_id": 5275376, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a8bbb1e2df58ceebc9bbb5596bf823f3?s=128&d=identicon&r=PG&f=1", "display_name": "Shiva Kishore", "link": "https://stackoverflow.com/users/5275376/shiva-kishore"}, "is_accepted": false, "score": 1, "last_activity_date": 1523459072, "creation_date": 1523459072, "answer_id": 49778552, "question_id": 49777328, "link": "https://stackoverflow.com/questions/49777328/sharing-constant-between-packages-in-golang/49778552#49778552", "title": "sharing constant between packages in golang", "body": "<p>You can use the constants as you describe, there is nothing wrong with it. But it is less intuitive.\n<br>\nHow i would go about this is having a root package <code>constants</code> and those can be used anywhere in the project.</p>\n\n<pre><code>go/src/my proj\n-cmd\n-constants\n--runners\n--otherpackage\n--package2\n--\u2026.\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9528667"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2904, "favorite_count": 0, "accepted_answer_id": 49777482, "answer_count": 2, "score": 1, "last_activity_date": 1523459072, "creation_date": 1523455821, "last_edit_date": 1523456054, "question_id": 49777328, "link": "https://stackoverflow.com/questions/49777328/sharing-constant-between-packages-in-golang", "title": "sharing constant between packages in golang", "body": "<p>I\u2019ve the following code which require multiple packages in <code>cmd</code> package</p>\n\n<pre><code>PATH_SEP = string(os.PathSeparator)\n</code></pre>\n\n<p>my project structure is like following</p>\n\n<pre><code>go/src/my proj\n-cmd\n--runners\n--otherpackage\n-- package2\n-- constants\n--\u2026. \n</code></pre>\n\n<p>in constants i put the code  </p>\n\n<pre><code>PATH_SEP = string(os.PathSeparator)\nconst2 etc\n</code></pre>\n\n<p>and in runners and package2/3 etc I use this constant.</p>\n\n<p>is it OK ? otherwise I need to duplicate the code for other packages .</p>\n"}, {"tags": ["node.js", "go", "fork", "child-process", "file-descriptor"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523452011, "post_id": 49775841, "comment_id": 86566869, "body": "In Go, you usually pass io.Readers and io.Writers around, not file descriptors."}, {"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523452102, "post_id": 49775841, "comment_id": 86566939, "body": "that might work, is there a way to send that from Golang to Node.js tho"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523452262, "post_id": 49775841, "comment_id": 86567072, "body": "Readers and writers are everywhere in the standard library, and <a href=\"https://golang.org/pkg/os/exec/#Cmd\" rel=\"nofollow noreferrer\">commands are no exception</a>. See Stdin, Stdout, and the *Pipe() methods."}, {"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523452516, "post_id": 49775841, "comment_id": 86567271, "body": "Do you like points because i will give you many points if you add a somewhat workng answer"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 0, "creation_date": 1523464623, "post_id": 49780120, "comment_id": 86576102, "body": "will have to go through this a few times, to understand the golang since I am new to golang. but in the node.js process, you want to write to the response stream, not to stdout. (unless, you have connected the stdout of the node.js process to the response stream in golang, which then would work). I was hoping however, that we could avoid stream all the data between the golang and node.js process, and instead reference the request/response through a file descriptor or something."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 0, "creation_date": 1523464887, "post_id": 49780120, "comment_id": 86576233, "body": "The render function connects stdout to ResponseWriter (here via the JSON decoder followed by Fprint). You could also read line-by-line and then write each line, for instance. The trick is to know when to stop reading."}, {"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 0, "creation_date": 1523465008, "post_id": 49780120, "comment_id": 86576308, "body": "this should work - thanks -  I was originally fantasizing about some way for node.js to write to the response directly instead of writing back into golang land."}, {"owner": {"reputation": 553, "user_id": 5483488, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/4ZHg7.jpg?s=128&g=1", "display_name": "Jake Lacey", "link": "https://stackoverflow.com/users/5483488/jake-lacey"}, "edited": false, "score": 0, "creation_date": 1547157456, "post_id": 49780120, "comment_id": 95106491, "body": "This would totally be a useful package, but I can&#39;t find anything!"}, {"owner": {"reputation": 10846, "user_id": 1673776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/0llsY.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/1673776/victor"}, "edited": false, "score": 0, "creation_date": 1550479813, "post_id": 49780120, "comment_id": 96268993, "body": "Thought of something similar but I couldn&#39;t have come with such a clean implementation. Great!"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 9, "last_activity_date": 1523463769, "creation_date": 1523463769, "answer_id": 49780120, "question_id": 49775841, "link": "https://stackoverflow.com/questions/49775841/using-react-for-server-side-rendering-with-golang/49780120#49780120", "title": "Using React for server-side rendering with Golang", "body": "<p>The following is a really rough draft, that uses a channel to implement a process pool, and shows how Go's io.Reader and io.Writer interfaces can be used to plug process and HTTP streams together. The code is also <a href=\"https://play.golang.org/p/QKe_3eIE1Fz\" rel=\"noreferrer\">on the playground</a>, for easy copy-paste.</p>\n\n<p>Note that I've written this in a hurry, just to show the general idea. Don't use this in production. I'm sure there are bugs, especially related to incomplete reads or writes. Processes exiting while idle are also not handled.</p>\n\n<pre><code>package main\n\nimport (\n        \"encoding/json\"\n        \"fmt\"\n        \"io\"\n        \"log\"\n        \"net/http\"\n        \"os\"\n        \"os/exec\"\n)\n</code></pre>\n\n<p>exec.Cmd.Stdin and exec.Cmd.Stdout are of type io.Reader and io.Writer respectively. However, it is more convenient for us to treat them the other way around. The StdinPipe and StdoutPipe methods facilitate exactly that, but they must be called only once and only before the process starts. So we store the pipes together with the command itself in a simple wrapper. This allows us to call nodeWrapper.Write([]byte) to send data to node, and nodeWrapper.Read() to read from its stdout. This is what I meant when I said in a comment you usually pass Readers and Writers around.</p>\n\n<pre><code>type nodeWrapper struct {\n        *exec.Cmd\n        io.Writer // stdin\n        io.Reader // stdout\n}\n\n// mustSpawnNode returns a started nodejs process that executes render.js\nfunc mustSpawnNode() nodeWrapper {\n        cmd := exec.Command(\"node\", \"render.js\")\n        cmd.Stderr = os.Stderr\n\n        stdin, err := cmd.StdinPipe()\n        if err != nil {\n                panic(err)\n        }\n\n        stdout, err := cmd.StdoutPipe()\n        if err != nil {\n                panic(err)\n        }\n\n        if err := cmd.Start(); err != nil {\n                panic(err)\n        }\n\n        return nodeWrapper{cmd, stdin, stdout}\n}\n</code></pre>\n\n<p>We use a simple channel-based ring buffer here to implement a process pool.</p>\n\n<p>The handler parses an HTTP request and extracts information that is required to render a page. In this example we simply pass the request Path to node. We then wait for a free node process and call render. render will write directly the ResponseWriter.</p>\n\n<pre><code>func main() {\n        pool := make(chan nodeWrapper, 4) // acts as a ring buffer\n        for i := 0; i &lt; cap(pool); i++ {\n                pool &lt;- mustSpawnNode()\n        }\n\n        log.Println(\"listening on :3000\")\n        log.Fatal(http.ListenAndServe(\":3000\", handler(pool)))\n}\n\nfunc handler(pool chan nodeWrapper) http.HandlerFunc {\n        return func(w http.ResponseWriter, r *http.Request) {\n                var renderArgs struct {\n                        Path string\n                }\n                renderArgs.Path = r.URL.Path\n\n                node := &lt;-pool\n\n                err := render(w, node, renderArgs)\n                if err != nil {\n                        // Assume the node process has failed and replace it\n                        // with a new one.\n                        node.Process.Kill()\n                        pool &lt;- mustSpawnNode()\n                        http.Error(w, err.Error(), 500)\n                } else {\n                        pool &lt;- node\n                }\n        }\n}\n</code></pre>\n\n<p>For the rendering we a) want to pass some data to the already running node process, and b) read from node's stdout and, more importantly, have to know when to stop reading.</p>\n\n<p>Usually we would set Stdout to our desired writer and simply run the process to completion. But in this case the process will not exit once it has finished rendering, so it will also not close stdout, and we need a replacement for the usual EOF signal.</p>\n\n<p>This is where we have to get creative and a find a solution that works well for you. I decided on the following protocol: We write a single line of JSON encoded data to node's stdin and then decode a single JSON encoded string from node's stdout. Ideally we wouldn't buffer the whole HTML document in memory but put it directly on the wire (by writing to w in real-time). But this keeps both the Go code and render.js real simple.</p>\n\n<pre><code>func render(w io.Writer, node nodeWrapper, args interface{}) error {\n        stdinErr := make(chan error, 1)\n        go func() {\n                stdinErr &lt;- json.NewEncoder(node).Encode(args)\n        }()\n\n        var html string\n        if err := json.NewDecoder(node).Decode(&amp;html); err != nil {\n                return err\n        }\n        if _, err := fmt.Fprint(w, html); err != nil {\n                return err\n        }\n\n        return &lt;-stdinErr\n}\n</code></pre>\n\n<p>And finally, the contents of render.js:</p>\n\n<pre><code>let lineReader = require('readline').createInterface({input: process.stdin})\n\nlineReader.on('line', (line) =&gt; {\n    let data = JSON.parse(line);\n\n    let html = \"\";\n    html += \"&lt;h1&gt;Path: \" + data.Path + \"&lt;/h1&gt;\\n\";\n    html += \"&lt;small&gt;PID: \" + process.pid + \"&lt;/small&gt;\\n\";\n\n    process.stdout.write(JSON.stringify(html)+\"\\n\")\n})\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4479, "favorite_count": 4, "answer_count": 1, "score": 1, "last_activity_date": 1523463769, "creation_date": 1523451604, "question_id": 49775841, "link": "https://stackoverflow.com/questions/49775841/using-react-for-server-side-rendering-with-golang", "title": "Using React for server-side rendering with Golang", "body": "<p>Say we want to use a Node.js process pool, to render some HTML using React. (I am not saying this is a good idea, just assume that this is the case, lulz).</p>\n\n<p>Is there a way to pass a reference to the request/response streams from Golang to a Node.js process? I think the cluster module for Node.js uses this technique, by passing a file descriptor or something like that. Note that the Node.js process pool (maybe 3 processes or so), would be children of the Golang process.</p>\n"}, {"tags": ["go", "environment-variables", "ubuntu-16.04", "hyperledger-fabric", "blockchain"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523449855, "post_id": 49775158, "comment_id": 86565188, "body": "First, that is not a valid GOPATH, it should not point to a bin directory. Second, sudo is running the command in a new environment without your env variables. You should never use sudo with <code>go get</code>"}, {"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1523449938, "post_id": 49775158, "comment_id": 86565243, "body": "^ but you should also update your go version currently go 1.10 is out which means the lowest supported version is go 1.8"}, {"owner": {"reputation": 598, "user_id": 5554070, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/b1FV3.jpg?s=128&g=1", "display_name": "Vishnu KR", "link": "https://stackoverflow.com/users/5554070/vishnu-kr"}, "edited": false, "score": 0, "creation_date": 1523450270, "post_id": 49775158, "comment_id": 86565504, "body": "Thank you please let me update the version,"}], "answers": [{"comments": [{"owner": {"reputation": 598, "user_id": 5554070, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/b1FV3.jpg?s=128&g=1", "display_name": "Vishnu KR", "link": "https://stackoverflow.com/users/5554070/vishnu-kr"}, "edited": false, "score": 0, "creation_date": 1523511047, "post_id": 49775381, "comment_id": 86592200, "body": "The problem was the version, The version which I installed has a bug, something like the GOPATH won&#39;t be consider if there is no go workspace configured. So i just removed my Go Lang and installed new version into the /home/go folder. then I configured the path by using GOROOT path variable.its working fine now."}, {"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "reply_to_user": {"reputation": 598, "user_id": 5554070, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/b1FV3.jpg?s=128&g=1", "display_name": "Vishnu KR", "link": "https://stackoverflow.com/users/5554070/vishnu-kr"}, "edited": false, "score": 0, "creation_date": 1523515375, "post_id": 49775381, "comment_id": 86594199, "body": "Ah, ok. Ubuntu has some very broken packages. Glad you could sort it out."}], "tags": [], "owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "is_accepted": false, "score": 2, "last_activity_date": 1523450240, "creation_date": 1523450240, "answer_id": 49775381, "question_id": 49775158, "link": "https://stackoverflow.com/questions/49775158/cannot-download-fabric-sdk-go-even-if-the-gopth-is-configured/49775381#49775381", "title": "Cannot download fabric-sdk-go even if the GOPTH is configured", "body": "<p>You are executing <code>go get</code> with <code>sudo</code>. That will cause all your env variables to be lost, as the command gets executed as user <code>root</code>.</p>\n\n<p>Usually this should not be necessary. $GOPATH is usually set to <code>$HOME/go/</code>. This is also the default value. You should set $GOPATH to this value. After that you do not have to call <code>go get</code> with <code>sudo</code>.</p>\n\n<p>And as pizza lord suggested, you should update your go version.</p>\n"}, {"comments": [{"owner": {"reputation": 598, "user_id": 5554070, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/b1FV3.jpg?s=128&g=1", "display_name": "Vishnu KR", "link": "https://stackoverflow.com/users/5554070/vishnu-kr"}, "edited": false, "score": 0, "creation_date": 1523510724, "post_id": 49776674, "comment_id": 86592090, "body": "Yes I tried exactly what you said . Thank you very much."}, {"owner": {"reputation": 9476, "user_id": 1155801, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/2ZLGy.png?s=128&g=1", "display_name": "appbootup", "link": "https://stackoverflow.com/users/1155801/appbootup"}, "reply_to_user": {"reputation": 598, "user_id": 5554070, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/b1FV3.jpg?s=128&g=1", "display_name": "Vishnu KR", "link": "https://stackoverflow.com/users/5554070/vishnu-kr"}, "edited": false, "score": 0, "creation_date": 1523771198, "post_id": 49776674, "comment_id": 86692687, "body": "You can accept the answer if it solved it. It helps others ."}], "tags": [], "owner": {"reputation": 9476, "user_id": 1155801, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/2ZLGy.png?s=128&g=1", "display_name": "appbootup", "link": "https://stackoverflow.com/users/1155801/appbootup"}, "is_accepted": false, "score": 1, "last_activity_date": 1523453948, "creation_date": 1523453948, "answer_id": 49776674, "question_id": 49775158, "link": "https://stackoverflow.com/questions/49775158/cannot-download-fabric-sdk-go-even-if-the-gopth-is-configured/49776674#49776674", "title": "Cannot download fabric-sdk-go even if the GOPTH is configured", "body": "<p>Remove the existing golang version packaged with ubuntu. Update you golang version to 1.9 or latest .</p>\n\n<pre><code>$ sudo apt-get remove golang-go \n$ sudo apt-get remove --auto-remove golang-go\n$ sudo add-apt-repository ppa:gophers/archive\n$ sudo apt-get update\n$ sudo apt-get install golang-1.10-go\n\nUpdate ~/.bash_profile with golang variables\nexport PATH=$PATH:\"/usr/lib/go-1.10/bin\"\nexport GOPATH=$HOME/go\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 598, "user_id": 5554070, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/b1FV3.jpg?s=128&g=1", "display_name": "Vishnu KR", "link": "https://stackoverflow.com/users/5554070/vishnu-kr"}, "edited": false, "score": 0, "creation_date": 1523509101, "post_id": 49779232, "comment_id": 86591552, "body": "I tried and fixed by re installing new version of Go lang. Thank you very much"}], "tags": [], "owner": {"reputation": 1358, "user_id": 5275376, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a8bbb1e2df58ceebc9bbb5596bf823f3?s=128&d=identicon&r=PG&f=1", "display_name": "Shiva Kishore", "link": "https://stackoverflow.com/users/5275376/shiva-kishore"}, "is_accepted": false, "score": 1, "last_activity_date": 1523461155, "creation_date": 1523461155, "answer_id": 49779232, "question_id": 49775158, "link": "https://stackoverflow.com/questions/49775158/cannot-download-fabric-sdk-go-even-if-the-gopth-is-configured/49779232#49779232", "title": "Cannot download fabric-sdk-go even if the GOPTH is configured", "body": "<p>There are 2 possible mistakes\n<br></p>\n\n<ol>\n<li>you have not configured <code>$GOPATH</code> correctly.</li>\n</ol>\n\n<p>try this.</p>\n\n<pre><code> mkdir ~/go-workspace\n</code></pre>\n\n<p>and in your <code>.bashrc</code> file, append this</p>\n\n<pre><code>export GOPATH=~/go-workspace\n</code></pre>\n\n<ol start=\"2\">\n<li>You are using <code>go get</code> with <code>sudo</code>.</li>\n</ol>\n\n<p>try :</p>\n\n<pre><code>go get -u github.com/hyperledger/fabric-sdk-go\n</code></pre>\n\n<p>if you get permission denied error, try</p>\n\n<pre><code>sudo chown user1 $(echo $GOPATH)\n</code></pre>\n"}], "owner": {"reputation": 598, "user_id": 5554070, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/b1FV3.jpg?s=128&g=1", "display_name": "Vishnu KR", "link": "https://stackoverflow.com/users/5554070/vishnu-kr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1523461155, "creation_date": 1523449663, "question_id": 49775158, "link": "https://stackoverflow.com/questions/49775158/cannot-download-fabric-sdk-go-even-if-the-gopth-is-configured", "title": "Cannot download fabric-sdk-go even if the GOPTH is configured", "body": "<p>I am a newbie in GOlang and Hyperledger fabric, I was just configuring the environment. But I got a weird error that is given bellow</p>\n\n<pre><code> user1@NTP-145UBUNTU:~$ go env\n GOARCH=\"amd64\"\n GOBIN=\"\"\n GOEXE=\"\"\n GOHOSTARCH=\"amd64\"\n GOHOSTOS=\"linux\"\n GOOS=\"linux\"\n GOPATH=\"/usr/lib/go-1.6/bin\"\n GORACE=\"\"\n GOROOT=\"/usr/lib/go-1.6\"\n GOTOOLDIR=\"/usr/lib/go-1.6/pkg/tool/linux_amd64\"\n GO15VENDOREXPERIMENT=\"1\"\n CC=\"gcc\"\n GOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0\"\n CXX=\"g++\"\n CGO_ENABLED=\"1\"\n user1@NTP-145UBUNTU:~$ sudo go get -u github.com/hyperledger/fabric-sdk-go\n [sudo] password for user1: \n package github.com/hyperledger/fabric-sdk-go: cannot download, $GOPATH not set. For more details see: go help gopath\n</code></pre>\n\n<p>It is saying that my GOPATH env variable is not set. I have configured it and its is showing in evn variable list also. If anyone in here faced this issue please help me. please note : I am using ubuntu 16 LTS</p>\n\n<p>thanks in advance.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1523440292, "post_id": 49771806, "comment_id": 86558655, "body": "Relevant: <a href=\"https://github.com/teh-cmc/go-internals\" rel=\"nofollow noreferrer\">github.com/teh-cmc/go-internals</a>"}, {"owner": {"reputation": 323, "user_id": 6039371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf93ffed843f66eeb081062f5f10de04?s=128&d=identicon&r=PG&f=1", "display_name": "FrontMage", "link": "https://stackoverflow.com/users/6039371/frontmage"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1523440515, "post_id": 49771806, "comment_id": 86558806, "body": "@zerkms Yeah, I&#39;ve been there, but I mean is there any lower level docs or tutorials?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 5, "creation_date": 1523443184, "post_id": 49771806, "comment_id": 86560616, "body": "If I get questions like that in an interview, it tells me I don&#39;t want to work there, because they&#39;re asking (mostly) irrelevant questions.  If, on the other hand, they ask &quot;How would you implement channels?&quot;, that&#39;s useful, because it explores <i>your</i> thought process, not your ability to regurgitate memorized information."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 15, "last_activity_date": 1576668325, "last_edit_date": 1576668325, "creation_date": 1523440919, "answer_id": 49772128, "question_id": 49771806, "link": "https://stackoverflow.com/questions/49771806/how-to-learn-internals-of-the-go-programming-language-for-noob/49772128#49772128", "title": "How to learn internals of the Go Programming Language? For noob", "body": "<p>The most organized collection of internal resources links is probably this:</p>\n\n<p><a href=\"https://github.com/emluque/golang-internals-resources\" rel=\"noreferrer\"><strong>Golang Internals Resources</strong></a></p>\n\n<p>Other than that, answers to these questions aren't collected in once place, but they are scattered in different blog posts.</p>\n\n<p>Slice internals: <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"noreferrer\">The Go Blog: usage and internals</a></p>\n\n<p>String internals: <a href=\"https://blog.golang.org/strings\" rel=\"noreferrer\">The Go Blog: Strings, bytes, runes and characters in Go</a></p>\n\n<p>Constants internals: <a href=\"https://blog.golang.org/constants\" rel=\"noreferrer\">The Go Blog: Constants</a></p>\n\n<p>Reflection insight: <a href=\"https://blog.golang.org/laws-of-reflection\" rel=\"noreferrer\">The Go Blog: The Laws of Reflection</a></p>\n\n<p>Interface internals: <a href=\"https://research.swtch.com/interfaces\" rel=\"noreferrer\">RSC: Go Data Structures: Interfaces</a></p>\n\n<p>Channel implementation: Overview on SO: <a href=\"https://stackoverflow.com/questions/19621149/how-are-go-channels-implemented\">How are Go channels implemented?</a></p>\n\n<p>Channel internals: <a href=\"https://docs.google.com/document/d/1yIAYmbvL3JxOKOjuCyon7JhW4cSv1wy5hC0ApeGMV9s/pub\" rel=\"noreferrer\">Go channel on steroids</a></p>\n\n<p>Map implementation: Overview on SO: <a href=\"https://stackoverflow.com/questions/37995648/golang-map-internal-implementation-how-does-it-search-the-map-for-a-key\">Golang map internal implementation - how does it search the map for a key?</a>; also related: <a href=\"https://stackoverflow.com/questions/59290522/gos-maps-under-the-hood/59292254#59292254\">Go&#39;s maps under the hood</a></p>\n\n<p>Map internals: <a href=\"https://www.ardanlabs.com/blog/2013/12/macro-view-of-map-internals-in-go.html\" rel=\"noreferrer\">Macro View of Map Internals In Go</a></p>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1523443065, "post_id": 49772651, "comment_id": 86560527, "body": "Well said. I&#39;ve been an interviewer in the past (for Java), and when asking internal-related questions, I was never after whether the candidate knew the actual details but more after his general knowledge and understanding of the context."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1523462308, "post_id": 49772651, "comment_id": 86574644, "body": "Is <i>&quot;cow-orkers&quot;</i> a typo or intended in your answer?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1523464145, "post_id": 49772651, "comment_id": 86575809, "body": "@icza, that&#39;s an american joke (I learned in the <a href=\"https://stackoverflow.com/questions/tagged/tcl\">tcl community</a>) :-)"}, {"owner": {"reputation": 323, "user_id": 6039371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf93ffed843f66eeb081062f5f10de04?s=128&d=identicon&r=PG&f=1", "display_name": "FrontMage", "link": "https://stackoverflow.com/users/6039371/frontmage"}, "edited": false, "score": 0, "creation_date": 1523499818, "post_id": 49772651, "comment_id": 86589238, "body": "Well explained, but there is still a question haunting me, that is go was designed to be simple, to keep the complexity hidden behind simplicity, therefore increases readability. So what exactly can we achieve by knowing the internals?  By that, I mean one can use goroutine and channels to build an application without even knowing the concept of thread and coroutine."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 323, "user_id": 6039371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf93ffed843f66eeb081062f5f10de04?s=128&d=identicon&r=PG&f=1", "display_name": "FrontMage", "link": "https://stackoverflow.com/users/6039371/frontmage"}, "edited": false, "score": 1, "creation_date": 1523525860, "post_id": 49772651, "comment_id": 86600499, "body": "@FrontMage Go was designed to be simple, which also means it has relatively few features compared to other languages. By knowing the internals you gain skill and knowledge to better craft the features you&#39;re in need of but are not provided by Go; or maybe achieve what you want with what Go <i>does</i> provide, using the features more optimally, potentially for things they were not meant in the first place. For example, channels were designed for safe communication between goroutines, yet they can be used for a simple and safe <a href=\"https://stackoverflow.com/a/38506367/1705598\">memory pool of objects</a>."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1523529771, "post_id": 49772651, "comment_id": 86603115, "body": "&#171;By that, I mean one can use goroutine and channels to build an application without even knowing the concept of thread and coroutine.&#187; this is simply not true. You can&#39;t do that without knowing <i>the concepts</i> of them. It may well be that you actually wanted to say &quot;\u2026without knowing the details of their implementation&quot;. Then yes, that would be true, but then it&#39;s what @icza said\u2026"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1523529999, "post_id": 49772651, "comment_id": 86603253, "body": "\u2026but then note that Go strikes a good balance between being reasonably high-level and\u2014at the same time\u2014 <i>close to the metal.</i> This latter property allows for two things. 1) Performance problems can be sanely assessed and analyzed (and Go has good tools to do that). But such analysis may require knowledge of how things work. 2) Knowing how things work allows you to think about ways of optimizing your algorythms, when and where it&#39;s needed."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 14, "last_activity_date": 1524053431, "last_edit_date": 1524053431, "creation_date": 1523442338, "answer_id": 49772651, "question_id": 49771806, "link": "https://stackoverflow.com/questions/49771806/how-to-learn-internals-of-the-go-programming-language-for-noob/49772651#49772651", "title": "How to learn internals of the Go Programming Language? For noob", "body": "<p>Let me warn you that you <em>may be</em> missing the real point of the interviewers.</p>\n\n<p>(Disclaimer: I do job interviews of Go programmers from time to time,\nfor a somewhat demanding project, so all of the below is my personal\nworld view. Still, it is shared by my cow-orkers ;-)).</p>\n\n<p>Most of the time, it's rather worthless for an employee to know precisely how this or that bit of the runtime (or the compiler) is implemented\u2014in part because this may change in any future release, and in part because there\ndo exist at least two up-to-date implementations of Go (\"the gc suite\", and\na part of GCC), and they all are free to implement a particular feature\nin any way they wish.</p>\n\n<p>What a (sensible) interviewer <em>should</em> really be interested in is\nwhether you understand \"the why\" of a particular core feature.</p>\n\n<p>Say, when they ask you to explain how a channel is implemented,\nwhat they <em>should</em> be interested to hear from you is that a channel\nprovides synchronization and may also provide buffering.\nSo you may tell them that a channel <em>is like</em>\na variable protected by a mutex\u2014for the case of an unbuffered channel,\u2014or\nlike a slice protected by a mutex.\nAnd then add that an upshot of using a channel instead of a hand-crafted\nsolution involving a mutex is that operations on channels\ncan be easily combined using the <code>select</code> statement, while implementing\na matching functionality without channels is possible (and by that time\nthey will probably would like to hear from you about <code>sync.Cond</code>)\nbut is really cumbersome and error-prone.</p>\n\n<p>It's not actually <em>completely</em> worthless to know nitty-gritty details\nof channels\u2014say to know that their implementation tries hard to lower\nthe price paid for the synchronization in the \"happy case\"\n(there is no contention at the\nmoment a goroutine accesses a channel), and that it is also clever about\nnot jumping straight into the kernel to sleep on a lock in the\n\"unhappy case\", but I see no point in knowng these details by heart.</p>\n\n<p>The same applies to goroutines. You should maintain a clear picture in what\nare the differences between an OS process and a thread running in it,\nand what <em>context</em> belongs to a thread\u2014that is, what is needed to be saved\nand restored when switching between the threads.\nAnd then the differences between an OS thread and a \"green thread\" which\na goroutine mostly is. It's okay to just know who schedules OS threads\nand who schedules goroutines, and why the latter is faster.\nAnd what are the benefits of having goroutines (the main one is network\npoller integrated into the scheduler (see <a href=\"http://journal.stuffwithstuff.com/2015/02/01/what-color-is-your-function/\" rel=\"nofollow noreferrer\">this</a>),\nthe second is dynamic stacks, the third is low context switching overhead\nmost of the time).</p>\n\n<p>My recommendation is to read through the list presented by @icza.</p>\n\n<p>And in addition to what you've asked about,\nI'd present the following list of what a good candidate\nshould be familiar with\u2014in the order from easiest to hardest (to grok):</p>\n\n<ul>\n<li><p>The mechanics of slices and <code>append</code>. You should know arrays exist\nand how they are different from slices.</p></li>\n<li><p>How interfaces are implemented.</p></li>\n<li><p>The dualistic nature of Go strings (given <code>s</code> contains a string,\nwhat is the difference between iterating over its contents via\n<code>for i := 0; i &lt; len(s); i++ { c := s[i] }</code> over <code>for i, c := range s {}</code>).</p>\n\n<p>Also: what kinds of data strings may contain\u2014you should know that it's\nperfectly okay to contain arbitrary binary data in them, UTF-8 is not\na requirement.</p>\n\n<p>The differences between <code>string</code> and <code>[]byte</code>.</p></li>\n<li><p>How blocking I/O is implemented (for the network; that's about\nthe netpoller integrated into the runtime).</p>\n\n<p>Knowing about the difference in handing non-network blocking I/O and\nsyscalls in general is a bonus.</p></li>\n<li><p>How the scheduler is implemented (those <code>P</code>s running <code>G</code>s on <code>M</code>s).</p></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 1714, "user_id": 4201748, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/77085485ce9b7c0ba971998b928048c0?s=128&d=identicon&r=PG", "display_name": "manigandand", "link": "https://stackoverflow.com/users/4201748/manigandand"}, "is_accepted": false, "score": 4, "last_activity_date": 1523450263, "last_edit_date": 1523450263, "creation_date": 1523449511, "answer_id": 49775100, "question_id": 49771806, "link": "https://stackoverflow.com/questions/49771806/how-to-learn-internals-of-the-go-programming-language-for-noob/49775100#49775100", "title": "How to learn internals of the Go Programming Language? For noob", "body": "<p>This GitHub repo would be helpful to get to know about go internals.</p>\n\n<p>You can get all go-internals related resources here.</p>\n\n<p><a href=\"https://github.com/emluque/golang-internals-resources\" rel=\"nofollow noreferrer\">A collection of articles and videos to understand Golang internals.</a></p>\n\n<p><a href=\"https://i.stack.imgur.com/WiGSs.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/WiGSs.png\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://github.com/teh-cmc/go-internals\" rel=\"nofollow noreferrer\">A book about the internals of the Go programming language</a></p>\n\n<p><a href=\"https://i.stack.imgur.com/G3rJ7.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/G3rJ7.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 323, "user_id": 6039371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/bf93ffed843f66eeb081062f5f10de04?s=128&d=identicon&r=PG&f=1", "display_name": "FrontMage", "link": "https://stackoverflow.com/users/6039371/frontmage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2707, "favorite_count": 6, "accepted_answer_id": 49772128, "answer_count": 3, "score": 8, "last_activity_date": 1576668325, "creation_date": 1523440040, "last_edit_date": 1576593548, "question_id": 49771806, "link": "https://stackoverflow.com/questions/49771806/how-to-learn-internals-of-the-go-programming-language-for-noob", "title": "How to learn internals of the Go Programming Language? For noob", "body": "<p>Recently I've participated several Go job interviews. The first one asked me <code>How is channel implemented?</code>, then the second one asked <code>How is goroutine implemented?</code>. Well as you can guess, the next one asked <code>How is a Go interface implemented?</code>.</p>\n\n<p>I've been using Go for six months, but to be honest I never did care or know these <code>Go internals</code>.</p>\n\n<p>I tried to learn these by reading the source code of Go, but can't really understand the quintessence.</p>\n\n<p>So the question is, for a noob in Go, how do I learn the Go internals?</p>\n"}, {"tags": ["mysql", "postgresql", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523439517, "post_id": 49771514, "comment_id": 86558100, "body": "Your <code>if err = rows.Err(); err != nil { return }</code> is entirely unnecessary. No need for an <code>if ... { return } return</code>.  Just do <code>return</code>."}, {"owner": {"reputation": 31, "user_id": 4607666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0855f307b0c837cff0515bee51776b58?s=128&d=identicon&r=PG&f=1", "display_name": "dev_medo", "link": "https://stackoverflow.com/users/4607666/dev-medo"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523442223, "post_id": 49771514, "comment_id": 86560002, "body": "@Flimzy for the phone is having an enumeration value : local , regional , international with each value so i created a struct having all the fields with the phone enumeration that&#39;s why i have to follow this method"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523442472, "post_id": 49771514, "comment_id": 86560174, "body": "@dev_medo: That&#39;s irrelevant to my point.  Having an &quot;if x do y else do y&quot; is identical to just &quot;y&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 4607666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0855f307b0c837cff0515bee51776b58?s=128&d=identicon&r=PG&f=1", "display_name": "dev_medo", "link": "https://stackoverflow.com/users/4607666/dev-medo"}, "edited": false, "score": 0, "creation_date": 1523441359, "post_id": 49771586, "comment_id": 86559443, "body": "for the phone is have an enumeration value : local , regional , international with each value so i created  a struct having all the fields with the phone enumeration  that&#39;s why i have to follow this method"}], "tags": [], "owner": {"reputation": 4278, "user_id": 3149524, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/4lMjS.jpg?s=128&g=1", "display_name": "cdaiga", "link": "https://stackoverflow.com/users/3149524/cdaiga"}, "is_accepted": false, "score": 3, "last_activity_date": 1523439396, "creation_date": 1523439396, "answer_id": 49771586, "question_id": 49771514, "link": "https://stackoverflow.com/questions/49771514/merge-two-queries-from-two-tables-as-a-one-struct/49771586#49771586", "title": "merge two queries from two tables as a one struct", "body": "<p>Just get the phone number too in the first query; don't repeat yourself.</p>\n\n<pre><code>db1.Query(\"Select ad_id, subject, phone FROM ads limit 200 \")\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 4607666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0855f307b0c837cff0515bee51776b58?s=128&d=identicon&r=PG&f=1", "display_name": "dev_medo", "link": "https://stackoverflow.com/users/4607666/dev-medo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1523439467, "creation_date": 1523439205, "last_edit_date": 1523439467, "question_id": 49771514, "link": "https://stackoverflow.com/questions/49771514/merge-two-queries-from-two-tables-as-a-one-struct", "title": "merge two queries from two tables as a one struct", "body": "<p>I have a struct called  Ads</p>\n\n<pre><code>type Ads struct {\n    ID      int `json:\"id\"`\n    Subject string `json:\"subject\"`\n    Phone   string `json:\"phone\"`\n}\n\nfunc GetAdsPostgres() (ads []Ads, err error) {\n    ads = make([]Ads, 0)\n    rows, err := db1.Query(\"Select ad_id, subject FROM ads limit 200 \")\n    for rows.Next() {\n        var ad Ads\n        rows.Scan(&amp;ad.ID, &amp;ad.Subject)\n\n        test := reflect.ValueOf(ad.ID)\n        addd := test.Interface().(int)\n        rows1, _ := db1.Query(\"Select phone FROM ads where ad_id=$1\", addd)\n        rows1.Scan(&amp;ad.Phone)\n\n        ads = append(ads, ad)\n        rows1.Close()\n    }\n\n    if err = rows.Err(); err != nil {\n        return\n    }\n    return\n}\n</code></pre>\n\n<p>without thinking of join the table because the phone has multipte enumeration values which I have to reform them as fields after </p>\n"}, {"tags": ["go", "memory-management", "slice"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1523439110, "post_id": 49771206, "comment_id": 86557801, "body": "Both slices and arrays are allocated at runtime. Whether they are allocated on the heap or stack may vary though (based on escape analysis)."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1523439228, "post_id": 49771206, "comment_id": 86557878, "body": "@icza is there any go reference for that. does <code>make</code> works like <code>new</code> to allocate space for slices."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1523439433, "post_id": 49771206, "comment_id": 86558028, "body": "Never confuse <code>make</code> with <code>new</code>. <code>new</code> returns a pointer to the zero value of the type passed. <code>make</code> returns a non-pointer to an initialized structure."}, {"owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "edited": false, "score": 0, "creation_date": 1523439510, "post_id": 49771206, "comment_id": 86558095, "body": "This blog should tell you everything you want to know about how slices are implemented in Go <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">blog.golang.org/go-slices-usage-and-internals</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1523439725, "post_id": 49771206, "comment_id": 86558242, "body": "Implicitly it is the consequence of this: arrays, slices and their elements are addressable, you can take their (memory) address. A valid memory address only exists at runtime, so slices / array cannot be allocated at compile time."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "edited": false, "score": 0, "creation_date": 1523439732, "post_id": 49771206, "comment_id": 86558246, "body": "@FranckJeannin Nothing here is written about memory allocation to runtime or compile time. It is only telling the usage of slices."}, {"owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "edited": false, "score": 0, "creation_date": 1523440299, "post_id": 49771206, "comment_id": 86558662, "body": "The missing link here is understanding that &#39;make&#39; does the (dynamic) allocation. Slices can grow and are garbage collected so compile-time allocation doesn&#39;t really make sense."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1523441944, "post_id": 49771206, "comment_id": 86559816, "body": "@icza:  &quot;slices and their elements are addressable&quot; <code>string</code>s are immutable, so they are a special case."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1523442109, "post_id": 49771206, "comment_id": 86559923, "body": "@peterSO Yes, <code>string</code> is implemented using a (read-only) byte slice, but the <code>string</code> type is not a slice type, <code>reflect.TypeOf(&quot;&quot;).Kind()</code> returns a different kind than <code>reflect.TypeOf([]byte{}).Kind()</code>."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1523442123, "post_id": 49771206, "comment_id": 86559936, "body": "@peterSO Please I am confused a little. Can anyone elaborate as an answer that would be really helpful."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1523443013, "post_id": 49771206, "comment_id": 86560507, "body": ",@icza: &quot;slices and their elements are addressable&quot;. Since <code>strings</code> are immutable, <code>string</code> and therefore slice of <code>string</code>, elements are not addressable. : <code>s := &quot;string&quot;; p := &amp;s[0];</code> error <code>cannot take the address of s[0]</code> and <code>s := &quot;string&quot;[0:1]; p := &amp;s[0]</code> error <code>cannot take the address of s[0]</code>."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1523443243, "post_id": 49771206, "comment_id": 86560655, "body": "@Himanshu: If you were allowed to obtain a pointer to an element of a <code>string</code> you could change the value of the element. But, <code>string</code>s are immutable, so that is not allowed."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1523443564, "post_id": 49771206, "comment_id": 86560870, "body": "@peterSO <code>&quot;string&quot;[0:1]</code> is not a slice, it&#39;s a (sub)string. Similarly, <code>&amp;s[0]</code> would be taking the address of an index expression indexing a <i>string</i>, not a <i>slice</i> (even though in the background it will index the byte slice of the string)."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1523443739, "post_id": 49771206, "comment_id": 86561033, "body": "@icza seems like I am also looking at the way that peter is taking string variable not slice of strings. I have a query that slice it self is a pointer to first index of array of elements. Then why to take address of element."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1523445645, "creation_date": 1523445645, "answer_id": 49773772, "question_id": 49771206, "link": "https://stackoverflow.com/questions/49771206/go-slice-stored-in-dynamic-memory-or-static-memory/49773772#49773772", "title": "Go slice stored in dynamic memory or static memory", "body": "<pre><code>type slice struct {\n    array unsafe.Pointer\n    len   int\n    cap   int\n}\n</code></pre>\n\n<p>The slice descriptor is a <code>struct</code>. <code>make([]type, len, cap)</code> returns a <code>slice</code> descriptor with a pointer to an underlying array with the given <code>type</code>, <code>len</code> (length), and <code>cap</code> (capacity). The slice descriptor and/or its underlying array are allocated on the stack and/or the heap.</p>\n\n<pre><code>type string struct {\n    array unsafe.Pointer\n    len   int\n}\n</code></pre>\n\n<p>The string descriptor is a <code>struct</code> with a pointer to an underlying <code>byte</code> array with length <code>len</code>. Since <code>strings</code> are immutable, the capacity is redundant; it is always equal to the length. The string descriptor, from a literal or conversion, and/or its underlying array are allocated on the stack and/or the heap.</p>\n\n<p>Consider a string as a special form of a <code>byte</code> slice. For example, slice expressions apply to both.</p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language\n  Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">Slice expressions</a></p>\n  \n  <p>Slice expressions construct a substring or slice from a string, array,\n  pointer to array, or slice. There are two variants: a simple form that\n  specifies a low and high bound, and a full form that also specifies a\n  bound on the capacity.</p>\n</blockquote>\n"}], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1033, "favorite_count": 2, "accepted_answer_id": 49773772, "answer_count": 1, "score": 2, "last_activity_date": 1523445645, "creation_date": 1523438349, "last_edit_date": 1523438693, "question_id": 49771206, "link": "https://stackoverflow.com/questions/49771206/go-slice-stored-in-dynamic-memory-or-static-memory", "title": "Go slice stored in dynamic memory or static memory", "body": "<p>I was searching for memory allocations of slices whether static at compile time or dynamic on fly. Since slices are pointers to the array in back and I have studied that for dynamic memory allocation, pointers are crucial. So what is the allocation of slice and how about maps.</p>\n"}, {"tags": ["go", "pprof"], "comments": [{"owner": {"reputation": 23, "user_id": 7076565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/385b866e968c40b99bc285384be0ce19?s=128&d=identicon&r=PG&f=1", "display_name": "B.Zamalutdinov", "link": "https://stackoverflow.com/users/7076565/b-zamalutdinov"}, "edited": false, "score": 0, "creation_date": 1523444297, "post_id": 49771048, "comment_id": 86587502, "body": "currently, all external tools using entire pprof possibilities, so I thing you can find everything inside pprof docs"}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523450864, "post_id": 49771048, "comment_id": 86565968, "body": "what&#39;s the type of the generated image? ( e.g. -inuse_space      Display in-use memory size   -inuse_objects    Display in-use object counts   -alloc_space      Display allocated memory size   -alloc_objects    Display allocated object counts)"}], "answers": [{"tags": [], "owner": {"reputation": 4323, "user_id": 370364, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/58cb3fbbdbcc34cda410ff6f366ae83a?s=128&d=identicon&r=PG", "display_name": "PiersyP", "link": "https://stackoverflow.com/users/370364/piersyp"}, "is_accepted": false, "score": 3, "last_activity_date": 1571651490, "last_edit_date": 1571651490, "creation_date": 1571449143, "answer_id": 58459836, "question_id": 49771048, "link": "https://stackoverflow.com/questions/49771048/golang-pprof-full-call-graph/58459836#58459836", "title": "Golang pprof full call graph", "body": "<p>I've been using the following approach to see everything.</p>\n\n<p><code>go tool pprof -http :9999 -edgefraction 0 -nodefraction 0 -nodecount 100000 cpu.prof</code></p>\n\n<p>This can give you a huge graph which can be quite difficult to follow. To help with that you can click on the offending node in the web view and select 'Focus' from the 'Refine' menu in the top left corner. This provides a view of that node and all its callers and callees.</p>\n\n<p>The key options to use in order to see everything are:</p>\n\n<pre><code>--nodecount=&lt;n&gt;    Show at most so many nodes [default=80]\n--nodefraction=&lt;f&gt; Hide nodes below &lt;f&gt;*total [default=.005]\n--edgefraction=&lt;f&gt; Hide edges below &lt;f&gt;*total [default=.001]\n</code></pre>\n\n<p>You can also use <code>-focus</code> on the command line to speed up rendering of large graphs.</p>\n\n<pre><code>--focus=&lt;regexp&gt; Focus on nodes matching &lt;regexp&gt;\n</code></pre>\n"}], "owner": {"reputation": 1789, "user_id": 4056372, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/285fed6a5df00f048a00732292105729?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/4056372/andrew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1617, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1571651490, "creation_date": 1523437884, "last_edit_date": 1523438682, "question_id": 49771048, "link": "https://stackoverflow.com/questions/49771048/golang-pprof-full-call-graph", "title": "Golang pprof full call graph", "body": "<p>I'm kinda new to <code>pprof</code>. I've started CPU profiling, and after a bit of time checked the top25. This is what I got:</p>\n\n<pre><code>Showing top 25 nodes out of 174\n      flat  flat%   sum%        cum   cum%\n  1.01mins 21.92% 21.92%   1.10mins 23.83%  time.Time.AppendFormat\n  0.26mins  5.56% 27.48%   0.26mins  5.56%  type..eq.[65]runtime.sigTabT\n  0.23mins  5.07% 32.55%   0.23mins  5.07%  type..hash.[3]runtime.symbol_key\n  0.15mins  3.14% 35.69%   0.15mins  3.14%  type..hash.[9]string\n  ...\n</code></pre>\n\n<p>I thought that's all cool, I just need to get rid of that time function. Then realized, I don't even use anything from the time pkg, so it must be either a third party lib, or one of the go internal functions.</p>\n\n<p>So I've generated the graph with the <code>-web</code> flag, so I can see which function calls it, but it doesn't really show directly. Is there any way to track it down where it's coming from?</p>\n"}, {"tags": ["go", "memory-management"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1523434008, "post_id": 49769508, "comment_id": 86554369, "body": "You can &quot;preallocate&quot; a map with big capacity with <code>make(map[int]string, 1000)</code> for 1000 elements, so no reallocation will occur."}, {"owner": {"reputation": 1043, "user_id": 1847559, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/19IAr.png?s=128&g=1", "display_name": "tworabbits", "link": "https://stackoverflow.com/users/1847559/tworabbits"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1523434180, "post_id": 49769508, "comment_id": 86554479, "body": "Yepp that&#39;s right, but what if I can&#39;t? There might be cases where I can&#39;t predict the total length, but I might know in which dimensions it will grow when it exceeds the capacity."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1523435296, "post_id": 49769508, "comment_id": 86555132, "body": "Even if you figure out how it works in your configuration, it&#39;s best not to rely on  such internals as it may vary based on what compiler is used, version, OS and architecture. To get a glimpse of how to &quot;measure&quot; it, this might be useful: <a href=\"https://stackoverflow.com/questions/46278003/how-much-memory-do-golang-maps-reserve/46278240#46278240\">How much memory do golang maps reserve?</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523437641, "post_id": 49769508, "comment_id": 86556757, "body": "This is an implementation detail, and therefore can/does vary between platforms, compilers, and versions."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1523440169, "post_id": 49769508, "comment_id": 86558562, "body": "<a href=\"https://stackoverflow.com/a/31790816/720999\"><code>append</code> and <code>runtime.growslice</code></a> \u2014 still valid for 1.8; did not check for later versions."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1523440317, "post_id": 49769508, "comment_id": 86558666, "body": "The problem with finding the actual runtime code is two-fold: 1) bits of it may be coded in the platform-specific assembly; 2) bits of it may be coded in Go but on the level which is close to the <a href=\"https://golang.org/doc/go1.8#compiler\" rel=\"nofollow noreferrer\">SSA engine</a>, so the location and the code are a bit weird\u2014when looked at from the outside ;-)"}, {"owner": {"reputation": 1043, "user_id": 1847559, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/19IAr.png?s=128&g=1", "display_name": "tworabbits", "link": "https://stackoverflow.com/users/1847559/tworabbits"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523441741, "post_id": 49769508, "comment_id": 86559699, "body": "@Flimzy: I am not planning to fiddle around with the internals... I can still grow slices and maps before the runtime would do the job for me when hit the capacity and keep inserting."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523442328, "post_id": 49769508, "comment_id": 86560069, "body": "@tworabbits: I wasn&#39;t suggesting that you would &quot;fiddle with internals&quot;--only that the answer to your question is not universal."}], "answers": [{"comments": [{"owner": {"reputation": 1043, "user_id": 1847559, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/19IAr.png?s=128&g=1", "display_name": "tworabbits", "link": "https://stackoverflow.com/users/1847559/tworabbits"}, "edited": false, "score": 0, "creation_date": 1523441494, "post_id": 49770276, "comment_id": 86559541, "body": "Thanks for your answer, the link helps. I was specifically looking for <a href=\"https://go.googlesource.com/go/+/master/src/runtime/slice.go#112\" rel=\"nofollow noreferrer\">L112</a>. Looks like size is doubled for capacity &lt; 1024 and factor 1.25 for capacity &gt; 1024."}, {"owner": {"reputation": 1043, "user_id": 1847559, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/19IAr.png?s=128&g=1", "display_name": "tworabbits", "link": "https://stackoverflow.com/users/1847559/tworabbits"}, "edited": false, "score": 0, "creation_date": 1523441986, "post_id": 49770276, "comment_id": 86559839, "body": "Not sure if I wasn&#39;t clear in my question, but wouldn&#39;t it be possible to get some sort of control by allocating a new map (with lets say double size) when hitting the map capacity and then copying the old into the new map?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 1043, "user_id": 1847559, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/19IAr.png?s=128&g=1", "display_name": "tworabbits", "link": "https://stackoverflow.com/users/1847559/tworabbits"}, "edited": false, "score": 0, "creation_date": 1523442341, "post_id": 49770276, "comment_id": 86560077, "body": "@tworabbits yes it&#39;s possible but since you don&#39;t have access to the underlying constructs of the map, probably copying over using the exposed API will be so slow that you&#39;re better off without it."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": false, "score": 1, "last_activity_date": 1523435613, "creation_date": 1523435613, "answer_id": 49770276, "question_id": 49769508, "link": "https://stackoverflow.com/questions/49769508/how-does-go-perform-map-slice-reallocations/49770276#49770276", "title": "How does go perform map/slice reallocations?", "body": "<p>The gist of it is that roughly speaking and barring edge cases, the capacity is usually doubled and there is no control over it. You can implement your own grow/copy mechanism if you need to. You can read the source code here: <a href=\"https://go.googlesource.com/go/+/master/src/runtime/slice.go#89\" rel=\"nofollow noreferrer\">https://go.googlesource.com/go/+/master/src/runtime/slice.go#89</a></p>\n"}], "owner": {"reputation": 1043, "user_id": 1847559, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/19IAr.png?s=128&g=1", "display_name": "tworabbits", "link": "https://stackoverflow.com/users/1847559/tworabbits"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 227, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1523435613, "creation_date": 1523433290, "question_id": 49769508, "link": "https://stackoverflow.com/questions/49769508/how-does-go-perform-map-slice-reallocations", "title": "How does go perform map/slice reallocations?", "body": "<p>I couldn't find it in <a href=\"https://golang.org/src/runtime/\" rel=\"nofollow noreferrer\">the runtime</a>, but I am wondering how go decides how much memory is likely to be needed when reallocating maps or slices. So when we look at this (same would apply to slices):</p>\n\n<pre><code>test := map[int]string{}\nfor i := 0; i &lt; 1000; i++ {\n  test[i] = fmt.Sprintf(\"test-%d\", i)\n}\n</code></pre>\n\n<p>How much memory will be allocated at first and how many reallocations take place during the loop?</p>\n\n<p>I am asking this because I am trying to figure out if there are cases where it makes sense to apply a custom reallocation strategy (i.e. use an array instead of a slice and grow the array when needed by a factor which likely meets my application's requirements).</p>\n"}, {"tags": ["pointers", "go", "error-handling", "interface", "null"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523431096, "post_id": 49768691, "comment_id": 86552687, "body": "<a href=\"https://golang.org/doc/faq#nil_error\" rel=\"nofollow noreferrer\">golang.org/doc/faq#nil_error</a>"}, {"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1523432804, "post_id": 49768691, "comment_id": 86553684, "body": "There is a really good gopher con talk about the different types of nil, including this common error where an interface pointer nil I&#39;d not the same as an interface nil. <a href=\"https://youtu.be/ynoY2xz-F8s\" rel=\"nofollow noreferrer\">youtu.be/ynoY2xz-F8s</a>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1523526855, "last_edit_date": 1523526855, "creation_date": 1523475965, "answer_id": 49783334, "question_id": 49768691, "link": "https://stackoverflow.com/questions/49768691/how-to-return-custom-errors-without-causing-problems-with-nil-values/49783334#49783334", "title": "How to return custom errors without causing problems with nil values", "body": "<p>For background, see <a href=\"https://stackoverflow.com/questions/29138591/hiding-nil-values-understanding-why-golang-fails-here/29138676#29138676\">Hiding nil values, understanding why golang fails here</a>; and <a href=\"https://golang.org/doc/faq#nil_error\" rel=\"nofollow noreferrer\">Go FAQ: Why is my nil error value not equal to nil?</a></p>\n\n<p>Go requires you to be explicit about types and conversions (e.g. you can't add a value of type <code>int32</code> to a value of type <code>int</code>), but interface conversions and automatic interface value creation is exception to this rule. Whenever a value of interface type is required, you may use any value whose type implements (satisfies) the interface type, and the interface value will be automatically created for you.</p>\n\n<p>Your function:</p>\n\n<pre><code>func WrapFailCustom(dofail bool) error {\n    return FailCustom(dofail)\n}\n</code></pre>\n\n<p><code>WrapFailCustom()</code> has a return type <code>error</code>, and you try to return the result of the <code>FailCustom()</code> function, whose return type is <code>*CustomError</code> which is not the same as <code>error</code>! This should raise a red flag!</p>\n\n<p>What / how will be returned? An interface value of <code>error</code> type will be automatically created! <code>*CustomError</code> implements <code>error</code>, so it's all good, but as you experienced, if the pointer is <code>nil</code>, this implicit value wrapping will not result in an interface value being <code>nil</code>, but rather a non-<code>nil</code> interface value wrapping the value <code>nil</code> and the type <code>*CustomError</code>.</p>\n\n<p>The solution?</p>\n\n<h2>Taking care of the root cause</h2>\n\n<p>Is it really justified / does it have any value for <code>FailCustom()</code> to have a return type other than <code>error</code>? If not, easiest would be to deal with the \"problem\" right where it originates from:</p>\n\n<pre><code>func FailCustom(dofail bool) error {\n    if dofail {\n        return &amp;CustomError{Code: 42}\n    }\n    return nil\n}\n</code></pre>\n\n<p>And then all your problems go away. If you follow the \"Go way\" to return errors using the <code>error</code> type, this is perfectly enough and satisfying. You don't even need the <code>WrapFailCustom()</code> function anymore.</p>\n\n<h2>Manually accounting for it in <code>WrapFailCustom()</code></h2>\n\n<p>If you do need <code>FailCustom()</code> to return the custom <code>*CustomError</code> type, then you need to account for it \"manually\" in <code>WrapFailCustom()</code>. I would write it this way:</p>\n\n<pre><code>func WrapFailCustom(dofail bool) error {\n    if customErr := FailCustom(dofail); customErr != nil {\n        return customErr \n    }\n    return nil\n}\n</code></pre>\n\n<p>(Note that I deliberately used a different <code>customErr</code> name and not <code>err</code>, signalling that it's not of type <code>error</code>, and care should be taken how it will be converted to <code>error</code>.)</p>\n\n<h2>Using a custom <code>error</code> type that is an interface type</h2>\n\n<p>If you want to / need to use your custom error type, another good approach would be to create an interface type that describes the \"extra\" functionality it incorporates:</p>\n\n<pre><code>type CustomErr interface {\n    Error // Embed error interface\n    Code() int\n}\n</code></pre>\n\n<p>And then we also need the implementation of this <code>Code()</code> method:</p>\n\n<pre><code>func (e *CustomError) Code() int { return e.Code }\n</code></pre>\n\n<p>What's the use of this?</p>\n\n<p>The root cause will be dealt with by returning a value of this <em>interface</em> type (and <em>not</em> a pointer):</p>\n\n<pre><code>func FailCustom(dofail bool) CustomErr {\n    if dofail {\n        return &amp;CustomError{Code: 42}\n    }\n    return nil\n}\n</code></pre>\n\n<p>The implicit interface value will be created in <code>FailCustom()</code>.</p>\n\n<p>Moreover, <code>WrapFailCustom()</code> becomes needless / useless. <code>FailCustom()</code> returns a value that is both an <code>error</code>, and you can get the <code>Code</code> from it using its <code>Code()</code> method. The returned value is aleady an interface value, and it <em>is</em> an <code>error</code>, you can use it where an <code>error</code> value is needed. The concrete type <code>CustomError</code> can even be made unexported (hidden).</p>\n\n<p>Related to this approach, check out <a href=\"https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully\" rel=\"nofollow noreferrer\">Dave Cheney: Don\u2019t just check errors, handle them gracefully</a>, especially the section titled: <strong>Assert errors for behaviour, not type</strong>.</p>\n"}], "owner": {"reputation": 1286, "user_id": 1071090, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/vdLa6.jpg?s=128&g=1", "display_name": "Peter Hommel", "link": "https://stackoverflow.com/users/1071090/peter-hommel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1631, "favorite_count": 1, "accepted_answer_id": 49783334, "answer_count": 1, "score": 2, "last_activity_date": 1523526855, "creation_date": 1523430670, "last_edit_date": 1523516706, "question_id": 49768691, "link": "https://stackoverflow.com/questions/49768691/how-to-return-custom-errors-without-causing-problems-with-nil-values", "title": "How to return custom errors without causing problems with nil values", "body": "<p>I have implemented a custom error type and do get strange behaviour with regard to nil values. When I do pass the custom error along as standard error interface, this is never recognized as nil, even if the custom error was returned as nil.</p>\n\n<p>Have a look at this little test program:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\ntype CustomError struct {\n    Code int\n}\n\nfunc (e *CustomError) Error() string {\n    return strconv.Itoa(e.Code)\n}\n\nfunc FailCustom(dofail bool) *CustomError {\n    if dofail {\n        return &amp;CustomError{Code: 42}\n    } else {\n        return nil\n    }\n}\n\nfunc WrapFailCustom(dofail bool) error {\n    return FailCustom(dofail)\n}\n\nfunc main() {\n    err := WrapFailCustom(false)\n    if err == nil {\n        fmt.Println(\"err is nil\")\n    } else {\n        fmt.Println(\"err is not nil\")\n    }\n}\n</code></pre>\n\n<p>Same in playground: <a href=\"https://play.golang.org/p/7bqeDw5B5fU\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7bqeDw5B5fU</a></p>\n\n<p><strong>This does actually output \"err is not nil\"</strong>.</p>\n\n<p>I would have expected the nil value of type *CustomError to be implicitly cast to a nil value of type error. Can anybody explain to me, why this is not the case and how to correctly propagate nil values of custom error types?</p>\n\n<p><strong>Edit:</strong>\nExplanation for this can be found <a href=\"https://golang.org/doc/faq#nil_error\" rel=\"nofollow noreferrer\">here</a> as pointed out by Iain Duncan</p>\n\n<p>To further explore the issue, let's consider the following modification to WrapFailCustom:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func WrapFailCustom(dofail bool) error {\n    err := FailCustom(dofail)\n    if err == nil {\n        return nil\n    } else {\n        return err\n    }\n}\n</code></pre>\n\n<p>This does actually return \"err is nil\": <a href=\"https://play.golang.org/p/mEKJFyk5zqf\" rel=\"nofollow noreferrer\">https://play.golang.org/p/mEKJFyk5zqf</a></p>\n\n<p>I do feel really bad with depending on this as solution, as it is easily forgotten when working with function that do spit out my custom error. Is there better way of making custom errors that does prevent this \"ambiguity\" from being possible to happen? The obvious solution of just using the basic error type all the time, seems really inconvenient for the code that consumes functions like WrapFailCustom, so I would like to avoid this...</p>\n"}, {"tags": ["go", "marshalling"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1523427532, "post_id": 49767223, "comment_id": 86550823, "body": "Data type of field <code>f</code> and <code>g</code> is unexported. Easyjson should report those error."}, {"owner": {"reputation": 9, "user_id": 8479136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d57340d7af5494008663f27c7534e2e?s=128&d=identicon&r=PG&f=1", "display_name": "hadi2f244", "link": "https://stackoverflow.com/users/8479136/hadi2f244"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1523428174, "post_id": 49767223, "comment_id": 86551137, "body": "I delete both of them, but it still sticks. I delete sync.RWMutex, now it works. So there are some problems with sync.RWMutex."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1523430271, "post_id": 49767223, "comment_id": 86552227, "body": "I can&#39;t reproduce your issue. Without <code>f</code> and <code>g</code> field (i.e. <code>sync.RWMutex</code> is not removed), easyjson is able to generate the file by invoking <code>easyjson -all filename.go</code>."}, {"owner": {"reputation": 9, "user_id": 8479136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d57340d7af5494008663f27c7534e2e?s=128&d=identicon&r=PG&f=1", "display_name": "hadi2f244", "link": "https://stackoverflow.com/users/8479136/hadi2f244"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1523435821, "post_id": 49767223, "comment_id": 86555477, "body": "I test it again, it works! So how can i use imported structs ?!"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1523436393, "post_id": 49767223, "comment_id": 86555874, "body": "You need to export your struct in order to be accessible from other package (i.e. the first letter of the struct&#39;s name must be upper case letter). For more detail, see <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">Exported Identifiers</a>."}, {"owner": {"reputation": 9, "user_id": 8479136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d57340d7af5494008663f27c7534e2e?s=128&d=identicon&r=PG&f=1", "display_name": "hadi2f244", "link": "https://stackoverflow.com/users/8479136/hadi2f244"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1523437910, "post_id": 49767223, "comment_id": 86556985, "body": "Thank you. But the main problem was other marshaller package(ffjson) that was used simultaneously.It&#39;s needed to run easyjson command on imported structs too."}], "owner": {"reputation": 9, "user_id": 8479136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d57340d7af5494008663f27c7534e2e?s=128&d=identicon&r=PG&f=1", "display_name": "hadi2f244", "link": "https://stackoverflow.com/users/8479136/hadi2f244"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 97, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1523436019, "creation_date": 1523424834, "last_edit_date": 1523436019, "question_id": 49767223, "link": "https://stackoverflow.com/questions/49767223/easyjson-sticks-on-easy-file-creating", "title": "Easyjson sticks on _easy file creating", "body": "<p><a href=\"https://github.com/mailru/easyjson\" rel=\"nofollow noreferrer\">Easyjson</a> works well for simple codes, but it sticks when i run  <code>easyjson -run filename.go</code> for code that looks like:</p>\n\n<pre><code>package pack3\n\nimport (\n    \"myProj/pack1/pack1_1\"\n    \"myProj/pack2\"\n    \"sync\"\n)\n\ntype myStruct struct {\n    sync.RWMutex\n    Name    string          \n    a   map[string]map[string]bool\n    b   map[string]map[string]int\n    c   map[string]float32           \n    d   map[string]int\n    e   []string               \n    f   map[string]pack1_1.struct1   \n    g   map[string]pack2.struct2 \n}\n</code></pre>\n\n<p>There is no error when it sticks, but two files are created(filename_easy.go.tmp and easyjson_bootstrp[random_number].go). </p>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 4966, "user_id": 3605497, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mV6Nc.jpg?s=128&g=1", "display_name": "Tripp Kinetics", "link": "https://stackoverflow.com/users/3605497/tripp-kinetics"}, "edited": false, "score": 0, "creation_date": 1523421849, "post_id": 49766629, "comment_id": 86548699, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/12398359/throw-all-goroutines-are-asleep-deadlock\">throw: all goroutines are asleep - deadlock</a>"}, {"owner": {"reputation": 157, "user_id": 9063101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh3.googleusercontent.com/-7wU7yyw74JQ/AAAAAAAAAAI/AAAAAAAAABE/JD5vjEZjb2A/photo.jpg?sz=128", "display_name": "YuanZheng Hu", "link": "https://stackoverflow.com/users/9063101/yuanzheng-hu"}, "reply_to_user": {"reputation": 4966, "user_id": 3605497, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mV6Nc.jpg?s=128&g=1", "display_name": "Tripp Kinetics", "link": "https://stackoverflow.com/users/3605497/tripp-kinetics"}, "edited": false, "score": 0, "creation_date": 1523422338, "post_id": 49766629, "comment_id": 86548829, "body": "@TrippKinetics I guess for that question, he closed  the channel, and use another one to output the result, but what I want to say is, is there a way to print the elements in channel using only one channel, without using receive function in another goroutine"}, {"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "edited": false, "score": 0, "creation_date": 1523428385, "post_id": 49766629, "comment_id": 86551233, "body": "If you want to put all the strings down a single channel you can use a sync.WaitGroup to wait until all the go routines have completed then close the channel in the main go routine"}], "answers": [{"comments": [{"owner": {"reputation": 157, "user_id": 9063101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh3.googleusercontent.com/-7wU7yyw74JQ/AAAAAAAAAAI/AAAAAAAAABE/JD5vjEZjb2A/photo.jpg?sz=128", "display_name": "YuanZheng Hu", "link": "https://stackoverflow.com/users/9063101/yuanzheng-hu"}, "edited": false, "score": 0, "creation_date": 1523434290, "post_id": 49767833, "comment_id": 86554545, "body": "Thanks! I also did a version using WaitGroup, but it gave me the same error, the code is above, why will that generate error ? do I have to use anonymous functions when using WaitGroup ?"}, {"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "reply_to_user": {"reputation": 157, "user_id": 9063101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh3.googleusercontent.com/-7wU7yyw74JQ/AAAAAAAAAAI/AAAAAAAAABE/JD5vjEZjb2A/photo.jpg?sz=128", "display_name": "YuanZheng Hu", "link": "https://stackoverflow.com/users/9063101/yuanzheng-hu"}, "edited": false, "score": 0, "creation_date": 1523435053, "post_id": 49767833, "comment_id": 86555001, "body": "Give the channel a size otherwise it will block until something read from it:<a href=\"https://play.golang.org/p/IxqyF42wwcv\" rel=\"nofollow noreferrer\">play.golang.org/p/IxqyF42wwcv</a>. More info here <a href=\"https://tour.golang.org/concurrency/3\" rel=\"nofollow noreferrer\">tour.golang.org/concurrency/3</a>"}, {"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "reply_to_user": {"reputation": 157, "user_id": 9063101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh3.googleusercontent.com/-7wU7yyw74JQ/AAAAAAAAAAI/AAAAAAAAABE/JD5vjEZjb2A/photo.jpg?sz=128", "display_name": "YuanZheng Hu", "link": "https://stackoverflow.com/users/9063101/yuanzheng-hu"}, "edited": false, "score": 0, "creation_date": 1523436347, "post_id": 49767833, "comment_id": 86555840, "body": "Obviously this requires knowing how many things will be sent down the channel up front whereas closing the channel in another routine does not"}, {"owner": {"reputation": 157, "user_id": 9063101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh3.googleusercontent.com/-7wU7yyw74JQ/AAAAAAAAAAI/AAAAAAAAABE/JD5vjEZjb2A/photo.jpg?sz=128", "display_name": "YuanZheng Hu", "link": "https://stackoverflow.com/users/9063101/yuanzheng-hu"}, "edited": false, "score": 0, "creation_date": 1523436786, "post_id": 49767833, "comment_id": 86556111, "body": "Thank you so much ,  I have one more question, in the first example you  gave, it does not sepcify the size of channel, but why the channel can take four strings without any receiving function ?"}, {"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "reply_to_user": {"reputation": 157, "user_id": 9063101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh3.googleusercontent.com/-7wU7yyw74JQ/AAAAAAAAAAI/AAAAAAAAABE/JD5vjEZjb2A/photo.jpg?sz=128", "display_name": "YuanZheng Hu", "link": "https://stackoverflow.com/users/9063101/yuanzheng-hu"}, "edited": false, "score": 0, "creation_date": 1523436923, "post_id": 49767833, "comment_id": 86556196, "body": "The range in the second for loop receives. That didn&#39;t work in your initial code because the deadlock was occurring at the end of the second for loop when the channel never closed. In the initial wait group code it locked in the send."}], "tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": false, "score": 7, "last_activity_date": 1523429493, "last_edit_date": 1523429493, "creation_date": 1523427607, "answer_id": 49767833, "question_id": 49766629, "link": "https://stackoverflow.com/questions/49766629/all-channels-are-deadlocked/49767833#49767833", "title": "All channels are deadlocked", "body": "<p>The second for loop will block until the channel is closed so you need to close it in the sending function.  Also, you only read from the first channel so some of the data is lost.  Doing this:</p>\n\n<pre><code>func main() {\n    var chans []chan string\n\n    for i := 0; i &lt; 3; i++ {\n        chans = append(chans, make(chan string))\n    }\n\n    for i := 0; i &lt; 3; i++ {\n        go sendString(chans[i])\n    }\n\n    for i := 0; i &lt; 3; i++ {\n        for str := range chans[i] {\n            fmt.Print(str)\n        }\n    }\n\n}\nfunc sendString(ch chan string) {\n    ch &lt;- \"a\"\n    ch &lt;- \"b\"\n    ch &lt;- \"c\"\n    ch &lt;- \"d\"\n    close(ch)\n}\n</code></pre>\n\n<p>Will produce:</p>\n\n<pre><code>abcdabcdabcd\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/7SoDKChnTbz\" rel=\"noreferrer\">https://play.golang.org/p/7SoDKChnTbz</a></p>\n\n<p>If you wanted to do this with a single channel as per your comment then you could add a wait group to close the channel once all the go routines are complete:</p>\n\n<pre><code>func main() {\n    c := make(chan string)\n    var wg sync.WaitGroup\n\n    for i := 0; i &lt; 3; i++ {\n        wg.Add(1)\n        go func() {\n            sendString(c)\n            wg.Done()\n        }()\n    }\n\n    go func() {\n        wg.Wait()\n        close(c)\n    }()\n\n    for str := range c {\n        fmt.Print(str)\n    }\n\n}\nfunc sendString(ch chan string) {\n    ch &lt;- \"a\"\n    ch &lt;- \"b\"\n    ch &lt;- \"c\"\n    ch &lt;- \"d\"\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/E_awt8UBK9v\" rel=\"noreferrer\">https://play.golang.org/p/E_awt8UBK9v</a></p>\n"}], "owner": {"reputation": 157, "user_id": 9063101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh3.googleusercontent.com/-7wU7yyw74JQ/AAAAAAAAAAI/AAAAAAAAABE/JD5vjEZjb2A/photo.jpg?sz=128", "display_name": "YuanZheng Hu", "link": "https://stackoverflow.com/users/9063101/yuanzheng-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1523434107, "creation_date": 1523421745, "last_edit_date": 1523434107, "question_id": 49766629, "link": "https://stackoverflow.com/questions/49766629/all-channels-are-deadlocked", "title": "All channels are deadlocked", "body": "<p>I'm trying to use a for loop that continuously sends strings to different channels read by different goroutines.  However, it gives me the error \"all goroutines are asleep - deadlock!\"  Why is this happening?  I searched for some answers, but I couldn't find an answer for this situation.</p>\n\n<pre><code>func main() {\n    var chans []chan string\n\n    for i := 0; i &lt; 3; i++ {\n        chans = append(chans, make(chan string))\n    }\n\n    for i := 0; i &lt; 3; i++ {\n        go sendString(chans[i])\n    }\n\n    for str := range chans[0] {\n        fmt.Print(str)\n    }\n}\n\nfunc sendString(ch chan string) {\n    ch &lt;- \"a\"\n    ch &lt;- \"b\"\n    ch &lt;- \"c\"\n    ch &lt;- \"d\"\n}\n</code></pre>\n\n<p>The errors are here.  It prints \"abcd\", then generates the error, and if I delete the loop for printing, the program does not generate the error.</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>abcdfatal error: all goroutines are asleep - deadlock!\n\n goroutine 1 [chan receive]:\nmain.main()\n    C:/Users/YuanZheng Hu/Desktop/Go Test/test/test.go:18 +0x28d\n\ngoroutine 19 [chan send]:\nmain.sendString(0xc04203c120)\n    C:/Users/YuanZheng Hu/Desktop/Go Test/test/test.go:24 +0x42\ncreated by main.main\n    C:/Users/YuanZheng Hu/Desktop/Go Test/test/test.go:15 +0x175\n\ngoroutine 20 [chan send]:\nmain.sendString(0xc04203c180)\n    C:/Users/YuanZheng Hu/Desktop/Go Test/test/test.go:24 +0x42\ncreated by main.main\n    C:/Users/YuanZheng Hu/Desktop/Go Test/test/test.go:15 +0x175\nexit status 2\n</code></pre>\n\n<hr>\n\n<p>I did the version using WaitGroup, but it seems not correct, and gives me the same error \" all goroutines are asleep - deadlock!\" where did I do wrong in the code below ?</p>\n\n<pre><code>func main() {\nvar myWaitGroup sync.WaitGroup\nch := make(chan string)\nmyWaitGroup.Add(1)\ngo sendString(ch, &amp;myWaitGroup)\n\n\nmyWaitGroup.Wait()\nclose(ch)\n\ntime.Sleep(1 * time.Second)\n}\nfunc sendString(ch chan string, pg *sync.WaitGroup) {\nch &lt;- \"a\"\nch &lt;- \"b\"\nch &lt;- \"c\"\nch &lt;- \"d\"\ndefer pg.Done()\n\n}\n</code></pre>\n"}, {"tags": ["laravel", "go", "password-hash"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 4, "creation_date": 1523412369, "post_id": 49765076, "comment_id": 86546300, "body": "It depends on how did you store the password. If you apply <code>bcrypt</code> function before storing the password, you can use Golang&#39;s <a href=\"https://godoc.org/golang.org/x/crypto/bcrypt\" rel=\"nofollow noreferrer\"><code>bcrypt</code></a> to encrypt the password then compare the result against the password stored in Laravel Project."}], "answers": [{"tags": [], "owner": {"reputation": 461, "user_id": 7789092, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-C9fg_rmgTtg/AAAAAAAAAAI/AAAAAAAAAAs/c2OQsYP7XwY/photo.jpg?sz=128", "display_name": "qskane", "link": "https://stackoverflow.com/users/7789092/qskane"}, "is_accepted": true, "score": 3, "last_activity_date": 1525661177, "creation_date": 1525661177, "answer_id": 50206435, "question_id": 49765076, "link": "https://stackoverflow.com/questions/49765076/how-to-migrate-laravel-project-password-to-go-project/50206435#50206435", "title": "How to migrate Laravel project password to Go project?", "body": "<p>I am using following codes solved the question</p>\n\n<pre><code>import \"golang.org/x/crypto/bcrypt\"\n\nfunc Hash(str string) (string, error) {\n    hashed, err := bcrypt.GenerateFromPassword([]byte(str), bcrypt.DefaultCost)\n    return string(hashed), err\n}\n\nfunc IsSame(str string, hashed string) bool {\n    return bcrypt.CompareHashAndPassword([]byte(hashed), []byte(str)) == nil\n}\n</code></pre>\n"}], "owner": {"reputation": 461, "user_id": 7789092, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-C9fg_rmgTtg/AAAAAAAAAAI/AAAAAAAAAAs/c2OQsYP7XwY/photo.jpg?sz=128", "display_name": "qskane", "link": "https://stackoverflow.com/users/7789092/qskane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 399, "favorite_count": 0, "accepted_answer_id": 50206435, "answer_count": 1, "score": 1, "last_activity_date": 1525661177, "creation_date": 1523410071, "last_edit_date": 1523417952, "question_id": 49765076, "link": "https://stackoverflow.com/questions/49765076/how-to-migrate-laravel-project-password-to-go-project", "title": "How to migrate Laravel project password to Go project?", "body": "<p>There is a Laravel project, but has now been refactored into a Go project.</p>\n\n<p>How can a user's password saved using Laravel be verified with Go?</p>\n\n<p>[UPDATE]  </p>\n\n<p>I use <code>Hash::make($password)</code> store password in <code>Laravel</code></p>\n"}, {"tags": ["sql-server", "go", "backup"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1523410926, "post_id": 49764868, "comment_id": 86545936, "body": "Is your Go application being executed in the same machine with <i>MSSQL</i>? Does the specified username has write permission to specified filename?"}, {"owner": {"reputation": 71, "user_id": 7884930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Kk6v0.jpg?s=128&g=1", "display_name": "nzoueidi", "link": "https://stackoverflow.com/users/7884930/nzoueidi"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1523411109, "post_id": 49764868, "comment_id": 86545990, "body": "Yeah, they are both in the same os and yes the username has the appropriate permission to store the backup there."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1523411633, "post_id": 49764868, "comment_id": 86546128, "body": "What is the result when the query is executed through <code>sqlcmd</code>? Also, try to observe the content of MSSQL log (error or access log, etc)."}, {"owner": {"reputation": 71, "user_id": 7884930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Kk6v0.jpg?s=128&g=1", "display_name": "nzoueidi", "link": "https://stackoverflow.com/users/7884930/nzoueidi"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1523412252, "post_id": 49764868, "comment_id": 86546273, "body": "You are right, I forget to mention that in the Q. I tried to backup using <code>sqlcmd</code> and it works properly. For the log files, I don&#39;t have any..  I try to see what the PID of MSSQL is doing by performing the following command <code>journalctl _PID=1234</code> and unfortunately, there is no entries related to my issue."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1523412969, "post_id": 49764868, "comment_id": 86546453, "body": "How if you remove the <code>STATS=10</code> from the query? One more thing, how if you replace the <code>db.QueryRowContext</code> with <code>db.ExecContext</code>?"}, {"owner": {"reputation": 71, "user_id": 7884930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Kk6v0.jpg?s=128&g=1", "display_name": "nzoueidi", "link": "https://stackoverflow.com/users/7884930/nzoueidi"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1523414937, "post_id": 49764868, "comment_id": 86546937, "body": "Thanks for getting back! I tried removing <code>STATS=10</code> but I am having the same behavior. If I change <code>db.QueryRowContext</code> by <code>db.ExecContext</code> it gives me an error that the query is intended to return many values rather than one."}], "answers": [{"tags": [], "owner": {"reputation": 71, "user_id": 7884930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Kk6v0.jpg?s=128&g=1", "display_name": "nzoueidi", "link": "https://stackoverflow.com/users/7884930/nzoueidi"}, "is_accepted": true, "score": 0, "last_activity_date": 1523541100, "creation_date": 1523541100, "answer_id": 49798371, "question_id": 49764868, "link": "https://stackoverflow.com/questions/49764868/golang-error-with-backing-up-the-dbmssql-backup-database-is-terminating-abnorma/49798371#49798371", "title": "Golang Error with Backing up the DBmssql: BACKUP DATABASE is terminating abnormally", "body": "<p>That was obvious though, the code is clean and working as expected. </p>\n\n<p>The only issue was from MSSQL, where it have a specific value set for the timeout queries. </p>\n\n<p>That's why I succeeded executing other SQL queries like: <code>SELECT @@VERSION</code> from the example above in the Q. </p>\n\n<p>Though, I set the value of the timeout for remote queries to 0 this SQL query:</p>\n\n<blockquote>\n  <p>EXEC SP_CONFIGURE 'remote query timeout', 0<br>\n   reconfigure<br>\n   EXEC sp_configure</p>\n</blockquote>\n\n<p>The  0 in <code>remote query timeout</code> means that the timeout is unlimited.</p>\n"}], "owner": {"reputation": 71, "user_id": 7884930, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Kk6v0.jpg?s=128&g=1", "display_name": "nzoueidi", "link": "https://stackoverflow.com/users/7884930/nzoueidi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 187, "favorite_count": 0, "accepted_answer_id": 49798371, "answer_count": 1, "score": 3, "last_activity_date": 1523552818, "creation_date": 1523408368, "last_edit_date": 1523552818, "question_id": 49764868, "link": "https://stackoverflow.com/questions/49764868/golang-error-with-backing-up-the-dbmssql-backup-database-is-terminating-abnorma", "title": "Golang Error with Backing up the DBmssql: BACKUP DATABASE is terminating abnormally", "body": "<p>I am trying to do a full backup for an MSSQL database using go.</p>\n\n<p>However, I tested the connection to the MSSQL server and it works like charm! </p>\n\n<p>By executing also a query into the code <code>SELECT @@VERSION</code> </p>\n\n<p>It gives me the version and that has been connected to mssql using the credentials in the code below. </p>\n\n<p>By running a query <code>BACKUP DATABASE name_db TO DISK = '/tmp/database.bak'</code> it fails with the following error </p>\n\n<blockquote>\n  <p>Error with Backing up the DBmssql: BACKUP DATABASE is terminating abnormally</p>\n</blockquote>\n\n<p>I am sure that I am missing something, any ideas/thoughts would be much appreciated.</p>\n\n<p>BTW, I am on Ubuntu 16.04 and the mssql is installed there, I am using go version 1.9. </p>\n\n<p>This is my code:</p>\n\n<pre><code>package main                                                                    \n  import (                                                                      \n     _ \"github.com/denisenkom/go-mssqldb\"                                       \n     \"database/sql\"                                                             \n     \"context\"                                                                  \n     \"log\"                                                                      \n     \"fmt\" )                                                                    \n\n\nvar server = \"server_url\"                                     \nvar port = 1433                                                                 \nvar user = \"user\"                                                          \nvar password = \"pass\"                                                  \n\nvar db *sql.DB                                                                  \n\nfunc main() {                                                                   \n        var err error                                                                                                                                           \n        // Create connection string                                               \n        connString := fmt.Sprintf(\"server=%s;user id=%s;password=%s;\n        port=%d\", server, user, password, port)                                   \n        // Create connection pool                                                 \n        db, err = sql.Open(\"sqlserver\", connString)                             \n        if err != nil {                                                         \n                log.Fatal(\"Error creating connection pool: \" \n                + err.Error())     \n        }                                                                       \n     log.Printf(\"Connected!\\n\")                                                 \n     defer db.Close()                                                           \n\n        Backup()                                                                \n        //Restore()                                                             \n }                                                                              \n\nfunc Backup(){                                                                  \n        ctx := context.Background()                                                                                                                     \n        err := db.PingContext(ctx)\n        if err != nil {\n                log.Fatal(\"Error pinging database :( \" + err.Error())\n        }\n        var result string\n        err = db.QueryRowContext(ctx, \"BACKUP DATABASE tempdb \n        TO DISK= '/tmp/Backup.bak' WITH NOFORMAT, NOINIT,\n        SKIP, NOREWIND, NOUNLOAD, STATS = 10;\").Scan(&amp;result)\n        //err = db.QueryRowContext(ctx, \"select @@version\").Scan(&amp;result)\n        if err != nil {\n                log.Fatal(\"Error with Backing up the DB\", err.Error())\n        }\n        fmt.Printf(\"%s\\n\",result)\n\n}   \n</code></pre>\n\n<p>I have found the solution which is very silly.. You can find it in the 1st reply.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1523408793, "creation_date": 1523408793, "answer_id": 49764915, "question_id": 49764707, "link": "https://stackoverflow.com/questions/49764707/prompt-multiple-user-input-fail/49764915#49764915", "title": "Prompt multiple user input fail", "body": "<p>These symptoms can occur on Windows, where lines may end with \"<code>\\r\\n</code>\" instead of \"<code>\\n</code>\". Try adding an explicit newline (\"<code>\\n</code>\") to the <code>Scanf</code> format. For example, <code>\"%s\\n\"</code>,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var inStr string\n    var inStr2 string\n    fmt.Printf(\"Input? \")\n    fmt.Scanf(\"%s\\n\", &amp;inStr)\n    fmt.Printf(\"\\nOutput: %s\\n\", inStr)\n    fmt.Printf(\"Input2? \")\n    fmt.Scanf(\"%s\\n\", &amp;inStr2)\n    fmt.Printf(\"\\nOutput: %s\\n\", inStr2)\n} \n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Input? 1\n\nOutput: 1\nInput2? 2\n\nOutput: 2\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 9627757, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cdef04790595263853e4e9c35da9f8e?s=128&d=identicon&r=PG&f=1", "display_name": "Kitty", "link": "https://stackoverflow.com/users/9627757/kitty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 1, "closed_date": 1523430537, "answer_count": 1, "score": -2, "last_activity_date": 1523430354, "creation_date": 1523406814, "last_edit_date": 1523430354, "question_id": 49764707, "link": "https://stackoverflow.com/questions/49764707/prompt-multiple-user-input-fail", "closed_reason": "Needs details or clarity", "title": "Prompt multiple user input fail", "body": "<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {  \n    var inStr string  \n    var inStr2 string  \n    fmt.Printf(\"Input? \")  \n    fmt.Scanf(\"%s\", &amp;inStr)  \n    fmt.Printf(\"\\nOutput: %s\\n\", inStr)  \n    fmt.Printf(\"Input2? \")  \n    fmt.Scanf(\"%s\", &amp;inStr2)  \n    fmt.Printf(\"\\nOutput: %s\\n\", inStr2)  \n}\n</code></pre>\n\n<p>this is output </p>\n\n<pre><code>Input? 2\nOutput: 2  \nInput2?   \nOutput:     \nSuccess: process exited with code 0.  \n</code></pre>\n\n<p>As you can see, it does not  allow me to enter input2; it exits the program.</p>\n"}, {"tags": ["go", "reflection"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1523407765, "last_edit_date": 1523407765, "creation_date": 1523406356, "answer_id": 49764649, "question_id": 49764568, "link": "https://stackoverflow.com/questions/49764568/set-nil-int32-struct-field-using-reflection/49764649#49764649", "title": "Set nil *int32 struct field using reflection", "body": "<p>There are two issues here.  The first is that an <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">addressable</a> value is required. Pass a pointer to the struct to the function instead of the the struct value:</p>\n\n<pre><code>replaceNilWithNegativeOne(&amp;testStructInstance)\n</code></pre>\n\n<p>In the function, call <a href=\"https://godoc.org/reflect#Value.Elem\" rel=\"nofollow noreferrer\"><code>Value.Elem()</code></a> to get the reflect value for the struct.</p>\n\n<p>The other issue is that the code assigns an int to an int32. Use int32(-1) to fix the problem.  </p>\n\n<p>Here's the updated function with these changes:</p>\n\n<pre><code>replaceNilWithNegativeOne(obj interface{}) (err error) {\n    v := reflect.ValueOf(obj).Elem()\n    t := v.Type()\n    for i := 0; i &lt; t.NumField(); i++ {\n        if grib, ok := t.Field(i).Tag.Lookup(\"grib\"); ok {\n            if strings.Contains(grib, \"foo\") {\n                fv := v.Field(i)\n                if fv.Kind() != reflect.Ptr {\n                    // do some stuff\n                    break\n                }\n                if fv.IsNil() {\n                    iv := int32(-1)\n                    fv.Set(reflect.ValueOf(&amp;iv))\n                    continue\n                }\n            }\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/8c7gGkWsk66\" rel=\"nofollow noreferrer\">Playground Example</a></p>\n"}], "owner": {"reputation": 654, "user_id": 3434541, "user_type": "registered", "accept_rate": 82, "profile_image": "https://graph.facebook.com/1096564134/picture?type=large", "display_name": "Joe", "link": "https://stackoverflow.com/users/3434541/joe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 715, "favorite_count": 0, "accepted_answer_id": 49764649, "answer_count": 1, "score": 2, "last_activity_date": 1523407765, "creation_date": 1523405665, "question_id": 49764568, "link": "https://stackoverflow.com/questions/49764568/set-nil-int32-struct-field-using-reflection", "title": "Set nil *int32 struct field using reflection", "body": "<p>I'm trying to set the value of a <code>nil</code> <code>*int</code> through reflection.</p>\n\n<p>In the example below, <code>replaceNilWithNegativeOne</code> should replace any <code>nil</code> <code>*int32</code> field (tagged with <code>grib:\"foo\"</code>) with a pointer to -1.</p>\n\n<p>However, when the code is run, reflect is panicking with <code>panic: reflect: reflect.Value.Set using unaddressable value</code>.</p>\n\n<p>I've seen almost the exact question I'm asking here in several other places, such as:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/6395076/using-reflect-how-do-you-set-the-value-of-a-struct-field?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa\">Using reflect, how do you set the value of a struct field?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/16456098/using-reflect-how-do-you-initialize-value-of-a-struct-pointer-field\">Using reflect, how do you initialize value of a struct pointer field?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/45809746/reflect-value-set-using-unaddressable-value?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa\">reflect.Value.Set using unaddressable value</a></li>\n<li><a href=\"https://stackoverflow.com/questions/24890732/set-a-pointer-to-a-field-using-reflection?utm_medium=organic&amp;utm_source=google_rich_qa&amp;utm_campaign=google_rich_qa\">Set a pointer to a field using reflection</a></li>\n<li>As well as non SO research.</li>\n</ul>\n\n<p>I know the answer must be in those responses somewhere, but I am still having trouble connecting the dots. I've tried several implementations in addition to the one you see in the example below, but they all seem to either lead to either a segfault, or, more frequently, the unadressable value panic.</p>\n\n<p>It is clear to me that <code>fieldPtr.CanSet() == false</code>, but, that being said, how would I go about accomplishing what it is that I want to accomplish?</p>\n\n<p><strong>Example</strong></p>\n\n<pre><code>// https://play.golang.org/p/yZOtYxwTzUs\npackage main\n\nimport (\n    \"log\"\n    \"reflect\"\n    \"strings\"\n)\n\nfunc main() {\n    type testStruct struct {\n        SomeField *int32 `grib:\"foo\"`\n    }\n    testStructInstance := testStruct{\n        SomeField: nil,\n    }\n    replaceNilWithNegativeOne(testStructInstance)\n\n    if *testStructInstance.SomeField != int32(-1) {\n        // We never get here\n        log.Println(\"Didn't get set\")\n    }\n}\n\nfunc replaceNilWithNegativeOne(obj interface{}) (err error) {\n    objType := reflect.TypeOf(obj)\n    for i := 0; i &lt; objType.NumField(); i++ {\n        if t, ok := objType.Field(i).Tag.Lookup(\"grib\"); ok {\n            if strings.Contains(t, \"foo\") {\n                fieldPtr := reflect.ValueOf(obj).Field(i)\n                if fieldPtr.Kind() != reflect.Ptr {\n                    // do some stuff\n                    break\n                }\n                if fieldPtr.IsNil() {\n                    v := -1\n                    // I know this isn't working because the CanSet() == false\n                    // But I want to set the value to -1.\n                    fieldPtr.Set(reflect.ValueOf(&amp;v))\n                    continue\n                }\n            }\n        }\n    }\n    return\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1523401584, "post_id": 49763876, "comment_id": 86543716, "body": "What is &quot;temporarily&quot;? Why not just change the paths in <code>GOPATH</code> or <code>vendor&#47;</code>?"}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1523404342, "post_id": 49763876, "comment_id": 86544375, "body": "You could possibly move <code>github.com&#47;A&#47;package</code> and make a symlink to <code>github.com&#47;B&#47;package</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 1, "creation_date": 1523410003, "post_id": 49763876, "comment_id": 86545714, "body": "@Gavin: symlinks are purposely not supported in GOPATH, you would need to rename the directories."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523429187, "post_id": 49763876, "comment_id": 86551645, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/37079225/golang-monkey-patching\">Golang monkey patching</a>"}, {"owner": {"reputation": 1650, "user_id": 4399634, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001746244457/picture?type=large", "display_name": "frankegoesdown", "link": "https://stackoverflow.com/users/4399634/frankegoesdown"}, "edited": false, "score": 0, "creation_date": 1562767641, "post_id": 49763876, "comment_id": 100481313, "body": "<a href=\"https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 730, "user_id": 6161244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/990831a04db3b7c4a8ac83e67e00817d?s=128&d=identicon&r=PG", "display_name": "Constantin Konstantinidis", "link": "https://stackoverflow.com/users/6161244/constantin-konstantinidis"}, "is_accepted": false, "score": 1, "last_activity_date": 1562764018, "creation_date": 1562764018, "answer_id": 56971390, "question_id": 49763876, "link": "https://stackoverflow.com/questions/49763876/is-there-a-way-to-override-a-package/56971390#56971390", "title": "Is there a way to override a package?", "body": "<p>Since Go1.11, modules allow the use of the <code>replace</code> directive in the <code>go.mod</code> file of the project. It allows to override an expressed dependency by another module.</p>\n\n<p>Online reference is <a href=\"https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive</a></p>\n"}], "owner": {"reputation": 39, "user_id": 1188730, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a8d60e9d2699cc73131675974be78c5?s=128&d=identicon&r=PG", "display_name": "Michael Lee Squires", "link": "https://stackoverflow.com/users/1188730/michael-lee-squires"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 837, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1614087536, "creation_date": 1523400121, "last_edit_date": 1614087536, "question_id": 49763876, "link": "https://stackoverflow.com/questions/49763876/is-there-a-way-to-override-a-package", "title": "Is there a way to override a package?", "body": "<p>I have import statements in my code that look like this:</p>\n\n<pre><code>import \"github.com/A/package\"\n</code></pre>\n\n<p>It turns out that - temporarily - I need to use <code>github.com/B/package</code>.</p>\n\n<p>Rather than modify the source, and re-modify it later, is there a way to specify an override?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 0, "creation_date": 1523398912, "post_id": 49763686, "comment_id": 86543006, "body": "Facepalm. Thanks."}], "tags": [], "owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "is_accepted": true, "score": 2, "last_activity_date": 1523398855, "creation_date": 1523398855, "answer_id": 49763686, "question_id": 49763593, "link": "https://stackoverflow.com/questions/49763593/invalid-operation-currency-name-currency-mismatched-types-string-and-con/49763686#49763686", "title": "invalid operation: currency.Name() == currency (mismatched types string and *config.Currency)", "body": "<p>You're shadowing <code>currency</code> in the for loop. Look at this code for a simpler example: <a href=\"https://play.golang.org/p/UFmwqQ4JZtG\" rel=\"nofollow noreferrer\">https://play.golang.org/p/UFmwqQ4JZtG</a></p>\n\n<p>First assignment to <code>currency</code> -> <code>func (s *Foo) validateCurrency(currency string) error {</code></p>\n\n<p>Second assignment which shadows the first: -> <code>for _, currency := range s.Config.Currencies {</code></p>\n\n<p>Change one of those variable names for a fix.</p>\n"}, {"comments": [{"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 0, "creation_date": 1523398966, "post_id": 49763689, "comment_id": 86543018, "body": "Thanks. IDE didn&#39;t highlight this, forgot I had named it that twice."}], "tags": [], "owner": {"reputation": 78, "user_id": 7748297, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xmDtE.jpg?s=128&g=1", "display_name": "Pseudohuman", "link": "https://stackoverflow.com/users/7748297/pseudohuman"}, "is_accepted": false, "score": 2, "last_activity_date": 1523398888, "creation_date": 1523398888, "answer_id": 49763689, "question_id": 49763593, "link": "https://stackoverflow.com/questions/49763593/invalid-operation-currency-name-currency-mismatched-types-string-and-con/49763689#49763689", "title": "invalid operation: currency.Name() == currency (mismatched types string and *config.Currency)", "body": "<p>Your <code>for</code> loop defines a variable named <code>currency</code> of type <code>Currency</code>. Your function has a parameter also named <code>currency</code>, but of type <code>string</code>. This causes <code>currency</code> inside the <code>for</code> loop to see the value of the <code>currency</code> of type <code>Currency</code> as defined in the loop instead of the function's parameter.</p>\n\n<p>In short, you have two variables named <code>currency</code>, but can only access the one most recently defined.</p>\n\n<p>To fix this, you should rename one of your <code>currency</code> variables to something else.</p>\n"}], "owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 0, "accepted_answer_id": 49763686, "answer_count": 2, "score": 2, "last_activity_date": 1523398888, "creation_date": 1523398275, "question_id": 49763593, "link": "https://stackoverflow.com/questions/49763593/invalid-operation-currency-name-currency-mismatched-types-string-and-con", "title": "invalid operation: currency.Name() == currency (mismatched types string and *config.Currency)", "body": "<p>I have a function that takes in a string, and checks to see if that string is present in a list of other strings. Simple enough.</p>\n\n<pre><code>func (s *Foo) validateCurrency(currency string) error {\n    for _, currency := range s.Config.Currencies {\n        if currency.Name() == currency {\n            return nil\n        }\n    }\n    return ErrCurrencyNotFound\n}\n</code></pre>\n\n<p>This is the <code>Currency</code> struct:</p>\n\n<pre><code>type Currency struct {\n    name    string\n    // ...\n}\n\nfunc (c *Currency) Name() string {\n    return c.name\n}\n</code></pre>\n\n<p>Yet I seem to be getting this error:</p>\n\n<blockquote>\n  <p>invalid operation: currency.Name() == currency (mismatched types\n  string and *config.Currency)</p>\n</blockquote>\n\n<p>Why on earth is the Go compiler yelling at me? I don't get it... both are strings. <code>currency.Name()</code> returns a string. Why does the error say it returns a <code>*config.Currency</code>?</p>\n"}, {"tags": ["go", "unicode", "codepoint"], "answers": [{"comments": [{"owner": {"reputation": 1718, "user_id": 102484, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4287b4d3f492373628c3972c6aec3180?s=128&d=identicon&r=PG", "display_name": "noonex", "link": "https://stackoverflow.com/users/102484/noonex"}, "edited": false, "score": 0, "creation_date": 1557761529, "post_id": 49764250, "comment_id": 98864610, "body": "are you sure that all assigned characters belong to some category? (it is kind of obvious, but maybe you have a quick proof)"}, {"owner": {"reputation": 1718, "user_id": 102484, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/4287b4d3f492373628c3972c6aec3180?s=128&d=identicon&r=PG", "display_name": "noonex", "link": "https://stackoverflow.com/users/102484/noonex"}, "edited": false, "score": 0, "creation_date": 1557763062, "post_id": 49764250, "comment_id": 98865418, "body": "actually code below shows 260+K runes belong to categories, while there is only ~130K codepoints assigned. Do I do something wrong? <a href=\"https://play.golang.org/p/gIcNVHa5PG6\" rel=\"nofollow noreferrer\">play.golang.org/p/gIcNVHa5PG6</a>"}], "tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": false, "score": 2, "last_activity_date": 1523403087, "creation_date": 1523403087, "answer_id": 49764250, "question_id": 49763103, "link": "https://stackoverflow.com/questions/49763103/check-whether-a-unicode-code-point-is-assigned/49764250#49764250", "title": "Check whether a Unicode code point is assigned", "body": "<p>I think you can verify a code point is <em>assigned</em> or <em>not</em> using <a href=\"https://golang.org/pkg/unicode/#Is\" rel=\"nofollow noreferrer\"><code>unicode.Is</code></a> and <code>unicode.Categories</code> (though it is not efficient), i.e.</p>\n\n<pre><code>func IsAssigned(r rune) bool {\n    for _, v := range unicode.Categories {\n        if unicode.Is(v, r) {\n            return true\n        }\n    }\n    return false\n}\n</code></pre>\n\n<p>Working example is in <a href=\"https://play.golang.org/p/UvQeho7S7sj\" rel=\"nofollow noreferrer\">The Go Playground</a>.</p>\n"}], "owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1523403087, "creation_date": 1523395665, "question_id": 49763103, "link": "https://stackoverflow.com/questions/49763103/check-whether-a-unicode-code-point-is-assigned", "title": "Check whether a Unicode code point is assigned", "body": "<p>Go has the <code>unicode</code> package, containing useful functions such as <code>IsGraphic</code> or <code>IsPrint</code>. One function that is missing though is <code>IsAssigned</code>. Of course I could write my own function by using the other functions. But I would rather expect the standard library to provide this function. In Java, writing this function is easy:</p>\n\n<pre><code>boolean isAssigned(int codePoint) {\n    return Character.getType(codePoint) != Character.UNASSIGNED;\n}\n</code></pre>\n\n<p>In Go there is no function <code>unicode.Type(rune)</code> or <code>unicode.IsAssigned(rune)</code>. The closest I could find is this:</p>\n\n<pre><code>func IsAssigned(r rune) bool {\n    return unicode.IsControl(r) ||\n            unicode.IsGraphic(r) ||\n            unicode.IsSymbol(r)\n}\n</code></pre>\n\n<p>But that code thinks that U+00AD (soft-hyphen) is unassigned, which is wrong.</p>\n\n<p>How can I get correct information about unassigned code points?</p>\n"}, {"tags": ["file", "post", "go", "request"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523429399, "post_id": 49763031, "comment_id": 86551750, "body": "You cannot avoid downloading the image. You can avoid saving it to a temporary file."}], "answers": [{"comments": [{"owner": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "edited": false, "score": 0, "creation_date": 1523395737, "post_id": 49763096, "comment_id": 86541831, "body": "I forgot to mention I am using multipart, I will edit my post"}, {"owner": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "edited": false, "score": 0, "creation_date": 1523396230, "post_id": 49763096, "comment_id": 86542015, "body": "I fixed it, can I just use the response.Body as the file when I use <code>.io.Copy</code>?"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "reply_to_user": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "edited": false, "score": 0, "creation_date": 1523396522, "post_id": 49763096, "comment_id": 86542129, "body": "Now your question is quite different to the one I answered. I think it will be very confusing. And some of the code seems to be missing."}, {"owner": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "edited": false, "score": 0, "creation_date": 1523396953, "post_id": 49763096, "comment_id": 86542319, "body": "Sorry, I added the request back. I need to bridge the response.Body into a file somehow."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "reply_to_user": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "edited": false, "score": 0, "creation_date": 1523399843, "post_id": 49763096, "comment_id": 86543259, "body": "@PLZHELP You still don&#39;t need a temporary file. Just <code>io.Copy()</code> directly from the reader to the writer after each time you call <code>CreatePart()</code>."}], "tags": [], "owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "is_accepted": true, "score": 3, "last_activity_date": 1523399813, "last_edit_date": 1523399813, "creation_date": 1523395627, "answer_id": 49763096, "question_id": 49763031, "link": "https://stackoverflow.com/questions/49763031/send-an-image-in-golang-without-downloading-it/49763096#49763096", "title": "Send an image in golang without downloading it", "body": "<p>You don't need to create a temporary file. Remember that <code>http.Request</code> takes an <code>io.Reader</code> (or an <code>io.ReadCloser</code>), and since <code>response.Body</code> is an <code>io.ReadCloser</code> it will happily read directly from your existing HTTP response body from your previous request.</p>\n\n<pre><code>req, err := http.NewRequest(\"POST\", url, response.Body)\n</code></pre>\n\n<p>For a multipart upload, you can simply call <code>multipart.CreatePart()</code> and then <code>io.Copy()</code> directly from the response body of the original HTTP GET request to the writer you're using. You still don't need a temporary file.</p>\n"}], "owner": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 501, "favorite_count": 0, "accepted_answer_id": 49763096, "answer_count": 1, "score": 1, "last_activity_date": 1523399813, "creation_date": 1523395262, "last_edit_date": 1523396913, "question_id": 49763031, "link": "https://stackoverflow.com/questions/49763031/send-an-image-in-golang-without-downloading-it", "title": "Send an image in golang without downloading it", "body": "<p><strong>What's the problem</strong></p>\n\n<p>I have a url with an image in it, and I want to send the image in a post request. Is there a way to do it without downloading the file locally?</p>\n\n<p><strong>What have I tried</strong></p>\n\n<p>Usually I would download the image, send the image, and delete the file. Is there a better way?</p>\n\n<pre><code>  response, e := http.Get(url)\nif e != nil {\n    log.Fatal(e)\n} \nwriter := multipart.NewWriter(body)\n  part, err := writer.CreateFormFile(paramName, filepath.Base(path))\n  if err != nil {\n      return nil, err\n  }\n  _, err = io.Copy(part, file)\n</code></pre>\n"}, {"tags": ["go", "go-build", "go-packages"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523394205, "post_id": 49762727, "comment_id": 86541178, "body": "You seem to be having a number of issues all covered in the docs. Have you gone through the intro material, like <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How To Write Go Code</a>?"}, {"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523394488, "post_id": 49762727, "comment_id": 86541294, "body": "yeah, importing code is tricky here, as is usual when learning new languages, I am just trying to figure it out"}, {"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523394548, "post_id": 49762727, "comment_id": 86541324, "body": "@JimB for example the baba directory and the hello directory are at <code>$GOPATH&#47;src&#47;hello</code> and <code>$GOPATH&#47;src&#47;baba</code>, so why is this hard?"}, {"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523394642, "post_id": 49762727, "comment_id": 86541367, "body": "I am guessing I need to do something like this <code>$GOPATH&#47;src&#47;myusername&#47;hello</code> and <code>$GOPATH&#47;src&#47;myusername&#47;baba</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523394923, "post_id": 49762727, "comment_id": 86541482, "body": "There&#39;s a step by step example in the docs I linked. You&#39;re neither importing <code>baba</code>, nor are you qualifying the <code>baba.Fodd</code> identifier with the package name."}, {"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523395147, "post_id": 49762727, "comment_id": 86541590, "body": "Got it thank you. I wish golang would enforce packages to match their directory names. In fact I see no reason why the package declaration exists at all. Oh well. The package name could just be the name of the directory, and we could forgo the package declaration. I wonder what the reasoning is."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 0, "creation_date": 1523394368, "post_id": 49762831, "comment_id": 86541247, "body": "yes but what if the package is just local, for example, let&#39;s say the package is at <code>$GOPATH&#47;src&#47;baba</code>"}, {"owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "reply_to_user": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 2, "creation_date": 1523395053, "post_id": 49762831, "comment_id": 86541539, "body": "You should not create root-level packages, even if they are just local. You can create a directory structure under a namespace of your choosing, though. See <a href=\"https://golang.org/doc/code.html#ImportPaths\" rel=\"nofollow noreferrer\">golang.org/doc/code.html#ImportPaths</a>.  (For the record, it will work if you create a root-level package, but it will be difficult to maintain and will probably break. You don&#39;t have to push your code to GitHub to be able to import it locally.)"}], "tags": [], "owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "is_accepted": false, "score": 1, "last_activity_date": 1523394333, "creation_date": 1523394333, "answer_id": 49762831, "question_id": 49762727, "link": "https://stackoverflow.com/questions/49762727/import-code-from-a-separate-package-folder/49762831#49762831", "title": "import code from a separate package/folder", "body": "<p>You need to import the <code>baba</code> package in order to use it from your main package. That will look something like:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"github.com/the1mills/myproject/baba\"\n)\n\nfunc main() {\n    log.Fatal(baba.Foodd(3))\n}\n</code></pre>\n\n<p>Imported packages are referred to by their package name, which is usually, but not always, the last element of the import path.</p>\n\n<p>Usually, people let <a href=\"https://godoc.org/golang.org/x/tools/cmd/goimports\" rel=\"nofollow noreferrer\">goimports</a> handle finding the correct import path and automatically adding it. Your editor of choice probably has <code>goimports</code> integration.</p>\n\n<p>Also see <a href=\"https://stackoverflow.com/a/15051192/9609198\">this answer</a> for some other references and how to set up your directory structure.</p>\n"}], "owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 465, "favorite_count": 0, "closed_date": 1523395023, "answer_count": 1, "score": 0, "last_activity_date": 1523394333, "creation_date": 1523393743, "question_id": 49762727, "link": "https://stackoverflow.com/questions/49762727/import-code-from-a-separate-package-folder", "closed_reason": "Duplicate", "title": "import code from a separate package/folder", "body": "<p>I have this directory layout:</p>\n\n<pre><code>/baba\n   biz.go         # package baba\n/hello\n   foo.go         # package main\n</code></pre>\n\n<p>biz.go looks like this:</p>\n\n<pre><code>package baba\n\nfunc Foodd(z int) int {\n    return z + 5\n}\n</code></pre>\n\n<p>and foo.go looks like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n)\n\nfunc main() {\n    log.Fatal(Foodd(3))\n}\n</code></pre>\n\n<p>currently this doesn't compile because <code>Foodd</code> is not recognized. How do I import the <code>baba</code> package in <code>foo.go</code>?</p>\n\n<p>I assume if I compile like so, that it will pull in the right files:</p>\n\n<pre><code>go build foo.go\n</code></pre>\n\n<p>Or do I need to include the files in the baba package in the <code>go build</code> command? (I would hope not).</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1523390952, "post_id": 49761966, "comment_id": 86539564, "body": "It&#39;s not that simple. You&#39;ll need to use something like AJAX polling or WebSockets to stream data to the browser, and some JavaScript to continuously update the DOM."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523391086, "post_id": 49761966, "comment_id": 86539637, "body": "I can&#39;t see anything here that can write the response of a request to web page"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523391129, "post_id": 49761966, "comment_id": 86539657, "body": "Please fix your example; it doesn&#39;t compile as it is now. You may have to call w.Flush every now and then to send output down the wire, but if the browser renders anything before the response is complete depends on the browser (curl should work though). Also, you can simply assign w to cmd.Stdout and cmd.Stderr; no need for the copyOutput goroutines."}, {"owner": {"reputation": 405, "user_id": 4062625, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Qsrh1RHLGX8/AAAAAAAAAAI/AAAAAAAAAGw/dCVzh6lGlLA/photo.jpg?sz=128", "display_name": "Coco Bennett", "link": "https://stackoverflow.com/users/4062625/coco-bennett"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523391488, "post_id": 49761966, "comment_id": 86539844, "body": "@Peter I will try w.Flush and how do I assign w to cmd.Stdout? As far as it not compiling, my bad, I will fix that too. This is for my company so I tried to grab the code relevant to my problem only"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523391938, "post_id": 49761966, "comment_id": 86540050, "body": "cmd.Stdout is an io.Writer, so assignment is trivial: <a href=\"https://play.golang.org/p/eoc4m_WKz3j\" rel=\"nofollow noreferrer\">play.golang.org/p/eoc4m_WKz3j</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523392052, "post_id": 49761966, "comment_id": 86540103, "body": "On second thought, depending on how you want to flush, you may have to keep the pipes. Flushing periodically doesn&#39;t need it, but flushing after N lines does."}, {"owner": {"reputation": 405, "user_id": 4062625, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Qsrh1RHLGX8/AAAAAAAAAAI/AAAAAAAAAGw/dCVzh6lGlLA/photo.jpg?sz=128", "display_name": "Coco Bennett", "link": "https://stackoverflow.com/users/4062625/coco-bennett"}, "edited": false, "score": 0, "creation_date": 1523392411, "post_id": 49761966, "comment_id": 86540286, "body": "Okay, I misunderstood the assign w. The problem is that I want it to write as it goes"}, {"owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "edited": false, "score": 0, "creation_date": 1523392687, "post_id": 49761966, "comment_id": 86540404, "body": "Hi @coco: how about this example using gorilla/websocket library <a href=\"https://github.com/gorilla/websocket/tree/master/examples/command\" rel=\"nofollow noreferrer\">github.com/gorilla/websocket/tree/master/examples/command</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523392691, "post_id": 49761966, "comment_id": 86540407, "body": "Assigning w to Stdout is the same as your goroutines, except not line buffered (it&#39;s not buffered <i>at all</i>). It says &quot;hey, cmd, write your output directly to the ResponseWriter&quot;."}, {"owner": {"reputation": 405, "user_id": 4062625, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Qsrh1RHLGX8/AAAAAAAAAAI/AAAAAAAAAGw/dCVzh6lGlLA/photo.jpg?sz=128", "display_name": "Coco Bennett", "link": "https://stackoverflow.com/users/4062625/coco-bennett"}, "edited": false, "score": 0, "creation_date": 1523392961, "post_id": 49761966, "comment_id": 86540563, "body": "Wouldn&#39;t assigning stdout as such just overwrite the output it was just assigned?"}, {"owner": {"reputation": 405, "user_id": 4062625, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Qsrh1RHLGX8/AAAAAAAAAAI/AAAAAAAAAGw/dCVzh6lGlLA/photo.jpg?sz=128", "display_name": "Coco Bennett", "link": "https://stackoverflow.com/users/4062625/coco-bennett"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523393022, "post_id": 49761966, "comment_id": 86540601, "body": "@Peter Sorry I&#39;m not getting it. It&#39;s been a long day at work I can&#39;t seem to process this"}, {"owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523393508, "post_id": 49761966, "comment_id": 86540864, "body": "@coco the responseWriter implements io.Writer, much like a file, or pipe, or buffer does. By assigning <code>w</code> to <code>cmd.Stdout</code>, you are telling it &#39;Hey, pretend this is a file, or console, or anything at all that I can write to&#39; and the <code>cmd</code> (in this case, the python) will write it there.  However, at the end of the day, I think @Peter is right that you need some fancier things like websockets to really do this"}, {"owner": {"reputation": 405, "user_id": 4062625, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Qsrh1RHLGX8/AAAAAAAAAAI/AAAAAAAAAGw/dCVzh6lGlLA/photo.jpg?sz=128", "display_name": "Coco Bennett", "link": "https://stackoverflow.com/users/4062625/coco-bennett"}, "edited": false, "score": 0, "creation_date": 1523393852, "post_id": 49761966, "comment_id": 86541028, "body": "So like instead of the stdout, err := cmd.StdoutPipe() I&#39;d just do cmd.Stdout = w, then what would I pass to go copyOutput? cmd.Stdout?"}, {"owner": {"reputation": 405, "user_id": 4062625, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Qsrh1RHLGX8/AAAAAAAAAAI/AAAAAAAAAGw/dCVzh6lGlLA/photo.jpg?sz=128", "display_name": "Coco Bennett", "link": "https://stackoverflow.com/users/4062625/coco-bennett"}, "edited": false, "score": 0, "creation_date": 1523394111, "post_id": 49761966, "comment_id": 86541140, "body": "And I have a fully functioning website with multiple pages and a database connected to the frontend (written in angular) via the backend (in go)"}, {"owner": {"reputation": 405, "user_id": 4062625, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Qsrh1RHLGX8/AAAAAAAAAAI/AAAAAAAAAGw/dCVzh6lGlLA/photo.jpg?sz=128", "display_name": "Coco Bennett", "link": "https://stackoverflow.com/users/4062625/coco-bennett"}, "edited": false, "score": 0, "creation_date": 1523394285, "post_id": 49761966, "comment_id": 86541208, "body": "I think I finally understand. I&#39;m going to try it now"}, {"owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "edited": false, "score": 0, "creation_date": 1523394469, "post_id": 49761966, "comment_id": 86541288, "body": "@coco You won&#39;t need <code>copyOutput</code> or a goroutine at all in theory. Again, though, this is going to behave differently depending on what you use to &#39;view&#39; it. For instance, browsers strongly prefer to have the output stop and the request close at some point =)"}, {"owner": {"reputation": 405, "user_id": 4062625, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Qsrh1RHLGX8/AAAAAAAAAAI/AAAAAAAAAGw/dCVzh6lGlLA/photo.jpg?sz=128", "display_name": "Coco Bennett", "link": "https://stackoverflow.com/users/4062625/coco-bennett"}, "edited": false, "score": 0, "creation_date": 1523394558, "post_id": 49761966, "comment_id": 86541327, "body": "So setting cmd.Stdout = w works, but it still only prints once the whole function is complete"}, {"owner": {"reputation": 405, "user_id": 4062625, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Qsrh1RHLGX8/AAAAAAAAAAI/AAAAAAAAAGw/dCVzh6lGlLA/photo.jpg?sz=128", "display_name": "Coco Bennett", "link": "https://stackoverflow.com/users/4062625/coco-bennett"}, "edited": false, "score": 0, "creation_date": 1523394639, "post_id": 49761966, "comment_id": 86541365, "body": "True haha :) The real function I&#39;m going to run here is going to take a long longer"}], "answers": [{"comments": [{"owner": {"reputation": 405, "user_id": 4062625, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Qsrh1RHLGX8/AAAAAAAAAAI/AAAAAAAAAGw/dCVzh6lGlLA/photo.jpg?sz=128", "display_name": "Coco Bennett", "link": "https://stackoverflow.com/users/4062625/coco-bennett"}, "edited": false, "score": 0, "creation_date": 1523456639, "post_id": 49770937, "comment_id": 86570373, "body": "nbari, thank you for the detailed, complete example but even trying this example, I have not been able to get the web browser to show the commands as they run. It still locks up the browser until it&#39;s complete, even with the flusher and scan"}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "reply_to_user": {"reputation": 405, "user_id": 4062625, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Qsrh1RHLGX8/AAAAAAAAAAI/AAAAAAAAAGw/dCVzh6lGlLA/photo.jpg?sz=128", "display_name": "Coco Bennett", "link": "https://stackoverflow.com/users/4062625/coco-bennett"}, "edited": false, "score": 0, "creation_date": 1523459716, "post_id": 49770937, "comment_id": 86572793, "body": "@CocoBennett I tried with <code>curl</code> &amp; <code>Chrome browser</code> just in case using <code>go version go1.10 darwin&#47;amd64</code> if it helps"}], "tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": true, "score": 2, "last_activity_date": 1523439191, "last_edit_date": 1523439191, "creation_date": 1523437581, "answer_id": 49770937, "question_id": 49761966, "link": "https://stackoverflow.com/questions/49761966/print-the-console-log-to-the-screen-of-a-webpage-continuously-using-go-routines/49770937#49770937", "title": "Print the console log to the screen of a webpage continuously using Go Routines", "body": "<p>This is a very basic (naive) example but how can give you an idea of how to stream data continuously:</p>\n\n<p><a href=\"https://play.golang.org/p/vtXPEHSv-Sg\" rel=\"nofollow noreferrer\">https://play.golang.org/p/vtXPEHSv-Sg</a></p>\n\n<p>The code for <code>game.py</code> is:</p>\n\n<pre><code>import time\nimport sys\n\nwhile True:\n    print(\"Hello\")\n    sys.stdout.flush()\n    time.sleep(1)\n</code></pre>\n\n<p>The web app code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"os/exec\"\n\n    \"github.com/nbari/violetear\"\n)\n\nfunc stream(w http.ResponseWriter, r *http.Request) {\n    cmd := exec.Command(\"python\", \"game.py\")\n    rPipe, wPipe, err := os.Pipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n    cmd.Stdout = wPipe\n    cmd.Stderr = wPipe\n    if err := cmd.Start(); err != nil {\n        log.Fatal(err)\n    }\n    go writeOutput(w, rPipe)\n    cmd.Wait()\n    wPipe.Close()\n}\n\nfunc writeOutput(w http.ResponseWriter, input io.ReadCloser) {\n    flusher, ok := w.(http.Flusher)\n    if !ok {\n        http.Error(w, \"Streaming not supported\", http.StatusInternalServerError)\n        return\n    }\n\n    // Important to make it work in browsers\n    w.Header().Set(\"Content-Type\", \"text/event-stream\")\n    w.Header().Set(\"Cache-Control\", \"no-cache\")\n    w.Header().Set(\"Connection\", \"keep-alive\")\n\n    in := bufio.NewScanner(input)\n    for in.Scan() {\n        fmt.Fprintf(w, \"data: %s\\n\", in.Text())\n        flusher.Flush()\n    }\n    input.Close()\n}\n\nfunc main() {\n    router := violetear.New()\n    router.HandleFunc(\"/\", stream, \"GET\")\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n}\n</code></pre>\n\n<p>The key part here is the use of <a href=\"https://golang.org/pkg/net/http/#Flusher\" rel=\"nofollow noreferrer\">http.Flusher</a> and some headers to make it work within a browser:</p>\n\n<pre><code> w.Header().Set(\"Content-Type\", \"text/event-stream\")\n</code></pre>\n\n<p>Note the problem with this code is that once a request arrives it will <code>exec</code> the command that loops forever, so the <code>wPipe.Close()</code> will never be called</p>\n\n<pre><code>    cmd.Wait()\n    wPipe.Close()\n</code></pre>\n\n<p>To be more verbose you could print the output the terminal beside the browser:</p>\n\n<pre><code> for in.Scan() {\n     data := in.Text()\n     log.Printf(\"data: %s\\n\", data)\n     fmt.Fprintf(w, \"data: %s\\n\", data)\n     flusher.Flush()\n }\n</code></pre>\n\n<p>If you have more than one request you will notice it will write faster in the terminal, not bad but you will also notice that if the client closed the connection/browser you will still see data going out.</p>\n\n<p>A better way could execute the command within a context, from the example: <a href=\"https://golang.org/pkg/os/exec/#CommandContext\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/exec/#CommandContext</a></p>\n\n<pre><code>ctx, cancel := context.WithTimeout(context.Background(), 100*time.Millisecond)\ndefer cancel()\n\nif err := exec.CommandContext(ctx, \"sleep\", \"5\").Run(); err != nil {\n    // This will fail after 100 milliseconds. The 5 second sleep\n    // will be interrupted.\n}\n</code></pre>\n\n<p>Also take a look at the context (<a href=\"https://stackoverflow.com/a/44146619/1135424\">https://stackoverflow.com/a/44146619/1135424</a>) not replaces <code>http.CloseNotifier</code> so could be usefull for terminate the process once the client close browser, disconetcs.</p>\n\n<p>At the end depends on your needs but hope can give you an idea about how to stream data in an easy way by using the <code>http.Flusher</code> interface.</p>\n\n<p>Just for fun here is an example using the <a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\">context</a>:</p>\n\n<p><a href=\"https://play.golang.org/p/V69BuDUceBA\" rel=\"nofollow noreferrer\">https://play.golang.org/p/V69BuDUceBA</a></p>\n\n<p>Still very basic, but in this case if client closes the browser the program also terminates, as an exercice could be nice to improve it an share back ;-), notice the use of <a href=\"https://golang.org/pkg/os/exec/#CommandContext\" rel=\"nofollow noreferrer\">CommandContext</a> and <code>ctx.Done()</code></p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"os/exec\"\n\n    \"github.com/nbari/violetear\"\n)\n\nfunc stream(w http.ResponseWriter, r *http.Request) {\n    ctx := r.Context()\n    ch := make(chan struct{})\n\n    cmd := exec.CommandContext(ctx, \"python\", \"game.py\")\n    rPipe, wPipe, err := os.Pipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n    cmd.Stdout = wPipe\n    cmd.Stderr = wPipe\n    if err := cmd.Start(); err != nil {\n        log.Fatal(err)\n    }\n\n    go writeOutput(w, rPipe)\n\n    go func(ch chan struct{}) {\n        cmd.Wait()\n        wPipe.Close()\n        ch &lt;- struct{}{}\n    }(ch)\n\n    select {\n    case &lt;-ch:\n    case &lt;-ctx.Done():\n        err := ctx.Err()\n        log.Printf(\"Client disconnected: %s\\n\", err)\n    }\n}\n\nfunc writeOutput(w http.ResponseWriter, input io.ReadCloser) {\n    flusher, ok := w.(http.Flusher)\n    if !ok {\n        http.Error(w, \"Streaming not supported\", http.StatusInternalServerError)\n        return\n    }\n\n    // Important to make it work in browsers\n    w.Header().Set(\"Content-Type\", \"text/event-stream\")\n    w.Header().Set(\"Cache-Control\", \"no-cache\")\n    w.Header().Set(\"Connection\", \"keep-alive\")\n\n    in := bufio.NewScanner(input)\n    for in.Scan() {\n        data := in.Text()\n        log.Printf(\"data: %s\\n\", data)\n        fmt.Fprintf(w, \"data: %s\\n\", data)\n        flusher.Flush()\n    }\n    input.Close()\n}\n\nfunc main() {\n    router := violetear.New()\n    router.HandleFunc(\"/\", stream, \"GET\")\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n}\n</code></pre>\n"}], "owner": {"reputation": 405, "user_id": 4062625, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-Qsrh1RHLGX8/AAAAAAAAAAI/AAAAAAAAAGw/dCVzh6lGlLA/photo.jpg?sz=128", "display_name": "Coco Bennett", "link": "https://stackoverflow.com/users/4062625/coco-bennett"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1349, "favorite_count": 0, "accepted_answer_id": 49770937, "answer_count": 1, "score": 1, "last_activity_date": 1523456509, "creation_date": 1523390286, "last_edit_date": 1523456509, "question_id": 49761966, "link": "https://stackoverflow.com/questions/49761966/print-the-console-log-to-the-screen-of-a-webpage-continuously-using-go-routines", "title": "Print the console log to the screen of a webpage continuously using Go Routines", "body": "<p>I got the go routine below to work but the problem is that it prints to the console instead of to the screen. My idea is to have a running log of what commands or output is happening in a script show on a webpage where it can be watched in real time. Using fmt.Fprint doesn't do the trick. All that happens is that my webpage will never fully load. Help please?</p>\n\n<p><a href=\"https://stackoverflow.com/questions/41415337/running-external-python-in-golang-catching-continuous-exec-command-stdout\">Running external python in Golang, Catching continuous exec.Command Stdout</a></p>\n\n<p>go code</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"time\"\n    \"os/exec\"\n    \"io\"\n    \"bufio\"\n    \"fmt\"\n    \"github.com/gorilla/mux\"\n)\n\nfunc main() {\n    r := mux.NewRouter()\n    s := r.PathPrefix(\"/api/\").Subrouter()\n    s.HandleFunc(\"/export\", export).Methods(\"GET\")\n    http.Handle(\"/\", r)\n    log.Panic(http.ListenAndServe(\":80\", nil))\n}\n\nfunc export(w http.ResponseWriter, r *http.Request) {\n    cmd := exec.Command(\"python\", \"game.py\")\n    stdout, err := cmd.StdoutPipe()\n    if err != nil {\n        panic(err)\n    }\n    stderr, err := cmd.StderrPipe()\n    if err != nil {\n        panic(err)\n    }\n    err = cmd.Start()\n    if err != nil {\n        panic(err)\n    }\n\n    go copyOutput(stdout)\n    go copyOutput(stderr)\n    cmd.Wait()\n}\n\nfunc copyOutput(r io.Reader, w http.ResponseWriter) {\n    scanner := bufio.NewScanner(r)\n    for scanner.Scan() {\n        fmt.Fprint(w, scanner.Text()) //line I expect to print to the screen, but doesn't\n    }\n}\n</code></pre>\n\n<p>python script</p>\n\n<pre><code>import time\nimport sys\n\nwhile True:\n    print \"Hello\"\n    sys.stdout.flush()\n    time.sleep(1)\n</code></pre>\n\n<p>There's a lot more to the site so I know the route is configured correctly because printing to the screen works when I'm not using the go routine'</p>\n\n<p>UPDATE:</p>\n\n<p>Here is my new update function which prints to the screen, but only after the entire script has ran, not as it goes</p>\n\n<pre><code>func export(w http.ResponseWriter, r *http.Request) {\n    cmd := exec.Command(\"python\", \"game.py\")\n    cmd.Stdout = w\n    cmd.Start()\n    cmd.Wait()\n}\n</code></pre>\n\n<p>I believe I may still need a go routine in order to get it to print as I go, but putting cmd.Start and/or cmd.Wait in one doesn't work</p>\n\n<p>UPDATE:</p>\n\n<p>So even with everything given, I have not been able to get having the outputs show on a browser as they are ran working. It simply locks up the browser, even with the headers and flush. I will hopefully have time to give a complete, working answer to this but for now, the code above prints the code to the browser correctly after it has ran. I found a repo that I think may be what I'm looking for and maybe it will help others who come across this question as well.</p>\n\n<p><a href=\"https://github.com/yudai/gotty\" rel=\"nofollow noreferrer\">https://github.com/yudai/gotty</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1523388178, "post_id": 49761374, "comment_id": 86538229, "body": "You put it in square brackets, indicating a character class, but that doesn&#39;t seem like what you actually want."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1523388194, "post_id": 49761374, "comment_id": 86538237, "body": "What do you mean &quot;doesn&#39;t work&quot;. Neither of these looks like what you&#39;re describing, which would simply be <code>\\.$</code>"}, {"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523389537, "post_id": 49761374, "comment_id": 86538870, "body": "Yup, just as @JimB mentioned <a href=\"https://regexr.com/3nltg\" rel=\"nofollow noreferrer\">example</a>. I would like to add that it might be better to use <code>Trim</code> instead of regex here, for performance sake."}], "answers": [{"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 2, "creation_date": 1523391228, "post_id": 49761761, "comment_id": 86539708, "body": "strings.TrimSuffix would remove it from the end and <i>not</i> the start, if that&#39;s your desired behavior."}], "tags": [], "owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "is_accepted": true, "score": 2, "last_activity_date": 1523393199, "last_edit_date": 1592644375, "creation_date": 1523389457, "answer_id": 49761761, "question_id": 49761374, "link": "https://stackoverflow.com/questions/49761374/remove-full-stop-from-end-of-word-in-golang/49761761#49761761", "title": "remove full stop from end of word in golang", "body": "<p>I would probably not use regex here, how about strings.Trim here instead?\n(caveat- would not go through and find any in the middle of the words.)</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;strings&quot;\n)\n\nfunc main() {\n    testCases := []string{\n        &quot;abc.&quot;,\n        &quot;123.45&quot;,\n        &quot;How about in the middle. Is that ok?&quot;,\n    }\n\n    for _, tc := range testCases {\n        fmt.Println(strings.TrimSuffix(tc, &quot;.&quot;))\n    }\n}\n</code></pre>\n<p>Output:</p>\n<blockquote>\n<p>abc</p>\n<p>123.45</p>\n<p>How about in the middle. Is that ok?</p>\n</blockquote>\n"}], "owner": {"reputation": 1912, "user_id": 1450312, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/b4d2c938b517dd6409ba7bd4cb6cd461?s=128&d=identicon&r=PG&f=1", "display_name": "nad", "link": "https://stackoverflow.com/users/1450312/nad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 242, "favorite_count": 0, "accepted_answer_id": 49761761, "answer_count": 1, "score": -2, "last_activity_date": 1523393199, "creation_date": 1523387950, "question_id": 49761374, "link": "https://stackoverflow.com/questions/49761374/remove-full-stop-from-end-of-word-in-golang", "title": "remove full stop from end of word in golang", "body": "<p>I am new to golang. I need to remove full stop from end of word but not from floating point. I looked into <a href=\"https://stackoverflow.com/questions/39734443/regex-python-remove-full-stop-from-end-of-word-but-not-in-float\">this post</a>. The python approach <code>r'(?&lt;!\\d)\\.(?!\\d)'</code> is not exactly applicable in golang so following this <a href=\"http://yourbasic.org/golang/regexp-cheat-sheet/\" rel=\"nofollow noreferrer\">cheatsheet</a>, I wrote below</p>\n\n<pre><code>re, err := regexp.Compile(\"[.$]\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\nprocessedString = re.ReplaceAllString(\"3.2isgood.\", \"\")\n</code></pre>\n\n<p>But that doesn't work. Can you please suggest?</p>\n"}, {"tags": ["go", "hyperledger-fabric"], "comments": [{"owner": {"reputation": 8115, "user_id": 4749297, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/LXTZX.jpg?s=128&g=1", "display_name": "Lansana Camara", "link": "https://stackoverflow.com/users/4749297/lansana-camara"}, "edited": false, "score": 0, "creation_date": 1523382533, "post_id": 49760013, "comment_id": 86535057, "body": "Show us what you have tried and where it is failing."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523382969, "post_id": 49760013, "comment_id": 86535297, "body": "Please provide <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable</a> example"}, {"owner": {"reputation": 983, "user_id": 6499004, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-I0fHv3jbsbs/AAAAAAAAAAI/AAAAAAAADUo/bejrpeXzWwg/photo.jpg?sz=128", "display_name": "mahima", "link": "https://stackoverflow.com/users/6499004/mahima"}, "edited": false, "score": 0, "creation_date": 1523383035, "post_id": 49760013, "comment_id": 86535329, "body": "Please check. I have added now"}], "answers": [{"comments": [{"owner": {"reputation": 983, "user_id": 6499004, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-I0fHv3jbsbs/AAAAAAAAAAI/AAAAAAAADUo/bejrpeXzWwg/photo.jpg?sz=128", "display_name": "mahima", "link": "https://stackoverflow.com/users/6499004/mahima"}, "edited": false, "score": 0, "creation_date": 1523388235, "post_id": 49760849, "comment_id": 86538261, "body": "Do I need to set chaincode.id.name in the main? It will still give error as: <code>cannot refer to unexported name chaincode.id</code> I tried os.Setenv, but it did not work"}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 1, "last_activity_date": 1523385706, "creation_date": 1523385706, "answer_id": 49760849, "question_id": 49760013, "link": "https://stackoverflow.com/questions/49760013/error-while-running-chaincode-program/49760849#49760849", "title": "Error while running Chaincode program", "body": "<p>In you look at <a href=\"https://github.com/hyperledger/fabric/blob/release-1.1/core/chaincode/shim/chaincode.go#L130\" rel=\"nofollow noreferrer\">the source</a> you see it is doing</p>\n\n<pre><code>chaincodename := viper.GetString(\"chaincode.id.name\")\nif chaincodename == \"\" {\n    return errors.New(\"error chaincode id not provided\")\n}\n</code></pre>\n\n<p>I believe you can just do:</p>\n\n<pre><code>os.Setenv(\"chaincode.id.name\", \"whatever\")\n</code></pre>\n\n<p>or</p>\n\n<pre><code>chaincode.id.name=whatever go run main.go\n</code></pre>\n\n<p>To get past that.</p>\n\n<p>As far as specifying the length of an attribute, of course you can.  You either use a data structure with a length (e.g. <code>[10]byte</code>), or make the field private and verify the length in your setter method.</p>\n\n<p><a href=\"https://play.golang.org/p/WvG-ZWKhrZ7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/WvG-ZWKhrZ7</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype SomeDocument struct {\n    DocumentID   [10]byte `json:\"docid\"`\n    CreatorID    string `json:\"uid\"`\n    DocHolder    string `json:\"doc_holder\"`\n    Location     string `json:\"location\"`\n    DocumentType string `json:\"doc_type\"`\n    Content      string `json:\"doc_content\"`\n}\n\nfunc (s *SomeDocument) SetDocumentID(id string) {\n    copy(s.DocumentID[:], []byte(id))\n}\n\nfunc (s SomeDocument) MarshalJSON() ([]byte, error) {\n    tmp := struct {\n    DocumentID   string `json:\"docid\"`\n    CreatorID    string `json:\"uid\"`\n    DocHolder    string `json:\"doc_holder\"`\n    Location     string `json:\"location\"`\n    DocumentType string `json:\"doc_type\"`\n    Content      string `json:\"doc_content\"`\n    }{\n    string(s.DocumentID[:]),\n    s.CreatorID,\n    s.DocHolder,\n    s.Location,\n    s.DocumentType,\n    s.Content,\n    }\n    return json.Marshal(tmp)\n}\n\nfunc main() {\n    s := SomeDocument{}\n    s.SetDocumentID(\"1234567890abcd\")\n    js, err := json.Marshal(s)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(js))\n    // {\"docid\":\"1234567890\",\"uid\":\"\",\"doc_holder\":\"\",\"location\":\"\",\"doc_type\":\"\",\"doc_content\":\"\"}\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 38497, "user_id": 104014, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3d186f3c6ad2de59b356c1cfad9af404?s=128&d=identicon&r=PG", "display_name": "Artem Barger", "link": "https://stackoverflow.com/users/104014/artem-barger"}, "is_accepted": false, "score": 1, "last_activity_date": 1523445748, "creation_date": 1523445748, "answer_id": 49773808, "question_id": 49760013, "link": "https://stackoverflow.com/questions/49760013/error-while-running-chaincode-program/49773808#49773808", "title": "Error while running Chaincode program", "body": "<p>It looks like you trying to run your chaincode from your IDE or locally, I'd suggest to consult with documentation and particular to see how to <a href=\"http://hyperledger-fabric.readthedocs.io/en/release-1.0/peer-chaincode-devmode.html\" rel=\"nofollow noreferrer\">execute chaincode in devmode</a>.</p>\n\n<p>In your case you just missing a few environment variables:</p>\n\n<pre><code>export CORE_CHAINCODE_LOGLEVEL=debug \nexport CORE_PEER_ADDRESS=127.0.0.1:7052 \nexport CORE_CHAINCODE_ID_NAME=mycc:0 // &lt;--- name and version of your chaincode\n</code></pre>\n\n<p>which needed to execute your chaincode locally.</p>\n"}], "owner": {"reputation": 983, "user_id": 6499004, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-I0fHv3jbsbs/AAAAAAAAAAI/AAAAAAAADUo/bejrpeXzWwg/photo.jpg?sz=128", "display_name": "mahima", "link": "https://stackoverflow.com/users/6499004/mahima"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 420, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1523445748, "creation_date": 1523382469, "last_edit_date": 1523383894, "question_id": 49760013, "link": "https://stackoverflow.com/questions/49760013/error-while-running-chaincode-program", "title": "Error while running Chaincode program", "body": "<p>I am writing chaincode program in GO on my MacOS. Following is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n\n    \"github.com/hyperledger/fabric/core/chaincode/shim\"\n    sc \"github.com/hyperledger/fabric/protos/peer\"\n)\n\n//Init and Invoke\ntype SmartContract struct {\n}\n\ntype SomeDocument struct {\n    DocumentID   string `json:\"docid\"`\n    CreatorID    string `json:\"uid\"`\n    DocHolder    string `json:\"doc_holder\"`\n    Location     string `json:\"location\"`\n    DocumentType string `json:\"doc_type\"`\n    Content      string `json:\"doc_content\"`\n}\n\nfunc (s *SmartContract) Init(APIstub shim.ChaincodeStubInterface) sc.Response {\n    return shim.Success(nil)\n}\n\nfunc (s *SmartContract) Invoke(APIstub shim.ChaincodeStubInterface) sc.Response {\n\n    return shim.Success(nil)\n}\n\nfunc main() {\n    first_doc := SomeDocument{\"1001\", \"123456789012\", \"ABCD EFGH\", \"New Delhi\", \"School Form\", \"I want to enroll in this school\"}\n    theJson, _ := json.Marshal(first_doc) //returns JSON encoding of first_stamp\n    fmt.Printf(\"%+v\\n\", string(theJson))\n    err := shim.Start(new(SmartContract))\n    if err != nil {\n        fmt.Printf(\"Error creating new Smart Document: %s\", err)\n    } else {\n        fmt.Println(\"Success\")\n    }\n}\n</code></pre>\n\n<p>It is showing the following error due to this line, shim.Start(new(SmartContract)):</p>\n\n<pre><code>{\"docid\":\"1001\",\"uid\":\"123456789012\",\"doc_holder\":\"ABCD EFGH\",\"location\":\"New Delhi\",\"doc_type\":\"School Form\",\"doc_content\":\"I want to enroll in this school\"}\n    2018-04-10 23:34:41.598 IST [shim] SetupChaincodeLogging -&gt; INFO 001 Chaincode log level not provided; defaulting to: INFO\n    2018-04-10 23:34:41.598 IST [shim] SetupChaincodeLogging -&gt; INFO 002 Chaincode (build level: ) starting up ...\n    Error creating new Smart Document: error chaincode id not provided%\n</code></pre>\n\n<p>I cannot find any solution. </p>\n\n<p>Is it possible to specify the limit on the length of struct attributes?. For example DocumentID should be length 10.</p>\n"}, {"tags": ["arrays", "for-loop", "go", "indexing"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1523377214, "post_id": 49758406, "comment_id": 86531947, "body": "Have you gone through the Tour of Go? Specifically the <a href=\"https://tour.golang.org/moretypes/7\" rel=\"nofollow noreferrer\">section on slices</a>? Or looked at the <a href=\"https://golang.org/doc/effective_go.html#slices\" rel=\"nofollow noreferrer\">Effective Go section on slices</a>? Or the <a href=\"https://golang.org/ref/spec#Making_slices_maps_and_channels\" rel=\"nofollow noreferrer\">documentation on making and appending to slices</a>? Or <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">Slices: Usage and Internals</a>? Or <a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">Arrays Slices and Strings</a>"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1523378769, "last_edit_date": 1523378769, "creation_date": 1523377208, "answer_id": 49758517, "question_id": 49758406, "link": "https://stackoverflow.com/questions/49758406/for-loop-causing-panic-runtime-error-due-to-nil-map-or-slice/49758517#49758517", "title": "For Loop causing panic: runtime error due to nil map or slice", "body": "<p>Allocate the slice. For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    x := make([]int, 32)\n    for i := range x {\n        x[i] = i + 1\n    }\n    fmt.Println(x == nil, len(x), cap(x), x)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/UVrUAZHtTw-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/UVrUAZHtTw-</a></p>\n\n<p>Output:</p>\n\n<pre><code>false 32 32 [1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32]\n</code></pre>\n\n<hr>\n\n<p>In your example, you have a zero-value (<code>nil</code>) slice which has length 0. Therefore, <code>x[i]</code> or <code>x[0]</code> is <code>panic: runtime error: index out of range</code>.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var x []int\n    fmt.Println(x == nil, len(x), cap(x), x)\n    for i := 0; i &lt; 32; i++ {\n        x[i] = i + 1\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/3hG5FpV3_dC\" rel=\"nofollow noreferrer\">https://play.golang.org/p/3hG5FpV3_dC</a></p>\n\n<p>Output:</p>\n\n<pre><code>true 0 0 []\npanic: runtime error: index out of range\nmain.go:9\n</code></pre>\n\n<hr>\n\n<p>References:</p>\n\n<p><a href=\"https://tour.golang.org/\" rel=\"nofollow noreferrer\">A Tour of Go</a></p>\n\n<p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a> </p>\n\n<p><a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\">Slice types</a> </p>\n\n<p><a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"nofollow noreferrer\">Index expressions</a></p>\n\n<p><a href=\"https://golang.org/ref/spec#Making_slices_maps_and_channels\" rel=\"nofollow noreferrer\">Making slices, maps and channels</a> </p>\n"}], "owner": {"reputation": 366, "user_id": 5228646, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/6Vc3O.png?s=128&g=1", "display_name": "JeanP", "link": "https://stackoverflow.com/users/5228646/jeanp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1389, "favorite_count": 1, "accepted_answer_id": 49758517, "answer_count": 1, "score": -2, "last_activity_date": 1523378769, "creation_date": 1523376847, "question_id": 49758406, "link": "https://stackoverflow.com/questions/49758406/for-loop-causing-panic-runtime-error-due-to-nil-map-or-slice", "title": "For Loop causing panic: runtime error due to nil map or slice", "body": "<p>Hey I am trying to create a simple scalar vector for my program.</p>\n\n<p>I was starting with a simple variable and incrementing it to make it a 32 by 1 size vector matrix. </p>\n\n<pre><code>var x []int\nfor i := 0; i &lt; 32 ; i++{\n    x[i] = i + 1\n}\n</code></pre>\n\n<p>Simple enough but when trying to compile this I get this error. </p>\n\n<pre><code>panic: runtime error: index out of range\n\ngoroutine 1 [running]:\nmain.main()\n    /Users/jeanmac/go/src/matrices/main.go:69 +0x7d\n\nProcess finished with exit code 2\n</code></pre>\n\n<p>Not sure why. FYI Line 69 refers to <code>x[i] = i + 1</code>.\nWhen trying to assign <code>x[i]</code> I receive the following warning.</p>\n\n<p><code>Reports indexing of nil map or slice that may lead to runtime panic.</code></p>\n\n<p>Not sure why this seems to be happening. </p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 706, "user_id": 167233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e326007182b2b41b557a3f035ff318ce?s=128&d=identicon&r=PG", "display_name": "Slabgorb", "link": "https://stackoverflow.com/users/167233/slabgorb"}, "edited": false, "score": 0, "creation_date": 1523472859, "post_id": 49758161, "comment_id": 86580327, "body": "The combination of the table schema with fields <code>user_id</code>, <code>name</code>, and <code>value</code> with the queries referencing fields like <code>age</code>, <code>job</code>, and <code>salary</code> is a bit confusing, is there a different table involved as well?"}], "answers": [{"comments": [{"owner": {"reputation": 59, "user_id": 9503747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/117e7dfc4c78542591bf46f210152b47?s=128&d=identicon&r=PG&f=1", "display_name": "Medone", "link": "https://stackoverflow.com/users/9503747/medone"}, "edited": false, "score": 0, "creation_date": 1523436048, "post_id": 49759163, "comment_id": 86555630, "body": "i think mr @Frank that the UNION  solution  is for one field  selection here i have two collect different fields"}, {"owner": {"reputation": 6841, "user_id": 3960399, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/c5OVT.jpg?s=128&g=1", "display_name": "Frank Bryce", "link": "https://stackoverflow.com/users/3960399/frank-bryce"}, "reply_to_user": {"reputation": 59, "user_id": 9503747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/117e7dfc4c78542591bf46f210152b47?s=128&d=identicon&r=PG&f=1", "display_name": "Medone", "link": "https://stackoverflow.com/users/9503747/medone"}, "edited": false, "score": 0, "creation_date": 1523470339, "post_id": 49759163, "comment_id": 86579046, "body": "I&#39;m actually not sure that that&#39;s a requirement to use UNION, but I deleted that part anyways to avoid confusion.  I think the code above should work just fine for you, though."}], "tags": [], "owner": {"reputation": 6841, "user_id": 3960399, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/c5OVT.jpg?s=128&g=1", "display_name": "Frank Bryce", "link": "https://stackoverflow.com/users/3960399/frank-bryce"}, "is_accepted": false, "score": 0, "last_activity_date": 1523470300, "last_edit_date": 1523470300, "creation_date": 1523379461, "answer_id": 49759163, "question_id": 49758161, "link": "https://stackoverflow.com/questions/49758161/making-enumeration-columns-value-into-fields/49759163#49759163", "title": "Making enumeration columns value into fields", "body": "<p>First, the queries should look like this.</p>\n\n<pre><code> userAgeValues, err1 := db1.Query(\"select value from users where user_id=$1 and name=\\\"age\\\";\", user_idvalue)\n userJobValues, err2 := db1.Query(\"select value from users where user_id=$1 and name=\\\"job\\\"\", user_idvalue)\n userSalaryValues, err3 := db1.Query(\"select value from users where user_id=$1 and name=\\\"salary\\\"\", user_idvalue)\n</code></pre>\n\n<p>Then you have these values to do with what you want. Based on your description there should only be 1 row in each of these results.</p>\n"}, {"comments": [{"owner": {"reputation": 59, "user_id": 9503747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/117e7dfc4c78542591bf46f210152b47?s=128&d=identicon&r=PG&f=1", "display_name": "Medone", "link": "https://stackoverflow.com/users/9503747/medone"}, "edited": false, "score": 0, "creation_date": 1523436234, "post_id": 49759606, "comment_id": 86555760, "body": "thanks @Jilan but this is  far away from what i am working on the problem as i explained is a getting data from a multiple query"}], "tags": [], "owner": {"reputation": 89, "user_id": 5124032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50b593302405409d5b2f916309d962e0?s=128&d=identicon&r=PG&f=1", "display_name": "Jilan", "link": "https://stackoverflow.com/users/5124032/jilan"}, "is_accepted": false, "score": -1, "last_activity_date": 1523380954, "creation_date": 1523380954, "answer_id": 49759606, "question_id": 49758161, "link": "https://stackoverflow.com/questions/49758161/making-enumeration-columns-value-into-fields/49759606#49759606", "title": "Making enumeration columns value into fields", "body": "<p>you can create a map with key= user_id and value = user struct</p>\n\n<p>define a user struct and map :</p>\n\n<pre><code>type user struct{\n    age    string\n    salary string\n    job    string\n}\nuser := make(map[int]user)\n</code></pre>\n\n<p>get the whole data from the table and start loading it into your map</p>\n"}], "owner": {"reputation": 59, "user_id": 9503747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/117e7dfc4c78542591bf46f210152b47?s=128&d=identicon&r=PG&f=1", "display_name": "Medone", "link": "https://stackoverflow.com/users/9503747/medone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1523470300, "creation_date": 1523376057, "last_edit_date": 1523394576, "question_id": 49758161, "link": "https://stackoverflow.com/questions/49758161/making-enumeration-columns-value-into-fields", "title": "Making enumeration columns value into fields", "body": "<p>I have a table that contains 3 fields: </p>\n\n<p><code>user_id</code>, <code>name</code>, <code>value</code></p>\n\n<p>There is no primary key in the table, the <code>user_id</code> can have duplicate values, For the <code>name</code> there are enumerated fields <strong>age, job and salary.</strong></p>\n\n<pre><code>user_id |   name | value\n------------------------\n      1 |    age |    20\n------------------------\n      1 |    job |    IT\n------------------------\n      2 | salary | 20000\n------------------------\n      2 |    job |   Dev\n------------------------\n      2 |    age |    30\n------------------------\n</code></pre>\n\n<p>I want to create a structure like below</p>\n\n<pre><code>user_id | age | job | salary\n----------------------------\n      1 |  20 |  IT |   NULL \n----------------------------\n      2 |  30 | Dev |  20000\n----------------------------\n</code></pre>\n\n<p>Main query : </p>\n\n<pre><code> rows, err := db1.Query(\"select user_id from main_users\");\n\n for rows.Next() {     \n     rows.scan(&amp;user_id)\n\n     id := reflect.ValueOf(user_id)\n     user_idvalue := id.Interface().(int)\n\n     rows1, err1 := db1.Query(\"select age from users where user_id=$1\", user_idvalue)\n     rows2, err2 := db1.Query(\"select job from users where user_id=$1\", user_idvalue)\n     rows3, err3 := db1.Query(\"select salary from users where user_id=$1\", user_idvalue)\n }\n</code></pre>\n\n<p>I am stuck at the part of with each result line the id compared for the 3 others queries and to be shown as one table.</p>\n"}, {"tags": ["go", "scope"], "comments": [{"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 2, "creation_date": 1523371730, "post_id": 49756621, "comment_id": 86528354, "body": "Containing block here is a block where the function is defined, not from which it is called. Most blocks are framed in <code>{ }</code>."}], "answers": [{"tags": [], "owner": {"reputation": 15219, "user_id": 894977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f18198ad9bdf73fa1d90956f7028254?s=128&d=identicon&r=PG", "display_name": "Cetin Basoz", "link": "https://stackoverflow.com/users/894977/cetin-basoz"}, "is_accepted": false, "score": 1, "last_activity_date": 1523372148, "creation_date": 1523372148, "answer_id": 49756841, "question_id": 49756621, "link": "https://stackoverflow.com/questions/49756621/function-calls-function-in-go/49756841#49756841", "title": "Function calls function in Go", "body": "<p>In the same paragraph it also says this:</p>\n\n<blockquote>\n  <p>An identifier declared in a block may be redeclared in an inner block.\n  While the identifier of the inner declaration is in scope, it denotes\n  the entity declared by the inner declaration.</p>\n</blockquote>\n\n<p>Thus the answer should be \"GOG\".</p>\n"}, {"comments": [{"owner": {"reputation": 2251, "user_id": 5238892, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b27ed4cd2a119f7efeaad687f11403cb?s=128&d=identicon&r=PG&f=1", "display_name": "Simin Jie", "link": "https://stackoverflow.com/users/5238892/simin-jie"}, "edited": false, "score": 0, "creation_date": 1523372746, "post_id": 49756846, "comment_id": 86529068, "body": "So a funtion&#39;s scope is the <code>current global scope</code> + <code>current function&#39;s own scope&#39;</code>? If you want to change the scope of a called function, you can either change the global scope or the scope of the called function."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 2251, "user_id": 5238892, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b27ed4cd2a119f7efeaad687f11403cb?s=128&d=identicon&r=PG&f=1", "display_name": "Simin Jie", "link": "https://stackoverflow.com/users/5238892/simin-jie"}, "edited": false, "score": 1, "creation_date": 1523372863, "post_id": 49756846, "comment_id": 86529157, "body": "You can&#39;t change a called function&#39;s scope. You can modify existing global variables&#39; values, and a function (however it is called) can create new local variables, which may shadow global variables."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1523372151, "creation_date": 1523372151, "answer_id": 49756846, "question_id": 49756621, "link": "https://stackoverflow.com/questions/49756621/function-calls-function-in-go/49756846#49756846", "title": "Function calls function in Go", "body": "<p>Your function <code>f1</code> creates a new, local variable <code>a</code> which <em>shadows</em> the global variable <code>a</code>:</p>\n\n<pre><code>func f1() {\n   a := \"O\"\n   print(a)\n   f2()\n}\n</code></pre>\n\n<p>That variable is scoped to <code>f1</code>. Any function it calls has its own scope, no scope change within <code>f1</code> has any impact on any other function it calls (excepting closures). So, when <code>f2</code> accesses <code>a</code>, it is accessing the <em>global</em> <code>a</code>. Otherwise, determining behavior would be nearly impossible because it would depend entirely on the calling context which can vary between different calls to the same function. If you want to pass some value to a function, pass it as a parameter.</p>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1523373840, "post_id": 49757090, "comment_id": 86529803, "body": "A <a href=\"https://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow noreferrer\">function is a containing block</a> whether or not it declares or shadows any variables. Your latter example is called a <a href=\"https://golang.org/ref/spec#Function_literals\" rel=\"nofollow noreferrer\">closure</a>."}, {"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1523382640, "post_id": 49757090, "comment_id": 86535110, "body": "I did not say otherwise, but I changed my answer to be a bit clearer. Thanks for your input.  The whole example contains a closure, but it is not a very good example for a closure. That topic is a bit beside the point."}], "tags": [], "owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "is_accepted": false, "score": 1, "last_activity_date": 1523382060, "last_edit_date": 1523382060, "creation_date": 1523372753, "answer_id": 49757090, "question_id": 49756621, "link": "https://stackoverflow.com/questions/49756621/function-calls-function-in-go/49757090#49757090", "title": "Function calls function in Go", "body": "<p>Containing blocks in function are any control structures, like e.g. <code>if</code>, <code>for</code> or <code>switch</code>.</p>\n\n<p>Functions can be containing blocks for variables. In your example <code>f1</code> is a containing block, as it redeclares <code>a</code> and shadows the global declaration.</p>\n\n<p><code>f2</code> is not in <code>f1</code>s block. They are declared at the same level. But you could define a function inside another function:</p>\n\n<pre><code>func f1() {\n    a := \"a1\" // f1 is containig block for a\n    f2 := func () {\n        // a is visible here, too\n        b := \"b\" // f2 is containing block for b, only visible in f2\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2251, "user_id": 5238892, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b27ed4cd2a119f7efeaad687f11403cb?s=128&d=identicon&r=PG&f=1", "display_name": "Simin Jie", "link": "https://stackoverflow.com/users/5238892/simin-jie"}, "is_accepted": false, "score": 0, "last_activity_date": 1523374587, "creation_date": 1523374587, "answer_id": 49757726, "question_id": 49756621, "link": "https://stackoverflow.com/questions/49756621/function-calls-function-in-go/49757726#49757726", "title": "Function calls function in Go", "body": "<p>To understand this question, I think you should first realize <a href=\"http://qr.ae/TU1in0\" rel=\"nofollow noreferrer\">What happens when a function is called</a>.</p>\n\n<p>When <code>f1</code> call <code>f2</code>, <code>f1</code>'s return address, <code>f2</code>'s parameters and locals will be added to the stack. So <code>f2</code> can only visit its locals and current globals.</p>\n\n<p>The <code>a := \"O\"</code> in <code>f1</code> only updates the locals of <code>f1</code> and doesn't affect the globals. So <code>f2</code> will read <code>a</code>(the value is same <code>G</code>) from globals.</p>\n\n<p>In summarize, when call <code>f2()</code> in <code>f1</code>, the <code>f2()</code> is in <code>f1</code>'s block, but when enter <code>f2</code>, <code>f1</code>'s block  has no concern with <code>f2</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 89, "user_id": 5124032, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50b593302405409d5b2f916309d962e0?s=128&d=identicon&r=PG&f=1", "display_name": "Jilan", "link": "https://stackoverflow.com/users/5124032/jilan"}, "is_accepted": false, "score": 1, "last_activity_date": 1523380514, "creation_date": 1523380514, "answer_id": 49759475, "question_id": 49756621, "link": "https://stackoverflow.com/questions/49756621/function-calls-function-in-go/49759475#49759475", "title": "Function calls function in Go", "body": "<p>you are creating a new variable 'a' in f1()\ntry this :</p>\n\n<pre><code>package main\n\nvar a string\n\nfunc main() {\n    a = \"G\"\n    print(a)\n    f1()\n}\n\nfunc f1() {\n    a = \"O\"\n    print(a)\n    f2()\n }\n\nfunc f2() {\n    print(a)\n}\n</code></pre>\n\n<p>by removing ':' before '=' you will refer to the global variable</p>\n"}], "owner": {"reputation": 2251, "user_id": 5238892, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b27ed4cd2a119f7efeaad687f11403cb?s=128&d=identicon&r=PG&f=1", "display_name": "Simin Jie", "link": "https://stackoverflow.com/users/5238892/simin-jie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 0, "accepted_answer_id": 49756846, "answer_count": 5, "score": -2, "last_activity_date": 1523382060, "creation_date": 1523371577, "question_id": 49756621, "link": "https://stackoverflow.com/questions/49756621/function-calls-function-in-go", "title": "Function calls function in Go", "body": "<pre><code>package main\n\nvar a string\n\nfunc main() {\n   a = \"G\"\n   print(a)\n   f1()\n}\n\nfunc f1() {\n   a := \"O\"\n   print(a)\n   f2()\n}\n\nfunc f2() {\n   print(a)\n}\n</code></pre>\n\n<p>I think <code>f2</code> will be in <code>f1</code>'s block when call <code>f2</code> in <code>f1</code>, so the output will be <code>GOO</code>, but the output is <code>GOG</code> instead.</p>\n\n<blockquote>\n  <p>The scope of a type identifier declared inside a function begins at the identifier in the TypeSpec and ends at the end of the innermost containing block.  -- From <a href=\"https://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Declarations_and_scope</a></p>\n</blockquote>\n\n<p>What are containing blocks inside a function? </p>\n\n<p>Why another function is not containing block?</p>\n"}, {"tags": ["go", "tcp"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1523371287, "post_id": 49756377, "comment_id": 86527990, "body": "Run the application with the <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">race detector</a> and fix any issues.  Show the code that writes to the connection."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1523371604, "post_id": 49756377, "comment_id": 86528246, "body": "<code>panic: close of closed channel</code> means you have a fundamental problem with the program logic, and you need to fix that first which may also include the <code>use of closed network connection</code>. You also need to read correctly from the connection -- always handle bytes read before handling the error;  see the <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\"><code>io.Reader</code> documentation</a>"}], "answers": [{"tags": [], "owner": {"reputation": 108, "user_id": 6137334, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zaM6c.jpg?s=128&g=1", "display_name": "daniel.rigberg", "link": "https://stackoverflow.com/users/6137334/daniel-rigberg"}, "is_accepted": false, "score": -1, "last_activity_date": 1523378763, "creation_date": 1523378763, "answer_id": 49758964, "question_id": 49756377, "link": "https://stackoverflow.com/questions/49756377/new-tcp-connection-throws-use-of-closed-network-connection-even-though-its-ju/49758964#49758964", "title": "New TCP connection throws &quot;use of closed network connection&quot; even though it&#39;s just been opened", "body": "<p>Okay, solved. I need to implement backoff for the first write to the channel, because sometimes it failed on the first attempt. Now it gracefully waits a moment and connects perfectly. Here's what it looks like:</p>\n\n<pre><code>func SendBackoff(data []byte, client *types.Client, i int) {\n    select {\n    case client.Data &lt;- data:\n        return\n    default:\n        time.Sleep(500 * time.Millisecond)\n\n        fmt.Println(\"Trying again!\", i)\n        if (i &gt; 5) {\n            return\n        }\n        SendBackoff(data, client, i + 1)\n    }\n}\n\nfunc SendToClient(request types.Request, client *types.Client) {\n    data, err := util.GobToBytes(request)\n\n    if err != nil {\n            fmt.Println(err)\n            return\n    }\n\n    fmt.Println(\"Trying to send:\", data)\n\n    SendBackoff(data, client, 1)\n}\n</code></pre>\n"}], "owner": {"reputation": 108, "user_id": 6137334, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zaM6c.jpg?s=128&g=1", "display_name": "daniel.rigberg", "link": "https://stackoverflow.com/users/6137334/daniel-rigberg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2496, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1523378763, "creation_date": 1523370930, "last_edit_date": 1523375597, "question_id": 49756377, "link": "https://stackoverflow.com/questions/49756377/new-tcp-connection-throws-use-of-closed-network-connection-even-though-its-ju", "title": "New TCP connection throws &quot;use of closed network connection&quot; even though it&#39;s just been opened", "body": "<p>When opening new connections, I sometimes get the \"use of closed network connection\" error at <code>client.Socket.Read(message)</code> in the <code>receive</code> function.</p>\n\n<p>This is odd enough, but what's really weird is that I then get an error for trying to close a closed channel at <code>close(connection.Data)</code>, when the client is passed through <code>manager.unregister</code>.</p>\n\n<p>I'm clearly missing something here, because all of my logging suggests that these are entirely new and unused channels and sockets.</p>\n\n<p>Any ideas?</p>\n\n<p>I'm using Golang version 1.10.</p>\n\n<pre><code>type ClientManager struct {\n    clients map[*types.Client]bool\n    broadcast chan []byte\n    register chan *types.Client\n    unregister chan *types.Client\n}\n\nfunc CloseSocket(client *types.Client) {\n    client.M.Lock()\n    defer client.M.Unlock()\n\n    if !client.Closed {\n        client.Socket.Close()\n        client.Closed = true\n    }\n}\n\nfunc (manager *ClientManager) receive(client *types.Client) {\n    for {\n            message := make([]byte, 4096)\n            fmt.Println(\"client listening:\", client)\n            length, err := client.Socket.Read(message)\n\n            if err != nil {\n                    fmt.Println(err)\n                    manager.unregister &lt;- client\n                    CloseSocket(client)\n                    break\n            }\n            if length &gt; 0 {\n                    request := util.DecodeGob(message)\n                    HandleRequest(request, client)\n            }\n    }\n}\n\nfunc (manager *ClientManager) start() {\n    fmt.Println(\"Listening for TCP connections...\")\n    for {\n            select {\n            case connection := &lt;-manager.register:\n                    manager.clients[connection] = true\n                    fmt.Println(\"Added new connection!\")\n            case connection := &lt;-manager.unregister:\n                    if _, ok := manager.clients[connection]; ok {\n                            close(connection.Data)\n                            delete(manager.clients, connection)\n                            fmt.Println(\"manager.clients:\", manager.clients)\n                            fmt.Println(\"A connection has terminated!\")\n                    }\n    }\n}\n\nfunc Run(port string) {\n    fmt.Println(\"Starting server...\")\n\n    listener, error := net.Listen(\"tcp\", port)\n\n    if error != nil {\n            fmt.Println(error)\n    }\n\n    manager := ClientManager{\n            clients: make(map[*types.Client]bool),\n            broadcast: make(chan []byte),\n            register: make(chan *types.Client),\n            unregister: make(chan *types.Client),\n    }\n\n    go manager.start()\n\n    fmt.Println(\"Server running on port \" + port + \"!\")\n\n    for {\n            connection, _ := listener.Accept()\n            if error != nil {\n                    fmt.Println(error)\n            }\n\n            fmt.Println(\"\\nRemote address:\", connection.RemoteAddr())\n\n            client := &amp;types.Client{Socket: connection, Data: make(chan []byte)}\n\n            manager.register &lt;- client\n            go manager.receive(client)\n            go manager.send(client)\n    }\n}\n</code></pre>\n\n<p>And the logging: </p>\n\n<pre><code>Starting server...\nServer running on port :9000!\nListening for TCP connections...\n\nRemote address: [::1]:54857\nAdded new connection!\nclient listening: &amp;{0xc42000e528 0xc42007e240 false}\nEOF\nmanager.clients: map[]\nA connection has terminated!\n\nRemote address: [::1]:54860\nAdded new connection!\nclient listening: &amp;{0xc4200e2000 0xc4200e6000 false}\nEOF\nmanager.clients: map[]\nA connection has terminated!\n\nRemote address: [::1]:54863\nAdded new connection!\nclient listening: &amp;{0xc420110000 0xc420116000 false}\nread tcp [::1]:9000-&gt;[::1]:54863: use of closed network connection\npanic: close of closed channel\n\ngoroutine 5 [running]:\ngo_gomoku/server.(*ClientManager).start(0xc42000c920)\n    /Users/themainframe/go/src/go_gomoku/server/server.go:397 +0x35c\ncreated by go_gomoku/server.Run\n    /Users/themainframe/go/src/go_gomoku/server/server.go:434 +0x242\n</code></pre>\n\n<p>Edit: added mutex to client, no more race output. Bug still present.</p>\n"}, {"tags": ["go", "type-conversion", "biginteger"], "comments": [{"owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "edited": false, "score": 0, "creation_date": 1523364552, "post_id": 49754100, "comment_id": 86522814, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/11810948/convert-a-bigint-to-a-string-in-go\">Convert a bigint to a string in Go</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523365377, "post_id": 49754100, "comment_id": 86523447, "body": "Converting the <code>uint64</code> to <code>int64</code> is going to give you the wrong value if it&#39;s greater than <code>1&lt;&lt;63 - 1</code>"}], "answers": [{"comments": [{"owner": {"reputation": 32833, "user_id": 313245, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0f991af3360e1c039243ce45fab996bf?s=128&d=identicon&r=PG", "display_name": "Hossein", "link": "https://stackoverflow.com/users/313245/hossein"}, "edited": false, "score": 0, "creation_date": 1523365356, "post_id": 49754410, "comment_id": 86523435, "body": "Thanks! somehow I missed the SetUint64 method"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1523365804, "last_edit_date": 1523365804, "creation_date": 1523365274, "answer_id": 49754410, "question_id": 49754100, "link": "https://stackoverflow.com/questions/49754100/how-to-convert-a-uint64-to-big-int-in-golang/49754410#49754410", "title": "How to convert a uint64 to big.Int in golang?", "body": "<p>Shortest and safest would be to use the <a href=\"https://golang.org/pkg/math/big/#Int.SetUint64\" rel=\"noreferrer\"><code>Int.SetUint64()</code></a> method:</p>\n\n<pre><code>var x uint64 = 10\n\ni := new(big.Int).SetUint64(x)\n\nfmt.Println(i) // Prints 10\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/3PYPK4lpCx1\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p>Care should be taken when manually converting <code>uint64</code> to <code>int64</code> (as in your example), as overflow might happen which you won't be notified about, but you will end up with a negative value.</p>\n\n<p>If you can be sure the value fits into an <code>int64</code>, using the <a href=\"https://golang.org/pkg/math/big/#NewInt\" rel=\"noreferrer\"><code>big.NewInt()</code></a> function is shorter:</p>\n\n<pre><code>i := big.NewInt(int64(x))\n</code></pre>\n\n<p>Try this one on the <a href=\"https://play.golang.org/p/N1HytzW4faw\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 32833, "user_id": 313245, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0f991af3360e1c039243ce45fab996bf?s=128&d=identicon&r=PG", "display_name": "Hossein", "link": "https://stackoverflow.com/users/313245/hossein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2955, "favorite_count": 0, "accepted_answer_id": 49754410, "answer_count": 1, "score": 1, "last_activity_date": 1523365804, "creation_date": 1523364373, "last_edit_date": 1523365693, "question_id": 49754100, "link": "https://stackoverflow.com/questions/49754100/how-to-convert-a-uint64-to-big-int-in-golang", "title": "How to convert a uint64 to big.Int in golang?", "body": "<p>I was wondering how can I convert a <code>uint64</code> to <code>big.Int</code> in golang? the shortest way.  </p>\n\n<p>I have tried <code>new(big.Int).SetInt64(int64(a uint64 number))</code>. </p>\n\n<p>I don't like it cause it's long, too much nested conversions and I'd rather use a built-in function if it exists.</p>\n"}, {"tags": ["go", "protocol-buffers", "rpc", "twirp"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523361326, "post_id": 49752685, "comment_id": 86520442, "body": "If you don&#39;t want your database package to depend on the protobuf types, you have to do the conversion manually. If the types are sufficiently similar, you may get away with json.Marshal and json.Unmarshal, for instance. You should include the generated types in the question, so we get an idea how they differ."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523361370, "post_id": 49752685, "comment_id": 86520478, "body": "And type aliases are definitely not a solution. Aliases don&#39;t create new types, only new names for existing types."}], "answers": [{"tags": [], "owner": {"reputation": 3784, "user_id": 6182569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/595afc3cb368ac51e5643e7e71dfdb4d?s=128&d=identicon&r=PG", "display_name": "Mihailo", "link": "https://stackoverflow.com/users/6182569/mihailo"}, "is_accepted": true, "score": 1, "last_activity_date": 1523363751, "creation_date": 1523363751, "answer_id": 49753852, "question_id": 49752685, "link": "https://stackoverflow.com/questions/49752685/how-to-use-gos-type-alias-to-make-own-models-work-with-protobufs/49753852#49753852", "title": "How to use Go&#39;s type alias to make own models work with protobufs?", "body": "<p>One way you can solve your problem is by doing the conversion <strong>manually</strong>.</p>\n\n<pre><code>type User struct {\n    FirstName string\n    LastName string\n}\n\ntype protoUser struct {\n    firstName string\n    lastName string\n}\n\nfunc main() {\n    u := db() // Retrieve a user from a mocked db\n\n    fmt.Println(\"Before:\")\n    fmt.Printf(\"%#v\\n\", *u) // What db returns (*protoUser)\n    fmt.Println(\"After:\")\n    fmt.Printf(\"%#v\\n\", u.AsUser()) // What conversion returns (User)\n}\n\n// Mocked db that returns pointer to protoUser\nfunc db() *protoUser {\n    pu := protoUser{\"John\", \"Dough\"}\n    return &amp;pu\n}\n\n// Conversion method (converts protoUser into a User)\nfunc (pu *protoUser) AsUser() User {\n    return User{pu.firstName, pu.lastName}\n}\n</code></pre>\n\n<blockquote>\n  <p>The key part is the <code>AsUser</code> method on the <code>protoUser</code> struct.<br>\n  There we simply write our custom logic for converting a <code>protoUser</code> into a <code>User</code> type we want to be working with.</p>\n</blockquote>\n\n<h2><a href=\"https://play.golang.org/p/TsstNNhvy-h\" rel=\"nofollow noreferrer\">Working Example</a></h2>\n"}, {"tags": [], "owner": {"reputation": 1475, "user_id": 5203951, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/fd9dc7df52e3a9be33094cd877e3f8fb?s=128&d=identicon&r=PG", "display_name": "Yami Odymel", "link": "https://stackoverflow.com/users/5203951/yami-odymel"}, "is_accepted": false, "score": 0, "last_activity_date": 1573888831, "creation_date": 1573888831, "answer_id": 58888488, "question_id": 49752685, "link": "https://stackoverflow.com/questions/49752685/how-to-use-gos-type-alias-to-make-own-models-work-with-protobufs/58888488#58888488", "title": "How to use Go&#39;s type alias to make own models work with protobufs?", "body": "<p>As <a href=\"https://stackoverflow.com/users/603316/peter\">@Peter</a> mentioned in the comment section.</p>\n\n<p>I've seen a project which made it with a custom <code>Convert</code> function. It converts the Protobuf to local struct via <code>json.Unmarshal</code>, not sure how's the performance but it's a way to go.</p>\n\n<p><strong>Preview Code</strong> <a href=\"https://play.golang.org/p/uVSGoDRjSQW\" rel=\"nofollow noreferrer\"><kbd>PLAYGROUND</kbd></a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Convert converts the in struct to out struct via `json.Unmarshal`\nfunc Convert(in interface{}, out interface{}) error {\n    j, err := json.Marshal(in)\n    if err != nil {\n        return err\n    }\n    err = json.Unmarshal(j, &amp;out)\n    if err != nil {\n        return err\n    }\n    return nil\n}\n\nfunc main() {\n    // Converts the protobuf struct to local struct via json.Unmarshal\n    var localUser User\n    if err := convert(protoUser, &amp;localUser); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>Before:\nmain.ProtoUser{FirstName:\"John\", LastName:\"Dough\"}\nAfter:\nmain.User{FirstName:\"John\", LastName:\"Dough\"}\n\nProgram exited.\n</code></pre>\n"}], "owner": {"reputation": 15031, "user_id": 1256496, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/hlmB0.jpg?s=128&g=1", "display_name": "zemirco", "link": "https://stackoverflow.com/users/1256496/zemirco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1114, "favorite_count": 0, "accepted_answer_id": 49753852, "answer_count": 2, "score": 2, "last_activity_date": 1590048514, "creation_date": 1523360380, "question_id": 49752685, "link": "https://stackoverflow.com/questions/49752685/how-to-use-gos-type-alias-to-make-own-models-work-with-protobufs", "title": "How to use Go&#39;s type alias to make own models work with protobufs?", "body": "<p>I've got some REST API with my models defined as Go structs.</p>\n\n<pre><code>type User struct {\n  FirstName string\n  LastName  string\n}\n</code></pre>\n\n<p>Then I've got my database methods for getting data.</p>\n\n<pre><code>GetUserByID(id int) (*User, error)\n</code></pre>\n\n<p>Now I'd like to replace my REST API with <a href=\"https://github.com/twitchtv/twirp\" rel=\"nofollow noreferrer\">https://github.com/twitchtv/twirp</a> .</p>\n\n<p>Therefore I started defining my models inside <code>.proto</code> files.</p>\n\n<pre><code>message User {\n  string first_name = 2;\n  string last_name = 3;\n}\n</code></pre>\n\n<p>Now I've got two <code>User</code> types. Let's call them the <strong>native</strong> and the <strong>proto</strong> type.</p>\n\n<p>I've also got a service defined in my <code>.proto</code> file which returns a user to the frontend.</p>\n\n<pre><code>service Users {\n  rpc GetUser(Id) returns (User);\n}\n</code></pre>\n\n<p>This generates an interface that I have to fill in.</p>\n\n<pre><code>func (s *Server) GetUser(context.Context, id) (*User, error) {\n  // i'd like to reuse my existing database methods\n  u, err := db.GetUserByID(id)\n  // handle error\n  // do more stuff\n  return u, nil\n}\n</code></pre>\n\n<p>Unfortunately this does not work. My database returns a <strong>native</strong> User but the interface requires a <strong>proto</strong> user.</p>\n\n<p>Is there an easy way to make it work? Maybe using <code>type aliases</code>?</p>\n\n<p>Thanks a lot!</p>\n"}, {"tags": ["date", "parsing", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523359315, "post_id": 49752041, "comment_id": 86519090, "body": "The standard library handles only English names, and library recommendations are off-topic."}, {"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1523360146, "post_id": 49752041, "comment_id": 86519659, "body": "you could make a switch to change from german names to english"}], "answers": [{"tags": [], "owner": {"reputation": 1059, "user_id": 8368990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e3e253063cfcfeff6159f83a5c2404d?s=128&d=identicon&r=PG&f=1", "display_name": "fanduin", "link": "https://stackoverflow.com/users/8368990/fanduin"}, "is_accepted": true, "score": 2, "last_activity_date": 1523360147, "creation_date": 1523360147, "answer_id": 49752618, "question_id": 49752041, "link": "https://stackoverflow.com/questions/49752041/how-to-parse-a-date-string-in-a-foreign-language-with-go-time/49752618#49752618", "title": "How to parse a date string in a foreign language with go time", "body": "<p>I believe what you are trying to achieve can be accomplished using the package</p>\n\n<blockquote>\n  <p><a href=\"https://godoc.org/github.com/goodsign/monday\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/goodsign/monday</a></p>\n</blockquote>\n\n<p>It allows you to specify that you want to parse the date in the German locale using the <a href=\"https://godoc.org/github.com/goodsign/monday#ParseInLocation\" rel=\"nofollow noreferrer\">ParseInLocation</a> function.</p>\n\n<p>A good example on how to use this (and in german) can be seen in <a href=\"https://stackoverflow.com/questions/21696689/how-to-parse-month-in-go-from-non-english-string-with\" title=\"https://stackoverflow.com/questions/21696689/how-to-parse-month-in-go-from-non-english-string-with\">this question</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 1434, "user_id": 801426, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7e4a92cd142e59829350dc0f2a021cc4?s=128&d=identicon&r=PG", "display_name": "bullgare", "link": "https://stackoverflow.com/users/801426/bullgare"}, "is_accepted": false, "score": 0, "last_activity_date": 1523360503, "creation_date": 1523360503, "answer_id": 49752718, "question_id": 49752041, "link": "https://stackoverflow.com/questions/49752041/how-to-parse-a-date-string-in-a-foreign-language-with-go-time/49752718#49752718", "title": "How to parse a date string in a foreign language with go time", "body": "<p>One way is to convert month in original string from your locale into number or english locale before sending it to Parse() function.\nIt will definitely work.</p>\n\n<p>Here's a yaml-file with definitions for many languages - <a href=\"https://github.com/scrapinghub/dateparser/blob/8e91eb1a6d161a50b1869408c559dc605ef3583f/data/languages.yaml#L116\" rel=\"nofollow noreferrer\">https://github.com/scrapinghub/dateparser/blob/8e91eb1a6d161a50b1869408c559dc605ef3583f/data/languages.yaml#L116</a></p>\n\n<p>That's a library in python, so it won't fit go. But you can use this yaml-file for your conversion.\nIt's taken from this answer - <a href=\"https://stackoverflow.com/a/32482516/801426\">https://stackoverflow.com/a/32482516/801426</a></p>\n"}], "owner": {"reputation": 487, "user_id": 3004786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mQ3jy.jpg?s=128&g=1", "display_name": "huehnerhose", "link": "https://stackoverflow.com/users/3004786/huehnerhose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 451, "favorite_count": 0, "accepted_answer_id": 49752618, "answer_count": 2, "score": 0, "last_activity_date": 1523360503, "creation_date": 1523358372, "question_id": 49752041, "link": "https://stackoverflow.com/questions/49752041/how-to-parse-a-date-string-in-a-foreign-language-with-go-time", "title": "How to parse a date string in a foreign language with go time", "body": "<p>So my problem is: I want to do this:</p>\n\n<pre><code>datestring := \"19. april 2018\"\n\nparsedDate, err := time.Parse(\"2. January 2006\", datestring)\nif err != nil {\n    fmt.Println(err)\n}\n\nfmt.Println(parsedDate)\n</code></pre>\n\n<p>This snippet works perfectly... but now my input datestring isn't english... it's german. So april fooled me. (German April = English April). Running this with <code>datestring := \"19. Februar 2018\"</code> fails:</p>\n\n<pre><code>parsing time \"12. februar 2018\" as \"2. January 2006\": \n    cannot parse \"februar 2018\" as \"Januar\\\"\n</code></pre>\n\n<p>Is there any way to add parseable (natural) languages? Or define the language I expect. I didn't find any mention of this in the documentation.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "random", "floating-point"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 26, "last_activity_date": 1523348304, "last_edit_date": 1523348304, "creation_date": 1523342870, "answer_id": 49747128, "question_id": 49746992, "link": "https://stackoverflow.com/questions/49746992/generate-random-float64-numbers-in-specific-range-using-golang/49747128#49747128", "title": "Generate random float64 numbers in specific range using Golang", "body": "<p>Simply use <a href=\"https://golang.org/pkg/math/rand/#Float64\" rel=\"noreferrer\"><code>rand.Float64()</code></a> to get a random number in the range of <code>[0..1)</code>, and you can map (project) that to the range of <code>[min..max)</code> like this:</p>\n\n<pre><code>r := min + rand.Float64() * (max - min)\n</code></pre>\n\n<p>And don't create a new <code>rand.Rand</code> and / or <code>rand.Source</code> in your function, just create a global one or use the global one of the <a href=\"https://golang.org/pkg/math/rand/\" rel=\"noreferrer\"><code>math/rand</code></a> package. But don't forget to initialize it once.</p>\n\n<p>Here's an example function doing that:</p>\n\n<pre><code>func randFloats(min, max float64, n int) []float64 {\n    res := make([]float64, n)\n    for i := range res {\n        res[i] = min + rand.Float64() * (max - min)\n    }\n    return res\n}\n</code></pre>\n\n<p>Using it:</p>\n\n<pre><code>func main() {\n    rand.Seed(time.Now().UnixNano())\n    fmt.Println(randFloats(1.10, 101.98, 5))\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/8AgpkbSs-3y\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[51.43243344285539 51.92791316776663 45.04754409242326 28.77642913403846\n    58.21730813384373]\n</code></pre>\n\n<p><strong>Some notes:</strong></p>\n\n<ul>\n<li>The code on the Go playground will always give the same random numbers (time is fixed, so most likely the Seed will always be the same, also output is cached)</li>\n<li>The above solution is safe for concurrent use, because it uses <code>rand.Float64()</code> which uses the global rand which is safe. Should you create your own <code>rand.Rand</code> using a source obtained by <code>rand.NewSource()</code>, that would not be safe and neither the <code>randFloats()</code> using it.</li>\n</ul>\n"}], "owner": {"reputation": 177, "user_id": 7215600, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/df6a5e1949a219818d8e2b89fbae76d9?s=128&d=identicon&r=PG&f=1", "display_name": "Dana", "link": "https://stackoverflow.com/users/7215600/dana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12060, "favorite_count": 5, "accepted_answer_id": 49747128, "answer_count": 1, "score": 12, "last_activity_date": 1523348304, "creation_date": 1523342306, "last_edit_date": 1523343442, "question_id": 49746992, "link": "https://stackoverflow.com/questions/49746992/generate-random-float64-numbers-in-specific-range-using-golang", "title": "Generate random float64 numbers in specific range using Golang", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc genRandNums(min, max float64) []float64 {\n    var randNums []float64\n    s := rand.NewSource(time.Now().Unix())\n    r := rand.New(s)\n    for x := 0; x &lt; 10; x++ {\n        // generate random float in range of min and max inclusive, append\n        // to randNums and return randNums\n    }\n    return randNums\n}\n\nfunc main() {\n    nums := genRandNums(1.10, 101.98)\n    fmt.Println(nums)\n}\n</code></pre>\n\n<p>I have tried searching online on how to accomplish this, but I only found out how to generate random integers in a range. Is there any way I can generate random floats in a range using Go stdlib?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "is_accepted": true, "score": 2, "last_activity_date": 1523344956, "last_edit_date": 1523344956, "creation_date": 1523341379, "answer_id": 49746723, "question_id": 49746631, "link": "https://stackoverflow.com/questions/49746631/golang-decrements-of-2-variables-in-a-single-line-separate-by-comma-gives-error/49746723#49746723", "title": "golang decrements of 2 variables in a single line separate by comma, gives error", "body": "<p>That's because both <code>i--</code> and <code>j--</code> are statements.</p>\n\n<p>So you either put them on different lines or separate with <code>;</code></p>\n\n<p>References:</p>\n\n<ul>\n<li><a href=\"https://golang.org/ref/spec#IncDec_statements\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#IncDec_statements</a></li>\n<li><a href=\"https://golang.org/ref/spec#Assignments\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Assignments</a></li>\n</ul>\n"}], "owner": {"reputation": 2335, "user_id": 963182, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82b8397cc8b711c38b1f1a4dee765af9?s=128&d=identicon&r=PG", "display_name": "Invictus", "link": "https://stackoverflow.com/users/963182/invictus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 1, "accepted_answer_id": 49746723, "answer_count": 1, "score": 0, "last_activity_date": 1523344956, "creation_date": 1523341068, "question_id": 49746631, "link": "https://stackoverflow.com/questions/49746631/golang-decrements-of-2-variables-in-a-single-line-separate-by-comma-gives-error", "title": "golang decrements of 2 variables in a single line separate by comma, gives error", "body": "<p>Hi I am new to golang and I am getting the error for the following piece of code.</p>\n\n<p>I have correct the code by creating 2 statements by why can't I do it in a single statement.</p>\n\n<pre><code>for i &lt; j {\n// some code\n    i--, j-- //error but, I can do i,j = i-1, j-1 \n}\n</code></pre>\n\n<p>Please, can some point to a place where I can read more on this.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1523339759, "post_id": 49746267, "comment_id": 86506837, "body": "<a href=\"https://godoc.org/encoding/json#RawMessage\" rel=\"nofollow noreferrer\">RawMessage</a> is what I think you are looking for."}, {"owner": {"reputation": 2847, "user_id": 752837, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/9494419c9a9187d1fac939b1c938b880?s=128&d=identicon&r=PG", "display_name": "YWCA Hello", "link": "https://stackoverflow.com/users/752837/ywca-hello"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1523340336, "post_id": 49746267, "comment_id": 86507100, "body": "@CeriseLim&#243;n If you provide this as an answer I will approve it."}], "answers": [{"tags": [], "owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "is_accepted": true, "score": 1, "last_activity_date": 1523340465, "last_edit_date": 1592644375, "creation_date": 1523340465, "answer_id": 49746464, "question_id": 49746267, "link": "https://stackoverflow.com/questions/49746267/how-to-not-unmarsal-nested-json-in-golang/49746464#49746464", "title": "How to not unmarsal nested JSON in Golang", "body": "<p>You have two options:</p>\n<h3>Using <code>json.RawMessage</code></h3>\n<p>Here you have to slightly change your struct:</p>\n<pre><code>type Person struct {\n    Name string\n    Age int\n    Extra *json.RawMessage\n}\n</code></pre>\n<p>then, you can <code>Unmarshal</code> as usual</p>\n<pre><code>person := Person{}\nerr := json.Unmarshal(raw_bytes, &amp;person)\n// handle err\n</code></pre>\n<p>finally, you can Unmarshal <code>Extra</code> again, you can even do some assertion type on it to previously detect the type</p>\n<pre><code>var extra_option_1 string\nextra_option_2 := AnotherStruct{}\n\nerr := json.Unmarshal(raw_bytes, &amp;extra_option_1)\n// handle err\n    \n// or\n    \nerr := json.Unmarshal(raw_bytes, &amp;extra_option_2)\n// handle err\n</code></pre>\n<hr />\n<h3>\u00a0Using <code>map[string]interface{}{}</code> - honestly not so useful in your case</h3>\n<p>You can directly unmarshal &quot;unknown&quot; or dynamics payloads using a general <code>map[string]interface{}{}</code>.<br />\nBUT I discourage this usage because is slower and you should always know what to expect.</p>\n<p>Anyway, hereafter is a pseudo code:</p>\n<pre><code>payload := map[string]interface{}{}\nerr := json.Unmarshal(raw_bytes, &amp;payload)\n// handle err\n</code></pre>\n<p>In this last case, you need even to do assertion to each field.</p>\n"}, {"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1523342354, "post_id": 49746924, "comment_id": 86508124, "body": "Another answer suggests using <code>map[string]interface{}</code>, but this type cannot represent arbitrary JSON.  Another answer also suggests using <code>*json.RawMessage</code>.  This works, but the extra level of indirection does not provide any value."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1523342075, "creation_date": 1523342075, "answer_id": 49746924, "question_id": 49746267, "link": "https://stackoverflow.com/questions/49746267/how-to-not-unmarsal-nested-json-in-golang/49746924#49746924", "title": "How to not unmarsal nested JSON in Golang", "body": "<p>Use <a href=\"https://godoc.org/encoding/json#RawMessage\" rel=\"nofollow noreferrer\"><code>json.RawMessage</code></a> or <code>interface{}</code>: </p>\n\n<pre><code>type Person struct {\n    Name string\n    Age int\n    Extra json.RawMessage\n}\n\ntype Person struct {\n    Name string\n    Age int\n    Extra interface{}\n}\n</code></pre>\n\n<p>With a json.RawMessage, the data is pushed down the line as a slice of bytes.  With an <code>interface{}</code>, the data is unmarshaled to Go values (bool, float64, string, []interface{}, map[string]interface{}, nil) and marshaled back to JSON. Both options pass arbitrary JSON through the application. If the application does not have a reason to use one or the other, then <code>json.RawMessage</code> is probably the better choice because it's faster.</p>\n"}], "owner": {"reputation": 2847, "user_id": 752837, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/9494419c9a9187d1fac939b1c938b880?s=128&d=identicon&r=PG", "display_name": "YWCA Hello", "link": "https://stackoverflow.com/users/752837/ywca-hello"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 49746464, "answer_count": 2, "score": 0, "last_activity_date": 1523342075, "creation_date": 1523339637, "last_edit_date": 1523339774, "question_id": 49746267, "link": "https://stackoverflow.com/questions/49746267/how-to-not-unmarsal-nested-json-in-golang", "title": "How to not unmarsal nested JSON in Golang", "body": "<p>I have some JSON that I wish to unmarshal in Go. One of the top-level keys of the JSON dictionary has a value that is also parsable JSON. For example:</p>\n\n<pre><code>{ \n    \"Name\": \"Tony\",\n    \"Age\": 50,\n    \"Extra\": {\\\"Weight\\\":180}\n}\n</code></pre>\n\n<p>I have a corresponding struct that I want to unmarsal to:</p>\n\n<pre><code>type Person struct {\n    Name string\n    Age int\n    Extra []byte\n }\n</code></pre>\n\n<p>I want the <code>Extra</code> key to be a byte array because the JSON structure will vary and the structure of it is not important to the program being written. The program simply needs to push this data along down the line as a byte array.</p>\n\n<p>How can I coax the Go JSON encoder to handle the value of <code>extra</code> like this?</p>\n"}, {"tags": ["mysql", "go", "go-gin"], "comments": [{"owner": {"reputation": 381813, "user_id": 1863229, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/4sh1l.png?s=128&g=1", "display_name": "Tim Biegeleisen", "link": "https://stackoverflow.com/users/1863229/tim-biegeleisen"}, "edited": false, "score": 0, "creation_date": 1523339806, "post_id": 49746260, "comment_id": 86506855, "body": "In the case of success, it looks like you are already doing something with JSON.  Why can&#39;t you just replicate that for the failure case?"}, {"owner": {"reputation": 65, "user_id": 7584296, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y8sofYU-Tq8/AAAAAAAAAAI/AAAAAAAADKg/mNbjTfL3woI/photo.jpg?sz=128", "display_name": "waseem khan", "link": "https://stackoverflow.com/users/7584296/waseem-khan"}, "reply_to_user": {"reputation": 381813, "user_id": 1863229, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/4sh1l.png?s=128&g=1", "display_name": "Tim Biegeleisen", "link": "https://stackoverflow.com/users/1863229/tim-biegeleisen"}, "edited": false, "score": 0, "creation_date": 1523340417, "post_id": 49746260, "comment_id": 86507141, "body": "It is not failing it is executing an empty set in the database that&#39;s the problem @TimBiegeleisen"}], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 7584296, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y8sofYU-Tq8/AAAAAAAAAAI/AAAAAAAADKg/mNbjTfL3woI/photo.jpg?sz=128", "display_name": "waseem khan", "link": "https://stackoverflow.com/users/7584296/waseem-khan"}, "edited": false, "score": 0, "creation_date": 1523420241, "post_id": 49750782, "comment_id": 86548219, "body": "Thank you so much I figured it out how to do this!"}, {"owner": {"reputation": 704, "user_id": 4792552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a528513962a9c962ff32df92a1a350b?s=128&d=identicon&r=PG", "display_name": "Berkant Ipek", "link": "https://stackoverflow.com/users/4792552/berkant-ipek"}, "reply_to_user": {"reputation": 65, "user_id": 7584296, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y8sofYU-Tq8/AAAAAAAAAAI/AAAAAAAADKg/mNbjTfL3woI/photo.jpg?sz=128", "display_name": "waseem khan", "link": "https://stackoverflow.com/users/7584296/waseem-khan"}, "edited": false, "score": 0, "creation_date": 1523424913, "post_id": 49750782, "comment_id": 86549676, "body": "And also, do not forget to fail in the case of sql.Open call&#39;s err is present. Otherwise the rest of the calls to DB will all fail. It is not appropriate to continue the execution without an established DB connection. You should have failed there the exit the program with Fatal."}, {"owner": {"reputation": 65, "user_id": 7584296, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y8sofYU-Tq8/AAAAAAAAAAI/AAAAAAAADKg/mNbjTfL3woI/photo.jpg?sz=128", "display_name": "waseem khan", "link": "https://stackoverflow.com/users/7584296/waseem-khan"}, "edited": false, "score": 0, "creation_date": 1523440102, "post_id": 49750782, "comment_id": 86558500, "body": "I got it Berkant Thank you and will take about db connectivities."}], "tags": [], "owner": {"reputation": 704, "user_id": 4792552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a528513962a9c962ff32df92a1a350b?s=128&d=identicon&r=PG", "display_name": "Berkant Ipek", "link": "https://stackoverflow.com/users/4792552/berkant-ipek"}, "is_accepted": false, "score": 0, "last_activity_date": 1523430588, "last_edit_date": 1523430588, "creation_date": 1523354462, "answer_id": 49750782, "question_id": 49746260, "link": "https://stackoverflow.com/questions/49746260/how-to-handle-the-errors-in-golang-for-inserting-a-duplicate-keys/49750782#49750782", "title": "How to handle the errors in Golang for inserting a duplicate keys?", "body": "<p>You can set UNIQUE option for the interested column. And to show the error in JSON response to HTTP request, just declare and initialize a variable before the handling part and alter its result according to the response from DB query.</p>\n\n<p>Even though I would firstly prefer to query against DB whether the input data has already been saved in DB.</p>\n"}], "owner": {"reputation": 65, "user_id": 7584296, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y8sofYU-Tq8/AAAAAAAAAAI/AAAAAAAADKg/mNbjTfL3woI/photo.jpg?sz=128", "display_name": "waseem khan", "link": "https://stackoverflow.com/users/7584296/waseem-khan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1850, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1597438634, "creation_date": 1523339620, "last_edit_date": 1597438634, "question_id": 49746260, "link": "https://stackoverflow.com/questions/49746260/how-to-handle-the-errors-in-golang-for-inserting-a-duplicate-keys", "title": "How to handle the errors in Golang for inserting a duplicate keys?", "body": "<p>When I insert a record to the database it is saving, but my problem is that in Golang I am not able to handle errors. Suppose right now I am getting the error like Duplicate keys in my console but rather I want to handle it in JSON response, how would I handle this error?</p>\n<p>Here is my code:</p>\n<pre><code>func main() {\n    router := gin.New()\n    router.Use(gin.Logger())\n    router.Use(gin.Recovery())\n    db, err := sql.Open(&quot;mysql&quot;, &quot;root:password@tcp(gpstest.cksiqniek8yk.ap-south-1.rds.amazonaws.com:3306)/tech&quot;)\n    if err != nil {\n        fmt.Print(err.Error())\n    }\n    // make sure connection is available\n    err = db.Ping()\n    if err != nil {\n        fmt.Print(err.Error())\n    }\n    router.POST(&quot;/validate&quot;, func(c *gin.Context) {\n        var (\n            cat  Cat\n            cats []Cat\n        )\n        c.BindJSON(&amp;cat)\n\n        rows, err := db.Query(&quot;select a.id, r.id from admin_user as a inner join roles as r on r.id = a.id where r.name = '&quot; + cat.roleName + &quot;' AND a.admin_email = '&quot; + cat.adminEmail + &quot;' AND a.id = ' + cat.ID + ' AND r.id = ' + cat.ID1 + ' ;&quot;)\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        if rows.Next() {\n            err = rows.Scan(&amp;cat.ID, &amp;cat.ID1)\n            cats = append(cats, cat)\n            if err != nil {\n                fmt.Print(err.Error())\n            }\n            c.JSON(http.StatusOK, gin.H{\n                &quot;result&quot;: cats,\n                &quot;count&quot;:  len(cats),\n            })\n        } else {\n            var buffer bytes.Buffer\n\n            stmt, err := db.Prepare(&quot;INSERT INTO admin_roles(admin_id, role_id) values(?,?)&quot;)\n            if err != nil {\n                panic(err)\n            }\n            _, err = stmt.Exec(cat.ID, cat.ID1)\n\n            if err != nil {\n                fmt.Print(err.Error())\n            }\n            buffer.WriteString(&quot;cat.ID&quot;)\n            buffer.WriteString(&quot; &quot;)\n            buffer.WriteString(&quot;cat.ID1&quot;)\n            defer stmt.Close()\n            name1 := buffer.String()\n            c.JSON(http.StatusOK, gin.H{\n                &quot;message&quot;: fmt.Sprintf(&quot; %s successfully created&quot;, name1),\n            })\n        }\n\n    })\n    router.Run(&quot;:4500&quot;)\n    //return router\n}\n</code></pre>\n<p>And here is the error which I am getting in console.</p>\n<blockquote>\n<p>Error 1062: Duplicate entry '2-2' for key 'admin_id_role_id_uk_idx'[GIN].\nI want to handle this error in JSON format.</p>\n</blockquote>\n"}, {"tags": ["http", "go", "reverse-proxy"], "comments": [{"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523348001, "post_id": 49745252, "comment_id": 86511579, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/43021058/golang-read-request-body\">Golang read request body</a>"}, {"owner": {"reputation": 3376, "user_id": 105194, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a389302e32cd285c6dc556d4d5e96a9a?s=128&d=identicon&r=PG", "display_name": "mash", "link": "https://stackoverflow.com/users/105194/mash"}, "reply_to_user": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523375602, "post_id": 49745252, "comment_id": 86530987, "body": "@vitr well the core issue is similar but this question has a different context which results into more variety of answers as seen in ymonad &#39;s one, which I think is valuable for other visitors too"}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523345241, "post_id": 49746842, "comment_id": 86509893, "body": "What&#39;s the point of the second request? Why not call url.ParseQuery directly?"}, {"owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523345833, "post_id": 49746842, "comment_id": 86510281, "body": "It&#39;s just because the OP&#39;s code is calling <code>ParseForm()</code>. besides I want to show that you can call any function which is included in <code>http.Request</code> (e.g. : <code>ParseMultipartForm()</code> )"}], "tags": [], "owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "is_accepted": false, "score": 4, "last_activity_date": 1523341792, "creation_date": 1523341792, "answer_id": 49746842, "question_id": 49745252, "link": "https://stackoverflow.com/questions/49745252/reverseproxy-depending-on-the-request-body-in-golang/49746842#49746842", "title": "ReverseProxy depending on the request.Body in golang", "body": "<p>You can set <code>Director</code> handler to <code>httputil.ReverseProxy</code>\nDocument: <a href=\"https://golang.org/pkg/net/http/httputil/#ReverseProxy\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/httputil/#ReverseProxy</a></p>\n\n<p>Here's an example code which reads content body from request and proxies from <code>localhost:8080</code> to <code>localhost:3333</code></p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"net/http/httputil\"\n)\n\nfunc main() {\n    director := func(req *http.Request) {\n        if req.Body != nil {\n            // read all bytes from content body and create new stream using it.\n            bodyBytes, _ := ioutil.ReadAll(req.Body)\n            req.Body = ioutil.NopCloser(bytes.NewBuffer(bodyBytes))\n\n            // create new request for parsing the body\n            req2, _ := http.NewRequest(req.Method, req.URL.String(), bytes.NewReader(bodyBytes))\n            req2.Header = req.Header\n            req2.ParseForm()\n            log.Println(req2.Form)\n        }\n\n        req.URL.Host = \"localhost:3333\"\n        req.URL.Scheme = \"http\"\n    }\n    proxy := &amp;httputil.ReverseProxy{Director: director}\n    log.Fatalln(http.ListenAndServe(\":8080\", proxy))\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3376, "user_id": 105194, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a389302e32cd285c6dc556d4d5e96a9a?s=128&d=identicon&r=PG", "display_name": "mash", "link": "https://stackoverflow.com/users/105194/mash"}, "edited": false, "score": 0, "creation_date": 1523377130, "post_id": 49746869, "comment_id": 86531900, "body": "<code>r.ParseForm</code> after <code>ioutil.ReadAll(r.Body)</code> there cannot parse the post body, because it&#39;s already read. <a href=\"https://play.golang.org/p/rT6dKVsZWBB\" rel=\"nofollow noreferrer\">play.golang.org/p/rT6dKVsZWBB</a>"}], "tags": [], "owner": {"reputation": 4027, "user_id": 86288, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d2d5c5e3d38f94fb0dcdd78749064479?s=128&d=identicon&r=PG", "display_name": "Aaron Qian", "link": "https://stackoverflow.com/users/86288/aaron-qian"}, "is_accepted": true, "score": 3, "last_activity_date": 1523382919, "last_edit_date": 1523382919, "creation_date": 1523341905, "answer_id": 49746869, "question_id": 49745252, "link": "https://stackoverflow.com/questions/49745252/reverseproxy-depending-on-the-request-body-in-golang/49746869#49746869", "title": "ReverseProxy depending on the request.Body in golang", "body": "<p><strong>edit:</strong></p>\n\n<p>As commented above, the parsed form will be empty in this case. You will need to manually parse the form from the body.</p>\n\n<p>The <code>request.Body</code> is a <code>io.ReaderCloser</code>, because this describes the <code>rx</code> part of a tcp connection. But in your use case you need to read everything since you are parsing the body into a form. The trick here is to reassign the <code>r.Body</code> with a <code>io.ReaderCloser</code> object derived from the already read data. Here is what I would do:</p>\n\n<h1>1. Get a reference of the request body as a byte slice:</h1>\n\n<pre><code>  // before calling r.ParseForm(), get the body\n  // as a byte slice\n  body, err := ioutil.ReadAll(r.Body)\n</code></pre>\n\n<h1>2. Reassign r.Body after parsing form</h1>\n\n<pre><code>  // after calling r.ParseForm(), reassign body\n  r.Body = ioutil.NopCloser(bytes.NewBuffer(body))\n</code></pre>\n\n<p><code>bytes.NewBuffer(body)</code> converts the body byte slice into a <code>io.Reader</code>, and <code>ioutil.NopCloser</code> convertts a <code>io.Reader</code> into a <code>io.ReaderCloser</code> with a <code>nop</code> <code>Close()</code> method.</p>\n\n<h1>Putting Everything Together</h1>\n\n<pre><code>  package main\n\n  import \"net/http\"\n  import \"net/http/httputil\"\n  import \"net/url\"\n  import \"net/http/httptest\"\n  import \"fmt\"\n  import \"log\"\n  import \"bytes\"\n  import \"io/ioutil\"\n\n  func main() {\n    backendServer := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        b, err := ioutil.ReadAll(r.Body)\n        if err != nil {\n            http.Error(w, fmt.Sprintf(\"ioutil.ReadAll: %s\", err), 500)\n            return\n        }\n        // expecting to see hoge=fuga\n        fmt.Fprintf(w, \"this call was relayed by the reverse proxy, body: %s\", string(b))\n    }))\n    defer backendServer.Close()\n\n    rpURL, err := url.Parse(backendServer.URL)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    proxy := func(u *url.URL) http.Handler {\n        p := httputil.NewSingleHostReverseProxy(u)\n        return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            // read out body into a slice\n            body, err := ioutil.ReadAll(r.Body)\n            if err != nil {\n                http.Error(w, fmt.Sprintf(\"Error reading body: %s\", err), 500)\n                return\n            }\n\n            // inspect current body here\n            if err := r.ParseForm(); err != nil {\n                http.Error(w, fmt.Sprintf(\"ParseForm: %s\", err), 500)\n                return\n            }\n\n            // assign a new body with previous byte slice\n            r.Body = ioutil.NopCloser(bytes.NewBuffer(body))\n            p.ServeHTTP(w, r)\n        })\n    }(rpURL)\n    frontendProxy := httptest.NewServer(proxy)\n    defer frontendProxy.Close()\n\n    resp, err := http.Post(\n        frontendProxy.URL,\n        \"application/x-www-form-urlencoded\",\n        bytes.NewBufferString(\"hoge=fuga\"))\n    if err != nil {\n        log.Fatalf(\"http.Post: %s\", err)\n    }\n\n    b, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        log.Fatalf(\"ioutil.ReadAll: %s\", err)\n    }\n\n    fmt.Printf(\"%s\", b)\n  }\n</code></pre>\n"}], "owner": {"reputation": 3376, "user_id": 105194, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a389302e32cd285c6dc556d4d5e96a9a?s=128&d=identicon&r=PG", "display_name": "mash", "link": "https://stackoverflow.com/users/105194/mash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2908, "favorite_count": 2, "accepted_answer_id": 49746869, "answer_count": 2, "score": 3, "last_activity_date": 1523382919, "creation_date": 1523334026, "question_id": 49745252, "link": "https://stackoverflow.com/questions/49745252/reverseproxy-depending-on-the-request-body-in-golang", "title": "ReverseProxy depending on the request.Body in golang", "body": "<p>I want to build a http reverse proxy which checks the HTTP body and send HTTP requests to it's upstream servers after that. How can you do that in go?</p>\n\n<p>Initial attempt (follows) fails because ReverseProxy copies the incoming request, modifies it and sends but the body is already read.</p>\n\n<pre><code>func main() {\n    backendServer := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        b, err := ioutil.ReadAll(r.Body)\n        if err != nil {\n            http.Error(w, fmt.Sprintf(\"ioutil.ReadAll: %s\", err), 500)\n            return\n        }\n        // expecting to see hoge=fuga\n        fmt.Fprintf(w, \"this call was relayed by the reverse proxy, body: %s\", string(b))\n    }))\n    defer backendServer.Close()\n\n    rpURL, err := url.Parse(backendServer.URL)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    proxy := func(u *url.URL) http.Handler {\n        p := httputil.NewSingleHostReverseProxy(u)\n        return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            if err := r.ParseForm(); err != nil {\n                http.Error(w, fmt.Sprintf(\"ParseForm: %s\", err), 500)\n                return\n            }\n            p.ServeHTTP(w, r)\n        })\n    }(rpURL)\n    frontendProxy := httptest.NewServer(proxy)\n    defer frontendProxy.Close()\n\n    resp, err := http.Post(frontendProxy.URL, \"application/x-www-form-urlencoded\", bytes.NewBufferString(\"hoge=fuga\"))\n    if err != nil {\n        log.Fatalf(\"http.Post: %s\", err)\n    }\n\n    b, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        log.Fatalf(\"ioutil.ReadAll: %s\", err)\n    }\n\n    fmt.Printf(\"%s\", b)\n}\n// shows: \"http: proxy error: http: ContentLength=9 with Body length 0\"\n</code></pre>\n\n<p>Then my next attempt would be to read the whole body into bytes.Reader and use that to check the body content, and Seek to the beginning before sending to upstream servers. But then I have to re-implement ReverseProxy which I would like to avoid.\nIs there any other elegant way?</p>\n"}, {"tags": ["sqlite", "go", "embedded-database", "rocksdb"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1523336653, "post_id": 49744812, "comment_id": 86505708, "body": "Database is not just a matter of writing content to disk, but how to manage them (transaction, query, update, sorting, etc.). If you store your content to <i>raw file</i> (e.g. one disk per key), you won&#39;t have those advantages, unless you implement those features by yourself. Furthermore, every file has <i>metadata</i> which occupies disk space. If your content size is less than the metadata size, then &quot;one file per key&quot; solution will be inefficient."}, {"owner": {"reputation": 4027, "user_id": 86288, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/d2d5c5e3d38f94fb0dcdd78749064479?s=128&d=identicon&r=PG", "display_name": "Aaron Qian", "link": "https://stackoverflow.com/users/86288/aaron-qian"}, "edited": false, "score": 1, "creation_date": 1523338713, "post_id": 49744812, "comment_id": 86506436, "body": "Just a wild guess here, I think you will eventually hit file system bottlenecks as more and more small files are added. Also, batch writes and reads probably will outpace single file open / write / read operations as number of keys in each batch increases?"}], "answers": [{"comments": [{"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1523335560, "post_id": 49745394, "comment_id": 86505365, "body": "Thanks for the reply! It makes sense that batching the disk writes would improve speed, but even these batched writes are slower than I would imagine. The 10k/sec you quoted is still 100mics per write, which is about as slow as opening a separate file for each write."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 1, "creation_date": 1523335599, "post_id": 49745394, "comment_id": 86505380, "body": "@rampatowl the design document shows other advantages than just writing though."}, {"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1523335867, "post_id": 49745394, "comment_id": 86505463, "body": "Still, it seems like read/write time should be the main way to compare embedded key-value databases. I&#39;m just surprised that the state of the art data structures are approximately as fast as opening up your own file for each key (100 mics per read/write). Am I missing something?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1523336033, "post_id": 49745394, "comment_id": 86505516, "body": "@rampatowl this is not about read/write files, but about entry lookup optimization."}, {"owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "edited": false, "score": 0, "creation_date": 1523336480, "post_id": 49745394, "comment_id": 86505661, "body": "I edited my original post with clarification. The reason I am comparing Badger&#39;s operation time to file read/write times is because you can implement a minimal key value store with one file per key, where each entry lookup takes as long as a single file access (with no additional data structures)."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 2, "last_activity_date": 1523336624, "last_edit_date": 1523336624, "creation_date": 1523335093, "answer_id": 49745394, "question_id": 49744812, "link": "https://stackoverflow.com/questions/49744812/embedded-key-value-db-vs-just-storing-one-file-per-key/49745394#49745394", "title": "Embedded key-value db vs. just storing one file per key?", "body": "<p>But Badger is not about writing \"an\" entry:</p>\n\n<blockquote>\n  <h2>My writes are really slow. Why?</h2>\n  \n  <p>Are you creating a new transaction for every single key update? This will lead to very low throughput. </p>\n  \n  <p><strong>To get best write performance, batch up multiple writes inside a transaction using single <code>DB.Update()</code> call</strong>.<br>\n  You could also have multiple such DB.Update() calls being made concurrently from multiple goroutines.</p>\n</blockquote>\n\n<p>That leads to <a href=\"https://github.com/dgraph-io/badger/issues/396\" rel=\"nofollow noreferrer\">issue 396</a>:</p>\n\n<blockquote>\n  <p>I was looking for fast storage in Go and so my first try was BoltDB. I need a lot of single-write transactions. Bolt was able to do about 240 rq/s.</p>\n  \n  <p>I just tested Badger and I got a crazy 10k rq/s. I am just baffled</p>\n</blockquote>\n\n<p>That is because:</p>\n\n<blockquote>\n  <p>LSM tree has an advantage compared to B+ tree when it comes to writes.<br>\n  Also, values are stored separately in value log files so writes are much faster. </p>\n  \n  <p>You can <a href=\"https://blog.dgraph.io/post/badger/\" rel=\"nofollow noreferrer\">read more about the design here</a>.</p>\n</blockquote>\n\n<hr>\n\n<p>One of the main point (hard to replicate with simple read/write of files) is:</p>\n\n<blockquote>\n  <h1>Key-Value separation</h1>\n  \n  <p>The major performance cost of LSM-trees is the compaction process. During compactions, multiple files are read into memory, sorted, and written back. Sorting is essential for efficient retrieval, for both key lookups and range iterations. With sorting, the key lookups would only require accessing at most one file per level (excluding level zero, where we\u2019d need to check all the files). Iterations would result in sequential access to multiple files.</p>\n  \n  <p>Each file is of fixed size, to enhance caching. Values tend to be larger than keys. When you store values along with the keys, the amount of data that needs to be compacted grows significantly.</p>\n  \n  <p>In Badger, only a pointer to the value in the value log is stored alongside the key. Badger employs delta encoding for keys to reduce the effective size even further. Assuming 16 bytes per key and 16 bytes per value pointer, a single 64MB file can store two million key-value pairs.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 196, "user_id": 100672, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e7c9c07e64a6b7b075097831c360d53?s=128&d=identicon&r=PG", "display_name": "Bill Katz", "link": "https://stackoverflow.com/users/100672/bill-katz"}, "is_accepted": false, "score": 1, "last_activity_date": 1575639326, "creation_date": 1575639326, "answer_id": 59214222, "question_id": 49744812, "link": "https://stackoverflow.com/questions/49744812/embedded-key-value-db-vs-just-storing-one-file-per-key/59214222#59214222", "title": "Embedded key-value db vs. just storing one file per key?", "body": "<p>Your question assumes that the only operation needed are single random reads and writes.  Those are the worst case scenarios for log-structured merge (LSM) approaches like Badger or RocksDB.  The range query, where all keys or key-value pairs in a range gets returned, leverages sequential reads (due to the adjacencies of sorted kv within files) to read data at very high speeds.  For Badger, you mostly get that benefit if doing key-only or small value range queries since they are stored in a LSM while large values are appended in a not-necessarily sorted log file.  For RocksDB, you\u2019ll get fast kv pair range queries.</p>\n\n<p>The previous answer somewhat addresses the advantage on writes - the use of buffering.  If you write many kv pairs, rather than storing each in separate files, LSM approaches hold these in memory and eventually flush them in a file write.  There\u2019s no free lunch so asynchronous compaction must be done to remove overwritten data and prevent checking too many files for queries.</p>\n"}, {"tags": [], "owner": {"reputation": 161, "user_id": 1483911, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H9hQm.jpg?s=128&g=1", "display_name": "Jason", "link": "https://stackoverflow.com/users/1483911/jason"}, "is_accepted": false, "score": 0, "last_activity_date": 1619275114, "creation_date": 1619275114, "answer_id": 67243940, "question_id": 49744812, "link": "https://stackoverflow.com/questions/49744812/embedded-key-value-db-vs-just-storing-one-file-per-key/67243940#67243940", "title": "Embedded key-value db vs. just storing one file per key?", "body": "<p>Previously answered <a href=\"https://stackoverflow.com/a/25715794/1483911\">here</a>. Mostly similar to other answers provided here but makes one important, additional point: files in a filesystem can't occupy the same block on disk. If your records are, on average, significantly smaller than typical disk block size (4-16 KiB), storing them as separate files will incur substantial storage overhead.</p>\n"}], "owner": {"reputation": 1250, "user_id": 9314540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/867477659dda7aded0a1b28a6a5ac1e7?s=128&d=identicon&r=PG&f=1", "display_name": "rampatowl", "link": "https://stackoverflow.com/users/9314540/rampatowl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1746, "favorite_count": 2, "accepted_answer_id": 49745394, "answer_count": 3, "score": 2, "last_activity_date": 1619275114, "creation_date": 1523330636, "last_edit_date": 1523336408, "question_id": 49744812, "link": "https://stackoverflow.com/questions/49744812/embedded-key-value-db-vs-just-storing-one-file-per-key", "title": "Embedded key-value db vs. just storing one file per key?", "body": "<p>I'm confused about the advantage of embedded key-value databases over the naive solution of just storing one file on disk per key. For example, databases like RocksDB, Badger, SQLite use fancy data structures like B+ trees and LSMs but seem to get roughly the same performance as this simple solution.</p>\n\n<p>For example, Badger (which is the fastest Go embedded db) takes <a href=\"https://medium.com/kongkow-it-medan/badger-vs-boltdb-persistent-key-value-store-written-in-go-e94ada87048f\" rel=\"nofollow noreferrer\" title=\"of about 800 mics\">about 800 microseconds</a> to write an entry. In comparison, creating a new file from scratch and writing some data to it takes 150 mics with no optimization.</p>\n\n<p>EDIT: to clarify, here's the simple implementation of a key-value store I'm comparing with the state of the art embedded dbs. Just hash each key to a string filename, and store the associated value as a byte array at that filename. Reads and writes are ~150 mics each, which is faster than Badger for single operations and comparable for batched operations. Furthermore, the disk space is minimal, since we don't store any extra structure besides the actual values.</p>\n\n<p>I must be missing something here, because the solutions people actually use are super fancy and optimized using things like bloom filters and B+ trees.</p>\n"}, {"tags": ["go", "tf-idf"], "answers": [{"tags": [], "owner": {"reputation": 1322, "user_id": 2936650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/21pIQ.png?s=128&g=1", "display_name": "ashburshui", "link": "https://stackoverflow.com/users/2936650/ashburshui"}, "is_accepted": false, "score": -2, "last_activity_date": 1523334515, "creation_date": 1523334515, "answer_id": 49745306, "question_id": 49744073, "link": "https://stackoverflow.com/questions/49744073/tf-idf-in-golang/49745306#49745306", "title": "TF-IDF in Golang", "body": "<p>TD-IDF is a relatively simple text feature representation method.</p>\n\n<p><strong>So I think that you can easily reason about it against the source code.</strong></p>\n\n<p>Have a try on this <a href=\"https://github.com/cdipaolo/goml/blob/master/text/tfidf.go\" rel=\"nofollow noreferrer\">module</a></p>\n"}], "owner": {"reputation": 1912, "user_id": 1450312, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/b4d2c938b517dd6409ba7bd4cb6cd461?s=128&d=identicon&r=PG&f=1", "display_name": "nad", "link": "https://stackoverflow.com/users/1450312/nad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 746, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1523334515, "creation_date": 1523325007, "question_id": 49744073, "link": "https://stackoverflow.com/questions/49744073/tf-idf-in-golang", "title": "TF-IDF in Golang", "body": "<p>Is there any golang library similar to sklearn that can be used to find tf-idf? I can't seem to find anything well documented. I am looking to find the tf-idf given a bunch of text file, similar to the python version mentioned <a href=\"https://stackoverflow.com/questions/34449127/sklearn-tfidf-transformer-how-to-get-tf-idf-values-of-given-words-in-documen\">here</a></p>\n\n<pre><code>from sklearn.feature_extraction.text import TfidfVectorizer\nimport numpy as np\nfrom scipy.sparse.csr import csr_matrix #need this if you want to save tfidf_matrix\n\ntf = TfidfVectorizer(input='filename', analyzer='word', ngram_range=(1,6),\n                     min_df = 0, stop_words = 'english', sublinear_tf=True)\ntfidf_matrix =  tf.fit_transform(corpus)\n</code></pre>\n"}, {"tags": ["unit-testing", "go", "types", "mocking", "assertions"], "answers": [{"comments": [{"owner": {"reputation": 65, "user_id": 1062179, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f0d504cbc41a2a7614ee2474917e084b?s=128&d=identicon&r=PG", "display_name": "theAdam", "link": "https://stackoverflow.com/users/1062179/theadam"}, "edited": false, "score": 0, "creation_date": 1523315131, "post_id": 49742777, "comment_id": 86500548, "body": "This helps a lot in understanding what I was missing but now I seem to be getting another error: <code>runtime error: invalid memory address or nil pointer dereference</code> with the stack trace pointing to the line where this starts: <code>uploader.Upload(&amp;s3manager.UploadInput{</code>"}, {"owner": {"reputation": 65, "user_id": 1062179, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f0d504cbc41a2a7614ee2474917e084b?s=128&d=identicon&r=PG", "display_name": "theAdam", "link": "https://stackoverflow.com/users/1062179/theadam"}, "edited": false, "score": 0, "creation_date": 1523316384, "post_id": 49742777, "comment_id": 86500963, "body": "Okay, I got it to work by removing the asterisk in front of mockUploader, in <code>func (*mockUploader) Upload(input *s3manager.UploadInput)</code> and taking @peter &#39;s advice and putting the full argument list in there with the <code>options ...func(*s3manager.Uploader)</code> part."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 2, "last_activity_date": 1523314334, "last_edit_date": 1523314334, "creation_date": 1523314013, "answer_id": 49742777, "question_id": 49742700, "link": "https://stackoverflow.com/questions/49742700/have-a-go-function-accept-different-structs-as-input-with-methods/49742777#49742777", "title": "Have a Go function accept different structs as input with methods", "body": "<p>You set the type signature to <code>func uploadFile(uploader interface{}) {</code>, which means it accepts anything as an argument, but you cannot call any method on <code>uploader</code>, because your type signature <code>interface{}</code> does not any methods on it.</p>\n\n<p>It looks like what you want to do is:</p>\n\n<pre><code>type Uploader interface {\n    Upload(input *s3manager.UploadInput) \n}\n\nfunc uploadFile(uploader Uploader) {\n    uploader.Upload(&amp;s3manager.UploadInput{\n        Bucket: aws.String(\"A\"),\n        Key:    aws.String(\"B\"),\n        Body:   bytes.NewReader([]byte(\"C\")),\n    })\n}\n</code></pre>\n\n<p>But you are going to need to match the function signature, and it looks like one of them has:</p>\n\n<pre><code>(mockUploadOutput, error) \n</code></pre>\n\n<p>and the other a</p>\n\n<pre><code>(*s3manager.UploadOutput, error)\n</code></pre>\n\n<p>so, what I would probably do is just return a real <code>(*s3manager.UploadOutput, error)</code> from your mock:</p>\n\n<pre><code>func (*mockUploader) Upload(input *s3manager.UploadInput) (*s3manager.UploadOutput, error) {\n  versionID := \"TESTVERSION\"\n  mockUploadResponse := &amp;s3manager.UploadOutput{\n      Location:  \"TESTLOCATION\",\n      VersionID: &amp;versionID,\n      UploadID:  \"TESTUPLOADID\",\n  }\n  return mockUploadResponse, nil\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 1, "last_activity_date": 1523314387, "creation_date": 1523314387, "answer_id": 49742842, "question_id": 49742700, "link": "https://stackoverflow.com/questions/49742700/have-a-go-function-accept-different-structs-as-input-with-methods/49742842#49742842", "title": "Have a Go function accept different structs as input with methods", "body": "<p>You have to give both types a common set if methods. Common means the name, argument types, and return types must be identical. Since you can't change the real implementation, your only option is to have the mock mimic the s3 type. s3's Upload method is defined as follows:</p>\n\n<pre><code>Upload(input *s3manager.UploadInput, options ...func(*s3manager.Uploader)) (*s3manager.UploadOutput, error)\n</code></pre>\n\n<p>Your mock must have the exact same method:</p>\n\n<pre><code>func (*mockUploader) Upload(input *s3manager.UploadInput, options ...func(*s3manager.Uploader)) (*s3manager.UploadOutput, error) {\n    // Implementation\n}\n</code></pre>\n\n<p>Note that you cannot change the return types.</p>\n\n<p>Now both types share an interface that you can depend on:</p>\n\n<pre><code>type Uploader interface {\n    Upload(input *s3manager.UploadInput, options ...func(*s3manager.Uploader)) (*s3manager.UploadOutput, error)\n}\n\nfunc uploadFile(uploader Uploader) {\n}\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 1062179, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f0d504cbc41a2a7614ee2474917e084b?s=128&d=identicon&r=PG", "display_name": "theAdam", "link": "https://stackoverflow.com/users/1062179/theadam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 392, "favorite_count": 0, "accepted_answer_id": 49742777, "answer_count": 2, "score": 0, "last_activity_date": 1523314387, "creation_date": 1523313470, "question_id": 49742700, "link": "https://stackoverflow.com/questions/49742700/have-a-go-function-accept-different-structs-as-input-with-methods", "title": "Have a Go function accept different structs as input with methods", "body": "<p>I'm rather new to Go and I can't seem to wrap my head around it's struct/interface system while trying to create a mock object for an AWS s3manager uploader's unit testing.</p>\n\n<p>In my package file I have:</p>\n\n<pre><code>package uploader\n\nimport (\n        \"fmt\"\n        \"github.com/aws/aws-sdk-go/aws\"\n        \"github.com/aws/aws-sdk-go/aws/session\"\n        \"github.com/aws/aws-sdk-go/service/s3/s3manager\"\n        \"os\"\n)\n\nfunc GetS3Uploader() *s3manager.Uploader {\n    conf := aws.Config{Region: aws.String(\"eu-west-1\")}\n    sess := session.New(&amp;conf)\n    uploader := s3manager.NewUploader(sess)\n    return uploader\n}\n\nfunc uploadFile(uploader interface{}) {\n\n    uploader.Upload(&amp;s3manager.UploadInput{\n       Bucket: aws.String(\"A\"),\n       Key:    aws.String(\"B\"),\n       Body:   bytes.NewReader([]byte(\"C\")),\n    })\n\n}\n</code></pre>\n\n<p>and in the matching uploader_test.go there is the following code, containing the mock objects:</p>\n\n<pre><code>package uploader_test\n\nimport (\n    . \"github.com/onsi/ginkgo\"\n    . \"github.com/something/reponame/uploader\"\n    \"github.com/aws/aws-sdk-go/service/s3/s3manager\"\n)\n\ntype mockUploadOutput struct {\n    Location  string\n    VersionID *string\n    UploadID  string\n}\n\ntype mockUploader struct {\n}\n\nfunc (*mockUploader) Upload(input *s3manager.UploadInput) (mockUploadOutput, error) {\n    versionID := \"TESTVERSION\"\n    mockUploadResponse := mockUploadOutput{\n        Location:  \"TESTLOCATION\",\n        VersionID: &amp;versionID,\n        UploadID:  \"TESTUPLOADID\",\n    }\n    return mockUploadResponse, nil\n}\n\nvar _ = Describe(\"Reportuploader\", func() {\n\n    var (\n        mockUp mockUploader\n    )\n\n    Describe(\"Upload()\", func() {\n        Context(\"With mocked uploader object\", func() {\n            It(\"should return the predefined mockUploadResponse\", func() {\n\n                uploadFile(mockUp)\n\n            })\n        })\n    })\n})\n</code></pre>\n\n<p>But when I try to run it, I get the following error:</p>\n\n<pre><code>uploader.Upload undefined (type interface {} is interface with no methods)\n</code></pre>\n\n<p>My aim is to have the uploadFile function accept both the *s3manager.Uploader object and the mocked mockUploader as valid arguments, and recognize both their Upload methods. I tried asserting the type before calling the Upload method, but that only gave a different error. Can anyone help, and tell me what am I doing wrong?</p>\n"}, {"tags": ["java", "hibernate", "go", "orm", "database-migration"], "comments": [{"owner": {"reputation": 19424, "user_id": 750852, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/ezMNd.png?s=128&g=1", "display_name": "mpm", "link": "https://stackoverflow.com/users/750852/mpm"}, "edited": false, "score": 2, "creation_date": 1523322026, "post_id": 49742518, "comment_id": 86502321, "body": "You are asking for a library recommendation which is clearly defined as &quot;off-topic&quot; by Stackoverflow ."}], "answers": [{"tags": [], "owner": {"reputation": 49, "user_id": 5879876, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fAaCM.jpg?s=128&g=1", "display_name": "G&#252;rkan &#199;intesun", "link": "https://stackoverflow.com/users/5879876/g%c3%bcrkan-%c3%87intesun"}, "is_accepted": false, "score": 2, "last_activity_date": 1523370015, "creation_date": 1523370015, "answer_id": 49756051, "question_id": 49742518, "link": "https://stackoverflow.com/questions/49742518/get-static-typing-of-dynamic-db-models-using-auto-migration/49756051#49756051", "title": "Get static typing of dynamic DB models (using auto-migration)", "body": "<p>You can only do with gorm tool of gorilla webkit from code environment to generate db models so vice versa is not possible. I think that there is not framework like Loopback for Node.js specified for Golang. </p>\n"}], "owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1523370015, "creation_date": 1523312390, "question_id": 49742518, "link": "https://stackoverflow.com/questions/49742518/get-static-typing-of-dynamic-db-models-using-auto-migration", "title": "Get static typing of dynamic DB models (using auto-migration)", "body": "<p>I am wondering if there is a way using Golang or Java, to generate DB models from the DB itself, and also get static typing from those generated models.</p>\n\n<p>For example, using the Loopback framework for Node.js, we can generate models (in the form of JSON files) from DB tables/structures, but I don't think you can get static typing for that, even with TypeScript.</p>\n\n<p>I'd like a relational ORM that is more performant/sophisticated than Loopback and has static typing, but I can't seem to find that.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523305687, "post_id": 49741086, "comment_id": 86496866, "body": "Two things check if you are using the shared folder also check for permissions provided to access from outside."}, {"owner": {"reputation": 933, "user_id": 2955815, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/de2492fe7f50ed8baa62225dff1dd06a?s=128&d=identicon&r=PG&f=1", "display_name": "oldsport", "link": "https://stackoverflow.com/users/2955815/oldsport"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523307045, "post_id": 49741086, "comment_id": 86497533, "body": "Himanshu, any idea how I can do that?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523307457, "post_id": 49741086, "comment_id": 86497712, "body": "Check using <code>smbclient -L SERVERNAME | grep -i &quot;YOURSHARENAME&quot;</code> in terminal for shared files."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 4, "creation_date": 1523309569, "post_id": 49741086, "comment_id": 86498619, "body": "That&#39;s not a filename, that&#39;s a URL. Access the file via the mount point instead."}], "owner": {"reputation": 933, "user_id": 2955815, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/de2492fe7f50ed8baa62225dff1dd06a?s=128&d=identicon&r=PG&f=1", "display_name": "oldsport", "link": "https://stackoverflow.com/users/2955815/oldsport"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 637, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1523305208, "creation_date": 1523305208, "question_id": 49741086, "link": "https://stackoverflow.com/questions/49741086/getting-error-no-such-file-or-directory-when-reading-file-in-samba-folder", "title": "Getting error &#39;no such file or directory&#39; when reading file in samba folder", "body": "<p>I want to read the following <strong>test.html</strong> file. I have mounted it in my <strong>ubuntu 16.04</strong> machine and I can access it.\nBut how can I read the file in go?\nI get the error <code>no such file or directory</code></p>\n\n<pre><code>url := `smb://192.168.32.114/test/test.html`\ndat, err := ioutil.ReadFile(url)\nif err != nil {\n    log.Println(err)\n}\n</code></pre>\n"}, {"tags": ["go", "visual-studio-code"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1523298044, "post_id": 49739155, "comment_id": 86492970, "body": "The std lib is installed together with Go. If you don&#39;t have it then it is highly probable that your Go installation didn&#39;t go as it should. <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">golang.org/doc/install</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1523300239, "post_id": 49739155, "comment_id": 86494101, "body": "Don\u2019t set GOROOT. It\u2019s set implicitly in almost every case."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 2, "creation_date": 1523300418, "post_id": 49739155, "comment_id": 86494192, "body": "GOPATH is for source code you create, and is generally $HOME/go. But you used this for GOROOT. GOROOT should be where Go was installed. And Go should <i>absolutely not</i> be installed in the GOPATH."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523301248, "post_id": 49740012, "comment_id": 86494614, "body": "It used to be necessary sometimes, but that was years ago. With modern versions GOROOT isn&#39;t necessary anymore (and mostly harmful)."}, {"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523301299, "post_id": 49740012, "comment_id": 86494636, "body": "yeah that&#39;s a shame that it changed, but that&#39;s how it goes"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1523311571, "post_id": 49740012, "comment_id": 86499434, "body": "@AlexanderMills You can still set GOROOT, but now it&#39;s optional. Most people consider this change a benefit, not something that&#39;s a shame."}], "tags": [], "owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "is_accepted": false, "score": 1, "last_activity_date": 1523300884, "creation_date": 1523300884, "answer_id": 49740012, "question_id": 49739155, "link": "https://stackoverflow.com/questions/49739155/cannot-import-strings-or-net-http/49740012#49740012", "title": "Cannot import &quot;strings&quot; or &quot;net/http&quot;", "body": "<p>I unset GOROOT and it worked</p>\n\n<p><code>$ unset GOROOT</code></p>\n\n<p>I see some userland docs telling people to set that manually, but apparently that's wrong.</p>\n"}], "owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1312, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1523300884, "creation_date": 1523297558, "question_id": 49739155, "link": "https://stackoverflow.com/questions/49739155/cannot-import-strings-or-net-http", "title": "Cannot import &quot;strings&quot; or &quot;net/http&quot;", "body": "<p>I have this message:</p>\n\n<blockquote>\n<pre><code>cannot find package \"strings\" in any of:\n    /Users/alexamil/go/src/strings (from $GOROOT)\n    /Users/alexamil/golang_alex/src/strings (from $GOPATH)\n</code></pre>\n</blockquote>\n\n<p>golang should be installed correctly, and I have:</p>\n\n<pre><code>go version go1.8 darwin/amd64\n</code></pre>\n\n<p>GOROOT and GOPATH are both defined as above. I assume \"strings\" and \"net/http\" are core libraries, so why cannot go find these libraries given that GOROOT is defined?</p>\n\n<p>Ok so I checked out GOROOT, and it turns out, I don't see \"strings\" and \"net/http\", so I guess how the F do I install them? Using Google to find out how to install these things is WAY harder than it needs to be - has nobody written an article on how to do this?</p>\n"}, {"tags": ["go", "visual-studio-code"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1523296066, "post_id": 49738719, "comment_id": 86491926, "body": "I&#39;m not familiar with VSCode, but in general GOPATH is optional (the default is <code>$HOME&#47;go</code>), but <code>GOROOT=$HOME&#47;go</code> is incorrect. You should almost never set GOROOT, and it should never be the same as GOPATH."}, {"owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "edited": false, "score": 0, "creation_date": 1523296246, "post_id": 49738719, "comment_id": 86492021, "body": "thanks..tbh guys I have never read so much conflicting info about env variables for any language, and that&#39;s not your fault."}], "owner": {"reputation": 1, "user_id": 1223975, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/5Oh7r.jpg?s=128&g=1", "display_name": "Alexander Mills", "link": "https://stackoverflow.com/users/1223975/alexander-mills"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 454, "favorite_count": 0, "closed_date": 1523297031, "answer_count": 0, "score": 1, "last_activity_date": 1523295886, "creation_date": 1523295886, "question_id": 49738719, "link": "https://stackoverflow.com/questions/49738719/gopath-not-set-in-vscode", "closed_reason": "Duplicate", "title": "GOPATH not set in VSCode", "body": "<p>Golang newb here.</p>\n\n<p><a href=\"https://i.stack.imgur.com/bcwlW.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/bcwlW.png\" alt=\"enter image description here\"></a></p>\n\n<p>Why is VSCode telling me that GOPATH is not set? I restarted VSCode a few times. The env variable is set as you can see from the terminal, and it's set to <code>$HOME/go</code>.</p>\n\n<pre><code>export GOROOT=$HOME/go\nexport GOPATH=$HOME/go\nexport GOBIN=$HOME/go/bin\nexport PATH=$PATH:$GOROOT/bin\n</code></pre>\n\n<p>I am using the golang plugin from lukehoban:\n<a href=\"https://code.visualstudio.com/docs/languages/go\" rel=\"nofollow noreferrer\">https://code.visualstudio.com/docs/languages/go</a></p>\n\n<p>And I have this in workspace settings:</p>\n\n<pre><code>{\n    \"go.gopath\": \"/Users/alexamil/go\"\n}\n</code></pre>\n\n<p>anyone know what might be wrong?</p>\n"}, {"tags": ["go", "stream", "tar"], "comments": [{"owner": {"reputation": 3292, "user_id": 2709093, "user_type": "registered", "profile_image": "https://graph.facebook.com/1042262218/picture?type=large", "display_name": "James K", "link": "https://stackoverflow.com/users/2709093/james-k"}, "edited": false, "score": 2, "creation_date": 1523278590, "post_id": 49733184, "comment_id": 86480767, "body": "Don&#39;t apologise for formatting, fix it with <code>go fmt</code>"}, {"owner": {"reputation": 3292, "user_id": 2709093, "user_type": "registered", "profile_image": "https://graph.facebook.com/1042262218/picture?type=large", "display_name": "James K", "link": "https://stackoverflow.com/users/2709093/james-k"}, "edited": false, "score": 0, "creation_date": 1523278825, "post_id": 49733184, "comment_id": 86480967, "body": "I did run this, and to my surprise it didn&#39;t give any error, the open file was removed without error."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1523277944, "creation_date": 1523277944, "answer_id": 49733314, "question_id": 49733184, "link": "https://stackoverflow.com/questions/49733184/golang-streams-and-readers/49733314#49733314", "title": "Golang streams and readers", "body": "<blockquote>\n<pre><code>f, err := os.Open(\"file.tar.gz\")\nif err != nil {\n    panic(err)\n}\ndefer f.Close()\nextractTarGz(f)\nerr = os.Remove(\"file.tar.gz\")\n</code></pre>\n</blockquote>\n\n<p>At the very least, you need to close the file before you removeit.</p>\n\n<pre><code>err = f.Close()\nif err != nil {\n    panic(err)\n}\nerr = os.Remove(\"file.tar.gz\")\n</code></pre>\n\n<p><code>defer f.Close()</code> won't run until the end of the function.</p>\n"}, {"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1523281239, "post_id": 49733319, "comment_id": 86482618, "body": "I&#39;d note that closing before removing is only needed on non-POSIX systems, namely, Windows. On POSIX-y systems, the paradigm of removing an opened file is not only legal but is actively used for temporary files\u2014where a file is created (and hence opened) and is then immediately removed while retaining the possibility to read and write to it as an open FD counts as a link to the file&#39;s data. Closing such FD removes its data from the filesystem."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1523278475, "last_edit_date": 1523278475, "creation_date": 1523277961, "answer_id": 49733319, "question_id": 49733184, "link": "https://stackoverflow.com/questions/49733184/golang-streams-and-readers/49733319#49733319", "title": "Golang streams and readers", "body": "<p>You should first close the file, and then attempt to remove it. Since you close it using <code>defer</code>, that will / would be called after the <code>os.Remove()</code> call.</p>\n\n<p>Try it like this:</p>\n\n<pre><code>name := \"file.tar.gz\"\ndefer func() {\n    if err = os.Remove(name); err != nil {\n        log.Printf(\"Failed to remove %s: %v\", name, err)\n    }\n}()\n\nf, err := os.Open(name)\nif err != nil {\n    panic(err)\n}\ndefer f.Close()\n\nextractTarGz(f)\n</code></pre>\n\n<p>Deferred functions are executed in LIFO (last-in-first-out) order, so first <code>f.Close()</code> will be called, and then the other which tries to remove the file. Quoting from <a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"nofollow noreferrer\">Spec: Deferred statements:</a></p>\n\n<blockquote>\n  <p>...deferred functions are invoked immediately before the surrounding function returns, <strong>in the reverse order they were deferred</strong>.</p>\n</blockquote>\n"}], "owner": {"reputation": 59, "user_id": 5105866, "user_type": "registered", "accept_rate": 17, "profile_image": "https://graph.facebook.com/1112800182070764/picture?type=large", "display_name": "\u0427\u0438\u043d\u0433\u0438\u0437 \u041c\u0430\u0440\u0434\u0430\u043d\u043e\u0432", "link": "https://stackoverflow.com/users/5105866/%d0%a7%d0%b8%d0%bd%d0%b3%d0%b8%d0%b7-%d0%9c%d0%b0%d1%80%d0%b4%d0%b0%d0%bd%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 754, "favorite_count": 1, "accepted_answer_id": 49733319, "answer_count": 2, "score": 1, "last_activity_date": 1523278537, "creation_date": 1523277505, "last_edit_date": 1523278537, "question_id": 49733184, "link": "https://stackoverflow.com/questions/49733184/golang-streams-and-readers", "title": "Golang streams and readers", "body": "<p>I am writing a simple script to get download unzip the tar.gz file and then remove it. Whenever I try to remove it I get an error:\n<code>The process cannot access the file because it is being used by another process.</code></p>\n\n<p>I assume the error is in how I pass the file to the <code>extractTarGz</code> function, but I am not sure.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"archive/tar\"\n    \"compress/gzip\"\n    \"io\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    f, err := os.Open(\"file.tar.gz\")\n    if err != nil {\n        panic(err)\n    }\n    defer f.Close()\n    extractTarGz(f)\n\n    err = os.Remove(\"file.tar.gz\")\n}\n\nfunc extractTarGz(gzipStream io.Reader) {\n    uncompressedStream, err := gzip.NewReader(gzipStream)\n    if err != nil {\n        log.Fatal(\"ExtractTarGz: NewReader failed\")\n    }\n\n    tarReader := tar.NewReader(uncompressedStream)\n\n    for true {\n        header, err := tarReader.Next()\n\n        if err == io.EOF {\n            break\n        }\n\n        if err != nil {\n            log.Fatalf(\"ExtractTarGz: Next() failed: %s\", err.Error())\n        }\n\n        switch header.Typeflag {\n        case tar.TypeDir:\n            if err := os.Mkdir(header.Name, 0755); err != nil {\n                log.Fatalf(\"ExtractTarGz: Mkdir() failed: %s\", err.Error())\n            }\n        case tar.TypeReg:\n            outFile, err := os.Create(header.Name)\n            if err != nil {\n                log.Fatalf(\"ExtractTarGz: Create() failed: %s\", err.Error())\n            }\n            defer outFile.Close()\n            if _, err := io.Copy(outFile, tarReader); err != nil {\n                log.Fatalf(\"ExtractTarGz: Copy() failed: %s\", err.Error())\n            }\n        default:\n            log.Fatalf(\n                \"ExtractTarGz: uknown type: %s in %s\",\n                header.Typeflag,\n                header.Name)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["debugging", "go", "binary", "visual-studio-code", "goland"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523277631, "post_id": 49733006, "comment_id": 86480042, "body": "Have you tried delve&#39;s <code>attach</code> command?"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523277715, "post_id": 49733006, "comment_id": 86480116, "body": "@JimB -  i&#39;ve tried with new Goland attach to local process and I was able to see the process in the opend dialog but wasnt able debug it getting error <code>&quot;could not attach to pid 97234: EOF&quot;</code>"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523277845, "post_id": 49733006, "comment_id": 86480200, "body": "@JimB - I&#39;ve <code>delve</code> debugger installed but I use it from <code>vsCode</code> and <code>Goland</code> to debug internally , can you please provide which steps should I dot to try it with the attach command and I&#39;ll do it ASAP"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523278503, "post_id": 49733006, "comment_id": 86480698, "body": "It&#39;s possible you&#39;re seeing this: <a href=\"https://github.com/derekparker/delve/issues/1165\" rel=\"nofollow noreferrer\">github.com/derekparker/delve/issues/1165</a> -- Try it from the command line first so you know if it&#39;s an issue with the editor integration, or the tools themselves."}], "answers": [{"comments": [{"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1523285105, "post_id": 49734101, "comment_id": 86485226, "body": "Thanks a lot 1+ , another question in case I use the workaround how it should work? I open cli and execute the binary and then I go to Goland and use attach to local process but Im losing some time until I click on the process dialog and find the PID , should I do it differently ?"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1523297169, "post_id": 49734101, "comment_id": 86492535, "body": "You answer my first question and I close it , it will be great if you can have a look at the comment ...thanks"}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1523298074, "post_id": 49734101, "comment_id": 86492987, "body": "We just released an update for the IDE which should make debugging possible again, without any workaround from you. Please try it, and if it&#39;s still not working comment back in the issue I linked. Thank you and sorry for the inconvenience!"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1523300200, "post_id": 49734101, "comment_id": 86494075, "body": "Thanks, just two question: should I remove the <code>Use native backend</code> after the update ?"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1523300343, "post_id": 49734101, "comment_id": 86494163, "body": "just to verify , in case i&#39;ve very small go binary which I need to debug , I need to run this bin and in parallel use the option <code>run-&gt;attach local process</code> , until I&#39;ll do it the bin will finish to run..., so how can I make this work with the latest Goland?"}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "reply_to_user": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "edited": false, "score": 0, "creation_date": 1523332971, "post_id": 49734101, "comment_id": 86504692, "body": "Yes, you should br able to remove the <code>Use native backend</code> workaround after the update. I don&#39;t understand the second question, can you please either open an issue or ping me on twitter/Gophers Slack at @dlsniper? Thank you."}, {"owner": {"reputation": 28102, "user_id": 100957, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4a77820cc954ab33a0d7933bb60bf044?s=128&d=identicon&r=PG", "display_name": "Heiko Rupp", "link": "https://stackoverflow.com/users/100957/heiko-rupp"}, "edited": false, "score": 1, "creation_date": 1523461348, "post_id": 49734101, "comment_id": 86573985, "body": "The latest Goland 2018.1.1 should have the OSX issue fixed."}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 4, "last_activity_date": 1523475377, "last_edit_date": 1523475377, "creation_date": 1523280260, "answer_id": 49734101, "question_id": 49733006, "link": "https://stackoverflow.com/questions/49733006/debug-golang-code-and-attach-it-to-local-process/49734101#49734101", "title": "Debug Golang code and attach it to local process", "body": "<p>If you use GoLand 2018.1+ you should be able to use the Run | Attach to Local Process feature and it will allow you to debug a running binary.</p>\n\n<p>I suggest that you compile the binary with all the optimizations turned off and compiled with Go 1.10+ in order to get the best debugging experience.</p>\n\n<p>Furthermore, the IDE can launch the binary and debug it in a single click, removing the need to perform multiple steps.</p>\n\n<p><s> One last issue that I can mention is that you currently will not be able to correctly debug Go apps via Delve, so regardless of which editor you use, due to a bug introduced by Apple in the latest developer tools. For more information please see the issue on our tracker: <a href=\"https://youtrack.jetbrains.com/issue/GO-5527\" rel=\"nofollow noreferrer\">https://youtrack.jetbrains.com/issue/GO-5527</a> and on Delve's tracker: <a href=\"https://github.com/derekparker/delve/issues/1165\" rel=\"nofollow noreferrer\">https://github.com/derekparker/delve/issues/1165</a> </s></p>\n\n<p>Edit:</p>\n\n<p>The issue mentioned above was resolved in GoLand 2018.1.1.</p>\n"}], "owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4285, "favorite_count": 1, "accepted_answer_id": 49734101, "answer_count": 1, "score": 3, "last_activity_date": 1523475377, "creation_date": 1523276938, "last_edit_date": 1523277341, "question_id": 49733006, "link": "https://stackoverflow.com/questions/49733006/debug-golang-code-and-attach-it-to-local-process", "title": "Debug Golang code and attach it to local process", "body": "<p>Im having a Golang code which I create from it binary for mac via go build\nlike:</p>\n\n<p><code>build darwin  amd64 myapp</code> </p>\n\n<p>Currently Im <strong>able to run the binary</strong> and see the logs.</p>\n\n<p>Now I want to debug it , is there a way to debug the binary with <code>Goland</code> or <code>Intellij</code> or <code>VSCode</code> ? regular debug with <code>delve</code> is working from all the IDE's above but now I want to attach it to the binary process which I was able to run,Any idea if it possible?</p>\n"}, {"tags": ["mysql", "go", "struct"], "comments": [{"owner": {"reputation": 10803, "user_id": 2548147, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cfKie.jpg?s=128&g=1", "display_name": "Raymond Nijland", "link": "https://stackoverflow.com/users/2548147/raymond-nijland"}, "edited": false, "score": 0, "creation_date": 1523271644, "post_id": 49731317, "comment_id": 86476206, "body": "You can&#39;t make dynamic columns with in MySQL."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523271737, "post_id": 49731317, "comment_id": 86476267, "body": "There is no way to create dynamic struct with different json tags or hiding the value."}, {"owner": {"reputation": 59, "user_id": 9503747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/117e7dfc4c78542591bf46f210152b47?s=128&d=identicon&r=PG&f=1", "display_name": "Medone", "link": "https://stackoverflow.com/users/9503747/medone"}, "reply_to_user": {"reputation": 10803, "user_id": 2548147, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cfKie.jpg?s=128&g=1", "display_name": "Raymond Nijland", "link": "https://stackoverflow.com/users/2548147/raymond-nijland"}, "edited": false, "score": 0, "creation_date": 1523271848, "post_id": 49731317, "comment_id": 86476341, "body": "@RaymondNijland i was talking on the result that will be shown as a json value , the table have a row called age  but it has some null values  so i want to control the struct where the age is null it will just show the id and user  else it will show all the fields"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523271962, "post_id": 49731317, "comment_id": 86476413, "body": "What does JSON have to do with this question, and why are you using <code>json</code> tags? Did you mean to use <code>db</code> tags?  Or is that an unrelated artifact?"}, {"owner": {"reputation": 59, "user_id": 9503747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/117e7dfc4c78542591bf46f210152b47?s=128&d=identicon&r=PG&f=1", "display_name": "Medone", "link": "https://stackoverflow.com/users/9503747/medone"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523272358, "post_id": 49731317, "comment_id": 86476651, "body": "yeep mr @Flimzy i am working on a rest api with json so i need the tags"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523272595, "post_id": 49731317, "comment_id": 86476798, "body": "Okay, no problem. It was just unclear whether you thought the tags were related to your question, since you included the [json] tag as well."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523272859, "post_id": 49731317, "comment_id": 86476961, "body": "@Medone an alternative solution to Flimzy&#39;s answer would be to use <code>json:&quot;age,omitempty&quot;</code> tag in Go, and <code>COALESCE(age, &#39;&#39;)</code> in your sql query. This way you can avoid having to deal with pointers in your Go struct."}, {"owner": {"reputation": 59, "user_id": 9503747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/117e7dfc4c78542591bf46f210152b47?s=128&d=identicon&r=PG&f=1", "display_name": "Medone", "link": "https://stackoverflow.com/users/9503747/medone"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523273502, "post_id": 49731317, "comment_id": 86477343, "body": "thanks @Flimzy for the solution just to mention if the age is a int  we can replace it sql.NullInt64"}, {"owner": {"reputation": 59, "user_id": 9503747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/117e7dfc4c78542591bf46f210152b47?s=128&d=identicon&r=PG&f=1", "display_name": "Medone", "link": "https://stackoverflow.com/users/9503747/medone"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523273546, "post_id": 49731317, "comment_id": 86477372, "body": "thanks @mkopriva for the additional suggestion it is working also"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1523273828, "post_id": 49731317, "comment_id": 86477571, "body": "@Medone you&#39;ll have to convert the int to int64 before you use sql.NullInt64. And if you opt for the alternative you can use <code>COALESCE(age, 0)</code> as well."}, {"owner": {"reputation": 59, "user_id": 9503747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/117e7dfc4c78542591bf46f210152b47?s=128&d=identicon&r=PG&f=1", "display_name": "Medone", "link": "https://stackoverflow.com/users/9503747/medone"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523280233, "post_id": 49731317, "comment_id": 86481960, "body": "@mkopriva i shared the result wanted as a screenshot  titled the result wanted"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1523281309, "post_id": 49731317, "comment_id": 86482674, "body": "@Medone use <code>,omitempty</code> in the json tag if you want to avoid <code>null</code> properties in your json."}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1523281566, "post_id": 49731317, "comment_id": 86482839, "body": "@Medone Json does not display anything, nor does it create SQL queries. Are you using some kind of 3. party ORM, and you want that ORM to generate certain SQL queries for you based on some submitted Json Input ? Or do you just want to fetch all records in your database, convert them to Json, but have the <code>Age</code> property removed for the records where <code>Age</code> is NULL ? Or do you want to do something else entirely ? Note  that your question is very moot and unclear, please try to add more details about what you actually need to do."}, {"owner": {"reputation": 59, "user_id": 9503747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/117e7dfc4c78542591bf46f210152b47?s=128&d=identicon&r=PG&f=1", "display_name": "Medone", "link": "https://stackoverflow.com/users/9503747/medone"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523281568, "post_id": 49731317, "comment_id": 86482842, "body": "@mkopriva i am just new to golang i replaced the string with a pointer string (*string)  as Flimzy suggested but it keeps returning me a null  even though"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523281726, "post_id": 49731317, "comment_id": 86482942, "body": "@Medone use <code>,omitempty</code> like in this example: <a href=\"https://play.golang.org/p/Kb0dAF2mWad\" rel=\"nofollow noreferrer\">play.golang.org/p/Kb0dAF2mWad</a>"}, {"owner": {"reputation": 59, "user_id": 9503747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/117e7dfc4c78542591bf46f210152b47?s=128&d=identicon&r=PG&f=1", "display_name": "Medone", "link": "https://stackoverflow.com/users/9503747/medone"}, "reply_to_user": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1523281792, "post_id": 49731317, "comment_id": 86482988, "body": "thank you @nos  it&#39;s as you mentioned:&quot; Or do you just want to fetch all records in your database, convert them to Json, but have the Age property removed for the records where Age is NULL &quot;"}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1523281856, "post_id": 49731317, "comment_id": 86483043, "body": "@Medone, That&#39;s what you need to write in your question then."}, {"owner": {"reputation": 59, "user_id": 9503747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/117e7dfc4c78542591bf46f210152b47?s=128&d=identicon&r=PG&f=1", "display_name": "Medone", "link": "https://stackoverflow.com/users/9503747/medone"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523281901, "post_id": 49731317, "comment_id": 86483066, "body": "that&#39;s what i was looking for @mkopriva thanks for the help"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 5, "last_activity_date": 1523281354, "last_edit_date": 1523281354, "creation_date": 1523271879, "answer_id": 49731445, "question_id": 49731317, "link": "https://stackoverflow.com/questions/49731317/handling-result-if-a-field-is-null-from-database-golang-mysql/49731445#49731445", "title": "handling result if a field is null from database golang mysql", "body": "<p>Don't do that.  Instead, use a nil-able type for your <code>Age</code> field. <code>*string</code> or <a href=\"https://golang.org/pkg/database/sql/#NullString\" rel=\"nofollow noreferrer\"><code>sql.NullString</code></a> would be the most natural choices.  Then just always select it, and the NULL value will be treated properly.</p>\n\n<pre><code>type Users struct {\n    ID    int     `json:\"id\"`\n    Name  string  `json:\"name\"`\n    Age   *string `json:\"age\"`\n}\n</code></pre>\n\n<p>Then always use:</p>\n\n<pre><code>SELECT id, name, age FROM users\n</code></pre>\n\n<p>And when <code>Age</code> is NULL in the database, it will be <code>nil</code> in Go, and when it's not NULL in the database, it will be a non-nil pointer to a string in Go.</p>\n"}, {"tags": [], "owner": {"reputation": 340, "user_id": 6464746, "user_type": "registered", "accept_rate": 22, "profile_image": "https://lh6.googleusercontent.com/-75L-hYPbdcQ/AAAAAAAAAAI/AAAAAAAAAKo/siHtIEA6B0g/photo.jpg?sz=128", "display_name": "Yash Goel", "link": "https://stackoverflow.com/users/6464746/yash-goel"}, "is_accepted": false, "score": 2, "last_activity_date": 1523448077, "creation_date": 1523448077, "answer_id": 49774592, "question_id": 49731317, "link": "https://stackoverflow.com/questions/49731317/handling-result-if-a-field-is-null-from-database-golang-mysql/49774592#49774592", "title": "handling result if a field is null from database golang mysql", "body": "<p>Use <code>ifnull()</code> in your query, so that <code>null</code> values can be fetched as <code>''</code>(string's default value)</p>\n\n<pre><code>select id,name,ifnull(age, '') from users;\n</code></pre>\n\n<p>Then use <code>omitempty</code> in <code>json</code> tag of Age field.</p>\n\n<pre><code>type Users struct {\nID    int    `json:\"id\"`\nName  string `json:\"name\"`\nAge   string `json:\"age,omitempty\"`\n}\n</code></pre>\n\n<p>If default value is fetched in Age, then it will be ignored in json response.</p>\n"}], "owner": {"reputation": 59, "user_id": 9503747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/117e7dfc4c78542591bf46f210152b47?s=128&d=identicon&r=PG&f=1", "display_name": "Medone", "link": "https://stackoverflow.com/users/9503747/medone"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2304, "favorite_count": 1, "answer_count": 2, "score": -1, "last_activity_date": 1523448077, "creation_date": 1523271417, "last_edit_date": 1523281365, "question_id": 49731317, "link": "https://stackoverflow.com/questions/49731317/handling-result-if-a-field-is-null-from-database-golang-mysql", "title": "handling result if a field is null from database golang mysql", "body": "<p><a href=\"https://i.stack.imgur.com/S8WrV.png\" rel=\"nofollow noreferrer\">the result wanted</a>I have a struct in go </p>\n\n<pre><code>type Users struct {\n    ID    int    `json:\"id\"`\n    Name  string `json:\"name\"`\n    Age   string `json:\"age\"`\n}\n</code></pre>\n\n<p>I have a mysql database in which some age values are nil so basically to make it dynamic I've been searching for the solution.   \"Age string <code>json:-</code>\" to hide the field if it is returnig the value nil from mysql.\nI did two queries </p>\n\n<pre><code>   query1: select id,name,age from users where age is not null\n   query2: select id,name from users where age is null\n</code></pre>\n\n<p>How can I make it a dynamic query to show the age if exsits else it doesn't don't show it?</p>\n"}, {"tags": ["git", "go", "go-git"], "comments": [{"owner": {"reputation": 3201, "user_id": 1875092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1182c2dfe8c91c9623e09d6c8fdf87b0?s=128&d=identicon&r=PG", "display_name": "jsageryd", "link": "https://stackoverflow.com/users/1875092/jsageryd"}, "edited": false, "score": 0, "creation_date": 1523276232, "post_id": 49731120, "comment_id": 86479145, "body": "Probably. Have you tried? Please explain how far you have gotten and what problem you are experiencing."}], "answers": [{"tags": [], "owner": {"reputation": 594, "user_id": 1054114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc175ba42a40a2cd3d3ba24910f9bfa1?s=128&d=identicon&r=PG", "display_name": "orirawlings", "link": "https://stackoverflow.com/users/1054114/orirawlings"}, "is_accepted": true, "score": 2, "last_activity_date": 1523279633, "creation_date": 1523279633, "answer_id": 49733881, "question_id": 49731120, "link": "https://stackoverflow.com/questions/49731120/is-it-possible-to-git-diff-equivalent-with-go-git/49733881#49733881", "title": "Is it possible to git diff equivalent with go-git", "body": "<p>You can use the <a href=\"https://godoc.org/gopkg.in/src-d/go-git.v4/plumbing/object#Commit.Patch\" rel=\"nofollow noreferrer\">(*object.Commit).Patch</a> method to diff two arbitrary commits. This provides information about which files where changed and what the differences were.</p>\n"}], "owner": {"reputation": 175, "user_id": 7902359, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/cc136e9fe72b06c7f6c2f201bf9e7b39?s=128&d=identicon&r=PG&f=1", "display_name": "ecl0", "link": "https://stackoverflow.com/users/7902359/ecl0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1364, "favorite_count": 0, "accepted_answer_id": 49733881, "answer_count": 1, "score": 1, "last_activity_date": 1523279633, "creation_date": 1523270698, "question_id": 49731120, "link": "https://stackoverflow.com/questions/49731120/is-it-possible-to-git-diff-equivalent-with-go-git", "title": "Is it possible to git diff equivalent with go-git", "body": "<p>I'm pulling a repo every 10 seconds and need to check what files have changed after each pull.</p>\n\n<p>Is it possible to do this with go-git?</p>\n"}, {"tags": ["variables", "go", "scope"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 6, "last_activity_date": 1523295474, "last_edit_date": 1523295474, "creation_date": 1523270792, "answer_id": 49731153, "question_id": 49731072, "link": "https://stackoverflow.com/questions/49731072/err-value-disappearing-outside-of-if-statement/49731153#49731153", "title": "err value disappearing outside of if statement", "body": "<p>The cause is detailed in <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">Spec: Short variable declaration:</a></p>\n\n<blockquote>\n  <p>Unlike regular variable declarations, a short variable declaration may redeclare variables provided they were originally declared earlier <strong>in the same block</strong> (or the parameter lists if the block is the function body) with the same type, and at least one of the non-blank variables is new. As a consequence, redeclaration can only appear in a multi-variable short declaration. Redeclaration does not introduce a new variable; it just assigns a new value to the original.</p>\n</blockquote>\n\n<p>When using short variable declaration with multiple variables where one already exists, assignment will only happen to the existing variable if it was declared <strong>in the same block</strong>. Since in your case <code>err</code> variable existed before the <code>if</code> block, <strong>a new <code>err</code> variable</strong> will be created inside the <code>if</code> block, which has nothing to do with the \"outsider\" <code>err</code> variable (other than sharing its name). The outer <code>err</code> will be <em>shadowed</em> in the <code>if</code> block after the short variable declaration.</p>\n\n<p>So what happens is that inside the <code>if</code>, you create a new <code>err</code> variable, and you assign a value to that, and you print that.</p>\n\n<p>After the <code>if</code> statement, you will print the outer <code>err</code> variable whose value was not changed inside the <code>if</code> block, so it remains <code>nil</code>.</p>\n\n<p>See this example:</p>\n\n<pre><code>var err error\nfmt.Println(\"outside:\", err) // nil\n\n{\n    // A new err variable, shadows the outer:\n    i, err := strconv.Atoi(\"a\")\n    fmt.Println(\"inside:\", i, err) // 0 strconv.Aoti: parsing \"a\": invalid syntax\n}\n\nfmt.Println(\"outside:\", err) // nil, because this was never changed\n\n// Now this will change the \"outer\" err:\nj, err := strconv.Atoi(\"a\")\nfmt.Println(\"outside:\", j, err) // 0 strconv.Aoti: parsing \"a\": invalid syntax\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/9xLTLkkkXyc\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>outside: &lt;nil&gt;\ninside: 0 strconv.Atoi: parsing \"a\": invalid syntax\noutside: &lt;nil&gt;\noutside: 0 strconv.Atoi: parsing \"a\": invalid syntax\n</code></pre>\n\n<p>If you want to use (assign to) the \"outer\" variable when also creating new variable(s), you can't use short variable declaration in a \"nested\" block but only simple assignment, in which case you also have to declare the other variables a priori, like in this example:</p>\n\n<pre><code>if err == nil {\n    var body []byte\n    body, err = ioutil.ReadAll(response.Body)\n    // ... rest...\n}\n</code></pre>\n\n<p>See related questions:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/34266337/why-it-is-possible-to-redefine-err-in-multiple-return-statement-in-go/34266366#34266366\">Why it is possible to redefine err in multiple return statement in Go</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/27919359/why-there-are-two-ways-of-declaring-variables-in-go-whats-the-difference-and-w/27919847#27919847\">Why there are two ways of declaring variables in Go, what&#39;s the difference and which to use?</a></p>\n"}, {"comments": [{"owner": {"reputation": 3292, "user_id": 2709093, "user_type": "registered", "profile_image": "https://graph.facebook.com/1042262218/picture?type=large", "display_name": "James K", "link": "https://stackoverflow.com/users/2709093/james-k"}, "edited": false, "score": 0, "creation_date": 1523271708, "post_id": 49731252, "comment_id": 86476242, "body": "This might give a compilation error <code>undefined body</code>."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 3292, "user_id": 2709093, "user_type": "registered", "profile_image": "https://graph.facebook.com/1042262218/picture?type=large", "display_name": "James K", "link": "https://stackoverflow.com/users/2709093/james-k"}, "edited": false, "score": 0, "creation_date": 1523271806, "post_id": 49731252, "comment_id": 86476311, "body": "Oh I mistakenly removed the assignment operator for body. Main purpose was to declare err outside of block"}, {"owner": {"reputation": 3292, "user_id": 2709093, "user_type": "registered", "profile_image": "https://graph.facebook.com/1042262218/picture?type=large", "display_name": "James K", "link": "https://stackoverflow.com/users/2709093/james-k"}, "edited": false, "score": 1, "creation_date": 1523272607, "post_id": 49731252, "comment_id": 86476809, "body": "But this now has the same shadowing problem from the original question... I&#39;d declare body (inside or outside the block as required) and use assignment (<code>=</code>) to redefine the value of err declared outside the block."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 3292, "user_id": 2709093, "user_type": "registered", "profile_image": "https://graph.facebook.com/1042262218/picture?type=large", "display_name": "James K", "link": "https://stackoverflow.com/users/2709093/james-k"}, "edited": false, "score": 0, "creation_date": 1523273466, "post_id": 49731252, "comment_id": 86477323, "body": "using assignment operator you are initializing the value of err and if you wants to print error inside the body you have to print it inside the block as it will have different value outside the body."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": -1, "last_activity_date": 1523293958, "last_edit_date": 1523293958, "creation_date": 1523271139, "answer_id": 49731252, "question_id": 49731072, "link": "https://stackoverflow.com/questions/49731072/err-value-disappearing-outside-of-if-statement/49731252#49731252", "title": "err value disappearing outside of if statement", "body": "<p>You have created <code>err</code> inside block but you are printing same outside of block. Declare error outside of block and initialize it anywhere inside that will fetch the value when printing.</p>\n\n<pre><code>var err error\nfmt.Println(err) // always prints nil\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8581634"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1523295474, "creation_date": 1523270566, "last_edit_date": 1523271720, "question_id": 49731072, "link": "https://stackoverflow.com/questions/49731072/err-value-disappearing-outside-of-if-statement", "title": "err value disappearing outside of if statement", "body": "<p>I have the code below:</p>\n\n<pre><code>if err == nil {\n    body, err := ioutil.ReadAll(response.Body)\n    if err == nil {\n        dataMap := &amp;models.UserResponse{}\n        json.Unmarshal(body, &amp;dataMap)\n        if dataMap.User == (models.UserId{}) {\n            err = fmt.Errorf(\"unauthorized\")\n            fmt.Println(err) // when unathorized, prints unauthorized\n        }\n    }\n}\n\nfmt.Println(err) // always prints nil\n</code></pre>\n\n<p>The <code>Println</code> inside <code>if dataMap.User ...</code> prints <code>\"unauthorized\"</code>, whereas the last <code>Println</code> always prints <code>nil</code>.</p>\n\n<p>I have no idea why it happens, <code>err</code> is declared via <code>var err error</code> at the beginning of this function.</p>\n"}, {"tags": ["go", "web", "permissions", "middleware"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523269424, "post_id": 49730556, "comment_id": 86474847, "body": "Write tests that make sure you didn&#39;t forget. As a bonus you know that your middlewares actually work."}], "answers": [{"comments": [{"owner": {"reputation": 2382, "user_id": 6272277, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/522db908ba9addc9a647f5c8a8f8421a?s=128&d=identicon&r=PG&f=1", "display_name": "Lassi", "link": "https://stackoverflow.com/users/6272277/lassi"}, "edited": false, "score": 0, "creation_date": 1525378466, "post_id": 49730892, "comment_id": 87344271, "body": "Here&#39;s a good tutorial that goes into more detail: <a href=\"https://medium.com/@matryer/the-http-handler-wrapper-technique-in-golang-updated-bc7fbcffa702\" rel=\"nofollow noreferrer\">medium.com/@matryer/&hellip;</a>"}], "tags": [], "owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "is_accepted": true, "score": 4, "last_activity_date": 1523270026, "creation_date": 1523270026, "answer_id": 49730892, "question_id": 49730556, "link": "https://stackoverflow.com/questions/49730556/best-way-to-check-user-permissions-in-a-go-web-app-router/49730892#49730892", "title": "Best way to check user permissions in a Go web app router", "body": "<p>Writing your own is not hard. Assuming you store your admin token in an environment variable called ADMINTOKEN :</p>\n\n<pre><code>func AdminOnly(f func(w http.ResponseWriter, r *http.Request)) func(w http.ResponseWriter, r *http.Request) {\n    return func(w http.ResponseWriter, r *http.Request) {\n        w.Header().Set(\"Access-Control-Allow-Headers\", \"Accept, Content-Type, Content-Length, Accept-Encoding, Authorization\")\n        if r.Method == \"OPTIONS\" {\n            f(w, r)\n            return\n        }\n\n        h := r.Header.Get(\"Authorization\")\n        token := strings.TrimPrefix(h, \"Bearer \")\n        if token == os.Getenv(\"ADMINTOKEN\") {\n            f(w, r)\n            return\n        }\n\n        http.Error(w, http.StatusText(http.StatusUnauthorized), http.StatusUnauthorized)\n    }\n}\n</code></pre>\n\n<p>OPTIONS method may have to be authorized regardless because of CORS.</p>\n"}, {"tags": [], "owner": {"reputation": 2254, "user_id": 1003650, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6b653616a592b8bdc296b0abf6207a71?s=128&d=identicon&r=PG", "display_name": "Venantius", "link": "https://stackoverflow.com/users/1003650/venantius"}, "is_accepted": false, "score": 0, "last_activity_date": 1523285431, "creation_date": 1523285431, "answer_id": 49735828, "question_id": 49730556, "link": "https://stackoverflow.com/questions/49730556/best-way-to-check-user-permissions-in-a-go-web-app-router/49735828#49735828", "title": "Best way to check user permissions in a Go web app router", "body": "<p>The short answer is to write middleware to handle authorization. A longer answer that may help you out just as much in the long run would be to use appropriate routing paths for your endpoints alongside that middleware. For instance, you could prefix all of your admin routes with <code>/api/admin</code> and then wrap the router for individual routes after that with the relevant admin-auth middleware.</p>\n"}], "owner": {"reputation": 2382, "user_id": 6272277, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/522db908ba9addc9a647f5c8a8f8421a?s=128&d=identicon&r=PG&f=1", "display_name": "Lassi", "link": "https://stackoverflow.com/users/6272277/lassi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 525, "favorite_count": 0, "accepted_answer_id": 49730892, "answer_count": 2, "score": 0, "last_activity_date": 1523285431, "creation_date": 1523268911, "question_id": 49730556, "link": "https://stackoverflow.com/questions/49730556/best-way-to-check-user-permissions-in-a-go-web-app-router", "title": "Best way to check user permissions in a Go web app router", "body": "<p>My web app has URLs at three access levels:</p>\n\n<ul>\n<li>Those accessible by anyone (login page and static assets)</li>\n<li>Those accessible regular users and admins who are logged in</li>\n<li>Those accessible only by admins who are logged in</li>\n</ul>\n\n<p>I should specify the minimum access level for each URL pattern in my router, so that people below that level are blocked. (I suppose they should get HTTP error 401 or 403.)</p>\n\n<p>How do I best implement these checks so that I don't have to remember to put them in every URL handler function separately (which is very easy to forget)? Ideally I'd like to do something like this:</p>\n\n<pre><code>router.Get(\"/someRegularPage\", regularAccess(handleSomeRegularPage))\nrouter.Get(\"/someAdminPage\", adminAccess(handleSomeAdminPage))\nrouter.Get(\"/\", publicAccess(handleLoginPage))\n</code></pre>\n\n<p>Is there some semi-standard middleware to do this and how does that work? How hard would it be to write my own?</p>\n\n<p>Additionally, it would be great if the default permission was to deny access to everybody in case I forget to specify the access level for some URL. A compiler warning or error would be ideal.</p>\n"}, {"tags": ["json", "csv", "parsing", "go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1523264511, "post_id": 49729041, "comment_id": 86471899, "body": "Please post what you have tried."}], "answers": [{"comments": [{"owner": {"reputation": 950, "user_id": 4834383, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ktt2X.gif?s=128&g=1", "display_name": "AlexGordon", "link": "https://stackoverflow.com/users/4834383/alexgordon"}, "edited": false, "score": 0, "creation_date": 1523266396, "post_id": 49729479, "comment_id": 86473016, "body": "I suspect preprocessing the file would be difficult because the input file (which may be huge) is arriving via network and is being processed while it is incoming (notice <code>multipart.Part</code>)."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 950, "user_id": 4834383, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ktt2X.gif?s=128&g=1", "display_name": "AlexGordon", "link": "https://stackoverflow.com/users/4834383/alexgordon"}, "edited": false, "score": 1, "creation_date": 1523266637, "post_id": 49729479, "comment_id": 86473171, "body": "Not at all. Just create an <code>io.Reader</code> wrapper, that reads each line as it comes in, calls <code>strings.SplitN(input, 4)</code>, properly quotes/escapes the last field, then writes the modified line as output."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1523265448, "creation_date": 1523265448, "answer_id": 49729479, "question_id": 49729041, "link": "https://stackoverflow.com/questions/49729041/parsing-nested-json-objects-in-a-csv-file-with-golang/49729479#49729479", "title": "Parsing nested JSON objects in a CSV file with golang", "body": "<p>Your CSV input doesn't follow normal CSV convention, by using unquoted fields (for JSON).</p>\n\n<p>I think the best approach would be to pre-process your input, either in your Go program, or in an external script.</p>\n\n<p>If your CSV input is predictable (as indicated in your question), it should be easy to properly quote last element, using a simple <code>strings.Split</code> call, for instance, before passing it to the CSV parser.</p>\n"}], "owner": {"reputation": 950, "user_id": 4834383, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ktt2X.gif?s=128&g=1", "display_name": "AlexGordon", "link": "https://stackoverflow.com/users/4834383/alexgordon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 446, "favorite_count": 1, "accepted_answer_id": 49729479, "answer_count": 1, "score": 0, "last_activity_date": 1523265448, "creation_date": 1523264116, "last_edit_date": 1523265193, "question_id": 49729041, "link": "https://stackoverflow.com/questions/49729041/parsing-nested-json-objects-in-a-csv-file-with-golang", "title": "Parsing nested JSON objects in a CSV file with golang", "body": "<p>I'm trying to parse a CSV file which contains a JSON object in the last column.<br>\nHere is an example with two rows from the input CSV file:</p>\n\n<pre><code>'id','value','createddate','attributes'\n524256,CAFE,2018-04-06 16:41:01,{\"Att1Numeric\": 6, \"Att2String\": \"abc\"}\n524257,BEBE,2018-04-06 17:00:00,{}\n</code></pre>\n\n<p>I tried using the parser from <code>csv</code> package:</p>\n\n<pre><code>func processFileAsCSV(f *multipart.Part) (int, error) {\n  reader := csv.NewReader(f)\n  reader.LazyQuotes = true\n  reader.Comma = ','\n  lineCount := 0\n  for {\n    line, err := reader.Read()\n    if err == io.EOF {\n        break\n    } else if err != nil {\n        fmt.Println(\"Error:\", err)\n        return 0, err\n    }\n\n    if lineCount%100000 == 0 {\n        fmt.Println(lineCount)\n    }\n    lineCount++\n    fmt.Println(lineCount, line)\n    processLine(line) // do something with the line\n  }\n\n  fmt.Println(\"done!\", lineCount)\n  return lineCount, nil\n}\n</code></pre>\n\n<p>But I got an error: </p>\n\n<blockquote>\n  <p>Error: line 2, column 0: wrong number of fields in line,</p>\n</blockquote>\n\n<p>probably because the parser ignores the JSON scope which starts with <code>{</code>.  </p>\n\n<p>Should I be writing my own CSV parser, or is there a library that can handle this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1523261983, "post_id": 49728373, "comment_id": 86470524, "body": "Why do you need/want to combine these functions? What is the actual goal?"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1523277280, "creation_date": 1523277280, "answer_id": 49733088, "question_id": 49728373, "link": "https://stackoverflow.com/questions/49728373/golang-how-can-these-two-functions-be-combined/49733088#49733088", "title": "golang how can these two functions be combined?", "body": "<p>You shouldn't \"combine\" those functions. What's common in them, move them \"out\", e.g. to a 3rd function which can be called by these 2.</p>\n\n<p>Also, connecting to a DB should not be a \"local\" operation, it should only be done once, e.g. in a package <code>init()</code> function.</p>\n\n<p>Moreover, functions that may fail (db operations are typical examples of these) should return an error, so it can be inspected and dealt with at the caller.</p>\n\n<p>This is a simpler, more robust and more idiomatic solution to your example:</p>\n\n<pre><code>var db *sql.DB\n\nfunc init() {\n    var err error\n    db, err = sql.Open(\"mysql\", \"db_url_string\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    if err = db.Ping(); err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc dbExecute(sql_cmd string) error {\n    stmt, err := db.Prepare(sql_cmd)\n    if err != nil {\n        return err\n    }\n    _, err = stmt.Exec()\n    return err\n}\n\nfunc dbTabelaSelect(cod_cliente string) (id, cod1, cod2, cod3 string, err error) {\n    query := \"select id, cod1, cod2, cod3 from db_tabela WHERE 'cliente'=? LIMIT 1\"\n    err = db.QueryRow(query, cod_cliente).Scan(&amp;id, &amp;cod1, &amp;cod2, &amp;cod3)\n    return\n}\n</code></pre>\n\n<p>Example using these functions:</p>\n\n<pre><code>func main() {\n    defer db.Close() // Graceful shutdown\n\n    if err := dbExecute(\"some_SQL\"); err != nil {\n        fmt.Print(\"SQL execution failed: %v\", err)\n    }\n\n    id, cod1, cod2, cod3, err := dbTabelaSelect(\"someID\")\n    switch {\n    case err == sql.ErrNoRows:\n        log.Printf(\"No codice cliente with that ID.\")\n    case err != nil:\n        log.Printf(\"database select problems\")\n    default:\n        fmt.Printf(\"Client code is %s %s %s %s\\n\", id, cod1, cod2, cod3)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 7204615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54176ff575fc7ec6f336c97869756259?s=128&d=identicon&r=PG&f=1", "display_name": "Lucian Blaga", "link": "https://stackoverflow.com/users/7204615/lucian-blaga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 202, "favorite_count": 0, "accepted_answer_id": 49733088, "answer_count": 1, "score": 0, "last_activity_date": 1523277280, "creation_date": 1523261889, "last_edit_date": 1523261971, "question_id": 49728373, "link": "https://stackoverflow.com/questions/49728373/golang-how-can-these-two-functions-be-combined", "title": "golang how can these two functions be combined?", "body": "<p>I want to learn to write clean code in golang, my problem is: I have two function and I need to combined to become only one, this is my actual code:</p>\n\n<pre><code>func db_execute(sql_cmd string) bool {\n\n    db, err := sql.Open(\"mysql\", mysql_login)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer db.Close()\n\n    err = db.Ping()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    stmt, err := db.Prepare(sql_cmd)\n    if err != nil {\n        fmt.Print(err.Error())\n    }\n    _, err = stmt.Exec()\n\n    if err != nil {\n        fmt.Print(err.Error())\n        return false\n    }\n\n    return true\n}\n\nfunc db_tabela_select(cod_cliente string) (id string, cod1 string, cod2 string, cod3 string) {\n\n    db, err := sql.Open(\"mysql\", mysql_login)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer db.Close()\n\n    err = db.Ping()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    err = db.QueryRow(\"select id, cod1, cod2, cod3 from db_tabela WHERE `cliente`=? LIMIT 1;\", cod_cliente).Scan(\n                        &amp;id, &amp;cod1, &amp;cod2, &amp;cod3)\n\n    switch {\n        case err == sql.ErrNoRows:\n                log.Printf(\"No codice cliente with that ID.\")\n        case err != nil:\n                log.Printf(\"database select problems\")\n        default:\n                fmt.Printf(\"Client code is %s %s %s\\n\", cod1, cod2, cod3)\n    }\n\n    return id, cod1, cod2, cod3\n}\n</code></pre>\n\n<p>How can I combine these 2 function in one? These functions have different input and different output.</p>\n"}, {"tags": ["mongodb", "http", "go", "state-machine"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1523261531, "post_id": 49728207, "comment_id": 86470299, "body": "Do you want to report 503 to all requests until the db is up? Or just to some selected endpoints?"}, {"owner": {"reputation": 679, "user_id": 1016771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ca8fd7158817a17bf51e0f4af7cd932?s=128&d=identicon&r=PG", "display_name": "nahsh", "link": "https://stackoverflow.com/users/1016771/nahsh"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1523261627, "post_id": 49728207, "comment_id": 86470340, "body": "Good question. I guess not, I want to be able to response to requests like server-health, version and so on."}, {"owner": {"reputation": 395, "user_id": 5264772, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-97udj4nE7oA/AAAAAAAAAAI/AAAAAAAABB0/6q0gJDPyEr4/photo.jpg?sz=128", "display_name": "Abhishek Sinha", "link": "https://stackoverflow.com/users/5264772/abhishek-sinha"}, "edited": false, "score": 0, "creation_date": 1523268626, "post_id": 49728207, "comment_id": 86474387, "body": "When you call <code>http.ListenAndServe</code> you can provide a different handler which can return 503. Once your connection is established, switch to use the <code>DefaultServeMux</code> which can server your routes, if you do not want to use a multiplexer. But I believe Middleware is a better way to go"}, {"owner": {"reputation": 679, "user_id": 1016771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ca8fd7158817a17bf51e0f4af7cd932?s=128&d=identicon&r=PG", "display_name": "nahsh", "link": "https://stackoverflow.com/users/1016771/nahsh"}, "edited": false, "score": 0, "creation_date": 1523272647, "post_id": 49728207, "comment_id": 86476832, "body": "Thanks  Abhishek. But this is actually my knowledge gap - how can I switch the mux on runtime?"}], "answers": [{"tags": [], "owner": {"reputation": 679, "user_id": 1016771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ca8fd7158817a17bf51e0f4af7cd932?s=128&d=identicon&r=PG", "display_name": "nahsh", "link": "https://stackoverflow.com/users/1016771/nahsh"}, "is_accepted": false, "score": 0, "last_activity_date": 1523274198, "creation_date": 1523274198, "answer_id": 49732136, "question_id": 49728207, "link": "https://stackoverflow.com/questions/49728207/change-http-routing-by-server-status/49732136#49732136", "title": "Change HTTP routing by server status", "body": "<p>I have something working, but it does based on common data. However, the data is a single boolean, so I guess it's not so dramatic. I would love to get comments for this solution:</p>\n\n<p>In the dao package, I have this Connect method, that return a boolean channel. The private connect go routine, writes 'true' and exit when succeed:\n</p>\n\n<pre><code>func Connect() chan bool {\n    connected := make(chan bool)\n    go connect(mongoUrl, connected)\n    return connected\n}\n</code></pre>\n\n<p>I also added the Ping() method to the dao package; it run forever and monitor the database status. It reports the status to a new channel and try to reconnect if needed:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Ping() chan bool {\n    status := make(chan bool)\n    go func() {\n        for {\n            if err := session.Ping(); err != nil {\n                session.Close()\n                status &lt;- false\n                &lt;- Connect()\n                status &lt;- true\n            }\n            time.Sleep(time.Second)\n        }\n    }()\n\n    return status\n} \n</code></pre>\n\n<p>In the main package, I have this simple type:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Connected struct {\n    isConnected bool\n}\n\n// this one is called as go-routine \nfunc (c *Connected) check(dbConnected chan bool) {\n    // first connection, on server boot\n    c.isConnected = &lt;- dbConnected\n\n    // monitor the database status\n    status := dao.Ping()\n    for {\n        c.isConnected = &lt;- status\n    }\n}\n\n// the middleware\nfunc (c *Connected) checkDbHandleFunc(next http.HandlerFunc) http.HandlerFunc {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        if !c.isConnected {\n            w.Header().Add(\"Retry-After\", \"10\")\n            w.Header().Set(\"Content-Type\", \"application/json\")\n            w.WriteHeader(503)\n            respBody := `{\"error\":\"The server is busy; Try again soon\"}`\n            w.Write([]byte(respBody))\n        } else {\n            next.ServeHTTP(w, r)\n        }\n    })\n}\n</code></pre>\n\n<p>Middleware usage:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>...\nconnected := Connected{\n    isConnected: false,\n}\n\ndbConnected := dao.Connect()\ngo connected.check(dbConnected)\n\nmux := http.NewServeMux()\nmux.HandleFunc(\"/\", mainPage)\nmux.HandleFunc(\"/some-db-required-path/\", connected.checkDbHandleFunc(someDbRequiredHandler))\n...\nlog.Fatal(http.ListenAndServe(addr, mux))\n...\n</code></pre>\n\n<p>Does it make sense?</p>\n"}], "owner": {"reputation": 679, "user_id": 1016771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ca8fd7158817a17bf51e0f4af7cd932?s=128&d=identicon&r=PG", "display_name": "nahsh", "link": "https://stackoverflow.com/users/1016771/nahsh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1523274198, "creation_date": 1523261283, "last_edit_date": 1523261875, "question_id": 49728207, "link": "https://stackoverflow.com/questions/49728207/change-http-routing-by-server-status", "title": "Change HTTP routing by server status", "body": "<p>I'm building a REST server in Go and using mongoDB as my database (but this question is actually related to any other external resource).</p>\n\n<p>I want my server to start and respond, even if the database is not up yet (not when the database is down after the server started - this is a different issue, much easier one).</p>\n\n<p>So my dao package includes a connection go-routine that receives a boolean channel, and write 'true' to the channel when it successfully connected to the database. If the connection failed, the go-routine will keep trying every X seconds.</p>\n\n<p>When I use this package with another software I wrote, that is a just a command-line program, I'm using select with timeout:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>dbConnected := make(chan bool)\nstorage.Connect(dbConnected)\n\ntimeout := time.After(time.Minute)\n\nselect {\ncase &lt;-dbConnected:\n    createReport()\n\ncase &lt;-timeout:\n    log.Fatalln(\"Can't connect to the database\")\n}\n</code></pre>\n\n<p>I want to use the same packge in a server, but I don't want to fail the whole server. Instead, I want to start the server with handler that returns <code>503 SERVER BUSY</code>, until the server is connected to the database, and then start serve requests normally. Is there a simple way to implement this logic in go standard library? Using solutions like gorilla is an option, but the server is simple with very few APIs, and gorilla is a bit overkill.</p>\n\n<p>== edited: ==</p>\n\n<p>I know I can use a middleware but I don't know how to do that without sharing data between the main method and the handlers. That why I'm using the channel in the first place.</p>\n"}, {"tags": ["go", "pprof"], "comments": [{"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 1, "creation_date": 1523261742, "post_id": 49728114, "comment_id": 86470396, "body": "Maybe this could help a little: <a href=\"https://violetear.org/post/0-allocs/#pprof\" rel=\"nofollow noreferrer\">violetear.org/post/0-allocs/#pprof</a>"}, {"owner": {"reputation": 1347, "user_id": 4622470, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/6015804f9937b6231b4b0022d70b5ddb?s=128&d=identicon&r=PG&f=1", "display_name": "Rohanil", "link": "https://stackoverflow.com/users/4622470/rohanil"}, "reply_to_user": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 0, "creation_date": 1523262923, "post_id": 49728114, "comment_id": 86471006, "body": "@nbari : I used <code>list</code> command of pprof but it could not explain what is ExternalCode."}, {"owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 0, "creation_date": 1523264152, "post_id": 49728114, "comment_id": 86471713, "body": "I had a similar issue. Are you doing any <code>time.NewTicker</code> in a loop?"}, {"owner": {"reputation": 1347, "user_id": 4622470, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/6015804f9937b6231b4b0022d70b5ddb?s=128&d=identicon&r=PG&f=1", "display_name": "Rohanil", "link": "https://stackoverflow.com/users/4622470/rohanil"}, "reply_to_user": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 0, "creation_date": 1523265575, "post_id": 49728114, "comment_id": 86472511, "body": "@vedhavyas : not actually but I have <code>time.Now()</code> in a loop"}, {"owner": {"reputation": 911, "user_id": 3563197, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/563e4185281840ef1792eda5d6391440?s=128&d=identicon&r=PG", "display_name": "vedhavyas", "link": "https://stackoverflow.com/users/3563197/vedhavyas"}, "edited": false, "score": 0, "creation_date": 1523266770, "post_id": 49728114, "comment_id": 86473251, "body": "without any code to look at, can&#39;t help you"}, {"owner": {"reputation": 3568, "user_id": 3621735, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5fd836e3ae389f324e2f8112b33a5772?s=128&d=identicon&r=PG&f=1", "display_name": "Sam", "link": "https://stackoverflow.com/users/3621735/sam"}, "edited": false, "score": 0, "creation_date": 1523303062, "post_id": 49728114, "comment_id": 86495469, "body": "Install graphviz and do a &#39;web&#39; on pprof cli."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1574591715, "post_id": 49728114, "comment_id": 104279976, "body": "it is weird your profile only shows runtime and none of the code calling it."}], "owner": {"reputation": 1347, "user_id": 4622470, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/6015804f9937b6231b4b0022d70b5ddb?s=128&d=identicon&r=PG&f=1", "display_name": "Rohanil", "link": "https://stackoverflow.com/users/4622470/rohanil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 991, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1574545926, "creation_date": 1523260874, "last_edit_date": 1574545926, "question_id": 49728114, "link": "https://stackoverflow.com/questions/49728114/understanding-go-pprof-result", "title": "understanding go pprof result", "body": "<p>I have Go code and I have written unit test for it. The test runs for 6.5 sec and it creates huge CPU load. I am running tests in docker container and its CPU usage reaches at 400-500%. I got cpuprofile and it shows following result:</p>\n\n<pre><code>(pprof) top\nShowing nodes accounting for 4260ms, 69.49% of 6130ms total\nDropped 80 nodes (cum &lt;= 30.65ms)\nShowing top 10 nodes out of 79\n      flat  flat%   sum%        cum   cum%\n    1250ms 20.39% 20.39%     1250ms 20.39%  runtime._ExternalCode /usr/local/go/src/runtime/proc.go\n     640ms 10.44% 30.83%      960ms 15.66%  runtime.scanobject /usr/local/go/src/runtime/mgcmark.go\n     580ms  9.46% 40.29%      580ms  9.46%  runtime.memmove /usr/local/go/src/runtime/memmove_amd64.s\n     420ms  6.85% 47.15%      730ms 11.91%  runtime.mapassign_faststr /usr/local/go/src/runtime/hashmap_fast.go\n     310ms  5.06% 52.20%      310ms  5.06%  runtime.duffcopy /usr/local/go/src/runtime/duff_amd64.s\n     260ms  4.24% 56.44%      260ms  4.24%  runtime.heapBitsForObject /usr/local/go/src/runtime/mbitmap.go\n     220ms  3.59% 60.03%      220ms  3.59%  runtime.scanobject /usr/local/go/src/runtime/mbitmap.go\n     200ms  3.26% 63.30%     1630ms 26.59%  runtime.mallocgc /usr/local/go/src/runtime/malloc.go\n     200ms  3.26% 66.56%      200ms  3.26%  runtime.memclrNoHeapPointers /usr/local/go/src/runtime/memclr_amd64.s\n     180ms  2.94% 69.49%     2250ms 36.70%  runtime.systemstack /usr/local/go/src/runtime/asm_amd64.s\n</code></pre>\n\n<p>I don't understand what is ExternalCode here. Also there is none of my actual code's function in this result. I understand some of my functions might be calling these built-in go stuff and could end up spending a lot of time there. But then it does not give me direction to work on improving performance in my code. Is there anything obvious from this result that I need to give attention to?</p>\n\n<p>I try to use <code>list</code> command in pprof interactive mode for the functions which were showing high cpu usage.</p>\n\n<pre><code>(pprof) list _ExternalCode\nTotal: 6.13s\nROUTINE ======================== runtime._ExternalCode in /usr/local/go/src/runtime/proc.go\n     1.25s      1.25s (flat, cum) 20.39% of Total\n         .          .   3231:   signalLock uint32\n         .          .   3232:   hz         int32\n         .          .   3233:}\n         .          .   3234:\n         .          .   3235:func _System()                    { _System() }\n     1.25s      1.25s   3236:func _ExternalCode()              { _ExternalCode() }\n         .          .   3237:func _LostExternalCode()          { _LostExternalCode() }\n         .          .   3238:func _GC()                        { _GC() }\n         .          .   3239:func _LostSIGPROFDuringAtomic64() { _LostSIGPROFDuringAtomic64() }\n         .          .   3240:\n         .          .   3241:// Counts SIGPROFs received while in atomic64 critical section, on mips{,le}\n(pprof) \n(pprof) \n(pprof) \n(pprof) list scanobject\nTotal: 6.13s\nROUTINE ======================== runtime.scanobject in /usr/local/go/src/runtime/mbitmap.go\n     220ms      220ms (flat, cum)  3.59% of Total\n         .          .    479:\n         .          .    480:// The caller can test morePointers and isPointer by &amp;-ing with bitScan and bitPointer.\n         .          .    481:// The result includes in its higher bits the bits for subsequent words\n         .          .    482:// described by the same bitmap byte.\n         .          .    483:func (h heapBits) bits() uint32 {\n         .          .    484:   // The (shift &amp; 31) eliminates a test and conditional branch\n         .          .    485:   // from the generated code.\n     200ms      200ms    486:   return uint32(*h.bitp) &gt;&gt; (h.shift &amp; 31)\n         .          .    487:}\n         .          .    488:\n         .          .    489:// morePointers returns true if this word and all remaining words in this object\n         .          .    490:// are scalars.\n         .          .    491:// h must not describe the second word of the object.\nROUTINE ======================== runtime.scanobject in /usr/local/go/src/runtime/mgcmark.go\n     640ms      960ms (flat, cum) 15.66% of Total\n         .          .   1155:           n = maxObletBytes\n         .          .   1156:       }\n         .          .   1157:   }\n         .          .   1158:\n         .          .   1159:   var i uintptr\n     100ms      100ms   1160:   for i = 0; i &lt; n; i += sys.PtrSize {\n         .          .   1161:       // Find bits for this word.\n      10ms       10ms   1162:       if i != 0 {\n         .          .   1163:           // Avoid needless hbits.next() on last iteration.\n      10ms       10ms   1164:           hbits = hbits.next()\n         .          .   1165:       }\n         .          .   1166:       // Load bits once. See CL 22712 and issue 16973 for discussion.\n         .          .   1167:       bits := hbits.bits()\n         .          .   1168:       // During checkmarking, 1-word objects store the checkmark\n         .          .   1169:       // in the type bit for the one word. The only one-word objects\n         .          .   1170:       // are pointers, or else they'd be merged with other non-pointer\n         .          .   1171:       // data into larger allocations.\n      80ms       80ms   1172:       if i != 1*sys.PtrSize &amp;&amp; bits&amp;bitScan == 0 {\n         .          .   1173:           break // no more pointers in this object\n         .          .   1174:       }\n      10ms       10ms   1175:       if bits&amp;bitPointer == 0 {\n         .          .   1176:           continue // not a pointer\n         .          .   1177:       }\n         .          .   1178:\n         .          .   1179:       // Work here is duplicated in scanblock and above.\n         .          .   1180:       // If you make changes here, make changes there too.\n      20ms       20ms   1181:       obj := *(*uintptr)(unsafe.Pointer(b + i))\n         .          .   1182:\n         .          .   1183:       // At this point we have extracted the next potential pointer.\n         .          .   1184:       // Check if it points into heap and not back at the current object.\n     340ms      340ms   1185:       if obj != 0 &amp;&amp; arena_start &lt;= obj &amp;&amp; obj &lt; arena_used &amp;&amp; obj-b &gt;= n {\n         .          .   1186:           // Mark the object.\n      60ms      300ms   1187:           if obj, hbits, span, objIndex := heapBitsForObject(obj, b, i); obj != 0 {\n      10ms       90ms   1188:               greyobject(obj, b, i, hbits, span, gcw, objIndex)\n         .          .   1189:           }\n         .          .   1190:       }\n         .          .   1191:   }\n         .          .   1192:   gcw.bytesMarked += uint64(n)\n         .          .   1193:   gcw.scanWork += int64(i)\n</code></pre>\n"}, {"tags": ["go", "google-cloud-storage", "app-engine-flexible"], "answers": [{"tags": [], "owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "is_accepted": true, "score": 1, "last_activity_date": 1523508509, "last_edit_date": 1523508509, "creation_date": 1523506378, "answer_id": 49787887, "question_id": 49727761, "link": "https://stackoverflow.com/questions/49727761/how-to-authenticate-resumable-uploads-from-appengine-flexible-similar-as-signedu/49787887#49787887", "title": "how to authenticate resumable uploads from appEngine flexible,similar as SignedURL in golang", "body": "<p>Well, I wanted to avoid to use auth2 because there wasn\u00b4t a nice documentation, and after reading a lot documentation and tried many fails examples, I finally go it to work, these are the steps to make a the token Bearer for Resume upload with json api </p>\n\n<ol>\n<li><p>Download JSON credential from console.cloud.google.com/apis/credentials</p>\n\n<p>1.1)Select \"Creat Credentials\"\n1.2)Select \"Service account key\"\n1.3)Select your account\n1.4) Select JSON->creat\n1.4)It will download a JSON with the information you need</p></li>\n<li><p>Creat a oauth2/jwt tokenSource</p>\n\n<p>import (\n    \"context\"\n    \"net/http\"\n    \"golang.org/x/oauth2/jwt\"\n)\n    var config = &amp;jwt.Config{\n                Email:        \"someEmail@something.com\",\n                PrivateKey:   []byte(\"-----BEGIN PRIVATE KEY-----\\nbablablablablablabalabal\\nbablablablablablabalabalas=\\n-----END PRIVATE KEY-----\\n\"),\n                PrivateKeyID: \"somethingVeryPrivate\",\n                Scopes:       []string{\"<a href=\"https://www.googleapis.com/auth/devstorage.read_write\" rel=\"nofollow noreferrer\">https://www.googleapis.com/auth/devstorage.read_write</a>\"}, //you can change/add scopes if you want <a href=\"https://cloud.google.com/storage/docs/json_api/v1/how-tos/authorizing\" rel=\"nofollow noreferrer\">https://cloud.google.com/storage/docs/json_api/v1/how-tos/authorizing</a>\n                TokenURL:     \"<a href=\"https://accounts.google.com/o/oauth2/token\" rel=\"nofollow noreferrer\">https://accounts.google.com/o/oauth2/token</a>\",\n            }\n            token, err := config.TokenSource(context.Background()).Token()//handle error</p></li>\n</ol>\n\n<p>3)Now  you have the id to use, it is in method token.AccessToken</p>\n\n<p>All the procces to get the url, I put it here: <a href=\"https://github.com/johnbalvin/google-cloud-go/blob/master/storage/resumableUpload.go\" rel=\"nofollow noreferrer\">https://github.com/johnbalvin/google-cloud-go/blob/master/storage/resumableUpload.go</a></p>\n"}], "owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 49787887, "answer_count": 1, "score": 0, "last_activity_date": 1523508509, "creation_date": 1523259490, "last_edit_date": 1523260499, "question_id": 49727761, "link": "https://stackoverflow.com/questions/49727761/how-to-authenticate-resumable-uploads-from-appengine-flexible-similar-as-signedu", "title": "how to authenticate resumable uploads from appEngine flexible,similar as SignedURL in golang", "body": "<p>I got this code to get a signedURL:</p>\n\n<pre><code>import (\n    \"net/http\"\n    \"time\"\n    \"cloud.google.com/go/storage\"\n    \"google.golang.org/appengine\"\n)\n\n//Don\u00b4t worry about the errors, I\u00b4m handling them\nfunc CreatSignedURL(r *http.Request) (string, error) {\n    ctx := appengine.NewContext(r)\n    acc, _ := appengine.ServiceAccount(ctx)\n    filename := \"fileName\"\n    bucket := \"bucketName\"\n    expires := time.Now().Add(time.Hour * 2)\n    url, _ := storage.SignedURL(bucket, filename, &amp;storage.SignedURLOptions{\n        GoogleAccessID: acc,\n        SignBytes: func(b []byte) ([]byte, error) {\n            _, signedBytes, err2 := appengine.SignBytes(ctx, b)\n            return signedBytes, err2\n        },\n        Method:  \"PUT\",\n        Expires: expires,\n    })\n    return url, nil\n}\n</code></pre>\n\n<p>But, I want to authenticate similar as the code above with resumable upload </p>\n\n<pre><code>import (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc ResumeUploadURL(nameBucket, nombreObjeto string) string {\n    url := \"https://www.googleapis.com/upload/storage/v1/b/\" + nameBucket + \"/o?uploadType=resumable&amp;name=\" + nombreObjeto\n    client := &amp;http.Client{}\n    r, _ := http.NewRequest(\"POST\", url, nil)              // URL-encoded payload\n    r.Header.Add(\"Authorization\", \"auth_token=??????????\") // What should I use instead?\n    r.Header.Add(\"Content-Length\", \"0\")\n\n    resp, _ := client.Do(r)\n    .....\n}\n</code></pre>\n\n<p>But I need auth_token,where auth_token I need to get it like it\u00b4s described here <a href=\"https://cloud.google.com/storage/docs/json_api/v1/how-tos/authorizing\" rel=\"nofollow noreferrer\">https://cloud.google.com/storage/docs/json_api/v1/how-tos/authorizing</a> But I would wanna avoid that becasue it seems pretty silly to me  to authenticate in that way if I can easy authenticate with signedURL and with resume upload can\u00b4t</p>\n"}, {"tags": ["git", "go", "dependency-management", "vendor"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523257511, "post_id": 49727229, "comment_id": 86468195, "body": "You can&#39;t. Those two ideals are in necessary conflict. The best you can do is re-apply your changes, manually resolving any conflicts, after updating the dependency."}, {"owner": {"reputation": 7779, "user_id": 6858274, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/323d5de87d97a689b73a663375e079eb?s=128&d=identicon&r=PG&f=1", "display_name": "felix", "link": "https://stackoverflow.com/users/6858274/felix"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523258092, "post_id": 49727229, "comment_id": 86468505, "body": "@Flimzy thanks for the answer, I guess I already knew it..."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523258698, "post_id": 49727229, "comment_id": 86468813, "body": "It&#39;s worth mentioning, there may be tools that make this task easier for you. The simplest might be to just fork your dependency, and then handle any merge conflicts in that repository, rather than in your <code>&#47;vendor&#47;</code> folder. Whether that&#39;s feasible/easy depends on the complexity of the package. There are also other patch-management tools (quilt comes to mind). AFAIK, none interface cleanly with the Go ecosystem, but it may be possible to shoe-horn something in."}, {"owner": {"reputation": 7779, "user_id": 6858274, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/323d5de87d97a689b73a663375e079eb?s=128&d=identicon&r=PG&f=1", "display_name": "felix", "link": "https://stackoverflow.com/users/6858274/felix"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1523258890, "post_id": 49727229, "comment_id": 86468927, "body": "@Flimzy sadly I can&#39;t fork the dependency, because I have another vendored dependency that import it... For the moment I&#39;ll keep re-applying my change with <code>git cherry-pick</code> and see how it goes"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523259086, "post_id": 49727229, "comment_id": 86469023, "body": "That&#39;s the approach I&#39;ve usually taken, too. Good luck."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523262156, "post_id": 49727229, "comment_id": 86470610, "body": "If your dependency is a git repository you can look into <a href=\"https://git-scm.com/book/en/v1/Git-Tools-Subtree-Merging\" rel=\"nofollow noreferrer\">git sub-trees</a> too. That is fairly complicated, requires special workflows for updating, and easy to mess up; but if done correctly it works well if you have many patches. If you want to try it, do that on a copy of your repository. As long as cherry-picking works for you, stick with that. We have all vendor patches committed as .patch files, so it&#39;s easy to re-apply them after an update. Also write tests that make sure all patches are applied correctly."}], "answers": [{"tags": [], "owner": {"reputation": 754, "user_id": 3476897, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/57E2l.png?s=128&g=1", "display_name": "Kugel", "link": "https://stackoverflow.com/users/3476897/kugel"}, "is_accepted": false, "score": 2, "last_activity_date": 1523260541, "creation_date": 1523260541, "answer_id": 49728035, "question_id": 49727229, "link": "https://stackoverflow.com/questions/49727229/avoid-loosing-custom-change-in-vendored-dependency-when-updating-dependencies/49728035#49728035", "title": "avoid loosing custom change in vendored dependency when updating dependencies", "body": "<p>Make a fork and when your dependency gets updated, rebase.</p>\n"}], "owner": {"reputation": 7779, "user_id": 6858274, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/323d5de87d97a689b73a663375e079eb?s=128&d=identicon&r=PG&f=1", "display_name": "felix", "link": "https://stackoverflow.com/users/6858274/felix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1523260541, "creation_date": 1523257377, "question_id": 49727229, "link": "https://stackoverflow.com/questions/49727229/avoid-loosing-custom-change-in-vendored-dependency-when-updating-dependencies", "title": "avoid loosing custom change in vendored dependency when updating dependencies", "body": "<p>I have a golang project using dep with a <code>vendor</code> directory. </p>\n\n<p>for some reason, I had to modify the code of one of the vendored dependency. <strong>This change can't be pushed to the upstream repository</strong>. </p>\n\n<p>How can I keep updating my vendored dependency, without loosing my change ? </p>\n"}, {"tags": ["azure", "go", "tcp", "azure-storage"], "comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 2, "creation_date": 1523246270, "post_id": 49725161, "comment_id": 86464468, "body": "It would be helpful if you would create a full example that compiles and can be run (<a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>). Your current example won&#39;t compile and is calling a lot of code that isn&#39;t in your question. We can&#39;t say anything meaningful about code we don&#39;t see ;-)"}, {"owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1523247307, "post_id": 49725161, "comment_id": 86464675, "body": "I&#39;ve made a bunch of changes to the code - now all someone really needs is a free, basic azure account to run the code. (There are many API questions on SO which require some kind of account to recreate so this seems fine.) If you have other complaints that I could fix to get you to remove your <code>-1</code>, please let me know!"}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1523247474, "post_id": 49725161, "comment_id": 86464708, "body": "Are you sure the code compiles, and that it demonstrates the problem you&#39;re having? Did you test it? Because I don&#39;t see <code>env</code> being defined anywhere, <code>err</code> being assigned and not used, etc."}, {"owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "reply_to_user": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1523247853, "post_id": 49725161, "comment_id": 86464801, "body": "ok. i fixed it. only thing user needs to enter is account credentials."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523258717, "post_id": 49725161, "comment_id": 86468823, "body": "Add your lsof command and some output too. Are most of these connections in TIME_WAIT state? That would be perfectly normal."}, {"owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "edited": false, "score": 0, "creation_date": 1523283778, "post_id": 49725161, "comment_id": 86484311, "body": "Updated with an example entry"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 1, "creation_date": 1523287036, "post_id": 49725161, "comment_id": 86486712, "body": "Are you using &quot;keep-alive&quot;?"}, {"owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "edited": false, "score": 0, "creation_date": 1523287970, "post_id": 49725161, "comment_id": 86487357, "body": "<a href=\"https://golang.org/pkg/net/http\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http</a> search <code>var DefaultTransport RoundTripper</code>, you can see that it does not set <code>DisableKeepAlives</code> so DisableKeepAlives is false so &quot;keep-alive&quot; should be enabled."}], "answers": [{"tags": [], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "is_accepted": false, "score": 0, "last_activity_date": 1523384428, "creation_date": 1523384428, "answer_id": 49760538, "question_id": 49725161, "link": "https://stackoverflow.com/questions/49725161/how-to-limit-connection-count-when-running-many-copy-operations-concurrently/49760538#49760538", "title": "How to limit connection count when running many Copy operations concurrently?", "body": "<p>There was a <a href=\"https://github.com/Azure/azure-sdk-for-go/pull/1539/commits/475dde0c61b55d1619215fe28c3aba375690162b\" rel=\"nofollow noreferrer\">connection leak in the azure library</a>. The fix has been merged into <code>dev</code> and will probably be included in the next release.</p>\n"}], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1523384428, "creation_date": 1523245002, "last_edit_date": 1523325735, "question_id": 49725161, "link": "https://stackoverflow.com/questions/49725161/how-to-limit-connection-count-when-running-many-copy-operations-concurrently", "title": "How to limit connection count when running many Copy operations concurrently?", "body": "<p>I have code which runs 200 goroutines concurrently. Each goroutine issues <a href=\"https://godoc.org/github.com/Azure/azure-sdk-for-go/storage#Blob.Copy\" rel=\"nofollow noreferrer\"><code>Copy</code></a> operations in serial. Each <code>Copy</code> makes two requests:</p>\n\n<ol>\n<li><a href=\"https://github.com/Azure/azure-sdk-for-go/blob/master/storage/copyblob.go#L72\" rel=\"nofollow noreferrer\"><code>StartCopy</code></a> (PUT request)</li>\n<li><a href=\"https://github.com/Azure/azure-sdk-for-go/blob/master/storage/copyblob.go#L77\" rel=\"nofollow noreferrer\"><code>WaitForCopy</code></a> (HEAD request)</li>\n</ol>\n\n<p>After each http request, <a href=\"https://github.com/Azure/azure-sdk-for-go/blob/master/storage/copyblob.go#L113\" rel=\"nofollow noreferrer\"><code>readAndCloseBody</code></a> is called, which is important for ensuring connections are reused. Additionally, I've set the transport to http.DefaultTransport and set <code>MaxIdleConnsPerHost</code> and <code>MaxIdleConns</code> to 200, which is important since it defaults to <code>DefaultMaxConnsPerHost</code> == 2.</p>\n\n<p>Despite all this, when I run <code>lsof</code>, I frequently see many <strong>more than 200</strong> TCP (ESTABLISHED) entries - sometimes up to 1000. Here's an example:</p>\n\n<pre><code>main 24217 jsmith 377u IPv4 0x364ecf4bed03d3d 0t0 TCP :50248-&gt;51.4.208.24:https (ESTABLISHED)\n</code></pre>\n\n<p>Any idea where connections might be leaking/how to limit connection count?</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"sync\"\n    \"time\"\n\n    \"github.com/Azure/azure-sdk-for-go/storage\"\n)\n\nfunc main() {\n    // create and initialize a client\n    client, _ := storage.NewBasicClient(ACCOUNT_NAME, ACCOUNT_KEY)\n\n    // use DefaultTransport with configs that limit conns\n    client.HTTPClient.Transport = http.DefaultTransport\n    transp, _ := client.HTTPClient.Transport.(*http.Transport)\n    client.HTTPClient.Transport = http.DefaultTransport\n    transp.MaxIdleConnsPerHost = 200\n    transp.MaxIdleConns = 200\n\n    rootClient := client.GetBlobService().GetContainerReference(\"foo\")\n    numRoutines := 200\n    numRequestsPerRoutine := 100\n\n    var wg sync.WaitGroup\n    for i := 0; i &lt; numRoutines; i++ {\n        wg.Add(1)\n        go func() {\n            for j := 0; j &lt; numRequestsPerRoutine; j++ {\n                sourceBlob := rootClient.GetBlobReference(\"fileA\")\n                destBlob := rootClient.GetBlobReference(\"dirX/fileA\")\n                destBlob.Copy(sourceBlob.GetURL(), nil)\n                time.Sleep(250 * time.Millisecond)\n            }\n            wg.Done()\n        }()\n    }\n    wg.Wait()\n}\n</code></pre>\n\n<p>I'm running go1.10 on OSX 10.3.2 and using <code>github.com/Azure/azure-sdk-for-go/storage</code> at <a href=\"https://github.com/Azure/azure-sdk-for-go/commit/56332fec5b308fbb6615fa1af6117394cdba186d\" rel=\"nofollow noreferrer\"><code>56332fe</code></a>.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1523248375, "last_edit_date": 1592644375, "creation_date": 1523248375, "answer_id": 49725586, "question_id": 49724142, "link": "https://stackoverflow.com/questions/49724142/gin-static-file-cache/49725586#49725586", "title": "Gin static file cache", "body": "<p>The <a href=\"https://github.com/gin-gonic/gin/issues/1222\" rel=\"nofollow noreferrer\">issue 1222</a> is still open, but with the comment:</p>\n<blockquote>\n<p>The status code 304 would not indicate a cached file but one was not modified.</p>\n<p>But you are wrong. This is enough to enable HTTP Conditional Get:</p>\n</blockquote>\n<pre><code>r := gin.Default()\nr.Static(&quot;/assets&quot;, &quot;./assets&quot;)\n</code></pre>\n<blockquote>\n<p>A file in assets is returned including the HTTP header <code>Last-Modified</code>.<br />\nThe next request by the browser will send the corresponding <code>If-Modified-Since</code> header which Gin will respond to with <code>304 Not Modified</code>.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 191, "user_id": 10494482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec6ee46c87f9b3ba9106a05b64ee257c?s=128&d=identicon&r=PG&f=1", "display_name": "EricW", "link": "https://stackoverflow.com/users/10494482/ericw"}, "is_accepted": false, "score": 1, "last_activity_date": 1578883265, "creation_date": 1578883265, "answer_id": 59709995, "question_id": 49724142, "link": "https://stackoverflow.com/questions/49724142/gin-static-file-cache/59709995#59709995", "title": "Gin static file cache", "body": "<p>In case you were using Chrome, this might be the cause:</p>\n\n<blockquote>\n  <p>You probably have the Disable cache (while DevTools is open) option selected in the Preferences panel of DevTools.\n  <a href=\"https://stackoverflow.com/questions/42719038/chrome-is-sending-cache-controlno-cache-header\">Chrome is sending Cache-control:no-cache header</a></p>\n</blockquote>\n\n<p><a href=\"https://i.stack.imgur.com/4FjCv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4FjCv.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 31, "user_id": 8611851, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26026841676304baed3459a19d86c291?s=128&d=identicon&r=PG&f=1", "display_name": "sematerix", "link": "https://stackoverflow.com/users/8611851/sematerix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1853, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1578883265, "creation_date": 1523233854, "last_edit_date": 1523234087, "question_id": 49724142, "link": "https://stackoverflow.com/questions/49724142/gin-static-file-cache", "title": "Gin static file cache", "body": "<p>Is possible to cache static files in Gin (golang)? </p>\n\n<p>I tried:</p>\n\n<pre><code>router := gin.Default()\nrouter.Static(\"/assets\", \"./assets\") \n</code></pre>\n\n<p>But I get a response with status code 200 whenever I refresh the page. I assume it should be 304 (or similar), but <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow noreferrer\">https://github.com/gin-gonic/gin</a> has no mention about HTTP caching (at least for now).</p>\n\n<p>How can I handle static file caching in gin?</p>\n"}, {"tags": ["pointers", "go", "reference"], "answers": [{"comments": [{"owner": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "edited": false, "score": 0, "creation_date": 1523228362, "post_id": 49723470, "comment_id": 86460864, "body": "do you know if changing <code>Chat to *Chat</code> would work?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523228817, "post_id": 49723470, "comment_id": 86460965, "body": "Do note that this only works if all fields are exported though."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523244906, "post_id": 49723470, "comment_id": 86464216, "body": "Good point @peter"}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": false, "score": 3, "last_activity_date": 1523227713, "last_edit_date": 1523227713, "creation_date": 1523227272, "answer_id": 49723470, "question_id": 49723427, "link": "https://stackoverflow.com/questions/49723427/copy-struct-with-nested-maps/49723470#49723470", "title": "Copy struct with nested maps", "body": "<p>I have found in previous cases, that an easy (though not the most efficient) way to copy a complex structure is to Marshal it, and then Unmarshal it into a new variable.  This can be done with a variety of encodings.  Two easy ones (included in the stdlib) would be json and gob.</p>\n\n<p>There are also plenty of libraries using reflection to achieve a similar goal: <a href=\"https://github.com/jinzhu/copier\" rel=\"nofollow noreferrer\">https://github.com/jinzhu/copier</a></p>\n\n<p>But like I said, though not as efficient, this is easy to reason about and takes just a single, simple function to achieve.  If performance matters you should prefer gob over json.  If performance REALLY matters, then you should prefer another solution altogether.</p>\n"}, {"comments": [{"owner": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "edited": false, "score": 0, "creation_date": 1523229159, "post_id": 49723635, "comment_id": 86461037, "body": "Thanks for the suggestion @reticentroot. I am creating a framework where I can add and remove data values as I need, for example adding an easter egg to the eightball. Having concrete types is nice, but I prefer the ease of development. Also having type switches and the easy <code>.(string)</code> keeps me doing it like this."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "edited": false, "score": 0, "creation_date": 1523229331, "post_id": 49723635, "comment_id": 86461086, "body": "You could modify the struct above to use pointers <code>*string</code>, then when you delete an item you can set it to <code>nil</code>. If you add the omitempty flag to json tags, if marshaled to bytes, the field will no longer be present. Food for thought"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "edited": false, "score": 0, "creation_date": 1523229409, "post_id": 49723635, "comment_id": 86461116, "body": "@PLZHELP, concrete types are <i>much</i> easier to work with than untyped maps. The compiler will stop you long before bad things happen, for instance. And you must be getting tired of type assertions by now."}, {"owner": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523229630, "post_id": 49723635, "comment_id": 86461169, "body": "@Peter you guys may be right. If I had multiple chats with different settings fields, (like one didn&#39;t have the eightball section) is there an easy way to work with that using a traditional concrete struct."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "edited": false, "score": 0, "creation_date": 1523229837, "post_id": 49723635, "comment_id": 86461216, "body": "@PLZHELP,  <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html#embedding</a>. Don&#39;t go overboard with embedding though. Often it is simpler to just have two slightly different types. Don&#39;t try to mimic inheritance with embedding."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "edited": false, "score": 0, "creation_date": 1523230266, "post_id": 49723635, "comment_id": 86461331, "body": "@PLZHELP here is an example <a href=\"https://goplay.space/#Pn_VaYLM_hO\" rel=\"nofollow noreferrer\">goplay.space/#Pn_VaYLM_hO</a> As I said before and Peter has said, you&#39;re gonna want to rip the inner structs out and keep them neat and small. Then you can use nil checking to check if something exist or not."}], "tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": false, "score": 1, "last_activity_date": 1523228710, "creation_date": 1523228710, "answer_id": 49723635, "question_id": 49723427, "link": "https://stackoverflow.com/questions/49723427/copy-struct-with-nested-maps/49723635#49723635", "title": "Copy struct with nested maps", "body": "<p>If you know the data structure it is best for you to fully define your structs. It will be much easier to manage than complex maps and interfaces with reflection to cast data types. Here is a tool to help you convert JSON to Go structs. It isn't perfect and you have to confirm the data types. You may even want to rip out the internal structs and create types for them for readability and maintenance, but it will save you some time.</p>\n\n<p><a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">https://mholt.github.io/json-to-go/</a>  </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\nvar rawDataExample = []byte(`{\n    \"default\": {\n        \"settings\": {\n            \"eightball\": {\n                \"messages\": [\n                    \"yes\",\n                    \"no\",\n                    \"maybe\"\n                ]   \n            },  \n            \"main\": {\n                \"blacklistedCommands\": [], \n                \"blacklistedUsers\": [], \n                \"error\": \"there was an error - \",\n                \"maxConsecutive\": 5,\n                \"permissions\": \"You don't have permissions for that command.\",\n                \"success\": \"The command was successful.\",\n                \"whitelistedCommands\": [], \n                \"whitelistedUsers\": []\n            }   \n        },  \n        \"data\": {\n            \"user\": {\n                \"default\": {\n                    \"admin\": \"false\",\n                    \"consecutiveCommands\": \"0\",\n                    \"nickname\": \"\", \n                    \"sentMessages\": \"0\" \n                },  \n                \"total\": {\n                    \"admin\": \"false\",\n                    \"consecutiveCommands\": \"0\",\n                    \"nickname\": \"\", \n                    \"sentMessages\": \"0\" \n                }   \n            },  \n            \"chat\": {\n                \"commandSender\": \"\", \n                \"lastMessage\": \"\", \n                \"lastSender\": \"\", \n                \"lastTimestamp\": \"\", \n                \"wasCommand\":\"\"\n            }\n        }\n    }\n}\n`)\n\ntype Settings struct {\n    Default struct {\n        Settings struct {\n            Eightball struct {\n                Messages []string `json:\"messages\"`\n            } `json:\"eightball\"`\n            Main struct {\n                BlacklistedCommands []string `json:\"blacklistedCommands\"`\n                BlacklistedUsers    []string `json:\"blacklistedUsers\"`\n                Error               string   `json:\"error\"`\n                MaxConsecutive      int      `json:\"maxConsecutive\"`\n                Permissions         string   `json:\"permissions\"`\n                Success             string   `json:\"success\"`\n                WhitelistedCommands []string `json:\"whitelistedCommands\"`\n                WhitelistedUsers    []string `json:\"whitelistedUsers\"`\n            } `json:\"main\"`\n        } `json:\"settings\"`\n        Data struct {\n            User struct {\n                Default struct {\n                    Admin               string `json:\"admin\"`\n                    ConsecutiveCommands string `json:\"consecutiveCommands\"`\n                    Nickname            string `json:\"nickname\"`\n                    SentMessages        string `json:\"sentMessages\"`\n                } `json:\"default\"`\n                Total struct {\n                    Admin               string `json:\"admin\"`\n                    ConsecutiveCommands string `json:\"consecutiveCommands\"`\n                    Nickname            string `json:\"nickname\"`\n                    SentMessages        string `json:\"sentMessages\"`\n                } `json:\"total\"`\n            } `json:\"user\"`\n            Chat struct {\n                CommandSender string `json:\"commandSender\"`\n                LastMessage   string `json:\"lastMessage\"`\n                LastSender    string `json:\"lastSender\"`\n                LastTimestamp string `json:\"lastTimestamp\"`\n                WasCommand    string `json:\"wasCommand\"`\n            } `json:\"chat\"`\n        } `json:\"data\"`\n    } `json:\"default\"`\n}\n\ntype Data struct {\n    Events map[string]Settings\n}\n\nfunc main() {\n    var settings Settings\n    err := json.Unmarshal(rawDataExample, &amp;settings)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    event := \"foo\"\n    d := Data{\n        Events: make(map[string]Settings),\n    }\n\n    if _, ok := d.Events[event]; !ok {\n        // event doesn't exist\n        // add it\n        d.Events[event] = settings\n        fmt.Println(\"event added\")\n    }\n\n    if _, ok := d.Events[event]; !ok {\n        // event exist, this will never be happen\n        // sanity check\n        fmt.Println(\"this will never be printed\")\n    }\n\n    fmt.Printf(\"%+v\\n\", d)\n\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523230152, "post_id": 49723715, "comment_id": 86461294, "body": "This is exactly the same as your first try."}, {"owner": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523230204, "post_id": 49723715, "comment_id": 86461309, "body": "I changed the type of the map from <code>map[string]Chat</code> to <code>map[string]*Chat</code> and it worked. <i>shrug</i>"}], "tags": [], "owner": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "is_accepted": false, "score": -1, "last_activity_date": 1523229276, "creation_date": 1523229276, "answer_id": 49723715, "question_id": 49723427, "link": "https://stackoverflow.com/questions/49723427/copy-struct-with-nested-maps/49723715#49723715", "title": "Copy struct with nested maps", "body": "<p>Super simple fix, just wanted to get some input before I did it. Changed the <code>map[string]Chat</code> > <code>map[string]*Chat</code> and made a new <code>*Chat</code>, then copied the data.</p>\n\n<pre><code>data[event.Chat] = &amp;Chat{}\n*data[event.Chat] = *data[\"default\"]\n</code></pre>\n"}], "owner": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 579, "favorite_count": 0, "closed_date": 1523272222, "answer_count": 3, "score": 0, "last_activity_date": 1523229324, "creation_date": 1523227016, "last_edit_date": 1523229324, "question_id": 49723427, "link": "https://stackoverflow.com/questions/49723427/copy-struct-with-nested-maps", "closed_reason": "Duplicate", "title": "Copy struct with nested maps", "body": "<p><strong>What am I trying to do?</strong></p>\n\n<p>Copy a \"default\" struct into a new one when needed, keeping all it's values.</p>\n\n<p><strong>Details</strong></p>\n\n<p>I am trying to copy a <code>Chat</code> struct:</p>\n\n<pre><code>type ChatData struct {\n        User map[string]map[string]string `json:\"user\"`\n        Chat map[string]string            `json:\"chat\"`\n}\ntype Chat struct {\n        Settings map[string]map[string]interface{} `json:\"settings\"`\n        Data     ChatData                          `json:\"data\"`\n}\n</code></pre>\n\n<p>I only need to do this when a new chat is introduced, and I check for membership in a <code>map[string]Chat</code>. </p>\n\n<pre><code>//data is a map[string]Chat\nif _, exists := data[event.Chat]; !exists {\n        data[event.Chat] = data[\"default\"]\n}\n</code></pre>\n\n<p>The full default struct is:</p>\n\n<pre><code>{\n    \"default\": {\n        \"settings\": {\n            \"eightball\": {\n                \"messages\": [\n                    \"yes\",\n                    \"no\",\n                    \"maybe\"\n                ]   \n            },  \n            \"main\": {\n                \"blacklistedCommands\": [], \n                \"blacklistedUsers\": [], \n                \"error\": \"there was an error - \",\n                \"maxConsecutive\": 5,\n                \"permissions\": \"You don't have permissions for that command.\",\n                \"success\": \"The command was successful.\",\n                \"whitelistedCommands\": [], \n                \"whitelistedUsers\": []\n            }   \n        },  \n        \"data\": {\n            \"user\": {\n                \"default\": {\n                    \"admin\": \"false\",\n                    \"consecutiveCommands\": \"0\",\n                    \"nickname\": \"\", \n                    \"sentMessages\": \"0\" \n                },  \n                \"total\": {\n                    \"admin\": \"false\",\n                    \"consecutiveCommands\": \"0\",\n                    \"nickname\": \"\", \n                    \"sentMessages\": \"0\" \n                }   \n            },  \n            \"chat\": {\n                \"commandSender\": \"\", \n                \"lastMessage\": \"\", \n                \"lastSender\": \"\", \n                \"lastTimestamp\": \"\", \n                \"wasCommand\":\"\"\n            }\n        }\n    }\n}\n</code></pre>\n\n<p><strong>What have I tried</strong></p>\n\n<pre><code>data[event.Chat] = data[\"default\"]\n// causes a reference\n\ndata[event.Chat] = &amp;data[\"default\"]\n// cannot use &amp;data[\"default\"] (type *Chat) as type Chat in assignment\n\ndata[event.Chat] = *data[\"default\"]\n// invalid indirect of data[\"default\"] (type Chat)\n</code></pre>\n\n<p>Do I need to change my use of <code>map[string]Chat</code> to <code>map[string]*Chat</code> and go with the second option? Pointers and references are not my specialty, so help would be appreciated.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>whoever thought I was copying a map, what are you smoking?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1523225085, "post_id": 49723172, "comment_id": 86460046, "body": "How did &quot;net&quot; end up in <code>src&#47;github.com&#47;golang</code>?  The reason I ask is I don&#39;t see the code importing github.com/golang/net, but rather net which are two different things"}, {"owner": {"reputation": 496, "user_id": 301332, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/9e12c8a13c6c8d18eed8e349431f961f?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/301332/paul"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1523225211, "post_id": 49723172, "comment_id": 86460072, "body": "@sberry I had assumed it was pulled in from the dependencies - but I was trying different fixes to understand how it worked, and it is possible I did a manual <code>go get</code> and put it there."}, {"owner": {"reputation": 496, "user_id": 301332, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/9e12c8a13c6c8d18eed8e349431f961f?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/301332/paul"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1523225261, "post_id": 49723172, "comment_id": 86460084, "body": "@sberry Aaah, that would explain it.  If I installed golang/net myself, could that be why it cannot find the Resolver thing because it is the wrong net?"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1523225329, "post_id": 49723172, "comment_id": 86460100, "body": "Does <code>go run &lt;name_of_file.go&gt;</code> work when <code>name_of_file.go</code> are these contents: <a href=\"https://play.golang.org/p/gRY_gJK1yUu\" rel=\"nofollow noreferrer\">play.golang.org/p/gRY_gJK1yUu</a> ?"}, {"owner": {"reputation": 496, "user_id": 301332, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/9e12c8a13c6c8d18eed8e349431f961f?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/301332/paul"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1523225436, "post_id": 49723172, "comment_id": 86460134, "body": "@sberry Yes, it does, no errors"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 1, "creation_date": 1523225500, "post_id": 49723172, "comment_id": 86460153, "body": "Ah, it appears <code>net.Resolver</code> (or something else) is not present in 1.7.  From the README: <code>Install Go, at least version 1.9.</code>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 4, "creation_date": 1523228404, "post_id": 49723172, "comment_id": 86460873, "body": "For the record, net.Resolver was <a href=\"https://golang.org/doc/go1.8#minor_library_changes\" rel=\"nofollow noreferrer\">introduced in 1.8</a>."}, {"owner": {"reputation": 496, "user_id": 301332, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/9e12c8a13c6c8d18eed8e349431f961f?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/301332/paul"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1523260762, "post_id": 49723172, "comment_id": 86469926, "body": "@sberry Ooops, thanks."}], "owner": {"reputation": 496, "user_id": 301332, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/9e12c8a13c6c8d18eed8e349431f961f?s=128&d=identicon&r=PG", "display_name": "Paul", "link": "https://stackoverflow.com/users/301332/paul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1523224781, "creation_date": 1523224781, "question_id": 49723172, "link": "https://stackoverflow.com/questions/49723172/go-unable-to-find-net-resolver", "title": "go unable to find net.Resolver", "body": "<p>I have installed go 1.7 in Debian to make <a href=\"https://github.com/m13253/dns-over-https\" rel=\"nofollow noreferrer\">doh</a></p>\n\n<p>It has a Makefile, which triggers the download and install of dependencies into my <code>GOPATH</code>.</p>\n\n<p>The <code>net</code> package is there:</p>\n\n<pre><code>$ ls $GOPATH/src/github.com/golang/net/\nAUTHORS         context          dict  http   idna      ipv6     lif      PATENTS       README.md  webdav\nbpf             CONTRIBUTING.md  dns   http2  internal  lex      nettest  proxy         route      websocket\ncodereview.cfg  CONTRIBUTORS     html  icmp   ipv4      LICENSE  netutil  publicsuffix  trace      xsrftoken\n</code></pre>\n\n<p>Yet during the build, it says it cannot find net.Resolver</p>\n\n<pre><code>$ make\ngo get -d -v ./doh-client ./doh-server\ncd doh-client &amp;&amp; go build\n# _/home/share/apps/dns-over-https/doh-client\n./client.go:47: undefined: net.Resolver\nMakefile:46: recipe for target 'doh-client/doh-client' failed\nmake: *** [doh-client/doh-client] Error 2\n</code></pre>\n\n<p>This is my first go with go, so I am not sure how it goes about pulling in imports, and whether the Resolver part is present.</p>\n"}, {"tags": ["go", "slice", "division"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523207736, "post_id": 49720498, "comment_id": 86454139, "body": "That happens when the slice that you are using  has less capacity than the index value you try to insert in it"}, {"owner": {"reputation": 445, "user_id": 92323, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1047661124/picture?type=large", "display_name": "MarcoW", "link": "https://stackoverflow.com/users/92323/marcow"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523208468, "post_id": 49720498, "comment_id": 86454379, "body": "When debugging, both <code>i</code> and <code>i + len(fis)&#47;gophers</code> are well within the bounds of <code>len(fis)</code>."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523208690, "post_id": 49720498, "comment_id": 86454452, "body": "Please post the length of <code>fis</code> in your question"}], "answers": [{"comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523209016, "post_id": 49720684, "comment_id": 86454577, "body": "I have a question here Can&#39;t we create a new slice and then update its value just by resetting ."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523210396, "post_id": 49720684, "comment_id": 86455062, "body": "Got called away.  Won&#39;t be able to fix this for now but it causes gophers+1 goroutines when fix is not evenly divisible."}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 3, "last_activity_date": 1523208698, "creation_date": 1523208698, "answer_id": 49720684, "question_id": 49720498, "link": "https://stackoverflow.com/questions/49720498/slice-bounds-out-of-range-error-when-splitting-a-slice/49720684#49720684", "title": "&#39;Slice bounds out of range&#39;-error when splitting a slice", "body": "<p>Check again.  <code>i + len(fis)/gophers</code> will not be within bound if <code>len(fis)</code> is not evenly divisible by <code>gophers</code>.  It will exceed the bounds on the last iteration.</p>\n\n<p>There are a number of ways to fix this like checking if <code>i + len(fis)/gophers &gt; len(fis) - 1</code> and resetting the value if it is.  You can also just use a <code>math.Min</code> call.</p>\n\n<pre><code>chunk := int(math.Min(float64(i+len(fis)/gophers), float64(len(fis))))\nxFiles := fis[i:chunk]\n</code></pre>\n"}], "owner": {"reputation": 445, "user_id": 92323, "user_type": "registered", "accept_rate": 75, "profile_image": "https://graph.facebook.com/1047661124/picture?type=large", "display_name": "MarcoW", "link": "https://stackoverflow.com/users/92323/marcow"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1460, "favorite_count": 1, "accepted_answer_id": 49720684, "answer_count": 1, "score": 1, "last_activity_date": 1523209388, "creation_date": 1523207417, "last_edit_date": 1523209388, "question_id": 49720498, "link": "https://stackoverflow.com/questions/49720498/slice-bounds-out-of-range-error-when-splitting-a-slice", "title": "&#39;Slice bounds out of range&#39;-error when splitting a slice", "body": "<p>I want to run a bunch of goroutines to insert an insanely large amount of .csv-files into a postgres database. I read the .csv-files to an object and then try to divide the object in 10 parts. This works perfectly when the amount of files is exactly dividable by 10, but when it's not I get a <code>panic: runtime error: slice bounds out of range</code>. </p>\n\n<p>This would be sensible if <code>i + len(fis)/gophers</code> returned a float, but it does not. When I use the debgging-mode of Goland-IDE, both <code>i</code> as well as the result of <code>i + len(fis)/gophers</code> are full integers.</p>\n\n<p>Any clue clue as to why this error occurs? I'm mostly interested in the theory behind why this happens, but also curious if someone can come up with a solution other than using the <code>%</code>-operator.</p>\n\n<p>Thanks in advance!</p>\n\n<p>Edit: I was under the impression that the error returned on the first iteratio (at which point, according to the debugger both <code>i</code> and <code>i + len(fis)/gophers</code> are well within the bounds of <code>len(fis)</code>. The amount of files in the directory is 2568. It turns out the error was on the last iterattion. Thanks Berry for pointing this out.</p>\n\n<pre><code>//Read files from download-folder\nf, _ := os.Open(dlFolder)\nfis, _ := f.Readdir(-1)\nf.Close()\n\nvar wg sync.WaitGroup\n\ngophers := 10\n\n//Split slice of files into 10 chunks and run a goroutine for each of them\nfor i := 0; i &lt; len(fis) ; i = i + len(fis)/gophers{\n\n    wg.Add(1)\n\n    xFiles := fis[i:i + len(fis)/gophers]\n    go csvTSql(xFiles)\n\n}\n\nwg.Wait()\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1523189297, "post_id": 49717523, "comment_id": 86448261, "body": "Try passing a WaitGroup pointer to <code>readFile</code> instead of a value."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523189416, "post_id": 49717523, "comment_id": 86448293, "body": "&quot;A WaitGroup must not be copied after first use.&quot; Use a pointer to a WaitGroup instead."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1523193861, "post_id": 49717523, "comment_id": 86449417, "body": "Running <code>go vet</code>, or having even a single unit test will show the error immediately."}, {"owner": {"reputation": 1184, "user_id": 1269041, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0f4555652545040e404bd072400c810c?s=128&d=identicon&r=PG", "display_name": "konart", "link": "https://stackoverflow.com/users/1269041/konart"}, "edited": false, "score": 0, "creation_date": 1523194234, "post_id": 49717523, "comment_id": 86449562, "body": "Getting or not getting them problem wasn&#39;t the issue though. The issue was me not seeing that I&#39;m passing a value instead of a pointer."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1523195841, "post_id": 49717523, "comment_id": 86450062, "body": "Yes, <code>go vet</code> warns you that you\u2019re copying the value, and <code>go test</code> runs <code>go vet</code>."}], "answers": [{"comments": [{"owner": {"reputation": 1184, "user_id": 1269041, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0f4555652545040e404bd072400c810c?s=128&d=identicon&r=PG", "display_name": "konart", "link": "https://stackoverflow.com/users/1269041/konart"}, "edited": false, "score": 1, "creation_date": 1523191486, "post_id": 49717651, "comment_id": 86448761, "body": "&gt;A WaitGroup must not be copied after first use. - They should put that on the box! (c) Ross Geller"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1184, "user_id": 1269041, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0f4555652545040e404bd072400c810c?s=128&d=identicon&r=PG", "display_name": "konart", "link": "https://stackoverflow.com/users/1269041/konart"}, "edited": false, "score": 3, "creation_date": 1523202018, "post_id": 49717651, "comment_id": 86452110, "body": "@konart, a way to deal with this is to properly approach the Go documentation: it&#39;s terse and as dry as possible, so you do not <i>skim through</i> it\u2014as one usually does with other bits of documentation, in our time of clip thinking,\u2014but actually read it top to bottom. This really works, trust me ;-)"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1523193113, "last_edit_date": 1523193113, "creation_date": 1523189240, "answer_id": 49717651, "question_id": 49717523, "link": "https://stackoverflow.com/questions/49717523/how-to-wait-for-goroutines-to-finish-and-read-the-channel-without-a-lock/49717651#49717651", "title": "How to wait for goroutines to finish and read the channel without a lock?", "body": "<p>Start by following the documentation for the <code>sync.WaitGroup</code> instructions:</p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/pkg/sync/\" rel=\"nofollow noreferrer\">Package sync</a></p>\n\n<pre><code>import \"sync\"\n</code></pre>\n  \n  <p><a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">type WaitGroup</a></p>\n  \n  <p>A WaitGroup waits for a collection of goroutines to finish. The main\n  goroutine calls Add to set the number of goroutines to wait for. Then\n  each of the goroutines runs and calls Done when finished. At the same\n  time, Wait can be used to block until all goroutines have finished.</p>\n  \n  <p>A WaitGroup must not be copied after first use.</p>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p><strong>A WaitGroup must not be copied after first use.</strong></p>\n</blockquote>\n"}], "owner": {"reputation": 1184, "user_id": 1269041, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0f4555652545040e404bd072400c810c?s=128&d=identicon&r=PG", "display_name": "konart", "link": "https://stackoverflow.com/users/1269041/konart"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1491, "favorite_count": 2, "accepted_answer_id": 49717651, "answer_count": 1, "score": 0, "last_activity_date": 1523193113, "creation_date": 1523188323, "question_id": 49717523, "link": "https://stackoverflow.com/questions/49717523/how-to-wait-for-goroutines-to-finish-and-read-the-channel-without-a-lock", "title": "How to wait for goroutines to finish and read the channel without a lock?", "body": "<p>I went through a number of examples and questions here on SO, but still can't get a rather simple code working as expected:</p>\n\n<pre><code>func main() {\n    ch := make(chan string)\n    var wg sync.WaitGroup\n    wg.Add(2)\n    go readFile(\"A\", ch, wg)\n    go readFile(\"B\", ch, wg)\n    go func() {\n        wg.Wait()\n        close(ch)\n    }()\n    printer(ch)\n}\n\nfunc readFile(name string, ch chan string, wg sync.WaitGroup) {\n    file, err := os.Open(name)\n    if err != nil {\n        fmt.Errorf(\"was not able to read from file %s: %s\", name, err)\n    }\n    scanner := bufio.NewScanner(file)\n    for scanner.Scan() {\n        ch &lt;- scanner.Text()\n    }\n    wg.Done()\n}\n\nfunc printer(ch chan string) {\n    for val := range ch {\n        fmt.Println(val)\n    }\n}\n</code></pre>\n\n<p>So I'm reading from two files, pushing read lines into a channel and then simply print them out (some code was simplified from unneeded detailes)</p>\n\n<p>Two goroutines, WaitGroup for both of them, reparate goroutine with Wait and close channel. </p>\n\n<p>From mine point of view this is pretty much identical to this question and the exepted answer: <a href=\"https://stackoverflow.com/questions/21819622/let-golang-close-used-channel-after-all-goroutines-finished#21819794\">Let golang close used channel after all goroutines finished</a></p>\n\n<p>So what's wrong in my case?</p>\n"}, {"tags": ["google-app-engine", "go", "deployment", "ubuntu-16.04", "gcloud"], "comments": [{"owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "edited": false, "score": 0, "creation_date": 1523394562, "post_id": 49717504, "comment_id": 86541329, "body": "Can you run the app locally with <code>dev_appserver.py</code> (from the directory with your app.yaml)? Can you post your app.yaml file?"}, {"owner": {"reputation": 401, "user_id": 3324751, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/654dbe483626fc572507566155c2a389?s=128&d=identicon&r=PG&f=1", "display_name": "hagh", "link": "https://stackoverflow.com/users/3324751/hagh"}, "reply_to_user": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "edited": false, "score": 0, "creation_date": 1523425245, "post_id": 49717504, "comment_id": 86549808, "body": "Thanks @TylerBui-Palsulich. Please see my edits above. Except for that warning I do not see anything wrong with dev_appserver.py."}], "answers": [{"comments": [{"owner": {"reputation": 401, "user_id": 3324751, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/654dbe483626fc572507566155c2a389?s=128&d=identicon&r=PG&f=1", "display_name": "hagh", "link": "https://stackoverflow.com/users/3324751/hagh"}, "edited": false, "score": 0, "creation_date": 1523503896, "post_id": 49775015, "comment_id": 86590104, "body": "Thanks a lot @Tyler. This worked. I guess I had this right for my first successful deployment, but then I might have forgotten to properly commit the changes. <code>dev_appserver.py</code> still generates that warning though, but it does not really matter as long as things are working."}, {"owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "reply_to_user": {"reputation": 401, "user_id": 3324751, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/654dbe483626fc572507566155c2a389?s=128&d=identicon&r=PG&f=1", "display_name": "hagh", "link": "https://stackoverflow.com/users/3324751/hagh"}, "edited": false, "score": 1, "creation_date": 1523558564, "post_id": 49775015, "comment_id": 86622159, "body": "I&#39;m glad it helped! Please consider accepting answers when they solve the issue, but no pressure. :)"}], "tags": [], "owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "is_accepted": true, "score": 2, "last_activity_date": 1523449288, "creation_date": 1523449288, "answer_id": 49775015, "question_id": 49717504, "link": "https://stackoverflow.com/questions/49717504/gcloud-deploy-app-cannot-find-import-packages-golang/49775015#49775015", "title": "gcloud deploy app cannot find import packages - golang", "body": "<p>Your Flex app.yaml file should not include</p>\n\n<pre><code>api_version: go1\n</code></pre>\n\n<p>You can delete the line entirely. It is only needed for App Engine Standard.</p>\n\n<p><a href=\"https://github.com/GoogleCloudPlatform/golang-samples/blob/master/getting-started/bookshelf/app/app.yaml\" rel=\"nofollow noreferrer\">Here</a> is an example App Engine Flexible app.yaml file. See <a href=\"https://cloud.google.com/appengine/docs/flexible/go/configuring-your-app-with-app-yaml\" rel=\"nofollow noreferrer\">the docs</a> for a reference of what you can configure in a Flex app.yaml file.</p>\n"}], "owner": {"reputation": 401, "user_id": 3324751, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/654dbe483626fc572507566155c2a389?s=128&d=identicon&r=PG&f=1", "display_name": "hagh", "link": "https://stackoverflow.com/users/3324751/hagh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1131, "favorite_count": 0, "accepted_answer_id": 49775015, "answer_count": 1, "score": 2, "last_activity_date": 1546941644, "creation_date": 1523188174, "last_edit_date": 1523427630, "question_id": 49717504, "link": "https://stackoverflow.com/questions/49717504/gcloud-deploy-app-cannot-find-import-packages-golang", "title": "gcloud deploy app cannot find import packages - golang", "body": "<p>I have already deployed a version of my app to GAE, but now I have trouble deploying a newer version.\nWhen I try <code>gcloud app deploy --version=VERSION</code>, I get a bunch of errors showing that remote build cannot find my import packages:</p>\n\n<pre><code>Beginning deployment of service [default]...\nBuilding and pushing image for service [default]\nSome files were skipped. Pass `--verbosity=info` to see which ones.\nYou may also view the gcloud log file, found at\n[/home/****/.config/gcloud/logs/2018.04.08/***.log].\nStarted cloud build [***].\nTo see logs in the Cloud Console: https://console.cloud.google.com/gcr/builds/****?project=**\n\n------------- REMOTE BUILD OUTPUT --------------------------------------------\n\nstarting build \"****\"\n\nFETCHSOURCE\nFetching storage object: gs://staging.****.appspot.com/us.gcr.io/****/appengine/default.20180408t040210:latest#****\nCopying gs://staging.****.appspot.com/us.gcr.io/****/appengine/default.***:latest#***...\n/ [1 files][  6.9 MiB/  6.9 MiB]                                                \nOperation completed over 1 objects/6.9 MiB.                                      \nBUILD\nStarting Step #0\nStep #0: Pulling image: gcr.io/gcp-runtimes/go1builder@sha256:****\nStep #0: sha256:***: Pulling from gcp-runtimes/go1-builder\nStep #0: Digest: sha256:***\nStep #0: Status: Downloaded newer image for gcr.io/gcp-runtimes/go1-builder@sha256:***\nStep #0: main.go:5:2: cannot find package \"config\" in any of:\nStep #0:    /usr/local/go/src/config (from $GOROOT)\nStep #0:    /workspace/_gopath/src/config (from $GOPATH)\nStep #0: main.go:6:2: cannot find package \"db\" in any of:\nStep #0:    /usr/local/go/src/db (from $GOROOT)\nStep #0:    /workspace/_gopath/src/db (from $GOPATH)\n...\nFinished Step #0\nERROR\nERROR: build step 0 \"gcr.io/gcp-runtimes/go1builder@sha256:***\" failed: exit status 1\n-------------------------------------------------------------------------------\n\nERROR: (gcloud.app.deploy) Cloud build failed. Check logs at https://console.cloud.google.com/gcr/builds/***?project=*** Failure status: UNKNOWN: Error Response: [2] Build failed; check build logs for details\n</code></pre>\n\n<p>I have tried several suggestions wrt proper setting of the GOPATH, including running command as root, sudo -E, and setting a system-wide GOPATH, no luck so far. I get the same set of errors no matter if I deploy in Cloud Shell or run the command in my local setup. If I set a wrong GOPATH build fails before getting to the remote build stage. I have not changed the source code structure from the first deployment either.</p>\n\n<p>I have spent lot's of time on this, and appreciate any help or advice.\nThanks.</p>\n\n<p><strong>EDIT:</strong>\nHere is my app.yaml</p>\n\n<pre><code>runtime: go\nenv: flex\napi_version: go1\n\nenv_variables:\n   APP_DATABASE_CONFIG: \"{...}\"\n   APP_CONFIG: \"{...}\"\n</code></pre>\n\n<p>Also running <code>dev_appserver.py app.yaml</code> I get the following output:\ndev_appserver.py app.yaml </p>\n\n<pre><code>INFO     2018-04-11 05:20:51,040 application_configuration.py:506] No version specified. Generated version id: 20180411t052051\nWARNING  2018-04-11 05:20:51,040 application_configuration.py:163] The Managed VMs runtime is deprecated, please consider migrating your application to use the Flexible runtime. See https://cloud.google.com/appengine/docs/flexible/python/migrating for more details.\nINFO     2018-04-11 05:20:51,040 devappserver2.py:105] Skipping SDK update check.\nINFO     2018-04-11 05:20:51,102 api_server.py:265] Starting API server at: http://localhost:46211\nINFO     2018-04-11 05:21:16,233 dispatcher.py:255] Starting module \"default\" running at: http://localhost:8080\nINFO     2018-04-11 05:21:16,234 admin_server.py:152] Starting admin server at: http://localhost:8000\n...\n</code></pre>\n\n<p>It generally works fine except for that warning at the beginning. I don't know why it gives that warning despite my app.yaml configuration, but if it helps the first instance I deployed was a standard project (the Google demo project), and I deleted that instance later.</p>\n\n<p>I am wondering where those GOROOT (/usr/local/go/) and GOPATH (/workspace/_gopath/) on the remote side come from? Are those the default settings? Also if it helps, those db and config packages shown in error messages are mine, and they are under project-root/src.</p>\n\n<p>app.yaml is under project-root/src/web. My GOPATH is set to project-root. My GOROOT is empty.</p>\n"}, {"tags": ["go", "discord"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1523230610, "post_id": 49717232, "comment_id": 86461422, "body": "I think this is a bit confusing, maybe it&#39;s just me.  It seems like you already know how to the get the ChannelID from the Message object. <code>Message.ChannelID</code>"}, {"owner": {"reputation": 4217, "user_id": 9614249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eJfci.png?s=128&g=1", "display_name": "Increasingly Idiotic", "link": "https://stackoverflow.com/users/9614249/increasingly-idiotic"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1523306978, "post_id": 49717232, "comment_id": 86497508, "body": "<code>Message.ChannelID</code> is the public channel the message was sent on. I would like to reply to the private channel of the user who sent the message."}], "answers": [{"tags": [], "owner": {"reputation": 245, "user_id": 1496317, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8aaed7a968f12467148e2a8a8c4ac2c0?s=128&d=identicon&r=PG", "display_name": "tsdtsdtsd", "link": "https://stackoverflow.com/users/1496317/tsdtsdtsd"}, "is_accepted": true, "score": 6, "last_activity_date": 1523268470, "creation_date": 1523268470, "answer_id": 49730422, "question_id": 49717232, "link": "https://stackoverflow.com/questions/49717232/send-private-message-with-discordgo/49730422#49730422", "title": "Send private message with discordgo", "body": "<p>The session struct has a method <code>UserChannelCreate(recipientID string)</code>, which returns the DM channel for given userID. Don't mind the 'Create', if a DM channel already exists, it will be reused.</p>\n"}], "owner": {"reputation": 4217, "user_id": 9614249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eJfci.png?s=128&g=1", "display_name": "Increasingly Idiotic", "link": "https://stackoverflow.com/users/9614249/increasingly-idiotic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2175, "favorite_count": 0, "accepted_answer_id": 49730422, "answer_count": 1, "score": 8, "last_activity_date": 1523268470, "creation_date": 1523186071, "question_id": 49717232, "link": "https://stackoverflow.com/questions/49717232/send-private-message-with-discordgo", "title": "Send private message with discordgo", "body": "<p>I would like to have a discord bot reply to a message made in a public channel via a private message. </p>\n\n<p>I am able to detect whether a channel is private or not using the following code from the <a href=\"https://github.com/bwmarrin/discordgo/wiki/FAQ#checking-if-a-message-is-from-a-private-channel\" rel=\"noreferrer\">FAQ</a>:</p>\n\n<pre><code>func isTheChannelTheMessageWasSentInPrivate(s *discordgo.Session, m *discordgo.MessageCreate) {\n    channel, err := s.State.Channel(m.ChannelID)\n    if err != nil {\n        astilog.Fatal(err)\n        return\n    } else if m.Author.ID == s.State.User.ID {\n        return\n    }\n    channelIsPrivate := strconv.FormatBool(channel.IsPrivate)\n    print(\"Channel ID: \" + m.ChannelID + \". Is it private? \" + channelIsPrivate + \"\\n\")\n}\n</code></pre>\n\n<p>And I can reply to a message on the same channel it was received using this code:</p>\n\n<pre><code>func recieveMessage(s *discordgo.Session, m *discordgo.MessageCreate) {\n    s.ChannelMessageSend(m.ChannelID, \"Reply!\")\n}\n</code></pre>\n\n<p>But I can't figure our how to get the <code>ChannelID</code> of a user's direct message channel from the <a href=\"https://godoc.org/github.com/bwmarrin/discordgo#Message\" rel=\"noreferrer\"><code>Message</code></a> object that is available upon receiving a message.</p>\n"}, {"tags": ["go", "typedef"], "answers": [{"tags": [], "owner": {"reputation": 108, "user_id": 5356496, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9eiku.jpg?s=128&g=1", "display_name": "goofle", "link": "https://stackoverflow.com/users/5356496/goofle"}, "is_accepted": false, "score": 1, "last_activity_date": 1523178164, "creation_date": 1523178164, "answer_id": 49716212, "question_id": 49716191, "link": "https://stackoverflow.com/questions/49716191/use-string-defined-type-value-as-string/49716212#49716212", "title": "Use string defined type value as string", "body": "<p>In this case you can use <code>return \"Hello \" + string(user) + \"!\"</code></p>\n"}, {"tags": [], "owner": {"reputation": 303, "user_id": 8008395, "user_type": "registered", "profile_image": "https://graph.facebook.com/1019408758194319/picture?type=large", "display_name": "Bohdan Kostko", "link": "https://stackoverflow.com/users/8008395/bohdan-kostko"}, "is_accepted": false, "score": 0, "last_activity_date": 1523256234, "last_edit_date": 1523256234, "creation_date": 1523178872, "answer_id": 49716310, "question_id": 49716191, "link": "https://stackoverflow.com/questions/49716191/use-string-defined-type-value-as-string/49716310#49716310", "title": "Use string defined type value as string", "body": "<p>You could use <a href=\"https://golang.org/pkg/fmt/#Sprintf\" rel=\"nofollow noreferrer\"><code>fmt.Sprintf</code></a> without any additional conversion of your argument or concatenation of your parts of strings:</p>\n\n<pre><code>func SayHello(u User) string {\n    return fmt.Sprintf(\"Hello %s!\", u)\n}\n</code></pre>\n\n<p>Even if you change your type from <code>string</code> to <code>struct</code> you still would be able to use <code>SayHello</code> if you'll implement method <code>func (u *User) String() string</code>. However such approach would also work for regular <code>string</code> conversion provided by <code>goofle</code>.</p>\n\n<p>Try it at <a href=\"https://play.golang.org/p/XnxeOucPZdE\" rel=\"nofollow noreferrer\">https://play.golang.org/p/XnxeOucPZdE</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 4217, "user_id": 9614249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eJfci.png?s=128&g=1", "display_name": "Increasingly Idiotic", "link": "https://stackoverflow.com/users/9614249/increasingly-idiotic"}, "edited": false, "score": 1, "creation_date": 1523185810, "post_id": 49716329, "comment_id": 86447395, "body": "@IncreasinglyIdiotic Always refer to golang specs if you find anything confusing."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 1, "last_activity_date": 1523180075, "last_edit_date": 1523180075, "creation_date": 1523179014, "answer_id": 49716329, "question_id": 49716191, "link": "https://stackoverflow.com/questions/49716191/use-string-defined-type-value-as-string/49716329#49716329", "title": "Use string defined type value as string", "body": "<p>From <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">Golang Spec</a></p>\n\n<blockquote>\n  <p>A value x is assignable to a variable of type T (\"x is assignable to\n  T\") if:</p>\n  \n  <ul>\n  <li>x's type is identical to T.</li>\n  <li>x's type V and T have identical underlying types and at least one of    V or T is not a defined type.</li>\n  </ul>\n</blockquote>\n\n<p>Variables of named type <code>type User string</code> and unnamed type <code>var user string</code> are absolutely different.\nWe can check that using reflection for showing the underlying type.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    )\n\ntype User string\n\nfunc main() {\n    var name User = \"User\"\n    var name2 string = \"User\"\n    //fmt.Print(name==name2) // mismatched types User and string\n    fmt.Println(reflect.TypeOf(name2))\n    fmt.Println(reflect.TypeOf(name))\n}\n</code></pre>\n\n<p>So check the underlying type of a variable and then type cast the type to primitive one to compare the value.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype User string\n\nfunc main() {\n    var u User\n    fmt.Print(SayHello(u))\n}\n\nfunc SayHello(u User) string {\n    change := string(u)\n    return \"Hello \" + change + \"!\"\n}\n</code></pre>\n\n<p>Check on \n<a href=\"https://play.golang.org/p/aK96uyxcvK0\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 2, "last_activity_date": 1523184396, "creation_date": 1523184396, "answer_id": 49717052, "question_id": 49716191, "link": "https://stackoverflow.com/questions/49716191/use-string-defined-type-value-as-string/49717052#49717052", "title": "Use string defined type value as string", "body": "<p><a href=\"https://golang.org/ref/spec#Type_identity\" rel=\"nofollow noreferrer\">Go does not have typedefs</a>. </p>\n\n<blockquote>\n  <p>Two types are either identical or different.</p>\n  \n  <p>A defined type is always different from any other type.</p>\n</blockquote>\n\n<p>User is a defined type and consequently different from type string.</p>\n\n<p>Since the underlying type of User is string, you can simply <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">convert from one type to the other</a>:</p>\n\n<pre><code>\"Hello \" + string(user) + \"!\"\n</code></pre>\n"}], "owner": {"reputation": 4217, "user_id": 9614249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eJfci.png?s=128&g=1", "display_name": "Increasingly Idiotic", "link": "https://stackoverflow.com/users/9614249/increasingly-idiotic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 345, "favorite_count": 0, "accepted_answer_id": 49716329, "answer_count": 4, "score": 2, "last_activity_date": 1533837473, "creation_date": 1523177986, "last_edit_date": 1533837473, "question_id": 49716191, "link": "https://stackoverflow.com/questions/49716191/use-string-defined-type-value-as-string", "title": "Use string defined type value as string", "body": "<p>I have a defined named type</p>\n\n<pre><code>type User string\n</code></pre>\n\n<p>and now I want to use a <code>User</code> value as an actual string like so</p>\n\n<pre><code>func SayHello(u User) string {\n    return \"Hello \" + user + \"!\"\n}\n</code></pre>\n\n<p>But I receive an error: </p>\n\n<blockquote>\n  <p>cannot use \"Hello \" + user + \"!\" (type User) as type string in return argument</p>\n</blockquote>\n\n<p>How do I use a named type as its underlying type?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523172525, "post_id": 49715499, "comment_id": 86444004, "body": "Please post the <code>Bread</code> map structure. It is not clear what is <code>b.ingredients</code>"}, {"owner": {"reputation": 157, "user_id": 9063101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh3.googleusercontent.com/-7wU7yyw74JQ/AAAAAAAAAAI/AAAAAAAAABE/JD5vjEZjb2A/photo.jpg?sz=128", "display_name": "YuanZheng Hu", "link": "https://stackoverflow.com/users/9063101/yuanzheng-hu"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523173537, "post_id": 49715499, "comment_id": 86444266, "body": "@Himanshu I&#39;ve posted it, thanks for noticing"}, {"owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 0, "creation_date": 1523173575, "post_id": 49715499, "comment_id": 86444279, "body": "@YuanZhengHu Please also post how you&#39;re initializing <code>Bread</code> (and it&#39;s <code>ingredients</code> field specifically)."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1523174333, "post_id": 49715499, "comment_id": 86444438, "body": "insufficient details"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523174412, "post_id": 49715499, "comment_id": 86444456, "body": "What is left you are using and also on which line you are getting here mention the comment in code where you are getting error"}], "answers": [{"comments": [{"owner": {"reputation": 157, "user_id": 9063101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh3.googleusercontent.com/-7wU7yyw74JQ/AAAAAAAAAAI/AAAAAAAAABE/JD5vjEZjb2A/photo.jpg?sz=128", "display_name": "YuanZheng Hu", "link": "https://stackoverflow.com/users/9063101/yuanzheng-hu"}, "edited": false, "score": 0, "creation_date": 1523175957, "post_id": 49715789, "comment_id": 86444826, "body": "Thanks! Is there any differnce between initialize the map with make and assinging the map variable with &quot;:=&quot; ? I&#39;m new to Go"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 157, "user_id": 9063101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh3.googleusercontent.com/-7wU7yyw74JQ/AAAAAAAAAAI/AAAAAAAAABE/JD5vjEZjb2A/photo.jpg?sz=128", "display_name": "YuanZheng Hu", "link": "https://stackoverflow.com/users/9063101/yuanzheng-hu"}, "edited": false, "score": 1, "creation_date": 1523180176, "post_id": 49715789, "comment_id": 86445914, "body": "@YuanZhengHu, I strongly suggest you take <a href=\"https://tour.golang.org/\" rel=\"nofollow noreferrer\">the Tour</a>. This is covered in &quot;Short variable declarations&quot;."}, {"owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "reply_to_user": {"reputation": 157, "user_id": 9063101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh3.googleusercontent.com/-7wU7yyw74JQ/AAAAAAAAAAI/AAAAAAAAABE/JD5vjEZjb2A/photo.jpg?sz=128", "display_name": "YuanZheng Hu", "link": "https://stackoverflow.com/users/9063101/yuanzheng-hu"}, "edited": false, "score": 0, "creation_date": 1523205239, "post_id": 49715789, "comment_id": 86453286, "body": "@YuanZhengHu Please note you should use <code>=</code> instead of <code>:=</code> here. Taking the tour like Peter suggests will tell you why :)"}], "tags": [], "owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "is_accepted": false, "score": 1, "last_activity_date": 1523174898, "creation_date": 1523174898, "answer_id": 49715789, "question_id": 49715499, "link": "https://stackoverflow.com/questions/49715499/assignment-to-entry-in-nil-map-initialization-map-doesn/49715789#49715789", "title": "assignment to entry in nil map , initialization map doesn", "body": "<p>You are using named return values in your <code>ShoppingList</code> function, so <code>difference</code> and <code>left</code> are <em>declared</em>: they are set to the types' zero-values. For maps, this is <code>nil</code> (<a href=\"http://You&#39;re%20using%20named%20return%20values,%20so%20%60difference%60%20and%20%60left%60%20are%20*declared*\" rel=\"nofollow noreferrer\">see spec</a>) - naturally, appending an item to a <code>nil</code> map results in a panic.</p>\n\n<p>So, before appending any items to them, do the following to assign them a value:</p>\n\n<pre><code>difference = make(map[string]Item)\nleft = make(map[string]Item)\n</code></pre>\n"}], "owner": {"reputation": 157, "user_id": 9063101, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh3.googleusercontent.com/-7wU7yyw74JQ/AAAAAAAAAAI/AAAAAAAAABE/JD5vjEZjb2A/photo.jpg?sz=128", "display_name": "YuanZheng Hu", "link": "https://stackoverflow.com/users/9063101/yuanzheng-hu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 680, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1523174898, "creation_date": 1523172388, "last_edit_date": 1523174465, "question_id": 49715499, "link": "https://stackoverflow.com/questions/49715499/assignment-to-entry-in-nil-map-initialization-map-doesn", "title": "assignment to entry in nil map , initialization map doesn", "body": "<p>The code below gives me \"assignement to entry in nil map\" error, I searched this error, and many answer says I need to initialize my map, I tried to initialize the map need as \"need := make(map[string]Item)\" it still gives me the same error,\nb.ingredients returns a type of map[string]Item, what is my mistake here ?</p>\n\n<pre><code>func (b *Bread) ShoppingList(have map[string]Item) (difference map[string]Item, left map[string]Item) {\n\n    need := b.ingredients\n\n    for k, v := range need {\n        flag := false\n        for key, value := range have {\n            if key == k {\n                flag = true\n                if value.weight &gt; v.weight {\n                    left[key] = Item{value.weight - v.weight}\n                } else {\n                    difference[key] = Item{v.weight - value.weight}\n                    left[key] = Item{0}\n                }\n                break\n            }\n        }\n        if !flag {\n            need[k] = v\n        }\n    }\n\n    return\n}\n\ntype Bread struct {\n    name        string\n    ingredients map[string]Item\n    weight      float32\n    Baking\n}\n\ntype Item struct {\n    weight int\n}\nfunc main() {\nhave := map[string]Item{\"Whole wheat flour\": Item{5000}, \"sugar\": Item{1000}, \"salt\": {500}}\n\ntmp := map[string]Item{\"white flour\": Item{200}, \"sesame\": Item{50}}\ntmp2 := map[string]Item{\"Whole wheat flour\": Item{250}}\nslices := [...]Baker{NewBread(), NewBreadVariation(\"Sesame bread\", tmp, tmp2)}\nslices[0].PrintBreadInfo()\nslices[1].PrintBreadInfo()\ndifference, left := slices[0].ShoppingList(have)\n//differencce1, _ := slices[1].ShoppingList(left)\n\nfmt.Print(difference)\nfmt.Print(left)\nfmt.Print(have)\n//fmt.Print(differencce1)\n}\n\n\ntype Baker interface {\nShoppingList(map[string]Item) (map[string]Item, map[string]Item)\nPrintBakeInstructions()\nPrintBreadInfo()\n}\n\nfunc NewBread() (brd *Bread) {\n\ning := map[string]Item{\"Whole wheat flour\": Item{500}, \"yeast\": Item{25}, \"salt\": Item{25},\n    \"sugar\": Item{50}, \"butter\": Item{50}, \"water\": Item{350}}\nbk := Baking{120, 60, 180}\nbrd = &amp;Bread{\"Whole wheat\", ing, 1.000, bk}\nreturn\n}\n\nfunc NewBreadVariation(name string, add map[string]Item, removed map[string]Item) (brd *Bread) {\nvar weight float32\nbk := Baking{120, 60, 180}\norigin := map[string]Item{\"Whole wheat flour\": Item{500}, \"yeast\": Item{25}, \"salt\": Item{25},\n    \"sugar\": Item{50}, \"butter\": Item{50}, \"water\": Item{350}}\n\nif add != nil {\n    for k, v := range add {\n        flag := false\n        for key, value := range origin {\n\n            if key == k {\n                flag = true\n                origin[key] = Item{v.weight + value.weight}\n                break\n            }\n\n        }\n\n        if !flag {\n            origin[k] = v\n        }\n\n    }\n}\nif removed != nil {\n    for k, v := range removed {\n        flag2 := false\n        for key, value := range origin {\n            if k == key {\n                flag2 = true\n                origin[key] = Item{value.weight - v.weight}\n                break\n            }\n        }\n\n        if !flag2 {\n            fmt.Print(\"something wrong\")\n        }\n\n    }\n}\n\nfor _, v := range origin {\n    tmp := v.weight\n    tmp2 := float32(tmp)\n    weight += tmp2\n}\nweight2 := weight / 1000\n\nreturn &amp;Bread{name, origin, weight2, bk}\n}\n</code></pre>\n"}, {"tags": ["go", "discord"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523180511, "post_id": 49715470, "comment_id": 86446019, "body": "There are two methods called GuildChannels and UserChannels. Have you tried those?"}, {"owner": {"reputation": 4217, "user_id": 9614249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eJfci.png?s=128&g=1", "display_name": "Increasingly Idiotic", "link": "https://stackoverflow.com/users/9614249/increasingly-idiotic"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523185440, "post_id": 49715470, "comment_id": 86447308, "body": "GuildChannels requires guildID and UserChannels returns empty list"}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523189770, "post_id": 49715470, "comment_id": 86448391, "body": "here the python api <a href=\"https://stackoverflow.com/questions/49446882/how-to-get-all-text-channels-using-discord-py\" title=\"how to get all text channels using discord py\">stackoverflow.com/questions/49446882/&hellip;</a> but I couldn&#39;t find anything similar in discordgo"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 2, "creation_date": 1523230696, "post_id": 49715470, "comment_id": 86461445, "body": "@IncreasinglyIdiotic <code>UserChannels returns an array of Channel structures for all private channels.</code> Are your channels private?"}, {"owner": {"reputation": 4217, "user_id": 9614249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eJfci.png?s=128&g=1", "display_name": "Increasingly Idiotic", "link": "https://stackoverflow.com/users/9614249/increasingly-idiotic"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1523376616, "post_id": 49715470, "comment_id": 86531606, "body": "@reticentroot Sadly they are not. I tried using that method but it returns an empty list."}], "answers": [{"tags": [], "owner": {"reputation": 65, "user_id": 2845609, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a5975e26f593bdfb26cec2734590456?s=128&d=identicon&r=PG&f=1", "display_name": "haraldfw", "link": "https://stackoverflow.com/users/2845609/haraldfw"}, "is_accepted": true, "score": 1, "last_activity_date": 1533714821, "creation_date": 1533714821, "answer_id": 51741363, "question_id": 49715470, "link": "https://stackoverflow.com/questions/49715470/how-to-get-list-of-all-channels-using-discordgo/51741363#51741363", "title": "How to get list of all channels using discordgo?", "body": "<p>Don't know if this is still relevant to you, but leaving this here for anyone else wondering.</p>\n\n<p>All you need is access to the <code>discordgo.Session</code> object, <code>dg</code> will in your case work just the same.</p>\n\n<p>It is possible, but you have to loop through each <em>Guild</em> (server) the bot has access to. Alternatively, if you have the relevant guild ID or object you can loop through the channels of only that guild.</p>\n\n<pre><code>func spam(s *discordgo.Session) {\n    // Loop through each guild in the session\n    for _, guild := range s.State.Guilds {\n\n        // Get channels for this guild\n        channels, _ := s.GuildChannels(guild.ID)\n\n        for _, c := range channels {\n            // Check if channel is a guild text channel and not a voice or DM channel\n            if c.Type != discordgo.ChannelTypeGuildText {\n                continue\n            }\n\n            // Send text message\n            s.ChannelMessageSend(\n                c.ID,\n                fmt.Sprintf(\"testmsg (sorry for spam). Channel name is %q\", c.Name),\n            )\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 4217, "user_id": 9614249, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eJfci.png?s=128&g=1", "display_name": "Increasingly Idiotic", "link": "https://stackoverflow.com/users/9614249/increasingly-idiotic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2742, "favorite_count": 0, "accepted_answer_id": 51741363, "answer_count": 1, "score": 6, "last_activity_date": 1533714821, "creation_date": 1523172093, "last_edit_date": 1523185512, "question_id": 49715470, "link": "https://stackoverflow.com/questions/49715470/how-to-get-list-of-all-channels-using-discordgo", "title": "How to get list of all channels using discordgo?", "body": "<p>I would like to send a message on all text channels of my private discord server using a bot.</p>\n\n<p>I have connected and can have a <a href=\"https://godoc.org/github.com/bwmarrin/discordgo#Session\" rel=\"noreferrer\"><code>Session</code></a> object but I'm not sure how to get a list of all available channels from the <a href=\"https://godoc.org/github.com/bwmarrin/discordgo#Session\" rel=\"noreferrer\"><code>Session</code></a>.</p>\n\n<pre><code>dg, err := discordgo.New(\"Bot \" + Token)\nif err != nil {\n    fmt.Println(\"error creating Discord session,\", err)\n    return\n}\n\n// Open a websocket connection to Discord and begin listening.\nerr = dg.Open()\nif err != nil {\n    fmt.Println(\"error opening connection,\", err)\n    return\n}\n\n// Get all channel ID's from dg here\n</code></pre>\n\n<p>Is this even possible with the discord API?</p>\n"}, {"tags": ["math", "go", "triggers", "mouse", "game-physics"], "comments": [{"owner": {"reputation": 161, "user_id": 554175, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/777819e50ff91652501cbf3200b44aad?s=128&d=identicon&r=PG", "display_name": "Ron", "link": "https://stackoverflow.com/users/554175/ron"}, "edited": false, "score": 0, "creation_date": 1523404678, "post_id": 49714827, "comment_id": 86544436, "body": "Any way you can push this to a repo so I can log some things on order to debug and test?"}, {"owner": {"reputation": 647, "user_id": 4086020, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/51666e33b30fa4041da075151209a271?s=128&d=identicon&r=PG&f=1", "display_name": "HKVariant", "link": "https://stackoverflow.com/users/4086020/hkvariant"}, "reply_to_user": {"reputation": 161, "user_id": 554175, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/777819e50ff91652501cbf3200b44aad?s=128&d=identicon&r=PG", "display_name": "Ron", "link": "https://stackoverflow.com/users/554175/ron"}, "edited": false, "score": 0, "creation_date": 1523415957, "post_id": 49714827, "comment_id": 86547173, "body": "@Ron Yeah gimme a minute. It uses Go obviously, and the library <a href=\"https://github.com/faiface/pixel\" rel=\"nofollow noreferrer\">github.com/faiface/pixel</a> -- just go get that"}, {"owner": {"reputation": 647, "user_id": 4086020, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/51666e33b30fa4041da075151209a271?s=128&d=identicon&r=PG&f=1", "display_name": "HKVariant", "link": "https://stackoverflow.com/users/4086020/hkvariant"}, "reply_to_user": {"reputation": 161, "user_id": 554175, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/777819e50ff91652501cbf3200b44aad?s=128&d=identicon&r=PG", "display_name": "Ron", "link": "https://stackoverflow.com/users/554175/ron"}, "edited": false, "score": 1, "creation_date": 1523416180, "post_id": 49714827, "comment_id": 86547211, "body": "@Ron added to the main post"}, {"owner": {"reputation": 161, "user_id": 554175, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/777819e50ff91652501cbf3200b44aad?s=128&d=identicon&r=PG", "display_name": "Ron", "link": "https://stackoverflow.com/users/554175/ron"}, "edited": false, "score": 0, "creation_date": 1523569259, "post_id": 49714827, "comment_id": 86627400, "body": "Thanks, I know someone already answered it but I\u2019m going to download this and check it out anyway.  I haven\u2019t used any visual libraries with go before and want to mess around with it."}], "answers": [{"tags": [], "owner": {"reputation": 5308, "user_id": 4038191, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10ec10e81b5315fe2147c38bf3e15e9e?s=128&d=identicon&r=PG", "display_name": "EvilTak", "link": "https://stackoverflow.com/users/4038191/eviltak"}, "is_accepted": false, "score": 2, "last_activity_date": 1523432679, "last_edit_date": 1523432679, "creation_date": 1523425134, "answer_id": 49767288, "question_id": 49714827, "link": "https://stackoverflow.com/questions/49714827/turn-rate-on-a-players-rotation-doing-a-360-once-it-hits-pi/49767288#49767288", "title": "Turn rate on a player&#39;s rotation doing a 360 once it hits pi", "body": "<p>Preface: this answer assumes some knowledge of linear algebra, trigonometry, and rotations/transformations.</p>\n\n<p>Your problem stems from the usage of rotation angles. Due to the discontinuous nature of the inverse trigonometric functions, it is quite difficult (if not outright impossible) to eliminate \"jumps\" in the value of the functions for relatively close inputs. Specifically, when <code>x &lt; 0</code>, <code>atan2(+0, x) = +pi</code> (where <code>+0</code> is a positive number very close to zero), but <code>atan2(-0, x) = -pi</code>. This is exactly why you experience the difference of <code>2 * pi</code> which causes your problem.</p>\n\n<p>Because of this, it is often better to work directly with vectors, rotation matrices and/or quaternions. They use angles as arguments to trigonometric functions, which are continuous and eliminate any discontinuities. In our case, <a href=\"https://en.wikipedia.org/wiki/Slerp\" rel=\"nofollow noreferrer\">spherical linear interpolation (slerp)</a> should do the trick.</p>\n\n<p>Since your code measures the angle formed by the relative position of the mouse to the absolute rotation of the object, our goal boils down to rotating the object such that the <em>local</em> axis <code>(1, 0)</code> (<code>= (cos rotateRad, sin rotateRad)</code> in <em>world</em> space) points towards the mouse. In effect, we have to rotate the object such that <code>(cos p.rotateRad, sin p.rotateRad)</code> equals <code>(win.MousePosition().Y - p.pos.Y, win.MousePosition().X - p.pos.X).normalized</code>.</p>\n\n<p>How does slerp come into play here? Considering the above statement, we simply have to <a href=\"https://en.wikipedia.org/wiki/Slerp#Geometric_Slerp\" rel=\"nofollow noreferrer\">slerp geometrically</a> from <code>(cos p.rotateRad, sin p.rotateRad)</code> (represented by <code>current</code>) to <code>(win.MousePosition().Y - p.pos.Y, win.MousePosition().X - p.pos.X).normalized</code> (represented by <code>target</code>) by an appropriate parameter which will be determined by the rotation speed.</p>\n\n<p>Now that we have laid out the groundwork, we can move on to actually calculating the new rotation. According to the slerp formula,</p>\n\n<pre><code>slerp(p0, p1; t) = p0 * sin(A * (1-t)) / sin A + p1 * sin (A * t) / sin A\n</code></pre>\n\n<p>Where <code>A</code> is the angle between unit vectors <code>p0</code> and <code>p1</code>, or <code>cos A = dot(p0, p1)</code>.</p>\n\n<p>In our case, <code>p0 == current</code> and <code>p1 == target</code>. The only thing that remains is the calculation of the parameter <code>t</code>, which can also be considered as the fraction of the angle to slerp through. Since we know that we are going to rotate by an angle <code>p.turnSpeed * dt</code> at every time step, <code>t = p.turnSpeed * dt / A</code>. After substituting the value of <code>t</code>, our slerp formula becomes</p>\n\n<pre><code>p0 * sin(A - p.turnSpeed * dt) / sin A + p1 * sin (p.turnSpeed * dt) / sin A\n</code></pre>\n\n<p>To avoid having to calculate <code>A</code> using <code>acos</code>, we can use the compound angle formula for <code>sin</code> to simplify this further. Note that the result of the slerp operation is stored in <code>result</code>.</p>\n\n<pre><code>result = p0 * (cos(p.turnSpeed * dt) - sin(p.turnSpeed * dt) * cos A / sin A) + p1 * sin(p.turnSpeed * dt) / sin A\n</code></pre>\n\n<p>We now have everything we need to calculate <code>result</code>. As noted before, <code>cos A = dot(p0, p1)</code>. Similarly, <code>sin A = abs(cross(p0, p1))</code>, where <code>cross(a, b) = a.X * b.Y - a.Y * b.X</code>.</p>\n\n<p>Now comes the problem of actually finding the rotation from <code>result</code>. Note that <code>result = (cos newRotation, sin newRotation)</code>. There are two possibilities:</p>\n\n<ol>\n<li>Directly calculate <code>rotateRad</code> by <code>p.rotateRad = atan2(result.Y, result.X)</code>, or</li>\n<li><p>If you have access to the 2D rotation matrix, simply replace the rotation matrix with the matrix </p>\n\n<pre><code>|result.X -result.Y|\n|result.Y  result.X|\n</code></pre></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 647, "user_id": 4086020, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/51666e33b30fa4041da075151209a271?s=128&d=identicon&r=PG&f=1", "display_name": "HKVariant", "link": "https://stackoverflow.com/users/4086020/hkvariant"}, "edited": false, "score": 0, "creation_date": 1523478040, "post_id": 49774205, "comment_id": 86583066, "body": "Thanks for this, since I am only going to be using a &quot;small&quot; angle for now this answer is perfect. Great explanation too, it works perfect!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 647, "user_id": 4086020, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/51666e33b30fa4041da075151209a271?s=128&d=identicon&r=PG&f=1", "display_name": "HKVariant", "link": "https://stackoverflow.com/users/4086020/hkvariant"}, "edited": false, "score": 0, "creation_date": 1523478772, "post_id": 49774205, "comment_id": 86583450, "body": "@HKVariant Don&#39;t misunderstand, my solution works on all angles (not just for &quot;small&quot; ones), and you probably wouldn&#39;t even notice the performance difference. I&#39;m just saying for &quot;big&quot; angles the normalization could be more efficient. For details, see <a href=\"https://stackoverflow.com/questions/24234609/standard-way-to-normalize-an-angle-to-%CF%80-radians-in-java\">this</a> or <a href=\"https://stackoverflow.com/questions/2320986/easy-way-to-keeping-angles-between-179-and-180-degrees\">this</a>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1523470850, "last_edit_date": 1523470850, "creation_date": 1523446864, "answer_id": 49774205, "question_id": 49714827, "link": "https://stackoverflow.com/questions/49714827/turn-rate-on-a-players-rotation-doing-a-360-once-it-hits-pi/49774205#49774205", "title": "Turn rate on a player&#39;s rotation doing a 360 once it hits pi", "body": "<p><strong>Note beforehand:</strong> I downloaded your example repo and applied my change on it, and it worked flawlessly. Here's a recording of it:</p>\n\n<p><a href=\"https://i.stack.imgur.com/tV9Wc.gif\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/tV9Wc.gif\" alt=\"fixed cursor following\"></a></p>\n\n<p><sup>(for reference, GIF recorded with <code>byzanz</code>)</sup></p>\n\n<hr>\n\n<p>An easy and simple solution would be to <em>not compare the angles</em> (<code>mouseRad</code> and the changed <code>p.rotateRad</code>), but rather <strong>calculate and \"normalize\" the difference</strong> so it's in the range of <code>-Pi..Pi</code>. And then you can decide which way to turn <strong>based on the sign</strong> of the difference (negative  or positive).</p>\n\n<p>\"Normalizing\" an angle can be achieved by adding / subtracting <code>2*Pi</code> until it falls in the <code>-Pi..Pi</code> range. Adding / subtracting <code>2*Pi</code> won't change the angle, as <code>2*Pi</code> is exactly a full circle.</p>\n\n<p>This is a simple normalizer function:</p>\n\n<pre><code>func normalize(x float64) float64 {\n    for ; x &lt; -math.Pi; x += 2 * math.Pi {\n    }\n    for ; x &gt; math.Pi; x -= 2 * math.Pi {\n    }\n    return x\n}\n</code></pre>\n\n<p>And use it in your <code>handleTurn()</code> like this:</p>\n\n<pre><code>func (p *player) handleTurn(win pixelglWindow, dt float64) {\n    // the angle the player needs to turn to face the mouse:\n    mouseRad := math.Atan2(p.pos.Y-win.MousePosition().Y,\n        win.MousePosition().X-p.pos.X)\n\n    if normalize(mouseRad-p.rotateRad-(p.turnSpeed*dt)) &gt; 0 {\n        p.rotateRad += p.turnSpeed * dt\n    } else if normalize(mouseRad-p.rotateRad+(p.turnSpeed*dt)) &lt; 0 {\n        p.rotateRad -= p.turnSpeed * dt\n    }\n}\n</code></pre>\n\n<p>You can play with it in this working <a href=\"https://play.golang.org/p/8Z97xPN04Ij\" rel=\"noreferrer\">Go Playground</a> demo.</p>\n\n<p>Note that if you store your angles normalized (being in the range <code>-Pi..Pi</code>), the loops in the <code>normalize()</code> function will have at most 1 iteration, so that's gonna be really fast. Obviously you don't want to store angles like <code>100*Pi + 0.1</code> as that is identical to <code>0.1</code>. <code>normalize()</code> would produce correct result with both of these input angles, while the loops in case of the former would have 50 iterations, in the case of the latter would have 0 iterations.</p>\n\n<p>Also note that <code>normalize()</code> could be optimized for \"big\" angles by using floating operations analogue to integer division and remainder, but if you stick to normalized or \"small\" angles, this version is actually faster.</p>\n"}], "owner": {"reputation": 647, "user_id": 4086020, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/51666e33b30fa4041da075151209a271?s=128&d=identicon&r=PG&f=1", "display_name": "HKVariant", "link": "https://stackoverflow.com/users/4086020/hkvariant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 305, "favorite_count": 4, "accepted_answer_id": 49774205, "answer_count": 2, "score": 15, "last_activity_date": 1523470850, "creation_date": 1523166312, "last_edit_date": 1523416206, "question_id": 49714827, "link": "https://stackoverflow.com/questions/49714827/turn-rate-on-a-players-rotation-doing-a-360-once-it-hits-pi", "title": "Turn rate on a player&#39;s rotation doing a 360 once it hits pi", "body": "<p>Making a game using Golang since it seems to work quite well for games. I made the player face the mouse always, but wanted a turn rate to make certain characters turn slower than others. Here is how it calculates the turn circle:</p>\n\n<pre><code>func (p *player) handleTurn(win pixelgl.Window, dt float64) {\n    mouseRad := math.Atan2(p.pos.Y-win.MousePosition().Y, win.MousePosition().X-p.pos.X) // the angle the player needs to turn to face the mouse\n    if mouseRad &gt; p.rotateRad-(p.turnSpeed*dt) {\n        p.rotateRad += p.turnSpeed * dt\n    } else if mouseRad &lt; p.rotateRad+(p.turnSpeed*dt) {\n        p.rotateRad -= p.turnSpeed * dt\n    }\n}\n</code></pre>\n\n<p>The mouseRad being the radians for the turn to face the mouse, and I'm just adding the turn rate [in this case, 2].</p>\n\n<p>What's happening is when the mouse reaches the left side and crosses the center y axis, the radian angle goes from -pi to pi or vice-versa. This causes the player to do a full 360.</p>\n\n<p>What is a proper way to fix this? I've tried making the angle an absolute value and it only made it occur at pi and 0 [left <em>and</em> right side of the square at the center y axis].</p>\n\n<p>I have attached a gif of the problem to give better visualization.<a href=\"https://i.stack.imgur.com/SoSRz.gif\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/SoSRz.gif\" alt=\"gif\"></a></p>\n\n<p>Basic summarization:</p>\n\n<p>Player slowly rotates to follow mouse, but when the angle reaches pi, it changes polarity which causes the player to do a 360 [counts all the back to the opposite polarity angle]. </p>\n\n<p><em>Edit:\ndt is delta time, just for proper frame-decoupled changes in movement obviously</em></p>\n\n<p><em>p.rotateRad starts at 0 and is a float64.</em></p>\n\n<p>Github repo temporarily: <a href=\"https://github.com/hunterkepley/temp_game\" rel=\"noreferrer\">here</a></p>\n\n<p>You need <a href=\"https://github.com/faiface/pixel\" rel=\"noreferrer\">this library</a> to build it! [go get it]</p>\n"}, {"tags": ["go", "gota"], "answers": [{"comments": [{"owner": {"reputation": 4536, "user_id": 751528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a198aa6474d46c0d0f912e638e1cbd99?s=128&d=identicon&r=PG", "display_name": "OkezieE", "link": "https://stackoverflow.com/users/751528/okeziee"}, "edited": false, "score": 0, "creation_date": 1523196320, "post_id": 49716928, "comment_id": 86450218, "body": "Thanks a lot.  That makes sense now."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 2, "last_activity_date": 1523183633, "creation_date": 1523183633, "answer_id": 49716928, "question_id": 49714668, "link": "https://stackoverflow.com/questions/49714668/specify-delimiter-when-using-dataframe-readcsv-in-the-gota-library/49716928#49716928", "title": "specify delimiter when using dataframe.ReadCSV in the gota library", "body": "<p>This library uses <a href=\"https://dave.cheney.net/2014/10/17/functional-options-for-friendly-apis\" rel=\"nofollow noreferrer\">functional options</a>.</p>\n\n<p>dataframe.ReadCSV takes <em>any number</em> of dataframe.LoadOption, where LoadOption is a function type. Look through the docs for things that return a value of LoadOption and pass those to ReadCSV:</p>\n\n<pre><code>dataframe.ReadCSV(ioContent,\n    dataframe.WithDelimiter(';'),\n    dataframe.HasHeader(true),\n    // etc.\n)\n</code></pre>\n"}], "owner": {"reputation": 4536, "user_id": 751528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a198aa6474d46c0d0f912e638e1cbd99?s=128&d=identicon&r=PG", "display_name": "OkezieE", "link": "https://stackoverflow.com/users/751528/okeziee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 609, "favorite_count": 0, "accepted_answer_id": 49716928, "answer_count": 1, "score": 2, "last_activity_date": 1523183633, "creation_date": 1523164729, "question_id": 49714668, "link": "https://stackoverflow.com/questions/49714668/specify-delimiter-when-using-dataframe-readcsv-in-the-gota-library", "title": "specify delimiter when using dataframe.ReadCSV in the gota library", "body": "<p>I'm trying to figure out how to use <code>dataframe.LoadOptions</code> in the <a href=\"https://github.com/kniren/gota\" rel=\"nofollow noreferrer\">gota library</a> to specify a delimiter when reading the CSV file.  </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/kniren/gota/dataframe\"\n    \"io/ioutil\"\n    \"strings\"\n)\n\nfunc main() {\n    content, _ := ioutil.ReadFile(\"/path/to/csv/file.csv\")\n    ioContent := strings.NewReader(string(content))\n\n    df := dataframe.ReadCSV(ioContent)\n\n    fmt.Println(df)\n}\n</code></pre>\n\n<p>The dataframe.ReadCSV function takes an <code>options</code> variable of type *dataframe.LoadOptions</p>\n\n<p>I checked the definition for the dataframe.LoadOptions struct and found the following:</p>\n\n<pre><code>type LoadOption func(*loadOptions)\n\ntype loadOptions struct {\n    defaultType series.Type\n    detectTypes bool\n    hasHeader bool\n    names []string\n    nanValues []string\n    delimiter rune\n    types map[string]series.Type\n}\n</code></pre>\n\n<p>I'm new to Go and got stuck on this.  First time I've come across a definition like this: <code>type LoadOption func(*loadOptions)</code></p>\n"}, {"tags": ["post", "go", "multipartform-data"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1523173546, "post_id": 49714513, "comment_id": 86444270, "body": "So, what&#39;s the problem? And why don&#39;t you use multipart?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523182859, "post_id": 49714513, "comment_id": 86446651, "body": "Looks like you have an extra <code>$</code> byte at the beginning of your body. Do consider using the <a href=\"https://golang.org/pkg/mime/multipart/\" rel=\"nofollow noreferrer\">mime/multipart package</a> though."}], "owner": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 967, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1523162872, "creation_date": 1523162872, "question_id": 49714513, "link": "https://stackoverflow.com/questions/49714513/send-binary-form-data-in-golang", "title": "send binary form-data in golang", "body": "<p>I have the headers down for my post request, but I don't know how to send the data in binary and compressed. This is my curl command:</p>\n\n<pre><code>curl 'http://192.168.1.90:333/sendMessage.srv' \n-H 'Origin: http://192.168.1.90:333' \n-H 'Accept-Encocding: gzip, deflate' \n-H 'Accept-Language: en-US,en;q=0.9' \n-H 'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36' \n-H 'Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryycti6tczDNAO3xqF' \n-H 'Accept: */*' \n-H 'Referer: http://192.168.1.90:333/' \n-H 'X-Requested-With: XMLHttpRequest' \n-H 'Connection: keep-alive' \n--data-binary PAYLOAD --compressed\n</code></pre>\n\n<p>this is my payload that I am trying to send</p>\n\n<pre><code>------WebKitFormBoundaryycti6tczDNAO3xqF\nContent-Disposition: form-data; name=\"hashid\"\n+12223334444\n------WebKitFormBoundaryycti6tczDNAO3xqF\nContent-Disposition: form-data; name=\"reqUID\"\nwxyz\n------WebKitFormBoundaryycti6tczDNAO3xqF\nContent-Disposition: form-data; name=\"recipients\"\n------WebKitFormBoundaryycti6tczDNAO3xqF\nContent-Disposition: form-data; name=\"file-name\"\n------WebKitFormBoundaryycti6tczDNAO3xqF\nContent-Disposition: form-data; name=\"text\"\nmessage\n------WebKitFormBoundaryycti6tczDNAO3xqF--\n</code></pre>\n\n<p>or on 1 line it is</p>\n\n<pre><code>$'------WebKitFormBoundaryk7s3ZvI9evAhMsEL\\r\\nContent-Disposition: form-data; name=\"hashid\"\\r\\n\\r\\n+12223334444\\r\\n------WebKitFormBoundaryk7s3ZvI9evAhMsEL\\r\\nContent-Disposition: form-data; name=\"reqUID\"\\r\\n\\r\\nly9a\\r\\n------WebKitFormBoundaryk7s3ZvI9evAhMsEL\\r\\nContent-Disposition: form-data; name=\"recipients\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundaryk7s3ZvI9evAhMsEL\\r\\nContent-Disposition: form-data; name=\"file-name\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundaryk7s3ZvI9evAhMsEL\\r\\nContent-Disposition: form-data; name=\"text\"\\r\\n\\r\\nmessage\\r\\n------WebKitFormBoundaryk7s3ZvI9vAhMsEL--\\r\\n'\n</code></pre>\n\n<p>and this is my code:</p>\n\n<pre><code>body := strings.NewReader(`$------WebKitFormBoundaryU8vOdhYkInm8YBuZ\\r\\nContent-Disposition: form-data; name=\"hashid\"\\r\\n\\r\\n+12223334444\\r\\n------WebKitFormBoundaryU8vOdhYkInm8YBuZ\\r\\nContent-Disposition: form-data; name=\"reqUID\"\\r\\n\\r\\nvvpr\\r\\n------WebKitFormBoundaryU8vOdhYkInm8YBuZ\\r\\nContent-Disposition: form-data; name=\"recipients\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundaryU8vOdhYkInm8YBuZ\\r\\nContent-Disposition: form-data; name=\"file-name\"\\r\\n\\r\\n\\r\\n------WebKitFormBoundaryU8vOdhYkInm8YBuZ\\r\\nContent-Disposition: form-data; name=\"text\"\\r\\n\\r\\message\\r\\n------WebKitFormBoundaryU8vOdhYkInm8YBuZ--\\r\\n`)\n\nreq, err := http.NewRequest(\"POST\", \"http://192.168.1.90:333/sendMessage.srv\", body)\nif err != nil {\n    panic(err)\n}\nreq.Header.Set(\"Origin\", \"http://192.168.1.90:333\")\nreq.Header.Set(\"Accept-Encoding\", \"gzip, deflate\")\nreq.Header.Set(\"Accept-Language\", \"en-US,en;q=0.9\")\nreq.Header.Set(\"User-Agent\", \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36\")\nreq.Header.Set(\"Content-Type\", \"multipart/form-data; boundary=----WebKitFormBoundaryU8vOdhYkInm8YBuZ\")\nreq.Header.Set(\"Accept\", \"*/*\")\nreq.Header.Set(\"Referer\", \"http://192.168.1.90:333/\")\nreq.Header.Set(\"X-Requested-With\", \"XMLHttpRequest\")\nreq.Header.Set(\"Connection\", \"keep-alive\")\n\nresp, err := http.DefaultClient.Do(req)\nif err != nil {\n    panic(err)\n}\ndefer resp.Body.Close()\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1523164548, "post_id": 49714487, "comment_id": 86442449, "body": "<code>json.Unmarshal(k, &amp;e.Items)</code> You&#39;re passing a pointer to an interface i.e. <code>*interface{}</code>, you should not do that, you should pass a pointer to a concrete type e.g. <code>*[]Person</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1523164605, "post_id": 49714487, "comment_id": 86442454, "body": "... <a href=\"https://play.golang.org/p/HeLMoMvNtU7\" rel=\"nofollow noreferrer\">play.golang.org/p/HeLMoMvNtU7</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1523173710, "post_id": 49714487, "comment_id": 86444309, "body": "Because Go is statically type. You unmarshal into interface{}, you get interface{}."}, {"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523206291, "post_id": 49714487, "comment_id": 86453613, "body": "@mkopriva can you please post as an answer? thansk!"}], "answers": [{"comments": [{"owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "edited": false, "score": 0, "creation_date": 1523206252, "post_id": 49717250, "comment_id": 86453596, "body": "redefining it is not an option"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "edited": false, "score": 0, "creation_date": 1523206959, "post_id": 49717250, "comment_id": 86453855, "body": "Then what you&#39;re trying to do is impossible."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 0, "last_activity_date": 1523186230, "creation_date": 1523186230, "answer_id": 49717250, "question_id": 49714487, "link": "https://stackoverflow.com/questions/49714487/how-do-i-unmarshal-json-to-a-person/49717250#49717250", "title": "How do I unmarshal json to a []Person?", "body": "<p>Your current problem has absolutely nothing to do with JSON unmarshaling.</p>\n\n<p>You define <code>Items</code> as type <code>interface{}</code>, so obviously, when you inspect it, it will be of type <code>interface{}</code>. If you want it to be of type <code>[]Person</code>, simply define it as such:</p>\n\n<pre><code>type Employees struct {\n    Indicator string   `json:\"indicator\"`\n    Items     []Person `json:\"items\"`\n}\n</code></pre>\n\n<p>Once you've done that, your test case will yield the expected results. But your <code>Items</code> will still be empty, as your input JSON doesn't have the <code>items</code> field.</p>\n"}, {"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1523210391, "last_edit_date": 1523210391, "creation_date": 1523209418, "answer_id": 49720822, "question_id": 49714487, "link": "https://stackoverflow.com/questions/49714487/how-do-i-unmarshal-json-to-a-person/49720822#49720822", "title": "How do I unmarshal json to a []Person?", "body": "<p>The problem is that the interface's underlying value is not a pointer:</p>\n\n<pre><code>e.Items = []Person{}\n</code></pre>\n\n<p>While it's true that you're passing a pointer to the interface itself: </p>\n\n<pre><code>json.Unmarshal(k, &amp;e.Items)\n</code></pre>\n\n<p>That does not fix the problem of the underlying value being a non-pointer.</p>\n\n<pre><code>var a interface{} = &amp;T{}\n\nvar b interface{} = T{}\nb = &amp;b\n</code></pre>\n\n<p>The types of <code>a</code> and <code>b</code> are different and will be handled differently by the unmarshaler, in <code>b</code>'s case the unmarshaler will elect to replace the pointed-to value with a <code>map[string]interface{}</code>.</p>\n\n<p>So to fix your immediate problem you can do something like this:</p>\n\n<pre><code>if e.Indicator == \"more difficult\" {\n    k = j\n    e.Items = &amp;Person{}\n} else {\n    e.Items = &amp;[]Person{}\n}\n\nreturn json.Unmarshal(k, e.Items)\n</code></pre>\n"}], "owner": {"reputation": 3900, "user_id": 522962, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c77cd63cb8f567c1ffefca8e78f2c605?s=128&d=identicon&r=PG&f=1", "display_name": "user_78361084", "link": "https://stackoverflow.com/users/522962/user-78361084"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 1, "accepted_answer_id": 49720822, "answer_count": 2, "score": -1, "last_activity_date": 1523210391, "creation_date": 1523162535, "question_id": 49714487, "link": "https://stackoverflow.com/questions/49714487/how-do-i-unmarshal-json-to-a-person", "title": "How do I unmarshal json to a []Person?", "body": "<p>I am trying to dynamically set a field that is of type interface{}. In all of the cases below the json unmarshals into the correct structure but in the \"problem\" case the json unmarshals to []interface{}. For that case I am expecting []Person. Why do I get the wrong type for \"problem\"? </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Employees struct {\n    Indicator string      `json:\"indicator\"`\n    Items     interface{} `json:\"items\"`\n}\n\ntype Person struct {\n    Name string `json:\"name\"`\n}\n\nfunc main() {\n    simple()\n    easy()\n    moreDifficult()\n    problem()\n}\n\nvar j = []byte(`{\"name\": \"bob\"}`)\nvar jj = []byte(`[{\"name\": \"bob\"}, {\"name\": \"jim\"}, {\"name\": \"fred\"}]`)\n\n\nfunc simple() {\n    p := Person{}\n    if err := json.Unmarshal(j, &amp;p); err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(\"easy:\", p, reflect.TypeOf(p))\n}\n\nfunc easy() {\n    p := []Person{}\n    if err := json.Unmarshal(jj, &amp;p); err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(\"easy:\", p, reflect.TypeOf(p))\n}\n\nfunc moreDifficult() {\n    var j = []byte(`{\"indicator\": \"more difficult\"}`)\n\n    e := Employees{}\n    if err := json.Unmarshal(j, &amp;e); err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(\"moreDifficult\", e.Items, reflect.TypeOf(e.Items))\n}\n\nfunc problem() {\n    var j = []byte(`{\"indicator:\": \"problem\"}`)\n\n    e := Employees{}\n    if err := json.Unmarshal(j, &amp;e); err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(\"problem:\", e.Items, reflect.TypeOf(e.Items)) // why not []Person???\n}\n\n\nfunc (e *Employees) UnmarshalJSON(b []byte) error {\n    type alias Employees\n\n    a := &amp;alias{}\n\n    if err := json.Unmarshal(b, &amp;a); err != nil {\n        return err\n    }\n\n    e.Indicator = a.Indicator\n\n    var k = jj\n\n    if e.Indicator == \"more difficult\" {\n        k = j\n        e.Items = &amp;Person{}\n    } else {\n        e.Items = []Person{}\n    }\n\n    return json.Unmarshal(k, &amp;e.Items)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/xQvjMyLTk5i\" rel=\"nofollow noreferrer\">https://play.golang.org/p/xQvjMyLTk5i</a></p>\n"}, {"tags": ["json", "amazon-web-services", "go", "amazon-dynamodb", "unmarshalling"], "answers": [{"tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 5, "last_activity_date": 1531502506, "last_edit_date": 1531502506, "creation_date": 1523165315, "answer_id": 49714724, "question_id": 49714414, "link": "https://stackoverflow.com/questions/49714414/dynamodb-unmarshallistofmaps-creates-empty-values-in-go/49714724#49714724", "title": "DynamoDB UnmarshalListOfMaps creates empty values in Go", "body": "<p>The <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/dynamodb/dynamodbattribute/#Marshal\" rel=\"nofollow noreferrer\"><code>Marshal</code> documentation</a> says:</p>\n\n<blockquote>\n  <p>All struct fields and with anonymous fields, are marshaled unless the any of the following conditions are meet.</p>\n  \n  <ul>\n  <li>the field is not exported</li>\n  </ul>\n</blockquote>\n\n<p>The <code>Unmarshal</code> documentation doesn't mention anything about non-exported fields but it would be common and expected in Go for unmarshalling to also ignore non-exported fields (you can't even <a href=\"https://golang.org/pkg/reflect/#Value.CanSet\" rel=\"nofollow noreferrer\">set non-exported fields</a> using Go's reflection after all).</p>\n\n<p>I don't know my way around DynamoDB but perhaps you would have better luck if your fields were exported:</p>\n\n<pre><code>type product struct {\n    Id          int\n    Description string\n    Price       float64\n}\n</code></pre>\n\n<p>There are <code>dynamodbav</code> struct tags available if you need to marshal your struct with lower case field names.</p>\n\n<p>I would also recommend paying attention to the error that <code>dynamodbattribute.UnmarshalListOfMaps</code> is returning:</p>\n\n<pre><code>err = dynamodbattribute.UnmarshalListOfMaps(result.Items, &amp;productList)\nif err != nil {\n    /* Do something with the error here even if you just log it. */\n}\n</code></pre>\n\n<p>Similarly for the <code>svc.Scan(input)</code> call and everything else that returns an error.</p>\n"}], "owner": {"reputation": 13, "user_id": 4339266, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a93fbf467390ec197bb6cd40b876b8f4?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/4339266/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1344, "favorite_count": 0, "accepted_answer_id": 49714724, "answer_count": 1, "score": 1, "last_activity_date": 1531502506, "creation_date": 1523161548, "question_id": 49714414, "link": "https://stackoverflow.com/questions/49714414/dynamodb-unmarshallistofmaps-creates-empty-values-in-go", "title": "DynamoDB UnmarshalListOfMaps creates empty values in Go", "body": "<p>I put-item from json file, my code can output the scan result json, but trying to unmarshal it into my type using the built-in process only creates empty/zero values.</p>\n\n<p>Expected: 0, tomato, 0.50</p>\n\n<p>Actual: 0, , 0</p>\n\n<p>item.json</p>\n\n<pre><code>{\n    \"id\" : {\"N\" : \"0\"},\n    \"description\" : {\"S\": \"tomato\"},\n    \"price\" : {\"N\": \"0.50\"}\n}\n</code></pre>\n\n<p>product.go</p>\n\n<pre><code>type product struct {\n    id          int\n    description string\n    price       float64\n}\n</code></pre>\n\n<p>My query function:</p>\n\n<pre><code>func listAllProducts() []product {\n    sess, err := session.NewSession(&amp;aws.Config{\n        Region: aws.String(\"us-east-1\"),\n    },\n    )\n    svc := dynamodb.New(sess)\n    productList := []product{}\n\n    input := &amp;dynamodb.ScanInput{\n        TableName: aws.String(\"Products\"),\n    }\n    result, err := svc.Scan(input)\n    err = dynamodbattribute.UnmarshalListOfMaps(result.Items, &amp;productList)\n    return productList\n}\n</code></pre>\n\n<p>Output code</p>\n\n<pre><code>productList := listAllProducts()\n\n    for _, p := range productList {\n        log.Println(strconv.Itoa(p.id) + \", \" + p.description + \", \" + strconv.FormatFloat(p.price, 'f', -1, 64))\n    }\n</code></pre>\n"}, {"tags": ["go", "travis-ci"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1523204516, "post_id": 49714106, "comment_id": 86453045, "body": "If possible, include <code>Linux&#47;amd64</code> in your test. From where I sit, I&#39;d say most production Go code runs on that combo. But at the same time, I&#39;d say SNMP could be of interest to enterprises which often use Windows for internal stuff. (On a side note: please fix the project&#39;s title: the language is called &quot;Go&quot;, there is no such thing as &quot;GoLang&quot; except for a special keyword for searching via a particular Internet search engine.)"}], "answers": [{"comments": [{"owner": {"reputation": 3549, "user_id": 658270, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/56a007a4b2c47b141bd39790278f88a7?s=128&d=identicon&r=PG", "display_name": "Sonia Hamilton", "link": "https://stackoverflow.com/users/658270/sonia-hamilton"}, "edited": false, "score": 0, "creation_date": 1523184006, "post_id": 49715096, "comment_id": 86446933, "body": "Thanks this is a great start! The list of 6 &quot;first class ports&quot; is linux/amd64,linux/386,linux/arm,darwin/amd64,windows/amd64,w&zwnj;&#8203;indows/386. Golang release policy says 3 major releases are supported. 6 * 3 (2+RC) = 18 cases. When I&#39;m hacking stuff I&#39;ll cut this down to latest release and linux/amd64,linux/386 (2 cases) then test against all 18 cases. For the moment I&#39;ll just do this by editing .travis.yml, but I&#39;m sure there&#39;s some magic I could do, testing a file for &quot;quick&quot; or &quot;full&quot;. But that&#39;s another problem."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 3549, "user_id": 658270, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/56a007a4b2c47b141bd39790278f88a7?s=128&d=identicon&r=PG", "display_name": "Sonia Hamilton", "link": "https://stackoverflow.com/users/658270/sonia-hamilton"}, "edited": false, "score": 0, "creation_date": 1523188916, "post_id": 49715096, "comment_id": 86448171, "body": "Consider including a simple test policy section in your README.md; it is often used an initial screen by interested users. Assume it&#39;s Cloudflare, which has a large network: <a href=\"https://blog.cloudflare.com/arm-takes-wing/\" rel=\"nofollow noreferrer\">ARM Takes Wing: Qualcomm vs. Intel CPU comparison</a>. Intel and ARM CI testing for two current and any candidate Go releases might be important."}, {"owner": {"reputation": 3549, "user_id": 658270, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/56a007a4b2c47b141bd39790278f88a7?s=128&d=identicon&r=PG", "display_name": "Sonia Hamilton", "link": "https://stackoverflow.com/users/658270/sonia-hamilton"}, "edited": false, "score": 0, "creation_date": 1523204534, "post_id": 49715096, "comment_id": 86453048, "body": "Good comment. I&#39;ve added &quot;builds tested against &quot;linux/amd64, linux/386, darwin/amd64, windows/amd64, windows/386&quot; near top of README. linux/arm is currently breaking with &#39;exec format error&#39; :-("}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1523170200, "last_edit_date": 1523170200, "creation_date": 1523168705, "answer_id": 49715096, "question_id": 49714106, "link": "https://stackoverflow.com/questions/49714106/which-goarchs-should-an-opensource-golang-project-test-against/49715096#49715096", "title": "Which GOARCH&#39;s should an opensource golang project test against?", "body": "<p>You can see which Go binary release stable version combinations (Version/GOOS/GOARCH) are supported by Go downloads.</p>\n\n<p>See <a href=\"https://golang.org/dl/\" rel=\"nofollow noreferrer\">Go Downloads</a></p>\n\n<hr>\n\n<p>You may limit it to Go first-class ports.</p>\n\n<p>See <a href=\"https://github.com/golang/go/wiki/PortingPolicy\" rel=\"nofollow noreferrer\">First class ports, PortingPolicy</a>.</p>\n\n<hr>\n\n<p>You should conform to the Go release policy.</p>\n\n<p>See <a href=\"https://golang.org/doc/devel/release.html\" rel=\"nofollow noreferrer\">Release Policy, Go Release History</a></p>\n\n<hr>\n\n<p>You should consider premptively testing against release candidates, and, perhaps betas and devel.</p>\n"}], "owner": {"reputation": 3549, "user_id": 658270, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/56a007a4b2c47b141bd39790278f88a7?s=128&d=identicon&r=PG", "display_name": "Sonia Hamilton", "link": "https://stackoverflow.com/users/658270/sonia-hamilton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 2, "closed_date": 1523211086, "answer_count": 1, "score": 0, "last_activity_date": 1523170200, "creation_date": 1523157958, "question_id": 49714106, "link": "https://stackoverflow.com/questions/49714106/which-goarchs-should-an-opensource-golang-project-test-against", "closed_reason": "Opinion-based", "title": "Which GOARCH&#39;s should an opensource golang project test against?", "body": "<p>I have an <a href=\"https://github.com/soniah/gosnmp\" rel=\"nofollow noreferrer\">opensource Go project</a>. Some commits were causing failures on 386, but I didn't know because my builds were configured incorrectly.</p>\n\n<p>I'm now testing against 386 using <a href=\"https://github.com/soniah/gosnmp/blob/master/.travis.yml\" rel=\"nofollow noreferrer\">Travis</a>. Which <a href=\"https://gist.github.com/asukakenji/f15ba7e588ac42795f421b48b8aede63\" rel=\"nofollow noreferrer\">GOARCH/GOOS/Go version combinations</a> should opensource projects test against? I want meaningful coverage but I also want fast builds.</p>\n"}, {"tags": ["security", "authentication", "go", "ssh"], "comments": [{"owner": {"reputation": 3305, "user_id": 7322045, "user_type": "registered", "accept_rate": 83, "profile_image": "https://lh5.googleusercontent.com/-edNAm-59nUM/AAAAAAAAAAI/AAAAAAAAAKQ/_i_mG8h7TDI/photo.jpg?sz=128", "display_name": "Omkar Nath Singh", "link": "https://stackoverflow.com/users/7322045/omkar-nath-singh"}, "edited": false, "score": 0, "creation_date": 1523158003, "post_id": 49714088, "comment_id": 86441431, "body": "You can prompt user to get the value, then store in a variable var. Use that $var everywhere then. It will exist for the terminal session only. This can solve your purpose."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523181342, "post_id": 49714088, "comment_id": 86446250, "body": "Isn&#39;t this assuming that all devices share the same password? Who does that?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523181772, "post_id": 49714088, "comment_id": 86446368, "body": "Perhaps storing credentials for some amount of time is a viable alternative, <a href=\"https://superuser.com/a/275173\">just like sudo can cache your password</a>? I, for one, almost never close some of my terminals. Perhaps there are cryptographic methods that render the ciphertext unusable after some time. Then you can just store credentials in a file."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1523231039, "post_id": 49714088, "comment_id": 86461528, "body": "Just thinking here, you might want to create a box which acts like a tunnel.  That box can use <code>key authentication</code>. Go ssh&#39;s into that box, which then tunnels + proxies to the other box. The session password if it&#39;s the same can be a ENV var on the tunnel box.  If that&#39;s a bit much have the command line tool save the users password as a local ENV on that user&#39;s own box and look for it there with os.Getenv.  So the user gets prompted once and the password is stored locally etc. There should be an update password flag just incase it needs to change."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1523231356, "post_id": 49714088, "comment_id": 86461595, "body": "Even better, the first time the user uses the cli, create a folder in the root path <code>~.env&#47;</code>, save an env file there, which contains the password, that can looked up later, update rules still apply. That&#39;s literally how aws cli tools work."}, {"owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1523231720, "post_id": 49714088, "comment_id": 86461685, "body": "@reticentroot I tried storing the hashed password in an env file, but then I have no way to compare the users\u2019s password to the hashed password without prompting the user. I\u2019d rather not store anyone\u2019s password as plain text in a file or env variable."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1523231989, "post_id": 49714088, "comment_id": 86461742, "body": "@mwalto7 Can you use a remote config? In that way the key to hash against is accessible everywhere? I also don&#39;t see a way to use the passwords otherwise. It&#39;s either a DB they hit or it&#39;s stored locally on their own boxes like other configs. If you want the passwords to have more security store them in a env with the correct permissions so that the user has to sudo to read them. There are some free DBs you can use in sandbox mode if it comes that to that."}], "owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 204, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1523157730, "creation_date": 1523157730, "question_id": 49714088, "link": "https://stackoverflow.com/questions/49714088/store-password-for-current-terminal-session", "title": "Store Password For Current Terminal Session", "body": "<p>I am writing a command line app in Go that allows automating the configuration of networking devices over SSH. Unfortunately, most of these devices are configured for password authentication rather than key authentication. Is there a way to temporarily and securely store the user's password for only the current terminal session? Similar to how setting an environment variable with <code>export ENV_VAR=&lt;value&gt;</code> only stores the environment variable for the current session. For example, a user opens the terminal, runs my CLI, and is prompted for their password. For subsequent calls to my program, I'd like to not prompt the user for their password again. If the user closes their terminal then comes back later, however, I would want the password prompt to reappear when my CLI is called. If possible, I would like to do this without using a database since the number of users of my CLI will be very small.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1523142261, "post_id": 49712810, "comment_id": 86439048, "body": "You may use conversion after the type assertion: <code>float32(mymap[&quot;x&quot;].(uint64))</code> <a href=\"https://play.golang.org/p/fBGUf4EDOMD\" rel=\"nofollow noreferrer\">play.golang.org/p/fBGUf4EDOMD</a>"}, {"owner": {"reputation": 48375, "user_id": 486578, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/51f25affd1ea28bd28e61422868f02d5?s=128&d=identicon&r=PG", "display_name": "Damir", "link": "https://stackoverflow.com/users/486578/damir"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523142508, "post_id": 49712810, "comment_id": 86439098, "body": "@mkopriva But this is a question I am receiving sometimes there 45.5 for example a when is round 45 and not 45.0. I can resolve this with reflection and explicit conversion but I wanted to avoid that step if is possible, to avoid reflection as slower part to be called additionally."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1523142771, "post_id": 49712810, "comment_id": 86439148, "body": "Would a type switch solve your problem? <a href=\"https://play.golang.org/p/Xe2qt634-D5\" rel=\"nofollow noreferrer\">play.golang.org/p/Xe2qt634-D5</a>"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 2, "creation_date": 1523154770, "post_id": 49712810, "comment_id": 86440967, "body": "You probably should solve this problem at the level where you are populating the map. But you didn&#39;t mention <i>how</i> you are doing that."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523182496, "post_id": 49712810, "comment_id": 86446549, "body": "What Michael said. Try not to use an empty interface if you care about types."}], "answers": [{"tags": [], "owner": {"reputation": 7, "user_id": 3003642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8652dca61dd07c283f18b97bda9e819?s=128&d=identicon&r=PG&f=1", "display_name": "Jing", "link": "https://stackoverflow.com/users/3003642/jing"}, "is_accepted": false, "score": 0, "last_activity_date": 1595562118, "creation_date": 1595562118, "answer_id": 63066446, "question_id": 49712810, "link": "https://stackoverflow.com/questions/49712810/interface-conversion-interface-is-uint64-not-float32/63066446#63066446", "title": "interface conversion: interface {} is uint64, not float32", "body": "<p>this is my script:</p>\n<pre><code>switch i := x.(type) {\ncase nil:\n    printString(&quot;x is nil&quot;)                // type of i is type of x (interface{})\ncase int:\n    printInt(i)                            // type of i is int\ncase float64:\n    printFloat64(i)                        // type of i is float64\ncase func(int) float64:\n    printFunction(i)                       // type of i is func(int) float64\ncase bool, string:\n    printString(&quot;type is bool or string&quot;)  // type of i is type of x (interface{})\ndefault:\n    printString(&quot;don't know the type&quot;)     // type of i is type of x (interface{})\n}\n</code></pre>\n"}], "owner": {"reputation": 48375, "user_id": 486578, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/51f25affd1ea28bd28e61422868f02d5?s=128&d=identicon&r=PG", "display_name": "Damir", "link": "https://stackoverflow.com/users/486578/damir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 896, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1595562118, "creation_date": 1523142023, "question_id": 49712810, "link": "https://stackoverflow.com/questions/49712810/interface-conversion-interface-is-uint64-not-float32", "title": "interface conversion: interface {} is uint64, not float32", "body": "<p>Basically I have <code>map[interface{}]interface{}</code>  and inside under key \"x\" value 90 (I printed to confirm that data are correct), but when I do</p>\n\n<pre><code>mymap[\"x\"].(float32)\n</code></pre>\n\n<p>I get error </p>\n\n<pre><code>interface conversion: interface {} is uint64, not float32\n</code></pre>\n\n<p>Problem is that I expect float number (produced from as output from another program). I also tried to float32(mymap[\"x\"]) but not success(also tried examples from google with int64 without success).</p>\n\n<p>I am using <strong>go version go1.10.1 linux/amd64</strong></p>\n"}, {"tags": ["go", "constructor"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1523143383, "post_id": 49712313, "comment_id": 86439276, "body": "There are no &quot;class methods&quot; in Go, and also methods in Go are just functions where the receiver is actually the first argument. (<a href=\"https://play.golang.org/p/RBJl0LZR5Bo\" rel=\"nofollow noreferrer\">play.golang.org/p/RBJl0LZR5Bo</a>)"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523182649, "post_id": 49712313, "comment_id": 86446590, "body": "<a href=\"https://golang.org/ref/spec#Method_expressions\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Method_expressions</a>"}], "answers": [{"comments": [{"owner": {"reputation": 401, "user_id": 905750, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/751cb4a776f11a8f82b9363aa67a2df7?s=128&d=identicon&r=PG", "display_name": "SCote", "link": "https://stackoverflow.com/users/905750/scote"}, "edited": false, "score": 0, "creation_date": 1523191807, "post_id": 49712372, "comment_id": 86448830, "body": "That makes sense based on what the others have written. This answers my question as asked."}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 2, "creation_date": 1523193922, "post_id": 49712372, "comment_id": 86449442, "body": "cool, also, consider this idiomatic oneliner <code>field := &amp;datafield{&quot;name&quot;, &quot;value&quot;}</code> the full code is here <a href=\"https://goplay.space/#Acph3gPwrj2\" rel=\"nofollow noreferrer\">goplay.space/#Acph3gPwrj2</a>"}], "tags": [], "owner": {"reputation": 101, "user_id": 9418865, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d777f9bdf0185992c2ffb8cdd5892685?s=128&d=identicon&r=PG", "display_name": "Philippe D.", "link": "https://stackoverflow.com/users/9418865/philippe-d"}, "is_accepted": true, "score": 2, "last_activity_date": 1523138408, "creation_date": 1523138408, "answer_id": 49712372, "question_id": 49712313, "link": "https://stackoverflow.com/questions/49712313/golang-factory-method/49712372#49712372", "title": "Golang Factory Method", "body": "<p>You must not set a method on type \"datafield\" in your case, but do this instead :</p>\n\n<pre><code>func NewField(name, value string) *datafield {\n    retval := new(datafield)\n    retval.name = name\n    retval.value = value\n    return retval\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 401, "user_id": 905750, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/751cb4a776f11a8f82b9363aa67a2df7?s=128&d=identicon&r=PG", "display_name": "SCote", "link": "https://stackoverflow.com/users/905750/scote"}, "edited": false, "score": 0, "creation_date": 1523191271, "post_id": 49712483, "comment_id": 86448713, "body": "Understood. Once there is an instance of the receiver, that function can be called through that receiver. When creating the struct, the &quot;constructor&quot; idiom is not necessary as you explained."}, {"owner": {"reputation": 401, "user_id": 905750, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/751cb4a776f11a8f82b9363aa67a2df7?s=128&d=identicon&r=PG", "display_name": "SCote", "link": "https://stackoverflow.com/users/905750/scote"}, "edited": false, "score": 0, "creation_date": 1523191851, "post_id": 49712483, "comment_id": 86448847, "body": "Although this cleared thing up in my head, I&#39;m going to pick the answer by Phillippe D. because it technically gave the answer to my question. My code will probably reflect your approach though."}], "tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": false, "score": 3, "last_activity_date": 1523139456, "creation_date": 1523139456, "answer_id": 49712483, "question_id": 49712313, "link": "https://stackoverflow.com/questions/49712313/golang-factory-method/49712483#49712483", "title": "Golang Factory Method", "body": "<p>By adding (d datafield) onto the function signature you are making the datafield a receiver argument (<a href=\"https://tour.golang.org/methods/1\" rel=\"nofollow noreferrer\">https://tour.golang.org/methods/1</a>) so the NewDatafield is now a method on datafield. This means to call it you need to already have a datafield which didn't make much sense so you could just remove the (d datafield) and it will work or even better just construct the stuct directly (<a href=\"https://gobyexample.com/structs\" rel=\"nofollow noreferrer\">https://gobyexample.com/structs</a>):</p>\n\n<pre><code>field := datafield{\"name\", \"value\"}\n</code></pre>\n\n<p>You only really need constructor functions when there is extra work to be done, not just setting fields.</p>\n"}, {"comments": [{"owner": {"reputation": 401, "user_id": 905750, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/751cb4a776f11a8f82b9363aa67a2df7?s=128&d=identicon&r=PG", "display_name": "SCote", "link": "https://stackoverflow.com/users/905750/scote"}, "edited": false, "score": 1, "creation_date": 1523192285, "post_id": 49714445, "comment_id": 86448965, "body": "This was an insanely useful explanation. Thanks for extending this out for me as interfaces were next on my list and this gives me a very relevant example."}], "tags": [], "owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "is_accepted": false, "score": 9, "last_activity_date": 1523189941, "last_edit_date": 1523189941, "creation_date": 1523162017, "answer_id": 49714445, "question_id": 49712313, "link": "https://stackoverflow.com/questions/49712313/golang-factory-method/49714445#49714445", "title": "Golang Factory Method", "body": "<p>Go isn't exactly object oriented language and promotes simplicity, that's why the previous answers are focused on fixing your code. Nevertheless, if you really need to implement this design pattern in Go, read further.</p>\n\n<blockquote>\n  <p>The factory method pattern is a creational pattern that uses factory\n  methods to deal with the problem of creating objects without having to\n  specify the exact class of the object that will be created. This is\n  done by creating objects by calling a factory method. (<a href=\"https://en.wikipedia.org/wiki/Factory_method_pattern\" rel=\"noreferrer\" title=\"a wiki article\">wikipedia</a>)</p>\n</blockquote>\n\n<p>Here is another definition and a really good example in Go by Svetlin\nRalchev:  </p>\n\n<blockquote>\n  <p>The Factory Method pattern is used to define a runtime interface for\n  creating an object. It\u2019s called a factory because it creates various\n  types of objects without necessarily knowing what kind of object it\n  creates or how to create it. (<a href=\"http://blog.ralch.com/tutorial/design-patterns/golang-factory-method/\" rel=\"noreferrer\" title=\"a blog post\">Desing Patterns in Golang: Factory\n  Method</a>)</p>\n</blockquote>\n\n<p>I've extended your example a bit to demonstrate the benefits of using Factory Methods, as there is no need to use factories at all if you're dealing with one struct (an object in OO world).\n<a href=\"https://goplay.space/#SOXPmM86GgF\" rel=\"noreferrer\">https://goplay.space/#SOXPmM86GgF</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype dataField interface {\n    Print()\n}\ntype dataField1 struct {\n    name  string\n    value string\n}\n\nfunc (df *dataField1) Print() {\n    fmt.Println(\"dataField1 -&gt;\", df.name, \":\", df.value)\n}\n\ntype dataField2 struct {\n    name  string\n    value string\n}\n\nfunc (df *dataField2) Print() {\n    fmt.Println(\"dataField2 -&gt;\", df.name, \":\", df.value)\n}\n\ntype dataFieldFactory interface {\n    Create(name, value string) dataField\n}\n\ntype dataField1Factory struct{}\n\nfunc (factory *dataField1Factory) Create(name, value string) dataField {\n    return &amp;dataField1{\n        name:  name,\n        value: value,\n    }\n}\n\ntype dataField2Factory struct{}\n\nfunc (factory *dataField2Factory) Create(name, value string) dataField {\n    return &amp;dataField2{\n        name:  name,\n        value: value,\n    }\n}\n\ntype Document struct {\n    dataFieldFactories []dataFieldFactory\n    allValues          [][]string\n}\n\nfunc (doc *Document) Print() {\n    for i, factory := range doc.dataFieldFactories {\n        field := factory.Create(doc.allValues[i][0], doc.allValues[i][1])\n        field.Print()\n    }\n}\n\nfunc main() {\n    doc := &amp;Document{\n        dataFieldFactories: []dataFieldFactory{\n            &amp;dataField1Factory{},\n            &amp;dataField2Factory{},\n        },\n        allValues: [][]string{{\"name1\", \"value1\"}, {\"name2\", \"value2\"}},\n    }\n    doc.Print()\n}\n</code></pre>\n\n<p>The program simply prints this</p>\n\n<pre><code>dataField1 -&gt; name1 : value1\ndataField2 -&gt; name2 : value2\n</code></pre>\n\n<p>However, if you look into main func you don't find any mentions or initializations of concrete types <code>dataField1</code> and <code>dataField2</code>.\nAll the complexity is hidden behind <code>dataFieldFactories</code>.\nBoth <code>dataField1Factory</code> and <code>dataField2Factory</code> implement <code>Create</code> interface and return dataField interface, that both the concrete types\nalso implement. So, you can call <code>Print()</code> for each of the concrete types.</p>\n\n<p><code>Document.Print()</code> uses both the Create and Print interfaces for printing\nout all the fields without any knowledge about how the fields are actually created or printed. We're achieving this by providing a list of Factory Methods (<code>dataField1Factory{}</code> and <code>dataField2Factory{}</code>) and corresponding string values to the Document struct (object).</p>\n\n<p>Excuse me for a bit artificial example, but I hope, you'll get the basic idea.\nAs you can see Go allows you to implement design patterns you're familiar with, perhaps, not in exact same way as you get used to in pure OO languages.</p>\n"}], "owner": {"reputation": 401, "user_id": 905750, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/751cb4a776f11a8f82b9363aa67a2df7?s=128&d=identicon&r=PG", "display_name": "SCote", "link": "https://stackoverflow.com/users/905750/scote"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2867, "favorite_count": 1, "accepted_answer_id": 49712372, "answer_count": 3, "score": 2, "last_activity_date": 1523189941, "creation_date": 1523137976, "question_id": 49712313, "link": "https://stackoverflow.com/questions/49712313/golang-factory-method", "title": "Golang Factory Method", "body": "<p>I am learning golang, and am getting stuck on an embarassingly simple concept. Maybe it's my OO habits clouding my comprehension, but I can't seem to get this simple example to work:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype datafield struct {\n    name  string\n    value string\n}\n\nfunc (d datafield) NewField(name, value string) *datafield {\n    retval := new(datafield)\n    retval.name = name\n    retval.value = value\n    return retval\n}\n\nfunc main() {\n    field := datafield.NewField(\"name\", \"value\")\n    if field == nil {\n        fmt.Println(\"Error: Did not create a datafield\")\n    } else {\n        fmt.Println(\"Success!\")\n    }\n}\n</code></pre>\n\n<p>The error is:</p>\n\n<pre><code>prog.go:20:29: not enough arguments in call to method expression datafield.NewField\n    have (string, string)\n    want (datafield, string, string)\n</code></pre>\n\n<p>What is the proper way to get <code>NewField(string,string)</code> to create a datafield?</p>\n"}, {"tags": ["go", "panic"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523128618, "post_id": 49711060, "comment_id": 86435670, "body": "What is the complete error message, with line number? And which line in your code does it correspond to?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1523128825, "post_id": 49711060, "comment_id": 86435736, "body": "Put the error in the question. But more important: <i>read</i> the error. It tells you were your problem is."}, {"owner": {"reputation": 29, "user_id": 8141892, "user_type": "registered", "profile_image": "https://graph.facebook.com/10203076781797317/picture?type=large", "display_name": "Jul Kreshpaj", "link": "https://stackoverflow.com/users/8141892/jul-kreshpaj"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1523128942, "post_id": 49711060, "comment_id": 86435764, "body": "line 21 is <code>l[i] = l[n]</code> and line 60 is where function is called in main"}], "answers": [{"comments": [{"owner": {"reputation": 29, "user_id": 8141892, "user_type": "registered", "profile_image": "https://graph.facebook.com/10203076781797317/picture?type=large", "display_name": "Jul Kreshpaj", "link": "https://stackoverflow.com/users/8141892/jul-kreshpaj"}, "edited": false, "score": 0, "creation_date": 1523128972, "post_id": 49711108, "comment_id": 86435774, "body": "i thought that but is there a fix that i can make"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 29, "user_id": 8141892, "user_type": "registered", "profile_image": "https://graph.facebook.com/10203076781797317/picture?type=large", "display_name": "Jul Kreshpaj", "link": "https://stackoverflow.com/users/8141892/jul-kreshpaj"}, "edited": false, "score": 0, "creation_date": 1523130001, "post_id": 49711108, "comment_id": 86436029, "body": "@JulKreshpaj, <code>for i := 0; i &lt; len(l) - 1; i++ {}</code>"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 0, "last_activity_date": 1523128781, "creation_date": 1523128781, "answer_id": 49711108, "question_id": 49711060, "link": "https://stackoverflow.com/questions/49711060/golang-runtime-error-index-out-of-range/49711108#49711108", "title": "golang runtime error: index out of range", "body": "<p>You're trying to access <code>l[n]</code> where <code>n := i + 1</code>, and <code>i</code> is the index of <code>l</code>.  This means that on the last time through the loop, when <code>i</code> is the last element in <code>l</code>, <code>n</code> will always be past the last element of <code>l</code>. Every time.</p>\n"}], "owner": {"reputation": 29, "user_id": 8141892, "user_type": "registered", "profile_image": "https://graph.facebook.com/10203076781797317/picture?type=large", "display_name": "Jul Kreshpaj", "link": "https://stackoverflow.com/users/8141892/jul-kreshpaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2746, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1523129236, "creation_date": 1523128523, "last_edit_date": 1523129236, "question_id": 49711060, "link": "https://stackoverflow.com/questions/49711060/golang-runtime-error-index-out-of-range", "title": "golang runtime error: index out of range", "body": "<p>I have a simple for loop in go which iterates through a slice of integers and changes the position of the current if next is smaller basically a sort, but it keeps showing me this error which says </p>\n\n<pre><code>panic: runtime error: index out of range\n</code></pre>\n\n<p>Here is the code:</p>\n\n<pre><code>func sort(n int, l []int) interface{} {\n    fmt.Println(l)\n    if d == false {\n        d = true\n        for i := range l {\n            n := i + 1\n            t := l[i]\n            l[i] = l[n]\n            l[n] = t\n            arr = l\n            d = false\n        }\n        return sort(n, arr)\n    }\n    return arr\n}\n</code></pre>\n\n<p>Returned arr is declared as a global variable.\nHere is the error:</p>\n\n<pre><code>panic: runtime error: index out of range\n\ngoroutine 1 [running]:\nmain.troubleSort(0x5, 0xc42001a150, 0x5, 0x5, 0x0, 0xc42000e1d0)\n        /home/julkreshpaj/codejam/Trouble Sort/Solution.go:21 +0x1c1\nmain.main()\n        /home/julkreshpaj/codejam/Trouble Sort/Solution.go:60 +0x82\nexit status 2\n</code></pre>\n"}, {"tags": ["sql", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523125974, "post_id": 49710588, "comment_id": 86434801, "body": "Don&#39;t use Printf et al. for SQL queries. See <a href=\"https://golang.org/pkg/database/sql/#DB.Query\" rel=\"nofollow noreferrer\">the example on DB.Query</a> for how to pass parameters safely."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1523126082, "post_id": 49710588, "comment_id": 86434841, "body": "Queryrow does not takes fmt Sprintf Should read more on <a href=\"https://golang.org/pkg/database/sql/#DB.QueryRow\" rel=\"nofollow noreferrer\">Query Row</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1523126098, "post_id": 49710588, "comment_id": 86434847, "body": "You are trying to scan NULL into string, but strings can&#39;t be nil. Use sql.NullString instead, but only after you removed the Printf."}], "answers": [{"tags": [], "owner": {"reputation": 18142, "user_id": 1515819, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c7d0a1373a2312378f6563acf2a8f937?s=128&d=identicon&r=PG&f=1", "display_name": "St&#233;phane Bruckert", "link": "https://stackoverflow.com/users/1515819/st%c3%a9phane-bruckert"}, "is_accepted": false, "score": 0, "last_activity_date": 1605143268, "creation_date": 1605143268, "answer_id": 64796471, "question_id": 49710588, "link": "https://stackoverflow.com/questions/49710588/unsupported-scan-storing-driver-value-type/64796471#64796471", "title": "unsupported Scan, storing driver.Value type", "body": "<p>Since the DB field was specifying <code>null</code> instead of <code>not null</code>, I had to replace this:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>type MyStruct struct {\n    TheDatetime time.Time `json:&quot;the_datetime&quot;`\n}\n</code></pre>\n<p>by:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>_ &quot;github.com/go-sql-driver/mysql&quot;\n\ntype MyStruct struct {\n    TheDatetime sql.NullTime `json:&quot;the_datetime&quot;`\n}\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 7204615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54176ff575fc7ec6f336c97869756259?s=128&d=identicon&r=PG&f=1", "display_name": "Lucian Blaga", "link": "https://stackoverflow.com/users/7204615/lucian-blaga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1288, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1605143268, "creation_date": 1523125605, "last_edit_date": 1523133207, "question_id": 49710588, "link": "https://stackoverflow.com/questions/49710588/unsupported-scan-storing-driver-value-type", "title": "unsupported Scan, storing driver.Value type", "body": "<p>I want to select fild in database and return 3 vriables with golang, \nthis is my actual code :</p>\n\n<pre><code>func db_tabela_select(cliente string) (id string, cod1 string, cod2 string, cod3 string) {\n\n    db, err := sql.Open(\"mysql\", mysql_login)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer db.Close()\n\n    err = db.Ping()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n\n    var Saldo, grup1, grup2, grup3, timestamp, user_agent string\n\n    err = db.QueryRow(fmt.Sprintf(\"select * from db_tabela WHERE `cliente`='%s' LIMIT 1;\", string(cliente) )).Scan(\n        &amp;id, &amp;cliente, &amp;Saldo, &amp;cod1, &amp;cod2, &amp;cod3, &amp;grup1, &amp;grup2, &amp;grup3, &amp;user_agent, &amp;timestamp)\n    if err != nil {\n        fmt.Println(err)\n    } else {\n        log.Printf(\"cod results : \", cod1, cod2, cod3)\n    }\n\n\n    return id, cod1, cod2, cod3\n}\n</code></pre>\n\n<p>return me this error, and i don't understend where is my mistake:</p>\n\n<pre><code>sql: Scan error on column index 2: unsupported Scan, storing driver.Value type &lt;\nnil&gt; into type *string\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1523113725, "post_id": 49708663, "comment_id": 86430931, "body": "This is off-topic on SO. I suggest you post this on <a href=\"http://codereview.stackexchange.com\">codereview.stackexchange.com</a> instead."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 0, "last_activity_date": 1523113520, "creation_date": 1523113520, "answer_id": 49708709, "question_id": 49708663, "link": "https://stackoverflow.com/questions/49708663/golang-get-cookies-simplification-code/49708709#49708709", "title": "golang get cookies simplification code", "body": "<p>One option is to move the replicated code to a function:</p>\n\n<pre><code>func cookie(r *http.Request, name string) string {\n   c, err := r.Cookie(name)\n   if err != nil {\n      return \"\"\n   }\n   return c.Value\n}\n</code></pre>\n\n<p>Use it like this:</p>\n\n<pre><code>    cliente := cookie(r, \"codicecliente\")\n    dd := cookie(r, \"dd\")\n    mm := cookie(r, \"mm\")\n    aaaa := cookie(r, \"aaaa\")\n</code></pre>\n"}], "owner": {"reputation": 129, "user_id": 2532757, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/7Ny8B.jpg?s=128&g=1", "display_name": "PythonFun", "link": "https://stackoverflow.com/users/2532757/pythonfun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 247, "favorite_count": 1, "closed_date": 1524331973, "accepted_answer_id": 49708709, "answer_count": 1, "score": 0, "last_activity_date": 1523117915, "creation_date": 1523113203, "last_edit_date": 1523117915, "question_id": 49708663, "link": "https://stackoverflow.com/questions/49708663/golang-get-cookies-simplification-code", "closed_reason": "Opinion-based", "title": "golang get cookies simplification code", "body": "<p>I want to learn to write clean and simple code in golang, this is my actual code :</p>\n\n<pre><code>if r.Method == \"POST\" &amp;&amp; r.FormValue(\"pincodeVal\") != \"\"  {\n        var cliente, dd, mm, aaaa, email string\n        redirectt    := \"http://\" + r.Host + \"/\" + GetMD5Hash(randString(10))\n\n        session1, _ := store.Get(r, \"loginSession\")\n        email       = GetSes(session1.Values[\"email\"])\n\n        cliente_cookie, err := r.Cookie(\"codicecliente\")\n        if err == nil { cliente = cliente_cookie.Value }\n\n        dd_cookie, err := r.Cookie(\"dd\")\n        if err == nil { dd = dd_cookie.Value }\n\n        mm_cookie, err := r.Cookie(\"mm\")\n        if err == nil { mm =  mm_cookie.Value }\n\n        aaaa_cookie, err := r.Cookie(\"aaaa\")\n        if err == nil { aaaa =  aaaa_cookie.Value }\n\n        pincode := r.FormValue(\"pincodeVal\")\n\n        if cliente == \"\" || dd == \"\" || mm == \"\" || aaaa == \"\" {\n            http.Redirect(w, r, redirectt + \"/login.html\", 302)\n        }\n}  \n</code></pre>\n\n<p>Does there exist a way to make more this golang code simpler?</p>\n"}, {"tags": ["go", "pipe", "stdin"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523088396, "post_id": 49704456, "comment_id": 86423788, "body": "To clarify, the goal is to read from stdin and then from the terminal, even if the terminal isn&#39;t connected to stdin?"}, {"owner": {"reputation": 33, "user_id": 5349200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b044275690e0b5590f6d690ddf35c875?s=128&d=identicon&r=PG&f=1", "display_name": "jap", "link": "https://stackoverflow.com/users/5349200/jap"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1523125125, "post_id": 49704456, "comment_id": 86434517, "body": "the goal is to read from stdin which is set to pipe mode in the beginning at the program and starting from this line <code>reader := bufio.NewReader(os.Stdin)</code>, the mode of stdin is switched to device, i.e. keyboard"}], "answers": [{"tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": false, "score": 1, "last_activity_date": 1592555545, "last_edit_date": 1592555545, "creation_date": 1523085823, "answer_id": 49704981, "question_id": 49704456, "link": "https://stackoverflow.com/questions/49704456/how-to-read-from-device-when-stdin-is-pipe/49704981#49704981", "title": "How to read from device when stdin is pipe", "body": "<p>Probably <a href=\"https://golang.org/pkg/fmt/#hdr-Scanning\" rel=\"nofollow noreferrer\">scanf</a> could help, check this example:</p>\n\n<p><a href=\"https://play.golang.org/p/tteQNl0trJp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/tteQNl0trJp</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    fmt.Println(\"Enter your name\")\n\n    var name string\n    fmt.Scanf(\"%s\", &amp;name)\n    fmt.Printf(\"name = %s\\n\", name)\n}\n</code></pre>\n\n<p>Something a little more elaborated to check if there is something to read from stdin and if not prompt the user:</p>\n\n<p><a href=\"https://play.golang.org/p/7qeAQ5UNhdQ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7qeAQ5UNhdQ</a></p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    // check if there is somethinig to read on STDIN\n    stat, _ := os.Stdin.Stat()\n    if (stat.Mode() &amp; os.ModeCharDevice) == 0 {\n        var stdin []byte\n        scanner := bufio.NewScanner(os.Stdin)\n        for scanner.Scan() {\n            stdin = append(stdin, scanner.Bytes()...)\n        }\n        if err := scanner.Err(); err != nil {\n            log.Fatal(err)\n        }\n        fmt.Printf(\"stdin = %s\\n\", stdin)\n    } else {\n        fmt.Println(\"Enter your name\")\n\n        var name string\n        fmt.Scanf(\"%s\", &amp;name)\n        fmt.Printf(\"name = %s\\n\", name)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 33, "user_id": 5349200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b044275690e0b5590f6d690ddf35c875?s=128&d=identicon&r=PG&f=1", "display_name": "jap", "link": "https://stackoverflow.com/users/5349200/jap"}, "edited": false, "score": 0, "creation_date": 1523127867, "post_id": 49710144, "comment_id": 86435437, "body": "So in the answer you provided, the program will read only from keyboard, but my intent is to first read from pipe and then switch it to device mode. The goal is to read from stdin which is set to pipe mode in the beginning at the program and starting from this line <code>reader := bufio.NewReader(os.Stdin)</code>, the mode of stdin is switched to device, i.e. keyboard. Is this even possible? Thanks."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "reply_to_user": {"reputation": 33, "user_id": 5349200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b044275690e0b5590f6d690ddf35c875?s=128&d=identicon&r=PG&f=1", "display_name": "jap", "link": "https://stackoverflow.com/users/5349200/jap"}, "edited": false, "score": 0, "creation_date": 1523128223, "post_id": 49710144, "comment_id": 86435540, "body": "@jap You read from the tty only when you want to read from the tty and read from stdin when you want to read from stdin. Of course you are allowed to have more than one bufio.Reader at a time; just use another variable!"}], "tags": [], "owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "is_accepted": true, "score": 1, "last_activity_date": 1523122720, "creation_date": 1523122720, "answer_id": 49710144, "question_id": 49704456, "link": "https://stackoverflow.com/questions/49704456/how-to-read-from-device-when-stdin-is-pipe/49710144#49710144", "title": "How to read from device when stdin is pipe", "body": "<p>You can instead read from <code>/dev/tty</code> as this is always the terminal (if the program runs on a terminal). This is portable only to Unix-like systems (Linux, BSD, macOS, etc) and won't work on Windows.</p>\n\n<pre><code>// +build !windows\n\ntty, err := os.Open(\"/dev/tty\")\nif err != nil {\n    log.Fatalf(\"can't open /dev/tty: %s\", err)\n}\nscanner := bufio.NewScanner(tty)\n// as you were ...\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 5349200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b044275690e0b5590f6d690ddf35c875?s=128&d=identicon&r=PG&f=1", "display_name": "jap", "link": "https://stackoverflow.com/users/5349200/jap"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1586, "favorite_count": 0, "accepted_answer_id": 49710144, "answer_count": 2, "score": 0, "last_activity_date": 1592555545, "creation_date": 1523081328, "last_edit_date": 1523095605, "question_id": 49704456, "link": "https://stackoverflow.com/questions/49704456/how-to-read-from-device-when-stdin-is-pipe", "title": "How to read from device when stdin is pipe", "body": "<p>So I have a Go program that reads from STDIN as such below. I want the username and password to be entered from keyboard or device but the string slice can be passed using pipe. If I run the command as below: </p>\n\n<blockquote>\n  <p>echo \"Hello World\" | go run main.go</p>\n</blockquote>\n\n<p>os.Stdin will be set to read from pipes and never the keyboard. Is there a way that I can change os.Stdin FileMode as such that it will be reading from device, i.e. keyboard for username and password?</p>\n\n<p>I tried using os.Stdin.Chmod(FileMode) but received this error: </p>\n\n<blockquote>\n  <p>chmod /dev/stdin: invalid argument</p>\n</blockquote>\n\n<pre><code>func main() {\n        var n = []string{}\n        scanner := bufio.NewScanner(os.Stdin)\n        fmt.Println(\"Please type anything with Newline Separated, empty line signals termination\")\n        for scanner.Scan() {\n            h := scanner.Text()\n            if h == \"\" {\n                break\n            }\n            n = append(n, h)\n        }\n        if err := scanner.Err(); err != nil {\n            fmt.Printf(\"Error in reading from STDIN: %v\\n\", err)\n        }\n\n        reader := bufio.NewReader(os.Stdin)\n        os.Stdout.WriteString(\"Username: \")\n        username, err := reader.ReadString('\\n')\n        if err != nil {\n            fmt.Printf(\"Unable to read username: %v\\n\", err)\n        }\n        username = strings.TrimSpace(username)\n\n        os.Stdout.WriteString(\"Password: \")\n        bytePassword, _ := terminal.ReadPassword(int(os.Stdin.Fd()))\n\n        password := string(bytePassword)\n        os.Stdout.WriteString(\"\\n\")\n    }\n</code></pre>\n"}, {"tags": ["go", "assembly"], "comments": [{"owner": {"reputation": 3691, "user_id": 1289675, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/edlUo.jpg?s=128&g=1", "display_name": "Netch", "link": "https://stackoverflow.com/users/1289675/netch"}, "edited": false, "score": 3, "creation_date": 1523117683, "post_id": 49704245, "comment_id": 86432152, "body": "If you need exactly <code>brsl</code>, <code>math.bits.LeadingZeros</code> (since Go 1.9) already implements this."}], "answers": [{"tags": [], "owner": {"reputation": 240649, "user_id": 224132, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/N4ivW.png?s=128&g=1", "display_name": "Peter Cordes", "link": "https://stackoverflow.com/users/224132/peter-cordes"}, "is_accepted": true, "score": 1, "last_activity_date": 1523164420, "last_edit_date": 1523164420, "creation_date": 1523164004, "answer_id": 49714607, "question_id": 49704245, "link": "https://stackoverflow.com/questions/49704245/how-to-write-asm-code-bsrl-in-golang/49714607#49714607", "title": "How to write asm code &quot;bsrl&quot; in golang", "body": "<p>All the answers on <a href=\"https://stackoverflow.com/questions/2951028/is-it-possible-to-include-inline-assembly-in-google-go-code\">the question you found</a> say it's <em>not</em> possible to use inline-asm in Go, with any syntax.  GNU C inline-asm syntax isn't going to help.</p>\n\n<p><strong>But fortunately, you don't need inline asm for <code>bsr</code></strong> (which finds the bit-index of the highest set bit).  Go 1.9 has an intrinsic / built-in function for bitwise operations that are close enough that they should compile efficiently.</p>\n\n<hr>\n\n<p>Use <a href=\"https://golang.org/pkg/math/bits/#LeadingZeros32\" rel=\"nofollow noreferrer\"><code>math.bits.LeadingZeros32</code></a> to get <code>lzcnt(x)</code>, which is <code>31-bsr(x)</code> for non-zero <code>x</code>.  This may cost extra instructions, especially on CPUs which only support <code>bsr</code>, not <a href=\"http://felixcloutier.com/x86/LZCNT.html\" rel=\"nofollow noreferrer\"><code>lzcnt</code></a> (e.g. Intel pre-Haswell).</p>\n\n<p><strong>Or use <a href=\"https://golang.org/pkg/math/bits/#Len32\" rel=\"nofollow noreferrer\"><code>Len32(x) - 1</code></a></strong></p>\n\n<p><code>Len32(x)</code> returns the number of bits required to represent <code>x</code>.  It returns <code>0</code> for <code>x=0</code>, and presumably it returns <code>1</code> for <code>x=1</code>, so it's <code>bsr(x) + 1</code>, with defined behaviour for <code>0</code> (thus potentially costing extra instructions).  Hopefully <code>Len32(x) - 1</code> can compile directly to a <code>bsr</code>.</p>\n\n<p>Of course, if what you really wanted was <code>lzcnt</code>, then use <code>LeadingZeros32</code> in the first place.</p>\n\n<hr>\n\n<p>Note that <a href=\"http://felixcloutier.com/x86/BSR.html\" rel=\"nofollow noreferrer\"><code>bsr</code></a> leaves the destination register unmodified for input = <code>0</code>.  Intel's docs only say with an undefined value, so compilers probably don't take advantage of this guarantee that AMD documents and Intel does provide in hardware.</p>\n\n<p>At least in theory, though, <code>Len32(x) - 1</code> could compile to a single <code>bsr</code> instruction if the compiler can prove that <code>x</code> is non-zero.</p>\n"}], "owner": {"reputation": 61, "user_id": 1240433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1b2a0ccd2709d47f1332aa6077bac23?s=128&d=identicon&r=PG", "display_name": "solos", "link": "https://stackoverflow.com/users/1240433/solos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 406, "favorite_count": 0, "accepted_answer_id": 49714607, "answer_count": 1, "score": 1, "last_activity_date": 1523164420, "creation_date": 1523079403, "last_edit_date": 1523091291, "question_id": 49704245, "link": "https://stackoverflow.com/questions/49704245/how-to-write-asm-code-bsrl-in-golang", "title": "How to write asm code &quot;bsrl&quot; in golang", "body": "<p>I need to write some asm code in golang. I read this question <a href=\"https://stackoverflow.com/questions/2951028/is-it-possible-to-include-inline-assembly-in-google-go-code\">Is it possible to include inline assembly in Google Go code?</a>, but not see how to write it. \nCould anyone help me? thanks.</p>\n\n<pre><code>asm (\"bsrl %1, %0;\"\n           :\"=r\"(bits)            /* output */\n           :\"r\"(value) );         /* input */\n</code></pre>\n"}, {"tags": ["javascript", "go", "websocket"], "answers": [{"tags": [], "owner": {"reputation": 3682, "user_id": 35439, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c99d027e3da3a80fa9e7af16f386f5d0?s=128&d=identicon&r=PG", "display_name": "tonys", "link": "https://stackoverflow.com/users/35439/tonys"}, "is_accepted": true, "score": 0, "last_activity_date": 1523080051, "last_edit_date": 1523080051, "creation_date": 1523079719, "answer_id": 49704278, "question_id": 49704093, "link": "https://stackoverflow.com/questions/49704093/how-to-fix-a-server-failure-when-the-client-reloads-the-page/49704278#49704278", "title": "How to fix a server failure when the client reloads the page?", "body": "<p>In <code>go</code>, log.Fatal(..) exits your application. </p>\n\n<pre><code>err := conn.ReadJSON(&amp;query)\n</code></pre>\n\n<p>will return an <code>err</code> when the client connection closes and the next block:</p>\n\n<pre><code>if err != nil {\n  log.Fatal(err)\n  return\n}\n</code></pre>\n\n<p>will close the <code>go</code> server and the Javascript client will be unable to reconnect. </p>\n\n<p>Your server structure also doesn't look quite correct - <code>WebSocketHandler</code> is invoked to handle a single connection:</p>\n\n<pre><code>    .\n    http.HandleFunc(\"/\", WebSocketHandler)\n    log.Fatal(http.ListenAndServe(\"localhost:8080\", nil))\n}\n\nfunc WebSocketHandler(w http.ResponseWriter, r *http.Request) {\n    conn, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        log.Print(\"Error upgrading websocket:\", err)\n        return\n    }\n\n    defer conn.Close()\n\n    for {\n        err = conn.ReadJSON(&amp;query)\n        if err != nil {\n            log.Print(\"Error reading query: \", err)\n            return\n        }\n        .\n        // -- process query here --\n        .\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1042, "user_id": 5197662, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/EUWyw.jpg?s=128&g=1", "display_name": "Sep GH", "link": "https://stackoverflow.com/users/5197662/sep-gh"}, "is_accepted": false, "score": 0, "last_activity_date": 1523082617, "creation_date": 1523082617, "answer_id": 49704594, "question_id": 49704093, "link": "https://stackoverflow.com/questions/49704093/how-to-fix-a-server-failure-when-the-client-reloads-the-page/49704594#49704594", "title": "How to fix a server failure when the client reloads the page?", "body": "<p>If on page load websocket connects, then there are no worries. When page refreshes the client will connect to server. you can ignore the exception for websocket close 1001.</p>\n"}], "owner": {"reputation": 13, "user_id": 9502852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ffa84864009dd58da00af0bf3fdaf83?s=128&d=identicon&r=PG&f=1", "display_name": "Haknazar", "link": "https://stackoverflow.com/users/9502852/haknazar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 552, "favorite_count": 0, "accepted_answer_id": 49704278, "answer_count": 2, "score": 1, "last_activity_date": 1523082617, "creation_date": 1523077883, "question_id": 49704093, "link": "https://stackoverflow.com/questions/49704093/how-to-fix-a-server-failure-when-the-client-reloads-the-page", "title": "How to fix a server failure when the client reloads the page?", "body": "<p>When the client reloads the page, the server issues an error -\nwebsocket: close 1001 (going away).\nWhen the client reloads the page, does not the websocket connection reconnect?\nI recently started studying programming, so please forgive if the question is stupid.\nClient code</p>\n\n<pre><code>var socket = new WebSocket(\"ws://localhost:8080/ws\" );\n\nsocket.onmessage = function (event) {\n    DownloadScene(event)\n}\n\nfunction DownloadScene(event) {\n    var data = JSON.parse(event.data)\n    document.getElementById(data.id).innerHTML = data.body;\n}\nfunction  loadScene(scene) {\n  var page = {\n    query_type:\"loadScene\",\n    data : {temp:scene}\n}\n   var event = JSON.stringify(page);\n   socket.send(event);\n}\n</code></pre>\n\n<p>I'm using the gorilla websocket library to build a connection.</p>\n\n<p>Server code</p>\n\n<pre><code>func WebSocketHandler(w http.ResponseWriter, r *http.Request) {\n\n   conn, err := upGrader.Upgrade(w, r, nil)\n\n   if err != nil {\n      log.Println(err)\n      return\n   }\n   for { webSocketHandler(conn)}\n   defer conn.Close()\n}\n\nfunc webSocketHandler(conn *websocket.Conn) {\n\n  println(\"new connect\")\n  err := conn.ReadJSON(&amp;query)\n  if err != nil {\n      log.Fatal(err)\n      return\n  }\n  switch query.QueryType {\n  case \"loadScene\" :\n    err := json.Unmarshal(query.Data,&amp;frames)\n    if err!= nil{\n        log.Fatal(err)\n    }\n    var buf  bytes.Buffer\n    data := frame.ExecuteTemplate(&amp;buf,\"frame\",nil)\n    if data!=nil{\n        log.Fatal(data)\n    }\n    res,e := json.Marshal(&amp;Frame{\"scene\",buf.String()})\n    if e !=nil{\n        log.Println(e)\n    }\n\n    errs := conn.WriteMessage(1,res)\n    if err!=nil{\n        log.Fatal(errs)\n    }\n }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1523073670, "post_id": 49703588, "comment_id": 86420790, "body": "The reflect API does not provide a way to get the underlying type of some type.  In this example, there&#39;s not a way to get <code>reflect.TypeOf(int(0))</code> from a <code>reflect.TypeOf(Role(0))</code>.  You can use <a href=\"https://godoc.org/reflect#Type.Kind\" rel=\"nofollow noreferrer\">Type.Kind</a> to reflect on the underlying type.  Why do you need to get the <code>int</code> type?"}, {"owner": {"reputation": 25, "user_id": 3977282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d84707694211cb7498ad6b3be673e566?s=128&d=identicon&r=PG&f=1", "display_name": "Neal", "link": "https://stackoverflow.com/users/3977282/neal"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1523079949, "post_id": 49703588, "comment_id": 86421836, "body": "@CeriseLim&#243;n thanks,I neglected Kind() method."}], "answers": [{"tags": [], "owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "is_accepted": true, "score": 1, "last_activity_date": 1523080746, "creation_date": 1523080746, "answer_id": 49704408, "question_id": 49703588, "link": "https://stackoverflow.com/questions/49703588/how-to-get-struct-field-type-in-golang/49704408#49704408", "title": "how to get struct field type in golang?", "body": "<p>In Go <code>Kind()</code> returns the basic types (this is what you're asking for) and <code>Type()</code> returns the direct types (what you've defined as custom types). You'll never get the basic type from <code>Type()</code> for any custom types you've defined. I've modified your example a bit to help you understand that <code>Kind()</code> always returns the actual basic type (or kind of type, see <a href=\"https://golang.org/pkg/reflect/#Kind\" rel=\"nofollow noreferrer\">https://golang.org/pkg/reflect/#Kind</a>), despite many nested custom types. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Role int\ntype Role2 Role\ntype Role3 Role2\n\ntype User struct {\n    Id   int64\n    Name string\n    Role Role3\n}\n\nfunc ListFields(a interface{}) {\n    v := reflect.ValueOf(a).Elem()\n    for j := 0; j &lt; v.NumField(); j++ {\n        f := v.Field(j)\n        n := v.Type().Field(j).Name\n        t := f.Type().String()\n        fmt.Printf(\"Name: %s  Basic Type or Kind: %s  Direct or Custom Type: %s\\n\", n, f.Kind(), t)\n    }\n}\n\nfunc main() {\n\n    var u User\n    ListFields(&amp;u)\n}\n</code></pre>\n\n<p><a href=\"https://goplay.space/#-eTlN4dGzj_k\" rel=\"nofollow noreferrer\">https://goplay.space/#-eTlN4dGzj_k</a></p>\n\n<p>In other words both Kind and Type are types. They match for basic types (int64, string, etc.) and differ for custom types. There is no reason to substitute the Type value with Kind.</p>\n"}], "owner": {"reputation": 25, "user_id": 3977282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d84707694211cb7498ad6b3be673e566?s=128&d=identicon&r=PG&f=1", "display_name": "Neal", "link": "https://stackoverflow.com/users/3977282/neal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1929, "favorite_count": 0, "accepted_answer_id": 49704408, "answer_count": 1, "score": 1, "last_activity_date": 1523080746, "creation_date": 1523072469, "question_id": 49703588, "link": "https://stackoverflow.com/questions/49703588/how-to-get-struct-field-type-in-golang", "title": "how to get struct field type in golang?", "body": "<pre><code>type Role int\n\ntype User struct {\n    Id int64\n    Name string\n    Role Role\n}\n\nfunc ListFields(a interface{}) {\n    v := reflect.ValueOf(a).Elem()\n    for j := 0; j &lt; v.NumField(); j++ {\n        f := v.Field(j)\n        n := v.Type().Field(j).Name\n        t := f.Type().String()\n        fmt.Printf(\"Name: %s  Kind: %s  Type: %s\\n\", n, f.Kind(), t)\n    }\n}\n\nfunc main() {\n\n    var u User\n    ListFields(&amp;u)\n}\n</code></pre>\n\n<p>go run main.go</p>\n\n<p>Name: Id  Kind: int64  Type: int64</p>\n\n<p>Name: Name  Kind: string  Type: string</p>\n\n<p>Name: Role  Kind: int  Type: main.Role  &lt;--- how to get int type ?</p>\n"}, {"tags": ["api", "ssl", "go", "certificate", "backend"], "comments": [{"owner": {"reputation": 999, "user_id": 1584308, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YAV1v.png?s=128&g=1", "display_name": "hewiefreeman", "link": "https://stackoverflow.com/users/1584308/hewiefreeman"}, "edited": false, "score": 0, "creation_date": 1523066578, "post_id": 49702778, "comment_id": 86419728, "body": "You sure they&#39;re the same exact ones used by your web server? I had this same problem and it turned out I needed to use an absolute path from the root folder of the Ubuntu system to my Apache cert/key."}, {"owner": {"reputation": 227, "user_id": 6606971, "user_type": "registered", "accept_rate": 37, "profile_image": "https://graph.facebook.com/822957514504959/picture?type=large", "display_name": "Dex Sebas", "link": "https://stackoverflow.com/users/6606971/dex-sebas"}, "reply_to_user": {"reputation": 999, "user_id": 1584308, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YAV1v.png?s=128&g=1", "display_name": "hewiefreeman", "link": "https://stackoverflow.com/users/1584308/hewiefreeman"}, "edited": false, "score": 0, "creation_date": 1523067227, "post_id": 49702778, "comment_id": 86419838, "body": "Yes, of course. I mean, is my dedicated server and I have my web and my API there."}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523074971, "post_id": 49702778, "comment_id": 86420989, "body": "use <a href=\"https://www.ssllabs.com/ssltest/\" rel=\"nofollow noreferrer\">ssllabs.com/ssltest</a> to check your certificate, you can check both  <a href=\"https://www.example.com:8081/api/v1/users\" rel=\"nofollow noreferrer\">example.com:8081/api/v1/users</a> and  <a href=\"https://www.example.com:443\" rel=\"nofollow noreferrer\">example.com:443</a>, as some other server is running in your system. after making sure that your certificate is valid, I&#39;d recommend to find the other server, stop and disable it, and move your go app to 433"}, {"owner": {"reputation": 227, "user_id": 6606971, "user_type": "registered", "accept_rate": 37, "profile_image": "https://graph.facebook.com/822957514504959/picture?type=large", "display_name": "Dex Sebas", "link": "https://stackoverflow.com/users/6606971/dex-sebas"}, "edited": false, "score": 0, "creation_date": 1523076258, "post_id": 49702778, "comment_id": 86421170, "body": "For example.com is &#39;trusted&#39; but for 8081 &#39;Port 8081 is not supported &#39;"}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523076706, "post_id": 49702778, "comment_id": 86421231, "body": "let&#39;s try a simple example <a href=\"https://goplay.space/#gwFPRhwQ9dX\" rel=\"nofollow noreferrer\">goplay.space/#gwFPRhwQ9dX</a>  as you have some extra cors stuff, we have to ensure that it works in general"}, {"owner": {"reputation": 227, "user_id": 6606971, "user_type": "registered", "accept_rate": 37, "profile_image": "https://graph.facebook.com/822957514504959/picture?type=large", "display_name": "Dex Sebas", "link": "https://stackoverflow.com/users/6606971/dex-sebas"}, "edited": false, "score": 0, "creation_date": 1523077134, "post_id": 49702778, "comment_id": 86421300, "body": "The server works. I mean i can make request to example.com:8081/api/v1/some-route and it will work. But for example, I don&#39;t desactivate the SSL Verification in postman then this is not going to work."}, {"owner": {"reputation": 227, "user_id": 6606971, "user_type": "registered", "accept_rate": 37, "profile_image": "https://graph.facebook.com/822957514504959/picture?type=large", "display_name": "Dex Sebas", "link": "https://stackoverflow.com/users/6606971/dex-sebas"}, "edited": false, "score": 0, "creation_date": 1523079794, "post_id": 49702778, "comment_id": 86421803, "body": "Seems like my configuration for some reason is not working properly. The tls.crt and tls.key are the one that the I bought. I mean, is not self-signed certificates."}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523106639, "post_id": 49702778, "comment_id": 86428729, "body": "the whole point of my example above is to assure validity of your certificate, you should deploy it and check with <a href=\"https://www.ssllabs.com/ssltest/\" rel=\"nofollow noreferrer\">ssllabs.com/ssltest</a>. If you pass the test, then you can go back to your real api and find some other issues"}, {"owner": {"reputation": 227, "user_id": 6606971, "user_type": "registered", "accept_rate": 37, "profile_image": "https://graph.facebook.com/822957514504959/picture?type=large", "display_name": "Dex Sebas", "link": "https://stackoverflow.com/users/6606971/dex-sebas"}, "edited": false, "score": 0, "creation_date": 1523107222, "post_id": 49702778, "comment_id": 86428917, "body": "Yes, it show me a error \u201cPort 8081 is not supported\u201d"}, {"owner": {"reputation": 227, "user_id": 6606971, "user_type": "registered", "accept_rate": 37, "profile_image": "https://graph.facebook.com/822957514504959/picture?type=large", "display_name": "Dex Sebas", "link": "https://stackoverflow.com/users/6606971/dex-sebas"}, "edited": false, "score": 0, "creation_date": 1523110619, "post_id": 49702778, "comment_id": 86429941, "body": "I just used <a href=\"https://www.example.com/api/v1/index\" rel=\"nofollow noreferrer\">example.com/api/v1/index</a> and it works and show me a message that have a valid certificate: &#39;Verified by GoDaddy.com, Inc&#39; So I guess that the configuration of certificates in my golang app are okay"}, {"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1523113955, "post_id": 49702778, "comment_id": 86431001, "body": "if you managed to pass the test on port 443 with go server, then, I guess, the case is closed, as you struggled only when you were using 8081"}], "answers": [{"comments": [{"owner": {"reputation": 227, "user_id": 6606971, "user_type": "registered", "accept_rate": 37, "profile_image": "https://graph.facebook.com/822957514504959/picture?type=large", "display_name": "Dex Sebas", "link": "https://stackoverflow.com/users/6606971/dex-sebas"}, "edited": false, "score": 0, "creation_date": 1523198691, "post_id": 49716573, "comment_id": 86450994, "body": "Nginx can run on windows with IIS and plesk?"}, {"owner": {"reputation": 337, "user_id": 2110053, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/57005d8628cb2bf998af91ceea5bbc93?s=128&d=identicon&r=PG", "display_name": "Adi", "link": "https://stackoverflow.com/users/2110053/adi"}, "reply_to_user": {"reputation": 227, "user_id": 6606971, "user_type": "registered", "accept_rate": 37, "profile_image": "https://graph.facebook.com/822957514504959/picture?type=large", "display_name": "Dex Sebas", "link": "https://stackoverflow.com/users/6606971/dex-sebas"}, "edited": false, "score": 1, "creation_date": 1523268463, "post_id": 49716573, "comment_id": 86474282, "body": "By default IIS must be running on port 80. So, you can use a different port for Nginx. Please refer to this: <a href=\"https://stackoverflow.com/questions/10829402/how-to-start-nginx-via-different-portother-than-80\" title=\"how to start nginx via different portother than 80\">stackoverflow.com/questions/10829402/&hellip;</a>"}], "tags": [], "owner": {"reputation": 337, "user_id": 2110053, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/57005d8628cb2bf998af91ceea5bbc93?s=128&d=identicon&r=PG", "display_name": "Adi", "link": "https://stackoverflow.com/users/2110053/adi"}, "is_accepted": false, "score": 2, "last_activity_date": 1523180877, "creation_date": 1523180877, "answer_id": 49716573, "question_id": 49702778, "link": "https://stackoverflow.com/questions/49702778/golang-https-api/49716573#49716573", "title": "GoLang HTTPS API", "body": "<ol>\n<li><p>Run the whole Golang application behind nginx (reverse proxy):</p></li>\n<li><p>Create a Virtual Host Server Block in Nginx using your domain.\n<a href=\"https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-server-blocks-virtual-hosts-on-ubuntu-16-04\" rel=\"nofollow noreferrer\">https://www.digitalocean.com/community/tutorials/how-to-set-up-nginx-server-blocks-virtual-hosts-on-ubuntu-16-04</a></p></li>\n<li><p>Setup your SSL certs</p></li>\n<li><p>Point that domain to your Golang App </p>\n\n<pre><code>server {\n\n    server_name example.com;\n\n    location / {\n        proxy_pass http://localhost:8081;\n        proxy_http_version 1.1;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n        proxy_cache_bypass $http_upgrade;\n        proxy_pass_request_headers on;\n        proxy_read_timeout 150;\n   }\n\n    ssl_certificate /path/to/chainfile/example.com/abcd.pem;\n    ssl_certificate_key /path/to/privatekeyfile/example.com/abcd.pem;\n\n    if ($scheme != \"https\") {\n        return 301 https://$host$request_uri;\n    }\n}\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 227, "user_id": 6606971, "user_type": "registered", "accept_rate": 37, "profile_image": "https://graph.facebook.com/822957514504959/picture?type=large", "display_name": "Dex Sebas", "link": "https://stackoverflow.com/users/6606971/dex-sebas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1125, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1523180877, "creation_date": 1523062489, "question_id": 49702778, "link": "https://stackoverflow.com/questions/49702778/golang-https-api", "title": "GoLang HTTPS API", "body": "<p>I have a server in windows using Plesk.</p>\n\n<p>I have a domain (example.com), also I bought a SSL certificate for this domain.</p>\n\n<p>I just installed successfully and configure the domain and ssl in my server. So now I can join to my web using <a href=\"https://www.example.com\" rel=\"nofollow noreferrer\">https://www.example.com</a> or example.com and will be redirect to https://.... </p>\n\n<p>Until that everything works fine.</p>\n\n<p>But now I have been developed an API in GoLang which can\u2019t start to listen at 443 port for some reason. (I thought that maybe because is being already used ?) So I changed to 8081 port. Now when I want to make a request to my API I have to use <a href=\"https://www.example.com:8081/api/v1/users\" rel=\"nofollow noreferrer\">https://www.example.com:8081/api/v1/users</a> for example. </p>\n\n<p>The problem is that some applications show me a error \u201cCertificate invalid\u201d which I think is because the port is not 443.  Is there any way that I can run go in 443?</p>\n\n<p>The code in GO is this: (The crt and key are the ones provided by GoDaddy, is where I bought the SSL)</p>\n\n<pre><code>func main() {\n\nrouter := NewRouter()\n\n\n\nhandler := cors.AllowAll().Handler(router)\n\nlog.Fatal(http.ListenAndServeTLS(\":8081\", \"tls.crt\", \"tls.key\", handler))\n}\n</code></pre>\n"}, {"tags": ["go", "concurrency", "websocket", "synchronization", "gorilla"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1523056373, "post_id": 49702044, "comment_id": 86417967, "body": "Regarding 2) The for loop in <code>echo</code> calls <code>ReadMessage</code>.  Because this method blocks until a message is received, it&#39;s expected nothing happens until the client sends a message."}, {"owner": {"reputation": 999, "user_id": 1584308, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YAV1v.png?s=128&g=1", "display_name": "hewiefreeman", "link": "https://stackoverflow.com/users/1584308/hewiefreeman"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1523065847, "post_id": 49702044, "comment_id": 86419629, "body": "@CeriseLim&#243;n I was thinking something might have been blocking... Do you have any suggestions as to how to make it pass if nothing has been read? Likewise for the blocking of the <code>WriteJSON()</code>? Would you not recommend this for performance? I&#39;m thinking of a way to constantly listen to a channel to update variables set in the <code>echo()</code> goroutines"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1523067614, "post_id": 49702044, "comment_id": 86419901, "body": "Another issue is that there&#39;s a race setting values <code>guestMap</code>. Consider this time line: goroutine 1 calls guestMap.Load, goroutine 2 calls guestmap,Load, goroutine 1 calls guestMap.Store, goroutine 2 calls guestMap.Store.  The second goroutine clobbers the value set by the first goroutine.  I suggest starting from the <a href=\"https://github.com/gorilla/websocket/tree/master/examples/chat\" rel=\"nofollow noreferrer\">chat example</a>."}, {"owner": {"reputation": 999, "user_id": 1584308, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YAV1v.png?s=128&g=1", "display_name": "hewiefreeman", "link": "https://stackoverflow.com/users/1584308/hewiefreeman"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1523147486, "post_id": 49702044, "comment_id": 86439987, "body": "@CeriseLim&#243;n If I&#39;m not mistaken, isn&#39;t <code>sync.Map</code> supposed to handle storing queues for me? I haven&#39;t had a problem with simultaneous load/stores at all."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1523149220, "post_id": 49702044, "comment_id": 86440250, "body": "sync.Map does not synchronize your application logic.  See timeline in my previous comment where where the application will overwrite a value previously written by the application.  Separate from the map issue, you should run the application with the race detector."}], "answers": [{"tags": [], "owner": {"reputation": 999, "user_id": 1584308, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YAV1v.png?s=128&g=1", "display_name": "hewiefreeman", "link": "https://stackoverflow.com/users/1584308/hewiefreeman"}, "is_accepted": true, "score": 0, "last_activity_date": 1578051754, "last_edit_date": 1578051754, "creation_date": 1523666338, "answer_id": 49826785, "question_id": 49702044, "link": "https://stackoverflow.com/questions/49702044/syncing-websocket-loops-with-channels-in-golang/49826785#49826785", "title": "Syncing websocket loops with channels in Golang", "body": "<p>To answer my own question:</p>\n\n<p>First, I've switched from a sync.map to a normal map. Secondly, in order for nobody to be reading/writing to it at the same time I've made a channel that you call to do any read/write operation on the map. I've been trying my best to keep my data access and manipulation quick to execute so the channel doesn't get crowded so easily. Here's a small example of that:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nvar (\n  guestMap map[string]*guestStruct = make(map[string]*guestStruct);\n  guestMapActionChan = make (chan actionStruct);\n\n)\n\ntype actionStruct struct {\n    Action      func([]interface{})[]interface{}\n    Params      []interface{}\n    ReturnChan  chan []interface{}\n}\n\ntype guestStruct struct {\n    Name string\n    Numb int\n}\n\nfunc main(){\n    //make chan listener\n    go guestMapActionChanListener(guestMapActionChan)\n\n    //some guest logs in...\n    newGuest := guestStruct{Name: \"Larry Josher\", Numb: 1337}\n\n    //add to the map\n    addRetChan := make(chan []interface{})\n    guestMapActionChan &lt;- actionStruct{Action: guestMapAdd,\n                                       Params: []interface{}{&amp;newGuest},\n                                       ReturnChan: addRetChan}\n    addReturned := &lt;-addRetChan\n\n    fmt.Println(addReturned)\n    fmt.Println(\"Also, numb was changed by listener to:\", newGuest.Numb)\n\n    // Same kind of thing for removing, except (of course) there's\n    // a lot more logic to a real-life application.\n}\n\nfunc guestMapActionChanListener (c chan actionStruct){\n    for{\n        value := &lt;-c;\n        //\n        returned := value.Action(value.Params);\n        value.ReturnChan &lt;- returned;\n        close(value.ReturnChan)\n    }\n}\n\nfunc guestMapAdd(params []interface{}) []interface{} {\n    //.. do some parameter verification checks\n    theStruct := params[0].(*guestStruct)\n    name := theStruct.Name\n    theStruct.Numb = 75\n    guestMap[name] = &amp;*theStruct\n\n    return []interface{}{\"Added '\"+name+\"' to the guestMap\"}\n}\n</code></pre>\n\n<p>For communication between connections, I just have each socket loop hold onto their <code>guestStruct</code>, and have more <code>guestMapActionChan</code> functions that take care of distributing data to other guests' <code>guestStruct</code>s</p>\n\n<p>Now, I'm not going to mark this as the correct answer unless I get some better suggestions as how to do something like this the right way. But for now this is working and <em>should</em> guarantee no races for reading/writing to the map.</p>\n\n<p>Edit: The correct approach should really have been to just use a <code>sync.Mutex</code> like I do in the (mostly) finished project <a href=\"https://github.com/hewiefreeman/GopherGameServer\" rel=\"nofollow noreferrer\">GopherGameServer</a></p>\n"}], "owner": {"reputation": 999, "user_id": 1584308, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YAV1v.png?s=128&g=1", "display_name": "hewiefreeman", "link": "https://stackoverflow.com/users/1584308/hewiefreeman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1665, "favorite_count": 0, "accepted_answer_id": 49826785, "answer_count": 1, "score": 0, "last_activity_date": 1578051754, "creation_date": 1523055744, "last_edit_date": 1525895002, "question_id": 49702044, "link": "https://stackoverflow.com/questions/49702044/syncing-websocket-loops-with-channels-in-golang", "title": "Syncing websocket loops with channels in Golang", "body": "<p>I'm facing a dilemma here trying to keep certain websockets in sync for a given user. Here's the basic setup:</p>\n\n<pre><code>type msg struct {\n    Key         string\n    Value   string\n}\n\ntype connStruct struct {\n    //...\n\n    ConnRoutineChans []*chan string\n    LoggedIn        bool\n    Login       string\n\n    //...\n\n    Sockets         []*websocket.Conn\n}\n\nvar (\n    //...\n\n    /*  LIST OF CONNECTED USERS AN THEIR IP ADDRESSES  */\n\n        guestMap sync.Map\n\n)\n\nfunc main() {\n    post(\"Started...\")\n    rand.Seed(time.Now().UTC().UnixNano())\n    http.HandleFunc(\"/wss\", wsHandler)\n    panic(http.ListenAndServeTLS(\"...\", \"...\", \"...\", nil))\n}\n\nfunc wsHandler(w http.ResponseWriter, r *http.Request) {\n    if r.Header.Get(\"Origin\")+\":8080\" != \"https://...:8080\" {\n        http.Error(w, \"Origin not allowed\", 403)\n        fmt.Println(\"Client origin not allowed! (https://\"+r.Host+\")\")\n        fmt.Println(\"r.Header Origin: \"+r.Header.Get(\"Origin\"))\n        return\n    }\n    ///\n    conn, err := websocket.Upgrade(w, r, w.Header(), 1024, 1024)\n    if err != nil {\n        http.Error(w, \"Could not open websocket connection\", http.StatusBadRequest)\n        fmt.Println(\"Could not open websocket connection with client!\")\n    }\n\n    //ADD CONNECTION TO guestMap IF CONNECTION IS nil\n    var authString string = /*gets device identity*/;\n    var authChan chan string = make(chan string);\n    authValue, authOK := guestMap.Load(authString);\n    if !authOK {\n        // NO SESSION, CREATE A NEW ONE\n        newSession = getSession();\n        //defer newSession.Close();\n        guestMap.Store(authString, connStruct{ LoggedIn: false,\n                                ConnRoutineChans: []*chan string{&amp;authChan},\n                                         Login: \"\",\n                                        Sockets: []*websocket.Conn{conn}\n                                        /* .... */ });\n    }else{\n        //SESSION STARTED, ADD NEW SOCKET TO Sockets\n        var tempConn connStruct = authValue.(connStruct);\n        tempConn.Sockets = append(tempConn.Sockets, conn);\n        tempConn.ConnRoutineChans = append(tempConn.ConnRoutineChans, &amp;authChan)\n        guestMap.Store(authString, tempConn);\n    }\n\n    //\n    go echo(conn, authString, &amp;authChan);\n}\n\nfunc echo(conn *websocket.Conn, authString string, authChan *chan string) {\n\n    var message msg;\n\n    //TEST CHANNEL\n    authValue, _ := guestMap.Load(authString);\n    go sendToChans(authValue.(connStruct).ConnRoutineChans, \"sup dude?\")\n\n    fmt.Println(\"got past send...\");\n\n    for true {\n        select {\n            case val := &lt;-*authChan:\n                // use value of channel\n                fmt.Println(\"AuthChan for user #\"+strconv.Itoa(myConnNumb)+\" spat out: \", val)\n            default:\n                // if channels are empty, this is executed\n        }\n\n        readError := conn.ReadJSON(&amp;message)\n        fmt.Println(\"got past readJson...\");\n\n        if readError != nil || message.Key == \"\" {\n            //DISCONNECT USER\n            //.....\n            return\n        }\n\n        //\n        _key, _value := chief(message.Key, message.Value, &amp;*conn, browserAndOS, authString)\n\n        if writeError := conn.WriteJSON(_key + \"|\" + _value); writeError != nil {\n            //...\n            return\n        }\n\n        fmt.Println(\"got past writeJson...\");\n    }\n}\n\nfunc sendToChans(chans []*chan string, message string){\n    for i := 0; i &lt; len(chans); i++ {\n        *chans[i] &lt;- message\n    }\n}\n</code></pre>\n\n<p>I know, a big block of code eh? And I commented out most of it...</p>\n\n<p>Anyway, if you've ever used a websocket most of it should be quite familiar:</p>\n\n<p>1) <code>func wsHandler()</code> fires every time a user connects. It makes an entry in <code>guestMap</code> (for each unique device that connects) which holds a <code>connStruct</code> which holds a list of channels: <code>ConnRoutineChans []*chan string</code>. This all gets passed to:</p>\n\n<p>2) <code>echo()</code>, which is a goroutine that constantly runs for each websocket connection. Here I'm just testing out sending a message to other running goroutines, but it seems my for loop isn't actually constantly firing. It only fires when the websocket receives a message from the open tab/window it's connected to. (If anyone can clarify this mechanic, I'd love to know why it's not looping constantly?)</p>\n\n<p>3) For each window or tab that the user has open on a given device there is a websocket and channel stored in an arrays. I want to be able to send a message to all the channels in the array (essentially the other goroutines for open tabs/windows on that device) and receive the message in the other goroutines to change some variables set in the constantly running goroutine.</p>\n\n<p>What I have right now works only for the very first connection on a device, and (of course) it sends \"sup dude?\" to itself since it's the only channel in the array at the time. Then if you open a new tab (or even many), the message doesn't get sent to anyone at all! Strange?... Then when I close all the tabs (and my commented out logic removes the device item from <code>guestMap</code>) and start up a new device session, still only the first connection gets it's own message.</p>\n\n<p>I already have a method for sending a message to all the other websockets on a device, but sending to a goroutine seems to be a little more tricky than I thought.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "is_accepted": true, "score": 0, "last_activity_date": 1523118599, "creation_date": 1523118599, "answer_id": 49709524, "question_id": 49702012, "link": "https://stackoverflow.com/questions/49702012/variable-mirroring-other-ones/49709524#49709524", "title": "Variable mirroring other ones", "body": "<p>this line to copy the user </p>\n\n<pre><code>data[event.Chat].Data.User[user] = default_user\n</code></pre>\n\n<p>made a <strong>reference</strong> to it, I don't know why I didn't spot it earlier. I replaced it with this code</p>\n\n<pre><code>for k, v := range data[event.Chat].Data.User[\"default\"] {\n    data[event.Chat].Data.User[user][k] = v \n} \n</code></pre>\n\n<p>and it worked perfectly.</p>\n"}], "owner": {"reputation": 467, "user_id": 8761914, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/24e93f0d9539d0b42c1458a329cb9629?s=128&d=identicon&r=PG&f=1", "display_name": "Peter S", "link": "https://stackoverflow.com/users/8761914/peter-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 49709524, "answer_count": 1, "score": 0, "last_activity_date": 1523118599, "creation_date": 1523055491, "last_edit_date": 1523101944, "question_id": 49702012, "link": "https://stackoverflow.com/questions/49702012/variable-mirroring-other-ones", "title": "Variable mirroring other ones", "body": "<p>So I have created a simple chat bot, and I'm having trouble with one of it's commands, <code>/resetall</code>. It is supposed to change every users values to the values of the user \"default\". However, it seems that default is causing all values to change by 2. </p>\n\n<pre><code>\"data\": {\n    \"user\": {\n        \"bob\": {\n            \"admin\": \"true\",\n            \"consecutiveCommands\": \"0\",\n            \"nickname\": \"\", \n            \"sentMessages\": \"2\" \n        },  \n        \"default\": {\n            \"admin\": \"true\",\n            \"consecutiveCommands\": \"0\",\n            \"nickname\": \"\", \n            \"sentMessages\": \"2\" \n        },  \n        \"me\": {\n            \"admin\": \"true\",\n            \"consecutiveCommands\": \"0\",\n            \"nickname\": \"\", \n            \"sentMessages\": \"2\" \n        },  \n        \"total\": {\n            \"admin\": \"true\",\n            \"consecutiveCommands\": \"0\",\n            \"nickname\": \"\", \n            \"sentMessages\": \"2\" \n        }   \n    },  \n    \"chat\": {\n        \"commandSender\": \"me\",\n        \"lastImage\": \"\", \n        \"lastMessage\": \"/pong\",\n        \"lastSender\": \"me\",\n        \"lastTimestamp\": \"11:59\",\n        \"wasCommand\": \"true\"\n    }\n}\n</code></pre>\n\n<p>and my go code:</p>\n\n<pre><code>// each incoming message\ntype Message struct {\n        Message   string\n        From      string\n        Chat      string\n        Timestamp string\n        IsCommand bool\n}\n//adds one to a string\nfunc addOne(s string) string {\n        i, _ := strconv.Atoi(s)\n        return strconv.Itoa(i + 1)\n}\n//counts messages sent\nfunc messageCounter(data map[string]Chat, event *Message) map[string]Chat {\n        //counts messages sent by user\n        data[event.Chat].Data.User[event.From][\"sentMessages\"] = addOne(data[event.Chat].Data.User[event.From][\"sentMessages\"])\n        data[event.Chat].Data.User[\"total\"][\"sentMessages\"] = addOne(data[event.Chat].Data.User[\"total\"][\"sentMessages\"])\n        return data\n}\n//sets variables for future use / other functions\nfunc eventRecorder(data map[string]Chat, event *Message) map[string]Chat {\n        if !event.IsCommand {\n                data[event.Chat].Data.Chat[\"lastMessage\"] = event.Message\n                data[event.Chat].Data.Chat[\"lastSender\"] = event.From\n                data[event.Chat].Data.Chat[\"lastTimestamp\"] = event.Timestamp\n                data[event.Chat].Data.Chat[\"wasCommand\"] = \"false\"\n        } else {\n                data[event.Chat].Data.Chat[\"wasCommand\"] = \"true\"\n                data[event.Chat].Data.Chat[\"commandSender\"] = event.From\n        }\n        return data\n}\n//supposed to set all users data to the default user\nfunc resetall(event *Message, data map[string]Chat) (error, map[string]Chat) {\n        default_user := data[event.Chat].Data.User[\"default\"]\n        if data[event.Chat].Data.User[event.From][\"admin\"] == \"true\" {\n                for user, _ := range data[event.Chat].Data.User {\n                        if user != \"default\" {\n                                data[event.Chat].Data.User[user] = default_user\n                                print(user + \"\\n\")\n                        }   \n                }   \n\n                return nil, data\n        }   \n        return errors.New(\"don't have permission\")), data\n}\nfunc main() {\n        processingFuncs := []func(map[string]Chat, *Message) map[string]Chat{\n                messageCounter,\n                eventRecorder,\n        }   \n        data, _ := readsettings() //reads the data from a json file\n        event := &amp;Message{\"/resetall\", \"me\", \"chat123\", \"11:59\", false}\n        if strings.Split(event.Message, \" \")[0] == \"/resetall\" {\n                event.IsCommand = true\n                _, data = resetall(event, data)\n                fmt.Println(\"success\")\n        }   \n        for _, processingFunc := range processingFuncs {\n                processingFunc(data, event)\n        }   \n        writesettings(data) //writes the data to a json file\n}\n</code></pre>\n\n<p>So if I set everyone's message counter to 0 and run it, it sets every single user's message counter to 2 (including default). Each time I run it, the value increases by 2. Can anyone help explain why this is happening</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3201, "user_id": 1875092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1182c2dfe8c91c9623e09d6c8fdf87b0?s=128&d=identicon&r=PG", "display_name": "jsageryd", "link": "https://stackoverflow.com/users/1875092/jsageryd"}, "edited": false, "score": 2, "creation_date": 1523052872, "post_id": 49701658, "comment_id": 86416939, "body": "Why is the conditional you mention not an option?"}, {"owner": {"reputation": 38, "user_id": 7958366, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-cUtgaqlwAuc/AAAAAAAAAAI/AAAAAAAAASY/T6t8zh7KIIE/photo.jpg?sz=128", "display_name": "Eric Meier", "link": "https://stackoverflow.com/users/7958366/eric-meier"}, "reply_to_user": {"reputation": 3201, "user_id": 1875092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1182c2dfe8c91c9623e09d6c8fdf87b0?s=128&d=identicon&r=PG", "display_name": "jsageryd", "link": "https://stackoverflow.com/users/1875092/jsageryd"}, "edited": false, "score": 0, "creation_date": 1523053637, "post_id": 49701658, "comment_id": 86417196, "body": "Because I want to do it with quite large structs and there has to be a better solution."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1523135874, "post_id": 49701658, "comment_id": 86437660, "body": "The only way to do it without explicitly checking every field is with reflection. See <a href=\"https://golang.org/pkg/reflect\" rel=\"nofollow noreferrer\">golang.org/pkg/reflect</a>."}], "answers": [{"tags": [], "owner": {"reputation": 1655, "user_id": 8682074, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1739167192766622/picture?type=large", "display_name": "John Balvin Arias", "link": "https://stackoverflow.com/users/8682074/john-balvin-arias"}, "is_accepted": false, "score": 2, "last_activity_date": 1523264367, "creation_date": 1523264367, "answer_id": 49729138, "question_id": 49701658, "link": "https://stackoverflow.com/questions/49701658/only-update-non-empty-struct-fields-in-golang/49729138#49729138", "title": "Only update non empty struct fields in golang", "body": "<p>What if you just restructured your code</p>\n\n<pre><code>type ProfilePayload struct {\n    Email      string `json:\"email,omitempty\"`\n    GivenName  string `json:\"given_name,omitempty\"`\n    FamilyName string `json:\"family_name,omitempty\"`\n    PictureURL string `json:\"picture,omitempty\"`\n    Nickname   string `json:\"nickname,omitempty\"` \n}\ntype UserAccount struct {\n    Id         string `json:\"id\" binding:\"required\"`\n    Enrolled   bool   `json:\"enrolled\" binding:\"required\"`\n    ProfilePayload //now it has all the fields from ProfilePayload\n}\n</code></pre>\n\n<p>When decoding to json you just decode it to UserAccount, and then you can extract ProfilePayload from UserAccount if you want </p>\n"}], "owner": {"reputation": 38, "user_id": 7958366, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-cUtgaqlwAuc/AAAAAAAAAAI/AAAAAAAAASY/T6t8zh7KIIE/photo.jpg?sz=128", "display_name": "Eric Meier", "link": "https://stackoverflow.com/users/7958366/eric-meier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1523264367, "creation_date": 1523052787, "question_id": 49701658, "link": "https://stackoverflow.com/questions/49701658/only-update-non-empty-struct-fields-in-golang", "title": "Only update non empty struct fields in golang", "body": "<p>Is there an easy way to only update non-nil/empty fields in go(-lang)?</p>\n\n<p>Given these two structs: </p>\n\n<pre><code>type UserAccount struct {\n    Id         string `json:\"id\" binding:\"required\"`\n    Enrolled   bool   `json:\"enrolled\" binding:\"required\"`\n    Email      string `json:\"email\" binding:\"required\"`\n    GivenName  string `json:\"given_name\" binding:\"required\"`\n    FamilyName string `json:\"family_name\" binding:\"required\"`\n    PictureURL string `json:\"picture\" binding:\"required\"`\n    Nickname   string `json:\"nickname\" binding:\"required\"`\n}\ntype ProfilePayload struct {\n    Email      string `json:\"email,omitempty\"`\n    GivenName  string `json:\"given_name,omitempty\"`\n    FamilyName string `json:\"family_name,omitempty\"`\n    PictureURL string `json:\"picture,omitempty\"`\n    Nickname   string `json:\"nickname,omitempty\"` \n}\n</code></pre>\n\n<p>Is it possible to only update non-nil fields in an UserAccount struct. For example, all fields except Email are nil/empty in a ProfilePayload, is there an easy way to \"merge\" them together and only set the Email field in a UserAccount to a new value and keeping everything else in the UserAccount the same?</p>\n\n<pre><code>if payload.Email != \"\" {\n    account.Email = payload.Email\n}\n....\n</code></pre>\n\n<p>Isn\u00b4t really an option for me.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1790, "user_id": 204406, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e5fc2adfaf7d787593faf6b78250be12?s=128&d=identicon&r=PG&f=1", "display_name": "drack", "link": "https://stackoverflow.com/users/204406/drack"}, "edited": false, "score": 0, "creation_date": 1523052375, "post_id": 49701569, "comment_id": 86416771, "body": "That errors with: <code>invalid type assertion: c[&quot;production&quot;].(map[string]&lt;inter&gt;) (non-interface type map[string]interface {} on left)</code> and <code>c[&quot;production&quot;]</code> is of type <code>map[string]interface {}</code>"}, {"owner": {"reputation": 1790, "user_id": 204406, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e5fc2adfaf7d787593faf6b78250be12?s=128&d=identicon&r=PG&f=1", "display_name": "drack", "link": "https://stackoverflow.com/users/204406/drack"}, "edited": false, "score": 0, "creation_date": 1523052603, "post_id": 49701569, "comment_id": 86416850, "body": "<code>c[&quot;production&quot;][&quot;host&quot;].(map[string]string)</code> is what I needed. Thanks! I went through that document a few times but I guess it didn&#39;t sink in."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1523053267, "last_edit_date": 1523053267, "creation_date": 1523052240, "answer_id": 49701569, "question_id": 49701482, "link": "https://stackoverflow.com/questions/49701482/invalid-operation-type-interface-does-not-support-indexing/49701569#49701569", "title": "invalid operation: (type interface {} does not support indexing)", "body": "<p>Use a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> to get the <code>map[string]string</code> value:</p>\n\n<pre><code>host, ok := c[\"production\"][\"host\"].(map[string]string)\nif !ok {\n   // handle error\n}\nfmt.Printf(\"host: %+v: %T\\n\", host[\"reader\"], host)\n</code></pre>\n"}], "owner": {"reputation": 1790, "user_id": 204406, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e5fc2adfaf7d787593faf6b78250be12?s=128&d=identicon&r=PG&f=1", "display_name": "drack", "link": "https://stackoverflow.com/users/204406/drack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2757, "favorite_count": 0, "accepted_answer_id": 49701569, "answer_count": 1, "score": 2, "last_activity_date": 1523053267, "creation_date": 1523051773, "question_id": 49701482, "link": "https://stackoverflow.com/questions/49701482/invalid-operation-type-interface-does-not-support-indexing", "title": "invalid operation: (type interface {} does not support indexing)", "body": "<p>I have a function (Load) that creates a map of maps with config for different environments and returns YamlConfig type.</p>\n\n<pre><code>var config = make(map[string]interface{})\n\ntype YamlConfig map[string]map[string]interface{}\n\ntype environments struct {\n    Test        map[string]interface{}\n    Development map[string]interface{}\n    Qa          map[string]interface{}\n    Staging     map[string]interface{}\n    Production  map[string]interface{}\n    Brandconsol map[string]interface{}\n}\n\nfunc Load(path string) YamlConfig {\n    var config = YamlConfig{}\n    var env = environments{}\n\n    data, err := ioutil.ReadFile(path)\n    if err != nil {\n        errors.Annotate(err, \"error reading yaml file\")\n    }\n\n    err = yaml.Unmarshal(data, &amp;env)\n    if err != nil {\n        errors.Annotate(err, \"error unmarshaling yaml data\")\n    }\n\n    config = make(map[string]interface{})\n    assignToMultiMap(config, env.Production)\n    config[\"production\"] = config\n\n    ...\n\n    return config\n\n}\n\nfunc assignToMultiMap(config map[string]interface{}, converted map[string]interface{}) {\n    fmt.Println(\"converted\", converted)\n    for k, v := range converted {\n        if reflect.TypeOf(v).Kind() == reflect.Map {\n            m := make(map[string]string)\n            v := v.(map[interface{}]interface{})\n            for kk, vv := range v {\n                m[kk.(string)] = vv.(string)\n            }\n            config[strings.ToLower(k)] = m\n            continue\n        }\n        config[strings.ToLower(k)] = parseErb(fmt.Sprintf(\"%v\", v))\n    }\n}\n\nfunc parseErb(value string) string {\n    if len(value) &gt; 0 {\n        re := regexp.MustCompile(\"&lt;%=\\\\s+ENV\\\\['(.+)']\\\\s+%&gt;\")\n        match := re.FindStringSubmatch(value)\n        if len(match) == 2 {\n            value = os.Getenv(match[1])\n        }\n    }\n\n    return value\n}\n</code></pre>\n\n<p>When I try to use this, however I'm getting the error: invalid operation: host[\"reader\"] (type interface {} does not support indexing)</p>\n\n<p>But host is of type <code>map[string]string</code></p>\n\n<pre><code>c := config.Load(\"config/database.yml\")\nhost := c[\"production\"][\"host\"]\nfmt.Printf(\"host: %+v: %T\\n\", host[\"reader\"], host)\n</code></pre>\n\n<p>fmt.Printf(\"%T\\n\", host) gives me map[string]string</p>\n"}, {"tags": ["unit-testing", "go", "channel"], "comments": [{"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1523048579, "post_id": 49700226, "comment_id": 86415368, "body": "Can you try to change <code>out</code> channel to both send/receive, instead of just send-only?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1523048688, "post_id": 49700226, "comment_id": 86415411, "body": "I think you&#39;re missing something here that is consuming your channel value, possibly <code>eventFilter</code> running from another test? You also have no way to ensure that event filter has returned; and having a sleep in your test is a sign that you may not be properly synchronizing things."}, {"owner": {"reputation": 1172, "user_id": 4621508, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/7edbd50ad77354c926f108838b77b938?s=128&d=identicon&r=PG&f=1", "display_name": "rumdrums", "link": "https://stackoverflow.com/users/4621508/rumdrums"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1523049232, "post_id": 49700226, "comment_id": 86415632, "body": "@JimB The eventFilter function is supposed to run in a loop, so it shouldn&#39;t ever return, which is why I block on the channel receive in the 2nd-to-last line. Point taken on the sleep calls, which are dirty but also what is used in the main library for the same purpose, so I assumed it was needed, given that I&#39;m depending on the file system: <a href=\"https://github.com/fsnotify/fsnotify/blob/master/integration_test.go\" rel=\"nofollow noreferrer\">github.com/fsnotify/fsnotify/blob/master/integration_test.go</a>"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1523231624, "post_id": 49700226, "comment_id": 86461660, "body": "Try adding a default case <a href=\"https://gobyexample.com/non-blocking-channel-operations\" rel=\"nofollow noreferrer\">gobyexample.com/non-blocking-channel-operations</a>, right now your select block is blocking"}], "owner": {"reputation": 1172, "user_id": 4621508, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/7edbd50ad77354c926f108838b77b938?s=128&d=identicon&r=PG&f=1", "display_name": "rumdrums", "link": "https://stackoverflow.com/users/4621508/rumdrums"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1523101963, "creation_date": 1523044906, "last_edit_date": 1523101963, "question_id": 49700226, "link": "https://stackoverflow.com/questions/49700226/channel-race-condition", "title": "Channel race condition", "body": "<p>I'm trying to write tests for a simple program that reads events from the inotify bus, filters them, then puts them on a channel. I have seen no issues when actually running the code, but in the last line of the following test, it will occasionally deadlock (about 30% of the time) on reading from that channel, even though as best I can tell, the event is <em>always</em> being put on the channel.</p>\n\n<p>Here is the function:</p>\n\n<pre><code>func eventFilter(watcher *rfsnotify.RWatcher, excludes []string, out chan&lt;- fsnotify.Event) {\n    for {\n        select {\n        case event := &lt;-watcher.Events:\n            log.Debug(fmt.Sprintf(\"Got event %v\", event))\n            if isExcluded(event.Name, excludes) {\n                log.Info(\"Ignoring excluded file: %v\", event)\n            } else if isRelevantOp(event) {\n                log.Info(fmt.Sprintf(\"Handling event %v\", event))\n                out &lt;- event\n            } else {\n                log.Info(fmt.Sprintf(\"Ignoring event %v\", event))\n            }\n        case err := &lt;-watcher.Errors:\n            log.Error(fmt.Sprintf(\"Error: %v\", err))\n        }\n    }\n}\n</code></pre>\n\n<p>Here is the testing code:</p>\n\n<pre><code>var hook *logrusTest.Hook\nvar testDir string\nvar rWatcher *rfsnotify.RWatcher\n\n\nfunc TestMain(m *testing.M) {\n    // initialize bad globals, amongst other things\n    log.SetLevel(log.DebugLevel)\n    hook = logrusTest.NewGlobal()\n\n    // Create directory to watch\n    testDir = tempMkdir()\n    defer os.RemoveAll(testDir)\n\n    rWatcher, _ = rfsnotify.NewWatcher()\n    defer rWatcher.Close()\n\n    err := rWatcher.AddRecursive(testDir)\n    if err != nil {\n        log.Fatal(\"Failed to add watcher: \", err)\n    }\n\n    os.Exit(m.Run())\n}\n\nfunc TestEventFilterMove(t *testing.T) {\n\n    ch := make(chan fsnotify.Event, 10)\n    go eventFilter(rWatcher, []string{\"test\"}, ch)\n    testFileSrc := filepath.Join(testDir, \"TestFsnotifyEvents.testfileSrc\")\n    testFileDest := filepath.Join(testDir, \"TestFsnotifyEvents.testfileDest\")\n\n    f, err := os.OpenFile(testFileSrc, os.O_WRONLY|os.O_CREATE, 0666)\n    if err != nil {\n        t.Fatalf(\"creating test file failed: %s\", err)\n    }\n\n    f.WriteString(\"data\")\n    f.Sync()\n    hook.Reset()\n\n    err = os.Rename(testFileSrc, testFileDest)\n    if err != nil {\n        t.Fatalf(\"renaming test file failed: %s\", err)\n    }\n\n    time.Sleep(100 * time.Millisecond)\n\n    expectedLogs := []string{\n        fmt.Sprintf(\"Got event \\\"%v\\\": CREATE|UPDATE\", testFileDest),\n        fmt.Sprintf(\"Handling event \\\"%v\\\": CREATE|UPDATE\", testFileDest),\n        fmt.Sprintf(\"Got event \\\"%v\\\": RENAME\", testFileSrc),\n        fmt.Sprintf(\"Ignoring event \\\"%v\\\": RENAME\", testFileSrc),\n    }\n    var actualLogs []string\n    for _, logEntry := range hook.AllEntries() {\n        actualLogs = append(actualLogs, logEntry.Message)\n    }\n    assert.ElementsMatch(t, actualLogs, expectedLogs)\n    hook.Reset()\n    _ = &lt;-ch\n    assert.Equal(t, 0, len(ch))\n\n}\n</code></pre>\n"}, {"tags": ["macos", "docker", "go", "alpine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523041611, "post_id": 49699092, "comment_id": 86412240, "body": "I&#39;m not able to replicate the issue. Have you tried building without CGO? Have you tried building with <code>-x</code> to see if it&#39;s a build time failure, and what command might have failed? Have you made sure you have the latest alpine image?"}, {"owner": {"reputation": 1525, "user_id": 274993, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01c81d75866cf2dafec13ca9bda43a50?s=128&d=identicon&r=PG", "display_name": "Krishna K", "link": "https://stackoverflow.com/users/274993/krishna-k"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523050588, "post_id": 49699092, "comment_id": 86416157, "body": "Without CGO fails with same error.  It&#39;s a build time failure.  Added output to description.  Thanks."}], "answers": [{"tags": [], "owner": {"reputation": 1525, "user_id": 274993, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01c81d75866cf2dafec13ca9bda43a50?s=128&d=identicon&r=PG", "display_name": "Krishna K", "link": "https://stackoverflow.com/users/274993/krishna-k"}, "is_accepted": true, "score": 1, "last_activity_date": 1523301718, "creation_date": 1523301718, "answer_id": 49740195, "question_id": 49699092, "link": "https://stackoverflow.com/questions/49699092/golangalpine-docker-container-on-macos-throws-invalid-symbol-version-for-go-st/49740195#49740195", "title": "golang:alpine docker container on macOS throws &quot;invalid symbol version for go.string&quot; when importing gin-gonic/gin", "body": "<p>It got resolved after I reset docker to factory defaults.</p>\n\n<p><a href=\"https://i.stack.imgur.com/2a0Fw.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/2a0Fw.png\" alt=\"Reset Docker\"></a></p>\n"}], "owner": {"reputation": 1525, "user_id": 274993, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01c81d75866cf2dafec13ca9bda43a50?s=128&d=identicon&r=PG", "display_name": "Krishna K", "link": "https://stackoverflow.com/users/274993/krishna-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "accepted_answer_id": 49740195, "answer_count": 1, "score": 1, "last_activity_date": 1523301718, "creation_date": 1523039698, "last_edit_date": 1523050477, "question_id": 49699092, "link": "https://stackoverflow.com/questions/49699092/golangalpine-docker-container-on-macos-throws-invalid-symbol-version-for-go-st", "title": "golang:alpine docker container on macOS throws &quot;invalid symbol version for go.string&quot; when importing gin-gonic/gin", "body": "<p>I am trying to run a very simple go/gin program on golang:alpine docker image.  This fails to run/build.</p>\n\n<p>Run container:</p>\n\n<pre><code>docker run -it --rm golang:1.10.1-alpine sh\n</code></pre>\n\n<p>In the container paste:</p>\n\n<pre><code>apk update &amp;&amp; apk add git gcc musl-dev\n\ngo get github.com/gin-gonic/gin\n\ncat &lt;&lt;EOT &gt; src/main.go\npackage main\nimport _ \"github.com/gin-gonic/gin\"\nfunc main() {\n}\nEOT\n\ngo run src/main.go\n</code></pre>\n\n<p>The error:</p>\n\n<pre><code># command-line-arguments\n2018/04/06 18:07:33 invalid symbol version for \"go.string.\\\"aa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e082542a3855\\xdb\\x0f\\x849\\x0e\\x00\\x00H\\x8b[\\bH\\x83\\xfb\\x01\\x0f\\x8f\\x17\\r\\x00\\x00H\\x8bH H\\x85\\xc9\\x0f\\x84\\x01\": -7\n</code></pre>\n\n<hr>\n\n<p>Host Machine: <code>macOS High Sierra 10.13.3, MacBook Pro Mid 2014, Intel i5</code> </p>\n\n<p>Docker version: </p>\n\n<pre><code>Client:\n Version:   18.03.0-ce\n API version:   1.37\n Go version:    go1.9.4\n Git commit:    0520e24\n Built: Wed Mar 21 23:06:22 2018\n OS/Arch:   darwin/amd64\n Experimental:  false\n Orchestrator:  swarm\n\nServer:\n Engine:\n  Version:  18.03.0-ce\n  API version:  1.37 (minimum version 1.12)\n  Go version:   go1.9.4\n  Git commit:   0520e24\n  Built:    Wed Mar 21 23:14:32 2018\n  OS/Arch:  linux/amd64\n  Experimental: false\n</code></pre>\n\n<hr>\n\n<p>This works <strong>without error on golang/stretch</strong> image, though:</p>\n\n<pre><code>\u2717 dk run -it --rm golang:1.10.1-stretch bash                                        11:24AM\nroot@5d98f42504c2:/go# go get github.com/gin-gonic/gin\nroot@5d98f42504c2:/go#\nroot@5d98f42504c2:/go# cat &lt;&lt;EOT &gt; src/main.go\n&gt; package main\n&gt; import _ \"github.com/gin-gonic/gin\"\n&gt; func main() {\n&gt; }\n&gt; EOT\nroot@5d98f42504c2:/go#\nroot@5d98f42504c2:/go# go run src/main.go\nroot@5d98f42504c2:/go#\n</code></pre>\n\n<hr>\n\n<p>What could be going wrong with alpine?  Any suggestion is appreciated.</p>\n\n<hr>\n\n<p><strong>More Information</strong></p>\n\n<p>Same error with CGO disabled.</p>\n\n<p>This is a build time failure and with -x option fails at:</p>\n\n<pre><code>EOF\nmkdir -p $WORK/b001/exe/\ncd .\n/usr/local/go/pkg/tool/linux_amd64/link \n-o $WORK/b001/exe/a.out \n-importcfg $WORK/b001/importcfg.link \n-buildmode=exe \n-buildid=UZcMyOX9lILP9hahS-FF/kCN0nlKO7qaS5D1mwkHf/i8lsdHfkhJNsud-tI68Q/UZcMyOX9lILP9hahS-FF \n-extld=gcc /root/.cache/go-build/55/55d1e3d2979a75ff5a13bc75c855482f90c32615d3b9e9d42ed096051efec200-d\n# command-line-arguments\n2018/04/06 21:28:17 invalid symbol version for \"go.string.\\\"aa87ca22be8b05378eb1c71ef320ad746e1d3b628ba79b9859f741e0\n82542a3855\\xdb\\x0f\\x849\\x0e\\x00\\x00H\\x8b[\\bH\\x83\\xfb\\x01\\x0f\n\\x8f\\x17\\r\\x00\\x00H\\x8bH H\\x85\\xc9\\x0f\\x84\\x01\": -7\n</code></pre>\n"}, {"tags": ["unit-testing", "testing", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1523034052, "post_id": 49697691, "comment_id": 86408390, "body": "Stdin is just an <code>*os.File</code>, but it would be more flexible to just parameterize your functions to take any <code>io.Reader</code>"}], "owner": {"reputation": 65, "user_id": 5902046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b5393c31e85b9483bd078bad5b1e643?s=128&d=identicon&r=PG&f=1", "display_name": "Hifnie Bilfash", "link": "https://stackoverflow.com/users/5902046/hifnie-bilfash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 617, "favorite_count": 0, "closed_date": 1523034355, "answer_count": 0, "score": 1, "last_activity_date": 1523033777, "creation_date": 1523033777, "question_id": 49697691, "link": "https://stackoverflow.com/questions/49697691/mock-stdin-and-stdout-in-golang", "closed_reason": "Duplicate", "title": "mock Stdin and Stdout in Golang", "body": "<p>I get confused when trying to write a test for simple console app in Golang.\nthe function I want to test is very simple. </p>\n\n<pre><code>func SimpleFunc() {\n    reader := bufio.NewReader(os.Stdin)\n    output, _ := reader.ReadString('\\n')\n    fmt.Println(output)\n}\n</code></pre>\n\n<p>Could you give an example how to write a test to mock stdin and stdout in Golang?</p>\n\n<p>Thanks in advance</p>\n"}]