[{"tags": ["http", "go", "webserver", "raspberry-pi3"], "comments": [{"owner": {"reputation": 1421, "user_id": 9672954, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/50jXz.jpg?s=128&g=1", "display_name": "runwuf", "link": "https://stackoverflow.com/users/9672954/runwuf"}, "edited": false, "score": 0, "creation_date": 1528930133, "post_id": 50847302, "comment_id": 88698129, "body": "when you use <code>.&#47;static&#47;templates</code> it is a relative path from the current working directory, depends where the process started it may not be where you think it is... how about use the absolute path and see if that works."}, {"owner": {"reputation": 1948, "user_id": 1924657, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/gumlg.jpg?s=128&g=1", "display_name": "Bryce", "link": "https://stackoverflow.com/users/1924657/bryce"}, "edited": false, "score": 0, "creation_date": 1528942758, "post_id": 50847302, "comment_id": 88700571, "body": "<code>go run</code> will run at tmp folder. U should use <code>go build &amp;&amp; .&#47;StatPiProvider</code>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1528931202, "last_edit_date": 1528931202, "creation_date": 1528930533, "answer_id": 50847420, "question_id": 50847302, "link": "https://stackoverflow.com/questions/50847302/golang-static-server-always-returns-404-page-not-found/50847420#50847420", "title": "golang static server always returns 404 page not found", "body": "<p>Note that <code>go run</code> does not change the working directory. So any relative path you use in your app, they will be resolved to the working directory, the folder from which you run <code>go run</code>.</p>\n\n<p>Since the <code>static</code> folder is next to the <code>StatPiProvider.go</code> file, and you use the path <code>./static/templates</code>, their containing folder must be the working directory when you run <code>go run</code>.</p>\n\n<p>So first change dir so the <code>StatPiProvider.go</code> will be in the working directory, and then launch the <code>.go</code> file like this:</p>\n\n<pre><code>cd StatPiProvider\ngo run StatPiProvider.go\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 9379651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1f0c08c452d6106d1f38d2aa92a8887?s=128&d=identicon&r=PG&f=1", "display_name": "ket0ma", "link": "https://stackoverflow.com/users/9379651/ket0ma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1563, "favorite_count": 1, "accepted_answer_id": 50847420, "answer_count": 1, "score": 2, "last_activity_date": 1531211197, "creation_date": 1528929654, "last_edit_date": 1531211197, "question_id": 50847302, "link": "https://stackoverflow.com/questions/50847302/golang-static-server-always-returns-404-page-not-found", "title": "golang static server always returns 404 page not found", "body": "<p>I try to get a Go webserver running on a raspberry pi (using 1.10.1)\nI have a go webserver implemented like (StatPiPrivider.go):</p>\n\n<pre><code>package main\n\nimport (\n        \"net/http\"\n)\n\nfunc main() {\n        http.Handle(\"/\", http.FileServer(http.Dir(\"./static/templates\")))\n        http.ListenAndServe(\":3000\", nil)\n}\n</code></pre>\n\n<p>and the static folder is in the same folder as the StatPiProvider.go file.</p>\n\n<p>In the folder static/templates are 4 html files including one index.html</p>\n\n<p>Everytime I rewuest the server I get a response 404 page not found. Even if I try to get an other html-file I get the same response.</p>\n\n<p>Is it a problem with my implementation or is something on my raspberry wrong.</p>\n\n<p>I run the code with: go run StatPiProvider/StatPiProvider.go </p>\n"}, {"tags": ["windows", "go", "service", "operating-system"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 9938123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e118dd8ec2036e617ffa87c7bd9eff92?s=128&d=identicon&r=PG&f=1", "display_name": "tramway", "link": "https://stackoverflow.com/users/9938123/tramway"}, "edited": false, "score": 0, "creation_date": 1528998435, "post_id": 50858994, "comment_id": 88728835, "body": "Nonono. I need to do this without all the user&#39;s actions. And without the rights of the system or so it is impossible?"}, {"owner": {"reputation": 1506, "user_id": 8689709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cd57855e7bff23fbca35abc8ddc0073?s=128&d=identicon&r=PG", "display_name": "Bill Zelenko", "link": "https://stackoverflow.com/users/8689709/bill-zelenko"}, "reply_to_user": {"reputation": 23, "user_id": 9938123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e118dd8ec2036e617ffa87c7bd9eff92?s=128&d=identicon&r=PG&f=1", "display_name": "tramway", "link": "https://stackoverflow.com/users/9938123/tramway"}, "edited": false, "score": 0, "creation_date": 1529083667, "post_id": 50858994, "comment_id": 88762652, "body": "Oh, OK.  I see what you want.  It is possible using std lib: <a href=\"https://godoc.org/golang.org/x/sys/windows/svc\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/sys/windows/svc</a>"}], "tags": [], "owner": {"reputation": 1506, "user_id": 8689709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cd57855e7bff23fbca35abc8ddc0073?s=128&d=identicon&r=PG", "display_name": "Bill Zelenko", "link": "https://stackoverflow.com/users/8689709/bill-zelenko"}, "is_accepted": false, "score": 0, "last_activity_date": 1528983798, "creation_date": 1528983798, "answer_id": 50858994, "question_id": 50845502, "link": "https://stackoverflow.com/questions/50845502/create-a-service-as-autorun/50858994#50858994", "title": "Create a service as autorun", "body": "<p>On Windows 10 go to Task Scheduler > Task Scheduler Library > Create Basic Task  > Trigger: when the computer starts > Action: Start a program.</p>\n\n<p>When running the task, use the following user account: SYSTEM.</p>\n"}, {"comments": [{"owner": {"reputation": 23, "user_id": 9938123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e118dd8ec2036e617ffa87c7bd9eff92?s=128&d=identicon&r=PG&f=1", "display_name": "tramway", "link": "https://stackoverflow.com/users/9938123/tramway"}, "edited": false, "score": 1, "creation_date": 1529137049, "post_id": 50880191, "comment_id": 88773984, "body": "So I used these examples, only combined all the code into one file."}], "tags": [], "owner": {"reputation": 1506, "user_id": 8689709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cd57855e7bff23fbca35abc8ddc0073?s=128&d=identicon&r=PG", "display_name": "Bill Zelenko", "link": "https://stackoverflow.com/users/8689709/bill-zelenko"}, "is_accepted": false, "score": 0, "last_activity_date": 1529083461, "creation_date": 1529083461, "answer_id": 50880191, "question_id": 50845502, "link": "https://stackoverflow.com/questions/50845502/create-a-service-as-autorun/50880191#50880191", "title": "Create a service as autorun", "body": "<p>There is a package in the standard library that does this:\n<a href=\"https://godoc.org/golang.org/x/sys/windows/svc\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/sys/windows/svc</a></p>\n\n<p>example: <a href=\"https://github.com/golang/sys/tree/master/windows/svc/example\" rel=\"nofollow noreferrer\">https://github.com/golang/sys/tree/master/windows/svc/example</a></p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 4474187, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4b3jqiLUlao/AAAAAAAAAAI/AAAAAAAAACI/3NaUsLtoQRQ/photo.jpg?sz=128", "display_name": "Alexandr", "link": "https://stackoverflow.com/users/4474187/alexandr"}, "is_accepted": false, "score": 2, "last_activity_date": 1608225330, "creation_date": 1608225330, "answer_id": 65345368, "question_id": 50845502, "link": "https://stackoverflow.com/questions/50845502/create-a-service-as-autorun/65345368#65345368", "title": "Create a service as autorun", "body": "<p>maybe it's not actual but during the creation of the service you should extend and pass Config</p>\n<blockquote>\n<p>mgr.Config{DisplayName: desc, StartType: mgr.StartAutomatic}</p>\n</blockquote>\n<p>like here:</p>\n<pre><code>s, err = m.CreateService(name, exepath, mgr.Config{DisplayName: desc, StartType: mgr.StartAutomatic}, &quot;is&quot;, &quot;auto-started&quot;)\nif err != nil {\n    return err\n}\n</code></pre>\n<p>Here you can find all necessary constants and functions:\n<a href=\"https://github.com/golang/sys/blob/master/windows/svc/mgr/config.go\" rel=\"nofollow noreferrer\">https://github.com/golang/sys/blob/master/windows/svc/mgr/config.go</a></p>\n"}], "owner": {"reputation": 23, "user_id": 9938123, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e118dd8ec2036e617ffa87c7bd9eff92?s=128&d=identicon&r=PG&f=1", "display_name": "tramway", "link": "https://stackoverflow.com/users/9938123/tramway"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 528, "favorite_count": 1, "answer_count": 3, "score": 2, "last_activity_date": 1608225330, "creation_date": 1528920782, "question_id": 50845502, "link": "https://stackoverflow.com/questions/50845502/create-a-service-as-autorun", "title": "Create a service as autorun", "body": "<p><strong>OS:</strong> <code>windows/7/8/8.1/10 32bit</code></p>\n\n<p>I have one question. How to create a service that would work like autorun?\nMost applications install themselves in autorun through the <code>registry</code> or through <code>C:\\Users\\Anon\\AppData\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup</code>. But there are those that are installing through the services, or rather as a service.\nI have a code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n    \"time\"\n    \"syscall\"\n\n    \"golang.org/x/sys/windows/svc\"\n    \"golang.org/x/sys/windows/svc/mgr\"\n    \"golang.org/x/sys/windows/svc/debug\"\n    \"log\"\n    \"os\"\n    \"path/filepath\"\n    \"golang.org/x/sys/windows/svc/eventlog\"\n)\n\nvar elog debug.Log\n\ntype myservice struct{}\n\nfunc (m *myservice) Execute(args []string, r &lt;-chan svc.ChangeRequest, changes chan&lt;- svc.Status) (ssec bool, errno uint32) {\n    const cmdsAccepted = svc.AcceptStop | svc.AcceptShutdown | svc.AcceptPauseAndContinue\n    changes &lt;- svc.Status{State: svc.StartPending}\n    fasttick := time.Tick(500 * time.Millisecond)\n    slowtick := time.Tick(2 * time.Second)\n    tick := fasttick\n    changes &lt;- svc.Status{State: svc.Running, Accepts: cmdsAccepted}\n    elog.Info(1, strings.Join(args, \"-\"))\nloop:\n    for {\n        select {\n        case &lt;-tick:\n            beep()\n            elog.Info(1, \"beep\")\n        case c := &lt;-r:\n            switch c.Cmd {\n            case svc.Interrogate:\n                changes &lt;- c.CurrentStatus\n                // Testing deadlock from https://code.google.com/p/winsvc/issues/detail?id=4\n                time.Sleep(100 * time.Millisecond)\n                changes &lt;- c.CurrentStatus\n            case svc.Stop, svc.Shutdown:\n                break loop\n            case svc.Pause:\n                changes &lt;- svc.Status{State: svc.Paused, Accepts: cmdsAccepted}\n                tick = slowtick\n            case svc.Continue:\n                changes &lt;- svc.Status{State: svc.Running, Accepts: cmdsAccepted}\n                tick = fasttick\n            default:\n                elog.Error(1, fmt.Sprintf(\"unexpected control request #%d\", c))\n            }\n        }\n    }\n    changes &lt;- svc.Status{State: svc.StopPending}\n    return\n}\n\nfunc runService(name string, isDebug bool) {\n    var err error\n    if isDebug {\n        elog = debug.New(name)\n    } else {\n        elog, err = eventlog.Open(name)\n        if err != nil {\n            return\n        }\n    }\n    defer elog.Close()\n\n    elog.Info(1, fmt.Sprintf(\"starting %s service\", name))\n    run := svc.Run\n    if isDebug {\n        run = debug.Run\n    }\n    err = run(name, &amp;myservice{})\n    if err != nil {\n        elog.Error(1, fmt.Sprintf(\"%s service failed: %v\", name, err))\n        return\n    }\n    elog.Info(1, fmt.Sprintf(\"%s service stopped\", name))\n}\n\nfunc startService(name string) error {\n    m, err := mgr.Connect()\n    if err != nil {\n        return err\n    }\n    defer m.Disconnect()\n    s, err := m.OpenService(name)\n    if err != nil {\n        return fmt.Errorf(\"could not access service: %v\", err)\n    }\n    defer s.Close()\n    err = s.Start(\"is\", \"auto-started\")\n    if err != nil {\n        return fmt.Errorf(\"could not start service: %v\", err)\n    }\n    return nil\n}\n\nfunc controlService(name string, c svc.Cmd, to svc.State) error {\n    m, err := mgr.Connect()\n    if err != nil {\n        return err\n    }\n    defer m.Disconnect()\n    s, err := m.OpenService(name)\n    if err != nil {\n        return fmt.Errorf(\"could not access service: %v\", err)\n    }\n    defer s.Close()\n    status, err := s.Control(c)\n    if err != nil {\n        return fmt.Errorf(\"could not send control=%d: %v\", c, err)\n    }\n    timeout := time.Now().Add(10 * time.Second)\n    for status.State != to {\n        if timeout.Before(time.Now()) {\n            return fmt.Errorf(\"timeout waiting for service to go to state=%d\", to)\n        }\n        time.Sleep(300 * time.Millisecond)\n        status, err = s.Query()\n        if err != nil {\n            return fmt.Errorf(\"could not retrieve service status: %v\", err)\n        }\n    }\n    return nil\n}\n\nfunc main() {\n    const svcName = \"Best Service\"\n\n    isIntSess, err := svc.IsAnInteractiveSession()\n    if err != nil {\n        log.Fatalf(\"failed to determine if we are running in an interactive session: %v\", err)\n    }\n    if !isIntSess {\n        runService(svcName, false)\n        return\n    }\n\n    /*err = controlService(svcName, svc.Stop, svc.Stopped)\n    err = removeService(svcName)*/\n    err = installService(svcName, \"Best Service\")\n    runService(svcName, true)\n\n    if err != nil {\n        log.Fatalf(\"failed to %s: %v\", svcName, err)\n    }\n    return\n}\n\nfunc exePath() (string, error) {\n    prog := os.Args[0]\n    p, err := filepath.Abs(prog)\n    if err != nil {\n        return \"\", err\n    }\n    fi, err := os.Stat(p)\n    if err == nil {\n        if !fi.Mode().IsDir() {\n            return p, nil\n        }\n        err = fmt.Errorf(\"%s is directory\", p)\n    }\n    if filepath.Ext(p) == \"\" {\n        p += \".exe\"\n        fi, err := os.Stat(p)\n        if err == nil {\n            if !fi.Mode().IsDir() {\n                return p, nil\n            }\n            err = fmt.Errorf(\"%s is directory\", p)\n        }\n    }\n    return \"\", err\n}\n\nfunc installService(name, desc string) error {\n    exepath, err := exePath()\n    if err != nil {\n        return err\n    }\n    m, err := mgr.Connect()\n    if err != nil {\n        return err\n    }\n    defer m.Disconnect()\n    s, err := m.OpenService(name)\n    if err == nil {\n        s.Close()\n        return fmt.Errorf(\"service %s already exists\", name)\n    }\n    s, err = m.CreateService(name, exepath, mgr.Config{DisplayName: desc, Description: \"BB service\"}, \"is\", \"auto-started\")\n    if err != nil {\n        return err\n    }\n    defer s.Close()\n    err = eventlog.InstallAsEventCreate(name, eventlog.Error|eventlog.Warning|eventlog.Info)\n    if err != nil {\n        s.Delete()\n        return fmt.Errorf(\"SetupEventLogSource() failed: %s\", err)\n    }\n    return nil\n}\n\nfunc removeService(name string) error {\n    m, err := mgr.Connect()\n    if err != nil {\n        return err\n    }\n    defer m.Disconnect()\n    s, err := m.OpenService(name)\n    if err != nil {\n        return fmt.Errorf(\"service %s is not installed\", name)\n    }\n    defer s.Close()\n    err = s.Delete()\n    if err != nil {\n        return err\n    }\n    err = eventlog.Remove(name)\n    if err != nil {\n        return fmt.Errorf(\"RemoveEventLogSource() failed: %s\", err)\n    }\n    return nil\n}\n\nvar (\n    beepFunc = syscall.MustLoadDLL(\"user32.dll\").MustFindProc(\"MessageBeep\")\n)\n\nfunc beep() {\n    beepFunc.Call(0xffffffff)\n}\n</code></pre>\n\n<p>Application is installed and every time I exit the application the service stops. I need that even after restarting the PC the service worked and the application started. How can I do it?</p>\n"}, {"tags": ["go", "integer-overflow"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1528917964, "post_id": 50844757, "comment_id": 88693055, "body": "The 555th fibonacci number is <code>435166381225550479896418053731403947254072020372607297358856&zwnj;&#8203;64398655775748034950&zwnj;&#8203;97257790926560550278&zwnj;&#8203;5297675867877570</code>, it&#39;s not even close to fitting into an integer and has rolled over multiple times."}, {"owner": {"reputation": 73919, "user_id": 44309, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iL4TW.png?s=128&g=1", "display_name": "High Performance Mark", "link": "https://stackoverflow.com/users/44309/high-performance-mark"}, "edited": false, "score": 1, "creation_date": 1528917986, "post_id": 50844757, "comment_id": 88693071, "body": "What&#39;s the largest integer value that an <code>int64</code> can cope with ? How does that compare to, say, your <code>fib(100)</code> ?  It&#39;s strange to me that you&#39;ve tagged this question <code>integer-overflow</code> without (seeming to) understand what it means !"}], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 9881724, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/900281a48e708a77ee1734b2a1cf98af?s=128&d=identicon&r=PG&f=1", "display_name": "wech", "link": "https://stackoverflow.com/users/9881724/wech"}, "is_accepted": false, "score": 0, "last_activity_date": 1528918010, "creation_date": 1528918010, "answer_id": 50844845, "question_id": 50844757, "link": "https://stackoverflow.com/questions/50844757/why-is-this-program-overflowing/50844845#50844845", "title": "Why is this program overflowing?", "body": "<p>Because the 555th fibonacci number is </p>\n\n<p>43516638122555047989641805373140394725407202037260729735885664398655775748034950972577909265605502785297675867877570</p>\n\n<p>which is much too large even for an int64.</p>\n"}, {"comments": [{"owner": {"reputation": 2884, "user_id": 3658166, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/X8dHk.png?s=128&g=1", "display_name": "ninesalt", "link": "https://stackoverflow.com/users/3658166/ninesalt"}, "edited": false, "score": 0, "creation_date": 1528931172, "post_id": 50844983, "comment_id": 88698387, "body": "Why does the array have a type of <code>*big.Int</code> rather than just <code>big.Int</code>?"}, {"owner": {"reputation": 3183, "user_id": 216345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ffc76b5c6c4607d55b0796da63d67f0?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/216345/thomas"}, "edited": false, "score": 1, "creation_date": 1528954941, "post_id": 50844983, "comment_id": 88703338, "body": "Probably because every method on big.Int requires a pointer receiver"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1528925067, "last_edit_date": 1528925067, "creation_date": 1528918656, "answer_id": 50844983, "question_id": 50844757, "link": "https://stackoverflow.com/questions/50844757/why-is-this-program-overflowing/50844983#50844983", "title": "Why is this program overflowing?", "body": "<p>The Fibonacci sequence gets very large, very fast. You need to use the <a href=\"https://golang.org/pkg/math/big/\" rel=\"nofollow noreferrer\"><code>math/big</code></a> package in order to calculate integers this large. Translating your algorithm gives us:</p>\n\n<pre><code>queue := []*big.Int{big.NewInt(0), big.NewInt(1)}\n\nfor i := 0; i &lt; num; i++ {\n    next := new(big.Int).Add(queue[0], queue[1])\n    queue[0] = queue[1]\n    queue[1] = next\n}\n</code></pre>\n\n<p>or more concisely:</p>\n\n<pre><code>for i := 0; i &lt; num; i++ {\n    queue[0].Add(queue[0], queue[1])\n    queue[0], queue[1] = queue[1], queue[0]\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/udIITdDPfrY\" rel=\"nofollow noreferrer\">https://play.golang.org/p/udIITdDPfrY</a></p>\n\n<p>Which will output the following number with <code>555</code> as the input:</p>\n\n<p><code>70411399558423479787498867358975911087747238266614004739546108921832817803452035228895708644544982403856194431208467\n</code></p>\n\n<p>(this is off by 1 from the expected 555th Fibonacci number, since it's 0 indexed)</p>\n"}], "owner": {"reputation": 2884, "user_id": 3658166, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/X8dHk.png?s=128&g=1", "display_name": "ninesalt", "link": "https://stackoverflow.com/users/3658166/ninesalt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 1, "accepted_answer_id": 50844983, "answer_count": 2, "score": 0, "last_activity_date": 1528984145, "creation_date": 1528917674, "question_id": 50844757, "link": "https://stackoverflow.com/questions/50844757/why-is-this-program-overflowing", "title": "Why is this program overflowing?", "body": "<p>I have a small golang program that calculates the <code>ith</code> fibonnaci number, however it appears to overflow for some numbers large numbers, even when the array is changed to a type of <code>int64</code>. Why is this happening?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fib(555) //prints a negative number\n\n}\n\nfunc fib(num int) {\n\n    queue := []int{0, 1}\n\n    for i := 0; i &lt; num; i++ {\n        next := queue[0] + queue[1]\n        queue[0] = queue[1]\n        queue[1] = next\n    }\n\n    fmt.Println(queue[len(queue)-1])\n\n}\n</code></pre>\n"}, {"tags": ["go", "httprequest", "httphandler", "go-gin"], "answers": [{"comments": [{"owner": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 0, "creation_date": 1528949802, "post_id": 50844500, "comment_id": 88701897, "body": "please explain more detail about threadsafe, avoid using package level variables, so if i declare a <code>struct</code> instead of <code>tplPath</code>, will it work, like <code>type pack struct { TplPath string }</code>"}, {"owner": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 0, "creation_date": 1528967922, "post_id": 50844500, "comment_id": 88710487, "body": "Just tested then like you are correct, declared variables can be access from other request. What if using <code>init()</code> to declare the package level variables once , then i don&#39;t modife this variable during the run time, in this case <code>tplPath</code> is a private variable which means it can&#39;t be change from outsite of the package. Or what&#39;s the correct way to share variables accross the requests?"}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "reply_to_user": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 0, "creation_date": 1528971250, "post_id": 50844500, "comment_id": 88712693, "body": "Init is more of a &quot;setup&quot; feature; for instantiating the variable in the first place, it won&#39;t solve the fact that you are reading from and writing to the same memory at the same time"}, {"owner": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 0, "creation_date": 1529034483, "post_id": 50844500, "comment_id": 88739471, "body": "Like using mutex to lock and unlock while get/set variables?"}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "reply_to_user": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 0, "creation_date": 1529045989, "post_id": 50844500, "comment_id": 88742747, "body": "Yes, using a mutex would prevent against a data race; but often you&#39;d want to try and re-architecht the problem or code so that you don&#39;t need to share the memory in the first place. Avoiding the need for many things to be reading and writing the same value"}, {"owner": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 0, "creation_date": 1529054438, "post_id": 50844500, "comment_id": 88746701, "body": "Thank you, i just wanna deelpy understand about how go works. My concern now is where to declare mutex variable? Declare it in package level is good practice or not?"}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "reply_to_user": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 0, "creation_date": 1529055927, "post_id": 50844500, "comment_id": 88747556, "body": "It&#39;s ok; i&#39;d try and avoid package variables in general. but you could store one at package level and use <code>init()</code> to create the struct / mutex required"}, {"owner": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 0, "creation_date": 1529072954, "post_id": 50844500, "comment_id": 88757227, "body": "And i realize that i can get used to it, like storing variables in package level like category list, product list ... things don&#39;t need to change oftenly instead of query them from database in each request, i store it as package variables, only need to query once then i will change it when needed, sounds good?"}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "reply_to_user": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 0, "creation_date": 1529073137, "post_id": 50844500, "comment_id": 88757334, "body": "sounds like a premature optimisation. There&#39;s nothing wrong with fetching things from the database. You should consider the service object pattern instead of package variables for shared state: <a href=\"https://www.calhoun.io/using-the-service-object-pattern-in-go/\" rel=\"nofollow noreferrer\">calhoun.io/using-the-service-object-pattern-in-go</a>"}, {"owner": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 0, "creation_date": 1529073346, "post_id": 50844500, "comment_id": 88757474, "body": "serving many sql queries cause the performance. my services get overload oftenly cause by sql queries. caching is an important part of optimization, right?"}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": true, "score": 4, "last_activity_date": 1528960165, "last_edit_date": 1528960165, "creation_date": 1528916627, "answer_id": 50844500, "question_id": 50844390, "link": "https://stackoverflow.com/questions/50844390/should-i-declare-variables-in-package-level-but-outside-of-http-handler/50844500#50844500", "title": "Should I declare variables in package level but outside of http handler?", "body": "<p>This is not threadsafe, package variables are shared across all goroutines, and modification in one routine will change the value in all the others, causing a data race.</p>\n\n<p>In general; try and avoid using package level variables where possible.</p>\n\n<p><strong>Edit</strong>:</p>\n\n<p>In go, packages are a kind of module. There exists only one instance of a package for any given import path (basically package name). This means that there is only 1 instance of any variable at package level.</p>\n\n<p>Package variables are shared, global state. All accessors of that variable will be accessing the exact same memory.</p>\n\n<p>It does not matter what type the package variable is, struct / string / int etc. If it is defined at package level, all accessors of that variable will share the same instance of it.</p>\n\n<p>If (as with http servers) you have concurrent code, there will be multiple accessors of that variable at the same time. In some situations this is fine, like when that variable is only ever read, but it appears that in your case it will be modified. Making this code racy!</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 9143474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1f91d038ec34d073b9be7aa3e06426e?s=128&d=identicon&r=PG&f=1", "display_name": "sakychen", "link": "https://stackoverflow.com/users/9143474/sakychen"}, "is_accepted": false, "score": -1, "last_activity_date": 1528943838, "creation_date": 1528943838, "answer_id": 50848841, "question_id": 50844390, "link": "https://stackoverflow.com/questions/50844390/should-i-declare-variables-in-package-level-but-outside-of-http-handler/50848841#50848841", "title": "Should I declare variables in package level but outside of http handler?", "body": "<p>The tplPath is a global variable, all routine will access the same memory address, and set after each http request.\nIf you want set just once, and the tplPath not depend on the http request. You can set it in the init function.</p>\n\n<pre><code>func init(){\n    _, filename, _, _ := runtime.Caller(0)\n    s := helper.RelativeFilePath(filename)\n    tplPath = s[1:len(s)] + \"template/\"\n}\n</code></pre>\n\n<p>The init function will run before main, and just do once.</p>\n"}], "owner": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1315, "favorite_count": 0, "accepted_answer_id": 50844500, "answer_count": 2, "score": -2, "last_activity_date": 1597434582, "creation_date": 1528916216, "last_edit_date": 1597434582, "question_id": 50844390, "link": "https://stackoverflow.com/questions/50844390/should-i-declare-variables-in-package-level-but-outside-of-http-handler", "title": "Should I declare variables in package level but outside of http handler?", "body": "<p>I'm using gin gonic as an HTTP framework and I need to group some paths with shared variable by like this:</p>\n<pre><code>ur := r.Group(&quot;/&quot;)\nur.Use(package.Prepare)\n{\n    ur.GET(&quot;/&quot;, package.Home)\n}\n</code></pre>\n<p>Inside the <code>Prepare</code> handler, I declare package variable like\n<code>package.tplPath</code> because I want all sub routes can access to this variable instead of rewrite the code in each http handler.</p>\n<pre><code>var tplPath = &quot;&quot;\n\nfunc Prepare(c *gin.Context) {\n    _, filename, _, _ := runtime.Caller(0)\n    s := helper.RelativeFilePath(filename)\n    tplPath = s[1:len(s)] + &quot;template/&quot;\n}\n</code></pre>\n<p>I don't know how Go works with each process, and variables for each http request. If a variable was declared in package level, will it be set after each http request?</p>\n<p>Is this considered good practice? If not, why not?</p>\n"}, {"tags": ["go", "random", "slice", "sampling"], "answers": [{"comments": [{"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1528915961, "post_id": 50844244, "comment_id": 88692091, "body": "This would modify the original array, I assume that &quot;without replacement&quot; means that the original array would not be modified. You&#39;d need to make a copy first."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 2, "creation_date": 1528916086, "post_id": 50844244, "comment_id": 88692144, "body": "@Zak: &quot;without replacement&quot; just means the same element won&#39;t be sampled multiple times. Not modifying the original slice very well may be another requirement, but isn&#39;t specified here."}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1528916268, "post_id": 50844244, "comment_id": 88692231, "body": "Ok, nice one. TIL"}, {"owner": {"reputation": 1043, "user_id": 6476080, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b82fc060e266edfb5c9695c9f4202b4d?s=128&d=identicon&r=PG&f=1", "display_name": "alpaca", "link": "https://stackoverflow.com/users/6476080/alpaca"}, "edited": false, "score": 0, "creation_date": 1528918058, "post_id": 50844244, "comment_id": 88693106, "body": "@JimB&#39;s definition of &quot;without replacement&quot; is correct. However, this solution is computationally expensive when a is large."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1043, "user_id": 6476080, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b82fc060e266edfb5c9695c9f4202b4d?s=128&d=identicon&r=PG&f=1", "display_name": "alpaca", "link": "https://stackoverflow.com/users/6476080/alpaca"}, "edited": false, "score": 0, "creation_date": 1528918782, "post_id": 50844244, "comment_id": 88693507, "body": "@alpaca: your example was not large, which makes this an appropriate solution. Otherwise you can either remove random samples from the original set, or if you don&#39;t want to modify the set simply record the sample indexes and don&#39;t repeat them."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1043, "user_id": 6476080, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b82fc060e266edfb5c9695c9f4202b4d?s=128&d=identicon&r=PG&f=1", "display_name": "alpaca", "link": "https://stackoverflow.com/users/6476080/alpaca"}, "edited": false, "score": 0, "creation_date": 1528925940, "post_id": 50844244, "comment_id": 88696831, "body": "@alpaca: it&#39;s also worth noting that if you&#39;re sampling a significant portion of <code>a</code>, this is optimal since you&#39;ll be calculating random values for, and copying the majority of values anyway. Shuffling the array (via i.e. an optimum Fisher-Yates) vs n random samples are both <code>O(n)</code> operations, so overall computation time converges as n approaches len(a)."}, {"owner": {"reputation": 1043, "user_id": 6476080, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b82fc060e266edfb5c9695c9f4202b4d?s=128&d=identicon&r=PG&f=1", "display_name": "alpaca", "link": "https://stackoverflow.com/users/6476080/alpaca"}, "edited": false, "score": 0, "creation_date": 1528926220, "post_id": 50844244, "comment_id": 88696958, "body": "record the sample indexes and don&#39;t repeat them &gt;&gt; would you be able to demonstrate how to do this if possible?"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1528928753, "last_edit_date": 1528928753, "creation_date": 1528915687, "answer_id": 50844244, "question_id": 50844153, "link": "https://stackoverflow.com/questions/50844153/sample-without-replacement-in-golang/50844244#50844244", "title": "Sample without replacement in golang", "body": "<p>If the set size is relatively small overall, or you are sampling a large portion of the set, the simplest method is to shuffle the elements and pick the first <code>n</code>:</p>\n\n<pre><code>rand.Shuffle(len(a), func(i, j int) { a[i], a[j] = a[j], a[i] })\nfmt.Println(a[:5])\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/lQx44Mn9RQL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/lQx44Mn9RQL</a></p>\n\n<p>If you don't want to shuffle the entire set, but it's acceptable to alter the order of the set (or copy the entire set), you can \"record\" the used values more efficiently by removing them from the slice.</p>\n\n<pre><code>// create a copy of the slice header\nc := a\nsamples := make([]int, n)\n\nfor i := 0; i &lt; n; i++ {\n    r := int(rand.Int63n(int64(len(c))))\n    samples[i] = c[r]\n\n    // remove the sample from the copy slice\n    c[r], c[len(c)-1] = c[len(c)-1], c[r]\n    c = c[:len(c)-1]\n}\n</code></pre>\n\n<p>In the case that the set size is quite large and you are sampling only a small portion, you can sample from the original set without modification by recording the sample index and not repeating it. Obviously as the ratio of the sample size to the set size grows, the number of collisions will grow making this less efficient.</p>\n\n<p>For example: </p>\n\n<pre><code>// record indexes here to prevent duplicates\nindexes := make(map[int]bool)\n\n// create n random indexes\nfor i := 0; i &lt; n; i++ {\n    var r int\n    for {\n        r = int(rand.Int63n(int64(len(a))))\n        if indexes[r] {\n            continue\n        }\n        break\n    }\n\n    indexes[r] = true\n}\n\nsamples := make([]int, 0, n)\nfor i := range indexes {\n    samples = append(samples, a[i])\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 0, "last_activity_date": 1528915835, "creation_date": 1528915835, "answer_id": 50844288, "question_id": 50844153, "link": "https://stackoverflow.com/questions/50844153/sample-without-replacement-in-golang/50844288#50844288", "title": "Sample without replacement in golang", "body": "<p>Depending on how random the sample needs to be, I'd probably copy the elements into a <code>map[T]struct{}</code> (where <code>T</code> is the result type) and <code>range</code> over that for my result.</p>\n\n<pre><code>// assume input is []int\nres := make([]int, len(input))\ndesorted := make(map[int]struct{})\n\nfor _, v := range input {\n        desorted[v] = struct{}\n}\n\ni := 0\nfor k, _ := range desorted {\n        res[i] = k\n        i++\n}\n</code></pre>\n"}], "owner": {"reputation": 1043, "user_id": 6476080, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b82fc060e266edfb5c9695c9f4202b4d?s=128&d=identicon&r=PG&f=1", "display_name": "alpaca", "link": "https://stackoverflow.com/users/6476080/alpaca"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1072, "favorite_count": 0, "accepted_answer_id": 50844244, "answer_count": 2, "score": 0, "last_activity_date": 1528928753, "creation_date": 1528915368, "question_id": 50844153, "link": "https://stackoverflow.com/questions/50844153/sample-without-replacement-in-golang", "title": "Sample without replacement in golang", "body": "<p>What's the best way to sample without replacement from a slice in golang?</p>\n\n<pre><code>a := make([]int, 100)\nfor i := range a {\n    a[i] = i\n}\n\n# TODO sample 5 elements from a without replacement.\n</code></pre>\n"}, {"tags": ["arrays", "math", "go", "statistics"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1528913886, "post_id": 50843647, "comment_id": 88691037, "body": "A normal distribution is symmetric, so it doesn&#39;t really make sense to have the      a range of (1, 150) with a mean of 85. Also, if the distribution is asymmetric, you can&#39;t then have a symmetric std deviation."}, {"owner": {"reputation": 23, "user_id": 9937605, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Nicholas Iun", "link": "https://stackoverflow.com/users/9937605/nicholas-iun"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528919083, "post_id": 50843647, "comment_id": 88693675, "body": "You are correct I changed my question to make sense, but I still don&#39;t understand how to get a normally distributed set."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1528919566, "post_id": 50843647, "comment_id": 88693912, "body": "<a href=\"https://golang.org/pkg/math/rand/#NormFloat64\" rel=\"nofollow noreferrer\"><code>rand.NormFloat64</code></a> returns a normal distribution"}, {"owner": {"reputation": 23, "user_id": 9937605, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Nicholas Iun", "link": "https://stackoverflow.com/users/9937605/nicholas-iun"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528923992, "post_id": 50843647, "comment_id": 88696056, "body": "@JimB Yes this works thank you."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528930874, "post_id": 50843647, "comment_id": 88698323, "body": "The distribution is only perfectly normal as the sample size approaches infinity, this is a random sampling from a normal distribution. I&#39;m not sure what you mean by a perfectly normal distribution without the random aspect, nor how you would come close to &quot;perfectly normal&quot; with only a limited set of integer values."}, {"owner": {"reputation": 23, "user_id": 9937605, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Nicholas Iun", "link": "https://stackoverflow.com/users/9937605/nicholas-iun"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528939874, "post_id": 50843647, "comment_id": 88700026, "body": "Sorry, I was wrong to use the words &quot;perfectly normal&quot;. I just meant the data set would fit the standard distribution curve as well as possible. But, I adjusted the question again to make sense. @JimB"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528983485, "post_id": 50843647, "comment_id": 88720322, "body": "Those values aren&#39;t a normal distribution, it&#39;s calculating the area under the probability density curve."}, {"owner": {"reputation": 23, "user_id": 9937605, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Nicholas Iun", "link": "https://stackoverflow.com/users/9937605/nicholas-iun"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528984498, "post_id": 50843647, "comment_id": 88720963, "body": "Oh I see thanks, I&#39;ll look into this. JimB"}, {"owner": {"reputation": 51182, "user_id": 1468366, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2e313135581cf6ceaad355580af931f8?s=128&d=identicon&r=PG", "display_name": "MvG", "link": "https://stackoverflow.com/users/1468366/mvg"}, "edited": false, "score": 0, "creation_date": 1529085707, "post_id": 50843647, "comment_id": 88763494, "body": "Are you looking for a way to compute <a href=\"https://en.wikipedia.org/wiki/Quantile\" rel=\"nofollow noreferrer\">quantiles</a> of a <a href=\"https://en.wikipedia.org/wiki/Normal_distribution#Quantile_function\" rel=\"nofollow noreferrer\">normal distribution</a> using a preferably precise formula? Do these terms help you find an implementation?"}], "answers": [{"tags": [], "owner": {"reputation": 51182, "user_id": 1468366, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2e313135581cf6ceaad355580af931f8?s=128&d=identicon&r=PG", "display_name": "MvG", "link": "https://stackoverflow.com/users/1468366/mvg"}, "is_accepted": true, "score": 3, "last_activity_date": 1529139414, "last_edit_date": 1529139414, "creation_date": 1529090848, "answer_id": 50881632, "question_id": 50843647, "link": "https://stackoverflow.com/questions/50843647/how-to-create-a-set-of-normally-distributed-numbers-in-go-lang-set-around-a-spe/50881632#50881632", "title": "How to create a set of Normally distributed numbers in go-lang, set around a specific number", "body": "<p>The mathematical description of a random <a href=\"https://en.wikipedia.org/wiki/Probability_distribution\" rel=\"nofollow noreferrer\">distribution</a> is usually via its <a href=\"https://en.wikipedia.org/wiki/Probability_distribution_function\" rel=\"nofollow noreferrer\">probability distribution function</a>. Which for a continuous distribution like the normal distribution is either expressed as a <a href=\"https://en.wikipedia.org/wiki/Probability_density_function\" rel=\"nofollow noreferrer\">probability density function</a> (the <a href=\"https://en.wikipedia.org/wiki/Gaussian_function\" rel=\"nofollow noreferrer\">bell-shaped curve</a> you might know) or a <a href=\"https://en.wikipedia.org/wiki/Cumulative_distribution_function\" rel=\"nofollow noreferrer\">cumulative distribution function</a> which is its <a href=\"https://en.wikipedia.org/wiki/Integral\" rel=\"nofollow noreferrer\">integral</a>. So perhaps you want to compute <a href=\"https://en.wikipedia.org/wiki/Error_function\" rel=\"nofollow noreferrer\">that function</a>.</p>\n\n<p>On the other hand, your use of the term <em>inverse</em> both in your implementation and in the <a href=\"https://support.office.com/en-us/article/norminv-function-87981ab8-2de0-4cb0-b1aa-e21d4cb879b8\" rel=\"nofollow noreferrer\">Excel function</a> you cite suggests that you are in fact looking for the <a href=\"https://en.wikipedia.org/wiki/Inverse_function\" rel=\"nofollow noreferrer\">inverse operation</a>: given a probability, find the value where the cumulative probability function reaches that value. That is called the <a href=\"https://en.wikipedia.org/wiki/Quantile\" rel=\"nofollow noreferrer\"><em>quantile</em></a> for the given probability.</p>\n\n<p>Unfortunately the normal distribution has a pretty complicated formula that is hard to compute. <a href=\"https://en.wikipedia.org/wiki/Normal_distribution#Quantile_function\" rel=\"nofollow noreferrer\">Its quantile function</a> isn't easier. Therefore instead of trying to get that computation right, I'd suggest you use some library providing that functionality. A bit of web search suggests this:</p>\n\n<p><a href=\"https://godoc.org/gonum.org/v1/gonum/stat/distuv#Normal.Quantile\" rel=\"nofollow noreferrer\">https://godoc.org/gonum.org/v1/gonum/stat/distuv#Normal.Quantile</a></p>\n\n<blockquote>\n<pre><code>func (n Normal) Quantile(p float64) float64\n</code></pre>\n  \n  <p>Quantile returns the inverse of the cumulative probability distribution.</p>\n</blockquote>\n\n<p>A look at <a href=\"https://github.com/gonum/gonum/blob/master/mathext/erf.go\" rel=\"nofollow noreferrer\">the underlying implementation</a> suggests that I wouldn't want to work this out myself. Also note that it will be an approximation (looks like a piecewise combination of <a href=\"https://en.wikipedia.org/wiki/Pad%C3%A9_approximant\" rel=\"nofollow noreferrer\">Pad\u00e9 approximants</a>), and I don't see any mention of error bounds at first glance. Other libraries might have better aproximations, or better guarantees.</p>\n\n<p>If you indeed want an array of numbers following this distribution, pick probabilities equidistant from (0,1) (which could mean either from 1/(<i>n</i>+1) through <i>n</i>/(<i>n</i>+1) or 1/(2<i>n</i>), 3/(2<i>n</i>), \u2026 (2<i>n</i>\u22121)/(2<i>n</i>) depending on application or taste) and compute quantiles for these. If you really want integers, you can round afterwards. But you might also want to check whether a <a href=\"https://en.wikipedia.org/wiki/Probability_distribution#Continuous_probability_distribution\" rel=\"nofollow noreferrer\">continuous distribution</a> is the right thing for you, or whether you would be better off with a <a href=\"https://en.wikipedia.org/wiki/Probability_distribution#Discrete_probability_distribution\" rel=\"nofollow noreferrer\">discrete distribution</a> like the <a href=\"https://en.wikipedia.org/wiki/Binomial_distribution\" rel=\"nofollow noreferrer\">binomial distribution</a>.</p>\n"}], "owner": {"reputation": 23, "user_id": 9937605, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Nicholas Iun", "link": "https://stackoverflow.com/users/9937605/nicholas-iun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1849, "favorite_count": 0, "accepted_answer_id": 50881632, "answer_count": 1, "score": 2, "last_activity_date": 1529139414, "creation_date": 1528913411, "last_edit_date": 1528939560, "question_id": 50843647, "link": "https://stackoverflow.com/questions/50843647/how-to-create-a-set-of-normally-distributed-numbers-in-go-lang-set-around-a-spe", "title": "How to create a set of Normally distributed numbers in go-lang, set around a specific number", "body": "<p>Creating a normally distributed set of numbers in Go can be accomplished as follows. </p>\n\n<pre><code>func getNormDistro(x int){\n    for i := 0; i &lt; x; i++{\n        fmt.Print(\"   \",int(normalInverse(80,10)), \"   \")\n    }\n}\n\nfunc normalInverse(mu float32, sigma float32)(float32){\n    return float32(rand.NormFloat64() * float64(sigma) + float64(mu))\n}\n</code></pre>\n\n<p>Running this:</p>\n\n<pre><code>getNormDistro(10)\n</code></pre>\n\n<p>prints this:</p>\n\n<pre><code>   86      74      79      94      73      92      66      77      74      78    \n</code></pre>\n\n<p>The only problem is the Distribution is not consistent and has a random aspect to it. This means the curve generated might not fit the normal distribution cure as closely as possible.</p>\n\n<p>How would one make a function that does follow a normal distribution as closely as possible in an algorithmic fashion that has no random component in the output?</p>\n\n<p>So, I know this is possible because you can easily do it in excel. Excel has this function =NORMINV(E3,C3,D3) that takes 3 perimeters the %chance of occurrence(as a decimal), the mean of your distribution, and the standard deviation.This function returns the value of the percent chance that is entered. </p>\n\n<p>If you iterate through the percent chance of occurrence with a specific mean and standard deviation at .5 you would have your mean and if your iteration was evenly spaced between 0% and 100% a standard distribution would be crated with no random component. </p>\n\n<pre><code>    Data Set    Mean    Standard Deviation  % Chance\n56.73652126 80  10  0.01\n56.73652126 80  10  0.02\n61.19206392 80  10  0.03\n62.49313929 80  10  0.04\n63.55146373 80  10  0.05\n64.45226405 80  10  0.06\n65.24208972 80  10  0.07\n65.9492844  80  10  0.08\n66.59244966 80  10  0.09\n67.18448434 80  10  0.1\n67.7347188  80  10  0.11\n68.25013208 80  10  0.12\n68.73608871 80  10  0.13\n69.19680659 80  10  0.14\n69.63566611 80  10  0.15\n70.05542117 80  10  0.16\n70.45834747 80  10  0.17\n70.84634912 80  10  0.18\n71.22103705 80  10  0.19\n71.58378766 80  10  0.2\n71.93578753 80  10  0.21\n72.27806786 80  10  0.22\n72.61153151 80  10  0.23\n72.93697437 80  10  0.24\n73.2551025  80  10  0.25\n73.56654595 80  10  0.26\n73.87187009 80  10  0.27\n74.17158493 80  10  0.28\n74.4661528  80  10  0.29\n74.75599487 80  10  0.3\n75.04149653 80  10  0.31\n75.32301201 80  10  0.32\n75.60086834 80  10  0.33\n75.87536871 80  10  0.34\n76.14679534 80  10  0.35\n76.41541207 80  10  0.36\n76.68146654 80  10  0.37\n76.94519212 80  10  0.38\n77.20680966 80  10  0.39\n77.46652897 80  10  0.4\n77.72455023 80  10  0.41\n77.98106521 80  10  0.42\n78.23625835 80  10  0.43\n78.49030785 80  10  0.44\n78.74338653 80  10  0.45\n78.99566279 80  10  0.46\n79.24730138 80  10  0.47\n79.49846417 80  10  0.48\n79.74931092 80  10  0.49\n80  80  10  0.5\n80.25068908 80  10  0.51\n80.50153583 80  10  0.52\n80.75269862 80  10  0.53\n81.00433721 80  10  0.54\n81.25661347 80  10  0.55\n81.50969215 80  10  0.56\n81.76374165 80  10  0.57\n82.01893479 80  10  0.58\n82.27544977 80  10  0.59\n82.53347103 80  10  0.6\n82.79319034 80  10  0.61\n83.05480788 80  10  0.62\n83.31853346 80  10  0.63\n83.58458793 80  10  0.64\n83.85320466 80  10  0.65\n84.12463129 80  10  0.66\n84.39913166 80  10  0.67\n84.67698799 80  10  0.68\n84.95850347 80  10  0.69\n85.24400513 80  10  0.7\n85.5338472  80  10  0.71\n85.82841507 80  10  0.72\n86.12812991 80  10  0.73\n86.43345405 80  10  0.74\n86.7448975  80  10  0.75\n87.06302563 80  10  0.76\n87.38846849 80  10  0.77\n87.72193214 80  10  0.78\n88.06421247 80  10  0.79\n88.41621234 80  10  0.8\n88.77896295 80  10  0.81\n89.15365088 80  10  0.82\n89.54165253 80  10  0.83\n89.94457883 80  10  0.84\n90.36433389 80  10  0.85\n90.80319341 80  10  0.86\n91.26391129 80  10  0.87\n91.74986792 80  10  0.88\n92.2652812  80  10  0.89\n92.81551566 80  10  0.9\n93.40755034 80  10  0.91\n94.0507156  80  10  0.92\n94.75791028 80  10  0.93\n95.54773595 80  10  0.94\n96.44853627 80  10  0.95\n97.50686071 80  10  0.96\n98.80793608 80  10  0.97\n100.5374891 80  10  0.98\n103.2634787 80  10  0.99\n110.9023231 80  10  0.999\n117.1901649 80  10  0.9999\n122.6489079 80  10  0.99999\n127.5342431 80  10  0.999999\n49.09767694 80  10  0.001\n42.80983515 80  10  0.0001\n37.35109206 80  10  0.00001\n32.46575691 80  10  0.000001\n28.00662418 80  10  0.0000001\n23.87998756 80  10  0.00000001\n</code></pre>\n"}, {"tags": ["go", "naming-conventions"], "comments": [{"owner": {"reputation": 3183, "user_id": 216345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ffc76b5c6c4607d55b0796da63d67f0?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/216345/thomas"}, "edited": false, "score": 2, "creation_date": 1528909327, "post_id": 50842430, "comment_id": 88688731, "body": "I would probably use package names of <code>rhinohorn</code> and/or <code>supervisor</code>. Or maybe a type named <code>Supervisor</code> inside package <code>rhinohorn</code>. Do you actually need to refer to Rhino Horn in the structure of the code? Maybe the application can just monitor stuff and be configured to monitor Rhino Horn, though I realize that may not be easily done depending on the reality of your actual deployment."}, {"owner": {"reputation": 1162, "user_id": 1586797, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0e19c16130bbfb34d0f8cdb414780e50?s=128&d=identicon&r=PG", "display_name": "bronze man", "link": "https://stackoverflow.com/users/1586797/bronze-man"}, "edited": false, "score": 0, "creation_date": 1571814660, "post_id": 50842430, "comment_id": 103360883, "body": "I think you should just use rhino_horn_supervisor. Write code whatever you want ,do not let some stupid guideline limit your thought. MixedCaps may have bug with os that filename is case insensitive. I think you should avoid upper case letter in filename."}], "answers": [{"tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": false, "score": 6, "last_activity_date": 1528917490, "last_edit_date": 1528917490, "creation_date": 1528908912, "answer_id": 50842518, "question_id": 50842430, "link": "https://stackoverflow.com/questions/50842430/how-do-you-name-a-multi-term-package-in-golang/50842518#50842518", "title": "How do you name a multi-term package in golang?", "body": "<p>I think there are many many many options. A few of which are:</p>\n\n<ul>\n<li>If your project is only focused on supervising rhino horn you could name your project rhino-horn-supervisor and not package anything just have flat top level files <code>main.go</code>, <code>hornoutput.go</code>, or w/e</li>\n<li>If supervising rhino horn is one component of a larger application there could be lots of setups, one of which could be a <code>supervisors</code> package and rhino horn being a single file with its implementation </li>\n<li>Theres also the possibility of sub packages, <code>supervisors/rhinohorn</code> package</li>\n<li>Also you could just make a <code>rhinohorn</code> package with a <code>supervisor.go</code> file :P </li>\n</ul>\n"}], "owner": {"reputation": 2192, "user_id": 2480092, "user_type": "registered", "accept_rate": 9, "profile_image": "https://www.gravatar.com/avatar/97f4cd231024913afd99cbe69655a963?s=128&d=identicon&r=PG", "display_name": "TheEnvironmentalist", "link": "https://stackoverflow.com/users/2480092/theenvironmentalist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4377, "favorite_count": 0, "answer_count": 1, "score": 11, "last_activity_date": 1528917490, "creation_date": 1528908576, "question_id": 50842430, "link": "https://stackoverflow.com/questions/50842430/how-do-you-name-a-multi-term-package-in-golang", "title": "How do you name a multi-term package in golang?", "body": "<p>Naming conventions for go packages are well-documented, with <a href=\"https://blog.golang.org/package-names\" rel=\"noreferrer\">golang.org's blog</a> stating:</p>\n\n<blockquote>\n  <p>Good package names are short and clear. They are lower case, with no under_scores or mixedCaps. They are often simple nouns, such as [descriptions removed]: time, list, http</p>\n</blockquote>\n\n<p>The same guide then presents two examples of bad names:</p>\n\n<blockquote>\n  <p>Here are two examples of names that might be good style in other languages but do not fit well in Go: computeServiceClient, priority_queue</p>\n</blockquote>\n\n<p>What the guide doesn't say is what to do when you have a package with a very specific purpose that really doesn't fit well as a one-word noun.</p>\n\n<p>We have a library called Rhino Horn used internally for finding credentials that are being leaked accidentally. For reasons owing to how resource intensive it is to run Rhino Horn, I've been instructed to write a supervisor in golang for Rhino Horn that monitors its performance and enables quick shutoff when needed. Rhino Horn wasn't written in go, and is an entirely separate project.</p>\n\n<p><strong>What would the golang naming conventions have me name the Rhino Horn Supervisor?</strong></p>\n"}, {"tags": ["go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1528911670, "last_edit_date": 1528911670, "creation_date": 1528911231, "answer_id": 50843122, "question_id": 50842389, "link": "https://stackoverflow.com/questions/50842389/parsing-multiple-templates-in-go/50843122#50843122", "title": "Parsing Multiple Templates in Go", "body": "<p><a href=\"https://golang.org/pkg/html/template/#Template.Clone\" rel=\"nofollow noreferrer\">https://golang.org/pkg/html/template/#Template.Clone</a></p>\n\n<blockquote>\n  <p>Clone can be used to prepare common templates and use them with\n  variant definitions for other templates by adding the variants after\n  the clone is made.</p>\n</blockquote>\n\n<pre><code>baseTemplate, err = template.ParseFiles(\n    \"views/layout/base.gohtml\",\n    \"views/layout/menu.html\",\n    \"views/layout/footer.gohtml\")\nif err != nil {\n    panic(err)\n}\n\nhomeTemplate, err = template.Must(baseTemplate.Clone()).ParseFiles(\"views/home.gohtml\")\nif err != nil {\n    panic(err)\n}\n\ncontactTemplate, err = template.Must(baseTemplate.Clone()).ParseFiles(\"views/contact.gohtml\")\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/q9ox01W8U00\" rel=\"nofollow noreferrer\">https://play.golang.org/p/q9ox01W8U00</a></p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1528916383, "last_edit_date": 1528916383, "creation_date": 1528915947, "answer_id": 50844322, "question_id": 50842389, "link": "https://stackoverflow.com/questions/50842389/parsing-multiple-templates-in-go/50844322#50844322", "title": "Parsing Multiple Templates in Go", "body": "<p>One option is to use <a href=\"https://golang.org/pkg/html/template/#Template.Clone\" rel=\"nofollow noreferrer\"><code>Template.Clone()</code></a> as you can see in mkopriva's answer. Note that <code>Template.Clone()</code> does not copy the actual representation of the templates, the clone will share the representation with the original.</p>\n\n<p>Another option is to parse all template files in one step, so the \"base\" templates will obviously will only be parsed once:</p>\n\n<pre><code>all := template.Must(template.ParseFiles(\n    \"views/layout/base.gohtml\",\n    \"views/layout/menu.html\",\n    \"views/layout/footer.gohtml\",\n    \"views/home.gohtml\",\n    \"views/contact.gohtml\",\n))\n</code></pre>\n\n<p>And you can use <a href=\"https://golang.org/pkg/html/template/#Template.ExecuteTemplate\" rel=\"nofollow noreferrer\"><code>Template.ExecuteTemplate()</code></a> to execute a designated, named template, e.g.:</p>\n\n<pre><code>// To execute the home template:\nerr := all.ExecuteTemplate(w, \"home.gohtml\", params)\n\n// To execute the contact template:\nerr := all.ExecuteTemplate(w, \"contact.gohtml\", params)\n</code></pre>\n\n<p>Pros of using <code>Template.Clone()</code> is that you can have multiple templates with the same name, which would not work when loading all at once.</p>\n\n<p>Pros of loading all at once is that it's simpler.</p>\n"}], "owner": {"reputation": 946, "user_id": 2867168, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/87931c389a65679729f2a9a153d3e111?s=128&d=identicon&r=PG&f=1", "display_name": "MisutoWolf", "link": "https://stackoverflow.com/users/2867168/misutowolf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1207, "favorite_count": 0, "accepted_answer_id": 50843122, "answer_count": 2, "score": 2, "last_activity_date": 1528916383, "creation_date": 1528908409, "last_edit_date": 1528916004, "question_id": 50842389, "link": "https://stackoverflow.com/questions/50842389/parsing-multiple-templates-in-go", "title": "Parsing Multiple Templates in Go", "body": "<p>I'm trying to figure out how to go about loading multiple templates in Go when a lot of them have a similar....base, you could say?</p>\n\n<p>Currently, I've got the following two templates I'm loading in a sample application I'm working on:</p>\n\n<pre><code>homeTemplate, err = template.ParseFiles(\n    \"views/layout/base.gohtml\",\n    \"views/layout/menu.html\",\n    \"views/layout/footer.gohtml\",\n    \"views/home.gohtml\")\nif err != nil {\n    panic(err)\n}\n\ncontactTemplate, err = template.ParseFiles(\n    \"views/layout/base.gohtml\",\n    \"views/layout/menu.html\",\n    \"views/layout/footer.gohtml\",\n    \"views/contact.gohtml\")\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>My question is the following:</p>\n\n<p>Is there a way to set this up in such a way that I can store the first three entries in each list of templates in a variable and then just append the final inclusion at the end so I can shorten the amount of code and simplify things?</p>\n\n<p>Am I tackling this whole thing wrong?  I read somewhere about using a setup that incorporated a <code>template[\"name\"]</code> syntax and then rendering from that, maybe I just need to load the base templates before the rest of this stuff, since they're more of less for layout stuff, and they probably don't need to be part of the above variables?</p>\n"}, {"tags": ["go", "grpc"], "comments": [{"owner": {"reputation": 3183, "user_id": 216345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ffc76b5c6c4607d55b0796da63d67f0?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/216345/thomas"}, "edited": false, "score": 0, "creation_date": 1528909451, "post_id": 50840699, "comment_id": 88688802, "body": "Do you have a different version of go grpc library vendored?"}, {"owner": {"reputation": 576, "user_id": 7371810, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c53dfe10f0150e2213e244ef1b93ccde?s=128&d=identicon&r=PG&f=1", "display_name": "menghanl", "link": "https://stackoverflow.com/users/7371810/menghanl"}, "edited": false, "score": 0, "creation_date": 1528912158, "post_id": 50840699, "comment_id": 88690220, "body": "Maybe try updating both proto plugins: go get -u github.com/golang/protobuf/{proto,protoc-gen-go}?"}, {"owner": {"reputation": 1, "user_id": 8781924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2a3b04f88b952a9a470372d79a7e933?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/8781924/eric"}, "edited": false, "score": 0, "creation_date": 1529041461, "post_id": 50840699, "comment_id": 88741041, "body": "I updated both and it still doesnt work..."}, {"owner": {"reputation": 406, "user_id": 1308278, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3639c54079f353462229eff6f38cf4f3?s=128&d=identicon&r=PG", "display_name": "kdvy", "link": "https://stackoverflow.com/users/1308278/kdvy"}, "edited": false, "score": 0, "creation_date": 1529081818, "post_id": 50840699, "comment_id": 88761827, "body": "I would download the example again and have a look at the method signature for <code>_Greeter_SayHello_Handler</code> .Generate the file again using the protoc command. If the signature is different then your protoc-gen-go is mismatched. Delete any binary protoc in your $PATH and install again."}], "answers": [{"tags": [], "owner": {"reputation": 444, "user_id": 7918749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r9BIg.jpg?s=128&g=1", "display_name": "Black_Dreams", "link": "https://stackoverflow.com/users/7918749/black-dreams"}, "is_accepted": false, "score": 0, "last_activity_date": 1548408512, "creation_date": 1548408512, "answer_id": 54362340, "question_id": 50840699, "link": "https://stackoverflow.com/questions/50840699/running-grpc-example-for-golang/54362340#54362340", "title": "Running GRPC example for golang", "body": "<p>Generate proto like this</p>\n\n<p>file_name : Your proto file name with the path</p>\n\n<pre><code>//To generate the grpc code \nprotoc proto/file_name.proto --go_out=plugins=grpc:.\n</code></pre>\n\n<p>Take a look this link How to write proto and generate the proto file. It may help your problem</p>\n\n<p><a href=\"https://github.com/SXerox007/protos-\" rel=\"nofollow noreferrer\">https://github.com/SXerox007/protos-</a></p>\n"}], "owner": {"reputation": 1, "user_id": 8781924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2a3b04f88b952a9a470372d79a7e933?s=128&d=identicon&r=PG&f=1", "display_name": "Eric", "link": "https://stackoverflow.com/users/8781924/eric"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 569, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1548408512, "creation_date": 1528902798, "last_edit_date": 1528905220, "question_id": 50840699, "link": "https://stackoverflow.com/questions/50840699/running-grpc-example-for-golang", "title": "Running GRPC example for golang", "body": "<p>newbie here.</p>\n\n<p>Currently learning how grpc works and was going through the tutorial in this link <br>\n<a href=\"https://grpc.io/docs/quickstart/go.html#update-and-run-the-application\" rel=\"nofollow noreferrer\">https://grpc.io/docs/quickstart/go.html#update-and-run-the-application</a></p>\n\n<p>When I ran the example using the <code>helloworld.pb.go</code> file provided, it works. But when I deleted that file and ran  <code>protoc --go_out=plugins=grpc:. *.proto</code> to generate the that file again, I find that I can no longer run the greeter server. </p>\n\n<p>The error I am getting is </p>\n\n<blockquote>\n  <p>google.golang.org/grpc/examples/helloworld/helloworld\n  helloworld/helloworld.pb.go:105:11: cannot use _Greeter_SayHello_Handler (type func(interface {}, \"context\".Context, grpc.Codec, []byte) (interface {}, error)) as type grpc.methodHandler in field value</p>\n</blockquote>\n\n<p>Tried to google but couldn't find out why. My protobuf version is 3.5.1 and the grpc is freshly cloned from <code>github.com/golang/protobuf/protoc-gen-go</code></p>\n"}, {"tags": ["authentication", "go", "google-cloud-platform", "microservices", "credentials"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1528944397, "post_id": 50840229, "comment_id": 88700871, "body": "Is it possible for you to have a microservice behind a vpc that is internal facing. This service can communicate with a DB.  Your external services should be able to hit this internal service with some user identifier (user id) after they have logged in, to fetch google creds to be used on your public layer.  Your public facing services also have to be on the same vpc as your internal facing one to communicate with it, likely via some API -&gt; GET, POST, PATCH, DELETE, to mod SQL or any db really. The google creds will have to be in the form of a refresh token so that you can use the oauth flow"}, {"owner": {"reputation": 14518, "user_id": 2575224, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IXLfW.jpg?s=128&g=1", "display_name": "Constantin Galbenu", "link": "https://stackoverflow.com/users/2575224/constantin-galbenu"}, "edited": false, "score": 0, "creation_date": 1528957770, "post_id": 50840229, "comment_id": 88704552, "body": "Do you use kubernetes? If yes the you can store the token in a secret: <a href=\"https://cloud.google.com/kubernetes-engine/docs/concepts/secret\" rel=\"nofollow noreferrer\">cloud.google.com/kubernetes-engine/docs/concepts/secret</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1854, "user_id": 9457843, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "rsantiago", "link": "https://stackoverflow.com/users/9457843/rsantiago"}, "is_accepted": false, "score": 0, "last_activity_date": 1536778973, "creation_date": 1536778973, "answer_id": 52301809, "question_id": 50840229, "link": "https://stackoverflow.com/questions/50840229/how-to-share-credentials-across-multiple-services-accessing-google-app/52301809#52301809", "title": "How to share credentials across multiple services accessing Google App", "body": "<p>It seems possible, you can ask a user to authenticate and authorize all permissions your application will need, all at once. But think about the user, when an application requires to access gmail, hangouts, photos, camera, etc. at once, the user normally disbelieve the application. So, the recommended approach is asking for the specific <a href=\"https://developers.google.com/identity/protocols/CrossClientAuth\" rel=\"nofollow noreferrer\">permission when the application requires</a> it so that the user can realize each action you app do.</p>\n\n<p>There exist many different ways to address your question depending on details, however the following link can help you to know where to start:</p>\n\n<ul>\n<li><p>This link <a href=\"https://developers.google.com/identity/choose-auth\" rel=\"nofollow noreferrer\">(Google Sign-in)</a> has a wide context on all the Identity mechanisms to look for the most appropriate for you. </p></li>\n<li><p>This another one explain all possible <a href=\"https://developers.google.com/api-client-library/\" rel=\"nofollow noreferrer\">Identity mechanisms</a> for specific use cases.</p></li>\n</ul>\n\n<p>This <a href=\"https://developers.google.com/calendar/auth#OAuth2Authorizing\" rel=\"nofollow noreferrer\">authentication example</a> for Google Calendar is useful, but this post explain how <a href=\"https://medium.com/technology-learning/how-we-solved-authentication-and-authorization-in-our-microservice-architecture-994539d1b6e6\" rel=\"nofollow noreferrer\">microservices authentication and authorization</a> was solved.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9936719"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 524, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1536778973, "creation_date": 1528901423, "last_edit_date": 1528902299, "question_id": 50840229, "link": "https://stackoverflow.com/questions/50840229/how-to-share-credentials-across-multiple-services-accessing-google-app", "title": "How to share credentials across multiple services accessing Google App", "body": "<p>First of all, I apologize in advance for my na\u00efvet\u00e9 on the topic.</p>\n\n<p>I am trying to create a few microservices that are exposed using an API gateway. A few of these services will need credentials from Google account to access Google Calendar/Gmail etc.. is there any way for a user to only have to login once so that the credentials are all shared between the services? Or should only one service be facing the Google services with credentials?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "edited": false, "score": 0, "creation_date": 1528890167, "post_id": 50836291, "comment_id": 88676385, "body": "can u help to explain a bit after remove the <code>WithCancel</code> how the <code>deliberately kill the client request</code> scenario works? is it because of the go http module already created the context with <code>WithCancel</code> and called the <code>defer cancel()</code>?"}, {"owner": {"reputation": 346, "user_id": 4476748, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/9411f33f09008556e0b6b5323f78fc35?s=128&d=identicon&r=PG&f=1", "display_name": "fding", "link": "https://stackoverflow.com/users/4476748/fding"}, "edited": false, "score": 0, "creation_date": 1539661472, "post_id": 50836291, "comment_id": 92571959, "body": "No there is no resource leak here. The stack frame, or gc, will release the resource."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 2, "last_activity_date": 1528890199, "last_edit_date": 1528890199, "creation_date": 1528889918, "answer_id": 50836291, "question_id": 50835982, "link": "https://stackoverflow.com/questions/50835982/how-to-use-context-withcancel-and-context-withtimeout-api-together-and-is-it-ne/50836291#50836291", "title": "How to use context.WithCancel and context.WithTimeout API together, and is it necessary?", "body": "<p>Because the <code>CancelFunc</code> returned from your <code>WithCancel</code> call is being immediately overwritten, this causes a resource (i.e. memory) leak in your program. From the <a href=\"https://golang.org/pkg/context\" rel=\"nofollow noreferrer\">context documentation</a>:</p>\n\n<blockquote>\n  <p>The WithCancel, WithDeadline, and WithTimeout functions take a Context (the parent) and return a derived Context (the child) and a CancelFunc. Calling the CancelFunc cancels the child and its children, removes the parent's reference to the child, and stops any associated timers. <strong>Failing to call the CancelFunc leaks the child and its children until the parent is canceled or the timer fires.</strong> </p>\n</blockquote>\n\n<p>Removing the <code>WithCancel</code> context from your code will fix this problem.</p>\n\n<p>Additionally, cancellation of the HTTP request is managed by the HTTP server, as described in the <a href=\"https://golang.org/pkg/net/http/#Request.Context\" rel=\"nofollow noreferrer\"><code>http.Request.Context</code></a> method documentation:</p>\n\n<blockquote>\n  <p>For incoming server requests, the context is canceled when the client's connection closes, the request is canceled (with HTTP/2), or when the ServeHTTP method returns.</p>\n</blockquote>\n\n<p>When the server cancels the request context, all child contexts will be cancelled.</p>\n"}, {"tags": [], "owner": {"reputation": 346, "user_id": 4476748, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/9411f33f09008556e0b6b5323f78fc35?s=128&d=identicon&r=PG&f=1", "display_name": "fding", "link": "https://stackoverflow.com/users/4476748/fding"}, "is_accepted": false, "score": 0, "last_activity_date": 1539661363, "creation_date": 1539661363, "answer_id": 52827666, "question_id": 50835982, "link": "https://stackoverflow.com/questions/50835982/how-to-use-context-withcancel-and-context-withtimeout-api-together-and-is-it-ne/52827666#52827666", "title": "How to use context.WithCancel and context.WithTimeout API together, and is it necessary?", "body": "<p>You can just use <code>WithTimeout()</code>, instead of using both APIs, because <code>WithTimeout()</code> returns you a <code>context.CancelFunc</code> just as <code>WithCancel()</code> does, which could be called at any time to cancel the target process/routine. Of course, the cancellation should before hitting the deadline set by <code>WithTimeout()</code>.  </p>\n\n<p>So, </p>\n\n<blockquote>\n  <p>Is it a proper way to use these two APIs together like this?<br>\n   Is it even necessary to use these two APIs together?</p>\n</blockquote>\n\n<p>No, no need to use both, use returned <code>context.CancelFunc</code> by any API in package context.</p>\n"}], "owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1916, "favorite_count": 3, "accepted_answer_id": 50836291, "answer_count": 2, "score": 4, "last_activity_date": 1539661363, "creation_date": 1528888974, "last_edit_date": 1529239810, "question_id": 50835982, "link": "https://stackoverflow.com/questions/50835982/how-to-use-context-withcancel-and-context-withtimeout-api-together-and-is-it-ne", "title": "How to use context.WithCancel and context.WithTimeout API together, and is it necessary?", "body": "<p>Now I did something like this:</p>\n\n<pre><code>func contextHandler(h http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        ctx, cancel := context.WithCancel(r.Context())\n        ctx, cancel = context.WithTimeout(ctx, config.EnvConfig.RequestTimeout)\n\n        defer cancel()\n\n        if cn, ok := w.(http.CloseNotifier); ok {\n            go func(done &lt;-chan struct{}, closed &lt;-chan bool) {\n                select {\n                case &lt;-done:\n                case &lt;-closed:\n                    logger.Debug(\"message\", \"client connection has gone away, request will be cancelled\")\n                    cancel()\n                }\n            }(ctx.Done(), cn.CloseNotify())\n        }\n\n        h.ServeHTTP(w, r.WithContext(ctx))\n    })\n}\n</code></pre>\n\n<p>Pls pay attention to these two lines:</p>\n\n<pre><code>ctx, cancel := context.WithCancel(r.Context())\nctx, cancel = context.WithTimeout(ctx, config.EnvConfig.RequestTimeout)\n</code></pre>\n\n<p>According to my tests: <code>deliberately kill the client request</code> and <code>deliberately make the request exceed the deadline</code>, both are working fine(i mean can receive the cancellation signal and timeout signal as expected), just my concern is: the latter <code>cancel</code> function will override the previous one returned by the <code>context.WithCancel(r.Context())</code>, so:</p>\n\n<ol>\n<li>Is it a proper way to use these two APIs together like this?</li>\n<li>Is it even necessary to use these two APIs together?</li>\n</ol>\n\n<p>Please help to explain.</p>\n"}, {"tags": ["go", "go-pg"], "answers": [{"tags": [], "owner": {"reputation": 512, "user_id": 3782382, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0e0f24876474e579ce70cbbdd45e9571?s=128&d=identicon&r=PG&f=1", "display_name": "asyndrige", "link": "https://stackoverflow.com/users/3782382/asyndrige"}, "is_accepted": true, "score": 0, "last_activity_date": 1528900092, "creation_date": 1528900092, "answer_id": 50839755, "question_id": 50834982, "link": "https://stackoverflow.com/questions/50834982/specify-key-for-many-to-many-relationship-in-go-pg-orm/50839755#50839755", "title": "Specify key for many-to-many relationship in go-pg ORM", "body": "<p>I was using version 5. In latest version this was fixed, now you can specify full joining keys:</p>\n\n<pre><code>type Person struct {\n    tableName    struct{}   `sql:\"person\"`\n    UUID         string     `sql:\"person_uuid,pk\"`\n    ContactDatas []ContactData `pg:\",many2many:person_contact_data,fk:person_uuid,joinFK:contact_data_uuid\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 512, "user_id": 3782382, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/0e0f24876474e579ce70cbbdd45e9571?s=128&d=identicon&r=PG&f=1", "display_name": "asyndrige", "link": "https://stackoverflow.com/users/3782382/asyndrige"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 885, "favorite_count": 0, "accepted_answer_id": 50839755, "answer_count": 1, "score": 0, "last_activity_date": 1528900092, "creation_date": 1528885928, "last_edit_date": 1528886612, "question_id": 50834982, "link": "https://stackoverflow.com/questions/50834982/specify-key-for-many-to-many-relationship-in-go-pg-orm", "title": "Specify key for many-to-many relationship in go-pg ORM", "body": "<p>I have these 2 models with many-to-many relationship:</p>\n\n<pre><code>type Person struct {\n    tableName    struct{}   `sql:\"person\"`\n    UUID         string     `sql:\"person_uuid,pk\"`\n    ContactDatas []ContactData `pg:\",many2many:person_contact_data,joinFK:\"`\n}\n\ntype ContactData struct {\n    tableName     struct{}   `sql:\"contact_data\"`\n    UUID          string     `sql:\"contact_data_uuid,pk\"`\n}\n</code></pre>\n\n<p>And model for <code>person_contact_data</code> table is:</p>\n\n<pre><code>type PersonContactData struct {\n    tableName       struct{} `sql:\"person_contact_data\"`\n    PersonUUID      string   `sql:\"person_uuid\"`\n    ContactDataUUID string   `sql:\"contact_data_uuid\"`\n}\n</code></pre>\n\n<p>If <code>joinFK</code> in <code>ContactDatas</code> struct tag is empty go-pg adds underscore under the hood, so generated SQL part looks like this: <code>WHERE (\"contact_data\".\"contact_data_uuid\" = person_contact_data.\"_contact_data_uuid\")</code>. </p>\n\n<p>Is there a way to specify joining keys completely manual? </p>\n"}, {"tags": ["json", "http", "go"], "comments": [{"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1528887209, "post_id": 50834379, "comment_id": 88674557, "body": "First verify where the issue is, client or server.  Does the server work if you perform the http post twice from some other tools, e.g. by using <code>curl</code> ? In which case it&#39;s your client that&#39;s the problem, or if you get the same issue by using existing tools to post to the server, it&#39;s your server that is the issue."}, {"owner": {"reputation": 204, "user_id": 7488661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSqnY.jpg?s=128&g=1", "display_name": "rtut", "link": "https://stackoverflow.com/users/7488661/rtut"}, "reply_to_user": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1528887391, "post_id": 50834379, "comment_id": 88674670, "body": "I check - problem with my master - with channel."}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1528887445, "post_id": 50834379, "comment_id": 88674705, "body": "Ok, then you don&#39;t need to post the client code, but your server code. (we can&#39;t debug your server code based on just the small piece of code you have posted here though)"}, {"owner": {"reputation": 204, "user_id": 7488661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSqnY.jpg?s=128&g=1", "display_name": "rtut", "link": "https://stackoverflow.com/users/7488661/rtut"}, "reply_to_user": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1528887799, "post_id": 50834379, "comment_id": 88674883, "body": "I understand, but first time i think problem in slave, now i solve problem and post result)))Thank You"}], "answers": [{"comments": [{"owner": {"reputation": 204, "user_id": 7488661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSqnY.jpg?s=128&g=1", "display_name": "rtut", "link": "https://stackoverflow.com/users/7488661/rtut"}, "edited": false, "score": 0, "creation_date": 1528885227, "post_id": 50834706, "comment_id": 88673356, "body": "i read this article and set timout, but i get timeout error. I think may be problem on master, but when my slave wait answer, i call my master and I jerk api call my master and he returns me a answer. How?"}, {"owner": {"reputation": 11, "user_id": 4860392, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWjdY.jpg?s=128&g=1", "display_name": "Noman", "link": "https://stackoverflow.com/users/4860392/noman"}, "reply_to_user": {"reputation": 204, "user_id": 7488661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSqnY.jpg?s=128&g=1", "display_name": "rtut", "link": "https://stackoverflow.com/users/7488661/rtut"}, "edited": false, "score": 0, "creation_date": 1528885858, "post_id": 50834706, "comment_id": 88673743, "body": "It&#39;s hard to tell without looking at master&#39;s code for this endpoint. If I had to guess - check the code for infinite loops, sleeps, and blocking operations (like adding message to a buffered channel for example)."}, {"owner": {"reputation": 204, "user_id": 7488661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSqnY.jpg?s=128&g=1", "display_name": "rtut", "link": "https://stackoverflow.com/users/7488661/rtut"}, "edited": false, "score": 0, "creation_date": 1528886805, "post_id": 50834706, "comment_id": 88674265, "body": "i add master  code, yes i have channel in my master."}, {"owner": {"reputation": 204, "user_id": 7488661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSqnY.jpg?s=128&g=1", "display_name": "rtut", "link": "https://stackoverflow.com/users/7488661/rtut"}, "edited": false, "score": 0, "creation_date": 1528887334, "post_id": 50834706, "comment_id": 88674631, "body": "i comment code which send result ot channel on master and master work good, See problem link with channel."}], "tags": [], "owner": {"reputation": 11, "user_id": 4860392, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WWjdY.jpg?s=128&g=1", "display_name": "Noman", "link": "https://stackoverflow.com/users/4860392/noman"}, "is_accepted": false, "score": 0, "last_activity_date": 1528885008, "creation_date": 1528885008, "answer_id": 50834706, "question_id": 50834379, "link": "https://stackoverflow.com/questions/50834379/golang-http-request-post-works-once/50834706#50834706", "title": "Golang http request POST works once", "body": "<p>You need to add a timeout to your http.Client. By default http.Client has timeout specified as 0 which means no timeout at all. So if server is not responding than your application will just hang waiting for a response. This problem is fully described in this article <a href=\"https://medium.com/@nate510/don-t-use-go-s-default-http-client-4804cb19f779\" rel=\"nofollow noreferrer\">Don\u2019t use Go\u2019s default HTTP client (in production)</a>. Though you create custom client you still need to specify timeout.</p>\n"}, {"tags": [], "owner": {"reputation": 204, "user_id": 7488661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSqnY.jpg?s=128&g=1", "display_name": "rtut", "link": "https://stackoverflow.com/users/7488661/rtut"}, "is_accepted": false, "score": 0, "last_activity_date": 1528963829, "creation_date": 1528963829, "answer_id": 50852634, "question_id": 50834379, "link": "https://stackoverflow.com/questions/50834379/golang-http-request-post-works-once/50852634#50852634", "title": "Golang http request POST works once", "body": "<p>Problem link with channel, i send result work slave on master to channel, but channel work without loop, i add loop for read data from channel and all work.</p>\n"}], "owner": {"reputation": 204, "user_id": 7488661, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YSqnY.jpg?s=128&g=1", "display_name": "rtut", "link": "https://stackoverflow.com/users/7488661/rtut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 217, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1528963829, "creation_date": 1528883958, "last_edit_date": 1528886779, "question_id": 50834379, "link": "https://stackoverflow.com/questions/50834379/golang-http-request-post-works-once", "title": "Golang http request POST works once", "body": "<p>I have a master and slave. Master have api call result, which takes JSON. And i have proplem with slave, which send this result on master, the first time my code sends json well, but second time, code stop(program wait.....) on <code>resp, err := client.Do(req)</code>, when create query on master.\nsalve code:</p>\n\n<pre><code>func main (){\n    for {\n        // some code, very long code\n        sendResult(resFiles)\n    }\n}\n\nfunc sendResult(rf common.ResultFiles) {\n    jsonValue, err := json.Marshal(rf)\n    req, err := http.NewRequest(methodPost, ResultAdress, \n                                bytes.NewBuffer(jsonValue))\n    req.Header.Set(\"Content-Type\", ContentType)\n    client := &amp;http.Client{}\n    resp, err := client.Do(req)\n    if err != nil {\n        panic(err)\n    }\n    defer resp.Body.Close()\n    fmt.Println(\"response Status:\", resp.Status)\n}\n</code></pre>\n\n<p>master api call:</p>\n\n<pre><code>func result(c echo.Context) error {\n    rf := &amp;ResultFiles{}\n    err := c.Bind(rf)\n    if err != nil {\n        log.Fatal(err)\n    }\n    rfChannel &lt;- *rf\n    return c.JSON(http.StatusOK, nil)\n}\n</code></pre>\n\n<p>My question: Why? May be problem in the standard client golang (http.Client) or timeout? If i set timout - my code crashed by timeout)))anticipated....\nThank you!</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528882210, "post_id": 50833673, "comment_id": 88671263, "body": "You must return nums. Read about how slices work in Go in the Blog."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528882269, "post_id": 50833673, "comment_id": 88671318, "body": "slice already point to an array so there is no need to point to them separately. As @Volker suggested you should return your slice after modifying the same"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1528895953, "last_edit_date": 1528895953, "creation_date": 1528886711, "answer_id": 50835239, "question_id": 50833673, "link": "https://stackoverflow.com/questions/50833673/rotate-array-in-go/50835239#50835239", "title": "Rotate Array in Go", "body": "<p>In Go, all arguments are passed by value.</p>\n\n<p>A Go slice is represented at runtime by a slice descriptor:</p>\n\n<pre><code>type slice struct {\n    array unsafe.Pointer\n    len   int\n    cap   int\n}\n</code></pre>\n\n<p>If you change any of the slice descriptor values in a function then communicate the change, typically by returning the changed slice descriptor.</p>\n\n<hr>\n\n<p>Your <code>rotate</code> function changes the values of the slice <code>num</code> pointer to the underlying array and the slice capacity, so return <code>num</code>.</p>\n\n<p>For example, after I fixed the bugs in your <code>rotate</code> algorithm,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc rotate(nums []int, k int) []int {\n    if k &lt; 0 || len(nums) == 0 {\n        return nums\n    }\n\n    fmt.Printf(\"nums %p array %p len %d cap %d slice %v\\n\", &amp;nums, &amp;nums[0], len(nums), cap(nums), nums)\n\n    r := len(nums) - k%len(nums)\n    nums = append(nums[r:], nums[:r]...)\n\n    fmt.Printf(\"nums %p array %p len %d cap %d slice %v\\n\", &amp;nums, &amp;nums[0], len(nums), cap(nums), nums)\n\n    return nums\n}\n\nfunc main() {\n    nums := []int{1, 2, 3, 4, 5, 6, 7}\n\n    fmt.Printf(\"nums %p array %p len %d cap %d slice %v\\n\", &amp;nums, &amp;nums[0], len(nums), cap(nums), nums)\n\n    nums = rotate(nums, 3)\n\n    fmt.Printf(\"nums %p array %p len %d cap %d slice %v\\n\", &amp;nums, &amp;nums[0], len(nums), cap(nums), nums)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>nums 0xc00000a080 array 0xc00001a1c0 len 7 cap 7 slice [1 2 3 4 5 6 7]\nnums 0xc00000a0c0 array 0xc00001a1c0 len 7 cap 7 slice [1 2 3 4 5 6 7]\nnums 0xc00000a0c0 array 0xc00001a240 len 7 cap 8 slice [5 6 7 1 2 3 4]\nnums 0xc00000a080 array 0xc00001a240 len 7 cap 8 slice [5 6 7 1 2 3 4]\n</code></pre>\n\n<p>Reference: <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">The Go Blog: Go Slices: usage and internals</a></p>\n"}, {"tags": [], "owner": {"reputation": 1178, "user_id": 3967945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d671333d111810416ba4952f1da75c1?s=128&d=identicon&r=PG", "display_name": "mroman", "link": "https://stackoverflow.com/users/3967945/mroman"}, "is_accepted": false, "score": -1, "last_activity_date": 1528966567, "creation_date": 1528966567, "answer_id": 50853511, "question_id": 50833673, "link": "https://stackoverflow.com/questions/50833673/rotate-array-in-go/50853511#50853511", "title": "Rotate Array in Go", "body": "<p>This doesn't work because <code>[]byte</code> is a slice which is sort of a \"pointer to an array\". Doing:</p>\n\n<pre><code>func f(v []T) {\n  v = ... //\n}\n</code></pre>\n\n<p>won't have any observable effect for the caller. Assuming your <code>append</code> way is correct (didn't really check it) you could do something like this:</p>\n\n<pre><code>func rotate(nums []int, k int) {\n    k = k % len(nums)\n    temp := append(nums[k:], nums[0:k]...)\n    copy(nums, temp) // this actually writes to where nums points to\n}\n\nfunc main() {\n    nums := []int{1,2,3,4,5,6,7}\n    rotate(nums ,3)\n    fmt.Println(nums)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 119, "user_id": 4757705, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-V0M8PT8mtOE/AAAAAAAAAAI/AAAAAAAAAEM/DvJkLXi5ddU/photo.jpg?sz=128", "display_name": "Anand Godar", "link": "https://stackoverflow.com/users/4757705/anand-godar"}, "is_accepted": false, "score": 0, "last_activity_date": 1584892809, "creation_date": 1584892809, "answer_id": 60801566, "question_id": 50833673, "link": "https://stackoverflow.com/questions/50833673/rotate-array-in-go/60801566#60801566", "title": "Rotate Array in Go", "body": "<p>Solutions</p>\n\n<p>Solution 1 : </p>\n\n<pre><code>func rotate(ar []int,d,n int) []int{\n    var newArray []int\n    for i:=0;i&lt;d;i++{\n        newArray = ar[1:n]\n        newArray = append(newArray,ar[0])\n        ar = newArray\n    }\n\n    return ar\n}\n</code></pre>\n\n<p>Solution 2 : </p>\n\n<pre><code>func rotateR(ar []int,d,n int) []int{\n    ar = append(ar[d:n],ar[0:d]...)\n    return  ar\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 7672532, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-V9Q9GleeV9g/AAAAAAAAAAI/AAAAAAAAAnY/mMewGfzR0xU/photo.jpg?sz=128", "display_name": "EJIRO EDWIN", "link": "https://stackoverflow.com/users/7672532/ejiro-edwin"}, "is_accepted": false, "score": 0, "last_activity_date": 1600695088, "creation_date": 1600695088, "answer_id": 63993360, "question_id": 50833673, "link": "https://stackoverflow.com/questions/50833673/rotate-array-in-go/63993360#63993360", "title": "Rotate Array in Go", "body": "<pre><code>func rotate(nums []int, k int) {\n    k = k % len(nums)\n    result := append(nums[len(nums)-k:], nums[:len(nums)-k]...)\n    for i := 0; i &lt; len(nums); i++ {\n        nums[i] = result[i]\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 726, "user_id": 2089818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c972f8bb9bad1881831dd0ce6aef124?s=128&d=identicon&r=PG", "display_name": "Abhas Sinha", "link": "https://stackoverflow.com/users/2089818/abhas-sinha"}, "is_accepted": false, "score": 0, "last_activity_date": 1606687900, "creation_date": 1606687900, "answer_id": 65065755, "question_id": 50833673, "link": "https://stackoverflow.com/questions/50833673/rotate-array-in-go/65065755#65065755", "title": "Rotate Array in Go", "body": "<p>Answering this late as i came across this while reading the book &quot;The Go Programming language&quot;. It presents a quite elegant algo to use the reverse function and apply it thrice to achieve the desired rotation by k elems. Something like this</p>\n<pre><code>// function to rotate array by k elems (3 reverse method)\nfunc rotate(arr []int, k int) {\n    reverse(arr[:k])\n    reverse(arr[k:])\n    reverse(arr)\n}\n</code></pre>\n<p>Please note, you will have to write a reverse function. Go does not provide one. This is an O(n) solution and takes O(1) space.</p>\n"}, {"tags": [], "owner": {"reputation": 3, "user_id": 5705601, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IIYDE.jpg?s=128&g=1", "display_name": "Amr Ali", "link": "https://stackoverflow.com/users/5705601/amr-ali"}, "is_accepted": false, "score": 0, "last_activity_date": 1617973071, "creation_date": 1617973071, "answer_id": 67021581, "question_id": 50833673, "link": "https://stackoverflow.com/questions/50833673/rotate-array-in-go/67021581#67021581", "title": "Rotate Array in Go", "body": "<p>This is my solution to the same hackerrank <a href=\"https://www.hackerrank.com/challenges/array-left-rotation/problem\" rel=\"nofollow noreferrer\">problem</a></p>\n<pre><code>func rotateLeft(d int32, arr []int32) []int32 {\n    for ; d &gt; 0 ; d-- {\n        left := arr[0]\n        arr = arr[1:]\n        arr = append(arr, left)        \n    }\n    return arr\n}\n</code></pre>\n"}], "owner": {"reputation": 329, "user_id": 9437085, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bZbW0.jpg?s=128&g=1", "display_name": "gyuaisdfaasf", "link": "https://stackoverflow.com/users/9437085/gyuaisdfaasf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3262, "favorite_count": 3, "answer_count": 6, "score": 2, "last_activity_date": 1617973071, "creation_date": 1528881942, "last_edit_date": 1528895005, "question_id": 50833673, "link": "https://stackoverflow.com/questions/50833673/rotate-array-in-go", "title": "Rotate Array in Go", "body": "<p>This is a LeetCode problem: <a href=\"https://leetcode.com/problems/rotate-array/description/\" rel=\"nofollow noreferrer\">189. Rotate Array</a>:</p>\n\n<blockquote>\n  <p>Given an array, rotate the array to the right by k steps, where k is\n  non-negative.</p>\n  \n  <p>Example 1:</p>\n  \n  <p>Input: [1,2,3,4,5,6,7] and k = 3<br>\n  Output: [5,6,7,1,2,3,4]  </p>\n</blockquote>\n\n<p>And here is my solution:</p>\n\n<pre><code>func rotate(nums []int, k int)  {\n    k = k % len(nums)\n    nums = append(nums[k:],nums[0:k]...)\n    fmt.Println(nums)\n}\n</code></pre>\n\n<p>It is a straight forward algorithm but it does not work.</p>\n\n<p>I am new to Go. I suppose <code>nums</code> is passed by value and changes to <code>nums</code> won't affect the real <code>nums</code>. </p>\n\n<p>How can I get this right?</p>\n"}, {"tags": ["go", "geometry", "line", "distance", "geojson"], "comments": [{"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1528881098, "post_id": 50833301, "comment_id": 88670533, "body": "Please show us some code of what you have tried. SO is not a code writing service."}, {"owner": {"reputation": 336, "user_id": 8689468, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KZXP3.jpg?s=128&g=1", "display_name": "Mzia", "link": "https://stackoverflow.com/users/8689468/mzia"}, "reply_to_user": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1528881469, "post_id": 50833301, "comment_id": 88670768, "body": "I don&#39;t even know which formula to use for line-line distance. I have code for line-point distance only Can you give me a hint?"}], "answers": [{"comments": [{"owner": {"reputation": 336, "user_id": 8689468, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KZXP3.jpg?s=128&g=1", "display_name": "Mzia", "link": "https://stackoverflow.com/users/8689468/mzia"}, "edited": false, "score": 0, "creation_date": 1528954285, "post_id": 50833550, "comment_id": 88703100, "body": "Thanks, I understand what you mean... I thought that there&#39;s a special formula for this"}, {"owner": {"reputation": 2191, "user_id": 9590251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1bc63e8510dda3d6969da82b4ad6d3f?s=128&d=identicon&r=PG&f=1", "display_name": "Timothy", "link": "https://stackoverflow.com/users/9590251/timothy"}, "reply_to_user": {"reputation": 336, "user_id": 8689468, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KZXP3.jpg?s=128&g=1", "display_name": "Mzia", "link": "https://stackoverflow.com/users/8689468/mzia"}, "edited": false, "score": 1, "creation_date": 1528962181, "post_id": 50833550, "comment_id": 88706876, "body": "There are formulas... I&#39;ve seen them somewhere.. But this geo library is brilliant. It will save you live will all kind of geo related functions."}], "tags": [], "owner": {"reputation": 2191, "user_id": 9590251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1bc63e8510dda3d6969da82b4ad6d3f?s=128&d=identicon&r=PG&f=1", "display_name": "Timothy", "link": "https://stackoverflow.com/users/9590251/timothy"}, "is_accepted": true, "score": 1, "last_activity_date": 1528881628, "creation_date": 1528881628, "answer_id": 50833550, "question_id": 50833301, "link": "https://stackoverflow.com/questions/50833301/how-can-i-find-distance-between-two-lines-linestrings-from-geojson-on-earth/50833550#50833550", "title": "How can I find distance between two lines (linestrings from geojson) on earth", "body": "<p>Get points <a href=\"http://turfjs.org/docs#explode\" rel=\"nofollow noreferrer\">http://turfjs.org/docs#explode</a> and via <a href=\"http://turfjs.org/docs#coordEach\" rel=\"nofollow noreferrer\">http://turfjs.org/docs#coordEach</a> find its distance to line <a href=\"http://turfjs.org/docs#pointToLineDistance\" rel=\"nofollow noreferrer\">http://turfjs.org/docs#pointToLineDistance</a></p>\n"}, {"comments": [{"owner": {"reputation": 2191, "user_id": 9590251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1bc63e8510dda3d6969da82b4ad6d3f?s=128&d=identicon&r=PG&f=1", "display_name": "Timothy", "link": "https://stackoverflow.com/users/9590251/timothy"}, "edited": false, "score": 1, "creation_date": 1528962438, "post_id": 50850270, "comment_id": 88707044, "body": "Correct. Either simple way <a href=\"http://turfjs.org/docs/#distance\" rel=\"nofollow noreferrer\">turfjs.org/docs/#distance</a> or more math kind of <a href=\"https://www.movable-type.co.uk/scripts/latlong.html\" rel=\"nofollow noreferrer\">movable-type.co.uk/scripts/latlong.html</a> will help you"}, {"owner": {"reputation": 336, "user_id": 8689468, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KZXP3.jpg?s=128&g=1", "display_name": "Mzia", "link": "https://stackoverflow.com/users/8689468/mzia"}, "reply_to_user": {"reputation": 2191, "user_id": 9590251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1bc63e8510dda3d6969da82b4ad6d3f?s=128&d=identicon&r=PG&f=1", "display_name": "Timothy", "link": "https://stackoverflow.com/users/9590251/timothy"}, "edited": false, "score": 0, "creation_date": 1528963106, "post_id": 50850270, "comment_id": 88707466, "body": "I used  movable-type.co.uk/scripts/latlong.html for point to point measurements. Than you for all links you gave, you helped me with your clue :)"}], "tags": [], "owner": {"reputation": 336, "user_id": 8689468, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KZXP3.jpg?s=128&g=1", "display_name": "Mzia", "link": "https://stackoverflow.com/users/8689468/mzia"}, "is_accepted": false, "score": 0, "last_activity_date": 1528954520, "creation_date": 1528954520, "answer_id": 50850270, "question_id": 50833301, "link": "https://stackoverflow.com/questions/50833301/how-can-i-find-distance-between-two-lines-linestrings-from-geojson-on-earth/50850270#50850270", "title": "How can I find distance between two lines (linestrings from geojson) on earth", "body": "<p>So, I do this\nI have two lines AB and CD\nI find distance from point A to line CD, from point C to CD, from point C to line AB, from point D to line AB\nPut it all into array and after than find the smallest distance </p>\n\n<p>(if line lines do not intersect or parallel, i'll put this cases into special condition)</p>\n"}], "owner": {"reputation": 336, "user_id": 8689468, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KZXP3.jpg?s=128&g=1", "display_name": "Mzia", "link": "https://stackoverflow.com/users/8689468/mzia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 296, "favorite_count": 0, "accepted_answer_id": 50833550, "answer_count": 2, "score": 0, "last_activity_date": 1528954520, "creation_date": 1528880878, "question_id": 50833301, "link": "https://stackoverflow.com/questions/50833301/how-can-i-find-distance-between-two-lines-linestrings-from-geojson-on-earth", "title": "How can I find distance between two lines (linestrings from geojson) on earth", "body": "<p>How can I find the smallest distance between two lines on Earth if I have their latitudes and longitudes? \nPreference to golang, but it'll be cool in an any programming language</p>\n\n<p>I really tried to find it, but I can only find how to do it for two points </p>\n"}, {"tags": ["go", "methods", "struct", "reflection"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1528879890, "creation_date": 1528879890, "answer_id": 50832948, "question_id": 50832854, "link": "https://stackoverflow.com/questions/50832854/how-can-i-call-golang-struct-fields-function/50832948#50832948", "title": "How can I call golang struct field&#39;s function?", "body": "<p><code>vf</code> is already of type <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"nofollow noreferrer\"><code>reflect.Value</code></a>, you don't have to pass that to another <a href=\"https://golang.org/pkg/reflect/#ValueOf\" rel=\"nofollow noreferrer\"><code>reflect.ValueOf()</code></a> call.</p>\n\n<p>Just call <a href=\"https://golang.org/pkg/reflect/#Value.MethodByName\" rel=\"nofollow noreferrer\"><code>MethodByName()</code></a> on <code>vf</code>:</p>\n\n<pre><code>vf.MethodByName(\"Foo\").Call([]reflect.Value{})\n</code></pre>\n\n<p>Output will be (try it on the <a href=\"https://play.golang.org/p/WugJ1p-OYEu\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>*main.T\nptr\nfoo\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 6343974, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-kLBlkm07d20/AAAAAAAAAAI/AAAAAAAAACc/w78AVoFYBSc/photo.jpg?sz=128", "display_name": "Minglang Jing", "link": "https://stackoverflow.com/users/6343974/minglang-jing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 551, "favorite_count": 0, "accepted_answer_id": 50832948, "answer_count": 1, "score": 0, "last_activity_date": 1528879996, "creation_date": 1528879621, "last_edit_date": 1528879996, "question_id": 50832854, "link": "https://stackoverflow.com/questions/50832854/how-can-i-call-golang-struct-fields-function", "title": "How can I call golang struct field&#39;s function?", "body": "<pre><code>package main\n\nimport \"fmt\"\nimport \"reflect\"\n\ntype T struct{}\n\nfunc (t *T) Foo() {\n    fmt.Println(\"foo\")\n}\n\ntype A struct {\n    Ts T\n}\n\nfunc main() {\n    var t T\n    var a A = A{Ts: t}\n    val := reflect.ValueOf(&amp;a).Elem()\n    for i := 0; i &lt; val.NumField(); i++ {\n        vf := val.Field(i).Addr()\n        fmt.Println(vf.Type())\n        fmt.Println(vf.Kind())\n        reflect.ValueOf(vf).MethodByName(\"Foo\").Call([]reflect.Value{})\n    }\n\n}\n</code></pre>\n\n<blockquote>\n  <p>$ go run reflect_call_1.go<br>\n  *main.T ptr panic: reflect: call of reflect.Value.Call on zero Value  </p>\n  \n  <p>goroutine 1 [running]: reflect.flag.mustBe(0x0, 0x13)<br>\n    /usr/local/go/src/reflect/value.go:201 +0xae reflect.Value.Call(0x0,\n  0x0, 0x0, 0xc420049f00, 0x0, 0x0, 0x0, 0x0, 0x40457c)<br>\n    /usr/local/go/src/reflect/value.go:300 +0x38  </p>\n</blockquote>\n"}, {"tags": ["json", "go", "struct", "marshalling"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528878147, "post_id": 50831987, "comment_id": 88668812, "body": "Not sure if you&#39;ve considered this, but you could declare a new type based off of <code>sql.NullInt64</code>, have it implement the MarshalJSON method together with the Scan and Value methods and use that in all your other types, then those types wouldn&#39;t have to implement the Marshaler interface."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528879562, "post_id": 50831987, "comment_id": 88669590, "body": "Side note: Parent and Child have an ugly smell of traditional inheritance OOP. Maybe you should remodel your types first?"}, {"owner": {"reputation": 230, "user_id": 1576231, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e33d33c90e755605f1f8237fec63dbba?s=128&d=identicon&r=PG", "display_name": "dieser_K3", "link": "https://stackoverflow.com/users/1576231/dieser-k3"}, "edited": false, "score": 0, "creation_date": 1528892872, "post_id": 50831987, "comment_id": 88678202, "body": "The names were just for showing my problem. In the real use case the problem was that I cannot just add a field to my SQL table because it has to be generated on the fly and is expected by the front-end on the same level as the remainder of the JSON."}], "answers": [{"comments": [{"owner": {"reputation": 230, "user_id": 1576231, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e33d33c90e755605f1f8237fec63dbba?s=128&d=identicon&r=PG", "display_name": "dieser_K3", "link": "https://stackoverflow.com/users/1576231/dieser-k3"}, "edited": false, "score": 0, "creation_date": 1528892801, "post_id": 50832801, "comment_id": 88678152, "body": "For some reason Option 2 didn&#39;t worked for me. Option 2 works but the way icza has shown was what I searched for."}], "tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": false, "score": 1, "last_activity_date": 1528879447, "creation_date": 1528879447, "answer_id": 50832801, "question_id": 50831987, "link": "https://stackoverflow.com/questions/50831987/json-marshaling-of-composite-structs-which-both-implement-marshaljson/50832801#50832801", "title": "JSON Marshaling of composite structs which both implement MarshalJSON()", "body": "<p>You should either have a named pointer to parent or embeded value of Parent.</p>\n\n<p>Option 1 will give you JSON you expect.</p>\n\n<pre><code>type Child struct {\n    Parent\n    Status int `json:\"status\"`\n}\n&gt;&gt; {\"some_string\":\"Hello\",\"id\":1, \"status\": 1}\n</code></pre>\n\n<p>Option 2 will put parent as sub-node.</p>\n\n<pre><code>type Child struct {\n    Parent *Parent\n    Status int `json:\"status\"`\n}\n&gt;&gt; {Parent: {\"some_string\":\"Hello\",\"id\":1}, \"status\": 1}\n</code></pre>\n\n<p>Another hacky option would be to marshal parent &amp; child separately and then join manually by cutting last/first characters, join with <code>,</code> and wrap in <code>{}</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1528879625, "creation_date": 1528879625, "answer_id": 50832855, "question_id": 50831987, "link": "https://stackoverflow.com/questions/50831987/json-marshaling-of-composite-structs-which-both-implement-marshaljson/50832855#50832855", "title": "JSON Marshaling of composite structs which both implement MarshalJSON()", "body": "<p>It looks you only define a custom marshaling logic because of the custom ID marshaling. Define your custom marshaling for the <code>IDType</code> type only which is not embedded, so it won't cause any trouble marshaling the other types:</p>\n\n<pre><code>func (id *IDType) MarshalJSON() ([]byte, error) {\n    return json.Marshal(id.Value)\n}\n</code></pre>\n\n<p>And no other custom marshaling are required. With this, the output will be:</p>\n\n<pre><code>{\"id\":1,\"some_string\":\"Hello\"}\n{\"id\":1,\"some_string\":\"Hello\",\"status\":1}\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/ZW-yVkMWbuX\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 230, "user_id": 1576231, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/e33d33c90e755605f1f8237fec63dbba?s=128&d=identicon&r=PG", "display_name": "dieser_K3", "link": "https://stackoverflow.com/users/1576231/dieser-k3"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 674, "favorite_count": 0, "accepted_answer_id": 50832855, "answer_count": 2, "score": 2, "last_activity_date": 1528892786, "creation_date": 1528876793, "last_edit_date": 1528892786, "question_id": 50831987, "link": "https://stackoverflow.com/questions/50831987/json-marshaling-of-composite-structs-which-both-implement-marshaljson", "title": "JSON Marshaling of composite structs which both implement MarshalJSON()", "body": "<p>I faced recently the following problem and have not found any solution. I have two struct types in Go, let us call them Parent and Child. Child has an anonymous field of the type *Parent. However, Parent has a field called \"ID\" which has the type of a third struct which type we will call \"IDType\" (in my real problem this is a dialect/sql.NullInt64). IDType has an int field and a bool field. </p>\n\n<p>The problem is the following: Both, Parent and Child, implement MarshalJSON() because for Parent I only want the int field inside the JSON and for Child the same. However, it seems that both MarshalJSONs infer with the result that only the values of Parent are encoded in the final JSON.</p>\n\n<p>Maybe a minimal example makes it easier to understand:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n)\n\ntype IDType struct {\n    Value int\n    Valid bool\n}\n\ntype Parent struct {\n    ID         IDType `json:\"id\"`\n    SomeString string `json:\"some_string\"`\n}\n\ntype Child struct {\n    *Parent\n    Status int `json:\"status\"`\n}\n\nfunc (parent *Parent) MarshalJSON() ([]byte, error) {\n    type Alias Parent\n    fmt.Println(\"Parent\")\n    return json.Marshal(struct {\n        *Alias\n        ID int `json:\"id\"`\n    }{\n        Alias: (*Alias)(parent),\n        ID:    parent.ID.Value,\n    })\n}\n\nfunc (child *Child) MarshalJSON() ([]byte, error) {\n    type Alias Child\n    fmt.Println(\"Child\")\n    return json.Marshal(struct {\n        *Alias\n        Status int `json:\"status\"`\n    }{\n        Alias:  (*Alias)(child),\n        Status: child.Status,\n    })\n}\n\nfunc main() {\n    ID := IDType{Value: 1, Valid: true}\n    parent := Parent{ID: ID, SomeString: \"Hello\"}\n    child := Child{Parent: &amp;Parent{ID: ID, SomeString: \"Hello\"}, Status: 1}\n    json.NewEncoder(os.Stdout).Encode(&amp;parent)\n    json.NewEncoder(os.Stdout).Encode(&amp;child)\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>Parent\n{\"some_string\":\"Hello\",\"id\":1}\nChild\nParent\n{\"some_string\":\"Hello\",\"id\":1}\n</code></pre>\n\n<p>I expect something like:</p>\n\n<pre><code>Parent\n{\"some_string\":\"Hello\",\"id\":1}\nChild\nParent\n{\"some_string\":\"Hello\",\"id\":1, \"status\": 1}\n</code></pre>\n"}, {"tags": ["for-loop", "go"], "comments": [{"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 1, "creation_date": 1528876739, "post_id": 50831892, "comment_id": 88668025, "body": "Well... i can&#39;t be negative so you <b>have</b> to check when it goes to 0."}, {"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 1, "creation_date": 1528876778, "post_id": 50831892, "comment_id": 88668045, "body": "Or you use an int32."}, {"owner": {"reputation": 77, "user_id": 4723053, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c2fa4cbb65d1307be11dbac91a75abc?s=128&d=identicon&r=PG&f=1", "display_name": "Hanif Bin Ariffin", "link": "https://stackoverflow.com/users/4723053/hanif-bin-ariffin"}, "edited": false, "score": 0, "creation_date": 1552066142, "post_id": 50831892, "comment_id": 96883773, "body": "All values of an unsigned integer is positive...therefore your condition will always be true."}], "answers": [{"comments": [{"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 0, "creation_date": 1528876864, "post_id": 50831984, "comment_id": 88668118, "body": "You forgot the disclaimer: &quot;don&#39;t do that to keep the code readable&quot;."}, {"owner": {"reputation": 79, "user_id": 2070938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba8ebab7c63bf18c6f81b064a5088a98?s=128&d=identicon&r=PG", "display_name": "cachekeyval", "link": "https://stackoverflow.com/users/2070938/cachekeyval"}, "edited": false, "score": 0, "creation_date": 1528877052, "post_id": 50831984, "comment_id": 88668229, "body": "Thanks for the constant max.MaxUint32. I was looking for her :) Solved."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1528878887, "post_id": 50831984, "comment_id": 88669211, "body": "<code>i != ^uint32(0)</code> would also do without resorting to importing <code>math</code>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1528878971, "post_id": 50831984, "comment_id": 88669262, "body": "@kostix True, I forgot about that :)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1588665859, "last_edit_date": 1588665859, "creation_date": 1528876778, "answer_id": 50831984, "question_id": 50831892, "link": "https://stackoverflow.com/questions/50831892/ambiguous-behavior-of-for-loop-in-golang/50831984#50831984", "title": "Ambiguous behavior of For loop in Golang", "body": "<p><code>i</code> is of type <code>uint32</code>, so once it reaches <code>0</code>, decrementing again will result in the max value of <code>uint32</code>. Change the loop condition to check for that:</p>\n\n<pre><code>var i uint32 // code bellow works fine with int32\nfor i = 31; i != 0xffffffff; i-- {\n    fmt.Println(i)\n}\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/T10ZUtmlFLQ\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>Or use the <code>math.MaxUint32</code> constant:</p>\n\n<pre><code>var i uint32 // code bellow works fine with int32\nfor i = 31; i != max.MaxUint32; i-- {\n    fmt.Println(i)\n}\n</code></pre>\n\n<p>Or use the <code>^uint32(0)</code> expression, where the <code>^</code> operator is the bitwise complement operator, applied on <code>0</code> will give you a value where all the bits are ones: the max value for <code>uint32</code>.</p>\n\n<p>Although if you look at the code, it's not intuitive, hard to understand. So you should use alternatives where this is not required and are more straightforward, such as using <code>int32</code> and checking for <code>i &gt;= 0</code>, or use an upward loop, such as:</p>\n\n<pre><code>for i := uint32(0); i &lt; 32; i++ {\n    fmt.Println(31 - i)\n}\n</code></pre>\n\n<p>Or offset the loop variable's range with +1, so you can test for <code>i &gt;= 1</code> or <code>i &gt; 0</code>:</p>\n\n<pre><code>for i := uint32(32); i &gt; 0; i-- {\n    fmt.Println(i-1)\n}\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 2070938, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba8ebab7c63bf18c6f81b064a5088a98?s=128&d=identicon&r=PG", "display_name": "cachekeyval", "link": "https://stackoverflow.com/users/2070938/cachekeyval"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 50831984, "answer_count": 1, "score": 1, "last_activity_date": 1588665859, "creation_date": 1528876512, "last_edit_date": 1528877895, "question_id": 50831892, "link": "https://stackoverflow.com/questions/50831892/ambiguous-behavior-of-for-loop-in-golang", "title": "Ambiguous behavior of For loop in Golang", "body": "<p>I want make some simple loop like this:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var i uint32 // code bellow works fine with int32\n    for i = 31; i &gt;= 0; i-- {\n        fmt.Println(i)\n    }\n}\n</code></pre>\n\n<p>But this loop is endless, if <code>i</code> has type <code>uint32</code>. If <code>i</code> is <code>int32</code> it`s ok.</p>\n\n<p>How I can break this loop, if <code>i</code> has type <code>uint32</code> without checking <code>if i == 0</code>?</p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528879713, "post_id": 50830676, "comment_id": 88669682, "body": "Refresh your knowledge about pointer in the Tour of Go, maybe starting from <a href=\"https://tour.golang.org/moretypes/1\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/1</a>"}, {"owner": {"reputation": 3271, "user_id": 7607701, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-0eLxeTB_SdQ/AAAAAAAAAAI/AAAAAAAAABg/XZT1oaa0wqA/photo.jpg?sz=128", "display_name": "Aaron N. Brock", "link": "https://stackoverflow.com/users/7607701/aaron-n-brock"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1528901345, "post_id": 50830676, "comment_id": 88684079, "body": "@Volker I went through the tour before asking the question but it didn&#39;t appear to address the case of setting a pointer to a value directly."}], "answers": [{"tags": [], "owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "is_accepted": false, "score": 3, "last_activity_date": 1528872640, "creation_date": 1528872640, "answer_id": 50830745, "question_id": 50830676, "link": "https://stackoverflow.com/questions/50830676/set-int-pointer-to-int-value-golang/50830745#50830745", "title": "Set int Pointer to int Value Golang", "body": "<p>Assuming you really want an int pointer and not just an int, then you need a variable to store the <code>int</code> you point to. For example:</p>\n\n<pre><code>var guess *int\na := 12345\nguess = &amp;a\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 29, "last_activity_date": 1528875706, "last_edit_date": 1528875706, "creation_date": 1528872799, "answer_id": 50830786, "question_id": 50830676, "link": "https://stackoverflow.com/questions/50830676/set-int-pointer-to-int-value-golang/50830786#50830786", "title": "Set int Pointer to int Value Golang", "body": "<p>You have a pointer variable which after declaration will be <code>nil</code>.</p>\n\n<p>If you want to set the pointed value, it must point to something. Attempting to dereference a <code>nil</code> pointer is a runtime panic, just what you experienced. You may use the builtin <a href=\"https://golang.org/pkg/builtin/#new\" rel=\"noreferrer\"><code>new()</code></a> function to obtain a pointer to a zero-valued <code>int</code>, and then you can set the pointed value:</p>\n\n<pre><code>var guess *int\nguess = new(int)\n*guess = 12345\n</code></pre>\n\n<p>Your modified app:</p>\n\n<pre><code>var guess *int\nfmt.Println(guess)\nguess = new(int)\n*guess = 12345\nfmt.Println(guess, *guess)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/uNtN6O2hoAi\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&lt;nil&gt;\n0x10414028 12345\n</code></pre>\n\n<p>Note that you can make this shorter using a <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"noreferrer\">short variable declaration</a> like this:</p>\n\n<pre><code>guess := new(int)\n*guess = 12345\n</code></pre>\n\n<p>Another option to make a pointer point to something \"useful\" is to assign the address of a variable to the pointer variable, like this:</p>\n\n<pre><code>value := 12345 // will be of type int\nguess := &amp;value\n</code></pre>\n\n<p>But this solution modifies the pointer value, not the pointed value. The result is the same though in this simple example.</p>\n\n<p>You could also just assign the address of another variable, and then proceed to change the pointed value:</p>\n\n<pre><code>var value int\nguess := &amp;value\n*guess = 12345\n</code></pre>\n\n<p>Also note that since <code>guess</code> points to <code>value</code>, changing the pointed value will change the value of the <code>value</code> variable too. Also if you change the <code>value</code> variable directly, the pointed value by <code>guess</code> also changes: they are one and the same:</p>\n\n<pre><code>var value int\nguess := &amp;value\nvalue = 12345\nfmt.Println(*guess) // This will also print 12345\n</code></pre>\n\n<p>Try this one on the <a href=\"https://play.golang.org/p/54e3FwohGRB\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 159, "user_id": 13383986, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3wXK1.png?s=128&g=1", "display_name": "GoForth", "link": "https://stackoverflow.com/users/13383986/goforth"}, "edited": false, "score": 0, "creation_date": 1593308951, "post_id": 55696573, "comment_id": 110733705, "body": "I actually searched this question looking for a built-in like this.  Nice."}], "tags": [], "owner": {"reputation": 2266, "user_id": 2128901, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fb08c32a2d1d2dff42f538d968632b7f?s=128&d=identicon&r=PG", "display_name": "Matt Wielbut", "link": "https://stackoverflow.com/users/2128901/matt-wielbut"}, "is_accepted": false, "score": 3, "last_activity_date": 1555359020, "creation_date": 1555359020, "answer_id": 55696573, "question_id": 50830676, "link": "https://stackoverflow.com/questions/50830676/set-int-pointer-to-int-value-golang/55696573#55696573", "title": "Set int Pointer to int Value Golang", "body": "<p>FWIW, if you do this often enough (like setting up data in unit tests) it's useful to have a shorthand, hence:</p>\n\n<p><a href=\"https://github.com/mwielbut/pointy\" rel=\"nofollow noreferrer\">https://github.com/mwielbut/pointy</a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>val := 42\npointerToVal := &amp;val\n// vs.\npointerToVal := pointy.Int(42)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 159, "user_id": 13383986, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3wXK1.png?s=128&g=1", "display_name": "GoForth", "link": "https://stackoverflow.com/users/13383986/goforth"}, "is_accepted": false, "score": 1, "last_activity_date": 1593309232, "creation_date": 1593309232, "answer_id": 62617386, "question_id": 50830676, "link": "https://stackoverflow.com/questions/50830676/set-int-pointer-to-int-value-golang/62617386#62617386", "title": "Set int Pointer to int Value Golang", "body": "<p>Just throwing my hat into the ring on this one.  Here's a util func:</p>\n<pre><code>func getIntPointer(val int) *int {\n    return &amp;val\n}\n</code></pre>\n<p>Or as an inline anonymous func:</p>\n<pre><code>func(val int) *int { return &amp;val }\n</code></pre>\n<p>For example,</p>\n<pre><code>var foo *int = func(val int) *int { return &amp;val }(10)\n</code></pre>\n<p><a href=\"https://play.golang.org/p/okjdWzTLnQy\" rel=\"nofollow noreferrer\">Run in playground</a></p>\n<p>Peace</p>\n"}], "owner": {"reputation": 3271, "user_id": 7607701, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-0eLxeTB_SdQ/AAAAAAAAAAI/AAAAAAAAABg/XZT1oaa0wqA/photo.jpg?sz=128", "display_name": "Aaron N. Brock", "link": "https://stackoverflow.com/users/7607701/aaron-n-brock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17950, "favorite_count": 4, "accepted_answer_id": 50830786, "answer_count": 4, "score": 12, "last_activity_date": 1593309232, "creation_date": 1528872361, "question_id": 50830676, "link": "https://stackoverflow.com/questions/50830676/set-int-pointer-to-int-value-golang", "title": "Set int Pointer to int Value Golang", "body": "<p>I'm very new to Go and am trying to set a <code>*int</code> to point to a number, say <code>12345</code>.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    var guess *int\n    fmt.Println(reflect.TypeOf(guess))\n    *guess = 12345\n    fmt.Println(guess)\n}\n</code></pre>\n\n<p>But it's giving me the following error:</p>\n\n<pre><code>Type: *int\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x483c7d]\n\ngoroutine 1 [running]:\nmain.main()\n    /home/aaron/projects/gopath/src/github.com/AaronNBrock/go-guess/main.go:16 +0x9d\nexit status 2\n</code></pre>\n\n<p>I see that the error is with the <code>*guess = 12345</code> since <code>12345</code>, but I'm not sure what's causing it.</p>\n"}, {"tags": ["go", "struct", "composite-literals"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 13, "last_activity_date": 1528871574, "last_edit_date": 1528871574, "creation_date": 1528871200, "answer_id": 50830393, "question_id": 50830340, "link": "https://stackoverflow.com/questions/50830340/what-does-initializing-a-go-struct-in-parentheses-do/50830393#50830393", "title": "What does initializing a Go struct in parentheses do?", "body": "<p>It does nothing special, those 2 lines are identical.</p>\n\n<p>However, when you want to use that in an <code>if</code> statement for example, the parentheses will be required, else you get a compile time error:</p>\n\n<pre><code>if i := Item{3, \"a\"}; i.Id == 3 {\n}\n</code></pre>\n\n<p>Results in:</p>\n\n<blockquote>\n  <p>expected boolean expression, found simple statement (missing parentheses around composite literal?) (and 1 more errors)</p>\n</blockquote>\n\n<p>This is because a parsing ambiguity arises: it's not obvious if the opening brace would be part of the composite literal or the body of the <code>if</code> statement.</p>\n\n<p>Using parentheses will make it unambiguous for the compiler, so this works:</p>\n\n<pre><code>if i := (Item{3, \"a\"}); i.Id == 3 {\n}\n</code></pre>\n\n<p>For details, see: <a href=\"https://stackoverflow.com/questions/35120724/struct-in-for-loop-initializer/35120825#35120825\">Struct in for loop initializer</a></p>\n"}], "owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 486, "favorite_count": 1, "accepted_answer_id": 50830393, "answer_count": 1, "score": 5, "last_activity_date": 1528871574, "creation_date": 1528871001, "last_edit_date": 1528871272, "question_id": 50830340, "link": "https://stackoverflow.com/questions/50830340/what-does-initializing-a-go-struct-in-parentheses-do", "title": "What does initializing a Go struct in parentheses do?", "body": "<p>Normally, I will initialize a struct like:</p>\n\n<pre><code>item1 := Item{1, \"Foo\"}\n</code></pre>\n\n<p>However, I've recently seen code initializing with parens:</p>\n\n<pre><code>item2 := (Item{2, \"Bar\"})\n</code></pre>\n\n<p><code>reflect</code> returns the same <code>Item</code> name.</p>\n\n<p>What does initializing in parentheses do and when is it preferred?</p>\n\n<p>Here's some Go code to try this out:</p>\n\n<ul>\n<li>Playground: <a href=\"https://play.golang.org/p/_gsaruS_DVi\" rel=\"nofollow noreferrer\">https://play.golang.org/p/_gsaruS_DVi</a></li>\n</ul>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1528876959, "post_id": 50830292, "comment_id": 88668174, "body": "Why are you creating a context in middleware? The http package already creates a context for you for each request."}, {"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1528877148, "post_id": 50830292, "comment_id": 88668290, "body": "@Flimzy so i just simply use the <code>func (r *Request) Context() context.Context</code> API to get and use?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1528877615, "post_id": 50830292, "comment_id": 88668550, "body": "Unless you have a specific reason not to (i.e. you specifically do NOT want your context to be cancelled when the request terminates), yes."}, {"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1528878087, "post_id": 50830292, "comment_id": 88668778, "body": "@Flimzy got it, thank u very much"}], "answers": [{"comments": [{"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "edited": false, "score": 0, "creation_date": 1528876750, "post_id": 50831896, "comment_id": 88668033, "body": "oh, i see, so those values i set in the context actually doesn&#39;t matter at all, i can just simply pass the upstream context down to the downstream"}, {"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "edited": false, "score": 0, "creation_date": 1528876985, "post_id": 50831896, "comment_id": 88668190, "body": "BTW, where i can find any doc to indicate that the context values will NOT be transported across network boundaries, or any example to verify that?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1528877070, "post_id": 50831896, "comment_id": 88668238, "body": "@Inshi: A more valid question would be &quot;Why would you assume values WOULD be transported?&quot; You won&#39;t find documentation for everything not done (i.e. &quot;Where do I find documentation that the context package doesn&#39;t clean my toilet?&quot;). You&#39;ll only find documentation for things that are supported."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 2, "last_activity_date": 1528876521, "creation_date": 1528876521, "answer_id": 50831896, "question_id": 50830292, "link": "https://stackoverflow.com/questions/50830292/should-i-create-a-new-context-for-downstream-service-call-or-just-simply-pass-th/50831896#50831896", "title": "Should I create a new context for downstream service call or just simply pass the upstream one?", "body": "<p>Context values are not transported across network boundaries. It's not possible since there is no way to get a list of all values from a context without knowing all the keys.</p>\n\n<p>What <em>is</em> transported is the cancelation signal. That is, if the client of your service gives up before an RPC completes, upstream services can stop their work as well. Whether or not that is desired is a case-by-case decision: you may not want to cancel sending email after registration has already completed, but it's usually totaly fine to cancel read-only operations.</p>\n"}], "owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 0, "accepted_answer_id": 50831896, "answer_count": 1, "score": 2, "last_activity_date": 1529239830, "creation_date": 1528870801, "last_edit_date": 1529239830, "question_id": 50830292, "link": "https://stackoverflow.com/questions/50830292/should-i-create-a-new-context-for-downstream-service-call-or-just-simply-pass-th", "title": "Should I create a new context for downstream service call or just simply pass the upstream one?", "body": "<p>The process is like this: for each incoming HTTP request, I have an early common handler which will create the context for the request, also there are some other common handlers which will do some pre-processing/parsing operations then put some data in the context for future usages, eventually will call one downstream grpc API.</p>\n\n<p>Now I cannot make my mind on this:</p>\n\n<ol>\n<li><p>I just simply pass the context created by the early common handler to the grpc API call, the concern is the downstream API doesn't need those data previously I put in the context, so I plan to use the <code>WithValue(parent Context, key, val interface{}) Context</code> API to set them all to <code>nil</code> before making the grpc call;</p></li>\n<li><p>I create a totally new context <code>outgoingCtx := metadata.NewOutgoingContext(context.Background(), md)</code>, then upon the early context <code>ctx.Done()</code> I called the <code>Cancel()</code> on this <code>outgoingCtx</code>;</p></li>\n</ol>\n\n<p>Which option is better, or it doesn't really make any difference, even for very high concurrency case?</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-ses"], "answers": [{"comments": [{"owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "edited": false, "score": 0, "creation_date": 1529917876, "post_id": 51011945, "comment_id": 89032312, "body": "I found the issue. It was not with the code but I did not place the credentials file at right place. It should be placed at ~.aws/credentials on my server root."}], "tags": [], "owner": {"reputation": 109, "user_id": 1577868, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I7SGs.jpg?s=128&g=1", "display_name": "jonhadfield", "link": "https://stackoverflow.com/users/1577868/jonhadfield"}, "is_accepted": false, "score": 0, "last_activity_date": 1529858539, "creation_date": 1529858539, "answer_id": 51011945, "question_id": 50829144, "link": "https://stackoverflow.com/questions/50829144/credentials-error-while-sending-emails-from-aws-ses/51011945#51011945", "title": "Credentials Error While sending emails from AWS SES", "body": "<p>The first error (NoCredentialProviders) isn't an issue with code but that it can't find any credentials. According to <a href=\"https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/configuring-sdk.html\" rel=\"nofollow noreferrer\">this page</a> it automatically checks in the following order:</p>\n\n<ol>\n<li>Environment variables.</li>\n<li>Shared credentials file.</li>\n<li>If your application is running on an Amazon EC2 instance, IAM role for Amazon EC2.</li>\n</ol>\n\n<p>If it worked in one environment and not another I'm guessing you had an IAM role with the necessary permissions associated with an EC2 instance via an Instance Profile.</p>\n\n<p>To set credentials explicitly, try this:</p>\n\n<pre><code>staticCreds = credentials.NewStaticCredentials(\"&lt;key-id&gt;\", \"&lt;secret&gt;\", \"&lt;session token&gt;\")\nsession, err = session.NewSession(&amp;aws.Config{Credentials: staticCreds})\n</code></pre>\n"}], "owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 251, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1529858539, "creation_date": 1528864475, "last_edit_date": 1528865151, "question_id": 50829144, "link": "https://stackoverflow.com/questions/50829144/credentials-error-while-sending-emails-from-aws-ses", "title": "Credentials Error While sending emails from AWS SES", "body": "<p>I am trying to send emails through Amazon SES in Golang. Previously it was working on a development server (without SSL) with following code:</p>\n\n<pre><code>sess, err := session.NewSession(&amp;aws.Config{\n            Region:aws.String(AwsRegion)},\n        )\n\n    /* Create an SES client in the session */\n    svc := ses.New(sess)\n\n    /* Assemble the email */\n    input := &amp;ses.SendEmailInput{\n        Destination: &amp;ses.Destination{\n            CcAddresses: []*string{\n            },\n            ToAddresses: []*string{\n                aws.String(request.EmailTo),\n            },\n        },\n        Message: &amp;ses.Message{\n            Body: &amp;ses.Body{\n                Html: &amp;ses.Content{\n                    Charset: aws.String(CharSet),\n                    Data:    aws.String(body),\n                },\n            },\n            Subject: &amp;ses.Content{\n                Charset: aws.String(CharSet),\n                Data:    aws.String(subject),\n            },\n        },\n        Source: aws.String(\"test&lt;test@example.com&gt;\"),\n    }\n\n    /* Attempt to send the email */\n    result, err := svc.SendEmail(input)\n</code></pre>\n\n<p>Recently I started working on the production server (with SSL) and the same code started giving me following error:</p>\n\n<pre><code>NoCredentialProviders: no valid providers in chain. Deprecated.\n        For verbose messaging see aws.Config.CredentialsChainVerboseErrors\n</code></pre>\n\n<p>I have tried adding credentials to the code like this:</p>\n\n<pre><code>creds := credentials.NewCredentials(&amp;ec2rolecreds.EC2RoleProvider{})\n\n/* updated session block with credentials in aws config */\nsess, err := session.NewSession(&amp;aws.Config{\n    Region: aws.String(AwsRegion),\n    Credentials: creds})\n</code></pre>\n\n<p>But this code is not working (not even compiling) and gives me following error:</p>\n\n<pre><code>/main.go:63:42: undefined: ec2rolecreds\n</code></pre>\n\n<p>However I have already included credentials package in code.</p>\n\n<p>I am not getting how to add credentials to this code so that it works on production server too. Any kind of help will be appreciated.</p>\n"}, {"tags": ["string", "go", "slice"], "comments": [{"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 1, "creation_date": 1528859963, "post_id": 50828601, "comment_id": 88661635, "body": "you mean like <code>mySlice := append([]byte(&quot;abc&quot;), 0)</code>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528870367, "post_id": 50828601, "comment_id": 88664509, "body": "If adding the 0 byte to you slice is the bottleneck in you application you are doing something strange. Sometimes efficiency does not matter."}, {"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1528870959, "post_id": 50828601, "comment_id": 88664813, "body": "What do you mean by &quot;final 0 char&quot;? Do you want to create a  null-terminated string, just like in c?"}, {"owner": {"reputation": 11, "user_id": 8464995, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-DPPNubv_zxk/AAAAAAAAAAI/AAAAAAAADFI/0wJ58F28H2U/photo.jpg?sz=128", "display_name": "Fabrice Decreau", "link": "https://stackoverflow.com/users/8464995/fabrice-decreau"}, "reply_to_user": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1529999078, "post_id": 50828601, "comment_id": 89066486, "body": "@mbuechmann: Yes, I want to create a null-terminated string, just like in C."}, {"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1529999189, "post_id": 50828601, "comment_id": 89066547, "body": "What would be the purpose of that?"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1528894206, "last_edit_date": 1528894206, "creation_date": 1528860231, "answer_id": 50828652, "question_id": 50828601, "link": "https://stackoverflow.com/questions/50828601/how-to-efficiently-convert-a-string-to-a-byte-slice-including-the-final-0-in-g/50828652#50828652", "title": "How to efficiently convert a string to a byte slice, including the final 0, in Go?", "body": "<p>Allocate a slice of the desired length. Copy the string to the slice.</p>\n\n<pre><code>s := \"abc\"\nmy_slice := make([]byte, len(s)+1)\ncopy(my_slice, s)\n</code></pre>\n\n<p>There's no need to set the last element to zero because make returns a slice with all elements set to zero.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1528867118, "last_edit_date": 1528867118, "creation_date": 1528866481, "answer_id": 50829405, "question_id": 50828601, "link": "https://stackoverflow.com/questions/50828601/how-to-efficiently-convert-a-string-to-a-byte-slice-including-the-final-0-in-g/50829405#50829405", "title": "How to efficiently convert a string to a byte slice, including the final 0, in Go?", "body": "<p>An efficient, one-line method is a function call that is inlined. For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc cstring(s string) []byte {\n    b := make([]byte, len(s)+1)\n    copy(b, s)\n    return b\n}\n\nfunc main() {\n    s := \"abc\"\n    fmt.Printf(\"%q\\n\", s)\n\n    c := cstring(s) // inlining call to cstring\n\n    fmt.Printf(\"%q\\n\", c)\n}\n</code></pre>\n\n<p>optimization decisions:</p>\n\n<pre><code>$ go tool compile -m cstring.go\ncstring.go:5:6: can inline cstring\ncstring.go:15:14: inlining call to cstring\ncstring.go:6:11: make([]byte, len(s) + 1) escapes to heap\ncstring.go:5:14: cstring s does not escape\ncstring.go:13:13: s escapes to heap\ncstring.go:15:14: make([]byte, len(s) + 1) escapes to heap\ncstring.go:17:13: c escapes to heap\ncstring.go:13:12: main ... argument does not escape\ncstring.go:17:12: main ... argument does not escape\n$\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run cstring.go\n\"abc\"\n\"abc\\x00\"\n$\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/7gi9gR7iWkS\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7gi9gR7iWkS</a></p>\n"}], "owner": {"reputation": 11, "user_id": 8464995, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-DPPNubv_zxk/AAAAAAAAAAI/AAAAAAAADFI/0wJ58F28H2U/photo.jpg?sz=128", "display_name": "Fabrice Decreau", "link": "https://stackoverflow.com/users/8464995/fabrice-decreau"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 422, "favorite_count": 1, "answer_count": 2, "score": -1, "last_activity_date": 1528894206, "creation_date": 1528859801, "last_edit_date": 1528866788, "question_id": 50828601, "link": "https://stackoverflow.com/questions/50828601/how-to-efficiently-convert-a-string-to-a-byte-slice-including-the-final-0-in-g", "title": "How to efficiently convert a string to a byte slice, including the final 0, in Go?", "body": "<p>I would like to convert a string to a byte slice, including the final 0 char.</p>\n\n<p>I am aware that the following code converts a string to a slice :</p>\n\n<pre><code>my_slice := []byte(\"abc\")\n</code></pre>\n\n<p>And that the following code can add the final 0 char:</p>\n\n<pre><code>my_slice = append(my_slice , 0)\n</code></pre>\n\n<p>But I wonder if it can be done more efficiently, maybe in 1 line, since both lines will allocate memory.</p>\n\n<p>Inefficient example: <a href=\"https://play.golang.org/p/Rg6ri3H66f9\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Rg6ri3H66f9</a></p>\n"}, {"tags": ["go", "homebrew"], "answers": [{"tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 3, "last_activity_date": 1528851019, "creation_date": 1528851019, "answer_id": 50827716, "question_id": 50827348, "link": "https://stackoverflow.com/questions/50827348/homebrew-formulas-for-golang/50827716#50827716", "title": "Homebrew formulas for Golang", "body": "<p>I'm pretty sure that your Homebrew formula is just a Ruby class with some DSL magic to make it friendlier. That means that <code>system</code> runs commands in a separate process so this:</p>\n\n<pre><code>system \"cd\", \"some_directory\"\n</code></pre>\n\n<p>will change the current directory in a separate process and then that process exits without affecting the parent.</p>\n\n<p>You should use <a href=\"http://ruby-doc.org/core/Dir.html#method-c-chdir\" rel=\"nofollow noreferrer\"><code>Dir.chdir</code></a> instead:</p>\n\n<pre><code>Dir.chdir buildpath/\"src/github.com/acarl005/ls-go\" do\n  system \"go\", \"get\", \"./\"\nend\nsystem \"go\", \"build\", \"-o\", bin/\"ls-go\"\n</code></pre>\n\n<p>Using the block form (i.e. <code>Dir.chdir dir do ... end</code>) will change directives, run the <code>system</code> command, and then change back to the original directory before continuing so you don't have to worry about the <code>cd -</code> part.</p>\n"}], "owner": {"reputation": 2667, "user_id": 6078821, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/5fhDI.jpg?s=128&g=1", "display_name": "Andy Carlson", "link": "https://stackoverflow.com/users/6078821/andy-carlson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 520, "favorite_count": 0, "accepted_answer_id": 50827716, "answer_count": 1, "score": 0, "last_activity_date": 1528851019, "creation_date": 1528847453, "question_id": 50827348, "link": "https://stackoverflow.com/questions/50827348/homebrew-formulas-for-golang", "title": "Homebrew formulas for Golang", "body": "<p>I want to write a Homebrew formula for installing a Go package and its dependencies. Here's what I've got so far:</p>\n\n<pre><code>class LsGo &lt; Formula\n  desc \"A more colorful, user-friendly implementation of `ls` written in Go\"\n  homepage \"https://github.com/acarl005/ls-go\"\n  url \"https://github.com/acarl005/ls-go/archive/v0.0.0.tar.gz\"\n  sha256 \"db9ba7300fbbaf92926b2c95fd63e3e936739e359f123b5a45e6ca04b490af51\"\n\n  depends_on \"go\" =&gt; :build\n\n  def install\n    ENV[\"GOPATH\"] = buildpath\n    (buildpath/\"src/github.com/acarl005\").mkpath\n    ln_s buildpath, buildpath/\"src/github.com/acarl005/ls-go\"\n    system \"cd\", buildpath/\"src/github.com/acarl005/ls-go\"\n    system \"go\", \"get\", \"./\"\n    system \"cd\", \"-\"\n    system \"go\", \"build\", \"-o\", bin/\"ls-go\"\n  end\n\n  test do\n    system bin/\"ls-go\", \"--help\"\n  end\nend\n</code></pre>\n\n<p>But I get an error about running <code>go get ./</code> outside the <code>$GOPATH</code>.</p>\n\n<pre><code>==&gt; cd /private/tmp/ls-go-20180612-22435-oidqms/ls-go-0.0.0/src/github.com/acarl005/ls-go\n==&gt; go get ./\nLast 15 lines from /Users/andy/Library/Logs/Homebrew/ls-go/02.go:\n2018-06-12 16:31:14 -0700\n\ngo\nget\n./\n\ngo get: no install location for directory /private/tmp/ls-go-20180612-22435-oidqms/ls-go-0.0.0 outside GOPATH\n</code></pre>\n\n<p>This doesn't make sense to me. I set <code>ENV[\"GOPATH\"]</code> to <code>/private/tmp/ls-go-20180612-22435-oidqms/ls-go-0.0.0/</code>, and I cd'ed into a subdir of that path. Why is it saying I'm outside the <code>$GOPATH</code>?</p>\n\n<p>How should I get the dependencies for my package?</p>\n\n<p>EDIT: I'd prefer to avoid vendoring packages.</p>\n"}, {"tags": ["go", "reflection", "type-conversion", "uuid"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1528844142, "creation_date": 1528844142, "answer_id": 50826936, "question_id": 50826889, "link": "https://stackoverflow.com/questions/50826889/go-convert-reflect-value-of-type-uuid-uuid-satori-back-to-uuid-uuid-again/50826936#50826936", "title": "Go: convert reflect.Value of type uuid.UUID (satori) back to uuid.UUID again", "body": "<p>Use a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> on the <a href=\"https://godoc.org/reflect#Value.Interface\" rel=\"nofollow noreferrer\">underlying value</a>:  </p>\n\n<pre><code>u, ok := reflectedValue.Interface().(uuid.UUID)\n</code></pre>\n"}], "owner": {"reputation": 2701, "user_id": 231582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b82066b95508c6d6a9b2e70c99064db8?s=128&d=identicon&r=PG", "display_name": "tirithen", "link": "https://stackoverflow.com/users/231582/tirithen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1805, "favorite_count": 0, "accepted_answer_id": 50826936, "answer_count": 1, "score": 0, "last_activity_date": 1528844142, "creation_date": 1528843745, "question_id": 50826889, "link": "https://stackoverflow.com/questions/50826889/go-convert-reflect-value-of-type-uuid-uuid-satori-back-to-uuid-uuid-again", "title": "Go: convert reflect.Value of type uuid.UUID (satori) back to uuid.UUID again", "body": "<p>I'm trying to convert a reflected UUID back to an actual UUID object again but can't find a way, when I print the reflected value it looks correct, but when trying to convert I can't find a way.</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"reflect\"\n\n  uuid \"github.com/satori/go.uuid\"\n)\n\nfunc main() {\n  value := uuid.Must(uuid.NewV4())\n  reflectedValue := reflect.ValueOf(value)\n  fmt.Println(reflectedValue)\n  result := reflectedValue.String()\n  fmt.Println(result)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>$ go run main.go\n0cca93f8-1763-4816-a2a0-09e7aeeb674c\n&lt;uuid.UUID Value&gt;\n</code></pre>\n\n<p>How to convert reflectedValue to uuid.UUID directly or []byte/string so I can make a uuid.UUID object from that. Since fmt.Println manages to print the correct value it has to be possible to make the conversion, but I can't figure out how.</p>\n\n<p>It seem like the uuid.UUID object has a data structure of 16 uint8 values.</p>\n"}, {"tags": ["docker", "go", "apache-kafka", "sarama"], "answers": [{"tags": [], "owner": {"reputation": 431, "user_id": 8098897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b98b33aae21691e1d0c45c29d779d7a5?s=128&d=identicon&r=PG&f=1", "display_name": "brianbhsu", "link": "https://stackoverflow.com/users/8098897/brianbhsu"}, "is_accepted": false, "score": 0, "last_activity_date": 1543179529, "last_edit_date": 1543179529, "creation_date": 1543179143, "answer_id": 53471852, "question_id": 50826247, "link": "https://stackoverflow.com/questions/50826247/unable-to-create-kafka-producer-client-with-sarama-golang-package-client-metada/53471852#53471852", "title": "Unable to create Kafka producer client with Sarama Golang package-&quot;client/metadata got error from broker while fetching metadata: EOF&quot;", "body": "<p>I ran into the same issue and I did the following which solve my problem:</p>\n\n<ol>\n<li><p>Check what version of Kafka you're using. The default Kafka version specified in the config when passed to <code>NewAsyncProducer</code> is <code>V0_8_2_0</code>. Make sure you specify the correct Kafka version in the config:</p>\n\n<pre><code>config := sarama.NewConfig()\nconfig.Version = sarama.V1_1_0_0\n</code></pre></li>\n<li><p>Make sure the broker URL you are passing is correct. You should be passing the broker URL, not the zookeeper URL or another URL. The default kafka port is <code>9092</code> so the URL should be similar to <code>BROKER_URL:9092</code> if you used the default port.</p></li>\n</ol>\n"}], "owner": {"reputation": 1, "user_id": 9932525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/caec8099b1664833f9f04d9943db6d36?s=128&d=identicon&r=PG&f=1", "display_name": "BenAODLions", "link": "https://stackoverflow.com/users/9932525/benaodlions"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2053, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1543179529, "creation_date": 1528839786, "question_id": 50826247, "link": "https://stackoverflow.com/questions/50826247/unable-to-create-kafka-producer-client-with-sarama-golang-package-client-metada", "title": "Unable to create Kafka producer client with Sarama Golang package-&quot;client/metadata got error from broker while fetching metadata: EOF&quot;", "body": "<p>Versions: GoLang 1.10.2\n          Kafka 4.4.1\n          Docker 18.03.1</p>\n\n<p>I'm trying to use Shopify's Sarama package to test out my Kafka instance. I used Docker compose to stand up Kafka/Zookeeper and it is all successfully running. </p>\n\n<p>When I try to create a Producer client with Sarama, an error is thrown. </p>\n\n<p>When I run the following </p>\n\n<pre><code>    package main\n\nimport (\n\"fmt\"\n\"log\"\n\"os\"\n\"os/signal\"\n\"time\"\n\n\"strconv\"\n\n\"github.com/Shopify/sarama\"\n</code></pre>\n\n<p>)</p>\n\n<pre><code>func main() {\n\n\n// Setup configuration\nconfig := sarama.NewConfig()\nconfig.Producer.Return.Successes = true\nconfig.Producer.Partitioner = sarama.NewRandomPartitioner\nconfig.Producer.RequiredAcks = sarama.WaitForAll\nbrokers := []string{\"localhost:29092\"}\nproducer, err := sarama.NewAsyncProducer(brokers, config)\nif err != nil {\n    // Should not reach here\n    panic(err)\n}\n\ndefer func() {\n    if err := producer.Close(); err != nil {\n        // Should not reach here\n        panic(err)\n    }\n}()\n</code></pre>\n\n<p>I get this </p>\n\n<p>[sarama] 2018/06/12 17:22:05 Initializing new client</p>\n\n<p>[sarama] 2018/06/12 17:22:05 client/metadata fetching metadata for all topics from broker localhost:29092</p>\n\n<p>[sarama] 2018/06/12 17:22:05 Connected to broker at localhost:29092 (unregistered)</p>\n\n<p>[sarama] 2018/06/12 17:22:05 client/metadata got error from broker while fetching metadata: EOF</p>\n\n<p>[sarama] 2018/06/12 17:22:05 Closed connection to broker localhost:29092</p>\n\n<p>{sarama] 2018/06/12 17:22:05 client/metadata no available broker to send metadata request to</p>\n\n<p>[sarama] 2018/06/12 17:22:06 Closing Client\npanic: kafka: client has run out of available brokers to talk to (Is your cluster reachable?)</p>\n\n<p>goroutine 1 [running]:\nmain.main()\n    /Users/benwornom/go/src/github.com/acstech/doppler-events/testprod/main.go:29 +0x3ec\nexit status 2</p>\n\n<p>Sarama did try several times in a row to create a producer client, but failed each time. </p>\n\n<p>My understanding of Sarama's \"NewAsyncProducer\" method is that it calls \"NewClient\", which is invoked regardless of whether you are creating a Producer or Consumer. NewClient attempts to gather metadata from the Kafka broker, which is failing in my situation. I know it is connecting to the Kafka broker, but once it connects it seems to break. Any advice would be helpful. My network connection is strong, I can't think of anything interfering with the server. As far as I know, I only have one broker and one partition for the existing topic. I don't think I have to manually assign a topic to a broker. If my client is connecting with the broker, why can't I establish a lasting connection for my producer?</p>\n\n<p>This is from the kafka log file right before it dies. </p>\n\n<p>__consumer_offsets-5 -> Vector(1), connect-offsets-23 -> Vector(1), __consumer_offsets-43 -> Vector(1), __consumer_offsets-32 -> Vector(1), __consumer_offsets-21 -> Vector(1), __consumer_offsets-10 -> Vector(1), connect-offsets-20 -> Vector(1), __consumer_offsets-37 -> Vector(1), connect-offsets-9 -> Vector(1), connect-status-4 -> Vector(1), __consumer_offsets-48 -> Vector(1), __consumer_offsets-40 -> Vector(1), __consumer_offsets-29 -> Vector(1), __consumer_offsets-18 -> Vector(1), connect-offsets-14 -> Vector(1), __consumer_offsets-7 -> Vector(1), __consumer_offsets-34 -> Vector(1), __consumer_offsets-45 -> Vector(1), __consumer_offsets-23 -> Vector(1), connect-offsets-6 -> Vector(1), connect-status-1 -> Vector(1), connect-offsets-17 -> Vector(1), connect-offsets-0 -> Vector(1), connect-offsets-22 -> Vector(1), __consumer_offsets-26 -> Vector(1), connect-offsets-11 -> Vector(1), __consumer_offsets-15 -> Vector(1), __consumer_offsets-4 -> Vector(1), __consumer_offsets-42 -> Vector(1), __consumer_offsets-9 -> Vector(1), __consumer_offsets-31 -> Vector(1), __consumer_offsets-20 -> Vector(1), connect-offsets-3 -> Vector(1), __consumer_offsets-1 -> Vector(1), __consumer_offsets-12 -> Vector(1), connect-offsets-8 -> Vector(1), connect-offsets-19 -> Vector(1), connect-status-3 -> Vector(1), __confluent.support.metrics-0 -> Vector(1), __consumer_offsets-17 -> Vector(1), __consumer_offsets-28 -> Vector(1), __consumer_offsets-6 -> Vector(1), __consumer_offsets-39 -> Vector(1), __consumer_offsets-44 -> Vector(1), connect-offsets-16 -> Vector(1), connect-status-0 -> Vector(1), connect-offsets-5 -> Vector(1), connect-offsets-21 -> Vector(1), __consumer_offsets-47 -> Vector(1), __consumer_offsets-36 -> Vector(1), __consumer_offsets-14 -> Vector(1), __consumer_offsets-25 -> Vector(1), __consumer_offsets-3 -> Vector(1), __consumer_offsets-30 -> Vector(1), __consumer_offsets-41 -> Vector(1), connect-offsets-13 -> Vector(1), connect-offsets-24 -> Vector(1), connect-offsets-2 -> Vector(1), connect-configs-0 -> Vector(1), __consumer_offsets-11 -> Vector(1), __consumer_offsets-22 -> Vector(1), __consumer_offsets-33 -> Vector(1), __consumer_offsets-0 -> Vector(1), connect-offsets-7 -> Vector(1), connect-offsets-18 -> Vector(1))) (kafka.controller.KafkaController)\n[36mkafka_1            |[0m [2018-06-12 20:24:47,461] DEBUG [Controller id=1] Topics not in preferred replica for broker 1 Map() (kafka.controller.KafkaController)\n[36mkafka_1            |[0m [2018-06-12 20:24:47,462] TRACE [Controller id=1] Leader imbalance ratio for broker 1 is 0.0 (kafka.controller.KafkaController)</p>\n"}, {"tags": ["go", "enums", "type-conversion", "constants", "implicit-conversion"], "answers": [{"comments": [{"owner": {"reputation": 1383, "user_id": 4167563, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/90cc579fcc609be0144e24cdd6e056fa?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/4167563/max"}, "edited": false, "score": 0, "creation_date": 1528840668, "post_id": 50826378, "comment_id": 88657534, "body": "thank you for so good example and explanation."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1528840674, "post_id": 50826378, "comment_id": 88657538, "body": "Was working on this exact solution, but ended up embedding an anonymous <code>string</code> in the struct instead of naming the field, which ends up doing some funky stuff. TIL."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 2, "last_activity_date": 1528840481, "creation_date": 1528840481, "answer_id": 50826378, "question_id": 50826100, "link": "https://stackoverflow.com/questions/50826100/how-to-disable-implicit-type-conversion-for-constants/50826378#50826378", "title": "How to disable implicit type conversion for Constants?", "body": "<p>You can't disable the possibility to assign a <code>string</code> to a variable of your <code>ErrorCode</code> type since <code>ErrorCode</code>'s underlying type is <code>string</code> and according to Go's assignability  rules:</p>\n\n<blockquote>\n  <p>A value x is assignable to a variable of type T (\"x is assignable to T\") if one of the following conditions applies: </p>\n  \n  <p>...</p>\n  \n  <ul>\n  <li>x's type V and T have identical underlying types and at least one of V or T is not a defined type</li>\n  </ul>\n</blockquote>\n\n<p>Source: <a href=\"https://golang.org/ref/spec#Assignability\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Assignability</a></p>\n\n<p>So that functionality is built-in into the language.</p>\n\n<p>One way to achieve similar functionality (not exactly the same but the closest you can get) would be to define the type like:</p>\n\n<pre><code>type ErrorCode struct {\n    Code string\n}\n</code></pre>\n\n<p>And then a <strong>variable</strong> (you can't define a constant of that type):</p>\n\n<pre><code>var (\n    INVALID_REQUEST ErrorCode = ErrorCode{\"INVALID_REQUEST\"}\n)\n</code></pre>\n\n<p>You should then modify your code, of course, to take the <code>Code</code> from inside that type to build the response:</p>\n\n<pre><code>user := &amp;Response{ErrorCode: errorCode.Code}\n</code></pre>\n\n<p>That way the function can't be called using a <code>string</code>, only <code>ErrorCode</code> values will be accepted.</p>\n\n<p>Playground: <a href=\"https://play.golang.org/p/qoKrGiJQtxv\" rel=\"nofollow noreferrer\">https://play.golang.org/p/qoKrGiJQtxv</a></p>\n"}], "owner": {"reputation": 1383, "user_id": 4167563, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/90cc579fcc609be0144e24cdd6e056fa?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/4167563/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "closed_date": 1528866518, "accepted_answer_id": 50826378, "answer_count": 1, "score": 1, "last_activity_date": 1528840481, "creation_date": 1528839024, "last_edit_date": 1528839772, "question_id": 50826100, "link": "https://stackoverflow.com/questions/50826100/how-to-disable-implicit-type-conversion-for-constants", "closed_reason": "Duplicate", "title": "How to disable implicit type conversion for Constants?", "body": "<p>I have the following code snippent:</p>\n\n<pre><code>type ErrorCode string\n\nconst (\n    INVALID_REQUEST ErrorCode = \"INVALID_REQUEST\"\n)\n\ntype Response struct {\n    ErrorCode string `json:\"errorCode\"`\n}\n\nfunc BuildResponseError(errorCode ErrorCode) string {\n    user := &amp;Response{ErrorCode: string(errorCode)}\n    response, err := json.Marshal(user)\n    if err != nil {\n        log.Println(err)\n        return `{\"errorCode\":\"bad_request\"}`\n    }\n\n    return string(response)\n}\n</code></pre>\n\n<p>I can call function <strong>BuildResponseError</strong> like that:</p>\n\n<pre><code>BuildResponseError(\"wrong_request\")\n</code></pre>\n\n<p>Is there a way to disable this implicit type conversion? I want to call this function only like this, using a enum value:</p>\n\n<pre><code>BuildResponseError(INVALID_REQUEST)\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "amazon-rekognition"], "comments": [{"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1528887423, "post_id": 50825401, "comment_id": 88674689, "body": "I played with this tool recently and I haven&#39;t found any limit on the number of returned chunks in the response. Sometimes I don&#39;t receive an entry for a given text because the image is of bad quality and Rekognition isn&#39;t able to extract such text."}], "answers": [{"comments": [{"owner": {"reputation": 291, "user_id": 747720, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/4974f3b6d364faf344236641c32351d6?s=128&d=identicon&r=PG&f=1", "display_name": "BZapper", "link": "https://stackoverflow.com/users/747720/bzapper"}, "edited": false, "score": 0, "creation_date": 1529872391, "post_id": 50836905, "comment_id": 89020086, "body": "confirmed (it was actually on their doc, just towards the bottom of the page). 50 limit it is! thanks"}, {"owner": {"reputation": 785, "user_id": 2989655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KpBWa.jpg?s=128&g=1", "display_name": "Sau001", "link": "https://stackoverflow.com/users/2989655/sau001"}, "edited": false, "score": 0, "creation_date": 1556828978, "post_id": 50836905, "comment_id": 98571226, "body": "Yes. There is a limit. I am not sure why AWS put such a hard limit. Possibly  AWS Textract is expected to fill the gap."}], "tags": [], "owner": {"reputation": 794, "user_id": 8144695, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WGnre.jpg?s=128&g=1", "display_name": "Mausam Sharma", "link": "https://stackoverflow.com/users/8144695/mausam-sharma"}, "is_accepted": true, "score": 6, "last_activity_date": 1560054191, "last_edit_date": 1560054191, "creation_date": 1528891684, "answer_id": 50836905, "question_id": 50825401, "link": "https://stackoverflow.com/questions/50825401/aws-rekognition-limitation-on-number-of-text-chunks-in-response/50836905#50836905", "title": "AWS Rekognition limitation on number of text chunks in response?", "body": "<p>AWS Recognition can detect upto 50 words in a single image only .</p>\n\n<p>You should use an OCR software for large amount of data , such as free OCR </p>\n\n<p><a href=\"https://ocr.space/ocrapi\" rel=\"nofollow noreferrer\">https://ocr.space/ocrapi</a></p>\n\n<p>Now AWS textract service overcomes the limitations of rekognition, and provides OCR.</p>\n"}], "owner": {"reputation": 291, "user_id": 747720, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/4974f3b6d364faf344236641c32351d6?s=128&d=identicon&r=PG&f=1", "display_name": "BZapper", "link": "https://stackoverflow.com/users/747720/bzapper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 750, "favorite_count": 0, "accepted_answer_id": 50836905, "answer_count": 1, "score": 1, "last_activity_date": 1560054191, "creation_date": 1528835440, "question_id": 50825401, "link": "https://stackoverflow.com/questions/50825401/aws-rekognition-limitation-on-number-of-text-chunks-in-response", "title": "AWS Rekognition limitation on number of text chunks in response?", "body": "<p>Trying to use the AWS Go SDK to do DetectText, basically trying it for OCR, and am seeing only about 30% of text being included in the response, and the rest of the text being ignored. Anyone aware of a limit on total number of text blobs being returned in the response? Any way to get around that? </p>\n"}, {"tags": ["go", "go-cobra"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1528833672, "post_id": 50824554, "comment_id": 88654807, "body": "A switch statement?"}, {"owner": {"reputation": 2880, "user_id": 2848483, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6593ff6dc03719571b02b89e5d23d661?s=128&d=identicon&r=PG", "display_name": "Bren", "link": "https://stackoverflow.com/users/2848483/bren"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1528835530, "post_id": 50824554, "comment_id": 88655640, "body": "@RayfenWindspear Something built in."}, {"owner": {"reputation": 2880, "user_id": 2848483, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6593ff6dc03719571b02b89e5d23d661?s=128&d=identicon&r=PG", "display_name": "Bren", "link": "https://stackoverflow.com/users/2848483/bren"}, "reply_to_user": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "edited": false, "score": 0, "creation_date": 1528835690, "post_id": 50824554, "comment_id": 88655728, "body": "@MarcoBonelli already covered that in the above comments."}, {"owner": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "edited": false, "score": 0, "creation_date": 1528835933, "post_id": 50824554, "comment_id": 88655832, "body": "Oh I see, sorry, so you are asking if there is a built in method that would do this automatically. I don&#39;t really think so, why would they implement it this way? I mean, you want to <i>potentially</i> crash your program if you get an unexpected flag? That doesn&#39;t sound so cool."}, {"owner": {"reputation": 2880, "user_id": 2848483, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6593ff6dc03719571b02b89e5d23d661?s=128&d=identicon&r=PG", "display_name": "Bren", "link": "https://stackoverflow.com/users/2848483/bren"}, "edited": false, "score": 0, "creation_date": 1528836025, "post_id": 50824554, "comment_id": 88655883, "body": "@I was thinking you might be able to register an error producing function or something like that. Seems like a common enough use-case, that I thought it may be built in and wanted to use that if it did exist."}, {"owner": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "edited": false, "score": 0, "creation_date": 1528836241, "post_id": 50824554, "comment_id": 88655983, "body": "Looking at the file <a href=\"https://github.com/spf13/cobra/blob/master/args.go\" rel=\"nofollow noreferrer\"><code>args.go</code></a> it seems like there may actually be something like what you&#39;re looking for."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "edited": false, "score": 0, "creation_date": 1528836634, "post_id": 50824554, "comment_id": 88656130, "body": "@MarcoBonelli I don&#39;t see any interfaces in that file, so I fail to see how one would add what OP is looking for. Note OP wants a single arg to be limited to a set of values. There doesn&#39;t appear to be a builtin for this."}, {"owner": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1528837461, "post_id": 50824554, "comment_id": 88656437, "body": "@RayfenWindspear I mean, those are exported functions... so one could theoretically use them. Didn&#39;t look inside it that much thought, you&#39;re probably right."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1528837639, "post_id": 50824554, "comment_id": 88656505, "body": "Yeah, those all seem to operate on the full set of args. But, they give a routine way of doing the checking, so I say write one and submit a pull request!"}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1528838808, "post_id": 50826015, "comment_id": 88656928, "body": "I&#39;m writing an answer using their format that you could use as a pull request in order to make it a supported feature."}], "tags": [], "owner": {"reputation": 2880, "user_id": 2848483, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6593ff6dc03719571b02b89e5d23d661?s=128&d=identicon&r=PG", "display_name": "Bren", "link": "https://stackoverflow.com/users/2848483/bren"}, "is_accepted": false, "score": 0, "last_activity_date": 1528838562, "creation_date": 1528838562, "answer_id": 50826015, "question_id": 50824554, "link": "https://stackoverflow.com/questions/50824554/permitted-flag-values-for-cobra/50826015#50826015", "title": "Permitted flag values for Cobra", "body": "<p>Though it is hard to prove a negative, it doesn't look this is currently a feature.</p>\n"}], "owner": {"reputation": 2880, "user_id": 2848483, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6593ff6dc03719571b02b89e5d23d661?s=128&d=identicon&r=PG", "display_name": "Bren", "link": "https://stackoverflow.com/users/2848483/bren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 708, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1528838562, "creation_date": 1528831988, "last_edit_date": 1528835741, "question_id": 50824554, "link": "https://stackoverflow.com/questions/50824554/permitted-flag-values-for-cobra", "title": "Permitted flag values for Cobra", "body": "<p>Is there built-in tooling (and if so how do I use it?) to require a flag to be one of several values and throw an error if a flag is not one of the permitted values, in the Cobra library? I didn't see this on the Github page. </p>\n"}, {"tags": ["go", "multipartform-data"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528830235, "post_id": 50824103, "comment_id": 88653254, "body": "Can you please check the error from Body.Read?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528830313, "post_id": 50824103, "comment_id": 88653295, "body": "...and when you say the code isn&#39;t returning anything, do you mean that not even the status code and header are being printed?"}, {"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528830576, "post_id": 50824103, "comment_id": 88653421, "body": "<code>Body.Read: n = 0, err=&lt;nil&gt;</code> <code>Body.Content = []</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528830676, "post_id": 50824103, "comment_id": 88653458, "body": "...also <code>io.Copy</code> and <code>writer.WriteField</code> too, return errors. Check every error every time. And you <code>NewRequest</code> result handling is bad practice, you are assuming that an <code>*http.Request</code> is always return even if you get an error, it&#39;s not, and so your calls to Header.Add would panic in case NewRequest returns an error."}, {"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528830719, "post_id": 50824103, "comment_id": 88653483, "body": "No, I meant, it&#39;s returning a <code>400</code> which is obviously the problem, but because I emulated everything I could think of from <code>curl</code> cmd, I am not sure what I am missing here."}, {"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528830819, "post_id": 50824103, "comment_id": 88653530, "body": "@mkopriva: it&#39;s not the code I will check in the repo, it&#39;s meant to be concise to post a repro on SO. I checked that part. The only issue is the 400 which is obviously a problem with the way the server expects things to be set up?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528830939, "post_id": 50824103, "comment_id": 88653595, "body": "400 means bad request, it&#39;s very much possible that some of those functions failed and returned an error creating an invalid request body, but because you don&#39;t care about errors you send that bad body anyway. I&#39;m not saying that&#39;s the case, but it is a possibility given that you are not checking errors."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528830995, "post_id": 50824103, "comment_id": 88653616, "body": "Before sending the request out, try this <a href=\"https://golang.org/pkg/net/http/httputil/#DumpRequestOut\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/httputil/#DumpRequestOut</a> to see if the request looks correct, ie compare it to the one sent with curl."}], "answers": [{"comments": [{"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1528834670, "post_id": 50824654, "comment_id": 88655240, "body": "Thanks for taking the time to edit the solution. I was trying to make curl use a file param and it stubbornly declined. Looking at your sample, I noticed that you use the byte array converted to string directly wihout path-escaping the content since it&#39;s just stuffed in the body of the request (vs passed as a cmd line arg?)."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 4, "last_activity_date": 1528832407, "creation_date": 1528832407, "answer_id": 50824654, "question_id": 50824103, "link": "https://stackoverflow.com/questions/50824103/implementing-multipart-file-upload-with-extra-params/50824654#50824654", "title": "Implementing multipart file upload with extra params", "body": "<p>In your CURL request, you are sending <code>wikitext</code> as a field (<code>-F wikitext=...</code>).</p>\n\n<p>However, in your code you are sending it as a file part.</p>\n\n<p>If you send that as a field it will work as you expect.</p>\n\n<p>Just include the file contents as an additional extra field in your code:</p>\n\n<pre><code>func transformWikitextToHtml(path string) {\n    fileBytes, err := ioutil.ReadFile(path)\n    if err != nil {\n        log.Fatal(err)\n    }\n    extraParams := map[string]string{\n        \"body_only\":       \"true\",\n        \"wikitext\": string(fileBytes),\n    }\n    // rest of the code should be as you posted\n}\n</code></pre>\n\n<p>Then of course, remove the parts of <code>newfileUploadRequest</code> that work with the path and file param name, which are not needed any more.</p>\n\n<p>Also, when writing the response body, you had a small bug and it was not printing anything even once the code was fixed, so please replace that part with:</p>\n\n<pre><code>    bodyBytes, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(string(bodyBytes))\n</code></pre>\n\n<p>Full working code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"log\"\n    \"mime/multipart\"\n    \"net/http\"\n    \"io/ioutil\"\n)\n\n// Creates a new file upload http request with optional extra params\nfunc newfileUploadRequest(uri string, params map[string]string) (*http.Request, error) {\n\n    body := new(bytes.Buffer)\n    writer := multipart.NewWriter(body)\n\n    for key, val := range params {\n        err  := writer.WriteField(key, val)\n        if err != nil {\n            log.Fatal(err)\n        }\n    }\n    err := writer.Close()\n    if err != nil {\n        return nil, err\n    }\n\n    request, err := http.NewRequest(\"POST\", uri, body)\n    request.Header.Add(\"Content-Type\", writer.FormDataContentType())\n    request.Header.Add(\"Accept\", \"text/html; charset=utf-8; profile=\\\"https://www.mediawiki.org/wiki/Specs/HTML/1.7.0\\\"\")\n    return request, err\n}\n\nfunc transformWikitextToHtml(path string) {\n    fileBytes, err := ioutil.ReadFile(path)\n    if err != nil {\n        log.Fatal(err)\n    }\n    extraParams := map[string]string{\n        \"body_only\":       \"true\",\n        \"wikitext\": string(fileBytes),\n    }\n    request, err := newfileUploadRequest(\"https://en.wikipedia.org/api/rest_v1/transform/wikitext/to/html\", extraParams)\n    if err != nil {\n        log.Fatal(err)\n    }\n    client := &amp;http.Client{}\n    resp, err := client.Do(request)\n    if err != nil {\n        log.Fatal(err)\n    } else {\n        fmt.Println(resp.StatusCode)\n        fmt.Println(resp.Header)\n        bodyBytes, err := ioutil.ReadAll(resp.Body)\n        if err != nil {\n            log.Fatal(err)\n        }\n        fmt.Println(string(bodyBytes))\n    }\n}\n\nfunc main() {\n    transformWikitextToHtml(\"/tmp/2239217\")\n}\n</code></pre>\n"}], "owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 312, "favorite_count": 0, "accepted_answer_id": 50824654, "answer_count": 1, "score": 2, "last_activity_date": 1528832407, "creation_date": 1528830060, "question_id": 50824103, "link": "https://stackoverflow.com/questions/50824103/implementing-multipart-file-upload-with-extra-params", "title": "Implementing multipart file upload with extra params", "body": "<p>I am trying to replicate the following command:</p>\n\n<pre><code>curl -X POST --header 'Content-Type: multipart/form-data' --header 'Accept: text/html; charset=utf-8; profile=\"https://www.mediawiki.org/wiki/Specs/HTML/1.7.0\"' -F wikitext=%27%27%27Mahikari%27%27%27%20is%20a%20%5B%5BJapan%5D%5Dese%20%5B%5Bnew%20religious%20movement%5D%5D -F body_only=true -F   'https://en.wikipedia.org/api/rest_v1/transform/wikitext/to/html'\n</code></pre>\n\n<p>The file is passed as a url quoted parameter to <code>curl</code>.</p>\n\n<p>The content of the original file is given as (with no trailing returns):</p>\n\n<pre><code>'''Mahikari''' is a [[Japan]]ese [[new religious movement]]\n</code></pre>\n\n<p>The only parameter I added, for now, is <code>body_only=true</code></p>\n\n<p>The expected and correct answer is:</p>\n\n<pre><code>&lt;p id=\"mwAQ\"&gt;&lt;b id=\"mwAg\"&gt;Mahikari&lt;/b&gt; is a &lt;a rel=\"mw:WikiLink\" href=\"./Japan\" title=\"Japan\" id=\"mwAw\"&gt;Japanese&lt;/a&gt; &lt;a rel=\"mw:WikiLink\" href=\"./New_religious_movement\" title=\"New religious movement\" id=\"mwBA\"&gt;new religious movement&lt;/a&gt;&lt;/p&gt;\n</code></pre>\n\n<p>The code below is not returning anything (not even an error!):</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n    // \"io/ioutil\"\n    \"log\"\n    \"mime/multipart\"\n    \"net/http\"\n    \"os\"\n    \"path/filepath\"\n)\n\n// Creates a new file upload http request with optional extra params\nfunc newfileUploadRequest(uri string, params map[string]string, paramName, path string) (*http.Request, error) {\n    file, err := os.Open(path)\n    if err != nil {\n        return nil, err\n    }\n    defer file.Close()\n\n    // fileContents, err := ioutil.ReadAll(file)\n    // if err != nil {\n    //  return nil, err\n    // }\n\n    fi, err := file.Stat()\n    if err != nil {\n        return nil, err\n    }\n\n    body := new(bytes.Buffer)\n    writer := multipart.NewWriter(body)\n    part, err := writer.CreateFormFile(paramName, fi.Name())\n    if err != nil {\n        return nil, err\n    }\n    // part.Write(fileContents)\n    io.Copy(part, file)\n\n    for key, val := range params {\n        _ = writer.WriteField(key, val)\n    }\n    err = writer.Close()\n    if err != nil {\n        return nil, err\n    }\n\n    request, err := http.NewRequest(\"POST\", uri, body)\n    request.Header.Add(\"Content-Type\", writer.FormDataContentType())\n    request.Header.Add(\"Accept\", \"text/html; charset=utf-8; profile=\\\"https://www.mediawiki.org/wiki/Specs/HTML/1.7.0\\\"\")\n    return request, err\n}\n\nfunc transformWikitextToHtml(path string) {\n    extraParams := map[string]string{\n        \"body_only\":       \"true\",\n    }\n    request, err := newfileUploadRequest(\"https://en.wikipedia.org/api/rest_v1/transform/wikitext/to/html\", extraParams, \"file\", path)\n    if err != nil {\n        log.Fatal(err)\n    }\n    client := &amp;http.Client{}\n    resp, err := client.Do(request)\n    if err != nil {\n        log.Fatal(err)\n    } else {\n        var bodyContent []byte\n        fmt.Println(resp.StatusCode)\n        fmt.Println(resp.Header)\n        resp.Body.Read(bodyContent)\n        resp.Body.Close()\n        fmt.Println(bodyContent)\n    }\n}\n\nfunc main() {\n    transformWikitextToHtml(\"/tmp/2239217\")\n}\n</code></pre>\n\n<p>I set up the headers according to the documentation and what is expected. I tried a few things, as reading the file at once (commented out), but that didnt help. What am I missing?</p>\n"}, {"tags": ["python", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528825350, "post_id": 50822856, "comment_id": 88650785, "body": "The functions do different things, did you try with <code>strings.Split</code>?"}, {"owner": {"reputation": 1674, "user_id": 5420686, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/2c318e16c4b5f17dd1375df8cb1425e5?s=128&d=identicon&r=PG&f=1", "display_name": "Jal", "link": "https://stackoverflow.com/users/5420686/jal"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528825560, "post_id": 50822856, "comment_id": 88650894, "body": "Interesting, <code>strings.Split(scanner.Text(), &quot; &quot;)</code>  speed is slightly faster to python, but I think it doesn&#39;t split by multiple space as python does,  <a href=\"https://play.golang.org/p/cNPgsp_Vcin\" rel=\"nofollow noreferrer\">go playground example</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528825844, "post_id": 50822856, "comment_id": 88651020, "body": "You can either have the more complete behavior of <code>strings.Fields</code>, the basic <code>strings.Split</code> implementation, or implement your own python-equivalent split."}], "answers": [{"comments": [{"owner": {"reputation": 1674, "user_id": 5420686, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/2c318e16c4b5f17dd1375df8cb1425e5?s=128&d=identicon&r=PG&f=1", "display_name": "Jal", "link": "https://stackoverflow.com/users/5420686/jal"}, "edited": false, "score": 0, "creation_date": 1528826615, "post_id": 50822975, "comment_id": 88651427, "body": "Interesting, is there out of box utility that does what python <code>line.split()</code> does but faster in golang?"}, {"owner": {"reputation": 1674, "user_id": 5420686, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/2c318e16c4b5f17dd1375df8cb1425e5?s=128&d=identicon&r=PG&f=1", "display_name": "Jal", "link": "https://stackoverflow.com/users/5420686/jal"}, "edited": false, "score": 0, "creation_date": 1528827049, "post_id": 50822975, "comment_id": 88651649, "body": "actually, I think python takes care of unicode too <code>a = u&#39;a\\tb&#39; </code> <code>a.split()</code> gives <code>[u&#39;a&#39;, u&#39;b&#39;]</code> , or maybe I am confused on what unicode means"}, {"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "reply_to_user": {"reputation": 1674, "user_id": 5420686, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/2c318e16c4b5f17dd1375df8cb1425e5?s=128&d=identicon&r=PG&f=1", "display_name": "Jal", "link": "https://stackoverflow.com/users/5420686/jal"}, "edited": false, "score": 0, "creation_date": 1528827281, "post_id": 50822975, "comment_id": 88651773, "body": "@Jal: Python supports Unicode, but you&#39;re not using it."}, {"owner": {"reputation": 1674, "user_id": 5420686, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/2c318e16c4b5f17dd1375df8cb1425e5?s=128&d=identicon&r=PG&f=1", "display_name": "Jal", "link": "https://stackoverflow.com/users/5420686/jal"}, "edited": false, "score": 0, "creation_date": 1528827561, "post_id": 50822975, "comment_id": 88651916, "body": "so does that mean <code>for line in f:</code> auto covert content of line from unicode to string? and why does <code>fmt.Println(reflect.TypeOf(scanner.Text()))</code> return <code>string</code> instead of unicode type"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1674, "user_id": 5420686, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/2c318e16c4b5f17dd1375df8cb1425e5?s=128&d=identicon&r=PG&f=1", "display_name": "Jal", "link": "https://stackoverflow.com/users/5420686/jal"}, "edited": false, "score": 0, "creation_date": 1528828084, "post_id": 50822975, "comment_id": 88652194, "body": "@Jal: there is no &quot;unicode type&quot; string in GO. Strings are a series of runes, though  they can be indexed as bytes."}, {"owner": {"reputation": 1674, "user_id": 5420686, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/2c318e16c4b5f17dd1375df8cb1425e5?s=128&d=identicon&r=PG&f=1", "display_name": "Jal", "link": "https://stackoverflow.com/users/5420686/jal"}, "edited": false, "score": 0, "creation_date": 1528835267, "post_id": 50822975, "comment_id": 88655504, "body": "I see, although I am still not sure why go is slower than python when python takes care of unicode also eg. <code>a = u&#39;a\\tb&#39; a.split() gives [u&#39;a&#39;, u&#39;b&#39;]</code> , looks like I have to read more on what unicode decoding means"}], "tags": [], "owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "is_accepted": false, "score": 2, "last_activity_date": 1528825701, "creation_date": 1528825701, "answer_id": 50822975, "question_id": 50822856, "link": "https://stackoverflow.com/questions/50822856/why-myvar-strings-fieldsscanner-text-take-much-more-time-than-comparable-o/50822975#50822975", "title": "Why myVar = strings.Fields(scanner.Text()) take much more time than comparable operation in python?", "body": "<p>You're using Unicode in Go and bytestrings in Python. Your Python code has a much easier job, since it doesn't have to do Unicode decoding or handle all Unicode whitespace values.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1528837533, "last_edit_date": 1528837533, "creation_date": 1528833918, "answer_id": 50825059, "question_id": 50822856, "link": "https://stackoverflow.com/questions/50822856/why-myvar-strings-fieldsscanner-text-take-much-more-time-than-comparable-o/50825059#50825059", "title": "Why myVar = strings.Fields(scanner.Text()) take much more time than comparable operation in python?", "body": "<p>Any benchmark should be a good scientific experiment. It must be reproducible.</p>\n\n<p>First, define the readily available input:</p>\n\n<p>The Complete Works of William Shakespeare by William Shakespeare:</p>\n\n<p><code>http://www.gutenberg.org/files/100/100-0.txt</code></p>\n\n<p>Next, fully define the executable programs:</p>\n\n<p><code>linesplit.py</code>: </p>\n\n<pre><code>import time; \nstart = time.time()\n\n# http://www.gutenberg.org/files/100/100-0.txt\nfile = \"/home/peter/shakespeare.100-0.txt\"\nwith open(file) as f:\n    for line in f:\n        parsedLine = line.split()\n\nend = time.time() \nprint (end - start)\n</code></pre>\n\n<p><code>linesplit.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"strings\"\n    \"time\"\n)\n\nfunc main() {\n    now := time.Now()\n    sec1 := now.Unix()\n\n    // http://www.gutenberg.org/files/100/100-0.txt\n    file_name := \"/home/peter/shakespeare.100-0.txt\"\n    file, err := os.Open(file_name)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer file.Close()\n\n    scanner := bufio.NewScanner(file)\n\n    var parsedLine []string\n\n    for scanner.Scan() {\n        parsedLine = strings.Fields(scanner.Text())\n    }\n\n    fmt.Println(parsedLine)\n    now2 := time.Now()\n    sec2 := now2.Unix()\n    fmt.Println(sec2 - sec1) // takes 24 second for file1.txt\n    fmt.Println(time.Since(now))\n}\n</code></pre>\n\n<p>Then, provide the benchmark results:</p>\n\n<pre><code>$ python2 --version\nPython 2.7.14\n$ time python2 linesplit.py\n.07024809169769\nreal    0m0.089s\nuser    0m0.089s\nsys     0m0.000s\n\n$ python3 --version\nPython 3.6.3\n$ time python3 linesplit.py\n0.12172794342041016\nreal    0m0.159s\nuser    0m0.155s\nsys     0m0.004s\n\n$ go version\ngo version devel +39ad208c13 Tue Jun 12 19:10:34 2018 +0000 linux/amd64\n$ go build linesplit.go &amp;&amp; time ./linesplit\n[]\n1\n91.833622ms\nreal    0m0.100s\nuser    0m0.094s\nsys     0m0.004s\n\n$ \n</code></pre>\n\n<p>We have Python2 &lt; Go &lt; Python3 or 0.0724 &lt; 0.0918 &lt; 0.1217 or, as a ratio, 1.00 &lt; 1.31 &lt; 1.73. Python2 is ASCII. Go and Python3 are Unicode.</p>\n"}], "owner": {"reputation": 1674, "user_id": 5420686, "user_type": "registered", "accept_rate": 49, "profile_image": "https://www.gravatar.com/avatar/2c318e16c4b5f17dd1375df8cb1425e5?s=128&d=identicon&r=PG&f=1", "display_name": "Jal", "link": "https://stackoverflow.com/users/5420686/jal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 1, "answer_count": 2, "score": -1, "last_activity_date": 1528837533, "creation_date": 1528825201, "last_edit_date": 1528828129, "question_id": 50822856, "link": "https://stackoverflow.com/questions/50822856/why-myvar-strings-fieldsscanner-text-take-much-more-time-than-comparable-o", "title": "Why myVar = strings.Fields(scanner.Text()) take much more time than comparable operation in python?", "body": "<p>Consider the following code in golang</p>\n\n<pre><code>now := time.Now()\nsec1 := now.Unix()\n\nfile, err := os.Open(file_name)\nif err != nil {\n    log.Fatal(err)\n}\ndefer file.Close()\n\nscanner := bufio.NewScanner(file)\n\nvar parsedLine []string\n\nfor scanner.Scan() {\n    parsedLine = strings.Fields(scanner.Text())\n}\n\nfmt.Println(parsedLine)\nnow2 := time.Now()\nsec2 := now2.Unix()\nfmt.Println(sec2 - sec1) // takes 24 second for file1.txt\n</code></pre>\n\n<p>And consider this python program</p>\n\n<pre><code>start = time.time()\n\nwith open(file) as f:\n    for line in f:\n        parsedLine = line.split()\n\nend = time.time() \nprint end - start # takes 4.6450419426 second for file1.txt\n</code></pre>\n\n<p>I observe the golang program is 5 times slower than the python program on a mac book pro</p>\n\n<p>Specifically this line </p>\n\n<pre><code>parsedLine = strings.Fields(scanner.Text())\n</code></pre>\n\n<p>is very slow.</p>\n\n<p>If I change that line in golang to</p>\n\n<pre><code>if strings.Contains(scanner.Text(), \"string_that_never_exist\") {\n     continue\n}\n// take less than 1 second\n</code></pre>\n\n<p>and python to </p>\n\n<pre><code>if \"string_that_never_exist\" in line:\n    continue\n# takes 2.86928987503 second\n</code></pre>\n\n<p>Golang version is now much faster than python one.</p>\n\n<p>I am slightly perplexed on why <code>strings.Fields(scanner.Text())</code> may be slower than <code>line.split()</code></p>\n\n<p>I feel I am missing something silly, can someone point me out why the golang version take longer than python</p>\n"}, {"tags": ["go", "struct", "stack", "runtime", "goroutine"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1528821095, "post_id": 50821851, "comment_id": 88648865, "body": "Yes, the method receiver is also passed just like any other parameters. Use a pointer receiver, and it&#39;ll be good."}], "answers": [{"tags": [], "owner": {"reputation": 23, "user_id": 4727512, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-qUnTccYwRY4/AAAAAAAAAAI/AAAAAAAAABE/lr_XOHxrO6Q/photo.jpg?sz=128", "display_name": "Nathan Thomas", "link": "https://stackoverflow.com/users/4727512/nathan-thomas"}, "is_accepted": false, "score": 1, "last_activity_date": 1528821561, "last_edit_date": 1528821561, "creation_date": 1528821209, "answer_id": 50821961, "question_id": 50821851, "link": "https://stackoverflow.com/questions/50821851/thread-within-struct-function-arguments-too-large-for-new-goroutine/50821961#50821961", "title": "Thread within struct, function arguments too large for new goroutine", "body": "<p>The issue with the stack size is, obviously, the size of the struct itself.  So as your struct grows organically, you may, as I did, cross that 2k stack call size.</p>\n\n<p>The above problem can be fixed by using a pointer to the struct in the function declaration.</p>\n\n<pre><code>func (l *loc_t) rampUp (wg *sync.WaitGroup) {\n    defer wg.Done()\n    l.Counter += 1\n}\n</code></pre>\n\n<p>This creates a pointer to the struct, so all that goes to the stack is the pointer, instead of an entire copy of the struct.</p>\n\n<p>Obviously this can have other implications including race conditions if you're making the call in several threads at once.  But as a solution to an ever growing struct that will suddenly start causing stack overflows, it's a solution.</p>\n\n<p>Anyway, hope this is helpful to someone else out there.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1528822713, "last_edit_date": 1528822713, "creation_date": 1528821452, "answer_id": 50821997, "question_id": 50821851, "link": "https://stackoverflow.com/questions/50821851/thread-within-struct-function-arguments-too-large-for-new-goroutine/50821997#50821997", "title": "Thread within struct, function arguments too large for new goroutine", "body": "<p>Method receivers are passed to method calls, just like any other parameter. So if the method has a non-pointer receiver, the whole struct in your case will be copied. The easiest solution would be to use a pointer receiver, if you can.</p>\n\n<p>If you must use a non-pointer receiver, then you can circumvent this by not launching the method call as the goroutine but another function, possibly a function literal:</p>\n\n<pre><code>go func() {\n    loc.rampUp(wg)\n}()\n</code></pre>\n\n<p>If the <code>loc</code> variable may be modified concurrently (before the launched goroutine would get scheduled and copy it for the <code>rampUp()</code> method), you can create a copy of it manually and use that in the goroutine, like this:</p>\n\n<pre><code>loc2 := loc\nwg.Add(1)\ngo func() {\n    loc2.rampUp(wg)\n}()\n</code></pre>\n\n<p>These solutions work because launching the new goroutine does not require big initial stack, so the initial stack limit will not get in the way. And the stack size is dynamic, so after the launch it will grow as needed. Details can be read here: <a href=\"https://stackoverflow.com/questions/49940414/does-go-have-an-infinite-call-stack-equivalent/49940717#49940717\">Does Go have an &quot;infinite call stack&quot; equivalent?</a></p>\n"}], "owner": {"reputation": 23, "user_id": 4727512, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-qUnTccYwRY4/AAAAAAAAAAI/AAAAAAAAABE/lr_XOHxrO6Q/photo.jpg?sz=128", "display_name": "Nathan Thomas", "link": "https://stackoverflow.com/users/4727512/nathan-thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 477, "favorite_count": 0, "accepted_answer_id": 50821997, "answer_count": 2, "score": 1, "last_activity_date": 1528823028, "creation_date": 1528820753, "last_edit_date": 1528823028, "question_id": 50821851, "link": "https://stackoverflow.com/questions/50821851/thread-within-struct-function-arguments-too-large-for-new-goroutine", "title": "Thread within struct, function arguments too large for new goroutine", "body": "<p>I created this simple app to demonstrate the issue I was having.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n    \"sync\"\n)\n\ntype loc_t struct {\n    count       [9999]int64\n    Counter     int64\n}\n\nfunc (l loc_t) rampUp (wg *sync.WaitGroup) {\n    defer wg.Done()\n    l.Counter += 1\n}\n\nfunc main() {\n    wg := new(sync.WaitGroup)\n    loc := loc_t{}\n\n    fmt.Println(unsafe.Sizeof(loc))\n    wg.Add(1)\n    go loc.rampUp(wg)\n    wg.Wait()\n    fmt.Println(loc.Counter)\n}\n</code></pre>\n\n<p>If I run the above I will get a <code>fatal error: newproc: function arguments too large for new goroutine</code>\n<code>runtime stack:\nruntime: unexpected return pc for runtime.systemstack called from 0x0</code></p>\n\n<p>Now the reason for that is the 2k stack size when a <code>go</code> is used to spawn a background task.  What's interesting is I'm only passing a pointer the called function.  This issue happened to me in production, different struct obviously, everything was working for a year, and then all of sudden it started throwing this error.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1528815180, "post_id": 50820072, "comment_id": 88645462, "body": "The <code>`json:&quot;start&quot;`</code> portion means that when Unmarshaling/Marshaling, the field <code>d1</code>, for example, corresponds with the JSON key <code>start</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1528815341, "post_id": 50820072, "comment_id": 88645591, "body": "Also see: <a href=\"https://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go/30889373#30889373\">What are the use(s) for tags in Go?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1528815359, "post_id": 50820151, "comment_id": 88645606, "body": "Would the term <code>attributes</code> be acceptable too?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1528815499, "post_id": 50820151, "comment_id": 88645700, "body": "@Derek: the language refers to them as fields, and the word &quot;attribute&quot; doesn&#39;t quite have the same meaning. You could say the tag becomes an attribute of the field however."}, {"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1528815572, "post_id": 50820151, "comment_id": 88645737, "body": "thanks, its a tad tedious to try to keep all the technical jargon straight, especially when going from PHP to JavaScript and GO all day"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 1, "last_activity_date": 1528815217, "creation_date": 1528815217, "answer_id": 50820151, "question_id": 50820072, "link": "https://stackoverflow.com/questions/50820072/golang-variable-declaration-syntax-meaning/50820151#50820151", "title": "Golang variable declaration syntax meaning", "body": "<p><code>d1</code>, <code>d2</code>, and <code>d3</code> are not variables, they are struct fields. The string is a \"struct tag\".</p>\n\n<p>This is all described in the <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">Struct Types</a> documentation in the language spec. </p>\n"}], "owner": {"reputation": 39, "user_id": 2945598, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee3351ab3881744efc337b15387062c?s=128&d=identicon&r=PG", "display_name": "Kesava", "link": "https://stackoverflow.com/users/2945598/kesava"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "closed_date": 1528815220, "answer_count": 1, "score": -2, "last_activity_date": 1528815217, "creation_date": 1528815027, "question_id": 50820072, "link": "https://stackoverflow.com/questions/50820072/golang-variable-declaration-syntax-meaning", "closed_reason": "Duplicate", "title": "Golang variable declaration syntax meaning", "body": "<p>I am going through some Golang code and came through this block of code, I am not able to comprehend it. I can see that d1,d2,d3 are variables of type int. But what is the last string <code>json:\"start\"</code></p>\n\n<pre><code>type obj1 struct {\n    d1   int `json:\"start\"`\n    d2     int `json:\"end\"`\n    d3 int   `json:\"retries\"`\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1528814874, "post_id": 50819963, "comment_id": 88645273, "body": "Try <code>io.Copy(w, response.Body)</code>. And please do close the response body i.e. <code>defer response.Body.Close()</code>. Also when Get returns an error and you write it to the reponse there is no reason to also write a nil response, so add a return statement to the end of the <code>if err != nil ...</code> conditional&#39;s body."}], "answers": [{"comments": [{"owner": {"reputation": 7704, "user_id": 2968101, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/kUEZQ.jpg?s=128&g=1", "display_name": "mfrachet", "link": "https://stackoverflow.com/users/2968101/mfrachet"}, "edited": false, "score": 0, "creation_date": 1528815202, "post_id": 50820111, "comment_id": 88645485, "body": "Thanks for this, it solved the Content-Type part of my problem :D"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 4, "last_activity_date": 1528815217, "last_edit_date": 1528815217, "creation_date": 1528815136, "answer_id": 50820111, "question_id": 50819963, "link": "https://stackoverflow.com/questions/50819963/proxying-a-rest-api-using-golang/50820111#50820111", "title": "Proxying a REST API using golang", "body": "<p>About the <code>Content-Type</code> header not being written to your response:</p>\n\n<p>Seems to be expected due to the order in which you are performing these operations:</p>\n\n<pre><code>w.WriteHeader(http.StatusOK)\nw.Header().Set(\"Content-Type\", \"application/json\")\n</code></pre>\n\n<p>See here: <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#ResponseWriter</a></p>\n\n<blockquote>\n  <p>Changing the header map after a call to WriteHeader (or Write) has no effect unless the modified headers are trailers.</p>\n</blockquote>\n\n<p>Try inverting those to read:</p>\n\n<pre><code>w.Header().Set(\"Content-Type\", \"application/json\")\nw.WriteHeader(http.StatusOK)\n</code></pre>\n"}], "owner": {"reputation": 7704, "user_id": 2968101, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/kUEZQ.jpg?s=128&g=1", "display_name": "mfrachet", "link": "https://stackoverflow.com/users/2968101/mfrachet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 708, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1528815217, "creation_date": 1528814689, "question_id": 50819963, "link": "https://stackoverflow.com/questions/50819963/proxying-a-rest-api-using-golang", "title": "Proxying a REST API using golang", "body": "<p>I m actually learning golang and try to implement a proxy on a an Rest API that I've made in another language</p>\n\n<p>For now, I only want to query my golang API, extract they actual path parameters and query the other API based on it.</p>\n\n<p>I want the result to be \"exactly\" the same (or at least, the body part), just like a simple JSON.</p>\n\n<p>For now, I don't want to create a structure for my data, I just want to simply get and retrieve the content.</p>\n\n<p>Here's what I have:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\nconst API_URL string = \"https://my-api-path/\"\n\nfunc setHeaders(w http.ResponseWriter) {\n    w.WriteHeader(http.StatusOK)\n    w.Header().Set(\"Content-Type\", \"application/json\")\n}\n\nfunc extractParams(r *http.Request) map[string]string {\n    return mux.Vars(r)\n}\n\nfunc getHandler(w http.ResponseWriter, r *http.Request) {\n    setHeaders(w)\n    params := extractParams(r)\n\n    url := API_URL + params[\"everything\"]\n    response, err := http.Get(url)\n\n    if err != nil {\n        fmt.Fprint(w, err)\n    }\n\n    fmt.Fprint(w, response)\n\n}\n\nfunc main() {\n    router := mux.NewRouter()\n    router.HandleFunc(\"/{everything}\", getHandler)\n    http.ListenAndServe(\":8080\", router)\n}\n</code></pre>\n\n<p><strong>My problem</strong></p>\n\n<p>For now, I m not able to retrieve JSON information from my other API. I only have a <code>text/plain</code> <code>Content-Type</code> which is weird since I enforce <code>application/json</code> and I only have some header details in the response body, something like:</p>\n\n<pre><code>&amp;{200 OK 200 HTTP/2.0 2 0 map[Allow:[GET, HEAD, OPTIONS] Expect-Ct:[max-age=86400, report-uri=\"https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct\"] Server:[cloudflare] Cf-Ray:[some-ray] Date:[Tue, 12 Jun 2018 14:38:57 GMT] Content-Type:[application/json] Set-Cookie:[__cfduid=lolol; expires=Wed, 12-Jun-19 14:38:56 GMT; path=/; domain=some-domain; HttpOnly; Secure] Vary:[Accept-Encoding Cookie] X-Frame-Options:[SAMEORIGIN] X-Xss-Protection:[1; mode=block]] 0xc4201926f0 -1 [] false true map[] 0xc420150800 0xc4200e8370}\n</code></pre>\n\n<p>Do you have any idea on how I can proxy this request (or the JSON result) ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1528812071, "post_id": 50819009, "comment_id": 88643322, "body": "What do you see when using debug breakpoints or <code>fmt.Println()</code> for <code>parser.file</code> ?"}, {"owner": {"reputation": 2074, "user_id": 688071, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1229375604/picture?type=large", "display_name": "Godzilla74", "link": "https://stackoverflow.com/users/688071/godzilla74"}, "reply_to_user": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1528812297, "post_id": 50819009, "comment_id": 88643463, "body": "Full disclosure, I&#39;m still learning Go.  Where did have in mind for me to place the <code>Println()</code> @Derek"}, {"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1528812325, "post_id": 50819009, "comment_id": 88643483, "body": "Also, you should really be capturing and handling the potential error returned by <code>xml.Unmarshal()</code>"}, {"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1528812423, "post_id": 50819009, "comment_id": 88643557, "body": "Also, please add the definition of <code>ConfigXML</code> type"}, {"owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "edited": false, "score": 0, "creation_date": 1529335000, "post_id": 50819009, "comment_id": 88825395, "body": "The <code>ConfigXML</code> type is there (the formatting had a typo). @Godzilla74, are you still running into trouble with this question?"}], "answers": [{"tags": [], "owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "is_accepted": true, "score": 3, "last_activity_date": 1528812752, "creation_date": 1528812752, "answer_id": 50819317, "question_id": 50819009, "link": "https://stackoverflow.com/questions/50819009/go-not-finding-unmarshaled-xml-node/50819317#50819317", "title": "Go not finding unmarshaled XML node", "body": "<p>Try exporting <code>snapshot</code> and adding a struct tag indicate the name. </p>\n\n<p><code>xml.Unmarshal</code> uses reflection to populate the the struct. So, the elements of the struct need to be exported.</p>\n\n<pre><code>type ConfigXML struct {\n    Snapshot []Snapshot `xml:\"snapshot\"`\n    FileName string\n}\n</code></pre>\n\n<p>See <a href=\"https://golang.org/pkg/encoding/xml/#Unmarshal\" rel=\"nofollow noreferrer\">the GoDoc</a> (search for \"exported\" and check out the example) for additional information about how <code>xml.Unmarshal</code> works.</p>\n"}], "owner": {"reputation": 2074, "user_id": 688071, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1229375604/picture?type=large", "display_name": "Godzilla74", "link": "https://stackoverflow.com/users/688071/godzilla74"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "accepted_answer_id": 50819317, "answer_count": 1, "score": 0, "last_activity_date": 1528812752, "creation_date": 1528811803, "last_edit_date": 1528812461, "question_id": 50819009, "link": "https://stackoverflow.com/questions/50819009/go-not-finding-unmarshaled-xml-node", "title": "Go not finding unmarshaled XML node", "body": "<p>I'm trying to unmarshal an XML file, but it's not finding my root node <code>snapshot</code>, which is keeping me from being able to unmarshal the rest of my file.</p>\n\n<p>I'm calling <code>parser.go</code> from <code>main.go</code>, as well as the <code>Validate</code> function.</p>\n\n<blockquote>\n  <p>parser.go</p>\n</blockquote>\n\n<pre><code>type Parser struct {\n    file     *ConfigXML\n    filepath string\n}\n\n//Load the file\nfunc (parser *Parser) Load() error {\n    b, err := helpers.LoadFile(parser.filepath)\n\n    if err != nil {\n        return err\n    }\n\n    parser.file = nil\n    xml.Unmarshal(b, &amp;parser.file)\n\n    return nil\n}\n\nfunc (parser *Parser) Validate() error {\n\n    if len(parser.file.snapshot) == 0 {\n        return fmt.Errorf(\"node snapshot does not exist\")\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>While my XML file is large, I'll post a snippet:</p>\n\n<pre><code>&lt;?xml version='1.0' encoding='UTF-8'?&gt;\n &lt;snapshot&gt;\n  &lt;ENBEquipment id=\"233443234543\" model=\"XYZ\" version=\"LR_16_02_L\"&gt;\n   &lt;attributes&gt;\n    &lt;administrativeState&gt;unlocked&lt;/administrativeState&gt;\n   &lt;/attributes&gt;\n  &lt;/ENBEquipment&gt;\n &lt;/snapshot&gt;\n</code></pre>\n\n<p>The structs I've created to unmarshal to:</p>\n\n<pre><code>type ConfigXML struct {\n    snapshot []Snapshot\n    FileName string\n}\n\n// Snapshot is root &lt;snapshot&gt;\ntype Snapshot struct {\n    ENBEquipment []ENBEquipment\n}\n\n// ENBEquipment subtag of &lt;snapshot&gt; -&gt; &lt;ENBEquipment&gt;\ntype ENBEquipment struct {\n    ID              string `xml:\"id,attr\"`\n    DeviceName      string `xml:\"id,attr\"`\n    SoftwareVersion string `xml:\"version,attr\"`\n    ElementType     string `xml:\"model,attr\"`\n    Enb             []Enb\n}\n</code></pre>\n\n<p>However when I attempt to run with <code>go run main.go</code>, I get:</p>\n\n<pre><code>ERRO[2018-06-12 09:45:34] parsing failed    error=\"node snapshot does not exist\" filename=/tmp/datain/xyz/123/agg/233443234543.xml\n</code></pre>\n\n<p>If I take out the Validation of <code>snapshot</code>, the file unmarshals fine. Why is this not finding the node?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1528809515, "post_id": 50817989, "comment_id": 88641502, "body": "You&#39;d have to loop through the slice and compare it byte by byte, as the string &quot;let&#39;s play&quot;, though a slice of bytes, does not have the length of 1024 that <code>msg</code> has."}, {"owner": {"reputation": 15, "user_id": 9876293, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-dxF9kXcw454/AAAAAAAAAAI/AAAAAAAAAAc/xeckOS7ZzJs/photo.jpg?sz=128", "display_name": "Si Lawas", "link": "https://stackoverflow.com/users/9876293/si-lawas"}, "reply_to_user": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1528809825, "post_id": 50817989, "comment_id": 88641711, "body": "I really didn&#39;t understand nothing, can you please write the code"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1528809942, "post_id": 50817989, "comment_id": 88641802, "body": "You could start with going through the Tour of Go one more time to refresh and solidify you Go skills. SO is not a &quot;write code for me service&quot;."}, {"owner": {"reputation": 1623, "user_id": 3263719, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/a3aff3452a5b060165118cd3a18f5e54?s=128&d=identicon&r=PG&f=1", "display_name": "c1moore", "link": "https://stackoverflow.com/users/3263719/c1moore"}, "edited": false, "score": 1, "creation_date": 1528810026, "post_id": 50817989, "comment_id": 88641853, "body": "Are you asking, as the title suggests, how to compare a string to an array of chars?  Or are you asking, as the post suggests, the best way to determine when to send a response?  Either way, please <b>format</b> your code and provide a <i>minimal</i> snippet."}, {"owner": {"reputation": 1623, "user_id": 3263719, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/a3aff3452a5b060165118cd3a18f5e54?s=128&d=identicon&r=PG&f=1", "display_name": "c1moore", "link": "https://stackoverflow.com/users/3263719/c1moore"}, "edited": false, "score": 2, "creation_date": 1528810334, "post_id": 50817989, "comment_id": 88642079, "body": "This is not the place for &quot;please write the code&quot;.  To determine what types of questions are appropriate for SO, please review this topic on the <a href=\"https://stackoverflow.com/help/on-topic\">help center</a>."}, {"owner": {"reputation": 15, "user_id": 9876293, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-dxF9kXcw454/AAAAAAAAAAI/AAAAAAAAAAc/xeckOS7ZzJs/photo.jpg?sz=128", "display_name": "Si Lawas", "link": "https://stackoverflow.com/users/9876293/si-lawas"}, "edited": false, "score": 1, "creation_date": 1528811570, "post_id": 50817989, "comment_id": 88642988, "body": "but this is a place for &quot;please help me&quot;"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528811699, "post_id": 50817989, "comment_id": 88643068, "body": "No it is not: Reddit or golang-nuts is the place for &quot;please help me&quot; and as you crossposted there <a href=\"https://www.reddit.com/r/golang/comments/8qixs1/how_to_compare_a_slice_to_a_string/\" rel=\"nofollow noreferrer\">reddit.com/r/golang/comments/8qixs1/&hellip;</a> you might get an answer there."}, {"owner": {"reputation": 15, "user_id": 9876293, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-dxF9kXcw454/AAAAAAAAAAI/AAAAAAAAAAc/xeckOS7ZzJs/photo.jpg?sz=128", "display_name": "Si Lawas", "link": "https://stackoverflow.com/users/9876293/si-lawas"}, "edited": false, "score": 0, "creation_date": 1528811897, "post_id": 50817989, "comment_id": 88643210, "body": "and I did get an answer there thank you for nothing"}, {"owner": {"reputation": 1623, "user_id": 3263719, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/a3aff3452a5b060165118cd3a18f5e54?s=128&d=identicon&r=PG&f=1", "display_name": "c1moore", "link": "https://stackoverflow.com/users/3263719/c1moore"}, "edited": false, "score": 0, "creation_date": 1528823786, "post_id": 50817989, "comment_id": 88649917, "body": "This is indeed a place for &quot;please help me&quot;, but we do have specific requirements for our content to make it as useful as possible.  Questions need background, an MVCE (if applicable), and a pointed question.  A general &quot;please write the code&quot; is not appropriate, but if you have done your research, we can help."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1528849467, "last_edit_date": 1528849467, "creation_date": 1528812011, "answer_id": 50819067, "question_id": 50817989, "link": "https://stackoverflow.com/questions/50817989/how-to-compare-a-slice-to-a-string/50819067#50819067", "title": "How to compare a slice to a string?", "body": "<p>Perhaps, something like this:</p>\n\n<pre><code>//receive msg\nmsg := make([]byte, 1024)\nfor {\n    n, useraddr, err := connection.ReadFromUDP(msg[:cap(msg)])\n    msg = msg[:n]\n    fmt.Println(\"msg from :\", useraddr)\n    if err != nil {\n        fmt.Printf(\"Some error  %v\", err)\n        continue\n    }\n    if string(msg) == \"let's play\" {\n        go sendResponse(connection, useraddr)\n    }\n}\n</code></pre>\n\n<p>The expression <code>msg[:cap(msg)]</code> sets the <code>msg</code> buffer length to its full capacity.</p>\n\n<p>The statement <code>msg = msg[:n]</code> sets the <code>msg</code> buffer length to the actual length read.</p>\n\n<p>The <code>string(msg)</code> expression converts the <code>msg</code> type <code>[]byte</code> to type <code>string</code> for the comparison.</p>\n"}], "owner": {"reputation": 15, "user_id": 9876293, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-dxF9kXcw454/AAAAAAAAAAI/AAAAAAAAAAc/xeckOS7ZzJs/photo.jpg?sz=128", "display_name": "Si Lawas", "link": "https://stackoverflow.com/users/9876293/si-lawas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 1, "accepted_answer_id": 50819067, "answer_count": 1, "score": -2, "last_activity_date": 1528849467, "creation_date": 1528808726, "last_edit_date": 1528827732, "question_id": 50817989, "link": "https://stackoverflow.com/questions/50817989/how-to-compare-a-slice-to-a-string", "title": "How to compare a slice to a string?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n)\n\nfunc main() {\n\n    msg := make([]byte, 1024)\n\n    //Basic variables\n    port := \":2002\"\n    protocol := \"udp\"\n\n    //Build the address\n    myaddr, err := net.ResolveUDPAddr(protocol, port)\n    if err != nil {\n        fmt.Println(\"Wrong Address\")\n        return\n    }\n\n    //Output\n    fmt.Println(\"Reading \" + protocol + \" from \" + myaddr.String())\n\n    //Create the connection\n    connection, err := net.ListenUDP(protocol, myaddr)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    //receive msg\n    for {\n        _, useraddr, err := connection.ReadFromUDP(msg)\n        fmt.Println(\"msg from :\", useraddr)\n\n        if err != nil {\n            fmt.Printf(\"Some error  %v\", err)\n            continue\n        }\n        go sendResponse(connection, useraddr)\n    }\n}\n</code></pre>\n\n<p>This is my UDP server, I'm making a game. So I want, if the client send \"let's play\", the server to run the <code>go sendresponse</code> function. If it's not \"let's play \" it will not run.</p>\n\n<p>I think I should compare <code>msg</code> but I don't know how. Thank you :)</p>\n"}, {"tags": ["opengl", "go", "transparency", "blending"], "comments": [{"owner": {"reputation": 9788, "user_id": 507043, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/kPUHE.png?s=128&g=1", "display_name": "Michael IV", "link": "https://stackoverflow.com/users/507043/michael-iv"}, "edited": false, "score": 0, "creation_date": 1528873095, "post_id": 50817040, "comment_id": 88665886, "body": "I used this one long ago,can&#39;t remember all the details,but have you taken a look at Nvidia OpenGL samples? There is a demo of this technique there with complete source code"}, {"owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "reply_to_user": {"reputation": 9788, "user_id": 507043, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/kPUHE.png?s=128&g=1", "display_name": "Michael IV", "link": "https://stackoverflow.com/users/507043/michael-iv"}, "edited": false, "score": 0, "creation_date": 1528882854, "post_id": 50817040, "comment_id": 88671713, "body": "@MichaelIV I had a look at that yes, but that was my first attempt. My second attempt was based off a working WebGL demo I have. But I&#39;m going to follow your advice anyway and attempt the NVidia one again. Future reference to the NVidia solution: <a href=\"https://github.com/NVIDIAGameWorks/GraphicsSamples/blob/master/samples/gl4-kepler/WeightedBlendedOIT/WeightedBlendedOIT.cpp\" rel=\"nofollow noreferrer\">github.com/NVIDIAGameWorks/GraphicsSamples/blob/master/sampl&zwnj;&#8203;es/&hellip;</a>"}, {"owner": {"reputation": 9788, "user_id": 507043, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/kPUHE.png?s=128&g=1", "display_name": "Michael IV", "link": "https://stackoverflow.com/users/507043/michael-iv"}, "edited": false, "score": 0, "creation_date": 1528883104, "post_id": 50817040, "comment_id": 88671919, "body": "But I remember also porting the code directly from the authors python demo.And it just worked. Make sure you set correct blending modes.Your last screen shot looks OK to me."}, {"owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "reply_to_user": {"reputation": 9788, "user_id": 507043, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/kPUHE.png?s=128&g=1", "display_name": "Michael IV", "link": "https://stackoverflow.com/users/507043/michael-iv"}, "edited": false, "score": 0, "creation_date": 1528887308, "post_id": 50817040, "comment_id": 88674620, "body": "@MichaelIV So the last screenshot is wrong because the yellow square isn&#39;t transparent to reveal the red behind it. See second last screenshot when I only enable blending."}, {"owner": {"reputation": 867, "user_id": 1121150, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ccdd15992f342d64acaae652eff3aa60?s=128&d=identicon&r=PG", "display_name": "Bim", "link": "https://stackoverflow.com/users/1121150/bim"}, "edited": false, "score": 0, "creation_date": 1541702738, "post_id": 50817040, "comment_id": 93316062, "body": "Which weighting function did you use? I have found it to be crucial to get good results. That said WBOIT (the 2016 paper) is not the silver bullet I had hoped it would be - the per-scene weighting function kind of kills it. Maybe the 2017 paper improves upon it, but I havent tried it out..."}, {"owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "reply_to_user": {"reputation": 867, "user_id": 1121150, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ccdd15992f342d64acaae652eff3aa60?s=128&d=identicon&r=PG", "display_name": "Bim", "link": "https://stackoverflow.com/users/1121150/bim"}, "edited": false, "score": 0, "creation_date": 1541781308, "post_id": 50817040, "comment_id": 93346264, "body": "@Bim I eventually realized that OIT will never give me the exact result I was hoping for. So I discontinued my efforts at the time. I am looking forward to how this concept develops over time, but currently have no need for pursuing it progressively."}, {"owner": {"reputation": 867, "user_id": 1121150, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ccdd15992f342d64acaae652eff3aa60?s=128&d=identicon&r=PG", "display_name": "Bim", "link": "https://stackoverflow.com/users/1121150/bim"}, "edited": false, "score": 0, "creation_date": 1541873520, "post_id": 50817040, "comment_id": 93369463, "body": "Look at Moment Transparency (see <a href=\"http://momentsingraphics.de/?page_id=210\" rel=\"nofollow noreferrer\">this</a> and <a href=\"https://briansharpe.files.wordpress.com/2018/07/moment-transparency-av.pdf\" rel=\"nofollow noreferrer\">this</a>). The result in the papers look pretty promising, as they are very close to ground truth (except in some pathological cases). The downside is one extra render pass, but else that that it works very similar to WBOIT."}], "owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1098, "favorite_count": 1, "answer_count": 0, "score": 3, "last_activity_date": 1528914570, "creation_date": 1528805896, "last_edit_date": 1528914570, "question_id": 50817040, "link": "https://stackoverflow.com/questions/50817040/weighted-blended-order-independent-transparency-rendering-issues", "title": "Weighted Blended Order-Independent Transparency rendering issues", "body": "<p>I'm implementing the OIT method from <a href=\"http://casual-effects.blogspot.com/2014/03/weighted-blended-order-independent.html\" rel=\"nofollow noreferrer\">this article</a> and I just cannot seem the get the correct results based on his <a href=\"http://1.bp.blogspot.com/-p1oHuj0YwaA/VXGHOL5DSFI/AAAAAAAAClM/h-YQ7iE50LQ/s1600/2015-03-26_000_scratch-morgan_r5768_g3d_r5767.png\" rel=\"nofollow noreferrer\">reference image</a>. When I try reproduce his reference (well, not <strong>EXACTLY</strong>) it comes out like this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/R0j0B.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/R0j0B.jpg\" alt=\"enter image description here\"></a></p>\n\n<h3>Issue</h3>\n\n<p>So the revealage output looks good but its the accumulation one that is all wrong. For starters, there is no depth testing. Both the blue and red sqaures should be behind or in front of the yellow square. There also isn't any alpha blending with the black background due to the three middle squares all having 0.75 alpha values.</p>\n\n<p>Then in the composite pass it also doesn't seem to use the revealage texture to dictate the depths of each object.</p>\n\n<p>From what I can tell with most of the OpenGL code, is that execution order is crucial and I when debugging (been going on for three days now), I get different results when moving something like <code>gl.DepthMask(false)</code> or <code>gl.Clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)</code> up by one line.</p>\n\n<h3>Code</h3>\n\n<pre><code>func (o *OpenGL) draw() {   \n    gl.ClearColor(clearColor.R, clearColor.G, clearColor.B, clearColor.A)\n    gl.Clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)\n\n\n    // DRAW OPAQUE FIRST (although the issue isn't really here, I just put it in incase)\n    gl.BindFramebuffer(gl.FRAMEBUFFER, o.opaqueFBO)\n    gl.DrawBuffer(gl.COLOR_ATTACHMENT0)\n    gl.Enable(gl.DEPTH_TEST)\n    gl.DepthMask(true)\n    gl.Clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)\n    gl.Disable(gl.BLEND)\n    gl.UseProgram(o.opaqueShader)\n\n    // Set uniforms\n    // Draw opaque objects\n\n    gl.UseProgram(0)\n\n    // THEN TRANSPARENT\n    gl.BindFramebuffer(gl.FRAMEBUFFER, o.transparentFBO)\n    gl.DrawBuffers(2, &amp;[]uint32{gl.COLOR_ATTACHMENT0, gl.COLOR_ATTACHMENT1}[0])\n    gl.Clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)\n    gl.ClearBufferfv(gl.COLOR, 0, &amp;[]float32{0, 0, 0, 1}[0])\n    gl.ClearBufferfv(gl.COLOR, 1, &amp;[]float32{1, 1, 1, 1}[0])\n    gl.Enable(gl.DEPTH_TEST)\n    gl.DepthMask(false)\n    gl.Enable(gl.BLEND)\n    gl.BlendFunci(0, gl.ONE, gl.ONE)\n    gl.BlendFunci(1, gl.ZERO, gl.ONE_MINUS_SRC_ALPHA)\n\n    gl.UseProgram(o.transparentShader)\n\n    // Set uniforms\n    // Draw opaque objects\n\n    gl.UseProgram(0)\n\n    // COMPOSITE PASS\n\n    gl.BindFramebuffer(gl.FRAMEBUFFER, 0)\n    gl.Disable(gl.DEPTH_TEST)\n    gl.Disable(gl.BLEND)\n\n    gl.UseProgram(o.compositeShader)\n\n    gl.ActiveTexture(gl.TEXTURE0)\n    gl.BindTexture(gl.TEXTURE_2D, o.transparentTex0)\n    gl.Uniform1i(uniformLocation(o.compositeShader, \"ColorTex0\\x00\"), int32(0))\n\n    gl.ActiveTexture(gl.TEXTURE1)\n    gl.BindTexture(gl.TEXTURE_2D, o.transparentTex1)\n    gl.Uniform1i(uniformLocation(o.compositeShader, \"ColorTex1\\x00\"), int32(1))\n\n    gl.DrawElements(gl.TRIANGLES, 6, gl.UNSIGNED_BYTE, gl.PtrOffset(0))\n    gl.BindVertexArray(0)\n    gl.UseProgram(0)\n\n\n    // RENDER A SPECIFIC TEXTURE FROM A FRAMEBUFFER. FOR TESTING THIS DRAWS OVER WHAT HAS ALREADY BEEN DRAWN.\n\n    // A.\n    // o.renderFramebuffer(o.transparentFBO, o.transparentTex0)\n\n    // B.\n    // o.renderFramebuffer(o.transparentFBO, o.transparentTex1)\n}\n\n\nfunc (o *OpenGL) renderFramebuffer(fbo uint32, tid uint32) {\n    // FBO DEBUGGER\n    gl.BindFramebuffer(gl.FRAMEBUFFER, 0)\n    gl.UseProgram(o.framebufferShader)\n\n    gl.ActiveTexture(gl.TEXTURE0)\n    gl.BindTexture(gl.TEXTURE_2D, tid)\n    gl.Uniform1i(uniformLocation(o.framebufferShader, \"Texture\\x00\"), int32(0))\n\n    // draw fullscreen quad\n\n    gl.UseProgram(0)\n    o.window.SwapBuffers()\n}\n</code></pre>\n\n<p>At the bottom of the draw function are the two functions I used to generate the revealage and accumu images from my testing reference.</p>\n\n<h3>Shaders</h3>\n\n<p>Here is the fragment shader from <code>o.transparentShader</code></p>\n\n<pre><code>#version 450 core\nlayout(location=0) in vec2 vTexCoord;\n\nuniform vec4 uColor;\n\nlayout(location=0, index=0) out vec4 oFragData0;\nlayout(location=0, index=1) out vec4 oFragData1;\n\nfloat w(float z, float a) {\n    return a * max(\n        pow(10.0, -2.0),\n        min(\n            3.0 * pow(10.0, 3.0),\n            10.0 /\n            (\n                pow(10.0, -5.0) + \n                pow(abs(z) / 5.0, 2.0) +\n                pow(abs(z) / 200.0, 6.0)\n            )\n        )\n    );\n}\nvoid main() {\n    vec4 Ci = uColor;\n\n    float ai = Ci.a;\n    float zi = gl_FragCoord.z;\n\n    float wresult = w(zi, ai);\n    oFragData0 = vec4(Ci.rgb * wresult, ai);\n    oFragData1.r = ai * wresult;\n}\n</code></pre>\n\n<p>And the fragment shader from <code>o.compositeShader</code></p>\n\n<pre><code>#version 450 core\nlayout(location=0) out vec4 outColor;\n\nuniform sampler2D ColorTex0;\nuniform sampler2D ColorTex1;\n\nout vec4 oFragColor;\n\nvoid main() {\n    vec4 accum = texelFetch(ColorTex0, ivec2(gl_FragCoord.xy), 0);\n    float r = accum.a;\n    accum.a = texelFetch(ColorTex1, ivec2(gl_FragCoord.xy), 0).r;\n    vec4 transparentColor = vec4(accum.rgb / clamp(accum.a, 1e-4, 5e4), r);\n    oFragColor = transparentColor * (1.0 - r);\n}\n</code></pre>\n\n<h3>Final Note</h3>\n\n<p>I stripped out all the error checking to keep the question minimal. I can confirm there are no errors with the shaders, framebuffers attachments, or <code>gl.GetError()</code> during the execution of my test output.</p>\n\n<p>I also removed most of the code relating to the drawing of opaque objects since this issue is about the transparent objects.</p>\n\n<h3>Update #1 (testing without framebuffers)</h3>\n\n<p>As an act of desperation I've stripped out all the code related to the FBOs and I came across some interesting results relating to blending...</p>\n\n<p><strong>DEPTH_TEST enabled | BLEND disabled | DEPTH_MASK false</strong>\n<a href=\"https://i.stack.imgur.com/yJawA.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/yJawA.jpg\" alt=\"enter image description here\"></a>\n<strong>DEPTH_TEST disabled | BLEND enabled | DEPTH_MASK false</strong>\n<a href=\"https://i.stack.imgur.com/fQIaH.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/fQIaH.jpg\" alt=\"enter image description here\"></a>\n<strong>DEPTH_TEST enabled | BLEND enabled | DEPTH_MASK false</strong>\n<a href=\"https://i.stack.imgur.com/bmp8k.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/bmp8k.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>As ridiculous as it might sound, it actually looks like it can do blending and depth testing separately, but when combined it just does a little bit of both and then gives up... Could this have something to do with the blend functions?</p>\n\n<h3>Update #2 (near perfect results based on the NVidia reference)</h3>\n\n<p>With a few brand new debugging tools and a better understanding of how OIT works, I've been able to get very close to the results I am hoping for. The final flaw being that the opaque objects (the scaled yellow square and the rotated cyan one) are darkened.</p>\n\n<p><a href=\"https://i.stack.imgur.com/hygUu.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hygUu.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>I got this far by tweaking the BlendFunc values and learning a few hard lessons about when to use which from each of these pairs:</p>\n\n<ul>\n<li><code>texture</code> vs <code>texelFetch</code></li>\n<li><code>GL_TEXTURE_2D</code> vs <code>GL_TEXTURE_RECT</code></li>\n<li><code>RGBA16F</code> vs <code>RGBA</code></li>\n<li><code>ONE_MINUS_SRC_ALPHA</code> vs <code>ONE_MINUS_SRC_COLOR</code></li>\n</ul>\n\n<p>I highly recommend fully understanding the differences before attempting MRT, Framebuffers, or OIT. Every reference made use of a different combination of these values.</p>\n\n<h3>Update #3 (final)</h3>\n\n<p>So after completely distancing myself from all the references and avoiding trying to copy their code across, I looked at the reference image from the first paragraph and just implemented it my own way.</p>\n\n<p><a href=\"https://i.stack.imgur.com/zF3EB.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/zF3EB.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>I'm going to leave this question for a while before I submit an answer because I'm still a bit skeptic and I want to run more tests (or perhaps hear from you guys?).</p>\n"}, {"tags": ["ios", "objective-c", "go", "gomobile"], "answers": [{"tags": [], "owner": {"reputation": 1053, "user_id": 234139, "user_type": "registered", "accept_rate": 30, "profile_image": "https://www.gravatar.com/avatar/a0efc2a2935cf5a96fc6e4604ffbdd51?s=128&d=identicon&r=PG", "display_name": "jonr", "link": "https://stackoverflow.com/users/234139/jonr"}, "is_accepted": false, "score": 2, "last_activity_date": 1571467192, "creation_date": 1571467192, "answer_id": 58461180, "question_id": 50815664, "link": "https://stackoverflow.com/questions/50815664/gomobile-binding-callbacks-for-objc/58461180#58461180", "title": "gomobile: binding callbacks for ObjC", "body": "<p>I ran into a similar issue today. I thought it was a bug in gomobile but it was my misunderstanding of swift/objc after all. <a href=\"https://github.com/golang/go/issues/35003\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/35003</a></p>\n\n<p>The TLDR of that bug is that you must subclass the protocol, and not the interface. If you are using swift then you can subclass the <code>GetResponseProtocol</code>:</p>\n\n<pre><code>class MyResponse: GetResponseProtocol\n</code></pre>\n\n<p>If in objc, then you probably want to directly implement the GetResponse protocol, rather than subclassing the interface.</p>\n"}], "owner": {"reputation": 21, "user_id": 1719140, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36ee02e252343dee471ca9e125c7dc54?s=128&d=identicon&r=PG", "display_name": "ensoreus", "link": "https://stackoverflow.com/users/1719140/ensoreus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 471, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1571467192, "creation_date": 1528801623, "last_edit_date": 1528832172, "question_id": 50815664, "link": "https://stackoverflow.com/questions/50815664/gomobile-binding-callbacks-for-objc", "title": "gomobile: binding callbacks for ObjC", "body": "<p>I have a Go interface</p>\n\n<pre><code>type GetResponse interface { OnResult(json string) }\n</code></pre>\n\n<p>I have to subscribe on that event OnResult from ObjC using this interface.</p>\n\n<pre><code>func Subscribe( response GetResponse){ response.OnResult(\"some json\") }\n</code></pre>\n\n<p>ObjC bind gives me a corresponding protocol and a basic class</p>\n\n<pre><code>@interface GetResponse : NSObject &lt;goSeqRefInterface, GetResponse&gt; {\n}\n@property(strong, readonly) id _ref;\n\n- (instancetype)initWithRef:(id)ref;\n- (void)onResult:(NSString*)json;\n@end\n</code></pre>\n\n<p>So, I need to get this json in my ObjC env. How can I do that?</p>\n\n<ol>\n<li><strong>Subclassing</strong> If I subclass this GetResponse or just use it as is and pass to     Subscribe routine, it crashes\n<strong>'go_seq_go_to_refnum on objective-c objects is not permitted'</strong></li>\n<li><p><strong>Category</strong> if I create struct on Go side with the protocol support, I can't subclass it but at least it's not crashes:</p>\n\n<pre><code>type GetResponseStruct struct{}\nfunc (GetResponseStruct) OnResult(json string){log.Info(\"GO RESULT\")}\nfunc CreateGetResponse() *GetResponseStruct{ return &amp;GetResponseStruct{}}\n</code></pre>\n\n<p>I have a solid object without obvious way to hook up my callback. If I make a category and override the onResult routine, it's not called. Just because overriding existing methods of class is not determined behavior according to AppleDoc. Anytime OnResult called from Go, the default implementation invokes and \"GO RESULT\" appears.</p></li>\n<li><p><strong>Swizzling</strong> I tried to use category and swizzle (replace method's implementation with mine renamed method) but it only works if I call onResult from ObjC env.</p></li>\n</ol>\n\n<p>Any way to solve my issue? Or I just red the doc not very accurately? Please help me</p>\n"}, {"tags": ["go", "time", "integer", "unsigned-integer"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1528802411, "post_id": 50815512, "comment_id": 88636547, "body": "Well, first <code>uint(a)</code> is not a cast in Go but a type conversion which just re-interprets the bits of a a being a uint. Now uints are just bit patterns and are neither positive nor negative and adding them is a bit operation resulting in a new bit pattern if you interpret this bit pattern as a signed integer then you&#39;ll see a subtraction happening because, well, that&#39;s how two&#39;s complement works. Tip: Do not use uints for numbers unless you feel comfortable with two&#39;s complement."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1528802469, "post_id": 50815512, "comment_id": 88636578, "body": "Formally the answer would be: &quot;Yes, you can rely on the language following the language spec.&quot;  which is a bit of nonsense answer."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1528803731, "post_id": 50815512, "comment_id": 88637419, "body": "Go doesn&#39;t have casting at all."}], "answers": [{"comments": [{"owner": {"reputation": 1275, "user_id": 1621584, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/8b6a478246788ac00b9d365390af5ec5?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/1621584/jeff"}, "edited": false, "score": 0, "creation_date": 1528802829, "post_id": 50815961, "comment_id": 88636823, "body": "The existing code uses already uint64 to represent time. I am not sure the motivation behind this or whether it is safe to change the variable types."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1275, "user_id": 1621584, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/8b6a478246788ac00b9d365390af5ec5?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/1621584/jeff"}, "edited": false, "score": 0, "creation_date": 1528802949, "post_id": 50815961, "comment_id": 88636907, "body": "@Jeff Then you may continue to use <code>uint64</code> type, but then do a subtraction, not addition, e.g. <code>interval := uint64(3600)</code> and then <code>endTime -= interval</code>."}, {"owner": {"reputation": 1275, "user_id": 1621584, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/8b6a478246788ac00b9d365390af5ec5?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/1621584/jeff"}, "edited": false, "score": 0, "creation_date": 1528803468, "post_id": 50815961, "comment_id": 88637217, "body": "the code is over simplified somewhat. interval can be a positive or negative value, specified by the user on the command line. If it is negative, it is added to the end time to get actually start time; if it is positive it is added to the start time to get end time. so i may be missing a better way of doing it but that is why I added interval."}, {"owner": {"reputation": 1933, "user_id": 1837565, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/jQ6Yt.jpg?s=128&g=1", "display_name": "Metalhead1247", "link": "https://stackoverflow.com/users/1837565/metalhead1247"}, "edited": false, "score": 0, "creation_date": 1528803747, "post_id": 50815961, "comment_id": 88637433, "body": "@icza Won&#39;t there be a overflow when converting a signed number to an unsigned ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1933, "user_id": 1837565, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/jQ6Yt.jpg?s=128&g=1", "display_name": "Metalhead1247", "link": "https://stackoverflow.com/users/1837565/metalhead1247"}, "edited": false, "score": 2, "creation_date": 1528803992, "post_id": 50815961, "comment_id": 88637615, "body": "@Metalhead1247 Conversion does not &quot;incur&quot; overflow. Conversion does not change the memory representation, just the type. Overflow may be the result of some arithmetic operation, a conversion is not that."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 7, "last_activity_date": 1528814995, "last_edit_date": 1528814995, "creation_date": 1528802608, "answer_id": 50815961, "question_id": 50815512, "link": "https://stackoverflow.com/questions/50815512/when-casting-an-int64-to-uint64-is-the-sign-retained/50815961#50815961", "title": "When casting an int64 to uint64, is the sign retained?", "body": "<p>Converting a signed number to an unsigned number will not remain negative, it can't, as the valid range of unsigned types doesn't include negative numbers. If you print <code>uint(interval)</code>, you will certainly see a positive number printed.</p>\n\n<p>What you experience is deterministic and you can rely on it (but it doesn't mean you should). It is the result of Go (and most other programming languages) storing signed integer types using the <a href=\"https://en.wikipedia.org/wiki/Two%27s_complement\" rel=\"nofollow noreferrer\">2's completement</a> representation.</p>\n\n<p>What this means is that in case of negative numbers, using <code>n</code> bit, the value <code>-x</code> (where <code>x</code> is positive) is stored as the binary representation of the positive value <code>2^n - x</code>. This has the advantage that numbers can be added bitwise, and the result will be correct regardless of whether they are negative or positive.</p>\n\n<p>So when you have a signed negative number, it is basically stored in memory like if you would subtract its absolute value from <code>0</code>. Which means that if you convert a negative, signed value to unsigned, and you add that to an unsigned value, the result will be correct because overflow will happen, in a useful way.</p>\n\n<p>Converting a value of type <code>int64</code> to <code>uint64</code> does not change the memory layout, only the type. So what 8 bytes the <code>int64</code> had, the converted <code>uint64</code> will have those same 8 bytes. And as mentioned above, the representation stored in those 8 bytes is the bit pattern identical to the bit pattern of value <code>0 - abs(x)</code>. So the result of the conversion will be a number that you would get if you would subtract <code>abs(x)</code> from <code>0</code>, in the unsigned world. Yes, this won't be negative (as the type is unsigned), instead it will be a \"big\" number, counting down from the max value of the <code>uint64</code> type. But if you add an <code>y</code> number bigger than <code>abs(x)</code> to this \"big\" number, overflow will happen, and the result will be like <code>y - abs(x)</code>.</p>\n\n<p>See this simple example demonstrating what's happening (try it on the <a href=\"https://play.golang.org/p/Ei9IAqxDnBv\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>a := uint8(100)\nb := int8(-10)\nfmt.Println(uint8(b)) // Prints 226 which is: 0 - 10 = 256 - 10\na = a + uint8(b)\nfmt.Println(a)        // Prints 90 which is: 100 + 226 = 326 = 90\n                      //           after overflow: 326 - 256 = 90\n</code></pre>\n\n<p>As mentioned above, you should not rely on this, as this may cause confusion. If you intend to work with negative numbers, then use signed types.</p>\n\n<p>And if you work with a code base that already uses <code>uint64</code> values, then do a subtraction instead of addition, using <code>uint64</code> values:</p>\n\n<pre><code>interval := uint64(3600)\nendTime -= interval\n</code></pre>\n\n<p>Also note that if you have <a href=\"https://golang.org/pkg/time/#Time\" rel=\"nofollow noreferrer\"><code>time.Time</code></a> values, you should take advantage of its <a href=\"https://golang.org/pkg/time/#Time.Add\" rel=\"nofollow noreferrer\"><code>Time.Add()</code></a> method:</p>\n\n<pre><code>func (t Time) Add(d Duration) Time\n</code></pre>\n\n<p>You may specify a <a href=\"https://golang.org/pkg/time/#Duration\" rel=\"nofollow noreferrer\"><code>time.Duration</code></a> to add to the time, which may be negative if you want to go back in time, like this:</p>\n\n<pre><code>t := time.Now()\nt = t.Add(-3600 * time.Second)\n</code></pre>\n\n<p><code>time.Duration</code> is more expressive: we see the value we specified above uses seconds explicitly.</p>\n"}], "owner": {"reputation": 1275, "user_id": 1621584, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/8b6a478246788ac00b9d365390af5ec5?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/1621584/jeff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5068, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1528814995, "creation_date": 1528801081, "last_edit_date": 1528803700, "question_id": 50815512, "link": "https://stackoverflow.com/questions/50815512/when-casting-an-int64-to-uint64-is-the-sign-retained", "title": "When casting an int64 to uint64, is the sign retained?", "body": "<p>I have an int64 variable which contains a negative number and I wish to subtract it from an uint64 variable which contains a positive number:</p>\n\n<pre><code>var endTime uint64\nnow := time.Now().Unix()\nendTime = uint64(now)\nvar interval int64\ninterval = -3600\nendTime = endTime + uint64(interval)\n</code></pre>\n\n<p>The above code appears to work but I wonder if I can rely on this. I am surprised, being new to Go, that after casting a negative number to uint64 that it remains negative -- I had planned to subtract the now positive value (after casting) to get what I wanted.</p>\n"}, {"tags": ["reactjs", "api", "go", "cors", "go-gin"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1528796880, "post_id": 50813853, "comment_id": 88633192, "body": "Try to add <code>CORS</code> middleware of gin for golang code to allow access to cross domain requests"}, {"owner": {"reputation": 383, "user_id": 9684016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ef1b3774f79c2b02b77c344c82aae71?s=128&d=identicon&r=PG&f=1", "display_name": "v v", "link": "https://stackoverflow.com/users/9684016/v-v"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1528852133, "post_id": 50813853, "comment_id": 88660124, "body": "@Himanshu I have added a middleware but got the same result."}], "answers": [{"comments": [{"owner": {"reputation": 383, "user_id": 9684016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ef1b3774f79c2b02b77c344c82aae71?s=128&d=identicon&r=PG&f=1", "display_name": "v v", "link": "https://stackoverflow.com/users/9684016/v-v"}, "edited": false, "score": 0, "creation_date": 1528852088, "post_id": 50814244, "comment_id": 88660120, "body": "Thank you. I have added that package. But the same result again. I have added the source to the question."}, {"owner": {"reputation": 183, "user_id": 5506197, "user_type": "registered", "profile_image": "https://graph.facebook.com/1065312320169114/picture?type=large", "display_name": "\u738b\u4fe1\u51f1", "link": "https://stackoverflow.com/users/5506197/%e7%8e%8b%e4%bf%a1%e5%87%b1"}, "edited": false, "score": 0, "creation_date": 1528856993, "post_id": 50814244, "comment_id": 88661087, "body": "You need to set AllowOrigins(&quot;<a href=\"http://localhost:8080&quot;\" rel=\"nofollow noreferrer\">localhost:8080&quot;</a>) &amp; AllowMethods &amp; AllowHeaders(&quot;Origin&quot;)"}, {"owner": {"reputation": 383, "user_id": 9684016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ef1b3774f79c2b02b77c344c82aae71?s=128&d=identicon&r=PG&f=1", "display_name": "v v", "link": "https://stackoverflow.com/users/9684016/v-v"}, "edited": false, "score": 0, "creation_date": 1528863856, "post_id": 50814244, "comment_id": 88662341, "body": "If set <code>localhost:8080</code> will cause <code>panic: bad origin: origins must either be &#39;*&#39; or include http:&#47;&#47; or https:&#47;&#47;</code> error when start server."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 383, "user_id": 9684016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ef1b3774f79c2b02b77c344c82aae71?s=128&d=identicon&r=PG&f=1", "display_name": "v v", "link": "https://stackoverflow.com/users/9684016/v-v"}, "edited": false, "score": 0, "creation_date": 1528880490, "post_id": 50814244, "comment_id": 88670170, "body": "@vv I have edited the answer for allowing all origins you can use <code>Default</code> config. Please check edited answer"}, {"owner": {"reputation": 383, "user_id": 9684016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ef1b3774f79c2b02b77c344c82aae71?s=128&d=identicon&r=PG&f=1", "display_name": "v v", "link": "https://stackoverflow.com/users/9684016/v-v"}, "edited": false, "score": 0, "creation_date": 1528880681, "post_id": 50814244, "comment_id": 88670293, "body": "@Himanshu Thank you. This time got <code>Warning: Missing translation for key: &quot;The X-Total-Count header is missing in the HTTP Response. The jsonServer Data Provider expects responses for lists of resources to contain this header with the total number of results to build the pagination. If you are using CORS, did you declare X-Total-Count in the Access-Control-Expose-Headers header?&quot;</code> I also added <code>X-Total-Count</code> but didn&#39;t fix."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 383, "user_id": 9684016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ef1b3774f79c2b02b77c344c82aae71?s=128&d=identicon&r=PG&f=1", "display_name": "v v", "link": "https://stackoverflow.com/users/9684016/v-v"}, "edited": false, "score": 0, "creation_date": 1528880845, "post_id": 50814244, "comment_id": 88670382, "body": "@vv Have you checked the link for more information. Also set the headers it requires Because when you are requesting from different domain you should add <code>Access-Control-Expose-Headers</code>"}, {"owner": {"reputation": 383, "user_id": 9684016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ef1b3774f79c2b02b77c344c82aae71?s=128&d=identicon&r=PG&f=1", "display_name": "v v", "link": "https://stackoverflow.com/users/9684016/v-v"}, "edited": false, "score": 0, "creation_date": 1528881069, "post_id": 50814244, "comment_id": 88670507, "body": "@Himanshu Yes, I add this line to <code>cors.Config</code>: <code>ExposeHeaders: []string{&quot;X-Total-Count&quot;},</code>, and this line for adding header: <code>AllowHeaders:  []string{&quot;Content-Type&quot;},</code>. Not work."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 1, "last_activity_date": 1528881675, "last_edit_date": 1528881675, "creation_date": 1528797164, "answer_id": 50814244, "question_id": 50813853, "link": "https://stackoverflow.com/questions/50813853/why-got-404-for-api-endpoint-with-react-admin/50814244#50814244", "title": "Why got 404 for API endpoint with react-admin?", "body": "<p>Add <code>CORS</code> middleware for cross origin domain requests. I would prefer to hit the api using <code>postman</code> to check if it is working fine. Below is the way to implement <code>CORS</code> middleware for gin in go:-</p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n\n    \"github.com/gin-contrib/cors\"\n    \"github.com/gin-gonic/gin\"\n)\n\nfunc main() {\n    router := gin.Default()\n    // CORS for http://localhost:8080 and https://github.com origins, allowing:\n    // - PUT and PATCH methods\n    // - Origin header\n    // - Credentials share\n    // - Preflight requests cached for 12 hours\n    router.Use(cors.New(cors.Config{\n        AllowOrigins:     []string{\"http://localhost:8080, https://localhost:8080\"},\n        AllowMethods:     []string{\"GET\", \"POST\", \"HEAD\", \"PUT\", \"PATCH\"},\n        AllowHeaders:     []string{\"Origin\"},\n        ExposeHeaders:    []string{\"Content-Length\"},\n        AllowCredentials: true,\n        MaxAge: 12 * time.Hour,\n    }))\n    router.Run()\n}\n</code></pre>\n\n<p><strong>Edited:</strong> For allowing all origins use <code>Default</code> config for <code>cors</code> as</p>\n\n<pre><code>func main() {\n    router := gin.Default()\n    // same as\n    // config := cors.DefaultConfig()\n    // config.AllowAllOrigins = true\n    // router.Use(cors.New(config))\n    router.Use(cors.Default())\n    router.Run()\n}\n</code></pre>\n\n<p>For more information checkout <a href=\"https://github.com/gin-contrib/cors\" rel=\"nofollow noreferrer\">CORS middleware</a> for gin</p>\n"}, {"tags": [], "owner": {"reputation": 383, "user_id": 9684016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ef1b3774f79c2b02b77c344c82aae71?s=128&d=identicon&r=PG&f=1", "display_name": "v v", "link": "https://stackoverflow.com/users/9684016/v-v"}, "is_accepted": true, "score": 0, "last_activity_date": 1529037496, "creation_date": 1529037496, "answer_id": 50869185, "question_id": 50813853, "link": "https://stackoverflow.com/questions/50813853/why-got-404-for-api-endpoint-with-react-admin/50869185#50869185", "title": "Why got 404 for API endpoint with react-admin?", "body": "<p>This way works:</p>\n\n<pre><code>func main() {\n        // ...\n        r := gin.Default()\n        r.Use(cors.New(cors.Config{\n                AllowOrigins:  []string{\"http://localhost:3000\"},\n                AllowMethods:  []string{\"GET\", \"POST\", \"PUT\", \"PATCH\", \"DELETE\", \"HEAD\"},\n                AllowHeaders:  []string{\"Origin\", \"Content-Length\", \"Content-Type\"},\n                ExposeHeaders: []string{\"X-Total-Count\"},\n        }))\n        r.GET(\"/posts\", GetPosts)\n        // ...\n        r.Run()\n}\n\nfunc GetPosts(c *gin.Context) {\n        var posts []Post\n        if err := db.Find(&amp;posts).Error; err != nil {\n                c.AbortWithStatus(404)\n                fmt.Println(err)\n        } else {\n                c.Header(\"X-Total-Count\", \"25\")\n                c.JSON(200, posts)\n        }\n}\n</code></pre>\n\n<p>Due to <a href=\"https://www.npmjs.com/package/ra-data-json-server\" rel=\"nofollow noreferrer\">ra-data-json-server</a>.</p>\n"}], "owner": {"reputation": 383, "user_id": 9684016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ef1b3774f79c2b02b77c344c82aae71?s=128&d=identicon&r=PG&f=1", "display_name": "v v", "link": "https://stackoverflow.com/users/9684016/v-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1767, "favorite_count": 0, "accepted_answer_id": 50869185, "answer_count": 2, "score": 1, "last_activity_date": 1597434079, "creation_date": 1528796098, "last_edit_date": 1597434079, "question_id": 50813853, "link": "https://stackoverflow.com/questions/50813853/why-got-404-for-api-endpoint-with-react-admin", "title": "Why got 404 for API endpoint with react-admin?", "body": "<h1>Created backend API use <code>gin</code> with <code>go</code> language</h1>\n\n<pre><code>type Post struct {\n    ID uint `json:\"id\"`\n    Title string `json:\"title\"`\n    Body string `json:\"body\"`\n}\n\nfunc main() {\n    // ...\n    r := gin.Default()\n    r.GET(\"/posts\", GetPosts)\n    r.GET(\"/posts/:id\", GetPost)\n    r.POST(\"/posts\", CreatePost)\n    r.PUT(\"/posts/:id\", UpdatePost)\n    r.DELETE(\"/posts/:id\", DeletePost)\n\n    r.Run(\":8080\")\n}\n\nfunc GetPosts(c *gin.Context) {\n    var posts []Post\n    c.Writer.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    if err := db.Find(&amp;posts).Error; err != nil {\n            c.AbortWithStatus(404)\n            fmt.Println(err)\n    } else {\n            c.JSON(200, post)\n    }\n}\n\n// ...\n</code></pre>\n\n<h1>Created frontend use <code>react</code> with <code>react-admin</code></h1>\n\n<h2>src/App.js</h2>\n\n<pre><code>import React from 'react';\nimport { Admin, Resource } from 'react-admin';\nimport jsonServerProvider from 'ra-data-json-server';\nimport { PostList } from './posts';\n\nconst dataProvider = jsonServerProvider('http://localhost:8080');\n\nconst App = () =&gt; (\n        &lt;Admin dataProvider={dataProvider}&gt;\n    &lt;Resource name=\"posts\" list={PostList} /&gt;\n        &lt;/Admin&gt;\n);\n\nexport default App;\n</code></pre>\n\n<h2>src/posts.js</h2>\n\n<pre><code>import React from 'react';\nimport { List, Datagrid, TextField } from 'react-admin';\n\nexport const PostList = (props) =&gt; (\n    &lt;List {...props}&gt;\n        &lt;Datagrid&gt;\n            &lt;TextField source=\"id\" /&gt;\n            &lt;TextField source=\"title\" /&gt;\n            &lt;TextField source=\"body\" /&gt;\n        &lt;/Datagrid&gt;\n    &lt;/List&gt;\n);\n</code></pre>\n\n<p>When access <code>http://localhost:3000</code> from chrome browser, got <code>Failed to fetch</code> message. From the console I saw:</p>\n\n<pre><code>Failed to load http://localhost:8080/posts?_end=10&amp;_order=DESC&amp;_sort=id&amp;_start=0: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://localhost:3000' is therefore not allowed access. The response had HTTP status code 404. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.\n</code></pre>\n\n<p>I have tried to add <code>Access-Control-Allow-Origin</code> in the go API program, but the same result. From the <code>gin</code> output I got:</p>\n\n<pre><code>[GIN] 2018/06/12 - 18:14:50 | 404 |       1.813\u00b5s |       127.0.0.1 | OPTIONS  /posts?_end=10&amp;_order=DESC&amp;_sort=id&amp;_start=0\n</code></pre>\n\n<hr>\n\n<h1>Add</h1>\n\n<p>Added <code>cors</code> package then change source as:</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n\n        \"github.com/gin-contrib/cors\"\n        \"github.com/gin-gonic/gin\"\n        // ...\n)\n\n// ...\n\nfunc main() {\n    r := gin.Default()\n\n    r.Use(cors.New(cors.Config{\n            AllowOrigins: []string{\"http://localhost:8080\"},\n    }))\n\n    r.GET(\"/posts\", GetPosts)\n    r.GET(\"/posts/:id\", GetPost)\n    r.POST(\"/posts\", CreatePost)\n    r.PUT(\"/posts/:id\", UpdatePost)\n    r.DELETE(\"/posts/:id\", DeletePost)\n\n    r.Run()\n}\n</code></pre>\n\n<p>Got same error again:</p>\n\n<pre><code>Failed to load http://localhost:8080/posts?_end=10&amp;_order=DESC&amp;_sort=id&amp;_start=0: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource. Origin 'http://localhost:3000' is therefore not allowed access. The response had HTTP status code 403. If an opaque response serves your needs, set the request's mode to 'no-cors' to fetch the resource with CORS disabled.\n</code></pre>\n\n<p>This time, the output of <code>gin</code> was:</p>\n\n<pre><code>[GIN] 2018/06/13 - 11:01:59 | 403 |       7.873\u00b5s |             ::1 | OPTIONS  /posts?_end=10&amp;_order=DESC&amp;_sort=id&amp;_start=0\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1528791336, "post_id": 50812137, "comment_id": 88629872, "body": "Can you provide an example of the xml data you are trying to unmarshal, as well as the type definition of the target value."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528793495, "post_id": 50812137, "comment_id": 88631080, "body": "Please provide a <b>standalone</b> example of the problem."}, {"owner": {"reputation": 23, "user_id": 9840635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7642435a6afabdea2c01faacf49aabbf?s=128&d=identicon&r=PG&f=1", "display_name": "jack", "link": "https://stackoverflow.com/users/9840635/jack"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528798607, "post_id": 50812137, "comment_id": 88634263, "body": "@mkopriva I&#39;m still testing but it looks like the answer you posted before solved the problem.. maybe can repost it again so I can accept it :)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528799091, "post_id": 50812137, "comment_id": 88634520, "body": "@jack I&#39;ve removed it because I haven&#39;t actually tested it and I assume it could fail for some form of utf16 strings, in which case you would need to implement a reader that converts utf16 to utf8. I&#39;ll undelete the answer and add a note for any other reader who may stumble upon the answer."}], "answers": [{"comments": [{"owner": {"reputation": 195, "user_id": 6459998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f94b1941b9a0be6a5d8edcd8b07201cf?s=128&d=identicon&r=PG&f=1", "display_name": "zerzevul", "link": "https://stackoverflow.com/users/6459998/zerzevul"}, "edited": false, "score": 1, "creation_date": 1608244212, "post_id": 50812725, "comment_id": 115531963, "body": "This worked for me trying to parse an xml with <code>encoding=&quot;ISO-8859-7&quot;</code>. Cheers!"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1528799292, "last_edit_date": 1528799292, "creation_date": 1528792571, "answer_id": 50812725, "question_id": 50812137, "link": "https://stackoverflow.com/questions/50812137/xml-encoding-utf-16-declared-but-decoder-charsetreader-is-nil-unmarshal-succe/50812725#50812725", "title": "xml: encoding &quot;utf-16&quot; declared but Decoder.CharsetReader is nil unmarshal successful", "body": "<p>If the <code>charset.NewReader</code> you're using in the second example is from <a href=\"https://godoc.org/golang.org/x/net/html/charset\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/net/html/charset</a> then the code shouldn't even compile since the <a href=\"https://golang.org/pkg/encoding/xml/#Decoder.CharsetReader\" rel=\"nofollow noreferrer\"><code>CharsetReader</code></a> field has a different signature from <code>NewReader</code>.</p>\n\n<hr>\n\n<p>To fix the error you can provide an \"identical\" charset reader, that is, one that returns the input unchanged.</p>\n\n<pre><code>func identReader(encoding string, input io.Reader) (io.Reader, error) {\n    return input, nil\n}\n\n// ...\n\ndecoder.CharsetReader = identReader\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/BiU4T2qz1Z1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/BiU4T2qz1Z1</a></p>\n\n<hr>\n\n<p><strong>NOTE</strong>: the above solution works for the example characters from the question but it may very well fail for other utf16 strings. In such a case a custom charset reader that can convert utf16 to utf8 should be provided instead of the <code>identReader</code>.</p>\n"}], "owner": {"reputation": 23, "user_id": 9840635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7642435a6afabdea2c01faacf49aabbf?s=128&d=identicon&r=PG&f=1", "display_name": "jack", "link": "https://stackoverflow.com/users/9840635/jack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1194, "favorite_count": 0, "accepted_answer_id": 50812725, "answer_count": 1, "score": 0, "last_activity_date": 1528799292, "creation_date": 1528790645, "question_id": 50812137, "link": "https://stackoverflow.com/questions/50812137/xml-encoding-utf-16-declared-but-decoder-charsetreader-is-nil-unmarshal-succe", "title": "xml: encoding &quot;utf-16&quot; declared but Decoder.CharsetReader is nil unmarshal successful", "body": "<p>I'm trying to unmarshal an XML feed containing German characters (e.g. \u00df, \u00e4, \u00d6, \u00fc, etc) into a struct, which results in the error: <code>xml: encoding \"utf-16\" declared but Decoder.CharsetReader is nil unmarshal successful</code></p>\n\n<p>Basically this is what I'm doing (omitted error checking for the parts that work):</p>\n\n<pre><code>resp, _ := http.Get(url)\ndefer resp.Body.Close()\nbodyBytes, _ := ioutil.ReadAll(resp.Body)\nerr = xml.Unmarshal(bodyBytes, &amp;target)\nif err != nil {\n  fmt.Println(err)\n}\n</code></pre>\n\n<p>I've tried to convert xml to json using <code>github.com/basgys/goxml2json</code>, I've tried to convert to string and back to []byte before unmarshal, I've tried to use various decoders posted in other SO answers (since it say charset reader is nil), such as:</p>\n\n<pre><code>reader := bytes.NewReader(bodyBytes)\ndecoder := xml.NewDecoder(reader)\ndecoder.CharsetReader = charset.NewReader\nerr = decoder.Decode(&amp;target)\nif err != nil {\n  fmt.Println(err)\n}\n</code></pre>\n\n<p>No matter what I've tried it fails to unmarshal/decode the xml feed into the struct.. in some cases it ends up converting all the text to Chinese rather than German.</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda"], "comments": [{"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1528790331, "post_id": 50811927, "comment_id": 88629357, "body": "First, in your logging you have a typo: <code>log.Print(request.body)</code> should be <code>log.Print(request.Body)</code>"}, {"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1528790458, "post_id": 50811927, "comment_id": 88629420, "body": "Secondly, doesn&#39;t <code>lamda.Start</code> send the context first?"}, {"owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1528790480, "post_id": 50811927, "comment_id": 88629432, "body": "For example, your handler should be: <code>Handler(ctx context.Context, request events.APIGatewayProxyRequest)</code>"}, {"owner": {"reputation": 55, "user_id": 9928877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/772d60e02613628d0be613aeaec12d9c?s=128&d=identicon&r=PG&f=1", "display_name": "matti0006", "link": "https://stackoverflow.com/users/9928877/matti0006"}, "reply_to_user": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1528795855, "post_id": 50811927, "comment_id": 88632507, "body": "@Derek adding the context doesn&#39;t seem to make a difference. It still returns an empty body (even capitalized correctly). The Amazon example also doesn&#39;t list the context: <a href=\"https://aws.amazon.com/blogs/compute/announcing-go-support-for-aws-lambda/\" rel=\"nofollow noreferrer\">aws.amazon.com/blogs/compute/&hellip;</a>"}, {"owner": {"reputation": 55, "user_id": 9928877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/772d60e02613628d0be613aeaec12d9c?s=128&d=identicon&r=PG&f=1", "display_name": "matti0006", "link": "https://stackoverflow.com/users/9928877/matti0006"}, "reply_to_user": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "edited": false, "score": 0, "creation_date": 1528796254, "post_id": 50811927, "comment_id": 88632750, "body": "In fact, the example on that website does not even work for me...it will return the error &quot;no name was provided in the HTTP body&quot;"}, {"owner": {"reputation": 721, "user_id": 4628081, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yGbnkCNSojE/AAAAAAAAAAI/AAAAAAAAAcY/zmn34zFQAVI/photo.jpg?sz=128", "display_name": "Francesco Gualazzi", "link": "https://stackoverflow.com/users/4628081/francesco-gualazzi"}, "edited": false, "score": 0, "creation_date": 1529393527, "post_id": 50811927, "comment_id": 88844995, "body": "I feel your pain... basically this tests are testing <code>encoding&#47;json</code> Marshal/Unmarshal instead of properly testing the API Gateway functionality <a href=\"https://github.com/aws/aws-lambda-go/blob/master/events/apigw_test.go#L48\" rel=\"nofollow noreferrer\">github.com/aws/aws-lambda-go/blob/master/events/&hellip;</a>."}, {"owner": {"reputation": 721, "user_id": 4628081, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yGbnkCNSojE/AAAAAAAAAAI/AAAAAAAAAcY/zmn34zFQAVI/photo.jpg?sz=128", "display_name": "Francesco Gualazzi", "link": "https://stackoverflow.com/users/4628081/francesco-gualazzi"}, "edited": false, "score": 0, "creation_date": 1529394012, "post_id": 50811927, "comment_id": 88845292, "body": "Chances are the body of the request is available only if you perform a POST, and not a GET. What HTTP verb are you using in your tests?  Also see this other answer for Python <a href=\"https://stackoverflow.com/questions/46672812/aws-api-gateway-malformed-lambda-response?rq=1\" title=\"aws api gateway malformed lambda response\">stackoverflow.com/questions/46672812/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 9928877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/772d60e02613628d0be613aeaec12d9c?s=128&d=identicon&r=PG&f=1", "display_name": "matti0006", "link": "https://stackoverflow.com/users/9928877/matti0006"}, "edited": false, "score": 0, "creation_date": 1529921317, "post_id": 50955619, "comment_id": 89034426, "body": "Thank you very much; this should give enough pointers to continue!"}], "tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": true, "score": 3, "last_activity_date": 1529522603, "creation_date": 1529522603, "answer_id": 50955619, "question_id": 50811927, "link": "https://stackoverflow.com/questions/50811927/having-issues-with-testing-lambda-functions-on-aws/50955619#50955619", "title": "Having issues with testing Lambda functions on AWS", "body": "<p>There's a few minor things I changed and then it works</p>\n\n<p>First, <code>log.Print(request.body)</code> doesn't compile for me, but using <code>request.Body</code> is fine</p>\n\n<p>Second, the type you are using for the request is</p>\n\n<pre><code>// APIGatewayProxyRequest contains data coming from the API Gateway proxy\ntype APIGatewayProxyRequest struct {\n    Resource              string                        `json:\"resource\"` // The resource path defined in API Gateway\n    Path                  string                        `json:\"path\"`     // The url path for the caller\n    HTTPMethod            string                        `json:\"httpMethod\"`\n    Headers               map[string]string             `json:\"headers\"`\n    QueryStringParameters map[string]string             `json:\"queryStringParameters\"`\n    PathParameters        map[string]string             `json:\"pathParameters\"`\n    StageVariables        map[string]string             `json:\"stageVariables\"`\n    RequestContext        APIGatewayProxyRequestContext `json:\"requestContext\"`\n    Body                  string                        `json:\"body\"`\n    IsBase64Encoded       bool                          `json:\"isBase64Encoded,omitempty\"`\n}\n</code></pre>\n\n<p>and in this Body is a field \"body\" that's a string.  So altering your test data to</p>\n\n<pre><code>{\n  \"body\": \"HELLO\"\n\n}\n</code></pre>\n\n<p>will give some data that passes through</p>\n\n<p>Lastly, the parameters for the Handler in all the examples seems to include a context object, so I added that</p>\n\n<pre><code>func Handler(ctx context.Context, request events.APIGatewayProxyRequest) \n</code></pre>\n\n<p>Here is a complete version of your program that \"worked for me\"</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"github.com/aws/aws-lambda-go/events\"\n    \"github.com/aws/aws-lambda-go/lambda\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc Handler(ctx context.Context, request events.APIGatewayProxyRequest) (events.APIGatewayProxyResponse, error) {\n\n    //These log statements return empty regardless of JSON input.\n    log.Print(request.Body)\n\n    return events.APIGatewayProxyResponse{\n        StatusCode: http.StatusOK,\n        Body:       request.Body}, nil\n}\n\nfunc main() {\n    lambda.Start(Handler)\n}\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 9928877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/772d60e02613628d0be613aeaec12d9c?s=128&d=identicon&r=PG&f=1", "display_name": "matti0006", "link": "https://stackoverflow.com/users/9928877/matti0006"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1164, "favorite_count": 1, "accepted_answer_id": 50955619, "answer_count": 1, "score": 4, "last_activity_date": 1529522603, "creation_date": 1528789796, "question_id": 50811927, "link": "https://stackoverflow.com/questions/50811927/having-issues-with-testing-lambda-functions-on-aws", "title": "Having issues with testing Lambda functions on AWS", "body": "<p>I have been trying to get my first lambda function in Go running via the Amazon API Gateway.</p>\n\n<p>I have the following package set up in go. The goal is to send a JSON request and log and return the body of that request:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"log\"\n    \"github.com/aws/aws-lambda-go/lambda\"\n    \"github.com/aws/aws-lambda-go/events\"\n)\n\nfunc Handler(request events.APIGatewayProxyRequest) (events.APIGatewayProxyResponse, error) {\n\n    //These log statements return empty regardless of JSON input.\n    log.Print(request.body)\n\n    return events.APIGatewayProxyResponse{\n        StatusCode: http.StatusOK,\n        Body: request.Body\n    }, nil\n}\n\nfunc main() {\n    lambda.Start(Handler)\n}\n</code></pre>\n\n<p>I can build and zip this and upload it to the AWS lambda manager.\nThe AWS lambda manager contains an option to use a test event which I can configure with a JSON string</p>\n\n<pre><code>{\n  \"testint\": 1,\n  \"teststring\": \"test\"\n}\n</code></pre>\n\n<p>However, if I run this test, I get the following result:</p>\n\n<pre><code>{\n  \"statusCode\": 200,\n  \"headers\": null,\n  \"body\": \"\"\n}\n</code></pre>\n\n<p>I would expect the body to actually contain the json I passed to the function, but clearly something is going wrong.</p>\n"}, {"tags": ["arrays", "dictionary", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1528787853, "post_id": 50809970, "comment_id": 88627960, "body": "Take the Tour of Go once more. You&#39;ll find the explanations very clear."}], "answers": [{"tags": [], "owner": {"reputation": 6198, "user_id": 2020002, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/t9iFY.jpg?s=128&g=1", "display_name": "Derek Pollard", "link": "https://stackoverflow.com/users/2020002/derek-pollard"}, "is_accepted": false, "score": 2, "last_activity_date": 1528783251, "creation_date": 1528783251, "answer_id": 50810140, "question_id": 50809970, "link": "https://stackoverflow.com/questions/50809970/to-create-map-of-array-of-map-in-golang/50810140#50810140", "title": "To create map of array of map in golang", "body": "<h2>In a struct:</h2>\n\n<pre><code>type SomeData struct {\n    Inputs []struct {\n        Data struct {\n            Image struct {\n                URL string `json:\"url\"`\n            } `json:\"image\"`\n        } `json:\"data\"`\n    } `json:\"inputs\"`\n}\n</code></pre>\n\n<p>But if we wanted to be able to add things individually, AND be more idiomatic, we would do it like this:</p>\n\n<pre><code>type Image struct {\n    URL string `json:\"url\"`\n}\n\ntype Data struct {\n    Image Image `json:\"image\"`\n}\n\n\ntype Input struct {\n    Data Data `json:\"data\"`\n}\n\ntype SomeData struct {\n    Inputs []Input `json:\"inputs\"`\n}\n</code></pre>\n\n<p>Then, of course, we could always just use a map:\n<code>someData := map[interface{}]interface{}{}</code></p>\n\n<p>It really just depends on which route you'd like to go. I suggest the second one as it gives you better fine-grained tooling without any pesky dirty tricks or code-clutter.</p>\n\n<p>Hope this helps!</p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 9812197, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Denys Nahurnyi", "link": "https://stackoverflow.com/users/9812197/denys-nahurnyi"}, "is_accepted": false, "score": 0, "last_activity_date": 1528793280, "creation_date": 1528793280, "answer_id": 50812948, "question_id": 50809970, "link": "https://stackoverflow.com/questions/50809970/to-create-map-of-array-of-map-in-golang/50812948#50812948", "title": "To create map of array of map in golang", "body": "<p>neededMap := make(map[string][]map[string]map[string]map[string]string)</p>\n"}], "owner": {"reputation": 1, "user_id": 9567391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/35672c301ebad385404f2eeb6b239c5c?s=128&d=identicon&r=PG&f=1", "display_name": "PankajTekwani", "link": "https://stackoverflow.com/users/9567391/pankajtekwani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 309, "favorite_count": 0, "answer_count": 2, "score": -5, "last_activity_date": 1528793280, "creation_date": 1528782258, "last_edit_date": 1528783217, "question_id": 50809970, "link": "https://stackoverflow.com/questions/50809970/to-create-map-of-array-of-map-in-golang", "title": "To create map of array of map in golang", "body": "<p>I want to create a json in golang for which I need to first create map of the following:</p>\n\n<pre><code>{\"inputs\": [{\"data\": {\"image\": {\"url\": \"SOME_URL\"}}}]}\n</code></pre>\n\n<p>how to create this map on golang. (for now even hardcoded will also work for me)</p>\n"}, {"tags": ["powershell", "go"], "comments": [{"owner": {"reputation": 6581, "user_id": 137071, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/A1wgH.jpg?s=128&g=1", "display_name": "Remko", "link": "https://stackoverflow.com/users/137071/remko"}, "edited": false, "score": 1, "creation_date": 1528785824, "post_id": 50809752, "comment_id": 88626861, "body": "Just out of interest: why write it in go and not in PowerShell. For the task at hand, PowerShell seems to be the best tool and spawning commandline tools and parsing it&#39;s output is a very unreliable method."}, {"owner": {"reputation": 150, "user_id": 182043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e466994eea3c2a1672564e45aca844d0?s=128&d=identicon&r=PG", "display_name": "gbraad", "link": "https://stackoverflow.com/users/182043/gbraad"}, "reply_to_user": {"reputation": 6581, "user_id": 137071, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/A1wgH.jpg?s=128&g=1", "display_name": "Remko", "link": "https://stackoverflow.com/users/137071/remko"}, "edited": false, "score": 0, "creation_date": 1528797655, "post_id": 50809752, "comment_id": 88633670, "body": "See note 3: it is part of a driver for docker/machine. Sure, no problem with writing it in PowerShell commands ... but the driver has to wrap these commands for higher level interaction using another command. Note: other issues have existed due to parsing, such as <a href=\"https://stackoverflow.com/questions/49765816/same-module-different-casing-why/49788125#49788125\" title=\"same module different casing why\">stackoverflow.com/questions/49765816/&hellip;</a> but this was a choice and several projects rely on this now."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1528798503, "post_id": 50809752, "comment_id": 88634209, "body": "HAve you tried using the <code>bytes.Runes()</code> function? You seem to be using bytes buffers, which are essentially ASCII characters. To interpret them as unicode, just passing them through <a href=\"https://golang.org/pkg/bytes/#Runes\" rel=\"nofollow noreferrer\">the <code>bytes.Rune()</code> func</a> might just fix it"}, {"owner": {"reputation": 18730, "user_id": 2102693, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sD3s8.jpg?s=128&g=1", "display_name": "Bill_Stewart", "link": "https://stackoverflow.com/users/2102693/bill-stewart"}, "edited": false, "score": 0, "creation_date": 1528820067, "post_id": 50809752, "comment_id": 88648394, "body": "Write a text file with your program that contains the PowerShell command you want to execute, and check what encoding it uses."}, {"owner": {"reputation": 150, "user_id": 182043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e466994eea3c2a1672564e45aca844d0?s=128&d=identicon&r=PG", "display_name": "gbraad", "link": "https://stackoverflow.com/users/182043/gbraad"}, "edited": false, "score": 0, "creation_date": 1528844375, "post_id": 50809752, "comment_id": 88658537, "body": "Note 4: Modifying the OutputEncoding had no effect. Setting it to UTF8 or other codepage would result in the same output for Get-VMSwitch."}, {"owner": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "edited": false, "score": 0, "creation_date": 1528849048, "post_id": 50809752, "comment_id": 88659527, "body": "Is &quot;Note 4&quot; in response to my answer? Are you saying that updating <code>[Console]::OutputEncoding</code> as I demonstrated has no effect?"}, {"owner": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "edited": false, "score": 0, "creation_date": 1528852901, "post_id": 50809752, "comment_id": 88660279, "body": "FYI, updated my answer to embed the test string directly into the program and to print out the current value of <code>[Console]::OutputEncoding</code> before printing out the test string. If you could provided the value of that variable on your system, it may help in troubleshooting."}, {"owner": {"reputation": 150, "user_id": 182043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e466994eea3c2a1672564e45aca844d0?s=128&d=identicon&r=PG", "display_name": "gbraad", "link": "https://stackoverflow.com/users/182043/gbraad"}, "edited": false, "score": 0, "creation_date": 1528855080, "post_id": 50809752, "comment_id": 88660718, "body": "It seems to be related to how Non-Interactive mode handles <code>$OutputEncoding</code>. However, when invoked from the Command Prompt as such it works, but not when invoked from <code>exec.Command</code>. Using <code>[Console]::OutputEncoding = [Text.Encoding]::UTF8</code> directly works."}], "answers": [{"comments": [{"owner": {"reputation": 150, "user_id": 182043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e466994eea3c2a1672564e45aca844d0?s=128&d=identicon&r=PG", "display_name": "gbraad", "link": "https://stackoverflow.com/users/182043/gbraad"}, "edited": false, "score": 1, "creation_date": 1528854946, "post_id": 50823931, "comment_id": 88660692, "body": "It seems <code>$OutputEncoding</code> in PowerShell is not correctly read by the cmdlet when using in non-interactive mode. I now did <code>[Console]::OutputEncoding :: [Text.Encoding]::UTF8; (Get-VMSwitch).Name</code> and it yielded the correct result."}], "tags": [], "owner": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "is_accepted": true, "score": 5, "last_activity_date": 1528852788, "last_edit_date": 1528852788, "creation_date": 1528829396, "answer_id": 50823931, "question_id": 50809752, "link": "https://stackoverflow.com/questions/50809752/golang-invoking-powershell-exe-always-returns-ascii-characters/50823931#50823931", "title": "Golang invoking PowerShell.exe always returns ASCII characters", "body": "<p>Man, Powershell is interesting. This was mostly the result of a bunch of trial and error.</p>\n\n<p>Basically, you want to set <code>[Console]::OutputEncoding</code>, not capture it. </p>\n\n<p>However, to clean up after yourself, it doesn't hurt to set it back to it's original value. I haven't fully wrapped my head around it, but the change persists through multiple <code>exec()</code> calls.</p>\n\n<p>Here's an example:</p>\n\n<pre><code>&lt;... everything else is as above ...&gt;\n\nfunc main() {\n        posh := New()\n\n        fmt.Println(\"With encoding change:\")\n        stdout, stderr, err := posh.Execute(\n                \"$test = \\\"Prze\u0142\u0105\u015b\\\"\\n\" +\n                \"$old = [Console]::OutputEncoding\\n\" +\n                \"[Console]::OutputEncoding = [Text.Encoding]::UTF8\\n\" +\n                \"[Console]::OutputEncoding\\n\" +\n                \"$test\\n\" +\n                \"[Console]::OutputEncoding = $old\")\n        fmt.Println(stdout)\n        fmt.Println(stderr)\n        if err != nil {\n                fmt.Println(err)\n        }\n\n        fmt.Println(\"Without encoding change:\")\n        stdout, stderr, err = posh.Execute(\n                \"$test = \\\"Prze\u0142\u0105\u015b\\\"\\n\" +\n                \"[Console]::OutputEncoding\\n\" +\n                \"$test\")\n        fmt.Println(stdout)\n        fmt.Println(stderr)\n        if err != nil {\n                fmt.Println(err)\n        }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ ./exec-powershell.exe\nWith encoding change:\n\n\nBodyName          : utf-8\nEncodingName      : Unicode (UTF-8)\nHeaderName        : utf-8\nWebName           : utf-8\nWindowsCodePage   : 1200\nIsBrowserDisplay  : True\nIsBrowserSave     : True\nIsMailNewsDisplay : True\nIsMailNewsSave    : True\nIsSingleByte      : False\nEncoderFallback   : System.Text.EncoderReplacementFallback\nDecoderFallback   : System.Text.DecoderReplacementFallback\nIsReadOnly        : False\nCodePage          : 65001\n\nPrze\u0142\u0105\u015b\n\n\n\n\nWithout encoding change:\n\n\nIsSingleByte      : True\nBodyName          : IBM437\nEncodingName      : OEM United States\nHeaderName        : IBM437\nWebName           : IBM437\nWindowsCodePage   : 1252\nIsBrowserDisplay  : False\nIsBrowserSave     : False\nIsMailNewsDisplay : False\nIsMailNewsSave    : False\nEncoderFallback   : System.Text.InternalEncoderBestFitFallback\nDecoderFallback   : System.Text.InternalDecoderBestFitFallback\nIsReadOnly        : True\nCodePage          : 437\n\nPrzelas\n</code></pre>\n"}], "owner": {"reputation": 150, "user_id": 182043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e466994eea3c2a1672564e45aca844d0?s=128&d=identicon&r=PG", "display_name": "gbraad", "link": "https://stackoverflow.com/users/182043/gbraad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4322, "favorite_count": 3, "accepted_answer_id": 50823931, "answer_count": 1, "score": 3, "last_activity_date": 1528852788, "creation_date": 1528780959, "question_id": 50809752, "link": "https://stackoverflow.com/questions/50809752/golang-invoking-powershell-exe-always-returns-ascii-characters", "title": "Golang invoking PowerShell.exe always returns ASCII characters", "body": "<p>I am using PowerShell from an application written in Go, but am unable to get it to return non-ASCII characters. At first I used go-powershell, but experience the same issue: <a href=\"https://github.com/gorillalabs/go-powershell/issues/10\" rel=\"nofollow noreferrer\">https://github.com/gorillalabs/go-powershell/issues/10</a> and now using a slightly more basic approach:</p>\n\n<pre><code>package main\n\nimport (\n        \"bytes\"\n        \"fmt\"\n        \"os/exec\"\n)\n\ntype PowerShell struct {\n        powerShell string\n}\n\nfunc New() *PowerShell {\n        ps, _ := exec.LookPath(\"powershell.exe\")\n        return &amp;PowerShell{\n                powerShell: ps,\n        }\n}\n\nfunc (p *PowerShell) Execute(args ...string) (stdOut string, stdErr string, err error) {\n        args = append([]string{\"-NoProfile\", \"-NonInteractive\"}, args...)\n        cmd := exec.Command(p.powerShell, args...)\n\n        var stdout bytes.Buffer\n        var stderr bytes.Buffer\n        cmd.Stdout = &amp;stdout\n        cmd.Stderr = &amp;stderr\n\n        err = cmd.Run()\n        stdOut, stdErr = stdout.String(), stderr.String()\n        return\n}\n\nfunc main() {\n        posh := New()\n        stdout, stderr, err := posh.Execute(\"$OutputEncoding = [Console]::OutputEncoding; (Get-VMSwitch).Name\")\n\n        fmt.Println(stdout)\n        fmt.Println(stderr)\n\n        if err != nil {\n                fmt.Println(err)\n        }\n}\n</code></pre>\n\n<p>but the same happens. Instead of gettting <code>Prze\u0142\u0105\u015b</code>, it returns <code>Przelas</code>. This will result in issues when further in the code a VM is created using this Virtual Switch name. It does not get recognized and errors.</p>\n\n<p>Note: <code>$OutputEncoding = [Console]::OutputEncoding;</code> did not have any effect. It does get changed, but the result remains the same.</p>\n\n<p>Note 2: invoking the same command directly from the command prompt does NOT have issues: <code>powershell.exe -NoProfile -NonInteractive $OutputEncoding = [Console]::OutputEncoding; (Get-VMSwitch).Name\")</code> or even <code>powershell.exe -NoProfile -NonInteractive (Get-VMSwitch).Name\")</code>. In other words, it does this only from Go when using <code>exec.Command</code>.</p>\n\n<p>Note 3: this is for fixing an issue with a virtual machine driver when it comes to the localized names. Yes, it could work with an GUID (<code>.Id</code>) instead, but this issue persists in different parts of the system.</p>\n"}, {"tags": ["go", "emacs"], "answers": [{"comments": [{"owner": {"reputation": 590, "user_id": 9848932, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a484cace64c76f71d3bb1fab9410761?s=128&d=identicon&r=PG&f=1", "display_name": "jdc", "link": "https://stackoverflow.com/users/9848932/jdc"}, "edited": false, "score": 0, "creation_date": 1528758596, "post_id": 50807214, "comment_id": 88620181, "body": "Ah, Lost In Stupid Parenthesis.  Sorry if I missed one."}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 0, "creation_date": 1528819066, "post_id": 50807214, "comment_id": 88647888, "body": "I got a weird &quot;wrong argument type: commandp, compile&quot; I was looking for whether I had a typo for command as commandp, but I think that is the name of a variable it&#39;s looking for."}, {"owner": {"reputation": 590, "user_id": 9848932, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a484cace64c76f71d3bb1fab9410761?s=128&d=identicon&r=PG&f=1", "display_name": "jdc", "link": "https://stackoverflow.com/users/9848932/jdc"}, "reply_to_user": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "edited": false, "score": 1, "creation_date": 1528819613, "post_id": 50807214, "comment_id": 88648169, "body": "Maybe this will help.  <a href=\"https://stackoverflow.com/questions/1250846/wrong-type-argument-commandp-error-when-binding-a-lambda-to-a-key\" title=\"wrong type argument commandp error when binding a lambda to a key\">stackoverflow.com/questions/1250846/&hellip;</a>"}, {"owner": {"reputation": 8261, "user_id": 245173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36c6145047e62b215306e1a3e6d6800f?s=128&d=identicon&r=PG", "display_name": "jpkotta", "link": "https://stackoverflow.com/users/245173/jpkotta"}, "edited": false, "score": 0, "creation_date": 1528840475, "post_id": 50807214, "comment_id": 88657464, "body": "<code>compile</code> is a built in command.  You should probably name your new command <code>go-compile</code> or something.  But really all you need to do is set <code>compile-command</code> variable, look at its documentation.  Also, I use the package <code>multi-compile</code> to set the compile command based on major mode."}], "tags": [], "owner": {"reputation": 590, "user_id": 9848932, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a484cace64c76f71d3bb1fab9410761?s=128&d=identicon&r=PG&f=1", "display_name": "jdc", "link": "https://stackoverflow.com/users/9848932/jdc"}, "is_accepted": false, "score": 1, "last_activity_date": 1528758421, "creation_date": 1528758421, "answer_id": 50807214, "question_id": 50805816, "link": "https://stackoverflow.com/questions/50805816/emacs-compile-ignoring-compile-command-variable/50807214#50807214", "title": "Emacs compile ignoring compile-command variable", "body": "<p>This should work:</p>\n\n<pre><code>(add-hook 'go-mode-hook (lambda ()\n  (defun compile ()\n    (setq compile-command \"go build -v &amp;&amp; go test -v &amp;&amp; go vet &amp;&amp; golint\"))\n  (define-key go-mode-map (kbd \"C-c C-c\") 'compile)))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8261, "user_id": 245173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/36c6145047e62b215306e1a3e6d6800f?s=128&d=identicon&r=PG", "display_name": "jpkotta", "link": "https://stackoverflow.com/users/245173/jpkotta"}, "is_accepted": true, "score": 2, "last_activity_date": 1528841341, "last_edit_date": 1528841341, "creation_date": 1528841010, "answer_id": 50826468, "question_id": 50805816, "link": "https://stackoverflow.com/questions/50805816/emacs-compile-ignoring-compile-command-variable/50826468#50826468", "title": "Emacs compile ignoring compile-command variable", "body": "<p>Your code works for me.  The only thing missing is an <code>add-hook</code>.  You probably want to set the <code>compile-command</code> to be buffer-local as well.</p>\n\n<p>Here's my code that definitely works:</p>\n\n<pre><code>(defun jpk/go-mode-hook ()\n  (make-local-variable 'compile-command)\n  (setq compile-command \"go build -v\")\n  (define-key go-mode-map (kbd \"C-c C-c\") #'compile))\n(add-hook 'go-mode-hook #'jpk/go-mode-hook)\n</code></pre>\n\n<p>I strongly recommend against redefining <code>compile</code> like in @jdc's answer.  If you must define your own command, do it with a different name.</p>\n\n<p>You may want to check out the <a href=\"https://github.com/ReanGD/emacs-multi-compile\" rel=\"nofollow noreferrer\">multi-compile</a> package, it allows you to set multiple compile commands (optionally major-mode specific).</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 85, "favorite_count": 0, "accepted_answer_id": 50826468, "answer_count": 2, "score": 0, "last_activity_date": 1528841341, "creation_date": 1528750244, "last_edit_date": 1528756454, "question_id": 50805816, "link": "https://stackoverflow.com/questions/50805816/emacs-compile-ignoring-compile-command-variable", "title": "Emacs compile ignoring compile-command variable", "body": "<p>Initially, I had the following defined in my .emacs.d/init.el</p>\n\n<pre><code>(defun go-mode-setup ()\n  (setq compile-command \"go build -v &amp;&amp; go test -v &amp;&amp; go vet &amp;&amp; golint\")\n  (define-key go-mode-map (kbd \"C-c C-c\") 'compile)\n  )\n</code></pre>\n\n<p>While in go-mode, everything else seemed to work fine, but his did not seem to set or respect my C-c C-c command, instead producing</p>\n\n<pre><code>C-c C-c is undefined.\n</code></pre>\n\n<p>So, I added an explicit hook:</p>\n\n<pre><code>(add-hook 'go-mode-hook (lambda () (define-key go-mode-map (kbd \"C-c C-c\") 'compile)))\n</code></pre>\n\n<p>This now respects my C-c C-c kbd shortcut, but still ignores the compile-command I set.  Unfortunately, it seems to compile the entire folder rather than just the main.go file I am working on.</p>\n\n<pre><code>Compile command: make -k \n</code></pre>\n\n<p>How can I set C-c C-c to use the compile-command I set?</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1528749930, "post_id": 50805724, "comment_id": 88617490, "body": "Your version doesn&#39;t use concurrency. So it would work, but sequentially. Which also means that all your <code>wg</code> calls are unnecessary."}, {"owner": {"reputation": 484, "user_id": 5826540, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0ea9d7911377881cf7a69ce177143cd9?s=128&d=identicon&r=PG&f=1", "display_name": "nagrom97", "link": "https://stackoverflow.com/users/5826540/nagrom97"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1528786685, "post_id": 50805724, "comment_id": 88627340, "body": "Thanks, I deleted the Go keyword for the function though. Editing a SO question on a tablet is the last thing Ill do ever again."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1528791371, "post_id": 50805724, "comment_id": 88629890, "body": "The current version doesn&#39;t wait for <code>compress</code> to finish before calling <code>wg.Done()</code>"}, {"owner": {"reputation": 484, "user_id": 5826540, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0ea9d7911377881cf7a69ce177143cd9?s=128&d=identicon&r=PG&f=1", "display_name": "nagrom97", "link": "https://stackoverflow.com/users/5826540/nagrom97"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1528792063, "post_id": 50805724, "comment_id": 88630258, "body": "Cheers, much appreciated :)"}], "answers": [{"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1528751300, "post_id": 50805901, "comment_id": 88618026, "body": "Also worth pointing out that it would be insufficient to use something like <code>go func() { compress(file); wg.Done() }()</code>, i.e. without the <code>filename</code> argument. This is because range loops reuse the iteration variable so the <code>file</code> gets overwritten on each iteration and if you reference it inside a goroutine closure (<code>go func() { file }()</code>) then its value will be from the last executed iteration <i>at the time</i> of the var&#39;s evaluation. On the other hand when you pass it as an argument, a copy is created and so <code>filename</code> will always have the value of the iteration that called the goroutine."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 4, "last_activity_date": 1528750633, "creation_date": 1528750633, "answer_id": 50805901, "question_id": 50805724, "link": "https://stackoverflow.com/questions/50805724/concurrency-example-confusion/50805901#50805901", "title": "Concurrency example confusion", "body": "<p>If you just execute:</p>\n\n<pre><code>compress(file)\n</code></pre>\n\n<p>That gets executed in the same goroutine, so until that call finishes, you won't be doing anything else.</p>\n\n<p>So if you want to process in parallel, then you need to launch a new goroutine by using the <code>go</code> keyword.</p>\n\n<p>If you do this:</p>\n\n<pre><code>go compress(file)\n</code></pre>\n\n<p>Then <em>it will</em> launch a new goroutine for compressing each file.</p>\n\n<p>But, as soon as the <code>main</code> function launches all goroutines, it will end execution (it will not wait for all goroutines to finish).</p>\n\n<p>That's why they included the <code>wg</code> calls.</p>\n\n<p>Since the <code>compress</code> function does not receive a <code>WaitGroup</code> to call the <code>Done</code> over it, they implemented that inline function in order to call <code>wg.Done()</code> right after that goroutine finishes the compression over that file.</p>\n\n<p>That's the reason for the:</p>\n\n<pre><code>go func(filename string) {\n    compress(filename)\n    wg.Done()\n}(file)\n</code></pre>\n"}], "owner": {"reputation": 484, "user_id": 5826540, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0ea9d7911377881cf7a69ce177143cd9?s=128&d=identicon&r=PG&f=1", "display_name": "nagrom97", "link": "https://stackoverflow.com/users/5826540/nagrom97"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "accepted_answer_id": 50805901, "answer_count": 1, "score": 0, "last_activity_date": 1528786572, "creation_date": 1528749828, "last_edit_date": 1528786572, "question_id": 50805724, "link": "https://stackoverflow.com/questions/50805724/concurrency-example-confusion", "title": "Concurrency example confusion", "body": "<p>I\u2019m studying concurrency in more depth with Go. A book I am reading gives the following example, which basically compresses files from command line argument(s).</p>\n\n<pre><code> package main\n\n import (\n  \"compress/gzip\"\n  \"io\"\n  \"os\"\n )\n\n func main() {\n\n     for _, file := range os.Args[1:] {\n        compress(file)\n     }\n\n }\n\n\n func compress(filename string) error {\n\n     in, err := os.Open(filename)\n\n     if err != nil {\n      return err\n     }\n\n     defer in.Close()\n\n     out, err := os.Create(filename + \".gz\")\n\n     if err != nil {\n       return err\n     }\n\n     defer out.Close()\n\n     gzout := gzip.NewWriter(out)\n\n     _, err = io.Copy(gzout, in)\n\n     gzout.Close()\n\n     return err\n}\n</code></pre>\n\n<p>The book then explains that if you wanted to process a few hundred files, keeping it like this would definitely be slower than if you were to utilise goroutines, so the following modification is made to the <code>main()</code> function in order to use them: </p>\n\n<pre><code>var wg sync.WaitGroup \nvar i int = -1\nvar file string\nfor i, file = range os.Args[1:] {\n    wg.Add(1)\n    go func(filename string) {\n       compress(filename)\n       wg.Done()\n     }(file)\n }\n wg.Wait()\n fmt.Printf(\"Compressed %d files\\n\", i+1)\n</code></pre>\n\n<p>It is then noted that the \u201ctrickery\u201d with regard to the inline function definition and its parameter (file name), is necessary \u201cbecause we are executing goroutines in a for loop\u201d.</p>\n\n<p>I guess what I don\u2019t understand is why the above inline function is required to get this working, couldn\u2019t the following be used instead, or am I missing a trick?</p>\n\n<pre><code>for i, file = range os.Args[1:] {\n    wg.Add(1)\n\n    go compress(file)\n\n    wg.Done()\n\n }\n wg.Wait()\n fmt.Printf(\"Compressed %d files\\n\", i+1)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 6, "creation_date": 1528745550, "post_id": 50804746, "comment_id": 88615628, "body": "Go projects must be in <code>GOPATH</code> in order to use the go tools."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1528745555, "post_id": 50804746, "comment_id": 88615631, "body": "You <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">write Go code</a> inside the <code>GOPATH&#47;src</code>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1528746854, "post_id": 50804746, "comment_id": 88616165, "body": "Why are you fighting the tools?"}, {"owner": {"reputation": 147776, "user_id": 3731501, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e4783dfa8ec98c884e61d29f2192ac97?s=128&d=identicon&r=PG&f=1", "display_name": "Estus Flask", "link": "https://stackoverflow.com/users/3731501/estus-flask"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 18, "creation_date": 1528747444, "post_id": 50804746, "comment_id": 88616440, "body": "Basic questions tend to be heavily downvoted these days, even properly asked ones (and not only mine). Seems like answering same newbie questions again and again made the communities too toxic and snobbish. @Flimzy I didn&#39;t embrace them yet and it&#39;s still hard to believe that tools are that restricting. It isn&#39;t like that with other package managers I have experience with."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1528747616, "post_id": 50804746, "comment_id": 88616511, "body": "This isn&#39;t being downvoted for being basic. Rather, it&#39;s being downvoted for not showing research effort. We get frequent questions about people foolishly trying to fight the Go tools for no reason."}, {"owner": {"reputation": 147776, "user_id": 3731501, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e4783dfa8ec98c884e61d29f2192ac97?s=128&d=identicon&r=PG&f=1", "display_name": "Estus Flask", "link": "https://stackoverflow.com/users/3731501/estus-flask"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 7, "creation_date": 1528749242, "post_id": 50804746, "comment_id": 88617196, "body": "@Flimzy IMO every single basic question shows a lack of research because it can be solved by studying some read. It wasn&#39;t obvious for me if it&#39;s <code>dep</code> or Go requirement, I&#39;m currently focused on code rather than infrastructure and didn&#39;t have a chance to know that GOPATH can contain multiple paths. Using a drive of my choice to store some projects can hardly be considered &#39;no reason&#39;. From my understanding, the solution in my case is to add <code>D:\\projects</code> to GOPATH, not to move them to current one. IMO, this is more like &#39;figuring out the right solution&#39;, not &#39;fighting the tools&#39;."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528749374, "post_id": 50804746, "comment_id": 88617249, "body": "@estus GOPATH should not contain multiple paths, just move your project to <code>GOPATH&#47;src</code>."}, {"owner": {"reputation": 147776, "user_id": 3731501, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e4783dfa8ec98c884e61d29f2192ac97?s=128&d=identicon&r=PG&f=1", "display_name": "Estus Flask", "link": "https://stackoverflow.com/users/3731501/estus-flask"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1528749644, "post_id": 50804746, "comment_id": 88617390, "body": "@mkopriva Why is that? The documentation suggests this as an option. And I&#39;d prefer to keep D:\\projects for my own projects, not for every Go app that will be built on this system."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528749697, "post_id": 50804746, "comment_id": 88617410, "body": "@estus I don&#39;t think the documentation says that, can you please point me to it."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1528749855, "post_id": 50804746, "comment_id": 88617469, "body": "@mkopriva: GOPATH takes a path separator, and it&#39;s perfectly valid to contain multiple values, just like PATH. <a href=\"https://golang.org/cmd/go/#hdr-GOPATH_environment_variable\" rel=\"nofollow noreferrer\">golang.org/cmd/go/#hdr-GOPATH_environment_variable</a>. This is however not highly recommended, as it tends to cause more confusion than it&#39;s worth, but it is there for advanced usage."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528750194, "post_id": 50804746, "comment_id": 88617590, "body": "Thanks @JimB, I thought this whole time it actually wasn&#39;t allowed, not just recommended against. Ignore my previous comment estus."}, {"owner": {"reputation": 463, "user_id": 1334774, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/7d88edc75310ad969e13e15238191979?s=128&d=identicon&r=PG", "display_name": "Bocky", "link": "https://stackoverflow.com/users/1334774/bocky"}, "edited": false, "score": 4, "creation_date": 1553613641, "post_id": 50804746, "comment_id": 97445185, "body": "I don&#39;t think this question is basic to a fault. You guys say don&#39;t fight the tools, but how much sense does it make have all your go code in one location, albeit seperated by folders? My practice has been to have a project folder holding a few repos of microservices like UI &amp; backend systems. Intuitively it doesn&#39;t make sense for me to have go code in the GOPATH/src while all the other code exists outside GOPATH. You say don&#39;t fight the tools, I say you are getting forced to have this habit driven by Go."}, {"owner": {"reputation": 1041, "user_id": 5419599, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/SbCyV.png?s=128&g=1", "display_name": "Wildcard", "link": "https://stackoverflow.com/users/5419599/wildcard"}, "edited": false, "score": 2, "creation_date": 1558205943, "post_id": 50804746, "comment_id": 99026645, "body": "I recommend reading up on \u201cGo modules\u201d for the modern solution to this problem."}, {"owner": {"reputation": 4657, "user_id": 102699, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/81df87e0d3e269d6fa6a17c6914fd656?s=128&d=identicon&r=PG", "display_name": "MikeSchinkel", "link": "https://stackoverflow.com/users/102699/mikeschinkel"}, "reply_to_user": {"reputation": 1041, "user_id": 5419599, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/SbCyV.png?s=128&g=1", "display_name": "Wildcard", "link": "https://stackoverflow.com/users/5419599/wildcard"}, "edited": false, "score": 1, "creation_date": 1618540780, "post_id": 50804746, "comment_id": 118637903, "body": "What @Wildcard wrote. Go modules solves this problem now and has quickly become the defacto standard for new Go projects:  <a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">blog.golang.org/using-go-modules</a>"}], "answers": [{"comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 3638, "user_id": 2884309, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/T1Mo3.jpg?s=128&g=1", "display_name": "Ivan Aracki", "link": "https://stackoverflow.com/users/2884309/ivan-aracki"}, "edited": false, "score": 0, "creation_date": 1550170327, "post_id": 50805065, "comment_id": 96181618, "body": "@IvanAracki With Go modules there is no need for dep anymore, so what is your comment addressing?"}, {"owner": {"reputation": 3638, "user_id": 2884309, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/T1Mo3.jpg?s=128&g=1", "display_name": "Ivan Aracki", "link": "https://stackoverflow.com/users/2884309/ivan-aracki"}, "edited": false, "score": 0, "creation_date": 1550174875, "post_id": 50805065, "comment_id": 96183481, "body": "projects could be easily moved outside of $GOPATH"}, {"owner": {"reputation": 3289, "user_id": 2480362, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/EYdoE.jpg?s=128&g=1", "display_name": "Steve Shipway", "link": "https://stackoverflow.com/users/2480362/steve-shipway"}, "edited": false, "score": 0, "creation_date": 1556062589, "post_id": 50805065, "comment_id": 98307714, "body": "Many many softlinks, and wrapper scripts.  That&#39;s how I had to do it in order to keep all my source in the correct place rather than split the go part into another location."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 10, "last_activity_date": 1528746646, "creation_date": 1528746646, "answer_id": 50805065, "question_id": 50804746, "link": "https://stackoverflow.com/questions/50804746/is-not-within-a-known-gopath-src-error-on-dep-init/50805065#50805065", "title": "&#39;is not within a known GOPATH/src&#39; error on dep init", "body": "<blockquote>\n  <p>How can I use dep without moving Go projects to %GOPATH%/src?</p>\n</blockquote>\n\n<p>Not at all.</p>\n"}, {"comments": [{"owner": {"reputation": 147776, "user_id": 3731501, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e4783dfa8ec98c884e61d29f2192ac97?s=128&d=identicon&r=PG&f=1", "display_name": "Estus Flask", "link": "https://stackoverflow.com/users/3731501/estus-flask"}, "edited": false, "score": 1, "creation_date": 1528749376, "post_id": 50805238, "comment_id": 88617250, "body": "Thanks. Is it safe to assume that GOPATH paths are completely independent, and there&#39;s no chance that a project located at one path will accidentally use packages from another path?"}, {"owner": {"reputation": 1227, "user_id": 418772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812e307892de3240c2b50a3e66295f84?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/418772/rob"}, "reply_to_user": {"reputation": 147776, "user_id": 3731501, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e4783dfa8ec98c884e61d29f2192ac97?s=128&d=identicon&r=PG&f=1", "display_name": "Estus Flask", "link": "https://stackoverflow.com/users/3731501/estus-flask"}, "edited": false, "score": 2, "creation_date": 1528749509, "post_id": 50805238, "comment_id": 88617318, "body": "Correct.  If you work on two completely different projects that you switch between, and have no dependencies on each other, then you want two independent GOPATH variables.  Before vendoring was a thing, you really needed to do this to deal with versioning.  Now, you mostly only do &quot;go get&quot; on toplevel projects and vendor everything that they depend on."}, {"owner": {"reputation": 4733, "user_id": 922445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a469120d35647d9aa50646cb4d778c71?s=128&d=identicon&r=PG&f=1", "display_name": "Nulik", "link": "https://stackoverflow.com/users/922445/nulik"}, "edited": false, "score": 0, "creation_date": 1595462941, "post_id": 50805238, "comment_id": 111486610, "body": "wasn&#39;t GOPATH obsolete thing after go <code>dep</code>  was released? I heard you no longer need to set GOPATH"}, {"owner": {"reputation": 1227, "user_id": 418772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812e307892de3240c2b50a3e66295f84?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/418772/rob"}, "edited": false, "score": 0, "creation_date": 1595465573, "post_id": 50805238, "comment_id": 111487214, "body": "people are migrating to modules, but there is way more to a real build than just the go compiler.  chances are, if you do a large go program, you still use GOROOT and GOPATH.  Code is often still structured to do checkouts into $GOPATH/src/${gitsite}/${authoraccount}/${project}."}, {"owner": {"reputation": 1227, "user_id": 418772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812e307892de3240c2b50a3e66295f84?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/418772/rob"}, "edited": false, "score": 0, "creation_date": 1595465675, "post_id": 50805238, "comment_id": 111487235, "body": "this is particularly true (still using GOPATH) if you have two repos, where you are actively working on BOTH of them at the same time."}, {"owner": {"reputation": 1227, "user_id": 418772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812e307892de3240c2b50a3e66295f84?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/418772/rob"}, "edited": false, "score": 0, "creation_date": 1595465823, "post_id": 50805238, "comment_id": 111487273, "body": "and it still stands that generally, your dependents are stable, and in ./vendor.  But you might reference devs that you are actually working on, in which case, GOPATH gives you some structure so that you can write things like bash scripts.  etc: reference a test TLS cert that exists under a repo, or a yaml file."}, {"owner": {"reputation": 4657, "user_id": 102699, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/81df87e0d3e269d6fa6a17c6914fd656?s=128&d=identicon&r=PG", "display_name": "MikeSchinkel", "link": "https://stackoverflow.com/users/102699/mikeschinkel"}, "edited": false, "score": 0, "creation_date": 1618540498, "post_id": 50805238, "comment_id": 118637858, "body": "Downvoted because while the answer explained the problem it did not provide a direct solution. Turgut Kalfaoglu&#39;s answer did instead."}], "tags": [], "owner": {"reputation": 1227, "user_id": 418772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812e307892de3240c2b50a3e66295f84?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/418772/rob"}, "is_accepted": true, "score": 10, "last_activity_date": 1566148261, "last_edit_date": 1566148261, "creation_date": 1528747441, "answer_id": 50805238, "question_id": 50804746, "link": "https://stackoverflow.com/questions/50804746/is-not-within-a-known-gopath-src-error-on-dep-init/50805238#50805238", "title": "&#39;is not within a known GOPATH/src&#39; error on dep init", "body": "<p>Go makes this choice so that there is nothing like a CLASSPATH (ie: Java) to deal with.  You specify a $GOPATH that has a consistent src tree inside of it.  If your repo makes references to particular git commits (rather than the ones checked out into $GOPATH/src/github.com/$githubUser/$githubProjectName), then those will be in the ./vendor directory of your project.</p>\n\n<p>If you have a different Go project that uses a completely different set of checkouts, due to versioning issues, then you can have multiple $GOPATH values to deal with that.</p>\n"}, {"tags": [], "owner": {"reputation": 1967, "user_id": 1031871, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7g8bJ.jpg?s=128&g=1", "display_name": "Arun Gopalpuri", "link": "https://stackoverflow.com/users/1031871/arun-gopalpuri"}, "is_accepted": false, "score": 5, "last_activity_date": 1558162348, "last_edit_date": 1558162348, "creation_date": 1554174326, "answer_id": 55466401, "question_id": 50804746, "link": "https://stackoverflow.com/questions/50804746/is-not-within-a-known-gopath-src-error-on-dep-init/55466401#55466401", "title": "&#39;is not within a known GOPATH/src&#39; error on dep init", "body": "<p>what does <code>go env</code> command say your <strong>GOPATH</strong> is? Set GOPATH for your environment as per this <a href=\"https://github.com/golang/go/wiki/SettingGOPATH\" rel=\"nofollow noreferrer\">doc</a></p>\n"}, {"comments": [{"owner": {"reputation": 147776, "user_id": 3731501, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e4783dfa8ec98c884e61d29f2192ac97?s=128&d=identicon&r=PG&f=1", "display_name": "Estus Flask", "link": "https://stackoverflow.com/users/3731501/estus-flask"}, "edited": false, "score": 2, "creation_date": 1565689193, "post_id": 57472577, "comment_id": 101421944, "body": "I understand that, the question was how to avoid keeping source files in unwanted location."}, {"owner": {"reputation": 4657, "user_id": 102699, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/81df87e0d3e269d6fa6a17c6914fd656?s=128&d=identicon&r=PG", "display_name": "MikeSchinkel", "link": "https://stackoverflow.com/users/102699/mikeschinkel"}, "edited": false, "score": 0, "creation_date": 1618540579, "post_id": 57472577, "comment_id": 118637873, "body": "Thanks for this answer.  I was the only one that explained how to solve the problem rather than just saying why you can&#39;t keep them in the unwanted location."}], "tags": [], "owner": {"reputation": 71, "user_id": 6240858, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152787493854412/picture?type=large", "display_name": "Turgut Kalfaoglu", "link": "https://stackoverflow.com/users/6240858/turgut-kalfaoglu"}, "is_accepted": false, "score": 6, "last_activity_date": 1565679404, "creation_date": 1565679404, "answer_id": 57472577, "question_id": 50804746, "link": "https://stackoverflow.com/questions/50804746/is-not-within-a-known-gopath-src-error-on-dep-init/57472577#57472577", "title": "&#39;is not within a known GOPATH/src&#39; error on dep init", "body": "<p>Go projects require that your project is within its path..\nSo first do a \n<code>$ go env</code>\nto find out where that is. Lets say it says <strong>/home/turgut/go</strong>\nmove the project that you downloaded that needs the dep to:\n<strong>/home/turgut/go/src/myproject</strong>\nthen <code>cd /home/turgut/go/src/myproject</code>\nand try the \n<code>dep ensure</code>\ncommand now.</p>\n"}], "owner": {"reputation": 147776, "user_id": 3731501, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e4783dfa8ec98c884e61d29f2192ac97?s=128&d=identicon&r=PG&f=1", "display_name": "Estus Flask", "link": "https://stackoverflow.com/users/3731501/estus-flask"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 24213, "favorite_count": 2, "accepted_answer_id": 50805238, "answer_count": 4, "score": 31, "last_activity_date": 1612917837, "creation_date": 1528745143, "question_id": 50804746, "link": "https://stackoverflow.com/questions/50804746/is-not-within-a-known-gopath-src-error-on-dep-init", "title": "&#39;is not within a known GOPATH/src&#39; error on dep init", "body": "<p>When I run <code>dep init</code> in project folder, the error occurs:</p>\n\n<blockquote>\n  <p>init failed: unable to detect the containing GOPATH: D:\\projects\\foo is not within a known GOPATH/src</p>\n</blockquote>\n\n<p>My projects are located on another drive and not <code>%GOPATH%/src</code> (i.e.  <code>%USERPROFILE%\\go\\src</code>).</p>\n\n<p>It's a known error but it's unclear what is the solution.</p>\n\n<p>How can I use <code>dep</code> without moving Go projects to <code>%GOPATH%/src</code>?</p>\n"}, {"tags": ["oop", "go", "design-patterns", "sdk"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1528744686, "post_id": 50804385, "comment_id": 88615272, "body": "First and foremost, this question is entirely opinion-based, so off-topic for SO. Second, your function is unexported, so it is not part of your SDK. Third, it is highly unusual for a web API SDK to take a <code>http.Request</code> - that&#39;s not an SDK, that&#39;s just a thin wrapper around <code>net&#47;http</code>."}, {"owner": {"reputation": 43, "user_id": 9926771, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QGWaYtAg-Ac/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq343WdK4bJuFQuoDltYh6Z5olOwQg/mo/photo.jpg?sz=128", "display_name": "Riaru Neimu", "link": "https://stackoverflow.com/users/9926771/riaru-neimu"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1528751126, "post_id": 50804385, "comment_id": 88617967, "body": "I would like to know the different options I have to form my opinions about the topic, if that makes sense."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1528754476, "post_id": 50804385, "comment_id": 88619130, "body": "@RiaruNeimu it makes sense but on stackoverflow opinion based questions are offtopic, your particular question is a better fit for <a href=\"https://softwareengineering.stackexchange.com/\">softwareengineering.stackexchange.com</a> I believe."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 9926771, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QGWaYtAg-Ac/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq343WdK4bJuFQuoDltYh6Z5olOwQg/mo/photo.jpg?sz=128", "display_name": "Riaru Neimu", "link": "https://stackoverflow.com/users/9926771/riaru-neimu"}, "edited": false, "score": 0, "creation_date": 1528744857, "post_id": 50804609, "comment_id": 88615341, "body": "Thanks for the help on how to structure my processes better. Another thing I was wondering is how I should be interacting with different types of objects I am requesting. Supposing I want to create a generic API service handler that can handle different responses for example."}, {"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "reply_to_user": {"reputation": 43, "user_id": 9926771, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QGWaYtAg-Ac/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq343WdK4bJuFQuoDltYh6Z5olOwQg/mo/photo.jpg?sz=128", "display_name": "Riaru Neimu", "link": "https://stackoverflow.com/users/9926771/riaru-neimu"}, "edited": false, "score": 0, "creation_date": 1528744912, "post_id": 50804609, "comment_id": 88615364, "body": "Go addresses this through &quot;Interfaces&quot; if you google go interfaces there are many amazing blogs and tutorials <a href=\"https://blog.chewxy.com/2018/03/18/golang-interfaces/\" rel=\"nofollow noreferrer\">blog.chewxy.com/2018/03/18/golang-interfaces</a>, <a href=\"https://medium.com/golangspec/interfaces-in-go-part-i-4ae53a97479c\" rel=\"nofollow noreferrer\">medium.com/golangspec/interfaces-in-go-part-i-4ae53a97479c</a>"}], "tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": false, "score": 1, "last_activity_date": 1528744464, "creation_date": 1528744464, "answer_id": 50804609, "question_id": 50804385, "link": "https://stackoverflow.com/questions/50804385/golang-what-to-return-when-building-an-sdk-to-interact-with-a-web-api/50804609#50804609", "title": "Golang: What to return when building an SDK to interact with a Web API?", "body": "<p>If you subscribe to <a href=\"https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html\" rel=\"nofollow noreferrer\">\"Clean Architecture\"</a> or <a href=\"http://fideloper.com/hexagonal-architecture\" rel=\"nofollow noreferrer\">\"Hexagonal Architecture\"</a> <code>runRequest</code> should return something from your domain.  Ie what are you actually requesting? (what's the name of the resource? Page? Car? Account?)</p>\n\n<p>I would argue the example you posted is the inverse of Clean Architecture.  It shows the protocols and technologies and is asking what is optimal when Clean Architecture suggests that the transport protocols are an implementation detail.  Focusing on your domain (ie what you're fetching and the operatations you allow performed on them) will help to decouple them from your implementation or transport protocols.</p>\n\n<p>For example pretend your request is for a User, and associated Account, and Pages belonging to that user.  Focusing on their relationships </p>\n\n<p>ie User.Accounts() or Account.Pages() is a nice trick to create more decoupled software.  What if you're offering a GRPC connection? What if you want to support multiple return types? JSON, XML, Protobuf?</p>\n\n<p>Clean architecture addresses this by focusing on the domain objects in the first cirlce, and then then the encoding in outer circle.  This means the inner circle, knows nothing about the encodings, (ie the encodings are dependent on your domain objects but your domain objects aren't dependent on the encodings)</p>\n\n<p>If your function above is requesting an account</p>\n\n<pre><code>type Account struct {\n   Name string\n   ID string\n   Location string\n}\n</code></pre>\n\n<p>Then there would be another layer that knows how to encode the account:</p>\n\n<pre><code>type JSONAccount struct {\n    Account\n}\n\nfunc (ja JSONAccount) Encode() ([]byte, error) {\n   return json.Marshal(ja)\n}\n</code></pre>\n\n<p>Your <code>runRequest</code> function could operate on an <a href=\"https://gobyexample.com/interfaces\" rel=\"nofollow noreferrer\">interface</a> </p>\n\n<pre><code>type Encoder interface {\n   Encode() ([]byte, error)\n}\n</code></pre>\n\n<p>Now you could support multiple different encodings for your return types, and expose them as a flag to the caller.  Since your function depends on an interface it will be able to operate or return multiple different data encoders as long as they fulfill the interface!!</p>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1528752224, "post_id": 50804780, "comment_id": 88618362, "body": "But note that this really isn&#39;t an SDK; this is a completely generic REST request helper for absolutely any JSON REST API."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1528754042, "post_id": 50804780, "comment_id": 88618996, "body": "I agree @Adrian, my intention was only to provide an example of what I think is a more idiomatic api for the given function, especially when compared to the <code>map[string]interface{}</code> approach."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1528745345, "creation_date": 1528745345, "answer_id": 50804780, "question_id": 50804385, "link": "https://stackoverflow.com/questions/50804385/golang-what-to-return-when-building-an-sdk-to-interact-with-a-web-api/50804780#50804780", "title": "Golang: What to return when building an SDK to interact with a Web API?", "body": "<p>For this simple example you can use the same approach that <code>json.Unmarshal</code> uses. That is, your function takes a pointer to a value into which you want to unmarshal the response's body.</p>\n\n<pre><code>func RunRequest(request *http.Request, dst interface{}) error {\n    resp, err := http.DefaultClient.Do(request)\n    if err != nil {\n        return err\n    }\n    defer resp.Body.Close()\n\n    return json.NewDecoder(resp.Body).Decode(dst)\n}\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 9926771, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QGWaYtAg-Ac/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq343WdK4bJuFQuoDltYh6Z5olOwQg/mo/photo.jpg?sz=128", "display_name": "Riaru Neimu", "link": "https://stackoverflow.com/users/9926771/riaru-neimu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "accepted_answer_id": 50804780, "answer_count": 2, "score": 2, "last_activity_date": 1528745345, "creation_date": 1528743464, "last_edit_date": 1528743725, "question_id": 50804385, "link": "https://stackoverflow.com/questions/50804385/golang-what-to-return-when-building-an-sdk-to-interact-with-a-web-api", "title": "Golang: What to return when building an SDK to interact with a Web API?", "body": "<p>I'm building an SDK for a web application using Go.</p>\n\n<p>I was wondering what the best form of returning data to users of the SDK would be.</p>\n\n<p>For example, below is a function that takes in an http.Request object. What is the preferred object/struct that should be returned from this function?</p>\n\n<pre><code>func runRequest(request *http.Request) map[string]interface{} {\n    resp, err := http.DefaultClient.Do(request)\n    //handle error\n    defer resp.Body.Close()\n\n    body, err := ioutil.ReadAll(resp.Body)\n    var data map[string]interface{}\n    err2 := json.Unmarshal([]byte(body), &amp;data)\n    //handle error\n\n    return data\n}\n</code></pre>\n"}, {"tags": ["opengl", "go", "framebuffer"], "comments": [{"owner": {"reputation": 138010, "user_id": 5577765, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LoGpC.jpg?s=128&g=1", "display_name": "Rabbid76", "link": "https://stackoverflow.com/users/5577765/rabbid76"}, "edited": false, "score": 0, "creation_date": 1528753395, "post_id": 50804355, "comment_id": 88618798, "body": "That won&#39;t solve the issue, but in case of <code>*att.textureID &gt; 0</code>, the setting of the texture parameters (<code>gl.TexParameteri</code>) and the specification of the texture image (<code>gl.TexImage2D</code>) is superfluous, because it has been done already. (except the parameters would change). In your case you can generate the textures once, before you call <code>attachFramebufferTextures</code>"}, {"owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "reply_to_user": {"reputation": 138010, "user_id": 5577765, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LoGpC.jpg?s=128&g=1", "display_name": "Rabbid76", "link": "https://stackoverflow.com/users/5577765/rabbid76"}, "edited": false, "score": 0, "creation_date": 1528755461, "post_id": 50804355, "comment_id": 88619459, "body": "@Rabbid76 That is true, thank you. I&#39;ve updated the code from my question to circumvent this."}], "owner": {"reputation": 906, "user_id": 4214582, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/GRB3X.png?s=128&g=1", "display_name": "Fanus du Toit", "link": "https://stackoverflow.com/users/4214582/fanus-du-toit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 172, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1528802224, "creation_date": 1528743336, "last_edit_date": 1528802224, "question_id": 50804355, "link": "https://stackoverflow.com/questions/50804355/creating-more-than-one-framebuffer", "title": "Creating more than one framebuffer", "body": "<p>I've been able to create a single framebuffer and render it to a texture. However when I try to create another one I start getting very strange results.</p>\n\n<p>I've learned that generating a framebuffer first and then it's textures should give me the correct results. However in my case I have a texture that is \"shared\" between the first and second framebuffer. See code:</p>\n\n<pre><code>func (o *OpenGL) Init() {\n    o.opaqueFBO = newFramebuffer()\n    o.transparentFBO = newFramebuffer()\n\n    // OPAQUE FBO\n    gl.BindFramebuffer(gl.FRAMEBUFFER, o.opaqueFBO)\n    opaqueFBOAttachments := []attachment{\n        attachment{&amp;o.opaqueTex0, gl.RGBA, gl.RGBA, gl.FLOAT, gl.COLOR_ATTACHMENT0},\n        attachment{&amp;o.sharedDepthBuffer, gl.DEPTH_COMPONENT, gl.DEPTH_COMPONENT, gl.FLOAT, gl.DEPTH_ATTACHMENT},\n    }\n    o.attachFramebufferTextures(o.opaqueFBO, opaqueFBOAttachments)\n    gl.BindFramebuffer(gl.FRAMEBUFFER, 0)\n\n    // TRANSPARENT FBO\n    gl.BindFramebuffer(gl.FRAMEBUFFER, o.transparentFBO)\n    transparentFBOAttachments := []attachment{\n        attachment{&amp;o.transparentTex0, gl.RGB, gl.RGB, gl.FLOAT, gl.COLOR_ATTACHMENT0},\n        attachment{&amp;o.transparentTex1, gl.RGBA, gl.RGBA, gl.FLOAT, gl.COLOR_ATTACHMENT1},\n        attachment{&amp;o.sharedDepthBuffer, gl.DEPTH_COMPONENT, gl.DEPTH_COMPONENT, gl.FLOAT, gl.DEPTH_ATTACHMENT},\n    }\n    o.attachFramebufferTextures(o.transparentFBO, transparentFBOAttachments)\n    gl.BindFramebuffer(gl.FRAMEBUFFER, 0)\n}\n\n// attachFramebufferTextures attaches textures to an existing framebuffer. Has a check to reuse one if it already has a value\nfunc (o *OpenGL) attachFramebufferTextures(fib uint32, a []attachment) {\n    for _, att := range a {\n        if *att.textureID &lt;= 0 {\n            gl.GenTextures(1, att.textureID)\n            gl.BindTexture(gl.TEXTURE_2D, *att.textureID)\n            gl.TexParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT)\n            gl.TexParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT)\n            gl.TexParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST)\n            gl.TexParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST)\n            gl.TexImage2D(gl.TEXTURE_2D, 0, att.internalFormat, int32(o.screenWidth), int32(o.screenHeight), 0, att.format, att.typ, nil)\n        } else {\n            log.Printf(\"&gt; DEBUG: Texture %v seems to be shared with another framebuffers\", *att.textureID)\n            gl.BindTexture(gl.TEXTURE_2D, *att.textureID)\n        }\n\n        gl.FramebufferTexture2D(gl.FRAMEBUFFER, att.point, gl.TEXTURE_2D, *att.textureID, 0)\n        // gl.BindTexture(gl.TEXTURE_2D, 0)\n    }\n\n    if gl.CheckFramebufferStatus(gl.FRAMEBUFFER) != gl.FRAMEBUFFER_COMPLETE {\n        log.Fatalf(\"Framebuffer Error Hex: 0x%x\\nNow go look it up here: https://raw.githubusercontent.com/go-gl/gl/master/v4.5-core/gl/package.go\", gl.CheckFramebufferStatus(gl.FRAMEBUFFER))\n    }\n}\n\n// newFramebuffer generates and returns a new framebuffer\nfunc newFramebuffer() uint32 {\n    var fid uint32\n    gl.GenFramebuffers(1, &amp;fid)\n    return fid\n}\n\ntype attachment struct {\n    textureID      *uint32\n    internalFormat int32\n    format         uint32\n    typ            uint32\n    point          uint32\n}\n</code></pre>\n\n<p>So a few things that I've noted from testing is as follows:</p>\n\n<p>-Changing the order of the \"OPAQUE FBO\" and \"TRANSPARENT FBO\" code blocks give different results. Why? They are both bound when I use then, and then unbound once I'm done.</p>\n\n<p>-When I render out each framebuffer alone, the results are what I expect. However when I eventually render them to the default framebuffer as textures, I just get a black screen. The black I think might have to do with the following code</p>\n\n<pre><code>bindFramebuffer(o.transparentFBO)\ngl.Clear(gl.COLOR_BUFFER_BIT | gl.DEPTH_BUFFER_BIT)\ngl.DrawBuffers(2, &amp;[]uint32{gl.COLOR_ATTACHMENT0, gl.COLOR_ATTACHMENT1}[0])\ngl.ClearBufferfv(gl.COLOR, 0, &amp;[]float32{0, 0, 0, 1}[0])\ngl.ClearBufferfv(gl.COLOR, 1, &amp;[]float32{1, 1, 1, 1}[0])\n</code></pre>\n\n<h3>Update</h3>\n\n<p>So the black screen had to do how I bind textures to the shaders. I had to first execute <code>gl.ActiveTexture(gl.TEXTURE0 + n)</code> <strong>BEFORE</strong> running <code>gl.BindTexture(...)</code>. Very strangle but it is what it is.</p>\n\n<p>The only problem I still have now is somehow \"sharing\" that depth buffer between the two FBOs. I'm not even sure anymore if it is what I'm supposed to do but the code I'm referencing seems to suggest it.</p>\n"}, {"tags": ["go", "vgo"], "comments": [{"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 0, "creation_date": 1528745902, "post_id": 50803978, "comment_id": 88615768, "body": "Before doing <code>vgo build</code> like in normal <code>go</code> you need to ran <code>vgo get</code> in your project directory"}, {"owner": {"reputation": 101, "user_id": 8580601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48d1f722aa37e73e3e91872b3936c56d?s=128&d=identicon&r=PG&f=1", "display_name": "lmln", "link": "https://stackoverflow.com/users/8580601/lmln"}, "edited": false, "score": 0, "creation_date": 1528748521, "post_id": 50803978, "comment_id": 88616886, "body": "did you go get github.com/julienschmidt/httprouter?"}, {"owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "edited": false, "score": 0, "creation_date": 1528810944, "post_id": 50803978, "comment_id": 88642558, "body": "Did you create an empty <code>go.mod</code> file before running <code>vgo build</code>? Did <code>vgo build</code> generate the contents of <code>go.mod</code>? Does <code>go.mod</code> contain <code>httprouter</code>? When you say &quot;start to run my server,&quot; what command did you run?"}], "answers": [{"comments": [{"owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "edited": false, "score": 1, "creation_date": 1528813668, "post_id": 50819138, "comment_id": 88644478, "body": "thanks for answer. I wonder can you include parallel step of run but without binary, I normally do go run main.go, when developing I also use some autoreloaded, <code>gin</code> what would be the equivalent of go run main.go with vgo?"}, {"owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "reply_to_user": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "edited": false, "score": 1, "creation_date": 1528905994, "post_id": 50819138, "comment_id": 88686919, "body": "You can run <code>vgo run</code> directly. :) I updated the answer with an example."}], "tags": [], "owner": {"reputation": 1388, "user_id": 9609198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc96575acd1296cba81df24ffd919d4?s=128&d=identicon&r=PG&f=1", "display_name": "Tyler Bui-Palsulich", "link": "https://stackoverflow.com/users/9609198/tyler-bui-palsulich"}, "is_accepted": false, "score": 4, "last_activity_date": 1530021357, "last_edit_date": 1530021357, "creation_date": 1528812213, "answer_id": 50819138, "question_id": 50803978, "link": "https://stackoverflow.com/questions/50803978/golang-how-to-use-vgo-error-cannot-find-package/50819138#50819138", "title": "Golang: How to use vgo? error: &quot;cannot find package&quot;", "body": "<h1>Using <code>vgo build</code></h1>\n\n<p>Here is a \"Hello, World\" walk-through of using <code>vgo</code>, including common errors and how to respond to them.</p>\n\n<ol>\n<li><code>$ go get -u golang.org/x/vgo</code></li>\n<li><code>$ cd /tmp/hello # Outside of GOPATH.</code></li>\n<li><p><code>$ cat main.go</code></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"Hello, World\")\n}\n</code></pre></li>\n<li><p><code>$ vgo build</code></p>\n\n<pre><code>cannot determine module root; please create a go.mod file there\n</code></pre></li>\n<li><p>This error tells us we need to specify what the root of our vgo module is. A module is a collection of packages (possibly one) versioned together. Create an empty <code>go.mod</code> file to signify this is the module root:</p>\n\n<pre><code>$ touch go.mod\n</code></pre></li>\n<li><p>Try building again: <code>$ vgo build</code>.</p>\n\n<pre><code>vgo: cannot determine module path for source directory\n/tmp/hello (outside GOPATH, no import comments)\n</code></pre></li>\n<li><p>This error tells us vgo doesn't know the import path of our package. There are two ways to tell it:</p>\n\n<ol>\n<li>Add a <code>module</code> statement to <code>go.mod</code>.</li>\n<li>Add an <code>import</code> comment to our package.</li>\n</ol>\n\n<p>We'll go with option 2 right now and come back to option 1. Change the first line of <code>main.go</code> to be:</p>\n\n<pre><code>package main // import \"my/import/path/hello\"\n</code></pre></li>\n<li><p><code>$ vgo build</code> one last time.</p></li>\n<li><p>Run the binary: <code>$ ./hello</code></p>\n\n<pre><code>Hello, World\n</code></pre></li>\n</ol>\n\n<p>Note: <code>go.mod</code> now contains a <code>module</code> line (option 1 above):</p>\n\n<pre><code>$ cat go.mod \nmodule my/import/path/hello\n</code></pre>\n\n<p><strong>If you are inside your <code>GOPATH</code></strong>, the error in step 5 should not occur - <code>vgo build</code> should automatically figure out you're inside your <code>GOPATH</code> and add the <code>module</code> line accordingly.</p>\n\n<hr>\n\n<h1>Using <code>vgo run</code> (without using <code>vgo build</code>)</h1>\n\n<p>For this example, lets use the <code>hello.go</code> from the <a href=\"https://research.swtch.com/vgo-tour\" rel=\"nofollow noreferrer\">A Tour of Versioned Go (vgo)</a>:</p>\n\n<ol>\n<li><code>$ go get -u golang.org/x/vgo</code></li>\n<li><code>$ mkdir /tmp/hello2</code></li>\n<li><code>$ curl -sS https://swtch.com/hello.go &gt;hello.go</code></li>\n<li><p><code>$ vgo run hello.go</code></p>\n\n<pre><code>cannot determine module root; please create a go.mod file there\n</code></pre></li>\n<li><p><code>$ touch go.mod</code></p></li>\n<li><p><code>$ vgo run hello.go</code></p>\n\n<pre><code>vgo: resolving import \"rsc.io/quote\"\nvgo: finding rsc.io/quote (latest)\nvgo: adding rsc.io/quote v1.5.2\nHello, world.\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5219, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1530021357, "creation_date": 1528741813, "question_id": 50803978, "link": "https://stackoverflow.com/questions/50803978/golang-how-to-use-vgo-error-cannot-find-package", "title": "Golang: How to use vgo? error: &quot;cannot find package&quot;", "body": "<ol>\n<li><p>I have a project which is currently under my GOPATH <code>/usr/local/go/src/</code></p></li>\n<li><p>Then I went inside my project root and ran: <code>go get -u golang.org/x/vgo</code></p></li>\n<li><p>In my main.go I want to use lib httprouter so I added in import statement:</p>\n\n<p><code>import (\n  \"github.com/julienschmidt/httprouter\"\n)</code></p></li>\n<li><p>I ran <code>vgo build</code></p></li>\n<li>Then when I start to run my server as usual I get the following error:</li>\n</ol>\n\n<p><code>\nmain.go:8:2: cannot find package \"github.com/julienschmidt/httprouter\" in any of:\n        /usr/local/go/src/github.com/julienschmidt/httprouter (from $GOROOT)\n        /Users/myuser/go/src/github.com/julienschmidt/httprouter (from $GOPATH)\n</code></p>\n\n<p>I understand the error, it seems to be searching for httprouter under GOPATH or GOROOT. So do I have to do anything else to just let vgo do its thing and I can run my server successfully?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 934, "user_id": 2508038, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/a401dcb35f89eb3be4a617acf05c31b8?s=128&d=identicon&r=PG&f=1", "display_name": "ProgramCpp", "link": "https://stackoverflow.com/users/2508038/programcpp"}, "edited": false, "score": 0, "creation_date": 1528792473, "post_id": 50803730, "comment_id": 88630504, "body": "cannot embed a struct in a interface. bufio.Reader must be embedded if its possible."}, {"owner": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "reply_to_user": {"reputation": 934, "user_id": 2508038, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/a401dcb35f89eb3be4a617acf05c31b8?s=128&d=identicon&r=PG&f=1", "display_name": "ProgramCpp", "link": "https://stackoverflow.com/users/2508038/programcpp"}, "edited": false, "score": 0, "creation_date": 1528812407, "post_id": 50803730, "comment_id": 88643548, "body": "io.Reader is not a struct"}], "tags": [], "owner": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "is_accepted": false, "score": 2, "last_activity_date": 1595469615, "last_edit_date": 1595469615, "creation_date": 1528740575, "answer_id": 50803730, "question_id": 50803598, "link": "https://stackoverflow.com/questions/50803598/mock-bufio-external-package-for-unit-testing/50803730#50803730", "title": "mock bufio external package for unit testing", "body": "<p>You can always define your own interface</p>\n<pre><code>// An interface for the minimal api our code needs to work\ntype StringReader interface {\n  io.Reader\n  ReadString(delim byte) (string, error)\n}\n\n// Use dependency injection so that we can pass in a mock\n// during testing\nfunc DoSomething(r StringReader) error {\n  _, err := r.ReadString('x')\n  return err\n}\n\n// MockReader allows you to intercept calls to the\n// underlying bufio.Reader\ntype MockReader struct {\n  bufio.Reader\n  ReadStringFunc func(delim byte) (string, error)\n}\n\nfunc (r *MockReader) ReadString(delim byte) (string, error) {\n  if r.ReadStringFunc != nil {\n    return r.ReadStringFunc(delim)\n  }\n  return r.Reader.ReadString(delim)\n}\n\n// The actual test\nfunc TestDoSomething(t *testing.T) {\n  mr := MockReader{\n    Reader: bufio.NewReader(os.Stdin),\n    ReadStringFunc: func(delim byte) (string, error) {\n      if delim != 'x' {\n        t.Fatalf(&quot;want x, got %v&quot;, delim)\n      }\n      return &quot;&quot;, nil\n    },\n  }\n  if err := DoSomething(mr); err != nil {\n    t.Fatal(err)\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 934, "user_id": 2508038, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/a401dcb35f89eb3be4a617acf05c31b8?s=128&d=identicon&r=PG&f=1", "display_name": "ProgramCpp", "link": "https://stackoverflow.com/users/2508038/programcpp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1595469615, "creation_date": 1528740051, "question_id": 50803598, "link": "https://stackoverflow.com/questions/50803598/mock-bufio-external-package-for-unit-testing", "title": "mock bufio external package for unit testing", "body": "<p>I need to mock bufio <a href=\"https://golang.org/pkg/bufio/#NewReader\" rel=\"nofollow noreferrer\">Reader</a> for testing. specifically the <a href=\"https://golang.org/pkg/bufio/#Reader.ReadString\" rel=\"nofollow noreferrer\">ReadString</a> API.</p>\n\n<pre><code>func NewReader(rd io.Reader) *Reader\nfunc (b *Reader) ReadString(delim byte) (string, error)\n</code></pre>\n\n<p>The <code>NewReader</code> returns <code>bufio.Reader</code>.\nSince it does not return an abstraction/interface, I cannot create a adapter for the Reader.</p>\n\n<p>Could you please help. </p>\n"}, {"tags": ["go", "dependencies", "package"], "comments": [{"owner": {"reputation": 882, "user_id": 3984522, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/6D9an.jpg?s=128&g=1", "display_name": "hsrv", "link": "https://stackoverflow.com/users/3984522/hsrv"}, "edited": false, "score": 1, "creation_date": 1528753339, "post_id": 50802513, "comment_id": 88618779, "body": "try replacing, see <a href=\"https://research.swtch.com/vgo-tour\" rel=\"nofollow noreferrer\">research.swtch.com/vgo-tour</a>; e.g. <code>replace rsc.io&#47;quote v1.5.2 =&gt; ..&#47;quote</code>"}], "owner": {"reputation": 248, "user_id": 653800, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/97b18c147f57f538b7f48132ee7c1b0a?s=128&d=identicon&r=PG", "display_name": "conceptacid", "link": "https://stackoverflow.com/users/653800/conceptacid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 296, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1528735463, "creation_date": 1528735463, "question_id": 50802513, "link": "https://stackoverflow.com/questions/50802513/how-to-import-and-update-subpackages-using-vgo", "title": "How to import and update subpackages using VGO", "body": "<p>I'm just learning how to use VGO and it seems like a very simple problem but I could not find any good example explaining how to solve it.</p>\n\n<p>I have project hosted in a private bitbucket repository. Let's assume the project URL is <code>bitbucket.org/mycompany/myapp</code></p>\n\n<p>At the root level I have the <code>main.go</code>, which imports from a subpackage. The import looks like this:</p>\n\n<pre><code>import \"bitbucket.org/mycompany/myapp/subpackage\"\n</code></pre>\n\n<p>Question 1. After I just added that subpackage I do \"<code>vgo get .</code>\" because I want to fetch some other libraries, but that fails because it tries also to fetch my subpackage from bitbucket rather than using my local version. Obviously, I have not committed my changes so that fetch fails with \"remote: Not Found\" error. Do I have to push my changes before I do \"<code>vgo get .</code>\" ?</p>\n\n<p>Question 2. Assuming I have my subpackage in the repository, but I made a small change something in it. Now I want to verify it it works, do I have always push every single change every time before I do <code>vgo build</code>?</p>\n\n<p>In general, is there a way to tell vgo that if an absolute import path refers to my local repository it should take the files from the filesystem, rather than pulling from the bitbucket.org?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1528734215, "post_id": 50802108, "comment_id": 88610265, "body": "Describe the higher-level problem that you are trying to solve.  For example, are you trying to copy a <code>[]interface{}</code> to a slice of any type, or something else?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1528734221, "post_id": 50802108, "comment_id": 88610268, "body": "It&#39;s unclear what you&#39;re asking here or trying to accomplish - the text asks &quot;how can we return slices of interfaces ... like showed in the example&quot;, but the function in the example doesn&#39;t return anything at all, and it operates on <code>interface{}</code>, not <code>[]interface{}</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 216, "user_id": 7314809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb42cac5ed64736694aae0558c6b3c86?s=128&d=identicon&r=PG&f=1", "display_name": "Erin", "link": "https://stackoverflow.com/users/7314809/erin"}, "edited": false, "score": 0, "creation_date": 1528735787, "post_id": 50802108, "comment_id": 88611104, "body": "@Erin it doesn&#39;t take a slice of type interface, it just takes an <code>interface{}</code>."}, {"owner": {"reputation": 31, "user_id": 9926207, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-y11i-4aOTp4/AAAAAAAAAAI/AAAAAAAAAAA/Z79YdDABlMc/photo.jpg?sz=128", "display_name": "n.p", "link": "https://stackoverflow.com/users/9926207/n-p"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528739479, "post_id": 50802108, "comment_id": 88612815, "body": "@ThunderCat higher-level use-case is to retrieve data from this function: <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo#Collection.Distinct\" rel=\"nofollow noreferrer\">godoc.org/github.com/mongodb/mongo-go-driver/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 9926207, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-y11i-4aOTp4/AAAAAAAAAAI/AAAAAAAAAAA/Z79YdDABlMc/photo.jpg?sz=128", "display_name": "n.p", "link": "https://stackoverflow.com/users/9926207/n-p"}, "edited": false, "score": 0, "creation_date": 1528737566, "post_id": 50802562, "comment_id": 88611926, "body": "sorry about the semantics. when I say <code>return</code> in this context obviously means use parameters passed by pointers to &quot;return&quot; values to the caller.  I&#39;m passing as argument the pointer to <code>t</code> so I would expect that to work the same as it works for any other var type.  the way you stated works. Thank you for pointing out that! But I still can&#39;t fully understand why it doesn&#39;t work the way I have in the example."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 31, "user_id": 9926207, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-y11i-4aOTp4/AAAAAAAAAAI/AAAAAAAAAAA/Z79YdDABlMc/photo.jpg?sz=128", "display_name": "n.p", "link": "https://stackoverflow.com/users/9926207/n-p"}, "edited": false, "score": 0, "creation_date": 1528739260, "post_id": 50802562, "comment_id": 88612682, "body": "@n.p: you&#39;re not passing a pointer to the function, you&#39;re passing an interface value containing a pointer value. You&#39;re also assigning the new slice to the interface value only within the function scope, and even if that could work like you want, you would be assigning a <code>[]string</code> to an <code>[]interface{}</code> which is not valid."}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "edited": false, "score": 0, "creation_date": 1528739930, "post_id": 50802562, "comment_id": 88613035, "body": "@NelsonPina: it is because t is a copy.. I updated the answer to explain it better, let me know if it makes sense"}, {"owner": {"reputation": 31, "user_id": 9926207, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-y11i-4aOTp4/AAAAAAAAAAI/AAAAAAAAAAA/Z79YdDABlMc/photo.jpg?sz=128", "display_name": "n.p", "link": "https://stackoverflow.com/users/9926207/n-p"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528740336, "post_id": 50802562, "comment_id": 88613239, "body": "@JimB I see, it&#39;s getting a bit clear for me now. I&#39;m still wrapping my head around the empty interface type in Go. thank you for your clarifications. it still seems that it the syntax to achieve this is quite heavy though, I would expect something simpler. BTW, this is the function I&#39;m trying to retrieve data from: <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo#Collection.Distinct\" rel=\"nofollow noreferrer\">godoc.org/github.com/mongodb/mongo-go-driver/&hellip;</a>"}, {"owner": {"reputation": 31, "user_id": 9926207, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-y11i-4aOTp4/AAAAAAAAAAI/AAAAAAAAAAA/Z79YdDABlMc/photo.jpg?sz=128", "display_name": "n.p", "link": "https://stackoverflow.com/users/9926207/n-p"}, "edited": false, "score": 0, "creation_date": 1528741255, "post_id": 50802562, "comment_id": 88613672, "body": "@eugenioy you are missing the point that the func uses <code>[]interface{}</code> for a reason. If the <code>a := []interface{}{&quot;first&quot;, &quot;second&quot;}</code> was always of type <code>[]string</code> then I wouldn&#39;t need to pass an empty interface. in your reply you are assuming that the value we need to extract is always of type []string."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 2, "last_activity_date": 1528739013, "last_edit_date": 1528739013, "creation_date": 1528735655, "answer_id": 50802562, "question_id": 50802108, "link": "https://stackoverflow.com/questions/50802108/return-slice-of-empty-interface-from-function/50802562#50802562", "title": "return slice of empty interface from function", "body": "<p>In you example, you are not trying to \"return\" a slice but rather you seem to be looking to modify the argument to point to a new slice of strings.</p>\n\n<p>The way you are doing it does not work cause in Go, arguments are passed by value.</p>\n\n<p>When you do this:</p>\n\n<pre><code>t = a\n</code></pre>\n\n<p><code>t</code> is a <em>copy</em> of the <code>&amp;test</code> you are sending to the function as an argument.</p>\n\n<p>So modifying <code>t</code> does not change your <code>test</code> variable.</p>\n\n<p>You need to pass in the address of a pointer in order to be able to modify what the pointer points to.</p>\n\n<p>Try this way:</p>\n\n<pre><code>func main() {\n    var test *[]string\n    Test(&amp;test)\n    fmt.Println(*test)\n}\n\nfunc Test(t interface{}) {\n    a := []string{\"first\", \"second\"}\n    fmt.Println(a)\n    *t.(**[]string) = &amp;a\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[first second]\n[first second]\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/tliMrmliykp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/tliMrmliykp</a></p>\n"}, {"comments": [{"owner": {"reputation": 31, "user_id": 9926207, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-y11i-4aOTp4/AAAAAAAAAAI/AAAAAAAAAAA/Z79YdDABlMc/photo.jpg?sz=128", "display_name": "n.p", "link": "https://stackoverflow.com/users/9926207/n-p"}, "edited": false, "score": 0, "creation_date": 1528740912, "post_id": 50803687, "comment_id": 88613510, "body": "thank you for the reply, but no, the result may not always be a <code>[]string</code>, that&#39;s why the <code>func</code> uses an <code>[]interface{}</code> to return the query results"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1528741649, "last_edit_date": 1528741649, "creation_date": 1528740414, "answer_id": 50803687, "question_id": 50802108, "link": "https://stackoverflow.com/questions/50802108/return-slice-of-empty-interface-from-function/50803687#50803687", "title": "return slice of empty interface from function", "body": "<p>Because an []string and a []interface{} are different types, you cannot assign one to the other.</p>\n\n<p>You must copy the slice to convert []interface{} to a slice of some specific type. If you know that the []interface{} always contains string values, then use the following:</p>\n\n<pre><code>func stringSlice() []string {\n    a := []interface{}{\"first\", \"second\"} // query result\n    fmt.Println(a)\n\n    result := make([]string, len(a))\n    for i := range a {\n       var ok bool\n       result[i], ok = a[i].(string)\n       if !ok {\n          // handle error with unexpected type\n       }\n    }\n    return result\n}\n</code></pre>\n\n<p>If the result can have arbitrary element types, then use <a href=\"https://godoc.org/reflect\" rel=\"nofollow noreferrer\">reflection</a> to copy the slice:</p>\n\n<pre><code>func anySlice(result interface{}) {\n    a := []interface{}{\"first\", \"second\"} // query result\n\n    slice := reflect.ValueOf(result).Elem()\n    elementType := slice.Type().Elem()\n    for _, v := range a {\n        rv := reflect.ValueOf(v)\n        if !rv.Type().AssignableTo(elementType) {\n            // handle error with unexpected type\n        }\n        slice.Set(reflect.Append(slice, rv))\n    }\n}\n</code></pre>\n\n<p>Use it like this:</p>\n\n<pre><code>var s []string\nanySlice(&amp;s)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/d83mbX7aDz6\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 31, "user_id": 9926207, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-y11i-4aOTp4/AAAAAAAAAAI/AAAAAAAAAAA/Z79YdDABlMc/photo.jpg?sz=128", "display_name": "n.p", "link": "https://stackoverflow.com/users/9926207/n-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 939, "favorite_count": 0, "accepted_answer_id": 50803687, "answer_count": 2, "score": 0, "last_activity_date": 1528741649, "creation_date": 1528733952, "last_edit_date": 1528741440, "question_id": 50802108, "link": "https://stackoverflow.com/questions/50802108/return-slice-of-empty-interface-from-function", "title": "return slice of empty interface from function", "body": "<p>Can someone explain why this doesn't work and how can we return slices of interfaces, []interface{}, from functions like showed in the example?</p>\n\n<pre><code>import (\n    \"fmt\"\n)\n\nfunc main() {\n    var test []string\n    Test(&amp;test)\n    fmt.Println(test)\n}\n\nfunc Test(t interface{}) {\n    a := []interface{}{\"first\", \"second\"}\n    fmt.Println(a)\n    t = a\n}\n</code></pre>\n\n<p>Example of running code can be found here: \n<a href=\"https://play.golang.org/p/vcEGHSdWrjv\" rel=\"nofollow noreferrer\">https://play.golang.org/p/vcEGHSdWrjv</a></p>\n\n<p>BTW, this is the <code>func</code> I'm trying to extract data from: <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo#Collection.Distinct\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/mongodb/mongo-go-driver/mongo#Collection.Distinct</a></p>\n\n<p>Note: the type we expect is not always of type <code>[]string</code>, I'm just using string as an example here.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["json", "go", "web"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1528733274, "post_id": 50801784, "comment_id": 88609776, "body": "The error message tells you the the problem: the <code>}</code> on line 52 is not expected.  It looks like the <code>}</code> is a typo. Delete it."}], "answers": [{"comments": [{"owner": {"reputation": 645, "user_id": 695156, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/90e478591937482d1045181ad957a6b2?s=128&d=identicon&r=PG", "display_name": "Intelwalk", "link": "https://stackoverflow.com/users/695156/intelwalk"}, "edited": false, "score": 0, "creation_date": 1528736291, "post_id": 50801952, "comment_id": 88611345, "body": "Thanks! I was blind to that earlier!"}], "tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": true, "score": 1, "last_activity_date": 1528733405, "creation_date": 1528733405, "answer_id": 50801952, "question_id": 50801784, "link": "https://stackoverflow.com/questions/50801784/non-declaration-statement-outside-function-body-when-trying-to-read-json/50801952#50801952", "title": "non-declaration statement outside function body when trying to read JSON", "body": "<p>there is an extra bracer in your last Println</p>\n"}], "owner": {"reputation": 645, "user_id": 695156, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/90e478591937482d1045181ad957a6b2?s=128&d=identicon&r=PG", "display_name": "Intelwalk", "link": "https://stackoverflow.com/users/695156/intelwalk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 945, "favorite_count": 0, "closed_date": 1529391924, "accepted_answer_id": 50801952, "answer_count": 1, "score": -4, "last_activity_date": 1528733405, "creation_date": 1528732772, "question_id": 50801784, "link": "https://stackoverflow.com/questions/50801784/non-declaration-statement-outside-function-body-when-trying-to-read-json", "closed_reason": "Not suitable for this site", "title": "non-declaration statement outside function body when trying to read JSON", "body": "<p>I'm getting the following two errors on the following code and it won't compile.  I'm not really sure what I've done wrong in this code.  Here are my errors: \n.\\app.go:52:52: syntax error: unexpected }, expecting comma or )\n.\\app.go:55:1: syntax error: non-declaration statement outside function body.  I don't know what else to check in the following code.  Any help would be appreciated</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n)\n\ntype Results struct {\n    Results []Result `json:\"results\"`\n}\n\ntype Result struct {\n    Name   string  `json:\"name\"`\n    Rating float64 `json:\"rating\"`\n}\n\nfunc main() {\n    url := \"https://maps.googleapis.com/maps/api/place/nearbysearch/json?location=33.985,-118.4695&amp;radius=500&amp;type=restaurant&amp;key=MYKEY\"\n\n    resultClient := http.Client{\n        Timeout: time.Second * 2,\n    }\n\n    req, err := http.NewRequest(http.MethodGet, url, nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    req.Header.Set(\"User-Agent\", \"eattheshoals\")\n\n    res, getErr := resultClient.Do(req)\n    if getErr != nil {\n        log.Fatal(getErr)\n    }\n\n    byteValue, _ := ioutil.ReadAll(res.Body)\n    //if readErr != nil {\n    //  log.Fatal(readErr)\n    //}\n\n    var results Results\n    jsonErr := json.Unmarshal(byteValue, &amp;results)\n    if jsonErr != nil {\n        log.Fatal(jsonErr)\n    }\n\n    for i := 0; i &lt; len(results.Results); i++ {\n        fmt.Println(\"Name \" + results.Results[i].Name)\n        fmt.Println(\"Rating \" + results.Results[i].Rating})\n    }\n}\n</code></pre>\n"}, {"tags": ["variables", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 8219, "user_id": 135605, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7c56ff86a79852b167d84b3838756fba?s=128&d=identicon&r=PG", "display_name": "somejkuser", "link": "https://stackoverflow.com/users/135605/somejkuser"}, "edited": false, "score": 0, "creation_date": 1528729046, "post_id": 50800633, "comment_id": 88607186, "body": "ok how do i fix that?"}, {"owner": {"reputation": 8219, "user_id": 135605, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7c56ff86a79852b167d84b3838756fba?s=128&d=identicon&r=PG", "display_name": "somejkuser", "link": "https://stackoverflow.com/users/135605/somejkuser"}, "edited": false, "score": 0, "creation_date": 1528729169, "post_id": 50800633, "comment_id": 88607263, "body": "My only question is it was never instantiated then?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 8219, "user_id": 135605, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7c56ff86a79852b167d84b3838756fba?s=128&d=identicon&r=PG", "display_name": "somejkuser", "link": "https://stackoverflow.com/users/135605/somejkuser"}, "edited": false, "score": 0, "creation_date": 1528729241, "post_id": 50800633, "comment_id": 88607309, "body": "@jkushner Declaring a variable will initialize it to its zero value. Since your <code>Config</code> type is a struct, its zero value is a struct with all its fields being the zero values of their types. And since it has fields of <code>string</code> type, their values will be the empty string."}, {"owner": {"reputation": 8219, "user_id": 135605, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7c56ff86a79852b167d84b3838756fba?s=128&d=identicon&r=PG", "display_name": "somejkuser", "link": "https://stackoverflow.com/users/135605/somejkuser"}, "edited": false, "score": 0, "creation_date": 1528729296, "post_id": 50800633, "comment_id": 88607353, "body": "i see. thanks for the help"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1528747495, "last_edit_date": 1528747495, "creation_date": 1528728922, "answer_id": 50800633, "question_id": 50800611, "link": "https://stackoverflow.com/questions/50800611/cannot-access-global-variable-inside-function/50800633#50800633", "title": "Cannot access global variable inside function", "body": "<p>Inside <code>main()</code> you used the same name: <code>config</code> for a local variable. This will shadow the global variable. After this point, you can't refer to the global variable (for details, see <a href=\"https://stackoverflow.com/questions/38496954/refer-to-constant-or-package-level-variable-instead-of-function-level-variable/38497376#38497376\">Refer to constant or package level variable instead of function level variable</a>). You load the config into this local variable, but the global <code>config</code> will remain unchanged (zero), and the <code>UDProutine()</code> function will read / print this global variable.</p>\n\n<p>If you want to load the config to the global variable, don't create a local <code>config</code> variable. Just delete this line:</p>\n\n<pre><code>config := Config{}\n</code></pre>\n\n<p><strong>Note:</strong></p>\n\n<p>The above line is a <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">short variable declaration</a> which creates a new variable.</p>\n\n<p>You most likely just wanted to assign an empty <code>Config{}</code> struct value to <code>config</code>, but for that you have to use an <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"nofollow noreferrer\">assignment</a>:</p>\n\n<pre><code>config = Config{}\n</code></pre>\n\n<p>But this is not needed in this case, as the global variable declaration:</p>\n\n<pre><code>var config Config\n</code></pre>\n\n<p>will initialize the <code>config</code> global variable to its <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero value</a>, which in case of structs is a struct value where all its fields are also initialized to the zero values of their types.</p>\n"}], "owner": {"reputation": 8219, "user_id": 135605, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/7c56ff86a79852b167d84b3838756fba?s=128&d=identicon&r=PG", "display_name": "somejkuser", "link": "https://stackoverflow.com/users/135605/somejkuser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 904, "favorite_count": 0, "closed_date": 1528730054, "accepted_answer_id": 50800633, "answer_count": 1, "score": -1, "last_activity_date": 1528747495, "creation_date": 1528728863, "last_edit_date": 1528731679, "question_id": 50800611, "link": "https://stackoverflow.com/questions/50800611/cannot-access-global-variable-inside-function", "closed_reason": "Duplicate", "title": "Cannot access global variable inside function", "body": "<p>I have the following code:</p>\n\n<pre><code>package main\n\nimport (\n  \"net/http\"\n  \"log\"\n  \"net\"\n  \"fmt\"\n  \"os\"\n  \"encoding/json\"\n)\n\nconst configName string = \"config.json\"\n\ntype Config struct {\n UDPServerAddress string\n HTTPServerAddress string \n}\n\nvar config Config\n\nfunc UDProutine (query string, ch chan&lt;- string) {\n  log.Fatal(config.UDPServerAddress)\n}\n\nfunc main () {\n  file,_ := os.Open(configName)\n  defer file.Close()\n  decoder := json.NewDecoder(file)\n  config := Config{}\n  err := decoder.Decode(&amp;config)\n  if err != nil {\n     fmt.Println(\"error\",err)\n  }\n  log.Fatal(config.UDPServerAddress)\n}\n</code></pre>\n\n<p>And in my <code>config.json</code></p>\n\n<pre><code>{\n  \"UDPServerAddress\":\"127.0.0.1:54\",\n  \"HTTPServerAddress\":\"127.0.0.1:8082\"\n}\n</code></pre>\n\n<p>My question is, why does it log the config data correctly inside <code>main</code> but its empty value when logged inside <code>UDPRoutine</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528719965, "post_id": 50797563, "comment_id": 88601215, "body": "See <a href=\"https://gobyexample.com/timeouts\" rel=\"nofollow noreferrer\">gobyexample.com/timeouts</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": false, "score": 5, "last_activity_date": 1528730799, "last_edit_date": 1528730799, "creation_date": 1528720449, "answer_id": 50797874, "question_id": 50797563, "link": "https://stackoverflow.com/questions/50797563/how-to-cancel-fmt-scanf-after-a-certain-timeout/50797874#50797874", "title": "How to cancel fmt.Scanf after a certain timeout?", "body": "<p>You just need to put it in an infinate loop</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"context\"\n)\n\n// 3 seconds for example\nvar deadline = time.Second * 3\n\nfunc main() {\n    c := make(chan string, 1)\n    go scan(c)\n\n    ctx, _ := context.WithTimeout(context.Background(), deadline)\n\n    select {\n    case &lt;-ctx.Done():\n        // didnt type for deadline seconds\n    case &lt;-c:\n        // did it in time\n    }\n}\n\nfunc scan(in chan string) {\n    var input string\n    _, err := fmt.Scanln(&amp;input)\n    if err != nil {\n        panic(err)\n    }\n\n    in &lt;- input\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 0, "creation_date": 1528727297, "post_id": 50798441, "comment_id": 88606049, "body": "just to be clear, there is absolutely no way to do this without goroutines, right?"}, {"owner": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "reply_to_user": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "edited": false, "score": 1, "creation_date": 1528727597, "post_id": 50798441, "comment_id": 88606256, "body": "@vitr nope, there isn&#39;t. There may be some more concise way perhaps using some libraries, but internally it all has to happen with two different goroutines: one waiting for input and one waiting for a certain amount of time to pass, since waiting for user input is a blocking action."}, {"owner": {"reputation": 3851, "user_id": 6266540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0455a60b54cc79b3f8935832f4ca76c?s=128&d=identicon&r=PG&f=1", "display_name": "Fabian", "link": "https://stackoverflow.com/users/6266540/fabian"}, "edited": false, "score": 0, "creation_date": 1582226082, "post_id": 50798441, "comment_id": 106714017, "body": "Though the goroutine will keep existing while no line was entered yet."}, {"owner": {"reputation": 889, "user_id": 7174778, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ea532fbe618953b221b4da28d03d56dd?s=128&d=identicon&r=PG&f=1", "display_name": "YotKay", "link": "https://stackoverflow.com/users/7174778/yotkay"}, "edited": false, "score": 0, "creation_date": 1597830169, "post_id": 50798441, "comment_id": 112259010, "body": "This will leak the goroutine and also block reading from Stdin. Try adding one more read after this timeout (after whole select statement), and you&#39;ll see a strange thing happens: what you write is first consumed by the Scanf in the goroutine. You&#39;ll have to enter text again to be consumed by your second Scanf."}, {"owner": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "reply_to_user": {"reputation": 889, "user_id": 7174778, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ea532fbe618953b221b4da28d03d56dd?s=128&d=identicon&r=PG&f=1", "display_name": "YotKay", "link": "https://stackoverflow.com/users/7174778/yotkay"}, "edited": false, "score": 0, "creation_date": 1597830851, "post_id": 50798441, "comment_id": 112259340, "body": "@YotKay you&#39;re right, the goroutine is leaked if the 3s timeout runs out. How would you suggest getting around that?"}, {"owner": {"reputation": 889, "user_id": 7174778, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ea532fbe618953b221b4da28d03d56dd?s=128&d=identicon&r=PG&f=1", "display_name": "YotKay", "link": "https://stackoverflow.com/users/7174778/yotkay"}, "edited": false, "score": 0, "creation_date": 1597831263, "post_id": 50798441, "comment_id": 112259541, "body": "Seems like there is no perfect solution in Go for this. Please take a look at this post, it is very good: <a href=\"https://benjamincongdon.me/blog/2020/04/23/Cancelable-Reads-in-Go/\" rel=\"nofollow noreferrer\">benjamincongdon.me/blog/2020/04/23/Cancelable-Reads-in-Go</a>"}], "tags": [], "owner": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "is_accepted": true, "score": 6, "last_activity_date": 1600602658, "last_edit_date": 1600602658, "creation_date": 1528722254, "answer_id": 50798441, "question_id": 50797563, "link": "https://stackoverflow.com/questions/50797563/how-to-cancel-fmt-scanf-after-a-certain-timeout/50798441#50798441", "title": "How to cancel fmt.Scanf after a certain timeout?", "body": "<p>You can simply create a channel and launch a goroutine which does the <code>fmt.Scanf(&quot;\\n&quot;)</code> and then writes something to the channel. Then <code>select</code> between that channel and <code>time.After(3 * time.Second)</code>.</p>\n<p>Here's a solution:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;time&quot;\n    &quot;os&quot;\n)\n\nfunc main() {\n    // Rest of the program...\n\n    ch := make(chan int)\n\n    go func() {\n        fmt.Scanf(&quot;\\n&quot;)\n        ch &lt;- 1\n    }()\n\n    select {\n    case &lt;-ch:\n        fmt.Println(&quot;Exiting.&quot;)\n        os.Exit(0)\n    case &lt;-time.After(3 * time.Second):\n        fmt.Println(&quot;Timed out, exiting.&quot;)\n    }\n}\n</code></pre>\n<p><strong>NOTE</strong>: as pointed out by @Fabian and @YotKay in the comments, this will &quot;leak&quot; a goroutine (meaning it will remain running until the process exits) if the timeout expires and the user does not enter anything. This is still fine in a situation in which you have to either wait for input or exit the program, but not advisable in other cases, since it's not possible to &quot;cancel&quot; goroutines from the outside.</p>\n"}], "owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1078, "favorite_count": 3, "accepted_answer_id": 50798441, "answer_count": 2, "score": 5, "last_activity_date": 1600602658, "creation_date": 1528719478, "last_edit_date": 1528730818, "question_id": 50797563, "link": "https://stackoverflow.com/questions/50797563/how-to-cancel-fmt-scanf-after-a-certain-timeout", "title": "How to cancel fmt.Scanf after a certain timeout?", "body": "<p>I have a very simple command line utility and at the end of it I'm waiting for a user to hit the enter key to end the program:</p>\n\n<pre><code>fmt.Scanf(\"\\n\") // wait for hitting the enter key to end the program\n</code></pre>\n\n<p>Now I want to change it and if the enter key hasn't been hit for some time, I want to cancel <code>Scanf</code> and do something else. Is it possible to cancel waiting for user's input?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1528719504, "post_id": 50797399, "comment_id": 88600938, "body": "Could you please post a minimal executable go playground example? WHy are you ranging over cars to set the same key? <a href=\"https://play.golang.org/p/xKIlHWqJ4a9\" rel=\"nofollow noreferrer\">play.golang.org/p/xKIlHWqJ4a9</a>"}, {"owner": {"reputation": 3291, "user_id": 462575, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/524849342/picture?type=large", "display_name": "Allen", "link": "https://stackoverflow.com/users/462575/allen"}, "reply_to_user": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1528724036, "post_id": 50797399, "comment_id": 88603870, "body": "@dm03514 not ranging over cars to set same key, im just demonstrating by setting one value"}], "answers": [{"comments": [{"owner": {"reputation": 3291, "user_id": 462575, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/524849342/picture?type=large", "display_name": "Allen", "link": "https://stackoverflow.com/users/462575/allen"}, "edited": false, "score": 0, "creation_date": 1528723905, "post_id": 50797591, "comment_id": 88603782, "body": "can you elaborate by what you mean by deference the cars map value? Maybe with a code example?"}], "tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": false, "score": 0, "last_activity_date": 1528720782, "last_edit_date": 1528720782, "creation_date": 1528719550, "answer_id": 50797591, "question_id": 50797399, "link": "https://stackoverflow.com/questions/50797399/how-to-pass-value-of-pointer-from-map-into-function-argument/50797591#50797591", "title": "How to pass value of pointer from map into function argument", "body": "<p>You can dereference the cars map value during your call, which will invoke the function with the value pointed to by the car pointer:</p>\n\n<p><code>getSize(*car)</code></p>\n\n<hr>\n\n<p>If you don't you should receive a compilation error:</p>\n\n<blockquote>\n  <p>prog.go:31:16: cannot use car (type *Car) as type Car in argument to\n  getSize</p>\n</blockquote>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\n\ntype Car struct {\n    Model string\n    Size  int\n}\n\nfunc getSize(car Car) {\n    fmt.Println(car.Size)\n}\n\nfunc main() {\n    cars := make(map[string]*Car)\n    // fill cars with stuff\n    cars[\"Toyota\"] = &amp;Car{\n        Model: \"Toyota\",\n        Size:  2,\n    }\n\n\n    cars[\"Toyota\"].Size = 4\n\n\n    for _, car := range cars {\n        //somehow get the value of car and insert into function\n        getSize(car)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 3291, "user_id": 462575, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/524849342/picture?type=large", "display_name": "Allen", "link": "https://stackoverflow.com/users/462575/allen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 171, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1528720782, "creation_date": 1528718952, "question_id": 50797399, "link": "https://stackoverflow.com/questions/50797399/how-to-pass-value-of-pointer-from-map-into-function-argument", "title": "How to pass value of pointer from map into function argument", "body": "<p>So my use case is this:</p>\n\n<h3>1. generate map of pointers to structs (cars)</h3>\n\n<h3>2. mutate map</h3>\n\n<h3>3. iterate map and pass to function</h3>\n\n<pre><code>type Car struct {\n    Model string\n    Size  int\n}\n\nfunc getSize(car Car) {\n    fmt.Println(car.Size)\n}\n\nfunc main() {\n    cars := make(map[string]*Car)\n    // fill cars with stuff\n    cars[\"Toyota\"] = &amp;Car{\n        Model: \"Toyota\",\n        Size:  2,\n    }\n\n    for _, car := range cars {\n        cars[\"Toyota\"].Size = 4\n    }\n\n    for _, car := range cars {\n        //somehow get the value of car and insert into function\n        getSize(car)\n    }\n}\n</code></pre>\n\n<p>but I'm not sure how to pass the value of a pointer from a map to a function since maps don't allow you to address the pointer.</p>\n\n<p>Is there any way to better go about this?</p>\n"}, {"tags": ["java", "go", "encryption", "aes", "ecb"], "comments": [{"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 1, "creation_date": 1528717573, "post_id": 50796912, "comment_id": 88599831, "body": "change your _ to err and check it also describe what does &quot;cannot get it to work&quot; means"}, {"owner": {"reputation": 27, "user_id": 5956876, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-NPjGWqLOvn4/AAAAAAAAAAI/AAAAAAAB-DY/AiaYLRaotok/photo.jpg?sz=128", "display_name": "jroehl", "link": "https://stackoverflow.com/users/5956876/jroehl"}, "reply_to_user": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 0, "creation_date": 1528719170, "post_id": 50796912, "comment_id": 88600764, "body": "Thanks, edited the op .."}, {"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 1, "creation_date": 1528730282, "post_id": 50796912, "comment_id": 88607961, "body": "Please at least compile and test your Java code before posting. Downvoted. Sheesh"}, {"owner": {"reputation": 27, "user_id": 5956876, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-NPjGWqLOvn4/AAAAAAAAAAI/AAAAAAAB-DY/AiaYLRaotok/photo.jpg?sz=128", "display_name": "jroehl", "link": "https://stackoverflow.com/users/5956876/jroehl"}, "edited": false, "score": 0, "creation_date": 1528731835, "post_id": 50796912, "comment_id": 88608927, "body": "The java code (not mine) works - as it is used in the other application that does the encryption - decryption originally .."}], "answers": [{"tags": [], "owner": {"reputation": 1217, "user_id": 1995130, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee77bb5963bfba17bca789df98a0097d?s=128&d=identicon&r=PG", "display_name": "dubonzi", "link": "https://stackoverflow.com/users/1995130/dubonzi"}, "is_accepted": false, "score": 2, "last_activity_date": 1558966862, "last_edit_date": 1558966862, "creation_date": 1558965447, "answer_id": 56327497, "question_id": 50796912, "link": "https://stackoverflow.com/questions/50796912/java-aes-ecb-encryption-to-golang-migration/56327497#56327497", "title": "JAVA AES ECB Encryption to Golang migration", "body": "<p>Java adds a padding by default with the PKCS5 algorithm. In your Go code, you have to remove that padding with something like this (before returning the decrypted value):</p>\n\n<pre><code>func pkcs5UnPadding(src []byte) []byte {\n    length := len(src)\n    if length%64 == 0 {\n        return src\n    }\n    unpadding := int(src[length-1])\n    return src[:(length - unpadding)]\n}\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 5956876, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-NPjGWqLOvn4/AAAAAAAAAAI/AAAAAAAB-DY/AiaYLRaotok/photo.jpg?sz=128", "display_name": "jroehl", "link": "https://stackoverflow.com/users/5956876/jroehl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 460, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1558966862, "creation_date": 1528717328, "last_edit_date": 1528732983, "question_id": 50796912, "link": "https://stackoverflow.com/questions/50796912/java-aes-ecb-encryption-to-golang-migration", "title": "JAVA AES ECB Encryption to Golang migration", "body": "<p>I try to port a Java implementation of AES decryption to Golang. I need to decrypt data that is previously encrypted by the JAVA code using Golang. But so far I have no luck decrypting it.</p>\n\n<p>The Java code is:</p>\n\n<pre><code>private static byte[] pad(final String password) {\n    String key;\n    for (key = password; key.length() &lt; 16; key = String.valueOf(key) + key) {}\n    return key.substring(0, 16).getBytes();\n}\n\npublic static String encrypt(String password, String message) throws Exception\n{    \n  SecretKeySpec skeySpec = new SecretKeySpec(pad(password), \"AES\");\n  Cipher cipher = Cipher.getInstance(\"AES\");\n  cipher.init(1, skeySpec);\n\n  byte[] encrypted = cipher.doFinal(message.getBytes());\n  return Hex.encodeHexString(encrypted);\n}\n\npublic static String decrypt(String password, String message)\nthrows Exception {\n\n  SecretKeySpec skeySpec = new SecretKeySpec(pad(password), \"AES\");\n\n  Cipher cipher = Cipher.getInstance(\"AES\");\n  cipher.init(1, skeySpec);\n\n  cipher.init(2, skeySpec);\n  byte[] original = cipher.doFinal(Hex.decodeHex(message.toCharArray()));\n  return new String(original);\n}\n</code></pre>\n\n<p>I tried implementations like <a href=\"https://gist.github.com/JonCooperWorks/5a07d21f930f0c4072d47790b0fe8662\" rel=\"nofollow noreferrer\">Cryptography GIST</a> or </p>\n\n<pre><code>func decrypt(passphrase, data []byte) []byte {\n  cipher, err := aes.NewCipher([]byte(passphrase))\n  if err != nil {\n    panic(err)\n  }\n  decrypted := make([]byte, len(data))\n  size := 16\n\n  for bs, be := 0, size; bs &lt; len(data); bs, be = bs+size, be+size {\n    cipher.Decrypt(decrypted[bs:be], data[bs:be])\n  }\n\n  return decrypted\n}\nhx, _ := hex.DecodeString(hexString)\nres := decrypt([]byte(password), hx)\n</code></pre>\n\n<p>No error is thrown, and a string is returned. But this string is not anywhere close to the encrypted data. Any help is very much appreciated! Thanks!</p>\n"}, {"tags": ["json", "dictionary", "go", "error-handling", "type-assertion"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1528712836, "post_id": 50795541, "comment_id": 88596994, "body": "Returning slices and maps from functions is possible and requires no magic. Please show the complete function returning such values. Aim for a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 383, "user_id": 5482387, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TDPXo.jpg?s=128&g=1", "display_name": "hundred_dolla_tea", "link": "https://stackoverflow.com/users/5482387/hundred-dolla-tea"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1528713514, "post_id": 50795541, "comment_id": 88597412, "body": "@icza added the code, I do agree this post came in very sloppy, I have not slept in quite a long time (but thats not a valid excuse)"}], "answers": [{"comments": [{"owner": {"reputation": 383, "user_id": 5482387, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TDPXo.jpg?s=128&g=1", "display_name": "hundred_dolla_tea", "link": "https://stackoverflow.com/users/5482387/hundred-dolla-tea"}, "edited": false, "score": 0, "creation_date": 1528714815, "post_id": 50795932, "comment_id": 88598210, "body": "I can&#39;t believe I&#39;ve allowed myself to get this lazy with the error checking... you were 100% right, it was exactly a request error that I failed to diagnose. It is all fixed now thank you icza"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1528714262, "last_edit_date": 1528714262, "creation_date": 1528713870, "answer_id": 50795932, "question_id": 50795541, "link": "https://stackoverflow.com/questions/50795541/null-pointer-whenever-referencing-a-slice-or-map-returned-from-a-function/50795932#50795932", "title": "Null pointer whenever referencing a slice or map returned from a function", "body": "<p>Returning values created inside a function in Go is perfectly OK and used commonly. The compiler uses escape analysis, and if it can't prove a value does not escape from the function, it will be allocated on the heap, and so will not be destroyed when the function returns, and can be used after the function has returned.</p>\n\n<p>The error can't come from the line printing the map (unless it contains a recursive data structure, which it doesn't since it's the result of a JSON unmarshaling). Printing empty or even <code>nil</code> maps is possible and results in no error.</p>\n\n<p>Most likely the error is in your <code>twitterRequest()</code> function, possibly when you do a type assertion returning the value:</p>\n\n<pre><code>return jsonResp.(map[string]interface{})\n</code></pre>\n\n<p>This type assertion results in a run-time panic if <code>jsonResp</code> is <code>nil</code>, or the value it holds is not of type <code>map[string]interface{}</code>. It may be <code>nil</code> if the response body is invalid JSON, and it may be a value of other type if the response body is valid JSON, but it is a JSON array for example.</p>\n\n<p>First, check all errors, including the one when reading the body:</p>\n\n<pre><code>respBody, _ := ioutil.ReadAll(resp.Body)\n</code></pre>\n\n<p>Do it like:</p>\n\n<pre><code>respBody, err := ioutil.ReadAll(resp.Body)\nif err != nil {\n    // Handle error, optionally return\n}\n</code></pre>\n\n<p>You should also use the special form of type assertion:</p>\n\n<pre><code>m, ok := jsonResp.(map[string]interface{})\nif !ok {\n    // jsonResp is nil or is not a map!\n    // Handle this error case and return\n}\n\nreturn m // all ok\n</code></pre>\n\n<p>This special form of type assertion will never panic, instead if the assertion does not hold, the <code>ok</code> variable will be <code>false</code>, which you can check and handle it properly. If <code>ok</code> is <code>true</code>, that means <code>jsonResp</code> was not <code>nil</code>, and the value inside it was indeed a value of type <code>map[string]interface{}</code>, which is stored in <code>m</code>, which you can safely return.</p>\n"}], "owner": {"reputation": 383, "user_id": 5482387, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/TDPXo.jpg?s=128&g=1", "display_name": "hundred_dolla_tea", "link": "https://stackoverflow.com/users/5482387/hundred-dolla-tea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 50795932, "answer_count": 1, "score": 0, "last_activity_date": 1528714531, "creation_date": 1528712588, "last_edit_date": 1528714531, "question_id": 50795541, "link": "https://stackoverflow.com/questions/50795541/null-pointer-whenever-referencing-a-slice-or-map-returned-from-a-function", "title": "Null pointer whenever referencing a slice or map returned from a function", "body": "<p>It usually will be something like this</p>\n\n<pre><code>func main() {\n   my_map := myFunc()\n   fmt.Println(my_map)\n}\n\nfunc myFunc() map[string]interface{} {\n   // .... create a map....\n   return map\n}\n</code></pre>\n\n<p>when I run patterns like this, I almost always get a segfault when I try and print out <code>my_map</code>. </p>\n\n<p>This also happens if I return a <code>[]byte</code> type.</p>\n\n<p>Now here's the thing: I think understand why returning a <code>[]byte</code> that was created inside <code>myFunc()</code> would result in a segfault when printing it in main: The slice is referencing an array that was created inside <code>myFunc</code>, so as soon as <code>myFunc</code> returns, that array is deleted by garbage collection, and hence the segfault.</p>\n\n<p>I'm going to assume something similar is happening with the map.</p>\n\n<p>In C++, it would simply create a copy of the map, and return that --> no problem. Same if i returned an array.</p>\n\n<p>Why, in go, can't I simply return a created map, and what would be the best way to return a map (created inside a function) without resulting in a segfault as soon as that function returns to main?</p>\n\n<pre><code>func twitterRequest(query string, token string) map[string]interface{} {\n    req, err := http.NewRequest(\"GET\", query, nil)\n    if err != nil {\n        log.Fatal(err.Error())\n    }\n    req.Header.Add(\"Authorization\", fmt.Sprintf(\"Bearer %s\", token))\n    client := &amp;http.Client{}\n    resp, err2 := client.Do(req)\n    if err2 != nil {\n        log.Fatal(err.Error())\n    }\n    defer resp.Body.Close()\n    respBody, _ := ioutil.ReadAll(resp.Body)\n    var jsonResp interface{} // turns into map[string]interface{}\n    err = json.Unmarshal(respBody, &amp;jsonResp)\n    if err != nil {\n        log.Fatal(\"wrong\")\n    }\n    return jsonResp.(map[string]interface{})\n}\n\nfunc searchTweets(queries string, token string) {\n    builder := strings.Builder{}\n    builder.WriteString(tweetSearchUrl)\n    builder.WriteString(\"q=\")\n    builder.WriteString(queries)\n    queryUrl := url.QueryEscape(builder.String())\n    map1 := twitterRequest(queryUrl, token)\n    fmt.Println(map1) // SEG FAULT HERE\n}\n</code></pre>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 12311, "user_id": 2095090, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/3vmqn.jpg?s=128&g=1", "display_name": "Vincent van der Weele", "link": "https://stackoverflow.com/users/2095090/vincent-van-der-weele"}, "edited": false, "score": 1, "creation_date": 1528710953, "post_id": 50794887, "comment_id": 88595786, "body": "Is the small p (<code>people</code> instead of <code>People</code>) intentional? This makes that the field is not accessible outside the package where <code>Test</code> is defined and will not be parsed from json. I suspect that is the root cause of this question because there is nothing special about accessing maps inside structs (<code>object.people[&quot;key&quot;]</code> would work just fine)."}, {"owner": {"reputation": 307, "user_id": 10116837, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32e713cdcd8f130250676746af81dc46?s=128&d=identicon&r=PG&f=1", "display_name": "Ukiyo", "link": "https://stackoverflow.com/users/10116837/ukiyo"}, "reply_to_user": {"reputation": 12311, "user_id": 2095090, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/3vmqn.jpg?s=128&g=1", "display_name": "Vincent van der Weele", "link": "https://stackoverflow.com/users/2095090/vincent-van-der-weele"}, "edited": false, "score": 0, "creation_date": 1528711266, "post_id": 50794887, "comment_id": 88595986, "body": "That wasn&#39;t intentional (Thanks for reminding). I need clarification while declaring object what should be args3 (i.e how to define People inside object)? @VincentvanderWeele"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528711478, "post_id": 50794887, "comment_id": 88596134, "body": "@AshwinSekhari <code>args3</code> should be <code>map[string]string</code>, same as People field&#39;s type. Is your question on how to initiliaze a map?"}, {"owner": {"reputation": 307, "user_id": 10116837, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32e713cdcd8f130250676746af81dc46?s=128&d=identicon&r=PG&f=1", "display_name": "Ukiyo", "link": "https://stackoverflow.com/users/10116837/ukiyo"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528711662, "post_id": 50794887, "comment_id": 88596260, "body": "@mkopriva Yes can you give an example how to initialize a map inside the object?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528711707, "post_id": 50794887, "comment_id": 88596290, "body": "@AshwinSekhari Just like you would do it outside of an object. <code>make(map[string]string)</code> or <code>map[string]string{}</code>."}], "answers": [{"tags": [], "owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "is_accepted": true, "score": 1, "last_activity_date": 1528711704, "creation_date": 1528711704, "answer_id": 50795267, "question_id": 50794887, "link": "https://stackoverflow.com/questions/50794887/define-and-access-map-field-inside-struct-in-golang/50795267#50795267", "title": "Define and access map field inside struct in golang?", "body": "<p>You could initialize an empty map:</p>\n\n<pre><code>args3 := map[string]string{}\n</code></pre>\n\n<p>Or a map with values:</p>\n\n<pre><code>args3 := map[string]string{\"jane\": \"Jane\"}\n</code></pre>\n\n<p>You can assign values later directly:</p>\n\n<pre><code>args3[\"john\"] = \"john\"\n</code></pre>\n\n<p>Or after initializing object:</p>\n\n<pre><code>var object = Test{Value1: arg1, Value2: arg2, People: args3, Timeupdate: time.Now().String()}\nobject.People[\"claire\"] = \"Claire\"\n</code></pre>\n"}], "owner": {"reputation": 307, "user_id": 10116837, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32e713cdcd8f130250676746af81dc46?s=128&d=identicon&r=PG&f=1", "display_name": "Ukiyo", "link": "https://stackoverflow.com/users/10116837/ukiyo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2347, "favorite_count": 0, "accepted_answer_id": 50795267, "answer_count": 1, "score": 0, "last_activity_date": 1528711704, "creation_date": 1528710617, "last_edit_date": 1528711391, "question_id": 50794887, "link": "https://stackoverflow.com/questions/50794887/define-and-access-map-field-inside-struct-in-golang", "title": "Define and access map field inside struct in golang?", "body": "<p>Suppose I have a struct named Test,</p>\n\n<pre><code>type Test struct {\n    Value1 int `json:\"value1\"`\n    Value2 int `json:\"Value2\"`\n    People map[string]string `json:\"Value3\"`\n    Timeupdate string `json:\"Timeupdate\"`\n}\n</code></pre>\n\n<p>and people variable is a collection of key value pairs. How can I define and access people inside the struct?</p>\n\n<pre><code>var object = Test{Value1: arg1, Value2: arg2, People: args3, Timeupdate: time.Now().String()}\n</code></pre>\n\n<p>how can I define and access people inside this object?</p>\n"}, {"tags": ["go", "concurrency", "synchronization", "channel", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1528710165, "last_edit_date": 1528710165, "creation_date": 1528708992, "answer_id": 50794364, "question_id": 50794265, "link": "https://stackoverflow.com/questions/50794265/gos-sync-waitgroup-lost-the-one-of-the-responses/50794364#50794364", "title": "Go&#39;s sync.WaitGroup lost the one of the responses", "body": "<p><code>wg.Wait()</code> will only wait until all the goroutines that make the HTTP calls are done, it does not wait for the goroutine that prints the results to complete. And when all HTTP calls are done (and their results are sent on the channel), <code>wg.Wait()</code> may return, and your <code>main()</code> function ends. And with it your app ends as well. It will not wait for the independent, concurrent goroutine printing the results to end.</p>\n\n<p>To make your app wait for that too, use a 2nd <code>WaitGroup</code> or other means for synchronization. And don't forget to close the <code>jsonResponses</code> channel once all HTTP calls are completed, as that will make the printing goroutine end (once all values are received before it was closed):</p>\n\n<pre><code>var wg2 sync.WaitGroup\nwg2.Add(1)\ngo func() {\n    defer wg2.Done()\n    for response := range jsonResponses {\n        fmt.Println(response)\n    }\n}()\n\nwg.Wait()\n\n// At this point HTTP calls are done.\n// Close jsonResponses, signalling no more data will come:\nclose(jsonResponses)\nwg2.Wait()\n</code></pre>\n\n<p>What happens here is that once <code>wg.Wait()</code> reutrns, we know all HTTP calls and delivering their results have completed. We may close <code>jsonResponses</code> here. And the <code>for range</code> loop in the printing goroutine will properly terminate once all values sent before the channel close are received. And finally it will call <code>wg2.Done()</code>, so the <code>wg2.Wait()</code> call in the main can return and your program end.</p>\n"}], "owner": {"reputation": 1027, "user_id": 737172, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/9c600702dddd78163b73952749b0240a?s=128&d=identicon&r=PG", "display_name": "pvd", "link": "https://stackoverflow.com/users/737172/pvd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 585, "favorite_count": 0, "accepted_answer_id": 50794364, "answer_count": 1, "score": 4, "last_activity_date": 1528710165, "creation_date": 1528708703, "last_edit_date": 1528709914, "question_id": 50794265, "link": "https://stackoverflow.com/questions/50794265/gos-sync-waitgroup-lost-the-one-of-the-responses", "title": "Go&#39;s sync.WaitGroup lost the one of the responses", "body": "<p>I'm trying to send http requests sequently by adding <code>time.Sleep</code> inside goroutine by myself.</p>\n\n<p>However, there's always lost one of the response by  <code>sync.WaitGroup</code>, for example, this following go client sent 5 requests to my web server, but only got 4 of the total 5 responses:</p>\n\n<pre><code>Sending http://localhost:9001/?id=1, at 2018-06-11 17:11:56.424086867 +0800 CST m=+0.000949479\nSending http://localhost:9001/?id=2, at 2018-06-11 17:11:57.426178028 +0800 CST m=+1.003040640\nGOT id: 2 sleeping .... 0.347917120258,  at: 2018-06-11 17:11:57.776187964 +0800 CST m=+1.353050576\nGOT id: 1 sleeping .... 1.63133622383,  at: 2018-06-11 17:11:58.059441646 +0800 CST m=+1.636304258\nSending http://localhost:9001/?id=3, at 2018-06-11 17:11:58.42641506 +0800 CST m=+2.003277672\nGOT id: 3 sleeping .... 0.959551004983,  at: 2018-06-11 17:11:59.392013618 +0800 CST m=+2.968876230\nSending http://localhost:9001/?id=4, at 2018-06-11 17:11:59.428900219 +0800 CST m=+3.005762831\nGOT id: 4 sleeping .... 0.0479890727854,  at: 2018-06-11 17:11:59.479683953 +0800 CST m=+3.056546565\nSending http://localhost:9001/?id=5, at 2018-06-11 17:12:00.428293512 +0800 CST m=+4.005156124\n</code></pre>\n\n<p>Here's the Go client code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    urls := []string{\n      \"http://localhost:9001/?id=1\",\n      \"http://localhost:9001/?id=2\",\n      \"http://localhost:9001/?id=3\",\n      \"http://localhost:9001/?id=4\",\n      \"http://localhost:9001/?id=5\",\n    }\n    jsonResponses := make(chan string)\n\n    var wg sync.WaitGroup\n\n    wg.Add(len(urls))\n\n    for i, url := range urls {\n        tsleep := i\n        go func(url string) {\n            defer wg.Done()\n            time.Sleep(time.Duration(tsleep) * time.Second)\n            fmt.Println(\"Sending \" + url + \", at \" + time.Now().String())\n            res, err := http.Get(url)\n            if err != nil {\n                log.Fatal(err)\n            } else {\n                defer res.Body.Close()\n                body, err := ioutil.ReadAll(res.Body)\n                if err != nil {\n                    log.Fatal(err)\n                } else {\n                    t := time.Now()\n                    jsonResponses &lt;- string(\"GOT id: \" + string(body) + \",  at: \" + t.String())\n                }\n            }\n        }(url)\n    }\n\n    go func() {\n        for response := range jsonResponses {\n            fmt.Println(response)\n        }\n    }()\n\n    wg.Wait()\n}\n</code></pre>\n\n<p>With my testing tornado python web server code</p>\n\n<pre><code>import tornado.ioloop\nimport tornado.web\nimport random\nimport tornado.gen\n\nclass DefaultHandler(tornado.web.RequestHandler):\n    @tornado.web.asynchronous\n    @tornado.gen.engine\n    def get(self):\n        id = self.get_query_argument(\"id\", \"1\")\n        sleepy = 2.0 * (random.random())\n        self.write(id + \" sleeping .... \" + str(sleepy))\n        yield tornado.gen.sleep(sleepy)\n        self.finish()\n\n\ndef make_app():\n    return tornado.web.Application([\n        (r\"/\", DefaultHandler),\n    ])\n\nif __name__ == \"__main__\":\n    app = make_app()\n    app.listen(9001)\n    tornado.ioloop.IOLoop.current().start()\n</code></pre>\n"}, {"tags": ["string", "go", "comparison", "equals", "symbols"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1528704365, "post_id": 50792777, "comment_id": 88591974, "body": "== compares string contents as defined in the language spec. What is the question?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1528706070, "post_id": 50792777, "comment_id": 88592908, "body": "What did your benchmarks tell you?"}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1528718253, "post_id": 50793043, "comment_id": 88600220, "body": "Another reason would be if constant-time comparison is desired."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1528727443, "post_id": 50793043, "comment_id": 88606157, "body": "@Peter Yes, that might be a rare case, but when that is the goal, often the algorithms work with raw <code>[]byte</code> instead of <code>string</code> values."}, {"owner": {"reputation": 25, "user_id": 6132089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72484792ca52f5d2d7b4148b3f9a66a2?s=128&d=identicon&r=PG&f=1", "display_name": "charn", "link": "https://stackoverflow.com/users/6132089/charn"}, "edited": false, "score": 0, "creation_date": 1529400772, "post_id": 50793043, "comment_id": 88849180, "body": "Thanks for your answer. I asked this question because when I was studying the golang string matching algorithm Rabin-Karp, I wanted to figure out how the == symbol works to understand the algorithm performance better. It may not be appropriate for me to ask, but your answer has solved my doubts. Thank you very much."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1539709717, "post_id": 50793043, "comment_id": 92597189, "body": "I&#39;d note that yet another case for a custom comparison routine would be using some <a href=\"http://unicode.org/faq/normalization.html\" rel=\"nofollow noreferrer\">Unicode normalization</a> on the strings to be compared. While Go goes a step further than, say, C in its treatment of textual data, still, the built-in comparison is oblivious to stuff like, say, a single character <code>&#252;</code> being &quot;the same&quot; as <code>u</code> and the combining diaeresis character <code>&#168;</code> immediately following it."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 6, "last_activity_date": 1528727371, "last_edit_date": 1528727371, "creation_date": 1528704459, "answer_id": 50793043, "question_id": 50792777, "link": "https://stackoverflow.com/questions/50792777/using-the-symbol-in-golang-and-using-a-loop-to-compare-if-string-a-equals-str/50793043#50793043", "title": "Using the == symbol in golang and using a loop to compare if string a equals string b,which performance is better?", "body": "<p>You should use the <code>==</code> operator to compare strings. It compares the content of the <code>string</code> values.</p>\n\n<p>What you print is the address of <code>a</code> and <code>b</code> variables. Since they are 2 distinct non-zero size variables, their addresses cannot be the same by definition. The values they hold of course may or may not be the same. The <code>==</code> operator compares the values the variables hold, not the addresses of the variables.</p>\n\n<p>Your solution with the loop might even result in a runtime panic, if the <code>b</code> string is shorter than <code>a</code>, as you index it with values that are valid for <code>a</code>.</p>\n\n<p>The built-in <code>==</code> operator will likely always outperform any loop, as that is implemented in architecture specific assembly code. It is implemented in the <code>runtime</code> package, unexported function <code>memequal()</code>.</p>\n\n<p>Also note that the built-in comparison might even omit checking the actual contents of the texts if their string header points to the same data (and have equal length). There is no reason not to use <code>==</code>.</p>\n\n<p>The only reason where a custom equal function for <code>string</code> values would make sense is where the heuristics of your strings are known. E.g. if you know all the string values have the same prefix and they may only differ in their last character. In this case you could write a comparator function which only compares the last character of the strings to decide if they are equal (and only, optionally revert to actually compare the rest). This solution would of course not use a loop.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1528804708, "last_edit_date": 1528804708, "creation_date": 1528742956, "answer_id": 50804269, "question_id": 50792777, "link": "https://stackoverflow.com/questions/50792777/using-the-symbol-in-golang-and-using-a-loop-to-compare-if-string-a-equals-str/50804269#50804269", "title": "Using the == symbol in golang and using a loop to compare if string a equals string b,which performance is better?", "body": "<p>Use the Go <code>==</code> operator for <code>string</code> equality. The Go <code>gc</code> and <code>gccgo</code> compilers are optimizing compilers. The Go <code>runtime</code> has been optimized.</p>\n\n<hr>\n\n<p>This comment in the <a href=\"https://golang.org/pkg/strings/\" rel=\"nofollow noreferrer\"><code>strings</code></a> package documentation for the <a href=\"https://golang.org/pkg/strings/#Compare\" rel=\"nofollow noreferrer\"><code>strings.Compare</code></a> function is also relevant to equality:</p>\n\n<blockquote>\n  <p>Compare is included only for symmetry with package bytes. It is\n  usually clearer and always faster to use the built-in string\n  comparison operators ==, &lt;, >, and so on.</p>\n</blockquote>\n\n<hr>\n\n<p>In Go, the <code>runtime</code> representation of a <code>string</code> is a <code>struct</code>:</p>\n\n<pre><code>type StringHeader struct {\n        Data uintptr    // byte array pointer\n        Len  int        // byte array length\n}\n</code></pre>\n\n<p>When you assign a Go <code>string</code> value to a variable,</p>\n\n<pre><code>s := \"ABC\"\n</code></pre>\n\n<p>the memory location allocated for the variable <code>s</code> is set to the value of a <code>StringHeader</code> <code>struct</code> describing the <code>string</code>. The address of the variable, <code>&amp;s</code>, points to the <code>struct</code>, not to the underlying byte array.</p>\n\n<p>A comparison for Go <code>string</code> equality compares the bytes of the underlying arrays, the values of <code>*StringHeader.Data[0:StringHeader.Len]</code>.</p>\n\n<hr>\n\n<p>In Go, we use the Go <code>testing</code> package to benchmark performance. For example, comparing the Go <code>==</code> operator to two Go <code>string</code> equality functions:</p>\n\n<p>Output:</p>\n\n<pre><code>$ go test equal_test.go -bench=. -benchmem\nBenchmarkEqualOper-4     500000000    3.19 ns/op    0 B/op    0 allocs/op\nBenchmarkEqualFunc1-4    500000000    3.32 ns/op    0 B/op    0 allocs/op\nBenchmarkEqualFunc2-4    500000000    3.61 ns/op    0 B/op    0 allocs/op\n$ go version\ngo version devel +bb222cde10 Mon Jun 11 14:47:06 2018 +0000 linux/amd64\n$\n</code></pre>\n\n<p><code>equal_test.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"reflect\"\n    \"testing\"\n    \"unsafe\"\n)\n\nfunc EqualOper(a, b string) bool {\n    return a == b\n}\n\nfunc EqualFunc1(a, b string) bool {\n    if len(a) != len(b) {\n        return false\n    }\n    for i := 0; i &lt; len(a); i++ {\n        if a[i] != b[i] {\n            return false\n        }\n    }\n    return true\n}\n\nfunc EqualFunc2(a, b string) bool {\n    if len(a) != len(b) {\n        return false\n    }\n    if len(a) == 0 {\n        return true\n    }\n    // string intern equality\n    if (*reflect.StringHeader)(unsafe.Pointer(&amp;a)).Data == (*reflect.StringHeader)(unsafe.Pointer(&amp;b)).Data {\n        return true\n    }\n    for i := 0; i &lt; len(a); i++ {\n        if a[i] != b[i] {\n            return false\n        }\n    }\n    return true\n}\n\nvar y, z = \"aby\", \"abz\"\n\nfunc BenchmarkEqualOper(B *testing.B) {\n    a, b := y, z\n    for i := 0; i &lt; B.N; i++ {\n        _ = EqualOper(a, b)\n    }\n}\n\nfunc BenchmarkEqualFunc1(B *testing.B) {\n    a, b := y, z\n    for i := 0; i &lt; B.N; i++ {\n        _ = EqualFunc1(a, b)\n    }\n}\n\nfunc BenchmarkEqualFunc2(B *testing.B) {\n    a, b := y, z\n    for i := 0; i &lt; B.N; i++ {\n        _ = EqualFunc2(a, b)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 6132089, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72484792ca52f5d2d7b4148b3f9a66a2?s=128&d=identicon&r=PG&f=1", "display_name": "charn", "link": "https://stackoverflow.com/users/6132089/charn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1104, "favorite_count": 2, "answer_count": 2, "score": -1, "last_activity_date": 1529564954, "creation_date": 1528703405, "last_edit_date": 1529564954, "question_id": 50792777, "link": "https://stackoverflow.com/questions/50792777/using-the-symbol-in-golang-and-using-a-loop-to-compare-if-string-a-equals-str", "title": "Using the == symbol in golang and using a loop to compare if string a equals string b,which performance is better?", "body": "<pre><code>for i:=0;i&lt;len(a);i++{\n    if a[i] != b[i]{\n        return false\n    }\n}\n</code></pre>\n\n<p>and just</p>\n\n<pre><code>a == b\n</code></pre>\n\n<p>I've found that the same string have different address </p>\n\n<pre><code>a := \"abc\"\nb := \"abc\"\nprintln(&amp;a)\nprintln(&amp;b)\n</code></pre>\n\n<p>answer is :<br>\n0xc420045f68<br>\n0xc420045f58</p>\n\n<p>so == not using address to compare.<br>\nIn fact, I would like to know how == compares two strings.<br>\nI am searching for a long time on net. But failed...</p>\n"}, {"tags": ["go", "google-sheets-api"], "answers": [{"tags": [], "owner": {"reputation": 111, "user_id": 8170382, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-DiUTyi_27S4/AAAAAAAAAAI/AAAAAAAAAHM/b4QMHfzn0iw/photo.jpg?sz=128", "display_name": "Kent Lu", "link": "https://stackoverflow.com/users/8170382/kent-lu"}, "is_accepted": false, "score": 8, "last_activity_date": 1528703465, "creation_date": 1528703465, "answer_id": 50792790, "question_id": 50792237, "link": "https://stackoverflow.com/questions/50792237/add-a-new-sheet/50792790#50792790", "title": "Add a new sheet", "body": "<p>I find the method...</p>\n\n<pre><code>    req := sheets.Request{\n        AddSheet: &amp;sheets.AddSheetRequest{\n            Properties: &amp;sheets.SheetProperties{\n                Title: \"test\",\n            },\n        },\n    }\n\n    rbb := &amp;sheets.BatchUpdateSpreadsheetRequest{\n        Requests: []*sheets.Request{&amp;req},\n    }\n\n    resp, err := srv.Spreadsheets.BatchUpdate(spreadsheetId, rbb).Context(context.Background()).Do()\n    if err != nil {\n        log.Fatal(err)\n    }\n</code></pre>\n"}], "owner": {"reputation": 111, "user_id": 8170382, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-DiUTyi_27S4/AAAAAAAAAAI/AAAAAAAAAHM/b4QMHfzn0iw/photo.jpg?sz=128", "display_name": "Kent Lu", "link": "https://stackoverflow.com/users/8170382/kent-lu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 643, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1528721540, "creation_date": 1528701328, "last_edit_date": 1528721540, "question_id": 50792237, "link": "https://stackoverflow.com/questions/50792237/add-a-new-sheet", "title": "Add a new sheet", "body": "<p>I try to add a new sheet, but I don't understand how to do. Help me please...</p>\n\n<p>thanks.</p>\n\n<blockquote>\n  <p>Google sheet sample code \n  <a href=\"https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets/batchUpdate\" rel=\"nofollow noreferrer\">https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets/batchUpdate</a></p>\n  \n  <p>AddSheetRequest\n  <a href=\"https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets/request#AddSheetRequest\" rel=\"nofollow noreferrer\">https://developers.google.com/sheets/api/reference/rest/v4/spreadsheets/request#AddSheetRequest</a></p>\n</blockquote>\n\n<pre><code>package main\n\n// BEFORE RUNNING:\n// ---------------\n// 1. If not already done, enable the Google Sheets API\n//    and check the quota for your project at\n//    https://console.developers.google.com/apis/api/sheets\n// 2. Install and update the Go dependencies by running `go get -u` in the\n//    project directory.\n\nimport (\n        \"errors\"\n        \"fmt\"\n        \"log\"\n        \"net/http\"\n\n        \"golang.org/x/net/context\"\n        \"google.golang.org/api/sheets/v4\"\n)\n\nfunc main() {\n        ctx := context.Background()\n\n        c, err := getClient(ctx)\n        if err != nil {\n                log.Fatal(err)\n        }\n\n        sheetsService, err := sheets.New(c)\n        if err != nil {\n                log.Fatal(err)\n        }\n\n        // The spreadsheet to apply the updates to.\n        spreadsheetId := \"my-spreadsheet-id\" // TODO: Update placeholder value.\n\n        // A list of updates to apply to the spreadsheet.\n        // Requests will be applied in the order they are specified.\n        // If any request is not valid, no requests will be applied.\n        requests := []*sheets.Request{} // TODO: Update placeholder value.\n\n        rb := &amp;sheets.BatchUpdateSpreadsheetRequest{\n                Requests: requests,\n\n                // TODO: Add desired fields of the request body.\n        }\n\n        resp, err := sheetsService.Spreadsheets.BatchUpdate(spreadsheetId, rb).Context(ctx).Do()\n        if err != nil {\n                log.Fatal(err)\n        }\n\n        // TODO: Change code below to process the `resp` object:\n        fmt.Printf(\"%#v\\n\", resp)\n}\n\nfunc getClient(ctx context.Context) (*http.Client, error) {\n        // TODO: Change placeholder below to get authentication credentials. See\n        // https://developers.google.com/sheets/quickstart/go#step_3_set_up_the_sample\n        //\n        // Authorize using the following scopes:\n        //     sheets.DriveScope\n        //     sheets.DriveFileScope\n        //     sheets.SpreadsheetsScope\n        return nil, errors.New(\"not implemented\")\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528689169, "post_id": 50790190, "comment_id": 88586492, "body": "is it possible to receive messages from a channel without spawning a go routine for <code>GatherUrls</code>?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1528696547, "post_id": 50790190, "comment_id": 88588325, "body": "The current answers use <code>WaitGroup</code> and <code>Mutex</code> types from the standard <a href=\"https://godoc.org/sync\" rel=\"nofollow noreferrer\">sync</a> package included with all Go distributions. These are the idiomatic tools for solving the issues in the question.  It is possible to reimplement WaitGroup and Mutex using channels and thus avoid importing the sync package, but there&#39;s little point in doing that."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528696852, "post_id": 50790190, "comment_id": 88588437, "body": "maybe, but i dont understand what it does. Tour of Go does not mention this package so i dont think it is absolutely necessary."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528697090, "post_id": 50790190, "comment_id": 88588518, "body": "You can learn about WaitGroup by reading the <a href=\"https://godoc.org/sync#WaitGroup\" rel=\"nofollow noreferrer\">documentation</a>.  It&#39;s linked from my answer."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528697638, "post_id": 50790190, "comment_id": 88588736, "body": "WaitGroups were not mentioned in Tour of Go. So I dont think they are absolutely necessary."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1528720495, "post_id": 50790190, "comment_id": 88601570, "body": "@dopatraman: just because you <i>can</i> do it without wait groups, why do you have the need to reimplement such a basic part of the std library? There&#39;s a reason they are used in the majority of cases with concurrency."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1528726220, "post_id": 50790190, "comment_id": 88605323, "body": "There&#39;s a lot in Go that isn&#39;t mentioned in the tour. It&#39;s just a starting point to cover the most basic fundamental concepts. Limiting yourself to only what&#39;s covered in the tour will make things unnecessarily difficult, and potentially impossible."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1528737031, "post_id": 50790190, "comment_id": 88611696, "body": "@JimB it seems odd that one would need a concept not introduced in the lessons to complete a challenge prescribed by the lessons. Also, WaitGroups do not seem very intuitive. Why does one need to manually increment and decrement them?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528837704, "post_id": 50790190, "comment_id": 88656520, "body": "@dopatraman Explicit Add/Done is required because the wait group cannot automatically determine what the application is waiting for and when it&#39;s done."}], "answers": [{"comments": [{"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1528695456, "post_id": 50790319, "comment_id": 88587981, "body": "i dont want to use wait group"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1528698937, "post_id": 50790319, "comment_id": 88589249, "body": "@dopatraman Updated answer includes reimplementation of sync.WaitGroup using concepts covered in the Go Tour."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1528699785, "last_edit_date": 1528699785, "creation_date": 1528689309, "answer_id": 50790319, "question_id": 50790190, "link": "https://stackoverflow.com/questions/50790190/go-routine-not-running-when-called-through-recursion/50790319#50790319", "title": "Go-routine not running when called through recursion", "body": "<p>The main() function exits before the goroutines execute.  Fix by using a <a href=\"https://godoc.org/sync#WaitGroup\" rel=\"nofollow noreferrer\">wait group</a>:</p>\n\n<p>There's a data race on <code>cache</code>. Protect it with a mutex.  Always set <code>cache[u] = true</code> for URLs to be visited.</p>\n\n<pre><code>var wg sync.WaitGroup\nvar mu sync.Mutex\nvar fetched = map[string]bool{}\n\nfunc Crawl(url string, depth int, fetcher Fetcher) {\n    if depth &lt;= 0 {\n        return\n    }\n    body, urls, err := fetcher.Fetch(url)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Printf(\"found: %s %q\\n\", url, body)\n    for _, u := range urls {\n        mu.Lock()\n        f := fetched[u]\n        fetched[u] = true\n        mu.Unlock()\n        if !f {\n            wg.Add(1)\n            go func(u string) {\n                defer wg.Done()\n                Crawl(u, depth-1, fetcher)\n            }(u)\n        }\n    }\n    return\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/18_KeE51Q3g\" rel=\"nofollow noreferrer\">playground example</a></p>\n\n<p><a href=\"https://godoc.org/sync#WaitGroup\" rel=\"nofollow noreferrer\">Wait groups</a> are the idiomatic way to wait for goroutines to complete.  If you cannot use <a href=\"https://godoc.org/sync#WaitGroup\" rel=\"nofollow noreferrer\">sync.WaitGroup</a> for some reason, then reimplement the type using a counter, mutex and channel:</p>\n\n<pre><code>type WaitGroup struct {\n    mu   sync.Mutex\n    n    int\n    done chan struct{}\n}\n\nfunc (wg *WaitGroup) Add(i int) {\n    wg.mu.Lock()\n    defer wg.mu.Unlock()\n    if wg.done == nil {\n        wg.done = make(chan struct{})\n    }\n    wg.n += i\n    if wg.n &lt; 0 {\n        panic(\"negative count\")\n    }\n    if wg.n == 0 {\n        close(wg.done)\n        wg.done = nil\n    }\n}\n\nfunc (wg *WaitGroup) Done() {\n    wg.Add(-1)\n}\n\nfunc (wg *WaitGroup) Wait() {\n    wg.mu.Lock()\n    done := wg.done\n    wg.mu.Unlock()\n    if done != nil {\n        &lt;-done\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/dT60vutBPzq\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}, {"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528691238, "post_id": 50790367, "comment_id": 88586903, "body": "Crawl can return without calling wg.Done()."}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1528695189, "post_id": 50790367, "comment_id": 88587902, "body": "please see the updates, i dont want to use any packages other than sync"}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1528697839, "post_id": 50790367, "comment_id": 88588812, "body": "i dont want to use any packages not mentioned in Tour of Go"}, {"owner": {"reputation": 85, "user_id": 5218121, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b308136b453109457c54443dbc9fab7d?s=128&d=identicon&r=PG&f=1", "display_name": "big pigeon", "link": "https://stackoverflow.com/users/5218121/big-pigeon"}, "reply_to_user": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1528697984, "post_id": 50790367, "comment_id": 88588871, "body": "@dopatraman you just write custom WaitGroup code ,but also need sync/atomic package"}, {"owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1528698034, "post_id": 50790367, "comment_id": 88588892, "body": "@bigpigeon can you provide an example of what that would look like"}, {"owner": {"reputation": 85, "user_id": 5218121, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b308136b453109457c54443dbc9fab7d?s=128&d=identicon&r=PG&f=1", "display_name": "big pigeon", "link": "https://stackoverflow.com/users/5218121/big-pigeon"}, "reply_to_user": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "edited": false, "score": 0, "creation_date": 1528699148, "post_id": 50790367, "comment_id": 88589349, "body": "@dopatraman WaitGroup.Add is thread safe operation, it use sync/atomic to maintain atomicity, and sync/atomic package implement without go, if you insist on not extra package, try to make channal to sync it"}], "tags": [], "owner": {"reputation": 85, "user_id": 5218121, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b308136b453109457c54443dbc9fab7d?s=128&d=identicon&r=PG&f=1", "display_name": "big pigeon", "link": "https://stackoverflow.com/users/5218121/big-pigeon"}, "is_accepted": false, "score": -1, "last_activity_date": 1528689752, "creation_date": 1528689752, "answer_id": 50790367, "question_id": 50790190, "link": "https://stackoverflow.com/questions/50790190/go-routine-not-running-when-called-through-recursion/50790367#50790367", "title": "Go-routine not running when called through recursion", "body": "<p>because main function was exit</p>\n\n<p>you need add <code>sync.WaitGroup</code> to keep main function wait unit all coroutine done</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nvar cache map[string]bool\n\nvar wg sync.WaitGroup\n\ntype Fetcher interface {\n    // Fetch returns the body of URL and\n    // a slice of URLs found on that page.\n    Fetch(url string) (body string, urls []string, err error)\n}\n\nfunc GatherUrls(url string, fetcher Fetcher, Urls chan []string) {\n    body, urls, err := fetcher.Fetch(url)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    } else {\n        fmt.Printf(\"found: %s %q\\n\", url, body)\n    }\n    Urls &lt;- urls\n    wg.Done()\n}\n\n// Crawl uses fetcher to recursively crawl\n// pages starting with url, to a maximum of depth.\nfunc Crawl(url string, depth int, fetcher Fetcher) {\n    // get all urls for depth\n    // check if url has been crawled\n    //  Y: noop\n    //  N: crawl url\n    // when depth is 0, stop\n    fmt.Printf(\"crawling %q... %d\\n\", url, depth)\n    if depth &lt;= 0 {\n        return\n    }\n    uc := make(chan []string)\n    wg.Add(1)\n    go GatherUrls(url, fetcher, uc)\n    urls, _ := &lt;-uc\n    fmt.Println(\"urls:\", urls)\n    for _, u := range urls {\n        fmt.Println(\"currentUrl:\", u)\n        if _, exists := cache[u]; !exists {\n            fmt.Printf(\"about to crawl %q\\n\", u)\n            wg.Add(1)\n            go Crawl(u, depth-1, fetcher)\n        } else {\n            cache[u] = true\n        }\n    }\n    wg.Done()\n}\n\nfunc main() {\n    cache = make(map[string]bool)\n    wg.Add(1)\n    go Crawl(\"https://golang.org/\", 4, fetcher)\n    wg.Wait()\n}\n\n// fakeFetcher is Fetcher that returns canned results.\ntype fakeFetcher map[string]*fakeResult\n\ntype fakeResult struct {\n    body string\n    urls []string\n}\n\nfunc (f fakeFetcher) Fetch(url string) (string, []string, error) {\n    if res, ok := f[url]; ok {\n        return res.body, res.urls, nil\n    }\n    return \"\", nil, fmt.Errorf(\"not found: %s\", url)\n}\n\n// fetcher is a populated fakeFetcher.\nvar fetcher = fakeFetcher{\n    \"https://golang.org/\": &amp;fakeResult{\n        \"The Go Programming Language\",\n        []string{\n            \"https://golang.org/pkg/\",\n            \"https://golang.org/cmd/\",\n        },\n    },\n    \"https://golang.org/pkg/\": &amp;fakeResult{\n        \"Packages\",\n        []string{\n            \"https://golang.org/\",\n            \"https://golang.org/cmd/\",\n            \"https://golang.org/pkg/fmt/\",\n            \"https://golang.org/pkg/os/\",\n        },\n    },\n    \"https://golang.org/pkg/fmt/\": &amp;fakeResult{\n        \"Package fmt\",\n        []string{\n            \"https://golang.org/\",\n            \"https://golang.org/pkg/\",\n        },\n    },\n    \"https://golang.org/pkg/os/\": &amp;fakeResult{\n        \"Package os\",\n        []string{\n            \"https://golang.org/\",\n            \"https://golang.org/pkg/\",\n        },\n    },\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6316, "user_id": 226145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b713823a49df6d9c2f9a24d0728add5?s=128&d=identicon&r=PG", "display_name": "ThanhHH", "link": "https://stackoverflow.com/users/226145/thanhhh"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528787001, "post_id": 50793832, "comment_id": 88627495, "body": "@ThunderCat Thank you for your comment. I rewrote from the original source code sample from &#39;A Tour of Go&#39; to fetch URL in parallel without using wait group."}], "tags": [], "owner": {"reputation": 6316, "user_id": 226145, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b713823a49df6d9c2f9a24d0728add5?s=128&d=identicon&r=PG", "display_name": "ThanhHH", "link": "https://stackoverflow.com/users/226145/thanhhh"}, "is_accepted": true, "score": 0, "last_activity_date": 1528817376, "last_edit_date": 1528817376, "creation_date": 1528707337, "answer_id": 50793832, "question_id": 50790190, "link": "https://stackoverflow.com/questions/50790190/go-routine-not-running-when-called-through-recursion/50793832#50793832", "title": "Go-routine not running when called through recursion", "body": "<p>As you see in this sample: <a href=\"https://tour.golang.org/concurrency/10\" rel=\"nofollow noreferrer\">https://tour.golang.org/concurrency/10</a>, we should do following tasks:</p>\n\n<ul>\n<li>Fetch URLs in parallel.</li>\n<li>Don't fetch the same URL twice.</li>\n<li>Cache URLs already fetched on a map, but maps alone are not safe for concurrent use!</li>\n</ul>\n\n<p>So, we can do following steps to resolve above tasks:</p>\n\n<p>Create struct to store the fetch result:</p>\n\n<pre><code>type Result struct {\n    body string\n    urls []string\n    err  error\n}\n</code></pre>\n\n<p>Create a struct to store URL has already fetched on the map, we need use <code>sync.Mutex</code>, this is not introduced in 'A Tour of Go':</p>\n\n<pre><code>type Cache struct {\n    store map[string]bool\n    mux   sync.Mutex\n}\n</code></pre>\n\n<p>Fetch URL and body in parallel: Add URL to the cache when fetching it, but the first we need lock read/write in parallel by a mutex. So, we can modify <code>Crawl</code> function like this:</p>\n\n<pre><code>func Crawl(url string, depth int, fetcher Fetcher) {\n    if depth &lt;= 0 {\n        return\n    }\n\n    ch := make(chan Result)\n\n    go func(url string, res chan Result) {\n        body, urls, err := fetcher.Fetch(url)\n\n        if err != nil {\n            ch &lt;- Result{body, urls, err}\n            return\n        }\n\n        var furls []string\n        cache.mux.Lock()\n        for _, u := range urls {\n            if _, exists := cache.store[u]; !exists {\n                furls = append(furls, u)\n            }\n            cache.store[u] = true\n        }\n        cache.mux.Unlock()\n\n        ch &lt;- Result{body: body, urls: furls, err: err}\n\n    }(url, ch)\n\n    res := &lt;-ch\n\n    if res.err != nil {\n        fmt.Println(res.err)\n        return\n    }\n\n    fmt.Printf(\"found: %s %q\\n\", url, res.body)\n\n    for _, u := range res.urls {\n        Crawl(u, depth-1, fetcher)\n    }\n}\n</code></pre>\n\n<p>You can view the full code and run this in the playground: <a href=\"https://play.golang.org/p/iY9uBXchx3w\" rel=\"nofollow noreferrer\">https://play.golang.org/p/iY9uBXchx3w</a></p>\n\n<p>Hope this help.</p>\n"}], "owner": {"reputation": 11693, "user_id": 858962, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/5f16ec0395b1710fd529b01602de66ca?s=128&d=identicon&r=PG", "display_name": "dopatraman", "link": "https://stackoverflow.com/users/858962/dopatraman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 1, "accepted_answer_id": 50793832, "answer_count": 3, "score": -2, "last_activity_date": 1528817376, "creation_date": 1528687857, "last_edit_date": 1528695822, "question_id": 50790190, "link": "https://stackoverflow.com/questions/50790190/go-routine-not-running-when-called-through-recursion", "title": "Go-routine not running when called through recursion", "body": "<p>I'm doing the <a href=\"https://tour.golang.org/concurrency/10\" rel=\"nofollow noreferrer\">Web Crawler</a> problem from the tour of go. Here's my solution so far:</p>\n\n<pre><code>func GatherUrls(url string, fetcher Fetcher) []string {\n    body, urls, err := fetcher.Fetch(url)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    } else {\n        fmt.Printf(\"found: %s %q\\n\", url, body)\n    }\n    return urls\n}\n\n// Crawl uses fetcher to recursively crawl\n// pages starting with url, to a maximum of depth.\nfunc Crawl(url string, depth int, fetcher Fetcher) {\n    // get all urls for depth\n    // check if url has been crawled\n    //  Y: noop\n    //  N: crawl url\n    // when depth is 0, stop\n    fmt.Printf(\"crawling %q...\\n\", url)\n    if depth &lt;= 0 {\n        return\n    }\n    urls := GatherUrls(url, fetcher)\n    fmt.Println(\"urls:\", urls)\n    for _, u := range urls {\n        fmt.Println(\"currentUrl:\", u)\n        if _, exists := cache[u]; !exists {\n            fmt.Printf(\"about to crawl %q\\n\", u)\n            go Crawl(u, depth - 1, fetcher)\n        } else {\n            cache[u] = true\n        }\n    }\n}\n\nfunc main() {\n    cache = make(map[string]bool)\n    Crawl(\"https://golang.org/\", 4, fetcher)\n}\n</code></pre>\n\n<p>When I run this code, <code>Crawl()</code> is never called when the function recurses (i know this because <code>fmt.Printf(\"crawling %q...\\n\", url)</code> is only ever called once)</p>\n\n<p>Here are the logs:</p>\n\n<pre><code>crawling \"https://golang.org/\"...\nfound: https://golang.org/ \"The Go Programming Language\"\nurls: [https://golang.org/pkg/ https://golang.org/cmd/]\ncurrentUrl: https://golang.org/pkg/\nabout to crawl \"https://golang.org/pkg/\"\ncurrentUrl: https://golang.org/cmd/\nabout to crawl \"https://golang.org/cmd/\"\n</code></pre>\n\n<p>What am I doing wrong? I suspect that spawning a thread to do recursion is the wrong way to do this? Please advise.</p>\n\n<p><strong>Please note</strong> that I want to do this with as few libraries as possible. I've seen some answers with the <code>WaitGroup</code> package. I dont want to use this.</p>\n\n<p>NOTE: The full code including the lesson boilerplate is below:\npackage main</p>\n\n<pre><code>import (\n    \"fmt\"\n)\n\nvar cache map[string]bool\n\ntype Fetcher interface {\n    // Fetch returns the body of URL and\n    // a slice of URLs found on that page.\n    Fetch(url string) (body string, urls []string, err error)\n}\n\nfunc GatherUrls(url string, fetcher Fetcher) []string {\n    body, urls, err := fetcher.Fetch(url)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    } else {\n        fmt.Printf(\"found: %s %q\\n\", url, body)\n    }\n    return urls\n}\n\n// Crawl uses fetcher to recursively crawl\n// pages starting with url, to a maximum of depth.\nfunc Crawl(url string, depth int, fetcher Fetcher) {\n    // get all urls for depth\n    // check if url has been crawled\n    //  Y: noop\n    //  N: crawl url\n    // when depth is 0, stop\n    fmt.Printf(\"crawling %q...\\n\", url)\n    if depth &lt;= 0 {\n        return\n    }\n    urls := GatherUrls(url, fetcher)\n    fmt.Println(\"urls:\", urls)\n    for _, u := range urls {\n        fmt.Println(\"currentUrl:\", u)\n        if _, exists := cache[u]; !exists {\n            fmt.Printf(\"about to crawl %q\\n\", u)\n            go Crawl(u, depth - 1, fetcher)\n        } else {\n            cache[u] = true\n        }\n    }\n}\n\nfunc main() {\n    cache = make(map[string]bool)\n    Crawl(\"https://golang.org/\", 4, fetcher)\n}\n\n// fakeFetcher is Fetcher that returns canned results.\ntype fakeFetcher map[string]*fakeResult\n\ntype fakeResult struct {\n    body string\n    urls []string\n}\n\nfunc (f fakeFetcher) Fetch(url string) (string, []string, error) {\n    if res, ok := f[url]; ok {\n        return res.body, res.urls, nil\n    }\n    return \"\", nil, fmt.Errorf(\"not found: %s\", url)\n}\n\n// fetcher is a populated fakeFetcher.\nvar fetcher = fakeFetcher{\n    \"https://golang.org/\": &amp;fakeResult{\n        \"The Go Programming Language\",\n        []string{\n            \"https://golang.org/pkg/\",\n            \"https://golang.org/cmd/\",\n        },\n    },\n    \"https://golang.org/pkg/\": &amp;fakeResult{\n        \"Packages\",\n        []string{\n            \"https://golang.org/\",\n            \"https://golang.org/cmd/\",\n            \"https://golang.org/pkg/fmt/\",\n            \"https://golang.org/pkg/os/\",\n        },\n    },\n    \"https://golang.org/pkg/fmt/\": &amp;fakeResult{\n        \"Package fmt\",\n        []string{\n            \"https://golang.org/\",\n            \"https://golang.org/pkg/\",\n        },\n    },\n    \"https://golang.org/pkg/os/\": &amp;fakeResult{\n        \"Package os\",\n        []string{\n            \"https://golang.org/\",\n            \"https://golang.org/pkg/\",\n        },\n    },\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 6, "creation_date": 1528679242, "post_id": 50789279, "comment_id": 88585008, "body": "You&#39;re using <code>make</code> incorrectly; it can&#39;t create multidimensional slices."}, {"owner": {"reputation": 130, "user_id": 6056648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bed0146d476e6226e9788cb1322f0723?s=128&d=identicon&r=PG", "display_name": "coding_carebear", "link": "https://stackoverflow.com/users/6056648/coding-carebear"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1528681473, "post_id": 50789279, "comment_id": 88585319, "body": "Thanks. changed the make statement to: g := make([][]byte, v.y)"}], "answers": [{"tags": [], "owner": {"reputation": 130, "user_id": 6056648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bed0146d476e6226e9788cb1322f0723?s=128&d=identicon&r=PG", "display_name": "coding_carebear", "link": "https://stackoverflow.com/users/6056648/coding-carebear"}, "is_accepted": false, "score": 0, "last_activity_date": 1528682776, "last_edit_date": 1528682776, "creation_date": 1528681618, "answer_id": 50789580, "question_id": 50789279, "link": "https://stackoverflow.com/questions/50789279/panic-runtime-error-makeslice-cap-out-of-range/50789580#50789580", "title": "panic: runtime error: makeslice: cap out of range", "body": "<p>As per the reply from Tim Cooper, this was a simple fix.</p>\n\n<p>Just changed the make statement to use it correctly:</p>\n\n<pre><code>func makeGrid(s string, v Vector) [][]byte {\n    g := make([][]byte, v.y)\n    for k, c := range s {\n        g[k/v.x] = append(g[k/v.x], byte(c))\n    }\n    return g \n}\n</code></pre>\n\n<p>Working fine now.</p>\n"}], "owner": {"reputation": 130, "user_id": 6056648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bed0146d476e6226e9788cb1322f0723?s=128&d=identicon&r=PG", "display_name": "coding_carebear", "link": "https://stackoverflow.com/users/6056648/coding-carebear"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2033, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1528682776, "creation_date": 1528677935, "last_edit_date": 1528678606, "question_id": 50789279, "link": "https://stackoverflow.com/questions/50789279/panic-runtime-error-makeslice-cap-out-of-range", "title": "panic: runtime error: makeslice: cap out of range", "body": "<p>As an exercise to practice Go everyday, I attempt one of the daily challenges on r/dailyprogrammer, each day.</p>\n\n<p>Currently, I'm implementing the intermediate challenge, #362 (<a href=\"https://www.reddit.com/r/dailyprogrammer/comments/8n8tog/20180530_challenge_362_intermediate_route/\" rel=\"nofollow noreferrer\">https://www.reddit.com/r/dailyprogrammer/comments/8n8tog/20180530_challenge_362_intermediate_route/</a>), which is a simple encryption/decryption challenge.</p>\n\n<p>So in my approach, I have a basic struct to represent the input:</p>\n\n<pre><code>type Vector struct {\n    x, y int\n}\n\ntype Input struct {\n    text   string\n    vector Vector\n    method string\n}\n</code></pre>\n\n<p>and a slice of the structs for the challenge inputs:</p>\n\n<pre><code>inputs := []Input{\n        {\"WE ARE DISCOVERED. FLEE AT ONCE\", Vector{9, 3}, \"clockwise\"},\n        {\"why is this professor so boring omg\", Vector{6, 5}, \"counter-clockwise\"},\n        {\"Solving challenges on r/dailyprogrammer is so much fun!!\", Vector{8, 6}, \"counter-clockwise\"},\n        {\"For lunch let's have peanut-butter and bologna sandwiches\", Vector{4, 12}, \"clockwise\"},\n        {\"I've even witnessed a grown man satisfy a camel\", Vector{9, 5}, \"clockwise\"},\n        {\"Why does it say paper jam when there is no paper jam?\", Vector{3, 14}, \"counter-clockwise\"},\n    }\n</code></pre>\n\n<p>So far, so good.</p>\n\n<p>I have a function to simplify the input string as outlined in the challenge (ie. a function removes all punctuation and pads the string with 'X's to the length of the required grid).</p>\n\n<p>After that, I feed the string into this function, to create the matrix grid:</p>\n\n<pre><code>func makeGrid(s string, v Vector) [][]byte {\n    g := make([][]byte, v.y, v.x)\n    for k, c := range s {\n        g[k/v.x] = append(g[k/v.x], byte(c))\n    }\n    return g\n}\n</code></pre>\n\n<p>So for the first input for example, running the program will produce a grid like the following (strings instead of bytes included below for ease of reading):</p>\n\n<pre><code>[[W E A R E D I S C]\n [O V E R E D F L E]\n [E A T O N C E X X]]\n</code></pre>\n\n<p>However, when the program reaches this input:</p>\n\n<pre><code>{\"For lunch let's have peanut-butter and bologna sandwiches\", Vector{4, 12}, \"clockwise\"},\n</code></pre>\n\n<p>The following error is thrown:</p>\n\n<pre><code>panic: runtime error: makeslice: cap out of range\n</code></pre>\n\n<p>The same for this input:</p>\n\n<pre><code>{\"Why does it say paper jam when there is no paper jam?\", Vector{3, 14}, \"counter-clockwise\"},\n</code></pre>\n\n<p>I can totally get why the error is at runtime and not at compile, since there is no way for the compiler to know the size of the grid during compilation, so the panic can only occur at runtime.</p>\n\n<p>What I don't understand is that is I reverse the vectors in the inputs:</p>\n\n<pre><code>{\"For lunch let's have peanut-butter and bologna sandwiches\", Vector{12, 4}, \"clockwise\"},\n{\"Why does it say paper jam when there is no paper jam?\", Vector{14, 3}, \"counter-clockwise\"},\n</code></pre>\n\n<p>The error no longer occurs. The program runs fine.</p>\n\n<p>It only occurs in situations where the x value in the vector is smaller than the y value.</p>\n\n<p>Debugging and following the code through, I can't quite see why a grid with lots of short rows will throw an error, while a grid with few long rows won't.</p>\n\n<p>There seem to be a couple of other answers on here that might be related, but I can't see how I should modify my method to avoid the error.</p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["go", "rpc"], "comments": [{"owner": {"reputation": 850, "user_id": 3894119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fbc11920a94562910843e3c6c39ddf31?s=128&d=identicon&r=PG&f=1", "display_name": "Andy Aldo", "link": "https://stackoverflow.com/users/3894119/andy-aldo"}, "edited": false, "score": 0, "creation_date": 1528857444, "post_id": 50789199, "comment_id": 88661157, "body": "Is the error declared in a separate package?"}, {"owner": {"reputation": 850, "user_id": 3894119, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/fbc11920a94562910843e3c6c39ddf31?s=128&d=identicon&r=PG&f=1", "display_name": "Andy Aldo", "link": "https://stackoverflow.com/users/3894119/andy-aldo"}, "edited": false, "score": 0, "creation_date": 1528857638, "post_id": 50789199, "comment_id": 88661202, "body": "<a href=\"https://stackoverflow.com/questions/41560241/compare-error-message-in-golang#41560303\" title=\"compare error message in golang%2341560303\">stackoverflow.com/questions/41560241/&hellip;</a>"}], "owner": {"reputation": 11, "user_id": 8109292, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5490513a75e688a7da7a7b7db9b2a73?s=128&d=identicon&r=PG&f=1", "display_name": "vonzcy", "link": "https://stackoverflow.com/users/8109292/vonzcy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1528682647, "creation_date": 1528676781, "question_id": 50789199, "link": "https://stackoverflow.com/questions/50789199/global-defined-error-does-not-equal-in-rpc-return", "title": "Global defined error does not equal in RPC return", "body": "<p>I have a couple of error type variables defined globally. For example,</p>\n\n<pre><code>var ErrFileNotExist = errors.New(\"File does not exist\")\n</code></pre>\n\n<p>On server side, this is used as a return value in an RPC, for example,</p>\n\n<pre><code>func (t *Type) F(args *T1, reply *T2) error {\n   ...\n   // some code here.\n   return ErrFileNotExist\n}\n</code></pre>\n\n<p>But on client side invoking this RPC and getting the return value, compare it with the global <code>ErrFileNotExist</code>, it does not match. That is, </p>\n\n<pre><code>...\n// client set up\ne := c.Call(...)\nlog.Prinln(e) // File does not exist\nlog.Println(e == ErrFileNotExist)  // false\n</code></pre>\n\n<p>Why this happens? Is there any workaround?</p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 3183, "user_id": 216345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ffc76b5c6c4607d55b0796da63d67f0?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/216345/thomas"}, "is_accepted": true, "score": 4, "last_activity_date": 1528676612, "creation_date": 1528676612, "answer_id": 50789181, "question_id": 50788805, "link": "https://stackoverflow.com/questions/50788805/how-to-read-from-stdin-with-goroutines-in-golang/50789181#50789181", "title": "How to read from stdin with goroutines in Golang?", "body": "<p>What's going on here is that when you time out you still have a <code>fmt.Scanf</code> going in the previous goroutine. You're also allocating a new channel each loop. The end result means the scan from question 3 gets your first input of 4 and then tries to push it onto a channel that will never be read from. The second time you enter 4 it is read by the new goroutine and is then pushed onto the channel you're expecting to find the user's input on.</p>\n\n<p>I'd suggest, instead, that you offload the user input into a single goroutine that feeds a single channel.</p>\n\n<pre><code>func readInput(input chan&lt;- int) {\n    for {\n        var u int\n        _, err := fmt.Scanf(\"%d\\n\", &amp;u)\n        if err != nil {\n            panic(err)\n        }\n        input &lt;- u\n    }\n}\n</code></pre>\n\n<p>And then process your questions like so:</p>\n\n<pre><code>func main() {\n    var points int\n    userInput := make(chan int)\n\n    go readInput(userInput)\n\n    for i := 0; i &lt; len(questions); i++ {\n        fmt.Println(questions[i].Text)\n        fmt.Print(\"Enter answer \")\n\n        select {\n        case userAnswer := &lt;-userInput:\n            if userAnswer == questions[i].Answer {\n                fmt.Println(\"Correct answer:\", userAnswer)\n                points++\n            } else {\n                fmt.Println(\"Wrong answer\")\n            }\n        case &lt;-time.After(5 * time.Second):\n            fmt.Println(\"\\n Time is over!\")\n        }\n    }\n}\n</code></pre>\n\n<p>You would probably want to add some additional logic or handling to terminate the input reading goroutine at some point, depending on the actual life cycle of your program but that's a different problem.</p>\n"}], "owner": {"reputation": 91, "user_id": 2388914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5911dcd5e171886c756cb9e3f7dbe6f?s=128&d=identicon&r=PG", "display_name": "Ragnar", "link": "https://stackoverflow.com/users/2388914/ragnar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1220, "favorite_count": 0, "accepted_answer_id": 50789181, "answer_count": 1, "score": 0, "last_activity_date": 1528676612, "creation_date": 1528672018, "question_id": 50788805, "link": "https://stackoverflow.com/questions/50788805/how-to-read-from-stdin-with-goroutines-in-golang", "title": "How to read from stdin with goroutines in Golang?", "body": "<p>There is list of questions. I show question one after one to user and wait for user`s answer. Every question should be answered in some seconds( for example 5 second for question). If question is answered right and in time, then user get some points.\nMy code is looks like:</p>\n\n<pre><code> for i := 0; i &lt; len(questions); i++ {\n        fmt.Println(questions[i].Text)\n        ans := make(chan int)\n        go func() {\n            fmt.Print(\"Enter answer \")\n            var u int\n            fmt.Scanf(\"%d\\n\", &amp;u)\n            ans &lt;- u\n        }()\n\n        select {\n        case userAnswer := &lt;-ans:\n            if userAnswer == questions[i].Answer {\n                points++\n            }\n        case &lt;-time.After(5 * time.Second):\n            fmt.Println(\"\\n Time is over!\")\n        }\n    }\n</code></pre>\n\n<p>Problem is next: if user don`t answer to question, then he get message \"Time is over\", as expected. But next answer will not be processed, and user should type it again. It looks like next output:</p>\n\n<pre><code>question with answer  1\nEnter answer: 1\n1  is right answer\nquestion with answer  2\nEnter answer: 2\n2  is right answer\nquestion with answer  3\nEnter answer: \n Time is over!\nquestion with answer  4\nEnter answer: 4\n4\n4  is right answer\nquestion with answer  5\nEnter answer: 5\n5  is right answer\n</code></pre>\n\n<p>User did not answer to question #3, so he need to answer to question #4 twice.\nI understand that problem is because goroutines and channels. But I don`t understand, why was not value, that was read from stdin after timeout,  sent to or get from channel \"ans\".</p>\n\n<p>Why value from channel was not properly received after timeout? How I can rewrite code, so user don`t need to repeat input twice after timeout to previous question?</p>\n\n<p>Sorry for bad english and thanks for help.</p>\n"}, {"tags": ["go", "distributed-computing", "distributed-system", "file-sharing", "system-design"], "comments": [{"owner": {"reputation": 358, "user_id": 7105409, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-cTCYnuGzn1M/AAAAAAAAAAI/AAAAAAAAAw8/mNUReftTmbs/photo.jpg?sz=128", "display_name": "Eliad Cohen", "link": "https://stackoverflow.com/users/7105409/eliad-cohen"}, "edited": false, "score": 0, "creation_date": 1528688710, "post_id": 50788473, "comment_id": 88586403, "body": "You can use SMB"}], "answers": [{"tags": [], "owner": {"reputation": 3498, "user_id": 6801443, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09cba631e2b30cf9b6b8fa433996ef1e?s=128&d=identicon&r=PG&f=1", "display_name": "Sean F", "link": "https://stackoverflow.com/users/6801443/sean-f"}, "is_accepted": true, "score": 3, "last_activity_date": 1528670058, "creation_date": 1528670058, "answer_id": 50788635, "question_id": 50788473, "link": "https://stackoverflow.com/questions/50788473/which-protocol-should-i-use-to-exchange-files-between-multiple-nodes/50788635#50788635", "title": "Which protocol should I use to exchange files between multiple nodes?", "body": "<p>Web servers are designed to serve files (amongst other things).  </p>\n\n<p>I would recommend you use the http protocol and use <a href=\"https://golang.org/pkg/net/http/#FileServer\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#FileServer</a> which requires just a few lines of code to set up.</p>\n\n<p>If you need secure transmission then use https, also available with FileServer: <a href=\"https://golang.org/pkg/net/http/#ListenAndServeTLS\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#ListenAndServeTLS</a></p>\n"}], "owner": {"reputation": 1383, "user_id": 4167563, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/90cc579fcc609be0144e24cdd6e056fa?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/4167563/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 50788635, "answer_count": 1, "score": 0, "last_activity_date": 1528670058, "creation_date": 1528668399, "question_id": 50788473, "link": "https://stackoverflow.com/questions/50788473/which-protocol-should-i-use-to-exchange-files-between-multiple-nodes", "title": "Which protocol should I use to exchange files between multiple nodes?", "body": "<p>I have multiple nodes. Node is just a linux or windows server. Also I have one master node. The master node is manager of process of file sharing.</p>\n\n<p>This images shows process of communication:\n<a href=\"https://i.stack.imgur.com/vAYyv.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vAYyv.png\" alt=\"enter image description here\"></a></p>\n\n<p>So, I try to choose some protocol for this system, which I can implement (or just use some existing implementation). I need a file sharing protocol. I mean checking the checksum, managing a Internet bandwidth, managing the process of data exchange.</p>\n\n<p>File is just a binary data. File size is approximately 1-10 MB. The number of files in the system is approximately 1 million. 90% of all requests are write requests.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1528726823, "post_id": 50787804, "comment_id": 88605721, "body": "As projects grow and mature, you&#39;ll likely want to turn this on its head a little bit. As it stands, both your <code>app</code> <i>and</i> <code>main</code> packages are coupled to the database, which is something you would likely want to avoid from a design standpoint. Decoupling them would help to alleviate some of your dependency issues, but requires a little more care in design."}, {"owner": {"reputation": 395, "user_id": 636599, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/30eb9d8543d9f120fd762c6f53420ac7?s=128&d=identicon&r=PG", "display_name": "JSP", "link": "https://stackoverflow.com/users/636599/jsp"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1528750439, "post_id": 50787804, "comment_id": 88617708, "body": "@Adrian Do you have any goto example apps that show that decoupling?  I&#39;ve looked at a few for example the Netlify GoTrue API but I struggle sometimes to understand the big picture because there is so many packages / abstractions."}], "answers": [{"comments": [{"owner": {"reputation": 395, "user_id": 636599, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/30eb9d8543d9f120fd762c6f53420ac7?s=128&d=identicon&r=PG", "display_name": "JSP", "link": "https://stackoverflow.com/users/636599/jsp"}, "edited": false, "score": 1, "creation_date": 1528750253, "post_id": 50788205, "comment_id": 88617615, "body": "Thank you @mkopriva I would have thought that would be driver specific so didn&#39;t think to look there.  Also some how missed exposing a method so I could defer outside of the <code>app</code> package."}, {"owner": {"reputation": 1030, "user_id": 9361129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45466ce9795191da87750d302e809b87?s=128&d=identicon&r=PG&f=1", "display_name": "Wariored", "link": "https://stackoverflow.com/users/9361129/wariored"}, "edited": false, "score": 0, "creation_date": 1563268441, "post_id": 50788205, "comment_id": 100633941, "body": "Not closing the <b>DB</b> may cause the connections to time out. You can decide to not close it. Not a big deal but it&#39;s an issue if your process is starting and stopping a lot very quickly."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 9, "last_activity_date": 1528696851, "last_edit_date": 1528696851, "creation_date": 1528666071, "answer_id": 50788205, "question_id": 50787804, "link": "https://stackoverflow.com/questions/50787804/does-db-close-need-to-be-called/50788205#50788205", "title": "Does db.Close() need to be called?", "body": "<p>It's not necessary to close the DB.</p>\n\n<blockquote>\n  <p>The returned DB is safe for concurrent use by multiple goroutines and\n  maintains its own pool of idle connections. Thus, the Open function\n  should be called just once. It is rarely necessary to close a DB.</p>\n</blockquote>\n\n<p>From: <a href=\"https://golang.org/pkg/database/sql/#Open\" rel=\"noreferrer\">https://golang.org/pkg/database/sql/#Open</a></p>\n\n<p>When your program exits then any open connection is closed, it does not stay open somewhere in the ether awaiting your program to start again, so do not worry about the connections \"growing\" when you CTRL-C your app.</p>\n\n<hr>\n\n<p>If, however, you still want to close it, then you can just export a <code>CloseDB</code> function the same way you do with <code>GetDB</code>.</p>\n\n<p>App.go</p>\n\n<pre><code>// ...\n\nfunc CloseDB() error {\n    return db.Close()\n}\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>// ...\n\nfunc main() {\n    // ...\n\n    app.Setup()\n    defer app.CloseDB()\n\n    // ...\n\n}\n</code></pre>\n"}], "owner": {"reputation": 395, "user_id": 636599, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/30eb9d8543d9f120fd762c6f53420ac7?s=128&d=identicon&r=PG", "display_name": "JSP", "link": "https://stackoverflow.com/users/636599/jsp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5740, "favorite_count": 3, "accepted_answer_id": 50788205, "answer_count": 1, "score": 5, "last_activity_date": 1604256866, "creation_date": 1528662849, "last_edit_date": 1604256866, "question_id": 50787804, "link": "https://stackoverflow.com/questions/50787804/does-db-close-need-to-be-called", "title": "Does db.Close() need to be called?", "body": "<p>So far the hardest part of Go has been understanding how to organize code.  It seems incredibly simple on it's face but every time I've tried to do anything I run into circular imports or things like \"exported func Start returns unexported type models.dbStore, which can be annoying to use\".</p>\n\n<p>Using the following code how do I call <code>db.Close()</code> or am I really not understanding how I'm supposed to provide the database to my models.  Here's what I've got:</p>\n\n<p>App.go</p>\n\n<pre><code>package app\n\nimport (\n    \"database/sql\"\n\n    // Comment\n    _ \"github.com/mattn/go-sqlite3\"\n)\n\nvar (\n    // DB The database connection\n    db *sql.DB\n)\n\n// Setup Sets up the many many app settings\nfunc Setup() {\n    d, err := sql.Open(\"sqlite3\", \"./foo.db\")\n    if err != nil {\n        panic(err)\n    }\n\n    // TODO: How does the DB get closed?\n    // defer db.Close()\n    db = d\n}\n\n// GetDB Returns a reference to the database\nfunc GetDB() *sql.DB {\n    return db\n}\n</code></pre>\n\n<p>Users.go</p>\n\n<pre><code>package models\n\nimport (\n    \"github.com/proj/org/app\"\n)\n\n// User struct\ntype User struct {\n    ID int\n}\n\n// CreateUser Creates a user\nfunc (u *User) CreateUser() (int64, error) {\n\n    // For the sake of brevity just make sure you can\n    // \"connect\" to the database\n    if err := app.GetDB().Ping(); err != nil {\n        panic(err)\n    }\n\n    return 1234, nil\n}\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    _ \"github.com/mattn/go-sqlite3\"\n    \"github.com/proj/org/app\"\n    \"github.com/proj/org/models\"\n)\n\nfunc homeHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"You are home\")\n}\n\nfunc subscribeHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Subscribing...\")\n    u := models.User{}\n\n    u.CreateUser()\n\n}\n\nfunc main() {\n    fmt.Println(\"Running\")\n\n    app.Setup()\n\n    http.HandleFunc(\"/\", homeHandler)\n    http.HandleFunc(\"/subscribe\", subscribeHandler)\n\n    err := http.ListenAndServe(\":9090\", nil)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>I thought about doing a <code>app.Shutdown()</code> but that wouldn't work for my most normal use case which is CTRL-C.  It would seem if I don't close the database the DB connections would just grow... Just trying to understand.</p>\n"}, {"tags": ["go", "udp", "minecraft", "datagram", "raknet"], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 9922018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5ead775bf24afb7cdef765df0b814f9?s=128&d=identicon&r=PG&f=1", "display_name": "xBeastMode", "link": "https://stackoverflow.com/users/9922018/xbeastmode"}, "is_accepted": true, "score": 0, "last_activity_date": 1529131971, "creation_date": 1529131971, "answer_id": 50885673, "question_id": 50787346, "link": "https://stackoverflow.com/questions/50787346/localhost-udp-client-not-receiving-packets-from-udp-proxy/50885673#50885673", "title": "Localhost UDP client not receiving packets from UDP proxy", "body": "<p>After so much debugging and testing, I figured I just needed to continue sending the datagram buffers, if it came from the server send it to client and vice-versa. If I cancelled the packet from sending I needed to send an ACK. It was all that simple.</p>\n"}], "owner": {"reputation": 21, "user_id": 9922018, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5ead775bf24afb7cdef765df0b814f9?s=128&d=identicon&r=PG&f=1", "display_name": "xBeastMode", "link": "https://stackoverflow.com/users/9922018/xbeastmode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 467, "favorite_count": 1, "closed_date": 1529182367, "accepted_answer_id": 50885673, "answer_count": 1, "score": 0, "last_activity_date": 1529131971, "creation_date": 1528659221, "last_edit_date": 1529123414, "question_id": 50787346, "link": "https://stackoverflow.com/questions/50787346/localhost-udp-client-not-receiving-packets-from-udp-proxy", "closed_reason": "Not suitable for this site", "title": "Localhost UDP client not receiving packets from UDP proxy", "body": "<p>I have a proxy that acts between a Minecraft (Windows 10 Edition) client and a server, the protocol is UDP. The client broadcasts an unconnected ping, then server replies with an unconnected pong, everything with that is okay. The thing is when the server sends the packet to my proxy, my proxy sends it to client but for some reason something happens during that part; either my proxy is not sending the packet or the client is not receiving the packet, but most likely it's the second option.</p>\n\n<p>Edit: I got the unconnected pings and pongs working, now the server shows online on the server list, now the problem is mainly the open connection requests/replies. How I got the the pings and pongs working was I re-encoded the buffers and send them instead of sending them raw.</p>\n\n<p>Here you can see from wireshark, the minecraft client sends an unconnected ping the proxy:</p>\n\n<pre><code>NO. Time.       Source.     Dest.       Proto.  Len. Packet\n417 10.452413   10.0.0.248  10.0.0.255  RakNet  75   Unconnected Ping (client -&gt; proxy)\n430 10.457000   10.0.0.248  x.x.x.x     RakNet  610  Unconnected Ping (proxy -&gt; server)\n431 10.587214   x.x.x.x     10.0.0.248  RakNet  212  Unconnected Pong (server -&gt; proxy -&gt; client)\n</code></pre>\n\n<p>Now the proxy receive the unconnected pong, send it to the client, and the client doesn't receive it, I can confirm this because on the game the server shows offline and doesn't show any data:</p>\n\n<p><a href=\"https://i.stack.imgur.com/zpwI2.png\" rel=\"nofollow noreferrer\">Localhost Server Screenshot</a></p>\n\n<p>In my code, I first bind the proxy on port 19132 and set the server address I want to communicate with: </p>\n\n<pre><code>var config = NewConfig()\nvar proxy = Proxy{}\n\nvar err error\n\nproxy.UDPConn, err = net.ListenUDP(\"udp\", &amp;net.UDPAddr{IP: net.ParseIP(config.BindAddr), Port: config.BindPort})\n\nif err != nil {\n    Panic(err.Error())\n    os.Exit(1)\n}\n\nInfo(\"Starting proxy on \" + config.BindAddr + \":\" + strconv.Itoa(config.BindPort))\n\naddrs, err := net.LookupHost(config.ServerAddr)\n\nif err != nil {\n    Panic(err.Error())\n    os.Exit(1)\n}\n\nconn := NewConnection(&amp;proxy)\nconn.server.SetAddress(net.UDPAddr{IP: net.ParseIP(addrs[0]), Port: config.ServerPort})\n\nconn.HandleIncomingPackets()\n</code></pre>\n\n<p>Now my proxy starts receiving and sending packets automatically.</p>\n\n<pre><code>for true {\n    buffer := make([]byte, 2048)\n    _, addr, err := conn.proxy.UDPConn.ReadFromUDP(buffer)\n\n    if err != nil {\n        Alert(err.Error())\n        continue\n    }\n\n    MessageId := buffer[0]\n\n    Debug(\"Message Id : \" + strconv.Itoa(int(MessageId))) // this is the packet id\n\n    if conn.client.IsConnected() { // client is connected\n        if conn.IsServer(*addr) {\n            conn.pkHandler.HandleIncomingPacket(buffer, conn.client) // if server send to client\n        }else{\n            conn.pkHandler.HandleIncomingPacket(buffer, conn.server) // if client send to server\n        }\n    } else {\n        switch MessageId {\n        case byte(IdUnconnectedPingOpenConnection):\n            conn.handleUnconnectedPing(*addr, buffer) // send this server\n            break\n        case byte(IdUnconnectedPongOpenConnection):\n            conn.handleUnconnectedPong(*addr, buffer) // parse server data and send to client\n            break\n        case byte(IdOpenConnectionRequest1):\n            conn.handleConnectionRequest1(*addr, buffer) // connect client and send to server\n            break\n        //case byte(IdOpenConnectionReply1):\n        //  conn.handleConnectionReply1(*addr, buffer)\n        //  break\n        }\n    }\n}\n</code></pre>\n\n<p>This is the message id log:</p>\n\n<pre><code>[2018-06-10 13:52:12][Log/DEBUG]: Message Id : 1\n[2018-06-10 13:52:12][Log/INFO]: Received unconnected ping from client address: 10.0.0.248\n[2018-06-10 13:52:12][Log/DEBUG]: Message Id : 28\n[2018-06-10 13:52:12][Log/INFO]: Received unconnected pong from server address: x.x.x.x\n[2018-06-10 13:52:13][Log/DEBUG]: Message Id : 1\n[2018-06-10 13:52:13][Log/INFO]: Received unconnected ping from client address: 10.0.0.248\n[2018-06-10 13:52:13][Log/DEBUG]: Message Id : 28\n[2018-06-10 13:52:13][Log/INFO]: Received unconnected pong from server address: x.x.x.x\n</code></pre>\n\n<p>Another way I confirmed the client is not receiving packets is that when in the game I click the server in the server list, the client sends an <code>open connection request 1 (5)</code> and the server replies with <code>open connection reply 1 (6)</code>, the client is supposed to receive this and continue with an <code>open connection request 2 (7)</code> then finally the server replies with <code>open connection reply 2 (8)</code>, but the client never sends <code>open connection request 2 (7)</code>, because it never got the <code>open connection reply 1 (6)</code> from the proxy and hence times out and disconnects, here is a log showing this:</p>\n\n<pre><code>[2018-06-10 11:07:46][Log/DEBUG]: Message Id : 5\n[5 0 255 255 0 254 254 254 254 253 253 253 253 18 52 86 120 8]\n[2018-06-10 11:07:47][Log/DEBUG]: Message Id : 6\n[6 0 255 255 0 254 254 254 254 253 253 253 253 18 52 86 120 36 149 162 237 197 55 226 161 0 8 28]\n[2018-06-10 11:07:47][Log/DEBUG]: Message Id : 5\n[5 0 255 255 0 254 254 254 254 253 253 253 253 18 52 86 120 8]\n[2018-06-10 11:07:47][Log/DEBUG]: Message Id : 6\n[6 0 255 255 0 254 254 254 254 253 253 253 253 18 52 86 120 36 149 162 237 197 55 226 161 0 8 28]\n[2018-06-10 11:07:47][Log/DEBUG]: Message Id : 1\n[1 0 0 0 0 3 3 91 191 0 255 255 0 254 254 254 254 253 253 253 253 18 52 86 120 191 216 14 215 31 123 8 249]\n</code></pre>\n"}, {"tags": ["docker", "go", "kubernetes"], "comments": [{"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 3, "creation_date": 1528648637, "post_id": 50785784, "comment_id": 88578110, "body": "Typically this means you&#39;re trying to invoke an executable compiled for a different platform. Is this really a 64-bit Intel/AMD Linux platform?"}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1528648755, "post_id": 50785784, "comment_id": 88578150, "body": "What does <code>file &#47;go&#47;bin&#47;api</code> emit? If the file already exists in the working tree you <code>COPY</code>, <code>go build</code> won&#39;t recreate it, so if you were starting with, say, a MacOS binary in that position, then it wouldn&#39;t get replaced, and that would explain our error."}, {"owner": {"reputation": 717, "user_id": 4445988, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/HPoQw.jpg?s=128&g=1", "display_name": "GwydionFR", "link": "https://stackoverflow.com/users/4445988/gwydionfr"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1528666093, "post_id": 50785784, "comment_id": 88582721, "body": "@CharlesDuffy I compile the binary in the first step, and the machine hosting the kubernetes node is a Container Optimized Os (by google). Plus, the file does not already exists in the tree... Im desperate"}, {"owner": {"reputation": 200, "user_id": 7930347, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d39c316849d3a5265c2251d7d752751?s=128&d=identicon&r=PG&f=1", "display_name": "elia", "link": "https://stackoverflow.com/users/7930347/elia"}, "edited": false, "score": 0, "creation_date": 1528685794, "post_id": 50785784, "comment_id": 88585963, "body": "you have to figure out the arch of the hosting machine, and you need to see the arch type of the images you have, I have faced the same problem when I was running images compiled on  x64 on Rpi(arm), the solution was simply compiling in the hosting machine, or cross compiling with the right arch.  another cause of such a problem is heterogenous cluster where the master node have different arch than that of workers, the images will be pulled according to the master."}, {"owner": {"reputation": 717, "user_id": 4445988, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/HPoQw.jpg?s=128&g=1", "display_name": "GwydionFR", "link": "https://stackoverflow.com/users/4445988/gwydionfr"}, "edited": false, "score": 0, "creation_date": 1528700395, "post_id": 50785784, "comment_id": 88589913, "body": "ssh on the machine and <code>arch</code> gives <code>x86_64</code> and <code>uname -a</code> gives <code>Linux gke-teddycare-dev-default-pool-b1d4c5d3-2fnm 4.4.111+ #1 SMP Thu Apr 19 11:45:40 PDT 2018 x86_64 Intel(R) Xeon(R) CPU @ 2.60GHz</code>GenuineIntel GNU/Linux`. Im building for GOARCH=amd64 (?)"}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1528730732, "post_id": 50785784, "comment_id": 88608240, "body": "Again, what&#39;s the <code>file</code> output?"}, {"owner": {"reputation": 717, "user_id": 4445988, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/HPoQw.jpg?s=128&g=1", "display_name": "GwydionFR", "link": "https://stackoverflow.com/users/4445988/gwydionfr"}, "reply_to_user": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1528786238, "post_id": 50785784, "comment_id": 88627070, "body": "@CharlesDuffy There is no <code>file</code> command, even when I switched to <code>golang:stretch</code>"}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1528816623, "post_id": 50785784, "comment_id": 88646419, "body": "For future note -- you can copy the binary out of the container and run <code>file</code> on your host."}], "answers": [{"tags": [], "owner": {"reputation": 717, "user_id": 4445988, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/HPoQw.jpg?s=128&g=1", "display_name": "GwydionFR", "link": "https://stackoverflow.com/users/4445988/gwydionfr"}, "is_accepted": false, "score": 0, "last_activity_date": 1528804137, "last_edit_date": 1592644375, "creation_date": 1528804137, "answer_id": 50816450, "question_id": 50785784, "link": "https://stackoverflow.com/questions/50785784/standard-init-linux-go178-exec-user-process-caused-exec-format-error-kuberne/50816450#50816450", "title": "standard_init_linux.go:178: exec user process caused &quot;exec format error&quot; kubernetes", "body": "<p>Ok I found the issue. I post it here, in case someone is stupid like me.\nI made a change in my github repository, transforming 1 project/microservices into 1 monorepo for every microservices.\nDuring the refactor, I had no package <code>main</code> in my <code>api</code> microservice, and the go build DID NOT fail, but wrote a file of <code>90 Ko</code> in the output destination.</p>\n<h3>SOLUTION</h3>\n<p>Ensure to have a main package</p>\n<p>I feel really stupid but hey, it happens to everyone.</p>\n<p>Thank you to commentators, you were right</p>\n"}, {"tags": [], "owner": {"reputation": 140, "user_id": 2128734, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/33dfce550ae9501a164d3c91c02a4249?s=128&d=identicon&r=PG", "display_name": "Anne van der Bom", "link": "https://stackoverflow.com/users/2128734/anne-van-der-bom"}, "is_accepted": false, "score": 0, "last_activity_date": 1558950204, "creation_date": 1558950204, "answer_id": 56323489, "question_id": 50785784, "link": "https://stackoverflow.com/questions/50785784/standard-init-linux-go178-exec-user-process-caused-exec-format-error-kuberne/56323489#56323489", "title": "standard_init_linux.go:178: exec user process caused &quot;exec format error&quot; kubernetes", "body": "<p>Although not the solution to this question, another cause may be if your command is a script without shebang.</p>\n"}], "owner": {"reputation": 717, "user_id": 4445988, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/HPoQw.jpg?s=128&g=1", "display_name": "GwydionFR", "link": "https://stackoverflow.com/users/4445988/gwydionfr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1743, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1558950204, "creation_date": 1528648170, "last_edit_date": 1528802444, "question_id": 50785784, "link": "https://stackoverflow.com/questions/50785784/standard-init-linux-go178-exec-user-process-caused-exec-format-error-kuberne", "title": "standard_init_linux.go:178: exec user process caused &quot;exec format error&quot; kubernetes", "body": "<p>I know this issue has been encountered by many people, but none of the given answers resolved my issue.</p>\n\n<h2>Workflow</h2>\n\n<ul>\n<li>I run all my dockers in a kubernetes cluster (google cloud).</li>\n<li>I've setup the compilation_trigger to auto build my dockerfile when I commit in my master branch on github.</li>\n<li>Then I update my kubernetes deployment with <code>kubectl set image deployment/MYPROJECT MYPROJECT=eu.gcr.io/foo/MYPROJECT:$TRAVIS_COMMIT</code></li>\n</ul>\n\n<h2>Whats wrong ?</h2>\n\n<p>My pod stays in <code>crashloop back-off</code> and in the logs I read: <code>standard_init_linux.go:178: exec user process caused \"exec format error\"</code></p>\n\n<h2>A bit of context</h2>\n\n<p>My workflow used to work untill the begining of June 2018, I don't understand what's wrong so Ive searched on the internet, modified my dockerfile, updated my dependencies, changed the dockerfile base image version, etc... Nothing works</p>\n\n<h3>Dockerfile</h3>\n\n<pre><code>FROM golang:1.10-alpine3.7 AS builder\nADD . /go/src/github.com/foo/MYPROJECT\nWORKDIR /go/src/github.com/foo/MYPROJECT/api\nRUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -ldflags \"-s -w\" -a -installsuffix cgo -o /go/bin/api\n\nFROM alpine:3.7\nRUN apk --no-cache add ca-certificates\nCOPY --from=builder /go/bin/api /go/bin/api\nCOPY --from=builder /go/src/github.com/foo/MYPROJECT/api/sql /go/migrations/sql\nCOPY --from=builder /go/src/github.com/foo/MYPROJECT/api/.docs/swagger.yml /static/swagger.yml\nRUN chmod +x /go/bin/api\nENTRYPOINT [\"/go/bin/api\"]\n</code></pre>\n\n<h3>[EDIT: 12 June]</h3>\n\n<p>I noticed the docker image size went from <code>6.3 Mo</code> to <code>2.3 Mo</code> when the problem started. I suspect an update from alpine, I continue to investigate.</p>\n"}, {"tags": ["go", "kubernetes", "kubectl", "client-go"], "comments": [{"owner": {"reputation": 2167, "user_id": 9485673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ed2a1368458a1ccc06a39dbcab4ab75?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Rak", "link": "https://stackoverflow.com/users/9485673/nick-rak"}, "edited": false, "score": 2, "creation_date": 1528730849, "post_id": 50784830, "comment_id": 88608321, "body": "Could you call <code>go run .&#47;main.go --kubeconfig &#47;path&#47;to&#47;your&#47;kubeconfig&#47;file</code> and tell the result."}, {"owner": {"reputation": 9428, "user_id": 405623, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/cdf09a1628df619e523dbbedfb0e07f3?s=128&d=identicon&r=PG", "display_name": "shershen", "link": "https://stackoverflow.com/users/405623/shershen"}, "reply_to_user": {"reputation": 2167, "user_id": 9485673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ed2a1368458a1ccc06a39dbcab4ab75?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Rak", "link": "https://stackoverflow.com/users/9485673/nick-rak"}, "edited": false, "score": 1, "creation_date": 1528734424, "post_id": 50784830, "comment_id": 88610374, "body": "What I should put to config file ? Output of the &#39;kubectl config view&#39; ?"}, {"owner": {"reputation": 9428, "user_id": 405623, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/cdf09a1628df619e523dbbedfb0e07f3?s=128&d=identicon&r=PG", "display_name": "shershen", "link": "https://stackoverflow.com/users/405623/shershen"}, "reply_to_user": {"reputation": 2167, "user_id": 9485673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ed2a1368458a1ccc06a39dbcab4ab75?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Rak", "link": "https://stackoverflow.com/users/9485673/nick-rak"}, "edited": false, "score": 1, "creation_date": 1528785290, "post_id": 50784830, "comment_id": 88626609, "body": "I&#39;ve tried the following: <code>$ kubectl config view &gt; kubeconfig</code>, and then <code>KUBERNETES_SERVICE_HOST=localhost KUBERNETES_SERVICE_PORT=6443 go run .&#47;main.go --kubeconfig .&#47;kubeconfig</code> and have the same error:  <code>panic: open &#47;var&#47;run&#47;secrets&#47;kubernetes.io&#47;serviceaccount&#47;token: no such file or directory </code>"}, {"owner": {"reputation": 2167, "user_id": 9485673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ed2a1368458a1ccc06a39dbcab4ab75?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Rak", "link": "https://stackoverflow.com/users/9485673/nick-rak"}, "edited": false, "score": 1, "creation_date": 1528809124, "post_id": 50784830, "comment_id": 88641214, "body": "Try to execute exactly that command without env variables."}, {"owner": {"reputation": 9428, "user_id": 405623, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/cdf09a1628df619e523dbbedfb0e07f3?s=128&d=identicon&r=PG", "display_name": "shershen", "link": "https://stackoverflow.com/users/405623/shershen"}, "reply_to_user": {"reputation": 2167, "user_id": 9485673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ed2a1368458a1ccc06a39dbcab4ab75?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Rak", "link": "https://stackoverflow.com/users/9485673/nick-rak"}, "edited": false, "score": 1, "creation_date": 1528823493, "post_id": 50784830, "comment_id": 88649788, "body": "@NickRak I am sorry correction: I was running this example - <code>Authenticating inside the cluster</code> - referencing the <a href=\"https://github.com/kubernetes/client-go/blob/master/examples/in-cluster-client-configuration/main.go\" rel=\"nofollow noreferrer\">github.com/kubernetes/client-go/blob/master/examples/&hellip;</a> - this is the one that fail with error. The example <code>out-of-cluster-client-configuration</code> <a href=\"https://github.com/kubernetes/client-go/tree/master/examples/out-of-cluster-client-configuration\" rel=\"nofollow noreferrer\">github.com/kubernetes/client-go/tree/master/examples/&hellip;</a> - works fine for me"}, {"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 1, "creation_date": 1528868026, "post_id": 50784830, "comment_id": 88663571, "body": "@shershen, the example you are using is supposed to be run inside a pod running in the cluster and not on host machines. Are you running this inside a pod?"}, {"owner": {"reputation": 9428, "user_id": 405623, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/cdf09a1628df619e523dbbedfb0e07f3?s=128&d=identicon&r=PG", "display_name": "shershen", "link": "https://stackoverflow.com/users/405623/shershen"}, "reply_to_user": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 1, "creation_date": 1529051542, "post_id": 50784830, "comment_id": 88745209, "body": "@TarunLalwani you are right I am checking the right config to run inside the kluster"}, {"owner": {"reputation": 2167, "user_id": 9485673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ed2a1368458a1ccc06a39dbcab4ab75?s=128&d=identicon&r=PG&f=1", "display_name": "Nick Rak", "link": "https://stackoverflow.com/users/9485673/nick-rak"}, "edited": false, "score": 1, "creation_date": 1529319101, "post_id": 50784830, "comment_id": 88815431, "body": "Could you provide output of command <code>kubectl describe pods $name_of_pod_where_you_run_client</code> I`m intrested in section mounted secret."}, {"owner": {"reputation": 4541, "user_id": 12257134, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBxwWKVlF4L8us3lQYXAJR7lOUmb1AU-rdlXteadQ=k-s128", "display_name": "Dawid Kruk", "link": "https://stackoverflow.com/users/12257134/dawid-kruk"}, "edited": false, "score": 0, "creation_date": 1616438707, "post_id": 50784830, "comment_id": 117997914, "body": "One of the possible reasons why you get this error is by the lack of <code>token</code> in your <code>&#47;var&#47;run&#47;secrets&#47;kubernetes.io&#47;serviceaccount&#47;</code> when inside a <code>Pod</code>. For example it could be cased by: <code>automountServiceAccountToken: false</code> in either <code>Pod</code> manifest or <code>ServiceAccount</code> manifest."}, {"owner": {"reputation": 2304, "user_id": 10347794, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f789eeaaa46141793c051f2446397400?s=128&d=identicon&r=PG&f=1", "display_name": "Nepomucen", "link": "https://stackoverflow.com/users/10347794/nepomucen"}, "edited": false, "score": 0, "creation_date": 1618245306, "post_id": 50784830, "comment_id": 118538523, "body": "@shershen, could you please edit your original question, so that it matches your real intend. You are actually trying to use in-cluster-client-configuration, whereas you state opposite - &quot;I took code from the example: out-of-cluster-client-configuration.&quot;. It&#39;s misleading the audience, and actually you have a dozen of correct hints and answers to choose from to solve your issue now. Please pick up the one that suits you the most, and close this thread."}], "answers": [{"tags": [], "owner": {"reputation": 907, "user_id": 3941521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74b7ef9032f2ef4c8420fa0e58d159db?s=128&d=identicon&r=PG&f=1", "display_name": "samhain1138", "link": "https://stackoverflow.com/users/3941521/samhain1138"}, "is_accepted": false, "score": 0, "last_activity_date": 1537885833, "creation_date": 1537885833, "answer_id": 52500668, "question_id": 50784830, "link": "https://stackoverflow.com/questions/50784830/fail-to-connect-to-kubectl-from-client-go-serviceaccount-token-no-such-file/52500668#52500668", "title": "Fail to connect to kubectl from client-go - /serviceaccount/token: no such file", "body": "<p>Just to make it clear, in case it helps you further debug it: the problem has nothing to do with Go or your code, and everything to do with the Kubernetes node not being able to get a token from the Kubernetes master.</p>\n\n<p>In <code>kubectl config view</code>, <code>clusters.cluster.server</code> should probably point at an IP address that the <em>node</em> can reach.<br>\nIt needs to access the CA, i.e., the master, in order to provide that token, and I'm guessing it fails to for that reason.<br>\n<code>kubectl describe &lt;your_pod_name&gt;</code> would probably tell you what the problem was acquiring the token.</p>\n\n<p>Since you assumed the problem was Go/your code and focused on that, you neglected to provide more information about your Kubernetes setup, which makes it more difficult for me to give you a better answer than my guess above ;-)</p>\n\n<p>But I hope it helps!</p>\n"}, {"tags": [], "owner": {"reputation": 4541, "user_id": 12257134, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mBxwWKVlF4L8us3lQYXAJR7lOUmb1AU-rdlXteadQ=k-s128", "display_name": "Dawid Kruk", "link": "https://stackoverflow.com/users/12257134/dawid-kruk"}, "is_accepted": false, "score": 0, "last_activity_date": 1617014551, "creation_date": 1617014551, "answer_id": 66852753, "question_id": 50784830, "link": "https://stackoverflow.com/questions/50784830/fail-to-connect-to-kubectl-from-client-go-serviceaccount-token-no-such-file/66852753#66852753", "title": "Fail to connect to kubectl from client-go - /serviceaccount/token: no such file", "body": "<p>This answer could be a little outdated but I will try to give more perspective/baseline for future readers that encounter the same/similar problem.</p>\n<p><strong>TL;DR</strong></p>\n<p>The following error:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>panic: open /var/run/secrets/kubernetes.io/serviceaccount/token: no such file or directory\n</code></pre>\n<p>is most likely connected with the lack of <code>token</code> in the <code>/var/run/secrets/kubernetes.io/serviceaccount</code> location when using <strong><code>in-cluster-client-configuration</code></strong>. Also, it could be related to the fact of using <strong><code>in-cluster-client-configuration</code></strong> code outside of the cluster (for example running this code directly on a laptop or in pure Docker container).</p>\n<p>You can check following commands to troubleshoot your issue further (assuming this code is running inside a <code>Pod</code>):</p>\n<ul>\n<li><code>$ kubectl get serviceaccount X -o yaml</code>:\n<ul>\n<li>look for: <code>automountServiceAccountToken: false</code></li>\n</ul>\n</li>\n<li><code>$ kubectl describe pod XYZ</code>\n<ul>\n<li>look for: <code>containers.mounts</code> and <code>volumeMounts</code> where <code>Secret</code> is mounted</li>\n</ul>\n</li>\n</ul>\n<p>Citing the official documentation:</p>\n<blockquote>\n<h3>Authenticating inside the cluster</h3>\n<p>This example shows you how to configure a client with client-go to authenticate to the Kubernetes API from an application running <strong>inside the Kubernetes cluster.</strong></p>\n<p>client-go uses the <a href=\"https://kubernetes.io/docs/admin/authentication/#service-account-tokens\" rel=\"nofollow noreferrer\">Service Account token</a> <strong>mounted inside the Pod</strong> at the <code>/var/run/secrets/kubernetes.io/serviceaccount</code> path when the <code>rest.InClusterConfig()</code> is used.</p>\n<p>-- <em><a href=\"https://github.com/kubernetes/client-go/tree/master/examples/in-cluster-client-configuration#authenticating-inside-the-cluster\" rel=\"nofollow noreferrer\">Github.com: Kubernetes: client-go: Examples: in cluster client configuration</a></em></p>\n</blockquote>\n<p>If you are authenticating to the Kubernetes API with <code>~/.kube/config</code> you should be using the <strong><code>out-of-cluster-client-configuration</code></strong>.</p>\n<hr />\n<h3>Additional information:</h3>\n<p>I've added additional information for more reference on further troubleshooting when the code is run inside of a <code>Pod</code>.</p>\n<ul>\n<li><code>automountServiceAccountToken: false</code></li>\n</ul>\n<blockquote>\n<p>In version 1.6+, you can opt out of automounting API credentials for a service account by setting automountServiceAccountToken: false on the service account:</p>\n<pre class=\"lang-yaml prettyprint-override\"><code>apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: go-serviceaccount\nautomountServiceAccountToken: false\n</code></pre>\n<p>In version 1.6+, you can also opt out of automounting API credentials for a particular pod:</p>\n<pre class=\"lang-yaml prettyprint-override\"><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: sdk\nspec:\n serviceAccountName: go-serviceaccount\n automountServiceAccountToken: false\n</code></pre>\n<p>-- <em><a href=\"https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/#use-the-default-service-account-to-access-the-api-server\" rel=\"nofollow noreferrer\">Kubernetes.io: Docs: Tasks: Configure pod container: Configure service account</a></em></p>\n</blockquote>\n<ul>\n<li><code>$ kubectl describe pod XYZ</code>:</li>\n</ul>\n<p>When the <code>servicAccount</code> token is mounted, the <code>Pod</code> definition should look like this:</p>\n<pre><code>&lt;-- OMITTED --&gt; \n    Mounts:\n      /var/run/secrets/kubernetes.io/serviceaccount from go-serviceaccount-token-4rst8 (ro)\n&lt;-- OMITTED --&gt; \nVolumes:\n  go-serviceaccount-token-4rst8:\n    Type:        Secret (a volume populated by a Secret)\n    SecretName:  go-serviceaccount-token-4rst8\n    Optional:    false\n</code></pre>\n<p>If it's not:</p>\n<pre><code>&lt;-- OMITTED --&gt; \n    Mounts:         &lt;none&gt;\n&lt;-- OMITTED --&gt; \nVolumes:            &lt;none&gt;\n</code></pre>\n<hr />\n<p>Additional resources:</p>\n<ul>\n<li><em><a href=\"https://kubernetes.io/docs/reference/access-authn-authz/authentication/\" rel=\"nofollow noreferrer\">Kubernetes.io: Docs: Reference: Access authn authz: Authentication</a></em></li>\n</ul>\n"}], "owner": {"reputation": 9428, "user_id": 405623, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/cdf09a1628df619e523dbbedfb0e07f3?s=128&d=identicon&r=PG", "display_name": "shershen", "link": "https://stackoverflow.com/users/405623/shershen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1402, "favorite_count": 2, "answer_count": 2, "score": 5, "last_activity_date": 1617014551, "creation_date": 1528641710, "question_id": 50784830, "link": "https://stackoverflow.com/questions/50784830/fail-to-connect-to-kubectl-from-client-go-serviceaccount-token-no-such-file", "title": "Fail to connect to kubectl from client-go - /serviceaccount/token: no such file", "body": "<p>I am using golang lib <a href=\"https://github.com/kubernetes/client-go\" rel=\"noreferrer\">client-go</a> to connect to a running local kubrenets. To start with I took code from the example: <a href=\"https://github.com/kubernetes/client-go/tree/master/examples/out-of-cluster-client-configuration\" rel=\"noreferrer\">out-of-cluster-client-configuration</a>.</p>\n\n<p>Running a code like this:\n<code>$ KUBERNETES_SERVICE_HOST=localhost KUBERNETES_SERVICE_PORT=6443 go run ./main.go</code> results in following error:</p>\n\n<pre><code>panic: open /var/run/secrets/kubernetes.io/serviceaccount/token: no such file or directory\n\ngoroutine 1 [running]:\n\n/var/run/secrets/kubernetes.io/serviceaccount/\n</code></pre>\n\n<p>I am not quite sure which part of configuration I am missing. I've researched following links :</p>\n\n<ul>\n<li><p><a href=\"https://kubernetes.io/docs/reference/access-authn-authz/authentication/#client-go-credential-plugins\" rel=\"noreferrer\">https://kubernetes.io/docs/reference/access-authn-authz/authentication/#client-go-credential-plugins</a></p></li>\n<li><p><a href=\"https://kubernetes.io/docs/reference/access-authn-authz/service-accounts-admin/\" rel=\"noreferrer\">https://kubernetes.io/docs/reference/access-authn-authz/service-accounts-admin/</a></p></li>\n</ul>\n\n<p>But with no luck.\nI guess I need to either let the client-go know which token/serviceAccount to use, or configure kubectl in a way that everyone can connect to its api.</p>\n\n<p>Here's status of my kubectl though some commands results:</p>\n\n<p><strong>$ kubectl config view</strong></p>\n\n<pre><code>apiVersion: v1\nclusters:\n- cluster:\n    insecure-skip-tls-verify: true\n    server: https://localhost:6443\n  name: docker-for-desktop-cluster\ncontexts:\n- context:\n    cluster: docker-for-desktop-cluster\n    user: docker-for-desktop\n  name: docker-for-desktop\ncurrent-context: docker-for-desktop\nkind: Config\npreferences: {}\nusers:\n- name: docker-for-desktop\n  user:\n    client-certificate-data: REDACTED\n    client-key-data: REDACTED\n</code></pre>\n\n<p><strong>$ kubectl get serviceAccounts</strong></p>\n\n<pre><code>NAME        SECRETS   AGE\ndefault     1         3d\ntest-user   1         1d\n</code></pre>\n\n<p><strong>$ kubectl describe serviceaccount test-user</strong></p>\n\n<pre><code>Name:                test-user\nNamespace:           default\nLabels:              &lt;none&gt;\nAnnotations:         &lt;none&gt;\nImage pull secrets:  &lt;none&gt;\nMountable secrets:   test-user-token-hxcsk\nTokens:              test-user-token-hxcsk\nEvents:              &lt;none&gt;\n</code></pre>\n\n<p><strong>$ kubectl get secret test-user-token-hxcsk -o yaml</strong></p>\n\n<pre><code>apiVersion: v1\ndata:\n  ca.crt: LS0tLS1CRUdJTiBDRVJUSUZJQ0......=\n  namespace: ZGVmYXVsdA==\n  token: ZXlKaGJHY2lPaUpTVXpJMU5pSX......=\nkind: Secret\nmetadata:\n  annotations:\n    kubernetes.io/service-account.name: test-user\n    kubernetes.io/service-account.uid: 984b359a-6bd3-11e8-8600-XXXXXXX\n  creationTimestamp: 2018-06-09T10:55:17Z\n  name: test-user-token-hxcsk\n  namespace: default\n  resourceVersion: \"110618\"\n  selfLink: /api/v1/namespaces/default/secrets/test-user-token-hxcsk\n  uid: 98550de5-6bd3-11e8-8600-XXXXXX\ntype: kubernetes.io/service-account-token\n</code></pre>\n"}, {"tags": ["html", "templates", "go", "web"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528640477, "post_id": 50784075, "comment_id": 88575767, "body": "The code you provided is mostly correct, the only problem is that there is no <code>ImageLink</code> field nor method declared in the example, that kind of mistake will break the rendering of the template, but you already know that because you&#39;re checking the error returned from <code>Execute&#47;ExecuteTemplate</code> right? So assuming that in your real code <code>ImageLink</code> method exists or you just mistyped <code>ImgPath</code>, then your code is ok, therefore the problem is in the part of the code that you haven&#39;t shared. (<a href=\"https://play.golang.org/p/SRa24adIeMk\" rel=\"nofollow noreferrer\">play.golang.org/p/SRa24adIeMk</a>)"}, {"owner": {"reputation": 9, "user_id": 7874405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5afae1ad5fbbf8bd9cdebb6605e3fd0?s=128&d=identicon&r=PG&f=1", "display_name": "ChristopherG1994", "link": "https://stackoverflow.com/users/7874405/christopherg1994"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528643637, "post_id": 50784075, "comment_id": 88576644, "body": "What part of my code you want me to share?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528644185, "post_id": 50784075, "comment_id": 88576796, "body": "That which is broken. Which part that is I do not know since I haven&#39;t seen it. But let&#39;s start with the one that closest to the problem. Where you call Execute/ExecuteTemplate on the template.Template instance and pass the page data and also that part which retrieves that data. Also if this is a nested template then do show the parent template, and it&#39;s parent and so on."}, {"owner": {"reputation": 9, "user_id": 7874405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5afae1ad5fbbf8bd9cdebb6605e3fd0?s=128&d=identicon&r=PG&f=1", "display_name": "ChristopherG1994", "link": "https://stackoverflow.com/users/7874405/christopherg1994"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528644839, "post_id": 50784075, "comment_id": 88577009, "body": "Added Controller and Model to my Post"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528645011, "post_id": 50784075, "comment_id": 88577062, "body": "When you check the error from ExecuteTemplate what does it say?"}, {"owner": {"reputation": 9, "user_id": 7874405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5afae1ad5fbbf8bd9cdebb6605e3fd0?s=128&d=identicon&r=PG&f=1", "display_name": "ChristopherG1994", "link": "https://stackoverflow.com/users/7874405/christopherg1994"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528645563, "post_id": 50784075, "comment_id": 88577224, "body": "how can i check it?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1528645894, "post_id": 50784075, "comment_id": 88577323, "body": "<code>err := tmpl.ExecuteTemplate(w, &quot;base&quot;, data); fmt.Println(&quot;error=&quot;, err)</code>."}, {"owner": {"reputation": 9, "user_id": 7874405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5afae1ad5fbbf8bd9cdebb6605e3fd0?s=128&d=identicon&r=PG&f=1", "display_name": "ChristopherG1994", "link": "https://stackoverflow.com/users/7874405/christopherg1994"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528646134, "post_id": 50784075, "comment_id": 88577377, "body": "change ImageLink to ImgPath, now it works. <i>facepalm</i> my fault."}, {"owner": {"reputation": 9, "user_id": 7874405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5afae1ad5fbbf8bd9cdebb6605e3fd0?s=128&d=identicon&r=PG&f=1", "display_name": "ChristopherG1994", "link": "https://stackoverflow.com/users/7874405/christopherg1994"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1528646147, "post_id": 50784075, "comment_id": 88577380, "body": "thank you very much"}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 4, "creation_date": 1528646753, "post_id": 50784075, "comment_id": 88577540, "body": "As a best practice, always print the returned error whenever there&#39;s a problem with any funcion call! It&#39;ll save everyone&#39;s time."}, {"owner": {"reputation": 9, "user_id": 7874405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5afae1ad5fbbf8bd9cdebb6605e3fd0?s=128&d=identicon&r=PG&f=1", "display_name": "ChristopherG1994", "link": "https://stackoverflow.com/users/7874405/christopherg1994"}, "edited": false, "score": 0, "creation_date": 1528646853, "post_id": 50784075, "comment_id": 88577567, "body": "im very fresh to this, but thanks for the advice"}], "owner": {"reputation": 9, "user_id": 7874405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5afae1ad5fbbf8bd9cdebb6605e3fd0?s=128&d=identicon&r=PG&f=1", "display_name": "ChristopherG1994", "link": "https://stackoverflow.com/users/7874405/christopherg1994"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 72, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1528701661, "creation_date": 1528636544, "last_edit_date": 1528701661, "question_id": 50784075, "link": "https://stackoverflow.com/questions/50784075/using-range-to-show-all-elements-of-table", "title": "Using range to show all Elements of Table", "body": "<p>i want to execute a template with following data: </p>\n\n<pre><code>type EquipmentPage struct {\n    Name string\n    EquipmentList [] model.Equipment\n    Pages [] Page\n\n}\n</code></pre>\n\n<p>On my Template File i want to loop through all Equipment Elements in my Database Table. </p>\n\n<pre><code>type Equipment struct {\n    ID int\n    Name string\n    Description string\n    ImgPath string\n    Category string\n    Availability bool\n    Amount string\n    Storage string\n}\n</code></pre>\n\n<p>My Template File looks like this:</p>\n\n<pre><code>{{define \"base\"}}\n\n{{range .EquipmentList}}\n\n\n&lt;div class=\"row\"&gt;\n  &lt;div class=\"col-1\"&gt;&lt;/div&gt;\n  &lt;div class=\"col-5\"&gt;\n     &lt;p&gt; {{.Name}} &lt;/p&gt;\n     &lt;br&gt;\n     {{.Description}}\n     &lt;br&gt;\n     &lt;button type=\"button\" class=\"btn btn-main btn-margin\" &gt;&lt;b&gt;Ausleihen&lt;/b&gt;&lt;/button&gt; \n     {{if .Availability}}\n     &lt;em class=\"status-text\" style=\"color:green\"&gt; verf\u00fcgbar &lt;/em&gt;\n     {{else}}\n     &lt;em class=\"status-text\"&gt; entliehen &lt;/em&gt;\n     {{end}}\n  &lt;/div&gt;\n  &lt;div class=\"col-2\"&gt;&lt;/div&gt;\n  &lt;div class=\"col-2\" style=\"margin-top: 30px\"&gt;\n     &lt;img class=\"float-right img-responsive bild\" src=\"{{.Imagelink}}\" alt=\"Kann nicht gezeigt werden\"&gt;\n  &lt;/div&gt;\n  &lt;/div&gt;\n\n{{end}}\n</code></pre>\n\n<p>{{end}}</p>\n\n<p>When i run my programm it just shows me the first Entry of my Table.</p>\n\n<p>I want to display all entrys. \nI have the contents of the equipment array in the console output and there are all items displayed.</p>\n\n<p>EDIT:</p>\n\n<p>Controller: (Template Test has no content)</p>\n\n<pre><code>func Equipment(w    http.ResponseWriter,    r   *http.Request)  {   \ndata := EquipmentPage{ \n    Name: \"Equipment\",\n    EquipmentList: model.GetEquipment(model.Db),\n    Pages: []Page{\n        {\n            Title: \"Meine Ger\u00e4te\", \n            Active: false,\n            Link: \"/my-equipment\",\n        },\n        {\n            Title: \"Equipment\", \n            Active: true,\n            Link: \"/equipment\",\n        },\n        {\n            Title: \"Logout\",\n            Active: false,\n            Link: \"/index\",\n        },\n    }, \n}\n\n\nfmt.Println(model.GetEquipment(model.Db))\n\n\n        tmpl:= template.Must(template.ParseFiles(\"template/base_equipment.html\", \"template/test.html\"))\n    tmpl.ExecuteTemplate(w, \"base\", data)\n\n\n}\n</code></pre>\n\n<p>ModeL:</p>\n\n<pre><code>func GetEquipment(Db *sql.DB) []Equipment {\n    sql_readall := `\n    select ID, Name, Description, ImgPath, Category, Availability, Amount, Storage from Equipment\n    `\n\n    rows, err := Db.Query(sql_readall)\n    if err != nil { panic(err) }\n    defer rows.Close()\n\n    var result []Equipment\n    for rows.Next() {\n        equipment := Equipment{}\n        err2 := rows.Scan(&amp;equipment.ID, &amp;equipment.Name, &amp;equipment.Description, &amp;equipment.ImgPath, &amp;equipment.Category, &amp;equipment.Availability, &amp;equipment.Amount, &amp;equipment.Storage)\n        if err2 != nil { panic(err2) }\n        result = append(result, equipment)\n    }\n\n\n    return result\n}\n</code></pre>\n"}, {"tags": ["go", "posix", "datetime-format"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1528636511, "post_id": 50784043, "comment_id": 88574557, "body": "you can use <code>Unix()</code> method of time package to get unix timstamp. Which date format do you want ? Mention in the post"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1528641075, "post_id": 50784043, "comment_id": 88575938, "body": "@Ram use the <code>Format</code> method <a href=\"https://play.golang.org/p/JlUyGVK0aPR\" rel=\"nofollow noreferrer\">play.golang.org/p/JlUyGVK0aPR</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528641845, "post_id": 50784043, "comment_id": 88576120, "body": "@Ram another solution, less elegant but presumably faster when compared to the <code>Format</code> method, would be to use <code>strconv</code> package&#39;s <code>Itoa</code> function and manual handling of the two-digit padding."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528642179, "post_id": 50784043, "comment_id": 88576218, "body": "... e.g. something like this: <a href=\"https://play.golang.org/p/TZh1U9NxtbA\" rel=\"nofollow noreferrer\">play.golang.org/p/TZh1U9NxtbA</a>"}, {"owner": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "edited": false, "score": 1, "creation_date": 1528720810, "post_id": 50784043, "comment_id": 88601797, "body": "I don&#39;t get why this got downvoted to be honest, seems a legitimate question, formatting time in Go is not as straightforward as in other languages."}], "answers": [{"comments": [{"owner": {"reputation": 1047, "user_id": 1191999, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8a5575da1a4d6205f568754e55294cfb?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/1191999/ram"}, "edited": false, "score": 0, "creation_date": 1528643698, "post_id": 50784061, "comment_id": 88576662, "body": "this is what I need. How do I create my own format string. Are there examples of that"}, {"owner": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "reply_to_user": {"reputation": 1047, "user_id": 1191999, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8a5575da1a4d6205f568754e55294cfb?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/1191999/ram"}, "edited": false, "score": 0, "creation_date": 1528645909, "post_id": 50784061, "comment_id": 88577328, "body": "@Ram added to the answer."}, {"owner": {"reputation": 1047, "user_id": 1191999, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8a5575da1a4d6205f568754e55294cfb?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/1191999/ram"}, "edited": false, "score": 0, "creation_date": 1528646954, "post_id": 50784061, "comment_id": 88577591, "body": "I just benchmarked all methods 1) using fmt.printf(... t.year()) 2) using itoa 3) using format. Seems all are almost same  Just curious why would be the reference date be so chosen"}, {"owner": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "reply_to_user": {"reputation": 1047, "user_id": 1191999, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8a5575da1a4d6205f568754e55294cfb?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/1191999/ram"}, "edited": false, "score": 0, "creation_date": 1528647358, "post_id": 50784061, "comment_id": 88577716, "body": "@Ram No particular reason for the reference date. From the doc: &quot;an easy way to remember this value is that it holds, when presented in this order, the values 1, 2,  3, 4, 5, 6, -7&quot;. I guess that may be a reason."}], "tags": [], "owner": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "is_accepted": true, "score": 3, "last_activity_date": 1528721314, "last_edit_date": 1528721314, "creation_date": 1528636424, "answer_id": 50784061, "question_id": 50784043, "link": "https://stackoverflow.com/questions/50784043/define-custom-time-format/50784061#50784061", "title": "Define custom time format", "body": "<p>In Go there are built in layouts to pass to the <code>.Format()</code> method of <code>Time</code> (<a href=\"https://golang.org/pkg/time/#Time.Format\" rel=\"nofollow noreferrer\">see <code>func (Time) Format</code></a>), one of these could be what you are looking for:</p>\n\n<pre><code>func main() {\n    fmt.Println(time.Now().Format(time.ANSIC))\n    fmt.Println(time.Now().Format(time.UnixDate))\n    fmt.Println(time.Now().Format(time.RFC3339))\n}\n</code></pre>\n\n<p>This is going to be faster than <code>fmt.Printf(\"...\", t.Year(), t.Month(), ...)</code>, but we're talking about microseconds \"faster\" here, so there really is no big difference.</p>\n\n<p>Output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Sun Jun 10 13:18:09 2018\nSun Jun 10 13:18:09 UTC 2018\n2018-06-10T13:18:09Z\n</code></pre>\n\n<p>There are a lot more predefined layouts, so you can check all of them out and see if one of them fits your needs. Here they are directly from the source code:</p>\n\n<pre><code>const (\n    ANSIC       = \"Mon Jan _2 15:04:05 2006\"\n    UnixDate    = \"Mon Jan _2 15:04:05 MST 2006\"\n    RubyDate    = \"Mon Jan 02 15:04:05 -0700 2006\"\n    RFC822      = \"02 Jan 06 15:04 MST\"\n    RFC822Z     = \"02 Jan 06 15:04 -0700\" // RFC822 with numeric zone\n    RFC850      = \"Monday, 02-Jan-06 15:04:05 MST\"\n    RFC1123     = \"Mon, 02 Jan 2006 15:04:05 MST\"\n    RFC1123Z    = \"Mon, 02 Jan 2006 15:04:05 -0700\" // RFC1123 with numeric zone\n    RFC3339     = \"2006-01-02T15:04:05Z07:00\"\n    RFC3339Nano = \"2006-01-02T15:04:05.999999999Z07:00\"\n    Kitchen     = \"3:04PM\"\n    // Handy time stamps.\n    Stamp      = \"Jan _2 15:04:05\"\n    StampMilli = \"Jan _2 15:04:05.000\"\n    StampMicro = \"Jan _2 15:04:05.000000\"\n    StampNano  = \"Jan _2 15:04:05.000000000\"\n)\n</code></pre>\n\n<p>Other than that, <strong>it's just a matter of creating your own layout</strong>, there really is no difference.</p>\n\n<hr>\n\n<p>To create a custom layout string, quoting from the documentation:</p>\n\n<blockquote>\n  <p>The layout string used by the <code>Parse</code> function and <code>Format</code> method shows by example how the reference time should be represented. We stress that <strong>one must show how the reference time is formatted, not a time of the user's choosing</strong>. Thus each layout string is a representation of the time stamp: <code>Jan 2 15:04:05 2006 MST</code>.</p>\n</blockquote>\n\n<p>So, for example:</p>\n\n<pre><code>fmt.Println(time.Now().Format(\"Mon January 2, 2006 - 15:04:05.000\"))\n</code></pre>\n\n<p>gives:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>Sun June 10, 2018 - 17:49:32.557\n</code></pre>\n\n<p><strong>If you want something different you'll just have to format the date <code>Jan 2 15:04:05 2006 MST</code> how you would want it to be displayed.</strong> You can also take a look at <a href=\"https://gobyexample.com/time-formatting-parsing\" rel=\"nofollow noreferrer\">the relative page</a> on Go by Example.</p>\n"}], "owner": {"reputation": 1047, "user_id": 1191999, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8a5575da1a4d6205f568754e55294cfb?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/1191999/ram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1840, "favorite_count": 0, "accepted_answer_id": 50784061, "answer_count": 1, "score": -1, "last_activity_date": 1528721314, "creation_date": 1528636273, "last_edit_date": 1528646136, "question_id": 50784043, "link": "https://stackoverflow.com/questions/50784043/define-custom-time-format", "title": "Define custom time format", "body": "<p>I am trying to write a custom date format string as required by my application. \nUsing the Go time package I get the format using a clumsy function (see below).</p>\n\n<p>Also since this function will be called millions of times every day, I want this to be super efficient too. Is there a POSIX style formatting available in Go?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    t := time.Now()\n    fmt.Printf(\"Time now is %d%02d%02d%02d%02d%02d\",\n        t.Year(), t.Month(), t.Day(), t.Hour(), t.Minute(), t.Second())\n}\n</code></pre>\n"}, {"tags": ["go", "hyperledger-fabric"], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 9921167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c77089db780415bcd1edeb0bb06b7cc?s=128&d=identicon&r=PG&f=1", "display_name": "user9921167", "link": "https://stackoverflow.com/users/9921167/user9921167"}, "is_accepted": false, "score": -1, "last_activity_date": 1528636220, "creation_date": 1528636220, "answer_id": 50784036, "question_id": 50783955, "link": "https://stackoverflow.com/questions/50783955/how-can-i-run-test-on-hyperledger-fabric-code/50784036#50784036", "title": "How can I run test on Hyperledger Fabric code?", "body": "<p>Solved, but I don't know what happened and why.\nVScode will gives a \"run file test||run package test\" hint on the top, I click it and it running success.</p>\n"}], "owner": {"reputation": 1, "user_id": 9921167, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c77089db780415bcd1edeb0bb06b7cc?s=128&d=identicon&r=PG&f=1", "display_name": "user9921167", "link": "https://stackoverflow.com/users/9921167/user9921167"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 179, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1528678875, "creation_date": 1528635697, "last_edit_date": 1528678875, "question_id": 50783955, "link": "https://stackoverflow.com/questions/50783955/how-can-i-run-test-on-hyperledger-fabric-code", "title": "How can I run test on Hyperledger Fabric code?", "body": "<p>I'm sorry to interrupt you guys, but I wish to know how can I run the Hyperledger Fabric code originally.</p>\n\n<p>I download all the Go, Docker, Docker composer, VSCode and those plugins for Go.\nAnd when I using <code>go test consensus_test.go</code> in <code>/orderer/solo</code>.</p>\n\n<p>It will give me these answer, so how can I run these code? Thank you.</p>\n\n<p><img src=\"https://i.stack.imgur.com/SFCyB.png\" alt=\"\"></p>\n\n<pre><code>$fabric@ubuntu:~/go/src/github.com/hyperledger/fabric/orderer/consensus/solo$ go test consensus_test.go\n# command-line-arguments\n./consensus_test.go:35:26: undefined: pkgLogID\n./consensus_test.go:45:48: undefined: chain\n./consensus_test.go:74:8: undefined: newChain\n./consensus_test.go:95:11: undefined: New\n./consensus_test.go:116:8: undefined: newChain\n./consensus_test.go:134:8: undefined: newChain\n./consensus_test.go:178:8: undefined: newChain\n./consensus_test.go:220:8: undefined: newChain\n./consensus_test.go:256:8: undefined: newChain\n./consensus_test.go:293:8: undefined: newChain\n./consensus_test.go:293:8: too many errors\nFAIL    command-line-arguments [build failed]\nfabric@ubuntu:~/go/src/github.com/hyperledger/fabric/orderer/consensus/solo$\n</code></pre>\n"}, {"tags": ["go", "struct", "types", "slice"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1528630735, "post_id": 50783071, "comment_id": 88573081, "body": "You should use <code>entries *[]Entry</code> as the function&#39;s argument. But note that, in Go, <code>[]Book</code> is not assignable/convertable to <code>[]Entry</code> even if <code>Book</code> implements <code>Entry</code>, you&#39;ll have to loop over <code>[]Book</code> to create a <code>[]Entry</code> slice."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528630782, "post_id": 50783071, "comment_id": 88573091, "body": "... see here <a href=\"https://stackoverflow.com/a/12754757/965900\">stackoverflow.com/a/12754757/965900</a>"}, {"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 0, "creation_date": 1528631332, "post_id": 50783071, "comment_id": 88573233, "body": "i dont think its a good way to test your function, why dont you just implement your interface and pass it to your test ?!"}, {"owner": {"reputation": 2701, "user_id": 231582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b82066b95508c6d6a9b2e70c99064db8?s=128&d=identicon&r=PG", "display_name": "tirithen", "link": "https://stackoverflow.com/users/231582/tirithen"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528638167, "post_id": 50783071, "comment_id": 88575040, "body": "Thanks @mkopriva for the link, seems like I could get something out of that, and thanks for the clarification about the Entry interface -&gt; Book conversion explanation. Somehow this worked when I sent in one &amp;Book and took it in as an Entry and did json.Unmarshal(dataString, book). But when I sent in *[]Entry or []Entry I was not able to append to the slice. I could see if it works with returning a new slice instead."}, {"owner": {"reputation": 2701, "user_id": 231582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b82066b95508c6d6a9b2e70c99064db8?s=128&d=identicon&r=PG", "display_name": "tirithen", "link": "https://stackoverflow.com/users/231582/tirithen"}, "reply_to_user": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 0, "creation_date": 1528638282, "post_id": 50783071, "comment_id": 88575075, "body": "Thanks @danicheeta, what I&#39;m trying to achieve is to have one method that lets you read/query/delete JSON files (in the example I reduced that code to some strings) as a mini database experiment, so I can&#39;t know before hand which structs I need to support other than that they will need to implement Entry.  Do you have other suggestions on how I could test my function?"}, {"owner": {"reputation": 2701, "user_id": 231582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b82066b95508c6d6a9b2e70c99064db8?s=128&d=identicon&r=PG", "display_name": "tirithen", "link": "https://stackoverflow.com/users/231582/tirithen"}, "edited": false, "score": 0, "creation_date": 1528640540, "post_id": 50783071, "comment_id": 88575787, "body": "@ThunderCat One file per entry like 0b27557a-00a5-46e6-8cf2-fbf40f19ca28.json and so on."}], "answers": [{"comments": [{"owner": {"reputation": 2701, "user_id": 231582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b82066b95508c6d6a9b2e70c99064db8?s=128&d=identicon&r=PG", "display_name": "tirithen", "link": "https://stackoverflow.com/users/231582/tirithen"}, "edited": false, "score": 0, "creation_date": 1528640604, "post_id": 50784646, "comment_id": 88575798, "body": "This looks really nice, I&#39;m trying it now"}, {"owner": {"reputation": 2701, "user_id": 231582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b82066b95508c6d6a9b2e70c99064db8?s=128&d=identicon&r=PG", "display_name": "tirithen", "link": "https://stackoverflow.com/users/231582/tirithen"}, "edited": false, "score": 0, "creation_date": 1528642850, "post_id": 50784646, "comment_id": 88576429, "body": "Thank you this was exactly what I was looking for! Works perfectly! :D"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1528640433, "creation_date": 1528640433, "answer_id": 50784646, "question_id": 50783071, "link": "https://stackoverflow.com/questions/50783071/how-to-populate-a-slice-of-interface-passed-as-reference-to-function/50784646#50784646", "title": "How to populate a slice of interface passed as reference to function", "body": "<p>Reflection is required to work with different slice types. Here's how to do it:</p>\n\n<pre><code>func GetByCollection(collectionName string, result interface{}) {    \n    collections := map[string][]string{\n        \"books\": []string{\n            `{\"ID\": \"c8cc718d-94a9-4605-a4bb-05d5aa067fd6\", \"Title\": \"Nils Holgersson\", \"Author\": \"d89e4a0a-6a65-4754-9090-f8b6c7d6eeec\"}`,\n            `{\"ID\": \"46ad379e-17f2-4961-b615-d4301160f892\", \"Title\": \"Ronja r\u00f6vardotter\", \"Author\": \"a1bba636-0700-474f-8fe8-2ad3ec9d061c\"}`,\n        },\n        \"authors\": []string{\n            `{\"ID\": \"d89e4a0a-6a65-4754-9090-f8b6c7d6eeec\", \"Name\": \"Selma Lagerl\u00f6f\"}`,\n            `{\"ID\": \"a1bba636-0700-474f-8fe8-2ad3ec9d061c\", \"Name\": \"Astrid Lindgren\"}`,\n        },\n    }\n\n    slice := reflect.ValueOf(result).Elem()\n    elementType := slice.Type().Elem()\n\n    for _, entryData := range collections[collectionName] {\n        v := reflect.New(elementType)\n        json.Unmarshal([]byte(entryData), v.Interface())\n        slice.Set(reflect.Append(slice, v.Elem()))\n    }\n}\n</code></pre>\n\n<p>Call it like this:</p>\n\n<pre><code>var books []Book\nGetByCollection(\"books\", &amp;books)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/cjoSbprtrs5\" rel=\"nofollow noreferrer\">Playground example</a></p>\n"}], "owner": {"reputation": 2701, "user_id": 231582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b82066b95508c6d6a9b2e70c99064db8?s=128&d=identicon&r=PG", "display_name": "tirithen", "link": "https://stackoverflow.com/users/231582/tirithen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 50784646, "answer_count": 1, "score": 0, "last_activity_date": 1528706121, "creation_date": 1528629116, "last_edit_date": 1528706121, "question_id": 50783071, "link": "https://stackoverflow.com/questions/50783071/how-to-populate-a-slice-of-interface-passed-as-reference-to-function", "title": "How to populate a slice of interface passed as reference to function", "body": "<p>I have a small example where I try to populate a []Entry (where Entry is an interface) slice inside a function, this works fine when the argument is a single Entry, but when trying to pass a slice of entries I cannot figure my way through the pointers.</p>\n\n<pre><code>package temp\n\nimport (\n    \"encoding/json\"\n\n    uuid \"github.com/satori/go.uuid\"\n)\n\ntype BaseEntry struct {\n    ID uuid.UUID\n}\n\nfunc (entry *BaseEntry) GetID() uuid.UUID {\n    return entry.ID\n}\n\ntype Entry interface {\n    GetID() uuid.UUID\n}\n\nfunc GetByCollection(collectionName string, entries []Entry) {\n    // This could be a lookup in a database or filesystem\n\n    collections := map[string][]string{\n        \"books\": []string{\n            `{\"ID\": \"c8cc718d-94a9-4605-a4bb-05d5aa067fd6\", \"Title\": \"Nils Holgersson\", \"Author\": \"d89e4a0a-6a65-4754-9090-f8b6c7d6eeec\"}`,\n            `{\"ID\": \"46ad379e-17f2-4961-b615-d4301160f892\", \"Title\": \"Ronja r\u00f6vardotter\", \"Author\": \"a1bba636-0700-474f-8fe8-2ad3ec9d061c\"}`,\n        },\n        \"authors\": []string{\n            `{\"ID\": \"d89e4a0a-6a65-4754-9090-f8b6c7d6eeec\", \"Name\": \"Selma Lagerl\u00f6f\"}`,\n            `{\"ID\": \"a1bba636-0700-474f-8fe8-2ad3ec9d061c\", \"Name\": \"Astrid Lindgren\"}`,\n        },\n    }\n\n    if collections[collectionName] != nil {\n        for _, entryData := range collections[collectionName] {\n            entry := BaseEntry{}\n            json.Unmarshal([]byte(entryData), &amp;entry)\n            *entries = append(*entries, &amp;entry)\n        }\n    }\n}\n</code></pre>\n\n<p>And the tests where I try to use this:</p>\n\n<pre><code>    package temp_test\n\n    import (\n        \"testing\"\n\n        \"github.com/mojlighetsministeriet/next/temp\"\n        uuid \"github.com/satori/go.uuid\"\n        \"github.com/stretchr/testify/assert\"\n    )\n\n    type Book struct {\n        temp.BaseEntry\n    }\n\n    func TestPopulate(test *testing.T) {\n        books := []Book{}\n        temp.GetByCollection(\"books\", &amp;books)\n        assert.NotEqual(test, uuid.Nil, books[0].GetID())\n    }\n</code></pre>\n\n<p>Depending if I declare <code>GetByCollection(collectionName string, entries []Entry)</code> or <code>GetByCollection(collectionName string, entries *[]Entry)</code> I get either:</p>\n\n<pre><code># github.com/mojlighetsministeriet/next/temp\n./main.go:39:4: invalid indirect of entries (type []Entry)\n</code></pre>\n\n<p>or</p>\n\n<pre><code># github.com/mojlighetsministeriet/next/temp_test\n./main_test.go:17:32: cannot use &amp;books (type *[]Book) as type * \n[]temp.Entry in argument to temp.GetByCollection\n</code></pre>\n\n<p>How should I write so that I can choose the entry type by calling GetByCollection with say either a []Book or []Author slice that get populated?</p>\n\n<p>I probably need to refactor somehow, in the end I like something similar to GORM's Query method (<a href=\"http://gorm.io/docs/query.html#Query\" rel=\"nofollow noreferrer\">http://gorm.io/docs/query.html#Query</a>) <code>db.Find(&amp;users)</code> but like <code>GetByCollection(\"books\", &amp;books)</code></p>\n"}, {"tags": ["javascript", "node.js", "api", "go", "electron"], "comments": [{"owner": {"reputation": 147776, "user_id": 3731501, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e4783dfa8ec98c884e61d29f2192ac97?s=128&d=identicon&r=PG&f=1", "display_name": "Estus Flask", "link": "https://stackoverflow.com/users/3731501/estus-flask"}, "edited": false, "score": 1, "creation_date": 1528627484, "post_id": 50782786, "comment_id": 88572269, "body": "Electron is Node.js+Chromium. I&#39;d suggest to start with &quot;normal web development&quot; and explore Node.js before dealing with same things in Electron."}, {"owner": {"reputation": 171, "user_id": 9579768, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "alexfwulf", "link": "https://stackoverflow.com/users/9579768/alexfwulf"}, "reply_to_user": {"reputation": 147776, "user_id": 3731501, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e4783dfa8ec98c884e61d29f2192ac97?s=128&d=identicon&r=PG&f=1", "display_name": "Estus Flask", "link": "https://stackoverflow.com/users/3731501/estus-flask"}, "edited": false, "score": 0, "creation_date": 1528628504, "post_id": 50782786, "comment_id": 88572523, "body": "@estus Thanks for your reply. But I&#39;d like to make a program together with a friend and he has front-end skills and I have got some backend skills in writing APIs and but as it has to process personal data it needs to be a desktop application because of GDPR. I wanted to know if it is possible to develop a Electron app API driven."}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1528628563, "post_id": 50782786, "comment_id": 88572538, "body": "You can use Electron as both a server and a client, but it seems a bit strange. Could you elaborate on what is your goal?"}, {"owner": {"reputation": 147776, "user_id": 3731501, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e4783dfa8ec98c884e61d29f2192ac97?s=128&d=identicon&r=PG&f=1", "display_name": "Estus Flask", "link": "https://stackoverflow.com/users/3731501/estus-flask"}, "edited": false, "score": 0, "creation_date": 1528630643, "post_id": 50782786, "comment_id": 88573057, "body": "Yes, it&#39;s possible to make it API driven. You essentially need to learn how to do this with Node. Normally you would set up a server (e.g. Express) to serve requests to front end part, e.g. via HTTP. In Electron, but you have additional option to pass data to front end directly via IPC. Both options are acceptable, the latter is more straightforward in Electron but cannot be easily translated to/from regular website/server architecture in case it&#39;s needed."}, {"owner": {"reputation": 171, "user_id": 9579768, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "alexfwulf", "link": "https://stackoverflow.com/users/9579768/alexfwulf"}, "reply_to_user": {"reputation": 147776, "user_id": 3731501, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e4783dfa8ec98c884e61d29f2192ac97?s=128&d=identicon&r=PG&f=1", "display_name": "Estus Flask", "link": "https://stackoverflow.com/users/3731501/estus-flask"}, "edited": false, "score": 0, "creation_date": 1528636346, "post_id": 50782786, "comment_id": 88574508, "body": "I think @estus gave me the hint to elaborate my question: Is it possible to make http requests to an offline API in Electron?"}, {"owner": {"reputation": 147776, "user_id": 3731501, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e4783dfa8ec98c884e61d29f2192ac97?s=128&d=identicon&r=PG&f=1", "display_name": "Estus Flask", "link": "https://stackoverflow.com/users/3731501/estus-flask"}, "edited": false, "score": 0, "creation_date": 1528644857, "post_id": 50782786, "comment_id": 88577016, "body": "Depends on what &#39;offline&#39; exactly is. Do you refer to <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/NavigatorOnLine/Online_and_offline_events\" rel=\"nofollow noreferrer\">developer.mozilla.org/en-US/docs/Web/API/NavigatorOnLine/&hellip;</a> ?"}, {"owner": {"reputation": 171, "user_id": 9579768, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "alexfwulf", "link": "https://stackoverflow.com/users/9579768/alexfwulf"}, "reply_to_user": {"reputation": 147776, "user_id": 3731501, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e4783dfa8ec98c884e61d29f2192ac97?s=128&d=identicon&r=PG&f=1", "display_name": "Estus Flask", "link": "https://stackoverflow.com/users/3731501/estus-flask"}, "edited": false, "score": 0, "creation_date": 1528646007, "post_id": 50782786, "comment_id": 88577346, "body": "@estus No. I&#39;m referring to the fact that the app runs locally on the machine as I&#39;m unwilling to deal with the GDPR."}, {"owner": {"reputation": 147776, "user_id": 3731501, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e4783dfa8ec98c884e61d29f2192ac97?s=128&d=identicon&r=PG&f=1", "display_name": "Estus Flask", "link": "https://stackoverflow.com/users/3731501/estus-flask"}, "edited": false, "score": 0, "creation_date": 1528646828, "post_id": 50782786, "comment_id": 88577557, "body": "Yes. In case you&#39;re communicating between frontend and backend via HTTP, there is localhost webserver that listens only to frontend requests. In case you&#39;re communicating via IPC there will be no such problem."}, {"owner": {"reputation": 171, "user_id": 9579768, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "alexfwulf", "link": "https://stackoverflow.com/users/9579768/alexfwulf"}, "edited": false, "score": 0, "creation_date": 1528648437, "post_id": 50782786, "comment_id": 88578059, "body": "Ok then what does IPC mean?"}, {"owner": {"reputation": 147776, "user_id": 3731501, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e4783dfa8ec98c884e61d29f2192ac97?s=128&d=identicon&r=PG&f=1", "display_name": "Estus Flask", "link": "https://stackoverflow.com/users/3731501/estus-flask"}, "edited": false, "score": 0, "creation_date": 1528648729, "post_id": 50782786, "comment_id": 88578139, "body": "Inter-process communication. There are two different processes, main (powered by Node.js) and renderer (powered by Chromium). See <a href=\"https://github.com/electron/electron/blob/master/docs/api/ipc-main.md\" rel=\"nofollow noreferrer\">github.com/electron/electron/blob/master/docs/api/ipc-main.m&zwnj;&#8203;d</a> and <a href=\"https://github.com/electron/electron/blob/master/docs/api/remote.md\" rel=\"nofollow noreferrer\">github.com/electron/electron/blob/master/docs/api/remote.md</a> . That&#39;s one of few things that are specific to Electron. In other cases you can learn how to do the job with Node.js and extrapolate the experience to Electron."}], "answers": [{"tags": [], "owner": {"reputation": 5576, "user_id": 4986182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5oDOo.png?s=128&g=1", "display_name": "vitr", "link": "https://stackoverflow.com/users/4986182/vitr"}, "is_accepted": false, "score": 2, "last_activity_date": 1528638420, "creation_date": 1528638420, "answer_id": 50784339, "question_id": 50782786, "link": "https://stackoverflow.com/questions/50782786/electron-architecture-api-calls/50784339#50784339", "title": "Electron architecture API calls", "body": "<p>Yes, it is possible and and here is a library <a href=\"https://github.com/asticode/go-astilectron\" rel=\"nofollow noreferrer\">go-astilectron</a> that demonstrates this approach. You can read more in the article <a href=\"https://hackernoon.com/how-to-add-a-gui-to-your-golang-app-in-5-easy-steps-c25c99d4d8e0\" rel=\"nofollow noreferrer\">How to add a GUI to your Golang app in 5 easy steps (powered by Electron)</a>. It's based on this project <a href=\"https://github.com/asticode/astilectron\" rel=\"nofollow noreferrer\">astilectron</a> - Electron app that provides an API over a TCP socket that allows executing Electron's method as well as capturing Electron's events.</p>\n"}], "owner": {"reputation": 171, "user_id": 9579768, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "alexfwulf", "link": "https://stackoverflow.com/users/9579768/alexfwulf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2151, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1528638420, "creation_date": 1528626701, "question_id": 50782786, "link": "https://stackoverflow.com/questions/50782786/electron-architecture-api-calls", "title": "Electron architecture API calls", "body": "<p>Hello Stackoverflow Community,</p>\n\n<p>I'm currently diving in into cross-platform apps with Electron.\nAs I'm a newbie to this topic there are some uncertainties:\nIn \"normal\" webdevelopment I would write an API in Go(lang) which processes JSON files. \nIs it possible to set up Electron like an offline server which can make API calls?</p>\n\n<p>Thank you in advance. I really appreciate your help.</p>\n"}, {"tags": ["sockets", "go", "networking", "tcp", "network-programming"], "comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 1, "creation_date": 1528629041, "post_id": 50782278, "comment_id": 88572659, "body": "If the server does not read the data as fast as the client sends them then the flow control of TCP will automatically slow down the client. There is no need to do this in your application."}, {"owner": {"reputation": 315, "user_id": 8015411, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef8fe3d890eb1754b63928775816be43?s=128&d=identicon&r=PG&f=1", "display_name": "Zihan", "link": "https://stackoverflow.com/users/8015411/zihan"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1528647856, "post_id": 50782278, "comment_id": 88577879, "body": "Thanks, but that seems to be OS level, or netstack level. When the client gets automatically slowed down, there are already many packets sent to the server. I think the server still needs to deal with packets that are cut into 2 pieces."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1528658200, "post_id": 50782278, "comment_id": 88580759, "body": "The is no such thing as &quot;cut into 2 pieces&quot;. TCP is a byte stream protocol and not a message based protocol. You should not make any assumptions on packet sizes etc and you should never assume that a single write at the sender results in a single read at the recipient. If you need message syntax then you need to add this to your application protocol, i.e. have the messaged prefixed with the length, have a clear message separater or similar."}, {"owner": {"reputation": 315, "user_id": 8015411, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef8fe3d890eb1754b63928775816be43?s=128&d=identicon&r=PG&f=1", "display_name": "Zihan", "link": "https://stackoverflow.com/users/8015411/zihan"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1528713972, "post_id": 50782278, "comment_id": 88597687, "body": "@SteffenUllrich I guess I didn&#39;t make it clear in text description, but I did use a &#39;4 byte length + content&#39; application protocol in the code. Anyway, peter&#39;s answer looks good to me, I&#39;ll flag this question as solved. Thanks for your comment."}], "answers": [{"comments": [{"owner": {"reputation": 315, "user_id": 8015411, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef8fe3d890eb1754b63928775816be43?s=128&d=identicon&r=PG&f=1", "display_name": "Zihan", "link": "https://stackoverflow.com/users/8015411/zihan"}, "edited": false, "score": 0, "creation_date": 1528647935, "post_id": 50783334, "comment_id": 88577909, "body": "Thanks, it seems the extra <code>dataLen</code> byte array allocation is unavoidable. Is there other way to make bufio work like a circular array and new data is read into the discarded space? I don&#39;t find such function in bufio."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 315, "user_id": 8015411, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef8fe3d890eb1754b63928775816be43?s=128&d=identicon&r=PG&f=1", "display_name": "Zihan", "link": "https://stackoverflow.com/users/8015411/zihan"}, "edited": false, "score": 0, "creation_date": 1528649160, "post_id": 50783334, "comment_id": 88578261, "body": "@biggerfish: You don&#39;t seem to understand. The code takes care of buffer reuse (like a circular array) with minimal allocations (as in almost none, because of reuse). Your concerns are not justified. Explain, in detail, with examples, why you don&#39;t think it works."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 315, "user_id": 8015411, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef8fe3d890eb1754b63928775816be43?s=128&d=identicon&r=PG&f=1", "display_name": "Zihan", "link": "https://stackoverflow.com/users/8015411/zihan"}, "edited": false, "score": 0, "creation_date": 1528649335, "post_id": 50783334, "comment_id": 88578312, "body": "@biggerfish: &quot;it seems the extra dataLen byte array allocation is unavoidable.&quot; Clearly, that&#39;s false. It&#39;s a conditional allocation that&#39;s rarely, if ever, made."}, {"owner": {"reputation": 315, "user_id": 8015411, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef8fe3d890eb1754b63928775816be43?s=128&d=identicon&r=PG&f=1", "display_name": "Zihan", "link": "https://stackoverflow.com/users/8015411/zihan"}, "edited": false, "score": 0, "creation_date": 1528714002, "post_id": 50783334, "comment_id": 88597714, "body": "I misunderstood it, you are correct. I&#39;ll accept the answer."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 0, "last_activity_date": 1528638219, "last_edit_date": 1528638219, "creation_date": 1528630898, "answer_id": 50783334, "question_id": 50782278, "link": "https://stackoverflow.com/questions/50782278/how-to-deal-with-sticky-tcp-packet-in-go/50783334#50783334", "title": "How to deal with sticky tcp packet in go?", "body": "<p>For example,</p>\n\n<pre><code>import (\n    \"bufio\"\n    \"encoding/binary\"\n    \"io\"\n    \"net\"\n)\n\nfunc providerCallback(conn net.Conn) error {\n    rdr := bufio.NewReader(conn)\n    data := make([]byte, 0, 4*1024)\n    for {\n        n, err := io.ReadFull(rdr, data[:4])\n        data = data[:n]\n        if err != nil {\n            if err == io.EOF {\n                break\n            }\n            return err\n        }\n        dataLen := binary.BigEndian.Uint32(data)\n        if uint64(dataLen) &gt; uint64(cap(data)) {\n            data = make([]byte, 0, dataLen)\n        }\n        n, err = io.ReadFull(rdr, data[:dataLen])\n        data = data[:n]\n        if err != nil {\n            return err\n        }\n\n        process(data)\n    }\n    return nil\n}\n\nfunc process([]byte) {}\n</code></pre>\n"}], "owner": {"reputation": 315, "user_id": 8015411, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef8fe3d890eb1754b63928775816be43?s=128&d=identicon&r=PG&f=1", "display_name": "Zihan", "link": "https://stackoverflow.com/users/8015411/zihan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 769, "favorite_count": 1, "accepted_answer_id": 50783334, "answer_count": 1, "score": -1, "last_activity_date": 1528638219, "creation_date": 1528622813, "last_edit_date": 1592644375, "question_id": 50782278, "link": "https://stackoverflow.com/questions/50782278/how-to-deal-with-sticky-tcp-packet-in-go", "title": "How to deal with sticky tcp packet in go?", "body": "<p>I have a tcp server and a client, the server does the following</p>\n<pre><code>func providerCallback(conn net.Conn) {\n    reader := bufio.NewReader(conn)\n    var err error\n    for {\n        lenbyte, _ := reader.Peek(4)\n        reader.Discard(4)\n        slen := int(binary.BigEndian.Uint32(lenbyte))\n        data, err = reader.Peek(slen)\n        process(data)\n        reader.Discard(slen)\n    }\n}\n</code></pre>\n<p>The client seems to send packet faster than process can deal with, therefore I'd like to buffer the requests in bufio and process later.</p>\n<p>However, as the size of bufio is fixed(4096, even though I can increase it, it is still fixed), which means I can't manually <code>Reset</code> it because there might be a packet cutting of in the end of bufio, as follows</p>\n<blockquote>\n<p>|normal data... [First 20 bytes of packet P] | [the rest of packet P]</p>\n<p>|------------------- size of bufio ------------------|</p>\n</blockquote>\n<p>How can I splice packet that is cut off, and reuse the bufio for later packets?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1528620944, "post_id": 50781369, "comment_id": 88570795, "body": "You have an infinite loop that reads indefinitely from the reader, <code>io.Reader</code>s are defined as returning EOF when they reach the end of the content to be read. Is <code>appOut</code> an infinite stream? If not then you&#39;re seeing normal behaviour."}], "owner": {"reputation": 21, "user_id": 9920298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe0076679553114c5be6a6a4566a6fe1?s=128&d=identicon&r=PG&f=1", "display_name": "ShimonBY", "link": "https://stackoverflow.com/users/9920298/shimonby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1528618483, "creation_date": 1528614523, "last_edit_date": 1528618483, "question_id": 50781369, "link": "https://stackoverflow.com/questions/50781369/go-language-opening-a-pipe-to-a-command-exec-after-redirection-output-causes-e", "title": "Go language - opening a pipe to a command exec after redirection output causes EOF", "body": "<p>I am trying to redirect the output of a process to one place, and then to open a pipe to the process , read its data and send the data to a predefined web socket connection --> but i get EOF.</p>\n\n<p>For example :</p>\n\n<pre><code>myCmd := exec.Command(\"bash\", \"-c\", \"some command\")\n\nmyCmd.Stdout = os.Stdout\n\nmyCmd.Stderr = os.Stderr\n\nappOut, _ := lsCmd.StdoutPipe()\n</code></pre>\n\n<p>And then i am calling this go routine:</p>\n\n<pre><code>data := make([]byte, 1000)\n\nfor {\n\n    for {\n\n        n, err := appOut.Read(data)\n\n        if err == nil &amp;&amp; n &gt; 0 {\n            myConnection.WriteMessage(websocket.TextMessage, data[0:n])\n        }\n\n      if err != nil {\n        log.Printf(\"App exited. err: %s, Error \", err)\n       }\n\n    }\n}\n</code></pre>\n\n<p>Can someone tell me what i have done wrong  ?\nI must mention that even if I change the order of the line (openning the pipe before the redirection it still happens)</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 4316, "user_id": 486035, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1654e9816b6e407e1daced17ac4fcf3b?s=128&d=identicon&r=PG", "display_name": "phemmer", "link": "https://stackoverflow.com/users/486035/phemmer"}, "is_accepted": true, "score": 9, "last_activity_date": 1528610151, "creation_date": 1528610151, "answer_id": 50780968, "question_id": 50780921, "link": "https://stackoverflow.com/questions/50780921/what-is-gos-net-listener-addr-used-for/50780968#50780968", "title": "What is Go&#39;s net.Listener Addr() used for?", "body": "<p>Some network protocols allow you to create a listener which listens on a random address. This is commonly used when you want to run multiple instances of your service at the same time, and thus you can't have them all listening on the same address. In these cases, the kernel will find one that's available, and put your listener there. But once you have a random address, you need to know what that address is so you can advertise it.</p>\n\n<p>For example, with TCP &amp; UDP, you can specify <code>0</code> as your port number:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n)\n\nfunc main() {\n    l, _ := net.Listen(\"tcp4\", \":0\")\n    fmt.Printf(\"Addr: %s\\n\", l.Addr())\n}\n</code></pre>\n\n<p>Results in something like:</p>\n\n<pre><code>Addr: 0.0.0.0:37733\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3436, "user_id": 307614, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/671aed37f0d4a6668053a70a75f5c715?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/307614/dave"}, "edited": false, "score": 0, "creation_date": 1529010338, "post_id": 50781304, "comment_id": 88734246, "body": "Thanks for the history, makes sense why it would be needed for their purposes."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 6, "last_activity_date": 1528615915, "last_edit_date": 1592644375, "creation_date": 1528613999, "answer_id": 50781304, "question_id": 50780921, "link": "https://stackoverflow.com/questions/50780921/what-is-gos-net-listener-addr-used-for/50781304#50781304", "title": "What is Go&#39;s net.Listener Addr() used for?", "body": "<p>To add to Patrick's answer, this particular method <code>Addr()</code> to the interface type <code>Listener</code> was added in Go1.0 in June 2009 in <a href=\"https://github.com/golang/go/commit/5d2ee9d90afc8277d20a1f40056caa047fae695b\" rel=\"noreferrer\">commit 5d2ee9d</a>.</p>\n<p>The reason at the time was:</p>\n<blockquote>\n<h2>add Addr() string to net.Listener interface.</h2>\n<p>use it to avoid use of fixed ports in tests.</p>\n</blockquote>\n<p>That way the <a href=\"https://github.com/golang/go/commit/5d2ee9d90afc8277d20a1f40056caa047fae695b#diff-38e4c7cb2de53090999368c9acb28f4dR29\" rel=\"noreferrer\"><code>net/server_test.go</code></a> could listen on any available port, and still get back the exact address.</p>\n<pre><code>if network == &quot;tcp&quot; {\n    listenaddr += &quot;:0&quot;; // any available port\n}\ngo runServe(t, network, listenaddr, listening, done);\naddr := &lt;-listening; // wait for server to start\n</code></pre>\n<p>With <code>runServe()</code> returning the address through the channel, using the <code>Addr()</code> method:</p>\n<pre><code>listening &lt;- l.Addr();\n</code></pre>\n"}], "owner": {"reputation": 3436, "user_id": 307614, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/671aed37f0d4a6668053a70a75f5c715?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/307614/dave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1202, "favorite_count": 3, "accepted_answer_id": 50780968, "answer_count": 2, "score": 2, "last_activity_date": 1528615915, "creation_date": 1528609632, "question_id": 50780921, "link": "https://stackoverflow.com/questions/50780921/what-is-gos-net-listener-addr-used-for", "title": "What is Go&#39;s net.Listener Addr() used for?", "body": "<p>Go's <a href=\"https://golang.org/pkg/net/#Listener\" rel=\"nofollow noreferrer\"><code>net.Listener</code></a> interface looks like this:</p>\n\n<pre><code>type Listener interface {\n    // Accept waits for and returns the next connection to the listener.\n    Accept() (Conn, error)\n\n    // Close closes the listener.\n    // Any blocked Accept operations will be unblocked and return errors.\n    Close() error\n\n    // Addr returns the listener's network address.\n    Addr() Addr\n}\n</code></pre>\n\n<p>But what is the <code>Addr</code> actually used for? If I had to implement my own Listener that just returned an empty <code>Addr().String()</code> but accepted and closed connections just fine, what implications would that have?</p>\n"}, {"tags": ["go", "grpc"], "answers": [{"comments": [{"owner": {"reputation": 7554, "user_id": 700471, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ebb4cc58c1fce4f22abc59a1226ee8e2?s=128&d=identicon&r=PG", "display_name": "Matt Mc", "link": "https://stackoverflow.com/users/700471/matt-mc"}, "edited": false, "score": 0, "creation_date": 1528664299, "post_id": 50784927, "comment_id": 88582295, "body": "Thanks!  This will achieve what I asked; I assume that the server will <i>not</i> clean up without this mechanism?"}], "tags": [], "owner": {"reputation": 76, "user_id": 9921401, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-eCYKXxQD-DQ/AAAAAAAAAAI/AAAAAAAAAEc/yUvxfBb4gbk/photo.jpg?sz=128", "display_name": "Chad Maine", "link": "https://stackoverflow.com/users/9921401/chad-maine"}, "is_accepted": true, "score": 6, "last_activity_date": 1528642420, "creation_date": 1528642420, "answer_id": 50784927, "question_id": 50780559, "link": "https://stackoverflow.com/questions/50780559/go-grpc-stream-scope/50784927#50784927", "title": "Go gRPC Stream Scope", "body": "<p>Use a cancel (<a href=\"https://golang.org/pkg/context/#WithCancel\" rel=\"noreferrer\">https://golang.org/pkg/context/#WithCancel</a>) context to cancel from the client side:</p>\n\n<pre><code>func somewhereDeepInMyCode() {\n    ctx, cancel := context.WithCancel(context.Background())\n    stream, err := aClient.TastyColors(ctx)\n    // ...\n\n    go func() {\n        defer cancel()\n        stream.Send(msg)\n        // ...\n        // eventually this goroutine ends\n        // and `stream` would get GC'd\n    }\n}\n</code></pre>\n\n<p>The server can handle client-side cancellation for cleanup as needed:</p>\n\n<pre><code>for {\n    select {\n    ...\n    case &lt;-stream.Context().Done():\n    // cleanup\n    ...\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 7554, "user_id": 700471, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ebb4cc58c1fce4f22abc59a1226ee8e2?s=128&d=identicon&r=PG", "display_name": "Matt Mc", "link": "https://stackoverflow.com/users/700471/matt-mc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2149, "favorite_count": 2, "accepted_answer_id": 50784927, "answer_count": 1, "score": 3, "last_activity_date": 1528642420, "creation_date": 1528604895, "question_id": 50780559, "link": "https://stackoverflow.com/questions/50780559/go-grpc-stream-scope", "title": "Go gRPC Stream Scope", "body": "<p><strong>TLDR; If my Go gRPC bi-directional streaming server is looping on <code>Recv</code>/<code>Send</code> infinitely, how can I close the connection when my client's <code>stream</code> falls out of scope and gets GC'd?</strong></p>\n\n<hr>\n\n<p>Let's say I am using Go to do a gRPC bi-directional streaming call:</p>\n\n<pre><code>syntax = \"proto3\";\n\npackage mystical;\n\nservice Unicorn {\n    rpc RainbowStream(stream Rainbow) returns (stream Rainbow);\n}\n</code></pre>\n\n<p>I have a server implementation that I will register with my gRPC server:</p>\n\n<pre><code>type Server struct {}\n\nfunc (serv *Server) RainbowStream(stream proto.Unicorn_RainbowStreamServer) error {\n    // Stub implementation\n    // Just sends the rainbows back\n    for {\n        msg, err := stream.Recv()\n        if err != nil {\n            return err\n        }\n        if err := stream.Send(msg); err != nil {\n            return err\n        }\n    }\n}\n</code></pre>\n\n<p>Then I have a client, eliding some of the gRPC nitty-gritty:</p>\n\n<pre><code>type Client struct {\n    proto.UnicornClient\n}\n\nfunc (c *Client) TastyColors() (stream proto.Unicorn_RainbowStreamClient, err error) {\n    return c.RainbowStream()\n}\n</code></pre>\n\n<p>And I do this:</p>\n\n<pre><code>func somewhereDeepInMyCode() {\n\n    stream, err := aClient.TastyColors()\n    // ...\n\n    go func() {\n       stream.Send(msg)\n       // ...\n       // eventually this goroutine ends\n       // and `stream` would get GC'd\n    }\n}\n</code></pre>\n\n<p>When <code>stream</code> falls out of scope, does the gRPC streaming call clean itself up?  Normally, from what I understand, the server has to return on its <code>RainbowStream</code> call to close the connection.  If it doesn't clean itself up, how can I achieve this?</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1528645673, "post_id": 50780413, "comment_id": 88577265, "body": "Sorry if I am missing something. I can&#39;t understand what you are trying to achieve here by reflection etc. What you need ultimately seems to have been achieved by just <code>json.Unmarshal([]byte(v), &amp;personMap)</code> See <a href=\"https://play.golang.org/p/fPEikxh0lDv\" rel=\"nofollow noreferrer\">play.golang.org/p/fPEikxh0lDv</a> Can you kindly explain?"}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 4, "last_activity_date": 1528604184, "last_edit_date": 1528604184, "creation_date": 1528603398, "answer_id": 50780449, "question_id": 50780413, "link": "https://stackoverflow.com/questions/50780413/how-should-i-pass-param-in-golang/50780449#50780449", "title": "How should I pass param in golang?", "body": "<p>You should be able to get your map from the interface, using <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a>:</p>\n\n<pre><code>a := i.(map[string]interface{})\n</code></pre>\n\n<p>See \"<a href=\"https://stackoverflow.com/a/20714739/6309\">Convert Value type to Map in Golang?</a>\"</p>\n\n<p>I have modified your <a href=\"https://play.golang.org/p/R724_1G3tnF\" rel=\"nofollow noreferrer\">code here</a>.<br>\nNote that I don't try to mutate the <code>f(value)</code> argument, but I return it instead.</p>\n\n<pre><code>func f(v string, value reflect.Value) reflect.Value {\n  ...\n  return value \n}\n</code></pre>\n\n<p>So the code becomes:</p>\n\n<pre><code>value = f(jsonStr, value)\nfmt.Println(value.Kind(), value.Interface().(map[string]interface{}))\n</code></pre>\n"}], "owner": {"reputation": 1617, "user_id": 1478168, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/2Fok1.jpg?s=128&g=1", "display_name": "thinkerou", "link": "https://stackoverflow.com/users/1478168/thinkerou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 2, "accepted_answer_id": 50780449, "answer_count": 1, "score": 3, "last_activity_date": 1528604184, "creation_date": 1528602912, "question_id": 50780413, "link": "https://stackoverflow.com/questions/50780413/how-should-i-pass-param-in-golang", "title": "How should I pass param in golang?", "body": "<p>I have the follow whole codes:</p>\n\n<p>I hope that string convert map in golang, and use golang reflect.</p>\n\n<p>The following code have simpled from my project.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    jsonStr := `{\"name\": \"thinkerou\", \"age\": 31, \"balance\": 3.14}`\n\n    var a map[string]interface{}\n    var value reflect.Value = reflect.ValueOf(&amp;a)\n\n    // call function and pass param\n    f(jsonStr, value)\n\n    // print result\n    fmt.Println(value.Kind(), value.Interface())\n}\n\nfunc f(v string, value reflect.Value) {\n    personMap := make(map[string]interface{})\n\n    err := json.Unmarshal([]byte(v), &amp;personMap)\n\n    if err != nil {\n        panic(err)\n    }\n\n    value = reflect.Indirect(value)\n    value = reflect.MakeMap(value.Type())\n    for k, v := range personMap {\n        // set key/value\n        value.SetMapIndex(reflect.ValueOf(k), reflect.ValueOf(v))\n    }\n\n    // print result\n    fmt.Println(value.Kind(), value.Interface())\n}\n</code></pre>\n\n<p>and run it and will get the result:</p>\n\n<pre><code>map map[age:31 balance:3.14 name:thinkerou]\nptr &amp;map[]\n</code></pre>\n\n<p>I hope the follow result:</p>\n\n<pre><code>map map[age:31 balance:3.14 name:thinkerou]\nmap map[age:31 balance:3.14 name:thinkerou]\n</code></pre>\n\n<p>How should I pass <code>reflect.Value</code> param? thanks!</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "is_accepted": true, "score": 3, "last_activity_date": 1528605854, "last_edit_date": 1528605854, "creation_date": 1528600105, "answer_id": 50780256, "question_id": 50780008, "link": "https://stackoverflow.com/questions/50780008/can-golang-hot-swap-in-develop-mode/50780256#50780256", "title": "Can golang hot swap in develop mode?", "body": "<p>You use or create a watcher process that looks for changes, will recompile and restart the server when it identifies a change.</p>\n\n<p>Here are some examples of this. I use Beego and <code>bee</code> rebuilds my server during development all the time.</p>\n\n<p><strong>Gin</strong></p>\n\n<ul>\n<li>GitHub: <a href=\"https://github.com/codegangsta/gin\" rel=\"nofollow noreferrer\">https://github.com/codegangsta/gin</a></li>\n</ul>\n\n<blockquote>\n  <p><code>gin</code> is a simple command line utility for live-reloading Go web applications. Just run <code>gin</code> in your app directory and your web app will be served with <code>gin</code> as a proxy. <code>gin</code> will automatically recompile your code when it detects a change. Your app will be restarted the next time it receives an HTTP request.</p>\n</blockquote>\n\n<p><strong>Fresh</strong></p>\n\n<ul>\n<li>GitHub: <a href=\"https://github.com/pilu/fresh\" rel=\"nofollow noreferrer\">https://github.com/pilu/fresh</a></li>\n</ul>\n\n<blockquote>\n  <p>Fresh will watch for file events, and every time you create/modify/delete a file it will build and restart the application. If go build returns an error, it will log it in the tmp folder.</p>\n</blockquote>\n\n<p>Fresh works specifically with Traffic, Martini and gocraft/web.</p>\n\n<p><strong>Beego bee</strong></p>\n\n<p>The Beego web framework also does this. This is implemented in <code>bee</code>, a CLI tool for running Beego.</p>\n\n<ul>\n<li>Website: <a href=\"https://beego.me/\" rel=\"nofollow noreferrer\">https://beego.me/</a></li>\n<li>Framework: <a href=\"https://github.com/astaxie/beego/\" rel=\"nofollow noreferrer\">https://github.com/astaxie/beego/</a></li>\n<li>CLI App: <a href=\"https://github.com/beego/bee\" rel=\"nofollow noreferrer\">https://github.com/beego/bee</a></li>\n</ul>\n\n<p><code>bee</code> will watch all the project directories by default and has an option to also watch the <code>vendor</code> directory.</p>\n"}], "owner": {"reputation": 7356, "user_id": 4732175, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/w2Po6.jpg?s=128&g=1", "display_name": "Zhang Buzz", "link": "https://stackoverflow.com/users/4732175/zhang-buzz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2689, "favorite_count": 1, "accepted_answer_id": 50780256, "answer_count": 1, "score": 3, "last_activity_date": 1528673807, "creation_date": 1528596348, "last_edit_date": 1528673807, "question_id": 50780008, "link": "https://stackoverflow.com/questions/50780008/can-golang-hot-swap-in-develop-mode", "title": "Can golang hot swap in develop mode?", "body": "<p>For production environment, I can accept that golang can not hot swap. But for development mode, must I recompile whole project, and restart server, even just modify 1 line of code? Is there any way to quickly hot swap code to check result for debugging?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1528570728, "post_id": 50777163, "comment_id": 88562084, "body": "A single process can create and run multiple <code>Cmd</code> objects."}, {"owner": {"reputation": 353, "user_id": 3593762, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cF6wa1FSnfQ/AAAAAAAAAAI/AAAAAAAAAAU/hbSKP7G8_s8/photo.jpg?sz=128", "display_name": "Ali Zohrevand", "link": "https://stackoverflow.com/users/3593762/ali-zohrevand"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528575168, "post_id": 50777163, "comment_id": 88563143, "body": "i could not find any example or tuts for run or add Cmd objects to process obj, could you please make an example ?"}, {"owner": {"reputation": 353, "user_id": 3593762, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cF6wa1FSnfQ/AAAAAAAAAAI/AAAAAAAAAAU/hbSKP7G8_s8/photo.jpg?sz=128", "display_name": "Ali Zohrevand", "link": "https://stackoverflow.com/users/3593762/ali-zohrevand"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528580112, "post_id": 50777163, "comment_id": 88564309, "body": "i am familiar with cmd object,  i want all of cmd execution run in same process, i&#39;ve updated my question"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528581252, "post_id": 50777163, "comment_id": 88564567, "body": "If all you want is to change directory, then set <a href=\"https://godoc.org/os/exec#Cmd.Dir\" rel=\"nofollow noreferrer\">Cmd.Dir</a>.  Otherwise, run a shell to execute multiple commands from a child process.  Note that the shell will start a process for each command."}, {"owner": {"reputation": 353, "user_id": 3593762, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cF6wa1FSnfQ/AAAAAAAAAAI/AAAAAAAAAAU/hbSKP7G8_s8/photo.jpg?sz=128", "display_name": "Ali Zohrevand", "link": "https://stackoverflow.com/users/3593762/ali-zohrevand"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528585582, "post_id": 50777163, "comment_id": 88565399, "body": "my only purpose is not &quot;Cd&quot; command, because of create and start new process for each command, command like &quot;cd&quot; will not work, i am looking for executing all cmd in one process."}, {"owner": {"reputation": 353, "user_id": 3593762, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cF6wa1FSnfQ/AAAAAAAAAAI/AAAAAAAAAAU/hbSKP7G8_s8/photo.jpg?sz=128", "display_name": "Ali Zohrevand", "link": "https://stackoverflow.com/users/3593762/ali-zohrevand"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528586111, "post_id": 50777163, "comment_id": 88565496, "body": "i am develoning a reverse shell or some thing like ssh, user send command like &quot;ls&quot; , &quot;cd&quot; etc. and client execute them and reply response of that command. command like cd did not work."}, {"owner": {"reputation": 353, "user_id": 3593762, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cF6wa1FSnfQ/AAAAAAAAAAI/AAAAAAAAAAU/hbSKP7G8_s8/photo.jpg?sz=128", "display_name": "Ali Zohrevand", "link": "https://stackoverflow.com/users/3593762/ali-zohrevand"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528587233, "post_id": 50777163, "comment_id": 88565660, "body": "yes, my last choice is develop built in cd, what do you mean run shell? i search for this key word and os/exec was only way! how run shell and does it return output of each command? thanks for taking time and helping."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1528607187, "post_id": 50777163, "comment_id": 88568147, "body": "How to run shell: See existing answer to this question and <a href=\"https://stackoverflow.com/questions/34458625/\">stackoverflow.com/questions/34458625</a>."}], "answers": [{"comments": [{"owner": {"reputation": 353, "user_id": 3593762, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cF6wa1FSnfQ/AAAAAAAAAAI/AAAAAAAAAAU/hbSKP7G8_s8/photo.jpg?sz=128", "display_name": "Ali Zohrevand", "link": "https://stackoverflow.com/users/3593762/ali-zohrevand"}, "edited": false, "score": 0, "creation_date": 1528585777, "post_id": 50778851, "comment_id": 88565441, "body": "thank you for answering, i test your solution and it did not work.  i tested in mac os high sierra."}, {"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "reply_to_user": {"reputation": 353, "user_id": 3593762, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cF6wa1FSnfQ/AAAAAAAAAAI/AAAAAAAAAAU/hbSKP7G8_s8/photo.jpg?sz=128", "display_name": "Ali Zohrevand", "link": "https://stackoverflow.com/users/3593762/ali-zohrevand"}, "edited": false, "score": 0, "creation_date": 1528588375, "post_id": 50778851, "comment_id": 88565804, "body": "@Ali.ZV what did you try, how did it not work? Your experiences differ from mine since it does work for me :)"}, {"owner": {"reputation": 353, "user_id": 3593762, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cF6wa1FSnfQ/AAAAAAAAAAI/AAAAAAAAAAU/hbSKP7G8_s8/photo.jpg?sz=128", "display_name": "Ali Zohrevand", "link": "https://stackoverflow.com/users/3593762/ali-zohrevand"}, "edited": false, "score": 0, "creation_date": 1528647018, "post_id": 50778851, "comment_id": 88577614, "body": "my bad,it worked and solve my other problem but not this problem... thanks."}], "tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": false, "score": 3, "last_activity_date": 1528588389, "last_edit_date": 1528588389, "creation_date": 1528581198, "answer_id": 50778851, "question_id": 50777163, "link": "https://stackoverflow.com/questions/50777163/is-there-any-way-run-multiple-command-os-exec-in-one-proccess-in-golang/50778851#50778851", "title": "is there any way run multiple command &quot;os/exec&quot; in one proccess in golang?", "body": "<p>Yes! </p>\n\n<p>You could use <code>sh -c \"ls &amp;&amp; cd model\"</code></p>\n\n<pre><code>cmd := exec.Command(\"sh\", \"-c\", \"ls &amp;&amp; cd model\")\ncmd.Stdout = &amp;stdout\ncmd.Stderr = &amp;stderr\nerr = cmd.Run()\n</code></pre>\n\n<p>On ubuntu</p>\n\n<pre><code>$ man sh\n\nDASH(1)                                                              BSD General Commands Manual                                                              DASH(1)\n\nNAME\n     dash \u2014 command interpreter (shell)\n\n           -c               Read commands from the command_string operand instead of from the standard input.  Special parameter 0 will be set from the command_name\n                            operand and the positional parameters ($1, $2, etc.)  set from the remaining argument operands.\n</code></pre>\n\n<hr>\n\n<p>An example using:</p>\n\n<pre><code>$ go version\ngo version go1.10.2 linux/amd64\n</code></pre>\n\n<hr>\n\n<pre><code>// cmd/test/main.go\n\npackage main\n\nimport (\n        \"bytes\"\n        \"os/exec\"\n        \"fmt\"\n)\n\n\nfunc main() {\n        var stdout, stderr bytes.Buffer\n        cmd := exec.Command(\"sh\", \"-c\", \"echo 'hello' &amp;&amp; echo 'hi'\")\n        cmd.Stdout = &amp;stdout\n        cmd.Stderr = &amp;stderr\n        err := cmd.Run()\n        fmt.Println(err)\n        out := stdout.String() + stderr.String()\n        fmt.Printf(out)\n}\n</code></pre>\n\n<hr>\n\n<pre><code>$ go run cmd/test/main.go\n&lt;nil&gt;\nhello\nhi\n</code></pre>\n"}], "owner": {"reputation": 353, "user_id": 3593762, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-cF6wa1FSnfQ/AAAAAAAAAAI/AAAAAAAAAAU/hbSKP7G8_s8/photo.jpg?sz=128", "display_name": "Ali Zohrevand", "link": "https://stackoverflow.com/users/3593762/ali-zohrevand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2371, "favorite_count": 2, "answer_count": 1, "score": 0, "last_activity_date": 1528589242, "creation_date": 1528567628, "last_edit_date": 1528589242, "question_id": 50777163, "link": "https://stackoverflow.com/questions/50777163/is-there-any-way-run-multiple-command-os-exec-in-one-proccess-in-golang", "title": "is there any way run multiple command &quot;os/exec&quot; in one proccess in golang?", "body": "<p>i want run multiple command in \"os/exec\" in one process, as you see below some command like \"cd\" not worked.</p>\n\n<pre><code>func main()  {\ncmd := exec.Command(\"ls\")\ncmdOutput := &amp;bytes.Buffer{}\ncmd.Stdout = cmdOutput\nerr := cmd.Run()\nfmt.Print(string(cmdOutput.Bytes()))\n\nfmt.Println(\"..........  cd   .........\")\ncdOutput := &amp;bytes.Buffer{}\ncdcomand:=exec.Command(\"cd\",\"model\")\ncdcomand.Stdout = cdOutput\nerr = cdcomand.Run()\nfmt.Print(string(cdOutput.Bytes()))\nfmt.Println(\".......... ls .........\")\nlsOutput := &amp;bytes.Buffer{}\nlscmd:=exec.Command(\"ls\")\nlscmd.Stdout = lsOutput\n\nerr = lscmd.Run()\nif err != nil {\n    os.Stderr.WriteString(err.Error())\n}\nfmt.Print(string(lsOutput.Bytes()))}\n</code></pre>\n\n<p><br>\ni try with another way:\n<br>\n    package main</p>\n\n<pre><code>import (\n\"os/exec\"\n\"bytes\"\n\"os\"\n\"fmt\"\n)\n\nfunc main()  {\ncmd := exec.Command(\"ls\")\ncmdOutput := &amp;bytes.Buffer{}\ncmd.Stdout = cmdOutput\nerr := cmd.Run()\nfmt.Print(string(cmdOutput.Bytes()))\n\nfmt.Println(\"..........  cd and ls   .........\")\ncdOutput := &amp;bytes.Buffer{}\ncdcomand:= exec.Command(\"sh\", \"-c\", \"ls &amp;&amp; cd model\")\ncdcomand.Stdout = cdOutput\nerr = cdcomand.Run()\nfmt.Print(string(cdOutput.Bytes()))\nfmt.Println(\".......... ls .........\")\nlsOutput := &amp;bytes.Buffer{}\nlscmd:=exec.Command(\"ls\")\nlscmd.Stdout = lsOutput\n\nerr = lscmd.Run()\nif err != nil {\n    os.Stderr.WriteString(err.Error())\n}\nfmt.Print(string(lsOutput.Bytes()))\n}\n</code></pre>\n\n<p>it did not work too.</p>\n\n<p>in cmd <a href=\"https://golang.org/pkg/os/exec/#Cmd\" rel=\"nofollow noreferrer\">document</a> writes: <br></p>\n\n<blockquote>\n  <p>A Cmd cannot be reused after calling its Run, Output or CombinedOutput methods. </p>\n</blockquote>\n\n<p>i've searched all tuts and docs for a way to do this, but i could not find any things. there was no solution in <a href=\"https://zaiste.net/executing_external_commands_in_go/\" rel=\"nofollow noreferrer\">Executing external commands in Go</a> article and <a href=\"https://blog.kowalczyk.info/article/wOYk/advanced-command-execution-in-go-with-osexec.html\" rel=\"nofollow noreferrer\">advanced command execution in Go with os</a>\n<br></p>\n\n<p>each cmd command execute in different process so command like \"cd\" will not change directory .<br> is there any way run multiple command \"os/exec\" in one proccess in golang?  </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1528560784, "post_id": 50776156, "comment_id": 88559271, "body": "You can&#39;t cancel a Read from Stdin, just leave the goroutine running and make sure it can&#39;t effect the program if it completes later on"}, {"owner": {"reputation": 9876, "user_id": 307990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6c21411c1e4d34bf068a7f656561f147?s=128&d=identicon&r=PG", "display_name": "Greg Giacovelli", "link": "https://stackoverflow.com/users/307990/greg-giacovelli"}, "edited": false, "score": 0, "creation_date": 1528561638, "post_id": 50776156, "comment_id": 88559531, "body": "<a href=\"https://golang.org/pkg/os/#File.SetReadDeadline\" rel=\"nofollow noreferrer\">golang.org/pkg/os/#File.SetReadDeadline</a> with this you could interrupt your read"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 9876, "user_id": 307990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6c21411c1e4d34bf068a7f656561f147?s=128&d=identicon&r=PG", "display_name": "Greg Giacovelli", "link": "https://stackoverflow.com/users/307990/greg-giacovelli"}, "edited": false, "score": 0, "creation_date": 1528566005, "post_id": 50776156, "comment_id": 88560763, "body": "@GregGiacovelli: that will return <code>ErrNoDeadline</code> on stdin"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1528572125, "post_id": 50776156, "comment_id": 88562458, "body": "It should be possible to stick an <code>io.Pipe</code> between the stdin and the consumer and then close one side of the pipe\u2014that should make the consumer receive <code>io.EOF</code> and the producer to return <code>io.ErrClosedPipe</code> (so it also may quit). I have not tested it but worth investigating."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1528572631, "post_id": 50776156, "comment_id": 88562565, "body": "@kostix, the producer won\u2019t be interrupted because it will also be blocked in Read. You can setup a POSIX \u201cself pipe trick\u201d, and poll the actual fd and close an <code>os.Pipe</code>, but it\u2019s rarely worth the effort."}, {"owner": {"reputation": 1104, "user_id": 3513453, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4a7f4865f48c8e1e971070379460b257?s=128&d=identicon&r=PG&f=1", "display_name": "felipeek", "link": "https://stackoverflow.com/users/3513453/felipeek"}, "edited": false, "score": 0, "creation_date": 1528908676, "post_id": 50776156, "comment_id": 88688382, "body": "Thanks guys, I guess it is not possible then"}], "owner": {"reputation": 1104, "user_id": 3513453, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4a7f4865f48c8e1e971070379460b257?s=128&d=identicon&r=PG&f=1", "display_name": "felipeek", "link": "https://stackoverflow.com/users/3513453/felipeek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 216, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1575659599, "creation_date": 1528560607, "question_id": 50776156, "link": "https://stackoverflow.com/questions/50776156/stop-goroutine-that-is-blocked-gracefully", "title": "Stop goroutine that is blocked gracefully", "body": "<p>I have a goroutine that is constantly blocked reading the stdin, like this:</p>\n\n<pre><code>func routine() {\n    for {\n        data := make([]byte, 8)\n        os.Stdin.Read(data);\n        otherChannel &lt;-data\n    }\n}\n</code></pre>\n\n<p>The routine waits to read 8 bytes via stdin and feeds another channel.</p>\n\n<p>I want to gracefully stop this goroutine from the main thread. However, since the goroutine will almost always be blocked reading from stdin, I can't find a good solution to force it to stop. I thought about something like:</p>\n\n<pre><code>func routine(stopChannel chan struct{}) {\n    for {\n        select {\n        case &lt;-stopChannel:\n            return\n        default:\n            data := make([]byte, 8)\n            os.Stdin.Read(data);\n            otherChannel &lt;-data\n        }\n    }\n}\n</code></pre>\n\n<p>However, the problem is that if there is no more input in the stdin when the <code>stopChannel</code> is closed, the goroutine will stay blocked and not return.</p>\n\n<p>Is there a good approach to make it return immediately when the main thread wants?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "type-assertion"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1528557839, "post_id": 50775367, "comment_id": 88558440, "body": "@xrfang Something like this? <a href=\"https://play.golang.org/p/IKxIj8XoOLc\" rel=\"nofollow noreferrer\">play.golang.org/p/IKxIj8XoOLc</a>"}, {"owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528775181, "post_id": 50775367, "comment_id": 88623483, "body": "@mkopriva yes, this is close to what I want"}], "answers": [{"tags": [], "owner": {"reputation": 3183, "user_id": 216345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ffc76b5c6c4607d55b0796da63d67f0?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/216345/thomas"}, "is_accepted": false, "score": 1, "last_activity_date": 1528563696, "creation_date": 1528563696, "answer_id": 50776610, "question_id": 50775367, "link": "https://stackoverflow.com/questions/50775367/type-assertion-with-embeded-types/50776610#50776610", "title": "Type assertion with embeded types", "body": "<p>You're trying to implement an inheritance style system in go. Struct embedding is not inheritance and should not be thought of or treated as such. This is an anti-pattern in go and generally does not work as you would desire or expect.</p>\n\n<p>Instead, the more idiomatic approach to this would be to define an interface (or a couple interfaces) and have your response types implement the necessary methods to conform.</p>\n\n<pre><code>type ApiReply interface {\n    Status() (string, string)\n\n    Body() (io.Reader, error)\n}\n\ntype BizError struct {\n    Code string\n    Mesg string\n}\n\nfunc (b BizError) Status() (string, string) {\n    return b.Code, b.Mesg\n}\n\nfunc (b BizError) Body() (io.Reader, error) {\n    return nil, errors.New(\"BizError never contains a body\")\n}\n</code></pre>\n\n<p>You would then implement <code>ApiReply</code> on your other response type structs. I'm of course guessing at what you actually need here but hopefully this gets the point across.</p>\n\n<p>And if you find you must, you can now do a type switch against the <code>ApiReply</code> instance you receive and special case any underlying types if absolutely necessary.</p>\n"}], "owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1528720585, "creation_date": 1528554923, "last_edit_date": 1528720585, "question_id": 50775367, "link": "https://stackoverflow.com/questions/50775367/type-assertion-with-embeded-types", "title": "Type assertion with embeded types", "body": "<pre><code>type BizError struct {\n    Code string\n    Mesg string\n}\n\ntype ApiReply struct {\n    Err BizError\n}\n\ntype GetDataReply struct {\n    Data interface{}\n    ApiReply\n}\n</code></pre>\n\n<p>with the above definition, I want to do the following:</p>\n\n<pre><code>func Func1(data interface{}) {\n    switch data.(type) {\n    case ApiReply:\n        data.(ApiReply).Err.Code = \"0\"\n    }\n}\n</code></pre>\n\n<p>The key problem is that in Func1, the type-switch does <em>not</em> know any new types that embeds ApiReply, it is a \"generic\" handler.  While the <code>data</code> \npassed to it is actually ApiReply's \"child class\".  Apparently, in Go, you cannot assert a GetDataReply type to an ApiReply.</p>\n\n<p>How can I handle this case so that in Func1 I do not need to have all possible structs that may embed ApiReply explicitly declared?</p>\n"}, {"tags": ["angular", "go", "cors", "preflight"], "answers": [{"tags": [], "owner": {"reputation": 4080, "user_id": 3547482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f93615ed584db10b4cc59daa1437b7e1?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander Leonov", "link": "https://stackoverflow.com/users/3547482/alexander-leonov"}, "is_accepted": false, "score": 1, "last_activity_date": 1528555750, "creation_date": 1528555750, "answer_id": 50775491, "question_id": 50775087, "link": "https://stackoverflow.com/questions/50775087/cors-issue-with-options-request/50775491#50775491", "title": "CORS issue with OPTIONS request", "body": "<p>You don't need to do anything in your angular app in order to make it work because <strong>CORS is a server-side configuration</strong>. Essentially it says who can call your API and using what methods/headers/other stuff. Having received proper headers in a response to an OPTIONS request browser then decides if you're allowed to make this call or not. Angular app has nothing to do with this. So, error you're receiving tells that you have not configured CORS properly on your web server. You can start, for example, from <a href=\"https://flaviocopes.com/golang-enable-cors/\" rel=\"nofollow noreferrer\">this article</a> on how to enable it on a GO web server.</p>\n"}, {"tags": [], "owner": {"reputation": 330, "user_id": 2785084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86f8856e60ee8e027677ce584772077d?s=128&d=identicon&r=PG&f=1", "display_name": "autlunatic", "link": "https://stackoverflow.com/users/2785084/autlunatic"}, "is_accepted": false, "score": 0, "last_activity_date": 1528724107, "creation_date": 1528724107, "answer_id": 50799017, "question_id": 50775087, "link": "https://stackoverflow.com/questions/50775087/cors-issue-with-options-request/50799017#50799017", "title": "CORS issue with OPTIONS request", "body": "<p>have you considered using the <a href=\"https://github.com/rs/cors\" rel=\"nofollow noreferrer\">https://github.com/rs/cors</a> package?</p>\n\n<p>with the cors package you can easily test your connection with the AllowAll() method. It handles the OPTIONS request for you. </p>\n\n<pre><code>handler := cors.AllowAll().Handler(mux)\ngo func() {\n    http.ListenAndServe(\":5050\", handler)\n}()\n</code></pre>\n\n<p>cross origin requests are forbidden by default.\nyou can allow additional origins for your application.\nHowever in production you should not use AllowAll(), but define your allowed origins.</p>\n"}], "owner": {"reputation": 2453, "user_id": 2647198, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/fhjZv.jpg?s=128&g=1", "display_name": "Vikram", "link": "https://stackoverflow.com/users/2647198/vikram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1837, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1528724107, "creation_date": 1528553037, "last_edit_date": 1528555906, "question_id": 50775087, "link": "https://stackoverflow.com/questions/50775087/cors-issue-with-options-request", "title": "CORS issue with OPTIONS request", "body": "<p>I am working on an application built with angular 5 and facing issues with CORS, in order to authorize users I am using jwt token method and send it in headers using jwt.interceptor as follows </p>\n\n<pre><code>export class JwtInterceptor implements HttpInterceptor {\n    intercept(request: HttpRequest&lt;any&gt;, next: HttpHandler): Observable&lt;HttpEvent&lt;any&gt;&gt; {\n        // add authorization header with jwt token if available\n        let currentUser = JSON.parse(localStorage.getItem('currentUser'));\n        if (currentUser &amp;&amp; currentUser.token) {\n            request = request.clone({\n                setHeaders: { \n                    Authorization: `Bearer ${currentUser.token}`,\n                    Ip:currentUser.Ip\n                }\n            });\n        }\n        return next.handle(request);\n    }\n}\n</code></pre>\n\n<p>this code modifies the header and add token/bearer, because of this modification browsers sends preflight OPTIONS requests before actual API, I am using httpclient to send api requestes as follows</p>\n\n<pre><code>merchantDefaultSetup(ipAddress) {\n      if(this.access_token != '')\n      {\n         this.coreService.setMerchantDefaultSetup(this.access_token, ipAddress).subscribe(res =&gt; {this.apiResponse = res},\n                                                                         err =&gt; console.log(err),\n                                                                         ()  =&gt; this.checkSetMerchantDefaultSetupApiResponse(this.apiResponse)\n                                                                        );\n      }\n      else\n      {\n        this.router.navigate([\"/dashboard\"]);\n      }\n   }\n</code></pre>\n\n<p>and this functions uses following service </p>\n\n<pre><code>public setMerchantDefaultSetup(token, ipAddress)\n   {\n      let header = new HttpHeaders({'Content-Type': 'application/json', 'Ip': ipAddress});\n      return this.http.get&lt;Response&gt;(this.apiUrl+'merchant/default-setup/'+token, {headers: header}).map(response =&gt; response.response);\n   }\n</code></pre>\n\n<p>above code works proper when api and app code are on same server but not I have created two ec2 instances on aws to host api and apps separately.</p>\n\n<p>Following is the error I get on api hit </p>\n\n<pre><code>Cross-Origin Request Blocked: The Same Origin Policy disallows reading the remote resource at https://mydomain.mytestsite.com:8080/api/v1/merchant/default-setup/678as6d98a6s8d68. (Reason: CORS header \u2018Access-Control-Allow-Origin\u2019 missing)\n</code></pre>\n\n<p>REST api are built with golang and running on 8080 port </p>\n\n<p>All the articles gives solution for get,post, put methods but they are working fine in my case unless there is any preflight OPTIONS request</p>\n\n<p>Please help</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 0, "creation_date": 1528567346, "post_id": 50776773, "comment_id": 88561157, "body": "Can you elaborate on how this achieves what I&#39;m asking for?"}], "tags": [], "owner": {"reputation": 75, "user_id": 1638680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3daa6d9e1fd176087a06f2bac4475895?s=128&d=identicon&r=PG", "display_name": "dgm", "link": "https://stackoverflow.com/users/1638680/dgm"}, "is_accepted": false, "score": 0, "last_activity_date": 1528564820, "creation_date": 1528564820, "answer_id": 50776773, "question_id": 50774964, "link": "https://stackoverflow.com/questions/50774964/passing-method-parameters-for-interface-only-once/50776773#50776773", "title": "Passing method parameters for interface only once?", "body": "<p>Simply move the bits you call in Init to your main function. Init is called at startup and anything created in it may disappear when Init exits.</p>\n\n<pre><code>func main(){\n    r := mux.NewRouter()\n\n    // Default routes\n    router.Route(\"/\", webtest.TestController{}, r)\n\n    // Serve the routes\n    router.Serve(r)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 1, "creation_date": 1528739253, "post_id": 50802157, "comment_id": 88612678, "body": "Great answer. I wanted to make it like this to give me more control over what I do while having everything important gathered in one place. I guess I will have to change the way I look at this."}, {"owner": {"reputation": 3183, "user_id": 216345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ffc76b5c6c4607d55b0796da63d67f0?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/216345/thomas"}, "reply_to_user": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 0, "creation_date": 1528763063, "post_id": 50802157, "comment_id": 88621140, "body": "If you&#39;re happy with the answer, please don&#39;t forget to accept @p-nick"}], "tags": [], "owner": {"reputation": 3183, "user_id": 216345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ffc76b5c6c4607d55b0796da63d67f0?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/216345/thomas"}, "is_accepted": true, "score": 0, "last_activity_date": 1528734136, "creation_date": 1528734136, "answer_id": 50802157, "question_id": 50774964, "link": "https://stackoverflow.com/questions/50774964/passing-method-parameters-for-interface-only-once/50802157#50802157", "title": "Passing method parameters for interface only once?", "body": "<p>Unfortunately, I don't think there's going to be an answer that you're happy with. At the end of the day the following must be true:</p>\n\n<p>Each handler must use the <code>http.Responsewriter</code> and <code>*http.Request</code> to service the request.</p>\n\n<p>A thing to keep in mind is that shorter and simpler do not always go hand-in-hand. Passing the writer and the response to the functions that need them, while slightly verbose, is exceedingly simple. </p>\n\n<p>What may make you happiest is to instead push most of the logic actually down into some additional methods that deal in the semantics of the operations rather than the network request layer. Using a GET request to load a record as an example, you might instead structure it as:</p>\n\n<pre><code>func main() {\n    http.DefaultServeMux.HandleFunc(\"/\", getHandler)\n\n    if err := http.ListenAndServe(\":8080\", nil); err != nil {\n        panic(err)\n    }\n}\n\nfunc getHandler(w http.ResponseWriter, r *http.Request) {\n    // Do stuff with the request, like deserialize\n    // Extract the ID\n    // Call getLogic\n    // return an appropriate error or serialize the response back out\n}\n\nfunc getLogic(recordID int) (Record, error) {\n    // Do actual interesting logic here.\n}\n</code></pre>\n\n<p>Splitting it up like this is not without a potential cost in simplicity. While it does let you test chunks of your logic without needing to deal with a <code>http.ResponseWriter</code> or <code>http.Request</code> you now have to make a decision where to cut that seam. Doing so consistently might be awkward.</p>\n\n<p>You could also try to take a different approaches like create a struct per request, put the writer and request on it, and then call the appropriate method, but I wouldn't recommend it:</p>\n\n<pre><code>func getHandler(w http.ResponseWriter, r *http.Request) {\n    SingleRequest{w, r}.Get()\n}\n\ntype SingleRequest struct {\n    writer  http.ResponseWriter\n    request *http.Request\n}\n\nfunc (s SingleRequest) Get() {\n    // Do logic here, but the method still has to access s.writer and s.request\n}\n</code></pre>\n\n<p>Neither of these approaches offer much in terms of simplicity of brevity. What minor amounts of brevity they do yield is, in my opinion, at the cost of simplicity. The first approach, however, could be reasonable depending on the complexity of a given handler. It is, after all, the extension of the pattern of making smaller functions to break up a larger function.</p>\n\n<p>As it stands currently, I am unaware of any approach that universally increases simplicity while decreasing code size. Instead, we should focus on why you feel like this is a problem that needs to be solved in the first place. Are you familiar with the <a href=\"https://golang.org/pkg/net/http/httptest/\" rel=\"nofollow noreferrer\" title=\"httptest\">httptest</a> package in the standard lib? If testing is your concern it will help you with testing these handlers.</p>\n"}], "owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 50802157, "answer_count": 2, "score": 1, "last_activity_date": 1528734136, "creation_date": 1528552205, "question_id": 50774964, "link": "https://stackoverflow.com/questions/50774964/passing-method-parameters-for-interface-only-once", "title": "Passing method parameters for interface only once?", "body": "<p>I'm trying to figure out a way to make my code shorter and simpler, by only calling the parameters for interface methods once in the parent struct(?)</p>\n\n<p>First the route defining:</p>\n\n<pre><code>func Init() {\n    // Create route\n    r := mux.NewRouter()\n\n    // Default routes\n    router.Route(\"/\", webtest.TestController{}, r)\n\n    // Serve the routes\n    router.Serve(r)\n}\n</code></pre>\n\n<p>Then the functions for it:</p>\n\n<pre><code>type Controller struct {\n    ControllerInterface\n}\n\ntype ControllerInterface interface {\n    Get(w http.ResponseWriter, r *http.Request)\n}\n\nfunc Route(path string, ct interface{}, r *mux.Router) {\n    if c, ok := ct.(controllers.ControllerInterface); ok {\n        r.HandleFunc(path, http.HandlerFunc(c.Get)).Methods(\"GET\")\n    }\n}\n</code></pre>\n\n<p>Then I call the route with</p>\n\n<pre><code>type TestController struct {\n    controllers.Controller\n}\n\nfunc (c TestController) Get(w http.ResponseWriter, r *http.Request) {\n    println(\"Hello World\")\n}\n</code></pre>\n\n<p>As you can see I have to have <code>w http.ResponseWriter, r *http.Request</code> everywhere, or the routes would not work. Is there any way I can include these params in the parent struct (or similar) so I don't have to include it everytime?</p>\n"}, {"tags": ["go", "concurrency", "channel"], "comments": [{"owner": {"reputation": 3183, "user_id": 216345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ffc76b5c6c4607d55b0796da63d67f0?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/216345/thomas"}, "edited": false, "score": 0, "creation_date": 1528564103, "post_id": 50774668, "comment_id": 88560272, "body": "Honestly it just looks to me like it probably only runs for a second but we&#39;re stuck watching the very slow terminal scroll. Comment out your printing and see how long it runs."}, {"owner": {"reputation": 3183, "user_id": 216345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ffc76b5c6c4607d55b0796da63d67f0?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/216345/thomas"}, "edited": false, "score": 1, "creation_date": 1528564248, "post_id": 50774668, "comment_id": 88560311, "body": "Tested it out on my machine. It is working working properly. You&#39;re mostly just dealing with slow terminal printing."}, {"owner": {"reputation": 405, "user_id": 4350349, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/GhnLJ.jpg?s=128&g=1", "display_name": "benSooraj", "link": "https://stackoverflow.com/users/4350349/bensooraj"}, "reply_to_user": {"reputation": 3183, "user_id": 216345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ffc76b5c6c4607d55b0796da63d67f0?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/216345/thomas"}, "edited": false, "score": 0, "creation_date": 1528572186, "post_id": 50774668, "comment_id": 88562467, "body": "@Thomas That probably is..."}], "answers": [{"comments": [{"owner": {"reputation": 405, "user_id": 4350349, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/GhnLJ.jpg?s=128&g=1", "display_name": "benSooraj", "link": "https://stackoverflow.com/users/4350349/bensooraj"}, "edited": false, "score": 0, "creation_date": 1528557071, "post_id": 50775322, "comment_id": 88558211, "body": "Awesome. That does appear to work. But, honestly, I still don&#39;t understand why it worked? Do you care to elaborate a little further? That would be really helpful..."}, {"owner": {"reputation": 3183, "user_id": 216345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ffc76b5c6c4607d55b0796da63d67f0?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/216345/thomas"}, "edited": false, "score": 0, "creation_date": 1528564215, "post_id": 50775322, "comment_id": 88560304, "body": "This isn&#39;t really a proper fix. I think you&#39;re just slowing down his printing enough that the terminal doesn&#39;t get excessively buffered."}, {"owner": {"reputation": 3183, "user_id": 216345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ffc76b5c6c4607d55b0796da63d67f0?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/216345/thomas"}, "edited": false, "score": 0, "creation_date": 1528564455, "post_id": 50775322, "comment_id": 88560365, "body": "I just want to reiterate that sleeping is pretty much never the answer! While your statement about select is true putting a sleep in here just makes his program run way slower. There is no actual problem with his program as it stands."}, {"owner": {"reputation": 94, "user_id": 5418667, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-baRILLW1ves/AAAAAAAAAAI/AAAAAAAAAJ4/9TIwxJEPc-k/photo.jpg?sz=128", "display_name": "Vlad", "link": "https://stackoverflow.com/users/5418667/vlad"}, "edited": false, "score": 0, "creation_date": 1528966243, "post_id": 50775322, "comment_id": 88709430, "body": "It isn&#39;t fixed. It illustrates the problem. Select statements have no guarantee which will proceed if several can. In your code value always can be written into <code>wordChannel</code>. And select do it. It never read from timer.C because it always can write to <code>wordChannel</code>."}], "tags": [], "owner": {"reputation": 94, "user_id": 5418667, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-baRILLW1ves/AAAAAAAAAAI/AAAAAAAAAJ4/9TIwxJEPc-k/photo.jpg?sz=128", "display_name": "Vlad", "link": "https://stackoverflow.com/users/5418667/vlad"}, "is_accepted": false, "score": 4, "last_activity_date": 1528554702, "creation_date": 1528554702, "answer_id": 50775322, "question_id": 50774668, "link": "https://stackoverflow.com/questions/50774668/time-newtimer-doesnt-work-as-i-expect/50775322#50775322", "title": "time.NewTimer doesn&#39;t work as I expect", "body": "<p>Timer works as intended. It sends a value to a channel.\nI think it is useful to read <a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"nofollow noreferrer\">about select statement</a>\nEach iteration in your loop can write to a channel. \nIf > 1 communication can proceed there is no guarantee which are.\nSo, if add delay to read loop like this : </p>\n\n<pre><code>for word := range mainWordChannel {\n    fmt.Printf(\"%s  \", word)\n    time.Sleep(time.Millisecond)\n}\n</code></pre>\n\n<p>In this case, only read from <code>timer.C</code> can proceed. And program will end. </p>\n"}], "owner": {"reputation": 405, "user_id": 4350349, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/GhnLJ.jpg?s=128&g=1", "display_name": "benSooraj", "link": "https://stackoverflow.com/users/4350349/bensooraj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 314, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1528557374, "creation_date": 1528550065, "last_edit_date": 1592644375, "question_id": 50774668, "link": "https://stackoverflow.com/questions/50774668/time-newtimer-doesnt-work-as-i-expect", "title": "time.NewTimer doesn&#39;t work as I expect", "body": "<p>I have a fairly simple program, which is supposed to self-terminate after a specified duration of time (for example, one second)</p>\n<p>The code:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;time&quot;\n)\n\nfunc emit(wordChannel chan string, done chan bool) {\n    defer close(wordChannel)\n\n    words := []string{&quot;The&quot;, &quot;quick&quot;, &quot;brown&quot;, &quot;fox&quot;}\n    i := 0\n    t := time.NewTimer(1 * time.Second)\n\n    for {\n        select {\n        case wordChannel &lt;- words[i]:\n            i++\n            if i == len(words) {\n                i = 0\n            }\n        // Please ignore the following case\n        case &lt;-done:\n            done &lt;- true\n            // fmt.Printf(&quot;Got done!\\n&quot;)\n            close(done)\n            return\n        case &lt;-t.C:\n            fmt.Printf(&quot;\\n\\nGot done!\\n\\n&quot;)\n            return\n        }\n    }\n}\n\nfunc main() {\n\n    mainWordChannel := make(chan string)\n    // Please ignore mainDoneChannel\n    mainDoneChannel := make(chan bool)\n\n    go emit(mainWordChannel, mainDoneChannel)\n\n    for word := range mainWordChannel {\n        fmt.Printf(&quot;%s  &quot;, word)\n    }\n\n}\n</code></pre>\n<p>I compile and execute the binary, and you can see the execution <a href=\"https://imgur.com/a/nFh3p3C\" rel=\"nofollow noreferrer\">here</a>.</p>\n<p>That is clearly above 1 second.</p>\n<p>Go's documentation on <a href=\"https://golang.org/pkg/time/#NewTimer\" rel=\"nofollow noreferrer\"><code>NewTimer</code></a> reads this:</p>\n<blockquote>\n<p><strong>func NewTimer</strong></p>\n<p><code>func NewTimer(d Duration) *Timer</code></p>\n<p>NewTimer creates a new Timer that will send the current time on its channel after at least duration d.</p>\n</blockquote>\n<p>Can someone kindly help me understand what's happening here? Why isn't the program terminating exactly (or closely <code>at least</code>) after 1 second?</p>\n"}, {"tags": ["go", "makefile"], "comments": [{"owner": {"reputation": 15776, "user_id": 12471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ce93e41c69b4e4ea8afce22cf11e2f4?s=128&d=identicon&r=PG", "display_name": "Jan Kr&#252;ger", "link": "https://stackoverflow.com/users/12471/jan-kr%c3%bcger"}, "edited": false, "score": 1, "creation_date": 1528550266, "post_id": 50774666, "comment_id": 88556268, "body": "This is not possible. Parameters that are not variable definitions are interpreted as Makefile targets. Might I suggest using a shell script instead, then you can say <code>.&#47;install github.com&#47;...</code>"}, {"owner": {"reputation": 4928, "user_id": 2736233, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/1R16X.png?s=128&g=1", "display_name": "Ivan Gabriele", "link": "https://stackoverflow.com/users/2736233/ivan-gabriele"}, "reply_to_user": {"reputation": 15776, "user_id": 12471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ce93e41c69b4e4ea8afce22cf11e2f4?s=128&d=identicon&r=PG", "display_name": "Jan Kr&#252;ger", "link": "https://stackoverflow.com/users/12471/jan-kr%c3%bcger"}, "edited": false, "score": 0, "creation_date": 1528550419, "post_id": 50774666, "comment_id": 88556300, "body": "Indeed I had the feeling it couldn&#39;t be done. I will do that instead. Thank you!"}, {"owner": {"reputation": 4928, "user_id": 2736233, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/1R16X.png?s=128&g=1", "display_name": "Ivan Gabriele", "link": "https://stackoverflow.com/users/2736233/ivan-gabriele"}, "reply_to_user": {"reputation": 15776, "user_id": 12471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ce93e41c69b4e4ea8afce22cf11e2f4?s=128&d=identicon&r=PG", "display_name": "Jan Kr&#252;ger", "link": "https://stackoverflow.com/users/12471/jan-kr%c3%bcger"}, "edited": false, "score": 0, "creation_date": 1528550643, "post_id": 50774666, "comment_id": 88556365, "body": "Just a subquestion @JanKr&#252;ger: it should be possible though to declare the shell script in the Makefile and parse the original arguments, which would make that somehow possible, is it ?"}, {"owner": {"reputation": 15776, "user_id": 12471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ce93e41c69b4e4ea8afce22cf11e2f4?s=128&d=identicon&r=PG", "display_name": "Jan Kr&#252;ger", "link": "https://stackoverflow.com/users/12471/jan-kr%c3%bcger"}, "edited": false, "score": 1, "creation_date": 1528551442, "post_id": 50774666, "comment_id": 88556582, "body": "To the best of my knowledge, common implementations of <code>make</code> don&#39;t allow you to access the original arguments in any way. <code>make</code> simply isn&#39;t designed for that kind of thing."}, {"owner": {"reputation": 69991, "user_id": 939557, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/3VPea.png?s=128&g=1", "display_name": "MadScientist", "link": "https://stackoverflow.com/users/939557/madscientist"}, "edited": false, "score": 0, "creation_date": 1528590015, "post_id": 50774666, "comment_id": 88566010, "body": "&quot;Tried unsuccessfully&quot; is not a problem description.  What command did you type?  What output did you get?  If it&#39;s not obvious, what about that output is not what you want?"}, {"owner": {"reputation": 4928, "user_id": 2736233, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/1R16X.png?s=128&g=1", "display_name": "Ivan Gabriele", "link": "https://stackoverflow.com/users/2736233/ivan-gabriele"}, "reply_to_user": {"reputation": 69991, "user_id": 939557, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/3VPea.png?s=128&g=1", "display_name": "MadScientist", "link": "https://stackoverflow.com/users/939557/madscientist"}, "edited": false, "score": 0, "creation_date": 1528686387, "post_id": 50774666, "comment_id": 88586051, "body": "@MadScientist I gave more details about my two trials."}, {"owner": {"reputation": 69991, "user_id": 939557, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/3VPea.png?s=128&g=1", "display_name": "MadScientist", "link": "https://stackoverflow.com/users/939557/madscientist"}, "edited": false, "score": 1, "creation_date": 1528717530, "post_id": 50774666, "comment_id": 88599804, "body": "You must have an older version of GNU make.  That syntax was made illegal for a while, then it was added back recently but with a warning due to some historical issues with Linux kernel makefiles.  You&#39;re not correct about &quot;arrays&quot;.  What&#39;s happening is that the rule is being run multiple times, once for each goal that you specify on the command line.  Each time its run, the automatic variable <code>$*</code> is set appropriately.  It&#39;s helpful to read the manual: <a href=\"https://www.gnu.org/software/make/manual/html_node/Introduction.html\" rel=\"nofollow noreferrer\">gnu.org/software/make/manual/html_node/Introduction.html</a>"}], "answers": [{"comments": [{"owner": {"reputation": 4928, "user_id": 2736233, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/1R16X.png?s=128&g=1", "display_name": "Ivan Gabriele", "link": "https://stackoverflow.com/users/2736233/ivan-gabriele"}, "edited": false, "score": 0, "creation_date": 1528555265, "post_id": 50775079, "comment_id": 88557696, "body": "I am well aware of the argument name-value argument in a Makefile as I told in the description ;) The idea was to avoid the arg name part as some other &quot;tasks automators&quot; are able to do."}], "tags": [], "owner": {"reputation": 13458, "user_id": 1773798, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/4Ljqn.png?s=128&g=1", "display_name": "Renaud Pacalet", "link": "https://stackoverflow.com/users/1773798/renaud-pacalet"}, "is_accepted": false, "score": 1, "last_activity_date": 1528552994, "creation_date": 1528552994, "answer_id": 50775079, "question_id": 50774666, "link": "https://stackoverflow.com/questions/50774666/how-to-only-pass-an-argument-value-to-a-makefile-target/50775079#50775079", "title": "How to only pass an argument value to a Makefile target?", "body": "<p>Make variables can probably do what you want:</p>\n\n<pre><code>host&gt; cat Makefile\ninstall:\n    go get $(P)\n    godep save ./...\n    git add Godeps vendor\n    git commit -m \"godep: add $(P)\"\n\nhost&gt; make install P=github.com/stretchr/testify\n</code></pre>\n\n<p>But using make just for this is probably overkill. It is much more than a scripting language.</p>\n"}, {"comments": [{"owner": {"reputation": 4928, "user_id": 2736233, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/1R16X.png?s=128&g=1", "display_name": "Ivan Gabriele", "link": "https://stackoverflow.com/users/2736233/ivan-gabriele"}, "edited": false, "score": 0, "creation_date": 1528686927, "post_id": 50779647, "comment_id": 88586121, "body": "Unless I&#39;m wrong I start to think that the target is in fact a sort of regex parsing everything after <code>make</code>, is it ? I just need to try something else before accepting your answer."}, {"owner": {"reputation": 69991, "user_id": 939557, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/3VPea.png?s=128&g=1", "display_name": "MadScientist", "link": "https://stackoverflow.com/users/939557/madscientist"}, "reply_to_user": {"reputation": 4928, "user_id": 2736233, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/1R16X.png?s=128&g=1", "display_name": "Ivan Gabriele", "link": "https://stackoverflow.com/users/2736233/ivan-gabriele"}, "edited": false, "score": 1, "creation_date": 1528717331, "post_id": 50779647, "comment_id": 88599691, "body": "That is a pattern rule: <a href=\"https://www.gnu.org/software/make/manual/html_node/Pattern-Rules.html\" rel=\"nofollow noreferrer\">gnu.org/software/make/manual/html_node/Pattern-Rules.html</a> which is a type of implicit rule: <a href=\"https://www.gnu.org/software/make/manual/html_node/Implicit-Rules.html\" rel=\"nofollow noreferrer\">gnu.org/software/make/manual/html_node/Implicit-Rules.html</a>  They have nothing to do with regular expressions."}], "tags": [], "owner": {"reputation": 69991, "user_id": 939557, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/3VPea.png?s=128&g=1", "display_name": "MadScientist", "link": "https://stackoverflow.com/users/939557/madscientist"}, "is_accepted": true, "score": 2, "last_activity_date": 1528590690, "creation_date": 1528590690, "answer_id": 50779647, "question_id": 50774666, "link": "https://stackoverflow.com/questions/50774666/how-to-only-pass-an-argument-value-to-a-makefile-target/50779647#50779647", "title": "How to only pass an argument value to a Makefile target?", "body": "<p>You cannot use explicit targets and patterns in the same rule, so your rule <code>% install:</code> will not work.</p>\n\n<p>You can do this with GNU make using <a href=\"https://www.gnu.org/software/make/manual/html_node/Goals.htm\" rel=\"nofollow noreferrer\">the <code>CMDGOALS</code> variable</a>, but it's very hackish and error-prone and I don't recommend it.</p>\n\n<pre><code>ARG := $(filter-out install,$(MAKECMDGOALS))\n\ninstall:\n        go get $(ARG)\n        godep save ./...\n        git add Godeps vendor\n        git commit -m \"godep: add $(ARG)\"\n</code></pre>\n\n<p>As you can see you'll need to add handling for situations where there are no other arguments, or where there are more than one other argument, and of course you can't add any more targets without putting them in the <code>filter-out</code> list, etc.</p>\n\n<p>Just... not a good way to do it IMO.</p>\n\n<p>Why don't you do something like this instead:</p>\n\n<pre><code>install-%:\n        go get $*\n        godep save ./...\n        git add Godeps vendor\n        git commit -m \"godep: add $*\"\n</code></pre>\n\n<p>Then run:</p>\n\n<pre><code>make install-github.com/stretchr/testify\n</code></pre>\n"}], "owner": {"reputation": 4928, "user_id": 2736233, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/1R16X.png?s=128&g=1", "display_name": "Ivan Gabriele", "link": "https://stackoverflow.com/users/2736233/ivan-gabriele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 0, "accepted_answer_id": 50779647, "answer_count": 2, "score": 0, "last_activity_date": 1528686547, "creation_date": 1528550028, "last_edit_date": 1528686547, "question_id": 50774666, "link": "https://stackoverflow.com/questions/50774666/how-to-only-pass-an-argument-value-to-a-makefile-target", "title": "How to only pass an argument value to a Makefile target?", "body": "<p>I come from the NodeJS world so I consider the Makefile as the \"scripts\" part in an npm <code>package.json</code>, which may be wrong (or not ?) to do so.</p>\n\n<p>So my idea is to automate repetitive actions when installing a new dependency by typing:</p>\n\n<pre><code>make install github.com/stretchr/testify\n</code></pre>\n\n<p>And find a way to get the <code>github.com/stretchr/testify</code> parameter <strong>without</strong> having to use the heavy parameter name-value declaration <code>FOO=bar</code> (=> <code>make install DEP=github.com/stretchr/testify</code>) generally suggested.</p>\n\n<p>So, following <a href=\"https://stackoverflow.com/a/40294025/2736233\">this answer</a>, I tried this:</p>\n\n<pre><code>install %:\n    go get $*\n    godep save ./...\n    git add Godeps vendor\n    git commit -m \"godep: add $*\"\n</code></pre>\n\n<p>but unsuccessfully: it runs <code>go get</code> without any param and <code>git commit -m \"godep: add\"</code>.</p>\n\n<p><strong>Trials</strong></p>\n\n<p><strong>1 -</strong> When I do that:</p>\n\n<pre><code>install %:\n    echo $*\n</code></pre>\n\n<p>I see my \"github.com/stretchr/testify\".</p>\n\n<p><strong>2 -</strong> When I do that:</p>\n\n<pre><code>install %:\n    go get ${*}\n</code></pre>\n\n<p>it loops twice and first run <code>go get</code> without any param, then runs <code>go get github.com/stretchr/testify</code> (as wished).</p>\n\n<p>It looks like <code>${*}</code> represents an \"array\" of params parsing characters groups after the target, the first one being the space between <code>install</code> and <code>github.com/stretchr/testify</code> and the second one being <code>github.com/stretchr/testify</code>.</p>\n"}, {"tags": ["json", "go", "struct", "get", "unmarshalling"], "comments": [{"owner": {"reputation": 2549, "user_id": 823321, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lrwbB.png?s=128&g=1", "display_name": "s\u0250un\u0131\u0254\u05df\u0250q\u0250p", "link": "https://stackoverflow.com/users/823321/s%c9%90un%c4%b1%c9%94%d7%9f%c9%90q%c9%90p"}, "edited": false, "score": 1, "creation_date": 1528548691, "post_id": 50774397, "comment_id": 88555791, "body": "Please add the response to the body of the question, since links may get broken someday..."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 9917913, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1aee59a2e4249513c6f24656dd8d2728?s=128&d=identicon&r=PG&f=1", "display_name": "IWantToBeAProgrammer", "link": "https://stackoverflow.com/users/9917913/iwanttobeaprogrammer"}, "edited": false, "score": 0, "creation_date": 1528556238, "post_id": 50774762, "comment_id": 88557990, "body": "You were right, they were not strings. Iv found another issue. I should use args[1] not args[0]. After this change + yours change program works fine."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 0, "last_activity_date": 1528968385, "last_edit_date": 1528968385, "creation_date": 1528550768, "answer_id": 50774762, "question_id": 50774397, "link": "https://stackoverflow.com/questions/50774397/how-to-get-latitude-and-longitude-from-google-map-api-using-go-language/50774762#50774762", "title": "How to get latitude and longitude from google map api using go language?", "body": "<p>Try to use <code>float64</code> to umarshal the latitude and longitude. Since they are not strings. Hence showing error when unmarshalling. Change <code>Coordinates</code> struct to </p>\n\n<pre><code>type Coordinates struct {\n    Latitude  float64 `json:\"lat\"`\n    Longitude float64 `json:\"lng\"`\n}\n</code></pre>\n\n<p>Check working code on <a href=\"https://play.golang.org/p/VsJ42viGuQX\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n\n<p>For more information on Umarshal along with types that can be used. Go through Golang Spec for <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\">JSON unmarshal</a></p>\n\n<p>You can also use <code>interface{}</code> if you don't know the format of your struct.</p>\n\n<blockquote>\n  <p>To unmarshal JSON into an interface value, Unmarshal stores one of\n  these in the interface value:</p>\n</blockquote>\n\n<pre><code>bool, for JSON booleans\nfloat64, for JSON numbers\nstring, for JSON strings\n[]interface{}, for JSON arrays\nmap[string]interface{}, for JSON objects\nnil for JSON null\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1006, "user_id": 4666785, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/YXCzR.png?s=128&g=1", "display_name": "elcomendante", "link": "https://stackoverflow.com/users/4666785/elcomendante"}, "is_accepted": false, "score": 1, "last_activity_date": 1566743192, "creation_date": 1566743192, "answer_id": 57646902, "question_id": 50774397, "link": "https://stackoverflow.com/questions/50774397/how-to-get-latitude-and-longitude-from-google-map-api-using-go-language/57646902#57646902", "title": "How to get latitude and longitude from google map api using go language?", "body": "<p>call the <a href=\"https://github.com/googlemaps/google-maps-services-go\" rel=\"nofollow noreferrer\">google-maps-services-go</a> directly:</p>\n\n<pre><code>var clinetGCM *maps.Client\n    if clinetGCM == nil {\n    // Pre-declare an err variable to avoid shadowing client.\n    var err error\n\n    clinetGCM, err = maps.NewClient(maps.WithAPIKey(\"api-key\"))\n    if err != nil {\n        log.Fatalf(\"maps.NewClient failed: %v\", err)\n    }\n}\n\n//CM is a google cloud maps\ntype CM struct {\n  Client *maps.Client\n}\n\n// Location is a gps\ntype Location struct {\n  Lat float64 `json:\"lat\"`\n  Lng float64 `json:\"lng\"`\n}\n\n// GeocodeAdress provided Location data from gcp maps geocoder api\nfunc (cm *CM) GeocodeAdress(address string) (Location, error) {\n\n  var loc Location\n\n  r := &amp;maps.GeocodingRequest{\n      Address: address,\n  }\n\n  res, err := cm.Client.Geocode(context.Background(), r)\n  if err != nil || len(res) == 0 {\n      return loc, fmt.Errorf(\"res Geocode err: %v\", err)\n  }\n\n  loc.Lat = res[0].Geometry.Location.Lat\n  loc.Lng = res[0].Geometry.Location.Lng\n\n  return loc, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 9917913, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1aee59a2e4249513c6f24656dd8d2728?s=128&d=identicon&r=PG&f=1", "display_name": "IWantToBeAProgrammer", "link": "https://stackoverflow.com/users/9917913/iwanttobeaprogrammer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1764, "favorite_count": 0, "accepted_answer_id": 50774762, "answer_count": 2, "score": 1, "last_activity_date": 1566743192, "creation_date": 1528548049, "last_edit_date": 1528563597, "question_id": 50774397, "link": "https://stackoverflow.com/questions/50774397/how-to-get-latitude-and-longitude-from-google-map-api-using-go-language", "title": "How to get latitude and longitude from google map api using go language?", "body": "<p>How to get <strong>'lat'</strong> and <strong>'lng'</strong> from <strong>location</strong> in geometry using go language ?</p>\n\n<p>I'm trying to get latitude and longitude to use it for next api to fetch weather of specific location.</p>\n\n<p>I am getting an error when running the code: </p>\n\n<blockquote>\n  <p>panic: runtime error: index out of range</p>\n</blockquote>\n\n<p>My response looks like this:\n<a href=\"https://developers.google.com/maps/documentation/geocoding/start\" rel=\"nofollow noreferrer\">https://developers.google.com/maps/documentation/geocoding/start</a></p>\n\n<p>My code is here.</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"fmt\"\n    \"net/http\"\n    \"log\"\n    \"encoding/json\"\n    \"io/ioutil\"\n)\n\nconst helloMessage = \"Hello to the weather program. Please enter the name of the city and the weather will show.\"\nconst googleApiUri = \"https://maps.googleapis.com/maps/api/geocode/json?key=MYKEY&amp;address=\"\n\n\n\ntype googleApiResponse struct {\n    Results Results `json:\"results\"`\n}\n\ntype Results []Geometry\n\ntype Geometry struct {\n    Geometry Location `json:\"geometry\"`\n}\n\ntype Location struct {\n    Location Coordinates `json:\"location\"`\n}\n\ntype Coordinates struct {\n    Latitude string `json:\"lat\"`\n    Longitude string `json:\"lng\"`\n}\n\n\nfunc main() {\n    fmt.Println(helloMessage)\n\n    args := os.Args\n    getCityCoordinates(args[0])\n}\n\nfunc getCityCoordinates(city string) {\n    fmt.Println(\"Fetching langitude and longitude of the city ...\")\n    resp, err := http.Get(googleApiUri + city)\n\n    if err != nil {\n        log.Fatal(\"Fetching google api uri data error: \", err)\n    }\n\n    bytes, err := ioutil.ReadAll(resp.Body)\n    defer resp.Body.Close()\n    if err != nil {\n        log.Fatal(\"Reading google api data error: \", err)\n    }\n\n    var data googleApiResponse\n    json.Unmarshal(bytes, &amp;data)\n    fmt.Println(data.Results[0].Geometry.Location.Latitude)\n\n    fmt.Println(\"Fetching langitude and longitude ended successful ...\")\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/a5ANM.png\" rel=\"nofollow noreferrer\">enter image description here</a></p>\n"}, {"tags": ["go", "encryption", "input", "type-conversion", "chat"], "answers": [{"comments": [{"owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 0, "creation_date": 1528545238, "post_id": 50773599, "comment_id": 88554973, "body": "Also of interest is <a href=\"https://golang.org/pkg/io/ioutil/#ReadAll\" rel=\"nofollow noreferrer\"><code>ioutil.ReadAll</code></a>."}, {"owner": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "edited": false, "score": 0, "creation_date": 1528561963, "post_id": 50773599, "comment_id": 88559638, "body": "Thanks a lot, that did it. My temporary working solution: <code>scannerWrite := bufio.NewScanner(os.Stdin)   \t\tif !scannerWrite.Scan() {   \t\t\tlog.Printf(&quot;Failed to read: %v&quot;, scannerWrite.Err())   \t\t\treturn   \t\t}   \t\tline := scannerWrite.Bytes() &#47;&#47; line is of type []byte, exactly what you need   \t\tciphertext := encrypt([]byte(line), &quot;password&quot;)   \t\tr := bytes.NewReader(ciphertext)   \t\tmustCopy(conn, r) )</code>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1528549250, "last_edit_date": 1528549250, "creation_date": 1528542442, "answer_id": 50773599, "question_id": 50773514, "link": "https://stackoverflow.com/questions/50773514/convert-os-stdin-to-byte/50773599#50773599", "title": "Convert os.Stdin to []byte", "body": "<p><code>os.Stdin</code> is an <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\"><code>io.Reader</code></a>. You can't convert it to a <code>[]byte</code>, but you can <em>read</em> from it, and the data you read from it, that may be read into a <code>[]byte</code>.</p>\n\n<p>Since in many terminals reading from <code>os.Stdin</code> gives data by lines, you should read a complete line from it. Reading from <code>os.Stdin</code> might block until a complete line is available.</p>\n\n<p>For that you have many possibilities, one is to use <a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"nofollow noreferrer\"><code>bufio.Scanner</code></a>.</p>\n\n<p>This is how you can do it:</p>\n\n<pre><code>scanner := bufio.NewScanner(os.Stdin)\nif !scanner.Scan() {\n    log.Printf(\"Failed to read: %v\", scanner.Err())\n    return\n}\nline := scanner.Bytes() // line is of type []byte, exactly what you need\n</code></pre>\n"}], "owner": {"reputation": 55, "user_id": 9917775, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25111716e0cfd63d268939e3ad2671de?s=128&d=identicon&r=PG", "display_name": "LazyEmpiricist", "link": "https://stackoverflow.com/users/9917775/lazyempiricist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1388, "favorite_count": 0, "accepted_answer_id": 50773599, "answer_count": 1, "score": 0, "last_activity_date": 1528549250, "creation_date": 1528541837, "last_edit_date": 1528542818, "question_id": 50773514, "link": "https://stackoverflow.com/questions/50773514/convert-os-stdin-to-byte", "title": "Convert os.Stdin to []byte", "body": "<p>I'm trying to implement a small chat-server in golang with end-to-end encryption. Starting of the example for server <a href=\"https://github.com/adonovan/gopl.io/tree/master/ch8/chat\" rel=\"nofollow noreferrer\">https://github.com/adonovan/gopl.io/tree/master/ch8/chat</a> and client <a href=\"https://github.com/adonovan/gopl.io/blob/master/ch8/netcat3/netcat.go\" rel=\"nofollow noreferrer\">https://github.com/adonovan/gopl.io/blob/master/ch8/netcat3/netcat.go</a> I stumbled upon <a href=\"https://www.thepolyglotdeveloper.com/2018/02/encrypt-decrypt-data-golang-application-crypto-packages/\" rel=\"nofollow noreferrer\">https://www.thepolyglotdeveloper.com/2018/02/encrypt-decrypt-data-golang-application-crypto-packages/</a> to encrypt and decrypt in Go.  </p>\n\n<p>The function to encrypt:</p>\n\n<pre><code>func encrypt(data []byte, passphrase string) []byte {\nblock, _ := aes.NewCipher([]byte(createHash(passphrase)))\ngcm, err := cipher.NewGCM(block)\nif err != nil {\n    panic(err.Error())\n}\nnonce := make([]byte, gcm.NonceSize())\nif _, err = io.ReadFull(rand.Reader, nonce); err != nil {\n    panic(err.Error())\n}\nciphertext := gcm.Seal(nonce, nonce, data, nil)\nreturn ciphertext\n}\n</code></pre>\n\n<p>in func main():</p>\n\n<pre><code>   ciphertext := encrypt([]byte(os.Stdin), \"password\")\n    mustCopy(conn, ciphertext)\n    conn.Close()\n</code></pre>\n\n<p>os.Stdin is os.file, while it is needed as []byte. The solution should be io.Reader or via buffer, but I can't find a working solution.</p>\n\n<p>I tried</p>\n\n<pre><code>bytes.NewBuffer([]byte(os.Stdin))\n</code></pre>\n\n<p>and</p>\n\n<pre><code>reader := bytes.NewReader(os.Stdin)\n</code></pre>\n\n<p>Any input is more than welcome. Sorry if I'm not seeing the obvious problem/solution here, as I'm fairly new.</p>\n"}, {"tags": ["go", "abstract-syntax-tree"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1528539313, "post_id": 50773068, "comment_id": 88553551, "body": "Did you only parse the file or have you also type-checked it with a valid <code>types.Importer</code> implementation?"}, {"owner": {"reputation": 117, "user_id": 1406669, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Fys97.jpg?s=128&g=1", "display_name": "El Gohr", "link": "https://stackoverflow.com/users/1406669/el-gohr"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528548927, "post_id": 50773068, "comment_id": 88555862, "body": "The file came from parser.ParseDir -&gt; pkg.Files -&gt; file"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528549110, "post_id": 50773068, "comment_id": 88555917, "body": "Take a look at <a href=\"https://golang.org/pkg/go/types/#Importer\" rel=\"nofollow noreferrer\"><code>types.Importer</code></a>. I believe its one line* documentation answers your question. <i>&quot;How can I resolve the unresolved ident to the right import?&quot;</i>"}, {"owner": {"reputation": 117, "user_id": 1406669, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Fys97.jpg?s=128&g=1", "display_name": "El Gohr", "link": "https://stackoverflow.com/users/1406669/el-gohr"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528549413, "post_id": 50773068, "comment_id": 88556016, "body": "<code>types.Importer</code> looks like the thing I&#39;m looking for. Do you have a tip for an easy implementation? Walker looks huge..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528552362, "post_id": 50773068, "comment_id": 88556839, "body": "Actually that&#39;s not gonna help you directly. The only place I can see where the <code>Unresolved</code> slice contents are attempted to be resolved is here: <a href=\"https://github.com/golang/go/blob/964639cc338db650ccadeafb7424bc8ebb2c0f6c/src/go/ast/resolve.go#L160-L168\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/&hellip;</a> and there the resolving depends on the provided scope and possibly also the importer. I&#39;m not really sure how to do that if it indeed is possible."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1528552620, "post_id": 50773068, "comment_id": 88556917, "body": "But with the previously mentioned <code>types.Importer</code> and additionally <code>types.Config</code> you can get your hands on an object of type <code>*types.Package</code> which contains the name <code>the_aliased_package</code> and the path <code>&quot;github.com&#47;elgohr&#47;counterfeiter&#47;fixtures&#47;aliased_package&quot;</code>. Just not through the <code>Unresolved</code> field... If you&#39;re interested I can provide a simple example."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1528553479, "post_id": 50773068, "comment_id": 88557161, "body": ".. something like this: <a href=\"https://play.golang.org/p/ty9gZWffvb6\" rel=\"nofollow noreferrer\">play.golang.org/p/ty9gZWffvb6</a>"}, {"owner": {"reputation": 117, "user_id": 1406669, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Fys97.jpg?s=128&g=1", "display_name": "El Gohr", "link": "https://stackoverflow.com/users/1406669/el-gohr"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528643940, "post_id": 50773068, "comment_id": 88576732, "body": "conf.Check calls NewPackage(path, &quot;&quot;) for the returned pkg. In this way pkg.Name is always empty..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528644694, "post_id": 50773068, "comment_id": 88576955, "body": "I am able to make the code work as illustrated by the link to the playground. If you can please share your code how you&#39;ve implemented it."}, {"owner": {"reputation": 117, "user_id": 1406669, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Fys97.jpg?s=128&g=1", "display_name": "El Gohr", "link": "https://stackoverflow.com/users/1406669/el-gohr"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528649709, "post_id": 50773068, "comment_id": 88578439, "body": "See <a href=\"https://github.com/maxbrunsfeld/counterfeiter/issues/87\" rel=\"nofollow noreferrer\">github.com/maxbrunsfeld/counterfeiter/issues/87</a> I was just wondering how to get the fset. In this way I had a look into conf.Check. There I found out that the function just returns  (NewPackage(path, &quot;&quot;), NewChecker(conf, fset, pkg, info).Files(files)). In this way I&#39;m wondering how this might work..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528651288, "post_id": 50773068, "comment_id": 88578866, "body": "<a href=\"https://github.com/golang/go/blob/903f095c1ae3cafc40855662c69722121c42e3a7/src/go/types/api.go#L351\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/&hellip;</a> as you can see <code>pkg</code> is then passed to <code>NewChecker</code> on which the <code>Files</code> method is called, that then probably modifies the <code>pkg</code> so that it has a name, and what not. Like for example here: <a href=\"https://github.com/golang/go/blob/903f095c1ae3cafc40855662c69722121c42e3a7/src/go/types/check.go#L183-L202\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/&hellip;</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528651481, "post_id": 50773068, "comment_id": 88578913, "body": "The linked issue, does not seem to be relevant to this."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528651918, "post_id": 50773068, "comment_id": 88579020, "body": "Just think about it, if you actually want the identifier <code>the_aliased_package</code> referenced in file X to be associated with the imported package you have to parse that package to actually find out that even though the import says <code>&quot;...&#47;aliased_package&quot;</code>, the actual package declaration at the top of the package&#39;s files says <code>pacakge the_aliased_package</code>. How else would you know it if you only parse file X? That&#39;s why you need to use the Importer and Config/Chekcer approach, because the importer <i>resolves the import path</i>."}, {"owner": {"reputation": 117, "user_id": 1406669, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Fys97.jpg?s=128&g=1", "display_name": "El Gohr", "link": "https://stackoverflow.com/users/1406669/el-gohr"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1529754495, "post_id": 50773068, "comment_id": 88995464, "body": "Looks like even this solution can&#39;t resolve the right package. Got: <code>something_remote.go:4:2: could not import github.com&#47;maxbrunsfeld&#47;counterfeiter&#47;fixtures&#47;aliased_packa&zwnj;&#8203;ge (can&#39;t find import: &quot;github.com&#47;maxbrunsfeld&#47;counterfeiter&#47;fixtures&#47;aliased_pack&zwnj;&#8203;age&quot;)</code> Which totally makes sense, because the package name is the_aliased_package"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1529754867, "post_id": 50773068, "comment_id": 88995574, "body": "I don&#39;t think it has to do with the aliased name. The error says it can&#39;t find a package at the given path. Are you using the default importer or the source importer? The default one has no problem resolving std lib packages but I frequently find it has problems with some other packages and I haven&#39;t yet discerned what the cause is. When I want to import a non std lib package I always end up using the source impoter."}, {"owner": {"reputation": 117, "user_id": 1406669, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Fys97.jpg?s=128&g=1", "display_name": "El Gohr", "link": "https://stackoverflow.com/users/1406669/el-gohr"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1529757938, "post_id": 50773068, "comment_id": 88996288, "body": "That was it! Thank you for your patience!"}], "owner": {"reputation": 117, "user_id": 1406669, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/Fys97.jpg?s=128&g=1", "display_name": "El Gohr", "link": "https://stackoverflow.com/users/1406669/el-gohr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 168, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1528539687, "creation_date": 1528538549, "last_edit_date": 1528539687, "question_id": 50773068, "link": "https://stackoverflow.com/questions/50773068/get-importspec-for-unresolved-identifiers", "title": "Get importSpec for unresolved identifiers", "body": "<p>I'm trying to understand what <a href=\"https://golang.org/pkg/go/ast/#File\" rel=\"nofollow noreferrer\">https://golang.org/pkg/go/ast/#File</a> means by \"unresolved identifiers\" and how to resolve the ast.ImportSpec from this.</p>\n\n<p>I have an interface:</p>\n\n<pre><code>import \"github.com/elgohr/counterfeiter/fixtures/aliased_package\"\n\ntype SomethingWithForeignInterface interface {\n     the_aliased_package.InAliasedPackage\n}\n</code></pre>\n\n<p>As you can see, <strong>the_aliased_package</strong> is different from the imported <strong>aliased_package</strong>. Nevertheless, it's inside this import (but the foldername of the package is different).\nIn the ast.File representation of this interface, ast.File.Imports contains a Path.Value \"github.com/elgohr/counterfeiter/fixtures/aliased_package\"\nand Unresolved contains an ast.Ident.Name \"the_aliased_package\"</p>\n\n<p>How can I resolve the unresolved ident to the right import?</p>\n"}, {"tags": ["go", "ethereum", "solidity"], "comments": [{"owner": {"reputation": 314, "user_id": 4187777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa1fb656a66b067b32d4c41dab8513c5?s=128&d=identicon&r=PG&f=1", "display_name": "chengbin du", "link": "https://stackoverflow.com/users/4187777/chengbin-du"}, "edited": false, "score": 0, "creation_date": 1528537197, "post_id": 50772811, "comment_id": 88553096, "body": "No, I need to build some params in Golang. If someone call the contract, I want to check these params are valid. So i have to calculate the signature of the params in Golang, then check it in Contract."}, {"owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 0, "creation_date": 1528540618, "post_id": 50772811, "comment_id": 88553866, "body": "look here <a href=\"https://github.com/ethereum/go-ethereum/blob/933972d139b0fe291cb01c7ad2c0f9d3109a68dd/accounts/abi/abi_test.go#L212\" rel=\"nofollow noreferrer\">go-ethereum source code</a>"}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "edited": false, "score": 1, "creation_date": 1528558862, "post_id": 50772811, "comment_id": 88558756, "body": "The easiest thing to do would just be to call the smart contract&#39;s <code>getHash</code> from your Go code."}, {"owner": {"reputation": 314, "user_id": 4187777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa1fb656a66b067b32d4c41dab8513c5?s=128&d=identicon&r=PG&f=1", "display_name": "chengbin du", "link": "https://stackoverflow.com/users/4187777/chengbin-du"}, "reply_to_user": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 1, "creation_date": 1528559058, "post_id": 50772811, "comment_id": 88558818, "body": "@ChihebNexus thanks"}], "answers": [{"comments": [{"owner": {"reputation": 292, "user_id": 2024713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21a49fbbb74b532c3aa713ca15734466?s=128&d=identicon&r=PG&f=1", "display_name": "Kuba", "link": "https://stackoverflow.com/users/2024713/kuba"}, "edited": false, "score": 1, "creation_date": 1551296258, "post_id": 50775947, "comment_id": 96592845, "body": "Unfortunately, it doesn&#39;t work the same for dynamic length types (like <code>bytes</code>). Go&#39;s <code>arguments.Pack</code> will return what you get from <code>abi.encode</code> not <code>abi.encodePacked</code>."}, {"owner": {"reputation": 3894, "user_id": 191347, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7226597774ed3751d939858a9affbd68?s=128&d=identicon&r=PG", "display_name": "Justin", "link": "https://stackoverflow.com/users/191347/justin"}, "edited": false, "score": 1, "creation_date": 1573751064, "post_id": 50775947, "comment_id": 103995225, "body": "go-ethereum 1.9.7 has a few more args in <code>abi.NewType</code>. The above still work with <code>abi.NewType(&quot;uint256&quot;, &quot;uint256&quot;, nil)</code>"}], "tags": [], "owner": {"reputation": 314, "user_id": 4187777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa1fb656a66b067b32d4c41dab8513c5?s=128&d=identicon&r=PG&f=1", "display_name": "chengbin du", "link": "https://stackoverflow.com/users/4187777/chengbin-du"}, "is_accepted": true, "score": 4, "last_activity_date": 1528559135, "creation_date": 1528559135, "answer_id": 50775947, "question_id": 50772811, "link": "https://stackoverflow.com/questions/50772811/how-can-i-get-the-same-return-value-as-solidity-abi-encodepacked-in-golang/50775947#50775947", "title": "How can I get the same return value as solidity `abi.encodePacked` in Golang", "body": "<p>finally I managed to do it. :)</p>\n\n<pre><code>package main\n\nimport (\n    \"math/big\"\n    \"github.com/ethereum/go-ethereum/common/hexutil\"\n    \"github.com/ethereum/go-ethereum/accounts/abi\"\n    \"log\"\n    \"github.com/ethereum/go-ethereum/common\"\n    \"github.com/ethereum/go-ethereum/crypto/sha3\"\n)\n\nfunc main() {\n    uint256Ty, _ := abi.NewType(\"uint256\")\n    bytes32Ty, _ := abi.NewType(\"bytes32\")\n    addressTy, _ := abi.NewType(\"address\")\n\n    arguments := abi.Arguments{\n        {\n            Type: addressTy,\n        },\n        {\n            Type: bytes32Ty,\n        },\n        {\n            Type: uint256Ty,\n        },\n    }\n\n    bytes, _ := arguments.Pack(\n        common.HexToAddress(\"0x0000000000000000000000000000000000000000\"),\n        [32]byte{'I','D','1'},\n        big.NewInt(42),\n    )\n\n    var buf []byte\n    hash := sha3.NewKeccak256()\n    hash.Write(bytes)\n    buf = hash.Sum(buf)\n\n    log.Println(hexutil.Encode(buf))\n    // output:\n    // 0x1f214438d7c061ad56f98540db9a082d372df1ba9a3c96367f0103aa16c2fe9a\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1186, "user_id": 795176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05b66b07efec5c62c602186b4c464d75?s=128&d=identicon&r=PG", "display_name": "Maga Abdurakhmanov", "link": "https://stackoverflow.com/users/795176/maga-abdurakhmanov"}, "is_accepted": false, "score": 1, "last_activity_date": 1580295307, "creation_date": 1580295307, "answer_id": 59965562, "question_id": 50772811, "link": "https://stackoverflow.com/questions/50772811/how-can-i-get-the-same-return-value-as-solidity-abi-encodepacked-in-golang/59965562#59965562", "title": "How can I get the same return value as solidity `abi.encodePacked` in Golang", "body": "<p>As <code>Jakub N</code> is said in comments to accepted answer, <code>Go's arguments.Pack</code> returns as <code>abi.encode</code> and not <code>abi.encodePacked</code>. In your case it works because all packed values are 32 bytes, but if you also add some strings then the result will be different.</p>\n\n<p>Here is how to do it to be compatible with <strong>tightly</strong> packed encoding corresponding to <code>abi.encodePacked</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\n// hash of packed byte array with arguments\n\nhash := crypto.Keccak256Hash(\n        common.HexToAddress(\"0x0000000000000000000000000000000000000000\").Bytes(),\n        [32]byte{'I','D','1'},\n        common.LeftPadBytes(big.NewInt(42).Bytes(), 32),\n        []byte(\"Some other string value\"),\n    )\n\n// normally we sign prefixed hash\n// as in solidity with `ECDSA.toEthSignedMessageHash`\n\nprefixedHash := crypto.Keccak256Hash(\n        []byte(fmt.Sprintf(\"\\x19Ethereum Signed Message:\\n%v\", len(hash))),\n        hash.Bytes(),\n    )\n\n// sign hash to validate later in Solidity\n\nsig, err := crypto.Sign(prefixedHash.Bytes(), privateKey)\n</code></pre>\n\n<p>It is also more efficient as we don't pack and allocate additional memory for that. Hash function iterates over existing values.</p>\n"}], "owner": {"reputation": 314, "user_id": 4187777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa1fb656a66b067b32d4c41dab8513c5?s=128&d=identicon&r=PG&f=1", "display_name": "chengbin du", "link": "https://stackoverflow.com/users/4187777/chengbin-du"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2058, "favorite_count": 5, "accepted_answer_id": 50775947, "answer_count": 2, "score": 6, "last_activity_date": 1580295307, "creation_date": 1528536574, "last_edit_date": 1528538379, "question_id": 50772811, "link": "https://stackoverflow.com/questions/50772811/how-can-i-get-the-same-return-value-as-solidity-abi-encodepacked-in-golang", "title": "How can I get the same return value as solidity `abi.encodePacked` in Golang", "body": "<p>How can i run abi.encodePacked in golang?</p>\n\n<p>in solidity i use <code>keccak256(abi.encodePacked(a, b))</code> to calc the signature of the params.</p>\n\n<p>here is my contract.</p>\n\n<pre><code>pragma solidity ^0.4.24;\n\nimport \"openzeppelin-solidity/contracts/ECRecovery.sol\";\n\n\ncontract MyContract {\n    using ECRecovery for bytes32;\n    address permittedSinger;\n\n    function doSomething(\n    bytes32 id, uint256 amount, bytes sig\n    ) {\n        bytes32 hash = getHash(msg.sender, id, amount);\n        address msgSigner = hash.recover(sig);\n        require(msgSigner == permittedSinger);\n    }\n\n    function getMsgSigner(bytes32 proveHash, bytes sig) public pure returns (address) {\n        return proveHash.recover(sig);\n    }\n\n    function getHash(\n    address receiver, bytes32 id, uint256 amount\n    ) pure returns (bytes32) {\n        return keccak256(abi.encodePacked(receiver, id, amount));\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "testify"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1528535028, "post_id": 50772163, "comment_id": 88552623, "body": "<code>testobj.On(&quot;Add&quot;, 1, 2).Return(5)</code> = expect a call to <code>Add</code> with arguments <code>1</code> and <code>2</code> and return value <code>5</code>. The actuall call <code>result.Add(5, 6)</code> passes <code>5</code> and <code>6</code>. These two numbers, as you know, are not the same as <code>1</code> and <code>2</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1528535220, "post_id": 50772163, "comment_id": 88552661, "body": "Also you mock is calculating the result <code>return args.Int(0) + args.Int(1)</code> as a normal implementation would. That&#39;s not how you do mocks. Your mock should return it&#39;s 0th return value, the one you passed to the <code>Return</code> method (<code>5</code>). So the mocks return statement should actually be <code>return args.Int(0)</code>. &lt;- return the zeroeth return arguemnt as an int."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1528535492, "post_id": 50772163, "comment_id": 88552711, "body": "Also, do understand that the <code>args</code> value holds the specified <i>return</i> arguemnts (those passed to the <code>Return</code> method), the <code>args</code> value <i>does not</i> hold the input arguments."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528535668, "post_id": 50772163, "comment_id": 88552741, "body": "i.e. <a href=\"https://play.golang.org/p/5PA15xsMXYM\" rel=\"nofollow noreferrer\">play.golang.org/p/5PA15xsMXYM</a>"}, {"owner": {"reputation": 1928, "user_id": 4364847, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/pcepW.png?s=128&g=1", "display_name": "MadzQuestioning", "link": "https://stackoverflow.com/users/4364847/madzquestioning"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528536010, "post_id": 50772163, "comment_id": 88552822, "body": "@mkopriva thanks a lot for pointing out this parameter and arguments. Because honestly I have no idea what it does, I just copied and did some modification from an online tutorial. Thanks for clarifying this. Can you move your answer to actual answer so that I can approve this as a solution"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528575686, "post_id": 50772163, "comment_id": 88563242, "body": "When this is the first time you use Go, then just stay away from fancy tooling like Testify! Write plain and simple test. Do not try fancy stuff just because such stuff is en vogue in your prior languages."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 5, "last_activity_date": 1528537730, "creation_date": 1528537730, "answer_id": 50772965, "question_id": 50772163, "link": "https://stackoverflow.com/questions/50772163/cannot-pass-testify-mock-object-error/50772965#50772965", "title": "Cannot pass Testify Mock object error", "body": "<p>The line</p>\n\n<pre><code>testobj.On(\"Add\", 1, 2).Return(5)\n</code></pre>\n\n<p>means that you expect the <code>testobj</code> mock to receive a call to its <code>Add</code> method with arguments <code>1</code> and <code>2</code> passed to it, and you also specify that that call should return the integer value <code>5</code>.</p>\n\n<p>But instead on this line</p>\n\n<pre><code>assert.Equal(t, 5, result.Add(5, 6))\n</code></pre>\n\n<p>you are calling the method <code>Add</code> with arguments <code>5</code> and <code>6</code>.</p>\n\n<p>This results in the error you got:</p>\n\n<pre><code>mock: Unexpected Method Call\n-----------------------------\n\nAdd(int,int)\n            0: 5\n            1: 6\n// this is result.Add(5, 6), the 0: and 1: are indexes of the actually passed in aguments.\n\nThe closest call I have is:\n\nAdd(int,int)\n            0: 1\n            1: 2\n// this is testobj.On(\"Add\", 1, 2), and 0: and 1: are indexes of the expected arguments.\n</code></pre>\n\n<p>On top of that your mock implementations are attempting to calculate and return the value. This is not what a mock should do. A mock should instead return the value provided to it through the <code>Return</code> method.</p>\n\n<p>The way you can do this is by using the <a href=\"https://godoc.org/github.com/stretchr/testify/mock#Arguments\" rel=\"noreferrer\"><code>args</code></a> value returned from the <code>Called</code> method call, this value will hold the <code>Return</code> method's arguments indexed in the same order they were passed in to <code>Return</code>.</p>\n\n<p>So the integer value <code>5</code> that you passed to <code>Return</code> on this line</p>\n\n<pre><code>testobj.On(\"Add\", 1, 2).Return(5)\n</code></pre>\n\n<p>can be accessed using the <code>Int</code> utility method and passing it the 0th index. That is <code>return args.Int(0)</code> will return the interger value <code>5</code>.</p>\n\n<p>So your test file should look more like this:</p>\n\n<pre><code>import (\n    \"testing\"\n\n    \"github.com/stretchr/testify/assert\"\n    \"github.com/stretchr/testify/mock\"\n)\n\ntype MyMock struct {\n    mock.Mock\n}\n\nfunc (m *MyMock) Add(num1 int, num2 int) int {\n    args := m.Called(num1, num2)\n    return args.Int(0)\n}\n\nfunc (m *MyMock) Subtract(num1 int, num2 int) int {\n    args := m.Called(num1, num2)\n    return args.Int(0)\n}\n\nfunc TestDoComputation(t *testing.T) {\n    testobj := new(MyMock)\n\n    testobj.On(\"Add\", 1, 2).Return(5)\n\n    // a := GetNewArithmetic(testobj)\n\n    result := GetNewArithmetic(testobj)\n\n    assert.Equal(t, 5, result.Add(1, 2))\n    testobj.AssertExpectations(t)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 81, "user_id": 7482310, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EDsIH.jpg?s=128&g=1", "display_name": "Mehul Sancheti", "link": "https://stackoverflow.com/users/7482310/mehul-sancheti"}, "is_accepted": false, "score": 2, "last_activity_date": 1543470784, "creation_date": 1543470784, "answer_id": 53532672, "question_id": 50772163, "link": "https://stackoverflow.com/questions/50772163/cannot-pass-testify-mock-object-error/53532672#53532672", "title": "Cannot pass Testify Mock object error", "body": "<p>In testify/mock package</p>\n\n<blockquote>\n  <p>testobj.On(\"Add\", 1, 2).Return(5)</p>\n</blockquote>\n\n<p>In above line,It tell the mock object that whenever we Call Add method with following arguments,it should return 5. Return is used to pass the result to the method with the given arguments.</p>\n\n<blockquote>\n  <p>assert.Equal(t, 5, result.Add(5, 6))</p>\n</blockquote>\n\n<p>In this line,you are asking to match the expected result with the function call.Earlier you specify when you pass 1 &amp; 2,the function should return 5 but in Equal statement you are passing values 5 &amp; 6</p>\n\n<p>All you have to is the change any of the one line with the correct value.</p>\n\n<blockquote>\n  <p>testobj.On(\"Add\", 5, 6).Return(5)</p>\n</blockquote>\n"}], "owner": {"reputation": 1928, "user_id": 4364847, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/pcepW.png?s=128&g=1", "display_name": "MadzQuestioning", "link": "https://stackoverflow.com/users/4364847/madzquestioning"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4405, "favorite_count": 1, "accepted_answer_id": 50772965, "answer_count": 2, "score": 1, "last_activity_date": 1543470784, "creation_date": 1528531258, "last_edit_date": 1528533031, "question_id": 50772163, "link": "https://stackoverflow.com/questions/50772163/cannot-pass-testify-mock-object-error", "title": "Cannot pass Testify Mock object error", "body": "<p>Hi I'm trying to mock a struct in GO. I'm using testify to do this. But I can't seem to get it to work and don't now what I'm doing wrong. Below is the sample main.go and main_test.go file I have</p>\n\n<pre><code>// Arithmetic ...\ntype Arithmetic interface {\n    Add(int, int) int\n    Subtract(int, int) int\n}\n\n// MathOperation ...\ntype MathOperation struct {}\n\n// GetNewArithmetic ...\nfunc GetNewArithmetic(obj Arithmetic) Arithmetic {\n    if obj != nil {\n        return obj\n    }\n\n    return MathOperation{}\n}\n\n// Add ...\nfunc (a MathOperation) Add(num1 int, num2 int) int {\n    return num1 + num2\n}\n\n// Subtract ...\nfunc (a MathOperation) Subtract(num1 int, num2 int) int {\n    return num1 - num2\n}\n</code></pre>\n\n<p>And here is my test file</p>\n\n<pre><code>import (\n    \"testing\"\n\n    \"github.com/stretchr/testify/assert\"\n    \"github.com/stretchr/testify/mock\"\n)\n\ntype MyMock struct {\n    mock.Mock\n}\n\nfunc (m *MyMock) Add(num1 int, num2 int) int {\n    args := m.Called(num1, num2)\n    return args.Int(0) + args.Int(1)\n}\n\nfunc (m *MyMock) Subtract(num1 int, num2 int) int {\n    args := m.Called(num1, num2)\n    return args.Int(0) + args.Int(1)\n}\n\nfunc TestDoComputation(t *testing.T) {\n    testobj := new(MyMock)\n\n    testobj.On(\"Add\", 1, 2).Return(5)\n\n    // a := GetNewArithmetic(testobj)\n\n    result := GetNewArithmetic(testobj)\n\n    assert.Equal(t, 5, result.Add(5, 6))\n    testobj.AssertExpectations(t)\n}\n</code></pre>\n\n<p>I receive this error</p>\n\n<pre><code>--- FAIL: TestDoComputation (0.00s)\npanic:\n\nmock: Unexpected Method Call\n-----------------------------\n\nAdd(int,int)\n            0: 5\n            1: 6\n\nThe closest call I have is:\n\nAdd(int,int)\n            0: 1\n            1: 2\n\n\n [recovered]\n        panic:\n\nmock: Unexpected Method Call\n-----------------------------\n\nAdd(int,int)\n            0: 5\n            1: 6\n\nThe closest call I have is:\n\nAdd(int,int)\n            0: 1\n            1: 2\n\ngoroutine 13 [running]:\ntesting.tRunner.func1(0xc420106870)\n        /usr/lib/golang/src/testing/testing.go:711 +0x2d2\npanic(0x701160, 0xc420011070)\n</code></pre>\n\n<p>I have no idea on how to fix since this is my first time using Go and using Testify to do unit testing. Would appreciate if someone can take a look and have a working version of this. Thanks</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1528529069, "post_id": 50771812, "comment_id": 88551259, "body": "By chance only."}, {"owner": {"reputation": 62, "user_id": 7931114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19bc80c4c96c1cfe0c5075a4755f9bc4?s=128&d=identicon&r=PG&f=1", "display_name": "hzyu", "link": "https://stackoverflow.com/users/7931114/hzyu"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1528529931, "post_id": 50771812, "comment_id": 88551452, "body": "It seems there is greater chance that first return 2 and then return 1"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1528534799, "post_id": 50771812, "comment_id": 88552572, "body": "The order in which goroutines are scheduled is non-deterministic. In a specific environment (e.g. OS, Go version, GOMAXPROCS etc.) it may be that you always <i>observe</i> the same order, but you cannot rely on this. The order is not specified by the language spec. If you need a specific execution order, you have to take care of it by explicit synchronization."}], "answers": [{"comments": [{"owner": {"reputation": 62, "user_id": 7931114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19bc80c4c96c1cfe0c5075a4755f9bc4?s=128&d=identicon&r=PG&f=1", "display_name": "hzyu", "link": "https://stackoverflow.com/users/7931114/hzyu"}, "edited": false, "score": 0, "creation_date": 1528553470, "post_id": 50774247, "comment_id": 88557158, "body": "It seems the order is random"}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "reply_to_user": {"reputation": 62, "user_id": 7931114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19bc80c4c96c1cfe0c5075a4755f9bc4?s=128&d=identicon&r=PG&f=1", "display_name": "hzyu", "link": "https://stackoverflow.com/users/7931114/hzyu"}, "edited": false, "score": 0, "creation_date": 1528555765, "post_id": 50774247, "comment_id": 88557850, "body": "hzyu the calling order is determined and each unique call will have a unique number.  But the exact sequence number that is granted to each call will not necessarily be in order and the return sequence is clearly never going to be in order.  If you need the calling sequence to be in order then set the sequence number in the same go routine (the main) .  I&#39;ll add a second version that does this - call the sequence before the go routine"}], "tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 2, "last_activity_date": 1528555896, "last_edit_date": 1528555896, "creation_date": 1528546947, "answer_id": 50774247, "question_id": 50771812, "link": "https://stackoverflow.com/questions/50771812/goroutine-value-return-order/50774247#50774247", "title": "goroutine value return order", "body": "<p>If you want to know what the order is, then let your program include ordering information</p>\n\n<p>This example uses a function closure to generate a sequence</p>\n\n<p>The channel returns a struct of two numbers, one of which is a sequence order number</p>\n\n<p>The sequence incrementer should be safe across go routines as there is a mutex lock on the sequence counter</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype value_with_order struct {\n    v     int\n    order int\n}\n\nvar (\n    mu sync.Mutex\n)\n\nfunc orgami(x int, c chan value_with_order, f func() int) {\n    v := new(value_with_order)\n    v.v = x\n    v.order = f()\n    c &lt;- *v\n}\nfunc seq() func() int {\n    i := 0\n    return func() int {\n        mu.Lock()\n        defer mu.Unlock()\n        i++\n        return i\n    }\n}\n\nfunc main() {\n\n    c := make(chan value_with_order)\n    sequencer := seq()\n    for n := 0; n &lt; 10; n++ {\n        go orgami(1, c, sequencer)\n        go orgami(2, c, sequencer)\n        go orgami(3, c, sequencer)\n    }\n    received := 0\n    for q := range c {\n        fmt.Printf(\"%v\\n\", q)\n        received++\n        if received == 30 {\n            close(c)\n        }\n    }\n\n}\n</code></pre>\n\n<p>second version where the sequence is called from the main loop to make the sequence numbers come out in the order that the function is called</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype value_with_order struct {\n    v     int\n    order int\n}\n\nvar (\n    mu sync.Mutex\n)\n\nfunc orgami(x int, c chan value_with_order, seqno int) {\n    v := new(value_with_order)\n    v.v = x\n    v.order = seqno\n    c &lt;- *v\n}\nfunc seq() func() int {\n    i := 0\n    return func() int {\n        mu.Lock()\n        defer mu.Unlock()\n        i++\n        return i\n    }\n}\n\nfunc main() {\n\n    c := make(chan value_with_order)\n    sequencer := seq()\n    for n := 0; n &lt; 10; n++ {\n\n        go orgami(1, c, sequencer())\n        go orgami(2, c, sequencer())\n        go orgami(3, c, sequencer())\n    }\n    received := 0\n    for q := range c {\n        fmt.Printf(\"%v\\n\", q)\n        received++\n        if received == 30 {\n            close(c)\n        }\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 62, "user_id": 7931114, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19bc80c4c96c1cfe0c5075a4755f9bc4?s=128&d=identicon&r=PG&f=1", "display_name": "hzyu", "link": "https://stackoverflow.com/users/7931114/hzyu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 525, "favorite_count": 0, "closed_date": 1528606808, "answer_count": 1, "score": 0, "last_activity_date": 1528555896, "creation_date": 1528528164, "question_id": 50771812, "link": "https://stackoverflow.com/questions/50771812/goroutine-value-return-order", "closed_reason": "Duplicate", "title": "goroutine value return order", "body": "<p>Why following codes always return 2,1, not 1,2.</p>\n\n<pre><code>func test(x int, c chan int) {\n   c &lt;- x\n}\n\nfunc main() {\n    c := make(chan int)\n    go test(1, c)\n    go test(2, c)\n    x, y := &lt;-c, &lt;-c // receive from c\n    fmt.Println(x, y)\n}\n</code></pre>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528528462, "post_id": 50771429, "comment_id": 88551119, "body": "In Go you cannot &quot;add a method&quot; to, or &quot;rename the fields&quot; of, a previously declared struct type. Not possible. Can you be more explicit in what you are actually trying to do? Maybe provide some code of the input you need to work with and the output you would like to produce?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1528528708, "post_id": 50771429, "comment_id": 88551172, "body": "Also, unless you change std lib&#39;s source, you cannot change the behaviour of <code>reflect.ValueOf</code>. It will always retrun a <code>reflect.Value</code> representation of the value you pass to it as the sole argument. You cannot somehow &quot;specify&quot; that it should return something other than what it would normally retrun. That&#39;s just not possible."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 2, "last_activity_date": 1528529137, "creation_date": 1528529137, "answer_id": 50771910, "question_id": 50771429, "link": "https://stackoverflow.com/questions/50771429/specifying-what-value-should-be-returned-by-reflect-valueof/50771910#50771910", "title": "Specifying what value should be returned by reflect.ValueOf", "body": "<p>No this is not possible. Sorry.</p>\n"}], "owner": {"reputation": 1011, "user_id": 2969402, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a971b3c4d070d8af92b98952b702c9bb?s=128&d=identicon&r=PG&f=1", "display_name": "user2969402", "link": "https://stackoverflow.com/users/2969402/user2969402"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "accepted_answer_id": 50771910, "answer_count": 1, "score": -2, "last_activity_date": 1528563760, "creation_date": 1528524491, "last_edit_date": 1528563760, "question_id": 50771429, "link": "https://stackoverflow.com/questions/50771429/specifying-what-value-should-be-returned-by-reflect-valueof", "title": "Specifying what value should be returned by reflect.ValueOf", "body": "<p>I have a struct such as this:</p>\n\n<pre><code>type Time struct {\n    Time time.Time\n    Valid bool\n}\n</code></pre>\n\n<p>Now if I call <code>reflect.ValueOf()</code> on a <code>Time</code> struct initialized with, say <code>time.Now()</code> and <code>false</code>, I'll get the following results:</p>\n\n<pre><code>{2018-06-09 15:03:17.4320396 false}\n</code></pre>\n\n<p>Is there a way to alter the struct (add a method? rename the fields?) so that <code>reflect</code> would only return the <code>time.Time</code> value, but not the <code>bool</code> one ?\nKind of like what the Valuer/Scanner interface does for SQL queries, but with <code>reflect</code>.</p>\n"}, {"tags": ["mongodb", "go", "remote-server"], "comments": [{"owner": {"reputation": 129250, "user_id": 2313887, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/259593de18972d36e25f230c2be19d9f?s=128&d=identicon&r=PG", "display_name": "Neil Lunn", "link": "https://stackoverflow.com/users/2313887/neil-lunn"}, "edited": false, "score": 1, "creation_date": 1528524599, "post_id": 50771414, "comment_id": 88550327, "body": "Pretty self explanatory error. Ping the servers from your location and test with other tools to see that you can actually reach and talk to them. The error message says that there is no listening server at the current address and port you are using."}, {"owner": {"reputation": 1369, "user_id": 1632556, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ErjRS.jpg?s=128&g=1", "display_name": "Soumya Kanti", "link": "https://stackoverflow.com/users/1632556/soumya-kanti"}, "edited": false, "score": 0, "creation_date": 1528710423, "post_id": 50771414, "comment_id": 88595437, "body": "If you can see ping is working but your client is still unable to reach the DB, check AWS security. 27017 is a non-standard port and you have to explicitly enable it. This may help you: <a href=\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/authorizing-access-to-an-instance.html\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/AWSEC2/latest/UserGuide/&hellip;</a>"}], "owner": {"reputation": 519, "user_id": 7533957, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/79e9e353a40ca6a2f95c498b3962f405?s=128&d=identicon&r=PG&f=1", "display_name": "Amandeep kaur", "link": "https://stackoverflow.com/users/7533957/amandeep-kaur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 353, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1528524373, "creation_date": 1528524373, "question_id": 50771414, "link": "https://stackoverflow.com/questions/50771414/how-to-connect-to-remote-mongodb-server", "title": "How to connect to remote Mongodb server", "body": "<p>I have two EC2 instances. On one instance I am running mongodb and on other instance I am running Golang code so as to test the Mongodb connection. Following is the Go code:</p>\n\n<pre><code>    package main \n\n    import (\n        \"gopkg.in/mgo.v2\"\n    \"time\"\n    \"fmt\"\n)\n\n    func main() {\n        mongoDBDialInfo := &amp;mgo.DialInfo{\n            Addrs:    []string{\"DBSERVERIP:27017\"},\n            Timeout:  60 * time.Second,\n            Database: \"my_db\",\n            Username: \"myusername\",\n            Password: \"mypassword\",\n        }\n\n        mongoSession, err := mgo.DialWithInfo(mongoDBDialInfo)\n        if err != nil {\n            fmt.Println(\"CreateSession: \", err)\n        }\n        mongoSession.SetMode(mgo.Monotonic, true)\n\n        fmt.Println(mongoSession)\n    }\n</code></pre>\n\n<p>In Mongodb, I have enabled security authorization and changed the bindIp to 0.0.0.0. But its giving me following error:</p>\n\n<pre><code>CreateSession:  no reachable servers\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x53f207]\n\ngoroutine 1 [running]:\ngopkg.in/mgo%2ev2.(*Session).SetMode(0x0, 0x1, 0x1)\n        /home/ubuntu/go/src/gopkg.in/mgo.v2/session.go:1681 +0x37\nmain.main()\n        /home/ubuntu/go/src/dbconnect/main.go:27 +0x1a0\nexit status 2\n</code></pre>\n\n<p>Can anybody tell me how should I fix it??\nThanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1528513901, "post_id": 50770300, "comment_id": 88548618, "body": "The document <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a> explains some of the concepts you that you may be missing."}, {"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528516320, "post_id": 50770300, "comment_id": 88548988, "body": "Thanks for the link; yes, I am fairly new to Go. Does not solve my problem though."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528517184, "post_id": 50770300, "comment_id": 88549116, "body": "The doc talks directly about how to refer to one package from another package.  You need to import &quot;controllers&quot; in router.go and refer to the interface as <code>controllers. ControllerInterfaceGet</code>.  Oh, that&#39;s what the answer says.  Is there an error after making this change?"}, {"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528518904, "post_id": 50770300, "comment_id": 88549362, "body": "Oh, I understand now. Sorry for the confusion :)"}], "answers": [{"comments": [{"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 0, "creation_date": 1528512352, "post_id": 50770430, "comment_id": 88548433, "body": "Okay, that makes sense. This does not solve the undefined error however."}, {"owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "edited": false, "score": 1, "creation_date": 1528518919, "post_id": 50770430, "comment_id": 88549366, "body": "Sorry about the confusion - this does solve the problem!"}], "tags": [], "owner": {"reputation": 260, "user_id": 3761716, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iY3GQ.jpg?s=128&g=1", "display_name": "MarStr", "link": "https://stackoverflow.com/users/3761716/marstr"}, "is_accepted": true, "score": 1, "last_activity_date": 1528511806, "creation_date": 1528511806, "answer_id": 50770430, "question_id": 50770300, "link": "https://stackoverflow.com/questions/50770300/how-to-build-routes-with-structs-interfaces/50770430#50770430", "title": "How to build routes with structs/interfaces?", "body": "<p>The immediate problem that you're running into is that the two are in separate packages. You should refer to it as <code>controllers.ControllerInterfaceGet</code>.</p>\n"}], "owner": {"reputation": 915, "user_id": 5255543, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/d633061767dde4eb709a66d8d962856a?s=128&d=identicon&r=PG&f=1", "display_name": "P. Nick", "link": "https://stackoverflow.com/users/5255543/p-nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 278, "favorite_count": 1, "accepted_answer_id": 50770430, "answer_count": 1, "score": 0, "last_activity_date": 1528511806, "creation_date": 1528510030, "question_id": 50770300, "link": "https://stackoverflow.com/questions/50770300/how-to-build-routes-with-structs-interfaces", "title": "How to build routes with structs/interfaces?", "body": "<p>I saw a method on a blog and decided to try to make it work, so far I have been unsuccessful. I'm trying to make routes with <code>gorilla/mux</code> and structs/interfaces. The main problem here is that I can not access the interfaces when the struct is passed as a function parameter.</p>\n\n<p>main.go:</p>\n\n<pre><code>package main\n\nimport (\n    router \"routers/web\"\n)\n\nfunc main() {\n    router.Serve()\n}\n</code></pre>\n\n<p>routers/router.go</p>\n\n<pre><code>package router\n\nimport (\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\nfunc Route(path string, ct interface{}) {\n    r := mux.NewRouter()\n\n    //ct prints {Controller:{ControllerInterfaceGet:&lt;nil&gt;}}\n\n    if c, ok := ct.(ControllerInterfaceGet); ok {\n        r.HandleFunc(path, http.HandlerFunc(c.Get)).Methods(\"GET\")\n    }\n}\n\nfunc Init() {\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>routers/web/web.go:</p>\n\n<pre><code>package routerweb\n\nimport (\n    \"controllers/web\"\n    \"routers\"\n)\n\nfunc Serve() {\n    router.Route(\"/\", webtest.TestController{})\n\n    router.Init()\n}\n</code></pre>\n\n<p>controllers/controller.go:</p>\n\n<pre><code>package controllers\n\nimport (\n    \"net/http\"\n)\n\ntype Controller struct {\n    ControllerInterfaceGet\n}\n\ntype ControllerInterfaceGet interface {\n    Get(w http.ResponseWriter, r *http.Request)\n}\n</code></pre>\n\n<p>And finally the controller for the specific route:</p>\n\n<pre><code>package webtest\n\nimport (\n    \"controllers\"\n    \"net/http\"\n)\n\ntype TestController struct {\n    controllers.Controller\n}\n\nfunc (p TestController) Get(w http.ResponseWriter, r *http.Request) {\n    println(\"Hello World\")\n}\n</code></pre>\n\n<p>I've done some debugging and whenever I try to compile it, it gives me this error:</p>\n\n<pre><code># routers\n.\\router.go:14:18: undefined: ControllerInterfaceGet\n</code></pre>\n\n<p>Any idea how to solve this?</p>\n"}, {"tags": ["mysql", "templates", "go", "web", "struct"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1528495985, "post_id": 50768543, "comment_id": 88545546, "body": "The Employee field names must be <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">exported</a>. What is the error returned from ExecuteTemplate? The error return value is currently ignored."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 983410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb0ae79ed3ba11aaff30af957e5339d9?s=128&d=identicon&r=PG", "display_name": "grethinam", "link": "https://stackoverflow.com/users/983410/grethinam"}, "edited": false, "score": 0, "creation_date": 1528531417, "post_id": 50769016, "comment_id": 88551815, "body": "Thank you so much....I never thought even a variable case has some value...Good to know..."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "reply_to_user": {"reputation": 43, "user_id": 983410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb0ae79ed3ba11aaff30af957e5339d9?s=128&d=identicon&r=PG", "display_name": "grethinam", "link": "https://stackoverflow.com/users/983410/grethinam"}, "edited": false, "score": 0, "creation_date": 1528569142, "post_id": 50769016, "comment_id": 88561652, "body": "You might want to run through the <a href=\"https://tour.golang.org/basics/3\" rel=\"nofollow noreferrer\">Go Tour</a> again, capitalization for exporting names comes up pretty quick."}], "tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 3, "last_activity_date": 1528496109, "creation_date": 1528496109, "answer_id": 50769016, "question_id": 50768543, "link": "https://stackoverflow.com/questions/50768543/display-mysql-table-using-template-in-golang-website/50769016#50769016", "title": "Display mysql table using template in Golang website", "body": "<p>You have two problems:</p>\n\n<ol>\n<li>You're not checking for errors when you call <code>ExecuteTemplate</code>.</li>\n<li>Your template is using non-exported fields, taking care of your first problem would have told you this.</li>\n</ol>\n\n<p>For the first problem:</p>\n\n<pre><code>err := tmpl.ExecuteTemplate(w, \"Index\", table)\nif err != nil {\n    // Do something with the error\n}\n</code></pre>\n\n<p>For the second problem, change your <code>struct</code> to have exported fields:</p>\n\n<pre><code>type Employee struct {\n    Fname, Sname, Dname, Email string\n}\n</code></pre>\n\n<p>and then change your template to use the new field names.</p>\n"}], "owner": {"reputation": 43, "user_id": 983410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb0ae79ed3ba11aaff30af957e5339d9?s=128&d=identicon&r=PG", "display_name": "grethinam", "link": "https://stackoverflow.com/users/983410/grethinam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1875, "favorite_count": 0, "accepted_answer_id": 50769016, "answer_count": 1, "score": 3, "last_activity_date": 1528496109, "creation_date": 1528492912, "question_id": 50768543, "link": "https://stackoverflow.com/questions/50768543/display-mysql-table-using-template-in-golang-website", "title": "Display mysql table using template in Golang website", "body": "<p>I am in the process learning GoLang web development, where I am trying a simple example of display a table in mysql database at Webpage rendered using Golang template.\nBelow is the snippet of my code, which is not working.Table rendering is failing,where <strong>range</strong> function at template not working</p>\n\n<p>Server.go</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    _ \"github.com/go-sql-driver/mysql\"\n    \"database/sql\"\n    \"os\"\n    \"html/template\"\n)\n\ntype Employee struct {\n    fname, sname, dname, email string\n}\n\nfunc helloWorld(w http.ResponseWriter, r *http.Request){\n    name, err := os.Hostname()\n    checkErr(err)\n    fmt.Fprintf(w, \"HOSTNAME : %s\\n\", name)\n}\n\nfunc dbConnect() (db *sql.DB) {\n    dbDriver := \"mysql\"\n    dbUser := \"root\"\n    dbPass := \"password\"\n    dbHost := \"mysql.go\"\n    dbPort := \"3306\"\n    dbName := \"company\"\n    db, err := sql.Open(dbDriver, dbUser +\":\"+ dbPass +\"@tcp(\"+ dbHost +\":\"+ dbPort +\")/\"+ dbName +\"?charset=utf8\")\n    checkErr(err)\n    return db\n}\n\nfunc dbSelect() []Employee{\n    db := dbConnect()\n    rows, err := db.Query(\"select * from employees\")\n    checkErr(err)\n\n    employee := Employee{}\n    employees := []Employee{}\n\n    for rows.Next() {\n        var first_name, last_name, department, email string\n        err = rows.Scan(&amp;first_name, &amp;last_name, &amp;department, &amp;email)\n        checkErr(err)\n        employee.fname = first_name\n        employee.sname = last_name\n        employee.dname = department\n        employee.email = email\n        employees = append(employees, employee)\n\n    }\n    defer db.Close()\n    return employees\n}\n\nvar tmpl = template.Must(template.ParseFiles(\"layout.html\"))\n//var tmpl = template.Must(template.ParseGlob(\"layout.html\"))\nfunc dbTableHtml(w http.ResponseWriter, r *http.Request){\n    table := dbSelect()\n    tmpl.ExecuteTemplate(w, \"Index\", table)\n}\n\nfunc dbTable(w http.ResponseWriter, r *http.Request){\n    table := dbSelect()\n    for i := range(table) {\n        emp := table[i]\n        fmt.Fprintf(w,\"YESS|%12s|%12s|%12s|%20s|\\n\" ,emp.fname ,emp.sname ,emp.dname ,emp.email)\n    }\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", helloWorld)\n    http.HandleFunc(\"/view\", dbTableHtml) \n    http.HandleFunc(\"/raw\", dbTable)\n    http.ListenAndServe(\":8080\", nil)\n}\n\nfunc checkErr(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p><strong>layout.html</strong></p>\n\n<pre><code>{{ define \"Index\" }}\n&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en-US\"&gt;\n    &lt;head&gt;\n        &lt;title&gt;Maithanam Website&lt;/title&gt;\n        &lt;meta charset=\"UTF-8\" /&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;h1&gt;Maithanammm website for mysql&lt;/h1&gt; \n\n    {{ $length := len . }}\n    &lt;h3&gt;Length {{$length}}&lt;/h3&gt; \n\n    &lt;table border=\"1\"&gt;\n      &lt;tr&gt;\n        &lt;td&gt;FirstName&lt;/td&gt;\n        &lt;td&gt;SecondName&lt;/td&gt;\n        &lt;td&gt;Department&lt;/td&gt;\n        &lt;td&gt;Email&lt;/td&gt;\n      &lt;/tr&gt;\n    {{ range . }}\n      &lt;tr&gt;\n        &lt;td&gt;{{ .fname }}&lt;/td&gt;\n        &lt;td&gt; {{ .sname }} &lt;/td&gt;\n        &lt;td&gt;{{ .dname }} &lt;/td&gt;\n        &lt;td&gt;{{ .email }} &lt;/td&gt;\n      &lt;/tr&gt;\n    {{ end }}\n    &lt;/table&gt;\n\n    &lt;/body&gt;\n&lt;/html&gt;\n{{ end }}\n</code></pre>\n\n<p><strong>WebPage</strong>\n<a href=\"https://i.stack.imgur.com/vQGeL.png\" rel=\"nofollow noreferrer\">enter image description here</a></p>\n"}]