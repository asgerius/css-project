[{"tags": ["mysql", "reactjs", "google-app-engine", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1566421179, "post_id": 57598731, "comment_id": 101655443, "body": "Your example of <code>SearchContract</code> and <code>getRow</code> omits all error handling, I hope this is only for brevity and your real code actually properly handles errors. If so, how are you handling them? How do you know an error in your code occurred or not? Another thing, from what you&#39;re saying I gather that the Go code works correctly but the Reactjs code doesn&#39;t... why then show the Go code and leave out the React code? Also what happens if you launch your app on appengine, including react, and then make the query to the server with a tool like postman, bypassing react, do you get the correct result?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1566421569, "post_id": 57598731, "comment_id": 101655570, "body": "If I&#39;m reading this correctly, you have hardcoded localhost in your reactjs app: <a href=\"https://imgur.com/a/quxXuHW\" rel=\"nofollow noreferrer\">imgur.com/a/quxXuHW</a>"}, {"owner": {"reputation": 176, "user_id": 8651748, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LkQCVfzSNlg/AAAAAAAAAAI/AAAAAAAAAAs/tnR2NGifmB4/photo.jpg?sz=128", "display_name": "Daniel Connelly", "link": "https://stackoverflow.com/users/8651748/daniel-connelly"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566423646, "post_id": 57598731, "comment_id": 101656214, "body": "@mkopriva .... I think you may be my savior! I apologize... this was a team project I am furthering, so I did not write this code. How would I dynamically get the host it is running on? Or should I hardcode for <a href=\"https://haveibeenexploited.appspot.com/\" rel=\"nofollow noreferrer\">haveibeenexploited.appspot.com</a>?  And yes, the error handling has been omitted for brevity.  Cerise and mkopriva, there is no log because the log Google Cloud uses is called StackDriver and is not enabled for Go programs. I can&#39;t debug really at all, except on localhost and running the server locally to view the errors."}, {"owner": {"reputation": 176, "user_id": 8651748, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LkQCVfzSNlg/AAAAAAAAAAI/AAAAAAAAAAs/tnR2NGifmB4/photo.jpg?sz=128", "display_name": "Daniel Connelly", "link": "https://stackoverflow.com/users/8651748/daniel-connelly"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566423955, "post_id": 57598731, "comment_id": 101656288, "body": "@mkopriva You make many good points. I think you are right it is probably my react code. I&#39;ve never looked into postman and have no idea how to use it. Do you have a good link or instruction on how to do this operation?"}, {"owner": {"reputation": 176, "user_id": 8651748, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LkQCVfzSNlg/AAAAAAAAAAI/AAAAAAAAAAs/tnR2NGifmB4/photo.jpg?sz=128", "display_name": "Daniel Connelly", "link": "https://stackoverflow.com/users/8651748/daniel-connelly"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566424092, "post_id": 57598731, "comment_id": 101656314, "body": "@mkopriva I would think though that the localhost hardcoding should be fine though, since it could run on the localhost of AppEngine and receive incoming connections from its localhost:8080?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1566424467, "post_id": 57598731, "comment_id": 101656410, "body": "You could use environment variables or env specific config files... which one of those depends on google clouds support for them, or maybe GC supports a different and better method of providing env specific configuration that you could use. You will need to do some research on your own as I am not familiar with GC. With react you can probably also provide env specific values during build and embed them in the output file, how exactly you would do that depends on the build tool you are using."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1566424802, "post_id": 57598731, "comment_id": 101656514, "body": "I\u2019m not an appengine user so I don\u2019t know how it works on localhost. What I know, however, is that an app served from internet, e.g. https://*.appspot.com, making a request to localhost is <i>not</i> ok."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1566425181, "post_id": 57598731, "comment_id": 101656620, "body": "I\u2019m not a postman user either but a lot of people are and so there\u2019s bound to be a lot of tutorials and blog posts on how to use it. Also I\u2019m pretty sure their own documentation is going to be more than decent since they are developer oriented, so I recommend you start on they site if you\u2019re interested. Alternatively, just use curl to see if your server works as it should."}, {"owner": {"reputation": 176, "user_id": 8651748, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LkQCVfzSNlg/AAAAAAAAAAI/AAAAAAAAAAs/tnR2NGifmB4/photo.jpg?sz=128", "display_name": "Daniel Connelly", "link": "https://stackoverflow.com/users/8651748/daniel-connelly"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566429020, "post_id": 57598731, "comment_id": 101657542, "body": "@mkopriva It works...  You have no idea how overjoyed I am at this fact and how many hours I have put into this simple bug. I ended up using the <code>console</code> by viewing the page source and it verifies that the hardcoding of localhost was the issue. I should have done this a long time ago, but somehow confused Google App Engine&#39;s lack of debugging to mean I didn&#39;t have this option. You not only gave me a solution to my problem but a lot of useful tools. I am indebted to you. Please feel free to add an answer and I would gladly accept it as the best one."}], "owner": {"reputation": 176, "user_id": 8651748, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LkQCVfzSNlg/AAAAAAAAAAI/AAAAAAAAAAs/tnR2NGifmB4/photo.jpg?sz=128", "display_name": "Daniel Connelly", "link": "https://stackoverflow.com/users/8651748/daniel-connelly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1566457220, "creation_date": 1566418902, "last_edit_date": 1566457220, "question_id": 57598731, "link": "https://stackoverflow.com/questions/57598731/server-fails-to-launch-in-google-app-engine-ok-in-localhost", "title": "Server fails to launch in Google App Engine; OK in Localhost", "body": "<p>I have a Flex App written in Go and React that is deployed to Google App engine. I would like it to interact with a MySql Database (2nd generation) on Google Cloud over a Unix socket. <strong>I believe the issue lies with the Go server not launching/responding to requests (see below for justification).</strong> The App is located at <a href=\"https://haveibeenexploited.appspot.com/\" rel=\"nofollow noreferrer\">https://haveibeenexploited.appspot.com/</a></p>\n\n<p>The project is simple. I have two routes in my Server:</p>\n\n<p><strong>server.go</strong></p>\n\n<pre><code>package main\n\nimport (\n     \"net/http\"\n     \"searchcontract\"\n)\n\nfunc main() {\n    http.Handle(\"/\", http.FileServer(http.Dir(\"./app/build\")))\n    http.HandleFunc(\"/search\", searchcontract.SearchContract)\n    http.ListenAndServe(\":8080\", nil)\n}   \n</code></pre>\n\n<p>The second route (\"/search\") is activated when a user hits the search button. Ideal behavior should return a row specifying the exploits available for the given \"contract address\" which React writes out to the screen.\n<strong>searchcontract/searchcontract.go</strong></p>\n\n<pre><code>//SearchContract is a handler that queries the DB for compromised contracts.\nfunc SearchContract(w http.ResponseWriter, r *http.Request) {\n  var contractName contractID //Used for parsing in contractName\n  queryResult := getRow(&amp;contractName.Name)\n  w.WriteHeader(200) \n  json.NewEncoder(w).Encode(queryResult)\n}\n\n//processRow queries the DB for a contract with ID value of name.\nfunc getRow(contractName *string) *ContractVulnerabilityInfo {\nvar storage ContractVulnerabilityInfo //stores row to encode\n\n//Login to database\n...\nscanErr := db.QueryRow(\"SELECT * FROM contracts WHERE ContractAddress=?;\", &amp;contractName).Scan(&amp;storage.ContractAddress, &amp;storage.IntegerOverflow, &amp;storage.IntegerUnderflow, &amp;storage.DOS, &amp;storage.ExceptionState, &amp;storage.ExternalCall, &amp;storage.ExternalCallFixed, &amp;storage.MultipleCalls, &amp;storage.DelegateCall, &amp;storage.PredictableEnv, &amp;storage.TxOrigin, &amp;storage.EtherWithdrawal, &amp;storage.StateChange, &amp;storage.UnprotectedSelfdestruct, &amp;storage.UncheckedCall)\n...\nreturn &amp;storage\n}\n</code></pre>\n\n<p>My <code>app.yaml</code> file should allow me to deploy this flex app and does:</p>\n\n<pre><code>runtime: go1.12\nenv: flex\n\nhandlers:\n- url: /.* \n  script: _server # my server.go file handles all endpoints\n\nautomatic_scaling:\n  max_num_instances: 1\n\nresources:\n  cpu: 1\n  memory_gb: 0.5 \n  disk_size_gb: 10\n\nenv_variables:\n  # user:password@unix(/cloudsql/INSTANCE_CONNECTION_NAME)/dbname\n  MYSQL_CONNECTION: root:root@unix(/cloudsql/haveibeenexploited:us-west1:hibe)/mythril\n\n# https://cloud.google.com/sql/docs/mysql/connect-app-engine\nbeta_settings:\n        cloud_sql_instances: haveibeenexploited:us-west1:hibe\n</code></pre>\n\n<p>I am able to query the database successfully on localhost.<a href=\"https://i.stack.imgur.com/QZqYu.png\" rel=\"nofollow noreferrer\">Localhost correctly shows address</a></p>\n\n<p>However, whenever I try to implement and push to AppEngine, when I query something that should be in the database, it does not show up in the remote App! <a href=\"https://i.stack.imgur.com/J3GHP.png\" rel=\"nofollow noreferrer\">App Engine does not show address in database</a>. Furthermore, I get a status code of '0' returned, which indicates to me that the server function isn't even being called at all ('200' is what I expect if successful or some other error message.').</p>\n\n<p><strong>Summary</strong></p>\n\n<p>I can't wrap my head around this bug. What should work locally should work remotely. Also, I can't debug this app probably because Stackdriver does not support flex apps and the devserver Google Cloud provides does not support Go Apps.</p>\n\n<p>I believe the primary issue is with Go not speaking to the React element correctly or the routing not being taken care of appropriately.</p>\n\n<p><strong>1) The problem does not lie with MySql connection/database access</strong>\n   - I changed my route to only be one page, turned off React, and included a hardcoded query. <a href=\"https://i.stack.imgur.com/na6JC.png\" rel=\"nofollow noreferrer\">The result on localhost</a>. <a href=\"https://i.stack.imgur.com/zz17y.png\" rel=\"nofollow noreferrer\">The result on App Engine</a></p>\n\n<p><strong>2) There is an issue in either a) my routing or b) the interaction between React and Go.</strong>\n<strong>3) Go seems to start correctly... at least when React is not started.</strong></p>\n\n<p>Any help is appreciated.</p>\n\n<p><strong>EDIT</strong> I believe that the go app indeed is still running, but the searchfunction is failing for whatever reason. The reason I believe this is because when I add another route for <code>haveibeenexploited.com/hello</code>, <a href=\"https://i.stack.imgur.com/JIxIv.png\" rel=\"nofollow noreferrer\">it works</a>.</p>\n"}, {"tags": ["go", "ssl"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566410459, "post_id": 57596920, "comment_id": 101651114, "body": "Is the .crt file in PEM format?"}, {"owner": {"reputation": 1842, "user_id": 2254802, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d32c3e8c2bd04797670b2b51e50c902e?s=128&d=identicon&r=PG&f=1", "display_name": "impossible", "link": "https://stackoverflow.com/users/2254802/impossible"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566410629, "post_id": 57596920, "comment_id": 101651192, "body": "Yes. It is in format, -----BEGIN CERTIFICATE----- &lt;content&gt; -----END CERTIFICATE-----"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1566410797, "post_id": 57596920, "comment_id": 101651266, "body": "@impossible: Is the key also in PEM format? Since this is what golang complains about and not about the certificate."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566410894, "post_id": 57596920, "comment_id": 101651312, "body": "It is actually complaining about the key, what about the private-key file? Maybe it is encrypted key?"}, {"owner": {"reputation": 1842, "user_id": 2254802, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d32c3e8c2bd04797670b2b51e50c902e?s=128&d=identicon&r=PG&f=1", "display_name": "impossible", "link": "https://stackoverflow.com/users/2254802/impossible"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1566411046, "post_id": 57596920, "comment_id": 101651375, "body": "@Steffen Yes. The key as well is in PEM format. -----BEGIN RSA PRIVATE KEY----- &lt;content&gt; -----END RSA PRIVATE KEY-----"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1566411458, "post_id": 57596920, "comment_id": 101651551, "body": "@impossible: Which platform are you on? What is the line ending in the PEM file, i.e. plain LF (like with UNIX or Mac) or CRLF (like in Windows)?"}, {"owner": {"reputation": 1842, "user_id": 2254802, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d32c3e8c2bd04797670b2b51e50c902e?s=128&d=identicon&r=PG&f=1", "display_name": "impossible", "link": "https://stackoverflow.com/users/2254802/impossible"}, "edited": false, "score": 0, "creation_date": 1566411651, "post_id": 57596920, "comment_id": 101651623, "body": "I am on Windows. Key file ends with  -----END RSA PRIVATE KEY-----"}, {"owner": {"reputation": 1842, "user_id": 2254802, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d32c3e8c2bd04797670b2b51e50c902e?s=128&d=identicon&r=PG&f=1", "display_name": "impossible", "link": "https://stackoverflow.com/users/2254802/impossible"}, "edited": false, "score": 0, "creation_date": 1566466035, "post_id": 57596920, "comment_id": 101667974, "body": "Is there a way I can test my cert and key file? Some independent validation technique?"}], "answers": [{"comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1566502687, "post_id": 57614637, "comment_id": 101687034, "body": "<i>&quot;I could solve the error Failed to find any PEM data in key by creating the private key by appending csr certificate and private key one below other, respectively.&quot;</i> - this is pretty sure not the cause of the problem.  Something was wrong with your key file, but there should be no need to combine certificate and key into a file just to load the key."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1566542122, "post_id": 57614637, "comment_id": 101696001, "body": "Very likely there was a problem with the key file which you&#39;ve fixed by manually adding the certificate to it (like UTF-8 encoding, some UTF-8 BOM, missing new line at end of file or other strange things). Since it is not clear how exactly you&#39;ve added the cert and what exactly the key file looked at the byte level before you did the changes, it cannot be said what the problem was. But it is definitely not that the certificate information were missing. My guess is that it still works if you manually delete the certificate from this file again."}, {"owner": {"reputation": 1842, "user_id": 2254802, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d32c3e8c2bd04797670b2b51e50c902e?s=128&d=identicon&r=PG&f=1", "display_name": "impossible", "link": "https://stackoverflow.com/users/2254802/impossible"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1566552999, "post_id": 57614637, "comment_id": 101700938, "body": "I am still working on it. I will update this answer after little more debugging and conclusions.  Thanks you for helping me out @SteffenUllrich"}, {"owner": {"reputation": 1222, "user_id": 1285846, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/2Q4Wf.jpg?s=128&g=1", "display_name": "Danny Schoemann", "link": "https://stackoverflow.com/users/1285846/danny-schoemann"}, "edited": false, "score": 1, "creation_date": 1595841292, "post_id": 57614637, "comment_id": 111602932, "body": "Thank you - this was the answer in our case - the wrong file encoding."}], "tags": [], "owner": {"reputation": 1842, "user_id": 2254802, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d32c3e8c2bd04797670b2b51e50c902e?s=128&d=identicon&r=PG&f=1", "display_name": "impossible", "link": "https://stackoverflow.com/users/2254802/impossible"}, "is_accepted": true, "score": 0, "last_activity_date": 1566615552, "last_edit_date": 1566615552, "creation_date": 1566495991, "answer_id": 57614637, "question_id": 57596920, "link": "https://stackoverflow.com/questions/57596920/failed-to-find-any-pem-data-in-key/57614637#57614637", "title": "Failed to find any PEM data in key", "body": "<p>The issue was with the key file. The beginning of the file had some issue (like UTF-8 BOM at the start of the file or similar) as @SteffenUllrich  mentioned. To fix this, I added an empty line just above the key file and it worked.</p>\n\n<p>Finally, the key looks like:</p>\n\n<pre><code>&lt;Empty line&gt;\n-----BEGIN RSA PRIVATE KEY-----\nwlWPpSnGEdNjRapfW/6+xzjDVAaKC41c5b07OAviFchwqGI+88\naZGwBJnTgkbsLddddddd=\n-----END RSA PRIVATE KEY-----\n</code></pre>\n"}], "owner": {"reputation": 1842, "user_id": 2254802, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d32c3e8c2bd04797670b2b51e50c902e?s=128&d=identicon&r=PG&f=1", "display_name": "impossible", "link": "https://stackoverflow.com/users/2254802/impossible"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4401, "favorite_count": 0, "accepted_answer_id": 57614637, "answer_count": 1, "score": 4, "last_activity_date": 1566615723, "creation_date": 1566410115, "last_edit_date": 1566615723, "question_id": 57596920, "link": "https://stackoverflow.com/questions/57596920/failed-to-find-any-pem-data-in-key", "title": "Failed to find any PEM data in key", "body": "<p>I am trying to run an HTTPS rest server locally. \nI followed this help: <a href=\"https://github.com/denji/golang-tls\" rel=\"nofollow noreferrer\">Golang TLS</a></p>\n\n<p>It works fine when using self-signed certificates as in the above tutorial. \nBut when I replace these certificates with one I generated from GoDaddy for one of my websites, I get <code>ListenAndServe: tls: failed to find any PEM data in key input</code></p>\n\n<p>These certificates work properly on the apache server but not on my local Go server.</p>\n\n<pre><code>package main\nimport (\n    \"log\"\n    \"net/http\"\n)\n\nfunc HelloServer(w http.ResponseWriter, req *http.Request) {\n    w.Header().Set(\"Content-Type\", \"text/plain\")\n    _, _ = w.Write([]byte(\"This is an example server.\\n\"))\n}\n\nfunc main() {\n    //https://localhost:443/hello\n    http.HandleFunc(\"/hello\", HelloServer)\n    err := http.ListenAndServeTLS(\":443\",\n        \"../../../../../sslcert/server.crt\",\n        \"../../../../../sslcert/server.key\",\n        nil)\n    if err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1566407200, "last_edit_date": 1566407200, "creation_date": 1566406882, "answer_id": 57596233, "question_id": 57596213, "link": "https://stackoverflow.com/questions/57596213/are-lenstring-and-lenslices-o1-operation-in-go/57596233#57596233", "title": "Are len(string) and len(slice)s O(1) operation in Go?", "body": "<p>A string <a href=\"https://godoc.org/reflect#StringHeader\" rel=\"nofollow noreferrer\">header</a> contains a pointer to the backing array and a length. </p>\n\n<p>The <code>len()</code> function returns the length field from <a href=\"https://godoc.org/reflect#StringHeader\" rel=\"nofollow noreferrer\">string</a> and <a href=\"https://godoc.org/reflect#SliceHeader\" rel=\"nofollow noreferrer\">slice</a> headers. It's an O(1) operation.</p>\n\n<p>Regarding builtin.go. The file says: </p>\n\n<blockquote>\n  <p>Package builtin provides documentation for Go's predeclared identifiers.\n      The items documented here are not actually in package builtin\n      but their descriptions here allow godoc to present documentation\n      for the language's special identifiers.</p>\n</blockquote>\n"}], "owner": {"reputation": 626, "user_id": 4358702, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/4FIAY.jpg?s=128&g=1", "display_name": "padfoot", "link": "https://stackoverflow.com/users/4358702/padfoot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 0, "accepted_answer_id": 57596233, "answer_count": 1, "score": 1, "last_activity_date": 1566407200, "creation_date": 1566406787, "question_id": 57596213, "link": "https://stackoverflow.com/questions/57596213/are-lenstring-and-lenslices-o1-operation-in-go", "title": "Are len(string) and len(slice)s O(1) operation in Go?", "body": "<pre class=\"lang-golang prettyprint-override\"><code>var s string\nvar slice []int\n\nlen(s)\nlen(slice)\n</code></pre>\n\n<p>Is the <code>len()</code> call on <code>string</code>s and slices, O(1).</p>\n\n<p>From <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">this</a> golang official blog, I can see that the slices have the length, capacity and pointer to the underlying array. So I understood, that the len() on it may be a O(1) operation. But what about strings? Is the length of strings also internally associated with the data so that len() just looks it up and returns it?</p>\n\n<p>I looked at the source <a href=\"https://golang.org/src/builtin/builtin.go?s=5926:5946#L148\" rel=\"nofollow noreferrer\">builtin.go</a> but couldn't make anything out of it.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566476437, "post_id": 57595721, "comment_id": 101673722, "body": "Also note that <code>ffmpeg</code> has a <code>-loglevel quiet</code> option."}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1566476284, "post_id": 57596706, "comment_id": 101673639, "body": "Also, as documented, <a href=\"https://golang.org/pkg/os/exec/#Cmd.Stdout\" rel=\"nofollow noreferrer\">exec.Cmd.Stdout</a> can be set to <code>nil</code> to redirect to the null device. Some commands may write a <i>lot</i> of status to stdout and/or stderr and if you don&#39;t need it and are not going to look at it, you shouldn&#39;t buffer it."}], "tags": [], "owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "is_accepted": true, "score": 1, "last_activity_date": 1566484145, "last_edit_date": 1566484145, "creation_date": 1566409142, "answer_id": 57596706, "question_id": 57595721, "link": "https://stackoverflow.com/questions/57595721/how-to-hide-output-of-terminal-command/57596706#57596706", "title": "How to hide output of terminal command", "body": "<p>You can simply put the output to a <code>bytes.Buffer</code> variable like following:</p>\n\n<pre><code>cmd := exec.Command(\n    \"ffmpeg\",\n    \"-y\",\n    \"-loglevel\", \"warning\",\n    \"-i\", ConvertImage,\n    \"-i\", videoInput,\n    \"-c:v\", cv,\n    \"-c:a\", audioCodec,\n    \"-crf\", fmt.Sprintf(\"%d\", crf),\n    \"-map\", \"[v]\",\n    \"-map\", \"1:a?\",\n    \"-r\", fmt.Sprintf(\"%d\", Res.FrameRate),\n    \"-strict\",\n    \"-2\",\n    outputFile,\n)\n\nvar execOut bytes.Buffer\nvar execErr bytes.Buffer\ncmd.Stdout = &amp;execOut\ncmd.Stderr = &amp;execErr\n</code></pre>\n\n<p>By doing this, both the output and the error are in the corresponding buffer.</p>\n\n<p>Now, if you want to print them, then you can use the following code snippet along with the above code:</p>\n\n<pre><code>err := cmd.Run()\nif err != nil {\n    fmt.Println(\"Cannot Execute cmd: \", err.Error())\n}\noutStr := execOut.String()\nerrStr := execErr.String()\nif len(outStr) &gt; 0 {\n    fmt.Print(outStr)\n}\nif len(errStr) &gt; 0 {\n    fmt.Print(errStr)\n}\n</code></pre>\n\n<p><strong>Update:</strong> Or, if you do not need the stdout and stderr totally, then you can set the <code>cmd.Stdout</code> and <code>cmd.Stderr</code> to <code>nil</code> just like following:</p>\n\n<pre><code>cmd.Stdout = nil\ncmd.Stderr = nil\n\nerr := cmd.Run()\nif err != nil {\n    fmt.Println(\"Cannot Execute cmd: \", err.Error())\n}\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 11664727, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0619dc94957db1834c6a36b4371426fd?s=128&d=identicon&r=PG&f=1", "display_name": "Lucian Blaga", "link": "https://stackoverflow.com/users/11664727/lucian-blaga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 497, "favorite_count": 0, "accepted_answer_id": 57596706, "answer_count": 1, "score": 0, "last_activity_date": 1566484145, "creation_date": 1566404331, "last_edit_date": 1566412594, "question_id": 57595721, "link": "https://stackoverflow.com/questions/57595721/how-to-hide-output-of-terminal-command", "title": "How to hide output of terminal command", "body": "<p>I have a complex <code>ffmpeg</code> command to execute and I need to execute using Go. The command is working, the problem is coming when I try to hide the output of command using <code>&gt; /dev/null 2&gt;&amp;1</code></p>\n\n<p>This is my code:</p>\n\n<pre><code>cmd := exec.Command(\n    \"ffmpeg\",\n    \"-y\",\n    \"-loglevel\", \"warning\",\n    \"-i\", ConvertImage,\n    \"-i\", videoInput,\n    \"-c:v\", cv,\n    \"-c:a\", audioCodec,\n    \"-crf\", fmt.Sprintf(\"%d\", crf),\n    \"-map\", \"[v]\",\n    \"-map\", \"1:a?\",\n    \"-r\", fmt.Sprintf(\"%d\", Res.FrameRate),\n    \"-strict\",\n    \"-2\",\n    outputFile,\n    \"&gt; /dev/null 2&gt;&amp;1\",\n)\n</code></pre>\n\n<p>Without last field <code>\"&gt; /dev/null 2&gt;&amp;1\",</code> code is working ok when I try to hide the output of command, command skip without the run.</p>\n\n<p>What did I do wrong? How can I fix it?</p>\n"}, {"tags": ["go", "go-echo"], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 1830161, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/27bbaf4544d9d7a07d05dc1b8f9c3d94?s=128&d=identicon&r=PG", "display_name": "doglover1337", "link": "https://stackoverflow.com/users/1830161/doglover1337"}, "edited": false, "score": 0, "creation_date": 1566406107, "post_id": 57595962, "comment_id": 101649404, "body": "Thanks for you answer, got it work ! I also appreciate your time and effort in writing everything and the link regarding Exported_identifies, you are awesome !"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1566405802, "last_edit_date": 1566405802, "creation_date": 1566405461, "answer_id": 57595962, "question_id": 57595608, "link": "https://stackoverflow.com/questions/57595608/create-routing-modules-go-echo-restapi/57595962#57595962", "title": "Create Routing Modules Go/Echo RestAPI", "body": "<blockquote>\n  <p>I want to have the routes of my api in a different file for example:\n  routes/users.go that then I include in the \"main\" function and\n  register those routes.</p>\n</blockquote>\n\n<p>This is possible, simply have your files in the <code>routes</code> package declare functions that take an instance of <code>*echo.Echo</code> and have them register the handlers.</p>\n\n<pre><code>// routes/users.go\n\nfunc InitUserRoutes(e *echo.Echo) {\n    e.GET(\"users\", UserController.CreateUser)\n    e.POST(\"users\", UserController.UpdateUser)\n    e.DELETE(\"users\", UserController.DeleteUser)\n}\n\n\n// routes/posts.go\n\nfunc InitPostRoutes(e *echo.Echo) {\n    e.GET(\"posts\", PostController.CreatePost)\n    e.POST(\"posts\", PostController.UpdatePost)\n    e.DELETE(\"posts\", PostController.DeletePost)\n}\n</code></pre>\n\n<p>and then in <code>main.go</code></p>\n\n<pre><code>import (\n     \"github.com/whatever/echo\"\n     \"package/path/to/routes\"\n)\n\nfunc main() {\n    e := echo.New()\n    routes.InitUserRoutes(e)\n    routes.InitPostRoutes(e)\n    // ...\n}\n</code></pre>\n\n<p>Note that the <code>InitXxx</code> functions need to start with an upper case letter as opposed to your <code>initRoutes</code> example which has its first letter in lower case. This is because identifiers with lower case first letters are <em>unexported</em>, which makes them inaccessible from outside their own package. Put another way, for you to be able to reference an imported identifier you have to export it by having it start with an upper case letter.</p>\n\n<p>More here: <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Exported_identifiers</a></p>\n"}], "owner": {"reputation": 137, "user_id": 1830161, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/27bbaf4544d9d7a07d05dc1b8f9c3d94?s=128&d=identicon&r=PG", "display_name": "doglover1337", "link": "https://stackoverflow.com/users/1830161/doglover1337"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 57595962, "answer_count": 1, "score": -2, "last_activity_date": 1566405802, "creation_date": 1566403868, "last_edit_date": 1566404319, "question_id": 57595608, "link": "https://stackoverflow.com/questions/57595608/create-routing-modules-go-echo-restapi", "title": "Create Routing Modules Go/Echo RestAPI", "body": "<p>I just started learning Go and want to create my own REST API.</p>\n\n<p>The problem is simple:\nI want to have the routes of my api in a different file for example: routes/users.go that then I include in the \"main\" function and register those routes.</p>\n\n<p>There are a high number of examples of restAPI's in Echo/Go but all of them have the routes in the main() function.</p>\n\n<p>I checked a few examples/github starter kits but it seems that I cannot find a solution that I like.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    e := echo.New()\n\n    e.GET(\"/\", func(c echo.Context) error {\n        responseJSON := &amp;JSResp{Msg: \"Hello World!\"}\n        return c.JSON(http.StatusOK, responseJSON)\n    })\n\n     //I want to get rid of this\n    e.GET(\"users\", UserController.CreateUser)\n    e.POST(\"users\", UserController.UpdateUser)\n    e.DELETE(\"users\", UserController.DeleteUser)\n\n    //would like something like\n    // UserRoutes.initRoutes(e)\n\n    e.Logger.Fatal(e.Start(\":1323\"))\n}\n\n//UserController.go\n//CreateUser \nfunc CreateUser(c echo.Context) error {\n    responseJSON := &amp;JSResp{Msg: \"Create User!\"}\n    return c.JSON(http.StatusOK, responseJSON)\n}\n\n//UserRoutes.go\nfunc initRoutes(e) { //this is probably e* echo or something like that\n//UserController is a package in this case that exports the CreateUser function\n    e.GET(\"users\", UserController.CreateUser) \n    return e;\n}\n</code></pre>\n\n<p>Is there an easy way to make this? Coming from node.js and still having some syntax errors of course, will solve them, but I am struggling with the architecture of my code at the moment.</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1566415253, "post_id": 57595156, "comment_id": 101653135, "body": "<code>maxPartSize = int64(512 * 1000)</code> \u2013 This isn&#39;t 5 MB. <code>5 MB = 5 &lt;&lt; 20</code>"}, {"owner": {"reputation": 379, "user_id": 2918731, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/6mtoN.png?s=128&g=1", "display_name": "TheLebDev", "link": "https://stackoverflow.com/users/2918731/thelebdev"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1566455278, "post_id": 57595156, "comment_id": 101662740, "body": "@icza then how do you recon it&#39;s working?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1566455395, "post_id": 57595156, "comment_id": 101662783, "body": "I just pointed out something that is most likely an error in your code. Change <code>maxPartSize</code> to be <code>5 &lt;&lt; 20</code> and see if it solves your issue."}], "answers": [{"comments": [{"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 1, "creation_date": 1566522618, "post_id": 57604562, "comment_id": 101691970, "body": "The documentation isn&#39;t fully correct.  The minimum part size isn&#39;t 5 MB = 5 &#215; 1000 &#215; 1000.  It&#39;s 5 MiB = 5 &#215; 1024 &#215; 1024.  Not sure what you were going for with 512 &#215; 1000."}, {"owner": {"reputation": 379, "user_id": 2918731, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/6mtoN.png?s=128&g=1", "display_name": "TheLebDev", "link": "https://stackoverflow.com/users/2918731/thelebdev"}, "reply_to_user": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1566550825, "post_id": 57604562, "comment_id": 101699783, "body": "I agree. After contacting the <a href=\"https://github.com/apoorvam\" rel=\"nofollow noreferrer\">author</a> of the code, it was <a href=\"https://github.com/apoorvam/aws-s3-multipart-upload/commit/ea47201d5130871b73c245fb2279a33afcdb3884\" rel=\"nofollow noreferrer\">fixed</a>."}], "tags": [], "owner": {"reputation": 379, "user_id": 2918731, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/6mtoN.png?s=128&g=1", "display_name": "TheLebDev", "link": "https://stackoverflow.com/users/2918731/thelebdev"}, "is_accepted": false, "score": 0, "last_activity_date": 1566460479, "creation_date": 1566460479, "answer_id": 57604562, "question_id": 57595156, "link": "https://stackoverflow.com/questions/57595156/entitytoosmall-when-uploading-to-s3/57604562#57604562", "title": "EntityTooSmall when uploading to S3", "body": "<p>Thanks to @icza's pointers, the code I've mentioned above is not quite complete. The error I was receiving had nothing to do with the last bit. Apparently, it's part of the <code>completeMultiPartUpload</code> function. That's where the error is being thrown.</p>\n\n<p><strong>Details:</strong> The <code>uploadPart</code> is taking my data, whatever my chunk size is, and storing it in a pool of some sort. The error is being thrown at the <code>maxPartSize</code>, being too small. Changing that to anything greater than 5 MB solved the issue.</p>\n"}], "owner": {"reputation": 379, "user_id": 2918731, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/6mtoN.png?s=128&g=1", "display_name": "TheLebDev", "link": "https://stackoverflow.com/users/2918731/thelebdev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 477, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1566460479, "creation_date": 1566402068, "last_edit_date": 1566409406, "question_id": 57595156, "link": "https://stackoverflow.com/questions/57595156/entitytoosmall-when-uploading-to-s3", "title": "EntityTooSmall when uploading to S3", "body": "<p>I'm trying to upload a file to my S3 bucket using multipart upload. I'm following the exact same code as found <a href=\"https://github.com/apoorvam/aws-s3-multipart-upload/blob/master/aws-multipart-upload.go\" rel=\"nofollow noreferrer\">here</a>. The problem is, whenever it reaches the last part of my file, I get a <code>EntityTooSmall: Your proposed upload is smaller than the minimum allowed size</code> error.</p>\n\n<p>Issue: S3's multipart upload restricts file part sizes to a minimum of 5 MB</p>\n\n<p>Solution: S3 allows the last part to be less than 5 MB large</p>\n\n<p>Issue: This <strong>is</strong> my last part. And it's not being recognized. Is there anything I'm missing?</p>\n"}, {"tags": ["go", "function-pointers"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 5, "last_activity_date": 1566400716, "creation_date": 1566400716, "answer_id": 57594773, "question_id": 57594698, "link": "https://stackoverflow.com/questions/57594698/what-are-function-pointers-good-for-in-go-if-you-cant-assign-them-values/57594773#57594773", "title": "What are function pointers good for in Go if you can&#39;t assign them values?", "body": "<p>You can't take the address of a function definition, you can take the address of a function <em>value</em>. This works:</p>\n\n<pre><code>g := &amp;f\n</code></pre>\n\n<p>Playground example: <a href=\"https://play.golang.org/p/BokYCrVmV_p\" rel=\"noreferrer\">https://play.golang.org/p/BokYCrVmV_p</a></p>\n"}, {"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 4, "last_activity_date": 1567120103, "last_edit_date": 1567120103, "creation_date": 1566400840, "answer_id": 57594807, "question_id": 57594698, "link": "https://stackoverflow.com/questions/57594698/what-are-function-pointers-good-for-in-go-if-you-cant-assign-them-values/57594807#57594807", "title": "What are function pointers good for in Go if you can&#39;t assign them values?", "body": "<p>You can pass it around and set it:</p>\n\n<pre><code>func a(f *func()) {\n  *f = foo\n}\n\nfunc main() {\n   var f func()\n\n   a(&amp;f)\n   f()\n}\n</code></pre>\n"}], "owner": {"reputation": 10223, "user_id": 221650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/68a2471aa6fae5bfec71d8d09afbb2f1?s=128&d=identicon&r=PG&f=1", "display_name": "Petruza", "link": "https://stackoverflow.com/users/221650/petruza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 57594773, "answer_count": 2, "score": -6, "last_activity_date": 1567120103, "creation_date": 1566400527, "question_id": 57594698, "link": "https://stackoverflow.com/questions/57594698/what-are-function-pointers-good-for-in-go-if-you-cant-assign-them-values", "title": "What are function pointers good for in Go if you can&#39;t assign them values?", "body": "<p>Can you do anything in Go with a <code>*func()</code>?  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    var f func() = foo // works\n    var g *func() // works\n    g = foo // fails `cannot use foo (type func()) as type *func() in assignment` as expected\n    g = &amp;foo // fails too `cannot take the address of foo`\n</code></pre>\n"}, {"tags": ["go", "channels"], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 1519054, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/f27ab92826d363bc4160fba73694dcf3?s=128&d=identicon&r=PG", "display_name": "user1519054", "link": "https://stackoverflow.com/users/1519054/user1519054"}, "edited": false, "score": 0, "creation_date": 1566404366, "post_id": 57594569, "comment_id": 101648648, "body": "Your answer was useful.  Thank you!  Working code would have been even better!"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 3, "last_activity_date": 1566400118, "creation_date": 1566400118, "answer_id": 57594569, "question_id": 57594490, "link": "https://stackoverflow.com/questions/57594490/channels-terminate-prematurely/57594569#57594569", "title": "Channels terminate prematurely", "body": "<p>You're calling <code>wg.Wait</code> in a goroutine, so <code>main</code> is allowed to return (and therefore your program exits) before the other routines have finished. This would cause the behavior your see, but taking out of a goroutine alone isn't enough.</p>\n\n<p>You're also misusing the <code>WaitGroup</code> in general; your <code>Add</code> and <code>Done</code> calls don't relate to one another, and you don't have as many <code>Done</code>s as you have <code>Add</code>s, so the <code>WaitGroup</code> will never finish. If you're calling <code>Add</code> in a loop, then every loop iteration must also result in a <code>Done</code> call; as you have it now, you <code>defer wg.Done()</code> before each of your loops, then call <code>Add</code> inside the loop, resulting in one <code>Done</code> and many <code>Add</code>s. This code would need to be significantly revised to work as intended.</p>\n"}, {"comments": [{"owner": {"reputation": 61, "user_id": 1519054, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/f27ab92826d363bc4160fba73694dcf3?s=128&d=identicon&r=PG", "display_name": "user1519054", "link": "https://stackoverflow.com/users/1519054/user1519054"}, "edited": false, "score": 0, "creation_date": 1566403357, "post_id": 57595391, "comment_id": 101648207, "body": "That addresses my needs.  Thank you!"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 3, "last_activity_date": 1566405172, "last_edit_date": 1566405172, "creation_date": 1566403005, "answer_id": 57595391, "question_id": 57594490, "link": "https://stackoverflow.com/questions/57594490/channels-terminate-prematurely/57595391#57595391", "title": "Channels terminate prematurely", "body": "<p>As Adrian already pointed out, your WaitGroup.Add and WaitGroup.Done calls are mismatched. However, in cases like this the \"I am done\" signal is typically given by closing the output channel. WaitGroups are only necessary if work is shared between several goroutines (i.e. several goroutines consume the same channel), which isn't the case here.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    a1 := []string{\"apple\", \"apricot\"}\n\n    chan1 := make(chan string)\n    chan2 := make(chan string)\n    chan3 := make(chan string)\n\n    go func() {\n        for _, s := range a1 {\n            chan1 &lt;- s\n        }\n\n        close(chan1)\n    }()\n\n    go Pipe1(chan2, chan1)\n    go Pipe2(chan3, chan2)\n\n    // This range loop terminates when chan3 is closed, which Pipe2 does after\n    // chan2 is closed, which Pipe1 does after chan1 is closed, which the\n    // anonymous goroutine above does after it sent all values.\n    for s := range chan3 {\n        fmt.Println(s)\n    }\n}\n\nfunc Pipe1(out chan&lt;- string, in &lt;-chan string) {\n    for s := range in {\n        out &lt;- s + \"s are\"\n    }\n\n    close(out) // let caller know that we're done\n}\n\nfunc Pipe2(out chan&lt;- string, in &lt;-chan string) {\n    for s := range in {\n        out &lt;- s + \" good for you\"\n    }\n\n    close(out) // let caller know that we're done\n}\n</code></pre>\n\n<p>Try it on the playground: <a href=\"https://play.golang.org/p/d2J4APjs_lL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/d2J4APjs_lL</a></p>\n"}], "owner": {"reputation": 61, "user_id": 1519054, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/f27ab92826d363bc4160fba73694dcf3?s=128&d=identicon&r=PG", "display_name": "user1519054", "link": "https://stackoverflow.com/users/1519054/user1519054"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 57595391, "answer_count": 2, "score": -3, "last_activity_date": 1566405172, "creation_date": 1566399848, "last_edit_date": 1566399871, "question_id": 57594490, "link": "https://stackoverflow.com/questions/57594490/channels-terminate-prematurely", "title": "Channels terminate prematurely", "body": "<p>I am prototyping a series of go routines for a pipeline that each perform a transformation.  The routines are terminating before all the data has passed through.</p>\n\n<p>I have checked Donavan and Kernighan book and Googled for solutions.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    a1 := []string{\"apple\", \"apricot\"}\n\n    chan1 := make(chan string)\n    chan2 := make(chan string)\n    chan3 := make(chan string)\n\n    var wg sync.WaitGroup\n\n    go Pipe1(chan2, chan1, &amp;wg)\n    go Pipe2(chan3, chan2, &amp;wg)\n    go Pipe3(chan3, &amp;wg)\n\n    func (data []string) {\n        defer wg.Done()\n        for _, s := range data {\n            wg.Add(1)\n            chan1 &lt;- s\n        }\n        go func() {\n            wg.Wait()\n            close(chan1)\n        }()\n    }(a1)\n}\n\nfunc Pipe1(out chan&lt;- string, in &lt;-chan string, wg *sync.WaitGroup) {\n    defer wg.Done()\n    for s := range in {\n        wg.Add(1)\n        out &lt;- s + \"s are\"\n    }\n}\nfunc Pipe2(out chan&lt;- string, in &lt;-chan string, wg *sync.WaitGroup) {\n    defer wg.Done()\n    for s := range in {\n        wg.Add(1)\n        out &lt;- s + \" good for you\"\n    }\n}\nfunc Pipe3(in &lt;-chan string, wg *sync.WaitGroup) {\n    defer wg.Done()\n    for s := range in {\n        wg.Add(1)\n        fmt.Println(s)\n    }\n}\n\n\n</code></pre>\n\n<p>My expected output is:</p>\n\n<pre><code>apples are good for you\napricots are good for you\n</code></pre>\n\n<p>The results of running main are inconsistent.  Sometimes I get both lines.  Sometimes I just get the apples.  Sometimes nothing is output.</p>\n"}, {"tags": ["go", "type-conversion"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1566395748, "post_id": 57593161, "comment_id": 101644084, "body": "See possible duplicate <a href=\"https://stackoverflow.com/questions/28227095/multiple-values-in-single-value-context/28233172#28233172\">Multiple values in single-value context</a>."}, {"owner": {"reputation": 1691, "user_id": 9609442, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bC135.jpg?s=128&g=1", "display_name": "Gabe", "link": "https://stackoverflow.com/users/9609442/gabe"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1566396647, "post_id": 57593161, "comment_id": 101644672, "body": "@icza That question was simply asking how to convert string to an int. I already knew how to do that, what I wanted was to do it in an if statement and throw away the error."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1566418832, "post_id": 57593161, "comment_id": 101654566, "body": "On the general principle that errors you are sure won&#39;t happen, actually will happen, I&#39;d use a <code>mustXXX</code> wrapper function that panics if the error that cannot happen, does happen."}], "answers": [{"comments": [{"owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 1, "creation_date": 1566399794, "post_id": 57593198, "comment_id": 101646317, "body": "Nice answer. I would argue the second option is more idiomatic Go."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "edited": false, "score": 1, "creation_date": 1566421419, "post_id": 57593198, "comment_id": 101655519, "body": "@EmilePels: In Go, don&#39;t ignore errors. Neither answer is idiomatic. Quite the contrary. Both answers are bad."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 5, "last_activity_date": 1566396182, "last_edit_date": 1566396182, "creation_date": 1566395316, "answer_id": 57593198, "question_id": 57593161, "link": "https://stackoverflow.com/questions/57593161/throwing-away-error-value-on-string-to-int-conversion/57593198#57593198", "title": "Throwing away error value on string to int conversion", "body": "<ol>\n<li>Create a wrapper function that discards the error result:</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func atoi(s string) int {\n    value, _ := strconv.Atoi(s)\n    return value\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>if 45 + atoi(value) &gt;= 90 {\n    //do something\n}\n</code></pre>\n\n<ol start=\"2\">\n<li>Or, do the conversion as a statement before the <code>if</code> and ignore the error result:</li>\n</ol>\n\n<pre class=\"lang-golang prettyprint-override\"><code>if i, _ := strconv.Atoi(value); 45 + i &gt;= 90 {\n    // do something\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1566422001, "last_edit_date": 1566422001, "creation_date": 1566420801, "answer_id": 57599058, "question_id": 57593161, "link": "https://stackoverflow.com/questions/57593161/throwing-away-error-value-on-string-to-int-conversion/57599058#57599058", "title": "Throwing away error value on string to int conversion", "body": "<blockquote>\n  <p>I simply want to convert a string to an int.</p>\n  \n  <p>What if I am 100% the string will be a number.</p>\n  \n  <p>I want to convert a string of numeric digits to an int in an if\n  statement, like the following:</p>\n\n<pre><code>if 45 + strconv.Atoi(value) &gt;= 90 {\n    //do something\n}\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>What if you are wrong?</p>\n\n<hr>\n\n<p>Write a simple Go wrapper function for <code>strconv.Atoi</code>. In Go, don't ignore errors.</p>\n\n<pre><code>// ASCII digits to integer.\nfunc dtoi(s string) int {\n    i, err := strconv.Atoi(s)\n    if err != nil {\n        panic(err)\n    }\n    return i\n}\n</code></pre>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\n// ASCII digits to integer.\nfunc dtoi(s string) int {\n    i, err := strconv.Atoi(s)\n    if err != nil {\n        panic(err)\n    }\n    return i\n}\n\nfunc main() {\n    value := \"1024\"\n    if 45+dtoi(value) &gt;= 90 {\n        fmt.Println(\"do something\")\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/I3plKW2TGSZ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/I3plKW2TGSZ</a></p>\n\n<p>Output:</p>\n\n<pre><code>do something\n</code></pre>\n"}], "owner": {"reputation": 1691, "user_id": 9609442, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bC135.jpg?s=128&g=1", "display_name": "Gabe", "link": "https://stackoverflow.com/users/9609442/gabe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 2, "accepted_answer_id": 57593198, "answer_count": 2, "score": -1, "last_activity_date": 1566422001, "creation_date": 1566395215, "last_edit_date": 1566395568, "question_id": 57593161, "link": "https://stackoverflow.com/questions/57593161/throwing-away-error-value-on-string-to-int-conversion", "title": "Throwing away error value on string to int conversion", "body": "<p>I have a Go program that I simply want to convert a string to an int. I understand the function: </p>\n\n<pre><code>val, err := strconv.Atoi(myValueAsAString)\n</code></pre>\n\n<p>works and I can check the error by the following:</p>\n\n<pre><code>if err != nil {\n    //handle error\n}\n</code></pre>\n\n<p>But what if I am 100% the string will be a number, and I want to convert it to an int in an if statement, like the following:</p>\n\n<pre><code>if 45 + strconv.Atoi(value) &gt;= 90 {\n    //do something\n}\n</code></pre>\n\n<p>But strconv.Atoi also returns an error value as well, so how can I throw that away and essentially do what I did above, without having to define the variable above the if statement and use it in the if statement. I'm not sure if this is possible or not, but I would love to know.</p>\n"}, {"tags": ["mysql", "go", "go-gorm"], "owner": {"reputation": 35, "user_id": 11620811, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JQCeY.jpg?s=128&g=1", "display_name": "dedicat4d", "link": "https://stackoverflow.com/users/11620811/dedicat4d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 69, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1569976228, "creation_date": 1566394528, "last_edit_date": 1569976228, "question_id": 57592938, "link": "https://stackoverflow.com/questions/57592938/how-to-parse-table-in-composite-structure", "title": "How to parse table in composite structure", "body": "<p>I have several structures, one of which contains all the rest. I need to use GORM to get the main structure.</p>\n\n<p>I tried to use gorm tag with 'column', but doesn't work</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package database\n\nimport (\n    \"database/sql\"\n    \"time\"\n)\n\ntype TaskItem struct {\n    Ind              int32          `gorm:\"column:Ind\"`\n    ParentIndArray   sql.NullString `gorm:\"column:ParentIndArray\"`\n    ParentInd        int32          `gorm:\"column:ParentInd\"`\n    SourceId         string         `gorm:\"column:SourceId\"`\n    SourceInd        int32          `gorm:\"column:SourceInd\"`\n    ContentIndActive int32          `gorm:\"column:ContentIndActive\"`\n    StatusIndInit    int32          `gorm:\"column:StatusIndInit\"`\n    StatusIndActive  int32          `gorm:\"column:StatusIndActive\"`\n    TaskTypeInd      int32          `gorm:\"column:TaskTypeInd\"`\n    RootTaskTypeInd  int32          `gorm:\"column:RootTaskTypeInd\"`\n    FieldInd         int32          `gorm:\"column:FieldInd\"`\n    StateIndActive   int32          `gorm:\"column:StateIndActive\"`\n    ChildIndArray    []byte         `gorm:\"column:ChildIndArray\"`\n}\n\ntype TaskContent struct {\n    Ind               int32     `gorm:\"column:ContentInd\"`\n    TaskInd           int32     `gorm:\"-\"`\n    SessionInd        int32     `gorm:\"column:ContentSessInd\"`\n    Caption           string    `gorm:\"column:Caption\"`\n    Content           []byte    `gorm:\"column:Content\"`\n    Priority          int32     `gorm:\"column:Priority\"`\n    PlanningDateStart time.Time `gorm:\"column:PlanningDateStart\"`\n    PlanningDateEnd   time.Time `gorm:\"column:PlanningDateEnd\"`\n    TimeEstimate      time.Time `gorm:\"column:TimeEstimate\"`\n    ApplyDate         time.Time `gorm:\"column:ContentApplyDate\"`\n}\n\ntype TaskStatus struct {\n    Ind         int32     `gorm:\"column:StatusInd\"`\n    TaskInd     int32     `gorm:\"-\"`\n    ChainId     string    `gorm:\"column:ChainId\"`\n    MessageId   string    `gorm:\"column:MessageID\"`\n    SessionInd  int32     `gorm:\"column:StatusSessInd\"`\n    StatusInd   int32     `gorm:\"column:Status\"`\n    Text        string    `gorm:\"column:Text\"`\n    Comment     string    `gorm:\"column:Comment\"`\n    ApplyDate   time.Time `gorm:\"column:StatusApplyDate\"`\n    ReceiveData time.Time `gorm:\"column:StatusReceiveDate\"`\n}\n\ntype TaskState struct {\n    Ind        int32     `gorm:\"column:StateInd\"`\n    TaskInd    int32     `gorm:\"-\"`\n    SessionInd int32     `gorm:\"column:StateSessInd\"`\n    State      int32     `gorm:\"column:State\"`\n    ApplyDate  time.Time `gorm:\"column:StateApplyDate\"`\n}\n\ntype Task struct {\n    Item    TaskItem\n    Content TaskContent\n    Status  TaskStatus\n    State   TaskState\n}\n\n</code></pre>\n\n<p>I expect Task to contain other data from database. What should I do?</p>\n\n<p>Note. At first, I use:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// tasks is equal []Task\nerr = database.db.Raw(\"CALL pr_task_list_by_account_ind(?)\", accountGroupInd).Scan(&amp;tasks)\n</code></pre>\n\n<p>Then I decided to try using:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var ti []TaskItem\nvar tc []TaskContent\nvar tse []TaskState\nvar tss []TaskStatus\nerr = database.db.Raw(\"CALL pr_task_list_by_account_ind(?)\", accountGroupInd).Scan(&amp;ti).Scan(&amp;tc).Scan(&amp;tse).Scan(&amp;tss).Error\n</code></pre>\n\n<p>and I noticed that the first scanner works, and if I remove it, then the second scanner starts to work too</p>\n"}, {"tags": ["date", "go"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 3, "last_activity_date": 1566394513, "creation_date": 1566394513, "answer_id": 57592930, "question_id": 57592856, "link": "https://stackoverflow.com/questions/57592856/cannot-parse-0000-utc-as-t-go-utc-time-parsing-error/57592930#57592930", "title": "cannot parse &quot; +0000 UTC&quot; as &quot;T&quot;. Go utc time parsing error", "body": "<p>stringTime is not in RFC3339 format: <a href=\"https://golang.org/pkg/time/#Time.String\" rel=\"nofollow noreferrer\">https://golang.org/pkg/time/#Time.String</a></p>\n\n<p>If you want to parse it, use the format in the link.</p>\n"}], "owner": {"reputation": 1550, "user_id": 3079776, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/NmNaz.png?s=128&g=1", "display_name": "M14", "link": "https://stackoverflow.com/users/3079776/m14"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 394, "favorite_count": 0, "closed_date": 1566400334, "answer_count": 1, "score": -4, "last_activity_date": 1566394513, "creation_date": 1566394254, "last_edit_date": 1566394429, "question_id": 57592856, "link": "https://stackoverflow.com/questions/57592856/cannot-parse-0000-utc-as-t-go-utc-time-parsing-error", "closed_reason": "Duplicate", "title": "cannot parse &quot; +0000 UTC&quot; as &quot;T&quot;. Go utc time parsing error", "body": "<p>I was trying to parse a time time between utc string back to Go time. But I'm getting an error <code>cannot parse \"  +0000 UTC\" as \"T\"</code>.</p>\n\n<pre><code>stringTime := time.Now().UTC().String()\nt, e := time.Parse(time.RFC3339, stringTime)\nfmt.Println(e)\nfmt.Println(t)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/HFiH9Ifk2kj\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}, {"tags": ["user-interface", "go", "andlabs-ui"], "comments": [{"owner": {"reputation": 2892, "user_id": 1978013, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/fd980993188a54d04e3cf1f1cbf34110?s=128&d=identicon&r=PG", "display_name": "Seaskyways", "link": "https://stackoverflow.com/users/1978013/seaskyways"}, "edited": false, "score": 1, "creation_date": 1566394043, "post_id": 57592484, "comment_id": 101642882, "body": "<code>NewEntry</code> is a function, you can&#39;t make an array of a function."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1566396173, "post_id": 57592484, "comment_id": 101644380, "body": "Also none of the things you listed are <a href=\"https://tour.golang.org/moretypes/6\" rel=\"nofollow noreferrer\">arrays</a>, they are all <a href=\"https://tour.golang.org/moretypes/7\" rel=\"nofollow noreferrer\">slices</a>."}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 1, "last_activity_date": 1566393166, "creation_date": 1566393166, "answer_id": 57592512, "question_id": 57592484, "link": "https://stackoverflow.com/questions/57592484/how-to-declare-an-array-of-ui-newentry/57592512#57592512", "title": "How to declare an array of ui.NewEntry?", "body": "<p><code>ui.NewEntry</code> returns <code>*Entry</code>, therefore your slice should be declared as:</p>\n\n<pre><code>var entlist []*ui.Entry\n</code></pre>\n"}], "owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 30, "favorite_count": 0, "accepted_answer_id": 57592512, "answer_count": 1, "score": -2, "last_activity_date": 1567098211, "creation_date": 1566393083, "last_edit_date": 1567098211, "question_id": 57592484, "link": "https://stackoverflow.com/questions/57592484/how-to-declare-an-array-of-ui-newentry", "title": "How to declare an array of ui.NewEntry?", "body": "<p>I am trying to create a GUI with a series of text entry fields: </p>\n\n<pre><code>package main\nimport (\"github.com/andlabs/ui\")\nfunc main() {\n    ui.Main(makeMainWin)\n}\nfunc makeMainWin(){\n    var entlist = []ui.NewEntry //Error here. How to declare an array of ui.NewEntry?\n    var box = ui.NewVerticalBox()\n    for i,_ := range [5]int{} {\n        println(i)\n        box.Append(ui.NewEntry(), false)\n    }\n    var mainWindow = ui.NewWindow(\"Hello\", 200, 100, false)\n    mainWindow.SetChild(box)\n    mainWindow.OnClosing( func (*ui.Window) bool { \n               ui.Quit(); return true   } )\n    mainWindow.Show()\n}\n</code></pre>\n\n<p>However, there is error on <code>var entlist = []NewEntry</code></p>\n\n<p>I am not able to create an array of NewEntry components. I have tried <code>[]ui.NewEntry</code>, <code>[]*ui.NewEntry</code>, <code>[]ui.NewEntry()</code> and <code>[]*ui.NewEntry()</code></p>\n\n<p>Where is the problem and how can it be solved? Thanks for your help.</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1566392138, "post_id": 57591085, "comment_id": 101641602, "body": "Are you running the current release of Go?"}, {"owner": {"reputation": 5623, "user_id": 15931, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/35d5a5a60971efb294071d856d5a1b9c?s=128&d=identicon&r=PG&f=1", "display_name": "E.Z.", "link": "https://stackoverflow.com/users/15931/e-z"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1566393545, "post_id": 57591085, "comment_id": 101642549, "body": "<code>go version go1.12.7 linux&#47;amd64</code>"}, {"owner": {"reputation": 2653, "user_id": 11210494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f24d82ad87e7e92592ede8c31c52748e?s=128&d=identicon&r=PG&f=1", "display_name": "typical182", "link": "https://stackoverflow.com/users/11210494/typical182"}, "edited": false, "score": 0, "creation_date": 1566868699, "post_id": 57591085, "comment_id": 101781699, "body": "Have you had a chance to try with Go 1.13?"}], "answers": [{"comments": [{"owner": {"reputation": 15260, "user_id": 1968182, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/E5nF2.jpg?s=128&g=1", "display_name": "Ulrich Eckhardt", "link": "https://stackoverflow.com/users/1968182/ulrich-eckhardt"}, "edited": false, "score": 0, "creation_date": 1578836773, "post_id": 57600241, "comment_id": 105561311, "body": "I don&#39;t see how this answers anything. Do you want to confirm that this is a bug in Go?"}], "tags": [], "owner": {"reputation": 2653, "user_id": 11210494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f24d82ad87e7e92592ede8c31c52748e?s=128&d=identicon&r=PG&f=1", "display_name": "typical182", "link": "https://stackoverflow.com/users/11210494/typical182"}, "is_accepted": true, "score": -1, "last_activity_date": 1566429269, "creation_date": 1566429269, "answer_id": 57600241, "question_id": 57591085, "link": "https://stackoverflow.com/questions/57591085/behaviour-of-go-mod-tidy-vs-go-build/57600241#57600241", "title": "Behaviour of &quot;go mod tidy&quot; vs &quot;go build&quot;", "body": "<p>The behavior you\u2019re expecting is usually true.</p>\n\n<p>Go 1.13 has some fixes in this area. I would suggest trying with that: </p>\n\n<p><a href=\"https://twitter.com/golang/status/1164276194524762113\" rel=\"nofollow noreferrer\">https://twitter.com/golang/status/1164276194524762113</a></p>\n"}], "owner": {"reputation": 5623, "user_id": 15931, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/35d5a5a60971efb294071d856d5a1b9c?s=128&d=identicon&r=PG&f=1", "display_name": "E.Z.", "link": "https://stackoverflow.com/users/15931/e-z"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4841, "favorite_count": 1, "accepted_answer_id": 57600241, "answer_count": 1, "score": 3, "last_activity_date": 1566429269, "creation_date": 1566388598, "last_edit_date": 1566392706, "question_id": 57591085, "link": "https://stackoverflow.com/questions/57591085/behaviour-of-go-mod-tidy-vs-go-build", "title": "Behaviour of &quot;go mod tidy&quot; vs &quot;go build&quot;", "body": "<p>Suppose I have a project with the following structure:</p>\n\n<pre><code>+-- app/\n+-- otherstuff/\n+-- test/\n+-- go.mod\n+-- go.sum\n+-- main.go\n</code></pre>\n\n<p>I can make sure <code>go.mod</code> does not contain unused dependencies by running <code>go mod tidy</code>:</p>\n\n<pre><code># 1) Verify that no dependency containing the name \"modern-go\" is found on go.mod\n$ grep 'modern-go' go.mod\n&lt;-- Empty (nothing found) (OK)\n\n\n# 2) Run \"go mod tidy\", verify that nothing changes (i.e. go.mod is already clean)\n$ go mod tidy -v\nunused github.com/modern-go/concurrent\nunused github.com/modern-go/reflect2\n&lt;-- messages above are displayed, but go.mod did not change\n\n\n# 3) Verify that go.mod did not change\n$ grep 'modern-go' go.mod\n&lt;-- Empty (nothing found) (OK)\n</code></pre>\n\n<p>Now, if I run <code>go build</code>, <code>go.mod</code> gets updated:</p>\n\n<pre><code># 4) Run \"go build\"\n$ go build\n\n\n# 5) go.mod was updated by \"go build\":\n$ grep 'modern-go' go.mod\n    github.com/modern-go/concurrent v0.0.0-20180306012644-bacd9c7ef1dd // indirect\n    github.com/modern-go/reflect2 v1.0.1 // indirect\n</code></pre>\n\n<p>I can't figure out what's going on here. I expected <code>go mod tidy</code> would leave <code>go.mod</code> on a clean state, and that running <code>go build</code> would therefore not change it.</p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 121, "user_id": 2120542, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ukWqY.jpg?s=128&g=1", "display_name": "Tristan", "link": "https://stackoverflow.com/users/2120542/tristan"}, "is_accepted": false, "score": 1, "last_activity_date": 1566455094, "creation_date": 1566455094, "answer_id": 57603133, "question_id": 57589790, "link": "https://stackoverflow.com/questions/57589790/cel-go-how-to-use-custom-objects-and-timestamp-comparisons/57603133#57603133", "title": "cel-go. how to use custom objects and timestamp comparisons", "body": "<p><a href=\"https://github.com/google/cel-spec\" rel=\"nofollow noreferrer\">CEL</a> is a C-like expression language where the expression can only referenced variables, functions, and macros that the host process exposes. CEL provides a library of builtin functions, or you can supply your own custom functions.</p>\n\n<p>Given the following expression:</p>\n\n<pre><code>user.expirydate &gt; now\n</code></pre>\n\n<p>The host process must declare the following variables:</p>\n\n<pre><code>user // type DYN\nnow  // type TIMESTAMP\n</code></pre>\n\n<p>All operators are declared as functions within CEL and which ones are supported in a given expression is customizable. The <code>&gt;</code> operator is one of the standard builtins, so it's available by default.</p>\n\n<p>The following is an example of how you might parse, type-check, and evaluate the example. Type-checking is optional, but strongly encouraged since it ensures the variables and functions are being used correctly. </p>\n\n<pre><code>vars := cel.Declarations(\n   decls.NewIdent('user', decls.Dyn, nil),\n   decls.NewIdent('now', decls.Timestamp, nil),\n)\n// The err and iss values should be checked, but for brevity the checks\n// have been omitted.\nenv, err     := cel.NewEnv(vars)\nparsed, iss  := env.Parse(`user.expirydate &gt; now`)\nast, iss     := env.Check(parsed)\nprogram, err := env.Program(ast)\n\n// The data is a map containing the desired fields.\n// The result contains the outcome of evaluation.\nresult, details, err := program.Eval(data)\n</code></pre>\n\n<p>Working <a href=\"https://play.golang.org/p/-IsfIbahvot\" rel=\"nofollow noreferrer\">Go Playground Example</a>.</p>\n\n<p>Note, evaluation is mutation free and side-effect free which means that extension functions must be idempotent. If the <code>now</code> were replaced with a function <code>now()</code> the expectation is that the function would behave like a lazy attribute which computes the time once and returns the same value for the duration of the expression.</p>\n\n<pre><code>// now() must return the same value on both invocations.\nuser.expirydate &gt; now() &amp;&amp; user.expirydate &lt; now() - duration('300s')\n</code></pre>\n\n<p>For more detailed examples, I would recommend looking at the conformance tests within the <a href=\"https://github.com/google/cel-spec\" rel=\"nofollow noreferrer\">google/cel-spec</a> repository and at the <a href=\"https://godoc.org/github.com/google/cel-go/cel#example-package\" rel=\"nofollow noreferrer\">godoc examples</a> for the <a href=\"https://github.com/google/cel-go\" rel=\"nofollow noreferrer\">google/cel-go</a> repo.</p>\n"}], "owner": {"reputation": 65, "user_id": 4280566, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-Kn3AqnI5ETE/AAAAAAAAAAI/AAAAAAAABFs/rXkZAzhHPos/photo.jpg?sz=128", "display_name": "Avinash K", "link": "https://stackoverflow.com/users/4280566/avinash-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 429, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1566455094, "creation_date": 1566383952, "question_id": 57589790, "link": "https://stackoverflow.com/questions/57589790/cel-go-how-to-use-custom-objects-and-timestamp-comparisons", "title": "cel-go. how to use custom objects and timestamp comparisons", "body": "<p>I am using Google/cel-go library for conditional evaluation purposes.\nHere's a scenario I'm trying to accomplish.\nI have a struct say user.\nIt has a expirydate field which contains string timestamp.\nI want to compare that against current system timestamp.\nI'm trying to figure out how to do that with cel-go. Could someone help.\nAlso I have a bunch of other fields in my user struct which I would use to construct more expressions. How can I use my struct as input to use user.fieldname notation</p>\n"}, {"tags": ["google-app-engine", "go", "google-app-engine-go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1566385667, "post_id": 57589752, "comment_id": 101637820, "body": "Maybe you have the old or both versions of the SDK? Try removing it and get only the new version."}, {"owner": {"reputation": 345, "user_id": 2501078, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0762aaca094446e39043dec807a16abd?s=128&d=identicon&r=PG", "display_name": "nafmo", "link": "https://stackoverflow.com/users/2501078/nafmo"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1566386881, "post_id": 57589752, "comment_id": 101638501, "body": "Indeed. Seems I had the wrong version installed some of the <code>google-cloud-sdk-*</code> packages. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 345, "user_id": 2501078, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0762aaca094446e39043dec807a16abd?s=128&d=identicon&r=PG", "display_name": "nafmo", "link": "https://stackoverflow.com/users/2501078/nafmo"}, "is_accepted": true, "score": 0, "last_activity_date": 1566386950, "creation_date": 1566386950, "answer_id": 57590630, "question_id": 57589752, "link": "https://stackoverflow.com/questions/57589752/problems-with-app-yaml-api-version-migrating-google-appengine-from-go-1-9-to-go/57590630#57590630", "title": "Problems with app.yaml api_version migrating Google AppEngine from Go 1.9 to Go 1.11", "body": "<p>I had mismatching SDK packages installed:</p>\n\n<pre><code>ii  google-cloud-sdk                    259.0.0-0       all          Utilities for the Google Cloud Platform\nii  google-cloud-sdk-app-engine-go      194.0.0-0       amd64        Go runtime for Google App Engine\n</code></pre>\n\n<p>Upgrading the mismatching packages fixed the issue. Thanks to @icza for the tip!</p>\n"}], "owner": {"reputation": 345, "user_id": 2501078, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0762aaca094446e39043dec807a16abd?s=128&d=identicon&r=PG", "display_name": "nafmo", "link": "https://stackoverflow.com/users/2501078/nafmo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 222, "favorite_count": 0, "accepted_answer_id": 57590630, "answer_count": 1, "score": 0, "last_activity_date": 1566386950, "creation_date": 1566383851, "question_id": 57589752, "link": "https://stackoverflow.com/questions/57589752/problems-with-app-yaml-api-version-migrating-google-appengine-from-go-1-9-to-go", "title": "Problems with app.yaml api_version migrating Google AppEngine from Go 1.9 to Go 1.11", "body": "<p>At <code>$DAYJOB</code> we are using a Go 1.9-based AppEngine application. Now that Google is deprecating version 1.9, I am trying to move to 1.11, using the <a href=\"https://cloud.google.com/appengine/docs/standard/go111/go-differences#migrating-appengine-sdk\" rel=\"nofollow noreferrer\">migration guide</a>. It says that I should set <code>runtime: go111</code> and remove the <code>api_version: go1.9</code> value from <code>app.yaml</code>, but when doing so, I get an error message deploying:</p>\n\n<pre><code>ERROR: (gcloud.app.deploy) Staging command [/usr/lib/google-cloud-sdk/platform/google_appengine/go-app-stager /home/peter/src/licensemanager/src/web/app.yaml /home/peter/src/licensemanager/src/web /home/peter/tmp/tmpBB3Yk8/tmpQQPTFj] failed with return code [1].\n\n------------------------------------ STDOUT ------------------------------------\n------------------------------------ STDERR ------------------------------------\n2019/08/21 07:59:20 invalid api_version value \n--------------------------------------------------------------------------------\n</code></pre>\n\n<p>If I try to add it back, no matter what value I put in it, I get an error message:</p>\n\n<pre><code>\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2557\n\u2560\u2550 Uploading 12 files to Google Cloud Storage               \u2550\u2563\n\u255a\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u255d\nFile upload done.\nERROR: (gcloud.app.deploy) INVALID_ARGUMENT: The following fields are not allowed in app.yaml: api_version.\n</code></pre>\n\n<p>I am a bit at a loss here, what am I doing wrong?</p>\n\n<p>Running locally with <code>dev_appserver.py</code> works fine.</p>\n"}, {"tags": ["database", "go", "testing"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1566391183, "post_id": 57589400, "comment_id": 101640984, "body": "We are using one database per <i>package</i> (not per function). Functions in a package don&#39;t execute in parallel by default and can therefore share a database."}, {"owner": {"reputation": 17, "user_id": 10144687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86473e93198ba5dc37332b2c0f247af0?s=128&d=identicon&r=PG&f=1", "display_name": "Ishan Sharma", "link": "https://stackoverflow.com/users/10144687/ishan-sharma"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1566391903, "post_id": 57589400, "comment_id": 101641448, "body": "@Peter I have a situation where say A is brand and B is product. Product has a brand ID. To refresh product which is linked to brand using foreign key constraint, I need to have that brand first, so need to refresh brand then product in B. So this is where my method fails. Also I want to add parallel testing within package in future."}, {"owner": {"reputation": 1841, "user_id": 1495550, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/56b9da65c0fbf232e45e80a79e9304fa?s=128&d=identicon&r=PG", "display_name": "billdoor", "link": "https://stackoverflow.com/users/1495550/billdoor"}, "edited": false, "score": 0, "creation_date": 1566420805, "post_id": 57589400, "comment_id": 101655325, "body": "have you tried using test containers? you could just start seperate containers for each package"}, {"owner": {"reputation": 2301, "user_id": 3448879, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/y7XPi.png?s=128&g=1", "display_name": "Jairo Lozano", "link": "https://stackoverflow.com/users/3448879/jairo-lozano"}, "edited": false, "score": 0, "creation_date": 1566428999, "post_id": 57589400, "comment_id": 101657537, "body": "What kind of tests are you implementing? unit tests or integration tests?"}, {"owner": {"reputation": 1909, "user_id": 1857083, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/EImkA.jpg?s=128&g=1", "display_name": "steamrolla", "link": "https://stackoverflow.com/users/1857083/steamrolla"}, "edited": false, "score": 0, "creation_date": 1566433171, "post_id": 57589400, "comment_id": 101658314, "body": "For integration tests at work, my team has been using <a href=\"https://godoc.org/github.com/stretchr/testify/suite\" rel=\"nofollow noreferrer\">testify suites</a>. That suite has a <code>SetupAllSuite</code> hook that is called and spins up a postgresql container before any test runs. In our <code>AfterTest</code> hook, we delete data from all tables. And, in our <code>TearDownAll</code> hook, we destroy the docker container.  I will look into open sourcing this mixin for testify suites, or, at least get you some sample code."}, {"owner": {"reputation": 17, "user_id": 10144687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86473e93198ba5dc37332b2c0f247af0?s=128&d=identicon&r=PG&f=1", "display_name": "Ishan Sharma", "link": "https://stackoverflow.com/users/10144687/ishan-sharma"}, "reply_to_user": {"reputation": 2301, "user_id": 3448879, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/y7XPi.png?s=128&g=1", "display_name": "Jairo Lozano", "link": "https://stackoverflow.com/users/3448879/jairo-lozano"}, "edited": false, "score": 0, "creation_date": 1566451370, "post_id": 57589400, "comment_id": 101661438, "body": "@JairoLozano I am doing integration testing. I need to run the tests on the CI/CD as well where it starts failing when multiple packages are there."}, {"owner": {"reputation": 17, "user_id": 10144687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86473e93198ba5dc37332b2c0f247af0?s=128&d=identicon&r=PG&f=1", "display_name": "Ishan Sharma", "link": "https://stackoverflow.com/users/10144687/ishan-sharma"}, "reply_to_user": {"reputation": 1909, "user_id": 1857083, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/EImkA.jpg?s=128&g=1", "display_name": "steamrolla", "link": "https://stackoverflow.com/users/1857083/steamrolla"}, "edited": false, "score": 0, "creation_date": 1566451631, "post_id": 57589400, "comment_id": 101661522, "body": "@steamrolla Thanks for suggesting a method. I will try to implement in my code."}], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 10144687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86473e93198ba5dc37332b2c0f247af0?s=128&d=identicon&r=PG&f=1", "display_name": "Ishan Sharma", "link": "https://stackoverflow.com/users/10144687/ishan-sharma"}, "edited": false, "score": 0, "creation_date": 1566538190, "post_id": 57614907, "comment_id": 101694804, "body": "Thanks for your the suggestion but in my storage layer I want to test the real database interactions, checking if my queries are right and different data can be inserted into the database. I was thinking to use go-sqlmock but it wont remain an integration testing in that case and I would just be testing code part."}], "tags": [], "owner": {"reputation": 2301, "user_id": 3448879, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/y7XPi.png?s=128&g=1", "display_name": "Jairo Lozano", "link": "https://stackoverflow.com/users/3448879/jairo-lozano"}, "is_accepted": false, "score": 0, "last_activity_date": 1566497204, "creation_date": 1566497204, "answer_id": 57614907, "question_id": 57589400, "link": "https://stackoverflow.com/questions/57589400/testing-database-interactions/57614907#57614907", "title": "Testing database interactions", "body": "<p>I don't have much experience in integration testing, I'm not sure if mocking the data base drivers could work for you, but if so, I've been using <a href=\"http://I%20don&#39;t%20have%20much%20experience%20on%20integration%20testing,%20I&#39;m%20not%20sure%20if%20mocking%20the%20data%20base%20drivers%20could%20work%20for%20you,%20but%20if%20so,%20I&#39;ve%20been%20using%20[this](https://github.com/DATA-DOG/go-sqlmock)%20package%20for%20mocking%20sql%20databases%20and%20works%20like%20a%20charm.%20You%20could%20use%20it%20and%20literally%20have%20a%20separated%20database%20mock\" rel=\"nofollow noreferrer\">go-sqlmock</a> package for mocking sql database results in unit tests and works like a charm. You could use it and literally have a separated \"database engine\" for each of your tests. It's a bit time consuming since you have to manually tell the mock what queries to expect and what to return but trust me, it's a good time investment.</p>\n\n<p>As I said before, I'm not sure if using this strategy suits your case, because if you are interested in knowing how your application behaves in a \"real database scenario\", like verifying that registries are actually saved, then mocking the database results is kind of useless.</p>\n"}], "owner": {"reputation": 17, "user_id": 10144687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86473e93198ba5dc37332b2c0f247af0?s=128&d=identicon&r=PG&f=1", "display_name": "Ishan Sharma", "link": "https://stackoverflow.com/users/10144687/ishan-sharma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 340, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1575379891, "creation_date": 1566382660, "last_edit_date": 1575379891, "question_id": 57589400, "link": "https://stackoverflow.com/questions/57589400/testing-database-interactions", "title": "Testing database interactions", "body": "<p>I have an API that has a storage layer. It only does the database interactions and perform the CRUD operations. Now I want to test these functions.\nIn my path API/storage/ , I have different packages having functions to interact with different tables in same database. Tables A, B and C are in same database.</p>\n\n<p>My file hierarchy goes like:</p>\n\n<pre><code>--api\n  --storage\n    --A\n      --A.go\n      --A_test.go\n    --B\n    --C\n  --server\n    --A\n  --testData\n    --A.sql\n    --B.sql\n</code></pre>\n\n<p>In this way I want to test the whole storage layer using command </p>\n\n<pre><code>go test ./...\n</code></pre>\n\n<p>The approach I was following is that I have a function <strong>RefreshTables</strong> which first truncates the table, then fills it with a fixed test data that I have kept in testData folder. For truncating I do : </p>\n\n<pre><code>db.Exec(\"SET FOREIGN_KEY_CHECKS = 0;\")\ndb.Exec(\"truncate \" + table)\ndb.Exec(\"SET FOREIGN_KEY_CHECKS = 1;\")\n</code></pre>\n\n<p>As go test runs test functions of different packages in parallel by default, multiple sql connections get created and <strong>truncate</strong> runs on some other connection while <strong>set foreign key</strong> runs on some other connection randomly from connection pool.</p>\n\n<p>I am not able to pass my tests if run together but all tests pass if run alone or package wise.</p>\n\n<p>If I do : </p>\n\n<pre><code>go test ./... -p 1\n</code></pre>\n\n<p>which makes test functions run one by one, all the tests pass.</p>\n\n<p>I have also tried using a transaction for truncate and locking table before truncate.</p>\n\n<p>I checked this article (<a href=\"https://medium.com/kongkow-it-medan/parallel-database-integration-test-on-go-application-8706b150ee2e\" rel=\"nofollow noreferrer\">https://medium.com/kongkow-it-medan/parallel-database-integration-test-on-go-application-8706b150ee2e</a>), and he suggests making different databases in every test function and dropping that database after function ends. I think this will be very time taking.</p>\n\n<p>It would be really helpful if someone suggest the best method for testing database interactions in Golang.</p>\n"}, {"tags": ["image", "file", "http", "go", "post"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1566385798, "post_id": 57589381, "comment_id": 101637896, "body": "Use <code>multipartWriter.WriteField</code> for <code>name</code> and <code>image_extension</code> and remove the <code>form = url.Values{} ...</code> stuff."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566386211, "post_id": 57589381, "comment_id": 101638125, "body": "Also note that <code>*http.Request.PostForm</code> is ignored by an <code>http.Client</code>, so you should never set PostForm on a client request."}], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 6626924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6314a8d2bbf893ac226060cf9dcb17ea?s=128&d=identicon&r=PG&f=1", "display_name": "apurva thakker", "link": "https://stackoverflow.com/users/6626924/apurva-thakker"}, "is_accepted": true, "score": 0, "last_activity_date": 1566387955, "creation_date": 1566387955, "answer_id": 57590907, "question_id": 57589381, "link": "https://stackoverflow.com/questions/57589381/how-do-i-send-an-http-post-request-with-image-and-with-some-parameters-in-go/57590907#57590907", "title": "How do I send an http post request with image and with some parameters in Go?", "body": "<pre><code>    testProduct := &amp;Product{\n    Name:           \"TestProductName\",\n    ImageExtension: \"png\",\n}\n\npr, pw := io.Pipe()\nform := multipart.NewWriter(pw)\n\ngo func() {\n    defer pw.Close()\n\n    err := form.WriteField(\"name\", testProduct.Name)\n    if err != nil {\n        return\n    }\n\n    err = form.WriteField(\"image_extension\", testProduct.ImageExtension)\n\n    file, err := os.Open(\"a.png\") // path to image file\n    if err != nil {\n        return\n    }\n\n    w, err := form.CreateFormFile(\"image\", \"sampleImageFileName.png\")\n    if err != nil {\n        return\n    }\n\n    _, err = io.Copy(w, file)\n    if err != nil {\n        return\n    }\n\n    form.Close()\n}()\n\nr, err := http.NewRequest(http.MethodPost, \"api/v1/admin/products/\", pr)\nif err != nil {\n    return\n}\nr.Header.Set(\"Content-Type\", form.FormDataContentType())\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 11751936, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nICkqMTK2lc/AAAAAAAAAAI/AAAAAAAAKCY/rYSBXT-2UlY/photo.jpg?sz=128", "display_name": "Sevada Sahakyan", "link": "https://stackoverflow.com/users/11751936/sevada-sahakyan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 57590907, "answer_count": 1, "score": 0, "last_activity_date": 1566387955, "creation_date": 1566382566, "question_id": 57589381, "link": "https://stackoverflow.com/questions/57589381/how-do-i-send-an-http-post-request-with-image-and-with-some-parameters-in-go", "title": "How do I send an http post request with image and with some parameters in Go?", "body": "<p>I am trying to make an http post request with image and parameters in the form-data, but when I am adding image, my parameters are lost.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>testProduct := &amp;Product{\n    Name: \"TestProductName\",\n    ImageExtension: \"png\",\n}\n\nvar b bytes.Buffer\nmultipartWriter := multipart.NewWriter(&amp;b)\nmultipartWriter.CreateFormFile(\"image\", \"../test.png\")\nmultipartWriter.Close()\n\nform = url.Values{}\nform.Add(\"name\", testProduct.Name)\nform.Add(\"image_extension\", testProduct.ImageExtension)\n\nreq, _ := http.NewRequest(http.MethodPost, \"api/v1/admin/products/\", &amp;b)\n\nreq.PostForm = form\nreq.Header.Add(\"Authorization\", \"Bearer \"+loginResponse.Token)\nreq.Header.Set(\"Content-Type\", multipartWriter.FormDataContentType())\n\nrecorder := httptest.NewRecorder()\nrouter.ServeHTTP(recorder, req)\n</code></pre>\n\n<p>But when the request handled the parameters doesn't bind:\n<a href=\"https://i.imgur.com/JmT4qLh.png\" rel=\"nofollow noreferrer\">https://i.imgur.com/JmT4qLh.png</a></p>\n\n<p>This is the product struct:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Product struct {\n    ID             string `form:\"id\" json:\"id\"`\n    Name           string `form:\"name\" json:\"name\"`\n    Price          int64  `form:\"price\" json:\"price\"`\n    ImageExtension string `form:\"image_extension\" json:\"image_extension\"`\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 68, "user_id": 1838539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94a74af69a77a36de933614556eba315?s=128&d=identicon&r=PG", "display_name": "Pavel Tsvetkov", "link": "https://stackoverflow.com/users/1838539/pavel-tsvetkov"}, "is_accepted": true, "score": 0, "last_activity_date": 1566382529, "creation_date": 1566382529, "answer_id": 57589369, "question_id": 57589221, "link": "https://stackoverflow.com/questions/57589221/difference-between-print-and-print-in-go/57589369#57589369", "title": "Difference Between Print and print in Go", "body": "<p>print() is builtin funstion and it is not guaranteed to stay in the language. See builtin.go</p>\n"}], "owner": {"reputation": 3, "user_id": 4560455, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qOoKeOwRdHQ/AAAAAAAAAAI/AAAAAAAAAEY/MyVqD3Ph2eg/photo.jpg?sz=128", "display_name": "Siddhartha Narayana", "link": "https://stackoverflow.com/users/4560455/siddhartha-narayana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "closed_date": 1566382392, "accepted_answer_id": 57589369, "answer_count": 1, "score": -3, "last_activity_date": 1566382529, "creation_date": 1566382059, "question_id": 57589221, "link": "https://stackoverflow.com/questions/57589221/difference-between-print-and-print-in-go", "closed_reason": "Duplicate", "title": "Difference Between Print and print in Go", "body": "<p>What will be the difference between the fmt.Print(\"print something\") and just print(\"print something\") in Go lang.  </p>\n\n<pre><code>var a int\nfmt.Print(\"In Print \", &amp;a, \"\\n \")\nprint(\"In print \", &amp;a, \"\\n\")\n</code></pre>\n\n<p>Both provide the same result. </p>\n\n<p>Result : </p>\n\n<pre><code>In Print 0xcSameAddressLocation\nIn print 0xcSameAddressLocation \n</code></pre>\n\n<p>However when I do this :</p>\n\n<pre><code>ar := []int{1, 2, 3, 4, 5, 6, 7, 8}\nprint(\"In print \", &amp;ar, \"\\n\")\nprint(\"In print \", ar[0], \"\\n\")\nprint(\"In print \", ar, \"\\n\")\nfmt.Print(\"In fmt.Print \", &amp;ar, \"\\n\")\nfmt.Print(\"In fmt.Print \", &amp;ar[0], \"\\n\")\nfmt.Print(\"In fmt.Print \", ar[0], \"\\n\")\nfmt.Print(\"In fmt.Print \", ar, \"\\n\")\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>In print 0xcAddressLocation1\nIn print 1\nIn print [8/8]0xcAddressLocation2\nIn fmt.Print &amp;[1 2 3 4 5 6 7 8]\nIn fmt.Print 0xcAddressLocation2\nIn fmt.Print 1\nIn fmt.Print [1 2 3 4 5 6 7 8]\n</code></pre>\n\n<p>Can someone please how this works and what \"print()\" and \"fmt.Print()\" do in Go Language respectively.</p>\n"}, {"tags": ["mongodb", "go"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 11907123, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-HlmzvFMDKsU/AAAAAAAAAAI/AAAAAAAACiE/lQpIvaTYjO0/photo.jpg?sz=128", "display_name": "Hoang Vo", "link": "https://stackoverflow.com/users/11907123/hoang-vo"}, "edited": false, "score": 0, "creation_date": 1566425109, "post_id": 57591505, "comment_id": 101656601, "body": "Thank you @apurva. I must admit that I&#39;m still having struggle with golang&#39;s dependency injection. Do you have any good document/material/tutorial... that easy to understand this topic. I&#39;ve spent several days tried to fix this error without any hope until your reply."}, {"owner": {"reputation": 101, "user_id": 6626924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6314a8d2bbf893ac226060cf9dcb17ea?s=128&d=identicon&r=PG&f=1", "display_name": "apurva thakker", "link": "https://stackoverflow.com/users/6626924/apurva-thakker"}, "reply_to_user": {"reputation": 1, "user_id": 11907123, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-HlmzvFMDKsU/AAAAAAAAAAI/AAAAAAAACiE/lQpIvaTYjO0/photo.jpg?sz=128", "display_name": "Hoang Vo", "link": "https://stackoverflow.com/users/11907123/hoang-vo"}, "edited": false, "score": 0, "creation_date": 1566452573, "post_id": 57591505, "comment_id": 101661778, "body": "Please check this out : <a href=\"https://medium.com/full-stack-tips/dependency-injection-in-go-99b09e2cc480\" rel=\"nofollow noreferrer\">medium.com/full-stack-tips/&hellip;</a>"}], "tags": [], "owner": {"reputation": 101, "user_id": 6626924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6314a8d2bbf893ac226060cf9dcb17ea?s=128&d=identicon&r=PG&f=1", "display_name": "apurva thakker", "link": "https://stackoverflow.com/users/6626924/apurva-thakker"}, "is_accepted": false, "score": 1, "last_activity_date": 1566389993, "creation_date": 1566389993, "answer_id": 57591505, "question_id": 57589048, "link": "https://stackoverflow.com/questions/57589048/local-server-return-http-panic-serving-152781-runtime-error-invalid-mem/57591505#57591505", "title": "local server return &quot;http: panic serving [::1]:52781: runtime error: invalid memory address or nil pointer dereference&quot; when I tried to call API", "body": "<p>You are facing this problem because the <em>client</em> variable in the <em>middleware.go file is nil</em>.</p>\n\n<p>client is a dependency here. It has to be injected from <em>main</em> package to <em>middleware</em> package.</p>\n\n<p>Fix:- </p>\n\n<p>middleware.go</p>\n\n<pre><code>type endpoints struct {\n    client *mongo.Client\n}\n\nfunc NewEndpoints(client *mongo.Client) *endpoints {\n    return &amp;endpoints{\n        client: client,\n    }\n}\n\nfunc (e *endpoints) CreatePersonEndpoint(response http.ResponseWriter, request *http.Request) {\n    response.Header().Set(\"content-type\", \"application/json\")\n    var person models.Person\n    _ = json.NewDecoder(request.Body).Decode(&amp;person)\n    collection := e.client.Database(\"thepolyglotdeveloper\").Collection(\"people\")\n    ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)\n    defer cancel()\n    result, _ := collection.InsertOne(ctx, person)\n    json.NewEncoder(response).Encode(result)\n}\nfunc (e *endpoints) GetPeopleEndpoint(response http.ResponseWriter, request *http.Request) {\n    response.Header().Set(\"content-type\", \"application/json\")\n    var people []models.Person\n    collection := e.client.Database(\"thepolyglotdeveloper\").Collection(\"people\")\n    ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)\n    defer cancel()\n    cursor, err := collection.Find(ctx, bson.M{})\n    if err != nil {\n        response.WriteHeader(http.StatusInternalServerError)\n        response.Write([]byte(`{ \"message\": \"` + err.Error() + `\" }`))\n        return\n    }\n    defer cursor.Close(ctx)\n    for cursor.Next(ctx) {\n        var person models.Person\n        cursor.Decode(&amp;person)\n        people = append(people, person)\n    }\n    if err := cursor.Err(); err != nil {\n        response.WriteHeader(http.StatusInternalServerError)\n        response.Write([]byte(`{ \"message\": \"` + err.Error() + `\" }`))\n        return\n    }\n    json.NewEncoder(response).Encode(people)\n}\nfunc (e *endpoints) GetPersonEndpoint(response http.ResponseWriter, request *http.Request) {\n    response.Header().Set(\"content-type\", \"application/json\")\n    params := mux.Vars(request)\n    id, _ := primitive.ObjectIDFromHex(params[\"id\"])\n    var person models.Person\n    collection := e.client.Database(\"thepolyglotdeveloper\").Collection(\"people\")\n    ctx, cancel := context.WithTimeout(context.Background(), 30*time.Second)\n    defer cancel()\n    err := collection.FindOne(ctx, models.Person{ID: id}).Decode(&amp;person)\n    if err != nil {\n        response.WriteHeader(http.StatusInternalServerError)\n        response.Write([]byte(`{ \"message\": \"` + err.Error() + `\" }`))\n        return\n    }\n    json.NewEncoder(response).Encode(person)\n}\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>func main() {\n    fmt.Println(\"Starting the application...\")\n    ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)\n    defer cancel()\n    clientOptions := options.Client().ApplyURI(\"mongodb://localhost:27017\")\n    client, _ = mongo.Connect(ctx, clientOptions)\n\n    endpoints := middleware.NewEndpoints(client) // injecting the dependency\n    router := mux.NewRouter()\n    router.HandleFunc(\"/person\", endpoints.CreatePersonEndpoint).Methods(\"POST\")\n    router.HandleFunc(\"/people\", endpoints.GetPeopleEndpoint).Methods(\"GET\")\n    router.HandleFunc(\"/person/{id}\", endpoints.GetPersonEndpoint).Methods(\"GET\")\n    http.ListenAndServe(\":12345\", router)\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11907123, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-HlmzvFMDKsU/AAAAAAAAAAI/AAAAAAAACiE/lQpIvaTYjO0/photo.jpg?sz=128", "display_name": "Hoang Vo", "link": "https://stackoverflow.com/users/11907123/hoang-vo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 582, "favorite_count": 0, "closed_date": 1566396462, "answer_count": 1, "score": -1, "last_activity_date": 1566389993, "creation_date": 1566381483, "question_id": 57589048, "link": "https://stackoverflow.com/questions/57589048/local-server-return-http-panic-serving-152781-runtime-error-invalid-mem", "closed_reason": "Not suitable for this site", "title": "local server return &quot;http: panic serving [::1]:52781: runtime error: invalid memory address or nil pointer dereference&quot; when I tried to call API", "body": "<p>I followed the guide to write the mongodb API here:\n<a href=\"https://www.thepolyglotdeveloper.com/2019/02/developing-restful-api-golang-mongodb-nosql-database/\" rel=\"nofollow noreferrer\">https://www.thepolyglotdeveloper.com/2019/02/developing-restful-api-golang-mongodb-nosql-database/</a></p>\n\n<p>The guide's code run perfectly. But when I tried to split the code into small packages to add more cases and easier to read, the server always return as the title. Below is the code, I just split the guide's code into small packages not add anything new or remove anything. What did I do wrong or what am I missing?\n<a href=\"https://github.com/imperiustx/mongo_golang\" rel=\"nofollow noreferrer\">https://github.com/imperiustx/mongo_golang</a></p>\n"}, {"tags": ["go", "amazon-cognito"], "answers": [{"tags": [], "owner": {"reputation": 5139, "user_id": 4887491, "user_type": "registered", "profile_image": "https://graph.facebook.com/10202753002026348/picture?type=large", "display_name": "acesmndr", "link": "https://stackoverflow.com/users/4887491/acesmndr"}, "is_accepted": true, "score": 1, "last_activity_date": 1566449840, "creation_date": 1566449840, "answer_id": 57602288, "question_id": 57588197, "link": "https://stackoverflow.com/questions/57588197/cognito-throws-errcodenotauthorizedexception-when-user-is-already-confirmed/57602288#57602288", "title": "Cognito throws ErrCodeNotAuthorizedException when user is already confirmed", "body": "<p>Since the code is the same for the unauthorized case and user already confirmed case, the only possible way to differentiate the cases is to match the <code>awsErr.Message()</code> which provides the clear description of the error.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>if awsErr, ok := err.(awserr.Error); ok {\n    switch awsErr.Code() {\n      case cognitoidentityprovider.ErrCodeNotAuthorizedException:\n        if awsErr.Message() == \"User cannot be confirm. Current status is CONFIRMED\" {\n            log.Println(\"Handle user already confirmed\")\n        } else {\n            log.Println(\"Handle not authorized case\")\n        }\n      ...\n      default:          \n    }\n}\n\n</code></pre>\n"}], "owner": {"reputation": 5139, "user_id": 4887491, "user_type": "registered", "profile_image": "https://graph.facebook.com/10202753002026348/picture?type=large", "display_name": "acesmndr", "link": "https://stackoverflow.com/users/4887491/acesmndr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 0, "accepted_answer_id": 57602288, "answer_count": 1, "score": 1, "last_activity_date": 1566449840, "creation_date": 1566378595, "last_edit_date": 1566378938, "question_id": 57588197, "link": "https://stackoverflow.com/questions/57588197/cognito-throws-errcodenotauthorizedexception-when-user-is-already-confirmed", "title": "Cognito throws ErrCodeNotAuthorizedException when user is already confirmed", "body": "<p>Why does cognito throw <code>ErrCodeNotAuthorizedException \"NotAuthorizedException\"</code> when the status of the user is already confirmed when making a request to cognito to confirm the user.\nThe documentation specifies that <code>ErrCodeNotAuthorizedException</code> is thrown when a user is not authorized.</p>\n\n<p><a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/cognitoidentityprovider/#CognitoIdentityProvider.ConfirmSignUp\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/service/cognitoidentityprovider/#CognitoIdentityProvider.ConfirmSignUp</a></p>\n\n<p>How should we handle this case? As it would be unclear if we made a request with invalid <code>client secret</code> as it would throw the same error.</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1566377721, "post_id": 57587823, "comment_id": 101633260, "body": "Some things are not suitable for unit testing. If you work in an environment where files system errors need to be unit tested: Ask someone in your environment how your testsuite injects e.g. disk full errors."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1566399455, "post_id": 57587823, "comment_id": 101646134, "body": "The posted code does not compile.  See <a href=\"https://play.golang.org/p/BSumX2EKASJ\" rel=\"nofollow noreferrer\">play.golang.org/p/BSumX2EKASJ</a>."}], "answers": [{"tags": [], "owner": {"reputation": 36, "user_id": 10653205, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/biZZx.jpg?s=128&g=1", "display_name": "Adrien", "link": "https://stackoverflow.com/users/10653205/adrien"}, "is_accepted": false, "score": 0, "last_activity_date": 1566379319, "creation_date": 1566379319, "answer_id": 57588406, "question_id": 57587823, "link": "https://stackoverflow.com/questions/57587823/how-to-test-file-open-with-os-o-rdwr-and-os-o-create-flags/57588406#57588406", "title": "How to test file.Open with os.O_RDWR and os.O_CREATE flags?", "body": "<p>Mocking in Go means having interfaces, if that's something you really need you might consider using something like <a href=\"https://github.com/spf13/afero\" rel=\"nofollow noreferrer\">https://github.com/spf13/afero</a> instead of using the os package directly. This also allows you to use in-memory filesystems and other things that make testing easier.</p>\n"}, {"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 0, "last_activity_date": 1566380416, "creation_date": 1566380416, "answer_id": 57588738, "question_id": 57587823, "link": "https://stackoverflow.com/questions/57587823/how-to-test-file-open-with-os-o-rdwr-and-os-o-create-flags/57588738#57588738", "title": "How to test file.Open with os.O_RDWR and os.O_CREATE flags?", "body": "<p>There are two things to consider.</p>\n\n<p>The first is that <code>O_RDWR|O_CREAT|O_APPEND</code> is almost nothing interesting when it comes to opening a file: it tells the OS that it should open the file for reading and writing, in append mode, and that if the file does not exist at the time of a call it should be created, and otherwise it's fine to append to it.</p>\n\n<p>Now the only two reasons I may fathom this operation might fail are:</p>\n\n<ul>\n<li>The filesystem to contain the file is mounted read/only \u2014 and hence opening the file for writing, creating it and appending to it are impossible.</li>\n<li>The file does not exist and the filesystem has its inode table full \u2014 and hence it's impossible to create a record for another file even if there is space for the file's data.</li>\n</ul>\n\n<p>Now consider that in order to simulate one of such cases you need to manipulate some filesystem available to the process running your test. While it certainly possible to do within a unit-testing framework, it looks like belonging more to the domain of integration testing.</p>\n\n<p>There are plenty of options to work towards this level of testing on Linux: <a href=\"https://unix.stackexchange.com/a/144200/43156\">\"flakey\" device-mapper target and friends</a>, mounting a read-only image via loop device or FUSE, injecting faults into the running kernel etc. Still, these are mostly unsuitable for unit-testing.</p>\n\n<p>If you want unit-test this stuff, there, again, are two approaches:</p>\n\n<ul>\n<li><p>Abstract away the whole filesystem layer using something like <a href=\"https://github.com/spf13/afero\" rel=\"nofollow noreferrer\">https://github.com/spf13/afero</a> as @Adrien suggested.</p>\n\n<p>The upside is that you can easily test almost everything filesystem-related in your code.</p></li>\n<li><p>Abstract away just a little bit of code using a variable.</p>\n\n<p>Say, you might have</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var whateverCreate = os.Create\n</code></pre>\n\n<p>use that <code>whateverCreate</code> in your code and then override just that variable in the setup code of your test suite to assign it a function which returns whatever error you need in specific test(s).</p></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 66, "user_id": 2409978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/516f4610184f62a860ad5d9c2dc337cd?s=128&d=identicon&r=PG", "display_name": "hullarb", "link": "https://stackoverflow.com/users/2409978/hullarb"}, "is_accepted": false, "score": 0, "last_activity_date": 1566389855, "last_edit_date": 1566389855, "creation_date": 1566380933, "answer_id": 57588883, "question_id": 57587823, "link": "https://stackoverflow.com/questions/57587823/how-to-test-file-open-with-os-o-rdwr-and-os-o-create-flags/57588883#57588883", "title": "How to test file.Open with os.O_RDWR and os.O_CREATE flags?", "body": "<p>You could make the the filename/file path configurable instead of using the hard coded info.log, then in your test you could use some non existing path for example.</p>\n\n<p>There are multiple options for configuring it:</p>\n\n<ul>\n<li><p>parameter in the constructor (maybe a separate constructor that could be called from New if you wanna keep the API as it is)</p></li>\n<li><p>package level configuration (like a global variable defaultLogFileName), this is less flexible (for example if you wanna run tests parallel), but might suit in this case as well</p></li>\n</ul>\n"}], "owner": {"reputation": 9, "user_id": 11955916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7014f338dcb6e1f3ff38b8cdaa249b3f?s=128&d=identicon&r=PG&f=1", "display_name": "equse", "link": "https://stackoverflow.com/users/11955916/equse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 370, "favorite_count": 0, "answer_count": 3, "score": -1, "last_activity_date": 1566389855, "creation_date": 1566377377, "question_id": 57587823, "link": "https://stackoverflow.com/questions/57587823/how-to-test-file-open-with-os-o-rdwr-and-os-o-create-flags", "title": "How to test file.Open with os.O_RDWR and os.O_CREATE flags?", "body": "<p>I'm trying to write unit test for struct constructor, which may return also nil if error happens during file.Open. I don't have idea how to test/mock file error with flags: os.O_RDWR|os.O_CREATE|os.O_APPEND</p>\n\n<p>I tried to check nil value inside test, but it failed.</p>\n\n<p>Constructor:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type App struct {\n    someField string\n    log *log.Logger\n}\n\nfunc New() *App {\n    app := &amp;App{}\n    f, err := os.OpenFile(\"info.log\", os.O_RDWR|os.O_CREATE|os.O_APPEND, 0666)\n    if err != nil {\n        fmt.Printf(\"error opening file: %v\", err)\n        return nil\n    }\n    mw := io.MultiWriter(os.Stdout, f)\n    l = log.New(mw, \"APP\", log.Ldate|log.LstdFlags|log.Lshortfile)\n    app.log = l\n\n    return app\n}\n</code></pre>\n\n<p>And test for constructor:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestNew(t *testing.T) {\n    var a App\n    a = New()\n\n    // doesn't cover\n    if a == nil {\n        t.Fatal(\"Error opening file\")\n    }\n}\n</code></pre>\n\n<p>I expect to have covered error != nil, which in coverage is red:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>f, err := os.OpenFile(\"info.log\", os.O_RDWR|os.O_CREATE|os.O_APPEND, 0666)\nif err != nil {\n  fmt.Printf(\"error opening file: %v\", err)\n  return nil\n}\n</code></pre>\n"}, {"tags": ["mysql", "database", "go"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 8366220, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_p1NtyMFXk0/AAAAAAAAAAI/AAAAAAAAAAs/6INulcKgpLA/photo.jpg?sz=128", "display_name": "SAM Temp", "link": "https://stackoverflow.com/users/8366220/sam-temp"}, "edited": false, "score": 0, "creation_date": 1566377449, "post_id": 57587754, "comment_id": 101633112, "body": "Thank you @Nick, it worked, I did not notice the format !!"}, {"owner": {"reputation": 117184, "user_id": 9473764, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aGMXl.jpg?s=128&g=1", "display_name": "Nick", "link": "https://stackoverflow.com/users/9473764/nick"}, "reply_to_user": {"reputation": 3, "user_id": 8366220, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_p1NtyMFXk0/AAAAAAAAAAI/AAAAAAAAAAs/6INulcKgpLA/photo.jpg?sz=128", "display_name": "SAM Temp", "link": "https://stackoverflow.com/users/8366220/sam-temp"}, "edited": false, "score": 0, "creation_date": 1566377679, "post_id": 57587754, "comment_id": 101633240, "body": "@SAMTemp no worries. I&#39;m glad I could help."}], "tags": [], "owner": {"reputation": 117184, "user_id": 9473764, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aGMXl.jpg?s=128&g=1", "display_name": "Nick", "link": "https://stackoverflow.com/users/9473764/nick"}, "is_accepted": true, "score": 4, "last_activity_date": 1566377164, "creation_date": 1566377164, "answer_id": 57587754, "question_id": 57587670, "link": "https://stackoverflow.com/questions/57587670/how-to-convert-go-time-time-into-mysql-datetime/57587754#57587754", "title": "How to convert Go time.Time into MySQL datetime?", "body": "<p>Your date format string is not compatible with MySQL. It should be</p>\n\n<pre><code>golangDateTime := time.Now().Format(\"2006-01-02 15:04:05\") \n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 8366220, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_p1NtyMFXk0/AAAAAAAAAAI/AAAAAAAAAAs/6INulcKgpLA/photo.jpg?sz=128", "display_name": "SAM Temp", "link": "https://stackoverflow.com/users/8366220/sam-temp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "closed_date": 1566405071, "accepted_answer_id": 57587754, "answer_count": 1, "score": 0, "last_activity_date": 1566455439, "creation_date": 1566376882, "last_edit_date": 1566455439, "question_id": 57587670, "link": "https://stackoverflow.com/questions/57587670/how-to-convert-go-time-time-into-mysql-datetime", "closed_reason": "Not suitable for this site", "title": "How to convert Go time.Time into MySQL datetime?", "body": "<p>I am generating a datetime string in Go and when I insert the generated value into a MySQL table, the value of the column becomes: 0000-00-00 00:00:00 but it is supposed to be: 2019-08-21 11:05:45.</p>\n\n<p>I do not understand why the datetime becomes zero, I guess there is some mismatch. </p>\n\n<pre><code>goDateTime := time.Now().Format(\"02-01-2006 03:04:05\") \n</code></pre>\n\n<p>The above code returns datetime as a string. But in my database table the column type is <code>datetime</code>. I changed the database type to <code>varchar</code> and it worked, but I want to use the <code>datetime</code> time.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 5, "creation_date": 1566377858, "post_id": 57587649, "comment_id": 101633344, "body": "Only exported elements of a package can be accessed after import. Your <code>controller</code> is not exported. Nevertheless: You should <b>NEVER</b> use local imports. Please read and stick to &quot;How to Write Go Code&quot;."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1566396533, "post_id": 57587649, "comment_id": 101644605, "body": "This is what @Volker is referring to: <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a>"}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1566396616, "post_id": 57589239, "comment_id": 101644656, "body": "Your first example code is invalid, all of that code is illegal outside of a function body."}, {"owner": {"reputation": 68, "user_id": 1838539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94a74af69a77a36de933614556eba315?s=128&d=identicon&r=PG", "display_name": "Pavel Tsvetkov", "link": "https://stackoverflow.com/users/1838539/pavel-tsvetkov"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1566453328, "post_id": 57589239, "comment_id": 101662025, "body": "This code is just based on your example(there is a lot of typis and invalid using) . O dont think that you use it in real project. It looks like logic proto with error. You should add it to main function."}], "tags": [], "owner": {"reputation": 68, "user_id": 1838539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94a74af69a77a36de933614556eba315?s=128&d=identicon&r=PG", "display_name": "Pavel Tsvetkov", "link": "https://stackoverflow.com/users/1838539/pavel-tsvetkov"}, "is_accepted": false, "score": -1, "last_activity_date": 1566382099, "creation_date": 1566382099, "answer_id": 57589239, "question_id": 57587649, "link": "https://stackoverflow.com/questions/57587649/how-to-import-local-package-to-package-main/57589239#57589239", "title": "How to import local package to package main", "body": "<p>If you want to use the function outside the package You have to rename object. first letter should be capitalized and your code should be next</p>\n\n<pre><code>package main\n\nimport (\n\n\"./contoroller\"\n)\n\napi := router.Group(\"/api\")\n{\n    api.GET(\"/articles\", func(c *gin.Context) {\n        controller.GetArticleController(c, db)\n    })\n}\n\nrouter.Run(\":2345\")\n</code></pre>\n\n<p>}</p>\n\n<p>controller</p>\n\n<pre><code>package controller\n\nimport (\n)\n\nfunc GetArticleController(c *gin.Context, db *sql.DB) {\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 193, "user_id": 11766408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec295cea34bc4a92fe14a67082d53407?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc", "link": "https://stackoverflow.com/users/11766408/jpskgc"}, "is_accepted": false, "score": 0, "last_activity_date": 1566453388, "creation_date": 1566453388, "answer_id": 57602817, "question_id": 57587649, "link": "https://stackoverflow.com/questions/57587649/how-to-import-local-package-to-package-main/57602817#57602817", "title": "How to import local package to package main", "body": "<p>I resolve this issue by copying <code>article</code> to <code>$GOPATH/src/github.com/[user]/</code></p>\n"}], "owner": {"reputation": 193, "user_id": 11766408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec295cea34bc4a92fe14a67082d53407?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc", "link": "https://stackoverflow.com/users/11766408/jpskgc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "answer_count": 2, "score": -5, "last_activity_date": 1566453388, "creation_date": 1566376820, "question_id": 57587649, "link": "https://stackoverflow.com/questions/57587649/how-to-import-local-package-to-package-main", "title": "How to import local package to package main", "body": "<p>I try to refactor main.go and divide codes to different files.<br>\nSo I made controller.go as package controller.<br>\nBut I can't import this local package to main.go.<br></p>\n\n<pre><code>article\n  \u251c client\n  \u251c api\n  \u2502  \u251c main.go\n  \u2502  \u2514 contoroller\n  \u2502       \u2514 contoroller.go\n  \u251c nginx\n  \u2514 docker-compose.yml\n</code></pre>\n\n<pre><code>\u30fbclient: react/axios\n\u30fbapi: golang/gin\n\u30fbweb-server: nginx\n\u30fbdb: mysql\n\u30fbcontainer: docker\n\u30fbci-tool: travis\n\u30fbdeploy: aws elastic beanstalk\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n\n\"./contoroller\"\n)\n\n    controller := controller.controller{}\n\n    api := router.Group(\"/api\")\n    {\n        api.GET(\"/articles\", func(c *gin.Context) {\n            controller.getArticleController(c, db)\n        })\n    }\n\n    router.Run(\":2345\")\n}\n</code></pre>\n\n<p>controller.go</p>\n\n<pre><code>package controller\n\nimport (\n)\n\nfunc getArticleController(c *gin.Context, db *sql.DB) {\n}\n</code></pre>\n\n<p>I expect package controller to be imported.<br>\nBut the actual is not.<br></p>\n\n<pre><code>undefined: controller\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "is_accepted": true, "score": 0, "last_activity_date": 1569888429, "creation_date": 1569888429, "answer_id": 58176595, "question_id": 57587621, "link": "https://stackoverflow.com/questions/57587621/gorm-how-to-use-slice-as-query-destination/58176595#58176595", "title": "gorm: How to use slice as query destination", "body": "<p>Pass in a pointer to a slice of your item kind</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var username []TestName{} // or whatever you called it\ndb.Table(\"test_name\").Select(\"username\").Find(&amp;username)\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 7445170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ffb90ff498dbd45982c9730fd261823?s=128&d=identicon&r=PG&f=1", "display_name": "\u80e1\u5fd7\u4f1f", "link": "https://stackoverflow.com/users/7445170/%e8%83%a1%e5%bf%97%e4%bc%9f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 272, "favorite_count": 0, "accepted_answer_id": 58176595, "answer_count": 1, "score": 1, "last_activity_date": 1569974535, "creation_date": 1566376749, "last_edit_date": 1569974535, "question_id": 57587621, "link": "https://stackoverflow.com/questions/57587621/gorm-how-to-use-slice-as-query-destination", "title": "gorm: How to use slice as query destination", "body": "<p>How to use slice as query destination.Here is the code I tried</p>\n\n<pre><code>var username []interface{}\ndb.Table(\"test_name\").Select(\"username\").Find(&amp;username)\nfmt.Println(username)\n</code></pre>\n\n<p>output <code>[&lt;nil&gt; &lt;nil&gt; &lt;nil&gt; &lt;nil&gt;]</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 664, "user_id": 8351493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f51ee7d1ce3d03323a059cb2f53f01d?s=128&d=identicon&r=PG&f=1", "display_name": "Barkha", "link": "https://stackoverflow.com/users/8351493/barkha"}, "edited": false, "score": 1, "creation_date": 1566376440, "post_id": 57587318, "comment_id": 101632607, "body": "I think you should use ParseFloat intead of checking for dots"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1566377461, "post_id": 57587318, "comment_id": 101633119, "body": "strings.Count counts occurrences in a string, but you definitively should use strconv.ParseFloat."}], "answers": [{"tags": [], "owner": {"reputation": 664, "user_id": 8351493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f51ee7d1ce3d03323a059cb2f53f01d?s=128&d=identicon&r=PG&f=1", "display_name": "Barkha", "link": "https://stackoverflow.com/users/8351493/barkha"}, "is_accepted": true, "score": 1, "last_activity_date": 1566376515, "creation_date": 1566376515, "answer_id": 57587555, "question_id": 57587318, "link": "https://stackoverflow.com/questions/57587318/check-the-number-of-dots-present-in-string-using-golang/57587555#57587555", "title": "Check the number of dots present in string using golang", "body": "<p>If you are just checking for number use this instead of dot check </p>\n\n<pre><code> i, err := strconv.ParseFloat(elem, 64)\n    if err != nil {\n        numbers = append(numbers, i)\n    }\n\n</code></pre>\n"}], "owner": {"reputation": 147, "user_id": 7060199, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/51b4e0f1117b2ae94e68239aaad68097?s=128&d=identicon&r=PG&f=1", "display_name": "Nagaraj M", "link": "https://stackoverflow.com/users/7060199/nagaraj-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 57587555, "answer_count": 1, "score": -4, "last_activity_date": 1566377582, "creation_date": 1566375640, "last_edit_date": 1566377129, "question_id": 57587318, "link": "https://stackoverflow.com/questions/57587318/check-the-number-of-dots-present-in-string-using-golang", "title": "Check the number of dots present in string using golang", "body": "<p>I have <code>cmd prompt</code>,In which <code>stdin</code> accept only string, but once i receive  the string need to <code>convert to float</code>. when someone mistakenly enter <code>\"0..1\" instead of 0.1,</code> I need check it and show error info.</p>\n\n<pre><code>    msg := \"enter the rate eg:{0.1}\"\n            rate, err := RatePrompt(msg)\n            if err != nil {\n                fmt.Println(\"something went while entering rate, please re-enter\")\n            }\n\n   func RatePrompt(cmrmsg string) (price string, err error) {\n      fmt.Println(\" \")\n      scanner := bufio.NewScanner(os.Stdin)\n      scanner.Scan()\n       price := scanner.Text()\n       return price, nil\n            } \n\n    //check for string contains multiple dot\n\n    rate, err := RatePrompt(msg)\n              if err != nil {\n            fmt.Println(\"something went while entering \n            rate, please re-enter\")else{\n                 ///check for string contains multiple dot\n         }\n   }\n</code></pre>\n\n<p>checking for multiple dot in string value, if multiple dot present throw error</p>\n"}, {"tags": ["go", "import"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 1, "creation_date": 1566375131, "post_id": 57587137, "comment_id": 101631978, "body": "What does <code>but it fails</code> mean? What does the compiler say?`"}, {"owner": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "edited": false, "score": 0, "creation_date": 1566375984, "post_id": 57587137, "comment_id": 101632370, "body": "The compiler says cannot resolve &quot;projects&quot; which is in the src folder  ~/go/src/projects/pkgs2$ pwd /home/peter/go/src/projects/pkgs2"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566376572, "post_id": 57587137, "comment_id": 101632662, "body": "FYI: (1) <code>x</code> is unexported so you won&#39;t be able to call it even if your import worked. (2) The call <code>x()</code> is unqualified, to reference an imported identifier you have to qualify it by prepending the package name, just like you&#39;re doing with <code>fmt.Println</code> by prepending the package name <code>fmt</code> to the identifier <code>Println</code>. So <i>export</i> your identifiers and then <i>qualify</i> them if you use them."}, {"owner": {"reputation": 664, "user_id": 8351493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f51ee7d1ce3d03323a059cb2f53f01d?s=128&d=identicon&r=PG&f=1", "display_name": "Barkha", "link": "https://stackoverflow.com/users/8351493/barkha"}, "edited": false, "score": 0, "creation_date": 1566376584, "post_id": 57587137, "comment_id": 101632672, "body": "have you tried giving the complete path from home?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 664, "user_id": 8351493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f51ee7d1ce3d03323a059cb2f53f01d?s=128&d=identicon&r=PG&f=1", "display_name": "Barkha", "link": "https://stackoverflow.com/users/8351493/barkha"}, "edited": false, "score": 1, "creation_date": 1566405987, "post_id": 57587137, "comment_id": 101649376, "body": "@user8351493 that&#39;s not how Go&#39;s <code>import</code> statements work."}], "answers": [{"comments": [{"owner": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "edited": false, "score": 0, "creation_date": 1566378334, "post_id": 57587925, "comment_id": 101633619, "body": "The code is modified for export of X(), see above. I also tried the absolute path which was not allowed. The error remains: &quot;Cannot resolve directory projects&quot;."}, {"owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "reply_to_user": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "edited": false, "score": 2, "creation_date": 1566378489, "post_id": 57587925, "comment_id": 101633714, "body": "How are you compiling/running this? Are you using an IDE? Some IDE&#39;s run in a shell with independent environment variables.  What if you cd into you pkgs1 folder and type <code>GOPATH=&#47;home&#47;peter&#47;go&#47; go run main.go</code>?"}, {"owner": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "edited": false, "score": 0, "creation_date": 1566379728, "post_id": 57587925, "comment_id": 101634462, "body": "Thank you for pointing that out. I use Jetbrains Goland.  After I cd into pkgs1 folder and type GOPATH=/home/peter/go/ go run main.go it works as expected."}, {"owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "reply_to_user": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "edited": false, "score": 0, "creation_date": 1566379872, "post_id": 57587925, "comment_id": 101634560, "body": "In goland you need to set the GOPATH in preferences-&gt;go. You can set the GOROOT too, although that\u2019s optional."}], "tags": [], "owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "is_accepted": false, "score": 2, "last_activity_date": 1566377705, "creation_date": 1566377705, "answer_id": 57587925, "question_id": 57587137, "link": "https://stackoverflow.com/questions/57587137/golang-local-import/57587925#57587925", "title": "Golang local import", "body": "<p>Your import path is correct and should resolve successfully, but as written, your program won't compile because the import isn't being used and there is no local function named <code>x</code>.</p>\n\n<p>As mentioned by mkopriva your <code>x</code> function in pkgs2 isn't exported and you have not qualified it when trying to use it in your main package.</p>\n\n<p>To export a function, it needs to start with a capital letter.</p>\n\n<p>To use the function in another package, you need to prefix the package name to the function name.</p>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"projects/pkgs2\"\n)\n\nfunc main(){\n    fmt.Println(\"123\")\n    pkgs2.X()\n}\n</code></pre>\n\n<p>stuff.go</p>\n\n<pre><code>package pkgs2\n\nimport \"fmt\"\n\nfunc X(){\n    fmt.Println(\"X\")\n}\n</code></pre>\n"}], "owner": {"reputation": 990, "user_id": 207425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/1dXtN.png?s=128&g=1", "display_name": "pigfox", "link": "https://stackoverflow.com/users/207425/pigfox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1566379279, "creation_date": 1566374913, "last_edit_date": 1566378014, "question_id": 57587137, "link": "https://stackoverflow.com/questions/57587137/golang-local-import", "title": "Golang local import", "body": "<p>I am attempting to do a local import but it fails.</p>\n\n<p>My environment is:</p>\n\n<p><code>echo $GOPATH\n/home/peter/go\necho $GOROOT\n/usr/local/go</code></p>\n\n<p>The entry point is: </p>\n\n<p>/home/peter/go/src/projects/pkgs1/main.go</p>\n\n<p>The imported file is:</p>\n\n<p>/home/peter/go/src/projects/pkgs2/stuff.go</p>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"projects/pkgs2\"  // &lt;- this does not resolve\n)\n\nfunc main(){\n    fmt.Println(\"123\")\n    pkgs2.X()\n}\n</code></pre>\n\n<p>stuff.go</p>\n\n<pre><code>package pkgs2\n\nimport \"fmt\"\n\nfunc X(){\n    fmt.Println(\"X\")\n}\n</code></pre>\n\n<p>Any pointers on what I do wrong?</p>\n"}, {"tags": ["mongodb", "go", "mongo-go"], "answers": [{"comments": [{"owner": {"reputation": 2133, "user_id": 7436566, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-VxBgdn2E0Qk/AAAAAAAAAAI/AAAAAAAAAIg/H8mCkOR8q_k/photo.jpg?sz=128", "display_name": "OhhhThatVarun", "link": "https://stackoverflow.com/users/7436566/ohhhthatvarun"}, "edited": false, "score": 0, "creation_date": 1568925785, "post_id": 57587024, "comment_id": 102440897, "body": "What to do when I&#39;m not sure which field user wants to update? e.g let&#39;s imagine this is out model  <code>id: 123, name: Varun, pwd : qwerty</code>. A user wants to update their name then we&#39;ll do what&#39;s defined in the answer. But imagine next time a user wants to update their password then what we will do?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1566374544, "creation_date": 1566374544, "answer_id": 57587024, "question_id": 57586592, "link": "https://stackoverflow.com/questions/57586592/how-to-perform-addtoset-using-go-official-driver/57587024#57587024", "title": "How to perform addToSet using Go official driver?", "body": "<p><code>$addToSet</code> is an update operation, if you want to update a single document, you may use the <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo#Collection.UpdateOne\" rel=\"nofollow noreferrer\"><code>Collection.UpdateOne()</code></a> method.</p>\n\n<p>Use the <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/bson#M\" rel=\"nofollow noreferrer\"><code>bson.M</code></a> and/or <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/bson#D\" rel=\"nofollow noreferrer\"><code>bson.D</code></a> types to describe your filters and update document.</p>\n\n<p>For example:</p>\n\n<pre><code>update := bson.M{\n    \"$addToSet\": bson.M{\n        \"tags\": bson.M{\"$each\": []string{\"camera\", \"electronics\", \"accessories\"}},\n    },\n}\nres, err := c.UpdateOne(ctx, bson.M{\"_id\": 2}, update)\n</code></pre>\n\n<p>Here's a complete, runnable app that connects to a MongoDB server and performs the above update operation:</p>\n\n<pre><code>ctx := context.Background()\nclient, err := mongo.Connect(ctx, options.Client().ApplyURI(\"mongodb://localhost\"))\nif err != nil {\n    panic(err)\n}\ndefer client.Disconnect(ctx)\n\nc := client.Database(\"dbname\").Collection(\"inventory\")\n\nupdate := bson.M{\n    \"$addToSet\": bson.M{\n        \"tags\": bson.M{\"$each\": []string{\"camera\", \"electronics\", \"accessories\"}},\n    },\n}\nres, err := c.UpdateOne(ctx, bson.M{\"_id\": 2}, update)\nif err != nil {\n    panic(err)\n}\nfmt.Printf(\"%+v\", res)\n</code></pre>\n"}], "owner": {"reputation": 188, "user_id": 662496, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-Q8gPIQ_YCRw/AAAAAAAAAAI/AAAAAAAAAC4/xN-2JGbR5Ts/photo.jpg?sz=128", "display_name": "Bijak Antusias Sufi", "link": "https://stackoverflow.com/users/662496/bijak-antusias-sufi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 700, "favorite_count": 0, "accepted_answer_id": 57587024, "answer_count": 1, "score": 2, "last_activity_date": 1566374645, "creation_date": 1566372693, "last_edit_date": 1566374645, "question_id": 57586592, "link": "https://stackoverflow.com/questions/57586592/how-to-perform-addtoset-using-go-official-driver", "title": "How to perform addToSet using Go official driver?", "body": "<p>I need to do <code>addToSet</code> operation using official Go MongoDB driver.</p>\n\n<p>In MongoDB we have some docs:</p>\n\n<pre><code>{ _id: 2, item: \"cable\", tags: [ \"electronics\", \"supplies\" ] }\n</code></pre>\n\n<p>Then to perform <code>addToSet</code>:</p>\n\n<pre><code>db.inventory.update(\n   { _id: 2 },\n   { $addToSet: { tags: { $each: [ \"camera\", \"electronics\", \"accessories\" ] } } }\n)\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>{\n  _id: 2,\n  item: \"cable\",\n  tags: [ \"electronics\", \"supplies\", \"camera\", \"accessories\" ]\n}\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1566372134, "post_id": 57585564, "comment_id": 101630598, "body": "As stated by bserdar in the answer <code>productlist</code> is a string not an array, so you can either declare the <code>Productlist</code> field as <code>string</code>, just like you&#39;re doing with <code>Roles</code>, or you can define a custom slice type that implements the <code>json.Unmarshaler</code> interface and unmarshals the string as an array."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566373001, "post_id": 57585564, "comment_id": 101630996, "body": "<a href=\"https://play.golang.com/p/Jn3yQU6HJSf\" rel=\"nofollow noreferrer\">play.golang.com/p/Jn3yQU6HJSf</a>"}, {"owner": {"reputation": 175, "user_id": 5971023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ad27ed2e7c4ecd69725e14046fe31dc?s=128&d=identicon&r=PG", "display_name": "S. Yacko", "link": "https://stackoverflow.com/users/5971023/s-yacko"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566405347, "post_id": 57585564, "comment_id": 101649119, "body": "Thank you - The issue was right in front of me and I just couldn&#39;t see it."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 5, "last_activity_date": 1566368865, "creation_date": 1566368865, "answer_id": 57585609, "question_id": 57585564, "link": "https://stackoverflow.com/questions/57585564/unmarshalling-a-json-object-with-json-array-into-a-struct/57585609#57585609", "title": "Unmarshalling a JSON object with JSON array into a struct", "body": "<p>The productlist field in the JSON input is a string, not an array:</p>\n\n<pre><code>\"productlist\": \"[\\\"SDCC\\\",\\\"JOB_CARDS\\\",\\\"ALLOCATIONS\\\"]\"\n</code></pre>\n\n<p>Note that the contents of it are quoted, and enclosed quotes are escaped. This is a string, not an array.</p>\n\n<p>If it was an array, it would have been:</p>\n\n<pre><code>\"productlist\": [\"SDCC\",\"JOB_CARDS\",\"ALLOCATIONS\"]\n</code></pre>\n"}], "owner": {"reputation": 175, "user_id": 5971023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ad27ed2e7c4ecd69725e14046fe31dc?s=128&d=identicon&r=PG", "display_name": "S. Yacko", "link": "https://stackoverflow.com/users/5971023/s-yacko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1566368865, "creation_date": 1566368651, "question_id": 57585564, "link": "https://stackoverflow.com/questions/57585564/unmarshalling-a-json-object-with-json-array-into-a-struct", "title": "Unmarshalling a JSON object with JSON array into a struct", "body": "<p>I want to unmarshal an array of json object into a struct.  Each json object has a json array for one of the properties. If the property is defined as a string, works.  If it's defined as an array of byte or string, I get an error.</p>\n\n<p>I have tried a number of approaches but keep getting an error. </p>\n\n<pre><code>panic: ERROR: json: cannot unmarshal string into Go struct field \n.productlist of type []string\n</code></pre>\n\n<p>Source file:</p>\n\n<pre><code>{\n  \"orgs\": [\n    {\n      \"orgname\": \"Test Organization 26\",\n      \"orgs_id\": 26,\n      \"contactdate\": \"2019-12-12\",\n      \"sincedate\": \"2019-12-12\",\n      \"estusers\": null,\n      \"estvehicles\": null,\n      \"paidusers\": null,\n      \"paythreshold\": null,\n      \"productlist\": \"[\\\"SDCC\\\",\\\"JOB_CARDS\\\",\\\"ALLOCATIONS\\\"]\",\n      \"roles\": \"[\\\"DISPATCH\\\",\\\"DRIVERS\\\",\\\"MECHANICS\\\"]\"\n    }\n  ]\n}\n</code></pre>\n\n<p>Go Struct:</p>\n\n<pre><code>type OrgsJSONData struct {\n    Orgs []struct {\n        Orgname      string      `json:\"orgname\"`\n        OrgsID       int         `json:\"orgs_id\"`\n        Contactdate  string      `json:\"contactdate\"`\n        Sincedate    string      `json:\"sincedate\"`\n        Estusers     interface{} `json:\"estusers\"`\n        Estvehicles  interface{} `json:\"estvehicles\"`\n        Paidusers    interface{} `json:\"paidusers\"`\n        Paythreshold interface{} `json:\"paythreshold\"`\n        Productlist  []string    `json:\"productlist\"`\n        Roles        string      `json:\"roles\"`\n    } `json:\"orgs\"`\n}\n\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>    var orgsJSONData OrgsJSONData\n    tmp := []byte(strings.Join(JsonData, \"\"))\n    err := json.Unmarshal(tmp, &amp;orgsJSONData)\n    if err != nil {\n        panic(\"ERROR: \" + err.Error())\n    }\n</code></pre>\n\n<p>If the productlist property is a string, the unmarshal works.  If it is any other slice or array, I get the error \"panic: ERROR: json: cannot unmarshal string into Go struct field .productlist of type []string\"  What am I doing wrong.  P.S. Very new to Golang (Week 2 and learning)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1566365391, "post_id": 57584905, "comment_id": 101627973, "body": "The compiler can take the address automatically and does this for you. See the <code>t.M2()</code>example in <a href=\"https://golang.org/ref/spec#Selectors\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Selectors</a> and the end of <a href=\"https://golang.org/ref/spec#Calls\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Calls</a>. This has nothing to do with package bytes but works on every type."}, {"owner": {"reputation": 1, "user_id": 11930111, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LTkaMYqO47I/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcAMU5q0dbQ_i2jOgTfMZUhHOeQig/photo.jpg?sz=128", "display_name": "Jack Lul", "link": "https://stackoverflow.com/users/11930111/jack-lul"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1566365651, "post_id": 57584905, "comment_id": 101628054, "body": "@Volker thanks a lot. very useful links."}], "answers": [{"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1566370392, "post_id": 57585010, "comment_id": 101629814, "body": "Go does not have references. The compiler passes a pointer to the value."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1566369563, "last_edit_date": 1566369563, "creation_date": 1566365526, "answer_id": 57585010, "question_id": 57584905, "link": "https://stackoverflow.com/questions/57584905/i-have-a-question-about-go-pointer-usage-in-package-bytes/57585010#57585010", "title": "I have a question about Go pointer usage in package bytes", "body": "<p>The receiver is a pointer, and in b.Write(), b is addressable. So Write is invoked on a pointer to b, not a copy of b. If b was not addressable, then you'd have received a compile error. For instance, this would fail:</p>\n\n<pre><code>bytes.Buffer{}.Write([]byte{1})\n</code></pre>\n\n<p>In general: you can call methods with pointer receivers only if you can take the address of the receiver object. The compiler passes the reference, not the copy for such methods.</p>\n"}], "owner": {"reputation": 1, "user_id": 11930111, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LTkaMYqO47I/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcAMU5q0dbQ_i2jOgTfMZUhHOeQig/photo.jpg?sz=128", "display_name": "Jack Lul", "link": "https://stackoverflow.com/users/11930111/jack-lul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 57585010, "answer_count": 1, "score": -2, "last_activity_date": 1566369563, "creation_date": 1566364899, "question_id": 57584905, "link": "https://stackoverflow.com/questions/57584905/i-have-a-question-about-go-pointer-usage-in-package-bytes", "title": "I have a question about Go pointer usage in package bytes", "body": "<p>I have a question about a usage of pointer in Go. The link is here: <a href=\"https://golang.org/pkg/bytes/#example_Buffer\" rel=\"nofollow noreferrer\">https://golang.org/pkg/bytes/#example_Buffer</a>.</p>\n\n<p>In the <code>type Buffer</code> section, the first example:</p>\n\n<pre><code>type Buffer struct {\n    // contains filtered or unexported fields\n}\n</code></pre>\n\n<pre><code>func main() {\n    var b bytes.Buffer // A Buffer needs no initialization.\n    b.Write([]byte(\"Hello \"))\n    fmt.Fprintf(&amp;b, \"world!\")\n    b.WriteTo(os.Stdout)\n}\n</code></pre>\n\n<p>and then in the </p>\n\n<pre><code>func (b *Buffer) Write(p []byte) (n int, err error)\n</code></pre>\n\n<p>I know that the receiver of <code>func Write</code> is <code>(b *Buffer)</code> then why in the <code>main()</code> function, after declaring/initializing <code>b</code>, we can simply use <code>b.Write()</code> but <strong>not</strong> <strong><code>(&amp;b).Write()</code></strong>?</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1138, "user_id": 4221945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fd64e16069e10f662f0eb2629f262f6?s=128&d=identicon&r=PG&f=1", "display_name": "Dominique Lorre", "link": "https://stackoverflow.com/users/4221945/dominique-lorre"}, "edited": false, "score": 0, "creation_date": 1566361155, "post_id": 57584307, "comment_id": 101627093, "body": "f(a) converts a into a string and displays the result to the standard output. It is defined by fmt.Println(string(a)). As you can see the function perm is recursive as it calls itself and the if block is the end condition."}, {"owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "edited": false, "score": 0, "creation_date": 1566361325, "post_id": 57584307, "comment_id": 101627120, "body": "I made a small modification in <code>main()</code> that should clear things up: <a href=\"https://play.golang.org/p/qG9bALwC4G8\" rel=\"nofollow noreferrer\">play.golang.org/p/qG9bALwC4G8</a>"}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 0, "creation_date": 1566361510, "post_id": 57584307, "comment_id": 101627164, "body": "<code>f</code> is an argument to the <code>perm</code> function which itself takes arguments of type <code>[]rune</code> and returns nothing (like <code>void</code> in C-family languages), and <code>a</code> is an argument to the <code>perm</code> function of type <code>[]rune</code>, so <code>f(a)</code> makes sense. Since <code>f</code> returns nothing, <code>fmt.Println(f(a))</code> doesn&#39;t make sense and will error."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1566397518, "post_id": 57584307, "comment_id": 101645255, "body": "Please take the <a href=\"https://tour.golang.org/moretypes/24\" rel=\"nofollow noreferrer\">Tour of Go</a>, which covers all language basics including function values and closures."}], "answers": [{"tags": [], "owner": {"reputation": 55, "user_id": 11898878, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KKfAm-JPmj4/AAAAAAAAAAI/AAAAAAAAAAk/F99sJ0yJSpI/photo.jpg?sz=128", "display_name": "Taylor Belland", "link": "https://stackoverflow.com/users/11898878/taylor-belland"}, "is_accepted": false, "score": 1, "last_activity_date": 1566369079, "creation_date": 1566369079, "answer_id": 57585659, "question_id": 57584307, "link": "https://stackoverflow.com/questions/57584307/golang-function-as-a-parameter/57585659#57585659", "title": "Golang function as a parameter", "body": "<p>You have discovered a Closure!</p>\n\n<p><a href=\"https://golangcode.com/anonymous-functions/\" rel=\"nofollow noreferrer\">Also known as an anonymous function.</a></p>\n\n<p>It is basically a one off function that stays within its scope.</p>\n\n<p>As for the printing not working, that's partly because of the anonymous nature, and partly because it has no return value to print. If you really wanted to get into it, you could try printing &amp;f to generate a pointer so you have a value to print out.</p>\n"}], "owner": {"reputation": 322, "user_id": 2939041, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/748a0100ad69d148ef651ec35bfdb889?s=128&d=identicon&r=PG&f=1", "display_name": "Vinay Sheshadri", "link": "https://stackoverflow.com/users/2939041/vinay-sheshadri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 122, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1566369079, "creation_date": 1566360548, "last_edit_date": 1566360863, "question_id": 57584307, "link": "https://stackoverflow.com/questions/57584307/golang-function-as-a-parameter", "title": "Golang function as a parameter", "body": "<p>I came across the following code to generate permutations of a given string. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    Perm([]rune(\"abc\"), func(a []rune) {\n        fmt.Println(string(a))\n    })\n\n}\n\nfunc Perm(a []rune, f func([]rune)) {\n    perm(a, f, 0)\n}\n\nfunc perm(a []rune, f func([]rune), i int) {\n    if i &gt; len(a) {\n        f(a)\n        return\n    }\n    perm(a, f, i+1)\n    for j := i + 1; j &lt; len(a); j++ {\n        a[i], a[j] = a[j], a[i]\n        perm(a, f, i+1)\n        a[i], a[j] = a[j], a[i]\n    }\n}\n</code></pre>\n\n<p>I am having a hard time understanding how this program works. Especially the exit condition where a call is made to <code>f(a)</code> in func perm. Can someone explain what f(a) implies? </p>\n\n<p>I tried printing <code>fmt.Println(f(a))</code> but got an error. </p>\n\n<p>Go Playground: <a href=\"https://play.golang.org/p/FNijVw32iAy\" rel=\"nofollow noreferrer\">https://play.golang.org/p/FNijVw32iAy</a></p>\n"}, {"tags": ["go", "tags"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 3, "last_activity_date": 1567120133, "last_edit_date": 1567120133, "creation_date": 1566355375, "answer_id": 57583790, "question_id": 57583734, "link": "https://stackoverflow.com/questions/57583734/how-to-use-mapstructure-tag-as-json-tag/57583790#57583790", "title": "How to use mapstructure tag as json tag?", "body": "<p>If you do not want to modify the package files, you can create another struct with the same field names, but with JSON tags, and copy:</p>\n\n<pre><code>type JSONServiceConfig struct {\n    Name      string        `json:\"name\"`\n    Endpoints string        `json:\"end_points\"`\n    Timeout   time.Duration `json:\"timeout\"`\n}\n</code></pre>\n\n<p>Then:</p>\n\n<pre><code>x := JSONServiceConfig(serviceConfig)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "is_accepted": false, "score": 2, "last_activity_date": 1566358683, "creation_date": 1566358683, "answer_id": 57584130, "question_id": 57583734, "link": "https://stackoverflow.com/questions/57583734/how-to-use-mapstructure-tag-as-json-tag/57584130#57584130", "title": "How to use mapstructure tag as json tag?", "body": "<p>You cannot do what you want without modifying the <code>mapstructure</code> source, and it would probably get a little bit hairy if you want to specify options, such as <code>json</code>'s <code>omitempty</code>. However, you can simply add a second struct tag for this</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type ServiceConfig struct {\n    // name of the service\n    Name string `mapstructure:\"name\" json:\"name\"`\n    // set of endpoint definitions\n    Endpoints string `mapstructure:\"end_points\" json:\"end_points\"`\n    // defafult timeout\n    Timeout time.Duration `mapstructure:\"timeout\" json:\"timeout\"`\n}\n</code></pre>\n\n<p>From the documentation of <code>reflect</code></p>\n\n<blockquote>\n  <p>By convention, tag strings are a concatenation of optionally\n  space-separated key:\"value\" pairs. Each key is a non-empty string\n  consisting of non-control characters other than space (U+0020 ' '),\n  quote (U+0022 '\"'), and colon (U+003A ':'). Each value is quoted using\n  U+0022 '\"' characters and Go string literal syntax.</p>\n</blockquote>\n\n<p><a href=\"https://play.golang.org/p/mxjirRO8vJ5\" rel=\"nofollow noreferrer\">Here's a simple example on the playground</a></p>\n"}], "owner": {"reputation": 19, "user_id": 1687674, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rj5L4.jpg?s=128&g=1", "display_name": "yifanes", "link": "https://stackoverflow.com/users/1687674/yifanes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 443, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1567120133, "creation_date": 1566354903, "question_id": 57583734, "link": "https://stackoverflow.com/questions/57583734/how-to-use-mapstructure-tag-as-json-tag", "title": "How to use mapstructure tag as json tag?", "body": "<p>I'm introducing a package from a third party that has this <code>struct</code> with <code>mapstructure</code> tag.</p>\n\n<p>I want the instance of this struct to be json with <code>mapstructure</code> specified value.What should I do?</p>\n\n<p>I can add json tag, but in doing so,I modify package files,I think this is a bad way.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type ServiceConfig struct {\n    // name of the service\n    Name string `mapstructure:\"name\"`\n    // set of endpoint definitions\n    Endpoints string `mapstructure:\"end_points\"`\n    // defafult timeout\n    Timeout time.Duration `mapstructure:\"timeout\"`\n}\n</code></pre>\n\n<p>I want to get:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>{\"name\":\"sss\", \"end_points\" :\"xxx\", \"timeout\" : \"120\"}\n</code></pre>\n"}, {"tags": ["go", "hyperledger-fabric", "hyperledger-chaincode", "chaincode"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1566364806, "post_id": 57583638, "comment_id": 101627812, "body": "Nothing wrong with the syntax in this code, so it cannot generate that error. Either the error is coming from somewhere else or the actual code is different."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 11955229, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-7eI37TihXhQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcpsDinCb7ZNiaJIYntYJNTTzJkJA/photo.jpg?sz=128", "display_name": "Porika Venkatesh", "link": "https://stackoverflow.com/users/11955229/porika-venkatesh"}, "is_accepted": false, "score": 0, "last_activity_date": 1566368470, "creation_date": 1566368470, "answer_id": 57585525, "question_id": 57583638, "link": "https://stackoverflow.com/questions/57583638/how-to-fix-syntax-error-unexpected-shim-expecting-comma-or-in-chaincode/57585525#57585525", "title": "How to fix &quot;syntax error: unexpected shim, expecting comma or )&quot; in chaincode?", "body": "<p>Don`t know whats in sc.Response but in all the cases you were returning shim.Error() type. As per terminology stub i think you were using gRPC, it should return response and an error.</p>\n"}], "owner": {"reputation": 1, "user_id": 10406511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/781f0ed72e048899d12db3f0a9d082fc?s=128&d=identicon&r=PG&f=1", "display_name": "Aiga", "link": "https://stackoverflow.com/users/10406511/aiga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 215, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1566368470, "creation_date": 1566354066, "last_edit_date": 1566363011, "question_id": 57583638, "link": "https://stackoverflow.com/questions/57583638/how-to-fix-syntax-error-unexpected-shim-expecting-comma-or-in-chaincode", "title": "How to fix &quot;syntax error: unexpected shim, expecting comma or )&quot; in chaincode?", "body": "<p>I have the chaincode, which should encrypt data and put to ledger and do query. </p>\n\n<p>I have updated fabric binaries, but in other fabric samples chaincodes this line is the same and do not have any errors. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (s *SmartContract) queryPatient(APIstub shim.ChaincodeStubInterface, args []string) sc.Response { \n     if len(args) != 1 {\n         return shim.Error(\"Incorrect number of arguments. Expecting 1\")\n     }\n\n    patientAsBytes, err := fc.Decrypter(APIstub, args[0])\n    if err != nil {\n        return shim.Error(err.Error())\n    }\n\n     return shim.Success(patientAsBytes)\n }\n</code></pre>\n\n<p>Error is directing to the \n<code>queryPatient(APIstub shim.ChaincodeStubInterface, args []string) sc.Response { .</code></p>\n"}, {"tags": ["go", "grpc"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566365929, "post_id": 57583346, "comment_id": 101628148, "body": "What does check() do? If it does not panic, then you might be reading from a stream that was terminated. Maybe not exactly what you are looking for, but I have similar code that terminates the loop as soon as an error is observed."}, {"owner": {"reputation": 11839, "user_id": 730346, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/86187a52f1e2f64890194d0451748ce5?s=128&d=identicon&r=PG", "display_name": "Daniel YC Lin", "link": "https://stackoverflow.com/users/730346/daniel-yc-lin"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566378091, "post_id": 57583346, "comment_id": 101633482, "body": "I just want to close client program beautifully when server is down in the middle of stream.  And I require to just filter out the known error, display unknown error"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 11955229, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-7eI37TihXhQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcpsDinCb7ZNiaJIYntYJNTTzJkJA/photo.jpg?sz=128", "display_name": "Porika Venkatesh", "link": "https://stackoverflow.com/users/11955229/porika-venkatesh"}, "is_accepted": false, "score": 0, "last_activity_date": 1566368934, "creation_date": 1566368934, "answer_id": 57585629, "question_id": 57583346, "link": "https://stackoverflow.com/questions/57583346/how-to-detect-the-error-when-grpc-server-is-shutdown-in-go/57585629#57585629", "title": "How to detect the error when grpc server is shutdown in Go?", "body": "<p>gRPC always need to return errors properly, if you do not handle errors the connection will go into TRANSIENT_FAILURE state and you cannot request any query with this client connection. Catch the error properly and return it using grpc error codes. You can find deeper insites here <a href=\"https://www.grpc.io/docs/guides/error/\" rel=\"nofollow noreferrer\">https://www.grpc.io/docs/guides/error/</a> and use this inbuilt package grpc: google.golang.org/grpc/status</p>\n\n<p>conn *grpc.ClientConn\nconn.GetState() will give the current connection state</p>\n"}], "owner": {"reputation": 11839, "user_id": 730346, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/86187a52f1e2f64890194d0451748ce5?s=128&d=identicon&r=PG", "display_name": "Daniel YC Lin", "link": "https://stackoverflow.com/users/730346/daniel-yc-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1215, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566377997, "creation_date": 1566351031, "last_edit_date": 1566377997, "question_id": 57583346, "link": "https://stackoverflow.com/questions/57583346/how-to-detect-the-error-when-grpc-server-is-shutdown-in-go", "title": "How to detect the error when grpc server is shutdown in Go?", "body": "<p>I'm trying to detect the gRPC server shutdown in Go gRPC client code like</p>\n\n<pre><code>import (\n     pb \"mysample.com/api/rpc\"\n     \"google.golang.org/grpc\"\n)\nvar stream pb.SearchProductService_MarketStreamClient\nfor {\n    r, err := stream.Recv()\n    if err == io.EOF {\n        log.Println(\"Info: server close\")\n        break\n    } else if err != nil {\n        log.Println(\"Err: grpc code:\", grpc.Code(err))\n        if err != nil {\n          log.Fatal(err)\n        }\n    }\n    outs := printOrderbook(r)\n    fmt.Println(outs)\n    if outf != nil {\n        outf.WriteString(time.Now().Format(\"030405.000 \") +\n            outs + \"\\n\")\n    }\n}\n</code></pre>\n\n<p>The output message is</p>\n\n<pre><code>mysample.go:122: Err: grpc code: Unavailable\npanic: rpc error: code = Unavailable desc = transport is closing\n</code></pre>\n\n<p>I'm trying to search 'transport is closing' in Go's source and $GOPATH/src/, but I can't not found such phrase.  Is there any smart method to handle such deeper error?</p>\n"}, {"tags": ["email", "go", "sparkpost", "gomail"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1566342567, "post_id": 57582419, "comment_id": 101624241, "body": "<code>MAIL FROM</code> is an SMTP command, not a header.  It looks like the package gets  the command argument from the <code>from</code> argument to the <a href=\"https://godoc.org/gopkg.in/gomail.v2#Sender.Send\" rel=\"nofollow noreferrer\">Sender.Send</a> method (this is a guess based on how other packages work, this is the first time that I&#39;ve looked at the gomail package)."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1566365914, "post_id": 57582419, "comment_id": 101628143, "body": "I agree with CeriseLim&#243;n. The first argument of <a href=\"https://godoc.org/gopkg.in/gomail.v2#Send\" rel=\"nofollow noreferrer\">Sender.Send</a> is used for the <code>MAIL FROM</code> SMTP command according to the source code."}, {"owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "edited": false, "score": 0, "creation_date": 1566389560, "post_id": 57582419, "comment_id": 101639936, "body": "Alright interesting, well apparently it&#39;s possible set a different &quot;MAIL FROM&quot; than the From in the header according to SparkPost, I&#39;m dealing with their support to see what they actually want me to send to them"}], "answers": [{"tags": [], "owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "is_accepted": false, "score": 0, "last_activity_date": 1566408977, "creation_date": 1566408977, "answer_id": 57596670, "question_id": 57582419, "link": "https://stackoverflow.com/questions/57582419/how-to-set-the-mail-from-header-for-an-email/57596670#57596670", "title": "How to set the &quot;MAIL FROM&quot; header for an email?", "body": "<p>So it's not a header in the email, maybe their documentation says that incorrectly. </p>\n\n<p>But it's one of the commands sent to the SMTP server when sending the email to the server. This is all handled in <code>gomail</code>, which uses the <code>net/smtp</code> package's <code>Mail()</code> function.</p>\n\n<p>Instead of using </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>return dialer.DialAndSend(m)\n</code></pre>\n\n<p>you can call the <code>Send()</code> function directly on the message, and pass to it a different address.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>s, err := dialer.Dial()\nif err != nil {\n    return err\n}\ndefer s.Close()\n\nm := gomail.NewMessage()\nmailFrom := \"bounces@bounce.example.com\"\nto := []string{\"receiver@example.com\"}\n\nreturn s.Send(mailFrom, to, m)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4334, "user_id": 1067124, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8d81542c7924beff2a0be7a449d91555?s=128&d=identicon&r=PG", "display_name": "Benedikt K&#246;ppel", "link": "https://stackoverflow.com/users/1067124/benedikt-k%c3%b6ppel"}, "is_accepted": false, "score": 0, "last_activity_date": 1586459180, "creation_date": 1586459180, "answer_id": 61128474, "question_id": 57582419, "link": "https://stackoverflow.com/questions/57582419/how-to-set-the-mail-from-header-for-an-email/61128474#61128474", "title": "How to set the &quot;MAIL FROM&quot; header for an email?", "body": "<p>In my case, I got the same error:</p>\n\n<pre><code>550 5.6.0 Invalid header found (see RFC2822 section 3.6)\n</code></pre>\n\n<p>After a bit of trial and error, I found that it was not an invalid header, but it was because the <code>Subject:</code> header was missing. Adding a subject solved the problem.</p>\n"}], "owner": {"reputation": 6456, "user_id": 728236, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/SOeHR.jpg?s=128&g=1", "display_name": "Brian Leishman", "link": "https://stackoverflow.com/users/728236/brian-leishman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 305, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1586459180, "creation_date": 1566341305, "question_id": 57582419, "link": "https://stackoverflow.com/questions/57582419/how-to-set-the-mail-from-header-for-an-email", "title": "How to set the &quot;MAIL FROM&quot; header for an email?", "body": "<p>In the SparkPost (an email sending provider) documentation for setting \"bounce domains\" it says </p>\n\n<blockquote>\n  <p>specified in the [...] mail from header in the SMTP payload</p>\n</blockquote>\n\n<p><a href=\"https://www.sparkpost.com/docs/tech-resources/custom-bounce-domain/\" rel=\"nofollow noreferrer\">https://www.sparkpost.com/docs/tech-resources/custom-bounce-domain/</a></p>\n\n<p>But when I set the \"MAIL FROM\" header I get a response from their server stating </p>\n\n<blockquote>\n  <p>550 5.6.0 Invalid header found (see RFC2822 section 3.6)</p>\n</blockquote>\n\n<p>I'm using the plugin <code>gomail \"gopkg.in/gomail.v2\"</code></p>\n\n<p>What does setting the \"MAIL FROM\" header actually mean? How do I set it?</p>\n"}, {"tags": ["mysql", "go", "stored-procedures"], "answers": [{"comments": [{"owner": {"reputation": 1517, "user_id": 1446184, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ba214a69aabc7a2d7e41fcf293c0efd1?s=128&d=identicon&r=PG", "display_name": "gfish3000", "link": "https://stackoverflow.com/users/1446184/gfish3000"}, "edited": false, "score": 0, "creation_date": 1566349010, "post_id": 57583038, "comment_id": 101625219, "body": "Got it. I&#39;m used to working with C# and ADO.NET where this sort of thing is a little more intuitive. I created a workaround for this stored procedure which works just fine, so I&#39;ll know that&#39;s a limitation for the future."}, {"owner": {"reputation": 194, "user_id": 3900981, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/PunDb.jpg?s=128&g=1", "display_name": "George Rautenbach", "link": "https://stackoverflow.com/users/3900981/george-rautenbach"}, "edited": false, "score": 0, "creation_date": 1586215545, "post_id": 57583038, "comment_id": 108042247, "body": "Note that this method of getting output from procedures does not work as of Go1.14 (not confident it ever worked, actually)."}, {"owner": {"reputation": 458695, "user_id": 20860, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/iavmP.jpg?s=128&g=1", "display_name": "Bill Karwin", "link": "https://stackoverflow.com/users/20860/bill-karwin"}, "edited": false, "score": 0, "creation_date": 1586215683, "post_id": 57583038, "comment_id": 108042281, "body": "Why doesn&#39;t it work? Are subsequent calls to <code>db.Query()</code> not guaranteed to use the same MySQL session?"}, {"owner": {"reputation": 194, "user_id": 3900981, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/PunDb.jpg?s=128&g=1", "display_name": "George Rautenbach", "link": "https://stackoverflow.com/users/3900981/george-rautenbach"}, "edited": false, "score": 0, "creation_date": 1586216169, "post_id": 57583038, "comment_id": 108042395, "body": "I believe so. Go sees all <code>@variables</code> in <code>db.Query()</code> calls as <code>NULL</code> and thus does not read in any information in <code>res.Scan()</code>."}, {"owner": {"reputation": 616, "user_id": 1068537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/t5m13.jpg?s=128&g=1", "display_name": "Phillip Elm", "link": "https://stackoverflow.com/users/1068537/phillip-elm"}, "edited": false, "score": 0, "creation_date": 1618349312, "post_id": 57583038, "comment_id": 118574507, "body": "@BillKarwin - I&#39;m a bit late to this, but it&#39;s my understanding that you need to explicitly create a transaction in order to force the Go SQL driver to use the same session for subsequent Exec and Query calls."}, {"owner": {"reputation": 458695, "user_id": 20860, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/iavmP.jpg?s=128&g=1", "display_name": "Bill Karwin", "link": "https://stackoverflow.com/users/20860/bill-karwin"}, "reply_to_user": {"reputation": 616, "user_id": 1068537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/t5m13.jpg?s=128&g=1", "display_name": "Phillip Elm", "link": "https://stackoverflow.com/users/1068537/phillip-elm"}, "edited": false, "score": 0, "creation_date": 1618353800, "post_id": 57583038, "comment_id": 118575688, "body": "@PhillipElm, You can&#39;t use the <code>sql.DB</code> object for multiple queries, because it might use different connections from the pool. But if you get a <code>sql.Conn</code> from the sql.DB, then you can use that connection for multiple queries (in separate transactions), and it&#39;ll be the same session."}, {"owner": {"reputation": 616, "user_id": 1068537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/t5m13.jpg?s=128&g=1", "display_name": "Phillip Elm", "link": "https://stackoverflow.com/users/1068537/phillip-elm"}, "edited": false, "score": 0, "creation_date": 1618365109, "post_id": 57583038, "comment_id": 118577682, "body": "@BillKarwin Yes, you can - see my added answer. Just call Begin() on it to get a transaction. The documentation (<a href=\"http://go-database-sql.org/modifying.html\" rel=\"nofollow noreferrer\">go-database-sql.org/modifying.html</a>) states that &quot;In Go, a transaction is essentially an object that reserves a connection to the datastore. It lets you do all of the operations we\u2019ve seen thus far, but guarantees that they\u2019ll be executed on the same connection.&quot;"}, {"owner": {"reputation": 458695, "user_id": 20860, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/iavmP.jpg?s=128&g=1", "display_name": "Bill Karwin", "link": "https://stackoverflow.com/users/20860/bill-karwin"}, "reply_to_user": {"reputation": 616, "user_id": 1068537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/t5m13.jpg?s=128&g=1", "display_name": "Phillip Elm", "link": "https://stackoverflow.com/users/1068537/phillip-elm"}, "edited": false, "score": 1, "creation_date": 1618372330, "post_id": 57583038, "comment_id": 118578861, "body": "@PhillipElm, Thanks, I understand how that works when you use a transaction. What I mean is that if you don&#39;t want to group statements in a single transaction, you can still ensure the same connection, so you can make use of session state, like user-defined variables."}, {"owner": {"reputation": 616, "user_id": 1068537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/t5m13.jpg?s=128&g=1", "display_name": "Phillip Elm", "link": "https://stackoverflow.com/users/1068537/phillip-elm"}, "edited": false, "score": 0, "creation_date": 1618380710, "post_id": 57583038, "comment_id": 118580638, "body": "@BillKarwin Ah, right. Apologies, I misread your original reply. That is a good point. I&#39;ve updated my answer below to reflect that. On an aside, I just re-read your answer and I noticed your use of Query over Exec. Do you see any benefit to using the former when invoking the stored procedure in this case? The former still requires a Close() call, and from this page (<a href=\"http://go-database-sql.org/surprises.html\" rel=\"nofollow noreferrer\">go-database-sql.org/surprises.html</a>) it sounds like some drivers (MySQL namely) have issues with it. Genuinely curious about use cases here."}, {"owner": {"reputation": 458695, "user_id": 20860, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/iavmP.jpg?s=128&g=1", "display_name": "Bill Karwin", "link": "https://stackoverflow.com/users/20860/bill-karwin"}, "reply_to_user": {"reputation": 616, "user_id": 1068537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/t5m13.jpg?s=128&g=1", "display_name": "Phillip Elm", "link": "https://stackoverflow.com/users/1068537/phillip-elm"}, "edited": false, "score": 1, "creation_date": 1618404950, "post_id": 57583038, "comment_id": 118590791, "body": "@PhillipElm If the stored procedure returns a result set, you must use Query()."}, {"owner": {"reputation": 616, "user_id": 1068537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/t5m13.jpg?s=128&g=1", "display_name": "Phillip Elm", "link": "https://stackoverflow.com/users/1068537/phillip-elm"}, "edited": false, "score": 0, "creation_date": 1618449122, "post_id": 57583038, "comment_id": 118607043, "body": "@BillKarwin wow TIL that works. Until now I&#39;ve been under the impression that didn&#39;t work with Go + MySQL due to a DB-specific driver level issue. Wrote a small test and voila, it worked ootb. Thanks for the info! +1"}], "tags": [], "owner": {"reputation": 458695, "user_id": 20860, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/iavmP.jpg?s=128&g=1", "display_name": "Bill Karwin", "link": "https://stackoverflow.com/users/20860/bill-karwin"}, "is_accepted": true, "score": 3, "last_activity_date": 1566347576, "creation_date": 1566347576, "answer_id": 57583038, "question_id": 57582326, "link": "https://stackoverflow.com/questions/57582326/cant-retrieve-output-parameter-with-go-mysql/57583038#57583038", "title": "Can&#39;t retrieve output parameter with Go MySQL", "body": "<p>You can't run more than one statement in a single <code>db.Query()</code> call. This is true of most query interfaces in all programming languages.</p>\n\n<p>Call your stored procedure in one call to <code>db.Query()</code>, then query <code>select @newargumentid</code> in a second call to <code>db.Query()</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 194, "user_id": 3900981, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/PunDb.jpg?s=128&g=1", "display_name": "George Rautenbach", "link": "https://stackoverflow.com/users/3900981/george-rautenbach"}, "is_accepted": false, "score": 0, "last_activity_date": 1586215948, "creation_date": 1586215948, "answer_id": 61070538, "question_id": 57582326, "link": "https://stackoverflow.com/questions/57582326/cant-retrieve-output-parameter-with-go-mysql/61070538#61070538", "title": "Can&#39;t retrieve output parameter with Go MySQL", "body": "<p>I just tested @Bill's answer and I can confirm it does not work as at Go1.14. My workaround was to rewrite my stored procedure to \"return\" values by doing a select at the end:</p>\n\n<pre><code>CREATE PROCEDURE foo()\nBEGIN\n    # do stuff...\n\n    SELECT 'bar';\nEND;\n</code></pre>\n\n<p>And then in Go just read it like any other query:</p>\n\n<pre><code>res, _ := db.Query(\"CALL foo()\")\nres.Next()\nvar bar string\nres.Scan(&amp;bar)\nprintln(bar)\n</code></pre>\n\n<p>Note this method also works for multiple columns and multiple rows.</p>\n"}], "owner": {"reputation": 1517, "user_id": 1446184, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ba214a69aabc7a2d7e41fcf293c0efd1?s=128&d=identicon&r=PG", "display_name": "gfish3000", "link": "https://stackoverflow.com/users/1446184/gfish3000"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 569, "favorite_count": 0, "accepted_answer_id": 57583038, "answer_count": 2, "score": 2, "last_activity_date": 1619181803, "creation_date": 1566340555, "question_id": 57582326, "link": "https://stackoverflow.com/questions/57582326/cant-retrieve-output-parameter-with-go-mysql", "title": "Can&#39;t retrieve output parameter with Go MySQL", "body": "<p>I have a stored procedure which inserts an entity and returns its new UUID, and while I can generate the code to create the right query, it errors out when using <code>go-sql-driver/mysql</code>. So the following code...</p>\n\n<pre><code>func test_insert() *sql.Rows {\n    db := openDbConnection()\n\n    defer db.Close()\n\n    results, err := db.Query(\"call saveargument(null, 'Test Argument', 'Test Argument', '1', null, null, null, 1, 'test_user', @newargumentid);\\nselect @newargumentid;\")\n\n    toolkit.HandleError(err)\n\n    return results\n}\n\nfunc openDbConnection() *sql.DB {\n    var db, err = sql.Open(\"mysql\", getConnectionString(entities.GetConfig()))\n\n    toolkit.HandleError(err)\n\n    return db\n}\n</code></pre>\n\n<p>... produces the following error: </p>\n\n<blockquote>\n  <p>You have an error in your SQL syntax; check the manual that\n  corresponds to your MySQL server version for the right syntax to use\n  near 'select @newargumentid' at line 2</p>\n</blockquote>\n\n<p>I'm not sure why such a basic piece of SQL could be so problematic. Any insights anyone?</p>\n"}, {"tags": ["go", "aws-lambda", "serverless"], "comments": [{"owner": {"reputation": 1251, "user_id": 10895704, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jCVxNo0ic3Y/AAAAAAAAAAI/AAAAAAAAF44/CT3dfgZ-3TQ/photo.jpg?sz=128", "display_name": "Erez", "link": "https://stackoverflow.com/users/10895704/erez"}, "edited": false, "score": 0, "creation_date": 1566374118, "post_id": 57581616, "comment_id": 101631553, "body": "Can you post the full <code>serverless invoke local</code> command you&#39;re using with the <code>--data</code> argument value?"}, {"owner": {"reputation": 1263, "user_id": 448967, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/79b84e97fab1f1e001a0f9e22a1ae326?s=128&d=identicon&r=PG", "display_name": "Adgezaza", "link": "https://stackoverflow.com/users/448967/adgezaza"}, "reply_to_user": {"reputation": 1251, "user_id": 10895704, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jCVxNo0ic3Y/AAAAAAAAAAI/AAAAAAAAF44/CT3dfgZ-3TQ/photo.jpg?sz=128", "display_name": "Erez", "link": "https://stackoverflow.com/users/10895704/erez"}, "edited": false, "score": 0, "creation_date": 1566398033, "post_id": 57581616, "comment_id": 101645357, "body": "<code>serverless invoke local -f myfunc --data &#39;{&quot;caller&quot;: &quot;foo&quot;, &quot;query&quot;: &quot;bar@gmail.com&quot;}&#39;</code>"}, {"owner": {"reputation": 1263, "user_id": 448967, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/79b84e97fab1f1e001a0f9e22a1ae326?s=128&d=identicon&r=PG", "display_name": "Adgezaza", "link": "https://stackoverflow.com/users/448967/adgezaza"}, "reply_to_user": {"reputation": 1251, "user_id": 10895704, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-jCVxNo0ic3Y/AAAAAAAAAAI/AAAAAAAAF44/CT3dfgZ-3TQ/photo.jpg?sz=128", "display_name": "Erez", "link": "https://stackoverflow.com/users/10895704/erez"}, "edited": false, "score": 0, "creation_date": 1566398095, "post_id": 57581616, "comment_id": 101645381, "body": "The docs are not clear on --data arg and behavior. I assume it doesn&#39;t default to requestresponse type?"}], "answers": [{"tags": [], "owner": {"reputation": 1263, "user_id": 448967, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/79b84e97fab1f1e001a0f9e22a1ae326?s=128&d=identicon&r=PG", "display_name": "Adgezaza", "link": "https://stackoverflow.com/users/448967/adgezaza"}, "is_accepted": false, "score": 2, "last_activity_date": 1566397935, "creation_date": 1566397935, "answer_id": 57593955, "question_id": 57581616, "link": "https://stackoverflow.com/questions/57581616/parsing-payload-is-different-with-serverless-invoke-local-then-when-deployed-w/57593955#57593955", "title": "Parsing payload is different with `serverless invoke local` then when deployed with behind APIGateway", "body": "<p>I got this working by using the <code>--path</code> arg instead of <code>--data</code> arg and writing out the payload like this.</p>\n\n<p><code>serverless invoke local -f myfunc --log --path mydata.json</code></p>\n\n<pre><code>{\n    \"body\": \"{\\\"caller\\\": \\\"foo\\\", \\\"value\\\": \\\"clark.kent@example.com\\\"}\"\n}\n</code></pre>\n"}], "owner": {"reputation": 1263, "user_id": 448967, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/79b84e97fab1f1e001a0f9e22a1ae326?s=128&d=identicon&r=PG", "display_name": "Adgezaza", "link": "https://stackoverflow.com/users/448967/adgezaza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 325, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1566397935, "creation_date": 1566335711, "question_id": 57581616, "link": "https://stackoverflow.com/questions/57581616/parsing-payload-is-different-with-serverless-invoke-local-then-when-deployed-w", "title": "Parsing payload is different with `serverless invoke local` then when deployed with behind APIGateway", "body": "<p>There seems to be a difference the way serverless handles request payloads with <code>invoke local</code> vs the behaviour when deployed to AWS.</p>\n\n<p>The expected behaviour is that you would pull the payload out of the request body like so...</p>\n\n<pre><code>func Handler(ctx context.Context, request events.APIGatewayProxyRequest)\n</code></pre>\n\n<p>Then unmarshal it into your data type like so...</p>\n\n<pre><code>type SearchQuery struct {\n    Caller string `json:\"caller\"`\n    Value  string `json:\"value\"`\n}\n</code></pre>\n\n<pre><code>err := json.Unmarshal([]byte(request.Body), &amp;searchQuery)\n</code></pre>\n\n<p>However, when invoking the function locally using the <code>--data</code> flag the payload is not in the <code>request.Body</code>.</p>\n\n<pre><code>events.APIGatewayProxyRequest) {\n Resource: (string) \"\",\n Path: (string) \"\",\n HTTPMethod: (string) \"\",\n Headers: (map[string]string) &lt;nil&gt;,\n MultiValueHeaders: (map[string][]string) &lt;nil&gt;,\n QueryStringParameters: (map[string]string) &lt;nil&gt;,\n MultiValueQueryStringParameters: (map[string][]string) &lt;nil&gt;,\n PathParameters: (map[string]string) &lt;nil&gt;,\n StageVariables: (map[string]string) &lt;nil&gt;,\n RequestContext: (events.APIGatewayProxyRequestContext) {\n  AccountID: (string) \"\",\n  ResourceID: (string) \"\",\n  Stage: (string) \"\",\n  RequestID: (string) \"\",\n  Identity: (events.APIGatewayRequestIdentity) {\n   CognitoIdentityPoolID: (string) \"\",\n   AccountID: (string) \"\",\n   CognitoIdentityID: (string) \"\",\n   Caller: (string) \"\",\n   APIKey: (string) \"\",\n   AccessKey: (string) \"\",\n   SourceIP: (string) \"\",\n   CognitoAuthenticationType: (string) \"\",\n   CognitoAuthenticationProvider: (string) \"\",\n   UserArn: (string) \"\",\n   UserAgent: (string) \"\",\n   User: (string) \"\"\n  },\n  ResourcePath: (string) \"\",\n  Authorizer: (map[string]interface {}) &lt;nil&gt;,\n  HTTPMethod: (string) \"\",\n  APIID: (string) \"\"\n },\n Body: (string) \"\",\n IsBase64Encoded: (bool) false\n}\n</code></pre>\n\n<p>It can only be extracted if you use the data type as your request param like so...</p>\n\n<pre><code>func Handler(ctx context.Context, request SearchQuery) (Response, error)\n</code></pre>\n\n<p>Is there a way to have these two environments working the same?</p>\n"}, {"tags": ["go", "visual-studio-code"], "comments": [{"owner": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1566359028, "post_id": 57581142, "comment_id": 101626765, "body": "Does this work in a terminal?"}, {"owner": {"reputation": 57, "user_id": 10307696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b452bdb04c17238e399fcee29772eb2?s=128&d=identicon&r=PG&f=1", "display_name": "Renan Angelini Ferrari", "link": "https://stackoverflow.com/users/10307696/renan-angelini-ferrari"}, "reply_to_user": {"reputation": 3396, "user_id": 1103734, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/87a5e4ab78c197e14ca8cbe22e84b53c?s=128&d=identicon&r=PG", "display_name": "ollien", "link": "https://stackoverflow.com/users/1103734/ollien"}, "edited": false, "score": 0, "creation_date": 1566385181, "post_id": 57581142, "comment_id": 101637560, "body": "@ollien does not work"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566397873, "post_id": 57581142, "comment_id": 101645299, "body": "You have a corrupt Go installation. As part of <a href=\"https://github.com/golang/go/issues/25417\" rel=\"nofollow noreferrer\">issue 25417</a> the assembly rc4 implementation was removed. You probably have a left over <code>rc4_asm.go</code> file from a previous version of Go. You should completly/cleanly uninstall Go and re-install Go."}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566397919, "post_id": 57585432, "comment_id": 101645312, "body": "&quot;Keep the definition you need, and go build again&quot; is bad advice; this is part of the Go standard library and a build failure there suggests a corrupt Go installation."}], "tags": [], "owner": {"reputation": 55, "user_id": 11898878, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KKfAm-JPmj4/AAAAAAAAAAI/AAAAAAAAAAk/F99sJ0yJSpI/photo.jpg?sz=128", "display_name": "Taylor Belland", "link": "https://stackoverflow.com/users/11898878/taylor-belland"}, "is_accepted": true, "score": 1, "last_activity_date": 1566367931, "creation_date": 1566367931, "answer_id": 57585432, "question_id": 57581142, "link": "https://stackoverflow.com/questions/57581142/error-downloading-golang-libraries-from-vscode/57585432#57585432", "title": "Error downloading Golang libraries from VSCode", "body": "<p>This is a declaration error, if you inspect the error code you can fix it yourself.</p>\n\n<blockquote>\n  <blockquote>\n    <p>crypto\\rc4\\rc4_asm.go:13:18: (*Cipher).XORKeyStream redeclared \n    in this block</p>\n    \n    <p>previous declaration at c:\\go\\src\\crypto\\rc4\\rc4.go:61:6</p>\n  </blockquote>\n</blockquote>\n\n<p>The first line states that (*Cipher).XORKeyStream was redeclared on line 13 of the file rc4_asm.go</p>\n\n<p>So if you inspect the rc4.go, file at line 61, you will find that (*Cipher).XORKeyStream has been defined more than once. Keep the definition you need, and go build again.</p>\n\n<p>I should note that one of the steps of go getting is a go build, so you don't have to worry about re-downloading again and again.</p>\n\n<p>I would try removing the download and trying again however, I managed to use that command and got an error free build.</p>\n"}], "owner": {"reputation": 57, "user_id": 10307696, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b452bdb04c17238e399fcee29772eb2?s=128&d=identicon&r=PG&f=1", "display_name": "Renan Angelini Ferrari", "link": "https://stackoverflow.com/users/10307696/renan-angelini-ferrari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 57585432, "answer_count": 1, "score": 0, "last_activity_date": 1566367931, "creation_date": 1566333065, "last_edit_date": 1566345140, "question_id": 57581142, "link": "https://stackoverflow.com/questions/57581142/error-downloading-golang-libraries-from-vscode", "title": "Error downloading Golang libraries from VSCode", "body": "<p>By running the following command in cmd or vscode:</p>\n\n<pre><code>go get -u -v github.com/mdempsky/gocode\n</code></pre>\n\n<p>I received the following console error:</p>\n\n<pre><code>crypto/internal/cipherhw\ncrypto/rc4\nruntime\n# crypto/rc4\nc:\\go\\src\\crypto\\rc4\\rc4_asm.go:13:18: (*Cipher).XORKeyStream redeclared \nin this block\nprevious declaration at c:\\go\\src\\crypto\\rc4\\rc4.go:61:6\n</code></pre>\n\n<p>I have already checked the GOPATH, and GOROOT. I also uninstalled and installed go and VSCode again and was unsuccessful.</p>\n"}, {"tags": ["mongodb", "docker", "go", "docker-compose", "dockerfile"], "comments": [{"owner": {"reputation": 2091, "user_id": 8407784, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jd1jX.jpg?s=128&g=1", "display_name": "Roberto Gon&#231;alves", "link": "https://stackoverflow.com/users/8407784/roberto-gon%c3%a7alves"}, "edited": false, "score": 0, "creation_date": 1566334385, "post_id": 57581091, "comment_id": 101622198, "body": "Hi Jeff, what are the logs for mongo_service? Is it running?"}], "answers": [{"tags": [], "owner": {"reputation": 5, "user_id": 2737022, "user_type": "registered", "profile_image": "https://graph.facebook.com/100002863437858/picture?type=large", "display_name": "Zen Th\u1eafng", "link": "https://stackoverflow.com/users/2737022/zen-th%e1%ba%afng"}, "is_accepted": false, "score": -1, "last_activity_date": 1566352662, "creation_date": 1566352662, "answer_id": 57583488, "question_id": 57581091, "link": "https://stackoverflow.com/questions/57581091/when-i-run-docker-compose-my-golang-ingest-container-fails-saying-error-esta/57583488#57583488", "title": "When I run docker compose, my golang (ingest) container fails saying &quot;Error establishing Mongo session&quot;", "body": "<p>In order to connect from Golang container to Mongo container, the Mongo Host must be set to <code>mongo_service_name:mongo_port</code>. And make sure the Golang container can reach to the Mongo container (by using network or links directives).</p>\n\n<p>Please check your <code>KOALA_MONGO_URL</code> in the <code>ingest</code> service. </p>\n\n<p>I don't know exactly what is your Mongo client in your <code>ingest</code> service. But normally, <code>KOALA_MONGO_URL</code> may be <code>mongo_service:27017</code> or <code>mongodb://mongo_service:27017/database_name</code>.</p>\n"}], "owner": {"reputation": 9, "user_id": 11853934, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Tjxo3eQMXJI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3re0Ae8xTg3EO8bzAvQacVD5eWvyIw/photo.jpg?sz=128", "display_name": "Jeff Sikala", "link": "https://stackoverflow.com/users/11853934/jeff-sikala"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1566352662, "creation_date": 1566332787, "question_id": 57581091, "link": "https://stackoverflow.com/questions/57581091/when-i-run-docker-compose-my-golang-ingest-container-fails-saying-error-esta", "title": "When I run docker compose, my golang (ingest) container fails saying &quot;Error establishing Mongo session&quot;", "body": "<p>I ran a docker-compose up and I get an error on my golang container saying \"Error establishing Mongo session\" and then the container exits out. I'm not sure if the issue begins with my golang container or mongo. </p>\n\n<p>I've tried a multitude of things at this point. Here is my docker logs file for my golang container.</p>\n\n<p><strong>docker logs for golang</strong></p>\n\n<pre><code>To run in debug mode, run with '-d true' option\n\ntime=\"2019-08-20T20:12:12Z\" level=info msg=\"Logging in INFO mode\"\ntime=\"2019-08-20T20:12:12Z\" level=info msg=\"Go version go1.7.3\"\ntime=\"2019-08-20T20:12:12Z\" level=info msg=\"Starting ingest service on port 4001\"\ntime=\"2019-08-20T20:12:12Z\" level=info msg=\"Koala Version Number: v19.33.0\"\ntime=\"2019-08-20T20:12:23Z\" level=error msg=\"Error establishing Mongo session\"\npanic: no reachable servers\n\ngoroutine 1 [running]:\npanic(0x933c00, 0xc4201b4f70)\n        /usr/local/go/src/runtime/panic.go:500 +0x1a1\ningest/mongo.InitDB(0x0, 0x0)\n        /home/jsikala/Documents/koala/go/src/ingest/mongo/mongo.go:34 +0x27e\nmain.setup()\n        /home/jsikala/Documents/koala/go/ingest.go:118 +0x3ce\nmain.main()\n        /home/jsikala/Documents/koala/go/ingest.go:56 +0x292\n</code></pre>\n\n<p>This is the error I get when I run my docker compose up.</p>\n\n<p>This is my <strong>docker-compose.yml</strong> file.</p>\n\n<pre><code>version: \"3\"\nvolumes:\n    data:\n        external:\n            name: ${MONGO_VOLUME_NAME}\nservices:\n    rails:\n        image: rails2\n        container_name: koala_rails_${USER}\n        environment: \n            - KOALA_ENV\n            - RAILS_PORT\n            - KOALA_INGEST_URL=${INGEST_PROTOCOL}://ingest:${INGEST_PORT}\n            - KOALA_MONGO_URL=mongo_service:27017\n            - KOALA_REDIS_URL=redis_service:6379\n            - KOALA_PKI_IN_DEV\n            - KOALA_USER_ID_HEADER\n            - USER\n            - USERNAME\n            - KOALA_REGISTER_USER_URL\n            - KOALA_SECURITY_VALIDATOR_URL\n            - CERT_FILE_PEM=/usr/src/app/certs/public.pem\n            - PRIVATE_CERT_FILE_PEM=/usr/src/app/certs/private-key.pem\n            - SSL_CA_FILE=/usr/src/app/certs/ca.pem\n            - LOGNAME\n            - KOALA_SECRET_KEY_BASE\n            - KOALA_MONGO_USERNAME\n            - KOALA_MONGO_PASSWORD\n            - KOALA_HELP_URL\n            - KOALA_CONTACT_EMAIL\n            - KOALA_USE_CERTS\n            - BUNDLE_GEMFILE\n            - KOALA_SERVER_URL\n            - RAILS_SERVE_STATIC_FILES\n            - RAILS_LOG_TO_STDOUT\n        ports:\n            - \"${RAILS_PORT}:${RAILS_PORT}\"\n        volumes:\n            - ${CERT_FILE_PEM}:/usr/src/app/certs/public.pem\n            - ${PRIVATE_CERT_FILE_PEM}:/usr/src/app/certs/private-key.pem\n            - ${SSL_CA_FILE}:/usr/src/app/certs/ca.pem\n    mongo_service:\n        image: mongo:3.2.0\n        volumes:\n            - data:/data/db\n        ports:\n            - \"27017:27017\"\n    redis_service:\n        image: redis:4.0.8\n        ports:\n            - \"6379:6379\"\n    ingest:\n        image: ingest\n        container_name: koala_ingest_${USER}\n        extra_hosts:\n            - csie.as.northgrum.com:10.8.131.12\n        environment: \n            - KOALA_ENV\n            - KOALA_CONFIG_FILE=/go/config.yml\n            - INGEST_PORT\n            - LOGNAME\n            - KOALA_MONGO_URL\n            - KOALA_JIRA_URL\n            - KOALA_JIRA_SESSION_URL\n            - CERT_FILE_PEM=/go/certs/public.pem\n            - PRIVATE_CERT_FILE_PEM=/go/certs/private-key.pem\n            - SSL_CA_FILE=/go/certs/ca.pem\n            - KOALA_REDIS_URL=redis_service:6379\n            - KOALA_USE_CERTS\n            - KOALA_MONGO_USERNAME\n            - KOALA_MONGO_PASSWORD\n            - JIRA_USERNAME\n            - JIRA_PASSWORD\n        ports:\n            - \"${INGEST_PORT}:${INGEST_PORT}\"\n        volumes:\n            - ${CERT_FILE_PEM}:/go/certs/public.pem\n            - ${PRIVATE_CERT_FILE_PEM}:/go/certs/private-key.pem\n            - ${SSL_CA_FILE}:/go/certs/ca.pem\n        links:\n            - mongo_service\n        depends_on:\n            - mongo_service\n            - redis_service\n</code></pre>\n\n<p><strong>NOTE</strong>: ingest is the golang service</p>\n\n<p>This is my docker <strong>Dockerfile</strong> for golang</p>\n\n<pre><code>FROM golang:1.11.5\n\nCOPY . .\n\nWORKDIR /go\nCOPY config.yml /go\nRUN mkdir -p $WORKDIR/logs\nRUN mkdir -p $WORKDIR/certs\n\nRUN cd $WORKDIR\n\nENV PATH $PATH:$WORKDIR\n\nCMD [\"./runIngest\"]\n</code></pre>\n\n<p>If this ran as intended, golang would be ingesting data in mongo. Any idea what caused this issue?</p>\n"}, {"tags": ["performance", "go", "cookies", "load-testing"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1566327564, "post_id": 57579537, "comment_id": 101619650, "body": "You&#39;re deleting cookies from the request when you never set any in the first place, so that&#39;s completely unnecessary. Deleting the cookies off the response is also unnecessary since you&#39;re not reusing it. &quot;Ignoring cookies&quot; would just mean disregarding that response header; since that&#39;s a pretty unusual use case, you&#39;d likely have to write your own client to do so."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1566359604, "post_id": 57579537, "comment_id": 101626854, "body": "For net/http there simply is no <i>need</i> to do much with cookies (and nothing you can do anyway). If memory pressure really comes from cookie values: Just empty each cookie&#39;s value (maybe name too) directly after receiving. Thats all you can do as there is <i>no</i> <i>way</i> to make net/http <i>not</i> read the cookies sent over the wire."}], "answers": [{"comments": [{"owner": {"reputation": 701, "user_id": 7355637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AsWJn.jpg?s=128&g=1", "display_name": "Solowalker", "link": "https://stackoverflow.com/users/7355637/solowalker"}, "edited": false, "score": 0, "creation_date": 1566333643, "post_id": 57580881, "comment_id": 101621944, "body": "Good info on fasthttp. Thanks. I&#39;m not looking at virtual memory, I&#39;m looking at RSS. I can watch that tick up until the process is killed because <code>out of memory</code>. It&#39;s definitely possible that I&#39;m doing something that&#39;s more expensive in Go than Python. Could be the work I&#39;m doing with the response body. I&#39;ll look into that."}, {"owner": {"reputation": 701, "user_id": 7355637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AsWJn.jpg?s=128&g=1", "display_name": "Solowalker", "link": "https://stackoverflow.com/users/7355637/solowalker"}, "edited": false, "score": 0, "creation_date": 1566363363, "post_id": 57580881, "comment_id": 101627514, "body": "After additional attempts to track down and reduce the memory usage, it does appear like it&#39;s less cookies and more handling the response the bodies. I&#39;ll have to keep going down that route. Thanks for pointing me in the right direction."}, {"owner": {"reputation": 127, "user_id": 6907368, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b9d8c6ed22d20483bc846b8618aef13?s=128&d=identicon&r=PG", "display_name": "Erik Dubbelboer", "link": "https://stackoverflow.com/users/6907368/erik-dubbelboer"}, "reply_to_user": {"reputation": 701, "user_id": 7355637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AsWJn.jpg?s=128&g=1", "display_name": "Solowalker", "link": "https://stackoverflow.com/users/7355637/solowalker"}, "edited": false, "score": 0, "creation_date": 1566458415, "post_id": 57580881, "comment_id": 101664168, "body": "How big are your response bodies?"}, {"owner": {"reputation": 127, "user_id": 6907368, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b9d8c6ed22d20483bc846b8618aef13?s=128&d=identicon&r=PG", "display_name": "Erik Dubbelboer", "link": "https://stackoverflow.com/users/6907368/erik-dubbelboer"}, "reply_to_user": {"reputation": 701, "user_id": 7355637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AsWJn.jpg?s=128&g=1", "display_name": "Solowalker", "link": "https://stackoverflow.com/users/7355637/solowalker"}, "edited": false, "score": 1, "creation_date": 1566458468, "post_id": 57580881, "comment_id": 101664196, "body": "You might like the new Go 1.13 that will be released soon: <a href=\"https://tip.golang.org/doc/go1.13#runtime\" rel=\"nofollow noreferrer\">tip.golang.org/doc/go1.13#runtime</a>  <code>The runtime is now more aggressive at returning memory to the operating system to make it available to co-tenant applications. Previously, the runtime could retain memory for five or more minutes following a spike in the heap size. It will now begin returning it promptly after the heap shrinks. However, on many OSes, including Linux, the OS itself reclaims memory lazily, so process RSS will not decrease until the system is under memory pressure. </code>"}], "tags": [], "owner": {"reputation": 127, "user_id": 6907368, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b9d8c6ed22d20483bc846b8618aef13?s=128&d=identicon&r=PG", "display_name": "Erik Dubbelboer", "link": "https://stackoverflow.com/users/6907368/erik-dubbelboer"}, "is_accepted": true, "score": 2, "last_activity_date": 1566331615, "creation_date": 1566331615, "answer_id": 57580881, "question_id": 57579537, "link": "https://stackoverflow.com/questions/57579537/go-in-a-high-performance-http-client-for-load-testing-how-can-i-block-ignore/57580881#57580881", "title": "Go - In a high performance http client for load testing, how can I block/ignore all cookies?", "body": "<p>Fasthttp will always load the full response into memory. So if you're having large response bodies and want to limit memory usage it's probably not the best solution for you.</p>\n\n<p>Fasthttp also trades memory usage for CPU usage by keeping buffers in memory and reusing it instead of spending CPU cycles having these buffers collected by the garbage collector.</p>\n\n<p>Using multiple GBs of memory seems a lot. Are you looking at the RSS or maybe the virtual memory in this case?</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 11950127, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7db92f5bf15350642dca4b38826aad2e?s=128&d=identicon&r=PG&f=1", "display_name": "cfmy", "link": "https://stackoverflow.com/users/11950127/cfmy"}, "is_accepted": false, "score": 1, "last_activity_date": 1566385730, "last_edit_date": 1566385730, "creation_date": 1566377999, "answer_id": 57588010, "question_id": 57579537, "link": "https://stackoverflow.com/questions/57579537/go-in-a-high-performance-http-client-for-load-testing-how-can-i-block-ignore/57588010#57588010", "title": "Go - In a high performance http client for load testing, how can I block/ignore all cookies?", "body": "<p>A cookie is just a header contained in the Response. You can't prevent a header from being returned by the server. You can only accept it and read it in memory. Although the browser can disable local cookies, it still does not prevent the server from returning a header with a set-cookie header.</p>\n\n<p>As for Fasthttp, I saw a bit of source code and find it used a lot of sync. Pool to improve performance, but I did not find that its purpose is to save memory. Its purpose is only fast. </p>\n\n<p>If you value memory very much, I recommend simply wrapping it on http/net or find another package instead of using fasthttp, which is not suitable for stress testing.</p>\n"}], "owner": {"reputation": 701, "user_id": 7355637, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AsWJn.jpg?s=128&g=1", "display_name": "Solowalker", "link": "https://stackoverflow.com/users/7355637/solowalker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1643, "favorite_count": 2, "accepted_answer_id": 57580881, "answer_count": 2, "score": 1, "last_activity_date": 1566385730, "creation_date": 1566325399, "question_id": 57579537, "link": "https://stackoverflow.com/questions/57579537/go-in-a-high-performance-http-client-for-load-testing-how-can-i-block-ignore", "title": "Go - In a high performance http client for load testing, how can I block/ignore all cookies?", "body": "<p>I'm creating tools for my company to load test our system. I currently have tools written in Python but I'm exploring options using Go, hoping for efficiency and performance gains as we need to generate millions of users simultaneously (many thousands per box with many boxes) and every little bit counts. My users primarily make http calls against our system and I need a very lightweight and efficient http client.</p>\n\n<p>For our Python tools, a previous employee had some functions manually dealing with and reusing Sockets and totally ignoring cookies. While I'm totally new to Go, I've compared multiple Go networking implementations so far and I've been happy with CPU and network usage so I don't think I need to go so far as to manually manage sockets yet, but RAM usage has been multiple times higher than in our Python solution. I have a suspicion that's due to these Go implementations automatically maintaining and managing cookies as other higher level Python libraries did the same thing. I'm looking for ways to have my http client disable/block/ignore all cookies to either solve my problem or rule out cookies as my memory bloat culprit.</p>\n\n<p>I've used a simple <code>net/http</code> <code>Get()</code> call, <a href=\"http://github.com/valyala/fasthttp\" rel=\"nofollow noreferrer\">fasthttp</a> to create a client that reuses varying numbers of connections per hosts (1000+), and creating a <code>net/http.Client</code> with and without a custom <code>Transport</code>. I've used <code>pprof</code> to memory profile each. Without overriding cookies, my http.Client flow seems to have the least memory bloat and fasthttp has the most. I've tried to go through all their docs and searched SO and the web and can't find anything that explicitly ignores or blocks cookies. Closest I found was fasthttp's <code>DelAllCookies()</code> for both requests and responses, but calling those had no discernible effect on memory usage. I've looked into <code>net/http/cookiejar</code> to set a custom jar and policy for <code>net/http.Client</code> but that looks more like a way to store and use cookie data, which I don't want to do, and I don't see a way to set a policy to ignore cookies altogether.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// fasthttp implementation\nvar httpClient *fasthttp.Client\n\nfunc init() {\n    httpClient = &amp;fasthttp.Client{\n        MaxConnsPerHost: 1000,\n    }\n}\n\nfunc fastHTTPClient(method string, uri string) (string, time.Duration) {\n\n    req := fasthttp.AcquireRequest()\n    req.Header.SetMethod(method)\n    req.SetRequestURI(uri)\n\n    resp := fasthttp.AcquireResponse()\n\n    startTime := time.Now()\n    err := httpClient.DoTimeout(req, resp, targetDuration)\n    elapsed := time.Since(startTime)\n\n    if err != nil {\n        log.Panicln(err)\n\n        body := string(resp.Body())\n        req.Header.DelAllCookies()\n        resp.Header.DelAllCookies()\n        fasthttp.ReleaseRequest(req)\n        fasthttp.ReleaseResponse(resp)\n        return body, elapsed\n    }\n\n    body := string(resp.Body())\n    req.Header.DelAllCookies()\n    resp.Header.DelAllCookies()\n    fasthttp.ReleaseRequest(req)\n    fasthttp.ReleaseResponse(resp)\n    return body, elapsed\n}\n\n// net/http implementation\nvar tr = &amp;http.Transport{}\nvar client = &amp;http.Client{Transport: tr}\n\nfunc netGet(method string, uri string) (string, time.Duration) {\n\n    startTime := time.Now()\n    resp, err := client.Get(uri)\n    elapsed := time.Since(startTime)\n\n    if err != nil {\n        log.Panic(err)\n\n        body, err2 := ioutil.ReadAll(resp.Body)\n        resp.Body.Close()\n\n        if err2 != nil {\n            log.Panic(err)\n        }\n\n        return string(body), elapsed\n    }\n\n    body, err := ioutil.ReadAll(resp.Body)\n    resp.Body.Close()\n\n    if err != nil {\n        log.Panicln(err)\n    }\n\n    return string(body), elapsed\n}\n</code></pre>\n\n<p>Again, these work functionally but when I run thousands of these concurrently using <a href=\"https://github.com/myzhan/boomer\" rel=\"nofollow noreferrer\">boomer</a> I end up using multiple GB of RAM vs 1-1.5 GB with our Python Sockets implementation. How can I block/ignore cookies or otherwise be sure cookies aren't what's eating up all my memory?</p>\n"}, {"tags": ["go", "kubectl"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1566323546, "post_id": 57578927, "comment_id": 101618096, "body": "What exactly is unclear in the error message?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1566324859, "post_id": 57578927, "comment_id": 101618611, "body": "The last <a href=\"https://github.com/kubernetes/klog/commit/cd60aa438f9c750641d5feacd2999e58df8af28f#diff-fb778b051a785bbb2eea40d6a00a3a21L1111-R1160\" rel=\"nofollow noreferrer\">commit</a> to <code>klog</code> made a braking change. Any code depending on the klog package&#39;s <code>Verbose</code> type to have the underlying type <code>bool</code>, which is the case with <code>kubernetes&#47;client-go</code>, will break. If you can, get an older version of klog on your system."}, {"owner": {"reputation": 21, "user_id": 4272472, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xIv7OQJuJLQ/AAAAAAAAAAI/AAAAAAAAABM/pbjTjlu-jxQ/photo.jpg?sz=128", "display_name": "Salim Badakhchani", "link": "https://stackoverflow.com/users/4272472/salim-badakhchani"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566332722, "post_id": 57578927, "comment_id": 101621640, "body": "@mkopriva thanks for bringing that to my attention. I will see if I can find an older version to test with."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566332951, "post_id": 57578927, "comment_id": 101621701, "body": "<a href=\"https://github.com/kubernetes/klog/releases/tag/v0.4.0\" rel=\"nofollow noreferrer\">github.com/kubernetes/klog/releases/tag/v0.4.0</a> should work"}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1566403940, "post_id": 57586415, "comment_id": 101648455, "body": "FYI, if you&#39;re using Go modules you wouldn&#39;t need to change anything under $GOPATH (e.g. your <code>..&#47;..&#47;..&#47;k8s.io</code> directory wouldn&#39;t be used) and a <code>go get github.com&#47;kubernetes&#47;klog@v0.4.0</code> run within your module would update your <code>go.mod</code> file to use the version mentioned by mkopriva."}, {"owner": {"reputation": 21, "user_id": 4272472, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xIv7OQJuJLQ/AAAAAAAAAAI/AAAAAAAAABM/pbjTjlu-jxQ/photo.jpg?sz=128", "display_name": "Salim Badakhchani", "link": "https://stackoverflow.com/users/4272472/salim-badakhchani"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566430176, "post_id": 57586415, "comment_id": 101657809, "body": "Thanks @DaveC. I thought I was probably missing a trick there!"}], "tags": [], "owner": {"reputation": 21, "user_id": 4272472, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xIv7OQJuJLQ/AAAAAAAAAAI/AAAAAAAAABM/pbjTjlu-jxQ/photo.jpg?sz=128", "display_name": "Salim Badakhchani", "link": "https://stackoverflow.com/users/4272472/salim-badakhchani"}, "is_accepted": false, "score": 0, "last_activity_date": 1566371995, "creation_date": 1566371995, "answer_id": 57586415, "question_id": 57578927, "link": "https://stackoverflow.com/questions/57578927/compilation-finished-with-exit-code-2/57586415#57586415", "title": "Compilation finished with exit code 2", "body": "<p>I got the build to finally execute but it seems there are a number of factors.</p>\n\n<ol>\n<li><p>Removed the ../../../k8s.io from my src dir.</p></li>\n<li><p>Avoid using the latest master branch of the client-go by explicitly declaring a version in the go.mod file.</p></li>\n</ol>\n\n<p>Re-running the build fetched the new sources and the stable version of the client. The build executed without errors.</p>\n"}], "owner": {"reputation": 21, "user_id": 4272472, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xIv7OQJuJLQ/AAAAAAAAAAI/AAAAAAAAABM/pbjTjlu-jxQ/photo.jpg?sz=128", "display_name": "Salim Badakhchani", "link": "https://stackoverflow.com/users/4272472/salim-badakhchani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1274, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566371995, "creation_date": 1566322665, "last_edit_date": 1566332528, "question_id": 57578927, "link": "https://stackoverflow.com/questions/57578927/compilation-finished-with-exit-code-2", "title": "Compilation finished with exit code 2", "body": "<p>I'm trying to run the example here:</p>\n\n<p><a href=\"https://github.com/kubernetes/client-go/tree/master/examples/in-cluster-client-configuration\" rel=\"nofollow noreferrer\">https://github.com/kubernetes/client-go/tree/master/examples/in-cluster-client-configuration</a></p>\n\n<p>I have set my GOROOT and GOPATH but still having problems. When I run the build I see the following error.</p>\n\n<pre><code>GOROOT=/usr/lib/golang #gosetup\nGOPATH=/home/sbadakhc/go #gosetup\n/usr/lib/golang/bin/go build -o /tmp/___go_build_main_go /home/sbadakhc/go/src/github.com/sbadakhc/gopro/main.go #gosetup\n# k8s.io/client-go/transport\n../../../k8s.io/client-go/transport/round_trippers.go:70:11: cannot convert klog.V(9) (type klog.Verbose) to type bool\n../../../k8s.io/client-go/transport/round_trippers.go:72:11: cannot convert klog.V(8) (type klog.Verbose) to type bool\n../../../k8s.io/client-go/transport/round_trippers.go:74:11: cannot convert klog.V(7) (type klog.Verbose) to type bool\n../../../k8s.io/client-go/transport/round_trippers.go:76:11: cannot convert klog.V(6) (type klog.Verbose) to type bool\n\nCompilation finished with exit code 2\n</code></pre>\n\n<p>The code.</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"time\"\n\n    \"k8s.io/apimachinery/pkg/api/errors\"\n    metav1 \"k8s.io/apimachinery/pkg/apis/meta/v1\"\n    \"k8s.io/client-go/kubernetes\"\n    \"k8s.io/client-go/rest\"\n    //\n    // Uncomment to load all auth plugins\n    _ \"k8s.io/client-go/plugin/pkg/client/auth\"\n    //\n    // Or uncomment to load specific auth plugins\n    // _ \"k8s.io/client-go/plugin/pkg/client/auth/azure\"\n    // _ \"k8s.io/client-go/plugin/pkg/client/auth/gcp\"\n    // _ \"k8s.io/client-go/plugin/pkg/client/auth/oidc\"\n    // _ \"k8s.io/client-go/plugin/pkg/client/auth/openstack\"\n)\n\nfunc main() {\n    // creates the in-cluster config\n    config, err := rest.InClusterConfig()\n    if err != nil {\n        panic(err.Error())\n    }\n    // creates the clientset\n    clientset, err := kubernetes.NewForConfig(config)\n    if err != nil {\n        panic(err.Error())\n    }\n    for {\n        pods, err := clientset.CoreV1().Pods(\"\").List(metav1.ListOptions{})\n        if err != nil {\n            panic(err.Error())\n        }\n        fmt.Printf(\"There are %d pods in the cluster\\n\", len(pods.Items))\n\n        // Examples for error handling:\n        // - Use helper functions like e.g. errors.IsNotFound()\n        // - And/or cast to StatusError and use its properties like e.g. ErrStatus.Message\n        _, err = clientset.CoreV1().Pods(\"default\").Get(\"example-xxxxx\", metav1.GetOptions{})\n        if errors.IsNotFound(err) {\n            fmt.Printf(\"Pod not found\\n\")\n        } else if statusError, isStatus := err.(*errors.StatusError); isStatus {\n            fmt.Printf(\"Error getting pod %v\\n\", statusError.ErrStatus.Message)\n        } else if err != nil {\n            panic(err.Error())\n        } else {\n            fmt.Printf(\"Found pod\\n\")\n        }\n\n        time.Sleep(10 * time.Second)\n    }\n}\n</code></pre>\n\n<p>This code should build correctly.</p>\n"}, {"tags": ["go", "documentation", "documentation-generation", "godoc"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1566322966, "post_id": 57578876, "comment_id": 101617852, "body": "As you can see from <code>godoc --help</code>, you cannot restrict it to specific packages. It doesn&#39;t really hurt anything to cover all packages though - is there a specific reason you&#39;re trying to restrict it?"}, {"owner": {"reputation": 2458, "user_id": 359910, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/1540f01a56f566e4e8e6c672b60f761d?s=128&d=identicon&r=PG", "display_name": "Brandon", "link": "https://stackoverflow.com/users/359910/brandon"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1566334267, "post_id": 57578876, "comment_id": 101622161, "body": "It&#39;s including docs for the entire Go library which doesn&#39;t make sense. There&#39;s no reason to include that in the output. It&#39;s just distracting at best."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1566395334, "post_id": 57578876, "comment_id": 101643778, "body": "Distracting how? Just go to the documentation you actually need. It&#39;s not as if it renders all the package docs on one page, you don&#39;t have to look at any docs you don&#39;t want to see. It doesn&#39;t seem like there is any downside to generating &quot;extra&quot; docs."}, {"owner": {"reputation": 81, "user_id": 5448130, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/031gV.jpg?s=128&g=1", "display_name": "MattB", "link": "https://stackoverflow.com/users/5448130/mattb"}, "edited": false, "score": 0, "creation_date": 1615503418, "post_id": 57578876, "comment_id": 117718607, "body": "I agree, the documentation is heavily weighted down to include all the standard go packages and external dependency documentation, those are available online anyway.  I don&#39;t see the need to have this information duplicated on every project level godoc instance."}], "answers": [{"comments": [{"owner": {"reputation": 2458, "user_id": 359910, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/1540f01a56f566e4e8e6c672b60f761d?s=128&d=identicon&r=PG", "display_name": "Brandon", "link": "https://stackoverflow.com/users/359910/brandon"}, "edited": false, "score": 0, "creation_date": 1566334416, "post_id": 57579140, "comment_id": 101622209, "body": "Are you aware of any documentation generation tools besides Godoc that can accomplish this?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 2458, "user_id": 359910, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/1540f01a56f566e4e8e6c672b60f761d?s=128&d=identicon&r=PG", "display_name": "Brandon", "link": "https://stackoverflow.com/users/359910/brandon"}, "edited": false, "score": 0, "creation_date": 1566359195, "post_id": 57579140, "comment_id": 101626793, "body": "@Brandon: &quot;Are you aware of any documentation generation tools besides Godoc that can accomplish this?&quot; No."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 0, "last_activity_date": 1566323585, "creation_date": 1566323585, "answer_id": 57579140, "question_id": 57578876, "link": "https://stackoverflow.com/questions/57578876/godoc-limit-documentation-to-project-not-dependencies/57579140#57579140", "title": "Godoc: Limit Documentation to Project (Not Dependencies)", "body": "<blockquote>\n  <p>Is there a way to control this and have it only generate documentation for my project code?</p>\n</blockquote>\n\n<p>No.</p>\n"}], "owner": {"reputation": 2458, "user_id": 359910, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/1540f01a56f566e4e8e6c672b60f761d?s=128&d=identicon&r=PG", "display_name": "Brandon", "link": "https://stackoverflow.com/users/359910/brandon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1566323585, "creation_date": 1566322452, "last_edit_date": 1566322839, "question_id": 57578876, "link": "https://stackoverflow.com/questions/57578876/godoc-limit-documentation-to-project-not-dependencies", "title": "Godoc: Limit Documentation to Project (Not Dependencies)", "body": "<p>I'm trying to use Godoc to generate some basic documentation for a project, but every time I do that, it adds documentation for all the Go packages as well. Is there a way to control this and have it only generate documentation for my project code?</p>\n\n<p>I'm using:</p>\n\n<pre><code>godoc -http=:6060\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 5, "creation_date": 1566321829, "post_id": 57578612, "comment_id": 101617373, "body": "Which ftp implementation you are using (there is no standard one)? Have you looked at the documentation?"}, {"owner": {"reputation": 9, "user_id": 11952912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/155e91f28f4b5f486cbb93709a872c12?s=128&d=identicon&r=PG&f=1", "display_name": "Angel", "link": "https://stackoverflow.com/users/11952912/angel"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 1, "creation_date": 1566322175, "post_id": 57578612, "comment_id": 101617495, "body": "@SteffenUllrich I am using <a href=\"https://godoc.org/github.com/jlaffaye/ftp\" rel=\"nofollow noreferrer\">godoc.org/github.com/jlaffaye/ftp</a> package to dial to the server. But I am not sure how I am supposed to make that connection secure and passive."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1566323582, "post_id": 57578612, "comment_id": 101618109, "body": "From a short look of the code it looks like that this library does passive mode by default and does not even support active mode."}, {"owner": {"reputation": 9, "user_id": 11952912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/155e91f28f4b5f486cbb93709a872c12?s=128&d=identicon&r=PG&f=1", "display_name": "Angel", "link": "https://stackoverflow.com/users/11952912/angel"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1566328141, "post_id": 57578612, "comment_id": 101619876, "body": "@SteffenUllrich I am still not able to establish the connection with the server though. Is it possible to create a secure connection with this package?"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 1, "creation_date": 1566328641, "post_id": 57578612, "comment_id": 101620100, "body": "A simple search for TLS in the documentation will likely answer this question. But, it does not make much sense to provide only snippets on where you fail when you don&#39;t provide a clue what you are trying to achieve in the first place: there is nothing known about the server and how one needs to connect to it and  you don&#39;t show any code so far."}, {"owner": {"reputation": 9, "user_id": 11952912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/155e91f28f4b5f486cbb93709a872c12?s=128&d=identicon&r=PG&f=1", "display_name": "Angel", "link": "https://stackoverflow.com/users/11952912/angel"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1566329394, "post_id": 57578612, "comment_id": 101620415, "body": "@SteffenUllrich I am not able to post the code due to privacy issues. I am trying to connect to the mainframe server via go. The mainframe server has a few more levels of security that we need to take care of. The mainframe server only accepts the file transfer via Explicit Passive mode FTP-S using TLS. So, when I use the client login function, it gives me the error of server requires authentication before User command."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 1, "creation_date": 1566331474, "post_id": 57578612, "comment_id": 101621185, "body": "Looking at the code I would say that this library does not support explicit TLS, only implicit. And as for the code: nobody expects you to provide your original code. In contrary, you should only provide a minimal version which demonstrates the actual problem you are having."}], "answers": [{"tags": [], "owner": {"reputation": 249, "user_id": 5427317, "user_type": "registered", "profile_image": "https://graph.facebook.com/955805941172568/picture?type=large", "display_name": "Sai Rahul Akarapu", "link": "https://stackoverflow.com/users/5427317/sai-rahul-akarapu"}, "is_accepted": false, "score": 1, "last_activity_date": 1566544353, "creation_date": 1566544353, "answer_id": 57621432, "question_id": 57578612, "link": "https://stackoverflow.com/questions/57578612/how-to-enter-passive-mode-for-ftp-using-golang/57621432#57621432", "title": "How to enter passive mode for FTP using Golang?", "body": "<p>If you are using <a href=\"https://github.com/secsy/goftp\" rel=\"nofollow noreferrer\">goftp</a> library, set activetranfers to false</p>\n\n<pre><code>config := goftp.Config{}\nconfig.User = userLL\nconfig.Password = passwordLL\nconfig.ActiveTransfers = false\n\nclient, err := goftp.DialConfig(config, hostLL)\nif err != nil {\n    fmt.Println(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 11952912, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/155e91f28f4b5f486cbb93709a872c12?s=128&d=identicon&r=PG&f=1", "display_name": "Angel", "link": "https://stackoverflow.com/users/11952912/angel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 436, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1566544353, "creation_date": 1566321196, "question_id": 57578612, "link": "https://stackoverflow.com/questions/57578612/how-to-enter-passive-mode-for-ftp-using-golang", "title": "How to enter passive mode for FTP using Golang?", "body": "<p>I am new to golang and am trying to connect to a server via ftp server using golang. But as the server requires me to enter in passive mode for me to connect with it. Could anyone please tell me how I can do that?</p>\n"}, {"tags": ["go", "aws-sdk", "aws-sdk-go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1566320693, "post_id": 57578317, "comment_id": 101616903, "body": "<code>Status</code> seems to be a pointer, so dereference it if you want the string."}, {"owner": {"reputation": 4669, "user_id": 3709060, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/MnFyD.jpg?s=128&g=1", "display_name": "edmamerto", "link": "https://stackoverflow.com/users/3709060/edmamerto"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566320738, "post_id": 57578317, "comment_id": 101616927, "body": "@mkopriva could you provide an example"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566320808, "post_id": 57578317, "comment_id": 101616962, "body": "<code>s := *p</code> (assign <code>s</code> the value pointed to by <code>p</code>)"}, {"owner": {"reputation": 4669, "user_id": 3709060, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/MnFyD.jpg?s=128&g=1", "display_name": "edmamerto", "link": "https://stackoverflow.com/users/3709060/edmamerto"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566320895, "post_id": 57578317, "comment_id": 101617003, "body": "@mkopriva Thanks!!"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1566321002, "post_id": 57578317, "comment_id": 101617060, "body": "note: this has nothing to do with &quot;parsing&quot; nor &quot;json&quot;. You have a Go value of a predefined struct type and you are trying to access it&#39;s fields using <a href=\"https://golang.org/ref/spec#Selectors\" rel=\"nofollow noreferrer\"><i>selector expressions</i></a> (not dot notation)"}], "answers": [{"tags": [], "owner": {"reputation": 4669, "user_id": 3709060, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/MnFyD.jpg?s=128&g=1", "display_name": "edmamerto", "link": "https://stackoverflow.com/users/3709060/edmamerto"}, "is_accepted": false, "score": 0, "last_activity_date": 1566320987, "creation_date": 1566320987, "answer_id": 57578569, "question_id": 57578317, "link": "https://stackoverflow.com/questions/57578317/accessing-fields-in-a-go-structure/57578569#57578569", "title": "Accessing fields in a GO structure", "body": "<p>As pointed out by @mkopriva</p>\n\n<p><code>Status</code> is a pointer and therefore need to be dereference when intending to extract the string.</p>\n\n<p>so to achieve extracting the value of status we can dereference it like this.</p>\n\n<pre><code>s := *result.DBClusterSnapshots[0].Status\nfmt.Println(s)\n</code></pre>\n"}], "owner": {"reputation": 4669, "user_id": 3709060, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/MnFyD.jpg?s=128&g=1", "display_name": "edmamerto", "link": "https://stackoverflow.com/users/3709060/edmamerto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1566321052, "creation_date": 1566319974, "last_edit_date": 1566321052, "question_id": 57578317, "link": "https://stackoverflow.com/questions/57578317/accessing-fields-in-a-go-structure", "title": "Accessing fields in a GO structure", "body": "<p>I am new to the Golang world and trying to parse a <code>json</code> response returned by AWS API. </p>\n\n<p>I've tried parsing the result by dot notation and seem to get success in the higher levels. Below is what my experimentation resulted to. </p>\n\n<p><em>For brevity I excluded other fields</em></p>\n\n<p><strong>Test 1</strong></p>\n\n<pre><code>fmt.Println(result)\n</code></pre>\n\n<p>returns</p>\n\n<pre><code>{\n  DBClusterSnapshots: [{\n      Status: \"available\"\n    }]\n}\n</code></pre>\n\n<p><strong>Test 2</strong></p>\n\n<pre><code>fmt.Println(result.DBClusterSnapshots[0])\n</code></pre>\n\n<p>returns</p>\n\n<pre><code>{\n    Status: \"available\"\n}\n</code></pre>\n\n<p><strong>Test 3</strong></p>\n\n<pre><code>fmt.Println(result.DBClusterSnapshots[0].Status)\n</code></pre>\n\n<p>returns what seem to be a reference to an object</p>\n\n<pre><code>0xc0001e74c8\n</code></pre>\n\n<p>Given the last example (Test 3) how do I parse it properly to get the value of <code>Status</code> which is <code>\"available\"</code></p>\n"}, {"tags": ["go", "jwt", "rsa", "auth0", "jwt-go"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1566318990, "post_id": 57577993, "comment_id": 101616206, "body": "The obvious question is: did you pass in a KeyFunc to the parse function that returns an instance of rsa.PublicKey?"}, {"owner": {"reputation": 7545, "user_id": 370605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/r8v6e.png?s=128&g=1", "display_name": "beauXjames", "link": "https://stackoverflow.com/users/370605/beauxjames"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566320153, "post_id": 57577993, "comment_id": 101616674, "body": "I have followed, verbatim, the setup recommended by Auth0 for getting this all scaffolded up with jwtMiddleware --- <a href=\"https://auth0.com/docs/quickstart/backend/golang/01-authorization\" rel=\"nofollow noreferrer\">auth0.com/docs/quickstart/backend/golang/01-authorization</a>"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566320385, "post_id": 57577993, "comment_id": 101616772, "body": "I wonder what the result of jwt.ParseRSAPublicKeyFromPEM([]byte(cert))  is. Maybe you can check the error instead of ignoring it, also printf the result to see if what it returns is really a public key"}, {"owner": {"reputation": 7545, "user_id": 370605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/r8v6e.png?s=128&g=1", "display_name": "beauXjames", "link": "https://stackoverflow.com/users/370605/beauxjames"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566324274, "post_id": 57577993, "comment_id": 101618387, "body": "the result of that method is {*crypto/rsa.PrivateKey} nil"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1566324452, "post_id": 57577993, "comment_id": 101618459, "body": "It is a private key, not a public key.  Return key.Public() instead."}, {"owner": {"reputation": 7545, "user_id": 370605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/r8v6e.png?s=128&g=1", "display_name": "beauXjames", "link": "https://stackoverflow.com/users/370605/beauxjames"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566331817, "post_id": 57577993, "comment_id": 101621320, "body": "So I changed the ParseRSAPrivateKeyFromPEM method to ParseRSAPublicKeyFromPEM and result type is *crypto/rsa.PublicKey but remains nil...how else can I communicate this issue such that it could be replicated?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566351953, "post_id": 57577993, "comment_id": 101625668, "body": "I might have misunderstood your reply. Did you mean return type is rsa.PrivateKey, but it is nil? If it is nil, it should have returned a non-nil error, and my guess is that it&#39;ll tell what&#39;s wrong with it."}, {"owner": {"reputation": 7545, "user_id": 370605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/r8v6e.png?s=128&g=1", "display_name": "beauXjames", "link": "https://stackoverflow.com/users/370605/beauxjames"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566399395, "post_id": 57577993, "comment_id": 101646096, "body": "additional inspection information added"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566400297, "post_id": 57577993, "comment_id": 101646639, "body": "I suggest you capture error information:     result, err := jwt.ParseRSAPublicKeyFromPEM([]byte(cert)), and print the error if not nil."}, {"owner": {"reputation": 7545, "user_id": 370605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/r8v6e.png?s=128&g=1", "display_name": "beauXjames", "link": "https://stackoverflow.com/users/370605/beauxjames"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566409667, "post_id": 57577993, "comment_id": 101650820, "body": "yeah...did that...still tracing it back to that crypto *PublicKey pointer but can&#39;t figure out why"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566410570, "post_id": 57577993, "comment_id": 101651161, "body": "What is the error? It appears that ParseRSAPublicKeyFromPEM is returning an error."}, {"owner": {"reputation": 7545, "user_id": 370605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/r8v6e.png?s=128&g=1", "display_name": "beauXjames", "link": "https://stackoverflow.com/users/370605/beauxjames"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566416943, "post_id": 57577993, "comment_id": 101653881, "body": "I found it. Deep in the bowels of go/1.12.8/libexec/src/encoding/pem/pem.go:82 there is a check against pemStart (&#39;\\n-----BEGIN &#39;). I had only 4 dashes when it was expecting 5. #@$!@#!@!"}], "answers": [{"tags": [], "owner": {"reputation": 7545, "user_id": 370605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/r8v6e.png?s=128&g=1", "display_name": "beauXjames", "link": "https://stackoverflow.com/users/370605/beauxjames"}, "is_accepted": true, "score": 1, "last_activity_date": 1566417469, "creation_date": 1566417469, "answer_id": 57598443, "question_id": 57577993, "link": "https://stackoverflow.com/questions/57577993/key-is-of-invalid-type-when-parsing-jwt-auth-token-in-jwt-go/57598443#57598443", "title": "Key is of Invalid Type when parsing JWT Auth token in jwt-go", "body": "<p>Found the answer. It's not a real answer, but it did fix the problem.</p>\n\n<p>Instead of '-----BEGIN' and 'END-----' I had used '----BEGIN' and 'END----' to build the cert within my middleware. </p>\n\n<p>In go/1.12.8/libexec/src/encoding/pem/pem.go:82 there is a check against '-----BEGIN' and if it fails it simply returns nil.</p>\n\n<pre><code>if bytes.HasPrefix(data, pemStart[1:]) {\n    rest = rest[len(pemStart)-1 : len(data)]\n} else if i := bytes.Index(data, pemStart); i &gt;= 0 {\n    rest = rest[i+len(pemStart) : len(data)]\n} else {\n    return nil, data\n}\n</code></pre>\n"}], "owner": {"reputation": 7545, "user_id": 370605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/r8v6e.png?s=128&g=1", "display_name": "beauXjames", "link": "https://stackoverflow.com/users/370605/beauxjames"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1286, "favorite_count": 0, "accepted_answer_id": 57598443, "answer_count": 1, "score": 0, "last_activity_date": 1588056138, "creation_date": 1566318678, "last_edit_date": 1588056138, "question_id": 57577993, "link": "https://stackoverflow.com/questions/57577993/key-is-of-invalid-type-when-parsing-jwt-auth-token-in-jwt-go", "title": "Key is of Invalid Type when parsing JWT Auth token in jwt-go", "body": "<p>I am setting up security middleware in a GoLang API and seem to have everything set up correctly, but I am getting an error \u2018key is of invalid type\u2019. </p>\n\n<p>I have confirmed that my Signing algorithm is RS256 and the middleware options are configured @ SigningMethod: jwt.SigningMethodRS256</p>\n\n<p>I have a valid token\u2026everything else in the middleware passes. </p>\n\n<p>The entry point to this error in the middleware is the jwt.ParseRSAPrivateKeyFromPEM method. </p>\n\n<p>I\u2019ve isolated the error down inside the package github.com/dgrijalva/jwt-go/rsa.go Verify() on line :62 is the ErrInvalidKeyType that is getting thrown. All the params up to the this point seem solid and appropriate (eg m|signingString|signature|key) but this key.(*rsa.PublicKey) is failing\u2026in my debugger (GoLand) I inspect *rsa and am given the response \u2018could not find symbol value for rsa\u2019\u2026</p>\n\n<pre><code>if rsaKey, ok = key.(*rsa.PublicKey); !ok {\n    return ErrInvalidKeyType\n}\n</code></pre>\n\n<p>please note\u2026if it\u2019s not already too obvious\u2026i\u2019m noob to GoLang</p>\n\n<p>----- UPDATE -----</p>\n\n<p>So at the most granular level the panic starts at go/1.12.8/libexec/src/crypto/rsa/rsa.go:49 with </p>\n\n<pre><code>func (pub *PublicKey) Size() int {\n    log.Printf(\"SIZE ::: %v :: %v\",pub.N.BitLen(), pub.N)\n    return (pub.N.BitLen() + 7) / 8\n}\n</code></pre>\n\n<p>The pub is seen as a nil pointer dereference. I trace it back to mux --></p>\n\n<blockquote>\n  <p>crypto/rsa.VerifyPKCS1v15(...)\n          /usr/local/Cellar/go/1.12.8/libexec/src/crypto/rsa/pkcs1v15.go:275</p>\n  \n  <p>github.com/dgrijalva/jwt-go.(*SigningMethodRSA).Verify(...)\n          /Users/me/Sandbox/src/github.com/dgrijalva/jwt-go/rsa.go:73</p>\n  \n  <p>github.com/dgrijalva/jwt-go.(*Parser).ParseWithClaims(...)\n          /Users/me/Sandbox/src/github.com/dgrijalva/jwt-go/parser.go:77</p>\n  \n  <p>github.com/dgrijalva/jwt-go.(*Parser).Parse(...)\n          /Users/btschirhart/Sandbox/src/github.com/dgrijalva/jwt-go/parser.go:20</p>\n  \n  <p>github.com/dgrijalva/jwt-go.Parse(...)\n          /Users/me/Sandbox/src/github.com/dgrijalva/jwt-go/token.go:89</p>\n  \n  <p>github.com/auth0/go-jwt-middleware.(*JWTMiddleware).CheckJWT(...)\n          /Users/me/Sandbox/src/github.com/auth0/go-jwt-middleware/jwtmiddleware.go:203</p>\n  \n  <p>github.com/auth0/go-jwt-middleware.(*JWTMiddleware).Handler.func1(...)\n          /Users/me/Sandbox/src/github.com/auth0/go-jwt-middleware/jwtmiddleware.go:110</p>\n  \n  <p>net/http.HandlerFunc.ServeHTTP(...)\n          /usr/local/Cellar/go/1.12.8/libexec/src/net/http/server.go:1995</p>\n  \n  <p>github.com/gorilla/mux.(*Router).ServeHTTP(...)\n          /Users/me/Sandbox/src/github.com/gorilla/mux/mux.go:210 +0xe3</p>\n</blockquote>\n"}, {"tags": ["postgresql", "go", "pgx"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1566317596, "post_id": 57577700, "comment_id": 101615535, "body": "<code>pgtype.Int4Array</code> implements <code>sql.Scanner</code>, so just use <a href=\"https://golang.org/pkg/database/sql/#Row.Scan\" rel=\"nofollow noreferrer\"><code>Row.Scan</code></a> as normal."}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1566317730, "post_id": 57577700, "comment_id": 101615597, "body": "@Flimzy Sorry, I did not understand."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1566317784, "post_id": 57577700, "comment_id": 101615618, "body": "Please show the code you&#39;re having trouble with. It will be much easier to offer an explicit suggestion that way."}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1566317811, "post_id": 57577700, "comment_id": 101615631, "body": "@Flimzy I do it this way: <code>row := tx.QueryRow(q)</code> <code>row.Scan(&amp;ids)</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1566317841, "post_id": 57577700, "comment_id": 101615652, "body": "<code>ids.AssignTo(&amp;sliceOfInt64)</code>"}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1566317981, "post_id": 57577700, "comment_id": 101615727, "body": "@CeriseLim&#243;n Thank you so mush! I have read the docs, but there are no comments in code. So it was a problem for me to find the solution"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1566318005, "creation_date": 1566318005, "answer_id": 57577822, "question_id": 57577700, "link": "https://stackoverflow.com/questions/57577700/how-to-convert-pgtype-int4array-from-pgx-library-to-int64-golang-type/57577822#57577822", "title": "How to convert pgtype.Int4Array (from pgx library) to []int64 Golang type?", "body": "<p>Use <code>ids.AssignTo(&amp;sliceOfInt64)</code></p>\n"}], "owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 485, "favorite_count": 0, "accepted_answer_id": 57577822, "answer_count": 1, "score": -1, "last_activity_date": 1566318005, "creation_date": 1566317469, "question_id": 57577700, "link": "https://stackoverflow.com/questions/57577700/how-to-convert-pgtype-int4array-from-pgx-library-to-int64-golang-type", "title": "How to convert pgtype.Int4Array (from pgx library) to []int64 Golang type?", "body": "<p>I use Go and Postgres (with <a href=\"https://github.com/jackc/pgx\" rel=\"nofollow noreferrer\">pgx driver</a>)</p>\n\n<p>In my Postgres table I have a field with array of integers.\nI have created a variable to store array of integers after scanning.</p>\n\n<pre><code>var ids pgtype.Int4Array\n</code></pre>\n\n<p>How to convert <code>ids</code> to <code>[]int64</code>?</p>\n"}, {"tags": ["go", "google-cloud-firestore", "google-cloud-datastore"], "answers": [{"comments": [{"owner": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "edited": false, "score": 0, "creation_date": 1566468406, "post_id": 57593138, "comment_id": 101669288, "body": "Thanks for helping! Yah, it&#39;s not that. The problem here is that the property is a slice, not a struct. It is the slice that is causing all the hiccups."}, {"owner": {"reputation": 732, "user_id": 4500456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fab3dad8c245703135552d2371bdbe10?s=128&d=identicon&r=PG&f=1", "display_name": "Andres S", "link": "https://stackoverflow.com/users/4500456/andres-s"}, "reply_to_user": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "edited": false, "score": 0, "creation_date": 1566594978, "post_id": 57593138, "comment_id": 101719463, "body": "can you share the part of your code where you are instantiate the datastore object  in your main function and where you call the save function ? (remember to cover you project id), I am trying to replicate this"}, {"owner": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "edited": false, "score": 0, "creation_date": 1566730942, "post_id": 57593138, "comment_id": 101741987, "body": "You mean like this?  dsClient, _ := datastore.NewClient(context.Background(), datastoreName) err := dsClient.Put(context.Background(), datastore.IncompleteKey(&quot;Phonebook&quot;, nil), &amp;phonebook)"}, {"owner": {"reputation": 732, "user_id": 4500456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fab3dad8c245703135552d2371bdbe10?s=128&d=identicon&r=PG&f=1", "display_name": "Andres S", "link": "https://stackoverflow.com/users/4500456/andres-s"}, "reply_to_user": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "edited": false, "score": 0, "creation_date": 1566838508, "post_id": 57593138, "comment_id": 101772887, "body": "I found a similar issue on the api [Github] (<a href=\"https://github.com/googleapis/google-cloud-go/issues/216\" rel=\"nofollow noreferrer\">github.com/googleapis/google-cloud-go/issues/216</a>) but it was closed due to age, probably the best way to move this forward and get a solution beyond the json workaround is to report a new issue on the repo."}, {"owner": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "edited": false, "score": 0, "creation_date": 1567325101, "post_id": 57593138, "comment_id": 101926763, "body": "Thanks for pointing the direction Andres. Just wondering if you agree this should be doable? I&#39;m guessing the authors have their reasons for not making it work. I&#39;m not fluent enough with reflection to say what is feasible and what&#39;s not."}, {"owner": {"reputation": 732, "user_id": 4500456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fab3dad8c245703135552d2371bdbe10?s=128&d=identicon&r=PG&f=1", "display_name": "Andres S", "link": "https://stackoverflow.com/users/4500456/andres-s"}, "reply_to_user": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "edited": false, "score": 0, "creation_date": 1567524626, "post_id": 57593138, "comment_id": 101984697, "body": "I think its better to create an issue on the repo and explain the situation there, and the repo contributors may address in case they consider feasible or may provide an explanation on why its not feasible."}], "tags": [], "owner": {"reputation": 732, "user_id": 4500456, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fab3dad8c245703135552d2371bdbe10?s=128&d=identicon&r=PG&f=1", "display_name": "Andres S", "link": "https://stackoverflow.com/users/4500456/andres-s"}, "is_accepted": false, "score": 0, "last_activity_date": 1566395127, "creation_date": 1566395127, "answer_id": 57593138, "question_id": 57577121, "link": "https://stackoverflow.com/questions/57577121/what-is-the-proper-way-to-save-a-slice-of-structs-into-cloud-datastore-firestor/57593138#57593138", "title": "What is the proper way to save a slice of structs into Cloud Datastore (Firestore in Datastore Mode)?", "body": "<p>I found this <a href=\"https://godoc.org/cloud.google.com/go/datastore#example-SaveStruct\" rel=\"nofollow noreferrer\">document</a> and it mentions src must be a struct pointer. </p>\n"}, {"comments": [{"owner": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "edited": false, "score": 0, "creation_date": 1566730518, "post_id": 57614881, "comment_id": 101741879, "body": "Thanks for your answer, but that&#39;s not it. I have other reasons for customizing the saving of Phonebook. I just omitted that part from the sample for brevity. It is not to avoid saving nil Contacts."}], "tags": [], "owner": {"reputation": 1030, "user_id": 4624877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f91dadad091002fe1a5a4867bc954721?s=128&d=identicon&r=PG&f=1", "display_name": "Siva", "link": "https://stackoverflow.com/users/4624877/siva"}, "is_accepted": false, "score": 0, "last_activity_date": 1566497045, "creation_date": 1566497045, "answer_id": 57614881, "question_id": 57577121, "link": "https://stackoverflow.com/questions/57577121/what-is-the-proper-way-to-save-a-slice-of-structs-into-cloud-datastore-firestor/57614881#57614881", "title": "What is the proper way to save a slice of structs into Cloud Datastore (Firestore in Datastore Mode)?", "body": "<p>The only reason you seem to customize the saving of PhoneBook seems to be to avoid saving the Contacts slice if there are no contacts. If so, you can just define your PhoneBook as follows and directly use SaveStruct on the PhoneBook object.</p>\n\n<pre><code>type Phonebook struct {\n  Contacts []Contact `datastore:\"Contacts,noindex,omitempty\"`\n  Title    string `datastore:\"Title,noindex\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 165, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1566497045, "creation_date": 1566315392, "question_id": 57577121, "link": "https://stackoverflow.com/questions/57577121/what-is-the-proper-way-to-save-a-slice-of-structs-into-cloud-datastore-firestor", "title": "What is the proper way to save a slice of structs into Cloud Datastore (Firestore in Datastore Mode)?", "body": "<p>I want to save a slice of structs in Google Cloud Datastore (Firestore in Datastore mode).</p>\n\n<p>Take this Phonebook and Contact for example.</p>\n\n<pre><code>type Contact struct {\n  Key         *datastore.Key `json:\"id\" datastore:\"__key__\"`\n  Email       string         `json:\"email\" datastore:\",noindex\"`\n  Name        string         `json:\"name\" datastore:\",noindex\"`\n}\ntype Phonebook struct {\n  Contacts []Contact\n  Title    string\n}\n</code></pre>\n\n<p>Saving and loading this struct is no problem as the <a href=\"https://godoc.org/cloud.google.com/go/datastore\" rel=\"nofollow noreferrer\">Datastore library</a> takes care of it.</p>\n\n<p>Due to the presence of some complex properties in my actual code, I need to implement <code>PropertyLoadSaver</code> methods.</p>\n\n<p>Saving the <code>Title</code> property is straightforward. But I have problems storing the slice of Contact structs.</p>\n\n<p>I tried using the <code>SaveStruct</code> method:</p>\n\n<pre><code>func (pb *Phonebook) Save() ([]datastore.Property, error) {\n  ps := []datastore.Property{\n    {\n      Name:    \"Title\",\n      Value:   pb.Title,\n      NoIndex: true,\n    },\n  }\n  ctt, err := datastore.SaveStruct(pb.Contacts)\n  if err != nil {\n    return nil, err\n  }\n  ps = append(ps, datastore.Property{\n    Name:    \"Contacts\",\n    Value:   ctt,\n    NoIndex: true,\n  })\n\n  return ps, nil\n}\n</code></pre>\n\n<p>This code compiles but doesn't work.</p>\n\n<p>The error message is <code>datastore: invalid entity type</code></p>\n\n<p>Making a slice of Property explicitly also does not work:</p>\n\n<pre><code>func (pb *Phonebook) Save() ([]datastore.Property, error) {\n  ps := []datastore.Property{\n    {\n      Name:    \"Title\",\n      Value:   pb.Title,\n      NoIndex: true,\n    },\n  }\n  cttProps := datastore.Property{\n    Name:    \"Contacts\",\n    NoIndex: true,\n  }\n  if len(pb.Contacts) &gt; 0 {\n    props := make([]interface{}, 0, len(pb.Contacts))\n    for _, contact := range pb.Contacts {\n      ctt, err := datastore.SaveStruct(contact)\n      if err != nil {\n        return nil, err\n      }\n      props = append(props, ctt)\n    }\n    cttProps.Value = props\n  }\n  ps = append(ps, cttProps)\n\n  return ps, nil\n}\n</code></pre>\n\n<p>Making a slice of Entity does not work either:</p>\n\n<pre><code>func (pb *Phonebook) Save() ([]datastore.Property, error) {\n  ps := []datastore.Property{\n    {\n      Name:    \"Title\",\n      Value:   pb.Title,\n      NoIndex: true,\n    },\n  }\n  cttProps := datastore.Property{\n    Name:    \"Contacts\",\n    NoIndex: true,\n  }\n  if len(pb.Contacts) &gt; 0 {\n    values := make([]datastore.Entity, len(pb.Contacts))\n    props := make([]interface{}, 0, len(pb.Contacts))\n    for _, contact := range pb.Contacts {\n      ctt, err := datastore.SaveStruct(contact)\n      if err != nil {\n        return nil, err\n      }\n      values = append(values, datastore.Entity{\n        Properties: ctt,\n      })\n    }\n    for _, v := range values {\n      props = append(props, v)\n    }\n    cttProps.Value = props\n  }\n  ps = append(ps, cttProps)\n\n  return ps, nil\n}\n</code></pre>\n\n<p>Both yielded the same error <code>datastore: invalid entity type</code></p>\n\n<p>Finally I resorted to using JSON. The slice of Contact is converted into a JSON array.</p>\n\n<pre><code>func (pb *Phonebook) Save() ([]datastore.Property, error) {\n  ps := []datastore.Property{\n    {\n      Name:    \"Title\",\n      Value:   pb.Title,\n      NoIndex: true,\n    },\n  }\n  var values []byte\n  if len(pb.Contacts) &gt; 0 {\n    js, err := json.Marshal(pb.Contacts)\n    if err != nil {\n      return nil, err\n    }\n    values = js\n  }\n  ps = append(ps, datastore.Property{\n    Name:    \"Contacts\",\n    Value:   values,\n    NoIndex: true,\n  })\n\n  return ps, nil\n}\n</code></pre>\n\n<p>Isn't there a better way of doing this other than using JSON?</p>\n"}, {"tags": ["go", "go-git"], "answers": [{"tags": [], "owner": {"reputation": 603, "user_id": 2904179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XMgKy.png?s=128&g=1", "display_name": "SteveCoffman", "link": "https://stackoverflow.com/users/2904179/stevecoffman"}, "is_accepted": true, "score": 0, "last_activity_date": 1566315538, "creation_date": 1566315538, "answer_id": 57577162, "question_id": 57577054, "link": "https://stackoverflow.com/questions/57577054/how-to-use-go-git-to-find-sha-of-origin-master/57577162#57577162", "title": "How to use go-git to find sha of origin/master?", "body": "<p>Whoops! <code>git rev-parse</code> is supported! Execute the following with <code>./main.go $PWD origin/master</code>:</p>\n\n<pre><code>///usr/bin/env go run \"$0\" \"$@\" ; exit \"$?\"\npackage main\n\nimport (\n    \"fmt\"\n    \"os\"\n\n    \"gopkg.in/src-d/go-git.v4\"\n    . \"gopkg.in/src-d/go-git.v4/_examples\"\n    \"gopkg.in/src-d/go-git.v4/plumbing\"\n)\n\n// Example how to resolve a revision into its commit counterpart\nfunc main() {\n    CheckArgs(\"&lt;path&gt;\", \"&lt;revision&gt;\")\n\n    path := os.Args[1]\n    revision := os.Args[2]\n\n    // We instantiate a new repository targeting the given path (the .git     folder)\n    r, err := git.PlainOpen(path)\n    CheckIfError(err)\n\n    // Resolve revision into a sha1 commit, only some revisions are resolved\n    // look at the doc to get more details\n    Info(\"git rev-parse %s\", revision)\n\n    h, err := r.ResolveRevision(plumbing.Revision(revision))\n\n    CheckIfError(err)\n\n    fmt.Println(h.String())\n}\n</code></pre>\n"}], "owner": {"reputation": 603, "user_id": 2904179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XMgKy.png?s=128&g=1", "display_name": "SteveCoffman", "link": "https://stackoverflow.com/users/2904179/stevecoffman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 471, "favorite_count": 0, "accepted_answer_id": 57577162, "answer_count": 1, "score": 0, "last_activity_date": 1566315538, "creation_date": 1566315191, "question_id": 57577054, "link": "https://stackoverflow.com/questions/57577054/how-to-use-go-git-to-find-sha-of-origin-master", "title": "How to use go-git to find sha of origin/master?", "body": "<p>I am trying to use go-git to find the SHA1 of <code>origin/master</code>, after I have already done the equivalent of <code>git fetch --all</code>. However, go-git does not appear to support either:</p>\n\n<ol>\n<li><code>git ls-remote git@github.com:StevenACoffman/toolbox.git</code></li>\n<li><code>git rev-parse origin/master</code></li>\n</ol>\n\n<p>Is there an alternative way to determine the SHA1 of <code>origin/master</code> using go-git?</p>\n"}, {"tags": ["linux", "go", "ioctl"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 9722897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfd8e5395e5db3f276022f010682ae31?s=128&d=identicon&r=PG&f=1", "display_name": "g0rbe", "link": "https://stackoverflow.com/users/9722897/g0rbe"}, "edited": false, "score": 0, "creation_date": 1566392249, "post_id": 57577010, "comment_id": 101641675, "body": "While search for <code>FS_IOC_SETFLAGS</code>, found the solution, see aboeve. Thanks for the idea :)"}], "tags": [], "owner": {"reputation": 36, "user_id": 10653205, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/biZZx.jpg?s=128&g=1", "display_name": "Adrien", "link": "https://stackoverflow.com/users/10653205/adrien"}, "is_accepted": true, "score": 0, "last_activity_date": 1566315030, "creation_date": 1566315030, "answer_id": 57577010, "question_id": 57576412, "link": "https://stackoverflow.com/questions/57576412/how-to-set-immutable-file-attribute/57577010#57577010", "title": "How to set immutable file attribute", "body": "<p>I'm not sure you're using the right ioctl here... At least chattr and the solution of <a href=\"https://stackoverflow.com/questions/32465756/setting-immutable-flag-using-ioctl-in-c\">Setting Immutable Flag using ioctl() in C</a> use <code>FS_IOC_SETFLAGS</code> (you can see what chattr does using <code>strace</code>). You can have a look at <code>/usr/include/linux/fs.h</code>, notably the big comment about \"Inode flags\", for more information.</p>\n"}], "owner": {"reputation": 33, "user_id": 9722897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dfd8e5395e5db3f276022f010682ae31?s=128&d=identicon&r=PG&f=1", "display_name": "g0rbe", "link": "https://stackoverflow.com/users/9722897/g0rbe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 0, "accepted_answer_id": 57577010, "answer_count": 1, "score": 2, "last_activity_date": 1566392377, "creation_date": 1566312994, "last_edit_date": 1566392377, "question_id": 57576412, "link": "https://stackoverflow.com/questions/57576412/how-to-set-immutable-file-attribute", "title": "How to set immutable file attribute", "body": "<p>How can I set the immutable attribute for a file with Go?</p>\n\n<p>I need a function that set/unset this attribute on a file, similar to <code>chattr +i file</code></p>\n\n<p>I found this: <a href=\"https://godoc.org/golang.org/x/sys/unix#IoctlSetInt\" rel=\"nofollow noreferrer\">IoctlSetInt</a></p>\n\n<p>how to use it?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    file, err := os.Open(\"file\")\n\n    if err != nil {\n        fmt.Printf(\"%s\\n\", err)\n        return\n    }\n\n\n    err = unix.IoctlSetInt(int(file.Fd()), unix.PERF_EVENT_IOC_MODIFY_ATTRIBUTES, unix.STATX_ATTR_IMMUTABLE)\n\n    if err != nil {\n        fmt.Printf(\"%s\\n\", err)\n    }\n</code></pre>\n\n<p>error: <code>inappropriate ioctl for device</code></p>\n\n<p><strong>SOLUTION</strong></p>\n\n<p>I found a pice of code in <a href=\"https://github.com/snapcore/snapd/blob/master/osutil/chattr.go\" rel=\"nofollow noreferrer\">snapd's repo</a>.</p>\n"}, {"tags": ["go", "protocol-buffers", "ipv6", "ipv4", "proto"], "answers": [{"tags": [], "owner": {"reputation": 7877, "user_id": 914716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0ed96380268ce904eb69d0895915cfa?s=128&d=identicon&r=PG", "display_name": "jpa", "link": "https://stackoverflow.com/users/914716/jpa"}, "is_accepted": true, "score": 1, "last_activity_date": 1566303309, "creation_date": 1566303309, "answer_id": 57573449, "question_id": 57573296, "link": "https://stackoverflow.com/questions/57573296/what-is-the-better-way-to-use-ip-field-ipv4-or-ipv6-in-proto3-file-for-golang/57573449#57573449", "title": "What is the better way to use IP field (IPV4 or IPV6) in proto3 file for Golang and C# usage", "body": "<p>If you have no performance constraints here, I would just go with a string.</p>\n\n<p>Almost any language has support for reading an ip address from a string with standard ipv4 or ipv6 notation. If you use a binary representation in a fixed32 or bytes field, you'll have to figure out a way to convert that in each language you use your protocol with.</p>\n\n<p>You may also want to specify whether it always has to be an ip address, or if a DNS hostname could be used instead.</p>\n"}], "owner": {"reputation": 39, "user_id": 10411378, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-iK15buKITXg/AAAAAAAAAAI/AAAAAAAAABM/m4slWGu4JYo/photo.jpg?sz=128", "display_name": "Avinash K R", "link": "https://stackoverflow.com/users/10411378/avinash-k-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 599, "favorite_count": 0, "accepted_answer_id": 57573449, "answer_count": 1, "score": 3, "last_activity_date": 1566303309, "creation_date": 1566302833, "question_id": 57573296, "link": "https://stackoverflow.com/questions/57573296/what-is-the-better-way-to-use-ip-field-ipv4-or-ipv6-in-proto3-file-for-golang", "title": "What is the better way to use IP field (IPV4 or IPV6) in proto3 file for Golang and C# usage", "body": "<p>I want to use an IP field in a proto3 message. Which type in proto3 should I use to represent the same. The field will be used by Golang and C# implementation. Should I use string? or fixed32 for IPV4 and bytes for IPV6? </p>\n\n<pre><code>message xyz {\n  string ip_addr = 1;\n}\n</code></pre>\n\n<p>or </p>\n\n<pre><code>message xyz {\n    oneof ip_addr{\n       fixed32 v4 = 1;\n       bytes v6 = 2;\n}\n</code></pre>\n\n<p>If it is the second one, then how to encode that in Golang implementation? Like, should I first construct a string with a valid IP address and then convert it to fixed32 format or how is it?</p>\n"}, {"tags": ["go", "visual-studio-code", "vscode-settings"], "answers": [{"comments": [{"owner": {"reputation": 43402, "user_id": 47961, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/EyOv8.jpg?s=128&g=1", "display_name": "Eugene Mayevski &#39;Callback", "link": "https://stackoverflow.com/users/47961/eugene-mayevski-callback"}, "edited": false, "score": 0, "creation_date": 1582145762, "post_id": 57573252, "comment_id": 106681148, "body": "On Windows, slashes are not supported: C:\\Projects\\Tests\\Go\\CallbackTest&gt;go mod init /Projects/Tests/Go/CallbackTest go: malformed import path &quot;/Projects/Tests/Go/CallbackTest&quot;: empty path element . Also, it&#39;s not clear, what path it should be. Unfortunately, just specifying the last part (CallbackTest) creates the .mod file, but this doesn&#39;t resolve the problem in VS Code."}, {"owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "reply_to_user": {"reputation": 43402, "user_id": 47961, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/EyOv8.jpg?s=128&g=1", "display_name": "Eugene Mayevski &#39;Callback", "link": "https://stackoverflow.com/users/47961/eugene-mayevski-callback"}, "edited": false, "score": 1, "creation_date": 1582215048, "post_id": 57573252, "comment_id": 106708619, "body": "@EugeneMayevski&#39;Callback Your first path element is empty (the one before the first <code>&#47;</code>) which is why it doesn&#39;t work. What happens when you change it and restart the language server/reload the VSCode window (it often seems to have problems with Go modules)?"}, {"owner": {"reputation": 43402, "user_id": 47961, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/EyOv8.jpg?s=128&g=1", "display_name": "Eugene Mayevski &#39;Callback", "link": "https://stackoverflow.com/users/47961/eugene-mayevski-callback"}, "edited": false, "score": 0, "creation_date": 1582227562, "post_id": 57573252, "comment_id": 106714670, "body": "Thank you for the explanation! Restarting doesn&#39;t solve anything, unfortunately. I&#39;ve ended up with &quot;callback/callbacktest&quot; as the module name. Got the following in VSCode log: Starting building the current package at c:\\Projects\\Tests\\Go\\CallbackTest Not able to determine import path of current package by using cwd: c:\\Projects\\Tests\\Go\\CallbackTest and Go workspace:    I.e. nothing has changed for me after restart of VS Code."}], "tags": [], "owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "is_accepted": true, "score": 1, "last_activity_date": 1582973222, "last_edit_date": 1582973222, "creation_date": 1566302666, "answer_id": 57573252, "question_id": 57572507, "link": "https://stackoverflow.com/questions/57572507/how-do-i-fix-vs-code-error-not-able-to-determine-import-path-of-current-packag/57573252#57573252", "title": "How do I fix VS Code error: &quot;Not able to determine import path of current package by using cwd&quot; for Go project", "body": "<p>Since your package is outside of <code>$GOPATH</code>, you may need to create a module file.</p>\n\n<p>You'll need to init your go module using</p>\n\n<pre><code>go mod init your.import/path\n</code></pre>\n\n<p>Change the import path to whatever you like.\nThis way you set the import path explicitly, which might help fix it.</p>\n\n<p>The resulting <code>go.mod</code> file looks like this:</p>\n\n<pre><code>module your.import/path\n\ngo 1.14  // Your go version\n</code></pre>\n\n<p>So if the <code>go.mod</code> file is in the same directory as a <code>main.go</code> file, you can now import submodules from it:</p>\n\n<p>E.g. <code>main.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n   \"your.import/path/somepackage\" // Import package from a subdirectory. This only works if `go.mod` has been created as above\n)\n\nfunc main() {\n    somepackage.SomeMethod()\n}\n</code></pre>\n\n<p>And in <code>somepackage/whatever.go</code>:</p>\n\n<pre><code>package somepackage\n\nimport \"fmt\"\n\nfunc SomeMethod() {\n    fmt.Println(\"Success!\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user11352107"}, "is_accepted": false, "score": 0, "last_activity_date": 1601485436, "creation_date": 1601485436, "answer_id": 64142433, "question_id": 57572507, "link": "https://stackoverflow.com/questions/57572507/how-do-i-fix-vs-code-error-not-able-to-determine-import-path-of-current-packag/64142433#64142433", "title": "How do I fix VS Code error: &quot;Not able to determine import path of current package by using cwd&quot; for Go project", "body": "<p>if you are using vs code, check if the go and code runner extensions are enabled, if enabled, try disabling and enabling again, and if not, install and enable, and download all requested packages.</p>\n"}], "owner": {"reputation": 685, "user_id": 6407609, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fd009e4ccebac72e3cd3bcacc2f9ad66?s=128&d=identicon&r=PG&f=1", "display_name": "Loading...", "link": "https://stackoverflow.com/users/6407609/loading"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5482, "favorite_count": 0, "accepted_answer_id": 57573252, "answer_count": 2, "score": 2, "last_activity_date": 1601485436, "creation_date": 1566300091, "last_edit_date": 1566303926, "question_id": 57572507, "link": "https://stackoverflow.com/questions/57572507/how-do-i-fix-vs-code-error-not-able-to-determine-import-path-of-current-packag", "title": "How do I fix VS Code error: &quot;Not able to determine import path of current package by using cwd&quot; for Go project", "body": "<p>I'm following tutorials and I think I may have missed something. </p>\n\n<p>I have a Go project located at:</p>\n\n<p><code>/Users/just_me/development/testing/golang/example_server</code></p>\n\n<p>The contents are:\n<code>main.go</code></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n\n    fmt.Println(\"hi world\")\n}\n</code></pre>\n\n<p>I have a <code>~/go</code> directory.</p>\n\n<p>go env shows:</p>\n\n<pre><code>GOPATH=\"/Users/just_me/go\"\nGOROOT=\"/usr/local/Cellar/go/1.12.9/libexec\"\n</code></pre>\n\n<p>I installed the suggested packages in VSCode.</p>\n\n<p>When I save my <code>main.go</code> I get:</p>\n\n<pre><code>Not able to determine import path of current package by using cwd: /Users/just_me/development/testing/golang/example_server and Go workspace: \n/Users/just_me/development/testing/golang/example_server&gt;\n</code></pre>\n\n<p>How do I fix this?</p>\n"}, {"tags": ["go", "cgo", "libsodium"], "answers": [{"tags": [], "owner": {"reputation": 36, "user_id": 10653205, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/biZZx.jpg?s=128&g=1", "display_name": "Adrien", "link": "https://stackoverflow.com/users/10653205/adrien"}, "is_accepted": false, "score": 1, "last_activity_date": 1566315413, "creation_date": 1566315413, "answer_id": 57577130, "question_id": 57570179, "link": "https://stackoverflow.com/questions/57570179/include-libsodium-using-cgo-in-go-project-fails/57577130#57577130", "title": "Include libsodium using cgo in go project fails", "body": "<p>You indeed need to link the library, the headers themselves are only the interface to the library and don't link the actual libsodium code to your binary.</p>\n\n<p>Assuming libsodium ships a pkg-config file (it seems to be the case), you can use something like</p>\n\n<pre><code>// #cgo pkg-config: libsodium\n// #include \"crypto_sign_ed25519.h\"\n</code></pre>\n\n<p>See <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">https://golang.org/cmd/cgo/</a> for more information about pkg-config support.</p>\n\n<p>To see what cflags/libs you'd be getting (so what cgo will use), run:</p>\n\n<pre><code>pkg-config --cflags --libs libsodium\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 508, "user_id": 4428183, "user_type": "registered", "accept_rate": 11, "profile_image": "https://i.stack.imgur.com/BvapX.jpg?s=128&g=1", "display_name": "manolodewiner", "link": "https://stackoverflow.com/users/4428183/manolodewiner"}, "edited": false, "score": 0, "creation_date": 1566378927, "post_id": 57581003, "comment_id": 101633965, "body": "I am using cgo!"}, {"owner": {"reputation": 1378, "user_id": 953439, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LgYlS.jpg?s=128&g=1", "display_name": "Frank Denis", "link": "https://stackoverflow.com/users/953439/frank-denis"}, "reply_to_user": {"reputation": 508, "user_id": 4428183, "user_type": "registered", "accept_rate": 11, "profile_image": "https://i.stack.imgur.com/BvapX.jpg?s=128&g=1", "display_name": "manolodewiner", "link": "https://stackoverflow.com/users/4428183/manolodewiner"}, "edited": false, "score": 0, "creation_date": 1566432121, "post_id": 57581003, "comment_id": 101658151, "body": "This is a shared library, so it totally applies to cgo as well. I just added this to the documentation. And calling sodium_init() is also mandatory for Go applications."}, {"owner": {"reputation": 508, "user_id": 4428183, "user_type": "registered", "accept_rate": 11, "profile_image": "https://i.stack.imgur.com/BvapX.jpg?s=128&g=1", "display_name": "manolodewiner", "link": "https://stackoverflow.com/users/4428183/manolodewiner"}, "edited": false, "score": 0, "creation_date": 1566465276, "post_id": 57581003, "comment_id": 101667553, "body": "NOO, there is no necessity of calling sodium_init()"}, {"owner": {"reputation": 1378, "user_id": 953439, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LgYlS.jpg?s=128&g=1", "display_name": "Frank Denis", "link": "https://stackoverflow.com/users/953439/frank-denis"}, "reply_to_user": {"reputation": 508, "user_id": 4428183, "user_type": "registered", "accept_rate": 11, "profile_image": "https://i.stack.imgur.com/BvapX.jpg?s=128&g=1", "display_name": "manolodewiner", "link": "https://stackoverflow.com/users/4428183/manolodewiner"}, "edited": false, "score": 0, "creation_date": 1566466678, "post_id": 57581003, "comment_id": 101668330, "body": "sodium_init() must be called, or internal data structures may not be initialized. (I&#39;m libsodium&#39;s author)."}, {"owner": {"reputation": 1378, "user_id": 953439, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LgYlS.jpg?s=128&g=1", "display_name": "Frank Denis", "link": "https://stackoverflow.com/users/953439/frank-denis"}, "reply_to_user": {"reputation": 508, "user_id": 4428183, "user_type": "registered", "accept_rate": 11, "profile_image": "https://i.stack.imgur.com/BvapX.jpg?s=128&g=1", "display_name": "manolodewiner", "link": "https://stackoverflow.com/users/4428183/manolodewiner"}, "edited": false, "score": 0, "creation_date": 1566467341, "post_id": 57581003, "comment_id": 101668696, "body": "You can see how they use cgo, initialize the library and include &lt;sodium.h&gt; and not individual headers: <a href=\"https://github.com/jamesruan/sodium/blob/master/core.go\" rel=\"nofollow noreferrer\">github.com/jamesruan/sodium/blob/master/core.go</a> - The ldconfig step is also required on Linux, no matter what language you use, since this is a  library loaded by the dynamic linker. This is now explicitly mentioned <a href=\"https://download.libsodium.org/doc/installation#compilation-on-unix-like-systems\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 508, "user_id": 4428183, "user_type": "registered", "accept_rate": 11, "profile_image": "https://i.stack.imgur.com/BvapX.jpg?s=128&g=1", "display_name": "manolodewiner", "link": "https://stackoverflow.com/users/4428183/manolodewiner"}, "edited": false, "score": 0, "creation_date": 1566569334, "post_id": 57581003, "comment_id": 101709490, "body": "It is not needed. I am using it without it. Check an example <a href=\"https://github.com/GoKillers/libsodium-go\" rel=\"nofollow noreferrer\">github.com/GoKillers/libsodium-go</a>"}, {"owner": {"reputation": 1378, "user_id": 953439, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LgYlS.jpg?s=128&g=1", "display_name": "Frank Denis", "link": "https://stackoverflow.com/users/953439/frank-denis"}, "reply_to_user": {"reputation": 508, "user_id": 4428183, "user_type": "registered", "accept_rate": 11, "profile_image": "https://i.stack.imgur.com/BvapX.jpg?s=128&g=1", "display_name": "manolodewiner", "link": "https://stackoverflow.com/users/4428183/manolodewiner"}, "edited": false, "score": 0, "creation_date": 1566570173, "post_id": 57581003, "comment_id": 101709917, "body": "If you don&#39;t do it, some functions will make the whole app crash (e.g. anything that requires randomness or memory allocation), and other functions will currently fall back to their slowest implementations since CPU features haven&#39;t been probed. Using the library without initialization should be considered undefined behavior, and what happens can change at any time. libsodium-go, that you are referring to, has the same code as James Ruan&#39;s Sodium bindings: <a href=\"https://github.com/GoKillers/libsodium-go/blob/master/sodium/core.go\" rel=\"nofollow noreferrer\">github.com/GoKillers/libsodium-go/blob/master/sodium/core.go</a>"}, {"owner": {"reputation": 1378, "user_id": 953439, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LgYlS.jpg?s=128&g=1", "display_name": "Frank Denis", "link": "https://stackoverflow.com/users/953439/frank-denis"}, "reply_to_user": {"reputation": 508, "user_id": 4428183, "user_type": "registered", "accept_rate": 11, "profile_image": "https://i.stack.imgur.com/BvapX.jpg?s=128&g=1", "display_name": "manolodewiner", "link": "https://stackoverflow.com/users/4428183/manolodewiner"}, "edited": false, "score": 0, "creation_date": 1566570578, "post_id": 57581003, "comment_id": 101710130, "body": "Even in the current version, signatures will cause the application to crash if the library has been compiled with non-deterministic signatures, and hasn&#39;t been initialized. And headers such as <code>crypto_sign_ed25519.h</code> may also be renamed or removed at any time, so I&#39;d recommend simply including <code>&lt;sodium.h&gt;</code> as documented."}], "tags": [], "owner": {"reputation": 1378, "user_id": 953439, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LgYlS.jpg?s=128&g=1", "display_name": "Frank Denis", "link": "https://stackoverflow.com/users/953439/frank-denis"}, "is_accepted": false, "score": -1, "last_activity_date": 1566467808, "last_edit_date": 1566467808, "creation_date": 1566332226, "answer_id": 57581003, "question_id": 57570179, "link": "https://stackoverflow.com/questions/57570179/include-libsodium-using-cgo-in-go-project-fails/57581003#57581003", "title": "Include libsodium using cgo in go project fails", "body": "<p>After manually installing a library on Linux, you have to type <code>ldconfig</code> so that the linker becomes aware of it.</p>\n\n<p>Also, in order to get libsodium prototypes, you should simply include <code>&lt;sodium.h&gt;</code> not <code>&lt;sodium/crypto_sign_ed25519.h&gt;</code> (not meant to be included directly), and call <code>sodium_init()</code> before any other function so that internal data structures are properly initialized.</p>\n\n<p>See how this is done in existing bindings for Go: <a href=\"https://github.com/jamesruan/sodium/blob/master/core.go\" rel=\"nofollow noreferrer\">https://github.com/jamesruan/sodium/blob/master/core.go</a></p>\n\n<p>You may want to use these bindings instead of reinventing your own. If they are missing some of the functions you need, their maintainers will probably be happy to accept your pull requests.</p>\n\n<p>The two main Go bindings for libsodium that I am aware of are <a href=\"https://github.com/jamesruan/sodium\" rel=\"nofollow noreferrer\">sodium</a> and <a href=\"https://github.com/GoKillers/libsodium-go\" rel=\"nofollow noreferrer\">libsodium-go</a>.</p>\n"}], "owner": {"reputation": 508, "user_id": 4428183, "user_type": "registered", "accept_rate": 11, "profile_image": "https://i.stack.imgur.com/BvapX.jpg?s=128&g=1", "display_name": "manolodewiner", "link": "https://stackoverflow.com/users/4428183/manolodewiner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 174, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1566467808, "creation_date": 1566291818, "last_edit_date": 1566295702, "question_id": 57570179, "link": "https://stackoverflow.com/questions/57570179/include-libsodium-using-cgo-in-go-project-fails", "title": "Include libsodium using cgo in go project fails", "body": "<p>I am trying to include the <a href=\"https://github.com/jedisct1/libsodium\" rel=\"nofollow noreferrer\">libsodium</a> into my Go project. For that, I've copied the repo inside my project</p>\n\n<pre><code>// #cgo CFLAGS: -I/mypath/libsodium/src/libsodium/include/sodium\n// #include &lt;stdlib.h&gt;\n// #include \"crypto_sign_ed25519.h\"\nimport \"C\"\n</code></pre>\n\n<p>When trying to build the project I get the following error:</p>\n\n<pre><code>/tmp/go-build/cgo-gcc-prolog:53: undefined reference to `crypto_sign_ed25519_pk_to_curve25519'\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>The file can be found but the error is there.\nI've also tried to reference the '.c' file as well as to copy the <code>crypto_sign_ed25519.h</code> into the src folder but it does not work.\nMy question is do I have to add <code>LDFLAGS</code> and therefore generate a <code>.so</code> file from the library or that is not needed and there is another possible way of doing it?</p>\n\n<p><strong><em>UPDATE</em></strong>: I've achieved to make it running by installing the library on my local ubuntu:</p>\n\n<pre><code>$ ./configure\n$ make &amp;&amp; make check\n$ sudo make install\n</code></pre>\n\n<p>and adding \n<code>// #cgo LDFLAGS: -L/usr/local/lib -lsodium</code>\nBut how can I do it without adding the local path?</p>\n"}, {"tags": ["python", "rest", "go", "rabbitmq", "microservices"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user11044402"}, "edited": false, "score": 2, "creation_date": 1566284095, "post_id": 57567958, "comment_id": 101597042, "body": "Take a look at the <a href=\"https://www.rabbitmq.com/tutorials/tutorial-six-python.html\" rel=\"nofollow noreferrer\">RPC feature of RabbitMQ</a>."}, {"owner": {"reputation": 37873, "user_id": 1202421, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f9ecf725ab72554a6fb27e979e3cd0a6?s=128&d=identicon&r=PG", "display_name": "Pedro Werneck", "link": "https://stackoverflow.com/users/1202421/pedro-werneck"}, "edited": false, "score": 0, "creation_date": 1566309447, "post_id": 57567958, "comment_id": 101610890, "body": "If you need a synchronous response, you&#39;ll need a callback queue for each request. It&#39;s messy, but it&#39;s the only way.   The real question is if you really need synchronous responses. If you need to tie it to the HTTP request, and you are willing to keep the HTTP client waiting for the response, why are you even using rabbitmq and separate consumers? Just keep it all on the HTTP service."}], "owner": {"reputation": 11, "user_id": 11949948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85f9335d7808b3fdfdf60b33dd4aca5f?s=128&d=identicon&r=PG&f=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/11949948/mike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1566283251, "creation_date": 1566283251, "question_id": 57567958, "link": "https://stackoverflow.com/questions/57567958/how-to-syncronyze-rabbitmq-messages", "title": "How to syncronyze rabbitmq messages?", "body": "<p>I have an application(APP), and now i need to integrate with some service(SERVICE-1) which supports communication through rabbitmq(sending request to one queue and listen for response in another one), i decided to move all the rabbitmq part to separate service(SERVICE-2) and communicate with it through REST api calls.</p>\n\n<p>The problem is - in APP i need a synchronous response to my call, so SERVICE-2 need somehow to synchronize those request:\nlike it needs to get a HTTP request -> send request to rabbitmq -> wait for response from rabbitmq -> give HTTP response back in a single HTTP session.</p>\n\n<p>But responses in rabbitmq may be in other order, for example i send requests with id 1,2,3 and receive back them in order 3,1,2</p>\n"}, {"tags": ["go", "types"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1566283714, "post_id": 57567917, "comment_id": 101596875, "body": "You are passing a pointer to an interface to UnmarshalMap. Don&#39;t do that. Change constructor to return  <code>*MyDynamoDBItemType</code>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1566285033, "post_id": 57567917, "comment_id": 101597456, "body": "What is the definition of <code>MyDynamoDBItemType</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 84, "user_id": 11484375, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Ci0LH8WkltQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfXUaM9_bZrD__rzBzJESn9PAQB_w/mo/photo.jpg?sz=128", "display_name": "polo xue", "link": "https://stackoverflow.com/users/11484375/polo-xue"}, "is_accepted": true, "score": 0, "last_activity_date": 1566304429, "last_edit_date": 1566304429, "creation_date": 1566284398, "answer_id": 57568211, "question_id": 57567917, "link": "https://stackoverflow.com/questions/57567917/dynamodbattribute-unmarshalmap-canges-the-type-of-my-variable-to-mapstringinte/57568211#57568211", "title": "dynamodbattribute.UnmarshalMap canges the type of my variable to map[string]interface{}", "body": "<p>The type of variable <code>myItem</code> is <code>interface{}</code>, and the type of <code>UnmarshalMap</code> input param is <code>interface{}</code> too. There is no comparison of underlying types when assigning values</p>\n\n<p>A example is as follows:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc Item() interface{} {\n    return struct {\n        Name string\n    }{Name: \"poloxue\"}\n}\n\nfunc ItemMap(item *interface{}) {\n    *item = map[string]interface{}{\n        \"Name\": \"poloxue\",\n    }\n}\n\nfunc main() {\n    m := Item()\n    fmt.Printf(\"%T\\n\", m)\n    ItemMap(&amp;m)\n    fmt.Printf(\"%T\\n\", m)\n}\n</code></pre>\n\n<p>If you want to unmarshal map to struct , try <a href=\"https://github.com/mitchellh/mapstructure\" rel=\"nofollow noreferrer\">mapstructure</a> package?</p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 3, "last_activity_date": 1566284887, "creation_date": 1566284887, "answer_id": 57568342, "question_id": 57567917, "link": "https://stackoverflow.com/questions/57567917/dynamodbattribute-unmarshalmap-canges-the-type-of-my-variable-to-mapstringinte/57568342#57568342", "title": "dynamodbattribute.UnmarshalMap canges the type of my variable to map[string]interface{}", "body": "<p>Your function is far too complex. Stop trying to force a \"generics\" mindset into Go. Just do this:</p>\n\n<pre><code>func GetItem(i interface{}) {\n  _ = dynamodbattribute.UnmarshalMap(item, &amp;i)\n}\n</code></pre>\n\n<p>But don't ignore errors:</p>\n\n<pre><code>func GetItem(i interface{}) error {\n  return dynamodbattribute.UnmarshalMap(item, &amp;i)\n}\n</code></pre>\n\n<p>But then you don't need your function at all... just use</p>\n\n<pre><code>dynamodbattribute.UnmarshalMap(item, &amp;i)\n</code></pre>\n\n<p>as intended.</p>\n"}], "owner": {"reputation": 5325, "user_id": 491605, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/94756649108cec79484192fccd1a89f2?s=128&d=identicon&r=PG", "display_name": "Nathan", "link": "https://stackoverflow.com/users/491605/nathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 70, "favorite_count": 0, "accepted_answer_id": 57568211, "answer_count": 2, "score": -1, "last_activity_date": 1566304429, "creation_date": 1566283043, "last_edit_date": 1566284692, "question_id": 57567917, "link": "https://stackoverflow.com/questions/57567917/dynamodbattribute-unmarshalmap-canges-the-type-of-my-variable-to-mapstringinte", "title": "dynamodbattribute.UnmarshalMap canges the type of my variable to map[string]interface{}", "body": "<p><strong>Background</strong></p>\n\n<p>I am trying to Unmarshal an item returned by <code>dynamodb.GetItem</code> into an object, which type I do not know at that place.\nFor this I have a function <code>emptyItemConstructor</code> which returns a new object t of the desired type.</p>\n\n<p><strong>Question</strong></p>\n\n<p>I have a function like this:</p>\n\n<pre><code>func GetItem(emptyItemConstructor func() interface{}) interface{} {\n  myItem := emptyItemConstructor()\n  fmt.Printf(\"Type is: %T\\n\", myItem)\n  _ = dynamodbattribute.UnmarshalMap(item, &amp;myItem)\n  fmt.Printf(\"Type now is: %T\\n\", myItem)\n}\n\n</code></pre>\n\n<p>and I am passing this function for <code>emptyItemConstructor</code>:</p>\n\n<pre><code>func constructor() MyDynamoDBItemType {\n    return MyDynamoDBItemType{}\n}\n</code></pre>\n\n<p>The output of the function is:</p>\n\n<pre><code>Type is: MyDynamoDBItemType\nType now is: map[string]interface\n</code></pre>\n\n<p>Why is UnmarshalMap changing the type of myItem?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 4, "creation_date": 1566281124, "post_id": 57567466, "comment_id": 101595859, "body": "What&#39;s the use case?"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1566281310, "post_id": 57567466, "comment_id": 101595930, "body": "The main issue here is that you cannot, via reflection, <i>set</i> any unexported field (since Go 1.8). Since <code>a</code> and <code>b</code> are both unexported, you will only be able to create a zero-valued <code>Data</code> object."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1566281458, "post_id": 57567466, "comment_id": 101595968, "body": "Yes you can create structs via reflection."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1566282302, "post_id": 57567466, "comment_id": 101596278, "body": "The function <a href=\"https://godoc.org/reflect#StructOf\" rel=\"nofollow noreferrer\">godoc.org/reflect#StructOf</a> will get you most of the way there.  The unexported fields shown in the question are not supported."}, {"owner": {"reputation": 219, "user_id": 10970002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0997553955eaf7ff70071d17ee5bd1f?s=128&d=identicon&r=PG&f=1", "display_name": "mazei513", "link": "https://stackoverflow.com/users/10970002/mazei513"}, "reply_to_user": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 2, "creation_date": 1566300607, "post_id": 57567466, "comment_id": 101605566, "body": "I&#39;m with @bereal here, why is this needed? There might be another way that doesn&#39;t rely on reflection and etc."}], "answers": [{"tags": [], "owner": {"reputation": 36, "user_id": 11951701, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/8d3e2014fd43348b31e03b2de8c3ec23?s=128&d=identicon&r=PG", "display_name": "asethi", "link": "https://stackoverflow.com/users/11951701/asethi"}, "is_accepted": true, "score": 2, "last_activity_date": 1566305822, "last_edit_date": 1566305822, "creation_date": 1566305348, "answer_id": 57574086, "question_id": 57567466, "link": "https://stackoverflow.com/questions/57567466/create-a-struct-by-reflection-in-go/57574086#57574086", "title": "Create a struct by reflection in Go", "body": "<p>An application can create a struct programmatically using <a href=\"https://godoc.org/reflect#StructOf\" rel=\"nofollow noreferrer\">reflect.StructOf</a>, but all fields in the struct must be <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">exported</a>. </p>\n\n<p>The question gets the struct as a value, but it's likely that a pointer to the struct is more useful to the application.</p>\n\n<p>Given the above, this answer shows how to do the following without defining the type at compile time:</p>\n\n<pre><code>type Data struct {\n   A string `json:\"a\"`\n   B int `json:\"b\"`\n}\nvar d interface{} = &amp;Data{}\n</code></pre>\n\n<p>The code is:</p>\n\n<pre><code>t := reflect.StructOf([]reflect.StructField{\n    {\n        Name: \"A\",\n        Type: reflect.TypeOf(int(0)),\n        Tag:  `json:\"a\"`,\n    },\n    {\n        Name: \"B\",\n        Type: reflect.TypeOf(\"\"),\n        Tag:  `json:\"B\"`,\n    },\n})\nd := reflect.New(t).Interface()\n</code></pre>\n\n<p>Here's a runnable example that sets some fields: <a href=\"https://play.golang.org/p/uik7Ph8_BRH\" rel=\"nofollow noreferrer\">https://play.golang.org/p/uik7Ph8_BRH</a></p>\n"}], "owner": {"reputation": 2512, "user_id": 1050389, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/9544928845a390ba53444700e96064b4?s=128&d=identicon&r=PG", "display_name": "aclowkay", "link": "https://stackoverflow.com/users/1050389/aclowkay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 334, "favorite_count": 0, "accepted_answer_id": 57574086, "answer_count": 1, "score": -1, "last_activity_date": 1566305822, "creation_date": 1566280842, "question_id": 57567466, "link": "https://stackoverflow.com/questions/57567466/create-a-struct-by-reflection-in-go", "title": "Create a struct by reflection in Go", "body": "<p>I want to define a struct completely dynamically, so that I can get the following struct, but without defining it first?</p>\n\n<pre><code>type Data struct {\n   a string\n   b int `json:\"b\"`\n}\nd := Data{}\n</code></pre>\n"}, {"tags": ["git", "go", "go-git"], "answers": [{"comments": [{"owner": {"reputation": 603, "user_id": 2904179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XMgKy.png?s=128&g=1", "display_name": "SteveCoffman", "link": "https://stackoverflow.com/users/2904179/stevecoffman"}, "edited": false, "score": 0, "creation_date": 1566328278, "post_id": 57566802, "comment_id": 101619940, "body": "Ah thanks! I coded up your answer and it worked great."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1566275874, "creation_date": 1566275874, "answer_id": 57566802, "question_id": 57566661, "link": "https://stackoverflow.com/questions/57566661/use-go-git-to-check-if-branch-has-been-pushed-to-remote/57566802#57566802", "title": "Use go-git to check if branch has been pushed to remote", "body": "<p>That was requested in <a href=\"https://github.com/src-d/go-git/issues/1161\" rel=\"nofollow noreferrer\"><code>go-git</code> issue 1161</a> and delivered in <a href=\"https://github.com/src-d/go-git/releases/tag/v4.12.0\" rel=\"nofollow noreferrer\"><code>go-git</code> v4.12.0</a>, with <a href=\"https://github.com/src-d/go-git/pull/1096\" rel=\"nofollow noreferrer\">PR 1096</a> and <a href=\"https://github.com/src-d/go-git/pull/1097\" rel=\"nofollow noreferrer\">PR 1097</a>.</p>\n\n<p>You can use the command <strong><code>merge-base</code></strong> to check if the common ancestor of <code>master</code> and <code>origin/master</code> is the same (you have pushed everything) or not (you have local commits that you have not pushed, or the opposite, you are behind <code>origin/master</code>)</p>\n"}, {"tags": [], "owner": {"reputation": 603, "user_id": 2904179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XMgKy.png?s=128&g=1", "display_name": "SteveCoffman", "link": "https://stackoverflow.com/users/2904179/stevecoffman"}, "is_accepted": true, "score": 1, "last_activity_date": 1566328285, "creation_date": 1566328285, "answer_id": 57580175, "question_id": 57566661, "link": "https://stackoverflow.com/questions/57566661/use-go-git-to-check-if-branch-has-been-pushed-to-remote/57580175#57580175", "title": "Use go-git to check if branch has been pushed to remote", "body": "<p>I followed VonC's answer and coded up a solution.</p>\n\n<pre><code>func main() {\n  dir, err := os.Getwd()\n  CheckIfError(err)\n\n  repo, err := git.PlainOpen(dir)\n  CheckIfError(err)\n\n  revision := \"origin/master\"\n\n  revHash, err := repo.ResolveRevision(plumbing.Revision(revision))\n  CheckIfError(err)\n  revCommit, err := repo.CommitObject(*revHash)\n\n  CheckIfError(err)\n\n  headRef, err := repo.Head()\n  CheckIfError(err)\n  // ... retrieving the commit object\n  headCommit, err := repo.CommitObject(headRef.Hash())\n  CheckIfError(err)\n\n  isAncestor, err := headCommit.IsAncestor(revCommit)\n\n  CheckIfError(err)\n\n  fmt.Printf(\"Is the HEAD an IsAncestor of origin/master? : %v\\n\",isAncestor)\n}\n</code></pre>\n\n<p><a href=\"https://gist.github.com/StevenACoffman/fbfa8be33470c097c068f86bcf4a436b\" rel=\"nofollow noreferrer\">Gist here</a></p>\n"}], "owner": {"reputation": 603, "user_id": 2904179, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XMgKy.png?s=128&g=1", "display_name": "SteveCoffman", "link": "https://stackoverflow.com/users/2904179/stevecoffman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 933, "favorite_count": 1, "accepted_answer_id": 57580175, "answer_count": 2, "score": 2, "last_activity_date": 1566328285, "creation_date": 1566274606, "last_edit_date": 1566285357, "question_id": 57566661, "link": "https://stackoverflow.com/questions/57566661/use-go-git-to-check-if-branch-has-been-pushed-to-remote", "title": "Use go-git to check if branch has been pushed to remote", "body": "<p>Using go-git, is there any way to check if I have made a commit, but have not yet pushed it to a remote?</p>\n\n<p>For instance:</p>\n\n<pre><code>$ echo \"Hello\" &gt; hello.txt\n$ git add -A\n$ git commit -am \"Add hello\"\n$ git status\nOn branch master\nYour branch is ahead of 'origin/master' by 2 commits.\n  (use \"git push\" to publish your local commits)\n\nnothing to commit, working tree clean\n</code></pre>\n\n<p>I know I can use go-git to check <code>w,_ = repo.Worktree()</code> and <code>w.Status()</code>, but that doesn't seem to give me what I'm after, unless I'm missing something.</p>\n"}, {"tags": ["go", "singleton", "state"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1566256523, "post_id": 57564929, "comment_id": 101591423, "body": "The problem is unrelated to the singleton.  Because the method has a value receiver, any changes made to the receiver argument are discarded when the method returns."}, {"owner": {"reputation": 1, "user_id": 9636528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47d24256d181df8e8e8635b51b47bbfd?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Shullick", "link": "https://stackoverflow.com/users/9636528/michael-shullick"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1566256688, "post_id": 57564929, "comment_id": 101591447, "body": "Ah, so the receiver is shadowing the global instance? How/why/when do receivers act like pass-by-value parameters?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1566257028, "post_id": 57564929, "comment_id": 101591514, "body": "All arguments, including the receiver, are passed by value in Go.  Possible duplicate of <a href=\"https://stackoverflow.com/questions/11810218/how-to-set-and-get-fields-in-structs-method\" title=\"how to set and get fields in structs method\">stackoverflow.com/questions/11810218/&hellip;</a>, <a href=\"https://stackoverflow.com/questions/6476343/using-a-setter-for-a-struct-type-does-not-work-as-anticipated\" title=\"using a setter for a struct type does not work as anticipated\">stackoverflow.com/questions/6476343/&hellip;</a>,"}, {"owner": {"reputation": 1, "user_id": 9636528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47d24256d181df8e8e8635b51b47bbfd?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Shullick", "link": "https://stackoverflow.com/users/9636528/michael-shullick"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1566257224, "post_id": 57564929, "comment_id": 101591541, "body": "Yeah, it is. Please flag if you can, I don&#39;t have the reputation to do it."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 9636528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47d24256d181df8e8e8635b51b47bbfd?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Shullick", "link": "https://stackoverflow.com/users/9636528/michael-shullick"}, "is_accepted": false, "score": 0, "last_activity_date": 1566257120, "creation_date": 1566257120, "answer_id": 57565006, "question_id": 57564929, "link": "https://stackoverflow.com/questions/57564929/how-should-one-set-singleton-state-in-go-or-why-doesnt-this-work/57565006#57565006", "title": "How should one set singleton state in Go? (Or, why doesn&#39;t this work?)", "body": "<p>Cerise spotted it immediately. I did not realize method receivers are essentially passed by value in Go. Therefore, to fix this example, the <code>SetState</code> signature just needs to be changed to <code>(f *foo) SetState()</code></p>\n"}], "owner": {"reputation": 1, "user_id": 9636528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47d24256d181df8e8e8635b51b47bbfd?s=128&d=identicon&r=PG&f=1", "display_name": "Michael Shullick", "link": "https://stackoverflow.com/users/9636528/michael-shullick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "closed_date": 1566261052, "answer_count": 1, "score": -1, "last_activity_date": 1566257120, "creation_date": 1566256429, "question_id": 57564929, "link": "https://stackoverflow.com/questions/57564929/how-should-one-set-singleton-state-in-go-or-why-doesnt-this-work", "closed_reason": "Duplicate", "title": "How should one set singleton state in Go? (Or, why doesn&#39;t this work?)", "body": "<p>Barring any conversation about whether singletons should be used (Yes, I know, antipattern, I've opted not to use it anyway), I'm confused as to why this doesn't work. I have state I'm trying to set within a singleton instance, but my method is not actually modifying the main instance.</p>\n\n<p>What does hold is any initialization I pass when the singleton is instantiated. </p>\n\n<p>At first I thought it was a nested struct problem, because I started with a <code>bar</code> in a <code>foo</code>, but then found it did the same thing with the primitive <code>val</code>.</p>\n\n<p>In the off chance it matters, I'm running Go 1.12.7 on Mac OS Mojave.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype foo struct {\n    val   int\n    state bar\n}\n\ntype bar struct {\n    inner int\n}\n\nvar singleton *foo\nvar once sync.Once\n\nfunc GetFoo() *foo {\n    once.Do(func() {\n        singleton = &amp;foo{\n            state: bar{inner: 0},\n        }\n    })\n    return singleton\n}\n\nfunc (f foo) SetState() {\n    f.val = 1\n    f.state.inner = 1\n}\n\nfunc main() {\n\n    f := GetFoo()\n    fmt.Println(f)\n    f.SetState()\n    fmt.Println(f)\n\n}\n</code></pre>\n\n<p>I would expect this to output:</p>\n\n<pre><code>&amp;{0 {0}}\n&amp;{1 {1}}\n</code></pre>\n\n<p>Instead, I'm getting: </p>\n\n<pre><code>&amp;{0 {0}}\n&amp;{0 {0}}\n</code></pre>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 378, "user_id": 5950472, "user_type": "registered", "accept_rate": 76, "profile_image": "https://lh6.googleusercontent.com/-HQx21UJoPf4/AAAAAAAAAAI/AAAAAAAABeo/xJjZvaonmjQ/photo.jpg?sz=128", "display_name": "Nagarajan Shanmuganathan", "link": "https://stackoverflow.com/users/5950472/nagarajan-shanmuganathan"}, "edited": false, "score": 0, "creation_date": 1566256231, "post_id": 57564849, "comment_id": 101591382, "body": "Can the downvoter please say why the question is bad?"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 1, "creation_date": 1566256241, "post_id": 57564849, "comment_id": 101591384, "body": "Check <a href=\"https://play.golang.org/p/55ExIDxmL5z\" rel=\"nofollow noreferrer\">play.golang.org/p/55ExIDxmL5z</a>, does it work as expected?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1566324251, "post_id": 57564849, "comment_id": 101618378, "body": "I can only assume about the down vote, but instead of making it easy to answer your question (or just identify it, for that matter) you make it complicated."}, {"owner": {"reputation": 378, "user_id": 5950472, "user_type": "registered", "accept_rate": 76, "profile_image": "https://lh6.googleusercontent.com/-HQx21UJoPf4/AAAAAAAAAAI/AAAAAAAABeo/xJjZvaonmjQ/photo.jpg?sz=128", "display_name": "Nagarajan Shanmuganathan", "link": "https://stackoverflow.com/users/5950472/nagarajan-shanmuganathan"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1566324410, "post_id": 57564849, "comment_id": 101618443, "body": "@MarkusWMahlberg I guess that too. The question may seem verbose. I just wanted to give the complete picture anyway."}], "answers": [{"tags": [], "owner": {"reputation": 5399, "user_id": 3248412, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/3yGCF.jpg?s=128&g=1", "display_name": "vs97", "link": "https://stackoverflow.com/users/3248412/vs97"}, "is_accepted": false, "score": 1, "last_activity_date": 1566257559, "creation_date": 1566257559, "answer_id": 57565060, "question_id": 57564849, "link": "https://stackoverflow.com/questions/57564849/extracting-information-from-strings/57565060#57565060", "title": "Extracting information from Strings", "body": "<p>Maybe something as simple as this will help. </p>\n\n<p>You can extract the <em>website name</em> using the following regex and returning the first group:</p>\n\n<pre><code>//([^/.]+)\n\n//         start with //\n([^/.]+)   match anything until first dot\n</code></pre>\n\n<p>You can extract the <em>resourceId</em> using the following regex and also returning first group:</p>\n\n<pre><code>.com/([^/?]+)\n\n.com/      start with .com\n([^/?]+)   match everything until the first ? (if exists, else matches till end)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/nI3XTHFB-dq\" rel=\"nofollow noreferrer\">Link to Go Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6553328, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/omcAX.jpg?s=128&g=1", "display_name": "Emma", "link": "https://stackoverflow.com/users/6553328/emma"}, "is_accepted": false, "score": 1, "last_activity_date": 1566257896, "last_edit_date": 1566257896, "creation_date": 1566257755, "answer_id": 57565081, "question_id": 57564849, "link": "https://stackoverflow.com/questions/57564849/extracting-information-from-strings/57565081#57565081", "title": "Extracting information from Strings", "body": "<p>I'm guessing that this expression might work:</p>\n\n<pre><code>(?i)https?:\\/\\/(www\\.)?([^.]*)[^\\/]*\\/([^?\\r\\n]*)\n</code></pre>\n\n<h3>Test</h3>\n\n<pre><code>package main\n\nimport (\n    \"regexp\"\n    \"fmt\"\n)\n\nfunc main() {\n    var re = regexp.MustCompile(`(?m)(?i)https?:\\/\\/(www\\.)?([^.]*)[^\\/]*\\/([^?\\r\\n]*)`)\n    var str = `https://website-name.some-domain.some-sub-domain.com/resourceId?randomContent\n\nhttps://website-name.some-domain.some-sub-domain.com/resourceId`\n\n    for i, match := range re.FindAllString(str, -1) {\n        fmt.Println(match, \"found at index\", i)\n    }\n}\n</code></pre>\n\n<h3><a href=\"https://regex101.com/r/tJ6tTf/1/\" rel=\"nofollow noreferrer\">Demo</a></h3>\n"}, {"comments": [{"owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 0, "creation_date": 1566311316, "post_id": 57565664, "comment_id": 101611953, "body": "Best answer. Go comes with a native package for doing exactly this."}, {"owner": {"reputation": 378, "user_id": 5950472, "user_type": "registered", "accept_rate": 76, "profile_image": "https://lh6.googleusercontent.com/-HQx21UJoPf4/AAAAAAAAAAI/AAAAAAAABeo/xJjZvaonmjQ/photo.jpg?sz=128", "display_name": "Nagarajan Shanmuganathan", "link": "https://stackoverflow.com/users/5950472/nagarajan-shanmuganathan"}, "edited": false, "score": 0, "creation_date": 1566324265, "post_id": 57565664, "comment_id": 101618385, "body": "I&#39;m marking this as the answer since it is generic and also solves my problems. Thanks."}], "tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": true, "score": 3, "last_activity_date": 1566264766, "creation_date": 1566264766, "answer_id": 57565664, "question_id": 57564849, "link": "https://stackoverflow.com/questions/57564849/extracting-information-from-strings/57565664#57565664", "title": "Extracting information from Strings", "body": "<p>The sample strings you show are ordinary HTTPS URLs, so you can use the <a href=\"https://godoc.org/net/url\" rel=\"nofollow noreferrer\"><code>net/url</code></a> package to parse them.  The <code>website-name</code> is the first part of the <code>parsedUrl.Hostname()</code>, and the <code>resourceId</code> is the <code>parsedUrl.Path</code> less a leading <code>/</code>.</p>\n\n<pre><code>u, err := url.Parse(s)\nif err != nil {\n    panic(err)\n}\nhost := u.Hostname()\nfirst := strings.SplitN(host, \".\", 2)[0]\nfmt.Printf(\"website-name: %s\\n\", first)\nfmt.Printf(\"resourceId: %s\\n\", u.Path[1:])\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/fnF2RTBuFxR\" rel=\"nofollow noreferrer\">https://play.golang.org/p/fnF2RTBuFxR</a> has a complete example, including the two URL strings from the question.  This works even if the hostname part of the URL doesn't end with <code>.com</code>, or the path part includes that string, or there is a port number or hash fragment, or other variations.</p>\n"}], "owner": {"reputation": 378, "user_id": 5950472, "user_type": "registered", "accept_rate": 76, "profile_image": "https://lh6.googleusercontent.com/-HQx21UJoPf4/AAAAAAAAAAI/AAAAAAAABeo/xJjZvaonmjQ/photo.jpg?sz=128", "display_name": "Nagarajan Shanmuganathan", "link": "https://stackoverflow.com/users/5950472/nagarajan-shanmuganathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 57565664, "answer_count": 3, "score": 0, "last_activity_date": 1566301592, "creation_date": 1566255534, "last_edit_date": 1566301592, "question_id": 57564849, "link": "https://stackoverflow.com/questions/57564849/extracting-information-from-strings", "title": "Extracting information from Strings", "body": "<p>When given a string of the form <code>https://website-name.some-domain.some-sub-domain.com/resourceId</code> (type 1) or <code>https://website-name.some-sub-domain.com/resourceId?randomContent</code> (type 2), I need to extract out only two sub-strings. I need the <code>website-name</code> in one string and <code>resourceId</code> in an other string.</p>\n\n<p>I have extracted the website name using the following code:</p>\n\n<pre><code>s := \"https://website-name.some-domain.some-sub-domain.com/resourceId?randomContent\"\nw := regexp.MustCompile(\"https://(.*?)\\\\.\")\nwebsite := w.FindStringSubmatch(s)\nfmt.Println(website[1])\n</code></pre>\n\n<p>I have the other regex to get the resourceId</p>\n\n<pre><code>s := \"https://website-name.some-domain.some-sub-domain.com/resourceId?randomContent\"\nr := regexp.MustCompile(\"com/(.*?)\\\\?\")\nresource := r.FindStringSubmatch(s)\nfmt.Println(resource[1])\n</code></pre>\n\n<p>This works for any string that ends with <code>?</code> or <code>?randomContent</code>. But I have strings that don't have a trailing <code>?</code> and I am not able to work with such cases (type 1).</p>\n\n<p>I tried <code>\"(com/(.*?)\\\\?)|(com/(.*?).*)\"</code> to get <code>resourceId</code> which is of no use.</p>\n\n<p>I am not able to find an elegant way to extract these two sub-strings. </p>\n\n<p>Note: The <code>randomContent</code> is an arbitrarily long substring, the same goes for the <code>resourceId</code> as well. But the <code>resourceId</code> will not have <code>?</code> in it. Upon encountering a <code>?</code>, it can be said that the <code>resourceId</code> has ended.</p>\n\n<p>Also, <code>website-name</code> can differ, but the pattern is the same - An arbitrary sub-domain and a <code>.com</code> will be present in the string.</p>\n\n<p>Here is what I have tried: <a href=\"https://play.golang.org/p/MGQIT5XRuuh\" rel=\"nofollow noreferrer\">https://play.golang.org/p/MGQIT5XRuuh</a></p>\n"}, {"tags": ["go", "makefile"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566253619, "post_id": 57564494, "comment_id": 101590819, "body": "What is the default target? Also, you defined &quot;generate&quot; as a phony target, but it has a prerequisite. Whenever generate runs, it&#39;ll run the prerequisite."}, {"owner": {"reputation": 3239, "user_id": 1478636, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7651e5295fced56136e81d876c5c7c95?s=128&d=identicon&r=PG", "display_name": "Paul Nelson Baker", "link": "https://stackoverflow.com/users/1478636/paul-nelson-baker"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566253918, "post_id": 57564494, "comment_id": 101590893, "body": "@bserdar so if a phony target has concrete dependencies, it&#39;ll run all those? If that&#39;s true, why does the pre-commit hook only get performed once? I&#39;ve set a default and now, I didn&#39;t realize that was required. I&#39;ve updated the question to reflect"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566254735, "post_id": 57564494, "comment_id": 101591076, "body": "pre-commit hook is looking for the pre-commit file. If that file is there, it won&#39;t run again. Same goes for the loop_file, and song_file. The .phony will make go generate piece run, but I&#39;m not sure about the dependencies. Maybe those files are not there?"}, {"owner": {"reputation": 3239, "user_id": 1478636, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7651e5295fced56136e81d876c5c7c95?s=128&d=identicon&r=PG", "display_name": "Paul Nelson Baker", "link": "https://stackoverflow.com/users/1478636/paul-nelson-baker"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566255203, "post_id": 57564494, "comment_id": 101591181, "body": "@bserdar, that would make sense but I can run each collectively via <code>make generate</code> and then manually verify with <code>ls</code> that each file exists like expected"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566256002, "post_id": 57564494, "comment_id": 101591340, "body": "Could you get rid of the &quot;export&quot; directives? Just declare like bin_directory=bin"}, {"owner": {"reputation": 3239, "user_id": 1478636, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7651e5295fced56136e81d876c5c7c95?s=128&d=identicon&r=PG", "display_name": "Paul Nelson Baker", "link": "https://stackoverflow.com/users/1478636/paul-nelson-baker"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566256159, "post_id": 57564494, "comment_id": 101591373, "body": "@bserdar it was a good idea, but removing <code>export</code> and just using any of &#39; = &#39; , &#39;=&#39; , &#39; := &#39; , or &#39;:=&#39; showed any difference."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566256886, "post_id": 57564494, "comment_id": 101591476, "body": "Sorry, I&#39;m stumped. I suggest getting rid of all the variables and the phony for generate, bringing it to a working minimal state, and go from there,"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1566256888, "post_id": 57564494, "comment_id": 101591477, "body": "Just because a target is phony does not mean that the recipes for its prerequisites will automatically be run.  The prerequisites will be <i>checked</i> if the target itself is built, but those that are up to date will not be rebuilt.  That&#39;s how a typical <code>all</code> target works, after all."}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1566258642, "post_id": 57564494, "comment_id": 101591796, "body": "So for those of us with limited go knowledge, how do you expect <code>go install .</code> to interact with your makefile? Because causing that command to run is the <i>only</i> thing that either version of your makefile will do when you run <code>make</code> without specifying a target. Or alternatively, just how are you running <code>make</code>?"}, {"owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "edited": false, "score": 0, "creation_date": 1566259704, "post_id": 57564494, "comment_id": 101591961, "body": "Note also that the special targets are case-sensitive: <code>.PHONY</code> and <code>.DEFAULT</code> (see <a href=\"https://stackoverflow.com/a/25295513/2402272\">stackoverflow.com/a/25295513/2402272</a>), not that this is responsible for the misbehavior.  Failure to actually declare your targets phony opens up possibilities for them to go unbuilt when otherwise you want them built, not the other way around."}], "answers": [{"comments": [{"owner": {"reputation": 3239, "user_id": 1478636, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7651e5295fced56136e81d876c5c7c95?s=128&d=identicon&r=PG", "display_name": "Paul Nelson Baker", "link": "https://stackoverflow.com/users/1478636/paul-nelson-baker"}, "edited": false, "score": 0, "creation_date": 1566315612, "post_id": 57565454, "comment_id": 101614557, "body": "This was the problem. <code>youtube-dl</code> was marking the file from December 17, 2018 every time. I&#39;m assuming this was probably some metadata it was trying to populate based on the music or something of that nature. Thanks for figuring it out, even though I forgot to specify that I was trying to run <code>make generate</code>"}], "tags": [], "owner": {"reputation": 69991, "user_id": 939557, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/3VPea.png?s=128&g=1", "display_name": "MadScientist", "link": "https://stackoverflow.com/users/939557/madscientist"}, "is_accepted": true, "score": 1, "last_activity_date": 1566262319, "creation_date": 1566262319, "answer_id": 57565454, "question_id": 57564494, "link": "https://stackoverflow.com/questions/57564494/makefile-rules-are-always-executed-despite-target-existing/57565454#57565454", "title": "Makefile rules are always executed despite target existing", "body": "<p>You don't specify but I assume you're running <code>make generate</code> when you see this behavior.  It's always best when asking questions if you show the command you typed, the output you got (cut and paste and formatted properly) or at least sufficient of it to see the problem, and point out exactly which part of the output is unexpected AND what you expected to happen instead.</p>\n\n<p>Assuming your environment and makefile are accurately described above, then the most obvious cause of the behavior you're seeing is that this command:</p>\n\n<pre><code>youtube-dl \"${song_url}\" --extract-audio --audio-format mp3 --exec \"mv {} ${song_file}\"\n</code></pre>\n\n<p>is not updating the timestamp on the output file <code>$(song_file)</code>, so it always looks older than the targets that depend on it, so make always rebuilds it.</p>\n\n<p>After you run your makefile, use <code>ls -l</code> on all the expected output files and see if their modification times are updated.  If not you may need to add <code>touch $@</code> to your rule after the <code>youtube-dl</code> command, to make sure it was updated:</p>\n\n<pre><code>$(song_file): .git/hooks/pre-commit\n        mkdir -p \"${@D}\"\n        youtube-dl \"${song_url}\" --extract-audio --audio-format mp3 --exec \"mv {} $@\"\n        touch $@\n</code></pre>\n\n<p>Also as mentioned in the comments above, and as described in the GNU make documentation, the special targets are <code>.DEFAULT</code> (uppercase) and <code>.PHONY</code> (uppercase), not <code>.default</code> and <code>.phony</code>.  Those latter are simply targets you've defined, just like <code>foo</code> or whatever; they have no special meaning to GNU make.  makefiles, like all UNIX/POSIX tools and languages, are case-sensitive so be careful to use the correct case for keywords as described in the GNU make manual (and for the targets you define in your makefile)</p>\n\n<p>Removing the <code>export</code> won't change anything: GNU make allows a variable to be assigned and exported on the same line.</p>\n"}, {"tags": [], "owner": {"reputation": 120941, "user_id": 2402272, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/1182b1d5518a596d4e8cfe0567a65c4d?s=128&d=identicon&r=PG", "display_name": "John Bollinger", "link": "https://stackoverflow.com/users/2402272/john-bollinger"}, "is_accepted": false, "score": 0, "last_activity_date": 1566264775, "last_edit_date": 1566264775, "creation_date": 1566264289, "answer_id": 57565624, "question_id": 57564494, "link": "https://stackoverflow.com/questions/57564494/makefile-rules-are-always-executed-despite-target-existing/57565624#57565624", "title": "Makefile rules are always executed despite target existing", "body": "<p>Both of your makefiles start with the line</p>\n\n<pre><code>.default: install\n</code></pre>\n\n<p>The intent seems to be to set the default target to <code>install</code>.  That doesn't work because the target names are case-sensitive -- you wanted <code>.DEFAULT</code>, and also <code>.PHONY</code>.  But by happenstance, because of the location of that line in the file, you get a similar effect: the default target is <code>.default</code>, and it has <code>install</code> as a prerequisite.  The <code>install</code> target will therefore be checked on every run, and if no such file in fact exists (remember that it's not actually phony, either) then its recipe will run.</p>\n\n<p>So if you run <code>make</code> without specifying a target then <code>make</code> will <em>probably</em> run the <code>install</code> recipe (and otherwise, it won't do anything visible to you).  I can't find any reason to think that <code>go install</code> would run <code>make</code> recursively, so if in fact you see other rules being run then I conclude that you must be naming a target, and if the rule for <code>generate</code> is one of those being run then either that or <code>.phony</code> must be the target you're naming, because none of the others have <code>generate</code> for a prerequisite.</p>\n\n<p>So think about what happens if you run <code>make generate</code> with the original makefile.  </p>\n\n<ul>\n<li><p>The <code>generate</code> target has <code>$(loop_file)</code> as a prerequisite, so whatever that expands to is checked.</p>\n\n<ul>\n<li><p>Whatever it expands to, there is a rule for <code>$(loop_target)</code> with <code>$(song_target)</code> as a prerequisite, so whatever <em>that</em> expands to is checked.</p>\n\n<ul>\n<li><p>There is a rule for <code>$(song_target)</code> with <code>.git/hooks/pre-commit</code> as a prerequisite, so it is checked, and finally</p></li>\n<li><p>the rule for <code>.git/hooks/pre-commit</code> has no prerequisite, so no further target is checked.  The recipe for <code>.git/hooks/pre-commit</code> will be run if and only if that file does not already exist.  The rule was not running for you, so I guess the file existed.</p></li>\n<li><p>The prerequisite for <code>$(song_target)</code> not being found out of date, the only reason for <code>$(song_target)</code> to be rebuilt is that it did not already exist.  It appears that in that case your rule will in fact generate it, so well and good.  But then,</p></li>\n</ul></li>\n<li><p>its prerequisite having been found initially missing or out of date, the recipe for <code>$(loop_file)</code> will run, regardless of whether that target itself already exists.  And that appears to be sensible, because the recipe uses <code>$(song_file)</code>.</p></li>\n</ul></li>\n<li><p>Finally, <em>its</em> prerequisite having been (re)built, the recipe for <code>generate</code> will run.  This is sensible if <code>go generate ./data</code> will make use of <code>$(loop_file)</code> or <code>$(song_file)</code>, but otherwise those should not be (ordinary) prerequisites of that target.</p></li>\n</ul>\n\n<p>Thus, <code>$(song_file)</code> needing to be built causes all other targets directly or indirectly depending on it to be rebuilt, too, <em>and that's the right thing to do</em>.</p>\n\n<hr>\n\n<p>Now let's think about your second makefile.  I presume that you again run <code>make generate</code>, rather than just <code>make</code> without specifying a target.  In this case,</p>\n\n<ul>\n<li><p>The <code>generate</code> target has <code>.git/hooks/pre-commit</code>, <code>$(song_file)</code>, and <code>$(loop_file)</code> as prerequisites, so all of these are checked.  And note well that there is no guarantee about the order in which they are checked or updated. It is incorrect to rely on a particular order, and doing so will bite you in a tender place -- maybe not today, and maybe not tomorrow, but if you count on a specific order then your day will come.</p>\n\n<ul>\n<li>none of those targets has any prerequisite designated, so each will be built only if it does not already exist.  As discussed above, that appears to be <em>wrong</em> for <code>$(loop_file)</code> -- even if it already exists, it ought to be rebuilt if <code>$(song_file)</code> is.</li>\n</ul></li>\n<li><p>if any of its prerequisites was built, then <code>generate</code> will be, too.  That doesn't appear quite right: I don't see why it needs to be rebuilt on account of <code>.git/hooks/pre-commit</code>, and if it does not depend <em>directly</em> on <code>$(song_file)</code> then it's messy and superfluous to name it as a prerequisite.</p></li>\n</ul>\n\n<hr>\n\n<p>It's hard to be sure what hidden dependencies there may be, but it looks like your original makefile is pretty reasonable, and the behavior you describe is what you should expect.  If you can, though, I'd look at pulling the git hook out from the bottom of the dependency stack, because it doesn't look like anything else actually depends on it.</p>\n\n<p>But if you want different behavior, such as considering a target's prerequisites only if the target does not already exist, then <code>make</code>'s model isn't really what you're after.  You can still handle that particular desire by engaging <code>make</code> recursively, but in that case I don't see what's gained over your original shell script.</p>\n"}], "owner": {"reputation": 3239, "user_id": 1478636, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/7651e5295fced56136e81d876c5c7c95?s=128&d=identicon&r=PG", "display_name": "Paul Nelson Baker", "link": "https://stackoverflow.com/users/1478636/paul-nelson-baker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 1, "accepted_answer_id": 57565454, "answer_count": 2, "score": 0, "last_activity_date": 1566264775, "creation_date": 1566252601, "last_edit_date": 1566256589, "question_id": 57564494, "link": "https://stackoverflow.com/questions/57564494/makefile-rules-are-always-executed-despite-target-existing", "title": "Makefile rules are always executed despite target existing", "body": "<p>I'm trying to adjust my <code>Makefile</code> for <a href=\"https://github.com/paul-nelson-baker/the-spins/tree/master\" rel=\"nofollow noreferrer\">my GoLang project</a>. I have several rules which should:</p>\n\n<ol>\n<li>Setup a git pre-commit hook (Don't want to commit the binary files and break copyright law by accident)</li>\n<li>Download an mp3 file via <code>youtube-dl</code></li>\n<li>Extract a subsection of that video via <code>ffmpeg</code></li>\n</ol>\n\n<p>Previously I was doing this via shellscript and checking for each file manually, but in the act of converting my script to a Makefile I seem to be missing something.</p>\n\n<p>The only rule that doesn't re-run is the pre-hook, but I think that's because I'm not using a variable for my target/rule name?</p>\n\n<pre><code>.default: install\n.phony: install generate clean\n\nexport bin_directory = bin\nexport asset_directory = data/assets\nexport song_url = https://www.youtube.com/watch?v=z8cgNLGnnK4\nexport song_file = ${bin_directory}/nsp-you-spin-me-cover.mp3\nexport loop_file = ${asset_directory}/spin-loop.mp3\n\ninstall:\n    go install .\n\ngenerate: $(loop_file)\n    go generate ./data\n\n$(loop_file): $(song_file)\n    mkdir -p \"${asset_directory}\"\n    ffmpeg -i \"${song_file}\" -ss 00:01:13.30 -to 00:01:30.38 -c copy \"${loop_file}\"\n\n$(song_file): .git/hooks/pre-commit\n    mkdir -p \"${bin_directory}\"\n    youtube-dl \"${song_url}\" --extract-audio --audio-format mp3 --exec \"mv {} ${song_file}\"\n\n.git/hooks/pre-commit:\n    cp ./pre-commit .git/hooks/pre-commit\n    chmod +x .git/hooks/pre-commit\n\nclean:\n    git clean -xdf\n</code></pre>\n\n<p>UPDATE: I've found this works correctly if I lump all the dependencies onto the <code>generate</code> rule like so (which seems like the wrong thing to do)</p>\n\n<pre><code>.default: install\n.phony: install generate clean\n\nbin_directory:=bin\nasset_directory:=data/assets\nsong_url:=https://www.youtube.com/watch?v=z8cgNLGnnK4\nsong_file:=$(bin_directory)/nsp-you-spin-me-cover.mp3\nloop_file:=$(asset_directory)/spin-loop.mp3\n\ninstall:\n    go install .\n\n.git/hooks/pre-commit:\n    cp ./pre-commit .git/hooks/pre-commit\n    chmod +x .git/hooks/pre-commit\n\n$(song_file):\n    mkdir -p \"${bin_directory}\"\n    youtube-dl \"${song_url}\" --extract-audio --audio-format mp3 --exec \"mv {} ${song_file}\"\n\n$(loop_file):\n    mkdir -p \"${asset_directory}\"\n    ffmpeg -i \"${song_file}\" -ss 00:01:13.30 -to 00:01:30.38 -c copy \"${loop_file}\"\n\ngenerate: .git/hooks/pre-commit $(song_file) $(loop_file)\n    go generate ./data\n\nclean:\n    git clean -xdf\n</code></pre>\n"}, {"tags": ["go", "networking", "packet", "sniffing"], "comments": [{"owner": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "edited": false, "score": 0, "creation_date": 1566269214, "post_id": 57564217, "comment_id": 101593450, "body": "packets are not handled at application layer, so the answer is no"}, {"owner": {"reputation": 15921, "user_id": 1542723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8a969ba62fc77da0a20654caffbe234?s=128&d=identicon&r=PG", "display_name": "Ferrybig", "link": "https://stackoverflow.com/users/1542723/ferrybig"}, "reply_to_user": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "edited": false, "score": 0, "creation_date": 1566282181, "post_id": 57564217, "comment_id": 101596239, "body": "@Mox he is using the pcap library for low level access, he is no longer with the application layer"}], "answers": [{"tags": [], "owner": {"reputation": 16, "user_id": 11953377, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2eb1534b1a89bc7a695f57b54c1e1544?s=128&d=identicon&r=PG&f=1", "display_name": "Konstantin Kogdenko", "link": "https://stackoverflow.com/users/11953377/konstantin-kogdenko"}, "is_accepted": false, "score": 0, "last_activity_date": 1566501885, "creation_date": 1566501885, "answer_id": 57615907, "question_id": 57564217, "link": "https://stackoverflow.com/questions/57564217/is-there-a-way-to-drop-packets-when-listening-on-internet-interface/57615907#57615907", "title": "Is there a way to drop packets when listening on internet interface?", "body": "<p>You can try to do it with go binding of netmap <a href=\"https://github.com/pragus/gonetmap\" rel=\"nofollow noreferrer\">https://github.com/pragus/gonetmap</a></p>\n"}], "owner": {"reputation": 11, "user_id": 11008445, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-kC38bQNFSrA/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQOgyyI49maCC-4vbz9RRt_U-NtFRA/mo/photo.jpg?sz=128", "display_name": "Angel Aleksandrov", "link": "https://stackoverflow.com/users/11008445/angel-aleksandrov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 244, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1566501885, "creation_date": 1566250532, "last_edit_date": 1566285420, "question_id": 57564217, "link": "https://stackoverflow.com/questions/57564217/is-there-a-way-to-drop-packets-when-listening-on-internet-interface", "title": "Is there a way to drop packets when listening on internet interface?", "body": "<p>Let's say an HTTP server is running on port 8080. I want all packets on \"eth0\" that have destination port 8080 in their TCP header and some other condition is met(for instance URG flag is up) to be dropped before reaching the server (with other words the server should not be able to see these packets). Something like a \"firewall\".</p>\n\n<p>I need a Go implementation. So far I managed to capture the network traffic on \"eth0\" and I know how to filter it. Is there any way I can drop the packets that I captured by the following program:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/google/gopacket\"\n    \"github.com/google/gopacket/pcap\"\n    \"fmt\"\n    \"log\"\n    \"time\"\n)\n\nvar (\n    device string = \"en0\"\n    snaplen int32 = 65535\n    promisc bool = false\n    err error\n    timeout time.Duration = -1 * time.Second\n    handle *pcap.Handle\n)\n\nfunc main() {\n    handle, err = pcap.OpenLive(device,snaplen,promisc,timeout)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer handle.Close()\n\n    packetSource := gopacket.NewPacketSource(handle,handle.LinkType())\n\n    for packet := range packetSource.Packets() {\n        fmt.Println(packet)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "assembly", "x86", "plan-9"], "comments": [{"owner": {"reputation": 52454, "user_id": 547981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90042f6f33a9f87769fac02096ceea68?s=128&d=identicon&r=PG", "display_name": "Jester", "link": "https://stackoverflow.com/users/547981/jester"}, "edited": false, "score": 4, "creation_date": 1566250316, "post_id": 57564065, "comment_id": 101589941, "body": "It is a supported instruction but it takes no operands, those are implicit. Try if simply <code>RDMSR</code> is accepted. That won&#39;t do what you want just yet though. You need to load the register number into <code>ecx</code> first."}, {"owner": {"reputation": 1256, "user_id": 4949938, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7586b74526dc4ef59eb6f8b6d4cb6a94?s=128&d=identicon&r=PG", "display_name": "mxplusb", "link": "https://stackoverflow.com/users/4949938/mxplusb"}, "reply_to_user": {"reputation": 52454, "user_id": 547981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90042f6f33a9f87769fac02096ceea68?s=128&d=identicon&r=PG", "display_name": "Jester", "link": "https://stackoverflow.com/users/547981/jester"}, "edited": false, "score": 0, "creation_date": 1566253383, "post_id": 57564065, "comment_id": 101590758, "body": "Oh, okay, I followed your advice, and I definitely got it to compile. I didn&#39;t realise there were no operands on that instruction. Now it compiles and I&#39;m getting memory errors, so I think now I just need to sort through why it&#39;s not working."}, {"owner": {"reputation": 52454, "user_id": 547981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/90042f6f33a9f87769fac02096ceea68?s=128&d=identicon&r=PG", "display_name": "Jester", "link": "https://stackoverflow.com/users/547981/jester"}, "edited": false, "score": 4, "creation_date": 1566253977, "post_id": 57564065, "comment_id": 101590908, "body": "Also note <code>RDMSR</code> is a privileged instruction so if you are trying to run it in user mode it will fault."}], "owner": {"reputation": 1256, "user_id": 4949938, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7586b74526dc4ef59eb6f8b6d4cb6a94?s=128&d=identicon&r=PG", "display_name": "mxplusb", "link": "https://stackoverflow.com/users/4949938/mxplusb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1566256144, "creation_date": 1566249447, "last_edit_date": 1566256144, "question_id": 57564065, "link": "https://stackoverflow.com/questions/57564065/model-specific-registers-in-go", "title": "Model-specific registers in go?", "body": "<p>I'm learning how to write assembly with Go, and I'm not very familiar with assembly. I'm trying to understand how to read from a model-specific register, and I'm running into errors.</p>\n\n<pre><code>// main.go\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc readmsr(register int64) int64\n\nfunc main() {\n    fmt.Println(readmsr(0xC0000080))\n}\n</code></pre>\n\n<pre><code>// intrinsics_amd64.s\n// readmsr(register int64) int64\nTEXT \u00b7readmsr(SB), $0-24\n    RDMSR register+0(FP), AX\n    MOVQ AX, ret+16(FP)\n    RET\n</code></pre>\n\n<p>When I try to compile the code, I get these errors:</p>\n\n<pre><code>go build -v .\n_/gopath/go/workspace/temp\n# _/gopath/go/workspace/temp\nasm: invalid instruction: 00000 (/gopath/go/workspace/temp/instrinsics_amd64.s:3)   RDMSR   register+8(FP), AX\nasm: assembly failed\n</code></pre>\n\n<p>Looking the op codes in the <a href=\"https://godoc.org/golang.org/x/arch/x86/x86asm#Op\" rel=\"nofollow noreferrer\">x86asm package</a>, it looks like <code>RDMSR</code> is a supported instruction, at least from what I can tell.</p>\n\n<p>I am not very familiar with assembly, so I'm unsure if what I am doing wrong is wrong in assembly or wrong in Go. Can you please help me understand what I'm doing wrong and why it's wrong?</p>\n"}, {"tags": ["http", "go", "response", "swagger-ui", "fileserver"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 2, "creation_date": 1566270577, "post_id": 57563922, "comment_id": 101593660, "body": "There is no size limit. What does the client receive? Does it receive 32K data, or nothing? I&#39;ve done things like this before, and one thing that always failed was the media type, because the FileServer does not set the Content-Type. Maybe you have a similar problem? Did you try with curl?"}, {"owner": {"reputation": 19, "user_id": 11336397, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OLBzFFev1ig/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3revhxnoqL-WkwrBF1IHS7dPeSDRbg/mo/photo.jpg?sz=128", "display_name": "Matthew Loughney", "link": "https://stackoverflow.com/users/11336397/matthew-loughney"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566311670, "post_id": 57563922, "comment_id": 101612166, "body": "The client receives a 200 response where the size field in the header is set correctly, but there is no data in they body. It looks like the content-type is also set correctly with <code>text&#47;css; charset=utf-8</code> for the css and <code>application&#47;javascript</code> for the js. However, in the console it also prints an error <code>net::ERR_CONTENT_LENGTH_MISMATCH 200 (OK)</code> presumably because the content-length is set correctly but the body has a length of zero. I&#39;ve tried this on Chrome/Safari/Firefox so I don&#39;t think the browser is the problem either."}, {"owner": {"reputation": 19, "user_id": 11336397, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OLBzFFev1ig/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3revhxnoqL-WkwrBF1IHS7dPeSDRbg/mo/photo.jpg?sz=128", "display_name": "Matthew Loughney", "link": "https://stackoverflow.com/users/11336397/matthew-loughney"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566312937, "post_id": 57563922, "comment_id": 101612962, "body": "When I curl for the css file I get <code>curl: (18) transfer closed with 33002 bytes remaining to read</code>. 33002 is the length of data that it should be receiving in the body, so this seems like the same error I get in browser."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566315574, "post_id": 57563922, "comment_id": 101614533, "body": "Did you try running this outside the docker container? Maybe it&#39;ll help diagnose what&#39;s wrong with it."}, {"owner": {"reputation": 19, "user_id": 11336397, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OLBzFFev1ig/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3revhxnoqL-WkwrBF1IHS7dPeSDRbg/mo/photo.jpg?sz=128", "display_name": "Matthew Loughney", "link": "https://stackoverflow.com/users/11336397/matthew-loughney"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566323346, "post_id": 57563922, "comment_id": 101618004, "body": "Interestingly enough, it does return data when I do that, but only the first 32KB of data for each file."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566324128, "post_id": 57563922, "comment_id": 101618324, "body": "Are these files served by fs, or origHandler? Maybe there&#39;s something wrong with origHandler? Can you add some printfs to see if it is origHandler or fs handling these files?"}, {"owner": {"reputation": 19, "user_id": 11336397, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OLBzFFev1ig/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3revhxnoqL-WkwrBF1IHS7dPeSDRbg/mo/photo.jpg?sz=128", "display_name": "Matthew Loughney", "link": "https://stackoverflow.com/users/11336397/matthew-loughney"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566324333, "post_id": 57563922, "comment_id": 101618418, "body": "It is fs serving these, and when curling with -v it shows that <code>Curl_http_done: called premature == 1</code>, which sounds like something on the server side closed the connection unexpectedly."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566324609, "post_id": 57563922, "comment_id": 101618508, "body": "I&#39;m out of suggestions... Try serving the files with a small handler yourself?"}, {"owner": {"reputation": 19, "user_id": 11336397, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OLBzFFev1ig/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3revhxnoqL-WkwrBF1IHS7dPeSDRbg/mo/photo.jpg?sz=128", "display_name": "Matthew Loughney", "link": "https://stackoverflow.com/users/11336397/matthew-loughney"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566324806, "post_id": 57563922, "comment_id": 101618592, "body": "Yeah I&#39;ll try that. Thanks for the suggestions."}], "answers": [{"tags": [], "owner": {"reputation": 19, "user_id": 11336397, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OLBzFFev1ig/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3revhxnoqL-WkwrBF1IHS7dPeSDRbg/mo/photo.jpg?sz=128", "display_name": "Matthew Loughney", "link": "https://stackoverflow.com/users/11336397/matthew-loughney"}, "is_accepted": false, "score": 0, "last_activity_date": 1566403271, "creation_date": 1566403271, "answer_id": 57595452, "question_id": 57563922, "link": "https://stackoverflow.com/questions/57563922/file-server-wont-serve-files-over-32-kb/57595452#57595452", "title": "File server won&#39;t serve files over 32 KB", "body": "<p>So I found out the problem and it turned out to have nothing to do with the function itself, just where I was calling it. I was calling it in a function to create a gateway proxy, and was modifying the handler afterwards to add other stuff such as metrics reporting. I just had to make the call to add this stuff the last call of the parent function, and it works now.</p>\n"}], "owner": {"reputation": 19, "user_id": 11336397, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-OLBzFFev1ig/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3revhxnoqL-WkwrBF1IHS7dPeSDRbg/mo/photo.jpg?sz=128", "display_name": "Matthew Loughney", "link": "https://stackoverflow.com/users/11336397/matthew-loughney"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 141, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566403271, "creation_date": 1566248529, "last_edit_date": 1566249658, "question_id": 57563922, "link": "https://stackoverflow.com/questions/57563922/file-server-wont-serve-files-over-32-kb", "title": "File server won&#39;t serve files over 32 KB", "body": "<p>I have a go program running in a docker container. I have set it up so that when you go to localhost:8080 (the port that the program is running on) it serves up the documentation files which were created using swagger-ui. The index.html file shows up, and in that file it imports one css file, one png file, and two javascript files. The png gets imported correctly (it is only 628 bytes); however, the other three files don't get served correctly (they are all a few hundred KB). I believe the problem is that they are too big as if I delete part of the files to get them under 32 KB, they are served correctly. I am not sure how to increase this file limit, though.</p>\n\n<p>I've looked through all of my code and a fair amount of the http package to see where this hard limit might be set, but can't find it anywhere.</p>\n\n<p>Here's the code that creates my fileserver and serves the files</p>\n\n<pre><code>\nfs := http.FileServer(http.Dir(docRoot)) // docRoot is a config variable\nfor _, f := range files {\n    path := fmt.Sprintf(\"/%s\", f.Name())\n    serveFile := func(w http.ResponseWriter, r *http.Request) {\n        if r.URL.Path == path || r.URL.Path == \"/index.html\" &amp;&amp; path == \"/\" {\n            fs.ServeHTTP(w, r)\n        } else {\n            origHandler.ServeHTTP(w, r)\n        }\n    }\n    docHandler.HandleFunc(path, serveFile)\n}\n</code></pre>\n\n<p>I would think that there would be some Handler.SetMaxSize() or maybe ResponseWriter.SetMaxSize() method, but I can't find anything like this in the http package. Does anyone know how to increase this hard limit or where it might be set?</p>\n"}, {"tags": ["http", "go"], "answers": [{"comments": [{"owner": {"reputation": 568, "user_id": 8545455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83e3f3b9695712c0e752d3e68be30d37?s=128&d=identicon&r=PG", "display_name": "steve", "link": "https://stackoverflow.com/users/8545455/steve"}, "edited": false, "score": 0, "creation_date": 1566555237, "post_id": 57563112, "comment_id": 101702068, "body": "Thank you. The reason this was not obvious to me, is that the split function belongs to the <code>net</code> library. I was looking for it down in <code>net&#47;http</code>. Makes sense now."}], "tags": [], "owner": {"reputation": 21585, "user_id": 160527, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f2af00f8b669405a2a068ddae153ff48?s=128&d=identicon&r=PG", "display_name": "Corey Ogburn", "link": "https://stackoverflow.com/users/160527/corey-ogburn"}, "is_accepted": true, "score": 4, "last_activity_date": 1566244632, "last_edit_date": 1566244632, "creation_date": 1566244296, "answer_id": 57563112, "question_id": 57563049, "link": "https://stackoverflow.com/questions/57563049/whats-the-cleanest-way-to-obtain-the-ip-address-from-net-http-request-remoteadd/57563112#57563112", "title": "What&#39;s the cleanest way to obtain the IP address from net/http.Request.RemoteAddr", "body": "<p>I think you're looking for <a href=\"https://golang.org/pkg/net/#SplitHostPort\" rel=\"nofollow noreferrer\">net.SplitHostPort</a>:</p>\n\n<pre><code>func main() {\n  host, _, _ := net.SplitHostPort(\"[::1]:53947\")\n  fmt.Println(host)\n  host, _, _ = net.SplitHostPort(\"127.0.0.1:54572\")\n  fmt.Println(host)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/BuQRhD0sL54\" rel=\"nofollow noreferrer\">https://play.golang.org/p/BuQRhD0sL54</a></p>\n\n<p>Since all you need is the host, you can <code>_</code> the port. If you ever need to go the other way, there's also <a href=\"https://golang.org/pkg/net/#JoinHostPort\" rel=\"nofollow noreferrer\">net.JoinHostPort</a>.</p>\n"}], "owner": {"reputation": 568, "user_id": 8545455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83e3f3b9695712c0e752d3e68be30d37?s=128&d=identicon&r=PG", "display_name": "steve", "link": "https://stackoverflow.com/users/8545455/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 57563112, "answer_count": 1, "score": -3, "last_activity_date": 1566244632, "creation_date": 1566244007, "question_id": 57563049, "link": "https://stackoverflow.com/questions/57563049/whats-the-cleanest-way-to-obtain-the-ip-address-from-net-http-request-remoteadd", "title": "What&#39;s the cleanest way to obtain the IP address from net/http.Request.RemoteAddr", "body": "<p>Golang net/http library provides a <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"nofollow noreferrer\">Request struct</a>,\nwhich is the object returned when running a server.</p>\n\n<p>The struct includes RemoteAddr: string.</p>\n\n<p>This contains both the remote (client) IP address and client port number. It can be IPv4 or IPv6 of course.</p>\n\n<p>An IPv6 example value seen (when the client is on the local host) is:</p>\n\n<pre><code>\"[::1]:53947\"\n</code></pre>\n\n<p>An IPv4 example is:</p>\n\n<pre><code>\"127.0.0.1:54572\"\n</code></pre>\n\n<p>Are there library functions to decompose these into host and port, or is it necessary to use string manipulations?</p>\n"}, {"tags": ["go", "adapter", "mux"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1566243854, "post_id": 57562980, "comment_id": 101587685, "body": "Where are you seeing a loop? What output do you see, and how do you produce it?"}, {"owner": {"reputation": 7545, "user_id": 370605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/r8v6e.png?s=128&g=1", "display_name": "beauXjames", "link": "https://stackoverflow.com/users/370605/beauxjames"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1566244055, "post_id": 57562980, "comment_id": 101587750, "body": "when I call the /endpoint from Postman...see the logs above...they just keep going and going --- updated description with a simple mux dependency"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1566244460, "post_id": 57562980, "comment_id": 101587927, "body": "Because you&#39;re passing <code>r</code>, the router, to the adapter, and then you pass the adapter to the router. Why?"}, {"owner": {"reputation": 7545, "user_id": 370605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/r8v6e.png?s=128&g=1", "display_name": "beauXjames", "link": "https://stackoverflow.com/users/370605/beauxjames"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566244933, "post_id": 57562980, "comment_id": 101588125, "body": "@mkopriva --- see &#39;answer&#39; below --- same question"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1566245249, "post_id": 57562980, "comment_id": 101588237, "body": "@beauXjames none of them pass the router to adapter and then the result back to router. They might pass the router to the adapter and then the result to <code>http.Handle</code>... but they don&#39;t recommend to create an infinite loop, and if they do then they are simply wrong as you already know. Most of them pass in a handler, <code>myHandler</code>, <code>indexHandler</code>... Where are your handlers?"}, {"owner": {"reputation": 7545, "user_id": 370605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/r8v6e.png?s=128&g=1", "display_name": "beauXjames", "link": "https://stackoverflow.com/users/370605/beauxjames"}, "edited": false, "score": 0, "creation_date": 1566245455, "post_id": 57562980, "comment_id": 101588305, "body": "Good question...I have inherited a legacy environment. The moment you asked this my eyes lit up, as the handler is available from the endpoint.GetHandler() method. The problem is this func does return w,r but it does not Serve the route currently. It creates and interfaces with another magic black box...graphQL. Taking another deep breath."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566245513, "post_id": 57562980, "comment_id": 101588323, "body": "for example: <a href=\"https://go-talks.appspot.com/github.com/matryer/golanguk/building-apis.slide#32\" rel=\"nofollow noreferrer\">go-talks.appspot.com/github.com/matryer/golanguk/&hellip;</a> <code>http.Handle -&gt; Adapt -&gt; router -&gt; Adapt -&gt; myHandler</code>... and <a href=\"https://medium.com/@matryer/writing-middleware-in-golang-and-how-go-makes-it-so-much-fun-4375c1246e81\" rel=\"nofollow noreferrer\">here</a> there&#39;s no router at all <code>http.Handle(&quot;&#47;&quot;, Adapt(indexHandler, AddHeader(&quot;Server&quot;, &quot;Mine&quot;), CheckAuth(providers), CopyMgoSession(db), Notify(logger))</code>"}, {"owner": {"reputation": 7545, "user_id": 370605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/r8v6e.png?s=128&g=1", "display_name": "beauXjames", "link": "https://stackoverflow.com/users/370605/beauxjames"}, "edited": false, "score": 1, "creation_date": 1566245662, "post_id": 57562980, "comment_id": 101588387, "body": "I think I&#39;ve got so many different citizens needing attention here and I&#39;m just in the mix. Just talking about this has exposed lots of pieces to the puzzle...stepping away for a sec...thanks for checking it out"}], "answers": [{"comments": [{"owner": {"reputation": 7545, "user_id": 370605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/r8v6e.png?s=128&g=1", "display_name": "beauXjames", "link": "https://stackoverflow.com/users/370605/beauxjames"}, "edited": false, "score": 0, "creation_date": 1566244896, "post_id": 57563147, "comment_id": 101588112, "body": "It is suggested in the referenced materials that I pass in the router before the string of adapters. When I just remove it the expectation of the Adapt(h http.Handler, adapters ...Adapter) {} complains and I don&#39;t know what to do next."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 7545, "user_id": 370605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/r8v6e.png?s=128&g=1", "display_name": "beauXjames", "link": "https://stackoverflow.com/users/370605/beauxjames"}, "edited": false, "score": 0, "creation_date": 1566252022, "post_id": 57563147, "comment_id": 101590397, "body": "I updated the answer.  Let me know if that doesn&#39;t help."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 0, "last_activity_date": 1567120140, "last_edit_date": 1567120140, "creation_date": 1566244476, "answer_id": 57563147, "question_id": 57562980, "link": "https://stackoverflow.com/questions/57562980/why-would-i-get-an-infinite-loop-with-this-adapter-interface-pattern/57563147#57563147", "title": "Why would I get an infinite loop with this Adapter Interface Pattern", "body": "<p>I <em>think</em> this is because your chain of handlers ends with r, in effect becoming:</p>\n\n<pre><code>r.Handle(path, r)\n</code></pre>\n\n<p>You have to have an actual handler somewhere to handle the call, so your setup should look like:</p>\n\n<pre><code>r.Handle(path, Adapt(theHandler, adapter1, adapter2, adapter3))\n</code></pre>\n\n<p>However, since you said you're using gorilla/mux, there is another way you can to this. Take a look at Router.Use</p>\n\n<p><a href=\"https://godoc.org/github.com/gorilla/mux#Router.Use\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/gorilla/mux#Router.Use</a></p>\n"}], "owner": {"reputation": 7545, "user_id": 370605, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/r8v6e.png?s=128&g=1", "display_name": "beauXjames", "link": "https://stackoverflow.com/users/370605/beauxjames"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 57563147, "answer_count": 1, "score": 0, "last_activity_date": 1567120140, "creation_date": 1566243634, "last_edit_date": 1566244198, "question_id": 57562980, "link": "https://stackoverflow.com/questions/57562980/why-would-i-get-an-infinite-loop-with-this-adapter-interface-pattern", "title": "Why would I get an infinite loop with this Adapter Interface Pattern", "body": "<p>I need to replace an existing API interface with one that considers an incoming Auth token and also issues a machine-to-machine token for the outgoing service calls. </p>\n\n<p>In summary, this is an API using gorilla/mux routing framework and I'm just adding endpoints to a mux.NewRouter(). Nothing fancy...yet ;). </p>\n\n<p>I have been trying a few different patterns, but the one that seems most appealing is the Adapter Interface derived by Mat Ryer in <a href=\"https://medium.com/@matryer/writing-middleware-in-golang-and-how-go-makes-it-so-much-fun-4375c1246e81\" rel=\"nofollow noreferrer\">https://medium.com/@matryer/writing-middleware-in-golang-and-how-go-makes-it-so-much-fun-4375c1246e81</a> and <a href=\"https://go-talks.appspot.com/github.com/matryer/golanguk/building-apis.slide#30\" rel=\"nofollow noreferrer\">https://go-talks.appspot.com/github.com/matryer/golanguk/building-apis.slide#30</a></p>\n\n<p>In summary with no direct logic, I have done the following and get stuck in an infinite loop when I run the endpoint from Postman.</p>\n\n<blockquote>\n  <p>{\"level\":\"info\",\"msg\":\"New Relic Checkpoint!!!\n  /endpoint\",\"time\":\"2019-08-19T14:28:27-05:00\"}\n  {\"level\":\"info\",\"msg\":\"Security Checkpoint!!!\n  /endpoint\",\"time\":\"2019-08-19T14:28:27-05:00\"}\n  {\"level\":\"info\",\"msg\":\"Header Checkpoint!!!\n  /endpoint\",\"time\":\"2019-08-19T14:28:27-05:00\"}\n  {\"level\":\"info\",\"msg\":\"New Relic Checkpoint!!!\n  /endpoint\",\"time\":\"2019-08-19T14:28:27-05:00\"}\n  {\"level\":\"info\",\"msg\":\"Security Checkpoint!!!\n  /endpoint\",\"time\":\"2019-08-19T14:28:27-05:00\"}\n  {\"level\":\"info\",\"msg\":\"Header Checkpoint!!!\n  /endpoint\",\"time\":\"2019-08-19T14:28:27-05:00\"}</p>\n</blockquote>\n\n<pre><code>r.Handle(endpoint.Path(), Adapt(r, NewRelicAdapter(endpoint), SecurityAdapter(endpoint), WithHeader(endpoint)))\n</code></pre>\n\n<p>the Adapter Interface is established as follows...</p>\n\n<pre><code>type Adapter func(http.Handler) http.Handler\n\nfunc Adapt(h http.Handler, adapters ...Adapter) http.Handler {\n    for _, adapter := range reverseAdapters(adapters) {\n        h = adapter(h)\n    }\n    return h\n}\n\nfunc NewRelicAdapter(endpoint rest.Endpoint) Adapter {\n    return func(h http.Handler) http.Handler {\n        return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            logrus.Infof(\"New Relic Checkpoint!!! %v\", endpoint.Path())\n            h.ServeHTTP(w, r)\n        })\n    }\n}\n\nfunc SecurityAdapter(endpoint rest.Endpoint) Adapter {\n    return func(h http.Handler) http.Handler {\n        return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            logrus.Infof(\"Security Checkpoint!!! %v\", endpoint.Path())\n            h.ServeHTTP(w, r)\n        })\n    }\n}\n\nfunc WithHeader(endpoint rest.Endpoint) Adapter {\n    return func(h http.Handler) http.Handler {\n        return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            logrus.Infof(\"Header Checkpoint!!! %v\", endpoint.Path())\n            h.ServeHTTP(w, r)\n        })\n    }\n}\n\nfunc reverseAdapters(adapters []Adapter) []Adapter {\n    for i := 0; i &lt; len(adapters)/2; i++ {\n        j := len(adapters) - i - 1\n        adapters[i], adapters[j] = adapters[j], adapters[i]\n    }\n    return adapters\n}\n</code></pre>\n\n<p>I would really appreciate knowing why this loops before I get into the details on what each adapter would be doing. </p>\n"}, {"tags": ["performance", "go"], "comments": [{"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1566420127, "post_id": 57562606, "comment_id": 101655045, "body": "Have you considered computing the confidence interval from your repetitions to check if the two trends actually differ? Just the mean value cannot tell anything without knowing its distribution."}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "reply_to_user": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1566422170, "post_id": 57562606, "comment_id": 101655762, "body": "@GiulioMicheloni Please check an update that has the full scale of how a number of goroutines increases in three different sync primitives, the confidence interval is pretty clear without computation I believe."}, {"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1566425660, "post_id": 57562606, "comment_id": 101656766, "body": "I would suggest to increase the number of repetitions at least to 20 and compute confidence intervals. Only at that point you can state that one sync mechanism is faster than another. In fact, I reproduced your test on my local machine with 20 repetitions and got these <a href=\"https://drive.google.com/file/d/1humlWypIqnEPAQ_yk2WoRByArQLklzC-/view?usp=sharing\" rel=\"nofollow noreferrer\">results</a>. As you can see most of CIs (0.975 quantile) are overlapping."}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "reply_to_user": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1566448336, "post_id": 57562606, "comment_id": 101660746, "body": "@GiulioMicheloni It&#39;s an HW related issue I assume, your results don&#39;t look like a reproduced result to me, perhaps your HW doesn&#39;t like mine, maybe you could try a full scale from 1 to 15000, then see if it remains the same."}], "answers": [{"comments": [{"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 1, "creation_date": 1566254128, "post_id": 57564601, "comment_id": 101590949, "body": "Thank you very much for your answer! But your answer only describe how channel behaves, it is still a myth that why sync.Mutex have a significant performance drop rather than linear at some point."}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 1, "creation_date": 1566289502, "post_id": 57564601, "comment_id": 101599616, "body": "&quot;has waited for more than 1ms&quot; this seems false. Each operation only spent no more than 500ns. It is hard to imagine a goroutine has waited more than 1ms, isn&#39;t it?"}, {"owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "reply_to_user": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1566393137, "post_id": 57564601, "comment_id": 101642259, "body": "I wonder if it is possible to get the max and min times from a benchmark; the average doesn&#39;t give us any info about the distribution of the individual timings."}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1566393460, "post_id": 57564601, "comment_id": 101642489, "body": "Sure I can present here, but you can calculate the min and max by its errors (&#177; x%). I think the <code>benchstat</code> is an excellent tool for illustration, it shows the regression of the performance that influenced by the increasing problem size, this is important and eliminates side effects while running the benchmark (e.g. system interruption)."}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1566393583, "post_id": 57564601, "comment_id": 101642570, "body": "Sorry if I misunderstood your comments: the throughput of sync.Mutex is 5x greater than channels. (on i7700, its: 50,000,000 vs 10,000,000)"}, {"owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "reply_to_user": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1566393602, "post_id": 57564601, "comment_id": 101642585, "body": "If I understand correctly, the benchstat &#177; is for variations in running the whole benchmark several times, not for the individual timings. Also, benchstat removes outliers."}], "tags": [], "owner": {"reputation": 932, "user_id": 6629874, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/3SUbo.jpg?s=128&g=1", "display_name": "5ndG", "link": "https://stackoverflow.com/users/6629874/5ndg"}, "is_accepted": false, "score": 1, "last_activity_date": 1566288529, "last_edit_date": 1566288529, "creation_date": 1566253439, "answer_id": 57564601, "question_id": 57562606, "link": "https://stackoverflow.com/questions/57562606/why-does-sync-mutex-largely-drop-performance-when-goroutine-contention-is-more-t/57564601#57564601", "title": "Why does sync.Mutex largely drop performance when goroutine contention is more than 3400?", "body": "<p>After watching <a href=\"https://www.youtube.com/watch?v=KBZlN0izeiY\" rel=\"nofollow noreferrer\">this talk</a>, it seems reasonable that a channel can cope better with a lot of goroutines than a mutex.</p>\n\n<p>My understanding is that a channel contains a lock to protect its buffer. In principle a goroutine has to acquire and free the lock on the channel whenever it uses it, but that the locking is optimised away in these two cases:</p>\n\n<ol>\n<li><p>The receiver is waiting for an empty channel to have something put in it. In this case the incoming data is dumped straight into the sleeping receiver's memory space, bypassing the channel memory and lock altogether.</p></li>\n<li><p>The sender is waiting for a full channel to have something taken out of it. In this case the current receiver takes the message from the sleeping sender's memory space and puts it in the empty space in the channel buffer it has just created. This means that the sending goroutine doesn't have to acquire the lock and put the item into the channel when it wakes up.</p></li>\n</ol>\n\n<p>These two cases are happening a lot in the benchmark in the question, so my theory is that the channel is faster for large numbers of goroutines because there is less contention for the lock.</p>\n\n<p>I might well be wrong here; this is just my theory after watching the excellent talk linked above.</p>\n\n<p><strong>Edit about non-linearity of mutex performance</strong></p>\n\n<p>This <a href=\"https://golang.org/src/sync/mutex.go#L42\" rel=\"nofollow noreferrer\">comment</a> in the source code for <code>Lock</code> sheds some light on the kink in the mutex performance chart:</p>\n\n<blockquote>\n  <p>Mutex fairness.</p>\n  \n  <p>Mutex can be in 2 modes of operations: normal and starvation.\n  In normal mode waiters are queued in FIFO order, but a woken up waiter\n  does not own the mutex and competes with new arriving goroutines over\n  the ownership. New arriving goroutines have an advantage -- they are\n  already running on CPU and there can be lots of them, so a woken up\n  waiter has good chances of losing. In such case it is queued at front\n  of the wait queue. If a waiter fails to acquire the mutex for more than 1ms,\n  it switches mutex to the starvation mode.</p>\n  \n  <p>In starvation mode ownership of the mutex is directly handed off from\n  the unlocking goroutine to the waiter at the front of the queue.\n  New arriving goroutines don't try to acquire the mutex even if it appears\n  to be unlocked, and don't try to spin. Instead they queue themselves at\n  the tail of the wait queue.</p>\n  \n  <p>If a waiter receives ownership of the mutex and sees that either\n  (1) it is the last waiter in the queue, or (2) it waited for less than 1 ms,\n  it switches mutex back to normal operation mode.</p>\n  \n  <p>Normal mode has considerably better performance as a goroutine can acquire\n  a mutex several times in a row even if there are blocked waiters.\n  Starvation mode is important to prevent pathological cases of tail latency.</p>\n</blockquote>\n\n<p>So possibly the cause of the sudden performance drop is that one of the goroutines has waited for more than 1ms for the lock and the mutex switches to starvation mode.</p>\n"}, {"tags": [], "owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "is_accepted": true, "score": 12, "last_activity_date": 1566892579, "creation_date": 1566892579, "answer_id": 57670078, "question_id": 57562606, "link": "https://stackoverflow.com/questions/57562606/why-does-sync-mutex-largely-drop-performance-when-goroutine-contention-is-more-t/57670078#57670078", "title": "Why does sync.Mutex largely drop performance when goroutine contention is more than 3400?", "body": "<p>sync.Mutex 's implementation is based on runtime semaphore. The reason why it encounters massive performance decreases is that the implementation of <code>runtime.semacquire1</code>.</p>\n\n<p>Now, let's sample two representative points, we use <code>go tool pprof</code> when the number of goroutines was equal to 2400 and 4800:</p>\n\n<pre><code>goos: linux\ngoarch: amd64\nBenchmarkMutexWrite/goroutines-2400-8           50000000                46.5 ns/op\nPASS\nok        2.508s\n\nBenchmarkMutexWrite/goroutines-4800-8           50000000               317 ns/op\nPASS\nok        16.020s\n</code></pre>\n\n<p>2400:</p>\n\n<p><a href=\"https://i.stack.imgur.com/gvbeD.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/gvbeD.png\" alt=\"enter image description here\"></a></p>\n\n<p>4800:</p>\n\n<p><a href=\"https://i.stack.imgur.com/hyUH1.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/hyUH1.png\" alt=\"enter image description here\"></a></p>\n\n<p>As we can see, when the number of goroutines increased to 4800, the overhead of <code>runtime.gopark</code> becomes dominant. Let's dig more in the runtime source code and see who exactly calls <code>runtime.gopark</code>. In the <code>runtime.semacquire1</code>:</p>\n\n<pre><code>func semacquire1(addr *uint32, lifo bool, profile semaProfileFlags, skipframes int) {\n    // fast path\n    if cansemacquire(addr) {\n        return\n    }\n\n    s := acquireSudog()\n    root := semroot(addr)\n    ...\n    for {\n        lock(&amp;root.lock)\n        atomic.Xadd(&amp;root.nwait, 1)\n        if cansemacquire(addr) {\n            atomic.Xadd(&amp;root.nwait, -1)\n            unlock(&amp;root.lock)\n            break\n        }\n\n        // slow path\n        root.queue(addr, s, lifo)\n        goparkunlock(&amp;root.lock, waitReasonSemacquire, traceEvGoBlockSync, 4+skipframes)\n        if s.ticket != 0 || cansemacquire(addr) {\n            break\n        }\n    }\n    ...\n}\n</code></pre>\n\n<p>Based on the pprof graph we presented above, we can conclude that:</p>\n\n<ol>\n<li><p>Observation: <code>runtime.gopark</code> calls rarely when 2400 #goroutines, and <code>runtime.mutex</code> calls heavily. We infer that most of the code is done before the slow path.</p></li>\n<li><p>Observation: <code>runtime.gopark</code> calls heavily when 4800 #goroutines. We infer that most of the code was entering the slow path, and when we start using <code>runtime.gopark</code>, the runtime scheduler context switching costs must be considered.</p></li>\n</ol>\n\n<p>Considering channels in Go is implemented based on OS synchronization primitives without involving runtime scheduler, eg. Futex on Linux. Therefore its performance decreases linearly with the increasing of problem size.</p>\n\n<p>The above explains the reason why we see a massive performance decrease in <code>sync.Mutex</code>.</p>\n"}], "owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3672, "favorite_count": 8, "accepted_answer_id": 57670078, "answer_count": 2, "score": 16, "last_activity_date": 1566892579, "creation_date": 1566241662, "last_edit_date": 1566422091, "question_id": 57562606, "link": "https://stackoverflow.com/questions/57562606/why-does-sync-mutex-largely-drop-performance-when-goroutine-contention-is-more-t", "title": "Why does sync.Mutex largely drop performance when goroutine contention is more than 3400?", "body": "<p>I am comparing the performance regarding sync.Mutex and Go channels. Here is my benchmark:</p>\n\n<pre><code>// go playground: https://play.golang.org/p/f_u9jHBq_Jc\nconst (\n    start = 300  // actual = start  * goprocs\n    end   = 600 // actual = end    * goprocs\n    step  = 10\n)\n\nvar goprocs = runtime.GOMAXPROCS(0) // 8\n\n// https://perf.golang.org/search?q=upload:20190819.3\nfunc BenchmarkChanWrite(b *testing.B) {\n    var v int64\n    ch := make(chan int, 1)\n    ch &lt;- 1\n    for i := start; i &lt; end; i += step {\n        b.Run(fmt.Sprintf(\"goroutines-%d\", i*goprocs), func(b *testing.B) {\n            b.SetParallelism(i)\n            b.RunParallel(func(pb *testing.PB) {\n                for pb.Next() {\n                    &lt;-ch\n                    v += 1\n                    ch &lt;- 1\n                }\n            })\n        })\n    }\n}\n\n// https://perf.golang.org/search?q=upload:20190819.2\nfunc BenchmarkMutexWrite(b *testing.B) {\n    var v int64\n    mu := sync.Mutex{}\n    for i := start; i &lt; end; i += step {\n        b.Run(fmt.Sprintf(\"goroutines-%d\", i*goprocs), func(b *testing.B) {\n            b.SetParallelism(i)\n            b.RunParallel(func(pb *testing.PB) {\n                for pb.Next() {\n                    mu.Lock()\n                    v += 1\n                    mu.Unlock()\n                }\n            })\n        })\n    }\n}\n</code></pre>\n\n<p>The performance comparison visualization is as follows:</p>\n\n<p><a href=\"https://i.stack.imgur.com/Mt8Fh.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/Mt8Fh.png\" alt=\"enter image description here\"></a></p>\n\n<p>What are the reasons that </p>\n\n<ol>\n<li>sync.Mutex encounters a large performance drop when the number of goroutines goes higher than roughly 3400?</li>\n<li>Go channels are pretty stable but slower than sync.Mutex before?</li>\n</ol>\n\n<p>Raw bench data by benchstat (go test -bench=. -count=5) <code>go version go1.12.4 linux/amd64</code>:</p>\n\n<pre><code>MutexWrite/goroutines-2400-8  48.6ns \u00b1 1%\nMutexWrite/goroutines-2480-8  49.1ns \u00b1 0%\nMutexWrite/goroutines-2560-8  49.7ns \u00b1 1%\nMutexWrite/goroutines-2640-8  50.5ns \u00b1 3%\nMutexWrite/goroutines-2720-8  50.9ns \u00b1 2%\nMutexWrite/goroutines-2800-8  51.8ns \u00b1 3%\nMutexWrite/goroutines-2880-8  52.5ns \u00b1 2%\nMutexWrite/goroutines-2960-8  54.1ns \u00b1 4%\nMutexWrite/goroutines-3040-8  54.5ns \u00b1 2%\nMutexWrite/goroutines-3120-8  56.1ns \u00b1 3%\nMutexWrite/goroutines-3200-8  63.2ns \u00b1 5%\nMutexWrite/goroutines-3280-8  77.5ns \u00b1 6%\nMutexWrite/goroutines-3360-8   141ns \u00b1 6%\nMutexWrite/goroutines-3440-8   239ns \u00b1 8%\nMutexWrite/goroutines-3520-8   248ns \u00b1 3%\nMutexWrite/goroutines-3600-8   254ns \u00b1 2%\nMutexWrite/goroutines-3680-8   256ns \u00b1 1%\nMutexWrite/goroutines-3760-8   261ns \u00b1 2%\nMutexWrite/goroutines-3840-8   266ns \u00b1 3%\nMutexWrite/goroutines-3920-8   276ns \u00b1 3%\nMutexWrite/goroutines-4000-8   278ns \u00b1 3%\nMutexWrite/goroutines-4080-8   286ns \u00b1 5%\nMutexWrite/goroutines-4160-8   293ns \u00b1 4%\nMutexWrite/goroutines-4240-8   295ns \u00b1 2%\nMutexWrite/goroutines-4320-8   280ns \u00b1 8%\nMutexWrite/goroutines-4400-8   294ns \u00b1 9%\nMutexWrite/goroutines-4480-8   285ns \u00b110%\nMutexWrite/goroutines-4560-8   290ns \u00b1 8%\nMutexWrite/goroutines-4640-8   271ns \u00b1 3%\nMutexWrite/goroutines-4720-8   271ns \u00b1 4%\n\nChanWrite/goroutines-2400-8  158ns \u00b1 3%\nChanWrite/goroutines-2480-8  159ns \u00b1 2%\nChanWrite/goroutines-2560-8  161ns \u00b1 2%\nChanWrite/goroutines-2640-8  161ns \u00b1 1%\nChanWrite/goroutines-2720-8  163ns \u00b1 1%\nChanWrite/goroutines-2800-8  166ns \u00b1 3%\nChanWrite/goroutines-2880-8  168ns \u00b1 1%\nChanWrite/goroutines-2960-8  176ns \u00b1 4%\nChanWrite/goroutines-3040-8  176ns \u00b1 2%\nChanWrite/goroutines-3120-8  180ns \u00b1 1%\nChanWrite/goroutines-3200-8  180ns \u00b1 1%\nChanWrite/goroutines-3280-8  181ns \u00b1 2%\nChanWrite/goroutines-3360-8  183ns \u00b1 2%\nChanWrite/goroutines-3440-8  188ns \u00b1 3%\nChanWrite/goroutines-3520-8  190ns \u00b1 2%\nChanWrite/goroutines-3600-8  193ns \u00b1 2%\nChanWrite/goroutines-3680-8  196ns \u00b1 3%\nChanWrite/goroutines-3760-8  199ns \u00b1 2%\nChanWrite/goroutines-3840-8  206ns \u00b1 2%\nChanWrite/goroutines-3920-8  209ns \u00b1 2%\nChanWrite/goroutines-4000-8  206ns \u00b1 2%\nChanWrite/goroutines-4080-8  209ns \u00b1 2%\nChanWrite/goroutines-4160-8  208ns \u00b1 2%\nChanWrite/goroutines-4240-8  209ns \u00b1 3%\nChanWrite/goroutines-4320-8  213ns \u00b1 2%\nChanWrite/goroutines-4400-8  209ns \u00b1 2%\nChanWrite/goroutines-4480-8  211ns \u00b1 1%\nChanWrite/goroutines-4560-8  213ns \u00b1 2%\nChanWrite/goroutines-4640-8  215ns \u00b1 1%\nChanWrite/goroutines-4720-8  218ns \u00b1 3%\n</code></pre>\n\n<p>Go 1.12.4. Hardware:</p>\n\n<pre><code>CPU:       Quad core Intel Core i7-7700 (-MT-MCP-) cache: 8192 KB\n           clock speeds: max: 4200 MHz 1: 1109 MHz 2: 3641 MHz 3: 3472 MHz 4: 3514 MHz 5: 3873 MHz 6: 3537 MHz\n           7: 3410 MHz 8: 3016 MHz\n           CPU Flags: 3dnowprefetch abm acpi adx aes aperfmperf apic arat arch_perfmon art avx avx2 bmi1 bmi2\n           bts clflush clflushopt cmov constant_tsc cpuid cpuid_fault cx16 cx8 de ds_cpl dtes64 dtherm dts epb\n           ept erms est f16c flexpriority flush_l1d fma fpu fsgsbase fxsr hle ht hwp hwp_act_window hwp_epp\n           hwp_notify ibpb ibrs ida intel_pt invpcid invpcid_single lahf_lm lm mca mce md_clear mmx monitor\n           movbe mpx msr mtrr nonstop_tsc nopl nx pae pat pbe pcid pclmulqdq pdcm pdpe1gb pebs pge pln pni\n           popcnt pse pse36 pti pts rdrand rdseed rdtscp rep_good rtm sdbg sep smap smep smx ss ssbd sse sse2\n           sse4_1 sse4_2 ssse3 stibp syscall tm tm2 tpr_shadow tsc tsc_adjust tsc_deadline_timer tsc_known_freq\n           vme vmx vnmi vpid x2apic xgetbv1 xsave xsavec xsaveopt xsaves xtopology xtpr\n</code></pre>\n\n<hr>\n\n<p>Update: I tested on different hardware. It seems the problem still exists:</p>\n\n<p><a href=\"https://i.stack.imgur.com/lSVrQ.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/lSVrQ.png\" alt=\"enter image description here\"></a></p>\n\n<p>bench: <a href=\"https://play.golang.org/p/HnQ44--E4UQ\" rel=\"noreferrer\">https://play.golang.org/p/HnQ44--E4UQ</a></p>\n\n<hr>\n\n<p>Update:</p>\n\n<p>My full benchmark that tested from 8 goroutines to 15000 goroutines, including a comparison on chan/sync.Mutex/atomic:</p>\n\n<p><a href=\"https://i.stack.imgur.com/1gv21.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/1gv21.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["regex", "go"], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 7183492, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8557fb6dc0d0c0d3c7eaf183f58cb09?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/7183492/steve"}, "edited": false, "score": 0, "creation_date": 1566238376, "post_id": 57561912, "comment_id": 101585603, "body": "I think this is just what I needed. Thanks. regex is like Hieroglyphics sometimes"}, {"owner": {"reputation": 938, "user_id": 4380513, "user_type": "registered", "profile_image": "https://graph.facebook.com/553865196/picture?type=large", "display_name": "Zakk Diaz", "link": "https://stackoverflow.com/users/4380513/zakk-diaz"}, "edited": false, "score": 0, "creation_date": 1566238558, "post_id": 57561912, "comment_id": 101585675, "body": "Be sure to accept an answer if it solved your question"}, {"owner": {"reputation": 18299, "user_id": 2191572, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/TWbVr.png?s=128&g=1", "display_name": "MonkeyZeus", "link": "https://stackoverflow.com/users/2191572/monkeyzeus"}, "reply_to_user": {"reputation": 69, "user_id": 7183492, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8557fb6dc0d0c0d3c7eaf183f58cb09?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/7183492/steve"}, "edited": false, "score": 0, "creation_date": 1566238642, "post_id": 57561912, "comment_id": 101585705, "body": "@Steve What they said ^^^"}], "tags": [], "owner": {"reputation": 18299, "user_id": 2191572, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/TWbVr.png?s=128&g=1", "display_name": "MonkeyZeus", "link": "https://stackoverflow.com/users/2191572/monkeyzeus"}, "is_accepted": true, "score": 1, "last_activity_date": 1566238081, "creation_date": 1566238081, "answer_id": 57561912, "question_id": 57561835, "link": "https://stackoverflow.com/questions/57561835/how-to-detect-all-matches-for-regex-in-single-string-in-go/57561912#57561912", "title": "How to detect all matches for regex in single string in go", "body": "<p>Your regex is too rigid, try:</p>\n\n<pre><code>\\[(\\d{7,})\\]\n</code></pre>\n\n<p>and <code>$1</code> will contain the matches.</p>\n\n<p><a href=\"https://regex101.com/r/XoEx56/1\" rel=\"nofollow noreferrer\">https://regex101.com/r/XoEx56/1</a></p>\n"}], "owner": {"reputation": 69, "user_id": 7183492, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8557fb6dc0d0c0d3c7eaf183f58cb09?s=128&d=identicon&r=PG&f=1", "display_name": "Steve", "link": "https://stackoverflow.com/users/7183492/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 29, "favorite_count": 0, "accepted_answer_id": 57561912, "answer_count": 1, "score": -1, "last_activity_date": 1566238081, "creation_date": 1566237728, "question_id": 57561835, "link": "https://stackoverflow.com/questions/57561835/how-to-detect-all-matches-for-regex-in-single-string-in-go", "title": "How to detect all matches for regex in single string in go", "body": "<p>I am attempting to build a regex to detect a unix timestamp like pattern in a string.  However, some strings contain multiple \"unix time\" like patterns and go's regex only detects the first instance of such pattern.</p>\n\n<p>My current regex:</p>\n\n<p>utcRegex, _ := regexp.Compile(<code>^.*\\[(\\d{7,})\\].*</code>)</p>\n\n<p>utcCheck := utcRegex.FindStringSubmatch(string)</p>\n\n<p>utc := utcCheck[1]</p>\n\n<p>Here are some example strings:</p>\n\n<p><strong>Regex works fine with these type of strings</strong></p>\n\n<p>\"Nov  6 11:21:34 [14039] : [1541532094] [DEBUG] FOO BAR\"</p>\n\n<p>The regex properly detects the 1541532094</p>\n\n<p><strong>Regex does not fulfull what I want</strong></p>\n\n<p>\"08-13 11:46:56.379 24980 24980 D SDK: [1565711216] [DEBUG] [15657110953902503] [FOO BAR ]\"</p>\n\n<p>The regex only detects 15657110953902503 but not 1565711216. I am only interested in 1565711216. The regex only finds 15657110953902503</p>\n\n<p>Is there an update I can make to my go regex that will detect both of these and then select the first/second instance of this pattern?</p>\n"}, {"tags": ["linux", "go", "plugins", "arm"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1566234956, "post_id": 57560473, "comment_id": 101584268, "body": "So what part of &quot;No such file or directory&quot; are you having trouble with?"}, {"owner": {"reputation": 81, "user_id": 1312819, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91b00417fcaa5c44ee96f0afdb81e758?s=128&d=identicon&r=PG", "display_name": "witwit", "link": "https://stackoverflow.com/users/1312819/witwit"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1566236200, "post_id": 57560473, "comment_id": 101584763, "body": "The file is there. &quot;/home/pi/plugged/reader.linux.arm.so&quot;  <code>file &#47;home&#47;pi&#47;plugged&#47;reader.linux.arm.so  &#47;home&#47;pi&#47;plugged&#47;reader.linux.arm.so: ELF 32-bit LSB shared object, ARM, EABI5 version 1 (SYSV), dynamically linked, BuildID[sha1]=d7a779de89f48ffb77de2424a5d36e69187124c7, not stripped</code>"}], "answers": [{"tags": [], "owner": {"reputation": 81, "user_id": 1312819, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91b00417fcaa5c44ee96f0afdb81e758?s=128&d=identicon&r=PG", "display_name": "witwit", "link": "https://stackoverflow.com/users/1312819/witwit"}, "is_accepted": true, "score": 0, "last_activity_date": 1566294900, "creation_date": 1566294900, "answer_id": 57571070, "question_id": 57560473, "link": "https://stackoverflow.com/questions/57560473/is-it-possible-to-build-and-run-go-plugins-for-linux-arm/57571070#57571070", "title": "Is it possible to build and run Go plugins for Linux/ARM?", "body": "<p>For anybody else struggling with this, the problem was the build process itself. This is what worked:</p>\n\n<pre><code>CC=arm-linux-gnueabihf-gcc CGO_ENABLED=1 GOOS=linux GOARCH=arm GOARM=7 go build -ldflags=\"-pluginpath=blah -extld=$CC\" -buildmode=plugin -o ./arm-dist/reader.linux.arm.so /app/plugins/reader/...\n</code></pre>\n\n<p>I used a different compiler and set <code>-extld=$CC</code> ldflag.</p>\n"}], "owner": {"reputation": 81, "user_id": 1312819, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/91b00417fcaa5c44ee96f0afdb81e758?s=128&d=identicon&r=PG", "display_name": "witwit", "link": "https://stackoverflow.com/users/1312819/witwit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 1, "accepted_answer_id": 57571070, "answer_count": 1, "score": -2, "last_activity_date": 1566294900, "creation_date": 1566231256, "last_edit_date": 1566234683, "question_id": 57560473, "link": "https://stackoverflow.com/questions/57560473/is-it-possible-to-build-and-run-go-plugins-for-linux-arm", "title": "Is it possible to build and run Go plugins for Linux/ARM?", "body": "<p><code>GOOS=linux GOARCH=arm</code> does not work for plugins? Plugins do not run on linux/arm ? I have built a simple example, that builds a simple plugin like:\n<code>CC=arm-linux-gnueabi-gcc CGO_ENABLED=1 GOOS=linux GOARCH=arm GOARM=7 go build -ldflags=\"-pluginpath=blah\" -buildmode=plugin -o ./arm-dist/reader.linux.arm.so /app/plugins/reader/...</code></p>\n\n<p>No errors,</p>\n\n<p>however when a main app on a raspberrypi tries to open the plugin, it says: <code>could not open ./arm-dist/caller.linux.arm.so plugin: not implemented</code></p>\n\n<p>is this the case? or did I miss something? somewhat of a showstopper...</p>\n\n<p><strong>Update:</strong></p>\n\n<p><code>CGO_ENABLED=1</code> was missing for the main app, d'oh!\nNow I am stuck at a different error message</p>\n\n<p><code>could not open /home/pi/plugged/reader.linux.arm.so plugin.Open(\"/home/pi/plugged/reader.linux.arm.so\"): /home/pi/plugged/reader.linux.arm.so: cannot open shared object file: No such file or directory</code></p>\n"}, {"tags": ["php", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1566227080, "post_id": 57559374, "comment_id": 101580581, "body": "Based on the errors, it looks like your <code>.dat</code> file is not in any of those formats. Your question talks about opening &quot;both .gz and non .gz files&quot; - is this a non-gz file? If so, you obviously won&#39;t be able to read it with a gz reader."}, {"owner": {"reputation": 998, "user_id": 4684493, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1b14bb87a971478b4a6e098f78648a07?s=128&d=identicon&r=PG&f=1", "display_name": "Hintham", "link": "https://stackoverflow.com/users/4684493/hintham"}, "edited": false, "score": 0, "creation_date": 1566227276, "post_id": 57559374, "comment_id": 101580677, "body": "Do you need to calculate md5 hashes for every file in an archive, or for the archive file itself?"}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1566231194, "post_id": 57559787, "comment_id": 101582584, "body": "This code is wrong - if <code>gzip.NewReader</code> returns <code>ErrHeader</code> you use the gz reader, when it should be the opposite."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 2, "last_activity_date": 1566849484, "last_edit_date": 1566849484, "creation_date": 1566228596, "answer_id": 57559787, "question_id": 57559374, "link": "https://stackoverflow.com/questions/57559374/how-to-implement-phps-gzopen-in-go/57559787#57559787", "title": "How to implement PHP&#39;s gzopen in Go?", "body": "<p>Since you need to support reading from both gzip and non-gzip files, add a check to see if the if <code>gzip.NewReader</code> returns the <code>ErrHeader</code> error. If that is returned, fallback to reading the file normally:</p>\n\n<pre><code>file, err := os.Open(\"somefile.dat\")\nif err != nil {\n    return err\n}\n\nvar rc io.ReadCloser\nif gz, err := gzip.NewReader(file); err == gzip.ErrHeader {\n    if _, err := file.Seek(0, io.SeekStart); err != nil {\n        return err\n    }\n    rc = file\n} else if err == nil {\n    rc = gz\n} else {\n    return err\n}\n\nmd5sum := md5.New()\nif _, err := io.Copy(md5sum, rc); err != nil {\n    return err\n}\n\nif err := rc.Close(); err != nil {\n    return err\n}\n\n// TODO: md5sum.Sum\n</code></pre>\n"}], "owner": {"reputation": 523, "user_id": 1796386, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/da317186f67fda767ce8c56fe81bf18b?s=128&d=identicon&r=PG", "display_name": "winhung", "link": "https://stackoverflow.com/users/1796386/winhung"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 57559787, "answer_count": 1, "score": -1, "last_activity_date": 1566849484, "creation_date": 1566226924, "last_edit_date": 1566271124, "question_id": 57559374, "link": "https://stackoverflow.com/questions/57559374/how-to-implement-phps-gzopen-in-go", "title": "How to implement PHP&#39;s gzopen in Go?", "body": "<p>I have to convert a PHP script into Go and am now stumped with a problem (I forsee many more to come).</p>\n\n<p>In the script, it uses <a href=\"https://www.php.net/manual/en/function.gzopen.php\" rel=\"nofollow noreferrer\"><code>gzopen</code></a> to open both .gz and non .gz files and then takes the read data and returns a MD5-hash version of it.\nI have tried using zlib.NewReader, gzip.NewReader and even flate but they are not working. Can someone point me in the right direction? </p>\n\n<pre><code>file, err := os.Open(\"somefile.dat\")\nif err != nil {\n  return err\n}\n\n// rc := flate.NewReader(f) //error: corrupt input before offset 5\n// rc, err := zlib.NewReader(f) //error: invalid header\n// rc, err := gzip.NewReader(f) //error: invalid header\nif err != nil {\n  return err\n}\n\nbuffer := make([]byte, 4096)\nrc.Read(buffer)\n</code></pre>\n\n<p>Note: With regards to converting to MD5 hash, i followed the example <a href=\"https://www.mrwaggel.be/post/generate-md5-hash-of-a-file-in-golang/\" rel=\"nofollow noreferrer\">here</a>\nI originally used the md5.Sum() but that returned a [Size]byte where Size is 16bytes which was not what i needed. I had to convert the MD5 checksum into a 32 character hexadecimal string for it to match the checksum i needed. Hope this helps anybody else.</p>\n"}, {"tags": ["docker", "go", "dockerfile"], "answers": [{"comments": [{"owner": {"reputation": 11211, "user_id": 1819355, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/99463baa1d0e4218941e26c2985620e5?s=128&d=identicon&r=PG", "display_name": "Alexandre M&#233;lard", "link": "https://stackoverflow.com/users/1819355/alexandre-m%c3%a9lard"}, "edited": false, "score": 0, "creation_date": 1567502782, "post_id": 57565835, "comment_id": 101972665, "body": "Thanks for you inputs, anyway I&#39;ve resolved this using environment variables. The configuration file is not the proper way to do it"}], "tags": [], "owner": {"reputation": 15564, "user_id": 6394722, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/117654f31d6ad5c9b2b0e00dcf4b24f3?s=128&d=identicon&r=PG&f=1", "display_name": "atline", "link": "https://stackoverflow.com/users/6394722/atline"}, "is_accepted": false, "score": 1, "last_activity_date": 1566266697, "creation_date": 1566266697, "answer_id": 57565835, "question_id": 57559268, "link": "https://stackoverflow.com/questions/57559268/how-to-push-config-file-to-new-oryd-hydra-docker-image/57565835#57565835", "title": "How to push config file to new oryd/hydra docker image?", "body": "<p>See <a href=\"https://github.com/ory/hydra/blob/master/cmd/root.go#L88\" rel=\"nofollow noreferrer\">github source code</a> of this docker image, the related code is as next:</p>\n\n<pre><code>func initConfig() {\n    if cfgFile != \"\" {\n        // enable ability to specify config file via flag\n        viper.SetConfigFile(cfgFile)\n    } else {\n        path := absPathify(\"$HOME\")\n        if _, err := os.Stat(filepath.Join(path, \".hydra.yml\")); err != nil {\n            _, _ = os.Create(filepath.Join(path, \".hydra.yml\"))\n        }\n\n        viper.SetConfigType(\"yaml\")\n        viper.SetConfigName(\".hydra\") // name of config file (without extension)\n        viper.AddConfigPath(\"$HOME\")  // adding home directory as first search path\n    }\n\n    viper.SetDefault(\"LOG_LEVEL\", \"info\")\n\n    viper.SetEnvKeyReplacer(strings.NewReplacer(\".\", \"_\"))\n    viper.AutomaticEnv() // read in environment variables that match\n\n    // If a config file is found, read it in.\n    if err := viper.ReadInConfig(); err != nil {\n        fmt.Printf(`Config file not found because \"%s\"`, err)\n        fmt.Println(\"\")\n    }\n}\n</code></pre>\n\n<p>From above, you can see in fact what it expected is <code>.hydra.yml</code>, not <code>.hydra</code>, <code>.hydra</code> just the one which remove extension:</p>\n\n<blockquote>\n  <p>viper.SetConfigName(\".hydra\") // name of config file (without extension)</p>\n</blockquote>\n\n<p>So the root cause is: its error indication not friendly which make you encountered problem, change to use <code>.hydra.yml</code> could make it ok.</p>\n"}, {"tags": [], "owner": {"reputation": 63, "user_id": 9956894, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-G0Na5d3IZN0/AAAAAAAAAAI/AAAAAAAACBM/0YF9wj0XqK8/photo.jpg?sz=128", "display_name": "Gustavo Bartolomeo", "link": "https://stackoverflow.com/users/9956894/gustavo-bartolomeo"}, "is_accepted": false, "score": 0, "last_activity_date": 1607782209, "creation_date": 1607782209, "answer_id": 65265863, "question_id": 57559268, "link": "https://stackoverflow.com/questions/57559268/how-to-push-config-file-to-new-oryd-hydra-docker-image/65265863#65265863", "title": "How to push config file to new oryd/hydra docker image?", "body": "<p>In this case I suggest you pass the configuration file (--config ) when starting the docker container. For example:</p>\n<pre class=\"lang-sh prettyprint-override\"><code>docker run -d \\\n  --name ory-hydra-example--hydra \\\n  --network hydraguide \\\n  -p 9000:4444 \\\n  -p 9001:4445 \\\n  -e SECRETS_SYSTEM=$SECRETS_SYSTEM \\\n  -e DSN=$DSN \\\n  -e URLS_SELF_ISSUER=http://127.0.0.1:9000 \\\n  -e URLS_CONSENT=http://127.0.0.1:9020/consent \\\n  -e URLS_LOGIN=http://127.0.0.1:9020/login \\\n  -v $(pwd)/hydra.yaml:/hydra.yaml \\\n  oryd/hydra:v1.8.5 serve all --config hydra.yaml --dangerous-force-http\n</code></pre>\n<p>This way you don't need to create your own dockerfile.</p>\n"}], "owner": {"reputation": 11211, "user_id": 1819355, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/99463baa1d0e4218941e26c2985620e5?s=128&d=identicon&r=PG", "display_name": "Alexandre M&#233;lard", "link": "https://stackoverflow.com/users/1819355/alexandre-m%c3%a9lard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 770, "favorite_count": 2, "answer_count": 2, "score": 1, "last_activity_date": 1607782209, "creation_date": 1566226630, "last_edit_date": 1592644375, "question_id": 57559268, "link": "https://stackoverflow.com/questions/57559268/how-to-push-config-file-to-new-oryd-hydra-docker-image", "title": "How to push config file to new oryd/hydra docker image?", "body": "<p>I am using the oryd/hydra docker image: <a href=\"https://hub.docker.com/r/oryd/hydra\" rel=\"nofollow noreferrer\">https://hub.docker.com/r/oryd/hydra</a>\nin order to build a custom image with my own configuration.</p>\n<p>I did create a custom directory:</p>\n<pre><code>mkdir sso-demo-hydra\ncd sso-demo-hydra\n</code></pre>\n<p>then I create a Dockerfile using that syntax:</p>\n<pre><code>vi Dockerfile\n</code></pre>\n<p>the file content:</p>\n<blockquote>\n<p>$ cat Dockerfile</p>\n<p>FROM oryd/hydra:latest</p>\n<p>COPY .hydra /</p>\n</blockquote>\n<p>when building the image I get no error:</p>\n<blockquote>\n<p>$ docker build -t sso-demo-hydra .</p>\n<p>Sending build context to Docker daemon  8.704kB</p>\n<p>Step 1/2 : FROM oryd/hydra:latest</p>\n<p>---&gt; 50f0a70dbda9</p>\n<p>Step 2/2 : COPY .hydra /</p>\n<p>---&gt; Using cache</p>\n<p>---&gt; 3539634979c0</p>\n<p>Successfully built 3539634979c0</p>\n<p>Successfully tagged sso-demo-hydra:latest</p>\n<p>SECURITY WARNING: You are building a Docker image from Windows against a non-Windows Docker host. All files and directories added to build context will have '-rwxr-xr-x' permissions. It is recommended to double check and reset permissions for sensitive files and directories.</p>\n</blockquote>\n<p>And when I launch the application I get the following warning:</p>\n<blockquote>\n<p>sso-demo-hydra | Config file not found because &quot;Config File &quot;.hydra&quot; Not Found in &quot;[/]&quot;&quot;</p>\n</blockquote>\n<p>PS: there is a .hydra file in the context directory</p>\n<p>Thanks for your support.</p>\n"}, {"tags": ["go", "goroutine", "ulimit"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1566221578, "post_id": 57557801, "comment_id": 101577517, "body": "Interesting situation. BTW, counting goroutines isn&#39;t going to help solve your problem, as goroutines are not directly related to threads. You could have (theoretically) millions of goroutines, and only a single OS thread."}, {"owner": {"reputation": 1446, "user_id": 1930817, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/66Aja.jpg?s=128&g=1", "display_name": "guzmonne", "link": "https://stackoverflow.com/users/1930817/guzmonne"}, "edited": false, "score": 0, "creation_date": 1566227831, "post_id": 57557801, "comment_id": 101580950, "body": "Have you tried modifying the <code>GOMAXPROVS</code> environment variable?"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1566228510, "post_id": 57557801, "comment_id": 101581292, "body": "See also <a href=\"https://stackoverflow.com/q/46484627/1256452\">stackoverflow.com/q/46484627/1256452</a>"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1566229147, "post_id": 57557801, "comment_id": 101581580, "body": "Update (replaces an earlier comment): having had a look at the runtime source (see previous link and its links), you&#39;re definitely getting EAGAIN errors. What&#39;s not clear to me is why you are getting another thread when you have 1306 already, nor why your system is running out at 1306\u2014presumably you&#39;re hitting a system-wide limit. See the fork manpage and <code>cat &#47;proc&#47;sys&#47;kernel&#47;pid_max</code> and <code>&#47;proc&#47;sys&#47;kernel&#47;threads-max</code>; you might be hitting a lower limit from a cgroup <code>pids.max</code>, too."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1566278121, "post_id": 57557801, "comment_id": 101595089, "body": "Hm, if your client processes manage goroutines themselves, why not refactor the client processes to goroutines?"}, {"owner": {"reputation": 799, "user_id": 675083, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/l75tP.jpg?s=128&g=1", "display_name": "sbs", "link": "https://stackoverflow.com/users/675083/sbs"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1566292704, "post_id": 57557801, "comment_id": 101601343, "body": "@MarkusWMahlberg Client processes can also run on different machines, so can&#39;t refactor them."}, {"owner": {"reputation": 799, "user_id": 675083, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/l75tP.jpg?s=128&g=1", "display_name": "sbs", "link": "https://stackoverflow.com/users/675083/sbs"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1566376544, "post_id": 57557801, "comment_id": 101632650, "body": "@torek pid_max is 55296, threads-max is 3656158, and /sys/fs/cgroup/pids/user.slice/user-1000.slice/pids.max is 18247."}, {"owner": {"reputation": 799, "user_id": 675083, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/l75tP.jpg?s=128&g=1", "display_name": "sbs", "link": "https://stackoverflow.com/users/675083/sbs"}, "reply_to_user": {"reputation": 1446, "user_id": 1930817, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/66Aja.jpg?s=128&g=1", "display_name": "guzmonne", "link": "https://stackoverflow.com/users/1930817/guzmonne"}, "edited": false, "score": 0, "creation_date": 1566377259, "post_id": 57557801, "comment_id": 101633017, "body": "@guzmonne setting GOMAXPROCS=1000 (under the number of threads it tries to open when it fails) seems to avoid the runtime error, but the app starts misbehaving and doing strange things probably related to not responding to some clients in time."}, {"owner": {"reputation": 799, "user_id": 675083, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/l75tP.jpg?s=128&g=1", "display_name": "sbs", "link": "https://stackoverflow.com/users/675083/sbs"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1566377387, "post_id": 57557801, "comment_id": 101633077, "body": "@torek Different attempts fail after having different numbers of threads already, eg. another failed with <code>runtime: failed to create new OS thread (have 1291 already; errno=11)</code>. The issue might actually be hardware related, since trying the same with a different CPU (OS and software identical; this is in OpenStack) works fine."}, {"owner": {"reputation": 1446, "user_id": 1930817, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/66Aja.jpg?s=128&g=1", "display_name": "guzmonne", "link": "https://stackoverflow.com/users/1930817/guzmonne"}, "edited": false, "score": 0, "creation_date": 1566400160, "post_id": 57557801, "comment_id": 101646547, "body": "And, do you have to create new threads to handle each client? Can&#39;t you use <code>goroutines</code>?"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1566403856, "post_id": 57557801, "comment_id": 101648428, "body": "I&#39;m not all that familiar with the internals of the go runtime, and I wonder if it automatically spins off new threads (despite GOMAXPROCS defaulting to the number of cpus) when making various blocking system calls."}, {"owner": {"reputation": 799, "user_id": 675083, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/l75tP.jpg?s=128&g=1", "display_name": "sbs", "link": "https://stackoverflow.com/users/675083/sbs"}, "reply_to_user": {"reputation": 1446, "user_id": 1930817, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/66Aja.jpg?s=128&g=1", "display_name": "guzmonne", "link": "https://stackoverflow.com/users/1930817/guzmonne"}, "edited": false, "score": 0, "creation_date": 1566591965, "post_id": 57557801, "comment_id": 101718626, "body": "@guzmonne I&#39;m not creating threads myself; the go runtime is automatically doing that in response to me creating goroutines."}, {"owner": {"reputation": 799, "user_id": 675083, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/l75tP.jpg?s=128&g=1", "display_name": "sbs", "link": "https://stackoverflow.com/users/675083/sbs"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1566592161, "post_id": 57557801, "comment_id": 101718667, "body": "@torek GOMAXPROCS doesn&#39;t have a default I think. It does seem to be a problem related to running out of a resource in the Operating System. Testing with a different OS, I got the server staying alive, but a manually executed client failing after only having 3 threads already. I guess the go runtime just doesn&#39;t handle this situation gracefully?"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1566593541, "post_id": 57557801, "comment_id": 101719120, "body": "@sbs: <code>runtime&#47;debug.go</code> can change the current (internal variable) <code>gomaxprocs</code> via <a href=\"https://golang.org/pkg/runtime/#GOMAXPROCS\" rel=\"nofollow noreferrer\"><code>GOMAXPROCS()</code></a>, but the default <i>is</i> the number of CPUs. But <code>runtime&#47;extern.go</code> says: &quot;There is no limit to the number of threads that can be blocked in system calls on behalf of Go code; those do not count against the GOMAXPROCS limit.&quot; So, yes, probably you have a lot of goroutines that are in blocking system calls. As a workaround you might have these goroutines use a counting semaphore to limit the number of syscall waiters."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1566593928, "post_id": 57557801, "comment_id": 101719219, "body": "The trick will be figuring out what, in your code or libraries you use, is making blocking system calls. The Linux <code>strace</code> utility might be useful here."}], "owner": {"reputation": 799, "user_id": 675083, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/l75tP.jpg?s=128&g=1", "display_name": "sbs", "link": "https://stackoverflow.com/users/675083/sbs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2650, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1566384271, "creation_date": 1566221461, "last_edit_date": 1566384271, "question_id": 57557801, "link": "https://stackoverflow.com/questions/57557801/runtime-failed-to-create-new-os-thread", "title": "runtime: failed to create new OS thread", "body": "<p>On a 54-core machine, I use <code>os.Exec()</code> to spawn hundreds of client processes, and manage them with an abundance of goroutines.</p>\n\n<p>Sometimes, but not always, I get this:</p>\n\n<pre><code>runtime: failed to create new OS thread (have 1306 already; errno=11)\nruntime: may need to increase max user processes (ulimit -u)\nfatal error: newosproc\n</code></pre>\n\n<p>My ulimit is pretty high already:</p>\n\n<pre><code>$ ulimit -u\n1828079\n</code></pre>\n\n<p>There's never a problem if I limit myself to, say, 54 clients.</p>\n\n<p>Is there a way I can handle this situation more gracefully? E.g.\u00a0not bomb out with a fatal error, and just do less/delayed work instead? Or query the system ahead of time and anticipate the maximum amount of stuff I can do (I don't just want to limit to the number of cores though)?</p>\n\n<p>Given my large ulimit, should this error even be happening? <code>grep -c goroutine</code> on the stack output following the fatal error only gives 6087. Each client process (of which there are certainly less than 2000) might have a few goroutines of their own, but nothing crazy.</p>\n\n<p>Edit: the problem only occurs on high-core machines (~60). Keeping everything else constant and just changing the number of cores down to 30 (this being an OpenStack environment, so the same underlying hardware still being used), these runtime errors don't occur.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1566214921, "post_id": 57554386, "comment_id": 101573745, "body": "Even if a const initializer could be nil, your A cannot be const. Const in Go works different. Read <a href=\"https://blog.golang.org/constants\" rel=\"nofollow noreferrer\">blog.golang.org/constants</a> and the language spec."}, {"owner": {"reputation": 800, "user_id": 8208981, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9eeb707bfd44f3aac336e6da2a2954b7?s=128&d=identicon&r=PG&f=1", "display_name": "vonaka", "link": "https://stackoverflow.com/users/8208981/vonaka"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1566219304, "post_id": 57554386, "comment_id": 101576183, "body": "OK, thanks @Volker, it makes sense now. We can&#39;t have const of something that is &quot;pointer-like&quot;. The only thing that confuse me is the error messages. Basically, I can&#39;t have a const of pointer but only because there is no way to initialize it."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1566234986, "post_id": 57554386, "comment_id": 101584279, "body": "Possible duplicates: <a href=\"https://stackoverflow.com/questions/42529691/why-cant-we-declare-a-map-and-fill-it-after-in-the-const/42529986#42529986\">Why can&#39;t we declare a map and fill it after in the const?</a>; <a href=\"https://stackoverflow.com/questions/13137463/declare-a-constant-array/29365828#29365828\">Declare a constant array</a>"}], "answers": [{"tags": [], "owner": {"reputation": 585, "user_id": 6044698, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/75a2287041af2123d1885e78473a5bc8?s=128&d=identicon&r=PG&f=1", "display_name": "jano", "link": "https://stackoverflow.com/users/6044698/jano"}, "is_accepted": true, "score": 9, "last_activity_date": 1566209763, "creation_date": 1566209763, "answer_id": 57554711, "question_id": 57554386, "link": "https://stackoverflow.com/questions/57554386/why-can-a-const-initializer-not-be-nil/57554711#57554711", "title": "Why can a const initializer not be nil?", "body": "<p>I believe that it is because you can only have constants of type <code>boolean</code>, <code>rune</code>, <code>integer</code>, <code>floating-point</code>, <code>complex</code>, and <code>string</code>.\nDocs: <a href=\"https://golang.org/ref/spec#Constants\" rel=\"noreferrer\">https://golang.org/ref/spec#Constants</a></p>\n\n<p>Whereas <code>nil</code> is a zero-value for types <code>pointer</code>, <code>interface</code>, <code>map</code>, <code>slice</code>, <code>channel</code> and <code>function</code>\nDocs: <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"noreferrer\">https://golang.org/ref/spec#The_zero_value</a></p>\n\n<p>You can read more here <a href=\"https://blog.golang.org/constants\" rel=\"noreferrer\">https://blog.golang.org/constants</a></p>\n"}], "owner": {"reputation": 800, "user_id": 8208981, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9eeb707bfd44f3aac336e6da2a2954b7?s=128&d=identicon&r=PG&f=1", "display_name": "vonaka", "link": "https://stackoverflow.com/users/8208981/vonaka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 508, "favorite_count": 0, "closed_date": 1566301912, "accepted_answer_id": 57554711, "answer_count": 1, "score": -2, "last_activity_date": 1566265011, "creation_date": 1566208546, "last_edit_date": 1566265011, "question_id": 57554386, "link": "https://stackoverflow.com/questions/57554386/why-can-a-const-initializer-not-be-nil", "closed_reason": "Duplicate", "title": "Why can a const initializer not be nil?", "body": "<p>I have a type <code>A</code> that is basically a simple map:</p>\n\n<pre><code>type A map[int32]struct{}\n</code></pre>\n\n<p>Now, I would like to have a special value of this type to be able to treat it a bit differently. I thought that it would be smart to use <code>nil</code> for this propose (additionally, this way, all non initialized variables of type <code>A</code> would have this value, and this is also what I would like to have):</p>\n\n<pre><code>const s A = nil\n</code></pre>\n\n<p>But I got</p>\n\n<blockquote>\n  <p>const initializer cannot be nil</p>\n</blockquote>\n\n<p>Sure I can accept this and refactor my program in dozens of different ways. But I'm still wondering why it's impossible to initialize <code>const</code> to <code>nil</code>? There must be an architectural reason but I don't see it.</p>\n\n<p>(Note that I prefer to \"rename\" <code>nil</code> instead of using it directly only because the name <code>nil</code> is not very intuitive in my case.)</p>\n"}, {"tags": ["go", "stripe-payments"], "answers": [{"tags": [], "owner": {"reputation": 2783, "user_id": 1027936, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7c00c38a2a2840ee056e39b4a900d274?s=128&d=identicon&r=PG", "display_name": "nicowernli", "link": "https://stackoverflow.com/users/1027936/nicowernli"}, "is_accepted": false, "score": 0, "last_activity_date": 1566204538, "creation_date": 1566204538, "answer_id": 57553305, "question_id": 57552886, "link": "https://stackoverflow.com/questions/57552886/stripe-charges-fails-when-using-a-customer-source/57553305#57553305", "title": "Stripe Charges fails when using a Customer Source", "body": "<p>OK, so what I was missing is the <code>Customer</code> id. When doing a Charge both IDs have to be given.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>params := &amp;stripe.ChargeParams{\n    Amount:      stripe.Int64(int64(order.total * 100)),\n    Currency:    stripe.String(string(stripe.CurrencyUSD)),\n    Description: stripe.String(\"Order Number \" + order.ID),\n    Customer:    stripe.String(sc.ID),\n}\n\nparams.SetSource(sc.Sources.Data[1].ID)\n\nif _, err := charge.New(params); err != nil {\n    return nil, err\n}\n</code></pre>\n\n<p>This code makes it work.</p>\n"}], "owner": {"reputation": 2783, "user_id": 1027936, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7c00c38a2a2840ee056e39b4a900d274?s=128&d=identicon&r=PG", "display_name": "nicowernli", "link": "https://stackoverflow.com/users/1027936/nicowernli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566204538, "creation_date": 1566202848, "question_id": 57552886, "link": "https://stackoverflow.com/questions/57552886/stripe-charges-fails-when-using-a-customer-source", "title": "Stripe Charges fails when using a Customer Source", "body": "<p>I'm trying to charge a customer with one of the stored credit cards. I'm passing the customer id in the request and I'm getting the customer info from Stripe just fine. The problem is when trying to make the charge to one of the customer sources the library returns an error <code>Must provide source or customer</code>. I checked the <code>sc.Sources.Data[1]</code> (its hardcoded here just for this example) and it has an actual cutsomer source. Can anyone tell me what I'm doing wrong?</p>\n\n<p><strong>EDIT</strong>: If I use a tok_1212321 token it works fine, but I don't find a way to retrieve the token id from stripe, only the cliente sources.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>stripe.Key = os.Getenv(\"STRIPE_KEY\")\nsc, _ := stripeCustomer(request)\n\nparams := &amp;stripe.ChargeParams{\n    Amount:      stripe.Int64(int64(order.total * 100)),\n    Currency:    stripe.String(string(stripe.CurrencyUSD)),\n    Description: stripe.String(\"Order Number \" + order.ID),\n}\n\nparams.SetSource(sc.Sources.Data[1])\n\nif _, err := charge.New(params); err != nil {\n    return nil, err\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 3, "creation_date": 1566201874, "post_id": 57552598, "comment_id": 101567485, "body": "Connect your redis client and see what is says. There is also the <a href=\"https://redis.io/commands/ping\" rel=\"nofollow noreferrer\">ping</a> command to test the connectivity."}, {"owner": {"reputation": 51, "user_id": 8662410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2adcb692e03a2536720e99c1bfe3bbd9?s=128&d=identicon&r=PG&f=1", "display_name": "Racchio", "link": "https://stackoverflow.com/users/8662410/racchio"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1566202270, "post_id": 57552598, "comment_id": 101567641, "body": "There is no other way to check? I may need the solution also to check other sockets"}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 1, "creation_date": 1566202426, "post_id": 57552598, "comment_id": 101567712, "body": "Try connecting to them over raw TCP using <a href=\"https://golang.org/pkg/net/#Dial\" rel=\"nofollow noreferrer\"><code>net.Dial</code></a>."}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 1, "creation_date": 1566202447, "post_id": 57552598, "comment_id": 101567722, "body": "A socket in itself is meaningless. Just try to connect the appropriate service and it will tell you if it can&#39;t."}], "answers": [{"tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": false, "score": 0, "last_activity_date": 1566203039, "creation_date": 1566203039, "answer_id": 57552929, "question_id": 57552598, "link": "https://stackoverflow.com/questions/57552598/how-to-check-if-socket-is-listening/57552929#57552929", "title": "How to check if socket is listening", "body": "<p>You could give a try to <a href=\"https://golang.org/pkg/net/#Dial\" rel=\"nofollow noreferrer\">net.Dial</a>, for example:</p>\n\n<p><a href=\"https://play.golang.org/p/DIsPzOmWqED\" rel=\"nofollow noreferrer\">https://play.golang.org/p/DIsPzOmWqED</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net\"\n    \"path/filepath\"\n)\n\nfunc main() {\n    l, err := net.Dial(\"unix\", filepath.Join(\"/tmp\", \"my.sock\"))\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"l = %+v\\n\", l)\n}\n</code></pre>\n\n<p>If socket is not \"listening\" you may get an error like this:</p>\n\n<pre><code>2019/08/19 10:20:38 dial unix /tmp/my.sock: connect: connection refused\nexit status 1\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 8662410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2adcb692e03a2536720e99c1bfe3bbd9?s=128&d=identicon&r=PG&f=1", "display_name": "Racchio", "link": "https://stackoverflow.com/users/8662410/racchio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 268, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1566203039, "creation_date": 1566201553, "last_edit_date": 1566201843, "question_id": 57552598, "link": "https://stackoverflow.com/questions/57552598/how-to-check-if-socket-is-listening", "title": "How to check if socket is listening", "body": "<p>I need to know if a unix socket (specifically redis socket) is listening using GoLang in an Ubuntu machine. The only way I thought to do this is parsing the </p>\n\n<pre><code>netstat --listen\n</code></pre>\n\n<p>command output. Is there any other way?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1566238176, "post_id": 57552383, "comment_id": 101585512, "body": "Take a look at <a href=\"https://github.com/grpc-ecosystem/grpc-gateway\" rel=\"nofollow noreferrer\">github.com/grpc-ecosystem/grpc-gateway</a>.  Perhaps you can leverage this project, or get some ideas from it."}, {"owner": {"reputation": 54, "user_id": 8726716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ca95b986d1c554e1c3a6e7a683c7526?s=128&d=identicon&r=PG&f=1", "display_name": "Papandadj", "link": "https://stackoverflow.com/users/8726716/papandadj"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1566261584, "post_id": 57552383, "comment_id": 101592282, "body": "@sberry This way need to change proto file and Sacrifice flexibility . Maybe I should find answer in micro api . thanks"}], "answers": [{"tags": [], "owner": {"reputation": 6761, "user_id": 664345, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/34de936228acd10be7665e5c73c53d92?s=128&d=identicon&r=PG", "display_name": "Liyan Chang", "link": "https://stackoverflow.com/users/664345/liyan-chang"}, "is_accepted": false, "score": 0, "last_activity_date": 1567477029, "creation_date": 1567477029, "answer_id": 57764287, "question_id": 57552383, "link": "https://stackoverflow.com/questions/57552383/grpc-protobuf-create-new-struct-with-string/57764287#57764287", "title": "grpc protobuf create new struct with string", "body": "<p>I'm not super familiar with <code>reflect</code> enough to know that it's impossible, but it's definitely not obvious how to do it. You might find that setting up your own registry will be easier:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    registry := map[string]func() interface{}{\n        \"AuthLoginReq\": func() interface{} {\n            return &amp;AuthLoginReq{}\n        },\n    }\n\n    i := registry[\"AuthLoginReq\"]()\n    a := i.(*AuthLoginReq)\n    a.Username = \"root\"\n\n    fmt.Printf(\"%#v\\n\", a)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/CDIIF69CpUd\" rel=\"nofollow noreferrer\">https://play.golang.org/p/CDIIF69CpUd</a></p>\n"}], "owner": {"reputation": 54, "user_id": 8726716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ca95b986d1c554e1c3a6e7a683c7526?s=128&d=identicon&r=PG&f=1", "display_name": "Papandadj", "link": "https://stackoverflow.com/users/8726716/papandadj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 94, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567477029, "creation_date": 1566200502, "question_id": 57552383, "link": "https://stackoverflow.com/questions/57552383/grpc-protobuf-create-new-struct-with-string", "title": "grpc protobuf create new struct with string", "body": "<p>I'm using micro framework to develop my new project, and I have finished the GRPC work. But now, I need to write the gateway to interacting with the frontend. I don't really want to write repetitive code, and I find some code in <code>pb.go</code> file.</p>\n\n<p>the code is defined some struct and init function. like below:</p>\n\n<pre><code>type AuthLoginReq struct {\n    Username             string   `protobuf:\"bytes,1,opt,name=username,proto3\" json:\"username,omitempty\"`\n    Password             string   `protobuf:\"bytes,2,opt,name=password,proto3\" json:\"password,omitempty\"`\n    XXX_NoUnkeyedLiteral struct{} `json:\"-\"`\n    XXX_unrecognized     []byte   `json:\"-\"`\n    XXX_sizecache        int32    `json:\"-\"`\n}\n\nfunc init() {\n    proto.RegisterType((*AuthLoginReq)(nil), \"device.info.provider.service.AuthLoginReq\")\n}\n\n\n</code></pre>\n\n<p>Meanwhile, I found this article <a href=\"https://stackoverflow.com/questions/23030884/is-there-a-way-to-create-an-instance-of-a-struct-from-a-string\">is there a way to create an instance of a struct from a string?</a>. </p>\n\n<p>Fortunately. pb file already defines it for me, but protoc auto generate file is defined nil pointer <code>(*AuthLoginReq)(nil)</code>.</p>\n\n<p>api.go</p>\n\n<pre><code>        qiniuType := proto.MessageType(\"device.info.provider.service.AuthLoginReq\")\n\n        pbValue := reflect.New(qiniuType)\n\n        pbStruct := pbValue.Elem().Interface()\n\n</code></pre>\n\n<p>When I change pbSturct is not really change, because is nil pointer</p>\n\n<pre><code>ctx.ShouldBind(&amp;pbStruct)\n</code></pre>\n\n<p><code>pbStruct</code> is already change. but <code>pbValue</code> is not change. </p>\n\n<p>How do I change <code>pbValue</code>? </p>\n"}, {"tags": ["go", "caching", "redis"], "answers": [{"tags": [], "owner": {"reputation": 30583, "user_id": 605153, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/771f1c4e90ceeec0060c62ff0dbb762e?s=128&d=identicon&r=PG", "display_name": "Mark Bramnik", "link": "https://stackoverflow.com/users/605153/mark-bramnik"}, "is_accepted": false, "score": 0, "last_activity_date": 1566203193, "creation_date": 1566203193, "answer_id": 57552962, "question_id": 57551810, "link": "https://stackoverflow.com/questions/57551810/using-redis-as-cache-with-ttl-and-size-limit-in-byte-for-each-table-in-mysql/57552962#57552962", "title": "Using redis as cache with TTL and size limit in byte for each table in Mysql", "body": "<p>I can't say about go, but\nbasically Redis has a TTL command that allows you to automatically remove the key-value from the cache. In the easiest form you can:</p>\n\n<pre><code>redis&gt; SET table1:id1 \"Hello\"\n\"OK\"\nredis&gt; EXPIRE table1:id1 10 // remove the line after 10 seconds\n(integer) 1\nredis&gt; TTL table1:id1  // if you want to query\n10\n</code></pre>\n"}], "owner": {"reputation": 467, "user_id": 8106002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e477ad83a0db8ad842418b2a4ee15fa?s=128&d=identicon&r=PG&f=1", "display_name": "pat", "link": "https://stackoverflow.com/users/8106002/pat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566203193, "creation_date": 1566197833, "question_id": 57551810, "link": "https://stackoverflow.com/questions/57551810/using-redis-as-cache-with-ttl-and-size-limit-in-byte-for-each-table-in-mysql", "title": "Using redis as cache with TTL and size limit in byte for each table in Mysql", "body": "<p>I want to cache mysql tables (key: id, value: row in serialized bytes) into redis. The cache must support TTL and size limit in bytes for each table.</p>\n\n<p>For example: table <code>user</code> can use 100MB cache, table <code>device</code> can use 100MB cache.</p>\n\n<p>I tried to implement TTL and size limit in application layer but there is too much overhead in managing and monitoring key expiration.</p>\n\n<p>Anyone know any idea or open source that has done it?</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-lambda", "aws-sdk"], "comments": [{"owner": {"reputation": 3250, "user_id": 2362433, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/qqhs1.jpg?s=128&g=1", "display_name": "GiamPy", "link": "https://stackoverflow.com/users/2362433/giampy"}, "edited": false, "score": 1, "creation_date": 1566199268, "post_id": 57551617, "comment_id": 101566391, "body": "What error are you getting?"}, {"owner": {"reputation": 4669, "user_id": 3709060, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/MnFyD.jpg?s=128&g=1", "display_name": "edmamerto", "link": "https://stackoverflow.com/users/3709060/edmamerto"}, "reply_to_user": {"reputation": 3250, "user_id": 2362433, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/qqhs1.jpg?s=128&g=1", "display_name": "GiamPy", "link": "https://stackoverflow.com/users/2362433/giampy"}, "edited": false, "score": 0, "creation_date": 1566225506, "post_id": 57551617, "comment_id": 101579745, "body": "@GiamPy I&#39;m getting a 502"}, {"owner": {"reputation": 1381, "user_id": 5908014, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5b6af9da8f72d19ce770d7ea5d163c8?s=128&d=identicon&r=PG", "display_name": "tpschmidt", "link": "https://stackoverflow.com/users/5908014/tpschmidt"}, "edited": false, "score": 0, "creation_date": 1566494617, "post_id": 57551617, "comment_id": 101683670, "body": "If it&#39;s integrated via api gateway you need to provide a proper response at your lambda function, e.g: <code>{&quot;statusCode&quot;: 200, &quot;body&quot;: json.dumps({&quot;success&quot;:true})}</code>"}], "owner": {"reputation": 4669, "user_id": 3709060, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/MnFyD.jpg?s=128&g=1", "display_name": "edmamerto", "link": "https://stackoverflow.com/users/3709060/edmamerto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 95, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1581351382, "creation_date": 1566196947, "question_id": 57551617, "link": "https://stackoverflow.com/questions/57551617/aws-sdk-go-function-works-but-getting-internal-server-error", "title": "aws-sdk go, function works but getting internal server error", "body": "<p>I'm using the serverless framwework to build a simple function with aws-go. My function works but whenever I try to make a GET request I get an <code>internal server error</code></p>\n\n<p>My function is a copy paste from the <code>aws-sdk</code> documentation</p>\n\n<pre><code>input := &amp;rds.ModifyDBClusterSnapshotAttributeInput{\n    AttributeName:               aws.String(\"restore\"),\n    DBClusterSnapshotIdentifier: aws.String(\"foobar\"),\n    ValuesToAdd: []*string{\n        aws.String(\"123456789\"),\n    },\n    ValuesToRemove: []*string{\n        aws.String(\"all\"),\n    },\n}\n\nresult, err := svc.ModifyDBClusterSnapshotAttribute(input)\nif err != nil {\n    if aerr, ok := err.(awserr.Error); ok {\n        switch aerr.Code() {\n        case rds.ErrCodeDBClusterSnapshotNotFoundFault:\n            fmt.Println(rds.ErrCodeDBClusterSnapshotNotFoundFault, aerr.Error())\n        case rds.ErrCodeInvalidDBClusterSnapshotStateFault:\n            fmt.Println(rds.ErrCodeInvalidDBClusterSnapshotStateFault, aerr.Error())\n        case rds.ErrCodeSharedSnapshotQuotaExceededFault:\n            fmt.Println(rds.ErrCodeSharedSnapshotQuotaExceededFault, aerr.Error())\n        default:\n            fmt.Println(aerr.Error())\n        }\n    } else {\n        // Print the error, cast err to awserr.Error to get the Code and\n        // Message from an error.\n        fmt.Println(err.Error())\n    }\n    return\n}\n\nfmt.Println(result)\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 447, "user_id": 7610791, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sN9k9iX1LNM/AAAAAAAAAAI/AAAAAAAAABY/87-D2rXLihQ/photo.jpg?sz=128", "display_name": "Clifton Avil D&#39;Souza", "link": "https://stackoverflow.com/users/7610791/clifton-avil-dsouza"}, "edited": false, "score": 0, "creation_date": 1566220598, "post_id": 57554024, "comment_id": 101576921, "body": "I have Updated the code .can you tell whats wrong. i am get 0 as Foregin Key. last print statement data is  <code>Clifton zzzzz 0 0001-01-01 00:00:00 +0000 UTC</code>"}, {"owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "reply_to_user": {"reputation": 447, "user_id": 7610791, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sN9k9iX1LNM/AAAAAAAAAAI/AAAAAAAAABY/87-D2rXLihQ/photo.jpg?sz=128", "display_name": "Clifton Avil D&#39;Souza", "link": "https://stackoverflow.com/users/7610791/clifton-avil-dsouza"}, "edited": false, "score": 0, "creation_date": 1566228547, "post_id": 57554024, "comment_id": 101581314, "body": "You have to handle error. I think it is because db.first is returning nothing"}], "tags": [], "owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "is_accepted": true, "score": 0, "last_activity_date": 1566207308, "creation_date": 1566207308, "answer_id": 57554024, "question_id": 57551132, "link": "https://stackoverflow.com/questions/57551132/how-to-add-foreign-key-to-a-model-using-gorm/57554024#57554024", "title": "How to add Foreign Key to a model using Gorm", "body": "<p>The code of the question will create the association between the <code>user(id=1)</code> and the <code>profile(id = 1)</code></p>\n\n<p>You can also use <a href=\"http://gorm.io/docs/associations.html#Association-Mode\" rel=\"nofollow noreferrer\">Association</a> to append foreign keys values.</p>\n\n<pre><code>var user User\ndb.First(&amp;user, 1) \ndb.Model(&amp;user).Association(\"Refer\").Append(user)\n</code></pre>\n"}], "owner": {"reputation": 447, "user_id": 7610791, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-sN9k9iX1LNM/AAAAAAAAAAI/AAAAAAAAABY/87-D2rXLihQ/photo.jpg?sz=128", "display_name": "Clifton Avil D&#39;Souza", "link": "https://stackoverflow.com/users/7610791/clifton-avil-dsouza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 548, "favorite_count": 0, "accepted_answer_id": 57554024, "answer_count": 1, "score": 1, "last_activity_date": 1566374987, "creation_date": 1566194235, "last_edit_date": 1566374987, "question_id": 57551132, "link": "https://stackoverflow.com/questions/57551132/how-to-add-foreign-key-to-a-model-using-gorm", "title": "How to add Foreign Key to a model using Gorm", "body": "<p>I am trying to add foreign key to a model using gorm. How should I pass an object of <code>User</code> Model as foreign key to <code>Profile</code> Model?</p>\n\n<p>My <code>main.go</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/sqlite\"\n)\n\ntype User struct {\n    gorm.Model\n    Refer string\n    Name  string\n}\n\ntype Profile struct {\n    gorm.Model\n    Name      string\n    User      User `gorm:\"association_foreignkey:Refer\"` // use Refer as association foreign key\n    UserRefer string\n}\n\nfunc main() {\n    db, err := gorm.Open(\"sqlite3\", \"test.db\")\n    if err != nil {\n        panic(\"failed to connect database\")\n    }\n    defer db.Close()\n\n    // Migrate the schema\n    db.AutoMigrate(&amp;User{})\n    db.AutoMigrate(&amp;Profile{})\n\n    // Create\n    db.Create(&amp;User{Name: \"Clifton\"})\n\n    // Read\n    var user User\n    db.Debug().First(&amp;user, 1)\n    db.Debug().Create(&amp;Profile{Name: \"Clifton\",\n        UserRefer: \"yyyyy\"}).Association(\"User\").Append(user)\n    // db.Debug().Model(&amp;user).Association(\"Refer\").Append(user)\n    var profile Profile\n    db.Debug().Find(&amp;profile, 1)\n    fmt.Println(profile.Name, profile.UserRefer, profile.User.ID, profile.User.CreatedAt)\n\n}\n</code></pre>\n"}, {"tags": ["go", "tfs"], "comments": [{"owner": {"reputation": 3250, "user_id": 2362433, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/qqhs1.jpg?s=128&g=1", "display_name": "GiamPy", "link": "https://stackoverflow.com/users/2362433/giampy"}, "edited": false, "score": 1, "creation_date": 1566199410, "post_id": 57550903, "comment_id": 101566443, "body": "Be very careful to how you pass parameters to <code>exec.Command</code>. I&#39;ve spent days in trying to debug a simple command. I would not use back ticks on your variadic arguments, make an attempt at using double quotes, and if you have any spaces in your arguments, make sure to use different variadic. Also, give <code>bash -c</code> a try and quote your command."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1566218920, "post_id": 57550903, "comment_id": 101575951, "body": "If those are real credentials, make sure you change your administrator password immediately now that it&#39;s been posted on the internet."}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566241133, "post_id": 57560814, "comment_id": 101586704, "body": "To check if lack of stdin is an issue you (the OP) could try running <code>tf \u2026args\u2026 &lt; &#47;dev&#47;null</code> and see if that still works."}], "tags": [], "owner": {"reputation": 36, "user_id": 10653205, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/biZZx.jpg?s=128&g=1", "display_name": "Adrien", "link": "https://stackoverflow.com/users/10653205/adrien"}, "is_accepted": false, "score": 1, "last_activity_date": 1566232807, "creation_date": 1566232807, "answer_id": 57560814, "question_id": 57550903, "link": "https://stackoverflow.com/questions/57550903/exec-command-and-terminal-execution-results-are-different/57560814#57560814", "title": "exec.Command and terminal execution results are different", "body": "<blockquote>\n  <p>I tried to write it to shell file, then use exec to call it, but it still failed.</p>\n</blockquote>\n\n<p>What if you try to execute that shell file manually?</p>\n\n<p>You might also want to dump the HTTP traffic and figure out any notable difference. This can be done with tcpdump: <code>tcpdump -A -vvv port 8080</code></p>\n\n<p>The issue might also be related to the fact that your child process has its stdin connected to /dev/null, so if the binary is expecting to read anything there the behaviour will differ with running it from a shell manually (where the child process inherits your shell's stdin).</p>\n"}], "owner": {"reputation": 11, "user_id": 7900170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d34f2068803a014dc98323cfcf1314c6?s=128&d=identicon&r=PG&f=1", "display_name": "zt ele", "link": "https://stackoverflow.com/users/7900170/zt-ele"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1566232807, "creation_date": 1566192356, "last_edit_date": 1566222151, "question_id": 57550903, "link": "https://stackoverflow.com/questions/57550903/exec-command-and-terminal-execution-results-are-different", "title": "exec.Command and terminal execution results are different", "body": "<p>I want to use <code>tf</code> in my Go program. Like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    cmd := exec.Command(\"tf\", `workspace`, `-new`, `testsssss`, `-collection:http://xxx.xxx.xxx:8080/tfs/new/`, `-login:Administrator,op@ms2019`)\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n    err := cmd.Run()\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>but I always get the result:</p>\n\n<blockquote>\n  <p>Error: Access is denied when connecting to the TFS server\n  <a href=\"http://xxx.xxx.xxx:8080/\" rel=\"nofollow noreferrer\">http://xxx.xxx.xxx:8080/</a> (authentication as an administrator)</p>\n</blockquote>\n\n<p>when I run the command in terminal it works:</p>\n\n<blockquote>\n  <p>tf workspace -new testsss -collection:<a href=\"http://xxx.xxx.xxx:8080/tfs/new/\" rel=\"nofollow noreferrer\">http://xxx.xxx.xxx:8080/tfs/new/</a>\n  -login:Administrator,op@ms2019</p>\n</blockquote>\n\n<p>I tried to write it to shell file, then use exec to call it, but it still failed.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "is_accepted": true, "score": 0, "last_activity_date": 1566165012, "creation_date": 1566165012, "answer_id": 57548623, "question_id": 57548566, "link": "https://stackoverflow.com/questions/57548566/web-server-and-listening-nats-at-the-same-time/57548623#57548623", "title": "Web server and listening nats at the same time", "body": "<p><code>http.ListenAndServe</code> is a blocking call.  Start it on a new goroutine:</p>\n\n<p><code>go http.ListenAndServe(\":8081\", nil)</code></p>\n"}], "owner": {"reputation": 5455, "user_id": 703529, "user_type": "registered", "accept_rate": 74, "profile_image": "https://lh3.googleusercontent.com/-G-kFsAfpLpU/AAAAAAAAAAI/AAAAAAAAAJE/8uMPWwMFaD0/photo.jpg?sz=128", "display_name": "serkan", "link": "https://stackoverflow.com/users/703529/serkan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 57548623, "answer_count": 1, "score": 0, "last_activity_date": 1566203466, "creation_date": 1566164446, "last_edit_date": 1566203466, "question_id": 57548566, "link": "https://stackoverflow.com/questions/57548566/web-server-and-listening-nats-at-the-same-time", "title": "Web server and listening nats at the same time", "body": "<p>My code reads input from terminal and send those value to <em>nats</em> while it needs to have an http endpoint.</p>\n\n<p>Separately it works but when I combine all of them it does not read from <em>nats</em>. If you could point me to a right direction I would appreciate. </p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    nats \"github.com/nats-io/nats.go\"\n    \"html/template\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n)\n\n\nfunc main() {\n    wd, err := os.Getwd()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    tmpl := template.Must(template.ParseFiles(wd + \"/template/main.html\"))\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        data := TodoPageData{\n            PageTitle: \"Demo\",          \n        }\n        tmpl.Execute(w, data)\n    })\n    http.ListenAndServe(\":8081\", nil)\n\n    type message struct {\n        content string\n    }\n    var messages []message\n\n    nc, err := nats.Connect(\n        nats.DefaultURL,\n    )\n\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer nc.Close()\n\n    // Subscribe\n    if _, err := nc.Subscribe(\"updates\", func(m *nats.Msg) {\n        fmt.Printf(\"Received a message: %s\\n\", string(m.Data))\n    }); err != nil {\n        log.Fatal(err)\n    }\n\n    // io r/w\n    scanner := bufio.NewScanner(os.Stdin)\n    for scanner.Scan() {\n        if err := nc.Publish(\"updates\", []byte(scanner.Text())); err != nil {\n            log.Fatal(err)\n        }\n        messages = append(messages, message{scanner.Text()})\n        for _, message := range messages {\n            fmt.Println(message.content)\n        }\n    }\n\n    if scanner.Err() != nil {\n        // handle error.\n    }\n}\n</code></pre>\n"}, {"tags": ["python", "tensorflow", "go", "python-imaging-library"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566220417, "post_id": 57548441, "comment_id": 101576816, "body": "The standard <a href=\"https://golang.org/pkg/image\" rel=\"nofollow noreferrer\"><code>image</code></a> package&#39;s <a href=\"https://golang.org/pkg/image#Decode\" rel=\"nofollow noreferrer\"><code>image.Decode</code></a> will decode an image for you. You need to know what format <code>PIL</code> is using to get the same data from the resultant <code>image.Image</code>; probably via looping over the bounds and calling <code>At</code> or knowing/converting it to a specific <code>image.Image</code> implementation and looping over the <code>Pix</code> field."}, {"owner": {"reputation": 51, "user_id": 11943909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62a986c685885fadcd636b4159863f9a?s=128&d=identicon&r=PG&f=1", "display_name": "Stefan995", "link": "https://stackoverflow.com/users/11943909/stefan995"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566313728, "post_id": 57548441, "comment_id": 101613415, "body": "Thank you for your suggestion. I will do that."}], "owner": {"reputation": 51, "user_id": 11943909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62a986c685885fadcd636b4159863f9a?s=128&d=identicon&r=PG&f=1", "display_name": "Stefan995", "link": "https://stackoverflow.com/users/11943909/stefan995"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1566220073, "creation_date": 1566163042, "last_edit_date": 1566220073, "question_id": 57548441, "link": "https://stackoverflow.com/questions/57548441/reading-image-file-in-go-v-s-reading-image-file-in-python", "title": "Reading Image File in Go v.s. Reading Image File in Python", "body": "<p>I have code written in Python which reads an image file using <code>PIL</code> library, and converts it to n-dimensional numpy array of <code>uint8</code> values:</p>\n\n<pre><code>    def load_image_into_numpy_array(image):\n          (im_width, im_height) = image.size\n          return np.array(image.getdata()).reshape((im_height, im_width, 3)).astype(np.uint8)\n\n    image_raw = Image.open(img)\n    image = load_image_into_numpy_array(image_raw)\n</code></pre>\n\n<p>Once I try to print out pixel values from <code>image[0][0][0]</code> up to <code>image[9][0][0]</code>, I get the following output:</p>\n\n<pre><code>image[0][0][0] = 51\nimage[1][0][0] = 51\nimage[2][0][0] = 47\nimage[3][0][0] = 40\nimage[4][0][0] = 38\nimage[5][0][0] = 48\nimage[6][0][0] = 65\nimage[7][0][0] = 81\nimage[8][0][0] = 94\nimage[9][0][0] = 89\nimage[10][0][0] = 84\n</code></pre>\n\n<p>In Go, I am reading an image by calling the <code>ioutil.ReadFile</code> function, and converting it to Tensor by calling Tensorflow API for Go like so:</p>\n\n<pre><code>b, err := ioutil.ReadFile(imagePath)\nif err != nil {\n    return nil, err\n}\n\ntensor, err := tf.NewTensor(string(b))\nif err != nil {\n    return nil, err\n}\n</code></pre>\n\n<p>Once I run this Tensor through a <code>tf.Session</code> so that I can convert its values to <code>uint8</code>, expand its dimensions so it matches the models input and try to print out pixel values from <code>tensor[0][0][0][0]</code> up to <code>tensor[0][9][0][0]</code> , I get the following output:</p>\n\n<pre><code>tensor[0][0][0][0]: 50\ntensor[0][1][0][0]: 48\ntensor[0][2][0][0]: 45\ntensor[0][3][0][0]: 39\ntensor[0][4][0][0]: 37\ntensor[0][5][0][0]: 47\ntensor[0][6][0][0]: 65\ntensor[0][7][0][0]: 80\ntensor[0][8][0][0]: 95\ntensor[0][9][0][0]: 88\n</code></pre>\n\n<p>I figured that when reading Image in python using <code>PIL</code> library, it internally decodes an byte array to an image of specific format. In Go I am reading an array of bytes and converting it to Tensor as is. There is no decoding phase.</p>\n\n<p>I cannot change code in Python, which means that I have to find a way to decode array of byes read by <code>ReadFile</code> function, same way as <code>PIL.Image.open</code> decodes it.</p>\n\n<p>Is there a package in Go which allows me to read an image the same way as PIL does. What would be the best way to approach this type of problem? Possibly find out if <code>PIL.Image</code> library wraps a certain C function and create same wrapper function in Go?</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566155986, "post_id": 57547563, "comment_id": 101558401, "body": "Initialize the Genre field first, because as it stands it&#39;s a <code>nil</code> pointer and will cause panic when you try to reference its fields, and then pass in the pointers to the Genre&#39;s fields. i.e. <code>&amp;book.Genre.Name</code>"}, {"owner": {"reputation": 75, "user_id": 10271393, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qt896eFlmxI/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPsBpvXUA9RVF54HuMVfKN58fta7w/mo/photo.jpg?sz=128", "display_name": "Showner91", "link": "https://stackoverflow.com/users/10271393/showner91"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566160158, "post_id": 57547563, "comment_id": 101559342, "body": "I tried initialising the genre by adding var genre models.Genre  and then I added &amp; book.Genre.Name, &amp;book.Genre.ID in the scan method but I get the following error: invalid memory address or nil pointer dereference  Am I initialising it correctly? Sorry if it&#39;s a silly question, I&#39;m pretty new to Go!"}, {"owner": {"reputation": 75, "user_id": 10271393, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qt896eFlmxI/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPsBpvXUA9RVF54HuMVfKN58fta7w/mo/photo.jpg?sz=128", "display_name": "Showner91", "link": "https://stackoverflow.com/users/10271393/showner91"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566161077, "post_id": 57547563, "comment_id": 101559547, "body": "Ok I figured it out thanks for your help. In the scan method I had to assign the values to genre by doing &amp;genre.Name, &amp;genre. Thanks!"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566192687, "post_id": 57547563, "comment_id": 101564181, "body": "Instead of initializing a separate variable you can directly initialize the field <code>book.Genre = new(Genre)</code> and then use <code>&amp;book.Genre.Name</code>. Or you can do it with the separate variable, whatever suits you better."}, {"owner": {"reputation": 75, "user_id": 10271393, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qt896eFlmxI/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPsBpvXUA9RVF54HuMVfKN58fta7w/mo/photo.jpg?sz=128", "display_name": "Showner91", "link": "https://stackoverflow.com/users/10271393/showner91"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566218539, "post_id": 57547563, "comment_id": 101575715, "body": "Ah I didn&#39;t know it was possible to initialize like that. I tried it and I prefer this way of doing it. Thansk mate!"}], "owner": {"reputation": 75, "user_id": 10271393, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qt896eFlmxI/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPsBpvXUA9RVF54HuMVfKN58fta7w/mo/photo.jpg?sz=128", "display_name": "Showner91", "link": "https://stackoverflow.com/users/10271393/showner91"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1566156217, "creation_date": 1566155145, "last_edit_date": 1566156217, "question_id": 57547563, "link": "https://stackoverflow.com/questions/57547563/how-to-retrieve-data-from-mysql-with-join-query", "title": "How to retrieve data from MySQL with join query", "body": "<p>I'm building a simple Go REST API with MySQL and I'm having some trouble querying the data when it comes to slightly more complicated queries. I have 2 models: books and genres. The model definitions in go are as below:</p>\n\n<pre><code>type Book struct {\n    ID    string  `json:\"id\"`\n    Title string  `json:\"title\"`\n    Genre *Genre  `json:\"genre\"`\n    Price float64 `json:\"price\"`\n}\n\n\ntype Genre struct {\n    ID   string `json:\"id\"`\n    Name string `json:\"name\"`\n}\n</code></pre>\n\n<p>In SQL, the book table has the fields id, title, price, and id_genre which is a foreign key.</p>\n\n<p>The confusion is after performing the select which returns the rows, I'm not sure how to add the information to the Genre field when I'm looping through the rows</p>\n\n<pre><code>result, err := database.DB.Query(\"SELECT a.id_book, a.title, a.price, b.name, b.id_genre FROM bookshelf.books a JOIN bookshelf.genres b ON a.id_genre = b.id_genre\")\n\nfor result.Next() {\n    var book models.Book\n\n    // ????\n    err := result.Scan(&amp;book.ID, &amp;book.Title, &amp;book.Price, &amp;book.Genre )\n\n    if err != nil {\n        panic(err.Error())\n    }\n    // ...more code\n}\n</code></pre>\n\n<p>Clearly in the result.Scan method is wrong, but I'm not sure how to go about the genre part.</p>\n\n<p>Is this the right approach or am I approaching this all wrong?</p>\n"}, {"tags": ["sql", "unit-testing", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1566148552, "post_id": 57546743, "comment_id": 101556749, "body": "The best way is usually to use a transaction, then ROLLBACK, so they are never committed in the first place."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1566149185, "post_id": 57546743, "comment_id": 101556922, "body": "<a href=\"https://github.com/DATA-DOG/go-txdb\" rel=\"nofollow noreferrer\">github.com/DATA-DOG/go-txdb</a> can help a lot with that."}, {"owner": {"reputation": 1624, "user_id": 7581022, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/exh3E.jpg?s=128&g=1", "display_name": "Oussama Ben Ghorbel", "link": "https://stackoverflow.com/users/7581022/oussama-ben-ghorbel"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1566150838, "post_id": 57546743, "comment_id": 101557268, "body": "Hey @Flimzy indeed that&#39;s what I needed. Could you please write an answer so I can accept it so people facing the same issue would go check out that repo? Many thanks."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1566151426, "last_edit_date": 1566151426, "creation_date": 1566151127, "answer_id": 57547063, "question_id": 57546743, "link": "https://stackoverflow.com/questions/57546743/whats-the-best-way-to-delete-all-database-records-used-for-a-test-suite/57547063#57547063", "title": "What&#39;s the best way to delete all database records used for a Test suite?", "body": "<p>The best way is usually to use a transaction, then ROLLBACK, so they are never committed in the first place. </p>\n\n<p>The <a href=\"https://github.com/DATA-DOG/go-txdb\" rel=\"nofollow noreferrer\"><code>github.com/DATA-DOG/go-txdb</code></a> package can help a lot with that.</p>\n\n<hr>\n\n<p>Final code: </p>\n\n<pre><code>import (\n    \"database/sql\"\n    \"os\"\n    \"testing\"\n\n    txdb \"github.com/DATA-DOG/go-txdb\"\n\n    \"github.com/romanyx/polluter\"\n)\n\n//mostly sql tests\nfunc init() {\n    txdb.Register(\"txdb\", \"mysql\", \"root:root@/betell_rest\")\n}\n\nfunc TestAddUser(t *testing.T) {\n    db, err := sql.Open(\"txdb\", \"root:root@/betell_rest\")\n    if err != nil {\n        t.Fatal(err)\n    }\n    defer db.Close()\n\n    users, _ := AllUsers(db)\n    userscount := len(users)\n    err = AddUser(db, \"bla@gmail.com\", \"pass\")\n    if err != nil {\n        t.Fatal(\"AddUser() failed\")\n    }\n\n    users, _ = AllUsers(db)\n    if (userscount + 1) != len(users) {\n        t.Fatal(\"AddUser() failed to write in database\")\n    }\n}\n</code></pre>\n\n<p>Note: Also you can pass <code>db</code> into your polluter so you don't affect your database at all.</p>\n"}], "owner": {"reputation": 1624, "user_id": 7581022, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/exh3E.jpg?s=128&g=1", "display_name": "Oussama Ben Ghorbel", "link": "https://stackoverflow.com/users/7581022/oussama-ben-ghorbel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 263, "favorite_count": 0, "accepted_answer_id": 57547063, "answer_count": 1, "score": 0, "last_activity_date": 1566151426, "creation_date": 1566148457, "last_edit_date": 1566148554, "question_id": 57546743, "link": "https://stackoverflow.com/questions/57546743/whats-the-best-way-to-delete-all-database-records-used-for-a-test-suite", "title": "What&#39;s the best way to delete all database records used for a Test suite?", "body": "<p>I have a test suite that pollute my database using a seed read from a YAML file. </p>\n\n<p>I'm wondering is there a way to clean my database (delete all records used for the test suite) after running my tests. </p>\n\n<pre><code>// Open db and returns pointer and closer func\nfunc prepareMySQLDB(t *testing.T) (db *sql.DB, closer func() error) {\n    db, err := sql.Open(\"mysql\", \"user:pass@/database\")\n    if err != nil {\n        t.Fatalf(\"open mysql connection: %s\", err)\n    }\n    return db, db.Close\n}\n// Pollute my database\nfunc polluteDb(db *sql.DB, t *testing.T) {\n    seed, err := os.Open(\"seed.yml\")\n    if err != nil {\n        t.Fatalf(\"failed to open seed file: %s\", err)\n    }\n    defer seed.Close()\n    p := polluter.New(polluter.MySQLEngine(db))\n    if err := p.Pollute(seed); err != nil {\n        t.Fatalf(\"failed to pollute: %s\", err)\n    }\n}\n\nfunc TestAllUsers(t *testing.T) {\n    t.Parallel()\n\n    db, closeDb := prepareMySQLDB(t)\n    defer closeDb()\n\n    polluteDb(db, t)\n\n    users, err := AllUsersD(db)\n    if err != nil {\n        t.Fatal(\"AllUsers() failed\")\n    }\n\n    got := users[0].Email\n    if got != \"myemail@gmail.com\" {\n        t.Errorf(\"AllUsers().Email = %s; want myemail@gmail.com\", got)\n    }\n\n    got1 := len(users)\n    if got1 != 1 {\n        t.Errorf(\"len(AllUsers()) = %d; want 1\", got1)\n    }\n}\n\n\n// Test I'm interested in\nfunc TestAddUser(t *testing.T) {\n    t.Parallel()\n\n    db, closeDb := prepareMySQLDB(t)\n    defer closeDb()\n\n    polluteDb(db, t)\n\n    user, err := AddUser(...)\n    if err != nil {\n        t.Fatal(\"AddUser() failed\")\n    }\n\n    //how can I clean my database after this? \n}\n</code></pre>\n\n<p>Should I retrieve the last ID inserted in TestAddUser() and just delete that line manually or there's any other way to save my database state and retrieve it after? </p>\n\n<p>As I said I'm new to Go so any other comments on my code or what so ever are strongly appreciated.  </p>\n"}, {"tags": ["go", "go-modules"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1566144395, "last_edit_date": 1566144395, "creation_date": 1566143732, "answer_id": 57546178, "question_id": 57546095, "link": "https://stackoverflow.com/questions/57546095/cant-load-package-in-brand-new-go-project/57546178#57546178", "title": "Can&#39;t load package in brand new Go project", "body": "<p>There are no .go files under github.com/x80486/gauge-basics, because you moved them under a different directory. You can run go build under the directory containing the source files or add another .go in the gauge-basics directory importing them.</p>\n"}], "owner": {"reputation": 5057, "user_id": 4695271, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/fNlXZ.png?s=128&g=1", "display_name": "x80486", "link": "https://stackoverflow.com/users/4695271/x80486"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 173, "favorite_count": 0, "accepted_answer_id": 57546178, "answer_count": 1, "score": 1, "last_activity_date": 1566144395, "creation_date": 1566143019, "question_id": 57546095, "link": "https://stackoverflow.com/questions/57546095/cant-load-package-in-brand-new-go-project", "title": "Can&#39;t load package in brand new Go project", "body": "<p>I'm trying modules in Go. I'm outside the <code>GOPATH</code> and using version <code>1.12.6</code>:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>GOBIN=\"/home/x80486/Workshop/go/bin/\"\nGOPATH=\"/home/x80486/Workshop/go/\"\nGOROOT=\"/home/x80486/.asdf/installs/golang/1.12.6/go/\"\n</code></pre>\n\n<p>I created a new project and initialized it as a module inside: <code>/home/x80486/Workshop/Development/gauge-basics</code>. I then created a file <code>example_spec.go</code> with this content:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package stepImpl\n\nimport (\n  \"github.com/getgauge-contrib/gauge-go/gauge\"\n)\n\nvar _ = gauge.Step(\"Run me before any other\", func() {})\n</code></pre>\n\n<p>...and I ran <code>go test</code>:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>[x80486@uplink gauge-basics]$ go test\ngo: finding github.com/getgauge-contrib/gauge-go/gauge latest\ngo: finding github.com/getgauge/common latest\ngo: finding github.com/golang/protobuf/proto latest\ngo: finding github.com/dmotylev/goproperties latest\n?       github.com/x80486/gauge-basics  [no test files]\n</code></pre>\n\n<p>Everything is somehow OK, but as soon as I move this file into a folder named <code>stepImpl</code>, nothing works:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>[x80486@uplink gauge-basics]$ go build\ncan't load package: package github.com/x80486/gauge-basics: unknown import path \"github.com/x80486/gauge-basics\": cannot find module providing package github.com/x80486/gauge-basics\n</code></pre>\n\n<p>I can't understand why moving a file to a folder with the package name would break the project.</p>\n\n<hr>\n\n<p>This is the generated <code>go.mod</code> file:</p>\n\n<pre><code>module github.com/x80486/gauge-basics\n\ngo 1.12\n\nrequire (\n    github.com/dmotylev/goproperties v0.0.0-20140630191356-7cbffbaada47 // indirect\n    github.com/getgauge-contrib/gauge-go v0.1.3 // indirect\n    github.com/getgauge/common v0.0.0-20190514095629-619e107433ce // indirect\n    github.com/golang/protobuf v1.3.2 // indirect\n)\n</code></pre>\n"}, {"tags": ["go", "circleci-2.0", "circleci-workflows"], "comments": [{"owner": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "edited": false, "score": 0, "creation_date": 1566198026, "post_id": 57545628, "comment_id": 101565871, "body": "Your main file import looks strange. Should it be something similar to &#39;github.com/username/graphic&#39;?"}, {"owner": {"reputation": 562, "user_id": 132296, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0ec63faaf9bdf72cb610f23f7579ef46?s=128&d=identicon&r=PG", "display_name": "HX_unbanned", "link": "https://stackoverflow.com/users/132296/hx-unbanned"}, "reply_to_user": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "edited": false, "score": 0, "creation_date": 1566199561, "post_id": 57545628, "comment_id": 101566498, "body": "Hmm. I think no, because it is importing local directory with .go file in the repo I am importing. Do you mean I do not need to import local .go package files or to do it differently?"}, {"owner": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "edited": false, "score": 0, "creation_date": 1566208188, "post_id": 57545628, "comment_id": 101570483, "body": "Just saw you use DEP. As far as i remember for dep you have to follow Golang folder structure with GOPATH (<a href=\"https://github.com/golang/go/wiki/GOPATH\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/GOPATH</a>) env variable set. Make sure you have it set in the docker container you run in CircleCI. Also, make sure you dont use absolute path to import packages. You either import with GOPATH taken as root or use go modules."}, {"owner": {"reputation": 562, "user_id": 132296, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0ec63faaf9bdf72cb610f23f7579ef46?s=128&d=identicon&r=PG", "display_name": "HX_unbanned", "link": "https://stackoverflow.com/users/132296/hx-unbanned"}, "reply_to_user": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "edited": false, "score": 0, "creation_date": 1566211136, "post_id": 57545628, "comment_id": 101571891, "body": "Hmm. So. I have this output from &#39;go env&#39;: <code>GOBIN=&quot;&#47;go&#47;bin&quot; GOPATH=&quot;&#47;go&quot; GOROOT=&quot;&#47;usr&#47;local&#47;go&quot;</code>  And I use &#39;working_directory&#39; attribute in CircleCI config.yml like this: <code>working_directory: &#47;go&#47;src&#47;github.com&#47;&lt;my-account&gt;&#47;project</code>  What, based on this, would working paths here? Thanks."}, {"owner": {"reputation": 562, "user_id": 132296, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0ec63faaf9bdf72cb610f23f7579ef46?s=128&d=identicon&r=PG", "display_name": "HX_unbanned", "link": "https://stackoverflow.com/users/132296/hx-unbanned"}, "reply_to_user": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "edited": false, "score": 0, "creation_date": 1566231710, "post_id": 57545628, "comment_id": 101582829, "body": "@ArkadyB , any ideas, mate?"}, {"owner": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "edited": false, "score": 0, "creation_date": 1566266581, "post_id": 57545628, "comment_id": 101593001, "body": "So, the working directory looks ok (are they for ur CicleCI instance?). Check where is this coming from <code>_&#47;go&#47;src&#47;github.com&#47;user&#47;project&#47;vendor&#47;github.com&#47;fogleman&#47;&zwnj;&#8203;gg</code>? Could you also show ur circle.yml?"}, {"owner": {"reputation": 562, "user_id": 132296, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0ec63faaf9bdf72cb610f23f7579ef46?s=128&d=identicon&r=PG", "display_name": "HX_unbanned", "link": "https://stackoverflow.com/users/132296/hx-unbanned"}, "reply_to_user": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "edited": false, "score": 0, "creation_date": 1566282750, "post_id": 57545628, "comment_id": 101596455, "body": "@ArkadyB, I updated the question with complete config.yml . Please take a look."}, {"owner": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "edited": false, "score": 0, "creation_date": 1566283768, "post_id": 57545628, "comment_id": 101596894, "body": "I am not entirely sure you need to re-export Go env vars in golang docker image, i would say Circle would already care about that for you. Also, if you use dep, you don&#39;t need to download dependencies manually with <code>go get</code>, that&#39;s why you would have Gopkg.toml and Gopkg.lock files. Once <code>dep ensure</code> is run for your app, it should download all required dependencies. Check this example here - <a href=\"https://gist.github.com/azihsoyn/7f307e39e4a493c24235367e711e3725\" rel=\"nofollow noreferrer\">gist.github.com/azihsoyn/7f307e39e4a493c24235367e711e3725</a> . In case nothin would work, try to commit vendor folder along with your project and check if Circle built succeeds."}, {"owner": {"reputation": 562, "user_id": 132296, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0ec63faaf9bdf72cb610f23f7579ef46?s=128&d=identicon&r=PG", "display_name": "HX_unbanned", "link": "https://stackoverflow.com/users/132296/hx-unbanned"}, "reply_to_user": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "edited": false, "score": 0, "creation_date": 1566288167, "post_id": 57545628, "comment_id": 101598952, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/198163/discussion-between-hx-unbanned-and-arkadyb\">continue this discussion in chat</a>."}, {"owner": {"reputation": 562, "user_id": 132296, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0ec63faaf9bdf72cb610f23f7579ef46?s=128&d=identicon&r=PG", "display_name": "HX_unbanned", "link": "https://stackoverflow.com/users/132296/hx-unbanned"}, "reply_to_user": {"reputation": 1084, "user_id": 2915603, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ea6fc9bc47d33adfb6e88ce2909f1a80?s=128&d=identicon&r=PG", "display_name": "ArkadyB", "link": "https://stackoverflow.com/users/2915603/arkadyb"}, "edited": false, "score": 0, "creation_date": 1566295746, "post_id": 57545628, "comment_id": 101603066, "body": "@ArkadyB Please check link above ;)"}], "answers": [{"comments": [{"owner": {"reputation": 562, "user_id": 132296, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0ec63faaf9bdf72cb610f23f7579ef46?s=128&d=identicon&r=PG", "display_name": "HX_unbanned", "link": "https://stackoverflow.com/users/132296/hx-unbanned"}, "edited": false, "score": 0, "creation_date": 1566380341, "post_id": 57585559, "comment_id": 101634886, "body": "Thanks, Kavin, for proposed solution, but if you will check the chat, linked in the comments, you will see it does not. The issue is in the way CircleCI has built the image/container. I hope they will respond to me bugreport/support request and explain what is happening there..."}, {"owner": {"reputation": 3, "user_id": 9915428, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5nuOdrZCYIo/AAAAAAAAAAI/AAAAAAAAC5A/sUqISFGwg_0/photo.jpg?sz=128", "display_name": "kevin tanzil", "link": "https://stackoverflow.com/users/9915428/kevin-tanzil"}, "reply_to_user": {"reputation": 562, "user_id": 132296, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0ec63faaf9bdf72cb610f23f7579ef46?s=128&d=identicon&r=PG", "display_name": "HX_unbanned", "link": "https://stackoverflow.com/users/132296/hx-unbanned"}, "edited": false, "score": 0, "creation_date": 1566896865, "post_id": 57585559, "comment_id": 101789835, "body": "i see, so this is a circle ci bug..  but sometimes it can be happend if we dont use any package mangers for manage our package..  Thanks dude.."}], "tags": [], "owner": {"reputation": 3, "user_id": 9915428, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5nuOdrZCYIo/AAAAAAAAAAI/AAAAAAAAC5A/sUqISFGwg_0/photo.jpg?sz=128", "display_name": "kevin tanzil", "link": "https://stackoverflow.com/users/9915428/kevin-tanzil"}, "is_accepted": false, "score": 0, "last_activity_date": 1566368623, "creation_date": 1566368623, "answer_id": 57585559, "question_id": 57545628, "link": "https://stackoverflow.com/questions/57545628/local-build-successful-while-circleci-build-failing/57585559#57585559", "title": "local build successful while CircleCI build failing", "body": "<p>i think for your case will solve if you use package manager, like DEP or other.</p>\n"}], "owner": {"reputation": 562, "user_id": 132296, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0ec63faaf9bdf72cb610f23f7579ef46?s=128&d=identicon&r=PG", "display_name": "HX_unbanned", "link": "https://stackoverflow.com/users/132296/hx-unbanned"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 301, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566368623, "creation_date": 1566139491, "last_edit_date": 1566282656, "question_id": 57545628, "link": "https://stackoverflow.com/questions/57545628/local-build-successful-while-circleci-build-failing", "title": "local build successful while CircleCI build failing", "body": "<p>I am trying to experiment a bit with imports and now stuck on the station where simple import of package is failing in CircleCI <em>while it is buildable locally successfully</em>. Could anybody please share what is wrong or what I am doing wrong that is not letting code to be built in CircleCI?</p>\n\n<p>Repo structure:</p>\n\n<pre><code>    - project\n    --- main.go\n    --- graphic\n    ----- graphics.go\n</code></pre>\n\n<p>main.go import definition:</p>\n\n<pre><code>    package main\n\n    import (\n        \"bufio\"\n        \"flag\"\n        \"fmt\"\n        \"io/ioutil\"\n        \"log\"\n        \"os\"\n        \"strings\"\n\n        graphic \"../project/graphic\"\n    )\n</code></pre>\n\n<p>graphics.go import definition:</p>\n\n<pre><code>    package graphic\n\n    import (\n        \"fmt\"\n        \"io/ioutil\"\n        \"log\"\n\n        \"github.com/fogleman/gg\"\n    )\n</code></pre>\n\n<p>CircleCI config.yml:</p>\n\n<pre><code>version: 2\njobs:\n  build:\n    docker:\n      - image: circleci/golang:1.9\n\n    working_directory: /go/src/github.com/&lt;my-account&gt;/project\n    steps:\n      - checkout\n\n      # specify any bash command here prefixed with `run: `\n      # - run: go get -v -t -d ./...\n\n      - run: \n          name: run filesystem path configuration\n          command: |\n            pwd\n            pwd -P\n            echo $GOROOT\n            echo $GOPATH\n            export GOBIN=$GOPATH/bin\n            echo $GOBIN\n            export PATH=$PATH:$GOBIN\n            ls -latr $GOROOT\n            ls -latr $GOPATH\n            ls -latr $GOBIN\n            go env\n      - run:\n          name: run dependecy managament\n          command: |\n            go get -v -u github.com/golang/dep/cmd/dep\n            go get -v -u github.com/fogleman/gg\n            go get -v -u github.com/aws/aws-sdk-go/aws\n            go get -v -u github.com/aws/aws-sdk-go/aws/session\n            go get -v -u github.com/aws/aws-sdk-go/service/cloudwatch\n      - run:\n          name: run documentation\n          command: |\n            godoc -v -index -timestamps main\n      - run:\n          name: run tests\n          command: |\n            go vet -v ./...\n      - run:\n          name: run build and deploy\n          command: |\n            dep init\n            mkdir build\n            dep ensure\n            go build -v -o build/main.exe main.go\n      - run:\n          name: run qa\n          command: go test -v main.go\n\n      - store_artifacts:\n          path: ./build\n\n</code></pre>\n\n<p>Failing error message:</p>\n\n<pre><code>    #!/bin/bash -eo pipefail\n    dep init\n    mkdir build\n    dep ensure\n    go build -v -o build/main.exe main.go\n      Using ^1.3.0 as constraint for direct dep github.com/fogleman/gg\n      Locking in v1.3.0 (0403632) for direct dep github.com/fogleman/gg\n      Locking in master (cff245a) for transitive dep golang.org/x/image\n      Using ^1.23.3 as constraint for direct dep github.com/aws/aws-sdk-go\n      Locking in v1.23.3 (fbdf1bd) for direct dep github.com/aws/aws-sdk-go\n      Locking in master (e2365df) for transitive dep github.com/golang/freetype\n      Locking in  (c2b33e84) for transitive dep github.com/jmespath/go-jmespath\n    graphic/graphics.go:8:2: cannot find package \"_/go/src/github.com/&lt;my-account&gt;/project/vendor/github.com/fogleman/gg\" in any of:\n        /usr/local/go/src/_/go/src/github.com/&lt;my-account&gt;/project/vendor/github.com/fogleman/gg (from $GOROOT)\n        /go/src/_/go/src/github.com/&lt;my-account&gt;/project/vendor/github.com/fogleman/gg (from $GOPATH)\n    Exited with code 1\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1566137404, "post_id": 57545297, "comment_id": 101553878, "body": "What, exactly, are you trying to call as a function? What is <code>checks</code>?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1566147527, "post_id": 57545297, "comment_id": 101556507, "body": "That&#39;s all interesting, but doesn&#39;t answer the question. What are you trying to call as a function? What is the type of <code>checks</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9335948, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BoqnP.jpg?s=128&g=1", "display_name": "Venugopal Naik", "link": "https://stackoverflow.com/users/9335948/venugopal-naik"}, "edited": false, "score": 0, "creation_date": 1566138306, "post_id": 57545394, "comment_id": 101554091, "body": "problem with this map is checkIPReachability is retrieved dynamically via yaml.  I had plans to give developers independently develop their functions and not touch the main code.. but as per your suggestion looks like we have to modify switch case everytime we write new function..  Thanks for your suggestion.. seems like no way around this."}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "reply_to_user": {"reputation": 1, "user_id": 9335948, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BoqnP.jpg?s=128&g=1", "display_name": "Venugopal Naik", "link": "https://stackoverflow.com/users/9335948/venugopal-naik"}, "edited": false, "score": 0, "creation_date": 1566138429, "post_id": 57545394, "comment_id": 101554118, "body": "If it&#39;s a framework, it may provide a way to expand that map with a <code>Register()</code> call. Updated the answer."}, {"owner": {"reputation": 1, "user_id": 9335948, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BoqnP.jpg?s=128&g=1", "display_name": "Venugopal Naik", "link": "https://stackoverflow.com/users/9335948/venugopal-naik"}, "edited": false, "score": 0, "creation_date": 1566138807, "post_id": 57545394, "comment_id": 101554210, "body": "thank you.. The idea was our users would not have expertise on golang.. hence the yaml was suggested and under the hoods we perform the task for them."}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "reply_to_user": {"reputation": 1, "user_id": 9335948, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BoqnP.jpg?s=128&g=1", "display_name": "Venugopal Naik", "link": "https://stackoverflow.com/users/9335948/venugopal-naik"}, "edited": false, "score": 0, "creation_date": 1566138951, "post_id": 57545394, "comment_id": 101554243, "body": "There&#39;s definitely no simple way to make this user-expansible without having them write some code in Go."}, {"owner": {"reputation": 1, "user_id": 9335948, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BoqnP.jpg?s=128&g=1", "display_name": "Venugopal Naik", "link": "https://stackoverflow.com/users/9335948/venugopal-naik"}, "edited": false, "score": 0, "creation_date": 1566139109, "post_id": 57545394, "comment_id": 101554285, "body": "ok understood.."}, {"owner": {"reputation": 1, "user_id": 9335948, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BoqnP.jpg?s=128&g=1", "display_name": "Venugopal Naik", "link": "https://stackoverflow.com/users/9335948/venugopal-naik"}, "edited": false, "score": 0, "creation_date": 1566174457, "post_id": 57545394, "comment_id": 101561409, "body": "Thanks bereal.. accepting your solution. I&#39;ll probably look at either the global map option or resort to switch case."}], "tags": [], "owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "is_accepted": true, "score": 1, "last_activity_date": 1566138789, "last_edit_date": 1566138789, "creation_date": 1566137787, "answer_id": 57545394, "question_id": 57545297, "link": "https://stackoverflow.com/questions/57545297/cannot-use-type-string-as-type-func-in-assignment/57545394#57545394", "title": "cannot use (type string) as type func() in assignment", "body": "<p>You cannot convert a string to a function. You may try using some kind of mapping, e.g.:</p>\n\n<pre><code>checkers := map[string]func() {\n    \"CheckIPReachability\": checkIPReachability,\n}\n\ncheckers[name]()\n</code></pre>\n\n<p>If you need to pass the arguments, the function would be like:</p>\n\n<pre><code>func checkIPReachability(args []interface{}) {\n    // convert args and check the IPs\n}\n\ncheckers := map[string]func([]interface{}) {\n    \"CheckIPReachability\": \"checkIPReachability\",\n}\n</code></pre>\n\n<p>If you want to allow the users of your framework to add their own checker, you can export that as a function <code>RegisterChecker(string, func(interface{}))</code> or something similar.</p>\n\n<p>A simpler alternative is a <a href=\"https://tour.golang.org/flowcontrol/9\" rel=\"nofollow noreferrer\"><code>switch-case</code></a> statement:</p>\n\n<pre><code>switch funcname {\n    case \"CheckIPReachability\":\n        // convert arguments and call the function\n    case \"OtherCheck\":\n        // same here\n} \n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9335948, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BoqnP.jpg?s=128&g=1", "display_name": "Venugopal Naik", "link": "https://stackoverflow.com/users/9335948/venugopal-naik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 530, "favorite_count": 0, "closed_date": 1566192177, "accepted_answer_id": 57545394, "answer_count": 1, "score": -4, "last_activity_date": 1566138789, "creation_date": 1566137164, "last_edit_date": 1566137336, "question_id": 57545297, "link": "https://stackoverflow.com/questions/57545297/cannot-use-type-string-as-type-func-in-assignment", "closed_reason": "Needs details or clarity", "title": "cannot use (type string) as type func() in assignment", "body": "<p>I have a yaml file in the following format:</p>\n\n<pre><code>checks:\n      CheckIPReachability:\n        args:\n          ip: 127.0.0.1\n          port: 22\n      xyz_check:\n        args:\n          xyz_arg: xxx\n          xyz_arg1: yy\n</code></pre>\n\n<p>I plan to accept this type of input from user and call CheckIPReachability or any xyz func and send args to it. Individual functions would extract the args and perform the task. </p>\n\n<p>I tried to do this,</p>\n\n<pre><code>m := make(map[string]func())\n\nfor prp, val := range checks {\n  m[\"func\"] = prp.(func())\n  m[\"func\"]()\n}\n</code></pre>\n\n<p>which fails with:</p>\n\n<blockquote>\n  <p>panic: interface conversion: interface {} is string, not func()</p>\n</blockquote>\n\n<p>so prp is \"CheckIPReachability\" and I am unable to call that as a function, inspite of converting it to a func.</p>\n\n<p>I also want to know whats the best possible way here (interfaces ?). Adding a switch case doesnt look right. </p>\n\n<p><a href=\"https://play.golang.org/p/B9w6p4MCI7V\" rel=\"nofollow noreferrer\">https://play.golang.org/p/B9w6p4MCI7V</a></p>\n"}, {"tags": ["java", "unit-testing", "go", "testng"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1566135918, "post_id": 57545121, "comment_id": 101553559, "body": "No, this is not supported in Go. In fact, it&#39;s bad practice to depend on execution order, regardless of your language. But Go makes it easy to run only a subset of tests with the <code>-run=</code> flag, which would render any ordering meaningless."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1566136073, "post_id": 57545121, "comment_id": 101553597, "body": "If your goal is simply to make sure that a server is running, or some other dependent state, do that outside of the testing framework."}], "owner": {"reputation": 185, "user_id": 7126092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1dde6979c03150ddb8275e5321d925d?s=128&d=identicon&r=PG&f=1", "display_name": "\u8fbd\u5317\u72e0\u4eba", "link": "https://stackoverflow.com/users/7126092/%e8%be%bd%e5%8c%97%e7%8b%a0%e4%ba%ba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 19, "favorite_count": 0, "closed_date": 1566135941, "answer_count": 0, "score": 0, "last_activity_date": 1566135874, "creation_date": 1566135710, "last_edit_date": 1566135874, "question_id": 57545121, "link": "https://stackoverflow.com/questions/57545121/how-should-i-manage-dependencies-among-test-cases", "closed_reason": "Duplicate", "title": "How should I manage dependencies among test cases", "body": "<p>I wonder whether it is possible to ensure the execution order of test cases in Go.</p>\n\n<p>For example in Java, this can be achieved with TestNG's <code>dependsOnMethods</code> (or <code>dependsOnGroups</code> alike) attribute within the <code>@Test</code> annotation as below:</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>@Test\npublic void serverStartedOk() {}\n\n@Test(dependsOnMethods = { \"serverStartedOk\" })\npublic void method1() {}\n\n</code></pre>\n\n<p>With this, <code>method1</code> would be executed after <code>serverStartedOk</code>. Any approach to achieve this with Go?</p>\n"}, {"tags": ["regex", "mongodb", "go", "bson"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1566136222, "post_id": 57545112, "comment_id": 101553623, "body": "You don&#39;t say which version you&#39;re using, but <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/bson\" rel=\"nofollow noreferrer\">the current version</a> doesn&#39;t export <code>RegEx</code>. It also doesn&#39;t have a file <code>bson&#47;primitive.go</code>, so I&#39;m not sure what you&#39;re looking at, unless it&#39;s a really old version."}], "answers": [{"comments": [{"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 1, "creation_date": 1566143664, "post_id": 57546000, "comment_id": 101555513, "body": "I doubt you need <code>.*</code>, use <code>regex := `(?i)` + name</code>. Most probably you also need to escape thd <code>name</code>."}], "tags": [], "owner": {"reputation": 295, "user_id": 9050336, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CyLEv.jpg?s=128&g=1", "display_name": "Brendan", "link": "https://stackoverflow.com/users/9050336/brendan"}, "is_accepted": false, "score": 1, "last_activity_date": 1566142266, "creation_date": 1566142266, "answer_id": 57546000, "question_id": 57545112, "link": "https://stackoverflow.com/questions/57545112/how-can-i-fix-this-error-in-my-go-project-undefined-bson-regex/57546000#57546000", "title": "How can I fix this error in my go project - undefined: bson.RegEx", "body": "<p>Managed to work around the problem by <strong>removing</strong> this:</p>\n\n<pre><code>regex := bson.M{\"$regex\": bson.RegEx{Pattern: id, Options: \"i\"}}\n</code></pre>\n\n<p>and <strong>add</strong> this instead:</p>\n\n<pre><code>regex := `(?i).*` + name + `.*`\nfilter = bson.M{\"name\": bson.M{\"$regex\": regex}}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": false, "score": 1, "last_activity_date": 1566954940, "creation_date": 1566954940, "answer_id": 57683900, "question_id": 57545112, "link": "https://stackoverflow.com/questions/57545112/how-can-i-fix-this-error-in-my-go-project-undefined-bson-regex/57683900#57683900", "title": "How can I fix this error in my go project - undefined: bson.RegEx", "body": "<blockquote>\n  <p>Why am I getting this error and how can I resolve it?</p>\n</blockquote>\n\n<p>Using <a href=\"https://godoc.org/go.mongodb.org/mongo-driver\" rel=\"nofollow noreferrer\">mongo-go-driver</a> v1+, you can utilise <code>bson.primitive</code>. For example: </p>\n\n<pre><code>patternName := `.*` + name + `.*`\nfilter := bson.M{\"name\": primitive.Regex{Pattern: patternName, Options:\"i\"}}\ncursor, err := collection.Find(context.TODO(), filter)\n</code></pre>\n\n<p>This is imported from <code>\"go.mongodb.org/mongo-driver/bson/primitive\"</code>. </p>\n\n<p>In addition, I would also suggest to consider the search pattern. You can optimise a regex search if the regular expression is a \u201cprefix expression\u201d, which means that all potential matches start with the same string. For example, <code>^name.*</code> will be optimised by matching only against the values from the index that starts with <code>name</code>. </p>\n\n<p>Also worth noting that case insensitive regular expression queries generally cannot use indexes effectively. The $regex implementation is not collation-aware and is unable to utilise case-insensitive indexes. Please see <a href=\"https://docs.mongodb.com/manual/reference/operator/query/regex/#index-use\" rel=\"nofollow noreferrer\">$regex index use</a> for more information. </p>\n\n<p>Depending on the use case, consider <a href=\"https://docs.mongodb.com/manual/text-search/\" rel=\"nofollow noreferrer\">MongoDB Text Search</a>. For example, you can create a <a href=\"https://docs.mongodb.com/manual/core/index-text/#index-feature-text\" rel=\"nofollow noreferrer\">text index</a>: </p>\n\n<pre><code>db.collection.createIndex({\"name\":\"text\"});\n</code></pre>\n\n<p>Which then you can search using: </p>\n\n<pre><code>filter := bson.M{\"$text\": bson.M{\"$search\": name}}\ncur, err := collection.Find(context.TODO(), filter)\n</code></pre>\n\n<p>Also worth mentioning depending on your requirements, there's also <a href=\"https://docs.atlas.mongodb.com/full-text-search/\" rel=\"nofollow noreferrer\">MongoDB Atlas Full Text Search</a> feature for advanced search functionality. i.e. <a href=\"https://docs.atlas.mongodb.com/reference/full-text-search/analyzers/#analyzers-ref\" rel=\"nofollow noreferrer\">text analysers</a>. </p>\n"}], "owner": {"reputation": 295, "user_id": 9050336, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CyLEv.jpg?s=128&g=1", "display_name": "Brendan", "link": "https://stackoverflow.com/users/9050336/brendan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 396, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1566954940, "creation_date": 1566135594, "last_edit_date": 1566139547, "question_id": 57545112, "link": "https://stackoverflow.com/questions/57545112/how-can-i-fix-this-error-in-my-go-project-undefined-bson-regex", "title": "How can I fix this error in my go project - undefined: bson.RegEx", "body": "<p>I get the following error from my editor: \n<code>undefined: bson.RegEx</code></p>\n\n<p>due to this line of code in my go project:</p>\n\n<p><code>regex := bson.M{\"$regex\": bson.RegEx{Pattern: id, Options: \"i\"}}</code></p>\n\n<p>Why am I getting this error and how can I resolve it?</p>\n\n<p>I've made sure that I'm importing:</p>\n\n<p><code>\"go.mongdb.org/mongo-driver/bson\"</code></p>\n\n<p>I've also checked inside <code>bson/primitive/primitive.go</code> to see that <code>RegEx</code> does exist</p>\n\n<p>Using version <code>1.1.0</code> of mongo-driver.</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 1410, "user_id": 5817056, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4cb8cc5a593728016414d7bead5a9912?s=128&d=identicon&r=PG&f=1", "display_name": "Talgat Saribayev", "link": "https://stackoverflow.com/users/5817056/talgat-saribayev"}, "edited": false, "score": 0, "creation_date": 1566128211, "post_id": 57543788, "comment_id": 101551682, "body": "what is the name of a package in <code>Support&#47;go_file.go</code>?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1566128796, "post_id": 57543788, "comment_id": 101551828, "body": "&quot;not working&quot; is not a problem description. What error or other unexpected output do you see? What did you expect to see instead?"}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 7501166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67c67d24c2a36f63fccb49d7404e1382?s=128&d=identicon&r=PG&f=1", "display_name": "Rockietto", "link": "https://stackoverflow.com/users/7501166/rockietto"}, "edited": false, "score": 0, "creation_date": 1566132201, "post_id": 57544324, "comment_id": 101552645, "body": "Thank you for your complete answer! I solved the problem!"}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 0, "last_activity_date": 1566129929, "last_edit_date": 1592644375, "creation_date": 1566129478, "answer_id": 57544324, "question_id": 57543788, "link": "https://stackoverflow.com/questions/57543788/problem-with-modules-and-importing-folders/57544324#57544324", "title": "Problem with modules and importing folders", "body": "<p>As given, your <code>Support/go_file.go</code> is not in any module so it's not importable using Go modules.</p>\n<p>Either use a single module for all three packages or use three separate modules (i.e.\u00a0put Support in it's own module). You could also use sub-modules.</p>\n<h3>Single module:</h3>\n<p>For a single module you'd do something like:</p>\n<pre><code>\u2514\u2500\u2500 My-Project\n    \u251c\u2500\u2500 go.mod\n    \u251c\u2500\u2500 Program\\ 1\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 main.go\n    \u251c\u2500\u2500 Program\\ 2\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 main.go\n    \u2514\u2500\u2500 Support\n        \u2514\u2500\u2500 go_file.go\n</code></pre>\n<p>And the project level <code>go.mod</code> would be something like:</p>\n<pre><code>module github.com/My-Name/My-Project\n</code></pre>\n<p>(substitute with appropriate module name) and then both <code>main</code> packages would import the support package with:</p>\n<pre><code>import &quot;github.com/My-Name/My-Project/Support&quot;\n</code></pre>\n<p>Note Go packages normally do not start with capitals like this.</p>\n<p>More idiomatic for such a setup with a single repository which mixes packages and commands is a layout that puts commands into a <code>cmd</code> subdirectory (e.g.\u00a0see the <a href=\"https://github.com/golang/tools/\" rel=\"nofollow noreferrer\"><code>golang.org/x/tools</code></a> layout). This would look something like this:</p>\n<pre><code>\u2514\u2500\u2500 My-Project\n    \u251c\u2500\u2500 cmd\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 program1\n    \u2502\u00a0\u00a0 \u2502\u00a0\u00a0 \u2514\u2500\u2500 main.go\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 program2\n    \u2502\u00a0\u00a0     \u2514\u2500\u2500 main.go\n    \u251c\u2500\u2500 go.mod\n    \u251c\u2500\u2500 internal\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 support\n    \u2502\u00a0\u00a0     \u2514\u2500\u2500 support.go\n    \u2514\u2500\u2500 other-package\n        \u2514\u2500\u2500 some-other-package.go\n</code></pre>\n<p>Here the <code>support</code> package is in an internal sub-directory which makes it non-importable from outside <code>My-Project</code> where-as the <code>other-package</code> is importable by anyone.</p>\n<p>Again, <code>go.mod</code> would define the module name which sets the prefix to be used for all import statements.</p>\n<h3>Separate modules:</h3>\n<p>To use separate modules you'd do something like:</p>\n<pre><code>\u2514\u2500\u2500 My-Project\n    \u251c\u2500\u2500 Program\\ 1\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 go.mod\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 main.go\n    \u251c\u2500\u2500 Program\\ 2\n    \u2502\u00a0\u00a0 \u251c\u2500\u2500 go.mod\n    \u2502\u00a0\u00a0 \u2514\u2500\u2500 main.go\n    \u2514\u2500\u2500 Support\n        \u251c\u2500\u2500 go_file.go\n        \u2514\u2500\u2500 go.mod\n</code></pre>\n<p>Here <code>My-Project/Program 1/go.mod</code> would be something like:</p>\n<pre><code>module &quot;github.com/My-Name/My-Project/Program 1&quot;\n\nrequire (\n        github.com/My-Name/My-Project/Support\n)\n</code></pre>\n<p>The imports would be the same as for the single module example.\nSimilarly for <code>Program 2</code>. For <code>Support/go.mod</code> it'd look something like:</p>\n<pre><code>module github.com/My-Name/My-Project/Support\n</code></pre>\n<p>For local development you'll probably also want/need a <code>replace</code> directive in each program's <code>go.mod</code> to use your local working copy of the support module (<code>go mod edit -replace github.com/My-Name/My-Project/Support=../Support</code> should add this).</p>\n"}], "owner": {"reputation": 53, "user_id": 7501166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67c67d24c2a36f63fccb49d7404e1382?s=128&d=identicon&r=PG&f=1", "display_name": "Rockietto", "link": "https://stackoverflow.com/users/7501166/rockietto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 57544324, "answer_count": 1, "score": -3, "last_activity_date": 1566131453, "creation_date": 1566125007, "last_edit_date": 1566131453, "question_id": 57543788, "link": "https://stackoverflow.com/questions/57543788/problem-with-modules-and-importing-folders", "title": "Problem with modules and importing folders", "body": "<p>I have some problems with how Go importing and modules works.\nI have a project with this structure:</p>\n\n<pre><code>My-Project\n|- Program 1\n   |- main.go\n   |- go.mod\n|- Program 2\n   |- main.go\n   |- go.mod\n|- Support\n   |- go_file.go\n</code></pre>\n\n<p>The two programs have different module \"definition\". I need to include the \"Support\" folder, which is shared between the two programs. I tried</p>\n\n<pre><code>import \"My-Project/Support\" \n</code></pre>\n\n<p>inside Program1's main.go, but this is not working, because Support can\u2019t be resolved. How can I do it? </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1551, "user_id": 1845283, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/12025c96a4e96984d9c95b2a8878d1bb?s=128&d=identicon&r=PG", "display_name": "Dewald Swanepoel", "link": "https://stackoverflow.com/users/1845283/dewald-swanepoel"}, "edited": false, "score": 0, "creation_date": 1566125129, "post_id": 57543757, "comment_id": 101550923, "body": "Yes, thanks. I figured that out shortly after I posted. The function passed to AfterFunc only fires once and then exits, at which point the Ticker is stopped seeing as defer t.Stop() occurs in that function."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1566125252, "last_edit_date": 1566125252, "creation_date": 1566124756, "answer_id": 57543757, "question_id": 57543721, "link": "https://stackoverflow.com/questions/57543721/first-wait-for-time-afterfunc-then-start-time-newticker/57543757#57543757", "title": "First wait for time.AfterFunc then start time.NewTicker", "body": "<blockquote>\n  <p><a href=\"https://golang.google.cn/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.google.cn/ref/spec#Program_execution\" rel=\"nofollow noreferrer\">Program execution</a></p>\n  \n  <p>Program execution begins by initializing the main package and then\n  invoking the function main. When that function invocation returns, the\n  program exits. It does not wait for other (non-main) goroutines to\n  complete.</p>\n</blockquote>\n\n<pre><code>time.AfterFunc(time.Second * 5, func() {\n    fmt.Println(\"AfterFunc\")\n    t := time.NewTicker(time.Second * 2)\n    defer t.Stop()\n    go func() {\n        for now := range t.C {\n            fmt.Println(\"Ticker\")\n        }\n    }()\n})\n</code></pre>\n\n<p><code>defer t.Stop()</code> stops the ticker.</p>\n\n<p>You are not waiting for the goroutine to run.</p>\n"}, {"comments": [{"owner": {"reputation": 1551, "user_id": 1845283, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/12025c96a4e96984d9c95b2a8878d1bb?s=128&d=identicon&r=PG", "display_name": "Dewald Swanepoel", "link": "https://stackoverflow.com/users/1845283/dewald-swanepoel"}, "edited": false, "score": 0, "creation_date": 1566127081, "post_id": 57543802, "comment_id": 101551382, "body": "No it does not. This is exactly what I had in my original question. The implicit function you specify for AfterFunc exits and executes t.Stop() immediately after setting up the ticker. So the ticker will never get the opportunity to fire."}, {"owner": {"reputation": 220, "user_id": 10176454, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZmxR2.png?s=128&g=1", "display_name": "zergon321", "link": "https://stackoverflow.com/users/10176454/zergon321"}, "reply_to_user": {"reputation": 1551, "user_id": 1845283, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/12025c96a4e96984d9c95b2a8878d1bb?s=128&d=identicon&r=PG", "display_name": "Dewald Swanepoel", "link": "https://stackoverflow.com/users/1845283/dewald-swanepoel"}, "edited": false, "score": 1, "creation_date": 1566128393, "post_id": 57543802, "comment_id": 101551729, "body": "What do you mean? Did you execute my code? This <code>t.Stop()</code> is <b>deferred</b> so it will be executed only at the end of the function, right after the <code>for range</code> loop for the ticker."}, {"owner": {"reputation": 220, "user_id": 10176454, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZmxR2.png?s=128&g=1", "display_name": "zergon321", "link": "https://stackoverflow.com/users/10176454/zergon321"}, "reply_to_user": {"reputation": 1551, "user_id": 1845283, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/12025c96a4e96984d9c95b2a8878d1bb?s=128&d=identicon&r=PG", "display_name": "Dewald Swanepoel", "link": "https://stackoverflow.com/users/1845283/dewald-swanepoel"}, "edited": false, "score": 0, "creation_date": 1566128747, "post_id": 57543802, "comment_id": 101551815, "body": "@DewaldSwanepoel You had the same code enveloped into a goroutine. The program stopped the ticker right after the goroutine had started. That&#39;s why you had your <code>defer</code> executed before the ticker. But in my code, everything is in the same goroutine and works as it should."}, {"owner": {"reputation": 1551, "user_id": 1845283, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/12025c96a4e96984d9c95b2a8878d1bb?s=128&d=identicon&r=PG", "display_name": "Dewald Swanepoel", "link": "https://stackoverflow.com/users/1845283/dewald-swanepoel"}, "edited": false, "score": 0, "creation_date": 1566130604, "post_id": 57543802, "comment_id": 101552282, "body": "Apologies @zergon321, I only realise now that your sample does not wrap the ticker in a goroutine, which is the key difference."}, {"owner": {"reputation": 1551, "user_id": 1845283, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/12025c96a4e96984d9c95b2a8878d1bb?s=128&d=identicon&r=PG", "display_name": "Dewald Swanepoel", "link": "https://stackoverflow.com/users/1845283/dewald-swanepoel"}, "edited": false, "score": 0, "creation_date": 1566131042, "post_id": 57543802, "comment_id": 101552371, "body": "I feel like a right knob now for downvoting your answer and SO prevents me from changing my vote unless the answer is edited. If you edit the answer, maybe just add explicitly that the ticker loop is not wrapped in a goroutine, I can change my vote."}], "tags": [], "owner": {"reputation": 220, "user_id": 10176454, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZmxR2.png?s=128&g=1", "display_name": "zergon321", "link": "https://stackoverflow.com/users/10176454/zergon321"}, "is_accepted": true, "score": -1, "last_activity_date": 1566125182, "creation_date": 1566125182, "answer_id": 57543802, "question_id": 57543721, "link": "https://stackoverflow.com/questions/57543721/first-wait-for-time-afterfunc-then-start-time-newticker/57543802#57543802", "title": "First wait for time.AfterFunc then start time.NewTicker", "body": "<pre class=\"lang-golang prettyprint-override\"><code>time.AfterFunc(time.Second*5, func() {\n        fmt.Println(\"AfterFunc\")\n\n        t := time.NewTicker(time.Second * 2)\n        defer t.Stop()\n        for range t.C {\n            fmt.Println(\"Ticker\")\n        }\n    })\n</code></pre>\n\n<p>It produces the output you need:</p>\n\n<pre><code>starting up\nAfterFunc\nTicker\nTicker\nTicker\nTicker\nTicker\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566130501, "post_id": 57543867, "comment_id": 101552258, "body": "There is no reason or point to use a goroutine like this inside of the function given to <code>time.AfterFunc</code>; it just complicates things. See <a href=\"https://stackoverflow.com/a/57543802/55504\">zergon321&#39;s answer</a> without a separate goroutine."}], "tags": [], "owner": {"reputation": 1551, "user_id": 1845283, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/12025c96a4e96984d9c95b2a8878d1bb?s=128&d=identicon&r=PG", "display_name": "Dewald Swanepoel", "link": "https://stackoverflow.com/users/1845283/dewald-swanepoel"}, "is_accepted": false, "score": 0, "last_activity_date": 1566125761, "creation_date": 1566125761, "answer_id": 57543867, "question_id": 57543721, "link": "https://stackoverflow.com/questions/57543721/first-wait-for-time-afterfunc-then-start-time-newticker/57543867#57543867", "title": "First wait for time.AfterFunc then start time.NewTicker", "body": "<p>Gosh, I figured it out not long after posting, though I still think my solution lacks some elegance.</p>\n\n<p>As @peterSO pointed out, the function passed to <code>AfterFunc()</code> executes and stops the <code>Ticker</code> moments after creating it with <code>defer t.Stop()</code></p>\n\n<p>The solution for me was to define the <code>t</code> variable before the call to <code>AfterFunc()</code> so that it has scope outside of the <code>AfterFunc()</code> payload function, and then stop it at the end of my <code>main()</code> func. Here is the new <code>main()</code> func:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    fmt.Println(\"starting up\")\n\n    var t *time.Ticker\n    time.AfterFunc(time.Second * 5, func() {\n        fmt.Println(\"AfterFunc\")\n\n        t = time.NewTicker(time.Second * 2)\n        go func() {\n            for now := range t.C {\n                fmt.Println(\"Ticker\")\n            }\n        }()\n    })\n    //defer t.Stop()\n\n    // Block until termination signal is received\n    osSignals := make(chan os.Signal, 1)\n    signal.Notify(osSignals, syscall.SIGINT, syscall.SIGTERM, os.Interrupt, os.Kill)\n    &lt;-osSignals\n\n    t.Stop()\n\n    logger.Info(\"exiting gracefully\")\n}\n</code></pre>\n\n<p>Strangely though that commented out <code>defer t.Stop()</code> causes a panic (invalid memory address or nil pointer dereference) when the application closes upon a termination signal. If I stop it as in the uncommented <code>t.Stop()</code> at the very end of the code, it works as expected. Not sure why that is.</p>\n"}], "owner": {"reputation": 1551, "user_id": 1845283, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/12025c96a4e96984d9c95b2a8878d1bb?s=128&d=identicon&r=PG", "display_name": "Dewald Swanepoel", "link": "https://stackoverflow.com/users/1845283/dewald-swanepoel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 467, "favorite_count": 1, "accepted_answer_id": 57543802, "answer_count": 3, "score": 1, "last_activity_date": 1566125761, "creation_date": 1566124475, "question_id": 57543721, "link": "https://stackoverflow.com/questions/57543721/first-wait-for-time-afterfunc-then-start-time-newticker", "title": "First wait for time.AfterFunc then start time.NewTicker", "body": "<p>I am trying to set up a service routine that runs every hour on the hour. It seems to me that either of those two are easy. To run my routine on the hour I can use <code>time.AfterFunc()</code>, first calculating the remaining time until the top of the hour. And to run my routine every hour I can use <code>time.NewTicker()</code>.</p>\n\n<p>However, I'm struggling to figure out how to start the <code>NewTicker</code> only after the function passed to  <code>AfterFunc()</code> has fired.</p>\n\n<p>My <code>main()</code> function looks something like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    fmt.Println(\"starting up\")\n\n    // Here I'm setting up all kinds of HTTP listeners and gRPC listeners, none\n    // of which is important, save to mention that the app has more happening\n    // than just this service routine.\n\n    // Calculate duration until next hour and call time.AfterFunc()\n    // For the purposes of this exercise I'm just using 5 seconds so as not to\n    // have to wait increments of hours to see the results\n    time.AfterFunc(time.Second * 5, func() {\n        fmt.Println(\"AfterFunc\")\n    })\n\n    // Set up a ticker to run every hour. Again, for the purposes of this\n    // exercise I'm ticking every 2 seconds just to see some results\n    t := time.NewTicker(time.Second * 2)\n    defer t.Stop()\n    go func() {\n        for now := range t.C {\n            fmt.Println(\"Ticker\")\n        }\n    }()\n\n    // Block until termination signal is received\n    osSignals := make(chan os.Signal, 1)\n    signal.Notify(osSignals, syscall.SIGINT, syscall.SIGTERM, os.Interrupt, os.Kill)\n    &lt;-osSignals\n\n    fmt.Println(\"exiting gracefully\")\n}\n</code></pre>\n\n<p>Of course <code>time.AfterFunc()</code> is blocking and the payload of my <code>Ticker</code> is deliberately put in a go routine so it also won't be blocking. This is so that my HTTP and gRPC listeners can continue to listen but also to allow the block of code at the end of <code>main()</code> to exit gracefully upon a termination signal from the OS. But the obvious downside now is that the <code>Ticker</code> kicks off pretty much immediately and fires twice (2 second intervals) before the function passed to <code>AfterFunc()</code> fires. The output looks like this:</p>\n\n<pre><code>Ticker\nTicker\nAfterFunc\nTicker\nTicker\nTicker\netc.\n</code></pre>\n\n<p>What I wanted of course is:</p>\n\n<pre><code>AfterFunc\nTicker\nTicker\nTicker\nTicker\nTicker\netc.\n</code></pre>\n\n<p>The following also doesn't work and I'm not exactly sure why. It prints AfterFunc but the Ticker never fires.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>time.AfterFunc(time.Second * 5, func() {\n        fmt.Println(\"AfterFunc\")\n\n        t := time.NewTicker(time.Second * 2)\n        defer t.Stop()\n        go func() {\n            for now := range t.C {\n                fmt.Println(\"Ticker\")\n            }\n        }()\n    })\n</code></pre>\n"}, {"tags": ["go", "visual-studio-code"], "comments": [{"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1566122901, "post_id": 57543502, "comment_id": 101550403, "body": "How are you compiling the code?"}, {"owner": {"reputation": 9768, "user_id": 8990367, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dk1Kx.jpg?s=128&g=1", "display_name": "Fateme Fazli", "link": "https://stackoverflow.com/users/8990367/fateme-fazli"}, "reply_to_user": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1566123018, "post_id": 57543502, "comment_id": 101550428, "body": "@user202729 <code>go run insertion.go</code>"}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1566123065, "post_id": 57543502, "comment_id": 101550441, "body": "And you change the name accordingly when renaming the file name? Does the run correctly in this case?"}, {"owner": {"reputation": 9768, "user_id": 8990367, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dk1Kx.jpg?s=128&g=1", "display_name": "Fateme Fazli", "link": "https://stackoverflow.com/users/8990367/fateme-fazli"}, "reply_to_user": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1566123167, "post_id": 57543502, "comment_id": 101550462, "body": "@user202729 yes."}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1566123209, "post_id": 57543502, "comment_id": 101550473, "body": "@Flimzy Surely removing the character helps, but it would be weird if it works fine when the file name is not insertion.go."}, {"owner": {"reputation": 9768, "user_id": 8990367, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dk1Kx.jpg?s=128&g=1", "display_name": "Fateme Fazli", "link": "https://stackoverflow.com/users/8990367/fateme-fazli"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1566123214, "post_id": 57543502, "comment_id": 101550475, "body": "@Flimzy but why it works just when i change the file name? without any change in my code?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1566123332, "post_id": 57543502, "comment_id": 101550498, "body": "@FatemeFazli: It probably doesn&#39;t really work when you change the name. Perhaps your name change just means it&#39;s not being compiled at all. Without seeing <i>exactly what you&#39;re doing</i>, I can&#39;t say for sure. But the error message says nothing about the filename, so I have no reason to believe the filename is the problem."}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 2, "creation_date": 1566123347, "post_id": 57543502, "comment_id": 101550502, "body": "How do you rename the file? By loading it into your editor and then saving it with a new name? If so, your editor may be removing the weird space."}, {"owner": {"reputation": 9768, "user_id": 8990367, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dk1Kx.jpg?s=128&g=1", "display_name": "Fateme Fazli", "link": "https://stackoverflow.com/users/8990367/fateme-fazli"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1566123459, "post_id": 57543502, "comment_id": 101550528, "body": "@PaulHankin so if my IDE removes it (using vs code) but why it happens again when i change the name to &quot;insertion.go&quot; ?"}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1566123603, "post_id": 57543502, "comment_id": 101550565, "body": "@FatemeFazli It could be a weird &quot;feature&quot; of vscode. Try closing the editor, deleting the <code>insertion.go</code> file, rename one of the other file to <code>insertion.go</code>, and run it."}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1566123684, "post_id": 57543502, "comment_id": 101550587, "body": "Try <code>diff insertion.go othername.go</code> and see if the files are different. If they are, it&#39;s your editor. If they&#39;re the same, it&#39;s a weird go bug."}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1566123699, "post_id": 57543502, "comment_id": 101550590, "body": "@PaulHankin Windows use <code>fc</code> not <code>diff</code>."}, {"owner": {"reputation": 9768, "user_id": 8990367, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dk1Kx.jpg?s=128&g=1", "display_name": "Fateme Fazli", "link": "https://stackoverflow.com/users/8990367/fateme-fazli"}, "edited": false, "score": 0, "creation_date": 1566123977, "post_id": 57543502, "comment_id": 101550648, "body": "when i rename without vs code it works fine with name &quot;insertion&quot;, thank you it&#39;s problem with vs code that even i delete the file and new another one with the same name it loads the old file again, i think."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1566123178, "creation_date": 1566123178, "answer_id": 57543558, "question_id": 57543502, "link": "https://stackoverflow.com/questions/57543502/invalid-identifier-character-with-file-name-insertion/57543558#57543558", "title": "Invalid identifier character with file name &quot;insertion&quot;", "body": "<p>Please read the error carefully. Look where the error is occurring: line 2, character 1. That means you have some invalid character in your source file. It's not a problem with the filename. <code>U+00A0</code> is a <a href=\"http://www.fileformat.info/info/unicode/char/00a0/index.htm\" rel=\"nofollow noreferrer\">NO-BREAK SPACE</a>, meaning you have an invalid no-break space character in your file, which will appear as invisible.</p>\n\n<p>So apparently, you have the following contents:</p>\n\n<pre><code>package main\nX\nimport (\n</code></pre>\n\n<p>Where <code>X</code> is an (invisible) NO-BLOCK SPACE (aka <code>&amp;nbsp;</code> in HTML speak).</p>\n\n<p>A guess would be that perhaps you copy-pasted this code from a web site, and a <code>&amp;nbsp;</code> was erroneously included in the paste.</p>\n"}], "owner": {"reputation": 9768, "user_id": 8990367, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Dk1Kx.jpg?s=128&g=1", "display_name": "Fateme Fazli", "link": "https://stackoverflow.com/users/8990367/fateme-fazli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566130299, "creation_date": 1566122797, "last_edit_date": 1566130299, "question_id": 57543502, "link": "https://stackoverflow.com/questions/57543502/invalid-identifier-character-with-file-name-insertion", "title": "Invalid identifier character with file name &quot;insertion&quot;", "body": "<p>I'm new in Go and writing a simple insertion sort but when i change my fileName to \"insertion.go\" I got error:</p>\n\n<blockquote>\n  <p>invalid identifier character U+00A0 at insertion.go:2:1</p>\n</blockquote>\n\n<p>but when I change the filename to anything else it works fine:</p>\n\n<p><strong>insertion.go</strong> </p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"math/rand\"\n        \"time\"\n)\n\nfunc main() {\n    slice := generateSlice(20)\n    fmt.Println(\"\\n--- Unsorted --- \\n\\n\", slice)\n    insertionsort(slice)\n    fmt.Println(\"\\n--- Sorted ---\\n\\n\", slice, \"\\n\")\n}\n\nfunc generateSlice(size int) []int {\n    slice := make([]int, size, size)\n    rand.Seed(time.Now().UnixNano())\n    for i := 0; i &lt; size; i++ {\n    slice[i] = rand.Intn(999) - rand.Intn(999)\n    }\n    return slice\n}\n\nfunc insertionsort(items []int) {\n    var n = len(items)\n    for i := 1; i &lt; n; i++ {\n        j := i\n        for j &gt; 0 {\n        if items[j-1] &gt; items[j] {\n            items[j-1], items[j] = items[j], items[j-1]\n        }\n        j = j - 1\n        }\n    }\n}\n</code></pre>\n\n<p>I want to know what's the problem with name \"insertion\"?</p>\n"}, {"tags": ["go", "webassembly"], "owner": {"reputation": 11, "user_id": 11942076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/481625062b1a92dd7ef7931aabce4380?s=128&d=identicon&r=PG&f=1", "display_name": "mackcom", "link": "https://stackoverflow.com/users/11942076/mackcom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 216, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1566200459, "creation_date": 1566117770, "question_id": 57542983, "link": "https://stackoverflow.com/questions/57542983/how-to-pass-a-go-pointer-as-wasm-context-data", "title": "How to pass a go pointer as wasm context data?", "body": "<p>I'm looking at wasmer go-ext-wasm example code <code>/go-ext-wasm/wasmer/test/imports.go</code> learning about setting context data. I want to pass a pointer as contextData, what's the best way to do this?</p>\n\n<pre><code>//export sum\nfunc sum(context unsafe.Pointer, x int32, y int32) int32 {\n    instanceContext := wasm.IntoInstanceContext(context)\n    t := *(*int)(instanceContext.Data())\n    log.Print(\"t: \", t)\n    return x + y\n}\n\nfunc testInstanceImport(t *testing.T) {\n    imports, err := wasm.NewImports().Namespace(\"env\").Append(\"sum\", sum, C.sum)\n    assert.NoError(t, err)\n\n    instance, err := wasm.NewInstanceWithImports(getImportedFunctionBytes(\"examples\", \"imported_function.wasm\"), imports)\n    defer instance.Close()\n    assert.NoError(t, err)\n\n    bar := int(2)\n    barPtr := &amp;bar\n\n    data := unsafe.Pointer(&amp;bar)\n    instance.SetContextData(data)\n    log.Printf(\"bar %v, barPtr %v\", bar, barPtr)\n    add1, exists := instance.Exports[\"add1\"]\n    assert.Equal(t, true, exists)\n\n    result, err := add1(1, 2)\n    log.Print(\"Result: \", result)\n    assert.Equal(t, wasm.I32(4), result)\n    assert.NoError(t, err)\n}\n</code></pre>\n\n<p>Which gives me the expected value of 2 for context in the sum function.  However when I change <code>data := unsafe.Pointer(&amp;bar)</code> to <code>data := unsafe.Pointer(&amp;barPtr)</code>  I get a: <code>runtime error: cgo argument has Go pointer to Go pointer</code> error.  </p>\n\n<p>It works when I run it with <code>GODEBUG=cgocheck=0</code>  Should I be concerned running with this flag?  Is what I'm trying to do a bad idea?  I have a struct that contains a pointer that I need to pass as contextData, is using the <code>GODEBUG=cgocheck=0</code> a bad idea?</p>\n"}, {"tags": ["postgresql", "go", "many-to-many", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 474, "user_id": 2849550, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VTTGh.jpg?s=128&g=1", "display_name": "kAvEh", "link": "https://stackoverflow.com/users/2849550/kaveh"}, "is_accepted": true, "score": 1, "last_activity_date": 1566118661, "creation_date": 1566118661, "answer_id": 57543078, "question_id": 57542827, "link": "https://stackoverflow.com/questions/57542827/how-to-do-many-to-many-find-query/57543078#57543078", "title": "How to do many-to-many Find query", "body": "<p>I found the solution myself. for finding Users who have specified language must use <a href=\"http://gorm.io/docs/many_to_many.html#Back-Reference\" rel=\"nofollow noreferrer\">Back-Reference</a> like this:</p>\n\n<pre><code>type User struct {\n  gorm.Model\n  Languages         []*Language `gorm:\"many2many:user_languages;\"`\n}\n\ntype Language struct {\n  gorm.Model\n  Name string\n  Users               []*User     `gorm:\"many2many:user_languages;\"`\n}\n</code></pre>\n\n<p>and the query will be in this form:</p>\n\n<pre><code>var users []User\nvar lang = Language &lt;-- this is the specified language\ndb.Model(&amp;lang).Association(\"Users\").Find(&amp;users)\n</code></pre>\n"}], "owner": {"reputation": 474, "user_id": 2849550, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VTTGh.jpg?s=128&g=1", "display_name": "kAvEh", "link": "https://stackoverflow.com/users/2849550/kaveh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 131, "favorite_count": 0, "accepted_answer_id": 57543078, "answer_count": 1, "score": 1, "last_activity_date": 1566118691, "creation_date": 1566116295, "last_edit_date": 1566118691, "question_id": 57542827, "link": "https://stackoverflow.com/questions/57542827/how-to-do-many-to-many-find-query", "title": "How to do many-to-many Find query", "body": "<p>I have two structs with a many-to-many relation like this:</p>\n\n<pre><code>type User struct {\n  gorm.Model\n  Languages         []Language `gorm:\"many2many:user_languages;\"`\n}\n\ntype Language struct {\n  gorm.Model\n  Name string\n}\n</code></pre>\n\n<p>I want to find users who have specified language. something like this:</p>\n\n<pre><code>var users []User\nvar lang = Language &lt;-- this is the specified language\ndb.Model(&amp;user).Association(\"Languages\").Where(\"id = ? \", lang.ID).Find(&amp;users)\n</code></pre>\n\n<p>but this format is not allowed.</p>\n"}, {"tags": ["list", "go"], "answers": [{"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": false, "score": 0, "last_activity_date": 1566150431, "last_edit_date": 1566150431, "creation_date": 1566118209, "answer_id": 57543029, "question_id": 57542361, "link": "https://stackoverflow.com/questions/57542361/list-package-movetofront-not-working-for-me/57543029#57543029", "title": "list package `MoveToFront` not working for me", "body": "<p>There seem to be two problems, to me.  First, this isn't how the List data type is meant to be used: <code>lc.list.PushFront()</code> will <em>create</em> a <code>List.Element</code> and return a pointer to it.  That's not fatal, but at the least, it is kind of annoying\u2014the caller has to dig through the returned <code>List.Element</code> when using <code>Get</code>, instead of just getting the value.</p>\n\n<p>Meanwhile, presumably the failure you see is because you remove elements in <code>Put</code> when the LRU-list runs out of space, but you don't remove them from the corresponding map.  Hence a later <code>Put</code> of the just-removed key will try to re-use the element in place, even though the element was removed from the list.  To fix this, you'll need to hold both key and value.  (In my simple experiment I did not see any failures here, but the problem became clear enough.)</p>\n\n<p>I restructured the code somewhat and turned it into a <a href=\"https://play.golang.org/p/peBi8i_mDD1\" rel=\"nofollow noreferrer\">working example on the Go Playground</a>.  I make no promises as to suitability, etc.</p>\n"}], "owner": {"reputation": 576, "user_id": 2275540, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0c949cbafe28092f362d1f887cd59260?s=128&d=identicon&r=PG", "display_name": "stringRay2014", "link": "https://stackoverflow.com/users/2275540/stringray2014"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 50, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566150431, "creation_date": 1566111486, "last_edit_date": 1566128058, "question_id": 57542361, "link": "https://stackoverflow.com/questions/57542361/list-package-movetofront-not-working-for-me", "title": "list package `MoveToFront` not working for me", "body": "<p>New to Go and building a simple LRU cache in Go to get used to syntax and Go development.</p>\n\n<p>Having an issue with the <code>MoveToFront</code> list method, it fails on the following check in the <code>MoveToFront</code> body </p>\n\n<pre><code>if e.list != l || l.root.next == e \n</code></pre>\n\n<p>I want to move the element (e) to the front of the list when I retrieve it from cache , like this </p>\n\n<pre><code>if elem, ok := lc.entries[k]; ok {\n    lc.list.MoveToFront(elem) // needs fixing\n    return elem\n}\nreturn nil\n</code></pre>\n\n<p>The Code can be seen here on line 32 the issue occurs </p>\n\n<p><a href=\"https://github.com/hajjboy95/golrucache/blob/master/lru_cache/lrucache.go#L32\" rel=\"nofollow noreferrer\">https://github.com/hajjboy95/golrucache/blob/master/lru_cache/lrucache.go#L32</a></p>\n"}, {"tags": ["go", "telnet"], "comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 2, "creation_date": 1566111719, "post_id": 57542309, "comment_id": 101548390, "body": "If you want to show data send by the server you should actually <a href=\"https://godoc.org/github.com/reiver/go-telnet#Conn.Read\" rel=\"nofollow noreferrer\">read</a> these. What you do here is just print the connection object."}, {"owner": {"reputation": 95, "user_id": 8660255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/deab6881d51059ce496b8146ed41fc9e?s=128&d=identicon&r=PG&f=1", "display_name": "Morteza Hasanabadi", "link": "https://stackoverflow.com/users/8660255/morteza-hasanabadi"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1566214176, "post_id": 57542309, "comment_id": 101573376, "body": "of course, but it&#39;s not clear for me how to use it and also there isn&#39;t any example."}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 8660255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/deab6881d51059ce496b8146ed41fc9e?s=128&d=identicon&r=PG&f=1", "display_name": "Morteza Hasanabadi", "link": "https://stackoverflow.com/users/8660255/morteza-hasanabadi"}, "edited": false, "score": 0, "creation_date": 1566214361, "post_id": 57542615, "comment_id": 101573472, "body": "This is the revised code but still I can&#39;t print any data. <code>code \tconn, _ := telnet.DialTo(&quot;10.253.102.41:23&quot;) \tconn.Write([]byte(&quot;test&quot;)) \tconn.Write([]byte(&quot;\\n&quot;)) \tb := make([]byte, 100) \tn, err := conn.Read(b) \tif err != nil { \t\t&#47;&#47; handle error \t}  \tfmt.Println(string(n))  }</code>"}], "tags": [], "owner": {"reputation": 1081, "user_id": 1185148, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/bhzy9.jpg?s=128&g=1", "display_name": "meshkati", "link": "https://stackoverflow.com/users/1185148/meshkati"}, "is_accepted": false, "score": 0, "last_activity_date": 1566114050, "creation_date": 1566114050, "answer_id": 57542615, "question_id": 57542309, "link": "https://stackoverflow.com/questions/57542309/reading-data-with-telnet-client-in-go/57542615#57542615", "title": "reading data with Telnet client in go", "body": "<p>It's obvious that it gets you <code>&amp;{0xc000006028 0xc000004720 0xc000040640}</code> cause you are printing the connection object and it's the pointer address of that. If you want to print the data, you have to read it through connection using the <code>Read</code> method of the connection. Something like this:</p>\n\n<pre><code>b := make([]byte, 100)\nn, err := conn.Read(b)\nif err != nil {\n    // handle error\n}\n\nfmt.Println(string(b))\n</code></pre>\n"}], "owner": {"reputation": 95, "user_id": 8660255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/deab6881d51059ce496b8146ed41fc9e?s=128&d=identicon&r=PG&f=1", "display_name": "Morteza Hasanabadi", "link": "https://stackoverflow.com/users/8660255/morteza-hasanabadi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 758, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1566114050, "creation_date": 1566110883, "question_id": 57542309, "link": "https://stackoverflow.com/questions/57542309/reading-data-with-telnet-client-in-go", "title": "reading data with Telnet client in go", "body": "<p>I'm trying to read data from some devices via telnet protocol and below is my simple code.\nI just want to print some meaningful results.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/reiver/go-telnet\"\n\n)\n\nfunc main() {\n\n    conn, _ := telnet.DialTo(\"10.253.102.41:23\")\n    fmt.Println(conn)\n}\n</code></pre>\n\n<p>but this is what I got by this way:\n&amp;{0xc000006028 0xc000004720 0xc000040640}</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1566099828, "creation_date": 1566099828, "answer_id": 57541474, "question_id": 57541420, "link": "https://stackoverflow.com/questions/57541420/can-not-parse-json-file-in-go/57541474#57541474", "title": "Can not parse json file in go", "body": "<p>The info struct fields are private. Capitalize the first letters.</p>\n"}], "owner": {"reputation": 1, "user_id": 11797103, "user_type": "registered", "profile_image": "https://graph.facebook.com/2376960142580328/picture?type=large", "display_name": "Phan C&#244;ng H\u1eadu", "link": "https://stackoverflow.com/users/11797103/phan-c%c3%b4ng-h%e1%ba%adu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "closed_date": 1566115677, "accepted_answer_id": 57541474, "answer_count": 1, "score": -3, "last_activity_date": 1566099828, "creation_date": 1566098701, "question_id": 57541420, "link": "https://stackoverflow.com/questions/57541420/can-not-parse-json-file-in-go", "closed_reason": "Duplicate", "title": "Can not parse json file in go", "body": "<p>I'm trying to parse a json file using GoLang but it seems like not work. Am I doing right?</p>\n\n<p>this is  my Go Code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n)\n\ntype info struct {\n    username   string   `json:\"username\"`\n    password   string   `json:\"password\"`\n    timedelay  int      `json:\"timedelay\"`\n    courselist []string `json:\"courselist\"`\n}\n\nfunc main() {\n    var jsonParse info\n    file, err := ioutil.ReadFile(\"info.json\")\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(\"My file content is:\\n\", string(file))\n    fmt.Println(\"---------------Parsing Json File----------------\")\n\n    json.Unmarshal(file, &amp;jsonParse)\n    fmt.Println(\"My Json Parse is:\\n\", jsonParse)\n\n}\n\n</code></pre>\n\n<p>and this is my json file</p>\n\n<pre><code>{\n    \"username\" : \"17020726\",\n    \"password\": \"Blueflower\",\n    \"timedelay\": 200,\n    \"courselist\": [\"54\"]\n}\n</code></pre>\n\n<p>this is result of my code</p>\n\n<pre><code>My file content is:\n {\n    \"username\" : \"17020726\",\n    \"password\": \"Blueflower\",\n    \"timedelay\": 200,\n    \"courselist\": [\"54\"]\n}\n---------------Parsing Json File----------------\nMy Json Parse is:\n {  0 []}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1566096219, "post_id": 57541199, "comment_id": 101546655, "body": "<code>log.Println(err)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 84923, "user_id": 1920232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iUA8y.jpg?s=128&g=1", "display_name": "peterm", "link": "https://stackoverflow.com/users/1920232/peterm"}, "is_accepted": true, "score": 2, "last_activity_date": 1566096500, "creation_date": 1566096500, "answer_id": 57541292, "question_id": 57541199, "link": "https://stackoverflow.com/questions/57541199/where-is-this-date-output-coming-from-in-json-encoder/57541292#57541292", "title": "Where is this date output coming from in json.Encoder?", "body": "<p>When <code>EOF</code> is reached the decoder returns <a href=\"https://godoc.org/io#pkg-variables\" rel=\"nofollow noreferrer\"><code>io.EOF</code></a> which is then is being output by the logger <code>log.Println(err)</code> with a timestamp prepended.</p>\n\n<p>You can check for <code>EOF</code> when decoding like this for example</p>\n\n<pre><code>if err := dec.Decode(&amp;v); err != nil {\n    if err != io.EOF {\n        log.Println(err)\n    }\n    return\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre>\n\u279c echo '{\"Name\":\"Wednesday\",\"Age\":6,\"Parents\":[\"Gomez\",\"Morticia\"]}' | ./json_decoder\n{\"Name\":\"Wednesday\"}\n</pre>\n"}, {"tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 1, "last_activity_date": 1566103624, "last_edit_date": 1566103624, "creation_date": 1566099756, "answer_id": 57541470, "question_id": 57541199, "link": "https://stackoverflow.com/questions/57541199/where-is-this-date-output-coming-from-in-json-encoder/57541470#57541470", "title": "Where is this date output coming from in json.Encoder?", "body": "<pre><code>log.Println(err)\n</code></pre>\n\n<blockquote>\n  <p>That logger writes to standard error and prints the date and time of each logged message.</p>\n</blockquote>\n\n<hr>\n\n<p>You are seeing both <code>stdout</code>and <code>stderr</code> so:</p>\n\n<ol>\n<li><p>The solution is to <strong>redirect</strong> the <code>stdout</code> to a file (or to another pipe):  </p>\n\n<pre><code>echo '{\"Name\":\"Wednesday\",\"Age\":6,\"Parents\":[\"Gomez\",\"Morticia\"]}' | ./jsonio &gt; file.json\n</code></pre>\n\n<p>Output (which is <code>stderr</code>):</p>\n\n<pre><code>2019/08/17 20:35:40 EOF\n</code></pre>\n\n<p>Then see the file content (which is <code>stdout</code>):</p>\n\n<pre><code>cat file.json \n\n{\"Name\":\"Wednesday\"}\n</code></pre></li>\n</ol>\n\n<hr>\n\n<ol start=\"2\">\n<li><p>You may discard <code>stderr</code> (not recommended, but for test purpose) or redirect <code>stderr</code>:</p>\n\n<pre><code>echo '{\"Name\":\"Wednesday\",\"Age\":6,\"Parents\":[\"Gomez\",\"Morticia\"]}' | ./jsonio 2&gt;/dev/null\n</code></pre>\n\n<p>Output (which is <code>stdout</code>):  </p>\n\n<pre><code>{\"Name\":\"Wednesday\"}\n</code></pre></li>\n</ol>\n\n<hr>\n\n<ol start=\"3\">\n<li><p>Or don't show the <code>EOF</code> at all (<strong>note</strong>: you'll see other errors like incorrect JSON errors in <code>stderr</code>):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"io\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    dec := json.NewDecoder(os.Stdin)\n    enc := json.NewEncoder(os.Stdout)\n    for {\n        var v map[string]interface{}\n        if err := dec.Decode(&amp;v); err != nil {\n            if err != io.EOF {\n                log.Println(err)\n            }\n            return\n        }\n        for k := range v {\n            if k != \"Name\" {\n                delete(v, k)\n            }\n        }\n        if err := enc.Encode(&amp;v); err != nil {\n            log.Println(err)\n        }\n    }\n}\n\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 14450, "user_id": 438615, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Dseeq.jpg?s=128&g=1", "display_name": "Jonah", "link": "https://stackoverflow.com/users/438615/jonah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 57541292, "answer_count": 2, "score": 2, "last_activity_date": 1566103624, "creation_date": 1566094862, "question_id": 57541199, "link": "https://stackoverflow.com/questions/57541199/where-is-this-date-output-coming-from-in-json-encoder", "title": "Where is this date output coming from in json.Encoder?", "body": "<p>At the end of <a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">the JSON and Go blog post</a> you'll find this sample program:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    dec := json.NewDecoder(os.Stdin)\n    enc := json.NewEncoder(os.Stdout)\n    for {\n        var v map[string]interface{}\n        if err := dec.Decode(&amp;v); err != nil {\n            log.Println(err)\n            return\n        }\n        for k := range v {\n            if k != \"Name\" {\n                delete(v, k)\n            }\n        }\n        if err := enc.Encode(&amp;v); err != nil {\n            log.Println(err)\n        }\n    }\n}\n</code></pre>\n\n<p>I compiled this with <code>go build json_decoder.go</code> and then ran the program like so in bash:</p>\n\n<pre><code>echo '{\"Name\":\"Wednesday\",\"Age\":6,\"Parents\":[\"Gomez\",\"Morticia\"]}' | json_decoder\n</code></pre>\n\n<p>and received this output:</p>\n\n<pre><code>{\"Name\":\"Wednesday\"}\n2019/08/17 22:09:20 EOF\n</code></pre>\n\n<p>The first line of output is exactly what I'd expect.  But where is the line <code>2019/08/17 22:09:20 EOF</code> coming from?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1566090712, "post_id": 57540983, "comment_id": 101546113, "body": "You&#39;re trying to assign a value of incompatible type."}], "answers": [{"tags": [], "owner": {"reputation": 192, "user_id": 9926863, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b8bd8790797123b145755a6727e49f7?s=128&d=identicon&r=PG&f=1", "display_name": "Jin", "link": "https://stackoverflow.com/users/9926863/jin"}, "is_accepted": true, "score": 1, "last_activity_date": 1566092003, "creation_date": 1566092003, "answer_id": 57541062, "question_id": 57540983, "link": "https://stackoverflow.com/questions/57540983/understanding-go-variable-assignment/57541062#57541062", "title": "Understanding GO variable assignment", "body": "<p>As @Sergio Tulentsev pointed out, you are assigning <code>ModifyDBClusterSnapshotAttributeInput</code> type to the variable <code>input</code>, that is a <code>CreateDBClusterSnapshotInput</code> type.</p>\n\n<p>There would be a few solutions to handle this problem, but the easiest way would be to make a method for each type struct that returns a compatible type for <code>input</code> like this;</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (createInput CreateDBClusterSnapshotInput) ReturnInput() {\n    return createInput.input // assuming that there are a input type your create\n}\n</code></pre>\n\n<p>If you don't want to make a method with the same functionality for each struct, you can create a base type, make your two structs extend the type, and build a method for the base type.</p>\n"}], "owner": {"reputation": 4669, "user_id": 3709060, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/MnFyD.jpg?s=128&g=1", "display_name": "edmamerto", "link": "https://stackoverflow.com/users/3709060/edmamerto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 57541062, "answer_count": 1, "score": -4, "last_activity_date": 1566092003, "creation_date": 1566090491, "question_id": 57540983, "link": "https://stackoverflow.com/questions/57540983/understanding-go-variable-assignment", "title": "Understanding GO variable assignment", "body": "<p>I'm new to GO and trying to build functions with the <code>aws-sdk</code> I have something like this</p>\n\n<pre><code>    input := &amp;rds.CreateDBClusterSnapshotInput{\n        // removed for brevity\n    }\n\n    result, err := svc.CreateDBClusterSnapshot(input)\n    if err != nil {\n        // removed for brevity\n    }\n\n    input = &amp;rds.ModifyDBClusterSnapshotAttributeInput{\n        // removed for brevity\n    }\n</code></pre>\n\n<p>When I try to build, I get this error</p>\n\n<pre><code>cannot use &amp;rds.ModifyDBClusterSnapshotAttributeInput literal (type *rds.ModifyDBClusterSnapshotAttributeInput) as type *rds.CreateDBClusterSnapshotInput in assignment\n</code></pre>\n\n<p>What's wrong with my assignment?</p>\n"}, {"tags": ["go", "encryption", "kotlin", "aes"], "comments": [{"owner": {"reputation": 44559, "user_id": 411022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9905bf9a7b8d5a587c1bdff07ef2e801?s=128&d=identicon&r=PG", "display_name": "Ilmari Karonen", "link": "https://stackoverflow.com/users/411022/ilmari-karonen"}, "edited": false, "score": 1, "creation_date": 1566083023, "post_id": 57540370, "comment_id": 101545236, "body": "While I&#39;m not 100% sure, I&#39;d be willing to bet that <code>NewCFBEncrypter</code> / <code>NewCFBDecrypter</code> implement full-block CFB mode (i.e. CFB-128 for AES), not CFB-8. I don&#39;t know if there <i>is</i> a built-in implementation of CFB-8 for Go; if not, you might have to implement it yourself using the raw AES block cipher directly (i.e. &quot;in ECB mode&quot;)."}, {"owner": {"reputation": 44559, "user_id": 411022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9905bf9a7b8d5a587c1bdff07ef2e801?s=128&d=identicon&r=PG", "display_name": "Ilmari Karonen", "link": "https://stackoverflow.com/users/411022/ilmari-karonen"}, "edited": false, "score": 1, "creation_date": 1566083249, "post_id": 57540370, "comment_id": 101545267, "body": "In fact, <a href=\"https://stackoverflow.com/a/37234233\">kostya&#39;s answer</a> to the last question you linked to above seems to provide a CFB-8 implementation in Go."}, {"owner": {"reputation": 201, "user_id": 6114308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Au3LV.jpg?s=128&g=1", "display_name": "Sxtanna", "link": "https://stackoverflow.com/users/6114308/sxtanna"}, "reply_to_user": {"reputation": 44559, "user_id": 411022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9905bf9a7b8d5a587c1bdff07ef2e801?s=128&d=identicon&r=PG", "display_name": "Ilmari Karonen", "link": "https://stackoverflow.com/users/411022/ilmari-karonen"}, "edited": false, "score": 0, "creation_date": 1566083322, "post_id": 57540370, "comment_id": 101545274, "body": "I actually tried that as well, but it doesn&#39;t work... @IlmariKaronen   Produces this:  Hello [68 160 19 37 229] [72 90 73 186 47] HZI\ufffd/"}, {"owner": {"reputation": 44559, "user_id": 411022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9905bf9a7b8d5a587c1bdff07ef2e801?s=128&d=identicon&r=PG", "display_name": "Ilmari Karonen", "link": "https://stackoverflow.com/users/411022/ilmari-karonen"}, "edited": false, "score": 2, "creation_date": 1566084578, "post_id": 57540370, "comment_id": 101545432, "body": "Looks like there was a typo in the <code>XORKeyStream</code> function that caused decryption to fail. Funny that nobody had caught it before... Anyway, I just edited the answer to fix it, and <a href=\"https://repl.it/repls/GrowlingStarchyAbandonware\" rel=\"nofollow noreferrer\">it seems to work fine now</a>."}, {"owner": {"reputation": 44559, "user_id": 411022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9905bf9a7b8d5a587c1bdff07ef2e801?s=128&d=identicon&r=PG", "display_name": "Ilmari Karonen", "link": "https://stackoverflow.com/users/411022/ilmari-karonen"}, "edited": false, "score": 0, "creation_date": 1567993237, "post_id": 57540370, "comment_id": 102121101, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/23897809/different-results-in-go-and-pycrypto-when-using-aes-cfb\">Different Results in Go and Pycrypto when using AES-CFB</a>"}, {"owner": {"reputation": 201, "user_id": 6114308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Au3LV.jpg?s=128&g=1", "display_name": "Sxtanna", "link": "https://stackoverflow.com/users/6114308/sxtanna"}, "reply_to_user": {"reputation": 44559, "user_id": 411022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9905bf9a7b8d5a587c1bdff07ef2e801?s=128&d=identicon&r=PG", "display_name": "Ilmari Karonen", "link": "https://stackoverflow.com/users/411022/ilmari-karonen"}, "edited": false, "score": 0, "creation_date": 1568190341, "post_id": 57540370, "comment_id": 102192455, "body": "I linked that question in my post to show that I&#39;ve seen it, and it didnt help."}, {"owner": {"reputation": 44559, "user_id": 411022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9905bf9a7b8d5a587c1bdff07ef2e801?s=128&d=identicon&r=PG", "display_name": "Ilmari Karonen", "link": "https://stackoverflow.com/users/411022/ilmari-karonen"}, "edited": false, "score": 0, "creation_date": 1568191218, "post_id": 57540370, "comment_id": 102192893, "body": "Did you try it again after I fixed the typo in the answer I linked above?"}, {"owner": {"reputation": 201, "user_id": 6114308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Au3LV.jpg?s=128&g=1", "display_name": "Sxtanna", "link": "https://stackoverflow.com/users/6114308/sxtanna"}, "reply_to_user": {"reputation": 44559, "user_id": 411022, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9905bf9a7b8d5a587c1bdff07ef2e801?s=128&d=identicon&r=PG", "display_name": "Ilmari Karonen", "link": "https://stackoverflow.com/users/411022/ilmari-karonen"}, "edited": false, "score": 1, "creation_date": 1568510814, "post_id": 57540370, "comment_id": 102295967, "body": "Yes, I did, and it worked. Thank you. @IlmariKaronen"}], "answers": [{"tags": [], "owner": {"reputation": 201, "user_id": 6114308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Au3LV.jpg?s=128&g=1", "display_name": "Sxtanna", "link": "https://stackoverflow.com/users/6114308/sxtanna"}, "is_accepted": true, "score": 0, "last_activity_date": 1568511066, "creation_date": 1568511066, "answer_id": 57940472, "question_id": 57540370, "link": "https://stackoverflow.com/questions/57540370/how-to-properly-write-jvm-aes-cfb8-encryption-in-go/57940472#57940472", "title": "How to properly write JVM AES/CFB8 Encryption in Go", "body": "<p>The solution to this is to implement CFB8 manually since the built in implementation defaults to CFB128.</p>\n\n<p>Implementation created by kostya and fixed by Ilmari Karonen (<a href=\"https://stackoverflow.com/a/37234233/6114308\">here</a>).</p>\n"}], "owner": {"reputation": 201, "user_id": 6114308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Au3LV.jpg?s=128&g=1", "display_name": "Sxtanna", "link": "https://stackoverflow.com/users/6114308/sxtanna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 330, "favorite_count": 3, "accepted_answer_id": 57940472, "answer_count": 1, "score": 2, "last_activity_date": 1568511066, "creation_date": 1566080870, "last_edit_date": 1568190295, "question_id": 57540370, "link": "https://stackoverflow.com/questions/57540370/how-to-properly-write-jvm-aes-cfb8-encryption-in-go", "title": "How to properly write JVM AES/CFB8 Encryption in Go", "body": "<p>I wrote a little test in Kotlin to encrypt some text \"Hello\" using a Cipher instance with the algorithm \"AES/CFB8/NoPadding\". \n(minecraft stuff)</p>\n\n<p>And I am now attempting to do the same in Go, however I am unable to produce the same result. All the different methods I have tried always produce something different.</p>\n\n<p>These are the following threads/examples I've already looked through in order to get to this point.</p>\n\n<ol>\n<li><a href=\"https://stackoverflow.com/questions/43463221/how-to-use-rsa-key-pair-for-aes-encryption-and-decryprion-in-golang\">How to use rsa key pair for AES encryption and decryprion in golang</a></li>\n<li><a href=\"https://play.golang.org/p/77fRvrDa4A\" rel=\"nofollow noreferrer\">https://play.golang.org/p/77fRvrDa4A</a></li>\n<li><a href=\"https://stackoverflow.com/questions/44850023/decrypt-in-golang-what-was-encrypted-in-python-aes-cfb\">Decrypt in Golang what was encrypted in Python AES CFB</a></li>\n<li><a href=\"https://gist.github.com/temoto/5052503\" rel=\"nofollow noreferrer\">https://gist.github.com/temoto/5052503</a></li>\n<li><a href=\"https://stackoverflow.com/questions/37210227/aes-encryption-in-golang-and-decryption-in-java\">AES Encryption in Golang and Decryption in Java</a></li>\n<li><a href=\"https://stackoverflow.com/questions/23897809/different-results-in-go-and-pycrypto-when-using-aes-cfb\">Different Results in Go and Pycrypto when using AES-CFB</a></li>\n</ol>\n\n<p>Kotlin Code:</p>\n\n<pre><code>enum class Mode(val mode: Int)\n{\n\n    ENCRYPT(Cipher.ENCRYPT_MODE),\n    DECRYPT(Cipher.DECRYPT_MODE),\n}\n\nfun createSecret(data: String): SecretKey\n{\n    return SecretKeySpec(data.toByteArray(), \"AES\")\n}\n\nfun newCipher(mode: Mode): Cipher\n{\n    val secret = createSecret(\"qwdhyte62kjneThg\")\n    val cipher = Cipher.getInstance(\"AES/CFB8/NoPadding\")\n    cipher.init(mode.mode, secret, IvParameterSpec(secret.encoded))\n\n    return cipher\n}\n\nfun runCipher(data: ByteArray, cipher: Cipher): ByteArray\n{\n    val output = ByteArray(data.size)\n\n    cipher.update(data, 0, data.size, output)\n\n    return output\n}\n\n\nfun main()\n{\n    val encrypter = newCipher(Mode.ENCRYPT)\n    val decrypter = newCipher(Mode.DECRYPT)\n\n    val iText = \"Hello\"\n    val eText = runCipher(iText.toByteArray(), encrypter)\n    val dText = runCipher(eText, decrypter)\n    val oText = String(dText)\n\n\n    println(iText)\n    println(Arrays.toString(eText))\n    println(Arrays.toString(dText))\n    println(oText)\n}\n</code></pre>\n\n<p>Go Code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestCipher(t *testing.T) {\n\n    secret := newSecret(\"qwdhyte62kjneThg\")\n\n    encrypter := newCipher(secret, ENCRYPT)\n    decrypter := newCipher(secret, DECRYPT)\n\n    iText := \"Hello\"\n    eText := encrypter.run([]byte(iText))\n    dText := decrypter.run(eText)\n    oText := string(dText)\n\n    fmt.Printf(\"%s\\n%v\\n%v\\n%s\\n\", iText, eText, dText, oText)\n}\n\ntype Mode int\n\nconst (\n    ENCRYPT Mode = iota\n    DECRYPT\n)\n\ntype secret struct {\n    Data []byte\n}\n\ntype cipherInst struct {\n    Data cipher2.Block\n    Make cipher2.Stream\n}\n\nfunc newSecret(text string) *secret {\n    return &amp;secret{Data: []byte(text)}\n}\n\nfunc newCipher(data *secret, mode Mode) *cipherInst {\n    cip, err := aes.NewCipher(data.Data)\n    if err != nil {\n        panic(err)\n    }\n\n    var stream cipher2.Stream\n\n    if mode == ENCRYPT {\n        stream = cipher2.NewCFBEncrypter(cip, data.Data)\n    } else {\n        stream = cipher2.NewCFBDecrypter(cip, data.Data)\n    }\n\n    return &amp;cipherInst{Data: cip, Make: stream}\n}\n\nfunc (cipher *cipherInst) run(dataI []byte) []byte {\n\n    out := make([]byte, len(dataI))\n    cipher.Make.XORKeyStream(out, dataI)\n\n    return out\n}\n</code></pre>\n\n<p>Kotlin code produces the output:</p>\n\n<pre><code>Hello\n[68, -97, 26, -50, 126]\n[72, 101, 108, 108, 111]\nHello\n</code></pre>\n\n<p>However, the Go code produces the output:</p>\n\n<pre><code>Hello\n[68 97 242 158 187]\n[72 101 108 108 111]\nHello\n</code></pre>\n\n<p>At this point, this issue has pretty much halted the progress of the project I'm working on. Any information on what I'm missing or doing wrong would be helpful.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1566071902, "post_id": 57539443, "comment_id": 101543212, "body": "Closely related/possible duplicate: <a href=\"https://stackoverflow.com/q/40737122/13860\">stackoverflow.com/q/40737122/13860</a>"}, {"owner": {"reputation": 889, "user_id": 1742379, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/56a17d1ef6bfbd93856faba181de8b7b?s=128&d=identicon&r=PG", "display_name": "Zane Hitchcox", "link": "https://stackoverflow.com/users/1742379/zane-hitchcox"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1566072875, "post_id": 57539443, "comment_id": 101543411, "body": "@Flimzy...I just tried the <code>convert</code> function, but it did not work for my use case and still gave me a map of strings to interface.  I&#39;m trying to get a map of strings to other maps like my code does in the question. The reason for this is that interfaces do not allow indexing the way maps do."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1566072926, "creation_date": 1566072926, "answer_id": 57539650, "question_id": 57539443, "link": "https://stackoverflow.com/questions/57539443/how-do-i-convert-nested-interfaces-to-a-map-of-slices-of-maps/57539650#57539650", "title": "How do I convert nested interfaces to a map of slices of maps?", "body": "<p>You can define a struct with the expected structure, and try to unmarshal to it with something like this:</p>\n\n<p><a href=\"https://github.com/mitchellh/mapstructure\" rel=\"nofollow noreferrer\">https://github.com/mitchellh/mapstructure</a></p>\n\n<p>I never tried it with map[interface{}]interface{} though.</p>\n"}, {"tags": [], "owner": {"reputation": 889, "user_id": 1742379, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/56a17d1ef6bfbd93856faba181de8b7b?s=128&d=identicon&r=PG", "display_name": "Zane Hitchcox", "link": "https://stackoverflow.com/users/1742379/zane-hitchcox"}, "is_accepted": true, "score": 0, "last_activity_date": 1566078084, "creation_date": 1566078084, "answer_id": 57540119, "question_id": 57539443, "link": "https://stackoverflow.com/questions/57539443/how-do-i-convert-nested-interfaces-to-a-map-of-slices-of-maps/57540119#57540119", "title": "How do I convert nested interfaces to a map of slices of maps?", "body": "<p>This is the final code I used:</p>\n\n<pre><code>if key == \"identities\" {\n    idTypes := convertToStringMap(setting)\n    ghIds := convertToMapSlice(idTypes[\"github\"])\n    for _, ghId := range ghIds {\n        for key, value := range convertToStringMap(ghId) {\n            log.Println(key, value)\n        }\n    }\n}\n</code></pre>\n\n<p>it basically converts the interfaces to map[string]interface{} one step at a time, which is the best way to do it I've found, and at least you stay out of nesting hell.</p>\n\n<p>These are the function to convert to the proper types:</p>\n\n<pre><code>func convertToStringMap(i interface{}) map[string]interface{} {\n    v, ok := i.(map[string]interface{})\n    if !ok {\n        v, ok := i.(map[interface{}]interface{})\n        if ok {\n            m2 := map[string]interface{}{}\n            for k, v := range v {\n                m2[k.(string)] = v\n            }\n            return m2\n        } else {\n            log.Fatal(\"There was a problem converting to a string map\")\n        }\n    }\n    return v\n}\n\nfunc convertToMapSlice(i interface{}) []interface{} {\n    v, ok := i.([]interface{})\n    if !ok {\n        log.Fatal(\"There was a problem converting to a slice\")\n    }\n    return v\n}\n</code></pre>\n\n<p>Overall though, I think I'm just going to find a work around so I don't have to do this at all.</p>\n"}], "owner": {"reputation": 889, "user_id": 1742379, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/56a17d1ef6bfbd93856faba181de8b7b?s=128&d=identicon&r=PG", "display_name": "Zane Hitchcox", "link": "https://stackoverflow.com/users/1742379/zane-hitchcox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 264, "favorite_count": 0, "accepted_answer_id": 57540119, "answer_count": 2, "score": 0, "last_activity_date": 1566078084, "creation_date": 1566071224, "last_edit_date": 1566075328, "question_id": 57539443, "link": "https://stackoverflow.com/questions/57539443/how-do-i-convert-nested-interfaces-to-a-map-of-slices-of-maps", "title": "How do I convert nested interfaces to a map of slices of maps?", "body": "<p>I have a map of arrays of maps <code>map[string][]map[string]string</code>, only, when I get the data, it's in the format <code>map[interface{}]map[interface{}][]map[interface{}]interface{}</code>, so I'm left to do a bunch of nested type assertions, which is really clunky, takes a long time to write, is hard to read/write, and is probably error prone, like this;</p>\n\n<pre><code>        if key == \"identities\" {\n            idErrMessage := \"Sorry, there was a problem with an identity\"\n            idArray, ok := setting.(map[string]interface{})\n            if ok {\n                for idType, ids := range idArray {\n                    idGroupArray, ok := ids.([]interface{})\n                    if ok {\n                        for _, idGroup := range idGroupArray {\n                            id, ok := idGroup.(map[interface{}]interface{})\n                            if ok {\n                                log.Println(\"type:\", idType)\n                                for key, val := range id {\n                                    log.Printf(\"%v: %v\", key, val)\n                                }\n                            } else {\n                                log.Fatal(idErrMessage)\n                            }\n                        }\n                    } else {\n                        log.Fatal(idErrMessage)\n                    }\n                }\n            } else {\n                log.Fatal(idErrMessage)\n            }\n        }\n</code></pre>\n\n<p>I've been searching for a few hours now, and I can't seem to find an easier way to do this than the code above.</p>\n\n<p>Is there anyway I can just <code>v, ok := setting.(map[string]map[string][]map[string]string)</code>, or am I just stuck with the code above?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 56, "user_id": 7556925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f0aed8a25dcbd6efcd20913f0c9c721?s=128&d=identicon&r=PG&f=1", "display_name": "Badmus Adeyinka", "link": "https://stackoverflow.com/users/7556925/badmus-adeyinka"}, "edited": false, "score": 0, "creation_date": 1566070719, "post_id": 57539355, "comment_id": 101542968, "body": "Works. Thank you very much. I didn&#39;t realise that might have been the problem."}, {"owner": {"reputation": 34787, "user_id": 1092711, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/x6e4H.jpg?s=128&g=1", "display_name": "Pavlo", "link": "https://stackoverflow.com/users/1092711/pavlo"}, "reply_to_user": {"reputation": 56, "user_id": 7556925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f0aed8a25dcbd6efcd20913f0c9c721?s=128&d=identicon&r=PG&f=1", "display_name": "Badmus Adeyinka", "link": "https://stackoverflow.com/users/7556925/badmus-adeyinka"}, "edited": false, "score": 0, "creation_date": 1566071078, "post_id": 57539355, "comment_id": 101543040, "body": "@BadmusAdeyinka Great! I&#39;d appreciate if you would <a href=\"https://stackoverflow.com/help/accepted-answer\">accept the anwer</a>."}], "tags": [], "owner": {"reputation": 34787, "user_id": 1092711, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/x6e4H.jpg?s=128&g=1", "display_name": "Pavlo", "link": "https://stackoverflow.com/users/1092711/pavlo"}, "is_accepted": true, "score": 1, "last_activity_date": 1566070369, "creation_date": 1566070369, "answer_id": 57539355, "question_id": 57539314, "link": "https://stackoverflow.com/questions/57539314/appending-to-slice-in-loop/57539355#57539355", "title": "Appending to slice in loop", "body": "<p>Move map initialization into the loop. This will create new map each time, otherwise, you are overriding the content of the same map:</p>\n\n<pre><code>for _, eachContent := range content {\n   e := map[string]string{}\n  // ...\n}\n</code></pre>\n"}], "owner": {"reputation": 56, "user_id": 7556925, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f0aed8a25dcbd6efcd20913f0c9c721?s=128&d=identicon&r=PG&f=1", "display_name": "Badmus Adeyinka", "link": "https://stackoverflow.com/users/7556925/badmus-adeyinka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "accepted_answer_id": 57539355, "answer_count": 1, "score": -1, "last_activity_date": 1566070911, "creation_date": 1566069967, "last_edit_date": 1566070911, "question_id": 57539314, "link": "https://stackoverflow.com/questions/57539314/appending-to-slice-in-loop", "title": "Appending to slice in loop", "body": "<p>I have a problem with appending to a slice in a loop. The last read content in loop replaces existing slice content.</p>\n\n<p>I have tried the built-in function append and also tried directly assigning with indexes, none works.</p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n\"io/ioutil\"\n\"log\"\n)\n\nfunc main() {\n\n    content, err := ioutil.ReadDir(\"./\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    var a []map[string]string\n    e := map[string]string{}\n    for _, eachContent := range content {\n\n        if eachContent.IsDir() {\n            e[\"name\"] = eachContent.Name()\n            e[\"isdir\"] = \"1\"\n        } else {\n            e[\"name\"] = eachContent.Name()\n            e[\"isdir\"] = \"0\"\n        }\n        fmt.Println(e)\n        a = append(a, e)\n    }\n\n    fmt.Println(a)\n\n}\n</code></pre>\n\n<p>Exepecting:</p>\n\n<pre><code>[map[name:dev isdir:1] map[isdir:1 name:etc] map[name:test.go isdir:0]] \n</code></pre>\n\n<p>but I got </p>\n\n<pre><code>[map[name:test.go isdir:0] map[isdir:0 name:test.go] map[name:test.go isdir:0]]\n</code></pre>\n"}, {"tags": ["javascript", "go", "mpeg-dash", "shaka"], "answers": [{"comments": [{"owner": {"reputation": 356, "user_id": 7723621, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-ebX4tq_cRZQ/AAAAAAAAAAI/AAAAAAAAAFI/9NpCS5hUHgA/photo.jpg?sz=128", "display_name": "Allan Guwatudde", "link": "https://stackoverflow.com/users/7723621/allan-guwatudde"}, "edited": false, "score": 0, "creation_date": 1593513317, "post_id": 57561023, "comment_id": 110801586, "body": "In my case, I was having a CORS issue."}], "tags": [], "owner": {"reputation": 220, "user_id": 10176454, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZmxR2.png?s=128&g=1", "display_name": "zergon321", "link": "https://stackoverflow.com/users/10176454/zergon321"}, "is_accepted": false, "score": 1, "last_activity_date": 1566233772, "creation_date": 1566233772, "answer_id": 57561023, "question_id": 57538927, "link": "https://stackoverflow.com/questions/57538927/how-to-serve-an-mpeg-dash-manifest-to-shaka-player-properly/57561023#57561023", "title": "How to serve an MPEG-DASH manifest to Shaka player properly?", "body": "<p>Ok, it was enough to specify the scheme:\n<code>http://127.0.0.1:5000/manifest</code>\ninstead of just\n<code>127.0.0.1:5000/manifest</code>.</p>\n"}], "owner": {"reputation": 220, "user_id": 10176454, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZmxR2.png?s=128&g=1", "display_name": "zergon321", "link": "https://stackoverflow.com/users/10176454/zergon321"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 439, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1566233772, "creation_date": 1566066700, "last_edit_date": 1566134123, "question_id": 57538927, "link": "https://stackoverflow.com/questions/57538927/how-to-serve-an-mpeg-dash-manifest-to-shaka-player-properly", "title": "How to serve an MPEG-DASH manifest to Shaka player properly?", "body": "<p>I tried to implement <a href=\"https://shaka-player-demo.appspot.com/docs/api/tutorial-basic-usage.html\" rel=\"nofollow noreferrer\">Shaka Player</a> in my Go project. This is the project structure:</p>\n\n<pre><code>.\n\u251c\u2500\u2500 client\n\u2502   \u251c\u2500\u2500 index.html\n\u2502   \u251c\u2500\u2500 shaka.js\n\u2502   \u2514\u2500\u2500 shaka-player.compiled.js\n\u2514\u2500\u2500 server\n    \u251c\u2500\u2500 assets\n    \u2502   \u251c\u2500\u2500 test_dashinit.mp4\n    \u2502   \u2514\u2500\u2500 test_dash.mpd\n    \u251c\u2500\u2500 Gopkg.lock\n    \u251c\u2500\u2500 Gopkg.toml\n    \u251c\u2500\u2500 main.go\n    \u2514\u2500\u2500 vendor\n</code></pre>\n\n<p><code>index.html</code>:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;!DOCTYPE html&gt;\r\n&lt;html&gt;\r\n\r\n&lt;head&gt;\r\n    &lt;meta charset=\"utf-8\"&gt;\r\n    &lt;title&gt;Video&lt;/title&gt;\r\n\r\n    &lt;script src=\"shaka-player.compiled.js\" defer&gt;&lt;/script&gt;\r\n    &lt;script src=\"shaka.js\" defer&gt;&lt;/script&gt;\r\n&lt;/head&gt;\r\n\r\n&lt;body&gt;\r\n    &lt;video id=\"video-clip\" controls&gt;&lt;/video&gt;\r\n&lt;/body&gt;\r\n\r\n&lt;/html&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>My <code>main.go</code> file in which I specify routes for <code>index.html</code> and <code>test_dash.mpd</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func sendManifest(w http.ResponseWriter, r *http.Request) {\n    // Open the file.\n    manifest, err := os.Open(\"server/assets/test_dash.mpd\")\n\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n\n        return\n    }\n\n    defer manifest.Close()\n\n    // Get file size.\n    stat, err := manifest.Stat()\n\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n\n        return\n    }\n\n    size := strconv.FormatInt(stat.Size(), 10)\n\n    // Set the headers.\n    w.Header().Set(\"Content-Disposition\", \"attachment; filename=manifest.mpd\")\n    w.Header().Set(\"Content-Type\", \"application/dash+xml\")\n    w.Header().Set(\"Content-Length\", size)\n    // Send the file.\n    io.Copy(w, manifest)\n}\n\nfunc main() {\n    cwd, _ := os.Getwd()\n    fmt.Println(cwd)\n\n    fs := http.FileServer(http.Dir(\"client\"))\n\n    http.Handle(\"/\", fs)\n    http.HandleFunc(\"/manifest\", sendManifest)\n\n    http.ListenAndServe(\":5000\", nil)\n}\n</code></pre>\n\n<p>When I try to access the manifest with <code>player.load()</code>, it just returns <code>404 Not found</code>. But when I try to access it in the browser by the same link (<code>127.0.0.1:5000/manifest</code>), it's ok and I can download the file. The link from the guide works well. How should I serve the video manifest from my Go server so Shaka player could consume it without any errors?</p>\n"}]