[{"tags": ["unit-testing", "testing", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1530768899, "post_id": 51181347, "comment_id": 89349693, "body": "Take a look at how the standard lib does such stuff. A good example is package go/printer. Try adopting what TestFiles in <a href=\"https://golang.org/src/go/printer/printer_test.go?#L179\" rel=\"nofollow noreferrer\">golang.org/src/go/printer/printer_test.go?#L179</a> does to your problem."}], "answers": [{"comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1530768707, "post_id": 51181421, "comment_id": 89349621, "body": "Suggestion: Add the expected results as testdate/yourtestfile.golden to the project and compare the generated output to the expected gold standard. Add a command line flag -update-golden to your test which overwrite the golden files with the acutal output in case your code changes and the expected outout needs some update."}, {"owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1530818639, "post_id": 51181421, "comment_id": 89378845, "body": "Thank you for this! Helped me write what I have in my second edit. Still, I have a question on how to properly handle the expected error values. @Volker Thanks for the <code>.golden</code> file suggestion. Seems pretty useful for this case."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 6, "last_activity_date": 1530819610, "last_edit_date": 1530819610, "creation_date": 1530743582, "answer_id": 51181421, "question_id": 51181347, "link": "https://stackoverflow.com/questions/51181347/learning-to-write-unit-tests/51181421#51181421", "title": "Learning to write unit tests", "body": "<p>You basically need to have some sample files with the contents you want to test, then in your test code you can call the <code>generateCmds</code> function passing in the template string and the files to then verify that the results are what you expect.</p>\n\n<p>It is not so much different as the examples you probably saw for simpler cases.</p>\n\n<p>You can place the files under a <code>testdata</code> folder inside the same package (<code>testdata</code> is a special name that the Go tools will ignore during build).</p>\n\n<p>Then you can do something like:</p>\n\n<pre><code>func TestCSVProcessing(t *testing.T) {\n    templateStr := `&lt;your template here&gt;`\n    testFile := \"testdata/yourtestfile.csv\"\n    result, err := generateCmds(templateStr, testFile)\n    if err != nil {\n        // fail the test here, unless you expected an error with this file\n    }\n    // compare the \"result\" contents with what you expected\n    // failing the test if it does not match\n}\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>About the specific questions you added later:</p>\n\n<blockquote>\n  <p>Would a test table be useful in a function like this? And, if so, would the test struct need to include the returned cmds string slice and the value of err?</p>\n</blockquote>\n\n<p>Yes, it'd make sense to include both the expected strings to be returned as well as the expected error (if any).</p>\n\n<blockquote>\n  <p>How do you handle errors that are supposed to be returned for specific test cases? For example, os.Open() returns an error of type *PathError if an error is encountered. How do I initialize a *PathError that is equivalent to the one returned by os.Open()?</p>\n</blockquote>\n\n<p>I don't think you'll be able to \"initialize\" an equivalent error for each case. Sometimes the libraries might use internal types for their errors making this impossible. Easiest would be to \"initialize\" a regular error with the same value returned in its <code>Error()</code> method, then just compare the returned error's <code>Error()</code> value with the expected one.</p>\n"}], "owner": {"reputation": 267, "user_id": 8020595, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e03b1dff3295eab007f791de5f787f60?s=128&d=identicon&r=PG&f=1", "display_name": "mwalto7", "link": "https://stackoverflow.com/users/8020595/mwalto7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 2, "accepted_answer_id": 51181421, "answer_count": 1, "score": 1, "last_activity_date": 1530872747, "creation_date": 1530742789, "last_edit_date": 1530817598, "question_id": 51181347, "link": "https://stackoverflow.com/questions/51181347/learning-to-write-unit-tests", "title": "Learning to write unit tests", "body": "<p>I am trying to learn how to write tests for my code in order to write better code, but I just seem to have the hardest time figuring out how to actually test some code I have written. I have read so many tutorials, most of which seem to only cover functions that add two numbers or mock some database or server.</p>\n\n<p>I have a simple function I wrote below that takes a text template and a CSV file as input and executes the template using the values of the CSV. I have \"tested\" the code by trial and error, passing files, and printing values, but I would like to learn how to write proper tests for it. I feel that learning to test my own code will help me understand and learn faster and better. Any help is appreciated.</p>\n\n<pre><code>// generateCmds generates configuration commands from a text template using\n// the values from a CSV file. Multiple commands in the text template must\n// be delimited by a semicolon. The first row of the CSV file is assumed to\n// be the header row and the header values are used for key access in the\n// text template.\nfunc generateCmds(cmdTmpl string, filename string) ([]string, error) {\n    t, err := template.New(\"cmds\").Parse(cmdTmpl)\n    if err != nil {\n        return nil, fmt.Errorf(\"parsing template: %v\", err)\n    }\n\n    f, err := os.Open(filename)\n    if err != nil {\n        return nil, fmt.Errorf(\"reading file: %v\", err)\n    }\n    defer f.Close()\n\n    records, err := csv.NewReader(f).ReadAll()\n    if err != nil {\n        return nil, fmt.Errorf(\"reading records: %v\", err)\n    }\n    if len(records) == 0 {\n        return nil, errors.New(\"no records to process\")\n    }\n\n    var (\n        b    bytes.Buffer\n        cmds []string\n        keys = records[0]\n        vals = make(map[string]string, len(keys))\n    )\n\n    for _, rec := range records[1:] {\n        for k, v := range rec {\n            vals[keys[k]] = v\n        }\n        if err := t.Execute(&amp;b, vals); err != nil {\n            return nil, fmt.Errorf(\"executing template: %v\", err)\n        }\n        for _, s := range strings.Split(b.String(), \";\") {\n            if cmd := strings.TrimSpace(s); cmd != \"\" {\n                cmds = append(cmds, cmd)\n            }\n        }\n        b.Reset()\n    }\n    return cmds, nil\n}\n</code></pre>\n\n<p><strong>Edit:</strong> Thanks for all the suggestions so far! My question was flagged as being too broad, so I have some specific questions regarding my example.</p>\n\n<ol>\n<li>Would a test table be useful in a function like this? And, if so, would the test struct need to include the returned <code>cmds</code> string slice <em>and</em> the value of <code>err</code>? For example:</li>\n</ol>\n\n<pre><code>type tmplTest struct {\n    name     string   // test name\n    tmpl     string   // the text template\n    filename string   // CSV file with template values\n    expected []string // expected configuration commands\n    err      error    // expected error\n}\n</code></pre>\n\n<ol start=\"2\">\n<li>How do you handle errors that are <em>supposed</em> to be returned for specific test cases? For example, <code>os.Open()</code> returns an error of type <code>*PathError</code> if an error is encountered. How do I initialize a <code>*PathError</code> that is equivalent to the one returned by <code>os.Open()</code>? Same idea for <code>template.Parse()</code>, <code>template.Execute()</code>, etc.</li>\n</ol>\n\n<p><strong>Edit 2:</strong> Below is a test function I came up with. My two question from the first edit still stand.</p>\n\n<pre><code>package cmd\n\nimport (\n    \"testing\"\n    \"strings\"\n    \"path/filepath\"\n)\n\ntype tmplTest struct {\n    name     string   // test name\n    tmpl     string   // text template to execute\n    filename string   // CSV containing template text values\n    cmds     []string // expected configuration commands\n}\n\nvar tests = []tmplTest{\n    {\"empty_error\", ``, \"\", nil},\n    {\"file_error\", ``, \"fake_file.csv\", nil},\n    {\"file_empty_error\", ``, \"empty.csv\", nil},\n    {\"file_fmt_error\", ``, \"fmt_err.csv\", nil},\n    {\"template_fmt_error\", `{{ }{{`, \"test_values.csv\", nil},\n    {\"template_key_error\", `{{.InvalidKey}}`, \"test_values.csv\", nil},\n}\n\nfunc TestGenerateCmds(t *testing.T) {\n    for _, tc := range tests {\n        t.Run(tc.name, func(t *testing.T) {\n            cmds, err := generateCmds(tc.tmpl, filepath.Join(\"testdata\", tc.filename))\n            if err != nil {\n                // Unexpected error. Fail the test.\n                if !strings.Contains(tc.name, \"error\") {\n                    t.Fatal(err)\n                }\n                // TODO: Otherwise, check that the function failed at the expected point.\n            }\n            if tc.cmds == nil &amp;&amp; cmds != nil {\n                t.Errorf(\"expected no commands; got %d\", len(cmds))\n            }\n            if len(cmds) != len(tc.cmds) {\n                t.Errorf(\"expected %d commands; got %d\", len(tc.cmds), len(cmds))\n            }\n            for i := range cmds {\n                if cmds[i] != tc.cmds[i] {\n                    t.Errorf(\"expected %q; got %q\", tc.cmds[i], cmds[i])\n                }\n            }\n        })\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "rpc"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9946708"}, "edited": false, "score": 0, "creation_date": 1530744133, "post_id": 51181345, "comment_id": 89345299, "body": "Thanks. I dug up to the place where I saw the c.req.Params[0] = param line and saw its 8 years old."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 2, "last_activity_date": 1530742782, "creation_date": 1530742782, "answer_id": 51181345, "question_id": 51180914, "link": "https://stackoverflow.com/questions/51180914/how-to-pass-multiple-arguments-to-golang-net-rpc-call/51181345#51181345", "title": "How to pass multiple arguments to golang net rpc call", "body": "<p>The codec that Go's JSON RPC uses on top of the <code>rpc.Client</code> will take whatever param you send and encode that as the first element of the array it uses for the params.</p>\n\n<p>So the encoded request will always have a top level array with just one element, which will contain the params you sent, as you already noted.</p>\n\n<p>See the <code>WriteRequest</code> function here:</p>\n\n<p><a href=\"https://golang.org/src/net/rpc/jsonrpc/client.go#L57\" rel=\"nofollow noreferrer\">https://golang.org/src/net/rpc/jsonrpc/client.go#L57</a></p>\n\n<p>To achieve what you want, you can implement a custom <code>rpc.ClientCodec</code>.</p>\n\n<p>The interface is documented here:</p>\n\n<p><a href=\"https://golang.org/pkg/net/rpc/#ClientCodec\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/rpc/#ClientCodec</a></p>\n\n<p>You can borrow almost all of the implementation for the default JSON codec here:</p>\n\n<p><a href=\"https://golang.org/src/net/rpc/jsonrpc/client.go\" rel=\"nofollow noreferrer\">https://golang.org/src/net/rpc/jsonrpc/client.go</a></p>\n\n<p>And modify the <code>params</code> attribute of the request to read:</p>\n\n<pre><code>Params interface{} `json:\"params\"`\n</code></pre>\n\n<p>Then when writing your <code>WriteRequest</code> based on the standard one, you can just assign your params to the request params:</p>\n\n<pre><code>c.req.Params[0] = param\n</code></pre>\n\n<p>You can then use the <code>rpc.NewClientWithCodec</code> to create a client using your custom codec:</p>\n\n<p><a href=\"https://golang.org/pkg/net/rpc/#NewClientWithCodec\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/rpc/#NewClientWithCodec</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9946708"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 891, "favorite_count": 3, "accepted_answer_id": 51181345, "answer_count": 1, "score": 4, "last_activity_date": 1530742782, "creation_date": 1530739525, "question_id": 51180914, "link": "https://stackoverflow.com/questions/51180914/how-to-pass-multiple-arguments-to-golang-net-rpc-call", "title": "How to pass multiple arguments to golang net rpc call", "body": "<p>I am using net library in go and I want to make RPC call:</p>\n\n<pre><code>Client.Call(\"action\", []string{\"arg1\", \"arg2\"}, &amp;response)\n</code></pre>\n\n<p>But in JSON I see:</p>\n\n<pre><code>{\"method\":\"action\",\"params\":[[\"arg1\",\"arg2\"]],\"id\":0}\n</code></pre>\n\n<p>Notice that arguments are enclosed with double square brackets.</p>\n\n<p>In my case I need params to be a simple list:</p>\n\n<pre><code>{\"method\":\"action\",\"params\":[\"arg1\",\"arg2\"],\"id\":0}\n</code></pre>\n\n<p>Any ideas how to accomplish this?</p>\n"}, {"tags": ["json", "go", "hash", "redis", "redigo"], "answers": [{"comments": [{"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1530758038, "post_id": 51180317, "comment_id": 89347485, "body": "Actually  <code>c.JSON(200, hashMap)</code> also gives gibberish in the browser. It is worth mentioning that the dictionary are of Arabic words."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1530770507, "post_id": 51180317, "comment_id": 89350318, "body": "The presence of Arabic words will not produce gibberish.  What does <code>fmt.Printf(&quot;%#v\\n&quot;, hashMap)</code> print?"}, {"owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "edited": false, "score": 0, "creation_date": 1530818041, "post_id": 51180317, "comment_id": 89378565, "body": "Well, I realized I needed to convert the Marshaled json to string before sending it to browser: <code>s := string(jmap)</code> and then <code>c.JSON(200, s)</code>"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 7, "last_activity_date": 1530735935, "last_edit_date": 1530735935, "creation_date": 1530735427, "answer_id": 51180317, "question_id": 51180202, "link": "https://stackoverflow.com/questions/51180202/cannot-convert-string-map-to-json/51180317#51180317", "title": "Cannot convert string map to json", "body": "<p>The variable <code>jmap</code> is type <code>[]byte</code>. The call to JSON encoder in <code>c.JSON()</code> marshals <code>[]byte</code> as a base64 encoded string as you see in the output. </p>\n\n<p>To fix the problem, use one level of JSON encoding by passing the map directly to c.JSON:</p>\n\n<pre><code>hashMap, err := redis.StringMap(conn.Do(\"HGETALL\", MyDict))\nif err != nil {\n    // handle error\n}    \nm := make(map[string]string)\nfor k, v := range hashMap {\n    m[k] = v\n}\n\nc.JSON(200, m)\n</code></pre>\n\n<p>Because <code>hashMap</code> is a <code>map[string]string</code>, you can use it directly:</p>\n\n<pre><code>hashMap, err := redis.StringMap(conn.Do(\"HGETALL\", MyDict))\nif err != nil {\n    // handle error\n}    \nc.JSON(200, hashMap)\n</code></pre>\n"}], "owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 539, "favorite_count": 0, "accepted_answer_id": 51180317, "answer_count": 1, "score": 2, "last_activity_date": 1530735935, "creation_date": 1530734624, "question_id": 51180202, "link": "https://stackoverflow.com/questions/51180202/cannot-convert-string-map-to-json", "title": "Cannot convert string map to json", "body": "<p>I'd like to make a json out of a hash received from redis using <a href=\"https://github.com/gomodule/redigo\" rel=\"nofollow noreferrer\">redigo</a>:</p>\n\n<pre><code>func showHashtags(c *gin.Context) {\n    hashMap, err := redis.StringMap(conn.Do(\"HGETALL\", MyDict))\n    if err != nil {\n        fmt.Println(err)\n    }    \n    fmt.Println(hashMap) //works fine and shows the map \n\n    m := make(map[string]string)\n    for k, v := range hashMap {\n        m[k] = v\n    }\n\n    jmap, _ := json.Marshal(m)\n    c.JSON(200, jmap)\n}\n</code></pre>\n\n<p>However the result in browser is gibberish like:</p>\n\n<pre><code>\"eyIgIjoiMiIsIjExX9iq24zYsSAiOiIxIiwiQWxsNFJhbWluICI6IjEiLCJCSUhFICI6IjMiLCJCVFNBUk1ZICI6IjIiLCJDTUJZTiAiOiIxI....\n</code></pre>\n\n<p>What is wrong here? How can I fix it? </p>\n"}, {"tags": ["go", "reverse-proxy"], "answers": [{"tags": [], "owner": {"reputation": 6415, "user_id": 1416525, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f23f148b7241e345a61d193ed205685?s=128&d=identicon&r=PG", "display_name": "cdk", "link": "https://stackoverflow.com/users/1416525/cdk"}, "is_accepted": true, "score": 2, "last_activity_date": 1530735310, "creation_date": 1530735310, "answer_id": 51180308, "question_id": 51180142, "link": "https://stackoverflow.com/questions/51180142/what-configuration-am-i-missing-for-httputil-newsinglehostreverseproxy/51180308#51180308", "title": "What configuration am I missing for httputil.NewSingleHostReverseProxy?", "body": "<p>I made the following 2 changes to get it working:</p>\n\n<p>Firstly, point the proxy at <code>www.cnn.com</code> instead of <code>www.cnn.com/favicon.ico</code>. Of course, now we must make our request to <code>localhost:9090/favicon.ico</code>. </p>\n\n<p>Next, set the proxied request's <code>Host</code> field to the target host, not the host of the proxy which is <code>localhost</code>.</p>\n\n<p>The code ends up looking like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"net/http/httputil\"\n    \"net/url\"\n)\n\ntype Director func(*http.Request)\n\nfunc (f Director) Then(g Director) Director {\n    return func(req *http.Request) {\n        f(req)\n        g(req)\n    }\n}\n\nfunc hostDirector(host string) Director {\n    return func(req *http.Request) {\n        req.Host = host\n    }\n}\n\nfunc main() {\n    url, _ := url.Parse(\"http://www.cnn.com\")\n    proxy := httputil.NewSingleHostReverseProxy(url)\n\n    d := proxy.Director\n    // sequence the default director with our host director\n    proxy.Director = Director(d).Then(hostDirector(url.Hostname()))\n\n    http.Handle(\"/\", proxy)\n    log.Fatal(http.ListenAndServe(\":9090\", nil))\n}\n</code></pre>\n"}], "owner": {"reputation": 764, "user_id": 1405725, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/85157a97c87155b8ec2671e86aef1087?s=128&d=identicon&r=PG", "display_name": "Darian311", "link": "https://stackoverflow.com/users/1405725/darian311"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 51180308, "answer_count": 1, "score": 1, "last_activity_date": 1530735310, "creation_date": 1530734255, "question_id": 51180142, "link": "https://stackoverflow.com/questions/51180142/what-configuration-am-i-missing-for-httputil-newsinglehostreverseproxy", "title": "What configuration am I missing for httputil.NewSingleHostReverseProxy?", "body": "<p>The code below produces the error further below. When I type \"<a href=\"http://www.cnn.com/favicon.ico\" rel=\"nofollow noreferrer\">http://www.cnn.com/favicon.ico</a>\" straight into any browser it works without issue.  I am guessing that I am missing some critical configuration for the reverse proxy.   What is the minimum config needed for getting this to work?</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"net/http/httputil\"\n    \"net/url\"\n    \"log\"\n)\n\nfunc main(){\n    url, _ := url.Parse(\"http://www.cnn.com/favicon.ico\")\n    proxy := httputil.NewSingleHostReverseProxy(url)\n    http.HandleFunc(\"/\", proxy.ServeHTTP)\n    log.Fatal(http.ListenAndServe(\":9090\", nil))\n}\n</code></pre>\n\n<blockquote>\n  <p>Fastly error: unknown domain: localhost. Please check that this domain\n  has been added to a service.</p>\n  \n  <p>Details: cache-lax8625-LAX</p>\n</blockquote>\n\n<p>Happy 4th of July! </p>\n"}, {"tags": ["go", "channel", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 4, "last_activity_date": 1530735428, "creation_date": 1530735428, "answer_id": 51180318, "question_id": 51180089, "link": "https://stackoverflow.com/questions/51180089/receiving-values-from-channels-in-go/51180318#51180318", "title": "Receiving values from channels in Go", "body": "<p>Do you mean this line?</p>\n\n<pre><code>x, y := &lt;-c, &lt;-c\n</code></pre>\n\n<p>That's a \"tuple assignment\".</p>\n\n<p>In this case, it would be equivalent to doing:</p>\n\n<pre><code>x := &lt;-c\ny := &lt;-c\n</code></pre>\n\n<p>So the second value read from <code>c</code> would be assigned to <code>y</code>.</p>\n\n<p>You can read more about it here:</p>\n\n<p><a href=\"https://golang.org/ref/spec#Assignments\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Assignments</a></p>\n\n<p>About the order in which the values are actually written to <code>c</code>, since two independent goroutines are being triggered here:</p>\n\n<pre><code>go sum(s[:len(s)/2], c)\ngo sum(s[len(s)/2:], c)\n</code></pre>\n\n<p>The order in which they end up processing and writing to <code>c</code> is not \"guaranteed\", so you can expect either one of the values be assigned to <code>x</code> and <code>y</code> in different runs.</p>\n\n<p>Since the values are being added to calculate the final result, this is not a problem in this case.</p>\n"}], "owner": {"reputation": 517, "user_id": 9956279, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iStX1.jpg?s=128&g=1", "display_name": "Sushilinux", "link": "https://stackoverflow.com/users/9956279/sushilinux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 0, "accepted_answer_id": 51180318, "answer_count": 1, "score": 0, "last_activity_date": 1530735428, "creation_date": 1530733935, "question_id": 51180089, "link": "https://stackoverflow.com/questions/51180089/receiving-values-from-channels-in-go", "title": "Receiving values from channels in Go", "body": "<p>Why doesn't the last result returned from <code>go sum(s[len(s)/2:], c)</code>(the second one) be assigned to <code>x</code>?\nThe two <code>&lt;-c</code>s confuse me.\nThis code is from <a href=\"https://tour.golang.org/concurrency/2\" rel=\"nofollow noreferrer\">A Tour of Go - [Channels]</a>.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc sum(s []int, c chan int) {   // int is the return value type\n  sum := 0\n  for _, v := range s {\n    sum += v\n  }\n  c &lt;- sum // Sends sum to c\n}\n\nfunc main() {\n  s := []int{7, 2, 8, -9, 4, 0}\n\n  c := make(chan int)\n  go sum(s[:len(s)/2], c)\n  go sum(s[len(s)/2:], c)\n\n  x, y := &lt;-c, &lt;-c                 // receive from c\n\n  fmt.Println(x, y, x+y)\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 2, "creation_date": 1530735093, "post_id": 51179588, "comment_id": 89342920, "body": "Presumably you&#39;d use <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo/findopt#FindBundle.Sort\" rel=\"nofollow noreferrer\"><code>findopt.Sort</code></a> to build options for <code>Find</code>. Unfortunately, it takes an <code>interface{}</code> argument, the documentation says nothing useful, and there are no examples in the documentation or GitHub."}], "answers": [{"comments": [{"owner": {"reputation": 449, "user_id": 7623709, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3b869731c724b20a6dd447a3f87121e6?s=128&d=identicon&r=PG&f=1", "display_name": "mike", "link": "https://stackoverflow.com/users/7623709/mike"}, "edited": false, "score": 8, "creation_date": 1530779520, "post_id": 51181206, "comment_id": 89355218, "body": "Not being straightforward is an understatement. It&#39;s total rubbish"}, {"owner": {"reputation": 561, "user_id": 522915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4c96d965519bcb39f42401ff75d807ae?s=128&d=identicon&r=PG", "display_name": "cyang", "link": "https://stackoverflow.com/users/522915/cyang"}, "edited": false, "score": 1, "creation_date": 1563808670, "post_id": 51181206, "comment_id": 100813531, "body": "This one is deprecated. Use <code>options.Find()</code> instead."}], "tags": [], "owner": {"reputation": 1944, "user_id": 4120554, "user_type": "registered", "accept_rate": 73, "profile_image": "https://lh5.googleusercontent.com/-RKmmNTC8iUo/AAAAAAAAAAI/AAAAAAAAAGs/oQQp9tU-Zb4/photo.jpg?sz=128", "display_name": "Marco Talento", "link": "https://stackoverflow.com/users/4120554/marco-talento"}, "is_accepted": true, "score": 6, "last_activity_date": 1530741701, "creation_date": 1530741701, "answer_id": 51181206, "question_id": 51179588, "link": "https://stackoverflow.com/questions/51179588/how-to-sort-and-limit-results-in-mongodb/51181206#51181206", "title": "How to &quot;sort&quot; and &quot;limit&quot; results in mongodb?", "body": "<p>The official driver is not straightforward as <code>mgo</code>. You can do sort and limit using the <code>findopt.Limit</code> and <code>findopt.Sort</code>.</p>\n\n<p>You can see examples from the official repository.</p>\n\n<p><a href=\"https://github.com/mongodb/mongo-go-driver/blob/5fea1444e52844a15513c0d9490327b2bd89ed7c/mongo/crud_spec_test.go#L364\" rel=\"noreferrer\">https://github.com/mongodb/mongo-go-driver/blob/5fea1444e52844a15513c0d9490327b2bd89ed7c/mongo/crud_spec_test.go#L364</a></p>\n"}, {"tags": [], "owner": {"reputation": 452, "user_id": 4334369, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/164mz.jpg?s=128&g=1", "display_name": "sieberts", "link": "https://stackoverflow.com/users/4334369/sieberts"}, "is_accepted": false, "score": 3, "last_activity_date": 1542022116, "creation_date": 1542022116, "answer_id": 53261221, "question_id": 51179588, "link": "https://stackoverflow.com/questions/51179588/how-to-sort-and-limit-results-in-mongodb/53261221#53261221", "title": "How to &quot;sort&quot; and &quot;limit&quot; results in mongodb?", "body": "<p>The sort-option apparently requires you to add a <code>map[string]interface{}</code> where you can specify a field as key and a sortOrder as value (where 1 means ascending and -1 means descending) as following:</p>\n\n<pre><code>sortMap := make(map[string]interface{})\nsortMap[\"version\"] = 1\nopt := findopt.Sort(sortMap)\n</code></pre>\n\n<p>As far as I can see this means that you are only able to properly sort results by one sortField because keys in a go map are stored in a random order.</p>\n"}, {"tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": false, "score": 18, "last_activity_date": 1561084722, "last_edit_date": 1561084722, "creation_date": 1542933050, "answer_id": 53439401, "question_id": 51179588, "link": "https://stackoverflow.com/questions/51179588/how-to-sort-and-limit-results-in-mongodb/53439401#53439401", "title": "How to &quot;sort&quot; and &quot;limit&quot; results in mongodb?", "body": "<p>In the current version <a href=\"https://github.com/mongodb/mongo-go-driver/releases/tag/v1.0.3\" rel=\"noreferrer\">mongo-go-driver v1.0.3</a>, the options are simplified. For example to perform find, sort and limit: </p>\n\n<pre><code>import (\n\"go.mongodb.org/mongo-driver/bson\"\n\"go.mongodb.org/mongo-driver/mongo\"\n\"go.mongodb.org/mongo-driver/mongo/options\"\n)\n\noptions := options.Find()\n\n// Sort by `_id` field descending\noptions.SetSort(bson.D{{\"_id\", -1}})\n\n// Limit by 10 documents only \noptions.SetLimit(10)\n\ncursor, err := collection.Find(context.Background(), bson.D{}, options)\n</code></pre>\n\n<p>See more available options on <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo/options\" rel=\"noreferrer\">godoc.org/go.mongodb.org/mongo-driver/mongo/options</a>. Especially <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo/options#FindOptions\" rel=\"noreferrer\">FindOptions</a> for all possible options for <code>Find()</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 199, "user_id": 6285363, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/398a2405e7f5f1551f418be7b2376497?s=128&d=identicon&r=PG&f=1", "display_name": "Mendo", "link": "https://stackoverflow.com/users/6285363/mendo"}, "is_accepted": false, "score": 5, "last_activity_date": 1559550085, "last_edit_date": 1559550085, "creation_date": 1559549736, "answer_id": 56423466, "question_id": 51179588, "link": "https://stackoverflow.com/questions/51179588/how-to-sort-and-limit-results-in-mongodb/56423466#56423466", "title": "How to &quot;sort&quot; and &quot;limit&quot; results in mongodb?", "body": "<p>You can use</p>\n\n<pre><code>findOptions := options.Find()\nfindOptions.SetLimit(2)\nfindOptions.SetSkip(2)\n...\ncursor, err := collection.Find(context.Background(), bson.M{}, findOptions)\n</code></pre>\n\n<p>resource at <a href=\"https://www.mongodb.com/blog/post/mongodb-go-driver-tutorial\" rel=\"noreferrer\">https://www.mongodb.com/blog/post/mongodb-go-driver-tutorial</a></p>\n"}, {"tags": [], "owner": {"reputation": 641, "user_id": 4046647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JRueZ.png?s=128&g=1", "display_name": "jianyongli", "link": "https://stackoverflow.com/users/4046647/jianyongli"}, "is_accepted": false, "score": 4, "last_activity_date": 1560145540, "creation_date": 1560145540, "answer_id": 56521060, "question_id": 51179588, "link": "https://stackoverflow.com/questions/51179588/how-to-sort-and-limit-results-in-mongodb/56521060#56521060", "title": "How to &quot;sort&quot; and &quot;limit&quot; results in mongodb?", "body": "<p>you need import \"github.com/mongodb/mongo-go-driver/options\" package to build a <code>findOptions</code>. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import github.com/mongodb/mongo-go-driver/options\n\nfindOptions := options.Find() // build a `findOptions`\nfindOptions.SetSort(map[string]int{\"when\": -1}) // reverse order by `when`\nfindOptions.SetSkip(0) // skip whatever you want, like `offset` clause in mysql\nfindOptions.SetLimit(10) // like `limit` clause in mysql\n\n// apply findOptions\ncur, err := collection.Find(context.TODO(), bson.D{}, findOptions)\n// resolve err\n\nfor cur.Next(context.TODO()) {\n   // call cur.Decode()\n}\n\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "is_accepted": false, "score": 1, "last_activity_date": 1573064546, "creation_date": 1573064546, "answer_id": 58736354, "question_id": 51179588, "link": "https://stackoverflow.com/questions/51179588/how-to-sort-and-limit-results-in-mongodb/58736354#58736354", "title": "How to &quot;sort&quot; and &quot;limit&quot; results in mongodb?", "body": "<p>ONE LINE OPTION</p>\n\n<p>I know there is already a lot of answers but <strong>you can do it as one line</strong> (if you need it for any case of yours)</p>\n\n<pre><code>// From the Doc\n// func (f *FindOptions) SetSort(sort interface{}) *FindOptions\n\ncursor, err := collection.Find(context.Background(), bson.M{}, options.Find().SetSort(map[string]int{\"when\": -1}).SetLimit(10))\n</code></pre>\n\n<p><em>SetSort() and the others</em> currently returns the parent pointer itself</p>\n"}], "owner": {"reputation": 449, "user_id": 7623709, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3b869731c724b20a6dd447a3f87121e6?s=128&d=identicon&r=PG&f=1", "display_name": "mike", "link": "https://stackoverflow.com/users/7623709/mike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12175, "favorite_count": 3, "accepted_answer_id": 51181206, "answer_count": 6, "score": 13, "last_activity_date": 1573064546, "creation_date": 1530730667, "question_id": 51179588, "link": "https://stackoverflow.com/questions/51179588/how-to-sort-and-limit-results-in-mongodb", "title": "How to &quot;sort&quot; and &quot;limit&quot; results in mongodb?", "body": "<p>I'm trying to execute a query with \"sort\" and \"limit\". With <a href=\"https://github.com/go-mgo/mgo\" rel=\"noreferrer\">mgo</a> you could do  <code>Find(nil).Sort(\u201c-when\u201d).Limit(10)</code> but the <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo\" rel=\"noreferrer\">new, official mongo driver</a> has no such methods. How can I sort and \"limit\" with the new driver?</p>\n"}, {"tags": ["json", "go", "mqtt", "unmarshalling"], "comments": [{"owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "edited": false, "score": 1, "creation_date": 1530727754, "post_id": 51178987, "comment_id": 89340578, "body": "Can you print and share <code>msg.Payload()</code> and people can check if it is a valid and <b>one</b> Json object."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1530727780, "post_id": 51178987, "comment_id": 89340586, "body": "Since you are passing a slice of <code>Data</code> but it is an object first. use <code>Data</code> struct not slice"}], "answers": [{"comments": [{"owner": {"reputation": 347, "user_id": 4206183, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/896dd7976b1309d64c083c238d8fb710?s=128&d=identicon&r=PG&f=1", "display_name": "Melissa", "link": "https://stackoverflow.com/users/4206183/melissa"}, "edited": false, "score": 0, "creation_date": 1530729776, "post_id": 51179040, "comment_id": 89341309, "body": "I added two more elements to my struct : <code>Actuator string json:&quot;actuator&quot;</code> and <code>Blink []string json: &quot;blink&quot;</code> to accommodate for the second JSON object. However when I do <code>fmt.Println(sensorData)</code>, I get <code>{DHT22 [22.9 22.9 22.9] [51.3 51.2 51.2]  []}</code> <code>{ [] [] arduinoLED [false false false]}</code>. It seems there are only four elements in each object but my struct has 5 parameters? Do you know why this is?"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 347, "user_id": 4206183, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/896dd7976b1309d64c083c238d8fb710?s=128&d=identicon&r=PG&f=1", "display_name": "Melissa", "link": "https://stackoverflow.com/users/4206183/melissa"}, "edited": false, "score": 0, "creation_date": 1530730314, "post_id": 51179040, "comment_id": 89341506, "body": "@Melissa, try printing it like this to get the field names as well for easier debugging (note the plus sign): fmt.Printf(&quot;%+v\\n&quot;, sensorData)"}, {"owner": {"reputation": 347, "user_id": 4206183, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/896dd7976b1309d64c083c238d8fb710?s=128&d=identicon&r=PG&f=1", "display_name": "Melissa", "link": "https://stackoverflow.com/users/4206183/melissa"}, "edited": false, "score": 0, "creation_date": 1530730726, "post_id": 51179040, "comment_id": 89341635, "body": "I get this: <code>{Sensor:DHT22 Temperature:[22.8 22.8 22.8] Humidity:[51.3 51.1 51] Actuator: Blink:[]}</code> <code>{Sensor: Temperature:[] Humidity:[] Actuator:arduinoLED Blink:[false false false]}</code>"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 347, "user_id": 4206183, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/896dd7976b1309d64c083c238d8fb710?s=128&d=identicon&r=PG&f=1", "display_name": "Melissa", "link": "https://stackoverflow.com/users/4206183/melissa"}, "edited": false, "score": 1, "creation_date": 1530730902, "post_id": 51179040, "comment_id": 89341683, "body": "ok, your five fields are listed on each object you are printing, right? In the first one only &quot;Sensor&quot;, &quot;Temperature&quot; and &quot;Humidity&quot; have values (the other two are blank), in the second one the opposite is true (Actuator and Blink have values, the other three are blank). It looks like the expected behavior."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 2, "last_activity_date": 1530727950, "last_edit_date": 1530727950, "creation_date": 1530727646, "answer_id": 51179040, "question_id": 51178987, "link": "https://stackoverflow.com/questions/51178987/unmarshal-json-object-published-over-mqtt-in-go/51179040#51179040", "title": "Unmarshal JSON object published over MQTT in Go", "body": "<p><strong>Slice vs single object</strong></p>\n\n<p>You are declaring a slice:</p>\n\n<pre><code>var sensorData []Data\n</code></pre>\n\n<p>But then your payload is not an array but rather only one object:</p>\n\n<pre><code>{'sensor': 'DHT22', 'temperature': [22.7, 22.7, 22.8], 'humidity': [51.9, 52.0, 52.0]}\n</code></pre>\n\n<p>So that error message is telling you it cannot unmarshal a single object as a slice.</p>\n\n<p>Try changing that declaration to:</p>\n\n<pre><code>var sensorData Data\n</code></pre>\n\n<p>Then, instead of iterating over it, you need to just check that one instance of the data.</p>\n\n<p><strong>Additional mismatches between the payload and the struct type</strong></p>\n\n<p>After that, you'll probably get another error since the <code>temperature</code> and <code>humidity</code> array seem to contain decimal numbers:</p>\n\n<pre><code>`{'sensor': 'DHT22', 'temperature': [22.7, 22.7, 22.8], 'humidity': [51.9, 52.0, 52.0]`\n</code></pre>\n\n<p>But you are declaring those as <code>int</code> slices in your code:</p>\n\n<pre><code>Temp []int           `json: \"temperature\"`\nHum []int           `json: \"humidity\"`\n</code></pre>\n\n<p>So you'll need to change those to be <code>[]float64</code></p>\n\n<p><strong>Differentiating the two different payloads</strong></p>\n\n<p>About differentiating the two object types, it'd be better if you try to do that, but even if you don't, Go's <code>json</code> library will ignore problems if field names do not match, so what will happen is that when de-serializing your <code>actuator</code> payloads into <code>Data</code>, all fields will have their default values, but no error will be received.</p>\n\n<p>This check will probably throw a <code>panic</code>, cause the array will be empty in that case:</p>\n\n<pre><code>if i.Temp[2] &gt; 20\n</code></pre>\n\n<p>One \"hacky\" way of solving this issue would be to only process the data if the <code>sensor</code> field is not a blank string.</p>\n\n<p>Assuming you always receive a sensor name in the <code>sensor</code> messages, the only case when that will result in an empty string is if you just processed one of the other messages.</p>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 1, "last_activity_date": 1530728231, "creation_date": 1530728231, "answer_id": 51179154, "question_id": 51178987, "link": "https://stackoverflow.com/questions/51178987/unmarshal-json-object-published-over-mqtt-in-go/51179154#51179154", "title": "Unmarshal JSON object published over MQTT in Go", "body": "<p>There are two main reasons for your error One is you have <code>float</code> value for temperature and humidity but you are passing slice of <code>int</code></p>\n\n<pre><code>type Data struct {\n    Sensor string        `json:\"sensor\"`\n    Temp []int           `json: \"temperature\"` // this should be []float64\n    Hum []int           `json: \"humidity\"` // this should be []float64\n}\n</code></pre>\n\n<p>Other is there are two objects in <code>msg.Payload</code> which is not a slice of <code>Data</code> struct. Working code.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Data struct {\n    Sensor string    `json:\"sensor\"`\n    Temp   []float64 `json:\"temperature\"`\n    Hum    []float64 `json:\"humidity\"`\n}\n\nfunc main() {\n    bytes := []byte(`{\n        \"sensor\": \"DHT22\", \n        \"temperature\": [22.7, 22.7, 22.8], \n        \"humidity\": [51.9, 52.0, 52.0]\n    }`)\n\n    var sensorData Data\n    if err := json.Unmarshal(bytes, &amp;sensorData); err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(sensorData)\n\n}\n</code></pre>\n\n<p>Check working code on <a href=\"https://play.golang.org/p/gontMGnCkuX\" rel=\"nofollow noreferrer\">Go playground</a></p>\n"}], "owner": {"reputation": 347, "user_id": 4206183, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/896dd7976b1309d64c083c238d8fb710?s=128&d=identicon&r=PG&f=1", "display_name": "Melissa", "link": "https://stackoverflow.com/users/4206183/melissa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 845, "favorite_count": 0, "accepted_answer_id": 51179040, "answer_count": 2, "score": 4, "last_activity_date": 1553776418, "creation_date": 1530727445, "last_edit_date": 1553776418, "question_id": 51178987, "link": "https://stackoverflow.com/questions/51178987/unmarshal-json-object-published-over-mqtt-in-go", "title": "Unmarshal JSON object published over MQTT in Go", "body": "<p>I am receiving sensor data over MQTT. I want to check if the temperature is over 20 degrees, and if it is, send a message. </p>\n\n<pre><code>var f MQTT.MessageHandler = func(client MQTT.Client, msg MQTT.Message) {\n    type Data struct {\n        Sensor string        `json:\"sensor\"`\n        Temp []int           `json: \"temperature\"`\n        Hum []int           `json: \"humidity\"`\n    }\n    var sensorData []Data\n    message := \"\"\n    err := json.Unmarshal(msg.Payload(), &amp;sensorData)\n    if err != nil {\n        panic(err)\n    }else {\n\n    //access certain element in the Data struct\n        for _, i := range sensorData {\n            if i.Temp[2] &gt; 20 { //where the temperature is stored\n                fmt.Println(\"Temperature too high\")\n                message = \"Temperature too high\"\n            }else{\n                fmt.Println(\"Perfect temperature\")\n                message = \"Perfect temperature\"\n        }\n    }\n\n    }\n\n    // Publish further instructions to \"sensor/instruction\"\n    token := client.Publish(\"sensor/instruction\", 0, false, message)\n    token.Wait()\n}\n</code></pre>\n\n<p>Currently I am publishing <strong>two</strong> JSON objects to be received. I think part of the problem is distinguishing between the two objects. This is the error I am getting <code>panic: json: cannot unmarshal object into Go value of type []main.Data</code>. These are the JSON objects I am publishing to a topic: </p>\n\n<pre><code>{'sensor': 'DHT22', 'temperature': [22.7, 22.7, 22.8], 'humidity': [51.9, 52.0, 52.0]}\n{'actuator': 'arduinoLED', 'blink': ['false', 'false', 'false']}\n</code></pre>\n\n<p>The <code>msg.Payload()</code> gives </p>\n\n<pre><code>{\"sensor\": \"DHT22\", \"temperature\": [22.9, 22.9, 22.9], \"humidity\": [50.9, 50.9, 50.9]}\n{\"actuator\": \"arduinoLED\", \"blink\": [\"false\", \"false\", \"false\"]\n</code></pre>\n\n<p>These objects are published constantly in a <strong>loop</strong>. I want to unmarshal the first object and access a specific element. </p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "is_accepted": true, "score": 5, "last_activity_date": 1530716346, "creation_date": 1530716346, "answer_id": 51176515, "question_id": 51176238, "link": "https://stackoverflow.com/questions/51176238/how-do-you-explicitly-find-a-record-where-a-field-is-null/51176515#51176515", "title": "How do you explicitly find a record where a field is NULL?", "body": "<p>According to the docs, this should work:</p>\n\n<pre><code>db.Where(\"owner_id IS NULL\").Find(&amp;dogs)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1201, "user_id": 5097493, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/95b290a191545edb4077adfaab317f1a?s=128&d=identicon&r=PG&f=1", "display_name": "RuNpiXelruN", "link": "https://stackoverflow.com/users/5097493/runpixelrun"}, "is_accepted": false, "score": 0, "last_activity_date": 1536181772, "last_edit_date": 1536181772, "creation_date": 1536156982, "answer_id": 52187335, "question_id": 51176238, "link": "https://stackoverflow.com/questions/51176238/how-do-you-explicitly-find-a-record-where-a-field-is-null/52187335#52187335", "title": "How do you explicitly find a record where a field is NULL?", "body": "<p>You were close in your original attempt. You can also achieve your desired result by writing the query as below.</p>\n\n<pre><code>db.Where(\"owner_id = ?\", \"NULL\").Find(&amp;dogs)\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 6731026, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48468f31924f93308db1bbcbba5474bb?s=128&d=identicon&r=PG&f=1", "display_name": "pdube", "link": "https://stackoverflow.com/users/6731026/pdube"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 923, "favorite_count": 0, "accepted_answer_id": 51176515, "answer_count": 2, "score": 4, "last_activity_date": 1536181772, "creation_date": 1530715387, "last_edit_date": 1530720598, "question_id": 51176238, "link": "https://stackoverflow.com/questions/51176238/how-do-you-explicitly-find-a-record-where-a-field-is-null", "title": "How do you explicitly find a record where a field is NULL?", "body": "<p>From the <a href=\"http://gorm.io/docs/query.html#Struct-amp-Map\" rel=\"nofollow noreferrer\">documentation</a>:</p>\n\n<blockquote>\n  <p>When query with struct, GORM will only query with those fields has non-zero value, that means if your field\u2019s value is 0, '', false or other zero values, it won\u2019t be used to build query conditions.</p>\n</blockquote>\n\n<p>Here is an example of what I am trying to do :</p>\n\n<pre><code>type Dog struct {\n  ID uuid.UUID\n  OwnerID *uuid.UUID\n}\n</code></pre>\n\n<p>The owner ID pointer may be nil.</p>\n\n<pre><code>db.Where(\"owner_id\", nil).Find(&amp;dogs)\n</code></pre>\n\n<p>But that returns all dogs (I expected this from the doc). I tried doing:</p>\n\n<pre><code>db.Where(\"owner_id\", \"NULL\").Find(&amp;dogs)\n</code></pre>\n\n<p>But that returns an empty list.</p>\n\n<p>Is there a way to explicitly search for a <code>NULL</code> value field?</p>\n"}, {"tags": ["http", "authentication", "go", "proxy"], "comments": [{"owner": {"reputation": 262, "user_id": 2451543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a8dc15e5b8b6a52475213fc15d059929?s=128&d=identicon&r=PG", "display_name": "Eelco", "link": "https://stackoverflow.com/users/2451543/eelco"}, "edited": false, "score": 0, "creation_date": 1530715841, "post_id": 51175487, "comment_id": 89335430, "body": "You are adding the authorization header to the response, not to the request."}], "answers": [{"tags": [], "owner": {"reputation": 596, "user_id": 5240559, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/7f3e629e8218ac26b2534deea627af27?s=128&d=identicon&r=PG&f=1", "display_name": "facumedica", "link": "https://stackoverflow.com/users/5240559/facumedica"}, "is_accepted": true, "score": 4, "last_activity_date": 1530716588, "last_edit_date": 1530716588, "creation_date": 1530715868, "answer_id": 51176368, "question_id": 51175487, "link": "https://stackoverflow.com/questions/51175487/go-http-proxy-with-auth/51176368#51176368", "title": "Go http proxy with auth", "body": "<p>You are trying to add a header to a response, which isn't what you send to the server but what you receive. You have to add headers and data to the request, which you have to assemble first and then execute it like this:</p>\n\n<pre><code>data := url.Values{} // the form data\ndata.Add(\"foo-key\", \"some data\")\nreq, err := http.NewRequest(\"POST\",\"https://yoururl\", strings.NewReader(data.Encode()))\nauth := \"username:password\"\nbasicAuth := \"Basic \" + base64.StdEncoding.EncodeToString([]byte(auth))\nreq.Header.Add(\"Proxy-Authorization\", basicAuth)\nreq.Header.Add(\"Content-Type\", \"application/x-www-form-urlencoded\")\nresp, err := bot.Client.Do(req)\n</code></pre>\n\n<p>Then you just use the response (<code>resp</code>)</p>\n"}, {"tags": [], "owner": {"reputation": 427, "user_id": 6254868, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-coh80Kgp5wI/AAAAAAAAAAI/AAAAAAAAAEM/YAQYO15Emg0/photo.jpg?sz=128", "display_name": "\u041e\u043b\u0435\u0433 \u0421\u0438\u0434\u043e\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/6254868/%d0%9e%d0%bb%d0%b5%d0%b3-%d0%a1%d0%b8%d0%b4%d0%be%d1%80%d0%be%d0%b2"}, "is_accepted": false, "score": 0, "last_activity_date": 1530772102, "creation_date": 1530772102, "answer_id": 51184615, "question_id": 51175487, "link": "https://stackoverflow.com/questions/51175487/go-http-proxy-with-auth/51184615#51184615", "title": "Go http proxy with auth", "body": "<p>Thanks to all!</p>\n\n<p>I found such a solution (may be it would be useful to someone):</p>\n\n<pre><code>// Uncomment to use proxy with auth\n    /*\n    proxyStr := \"http://proxy.com:3128\"\n    proxyURL, _ := url.Parse(proxyStr)\n    auth := \"username:password\"\n    basicAuth := \"Basic \" + base64.StdEncoding.EncodeToString([]byte(auth))\n    hdr := http.Header{}\n    hdr.Add(\"Proxy-Authorization\", basicAuth)\n    transport := &amp;http.Transport{\n        Proxy: http.ProxyURL(proxyURL),\n        ProxyConnectHeader: hdr,\n    }\n\n    bot.Client = &amp;http.Client{\n        Transport: transport,\n    }\n    */\n\n    resp, err := bot.Client.PostForm(method, params)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 348, "user_id": 6321206, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t7rEQ.jpg?s=128&g=1", "display_name": "Andrii Soluk", "link": "https://stackoverflow.com/users/6321206/andrii-soluk"}, "is_accepted": false, "score": 4, "last_activity_date": 1592126070, "creation_date": 1592126070, "answer_id": 62370543, "question_id": 51175487, "link": "https://stackoverflow.com/questions/51175487/go-http-proxy-with-auth/62370543#62370543", "title": "Go http proxy with auth", "body": "<p>You can create the client once by using the following code. Then substitute your HTTP client in the third-party package.</p>\n\n<pre><code>&amp;http.Client{\n  Transport: &amp;http.Transport{\n    Proxy: http.ProxyURL(&amp;url.URL{\n      Scheme: \"http\",\n      User:   url.UserPassword(\"username\", \"password\"),\n      Host:   \"146.137.9.45:65233\",\n    })\n  }\n}\n</code></pre>\n\n<p>or you can parse the URL as well</p>\n\n<pre><code>url, _ := url.Parse(\"http://username:password@146.137.9.45:65233\")\n&amp;http.Client{\n  Transport: &amp;http.Transport{\n    Proxy: http.ProxyURL(url),\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 427, "user_id": 6254868, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh5.googleusercontent.com/-coh80Kgp5wI/AAAAAAAAAAI/AAAAAAAAAEM/YAQYO15Emg0/photo.jpg?sz=128", "display_name": "\u041e\u043b\u0435\u0433 \u0421\u0438\u0434\u043e\u0440\u043e\u0432", "link": "https://stackoverflow.com/users/6254868/%d0%9e%d0%bb%d0%b5%d0%b3-%d0%a1%d0%b8%d0%b4%d0%be%d1%80%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4287, "favorite_count": 1, "accepted_answer_id": 51176368, "answer_count": 3, "score": 3, "last_activity_date": 1592126070, "creation_date": 1530712755, "last_edit_date": 1530726712, "question_id": 51175487, "link": "https://stackoverflow.com/questions/51175487/go-http-proxy-with-auth", "title": "Go http proxy with auth", "body": "<p>I need to use a proxy with auth using PostForm method.\nIf I use something like (simplified):</p>\n\n<pre><code>request, err := http.NewRequest(\"GET\", url.String(), nil)\nresponse, err := client.Do(request)\n</code></pre>\n\n<p>I can with ease do <code>request.Header.Add(\"Proxy-Authorization\", basicAuth)</code> and it works fine. \nBut now, I am editing third-party package, and I try to add proxy to the existing code:</p>\n\n<pre><code>    proxyStr := \"http://proxy.com:8080\"\n    proxyURL, _ := url.Parse(proxyStr)\n\n    transport := &amp;http.Transport{\n        Proxy: http.ProxyURL(proxyURL),\n    }\n    bot.Client = &amp;http.Client{\n        Transport: transport,\n    }\n\n    resp, err := bot.Client.PostForm(method, params)\n\n    auth := \"username:password\"\n    basicAuth := \"Basic \" + base64.StdEncoding.EncodeToString([]byte(auth)) \n    resp.Header.Add(\"Proxy-Authorization\", basicAuth)\n</code></pre>\n\n<p>It does not work, and it fails, to my mind, at string <code>resp.Header.Add(\"Proxy-Authorization\", basicAuth)</code>.\nProxy without auth works fine, in this example.\nDoes anybody know, can I use proxy with auth in this case?</p>\n"}, {"tags": ["go", "utf-8"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1530712319, "post_id": 51175286, "comment_id": 89333357, "body": "Use <a href=\"https://godoc.org/golang.org/x/text/encoding\" rel=\"nofollow noreferrer\"><code>golang.org&#47;x&#47;text&#47;encoding</code></a>. Usage examples can be found <a href=\"https://godoc.org/golang.org/x/text/encoding?importers\" rel=\"nofollow noreferrer\">there</a> as well."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 4, "creation_date": 1530713527, "post_id": 51175286, "comment_id": 89334109, "body": "Probably you will have to detect the encoding during downloading (e.g. by inspecting the Content-Type or peeking into the HTML for appropriate meta tags) and then apply @kostix&#39;s advice."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1530713920, "post_id": 51175286, "comment_id": 89334325, "body": "The Go program copies the response bytes to a file as is.  There is no conversion to characters like  \ufffd by the Go program. That&#39;s something that your terminal or editor are doing. The fix is to add a conversion as noted in previous comments."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1530736465, "last_edit_date": 1530736465, "creation_date": 1530723835, "answer_id": 51178306, "question_id": 51175286, "link": "https://stackoverflow.com/questions/51175286/how-to-retrieve-a-webpage-with-go-and-convert-it-to-utf-8/51178306#51178306", "title": "How to retrieve a webpage with Go and convert it to UTF-8", "body": "<p>Something like:</p>\n\n<pre><code>import \"golang.org/x/text/encoding/charmap\"\n\nrdrBody := charmap.Windows1252.NewDecoder().Reader(resp.Body)\n_, err = io.Copy(out, rdrBody)\n\nrdrBody := charmap.ISO8859_1.NewDecoder().Reader(resp.Body)\n_, err = io.Copy(out, rdrBody)\n</code></pre>\n\n<p>There are many other<code>ISO8859</code>encodings in package <code>charmap</code>.</p>\n\n<hr>\n\n<p>A simple example of package <code>charmap.ISO8859_1</code> use:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"strings\"\n\n    \"golang.org/x/text/encoding/charmap\"\n)\n\nfunc main() {\n    resp, err := http.Get(\"http://example.com\")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    defer resp.Body.Close()\n\n    rdrBody := io.Reader(resp.Body)\n    contentType := strings.ToLower(resp.Header.Get(\"Content-Type\"))\n    if strings.Contains(contentType, \"charset=iso-8859-1\") {\n        rdrBody = charmap.ISO8859_1.NewDecoder().Reader(rdrBody)\n    }\n    body, err := ioutil.ReadAll(rdrBody)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    n := 256\n    if n &gt; len(body) {\n        n = len(body)\n    }\n    fmt.Println(string(body[:n]))\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 5270539, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-freqXtjdI_Y/AAAAAAAAAAI/AAAAAAAAAFo/GPY1pVAzmSA/photo.jpg?sz=128", "display_name": "Antonio Lima", "link": "https://stackoverflow.com/users/5270539/antonio-lima"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1530736465, "creation_date": 1530712178, "last_edit_date": 1530712242, "question_id": 51175286, "link": "https://stackoverflow.com/questions/51175286/how-to-retrieve-a-webpage-with-go-and-convert-it-to-utf-8", "title": "How to retrieve a webpage with Go and convert it to UTF-8", "body": "<p>I need to download some big html files (about 300k+). Everything is working fine, the problem is that some of the files comes with Windows-1252/ISO-8859 characters like \"\u00e1\" or \"\u00e7\" and when I save the document, Go converts it to characters like \ufffd. Any idea?</p>\n\n<p>My code as follow:</p>\n\n<pre><code>package main\n\nimport (\n  \"io\"\n  \"net/http\"\n  \"os\"\n)\n\nfunc main() {\n\n  pagina := \"http://www.mypage.com/doc?someparameters=123\"\n  err := DownloadFile(\"doc.html\", pagina)\n  if err != nil {\n    panic(err)\n  }\n\n}\n\nfunc DownloadFile(filepath string, url string) error {\n  out, err := os.Create(filepath)\n  if err != nil {\n    return err\n  }\n  defer out.Close()\n\n  resp, err := http.Get(url)\n  if err != nil {\n    return err\n  }\n  defer resp.Body.Close()\n\n  _, err = io.Copy(out, resp.Body)\n  if err != nil {\n    return err\n  }\n\n  return nil\n}\n</code></pre>\n"}, {"tags": ["json", "go", "protocol-buffers"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1530716383, "post_id": 51174852, "comment_id": 89335694, "body": "can we have the contents of the generated pb.go file?"}, {"owner": {"reputation": 292, "user_id": 3006344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e5bd75574303cf338529d605191d6f6?s=128&d=identicon&r=PG", "display_name": "Cajus Pollmeier", "link": "https://stackoverflow.com/users/3006344/cajus-pollmeier"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1530779485, "post_id": 51174852, "comment_id": 89355201, "body": "@RickyA currently wondering why I can&#39;t reproduce it with the snippet above which just doesn&#39;t contain the whole story of the project. Trying to find the reason... Will report back."}, {"owner": {"reputation": 292, "user_id": 3006344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e5bd75574303cf338529d605191d6f6?s=128&d=identicon&r=PG", "display_name": "Cajus Pollmeier", "link": "https://stackoverflow.com/users/3006344/cajus-pollmeier"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1530782581, "post_id": 51174852, "comment_id": 89357035, "body": "Now I&#39;ve a working and a non working version. It is not related to the generated <code>.pb.go</code> file, but has something to do with a <code>vendor</code> directory inside of my <code>proto</code>-Repository. If I remove it, the oneof key in JSON is <b>int_value</b> and the unmarshalling works. If the vendor directory is there, the oneof key in JSON is <b>intValue</b> - and it does not work. The vendor directory only contains <code>github.com&#47;gogo&#47;protobuf&#47;proto</code> with some go-files. They&#39;re in the same version as the top level ones."}, {"owner": {"reputation": 292, "user_id": 3006344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e5bd75574303cf338529d605191d6f6?s=128&d=identicon&r=PG", "display_name": "Cajus Pollmeier", "link": "https://stackoverflow.com/users/3006344/cajus-pollmeier"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1530784997, "post_id": 51174852, "comment_id": 89358533, "body": "Placed it here: <a href=\"https://github.com/cajus/prototest\" rel=\"nofollow noreferrer\">github.com/cajus/prototest</a>"}], "answers": [{"comments": [{"owner": {"reputation": 292, "user_id": 3006344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e5bd75574303cf338529d605191d6f6?s=128&d=identicon&r=PG", "display_name": "Cajus Pollmeier", "link": "https://stackoverflow.com/users/3006344/cajus-pollmeier"}, "edited": false, "score": 0, "creation_date": 1531118165, "post_id": 51206760, "comment_id": 89457628, "body": "The problem is that the real project has vendored <i>proto</i> which has vendored gogo/*. The main project does so, too. The only way to get around it seems to be removing of the proto/vendor stuff. I can make it happen, but that needs some refactoring. Sigh. If I dislike something in golang, then it&#39;s its various ways of broken dependency management. But anyway - thanks for your help!"}], "tags": [], "owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "is_accepted": true, "score": 1, "last_activity_date": 1530867905, "creation_date": 1530867905, "answer_id": 51206760, "question_id": 51174852, "link": "https://stackoverflow.com/questions/51174852/how-to-unmarshal-json-into-protobuf-containing-oneof-definitions-using-jsonpb/51206760#51206760", "title": "How to unmarshal JSON into protobuf containing oneof definitions using jsonpb?", "body": "<p>You have a Type mix up due to the two vendor folders. A type declared in two vendor folders is <em>not the same, even if the code for them is exactly the same</em>.</p>\n\n<p>Thus for example:\n<code>prototest-master/vendor/github.com/gogo/proto/messageSet</code> (A) is not of the same type as <code>prototest-master/</code><strong>proto</strong><code>/vendor/github.com/gogo/proto/messageSet</code> (B) even as their imports are the same (<code>github.com/gogo/proto</code>)</p>\n\n<p>In your project's <code>main.go</code> the construction of the marshaler <code>jsonpb.Marshaler{}</code> uses the types from (A) where the actual messages like <code>&amp;pb.ParameterSets{...</code> use the types from (B) to construct itself.</p>\n\n<p>Since <code>jsonpb</code> seems to do a lot of reflection stuff it breaks on the mixing of the two types.</p>\n\n<p>A better solution is to use just one <code>vendor</code> folder to be clear on the types everyone uses. I would just ditch the (B) vendor folder because it adds nothing.</p>\n"}, {"tags": [], "owner": {"reputation": 1226, "user_id": 1716905, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf004baf04689322a8766ebc1efd5e07?s=128&d=identicon&r=PG&f=1", "display_name": "Luke", "link": "https://stackoverflow.com/users/1716905/luke"}, "is_accepted": false, "score": 1, "last_activity_date": 1589194843, "creation_date": 1589194843, "answer_id": 61728103, "question_id": 51174852, "link": "https://stackoverflow.com/questions/51174852/how-to-unmarshal-json-into-protobuf-containing-oneof-definitions-using-jsonpb/61728103#61728103", "title": "How to unmarshal JSON into protobuf containing oneof definitions using jsonpb?", "body": "<p>I don't think it is safe to manually build the message as you are doing since you cannot grant that the resulting JSON matches exactly what would be produced by <code>jsonpb.Marshal</code>. Better to just instantiate <code>Parameter</code>.\n<a href=\"https://github.com/golang/protobuf/issues/446\" rel=\"nofollow noreferrer\">This github issue</a> discusses a scenario that is in a way similar to yours and <a href=\"https://github.com/golang/protobuf/issues/446#issuecomment-360698636\" rel=\"nofollow noreferrer\">one of the solutions</a> may help you:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n\n    \"github.com/golang/protobuf/jsonpb\"\n    \"github.com/golang/protobuf/proto\"\n)\n\nfunc main() {\n    msg := &amp;Person{\n        Name: \"Allen\",\n        Age: 30,\n        Married: true,\n        Number: &amp;Person_F{float32(14500.6)},\n    }\n\n    m := jsonpb.Marshaler{}\n    js, err := m.MarshalToString(msg)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    fmt.Printf(\"json output ==&gt; %v\\n\", js)\n\n    msg2 := &amp;Person{}\n    if err := jsonpb.Unmarshal(strings.NewReader(js), msg2); err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    fmt.Printf(\"%+v\\n\", proto.MarshalTextString(msg2))\n}\n</code></pre>\n"}], "owner": {"reputation": 292, "user_id": 3006344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e5bd75574303cf338529d605191d6f6?s=128&d=identicon&r=PG", "display_name": "Cajus Pollmeier", "link": "https://stackoverflow.com/users/3006344/cajus-pollmeier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5509, "favorite_count": 1, "accepted_answer_id": 51206760, "answer_count": 2, "score": 4, "last_activity_date": 1589194843, "creation_date": 1530710828, "question_id": 51174852, "link": "https://stackoverflow.com/questions/51174852/how-to-unmarshal-json-into-protobuf-containing-oneof-definitions-using-jsonpb", "title": "How to unmarshal JSON into protobuf containing oneof definitions using jsonpb?", "body": "<p>I'm currently failing to unmarshal a JSON snippet which is generated by <em>jsonpb</em>. Maybe it's just some kind of misunderstanding on my side, but when looking at the tests I'd expect it to work somehow.</p>\n\n<p>Here's the relevant snippet of the <code>pb.proto</code>:</p>\n\n<pre><code>syntax = \"proto3\";\npackage pb;\n\nmessage Parameter {\n    string name = 1;\n    oneof value {\n        string str_value = 2;\n        int32 int_value = 3;\n        bool bool_value = 4;\n        float float_value = 5;\n    }\n}\n\nmessage ParameterSet {\n    bytes raw = 1;\n    repeated Parameter parameters = 2;\n}\n\nmessage ParameterSets {\n    map&lt;string,ParameterSet&gt; sets = 1;\n}\n</code></pre>\n\n<p>Testing marshaling/unmarshaling using this simple snippet fails:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/gogo/protobuf/jsonpb\"\n    \"strings\"\n)\n\nfunc main() {\n    m := jsonpb.Marshaler{}\n    str, err := m.MarshalToString(&amp;pb.ParameterSets{Sets: map[string]*pb.ParameterSet{\n        \"parameter\": {\n            Raw: []byte{0, 1, 2, 3, 4, 5, 6, 1, 2},\n            Parameters: []*pb.Parameter{\n                {Name: \"itest\", Value: &amp;pb.Parameter_IntValue{42}},\n                {Name: \"stest\", Value: &amp;pb.Parameter_StrValue{\"Foobar\"}},\n                {Name: \"btest\", Value: &amp;pb.Parameter_BoolValue{true}},\n                {Name: \"ftest\", Value: &amp;pb.Parameter_FloatValue{41.99}},\n           },\n        },\n    }},)\n    fmt.Println(str)\n    fmt.Println(err)\n\n    sets := pb.ParameterSets{}\n    err = jsonpb.Unmarshal(strings.NewReader(str), &amp;sets)\n    fmt.Println(sets)\n    fmt.Println(err)\n}\n</code></pre>\n\n<p>It results in:</p>\n\n<pre><code>{\"sets\":{\"parameter\":{\"raw\":\"AAECAwQFBgEC\",\"parameters\":[{\"name\":\"itest\",\"intValue\":42},{\"name\":\"stest\",\"strValue\":\"Foobar\"},{\"name\":\"btest\",\"boolValue\":true},{\"name\":\"ftest\",\"floatValue\":41.99}]}}}\n&lt;nil&gt;\n{map[]}\nunknown field \"intValue\" in pb.Parameter\n</code></pre>\n\n<p>How can I get the <em>oneof</em> values back in the proto object?</p>\n"}, {"tags": ["http", "go", "reverse-proxy", "gorilla", "mux"], "answers": [{"tags": [], "owner": {"reputation": 447, "user_id": 1882516, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/b294715d6e36b379479a6eba4099a540?s=128&d=identicon&r=PG&f=1", "display_name": "squirreldev", "link": "https://stackoverflow.com/users/1882516/squirreldev"}, "is_accepted": false, "score": 1, "last_activity_date": 1530734571, "creation_date": 1530734571, "answer_id": 51180194, "question_id": 51174375, "link": "https://stackoverflow.com/questions/51174375/reverse-proxy-with-httputil-and-gorilla-mux/51180194#51180194", "title": "Reverse proxy with httputil and gorilla/mux", "body": "<p>This error was caused by the route returning a 301 still unclear why. ReverseProxy's fallback behavior on 301, 302, 303 is to support RFC 2616</p>\n\n<p><a href=\"https://github.com/golang/go/issues/18570\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/18570</a>\nThis rewrites the Method to <code>GET</code></p>\n"}], "owner": {"reputation": 447, "user_id": 1882516, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/b294715d6e36b379479a6eba4099a540?s=128&d=identicon&r=PG&f=1", "display_name": "squirreldev", "link": "https://stackoverflow.com/users/1882516/squirreldev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1270, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1530734571, "creation_date": 1530709330, "last_edit_date": 1530709576, "question_id": 51174375, "link": "https://stackoverflow.com/questions/51174375/reverse-proxy-with-httputil-and-gorilla-mux", "title": "Reverse proxy with httputil and gorilla/mux", "body": "<p>I've been trying to reverse proxy some of my requests internally with <code>httputil.NewSingleHostReverseProxy(*Url)</code>\nI noticed that gorilla mux is not happy with this so I found a fix online that solved the issue for <code>GET</code> requests.\nHowever, it seems like like <code>GET</code> is the only request that will be reverse proxied correctly.</p>\n\n<p><code>u = generated URL with url.Parse</code></p>\n\n<pre><code>api.Path(\"/feature\").Methods(\"POST\").HandlerFunc(handler(httputil.NewSingleHostReverseProxy(u)))\n\nfunc handler(p *httputil.ReverseProxy) func(http.ResponseWriter, *http.Request) {\n    return func(w http.ResponseWriter, r *http.Request) {\n        r.URL.Path = mux.Vars(r)[\"path\"]\n        p.ServeHTTP(w, r)\n    }\n}\n</code></pre>\n\n<p>This works fine for <code>GET</code> requests, but when sending a <code>POST</code> or <code>PATCH</code> the receiving http method is set as <code>GET</code>. I have confirmed that the proxy's <code>r.Method</code> is <code>POST</code> on one end and <code>GET</code> on the other.\nHas anyone encountered this issue before, or know what could be causing this?</p>\n"}, {"tags": ["go", "interface", "type-assertion"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1530703730, "post_id": 51172562, "comment_id": 89327807, "body": "If there is no requirement to use <code>reflection</code> then you should avoid it and loop over the <code>[]interface{}</code>."}, {"owner": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1530703928, "post_id": 51172562, "comment_id": 89327945, "body": "So, I would <i>only</i> use reflection if I don&#39;t know the structure?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530704005, "post_id": 51172562, "comment_id": 89327990, "body": "@BobvanLuijt: Basically."}], "answers": [{"comments": [{"owner": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "edited": false, "score": 1, "creation_date": 1530707609, "post_id": 51172619, "comment_id": 89330338, "body": "Thanks, this is very helpful. Adding the map to an interface to iterate was something I didn&#39;t know."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 9, "last_activity_date": 1530705398, "last_edit_date": 1530705398, "creation_date": 1530703752, "answer_id": 51172619, "question_id": 51172562, "link": "https://stackoverflow.com/questions/51172562/how-to-iterate-over-an-interface-in-go/51172619#51172619", "title": "How to iterate over an []interface{} in Go", "body": "<p>If you know that's your data structure, there's no reason to use reflection at all. Just use a type assertion:</p>\n\n<pre><code>for key, value := range result.([]interface{})[0].([]interface{})[0].(map[string]interface{}) {\n    // key == id, label, properties, etc\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530707097, "post_id": 51173189, "comment_id": 89330030, "body": "It is just an example my main concern was to unmarshal and then use type assertion to get the underlying value. I m just using recursion to get the value of slice of interface{}. I have used json as an example Since OP has given the json in his question."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530707376, "post_id": 51173189, "comment_id": 89330177, "body": "The OP has explained that his <code>result</code> variable is the output of the <a href=\"https://godoc.org/github.com/qasaur/gremgo#Client.Execute\" rel=\"nofollow noreferrer\"><code>Execute</code></a> method, which does not return, nor consume, JSON.  Perhaps the data in the database is stored as JSON, but it is not accessible in that form via the Go client library, so answering with <code>json.Unmarshal</code> is a non-answer."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530707448, "post_id": 51173189, "comment_id": 89330224, "body": "Ok but using recursion to fetch the value of slice of <code>interface{}</code> can be done in any case. So I am edited my answer according to you thanks for infromation."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 4, "last_activity_date": 1530707889, "last_edit_date": 1530707889, "creation_date": 1530705601, "answer_id": 51173189, "question_id": 51172562, "link": "https://stackoverflow.com/questions/51172562/how-to-iterate-over-an-interface-in-go/51173189#51173189", "title": "How to iterate over an []interface{} in Go", "body": "<p>For getting the underlying value of an interface use type assertion. Read more about <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">Type assertion</a> and how it works.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n     res, err := g.Execute( // Sends a query to Gremlin Server with bindings\n           \"g.V(x)\",\n            map[string]string{\"x\": \"1234\"},\n            map[string]string{},\n     )\n     if err != nil {\n          fmt.Println(err)\n          return\n     }\n     fetchValue(res)\n}\n\nfunc fetchValue(value interface{}) {\n    switch value.(type) {\n    case string:\n        fmt.Printf(\"%v is an interface \\n \", value)\n    case bool:\n        fmt.Printf(\"%v is bool \\n \", value)\n    case float64:\n        fmt.Printf(\"%v is float64 \\n \", value)\n    case []interface{}:\n        fmt.Printf(\"%v is a slice of interface \\n \", value)\n        for _, v := range value.([]interface{}) { // use type assertion to loop over []interface{}\n            fetchValue(v)\n        }\n    case map[string]interface{}:\n        fmt.Printf(\"%v is a map \\n \", value)\n        for _, v := range value.(map[string]interface{}) { // use type assertion to loop over map[string]interface{}\n            fetchValue(v)\n        }\n    default:\n        fmt.Printf(\"%v is unknown \\n \", value)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11267, "favorite_count": 2, "accepted_answer_id": 51172619, "answer_count": 2, "score": 5, "last_activity_date": 1586160903, "creation_date": 1530703586, "last_edit_date": 1586160903, "question_id": 51172562, "link": "https://stackoverflow.com/questions/51172562/how-to-iterate-over-an-interface-in-go", "title": "How to iterate over an []interface{} in Go", "body": "<p>I'm struggling to get the <strong>keys and values</strong> of the following interface, which is the result of JSON marshaling the result returned by <a href=\"https://godoc.org/github.com/qasaur/gremgo#Client.Execute\" rel=\"nofollow noreferrer\"><code>Execute</code></a> as demonstrated in <a href=\"https://github.com/qasaur/gremgo#example\" rel=\"nofollow noreferrer\">this example</a>:</p>\n\n<pre><code>[\n    [\n        {\n            \"id\": 36,\n            \"label\": \"TestThing\",\n            \"properties\": {\n                \"schema__testBoolean\": [\n                    {\n                        \"id\": 40,\n                        \"value\": true\n                    }\n                ],\n                \"schema__testInt\": [\n                    {\n                        \"id\": 39,\n                        \"value\": 1\n                    }\n                ],\n                \"schema__testNumber\": [\n                    {\n                        \"id\": 38,\n                        \"value\": 1.0879834\n                    }\n                ],\n                \"schema__testString\": [\n                    {\n                        \"id\": 37,\n                        \"value\": \"foobar\"\n                    }\n                ],\n                \"uuid\": [\n                    {\n                        \"id\": 41,\n                        \"value\": \"7f14bf92-341f-408b-be00-5a0a430852ee\"\n                    }\n                ]\n            },\n            \"type\": \"vertex\"\n        }\n    ]\n]\n</code></pre>\n\n<p>A <code>reflect.TypeOf(result)</code> results in: <code>[]interface{}</code>.</p>\n\n<p>I've used this to loop over the array:</p>\n\n<pre><code>s := reflect.ValueOf(result)\nfor i := 0; i &lt; s.Len(); i++ {\n  singleVertex := s.Index(i).Elem() // What to do here?\n}\n</code></pre>\n\n<p>But I'm getting stuck with errors like: </p>\n\n<blockquote>\n  <p>reflect.Value.Interface: cannot return value obtained from unexported\n  field or method</p>\n</blockquote>\n"}, {"tags": ["go", "travis-ci", "importerror"], "comments": [{"owner": {"reputation": 480, "user_id": 9448870, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ckK5P.jpg?s=128&g=1", "display_name": "Daniel Sch&#252;tte", "link": "https://stackoverflow.com/users/9448870/daniel-sch%c3%bctte"}, "edited": false, "score": 0, "creation_date": 1531013603, "post_id": 51170882, "comment_id": 89436273, "body": "Take a look at the example projects at Travis CI&#39;s <a href=\"https://docs.travis-ci.com/user/languages/go/\" rel=\"nofollow noreferrer\">homepage, at the bottom</a> to get a feeling for how people usually structure their projects. To my understand, the recommended way to pull external but private dependencies is to use a GitHub API as explained on the same website."}], "answers": [{"tags": [], "owner": {"reputation": 1434, "user_id": 801426, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7e4a92cd142e59829350dc0f2a021cc4?s=128&d=identicon&r=PG", "display_name": "bullgare", "link": "https://stackoverflow.com/users/801426/bullgare"}, "is_accepted": false, "score": 0, "last_activity_date": 1530723075, "creation_date": 1530723075, "answer_id": 51178140, "question_id": 51170882, "link": "https://stackoverflow.com/questions/51170882/import-local-source-file-to-be-compatible-with-travis-ci/51178140#51178140", "title": "Import local source file to be compatible with Travis CI", "body": "<p>Why not to use full path in import? It does not lead to any problem, right?\nIt works just fine both local and with CI (hopefully)</p>\n"}], "owner": {"reputation": 337, "user_id": 1338631, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/8987b8a8b1cc862d332b9ed4ed1030e6?s=128&d=identicon&r=PG", "display_name": "simonszu", "link": "https://stackoverflow.com/users/1338631/simonszu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 174, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1530723075, "creation_date": 1530698211, "last_edit_date": 1530698316, "question_id": 51170882, "link": "https://stackoverflow.com/questions/51170882/import-local-source-file-to-be-compatible-with-travis-ci", "title": "Import local source file to be compatible with Travis CI", "body": "<p>I have a go project which consists of several packages. First, the main package located at <code>$GOPATH/src/myproject/main.go</code>, and then an auth package located at <code>$GOPATH/src/myproject/auth/&lt;filename&gt;.go</code>. The main package references the auth package with an <code>import \"myproject/auth\"</code>. Local build goes fine. </p>\n\n<p>Now I try to use this project build with Travis CI, especially to learn more about Travis. Apparently Travis expects <code>import</code> statements which don't start with a hostname to be available from beginning, since I get the error <code>package myproject/auth: unrecognized import path \"myproject/auth\" (import path does not begin with hostname)</code>. </p>\n\n<p>On my local machine this is no problem, since my local go knows about its available sources in <code>$GOPATH</code>, and so about the project's subpackage, too, and just includes the sources. </p>\n\n<p>What are the expected steps to do to make Travis work with this import statement as well? </p>\n"}, {"tags": ["parsing", "go", "yaml", "multilinestring"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530698424, "post_id": 51170788, "comment_id": 89324466, "body": "So <code>updateDescriptorV3</code> is an instance of <code>Products</code>?"}, {"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 2, "creation_date": 1530698498, "post_id": 51170788, "comment_id": 89324518, "body": "@KasunSiyambalapitiya Check <a href=\"https://stackoverflow.com/a/21699210/134204\">this answer</a>. YAML is the opposite of simple. There are 9 ways to write multi-line strings. From that answer <code>|-: &quot;strip&quot;: remove the line feed, remove the trailing blank lines.</code>."}, {"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 0, "creation_date": 1530698825, "post_id": 51170788, "comment_id": 89324707, "body": "Before anyone starts downvoting, do <i>you</i> remember the entire YAML spec? Really? It&#39;s larger than XML, with different libraries using different rules to serialize. <a href=\"https://arp242.net/weblog/yaml_probably_not_so_great_after_all.html\" rel=\"nofollow noreferrer\">YAML: Probably not so great after all</a>."}, {"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 0, "creation_date": 1530699104, "post_id": 51170788, "comment_id": 89324867, "body": "@KasunSiyambalapitiya it&#39;s perfectly OK to be surprised by YAML, even experts can&#39;t remember every single cryptic combination. In fact, the author of the linked answer had to edit the answer 3 times at least just for multiline strings <code>There are 5 6 NINE (or 63*, depending how you count) different ways</code>. The answer has 35 revisions"}, {"owner": {"reputation": 3269, "user_id": 93745, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8F5Wc.jpg?s=128&g=1", "display_name": "tinita", "link": "https://stackoverflow.com/users/93745/tinita"}, "edited": false, "score": 0, "creation_date": 1530699980, "post_id": 51170788, "comment_id": 89325434, "body": "You might also want to read my article on YAML quoting: <a href=\"http://blogs.perl.org/users/tinita/2018/03/strings-in-yaml---to-quote-or-not-to-quote.html\" rel=\"nofollow noreferrer\">blogs.perl.org/users/tinita/2018/03/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 1, "creation_date": 1530698950, "post_id": 51170993, "comment_id": 89324778, "body": "That answer is actually used as an <a href=\"https://arp242.net/weblog/yaml_probably_not_so_great_after_all.html\" rel=\"nofollow noreferrer\">example of YAML&#39;s complexity</a>: <code>For example did you know there are nine ways to write a multi-line string in YAML with subtly different behaviour?  Yeah :-&#47;</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 0, "creation_date": 1530698999, "post_id": 51170993, "comment_id": 89324805, "body": "@PanagiotisKanavos You won&#39;t find me defending YAML. I don&#39;t need to be convinced it&#39;s over complex."}, {"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 0, "creation_date": 1530699308, "post_id": 51170993, "comment_id": 89324995, "body": "just a coincidence - the article resurfaced yesterday in twitter discussions about config formats. I just realized it linked to <i>that</i> answer as an example of its complexity"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1530699240, "last_edit_date": 1530699240, "creation_date": 1530698552, "answer_id": 51170993, "question_id": 51170788, "link": "https://stackoverflow.com/questions/51170788/how-to-marshal-a-multiline-string-to-yaml-value/51170993#51170993", "title": "How to marshal a multiline string to yaml value", "body": "<p>It is working properly.  Your multi-line string does not end in a newline, so it is necessary for the YAML to strip the newline when it is parsed. That is precisely what the <code>|-</code> does.</p>\n\n<p>If you really want <code>|</code> instead, just add a newline to the end of your input string, but be aware of the functional difference.</p>\n\n<p>See <a href=\"https://stackoverflow.com/a/21699210/13860\">this answer</a> for a complete explanation of the various ways to include multi-line strings in YAML.</p>\n"}], "owner": {"reputation": 2855, "user_id": 5105305, "user_type": "registered", "accept_rate": 58, "profile_image": "https://lh4.googleusercontent.com/-i8lMihc1yYc/AAAAAAAAAAI/AAAAAAAAAJE/ooPD4M12q8I/photo.jpg?sz=128", "display_name": "Kasun Siyambalapitiya", "link": "https://stackoverflow.com/users/5105305/kasun-siyambalapitiya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1643, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1530699240, "creation_date": 1530697867, "last_edit_date": 1530698936, "question_id": 51170788, "link": "https://stackoverflow.com/questions/51170788/how-to-marshal-a-multiline-string-to-yaml-value", "title": "How to marshal a multiline string to yaml value", "body": "<p>I have a struct </p>\n\n<pre><code>type Products struct {\n    Name    string\n    Version string\n    Description     string\n}\n</code></pre>\n\n<p>holding a multiline string constant as the value for <code>Description</code> field, the constant is as follows </p>\n\n<pre><code>const DEFAULT_DESCRIPTION = `Please add the description here without removing the literal block (|)\n    Sample description will be as follows,\n    Fixes for the following in rabbitmq transport\n    (i)   Channel not closing issue in rabbitmq publisher\n    (ii)  Performance improvements to the transport by introducing a channel pool (configurable) and parameterising queue and exchange creation.\n    (iii) Allow configuring connection factory by name in target url`\n</code></pre>\n\n<p>Then I use the package <code>gopkg.in/yaml.v2</code> for marshaling the above struct (which contains the above constant as a value for its field) as follows</p>\n\n<pre><code>data, err = yaml.Marshal(updateDescriptorV3)\n</code></pre>\n\n<p>and write the generated <code>yaml</code> content to a file using <code>os.file.Write()</code>\nBut in the <code>yaml</code> file generated above an additional <code>-</code> exists after literal_block symbol (<code>|</code>) What I am doing wrong?</p>\n\n<pre><code>  description: |-\nPlease add the description here without removing the literal block (|)\nSample description will be as follows,\nFixes for the following in rabbitmq transport\n(i)   Channel not closing issue in rabbitmq publisher\n(ii)  Performance improvements to the transport by introducing a channel pool (configurable) and parameterising queue and exchange creation.\n(iii) Allow configuring connection factory by name in target url\n</code></pre>\n\n<p>What needs to be done to get the above constant as a literal_block in <code>yaml</code> as follows?</p>\n\n<pre><code>  description: |\nPlease add the description here without removing the literal block (|)\nSample description will be as follows,\nFixes for the following in rabbitmq transport\n(i)   Channel not closing issue in rabbitmq publisher\n(ii)  Performance improvements to the transport by introducing a channel pool (configurable) and parameterising queue and exchange creation.\n(iii) Allow configuring connection factory by name in target url\n</code></pre>\n"}, {"tags": ["algorithm", "go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1530698792, "post_id": 51170263, "comment_id": 89324682, "body": "Just to comment. Your <code>min</code> function peels a single index set off, but doesn&#39;t compare it as it needs to. Instead of working with a, b, c, etc separately, you need to find the closest <code>n</code> length tuple (3 in this example). So the length of the outer slice determines that portion of the complexity and is what the recursion should be based off... unless my 4AM tired brain isn&#39;t firing on all cylinders..."}, {"owner": {"reputation": 2170, "user_id": 927370, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f9c81e4d799a162e9f04472e2d09c6f0?s=128&d=identicon&r=PG", "display_name": "SeattleOrBayArea", "link": "https://stackoverflow.com/users/927370/seattleorbayarea"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1530699825, "post_id": 51170263, "comment_id": 89325342, "body": "@RayfenWindspear right. That is the issue. What I think I need is to recursively find min with something like..  \tmin({{0, 10}, {3, 9}, {5, 12}}) \t\t-- min ({0}, {3, 9}, {5, 12})   \t\t\t-- min {3}, {5, 12} \t\t\t\t    -- min {5}  \t\t\t            -- min {12}"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1530703653, "post_id": 51170263, "comment_id": 89327778, "body": "I&#39;m not sure there&#39;s a solution that doesn&#39;t involve comparing every possible tuple. I came to an iterative solution rather than recursive. Basically, I generated all the combinations for (a,b,c), then scored them individually. Perhaps a dynamic solution could involve keeping track of the best score yet and immediately tossing out known sets. e.g. 10,9,12 is best score with 5, if that&#39;s seen earlier, the set 0,9,5 could immediately be ruled out as soon as it saw 0,9 making that score at least 9. I&#39;d post my code, but it&#39;s a gory mess."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1530705956, "post_id": 51170263, "comment_id": 89329266, "body": "A combinatorial explosion? See <a href=\"https://en.wikipedia.org/wiki/Travelling_salesman_problem\" rel=\"nofollow noreferrer\">Travelling salesman problem</a> and <a href=\"https://en.wikipedia.org/wiki/NP-hardness\" rel=\"nofollow noreferrer\">NP-hardness</a>."}, {"owner": {"reputation": 465, "user_id": 1600231, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ePGpS.jpg?s=128&g=1", "display_name": "BG Adrian", "link": "https://stackoverflow.com/users/1600231/bg-adrian"}, "edited": false, "score": 0, "creation_date": 1530743077, "post_id": 51170263, "comment_id": 89345124, "body": "It sounds like a Travelling salesman version, without a specific start/end point. You can add a fake 2nd coordinate to use the same algorithms."}], "owner": {"reputation": 2170, "user_id": 927370, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f9c81e4d799a162e9f04472e2d09c6f0?s=128&d=identicon&r=PG", "display_name": "SeattleOrBayArea", "link": "https://stackoverflow.com/users/927370/seattleorbayarea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1530696468, "creation_date": 1530696382, "last_edit_date": 1530696468, "question_id": 51170263, "link": "https://stackoverflow.com/questions/51170263/find-closest-indices-given-a-list-of-indices", "title": "Find closest indices given a list of indices", "body": "<p>I ran into this while solving a programming question, so seeking help with a subset of the original problem. </p>\n\n<p>The indexes of a, b, and c are provided in a slice of slice of integers ([][]int). </p>\n\n<p>For example:</p>\n\n<pre><code>indexes := [][]int{{0, 10}, {3, 9}, {5, 12}} \n</code></pre>\n\n<p>where a is found at indices 0 and 10. \nb is found at indices 3 and 9 \nc is found at indices 5 and 12. </p>\n\n<p>The goal is to find, programmatically, which of the indexes for a, b and c makes them closest. For example, in the above case, the answer would be 10, 9, 12.</p>\n\n<p>What would be a way to solve this? I have thought about dynamic programming but still cannot figure out how to represent this problem in a recursive way.\nNon Dp solution also welcome, just looking for ideas not entire solution.</p>\n\n<p>I think I am close but still not there (see min() function) - <a href=\"https://play.golang.org/p/odw9u-JeOPU\" rel=\"nofollow noreferrer\">https://play.golang.org/p/odw9u-JeOPU</a></p>\n"}, {"tags": ["http", "go", "static-files"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1530695284, "post_id": 51169677, "comment_id": 89322399, "body": "Perhaps this is what you are looking for? The resulting answer appers somewhat dirty to me, however. It basically consists of just checking if the currently requested resource is a Dir, or a File and handling it accordingly. <a href=\"https://stackoverflow.com/questions/49589685/good-way-to-disable-directory-listing-with-http-fileserver-in-go\" title=\"good way to disable directory listing with http fileserver in go\">stackoverflow.com/questions/49589685/&hellip;</a>"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1530695953, "post_id": 51169677, "comment_id": 89322856, "body": "Uuuh, yes, this is what <code>Dir</code> does: <a href=\"https://golang.org/pkg/net/http/#Dir\" rel=\"nofollow noreferrer\">A Dir implements FileSystem using the native file system restricted to a specific directory tree</a> What is the problem exactly?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 1, "creation_date": 1530696162, "post_id": 51169677, "comment_id": 89323013, "body": "@RickyA the problem is that most other servers default to returning a 404 when hitting a directory, which is a very sane default for security. Go doesn&#39;t offer a way to turn this off. Essentially the question&#39;s answer boils down to the last piece of the doc for <code>Dir</code>: &quot;create a custom FileSystem implementation.&quot;"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1530696329, "post_id": 51169677, "comment_id": 89323134, "body": "@RayfenWindspear that is an assumption. Maybe OP expects an index.html to be rendered, so I want to hear it from OP."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 1, "creation_date": 1530696464, "post_id": 51169677, "comment_id": 89323226, "body": "@RickyA not to seem rude, but it seems a safe assumption. Serving a &quot;statics&quot; dir with css, js, etc wouldn&#39;t normally have an index.html at the <code>statics&#47;</code> level of the dir as it is just a container for the separate types of statics. But yes, an assumption nonetheless..."}, {"owner": {"reputation": 216, "user_id": 5039386, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y1c-Clsbdkw/AAAAAAAAAAI/AAAAAAAAAKA/WFHwWVc3h_I/photo.jpg?sz=128", "display_name": "Hau Ma", "link": "https://stackoverflow.com/users/5039386/hau-ma"}, "edited": false, "score": 0, "creation_date": 1530697664, "post_id": 51169677, "comment_id": 89323937, "body": "Thank you so much guys, I implemented a solution to my own repo related to the correct answer: <a href=\"https://github.com/hauxe/GoM/blob/master/http/filesystem_handler.go\" rel=\"nofollow noreferrer\">github.com/hauxe/GoM/blob/master/http/filesystem_handler.go</a>"}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 2, "creation_date": 1530697399, "post_id": 51170557, "comment_id": 89323770, "body": "+1 Straight to the point. Still seems odd that such a basic piece of functionality isn&#39;t builtin as an option."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1530697708, "post_id": 51170557, "comment_id": 89323965, "body": "@RayfenWindspear I agree, <code>http.FileServer</code> could use a little customization, in the public&#39;s best interest..."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1530706566, "last_edit_date": 1530706566, "creation_date": 1530697182, "answer_id": 51170557, "question_id": 51169677, "link": "https://stackoverflow.com/questions/51169677/http-static-file-handler-keeps-showing-the-directory-list/51170557#51170557", "title": "HTTP Static file handler keeps showing the directory list", "body": "<p>Fortunately or not, the default behavior of <a href=\"https://golang.org/pkg/net/http/#FileServer\" rel=\"nofollow noreferrer\"><code>http.FileServer</code></a> is that if the path denotes a directory without an <code>index.html</code> file, a directory listing will be served. And it does not provide a simple way to turn that off. But...</p>\n\n<p><a href=\"https://golang.org/pkg/net/http/#FileServer\" rel=\"nofollow noreferrer\"><code>http.FileServer</code></a> operates on a <em>virtual</em> filesystem described by the <a href=\"https://golang.org/pkg/net/http/#FileSystem\" rel=\"nofollow noreferrer\"><code>http.FileSystem</code></a> interface.</p>\n\n<p>This interface has a single method which tells how to open a file, and obtain an <a href=\"https://golang.org/pkg/net/http/#File\" rel=\"nofollow noreferrer\"><code>http.File</code></a> \"view\" of it:</p>\n\n<pre><code>type FileSystem interface {\n        Open(name string) (File, error)\n}\n</code></pre>\n\n<p>If you want to disable directory listing, all you have to do is provide your own implementation of <code>http.FileSystem</code> which when a directory is targeted, you simply report / return an error. That's all it takes.</p>\n\n<p>Of course you don't have to do this all by yourself. You may create your own <code>FileSystem</code> which uses / utilizes <a href=\"https://golang.org/pkg/net/http/#Dir\" rel=\"nofollow noreferrer\"><code>http.Dir</code></a>, which is the default implementation that uses the native file system (restricted to a specific directory tree).</p>\n\n<pre><code>type myfs struct {\n    http.Dir\n}\n\nfunc (m myfs) Open(name string) (result http.File, err error) {\n    f, err := m.Dir.Open(name)\n    if err != nil {\n        return\n    }\n\n    fi, err := f.Stat()\n    if err != nil {\n        return\n    }\n    if fi.IsDir() {\n        // Return a response that would have been if directory would not exist:\n        return m.Dir.Open(\"does-not-exist\")\n    }\n    return f, nil\n}\n</code></pre>\n\n<p>Using the above custom implementation:</p>\n\n<pre><code>handler := http.FileServer(myfs{http.Dir(*directory)})\nhttp.Handle(\n    \"/statics/\",\n    http.StripPrefix(strings.TrimRight(\"/statics/\", \"/\"), handler),\n)\n</code></pre>\n\n<p>And that's all. Attempting to browse <code>http://locahost:3000/statics/</code> will result in the default response:</p>\n\n<pre><code>404 page not found\n</code></pre>\n\n<p><strong>Notes:</strong></p>\n\n<p>The above implementation does a second <code>Dir.Open()</code> call to return an error, which is always the same. To \"speed things up\", we can store this response and just reuse it:</p>\n\n<pre><code>var notFoundFile, notFoundErr = http.Dir(\"dummy\").Open(\"does-not-exist\")\n</code></pre>\n\n<p>And when we detect a directory in our <code>myfs.Open()</code> method:</p>\n\n<pre><code>if fi.IsDir() {\n    // Return a response that \"belogns\" to opening a non-existing folder:\n    return notFoundFile, notFoundErr\n}\n</code></pre>\n"}], "owner": {"reputation": 216, "user_id": 5039386, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y1c-Clsbdkw/AAAAAAAAAAI/AAAAAAAAAKA/WFHwWVc3h_I/photo.jpg?sz=128", "display_name": "Hau Ma", "link": "https://stackoverflow.com/users/5039386/hau-ma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 861, "favorite_count": 2, "accepted_answer_id": 51170557, "answer_count": 1, "score": 4, "last_activity_date": 1530862554, "creation_date": 1530694603, "last_edit_date": 1530862554, "question_id": 51169677, "link": "https://stackoverflow.com/questions/51169677/http-static-file-handler-keeps-showing-the-directory-list", "title": "HTTP Static file handler keeps showing the directory list", "body": "<p>When I implement a static server handler, if I access to root path, it will show the whole directory, like this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/twmYb.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/twmYb.png\" alt=\"access to root folder\"></a></p>\n\n<p>My code is:</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"log\"\n    \"net/http\"\n    \"strings\"\n)\n\nfunc main() {\n    port := flag.String(\"p\", \"3000\", \"port to serve on\")\n    directory := flag.String(\"d\", \".\", \"the directory of static file to host\")\n    flag.Parse()\n\n    http.Handle(\"/statics/\", http.StripPrefix(strings.TrimRight(\"/statics/\", \"/\"), http.FileServer(http.Dir(*directory))))\n\n    log.Printf(\"Serving %s on HTTP port: %s\\n\", *directory, *port)\n    log.Fatal(http.ListenAndServe(\":\"+*port, nil))\n}\n</code></pre>\n\n<p>go to : <a href=\"http://locahost:3000/statics/\" rel=\"nofollow noreferrer\">http://locahost:3000/statics/</a></p>\n"}, {"tags": ["go", "goland", "golang-migrate"], "comments": [{"owner": {"reputation": 39499, "user_id": 740553, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/s5cOX.jpg?s=128&g=1", "display_name": "Mike &#39;Pomax&#39; Kamermans", "link": "https://stackoverflow.com/users/740553/mike-pomax-kamermans"}, "edited": false, "score": 0, "creation_date": 1566577326, "post_id": 51169321, "comment_id": 101713441, "body": "This is two questions. 1: how do I turn JSON into a struct, and 2: how do I map over an array."}, {"owner": {"reputation": 9, "user_id": 3014495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/042032d183c9f0673628813a0a3d153d?s=128&d=identicon&r=PG&f=1", "display_name": "Le-Coder", "link": "https://stackoverflow.com/users/3014495/le-coder"}, "reply_to_user": {"reputation": 39499, "user_id": 740553, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/s5cOX.jpg?s=128&g=1", "display_name": "Mike &#39;Pomax&#39; Kamermans", "link": "https://stackoverflow.com/users/740553/mike-pomax-kamermans"}, "edited": false, "score": 0, "creation_date": 1566577795, "post_id": 51169321, "comment_id": 101713659, "body": "Yes. I understand we can loop over slice and unmarshal it one by one. But is there a one liner which does it ?"}, {"owner": {"reputation": 39499, "user_id": 740553, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/s5cOX.jpg?s=128&g=1", "display_name": "Mike &#39;Pomax&#39; Kamermans", "link": "https://stackoverflow.com/users/740553/mike-pomax-kamermans"}, "edited": false, "score": 0, "creation_date": 1566578174, "post_id": 51169321, "comment_id": 101713826, "body": "If your array was itself JSON: yes (unmarshall would be all you need), but this is an array of strings, you&#39;re not going to do anything to those strings without iterating the array <i>somewhere</i>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566646338, "post_id": 51169321, "comment_id": 101727391, "body": "You appear to have edited one question into a completely unrelated new question. Please <i>do not do that</i>."}], "answers": [{"tags": [], "owner": {"reputation": 466, "user_id": 10461720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WEcLo.png?s=128&g=1", "display_name": "D.C. Joo", "link": "https://stackoverflow.com/users/10461720/d-c-joo"}, "is_accepted": false, "score": 0, "last_activity_date": 1573115615, "creation_date": 1573115615, "answer_id": 58744740, "question_id": 51169321, "link": "https://stackoverflow.com/questions/51169321/array-of-json-string-to-array-of-struct-in-golang/58744740#58744740", "title": "Array of json string to array of struct in golang?", "body": "<p>If you need a one-liner, here it is.</p>\n\n<pre><code>var dest []Status\n_ = json.Unmarshal([]byte(\"[\" + strings.Join(data, \",\")+ \"]\"), &amp;dest)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/pDs9iB338Uh\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n"}], "owner": {"reputation": 9, "user_id": 3014495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/042032d183c9f0673628813a0a3d153d?s=128&d=identicon&r=PG&f=1", "display_name": "Le-Coder", "link": "https://stackoverflow.com/users/3014495/le-coder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 218, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1573115615, "creation_date": 1530693540, "last_edit_date": 1566577072, "question_id": 51169321, "link": "https://stackoverflow.com/questions/51169321/array-of-json-string-to-array-of-struct-in-golang", "title": "Array of json string to array of struct in golang?", "body": "<p>I have the following json string array</p>\n\n<pre><code>data := []string{\n    `{\"STATUS\":\"UP\"}`,\n    `{\"STATUS\":\"UP\"}`,\n}\n</code></pre>\n\n<p>and the following struct corresponding to it</p>\n\n<pre><code>type Status struct {\n    STATUS string `json:\"STATUS\"`\n}\n</code></pre>\n\n<p>How do I unmarshal data into an array of Status struct ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1530690556, "post_id": 51167940, "comment_id": 89319784, "body": "Rule of thumb: Only <i>one</i> send/receive per select case! (Your <code>case ch&lt;- &lt;-input</code> is two: One send and one receive)."}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 3, "creation_date": 1530693804, "post_id": 51168233, "comment_id": 89321476, "body": "To the OP: as usually, read <a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"nofollow noreferrer\">the spec</a>, which says: &#171;For all the cases in the statement, the channel operands of receive operations and the channel and right-hand-side expressions of send statements are evaluated exactly once, in source order, upon entering the &quot;select&quot; statement. &lt;...&gt; Any side effects in that evaluation will occur irrespective of which (if any) communication operation is selected to proceed.&#187;"}], "tags": [], "owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "is_accepted": false, "score": 6, "last_activity_date": 1530689753, "creation_date": 1530689753, "answer_id": 51168233, "question_id": 51167940, "link": "https://stackoverflow.com/questions/51167940/chained-channel-operations-in-a-single-select-case/51168233#51168233", "title": "Chained channel operations in a single `select` case", "body": "<p>That happens because in select only one channel read or write is non blocking.</p>\n\n<p>All other operations behave normally.</p>\n\n<p>So in this piece of code</p>\n\n<pre><code>select {\n                case ch&lt;- &lt;-input1:\n                case ch&lt;- &lt;-input2:\n            }\n</code></pre>\n\n<p>it receives a value from <code>input1</code> (blocking). It waits for a delay and receives <code>A 0</code>.</p>\n\n<p>It tries to write it to <code>ch</code>, non blocking.</p>\n\n<p>If the code in <code>main</code> was fast enough to reach</p>\n\n<pre><code> fmt.Printf(\"%q\\n\", &lt;-ch)\n</code></pre>\n\n<p>line then write to a channel succeeds.</p>\n\n<p>Then <code>fanIn</code> <code>for</code> loop starts second iteration: it picks the second <code>case</code> this time (it's not deterministic). At this point it's likely that the second goroutine has written the <code>B 0</code> value.</p>\n\n<p>But there is a chance that the <code>main</code> function loop has not consumed the value from the combined channel.</p>\n\n<p>So the value is dropped.</p>\n\n<p>This repeats multiple times, you lose few values and end up having no writers and a reader waiting for the remaining values forever.</p>\n\n<p>This slightly modified copy of code demonstrates it: <a href=\"https://play.golang.org/p/lcM5OKx09Dj\" rel=\"noreferrer\">https://play.golang.org/p/lcM5OKx09Dj</a></p>\n"}, {"tags": [], "owner": {"reputation": 4142, "user_id": 9962955, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q_I2uCDh94A/AAAAAAAAAAI/AAAAAAAAABY/7dXHe3szfmQ/photo.jpg?sz=128", "display_name": "Leo K", "link": "https://stackoverflow.com/users/9962955/leo-k"}, "is_accepted": false, "score": 1, "last_activity_date": 1530690978, "creation_date": 1530690978, "answer_id": 51168572, "question_id": 51167940, "link": "https://stackoverflow.com/questions/51167940/chained-channel-operations-in-a-single-select-case/51168572#51168572", "title": "Chained channel operations in a single `select` case", "body": "<p>(my reading of this, I haven't seen a specific explanation of this particular combination of 'case' clauses in the GO docs).</p>\n\n<p>When you have a 'select' that has 'case' clauses referring to multiple channels, GO will pick <strong>any</strong> of them that is available and take that as 'the channel that woke up the select'.</p>\n\n<p>In your first code snippet, the 'case' clauses refer only to input1 and input2 (correct - what you actually wanted, i.e., \"wait for either input1 or input2\").</p>\n\n<p>In the second snippet, you have all three (<code>input1</code>, <code>input2</code> and <code>ch</code>) in 'case' clauses, so the statement says \"wait for <code>input1</code> or <code>input2</code> to be readable OR for <code>ch</code> to be writable\". Now, <code>ch</code> can become writable easily due to main waiting on it, so your 'select' can wake up on that and end up executing a read on input1 or intput2 without those being readable at the moment (NOT what you wanted).</p>\n"}, {"tags": [], "owner": {"reputation": 216, "user_id": 5039386, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Y1c-Clsbdkw/AAAAAAAAAAI/AAAAAAAAAKA/WFHwWVc3h_I/photo.jpg?sz=128", "display_name": "Hau Ma", "link": "https://stackoverflow.com/users/5039386/hau-ma"}, "is_accepted": false, "score": 2, "last_activity_date": 1530697139, "creation_date": 1530697139, "answer_id": 51170541, "question_id": 51167940, "link": "https://stackoverflow.com/questions/51167940/chained-channel-operations-in-a-single-select-case/51170541#51170541", "title": "Chained channel operations in a single `select` case", "body": "<p>I will explain why your value in channel has been dropped.\nBase on the fact in Golang document about execution of select statement:</p>\n\n<blockquote>\n  <p>For all the cases in the statement, the channel operands of receive operations and the channel and right-hand-side expressions of send statements are evaluated exactly once, in source order, upon entering the \"select\" statement. The result is a set of channels to receive from or send to, and the corresponding values to send. Any side effects in that evaluation will occur irrespective of which (if any) communication operation is selected to proceed. Expressions on the left-hand side of a RecvStmt with a short variable declaration or assignment are not yet evaluated.</p>\n</blockquote>\n\n<p>The result is a set of channels to receive from or send to, because of this, when you pass channel in left-hand side, select statement first try to get <strong>ALL</strong> right-hand side statements are evaluated before trying to send to channel in left-hand side statement</p>\n\n<p>Obviously, input1 and input2 must be received at one round of select statement, and then send to ch, so the ch channel <strong>Always</strong> has exact 5 value which mixed from intput1 and input2 <strong>Equally</strong> despite of their delay</p>\n\n<p>You can see all data has printed when sending value to input1 and input2 channel in this code:\n<a href=\"https://play.golang.org/p/NeUuW7d69eV\" rel=\"nofollow noreferrer\">Link</a></p>\n"}], "owner": {"reputation": 31, "user_id": 5361483, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e32f6de892610d101ba554c07f88c23?s=128&d=identicon&r=PG&f=1", "display_name": "YUTING LAI", "link": "https://stackoverflow.com/users/5361483/yuting-lai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 748, "favorite_count": 1, "answer_count": 3, "score": 3, "last_activity_date": 1530697139, "creation_date": 1530688801, "last_edit_date": 1530693657, "question_id": 51167940, "link": "https://stackoverflow.com/questions/51167940/chained-channel-operations-in-a-single-select-case", "title": "Chained channel operations in a single `select` case", "body": "<p>I try to multiplex 2 channels, A and B. A is sending with 10 milliseconds delay and B is 1 second. I use select to wait for A and B, and send the result to a fan-in channel, and then receive value in main.</p>\n\n<pre><code>package main\n\nimport  (\n\"fmt\"\n\"time\"\n)\n\nfunc talk(msg string, wait_time int) &lt;-chan string {\n    ch := make(chan string)\n    go func () {\n        for i:=0;i&lt;5;i++ {\n            ch &lt;- fmt.Sprintf(\"%s %d\", msg, i)\n            time.Sleep(time.Duration(wait_time)*time.Millisecond)\n        }\n    }()\n\n    return ch\n}\n\nfunc fanIn(input1, input2 &lt;-chan string) &lt;-chan string {\n    ch := make(chan string)\n    go func () {\n        for {\n            select {\n                case t :=&lt;-input1:\n                    ch &lt;- t\n                case t := &lt;-input2:\n                    ch &lt;- t\n            }\n        }\n    }()\n\n    return ch\n}\nfunc main() {\n    ch := fanIn(talk(\"A\", 10), talk(\"B\", 1000))\n\n    for i:=0; i&lt;10; i++ {\n        fmt.Printf(\"%q\\n\", &lt;-ch)\n    }\n    fmt.Printf(\"Done\\n\")\n\n}\n</code></pre>\n\n<p>This will get the correct result as shown below</p>\n\n<pre><code>\"A 0\"\n\"B 0\"\n\"A 1\"\n\"A 2\"\n\"A 3\"\n\"A 4\"\n\"B 1\"\n\"B 2\"\n\"B 3\"\n\"B 4\"\nDone\n</code></pre>\n\n<p>My question is, when I change the case statement, I got weird output. it seems some value were dropped, and of course no more value is received in fan-in channel and deadlock happened.</p>\n\n<pre><code>select {\n                case ch&lt;- &lt;-input1:\n                case ch&lt;- &lt;-input2:\n            }\n</code></pre>\n\n<p>Result is like this:</p>\n\n<pre><code>\"B 0\"\n\"A 1\"\n\"B 2\"\n\"A 3\"\n\"A 4\"\nfatal error: all goroutines are asleep - deadlock!\n</code></pre>\n\n<p>Anyone has any idea of this situation?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1530681949, "post_id": 51166265, "comment_id": 89315671, "body": "Like in any other language: ^/*"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1530686787, "post_id": 51166265, "comment_id": 89317803, "body": "If that&#39;s your only requirement, don&#39;t use a regex. Use <code>strings.HasPrefix</code> instead."}], "answers": [{"tags": [], "owner": {"reputation": 12311, "user_id": 2095090, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/3vmqn.jpg?s=128&g=1", "display_name": "Vincent van der Weele", "link": "https://stackoverflow.com/users/2095090/vincent-van-der-weele"}, "is_accepted": false, "score": 2, "last_activity_date": 1530684545, "creation_date": 1530684545, "answer_id": 51166816, "question_id": 51166265, "link": "https://stackoverflow.com/questions/51166265/regex-that-includes-slash-and-asterix-as-constant/51166816#51166816", "title": "Regex that includes slash and asterix as constant", "body": "<p>You need to escape the <code>*</code> with a backslash: <code>^/\\*</code>. However, if you use normal quotation marks, you need to escape that backslash itself as well:</p>\n\n<p><code>\"^/\\\\*\"</code></p>\n\n<p>Alternatively, you can use a raw string literal, which does not need the escaping of the backslash:</p>\n\n<p><code>`^/\\*`</code></p>\n\n<p>Playground link: <a href=\"https://play.golang.org/p/v5y9l8dTXRs\" rel=\"nofollow noreferrer\">https://play.golang.org/p/v5y9l8dTXRs</a></p>\n"}, {"comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1530690657, "post_id": 51166877, "comment_id": 89319840, "body": "Sorry. I typed the backslash, but it seems it doesnt make it to the output of the comment. Of course I did not propose /*."}], "tags": [], "owner": {"reputation": 24167, "user_id": 7388477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e42e688ade97076d4fdd1939946e7c7b?s=128&d=identicon&r=PG&f=1", "display_name": "Valdi_Bo", "link": "https://stackoverflow.com/users/7388477/valdi-bo"}, "is_accepted": true, "score": 1, "last_activity_date": 1530685319, "last_edit_date": 1530685319, "creation_date": 1530684812, "answer_id": 51166877, "question_id": 51166265, "link": "https://stackoverflow.com/questions/51166265/regex-that-includes-slash-and-asterix-as-constant/51166877#51166877", "title": "Regex that includes slash and asterix as constant", "body": "<p>If you want to match the <strong>whole</strong> source text, the regex must start with <code>^</code>\nand end with <code>$</code> (anchors).</p>\n\n<p>To match <code>/</code> use just <code>/</code>. In some other host languages (e.g. Javascript or Perl)\nslashes are used as regex delimiters, so to use the slash as the <strong>content</strong>\nof regex, you would have to escape it with a backslash, but in <em>go</em> this is not needed.</p>\n\n<p>To match <code>*</code> use <code>\\*</code>. You can not use just <code>*</code> (as <em>Volker</em> proposed), because it is a <strong>quantifier</strong>, meaning <em>0 or more</em>.</p>\n\n<p>As you want to match <strong>the whole string</strong> (not just <code>/*</code>), the next part\nshould be <code>.*</code> (any number of any chars).</p>\n\n<p>If you want to catch the \"rest\" of string in a capturing group, surround\nthis part with parentheses.</p>\n\n<p>And the last step of complication: Usually after <code>/*</code> there are some spaces\nand only after them the fragment you actually want to catch. In such case:</p>\n\n<ul>\n<li>start from <code>\\s*</code> (optional sequence of white chars),</li>\n<li>then put <code>(.*)</code>.</li>\n</ul>\n\n<p>So the final solution is: <code>^/\\*\\s*(.*)$</code></p>\n\n<p>For a working example see <a href=\"https://regex101.com/r/80ORab/1\" rel=\"nofollow noreferrer\">https://regex101.com/r/80ORab/1</a></p>\n\n<h2>Edit</h2>\n\n<p>If you write your regex as a string, in double quotes, the backslash\nmust be written twice.</p>\n"}], "owner": {"reputation": 3528, "user_id": 5170722, "user_type": "registered", "accept_rate": 51, "profile_image": "https://graph.facebook.com/10206583885691224/picture?type=large", "display_name": "Sredny M Casanova", "link": "https://stackoverflow.com/users/5170722/sredny-m-casanova"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 96, "favorite_count": 0, "accepted_answer_id": 51166877, "answer_count": 2, "score": -1, "last_activity_date": 1530910101, "creation_date": 1530681738, "question_id": 51166265, "link": "https://stackoverflow.com/questions/51166265/regex-that-includes-slash-and-asterix-as-constant", "title": "Regex that includes slash and asterix as constant", "body": "<p>I am using Golang and I am trying to determine which regex will work to match any string that starts with:</p>\n\n<pre><code>/*\n</code></pre>\n\n<p>It has been dificult to get it, I tried many ways (I didn't save them all to writte them here), but some of them are:</p>\n\n<pre><code>{/*}.*?\n//*.*?\n//\\\\*[A-Za-z0-9_-]*$\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 3589, "user_id": 337988, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/a0929a98013283051149383445c2fad5?s=128&d=identicon&r=PG", "display_name": "philipjkim", "link": "https://stackoverflow.com/users/337988/philipjkim"}, "edited": false, "score": 1, "creation_date": 1530680630, "post_id": 51166006, "comment_id": 89315269, "body": "I think mgo is supporting <a href=\"https://github.com/globalsign/mgo/labels/3.6%20feature\" rel=\"nofollow noreferrer\">3.6</a>. But I&#39;m not sure since I don&#39;t use mgo for mongoDB driver. I&#39;m using <a href=\"https://github.com/mongodb/mongo-go-driver\" rel=\"nofollow noreferrer\">mongo-go-driver</a> and it is compatible with 3.6."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530687319, "post_id": 51166006, "comment_id": 89318067, "body": "It should be compatible with the old features of MongoDB 3.6 for sure, since MongoDB 3.6 ought to be backward compatible with 3.0. Whether it supports (or you need) new 3.6 features is another question."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 5, "creation_date": 1530692860, "post_id": 51166006, "comment_id": 89320979, "body": "Why are you still using this driver? <a href=\"https://github.com/go-mgo/mgo\" rel=\"nofollow noreferrer\">The MongoDB driver for Go. UNMAINTAINED</a>, <a href=\"https://groups.google.com/d/msg/mgo-users/xQxKbDnxPIA/hU2J4g4AAwAJ\" rel=\"nofollow noreferrer\">go-mgo/mgo now unmaintained</a> and <a href=\"https://engineering.mongodb.com/post/considering-the-community-effects-of-introducing-an-official-golang-mongodb-driver\" rel=\"nofollow noreferrer\">Considering the Community Effects of Introducing an Official MongoDB Go Driver</a>"}, {"owner": {"reputation": 75, "user_id": 1638680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3daa6d9e1fd176087a06f2bac4475895?s=128&d=identicon&r=PG", "display_name": "dgm", "link": "https://stackoverflow.com/users/1638680/dgm"}, "edited": false, "score": 1, "creation_date": 1531311618, "post_id": 51166006, "comment_id": 89547927, "body": "There is a maintained version of gopkg by globalsign. You can include it by doing a: go get github.com/globalsign/mgo and go get github.com/globalsign/mgo/bson. There is a bit of work involved in swapping over the the official MongoDB driver, but it will be worth it in the end."}], "owner": {"reputation": 59, "user_id": 3816026, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/61eb944feca55cffedbbd440cd713799?s=128&d=identicon&r=PG&f=1", "display_name": "Surinder Rajpal", "link": "https://stackoverflow.com/users/3816026/surinder-rajpal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 568, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1530680151, "creation_date": 1530680151, "question_id": 51166006, "link": "https://stackoverflow.com/questions/51166006/is-gopkg-in-mgo-v2-compatible-with-mongo-3-6", "title": "Is gopkg.in/mgo.v2 compatible with mongo 3.6?", "body": "<p>I'm using gopkg.in/mgo.v2 for mongodb queries using GOLang. \nEarlier, Mongodb version was 3.0 and now I'm planning to upgrade it to 3.6.\nAre they compatible with each other?</p>\n"}, {"tags": ["templates", "if-statement", "go", "go-templates"], "answers": [{"comments": [{"owner": {"reputation": 673, "user_id": 363042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d158e0063c0d368abbca8e7f99a153af?s=128&d=identicon&r=PG", "display_name": "Brent", "link": "https://stackoverflow.com/users/363042/brent"}, "edited": false, "score": 0, "creation_date": 1530707421, "post_id": 51167460, "comment_id": 89330208, "body": "Perfect, thanks icza! The only small change I needed to make -- and I&#39;m not sure why -- is adding .Valid to the first if condition, like this: {{ if $.MyStruct.MyField.Valid }} {{if eq $.MyStruct.MyField.Value .}}selected=&quot;selected&quot;{{end}}{{end}}. With that, this template is finally working."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 673, "user_id": 363042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d158e0063c0d368abbca8e7f99a153af?s=128&d=identicon&r=PG", "display_name": "Brent", "link": "https://stackoverflow.com/users/363042/brent"}, "edited": false, "score": 2, "creation_date": 1530707876, "post_id": 51167460, "comment_id": 89330497, "body": "@Brent Then it looks you are not using pointers to structs but struct values. In your question you were referring to <code>nil</code> values, and only pointers have <code>nil</code> values, not structs. See edited answer."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1554160206, "last_edit_date": 1554160206, "creation_date": 1530687117, "answer_id": 51167460, "question_id": 51165642, "link": "https://stackoverflow.com/questions/51165642/golang-template-and-testing-for-valid-fields/51167460#51167460", "title": "Golang template and testing for Valid fields", "body": "<p>The <code>and</code> function in Go templates is not short-circuit evaluated (unlike the <code>&amp;&amp;</code> operator in Go), all its arguments are evaluated always. Quoting from <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\"><code>text/template</code></a> package doc:</p>\n\n<blockquote>\n<pre><code>and\n    Returns the boolean AND of its arguments by returning the\n    first empty argument or the last argument, that is,\n    \"and x y\" behaves as \"if x then y else x\". All the\n    arguments are evaluated.\n</code></pre>\n</blockquote>\n\n<p>This means that the <code>{{if}}</code> action of yours:</p>\n\n<pre><code>{{ if and ($.MyStruct.MyField) (eq $.MyStruct.MyField.Value .)}}\n</code></pre>\n\n<p>Even though the condition would be evaluated to <code>false</code> if <code>$.MyStruct.MyField</code> is <code>nil</code>, but <code>eq $.MyStruct.MyField.Value .</code> will also be evaluated and result in the error you get.</p>\n\n<p>Instead you may embed multiple <code>{{if}}</code> actions, like this:</p>\n\n<pre><code>{{if $.MyStruct.MyField}}\n    {{if eq $.MyStruct.MyField.Value .}}selected=\"selected\"{{end}}\n{{end}}\n</code></pre>\n\n<p>You may also use the <code>{{with}}</code> action, but that also sets the dot, so you have to be careful:</p>\n\n<pre><code>&lt;select name=\"y\"&gt;\n   {{range $idx, $e := .SomeSlice}}\n       &lt;option value=\"{{.}}\" {{with $.MyStruct.MyField}}\n               {{if eq .Value $e}}selected=\"selected\"{{end}}\n           {{end}}&gt;{{.}}&lt;/option&gt;\n   {{end}}\n&lt;/select&gt;\n</code></pre>\n\n<p><strong>Note:</strong></p>\n\n<p>You were talking about <code>nil</code> values in your question, but the <code>sql.NullXX</code> types are structs which cannot be <code>nil</code>. In which case you have to check its <code>Valid</code> field to tell if its <code>Value()</code> method will return you a non-<code>nil</code> value when called. It could look like this:</p>\n\n<pre><code>{{if $.MyStruct.MyField.Valid}}\n    {{if eq $.MyStruct.MyField.Value .}}selected=\"selected\"{{end}}\n{{end}}\n</code></pre>\n"}], "owner": {"reputation": 673, "user_id": 363042, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d158e0063c0d368abbca8e7f99a153af?s=128&d=identicon&r=PG", "display_name": "Brent", "link": "https://stackoverflow.com/users/363042/brent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1937, "favorite_count": 1, "accepted_answer_id": 51167460, "answer_count": 1, "score": 5, "last_activity_date": 1554160206, "creation_date": 1530677501, "last_edit_date": 1530687482, "question_id": 51165642, "link": "https://stackoverflow.com/questions/51165642/golang-template-and-testing-for-valid-fields", "title": "Golang template and testing for Valid fields", "body": "<p>In Go's database/sql package, there are a bunch of Null[Type] structs that help map database values (and their possible nulls) into code. I'm trying to figure out how to test whether a struct <em>field</em> is null, or in other words, when its Valid property is false. </p>\n\n<p>The recommended way to print a SQL field is to use the .Value property, like this:</p>\n\n<pre><code>&lt;div&gt;{{ .MyStruct.MyField.Value }}&lt;/div&gt;\n</code></pre>\n\n<p>This works great.</p>\n\n<p>But suppose I have something slightly more complicated, where I need to test the value against something else, for example:</p>\n\n<pre><code>&lt;select name=\"y\"&gt;\n   {{ range .SomeSlice }}\n       &lt;option value=\"{{ . }}\" {{ if eq $.MyStruct.MyField.Value .}}selected=\"selected\"{{ end }}&gt;{{ . }}&lt;/option&gt;\n   {{ end }}\n&lt;/select&gt;\n</code></pre>\n\n<p>As it happens, this works great, too, unless .MyField is not Valid, in which case I get the error, \"error calling eq: invalid type for comparison\". The error makes sense, because Go can't compare a nil Field against another value (or something like that).</p>\n\n<p>I would have thought the 'easy' solution would be to test first whether the Value is nil, and then compare it against what I need, like this:</p>\n\n<pre><code>&lt;select name=\"y\"&gt;\n   {{ range .SomeSlice }}\n       &lt;option value=\"{{ . }}\" {{ if and ($.MyStruct.MyField) (eq $.MyStruct.MyField.Value .)}}selected=\"selected\"{{ end }}&gt;{{ . }}&lt;/option&gt;\n   {{ end }}\n&lt;/select&gt;\n</code></pre>\n\n<p>In this case, I get the same \"error calling eq: invalid type for comparison\". I guess that means .MyField \"exists\" even though the value of .MyField is not Valid. So, then I tried a half dozen other versions, mostly with the same error, for example:</p>\n\n<pre><code>&lt;select name=\"y\"&gt;\n   {{ range .SomeSlice }}\n       &lt;option value=\"{{ . }}\" {{ if and ($.MyStruct.MyField.Valid) (eq $.MyStruct.MyField.Value .)}}selected=\"selected\"{{ end }}&gt;{{ . }}&lt;/option&gt;\n   {{ end }}\n&lt;/select&gt;\n</code></pre>\n\n<p>At this point, I'm realizing I really don't understand how to test for the existence of a valid field at all. I'd appreciate any help you might have.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8210, "user_id": 9816472, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DltvK.jpg?s=128&g=1", "display_name": "Isaac", "link": "https://stackoverflow.com/users/9816472/isaac"}, "reply_to_user": {"reputation": 602, "user_id": 3342628, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/eStRY.png?s=128&g=1", "display_name": "Manjunath", "link": "https://stackoverflow.com/users/3342628/manjunath"}, "edited": false, "score": 0, "creation_date": 1530678109, "post_id": 51165616, "comment_id": 89314570, "body": "@Manjunath: but of all the variant I can&#39;t seems to find what is m=+xxxxxx"}, {"owner": {"reputation": 602, "user_id": 3342628, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/eStRY.png?s=128&g=1", "display_name": "Manjunath", "link": "https://stackoverflow.com/users/3342628/manjunath"}, "edited": false, "score": 0, "creation_date": 1530680772, "post_id": 51165616, "comment_id": 89315312, "body": "@Isaac as other answers its location and clock.. for formating you can check this link which has examples <a href=\"https://gobyexample.com/time-formatting-parsing\" rel=\"nofollow noreferrer\">gobyexample.com/time-formatting-parsing</a> and for formats you can refer link before"}], "answers": [{"comments": [{"owner": {"reputation": 1788, "user_id": 4505244, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/34201820/picture?type=large", "display_name": "P Ackerman", "link": "https://stackoverflow.com/users/4505244/p-ackerman"}, "edited": false, "score": 0, "creation_date": 1530678959, "post_id": 51165765, "comment_id": 89314763, "body": "More about monotonic clocks: <a href=\"https://stackoverflow.com/questions/3523442/difference-between-clock-realtime-and-clock-monotonic\" title=\"difference between clock realtime and clock monotonic\">stackoverflow.com/questions/3523442/&hellip;</a>"}, {"owner": {"reputation": 8210, "user_id": 9816472, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DltvK.jpg?s=128&g=1", "display_name": "Isaac", "link": "https://stackoverflow.com/users/9816472/isaac"}, "edited": false, "score": 0, "creation_date": 1530682529, "post_id": 51165765, "comment_id": 89315866, "body": "@StephenWeinberg: The reason for this question is that I was following the tutorial from udemy and the instructor&#39;s <code>time.now()</code> is different from my output."}, {"owner": {"reputation": 8210, "user_id": 9816472, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DltvK.jpg?s=128&g=1", "display_name": "Isaac", "link": "https://stackoverflow.com/users/9816472/isaac"}, "edited": false, "score": 0, "creation_date": 1530682632, "post_id": 51165765, "comment_id": 89315909, "body": "Correct me if im wrong, since both of us did not specify any specific format, I was expecting a <code>standard&#47;base</code> format by <code>date.Now()</code>"}], "tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": false, "score": 1, "last_activity_date": 1530678463, "creation_date": 1530678463, "answer_id": 51165765, "question_id": 51165616, "link": "https://stackoverflow.com/questions/51165616/unexpected-output-from-time-time/51165765#51165765", "title": "Unexpected output from time.Time", "body": "<p>The +08 is the string returned by <code>t.Location().String()</code>. Locations are given a string on creation which is used to identify it. It could be IST, or it can be \"+08\" or any other string you can think of.</p>\n\n<p>The m=+0.002000201 is the monotonic clock. It is used for more accurate durations. For more information on Go's monotonic clock implementations, see <a href=\"https://golang.org/pkg/time/#hdr-Monotonic_Clocks\" rel=\"nofollow noreferrer\">https://golang.org/pkg/time/#hdr-Monotonic_Clocks</a>.</p>\n\n<p>As for the reason the monotonic clock shows up in <code>t.String()</code>:</p>\n\n<blockquote>\n  <p>For debugging, the result of t.String does include the monotonic clock reading if present. If t != u because of different monotonic clock readings, that difference will be visible when printing t.String() and u.String().</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 6, "last_activity_date": 1530689351, "creation_date": 1530689351, "answer_id": 51168112, "question_id": 51165616, "link": "https://stackoverflow.com/questions/51165616/unexpected-output-from-time-time/51168112#51168112", "title": "Unexpected output from time.Time", "body": "<blockquote>\n  <p>The question is, why the same command <code>date.Now()</code> is returning different format between the instructor's program and mine? </p>\n</blockquote>\n\n<p>Because the tutorial was created before the release of Go 1.9.  As of Go 1.9, <a href=\"https://golang.org/doc/go1.9#monotonic-time\" rel=\"noreferrer\">monotonic clock support</a> was added to the <code>time.Time</code> struct, which added those extra fields.</p>\n\n<p>For normal usage, you should always output time using the <a href=\"https://golang.org/pkg/time/#Time.Format\" rel=\"noreferrer\">Format</a> function, rather than outputting the raw data. This will produce more useful output, and be protected against any future additions to the underlying type.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 5, "last_activity_date": 1530692129, "last_edit_date": 1530692129, "creation_date": 1530691476, "answer_id": 51168702, "question_id": 51165616, "link": "https://stackoverflow.com/questions/51165616/unexpected-output-from-time-time/51168702#51168702", "title": "Unexpected output from time.Time", "body": "<p>Your Udemy tutorial video is out-of-date. Go is continually updated. For example, a monotonic clock bug fix:</p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/doc/go1.9\" rel=\"nofollow noreferrer\">Go 1.9 Release Notes (August 2017)</a></p>\n  \n  <p><a href=\"https://golang.org/doc/go1.9#monotonic-time\" rel=\"nofollow noreferrer\">Transparent Monotonic Time support</a></p>\n  \n  <p>The time package now transparently tracks monotonic time in each Time\n  value, making computing durations between two Time values a safe\n  operation in the presence of wall clock adjustments. See the package\n  docs and design document for details.</p>\n  \n  <p>As always, there are various minor changes and updates to the library,\n  made with the Go 1 promise of compatibility in mind.</p>\n  \n  <p>time</p>\n  \n  <p>If a Time value has a monotonic clock reading, its string\n  representation (as returned by String) now includes a final field\n  \"m=\u00b1value\", where value is the monotonic clock reading formatted as a\n  decimal number of seconds.</p>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">Package time</a></p>\n  \n  <p><code>import \"time\"</code> </p>\n  \n  <p>The Time returned by time.Now contains a monotonic clock reading. If\n  Time t has a monotonic clock reading, t.Add adds the same duration to\n  both the wall clock and monotonic clock readings to compute the\n  result. Because t.AddDate(y, m, d), t.Round(d), and t.Truncate(d) are\n  wall time computations, they always strip any monotonic clock reading\n  from their results. Because t.In, t.Local, and t.UTC are used for\n  their effect on the interpretation of the wall time, they also strip\n  any monotonic clock reading from their results. The canonical way to\n  strip a monotonic clock reading is to use t = t.Round(0).</p>\n</blockquote>\n\n<hr>\n\n<p><code>fmt.Println(t)</code> uses a debugging format so it prints all the underlying <code>time.Time</code> fields.</p>\n\n<blockquote>\n  <p>The canonical way to strip a monotonic clock reading is to use t =\n  t.Round(0).</p>\n</blockquote>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    t := time.Now()\n    fmt.Println(t)\n    fmt.Println(t.Round(0))\n\n    t2 := time.Now().Round(0)\n    fmt.Println(t2)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/p_pjRWRB8_y\" rel=\"nofollow noreferrer\">https://play.golang.org/p/p_pjRWRB8_y</a></p>\n\n<p>Output:</p>\n\n<pre><code>2009-11-10 23:00:00 +0000 UTC m=+0.000000001\n2009-11-10 23:00:00 +0000 UTC\n2009-11-10 23:00:00 +0000 UTC\n</code></pre>\n"}], "owner": {"reputation": 8210, "user_id": 9816472, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DltvK.jpg?s=128&g=1", "display_name": "Isaac", "link": "https://stackoverflow.com/users/9816472/isaac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 475, "favorite_count": 2, "accepted_answer_id": 51168112, "answer_count": 3, "score": 4, "last_activity_date": 1531026006, "creation_date": 1530677272, "last_edit_date": 1531026006, "question_id": 51165616, "link": "https://stackoverflow.com/questions/51165616/unexpected-output-from-time-time", "title": "Unexpected output from time.Time", "body": "<p>I just started to learn Go by following a tutorial video on Udemy, and I tried to print the current time as below</p>\n\n<pre><code>import (\n  \"fmt\" \n  \"time\"\n)\n\nfunc main(){\n  t := time.Now()\n\n  fmt.Println(t) \n}\n</code></pre>\n\n<p>And I get a very long text as the output as below</p>\n\n<pre><code>2018-07-04 12:03:07.2911671 +0800 +08 m=+0.002000201\n</code></pre>\n\n<p>I was expecting to get only the <code>+0800</code> followed by a <code>timeZone</code> and that should be the end of it. The expected output is shown below and as it was shown in the tutorial video, too. But for me, the result is in much longer form.</p>\n\n<pre><code>2018-07-04 12:03:07.2911671 +0530 IST\n</code></pre>\n\n<p>The question is, why does the same command <code>date.Now()</code> return different formats between the instructor's program and mine? Why is there no specific format being set, shouldn't a <code>standardize/base</code> format being returned instead?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1530691206, "post_id": 51164206, "comment_id": 89320098, "body": "We can&#39;t answer this without knowing which operating system you&#39;re using.  We also aren&#39;t going to write your code for you. Show your attempt, and explain what specific problems you&#39;re having."}], "answers": [{"comments": [{"owner": {"reputation": 480, "user_id": 9448870, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ckK5P.jpg?s=128&g=1", "display_name": "Daniel Sch&#252;tte", "link": "https://stackoverflow.com/users/9448870/daniel-sch%c3%bctte"}, "edited": false, "score": 0, "creation_date": 1531011088, "post_id": 51165016, "comment_id": 89435994, "body": "On macOS, you can achieve the same thing with <code>xterm -e &lt;program&gt;</code> and after installing <code>urxvt</code> with homebrew, <code>urxvt -e &lt;program&gt;</code>. The native xterm (and urxvt) windows look kinda ugly so you might want to customize them by specifying a couple more options ;)"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 5, "last_activity_date": 1530671467, "creation_date": 1530671467, "answer_id": 51165016, "question_id": 51164206, "link": "https://stackoverflow.com/questions/51164206/open-new-console-window/51165016#51165016", "title": "Open new console window", "body": "<p>The below code would work on Ubuntu, it is a sample program that echoes the input unless you type \"new console\" in which case executes itself again in a separate console.</p>\n\n<p>It does that by executing:</p>\n\n<pre><code>gnome-terminal -e &lt;program&gt;\n</code></pre>\n\n<p>Note that this might be OS specific, as each OS flavour would have a different way of opening a new shell window.</p>\n\n<p>For example, in Windows it seems the same can be achieved using:</p>\n\n<pre><code>cmd /C start &lt;program&gt;\n</code></pre>\n\n<p>(though I am not able to test that right now)</p>\n\n<p>Sample working program for Ubuntu:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"bufio\"\n    \"os\"\n    \"os/exec\"\n    \"log\"\n)\n\nfunc main() {\n    progPath, err := os.Executable()\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(`Enter text to echo (or \"new console\" to open a new console)`)\n    scanner := bufio.NewScanner(os.Stdin)\n    for scanner.Scan() {\n        text := scanner.Text()\n        if text == \"new console\" {\n            cmd:= exec.Command(\"gnome-terminal\",\"-e\", progPath)\n            cmd.Start()\n        } else {\n            fmt.Println(scanner.Text())\n        }\n        fmt.Println(`Enter text to echo (or \"new console\" to open a new console)`)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 499, "user_id": 9903859, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8956511dc438a5e2302451a556171723?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas", "link": "https://stackoverflow.com/users/9903859/nicholas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 967, "favorite_count": 1, "accepted_answer_id": 51165016, "answer_count": 1, "score": -2, "last_activity_date": 1530691232, "creation_date": 1530662478, "last_edit_date": 1530691232, "question_id": 51164206, "link": "https://stackoverflow.com/questions/51164206/open-new-console-window", "title": "Open new console window", "body": "<p>What is some code I can use so that my golang program can open a new console window? </p>\n\n<p>I have one program A running program B, and so there is no console window for program B (the stdin and stdout is used for interaction with program A). I want program B to display user-friendly information in a new console window (along with program A\u2019s console window) so that it is easy to see what is going on.</p>\n"}, {"tags": ["go", "gorilla"], "answers": [{"tags": [], "owner": {"reputation": 5105, "user_id": 373815, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBPZK.png?s=128&g=1", "display_name": "chuckx", "link": "https://stackoverflow.com/users/373815/chuckx"}, "is_accepted": true, "score": 4, "last_activity_date": 1564163174, "last_edit_date": 1564163174, "creation_date": 1530663828, "answer_id": 51164341, "question_id": 51162055, "link": "https://stackoverflow.com/questions/51162055/what-is-the-difference-between-pathprefix-and-handlepathstring-in-goril/51164341#51164341", "title": "What is the difference between PathPrefix() and Handle(pathString, ...) in gorilla/mux?", "body": "<h3>Router vs. Route</h3>\n\n<p><code>Router</code> is a container within which you can register multiple <code>Route</code> instances. The <code>Route</code> interface is largely replicated on <code>Router</code> to enable easy creation of <code>Route</code> instances in the <code>Router</code>. </p>\n\n<p>Note that all of the <code>Router</code> methods that have the same name as a <code>Route</code> method are wrappers around <a href=\"https://github.com/gorilla/mux/blob/cb4698366aa625048f3b815af6a0dea8aef9280a/mux.go#L267\" rel=\"nofollow noreferrer\"><code>Router.NewRoute()</code></a>, which returns a new <code>Route</code> registered to the <code>Router</code> instance. </p>\n\n<p>For comparison, when you call such methods on an existing <code>Route</code> instance, it returns the same instance for chaining method calls.</p>\n\n<h3>PathPrefix() vs. Path()</h3>\n\n<p>When you specify a path using <code>PathPrefix()</code> it has an implicit wildcard at the end.</p>\n\n<p>A quote from <a href=\"http://www.gorillatoolkit.org/pkg/mux#overview\" rel=\"nofollow noreferrer\">the overview section of the documentation</a>:</p>\n\n<blockquote>\n  <p>Note that the path provided to PathPrefix() represents a \"wildcard\": calling PathPrefix(\"/static/\").Handler(...) means that the handler will be passed any request that matches \"/static/*\".</p>\n</blockquote>\n\n<p>On the other hand, when you specify a path using <code>Path()</code>, there's no such implied wildcard suffix. </p>\n\n<h3>Router.Handle() vs. Router.Path().Handler()</h3>\n\n<p><a href=\"https://github.com/gorilla/mux/blob/cb4698366aa625048f3b815af6a0dea8aef9280a/mux.go#L276\" rel=\"nofollow noreferrer\"><code>Router.Handle()</code> is a shortcut for, and therefore equivalent to, executing <code>Router.Path()</code> followed by a call to <code>Route.Handler()</code> on the returned <code>Route</code>.</a> </p>\n\n<p>Note that this is <strong>not the same</strong> as calling <code>Router.PrefixPath()</code> followed by a call to <code>Route.Handler</code>, since <code>Router.Handle()</code> does not provide the wildcard suffix.</p>\n\n<h3>Serving files from a path with a prefix</h3>\n\n<p>For your last example, try changing:</p>\n\n<pre><code>r.PathPrefix(\"/home\").Handler(http.FileServer(http.Dir(dir+\"/public\")))\n</code></pre>\n\n<p>To:</p>\n\n<pre><code>r.PathPrefix(\"/home/\").Handler(http.StripPrefix(\"/home/\", http.FileServer(http.Dir(dir+\"/public\"))))\n</code></pre>\n\n<p>Otherwise, it's trying to serve files from <code>dir + \"/public\" + \"/home/\"</code></p>\n\n<p>An example of this is in <a href=\"http://www.gorillatoolkit.org/pkg/mux#overview\" rel=\"nofollow noreferrer\">the documentation, halfway through the overview</a>.</p>\n"}], "owner": {"reputation": 461, "user_id": 7359470, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3d7fb653bc3eb067f9dd9b2019e653bd?s=128&d=identicon&r=PG&f=1", "display_name": "mofury", "link": "https://stackoverflow.com/users/7359470/mofury"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1675, "favorite_count": 0, "accepted_answer_id": 51164341, "answer_count": 1, "score": 3, "last_activity_date": 1564163174, "creation_date": 1530647913, "last_edit_date": 1530684843, "question_id": 51162055, "link": "https://stackoverflow.com/questions/51162055/what-is-the-difference-between-pathprefix-and-handlepathstring-in-goril", "title": "What is the difference between PathPrefix() and Handle(pathString, ...) in gorilla/mux?", "body": "<p>I noticed that there are two ways to specify a path in the <a href=\"https://github.com/gorilla/mux\" rel=\"nofollow noreferrer\"><code>gorilla/mux</code> router</a>:</p>\n\n<pre><code>r.PathPrefix(\"/api\").Handler(APIHandler)\n</code></pre>\n\n<p>And:</p>\n\n<pre><code>r.Handle(\"/api\", APIHandler)\n</code></pre>\n\n<p>What is the difference?</p>\n\n<p>Also, I don't understand the difference between a router and a route in the context of <code>gorilla/mux</code>.</p>\n\n<p><code>PathPrefix()</code> returns a route, which has a <code>Handler()</code> method. However, we cannot call <code>Handler()</code> on a router, we must call <code>Handle()</code>. </p>\n\n<p>Look at the following example:</p>\n\n<pre><code>r.PathPrefix(\"/\").Handler(http.FileServer(http.Dir(dir+\"/public\")))\n</code></pre>\n\n<p>I am trying to serve static files from a public directory. The above expression works without any problem. My HTML and JavaScript are served as expected. However, once I add something to the path, e.g.</p>\n\n<pre><code>r.PathPrefix(\"/home\").Handler(http.FileServer(http.Dir(dir+\"/public\")))\n</code></pre>\n\n<p>Then I am getting 404, not found error on <code>localhost:&lt;port&gt;/home</code>.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "is_accepted": true, "score": 3, "last_activity_date": 1530650821, "creation_date": 1530650821, "answer_id": 51162614, "question_id": 51161850, "link": "https://stackoverflow.com/questions/51161850/govips-option-struct-how-to-set-a-white-background/51162614#51162614", "title": "govips Option struct how to set a white background", "body": "<pre><code>x := 100 - imgRef.Width()/2\ny := 100 - imgRef.Height()/2\nimg, err := vips.Embed(imgRef.Image(), x, y, 200, 200, vips.InputString(\"extend\", \"white\"))\n</code></pre>\n\n<p>Found it, alleluia!</p>\n"}], "owner": {"reputation": 5905, "user_id": 172754, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/efa5682f70f80f7f60a1d0d0f406a042?s=128&d=identicon&r=PG", "display_name": "Gert Cuykens", "link": "https://stackoverflow.com/users/172754/gert-cuykens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 51162614, "answer_count": 1, "score": 3, "last_activity_date": 1530650821, "creation_date": 1530646895, "question_id": 51161850, "link": "https://stackoverflow.com/questions/51161850/govips-option-struct-how-to-set-a-white-background", "title": "govips Option struct how to set a white background", "body": "<p><a href=\"https://github.com/davidbyttow/govips\" rel=\"nofollow noreferrer\">https://github.com/davidbyttow/govips</a> <code>Option</code></p>\n\n<pre><code>// Option is a type that is passed to internal libvips functions\ntype Option struct {\n    Name   string\n    ref    interface{}\n    gvalue C.GValue\n    closer func(gv *C.GValue)\n    output bool\n}\n</code></pre>\n\n<p>Fail to figure out how I can add a Option to embed in Go to set the white background</p>\n\n<pre><code>x := 100 - imgRef.Width()/2\ny := 100 - imgRef.Height()/2\nimg, err := vips.Embed(imgRef.Image(), x, y, 200, 200, background)\n</code></pre>\n\n<p>I only know it's possible looking at de cli verion, but how to translate it into a Go Option struct is a mystery for me</p>\n\n<pre><code>$ vips embed\nembed an image in a larger image\nusage:\n   embed in out x y width height\nwhere:\n   in           - Input image, input VipsImage\n   out          - Output image, output VipsImage\n   x            - Left edge of input in output, input gint\n                            default: 0\n                            min: -1000000000, max: 1000000000\n   y            - Top edge of input in output, input gint\n                            default: 0\n                            min: -1000000000, max: 1000000000\n   width        - Image width in pixels, input gint\n                            default: 1\n                            min: 1, max: 1000000000\n   height       - Image height in pixels, input gint\n                            default: 1\n                            min: 1, max: 1000000000\noptional arguments:\n   extend       - How to generate the extra pixels, input VipsExtend\n                            default: black\n                            allowed: black, copy, repeat, mirror, white, background\n   background   - Colour for background pixels, input VipsArrayDouble\noperation flags: sequential-unbuffered \n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1530645862, "post_id": 51161150, "comment_id": 89306654, "body": "fmt.Println(val.MapIndex(element)) //get the value"}], "answers": [{"comments": [{"owner": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "edited": false, "score": 0, "creation_date": 1530646546, "post_id": 51161599, "comment_id": 89306894, "body": "O, yes, this is actually it. Thanks!"}], "tags": [], "owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "is_accepted": true, "score": 13, "last_activity_date": 1530645566, "creation_date": 1530645566, "answer_id": 51161599, "question_id": 51161150, "link": "https://stackoverflow.com/questions/51161150/how-to-get-values-of-a-map-interface-with-reflect-in-go/51161599#51161599", "title": "How to get values of a map interface with reflect in Go?", "body": "<p>You were close, you can use the key returned form <code>MapKeys</code> and then use <code>MapIndex</code> to get the value of the map key. Below I use a switch statement to convert the value of the interface to the correct type.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    Schema := map[string]interface{}{}\n    Schema[\"int\"] = 10\n    Schema[\"string\"] = \"this is a string\"\n    Schema[\"bool\"] = false\n\n    val := reflect.ValueOf(Schema)\n    fmt.Println(\"VALUE = \", val)\n    fmt.Println(\"KIND = \", val.Kind())\n\n    if val.Kind() == reflect.Map {\n        for _, e := range val.MapKeys() {\n            v := val.MapIndex(e)\n            switch t := v.Interface().(type) {\n            case int:\n                fmt.Println(e, t)\n            case string:\n                fmt.Println(e, t)\n            case bool:\n                fmt.Println(e, t)\n            default:\n                fmt.Println(\"not found\")\n\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Program Output:</p>\n\n<pre><code>VALUE =  map[int:10 string:this is a string bool:false]\nKIND =  map\nint 10\nstring this is a string\nbool false\n</code></pre>\n"}], "owner": {"reputation": 6046, "user_id": 1501285, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/b742182dd480420da7e0e9fe357b2c04?s=128&d=identicon&r=PG", "display_name": "Bob van Luijt", "link": "https://stackoverflow.com/users/1501285/bob-van-luijt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7346, "favorite_count": 0, "accepted_answer_id": 51161599, "answer_count": 1, "score": 8, "last_activity_date": 1530645566, "creation_date": 1530643421, "question_id": 51161150, "link": "https://stackoverflow.com/questions/51161150/how-to-get-values-of-a-map-interface-with-reflect-in-go", "title": "How to get values of a map interface with reflect in Go?", "body": "<p>I'm struggling to get the value of an interface map in Go.</p>\n\n<pre><code>val := reflect.ValueOf(Schema)\nfmt.Println(\"VALUE = \", val)\nfmt.Println(\"KIND = \", val.Kind())\nif val.Kind() == reflect.Map {\n    fmt.Println(\"len = \", val.Len())\n    for key, element := range val.MapKeys() {\n        fmt.Println(key, element) // how to get the value?\n    }\n}\n</code></pre>\n\n<p>This outputs:</p>\n\n<pre><code>VALUE =  map[testString:foobar testInt:1 testBoolean:true testNumber:1 testDateTime:2017-10-06 08:15:30 +0100 +0100]\nKIND =  map\nlen =  5\n0 testString\n1 testInt\n2 testBoolean\n3 testNumber\n4 testDateTime\n</code></pre>\n\n<p><strong>My question</strong>:<br>\nHow can I get the type and value of the map items?</p>\n"}, {"tags": ["go", "ibm-cloud", "minio"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1530643682, "post_id": 51160321, "comment_id": 89305781, "body": "Looking at the sources, it looks to me this MD5 should be added automatically. Providing it as a custom header like you did, it will not make it to the final outgoing request, but the key will be prefixed by <code>&quot;X-Amz-Meta-&quot;</code> (as can be seen in <a href=\"https://github.com/minio/minio-go/blob/master/api-put-object.go#L91\" rel=\"nofollow noreferrer\">api-put-object.go / Header() method</a>). So to sum it, it&#39;s possible this is a bug, you should report it."}, {"owner": {"reputation": 3, "user_id": 4284517, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c18c440d32774a3aebf61d5b1b724b8?s=128&d=identicon&r=PG&f=1", "display_name": "pacalJ", "link": "https://stackoverflow.com/users/4284517/pacalj"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1530646053, "post_id": 51160321, "comment_id": 89306727, "body": "@icza Thanks. I saw exactly the same thing in the go file you mentioned. I am trying to capture the packet to verify if Content-MD5 is missing in there."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 4284517, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c18c440d32774a3aebf61d5b1b724b8?s=128&d=identicon&r=PG&f=1", "display_name": "pacalJ", "link": "https://stackoverflow.com/users/4284517/pacalj"}, "edited": false, "score": 0, "creation_date": 1531329055, "post_id": 51215851, "comment_id": 89559607, "body": "thanks for the great answer. I figured out the same conclusion as Content-Md5 cannot be set by a user, it will be bypassed and not added to the header, hence causing the error. I modified Minio-go sdk to add compatibility for IBM COS and now it solves the problem. But I agree that it could be a bug in the IBM side."}], "tags": [], "owner": {"reputation": 226, "user_id": 8539654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/957060899c8b5962db2801bb3f21c1f1?s=128&d=identicon&r=PG&f=1", "display_name": "r1j1m1n1", "link": "https://stackoverflow.com/users/8539654/r1j1m1n1"}, "is_accepted": true, "score": 0, "last_activity_date": 1530901079, "creation_date": 1530901079, "answer_id": 51215851, "question_id": 51160321, "link": "https://stackoverflow.com/questions/51160321/how-can-i-set-content-md5-header-in-minio-sdk-for-uploading-to-ibm-cloud-object/51215851#51215851", "title": "How can I set Content-MD5 header in Minio SDK for uploading to IBM Cloud Object Storage?", "body": "<p>@pacalj If you look at AWS documentation for <code>PutObject</code> <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/API/RESTObjectPUT.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/AmazonS3/latest/API/RESTObjectPUT.html</a> . <code>Content-MD5</code> is not a required field. Meaning if it is not set by the client, the server should not error out, as you have already seen with AWS S3. As far as <code>minio-go</code> sdk is concerned, <code>content-MD5</code> cannot be set via <code>PutObjectOptions</code> as explained in <a href=\"https://docs.minio.io/docs/golang-client-api-reference#FPutObject\" rel=\"nofollow noreferrer\">https://docs.minio.io/docs/golang-client-api-reference#FPutObject</a></p>\n\n<p>Minio-go sets <code>X-Amz-Content-Sha256</code> in the case of <code>http</code> connection and <code>Content-Md5</code> in the case of <code>https</code> connections. Minio-go's <code>FPutObject</code> and <code>PutObject</code> api abstracts both <code>multi-part put</code> and <code>single part put</code> into these APIs. In the case of <code>multi-part</code> PUT, each part will set either <code>X-Amz-Content-Sha256</code> or <code>Content-Md5</code> depending on the type of connection. Since the call is abstracted, it is not possible for a user to set <code>Content-Md5</code>. </p>\n\n<p>I believe <code>IBM Cloud Object Storage</code> has a bug as it should not error out, even if <code>Content-Md5</code> is not set.</p>\n"}], "owner": {"reputation": 3, "user_id": 4284517, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c18c440d32774a3aebf61d5b1b724b8?s=128&d=identicon&r=PG&f=1", "display_name": "pacalJ", "link": "https://stackoverflow.com/users/4284517/pacalj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1055, "favorite_count": 0, "accepted_answer_id": 51215851, "answer_count": 1, "score": 0, "last_activity_date": 1530901079, "creation_date": 1530639921, "question_id": 51160321, "link": "https://stackoverflow.com/questions/51160321/how-can-i-set-content-md5-header-in-minio-sdk-for-uploading-to-ibm-cloud-object", "title": "How can I set Content-MD5 header in Minio SDK for uploading to IBM Cloud Object Storage?", "body": "<p>I am trying to set the Content-MD5 header when I use Minio Golang SDK to upload a file to S3. I can successfully upload files to AWS without setting Content-MD5, but uploading to IBM Cloud Object Storage fails with the following error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>ERR: Object write failed, reason: Missing required header for this request: Content-MD5\n</code></pre>\n\n<p>According to the Minio SDK,<br><a href=\"https://docs.minio.io/docs/golang-client-api-reference#FPutObject\" rel=\"nofollow noreferrer\">https://docs.minio.io/docs/golang-client-api-reference#FPutObject</a><br>I use the UserMetadata field in minio.PutObjectOptions to set Content-MD5, but IBM Cloud Object Storage keeps complaining missing MD5, am I doing something wrong in the following code?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (cloudIO *CloudIO) FWrite(name string) (n int, err error) {\n    f, err := os.Open(name)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer f.Close()\n\n    h := md5.New()\n    if _, err := io.Copy(h, f); err != nil {\n        log.Fatal(err)\n    }\n\n    bytesWritten, err := cloudIO.client.FPutObject(cloudIO.bucket, cloudIO.address,\n        name,\n        minio.PutObjectOptions{UserMetadata: map[string]string{\"Content-MD5\": hex.EncodeToString(h.Sum(nil))}})\n    return int(bytesWritten), err\n}\n</code></pre>\n"}, {"tags": ["go", "parallel-processing"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530629218, "post_id": 51157337, "comment_id": 89298214, "body": "If you want the results ordered the same as the inputs, give them an index of some kind and sort them when all results are ready. The order of concurrent operations is non-deterministic."}, {"owner": {"reputation": 1178, "user_id": 3967945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d671333d111810416ba4952f1da75c1?s=128&d=identicon&r=PG", "display_name": "mroman", "link": "https://stackoverflow.com/users/3967945/mroman"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530629431, "post_id": 51157337, "comment_id": 89298336, "body": "Waiting for <b>all</b> results to be ready is infeasible if you have gigabytes of data. One could of course split it into smaller chunks, process them, then sort those smaller chunks. Of course, you can also send things as &quot;batches of computations&quot; in my version as well. (I.e. send an array of ints, but of course, this is just demo)."}, {"owner": {"reputation": 1178, "user_id": 3967945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d671333d111810416ba4952f1da75c1?s=128&d=identicon&r=PG", "display_name": "mroman", "link": "https://stackoverflow.com/users/3967945/mroman"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530629571, "post_id": 51157337, "comment_id": 89298428, "body": "&gt; The order of concurrent operations is non-deterministic.   That&#39;s certainly true of course. You might have computations that can be split into a part that you can run independently of each other but then have to process the results in a way where the order of the results is important and must be the same as the ordering of the input values."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530629816, "post_id": 51157337, "comment_id": 89298583, "body": "Correct. Some synchronization is required to deliver a predefined order of results. Either you do everything sequentially in a single thread; you do everything multi-threaded then sort in a single thread, or you do everything in batches as you suggested, sorting the batches serially in a single thread, and using locking to ensure batches are delivered in order. Anything you try to do to achieve predictable ordering of concurrent operations requires synchronization, increasing complexity and reducing concurrency."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530629923, "post_id": 51157337, "comment_id": 89298652, "body": "So you cannot, as the question title says, &quot;Serialize goroutines (parallelize but guarantee ordering)&quot;. You cannot have your cake and eat it too: either it&#39;s synchronous <i>or</i> parallel; either it&#39;s guaranteed order <i>or</i> asynchronous."}, {"owner": {"reputation": 1178, "user_id": 3967945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d671333d111810416ba4952f1da75c1?s=128&d=identicon&r=PG", "display_name": "mroman", "link": "https://stackoverflow.com/users/3967945/mroman"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530630120, "post_id": 51157337, "comment_id": 89298788, "body": "Yes, but just because your second stage of your processing pipline requires things &quot;in order&quot; doesn&#39;t mean that you can&#39;t parallelize the first pre-processing step. My code serializes read and writes to/from the channels but the actual computation is still parallel. That&#39;s what I mean with &quot;serialize&quot;."}, {"owner": {"reputation": 1178, "user_id": 3967945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d671333d111810416ba4952f1da75c1?s=128&d=identicon&r=PG", "display_name": "mroman", "link": "https://stackoverflow.com/users/3967945/mroman"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530630162, "post_id": 51157337, "comment_id": 89298828, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/174272/discussion-between-mroman-and-adrian\">continue this discussion in chat</a>."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1530642308, "post_id": 51157337, "comment_id": 89305166, "body": "If you need to maintain order channels is probs not the best thing to use then, however if you did want to use channels you can do something like this <a href=\"https://goplay.space/#VmVXYh2bHVk\" rel=\"nofollow noreferrer\">goplay.space/#VmVXYh2bHVk</a>, additionally you can use channels and send the results to a redis zset where you can specify the zscore and let redis do the sorting for you."}, {"owner": {"reputation": 1178, "user_id": 3967945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d671333d111810416ba4952f1da75c1?s=128&d=identicon&r=PG", "display_name": "mroman", "link": "https://stackoverflow.com/users/3967945/mroman"}, "edited": false, "score": 0, "creation_date": 1530690683, "post_id": 51157337, "comment_id": 89319855, "body": "One use case is when you have a file containing json data that you need to process using some &quot;analysis function&quot; that is order sensitive (meaning A,B won&#39;t produce the same result as B,A) and you can at least perform the unmarshalling in parallel to speed things up greatly. The unmarshalled entries are then feed through the &quot;analysis function&quot; in the same order as they were in the file."}], "answers": [{"comments": [{"owner": {"reputation": 1178, "user_id": 3967945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d671333d111810416ba4952f1da75c1?s=128&d=identicon&r=PG", "display_name": "mroman", "link": "https://stackoverflow.com/users/3967945/mroman"}, "edited": false, "score": 0, "creation_date": 1530691803, "post_id": 51158867, "comment_id": 89320383, "body": "Thank you very much for your input. This looks great. While looking at it I had another idea which basically revolves around one buffering results and once you have the result with the next index you send it to the result chan. (Essentially how you order UDP packets with packet numbers. You buffer packets that have a packet number &gt; next packet and once you receive the packet that is supposed to be next you process it then scan forward in the buffer until the first &quot;gap&quot; and then rinse and repeat)."}, {"owner": {"reputation": 1178, "user_id": 3967945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d671333d111810416ba4952f1da75c1?s=128&d=identicon&r=PG", "display_name": "mroman", "link": "https://stackoverflow.com/users/3967945/mroman"}, "edited": false, "score": 0, "creation_date": 1530691840, "post_id": 51158867, "comment_id": 89320406, "body": "I think I&#39;ll construct some benchmark case and then try all the methods mentioned here in the comments/answers and publish the results. Would be interesting to see what gets the most throughput."}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "reply_to_user": {"reputation": 1178, "user_id": 3967945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d671333d111810416ba4952f1da75c1?s=128&d=identicon&r=PG", "display_name": "mroman", "link": "https://stackoverflow.com/users/3967945/mroman"}, "edited": false, "score": 0, "creation_date": 1530692720, "post_id": 51158867, "comment_id": 89320916, "body": "Great ideas, I had a similar kind of &quot;buffering&quot; idea in mind; omitted for simplicity. But may well work great. I hoped the idea above would be flexible enough to incorporate these optimisations easily!"}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 1, "last_activity_date": 1530633753, "creation_date": 1530633753, "answer_id": 51158867, "question_id": 51157337, "link": "https://stackoverflow.com/questions/51157337/serialize-goroutines-parallelize-but-guarantee-ordering/51158867#51158867", "title": "Serialize goroutines (parallelize but guarantee ordering)", "body": "<p>If I understand correctly this is the version of your code that uses a \"pipeline\" style. Where there are a number of steps in the pipeline:</p>\n\n<ol>\n<li>Sending the src values</li>\n<li>Workers that do work in the received src values, sending to their own results channel</li>\n<li>Merging the slice of results channels from the workers into a single unordered channel</li>\n<li>Ordering the unordered values from the unordered merged channel</li>\n</ol>\n\n<p>Here is the code, it uses the Indexed pair style that you mention in the edits to your original question.</p>\n\n<pre><code>type idxPair struct {\n    idx, val int\n}\n\nfunc main() {\n    // add a done channel, an ability to stop the world by closing this.\n    done := make(chan struct{})\n    defer close(done)\n\n    // create srcChan, this will be where the values go into the pipeline\n    srcCh := make(chan idxPair)\n\n    // create a slice of result channels, one for each of the go workers\n    const numWorkers = 8\n    resChans := make([]&lt;-chan idxPair, numWorkers)\n\n    // waitgroup to wait for all the workers to stop\n    var wg sync.WaitGroup\n    wg.Add(numWorkers)\n\n    // start the workers, passing them each the src channel,\n    // collecting the result channels they return\n    for i := 0; i &lt; numWorkers; i++ {\n        resChans[i]  = worker(done, &amp;wg, srcCh)\n    }\n\n    // start a single goroutine to send values into the pipeline\n    // all values are sent with an index, to be pieces back into order at the end.\n    go func() {\n        defer close(srcCh)\n        for i := 1; i &lt; 100; i++ {\n            srcCh &lt;- idxPair{idx: i, val: i}\n        }\n    }()\n\n    // merge all the results channels into a single results channel\n    // this channel is unordered.\n    mergedCh := merge(done, resChans...)\n\n    // order the values coming from the mergedCh according the the idxPair.idx field.\n    orderedResults := order(100, mergedCh)\n\n    // iterate over each of the ordered results\n    for _, v := range orderedResults {\n        fmt.Println(v)\n    }\n}\n\nfunc order(len int, res &lt;-chan idxPair) []int {\n    results := make([]int, len)\n\n    // collect all the values to order them\n    for r := range res {\n        results[r.idx] = r.val\n    }\n\n    return results\n}\n\nfunc worker(done &lt;- chan struct{}, wg *sync.WaitGroup, src &lt;-chan idxPair) &lt;-chan idxPair {\n    res := make(chan idxPair)\n\n    go func() {\n        defer wg.Done()\n        defer close(res)\n        sendValue := func(pair idxPair) {\n            v := pair.val\n            v *= v\n            ip := idxPair{idx: pair.idx, val: v}\n            select {\n            case res &lt;- ip:\n            case &lt;-done:\n            }\n        }\n\n        for v := range src{\n             sendValue(v)\n        }\n    }()\n\n    return res\n}\n\n\n// example and explanation here: https://blog.golang.org/pipelines\nfunc merge(done &lt;-chan struct{}, cs ...&lt;-chan idxPair) &lt;-chan idxPair {\n    var wg sync.WaitGroup\n    out := make(chan idxPair)\n\n    output := func(c &lt;-chan idxPair) {\n        defer wg.Done()\n        for n := range c {\n            select {\n            case out &lt;- n:\n            case &lt;-done:\n                return\n            }\n        }\n    }\n    wg.Add(len(cs))\n    for _, c := range cs {\n        go output(c)\n    }\n\n    go func() {\n        wg.Wait()\n        close(out)\n    }()\n    return out\n}\n</code></pre>\n\n<p>The reason that I think this is slightly cleaner and not just \"different for the sake of it\", is because:</p>\n\n<ol>\n<li>You can model and implement each of the stages independently. The <code>order</code> stage can be easily optimised to send values through a channel when they are received etc.</li>\n<li>It's much more composable; instead of one large method that operates on a number of channels stored in arrays, you can do async work on elements and leave the ordering as something elses resposibility. This promotes reuse.</li>\n</ol>\n"}], "owner": {"reputation": 1178, "user_id": 3967945, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d671333d111810416ba4952f1da75c1?s=128&d=identicon&r=PG", "display_name": "mroman", "link": "https://stackoverflow.com/users/3967945/mroman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1530633753, "creation_date": 1530628912, "last_edit_date": 1530630809, "question_id": 51157337, "link": "https://stackoverflow.com/questions/51157337/serialize-goroutines-parallelize-but-guarantee-ordering", "title": "Serialize goroutines (parallelize but guarantee ordering)", "body": "<p>Let's say we want to process some computations in parallel but we have to guarantee that the ordering of the results is the same as the ordering of computations:</p>\n\n<p>This can be done through for example:</p>\n\n<p><a href=\"https://play.golang.org/p/jQbo0EVLzvX\" rel=\"nofollow noreferrer\">https://play.golang.org/p/jQbo0EVLzvX</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    orderPutChans := make([]chan bool, 8)\n    orderGetChans := make([]chan bool, 8)\n    doneChans := make([]chan bool, 8)\n\n    for i := 0; i &lt; 8; i++ {\n        orderPutChans[i] = make(chan bool, 1)\n        orderGetChans[i] = make(chan bool)\n        doneChans[i] = make(chan bool)\n    }\n\n    srcCh := make(chan int)\n    dstCh := make(chan int)\n\n    for i := 0; i &lt; 8; i++ {\n        go func(j int) {\n            myGetCh := orderGetChans[j]\n            nextGetCh := orderGetChans[(j+1) % 8]\n            myPutCh := orderPutChans[j]\n            nextPutCh := orderPutChans[(j+1) % 8]\n\n            for {\n                _ = &lt;- myGetCh\n\n                v, ok := &lt;- srcCh\n\n                if !ok {\n                    k := (j + 1) % 8\n                    if orderGetChans[k] != nil {\n                            orderGetChans[k] &lt;- true\n                    }\n                    orderGetChans[j] = nil\n\n                    break\n                }\n\n                nextGetCh &lt;- true\n\n                time.Sleep(1000)\n\n                v *= v\n\n                _ = &lt;- myPutCh\n\n                dstCh &lt;- v\n\n                nextPutCh &lt;- true\n            }\n\n            doneChans[j] &lt;- true\n        }(i)\n    }\n\n    go func() {\n        for i := 0; i &lt; 8; i++ {\n            _ = &lt;- doneChans[i]\n        }\n        close(dstCh)\n    }()\n\n    orderGetChans[0] &lt;- true\n    orderPutChans[0] &lt;- true\n\n    go func() {\n        for i := 0; i &lt; 100; i++ {\n            srcCh &lt;- i\n        }\n        close(srcCh)\n    }()\n\n    for vv := range dstCh {\n        fmt.Println(vv)\n    }\n}\n</code></pre>\n\n<p>One can use channels to pass around read/write permissions for the channels. The code is messy and doesn't look very tidy. Is there a cleaner way in Go to achieve that?</p>\n\n<p><strong>Edit</strong>:\nI'm not asking for \"simple\" replacements such as using <code>chan struct{}</code> or using <code>close</code> on <code>doneChans</code> in favor of <code>doneChans[i] &lt;- true</code>.</p>\n\n<p><strong>Edit2</strong>:</p>\n\n<p>A much simpler approach (at least as far as code is concerned) would be to have a <code>results</code> array and the consumer sends the data together with an index (which is going to be mod number of workers) and goroutines write the result to <code>results[j]</code> and then have a WaitGroup to wait until all are done (with one batch of many batches) and then iterate through the results and send them to the destination channel. (Maybe not so good due to false sharing?)</p>\n"}, {"tags": ["date", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530628076, "post_id": 51157052, "comment_id": 89297501, "body": "Pass in the location (time zone) you want to receive the resulting <code>time.Time</code> in, e.g. <a href=\"https://golang.org/pkg/time/#Location\" rel=\"nofollow noreferrer\"><code>time.UTC</code></a>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1530628183, "post_id": 51157052, "comment_id": 89297586, "body": "Or if you want the result in your local time zone, use (pass) <code>time.Local</code>."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 6, "last_activity_date": 1530636248, "last_edit_date": 1530636248, "creation_date": 1530635767, "answer_id": 51159360, "question_id": 51157052, "link": "https://stackoverflow.com/questions/51157052/how-to-get-time-time-from-civil-datetime/51159360#51159360", "title": "How to get time.Time from civil.Datetime", "body": "<p>Use whatever <code>time.Location</code> makes sense for your application. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n\n    \"cloud.google.com/go/civil\"\n)\n\nfunc main() {\n    now := time.Now().Round(0)\n    fmt.Println(now, \" : time Now\")\n    d := civil.DateTimeOf(now)\n    fmt.Println(d, \"           : civil DateTime\")\n    t := d.In(time.UTC)\n    fmt.Println(t, \" : time UTC\")\n    t = d.In(time.Local)\n    fmt.Println(t, \" : time Local\")\n    pacific, err := time.LoadLocation(\"America/Los_Angeles\")\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n    t = d.In(pacific)\n    fmt.Println(t, \" : time Pacific\")\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2018-07-03 12:46:15.728611385 -0400 EDT  : time Now\n2018-07-03T12:46:15.728611385            : civil DateTime\n2018-07-03 12:46:15.728611385 +0000 UTC  : time UTC\n2018-07-03 12:46:15.728611385 -0400 EDT  : time Local\n2018-07-03 12:46:15.728611385 -0700 PDT  : time Pacific\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 36, "user_id": 12262182, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-BAifSpcqQuk/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfmaDNUe2rpFKcAQAjV5Yp7gGlF9g/photo.jpg?sz=128", "display_name": "NicoGonzaMu", "link": "https://stackoverflow.com/users/12262182/nicogonzamu"}, "is_accepted": false, "score": 0, "last_activity_date": 1571837550, "last_edit_date": 1571837550, "creation_date": 1571826465, "answer_id": 58520790, "question_id": 51157052, "link": "https://stackoverflow.com/questions/51157052/how-to-get-time-time-from-civil-datetime/58520790#58520790", "title": "How to get time.Time from civil.Datetime", "body": "<p>In addition to @peterSO's answer, if you just don't want to depend on the machine's region time, you can convert to <code>string</code> and then again to <code>time.Time</code>:</p>\n\n<pre><code>t, err := time.Parse(\"2006-01-02\", myCivilDateTime.Date.String())\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/MW9DrQ89Mwu\" rel=\"nofollow noreferrer\">https://play.golang.org/p/MW9DrQ89Mwu</a></p>\n"}], "owner": {"reputation": 53, "user_id": 7629314, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HMfx4.jpg?s=128&g=1", "display_name": "Ivan Coleto", "link": "https://stackoverflow.com/users/7629314/ivan-coleto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 989, "favorite_count": 1, "accepted_answer_id": 51159360, "answer_count": 2, "score": 4, "last_activity_date": 1571837550, "creation_date": 1530627960, "last_edit_date": 1530639160, "question_id": 51157052, "link": "https://stackoverflow.com/questions/51157052/how-to-get-time-time-from-civil-datetime", "title": "How to get time.Time from civil.Datetime", "body": "<p>I have to use the civil.Datetime due to a Query response from a Bigquery database.</p>\n\n<p>How can I get a time.Time date from civil.Datetime in Golang?</p>\n\n<p>Something like:</p>\n\n<pre><code>var date time.Time = civil.ToTime(myCivilTime)\n</code></pre>\n\n<p>I checked the civil time docs : <a href=\"https://godoc.org/cloud.google.com/go/civil\" rel=\"nofollow noreferrer\">https://godoc.org/cloud.google.com/go/civil</a> and there is a function that seems to make what I'm asking.</p>\n\n<pre><code>func (d Date) In(loc *time.Location) time.Time\n</code></pre>\n\n<p>But I am not sure about how should I set the *time.Location param.</p>\n"}, {"tags": ["go", "go-pg"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 1, "creation_date": 1530626110, "post_id": 51156305, "comment_id": 89296147, "body": "loop through array and convert to string with delimiter <code>,</code>"}, {"owner": {"reputation": 93, "user_id": 1989863, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3397588b77ce50008a7f19b4e1a2aa37?s=128&d=identicon&r=PG&f=1", "display_name": "XZen", "link": "https://stackoverflow.com/users/1989863/xzen"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1530626502, "post_id": 51156305, "comment_id": 89296442, "body": "@Himanshu this way if i got u correctly I&#39;ll get <code>id IN (&#39;7,45&#39;)</code> which is not what I need"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1530627463, "post_id": 51156305, "comment_id": 89297077, "body": "Use <a href=\"https://godoc.org/github.com/go-pg/pg#Array\" rel=\"nofollow noreferrer\">pg.Array</a>?"}], "answers": [{"comments": [{"owner": {"reputation": 93, "user_id": 1989863, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3397588b77ce50008a7f19b4e1a2aa37?s=128&d=identicon&r=PG&f=1", "display_name": "XZen", "link": "https://stackoverflow.com/users/1989863/xzen"}, "edited": false, "score": 0, "creation_date": 1530626750, "post_id": 51156543, "comment_id": 89296596, "body": "When I do this I get the following generated query: <code>SELECT id FROM bar WHERE code_id IN (&#39;7,45&#39;)</code>"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 93, "user_id": 1989863, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3397588b77ce50008a7f19b4e1a2aa37?s=128&d=identicon&r=PG&f=1", "display_name": "XZen", "link": "https://stackoverflow.com/users/1989863/xzen"}, "edited": false, "score": 0, "creation_date": 1530627010, "post_id": 51156543, "comment_id": 89296774, "body": "@XZen No you will not when you create a query using that. Please check updated answer with query generated."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1530627202, "post_id": 51156543, "comment_id": 89296905, "body": "Same function with reduction in memory allocation: <a href=\"https://play.golang.org/p/JuXR-P8prEd\" rel=\"nofollow noreferrer\">play.golang.org/p/JuXR-P8prEd</a>"}, {"owner": {"reputation": 93, "user_id": 1989863, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3397588b77ce50008a7f19b4e1a2aa37?s=128&d=identicon&r=PG&f=1", "display_name": "XZen", "link": "https://stackoverflow.com/users/1989863/xzen"}, "edited": false, "score": 0, "creation_date": 1530627232, "post_id": 51156543, "comment_id": 89296929, "body": "@Himanshu, got it, but my goal is to use go-pg and it&#39;s placeholders feature, so that I could avoid strings manipulations, which is not the safest way to build queries. If there&#39;s no way to do it using go-pg it&#39;ll be sad and I&#39;ll go with the way like one you&#39;ve just provided, thank you."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 93, "user_id": 1989863, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3397588b77ce50008a7f19b4e1a2aa37?s=128&d=identicon&r=PG&f=1", "display_name": "XZen", "link": "https://stackoverflow.com/users/1989863/xzen"}, "edited": false, "score": 0, "creation_date": 1530627357, "post_id": 51156543, "comment_id": 89297003, "body": "@XZen you can still add string and pass it to sql query you are creating it dynamically"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 93, "user_id": 1989863, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3397588b77ce50008a7f19b4e1a2aa37?s=128&d=identicon&r=PG&f=1", "display_name": "XZen", "link": "https://stackoverflow.com/users/1989863/xzen"}, "edited": false, "score": 0, "creation_date": 1530627941, "post_id": 51156543, "comment_id": 89297401, "body": "@XZen Check updated answer for your question. you can bind an array directly."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": -1, "last_activity_date": 1530628322, "last_edit_date": 1530628322, "creation_date": 1530626464, "answer_id": 51156543, "question_id": 51156305, "link": "https://stackoverflow.com/questions/51156305/pass-array-to-go-pg-query/51156543#51156543", "title": "pass array to go-pg query", "body": "<p>A way is to create a string with delimiter required to make an string and then pass it to the <code>db.query</code> to fetch the result.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc main() {\n    a := []int{7,45,32}\n    str := ConvertToString(a, \",\")\n    query := `Select * from table1 where ID IN(`+ str +`)`\n    fmt.Println(query)\n}\n\nfunc ConvertToString(a []int, delim string) string{\n    var b string\n    for _, v := range a{\n        b += strconv.Itoa(v)\n        b += \",\"\n    }\n    return strings.Trim(b,\",\")\n}\n</code></pre>\n\n<p>Working code on <a href=\"http://jmoiron.github.io/sqlx/#inQueries\" rel=\"nofollow noreferrer\">Playground</a>.</p>\n\n<p><strong>Edited</strong>:- </p>\n\n<p>You can use <a href=\"http://jmoiron.github.io/sqlx/#inQueries\" rel=\"nofollow noreferrer\">Golang sqlx</a> package for your requirement.</p>\n\n<blockquote>\n  <p><code>database/sql</code> package does not inspect your query and it passes your\n  arguments directly to the driver, it makes dealing with queries with\n  IN clauses difficult:</p>\n</blockquote>\n\n<pre><code>SELECT * FROM users WHERE level IN (?);\n</code></pre>\n\n<blockquote>\n  <p>When this gets prepared as a statement on the backend, the bindvar ?\n  will only correspond to a single argument, but what is often desired\n  is for that to be a variable number of arguments depending on the\n  length of some slice, eg:</p>\n</blockquote>\n\n<pre><code>var levels = []int{4, 6, 7}\nrows, err := db.Query(\"SELECT * FROM users WHERE level IN (?);\", levels)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 6, "last_activity_date": 1530648743, "creation_date": 1530648743, "answer_id": 51162218, "question_id": 51156305, "link": "https://stackoverflow.com/questions/51156305/pass-array-to-go-pg-query/51162218#51162218", "title": "pass array to go-pg query", "body": "<p>There are a couple things you can do:</p>\n\n<ol>\n<li>Keep using <code>in (...)</code> and use <a href=\"https://godoc.org/github.com/go-pg/pg#In\" rel=\"noreferrer\"><code>pg.In</code></a>.</li>\n<li>Use <a href=\"https://www.postgresql.org/docs/current/static/functions-comparisons.html#id-1.5.8.28.16\" rel=\"noreferrer\"><code>= any(array)</code></a> in your SQL instead of <code>in (list)</code> and <a href=\"https://godoc.org/github.com/go-pg/pg#Array\" rel=\"noreferrer\"><code>pg.Array</code></a> in Go to send a proper array to PostgreSQL.</li>\n</ol>\n\n<p>The first looks like:</p>\n\n<pre><code>db.Query(&amp;result, `SELECT id FROM bar WHERE code_id IN (?)`, pg.In(params.Codes))\n</code></pre>\n\n<p>the second looks like:</p>\n\n<pre><code>db.Query(&amp;result, `SELECT id FROM bar WHERE code_id = ANY (?)`, pg.Array(params.Codes))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2421, "user_id": 445845, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vrtJX.jpg?s=128&g=1", "display_name": "Ariel Monaco", "link": "https://stackoverflow.com/users/445845/ariel-monaco"}, "is_accepted": false, "score": 2, "last_activity_date": 1578174948, "creation_date": 1578174948, "answer_id": 59595177, "question_id": 51156305, "link": "https://stackoverflow.com/questions/51156305/pass-array-to-go-pg-query/59595177#59595177", "title": "pass array to go-pg query", "body": "<p>You could use the go-pg ORM instead for the same results:</p>\n\n<pre><code>ids := []int{1, 2, 3}\nerr := db.Model((*Book)(nil)).\n    Where(\"id in (?)\", pg.In(ids)).\n    Select()\n\n// SELECT * FROM books WHERE id IN (1, 2, 3)\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 1989863, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/3397588b77ce50008a7f19b4e1a2aa37?s=128&d=identicon&r=PG&f=1", "display_name": "XZen", "link": "https://stackoverflow.com/users/1989863/xzen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3163, "favorite_count": 0, "accepted_answer_id": 51162218, "answer_count": 3, "score": 4, "last_activity_date": 1578174948, "creation_date": 1530625776, "last_edit_date": 1530634747, "question_id": 51156305, "link": "https://stackoverflow.com/questions/51156305/pass-array-to-go-pg-query", "title": "pass array to go-pg query", "body": "<p>I'm using Go-pg and when I use the following way to execute sql query:</p>\n\n<pre><code>db.Query(&amp;result, sqlQuery, params)\n</code></pre>\n\n<p>where <code>params</code> is a structure like the following:</p>\n\n<pre><code>type MyParams struct {\n    Codes []int\n}\n</code></pre>\n\n<p>and <code>sqlQuery</code> is </p>\n\n<pre><code>SELECT id FROM bar WHERE code_id IN (?codes)\n</code></pre>\n\n<p>in the actual SQL query I get query like this:</p>\n\n<pre><code>SELECT id FROM bar WHERE code_id IN ('[7,45]')\n</code></pre>\n\n<p>Is it possible to have int array placeholder passed properly to have a query:</p>\n\n<pre><code>SELECT id FROM bar WHERE code_id IN (7,45)\n</code></pre>\n"}, {"tags": ["python", "c", "go"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1530627868, "post_id": 51156221, "comment_id": 89297347, "body": "Please include the exact command used to build the library (from Go source)."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1530628257, "post_id": 51156221, "comment_id": 89297625, "body": "A reality check: to create a module for CPython, you&#39;re supposed to build your Go code in a way to provide a C-compatible &quot;archive&quot; or a library\u2014that is, you&#39;re supposed to use the <a href=\"https://golang.org/pkg/cmd/go/internal/help/\" rel=\"nofollow noreferrer\"><code>-buildmode</code></a> option with one of <code>c-archive</code> or <code>c-shared</code> values. The further build process (which would use that archive/library) is supposed to act in accordance with the type of the produced artefact."}, {"owner": {"reputation": 109, "user_id": 1892636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1a8658a9de51235a672df0b3682a3d7?s=128&d=identicon&r=PG", "display_name": "Ratmil", "link": "https://stackoverflow.com/users/1892636/ratmil"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1530636202, "post_id": 51156221, "comment_id": 89302142, "body": "This is the command to compile the library from Go:                              go build -buildmode=c-archive -o $(BUILDLIB_DIR)/mylib.a  $(LIB_FILES)"}, {"owner": {"reputation": 109, "user_id": 1892636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1a8658a9de51235a672df0b3682a3d7?s=128&d=identicon&r=PG", "display_name": "Ratmil", "link": "https://stackoverflow.com/users/1892636/ratmil"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1530636313, "post_id": 51156221, "comment_id": 89302188, "body": "It works well on Linux. The problem is with Mac OS and setting the install name."}, {"owner": {"reputation": 109, "user_id": 1892636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1a8658a9de51235a672df0b3682a3d7?s=128&d=identicon&r=PG", "display_name": "Ratmil", "link": "https://stackoverflow.com/users/1892636/ratmil"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1530636492, "post_id": 51156221, "comment_id": 89302290, "body": "I have found something that may help me. Adding arguments to Go c compiler."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1530686173, "post_id": 51156221, "comment_id": 89317508, "body": "Then please answer your own question and then mark it as accepted. This is normal practice on SO."}, {"owner": {"reputation": 109, "user_id": 1892636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1a8658a9de51235a672df0b3682a3d7?s=128&d=identicon&r=PG", "display_name": "Ratmil", "link": "https://stackoverflow.com/users/1892636/ratmil"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1530717720, "post_id": 51156221, "comment_id": 89336422, "body": "Sorry, I haven&#39;t solved this problem yet."}, {"owner": {"reputation": 109, "user_id": 1892636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1a8658a9de51235a672df0b3682a3d7?s=128&d=identicon&r=PG", "display_name": "Ratmil", "link": "https://stackoverflow.com/users/1892636/ratmil"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1530723844, "post_id": 51156221, "comment_id": 89339143, "body": "Sorry. I just thought I had found the answer but I haven&#39;t. My idea is to add an argument to go builder like this: go build -gcflags=&quot;-install_name @rpath/mylib.a&quot;, but that didn&#39;t work."}], "answers": [{"tags": [], "owner": {"reputation": 109, "user_id": 1892636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1a8658a9de51235a672df0b3682a3d7?s=128&d=identicon&r=PG", "display_name": "Ratmil", "link": "https://stackoverflow.com/users/1892636/ratmil"}, "is_accepted": false, "score": 0, "last_activity_date": 1530836340, "creation_date": 1530836340, "answer_id": 51201529, "question_id": 51156221, "link": "https://stackoverflow.com/questions/51156221/compiling-and-linking-python-module-in-mac-os/51201529#51201529", "title": "Compiling and linking Python module in Mac Os", "body": "<p>OK. This is what I previously had:</p>\n\n<pre><code>ext_modules = [Extension(\"_mypymod\", [\"mymod.c\"],\n                         extra_link_args=[],\n                         depends=[],\n                         libraries = [':mylib.a'],\n                         library_dirs = [\n                             lib_path\n                         ],\n                   )],\n</code></pre>\n\n<p>That didn't work in MacOS. This is how it should be:</p>\n\n<pre><code>ext_modules = [Extension(\"_mypymod\", [\"mymod.c\"],\n                             extra_link_args=[lib_path + '/mylib.a'], #full path to the library\n                             depends=[],\n                       )],\n</code></pre>\n\n<p>That works in linux and Mac.</p>\n"}], "owner": {"reputation": 109, "user_id": 1892636, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1a8658a9de51235a672df0b3682a3d7?s=128&d=identicon&r=PG", "display_name": "Ratmil", "link": "https://stackoverflow.com/users/1892636/ratmil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 189, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1530836340, "creation_date": 1530625545, "question_id": 51156221, "link": "https://stackoverflow.com/questions/51156221/compiling-and-linking-python-module-in-mac-os", "title": "Compiling and linking Python module in Mac Os", "body": "<p>I am working on a Python module. I have C source file and a compiled library. I was having problems when linking in Mac Os, so I followed the instructions provided at <a href=\"https://stackoverflow.com/questions/19123623/python-runtime-library-dirs-doesnt-work-on-mac\">Python runtime_library_dirs doesn&#39;t work on Mac</a>.</p>\n\n<p>This post says that add extra link arguments should be added when linking in Mac Os. It also says that install_name_tool should be used to change the install name of the library.</p>\n\n<p>However, I am getting this error message when using install_name_tool:</p>\n\n<pre><code>string table not at the end of the file (can't be processed) in file:\n</code></pre>\n\n<p>The library is compiled from Go source.</p>\n"}, {"tags": ["go", "bit-manipulation", "dht", "kademlia"], "answers": [{"comments": [{"owner": {"reputation": 5742, "user_id": 181052, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/5b1eca209b1b486ff1732ffb7c745f0e?s=128&d=identicon&r=PG", "display_name": "Sid", "link": "https://stackoverflow.com/users/181052/sid"}, "edited": false, "score": 0, "creation_date": 1530695824, "post_id": 51161016, "comment_id": 89322765, "body": "Your response and the links on the subject are priceless. Thank you for taking the time @the8472."}, {"owner": {"reputation": 5742, "user_id": 181052, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/5b1eca209b1b486ff1732ffb7c745f0e?s=128&d=identicon&r=PG", "display_name": "Sid", "link": "https://stackoverflow.com/users/181052/sid"}, "edited": false, "score": 0, "creation_date": 1530695939, "post_id": 51161016, "comment_id": 89322845, "body": "Adding the paper referenced in your other answers <a href=\"https://stackoverflow.com/questions/47507317/is-there-a-clearly-documented-consensus-in-plain-english-that-describes-maymounk/47517428#47517428\" title=\"is there a clearly documented consensus in plain english that describes maymounk\">stackoverflow.com/questions/47507317/&hellip;</a> to reduce the link hops.   <a href=\"http://www.maymounkov.org/papers/maymounkov-kademlia-lncs.pdf\" rel=\"nofollow noreferrer\">maymounkov.org/papers/maymounkov-kademlia-lncs.pdf</a>"}], "tags": [], "owner": {"reputation": 34798, "user_id": 1362755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97aa8c37ffa60c4262955aefae56e605?s=128&d=identicon&r=PG", "display_name": "the8472", "link": "https://stackoverflow.com/users/1362755/the8472"}, "is_accepted": true, "score": 3, "last_activity_date": 1530646397, "last_edit_date": 1530646397, "creation_date": 1530642899, "answer_id": 51161016, "question_id": 51155560, "link": "https://stackoverflow.com/questions/51155560/routing-table-in-kadmelia-k-bucket-algorithm-without-looping-over-each-bit-in-th/51161016#51161016", "title": "Routing Table in Kadmelia K-Bucket algorithm without looping over each bit in the Node ID", "body": "<blockquote>\n  <p>How is this approach identical to looping over each bit?</p>\n</blockquote>\n\n<p>The loop simply iterates over bytes and then for each byte over the bits doing shifts and masks. So in effect it does iterate over all bits, the bits just happen to be packed into bytes since the smallest addressable unit of memory generally is one byte.</p>\n\n<blockquote>\n  <p>What I fail to understand is the return values and why they're set in that way. </p>\n</blockquote>\n\n<p>It simply calculates the bit position in terms of <code>i</code> complete bytes and <code>j</code> bits in the last partial byte.</p>\n\n<blockquote>\n  <p>Context</p>\n</blockquote>\n\n<p>The context is actually misguided here since you're trying to explain the splittable routing table design while looking at a code sample with a fixed array layout. <a href=\"https://stackoverflow.com/q/51161731/1362755\">That is a common source of confusion</a>.</p>\n"}], "owner": {"reputation": 5742, "user_id": 181052, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/5b1eca209b1b486ff1732ffb7c745f0e?s=128&d=identicon&r=PG", "display_name": "Sid", "link": "https://stackoverflow.com/users/181052/sid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 51161016, "answer_count": 1, "score": 0, "last_activity_date": 1530646397, "creation_date": 1530623590, "question_id": 51155560, "link": "https://stackoverflow.com/questions/51155560/routing-table-in-kadmelia-k-bucket-algorithm-without-looping-over-each-bit-in-th", "title": "Routing Table in Kadmelia K-Bucket algorithm without looping over each bit in the Node ID", "body": "<p><strong>Context</strong></p>\n\n<p>I'm trying to implement Kadmelia's K-Bucket algorithm to keep track of closer nodes. I understand in theory how the algorithm works </p>\n\n<ol>\n<li>When a new node is <code>added</code></li>\n<li>If the bucket size hasn't exceeded k (bucket size) we add it to the current bucket</li>\n<li>else we split the bucket and divide the contacts in the parent bucket by looping over each bit and split them into two buckets.</li>\n<li>This also implies that for a given node there would be <code>k * 8</code> buckets (or lists)</li>\n</ol>\n\n<p><strong>Question</strong></p>\n\n<p>The question is in reference to the approach adopted in this example <a href=\"http://blog.notdot.net/2009/11/Implementing-a-DHT-in-Go-part-1\" rel=\"nofollow noreferrer\">http://blog.notdot.net/2009/11/Implementing-a-DHT-in-Go-part-1</a></p>\n\n<p>Given that we have defined a Node as a byte array of length 20 </p>\n\n<pre><code>\n\nconst IdLength = 20\ntype NodeID [IdLength]byte\n</code></pre>\n\n<p>I'm trying to understand what the <code>PrefixLen</code> function does to actually compute the prefix and populate the routing table. I understand what each component of the method does. By that I mean, I understand what the bit shift operators do and <code>AND</code> with 1 to check if the bit is set.</p>\n\n<p>What I fail to understand is the return values and why they're set in that way. \n<pre><code>\n\nfunc (node NodeID) PrefixLen() (ret int) {\n  for i := 0; i &lt; IdLength; i++ {\n    for j := 0; j &lt; 8; j++ {\n      if (node[i] >> uint8(7 - j)) &amp; 0x1 != 0 {\n        return i * 8 + j;\n      }\n    }\n  }\n  return IdLength * 8 - 1;\n}\n</pre></code></p>\n\n<p>How is the return value suitable to be used as an index for the routing table?</p>\n\n<p><pre><code>\n  ...\n  prefix_length := contact.id.Xor(table.node.id).PrefixLen();\n  bucket := table.buckets[prefix_length];\n  ...\n</pre></code></p>\n\n<p>How is this approach identical to looping over each bit? How does the author achieve the same result using the PrefixLen method.</p>\n\n<p>Could you help me understand this with examples. Thanks in advance.</p>\n"}, {"tags": ["go", "tcp", "zebra-printers"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530623904, "post_id": 51155091, "comment_id": 89294591, "body": "Don&#39;t use <code>rw.ReadString(&#39;\\n&#39;)</code> if the device doesn&#39;t send a <code>\\n</code>."}, {"owner": {"reputation": 4531, "user_id": 9938, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/56982d0ab4f8fdd82cf65d399f25b774?s=128&d=identicon&r=PG", "display_name": "Mike Roosa", "link": "https://stackoverflow.com/users/9938/mike-roosa"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530625585, "post_id": 51155091, "comment_id": 89295766, "body": "Yes, I know, but I&#39;m asking how to know when the zebra is done sending data or is there a way to tell zebra to send a \\n when it&#39;s done."}], "answers": [{"comments": [{"owner": {"reputation": 4531, "user_id": 9938, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/56982d0ab4f8fdd82cf65d399f25b774?s=128&d=identicon&r=PG", "display_name": "Mike Roosa", "link": "https://stackoverflow.com/users/9938/mike-roosa"}, "edited": false, "score": 0, "creation_date": 1530651657, "post_id": 51159838, "comment_id": 89308789, "body": "This doesn&#39;t seem to return anything for me."}], "tags": [], "owner": {"reputation": 1364, "user_id": 73390, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13d31315aa013d9667d9ea8949274dac?s=128&d=identicon&r=PG", "display_name": "banno", "link": "https://stackoverflow.com/users/73390/banno"}, "is_accepted": false, "score": 0, "last_activity_date": 1530637856, "creation_date": 1530637856, "answer_id": 51159838, "question_id": 51155091, "link": "https://stackoverflow.com/questions/51155091/how-to-get-a-zebra-printer-to-return-a-new-line-character-when-using-getvar/51159838#51159838", "title": "How to get a Zebra printer to return a new line character when using getvar?", "body": "<p>Use the JSON wrapping of SGD:</p>\n\n<p>send {}{\"zpl.system_status\":null}</p>\n\n<p>The response will come back in JSON to you can look for the closing }</p>\n"}], "owner": {"reputation": 4531, "user_id": 9938, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/56982d0ab4f8fdd82cf65d399f25b774?s=128&d=identicon&r=PG", "display_name": "Mike Roosa", "link": "https://stackoverflow.com/users/9938/mike-roosa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 228, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1570301945, "creation_date": 1530622207, "last_edit_date": 1570301945, "question_id": 51155091, "link": "https://stackoverflow.com/questions/51155091/how-to-get-a-zebra-printer-to-return-a-new-line-character-when-using-getvar", "title": "How to get a Zebra printer to return a new line character when using getvar?", "body": "<p>I wrote a simple Go program to connect to the printer, run a get command</p>\n\n<pre><code>! U1 getvar \"zpl.system_status\"\\r\\n\n</code></pre>\n\n<p>I was then trying to read the response but my read listener kept timing out.  I was expecting a \\n at the end of the data coming from the printer but was not getting it. Is there a way to tell the printer to respond and terminate the line with \\n?</p>\n\n<p>If not, what's the best way to listen for a response. I ended up reading the stream and then setting a timeout to wait for more data, but that seems kind of hacky.</p>\n\n<p>Is there a specific character I can wait for to indicate the printer is done sending the response?</p>\n\n<p>I also logged in with a telnet client manually and saw the same behavior.</p>\n\n<p>Here is the code I put together. It's rough at the moment, just trying to get things working before I clean it up. It does get the response with this code and with the commented out code, but I feel like I should be getting a line terminator from the server and I'm not.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"net\"\n    \"os\"\n    \"time\"\n)\n\nfunc main() {\n    dialer := net.Dialer{Timeout: 1 * time.Second}\n    conn, err := dialer.Dial(\"tcp\", \"127.0.0.1:9100\")\n    if err != nil {\n        println(\"Dial failed: \", err.Error())\n        os.Exit(1)\n    }\n    defer conn.Close()\n\n    rw := bufio.NewReadWriter(bufio.NewReader(conn), bufio.NewWriter(conn))\n\n    println(\"Sending string request\")\n    n, err := rw.WriteString(\"! U1 getvar \\\"interface.network.active.mac_addr\\\"\\r\\n\")\n    if err != nil {\n        println(\"Error getting status.\", err)\n    }\n    println(\"Characters sent: \", n)\n\n    err = rw.Flush()\n    if err != nil {\n        println(\"Error on flush\", err)\n    }\n\n    err = conn.SetReadDeadline(time.Now().Add(1 * time.Second))\n    if err != nil {\n        println(\"Set Deadline failed: \", err)\n    }\n\n    // buffer := make([]byte, 0, 1024)\n    // tmp := make([]byte, 128)\n    // for {\n    //  n, err := conn.Read(tmp[:])\n    //  if err != nil {\n    //      println(err)\n    //      break\n    //  }\n    //  println(n)\n    //  buffer = append(buffer, tmp[:n]...)\n    // }\n    // println(string(buffer))\n\n    response, err := rw.ReadString('\\n')\n    if err != nil {\n        println(\"Read error: \", err.Error())\n    }\n    println(\"Response: \", response)\n}\n</code></pre>\n\n<p>Response - I changed the mac address below but this is basically what I get.</p>\n\n<pre><code>Sending string request\nCharacters sent:  49\nRead error:  read tcp i/o timeout\nResponse:  \"07:4d:07:79:47:ef\"\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 1, "last_activity_date": 1530620169, "creation_date": 1530620169, "answer_id": 51154433, "question_id": 51154347, "link": "https://stackoverflow.com/questions/51154347/consume-a-nested-array-inside-json-request-in-go/51154433#51154433", "title": "Consume a nested array inside JSON request in Go", "body": "<p>You can nest objects, and <code>Unmarshal</code> will handle the entire tree for you.</p>\n\n<pre><code>type Recipient struct {\n    Address string `json:\"address\"`\n}\n\ntype EmailValidator struct {\n    Client  string `json:\"client\"`\n    Content string `json:\"content\"`\n    Recipients []Recipient `json:\"recipients\"`\n}\n</code></pre>\n\n<p>The rest of your code looks good.</p>\n"}, {"comments": [{"owner": {"reputation": 681, "user_id": 1894292, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/24bbb0e9731796478c7307061bfd1a84?s=128&d=identicon&r=PG", "display_name": "user1894292", "link": "https://stackoverflow.com/users/1894292/user1894292"}, "edited": false, "score": 0, "creation_date": 1530687136, "post_id": 51154439, "comment_id": 89317978, "body": "Thanks for your answers, but this is still not working. Could it be because &#39;address&#39; is in it&#39;s own anonymous object?"}, {"owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "reply_to_user": {"reputation": 681, "user_id": 1894292, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/24bbb0e9731796478c7307061bfd1a84?s=128&d=identicon&r=PG", "display_name": "user1894292", "link": "https://stackoverflow.com/users/1894292/user1894292"}, "edited": false, "score": 0, "creation_date": 1530705739, "post_id": 51154439, "comment_id": 89329141, "body": "So maybe your JSON data isn&#39;t how you expect it to be. Try to print your HTTP response body to make sure it looks the way you expect. For the JSON example you mentioned, this code does work."}, {"owner": {"reputation": 681, "user_id": 1894292, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/24bbb0e9731796478c7307061bfd1a84?s=128&d=identicon&r=PG", "display_name": "user1894292", "link": "https://stackoverflow.com/users/1894292/user1894292"}, "edited": false, "score": 0, "creation_date": 1530723172, "post_id": 51154439, "comment_id": 89338888, "body": "How would you print HTTP response body? When I try to print the raw response, I get what looks like a hex string."}, {"owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "reply_to_user": {"reputation": 681, "user_id": 1894292, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/24bbb0e9731796478c7307061bfd1a84?s=128&d=identicon&r=PG", "display_name": "user1894292", "link": "https://stackoverflow.com/users/1894292/user1894292"}, "edited": false, "score": 0, "creation_date": 1530792772, "post_id": 51154439, "comment_id": 89363655, "body": "When you used ioutil.ReadAll, you got a byte slice. Convert it to string with string(b)."}], "tags": [], "owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "is_accepted": false, "score": 2, "last_activity_date": 1530620194, "creation_date": 1530620194, "answer_id": 51154439, "question_id": 51154347, "link": "https://stackoverflow.com/questions/51154347/consume-a-nested-array-inside-json-request-in-go/51154439#51154439", "title": "Consume a nested array inside JSON request in Go", "body": "<p>You need an array of \"things with an address\":</p>\n\n<pre><code>type EmailValidator struct {\n    Client  string `json:\"client\"`\n    Content string `json:\"content\"`\n    Recipients []Recipient `json:\"recipients\"`\n}\n\n\ntype Recipient struct {\n    Address string `json:\"address\"`\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 681, "user_id": 1894292, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/24bbb0e9731796478c7307061bfd1a84?s=128&d=identicon&r=PG", "display_name": "user1894292", "link": "https://stackoverflow.com/users/1894292/user1894292"}, "edited": false, "score": 0, "creation_date": 1530687057, "post_id": 51154494, "comment_id": 89317929, "body": "Thanks for your answers, but this is still not working.  Could it be because &#39;address&#39; is in it&#39;s own anonymous object?"}, {"owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "reply_to_user": {"reputation": 681, "user_id": 1894292, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/24bbb0e9731796478c7307061bfd1a84?s=128&d=identicon&r=PG", "display_name": "user1894292", "link": "https://stackoverflow.com/users/1894292/user1894292"}, "edited": false, "score": 0, "creation_date": 1530689748, "post_id": 51154494, "comment_id": 89319337, "body": "@user1894292 If you run code from my answer you receive: <code>{Client:The CLient Content:Hellow World Recipients:[{Adress:email1@example.com} {Adress:email2@example.com}]}</code>. Isn&#39;t result correct? What do you mean by &#39;address&#39; is in it&#39;s own anonymous object? Do you have another JSON format?"}], "tags": [], "owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "is_accepted": true, "score": 4, "last_activity_date": 1530620343, "creation_date": 1530620343, "answer_id": 51154494, "question_id": 51154347, "link": "https://stackoverflow.com/questions/51154347/consume-a-nested-array-inside-json-request-in-go/51154494#51154494", "title": "Consume a nested array inside JSON request in Go", "body": "<p>You can try something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Email struct {\n    Adress string `json:\"address\"`\n}\n\ntype EmailValidator struct {\n    Client  string `json:\"client\"`\n    Content string `json:\"content\"`\n    Recipients []Email `json:\"recipients\"`\n}\n\nfunc main() {\n    j := `{\n    \"notificationType\": \"email\",\n    \"client\": \"The CLient\",\n    \"content\": \"Hellow World\",\n    \"recipients\": [\n        {\n            \"address\": \"email1@example.com\"\n        },\n        {\n            \"address\": \"email2@example.com\"\n        }\n    ]\n    }`\n    result := EmailValidator{}\n    json.Unmarshal([]byte(j), &amp;result)\n    fmt.Printf(\"%+v\", result) // something like var_dump in PHP\n}\n</code></pre>\n"}], "owner": {"reputation": 681, "user_id": 1894292, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/24bbb0e9731796478c7307061bfd1a84?s=128&d=identicon&r=PG", "display_name": "user1894292", "link": "https://stackoverflow.com/users/1894292/user1894292"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 0, "accepted_answer_id": 51154494, "answer_count": 3, "score": 1, "last_activity_date": 1530620343, "creation_date": 1530619927, "question_id": 51154347, "link": "https://stackoverflow.com/questions/51154347/consume-a-nested-array-inside-json-request-in-go", "title": "Consume a nested array inside JSON request in Go", "body": "<p>How do I go about consuming the following json post in Go?</p>\n\n<pre><code>{\n    \"notificationType\": \"email\",\n    \"client\": \"The CLient\",\n    \"content\": \"Hellow World\",\n    \"recipients\": [\n        {\n            \"address\": \"email1@example.com\"\n        },\n        {\n            \"address\": \"email2@example.com\"\n        }\n    ]\n}\n</code></pre>\n\n<p>I've managed to get the string types but I really don't know enough about Go to deal with the recipients array.</p>\n\n<p>My code looks like this:</p>\n\n<pre><code>package handlers\n\nimport (\n    \"net/http\"\n    \"encoding/json\"\n    \"notificationservice/src/validation\"\n    \"io/ioutil\"\n    \"fmt\"\n)\n\nfunc EmailHandler(w http.ResponseWriter, r *http.Request) {\n    b, err := ioutil.ReadAll(r.Body)\n    defer r.Body.Close()\n    if err != nil {\n        http.Error(w, err.Error(), 500)\n        return\n    }\n\n    var postData validation.EmailValidator\n    err = json.Unmarshal(b, &amp;postData)\n    if err != nil {\n        http.Error(w, err.Error(), 500)\n        return\n    }\n\n    fmt.Println(postData.Client)\n    fmt.Println(postData.Content)\n}\n</code></pre>\n\n<p>My struct:</p>\n\n<pre><code>package validation\n\nimport \"fmt\"\n\ntype EmailValidator struct {\n    Client  string `json:\"client\"`\n    Content string `json:\"content\"`\n    //Recipients []string `json:\"recipients\"`\n}\n\nfunc (validator * EmailValidator) ValidateEmail() (bool) {\n\n    var required = []string {validator.Client, validator.Content, validator.Stuff}\n\n    for _, param := range required {\n        fmt.Println(param)\n    }\n    return true;\n}\n</code></pre>\n\n<p>I've tried setting Recipients to []string and [][]string but I really don't know what I'm doing.</p>\n\n<p>In PHP I would use the var_dump command to print out the entire object and debug step by step from there, but Go doesn't appear to have that functionality.</p>\n"}, {"tags": ["mongodb", "go", "mongo-go"], "comments": [{"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 2, "creation_date": 1530620366, "post_id": 51154010, "comment_id": 89291993, "body": "There is nothing to encode in the cursor. Why do you need it?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1530620679, "post_id": 51154010, "comment_id": 89292200, "body": "Check out this related / possible duplicate: <a href=\"https://stackoverflow.com/questions/40634865/efficient-paging-in-mongodb-using-mgo\">Efficient paging in MongoDB using mgo</a>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530624308, "post_id": 51154010, "comment_id": 89294866, "body": "&quot;there is ID, though undocumented&quot; -- I&#39;m confused. When I look at the Cursor doc, the first documented function is <code>ID()</code>."}, {"owner": {"reputation": 6519, "user_id": 613453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0c744d4e2bee639d69f3e78f7daeba6d?s=128&d=identicon&r=PG", "display_name": "themihai", "link": "https://stackoverflow.com/users/613453/themihai"}, "reply_to_user": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1530699718, "post_id": 51154010, "comment_id": 89325271, "body": "@AlexBlex how are you supposed to provide pagination to the end user(i.e. via a html interface) without a &quot;string&quot;/encoded cursor?"}, {"owner": {"reputation": 6519, "user_id": 613453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0c744d4e2bee639d69f3e78f7daeba6d?s=128&d=identicon&r=PG", "display_name": "themihai", "link": "https://stackoverflow.com/users/613453/themihai"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1530699768, "post_id": 51154010, "comment_id": 89325309, "body": "@icza mgo is totally different(and deprecated) than the official mongo driver"}, {"owner": {"reputation": 6519, "user_id": 613453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0c744d4e2bee639d69f3e78f7daeba6d?s=128&d=identicon&r=PG", "display_name": "themihai", "link": "https://stackoverflow.com/users/613453/themihai"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530699827, "post_id": 51154010, "comment_id": 89325345, "body": "@Flimzy ok, and what the &quot;ID&quot; of the cursor and how can you use it? What exactly it documents?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1530699939, "post_id": 51154010, "comment_id": 89325414, "body": "@themihai Yes, I realized later. My answer below applies to the official mongo driver."}, {"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 1, "creation_date": 1530700456, "post_id": 51154010, "comment_id": 89325683, "body": "Although mgo is unmaintained, it doesn&#39;t mean it uses anything different than <a href=\"https://docs.mongodb.com/manual/reference/mongodb-wire-protocol/\" rel=\"nofollow noreferrer\">mongodb wire protocol</a>. icza&#39;s answer apply to <b>any</b> driver built on top of it. Implementation details may differ, but the main idea is still the same - cursor is a resource."}, {"owner": {"reputation": 6519, "user_id": 613453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0c744d4e2bee639d69f3e78f7daeba6d?s=128&d=identicon&r=PG", "display_name": "themihai", "link": "https://stackoverflow.com/users/613453/themihai"}, "reply_to_user": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1530701826, "post_id": 51154010, "comment_id": 89326585, "body": "@AlexBlex there is no need to lecture me about what a unmaintained project means. As I understand <code>minquery</code> requires you to maintain a separate index of integer type(ascending)."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1530702018, "post_id": 51154010, "comment_id": 89326714, "body": "@themihai Minquery does not require you to maintain a &quot;separate&quot; index, it requires you to base your query on an index, and it provides you means to continue listing documents from a designated index entry, from the last index entry of your previous fetch."}, {"owner": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1530702021, "post_id": 51154010, "comment_id": 89326716, "body": "I have update the answer, if it makes it more clear why re-using cursor for pagination is a bad idea. If it doesn&#39;t stop you - go on. Maintain a pool of cursors in memory, ensure http requests are routed to the same instance, re-use the cursor. You still don&#39;t need to encode and send it to the client."}, {"owner": {"reputation": 6519, "user_id": 613453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0c744d4e2bee639d69f3e78f7daeba6d?s=128&d=identicon&r=PG", "display_name": "themihai", "link": "https://stackoverflow.com/users/613453/themihai"}, "reply_to_user": {"reputation": 24603, "user_id": 1110423, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ed86330a464a2bc0069dfdfc35524f2e?s=128&d=identicon&r=PG", "display_name": "Alex Blex", "link": "https://stackoverflow.com/users/1110423/alex-blex"}, "edited": false, "score": 0, "creation_date": 1530709024, "post_id": 51154010, "comment_id": 89331232, "body": "@AlexBlex even if I would maintain a pool of cursors in memory how could I know the page the client is trying to fetch? I would still have to provide a string representation so that the end user can store links to &quot;pages/cursors&quot; as it progresses through the list/pages.   I&#39;ve provided an answer myself and I&#39;m planning to mark it as &quot;accepted&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 0, "last_activity_date": 1530701709, "last_edit_date": 1530701709, "creation_date": 1530627485, "answer_id": 51156905, "question_id": 51154010, "link": "https://stackoverflow.com/questions/51154010/how-to-encode-decode-mongodb-cursor/51156905#51156905", "title": "How to encode/decode mongodb cursor?", "body": "<p>A <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo#Cursor\" rel=\"nofollow noreferrer\"><code>mongo.Cursor</code></a> object isn't something you can encode and put away for later use, like what you intend to use it for.</p>\n\n<p>A <code>mongo.Cursor</code> is something you use to iterate over a \"live query\", a stream of documents. You <strong>can't</strong> use it to return a batch of documents which you send to your client, and when the client requests more documents (the next page), you decode the stored cursor and continue where you left off. A cursor have a server side resource under the hood, which is kept for 10 minutes (configurable, see <a href=\"https://docs.mongodb.com/manual/reference/parameters/#param.cursorTimeoutMillis\" rel=\"nofollow noreferrer\">cursorTimeoutMillis</a>) or until you close the cursor implicitly. You do not want to keep the cursor \"alive\" while waiting for the client if he / she needs more documents, especially in an application with large traffic. Your MongoDB would quickly run out of resources. If cursor is closed by timeout, any attempt to read from the cursor will result with error \"Cursor not found, cursor id: #####\"</p>\n\n<p>The <code>Cursor.Decode()</code> method is not to decode a cursor from some encoded form. It is to decode the next document the cursor designates into a Go value.</p>\n\n<p>That's why there is no magic <code>mongo.NewCursor()</code> or <code>mongo.ParseCursor()</code> or <code>mongo.DecodeCursor()</code> function. A <code>mongo.Cursor</code> is <em>handed</em> to you by executing queries, e.g. with <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo#Collection.Find\" rel=\"nofollow noreferrer\"><code>Collection.Find()</code></a>:</p>\n\n<pre><code>func (coll *Collection) Find(ctx context.Context, filter interface{},\n    opts ...findopt.Find) (Cursor, error)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6519, "user_id": 613453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0c744d4e2bee639d69f3e78f7daeba6d?s=128&d=identicon&r=PG", "display_name": "themihai", "link": "https://stackoverflow.com/users/613453/themihai"}, "is_accepted": true, "score": 1, "last_activity_date": 1530708494, "last_edit_date": 1530708494, "creation_date": 1530708191, "answer_id": 51174000, "question_id": 51154010, "link": "https://stackoverflow.com/questions/51154010/how-to-encode-decode-mongodb-cursor/51174000#51174000", "title": "How to encode/decode mongodb cursor?", "body": "<p>MongoDB does not provide a serializable cursor. <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo#Cursor\" rel=\"nofollow noreferrer\">Cursor</a> is not serializable. The <a href=\"https://docs.mongodb.com/manual/reference/method/cursor.skip/\" rel=\"nofollow noreferrer\">recommended workaround</a> is to use a range query and sort on a field that generally changes in a consistent direction over time such <code>_id</code>.  </p>\n\n<pre><code>function printStudents(startValue, nPerPage) {\n  let endValue = null;\n  db.students.find( { _id: { $lt: startValue } } )\n             .sort( { _id: -1 } )\n             .limit( nPerPage )\n             .forEach( student =&gt; {\n               print( student.name );\n               endValue = student._id;\n             } );\n\n  return endValue;\n}\n</code></pre>\n\n<p>There is a go package <a href=\"https://godoc.org/github.com/icza/minquery\" rel=\"nofollow noreferrer\">minquery</a> that tries to make the cursor query/serialization more convenient. You may find it helpful.</p>\n"}], "owner": {"reputation": 6519, "user_id": 613453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0c744d4e2bee639d69f3e78f7daeba6d?s=128&d=identicon&r=PG", "display_name": "themihai", "link": "https://stackoverflow.com/users/613453/themihai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1800, "favorite_count": 0, "accepted_answer_id": 51174000, "answer_count": 2, "score": -1, "last_activity_date": 1530708494, "creation_date": 1530618935, "last_edit_date": 1530700080, "question_id": 51154010, "link": "https://stackoverflow.com/questions/51154010/how-to-encode-decode-mongodb-cursor", "title": "How to encode/decode mongodb cursor?", "body": "<p>I need to build a list of \"pages\" so part of this there will be a <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo#Cursor\" rel=\"nofollow noreferrer\">cursor</a>. The issue is that I can't find a way to encode(to string) and decode the cursor. Any idea? The <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/mongo#Cursor\" rel=\"nofollow noreferrer\">Cursor</a> interface has no \"encoding\" method(there is ID, though undocumented) and there is no way to create a new cursor from a string(or int).</p>\n\n<pre><code>type Cursor interface {\n\n    // Get the ID of the cursor.\n    ID() int64\n\n    // Get the next result from the cursor.\n    // Returns true if there were no errors and there is a next result.\n    Next(context.Context) bool\n\n    Decode(interface{}) error\n\n    DecodeBytes() (bson.Reader, error)\n\n    // Returns the error status of the cursor\n    Err() error\n\n    // Close the cursor.\n    Close(context.Context) error\n}\n</code></pre>\n\n<p><strong>Why do I need the cursor encoded?</strong> </p>\n\n<p>To provide pagination to the end client through a html or JSON API.</p>\n"}, {"tags": ["go", "error-handling", "udp"], "comments": [{"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1530636960, "post_id": 51151973, "comment_id": 89302493, "body": "Checking for strings is a risky idea. See and verify if something like this helps you construct the right type of error to check against what your call returns <a href=\"https://play.golang.org/p/pQ7tGsWYvhG\" rel=\"nofollow noreferrer\">play.golang.org/p/pQ7tGsWYvhG</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2388, "user_id": 2557927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce1fef35bfb4d433d79b2ec303e3cb37?s=128&d=identicon&r=PG", "display_name": "Star Brilliant", "link": "https://stackoverflow.com/users/2557927/star-brilliant"}, "edited": false, "score": 0, "creation_date": 1535989751, "post_id": 51152601, "comment_id": 91256133, "body": "On Windows, the error message is &quot;Only one usage of each socket address (protocol/network address/port) is normally permitted.&quot; I invite you to check my solution that supports Windows. :-)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 2388, "user_id": 2557927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce1fef35bfb4d433d79b2ec303e3cb37?s=128&d=identicon&r=PG", "display_name": "Star Brilliant", "link": "https://stackoverflow.com/users/2557927/star-brilliant"}, "edited": false, "score": 0, "creation_date": 1535990151, "post_id": 51152601, "comment_id": 91256291, "body": "@StarBrilliant: This is a prime example why checking the text of an error message is bad practice :)"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 5, "last_activity_date": 1530616823, "last_edit_date": 1530616823, "creation_date": 1530614688, "answer_id": 51152601, "question_id": 51151973, "link": "https://stackoverflow.com/questions/51151973/catching-bind-address-already-in-use-in-golang/51152601#51152601", "title": "Catching &quot;bind: address already in use&quot; in golang", "body": "<p>The easy way is just to check the text of the error:</p>\n\n<pre><code>conn, err := net.ListenUDP(\"udp\", addr)\nif err != nil &amp;&amp; err.Error() == \"bind: address already in use\" {\n    // Failed to bind, do something\n}\nif err != nil {\n    // Some other error\n    panic(err)\n}\n</code></pre>\n\n<p>For a simple case like this, this may be sufficient. This approach is somewhat fragile, however:</p>\n\n<ol>\n<li>If the library ever changes the error message (this <em>does</em> happen from time to time, although is probably unlikely in this specific instance), the check will break</li>\n<li>If you do this check in some wrapping function, that may also return other types of errors, you may, at least in theory, receive a false positive, if some other functionality returns an error with the same text (also probably unlikely in this case)</li>\n</ol>\n\n<p>To mitigate these concerns, you may be able to check for the specific error type, rather than just a textual representation. In your example, the <a href=\"https://golang.org/pkg/net\" rel=\"nofollow noreferrer\">net</a> package provides a few custom errors. The <a href=\"https://golang.org/src/net/udpsock.go?s=6818:6882#L217\" rel=\"nofollow noreferrer\"><code>ListenUDP</code></a> method returns a <a href=\"https://golang.org/pkg/net/#OpError\" rel=\"nofollow noreferrer\"><code>net.OpError</code></a>, which means you can examine it more closely. For example:</p>\n\n<pre><code>conn, err := net.ListenUDP(\"udp\", addr)\nif opErr, ok := err.(*net.OpError); ok {\n    if opErr.Op == \"listen\" &amp;&amp; strings.Contains(opErr.Error.Error(), \"address already in use\") {\n        // Failed to bind, do something\n    }\n}\nif err != nil {\n    // Some other error, panic\n    panic(err)\n}\n</code></pre>\n\n<p>In this case, we still depend on a textual check, so there's still a risk of future library changes breaking the test.  But by checking for the <code>net.OpError</code> type, we do mitigate the second risk, that some other error, with the same text, may be raised.</p>\n"}, {"tags": [], "owner": {"reputation": 2388, "user_id": 2557927, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce1fef35bfb4d433d79b2ec303e3cb37?s=128&d=identicon&r=PG", "display_name": "Star Brilliant", "link": "https://stackoverflow.com/users/2557927/star-brilliant"}, "is_accepted": false, "score": 5, "last_activity_date": 1535989686, "creation_date": 1535989686, "answer_id": 52152912, "question_id": 51151973, "link": "https://stackoverflow.com/questions/51151973/catching-bind-address-already-in-use-in-golang/52152912#52152912", "title": "Catching &quot;bind: address already in use&quot; in golang", "body": "<p>On Windows, the error message is \"<code>Only one usage of each socket address (protocol/network address/port) is normally permitted.</code>\"</p>\n\n<p>Additionally, in case of localization, the message would change.</p>\n\n<p>Here is a possible solution to catch \"Address already in use\" error:</p>\n\n<pre><code>func isErrorAddressAlreadyInUse(err error) bool {\n    errOpError, ok := err.(*net.OpError)\n    if !ok {\n        return false\n    }\n    errSyscallError, ok := errOpError.Err.(*os.SyscallError)\n    if !ok {\n        return false\n    }\n    errErrno, ok := errSyscallError.Err.(syscall.Errno)\n    if !ok {\n        return false\n    }\n    if errErrno == syscall.EADDRINUSE {\n        return true\n    }\n    const WSAEADDRINUSE = 10048\n    if runtime.GOOS == \"windows\" &amp;&amp; errErrno == WSAEADDRINUSE {\n        return true\n    }\n    return false\n}\n</code></pre>\n\n<p>To use this function:</p>\n\n<pre><code>conn, err := net.ListenUDP(\"udp\", addr)\nif err != nil {\n    if isErrorAddressAlreadyInUse(err) {\n        // Do something if 'addr' is already in use\n    } else {\n        panic(err)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 8497, "user_id": 193468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58e035667fdc434462801c66fab34f75?s=128&d=identicon&r=PG", "display_name": "the paul", "link": "https://stackoverflow.com/users/193468/the-paul"}, "edited": false, "score": 1, "creation_date": 1611866909, "post_id": 65865898, "comment_id": 116596050, "body": "<code>errors.As()</code> should work fine with syscall.Errno; you just need to pass in a pointer to <code>syscall.Errno</code>, not a pointer to a pointer, because <code>syscall.Errno</code> is the type implementing <code>error</code>, not <code>*syscall.Errno</code>.   <code>var errErrno syscall.Errno</code>; <code>if !errors.As(eOsSyscall.Err, &amp;errErrno) { return false }</code>"}, {"owner": {"reputation": 333, "user_id": 2510873, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0dbf1093898f05f0c23fcdda3bc5abf3?s=128&d=identicon&r=PG", "display_name": "Brian Cunnie", "link": "https://stackoverflow.com/users/2510873/brian-cunnie"}, "reply_to_user": {"reputation": 8497, "user_id": 193468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/58e035667fdc434462801c66fab34f75?s=128&d=identicon&r=PG", "display_name": "the paul", "link": "https://stackoverflow.com/users/193468/the-paul"}, "edited": false, "score": 0, "creation_date": 1611973649, "post_id": 65865898, "comment_id": 116629509, "body": "Thanks @thepaul, I&#39;ve updated my code snippet."}], "tags": [], "owner": {"reputation": 333, "user_id": 2510873, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0dbf1093898f05f0c23fcdda3bc5abf3?s=128&d=identicon&r=PG", "display_name": "Brian Cunnie", "link": "https://stackoverflow.com/users/2510873/brian-cunnie"}, "is_accepted": false, "score": 1, "last_activity_date": 1611973617, "last_edit_date": 1611973617, "creation_date": 1611447053, "answer_id": 65865898, "question_id": 51151973, "link": "https://stackoverflow.com/questions/51151973/catching-bind-address-already-in-use-in-golang/65865898#65865898", "title": "Catching &quot;bind: address already in use&quot; in golang", "body": "<p>To update Star Brilliant's most-excellent answer with Go 1.13's <a href=\"https://blog.golang.org/go1.13-errors\" rel=\"nofollow noreferrer\">error enhancements</a>:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func isErrorAddressAlreadyInUse(err error) bool {\n    var eOsSyscall *os.SyscallError\n    if !errors.As(err, &amp;eOsSyscall) {\n        return false\n    }\n    var errErrno syscall.Errno // doesn't need a &quot;*&quot; (ptr) because it's already a ptr (uintptr)\n    if !errors.As(eOsSyscall, &amp;errErrno) {\n        return false\n    }\n    if errErrno == syscall.EADDRINUSE {\n        return true\n    }\n    const WSAEADDRINUSE = 10048\n    if runtime.GOOS == &quot;windows&quot; &amp;&amp; errErrno == WSAEADDRINUSE {\n        return true\n    }\n    return false\n}\n</code></pre>\n"}], "owner": {"reputation": 93, "user_id": 4489021, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/620b96f7b2741e22237c04be26394461?s=128&d=identicon&r=PG&f=1", "display_name": "storykim", "link": "https://stackoverflow.com/users/4489021/storykim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2264, "favorite_count": 2, "accepted_answer_id": 51152601, "answer_count": 3, "score": 2, "last_activity_date": 1611973617, "creation_date": 1530612730, "question_id": 51151973, "link": "https://stackoverflow.com/questions/51151973/catching-bind-address-already-in-use-in-golang", "title": "Catching &quot;bind: address already in use&quot; in golang", "body": "<p>I want to catch \"bind: address already in use\" error in golang.</p>\n\n<pre><code>conn, err := net.ListenUDP(\"udp\", addr)\nif err != nil {\n    if CATCH_BIND_ERROR(err) {\n         // Do something if 'addr' is already in use\n    } else {\n         panic(err)\n    }\n}\n</code></pre>\n\n<p>Is there any way to implement CATCH_BIND_ERROR function?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 2, "creation_date": 1530612420, "post_id": 51151729, "comment_id": 89287067, "body": "There is only one way and that is to create <code>interface{}</code> that you have mentioned. And then use switch to get the value. If you don&#39;t know the JSON response you can only use <code>interface{}</code>."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1530613870, "post_id": 51151729, "comment_id": 89288020, "body": "This answer might help <a href=\"https://stackoverflow.com/a/49107090/5821354\">stackoverflow.com/a/49107090/5821354</a> on how to fetch value from interface using type assertion"}], "answers": [{"tags": [], "owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "is_accepted": false, "score": 0, "last_activity_date": 1530613248, "creation_date": 1530613248, "answer_id": 51152136, "question_id": 51151729, "link": "https://stackoverflow.com/questions/51151729/how-to-treat-different-types-in-json-response-in-golang-or-typed-language-in-gen/51152136#51152136", "title": "How to treat different types in JSON response in golang or typed language in general", "body": "<p>In this case you have to use <code>interface{}</code>.\n<br>But with purpose to reduce complexity of your struct you can have one additional field like <code>NameValue</code> and fill this value after <code>json.Unmarshal</code> and assign value or from <code>person</code> either from <code>person.name</code>.\n<br>In your code you can loosely use <code>NameValue</code> which will always contain correct value.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user9946708"}, "edited": false, "score": 0, "creation_date": 1530614441, "post_id": 51152383, "comment_id": 89288376, "body": "This looks promising."}], "tags": [], "owner": {"reputation": 162, "user_id": 7666241, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gr16JlVLvdE/AAAAAAAAAAI/AAAAAAAAGqI/lTWCYP2XrPQ/photo.jpg?sz=128", "display_name": "KeKsBoTer", "link": "https://stackoverflow.com/users/7666241/keksboter"}, "is_accepted": true, "score": 3, "last_activity_date": 1530613988, "creation_date": 1530613988, "answer_id": 51152383, "question_id": 51151729, "link": "https://stackoverflow.com/questions/51151729/how-to-treat-different-types-in-json-response-in-golang-or-typed-language-in-gen/51152383#51152383", "title": "How to treat different types in JSON response in golang or typed language in general", "body": "<p>Another option is to define a type with custom JSON marshal and unmarshal functions.</p>\n\n<pre><code>type Person string\n\nfunc (p *Person) UnmarshalJSON(b []byte) error {\n    if strings.HasPrefix(string(*p),\"{\"){\n        value := map[string]string{}\n        json.Unmarshal(b,&amp;value)\n        *p = Person(value[\"name\"])\n    }else{\n        *p = Person(b)\n    }\n    return nil\n}\n\nfunc (p Person) MarshalJSON() ([]byte, error) {\n    return []byte(p),nil\n}\n\n\ntype PersonStruct struct{\n    Person  Person `json:\"person\"`\n}\n\nfunc main(){\n    one := `{\"person\": \"john\"}`\n    two := `{\"person\": {name:\"john\"}}`\n    result := PersonStruct{}\n    json.Unmarshal([]byte(one),&amp;result)\n    fmt.Println(result)\n    json.Unmarshal([]byte(two),&amp;result)\n    fmt.Println(result)\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9946708"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 51152383, "answer_count": 2, "score": 1, "last_activity_date": 1530613988, "creation_date": 1530612059, "question_id": 51151729, "link": "https://stackoverflow.com/questions/51151729/how-to-treat-different-types-in-json-response-in-golang-or-typed-language-in-gen", "title": "How to treat different types in JSON response in golang or typed language in general", "body": "<p>I am working on a project in golang and I need to work with JSON response. The thing is that a value in JSON coming from server can be something like </p>\n\n<pre><code>{person: \"john\"} \n</code></pre>\n\n<p>or </p>\n\n<pre><code>{person: {name:\"john\"}} \n</code></pre>\n\n<p>so to create a structure for capturing this I have a couple of options:</p>\n\n<p>1) make person type as interface{}, but this will have redundant code later to work with the value</p>\n\n<p>2) store values in new properties, like PersonAsString and PersonAsObject, this makes code bit more unpredictable as it meant to be used as a module for other developers</p>\n\n<p>any other pros and cons for this? any other suggestions how to treat unknown type JSON fields?</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1530610832, "post_id": 51151234, "comment_id": 89286036, "body": "I don&#39;t understand your question. What have you tried? What specific problem are you having?"}, {"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1530611511, "post_id": 51151234, "comment_id": 89286447, "body": "I think the OP wants to test that the func HTTPGet sends a request with the passed in url."}, {"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1530612112, "post_id": 51151234, "comment_id": 89286875, "body": "<code>getClient</code> seems to be irrelevant to this question. Is that correct?"}], "answers": [{"tags": [], "owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "is_accepted": true, "score": 0, "last_activity_date": 1530627939, "last_edit_date": 1530627939, "creation_date": 1530611196, "answer_id": 51151433, "question_id": 51151234, "link": "https://stackoverflow.com/questions/51151234/how-to-mock-getclient/51151433#51151433", "title": "How to mock getClient?", "body": "<p>You can read and save the requested url in the following manner:</p>\n\n<pre><code>var receivedURL string\nfunc Handler(w http.ResponseWriter, r *http.Request) {\n    receivedURL = r.RequestURI\n    fmt.Fprintf(w, \"Hello, Client\")\n}\n</code></pre>\n\n<p>Then later just assert it:</p>\n\n<pre><code>func TestHTTPGet(t *testing.T) {\n    ts := httptest.NewServer(http.HandlerFunc(Handler))\n    defer ts.Close()\n    mockServerURL := ts.URL\n    url := fmt.Sprintf(\"%s%s\", mockServerURL, '/path/to/test')\n    resp, err := HTTPGet(mockServerURL)\n    defer resp.Body.Close()\n    assertEquals(receivedURL, url, t)\n}\n</code></pre>\n"}], "owner": {"reputation": 344, "user_id": 1538016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0571ecc6828cf8c1c55fb8e89dc51663?s=128&d=identicon&r=PG&f=1", "display_name": "gautam", "link": "https://stackoverflow.com/users/1538016/gautam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "closed_date": 1530619588, "accepted_answer_id": 51151433, "answer_count": 1, "score": -2, "last_activity_date": 1530627939, "creation_date": 1530610582, "question_id": 51151234, "link": "https://stackoverflow.com/questions/51151234/how-to-mock-getclient", "closed_reason": "Needs details or clarity", "title": "How to mock getClient?", "body": "<p>I have a function :</p>\n\n<pre><code>func HTTPGet(url string) (*http.Response, error) {\n    resp, err := getClient().Get(url)\n    return resp, err\n}\n</code></pre>\n\n<p>and getClient function is :</p>\n\n<pre><code>var defaultClient *http.Client\nfunc getClient() *http.Client {\n    if defaultClient == nil {\n        defaultClient = &amp;http.Client{\n            Timeout:   time.Second * 60,\n            Transport: newDefaultTransport(),\n        }\n    }\n    return defaultClient\n}\n</code></pre>\n\n<p>I need to write testcase for HTTPGet for url : \"/catalog/v6/providers\".</p>\n\n<p>I have written testcase for default URL like :</p>\n\n<pre><code>func Handler(w http.ResponseWriter, r *http.Request) {\n     fmt.Fprintf(w, \"Hello, Client\")\n}\nfunc TestHTTPGet(t *testing.T) {\n    ts := httptest.NewServer(http.HandlerFunc(Handler))\n    defer ts.Close()\n    mockServerURL := ts.URL\n    resp, err := HTTPGet(mockServerURL)\n    defer resp.Body.Close()\n    body, _ := ioutil.ReadAll(resp.Body)\n    assertEquals(\"Hello, Client\", fmt.Sprintf(\"%s\", body), t)\n}\n</code></pre>\n\n<p>But How to write testcase for specific URL.</p>\n"}, {"tags": ["mongodb", "go", "mongodb-query", "mgo"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1530601333, "post_id": 51147095, "comment_id": 89280747, "body": "No. I&#39;ve never used MongoDB. I don&#39;t know why you assume that someone who improves your formatting would be a subject matter expert on your specific question. But you already have multiple answers."}, {"owner": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530601508, "post_id": 51147095, "comment_id": 89280843, "body": "@flimzy these answers are right if we run this in the mongodb shell but i need it to make as a query in golang"}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "edited": false, "score": 0, "creation_date": 1530595674, "post_id": 51147118, "comment_id": 89278358, "body": "then how it will written in go can you tell me sir @mickl"}, {"owner": {"reputation": 40100, "user_id": 6238977, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kBcTp.png?s=128&g=1", "display_name": "mickl", "link": "https://stackoverflow.com/users/6238977/mickl"}, "reply_to_user": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "edited": false, "score": 1, "creation_date": 1530596815, "post_id": 51147118, "comment_id": 89278774, "body": "@ansh there was nothing about go in your question :) You need to read the docs, maybe here: <a href=\"https://godoc.org/labix.org/v2/mgo#Collection.Find\" rel=\"nofollow noreferrer\">godoc.org/labix.org/v2/mgo#Collection.Find</a>"}, {"owner": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "edited": false, "score": 0, "creation_date": 1530597505, "post_id": 51147118, "comment_id": 89278986, "body": "see I&#39;m using the Query like that ` \tconditions := bson.M{&#39;_id&#39;: bson.M{&#39;$type&#39;: &quot;objectId&quot; } }  \tdata, err := models.GetAllUsers(conditions)`"}], "tags": [], "owner": {"reputation": 40100, "user_id": 6238977, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kBcTp.png?s=128&g=1", "display_name": "mickl", "link": "https://stackoverflow.com/users/6238977/mickl"}, "is_accepted": false, "score": 1, "last_activity_date": 1530595134, "creation_date": 1530595134, "answer_id": 51147118, "question_id": 51147095, "link": "https://stackoverflow.com/questions/51147095/how-to-get-all-the-records-in-mongodb-having-object-id/51147118#51147118", "title": "How to get all the records in mongodb having object id", "body": "<p>You can use <a href=\"https://docs.mongodb.com/manual/reference/operator/query/type/\" rel=\"nofollow noreferrer\">$type</a> operator:</p>\n\n<pre><code>db.challenge.find({ _id: { $type: \"objectId\" } })\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "edited": false, "score": 0, "creation_date": 1530600197, "post_id": 51147626, "comment_id": 89280173, "body": "can you please tell me how i will write the query in go lang"}, {"owner": {"reputation": 3476, "user_id": 6633337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JpQt1.jpg?s=128&g=1", "display_name": "Ratan Uday Kumar", "link": "https://stackoverflow.com/users/6633337/ratan-uday-kumar"}, "reply_to_user": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "edited": false, "score": 0, "creation_date": 1530600368, "post_id": 51147626, "comment_id": 89280255, "body": "refer this document <a href=\"http://goinbigdata.com/how-to-build-microservice-with-mongodb-in-golang/\" rel=\"nofollow noreferrer\">goinbigdata.com/&hellip;</a>"}, {"owner": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "edited": false, "score": 0, "creation_date": 1530600664, "post_id": 51147626, "comment_id": 89280406, "body": "see @ratanUdayKumar I&#39;m also writing it like that but it gives me error<code>conditions := bson.M{&#39;_id&#39;: bson.M{&#39;$type&#39;: &quot;objectId&quot; } } \tdata, err := models.GetAllUsers(conditions)</code>"}], "tags": [], "owner": {"reputation": 3476, "user_id": 6633337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/JpQt1.jpg?s=128&g=1", "display_name": "Ratan Uday Kumar", "link": "https://stackoverflow.com/users/6633337/ratan-uday-kumar"}, "is_accepted": false, "score": 1, "last_activity_date": 1530606645, "last_edit_date": 1530606645, "creation_date": 1530597970, "answer_id": 51147626, "question_id": 51147095, "link": "https://stackoverflow.com/questions/51147095/how-to-get-all-the-records-in-mongodb-having-object-id/51147626#51147626", "title": "How to get all the records in mongodb having object id", "body": "<p>You can try like below</p>\n\n<pre><code>//For Retrieving for ObjectID\ndb.challange.find(\n    {\n        \"_id\": {\n            $type: 7  //ObjectID\n        }\n    }\n)\n\n//For Retrieving for Number\ndb.challange.find(\n    {\n        $or: [\n            {\n                \"_id\": {\n                    $type: 1  //double\n                }\n            },\n            {\n                \"_id\": {\n                    $type: 16  //32 bit integer\n                }\n            },\n            {\n                \"_id\": {\n                    $type: 18  //64 bit integer\n                }\n            },\n            {\n                \"_id\": {\n                    $type: 19  //decimal\n                }\n            }\n        ]\n    }\n)\n</code></pre>\n\n<p>Refer <a href=\"https://docs.mongodb.com/manual/reference/operator/query/type/\" rel=\"nofollow noreferrer\">$type</a> ,  <a href=\"https://docs.mongodb.com/manual/reference/operator/query/or/\" rel=\"nofollow noreferrer\">$or</a></p>\n"}, {"comments": [{"owner": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "edited": false, "score": 0, "creation_date": 1530606029, "post_id": 51148925, "comment_id": 89283111, "body": "Thanks for this awesome answer"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1530616694, "last_edit_date": 1530616694, "creation_date": 1530603231, "answer_id": 51148925, "question_id": 51147095, "link": "https://stackoverflow.com/questions/51147095/how-to-get-all-the-records-in-mongodb-having-object-id/51148925#51148925", "title": "How to get all the records in mongodb having object id", "body": "<p><code>'_id'</code> and <code>'$type'</code> are invalid <a href=\"https://golang.org/ref/spec#Rune_literals\" rel=\"nofollow noreferrer\">rune literals</a>, you can't list multiple runes (characters) in a rune literal (only a single rune).</p>\n\n<p>The <a href=\"https://godoc.org/github.com/globalsign/mgo/bson#M\" rel=\"nofollow noreferrer\"><code>bson.M</code></a> type is a map with <code>string</code> key type, so you have to use <a href=\"https://golang.org/ref/spec#String_literals\" rel=\"nofollow noreferrer\">string literals</a> (or expressions), like this:</p>\n\n<pre><code>conditions := bson.M{\"_id\": bson.M{\"$type\": \"objectId\"}}\n</code></pre>\n\n<p>Also note that the <a href=\"https://godoc.org/github.com/globalsign/mgo/bson\" rel=\"nofollow noreferrer\"><code>bson</code></a> package holds <a href=\"https://godoc.org/github.com/globalsign/mgo/bson#pkg-constants\" rel=\"nofollow noreferrer\">constants</a> for the different types, so it's safer to use those constants:</p>\n\n<pre><code>conditions := bson.M{\"_id\": bson.M{\"$type\": bson.ElementObjectId}}\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 9999536, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f05a59f4a6460df7878bf32a305c91d?s=128&d=identicon&r=PG&f=1", "display_name": "ansh", "link": "https://stackoverflow.com/users/9999536/ansh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1405, "favorite_count": 0, "accepted_answer_id": 51148925, "answer_count": 3, "score": 0, "last_activity_date": 1530616694, "creation_date": 1530594971, "last_edit_date": 1530607120, "question_id": 51147095, "link": "https://stackoverflow.com/questions/51147095/how-to-get-all-the-records-in-mongodb-having-object-id", "title": "How to get all the records in mongodb having object id", "body": "<p>In the mongodb there is a user data has been stored in collection <code>challange</code> the data seems like bellow:</p>\n\n<pre><code>{\n\"_id\" : 1,\n \"name\" : \"puneet\",\n \"last\" : \"jindal\",\n \"email\" : \"puneet@g.com\"\n}\n{\n \"_id\" : ObjectId(\"5b3af82cdb3aaa47792b5fd3\"),\n \"name\" : \"hardeep\",\n \"last\" : \"singh\",\n \"email\" : \"hardeep@g.com\"\n}\n{ \n \"_id\" : 3,\n \"name\" : \"gaurav\",\n \"last\" : \"bansal\",\n \"email\" : \"gaurav@g.com\"\n}\n{\n \"_id\" : ObjectId(\"5b3af87ddb3aaa47792b5fd4\"),\n \"name\" : \"manish\",\n \"last\" : \"jindal\",\n \"email\" : \"manish@g.com\"\n}\n</code></pre>\n\n<p>In the above data there are four records and two of them having id in the integer form and other will having id in object form. I just want to retrieve the all the records which are having the <code>object id</code> in the id field. can anyone tell what query should I write in the code that will only retrieve that records which are having the object id.</p>\n\n<p>Updated:</p>\n\n<p>code I'm using :</p>\n\n<pre><code>type User struct {\n Id              bson.ObjectId    `json:\"_id\" bson:\"_id,omitempty\"`\n Name            string    `json:\"name,omitempty\" bson:\"name,omitempty\"`\n Last            string `json:\"last,omitempty\" bson:\"last,omitempty\"`\n Email          string `json:\"email,omitempty\" bson:\"email,omitempty\"`\n}\ntype Users []User\n\nfunc GetAllUsers(listQuery interface{}) (result Users, err error) {\n mongoSession := config.ConnectDb()\n sessionCopy := mongoSession.Copy()\n defer sessionCopy.Close()\n getCollection := mongoSession.DB(config.Database).C(config.UsersCollection)\n err = getCollection.Find(listQuery).Select(bson.M{\"password\": 0}).All(&amp;result)\n if err != nil {\n    return result, err\n }\n return result, nil\n}\n\nconditions := bson.M{'_id': bson.M{'$type': \"objectId\" } }\ndata, err := models.GetAllUsers(conditions) \n</code></pre>\n\n<p>The error I'm facing by using this :-</p>\n\n<blockquote>\n  <p>controllers/UserController.go:18:23: invalid character literal (more than one character)\n  controllers/UserController.go:18:28: cannot use '\\u0000' (type rune) as type string in map key</p>\n</blockquote>\n"}, {"tags": ["go", "web", "multilingual"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 5, "creation_date": 1530596547, "post_id": 51146794, "comment_id": 89278673, "body": "Well, that is a very broad question. Some frameworks provide some functionality here. You might want to check golang.org/x/text which is still under development."}, {"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 0, "creation_date": 1530608604, "post_id": 51146794, "comment_id": 89284640, "body": "That&#39;s a <i>web framework</i> and a <i>site design</i> feature, not a language feature. In fact, it&#39;s just one way of providing multilingual content. A multinational company would need different <i>sites</i> per language/country, not just translated content."}], "answers": [{"comments": [{"owner": {"reputation": 310, "user_id": 6811933, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1073602816008139/picture?type=large", "display_name": "Kshitij Kumar", "link": "https://stackoverflow.com/users/6811933/kshitij-kumar"}, "edited": false, "score": 0, "creation_date": 1530626298, "post_id": 51155586, "comment_id": 89296296, "body": "This looks clean. Thanks!"}, {"owner": {"reputation": 8129, "user_id": 1011695, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/00787a09c9726b2074f2bb786f88162c?s=128&d=identicon&r=PG", "display_name": "Everton", "link": "https://stackoverflow.com/users/1011695/everton"}, "reply_to_user": {"reputation": 310, "user_id": 6811933, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1073602816008139/picture?type=large", "display_name": "Kshitij Kumar", "link": "https://stackoverflow.com/users/6811933/kshitij-kumar"}, "edited": false, "score": 2, "creation_date": 1530626723, "post_id": 51155586, "comment_id": 89296577, "body": "@KshitijKumar If the answer solved your issue, you should accept it."}, {"owner": {"reputation": 310, "user_id": 6811933, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1073602816008139/picture?type=large", "display_name": "Kshitij Kumar", "link": "https://stackoverflow.com/users/6811933/kshitij-kumar"}, "edited": false, "score": 1, "creation_date": 1530875038, "post_id": 51155586, "comment_id": 89398668, "body": "I cleaned it a little bit more to segregate pages as well: <a href=\"https://play.golang.org/p/dMnvs0K3Hag\" rel=\"nofollow noreferrer\">play.golang.org/p/dMnvs0K3Hag</a>"}], "tags": [], "owner": {"reputation": 162, "user_id": 7666241, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gr16JlVLvdE/AAAAAAAAAAI/AAAAAAAAGqI/lTWCYP2XrPQ/photo.jpg?sz=128", "display_name": "KeKsBoTer", "link": "https://stackoverflow.com/users/7666241/keksboter"}, "is_accepted": true, "score": 5, "last_activity_date": 1530623661, "creation_date": 1530623661, "answer_id": 51155586, "question_id": 51146794, "link": "https://stackoverflow.com/questions/51146794/what-is-the-standard-idiomatic-way-to-handle-multilingual-go-web-apps/51155586#51155586", "title": "What is the standard/ idiomatic way to handle multilingual Go web apps?", "body": "<p>I allways use a map and define a function on it, which returns the text for a given key:</p>\n\n<pre><code>type Texts map[string]string\n\nfunc (t *Texts) Get(key string) string{\n    return (*t)[key]\n}\n\nvar texts = map[string]Texts{\n    \"de\":Texts{\n        \"title\":\"Deutscher Titel\",\n    },\n    \"en\":Texts{\n        \"title\":\"English title\",\n    },\n}\n\nfunc executeTemplate(lang string){\n    tmpl, _ := template.New(\"example\").Parse(`Title: {{.Texts.Get \"title\" }} `)\n    tmpl.Execute(os.Stdout,struct{\n        Texts Texts\n    }{\n        Texts: texts[lang],\n    })\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3406, "user_id": 110186, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/AemXl.jpg?s=128&g=1", "display_name": "Feckmore", "link": "https://stackoverflow.com/users/110186/feckmore"}, "is_accepted": false, "score": 5, "last_activity_date": 1530633485, "creation_date": 1530633485, "answer_id": 51158783, "question_id": 51146794, "link": "https://stackoverflow.com/questions/51146794/what-is-the-standard-idiomatic-way-to-handle-multilingual-go-web-apps/51158783#51158783", "title": "What is the standard/ idiomatic way to handle multilingual Go web apps?", "body": "<p>If a user's preferred language has a possibility of being unavailable, you can use Golang's <a href=\"https://godoc.org/golang.org/x/text/language\" rel=\"noreferrer\">text/language package</a> to match requested languages to supported languages.  </p>\n\n<p>This type of language matching is a non-trivial problem as <a href=\"https://blog.golang.org/matchlang\" rel=\"noreferrer\">outlined in this excellent post in The Go Blog</a>.</p>\n\n<p>To use the language package, create a matcher with a slice of supported languages:</p>\n\n<pre><code>var serverLangs = []language.Tag{\n    language.AmericanEnglish, // en-US fallback\n    language.German,          // de\n}\n\nvar matcher = language.NewMatcher(serverLangs)\n</code></pre>\n\n<p>Then match against one or more preferred languages. (The preferred language may be based on the user's IP address or the <code>Accept-Language</code> header.)</p>\n\n<pre><code>var userPrefs = []language.Tag{\n    language.Make(\"gsw\"), // Swiss German\n    language.Make(\"fr\"),  // French\n}\n\ntag, index, confidence := matcher.Match(sortLanguageTags(&amp;langs, DescendingQuality)...)\n</code></pre>\n\n<p>To retrieve the corresponding text for the language, you can use the <code>tag.String()</code> method:</p>\n\n<pre><code>type Translation map[string]string\ntype Translations map[string]Translation\n\ntranslations := Translations{\n        \"knee\": {\n            language.German.String():          \"knie\",\n            language.AmericanEnglish.String(): \"knee\",\n        },\n    }\n\nfmt.Println(translations[\"knee\"][tag.String()]) // prints \"knie\"\n</code></pre>\n"}], "owner": {"reputation": 310, "user_id": 6811933, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1073602816008139/picture?type=large", "display_name": "Kshitij Kumar", "link": "https://stackoverflow.com/users/6811933/kshitij-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1146, "favorite_count": 3, "accepted_answer_id": 51155586, "answer_count": 2, "score": 4, "last_activity_date": 1530633485, "creation_date": 1530592964, "question_id": 51146794, "link": "https://stackoverflow.com/questions/51146794/what-is-the-standard-idiomatic-way-to-handle-multilingual-go-web-apps", "title": "What is the standard/ idiomatic way to handle multilingual Go web apps?", "body": "<p>I'm working on a website which needs to deliver web pages in different languages as selected by the user. e.g. if the user selects Spanish as his preferred language, the server should send text elements of web pages in Spanish.</p>\n\n<p>What is the standard way of doing it in Go? I'd also love to know what methods you guys are using.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["javascript", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530604730, "post_id": 51146125, "comment_id": 89282431, "body": "What is the error?"}, {"owner": {"reputation": 10321, "user_id": 215552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/26bda02894d869c95f620de4b7cd386d?s=128&d=identicon&r=PG", "display_name": "Heretic Monkey", "link": "https://stackoverflow.com/users/215552/heretic-monkey"}, "edited": false, "score": 0, "creation_date": 1530622304, "post_id": 51146125, "comment_id": 89293404, "body": "@V5NXT Please don&#39;t use snippets for Go language code; they only work for HTML, CSS, and JavaScript."}], "answers": [{"tags": [], "owner": {"reputation": 2449, "user_id": 6346483, "user_type": "registered", "profile_image": "https://graph.facebook.com/10154223277015798/picture?type=large", "display_name": "Anish Goyal", "link": "https://stackoverflow.com/users/6346483/anish-goyal"}, "is_accepted": false, "score": 7, "last_activity_date": 1530618756, "last_edit_date": 1530618756, "creation_date": 1530588877, "answer_id": 51146313, "question_id": 51146125, "link": "https://stackoverflow.com/questions/51146125/golang-html-template-cannot-call-javascript-file-in-html-file/51146313#51146313", "title": "Golang html template cannot call javascript file in html file", "body": "<p>The issue seems to be that you are spinning up a server that only serves the HTML template - not the script. When a browser attempts to load your scripts, the server returns your index page.</p>\n\n<p>Take a look at <a href=\"https://www.alexedwards.net/blog/serving-static-sites-with-go\" rel=\"nofollow noreferrer\">https://www.alexedwards.net/blog/serving-static-sites-with-go</a>; this post discusses how you can serve static files.</p>\n\n<p>For your purposes, you may be able to get by just by adding the following lines to the beginning of your main method:</p>\n\n<pre><code>fs := http.FileServer(http.Dir(\"public\"))\nhttp.Handle(\"/public/\", http.StripPrefix(\"/static/\", fs))\n</code></pre>\n\n<p>This will load any files in your directory, \"public\" (relative to your compiled executable), and serve them at url/public/path/to/file</p>\n\n<p>As a word of caution: by default, this will enable directory listings for your public directory (users will be able to see a list of files in that directory and all subdirectories). Take a look at the answer for this question for info on how to disable directory listings: <a href=\"https://stackoverflow.com/a/40718195/6346483\">https://stackoverflow.com/a/40718195/6346483</a></p>\n"}, {"tags": [], "owner": {"reputation": 333, "user_id": 8989452, "user_type": "registered", "profile_image": "https://graph.facebook.com/1517851688282463/picture?type=large", "display_name": "Krzysztof Skolimowski", "link": "https://stackoverflow.com/users/8989452/krzysztof-skolimowski"}, "is_accepted": false, "score": 0, "last_activity_date": 1530621576, "creation_date": 1530621576, "answer_id": 51154899, "question_id": 51146125, "link": "https://stackoverflow.com/questions/51146125/golang-html-template-cannot-call-javascript-file-in-html-file/51154899#51154899", "title": "Golang html template cannot call javascript file in html file", "body": "<p>Are you serving <code>public/bundle.js</code>? </p>\n\n<p>If not you need to serve it somehow. For example you can use <code>net/http</code> <a href=\"https://golang.org/pkg/net/http/#ServeFile\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#ServeFile</a></p>\n"}], "owner": {"reputation": 47, "user_id": 9918438, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-ldgVRxIXQrA/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq0F2CgRAhW9tpNdAYcm3qO3lUcJKg/mo/photo.jpg?sz=128", "display_name": "Phuc Hoang", "link": "https://stackoverflow.com/users/9918438/phuc-hoang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2958, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1530621576, "creation_date": 1530587228, "question_id": 51146125, "link": "https://stackoverflow.com/questions/51146125/golang-html-template-cannot-call-javascript-file-in-html-file", "title": "Golang html template cannot call javascript file in html file", "body": "<p>I bundle React app with Webpack after I call it in HTML file. However, it error when I using Golang and html/template to view HTML file.<br/><br/>\nMy HTML file: index.html<br/><br/></p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n    &lt;head&gt;\n        &lt;meta charset=\"UTF-8\"&gt;\n        &lt;title&gt;Note App&lt;/title&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;div id=\"root\"&gt;&lt;/div&gt;\n        &lt;script src=\"public/bundle.js\"&gt;&lt;/script&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p><br/><br/>\nMy Golang file: index.go<br/><br/></p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"html/template\"\n    \"path/filepath\"\n)\n\nfunc handle(w http.ResponseWriter, r *http.Request) {\n    fp := filepath.Join(\"views\", \"index.html\")\n    t := template.Must(template.ParseFiles(fp))\n    t.Execute(w, nil)\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", handle)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n"}, {"tags": ["go", "github"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1530579145, "post_id": 51143581, "comment_id": 89274859, "body": "Shouldn&#39;t you use a package manager like dep?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530601047, "post_id": 51143581, "comment_id": 89280610, "body": "Why is it &quot;too large&quot;? Too large for what, specifically? Does the download timeout? Is it using too much disk space? How large is it?"}], "answers": [{"tags": [], "owner": {"reputation": 91, "user_id": 9911189, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FpQ1Ants5QU/AAAAAAAAAAI/AAAAAAAAAAc/E4smqVInW44/photo.jpg?sz=128", "display_name": "Arthur Ruckman", "link": "https://stackoverflow.com/users/9911189/arthur-ruckman"}, "is_accepted": false, "score": 1, "last_activity_date": 1530568210, "creation_date": 1530568210, "answer_id": 51144154, "question_id": 51143581, "link": "https://stackoverflow.com/questions/51143581/connect-golang-to-github/51144154#51144154", "title": "Connect GoLang to GitHub", "body": "<p>There's no tool I know of that could do this. You could use <code>go list -f '{{ .Imports }}'</code> or similar to list the dependencies you need for any given Go package, and script a way to download only the files needed. But you also have to think about things like templates or config files that your programs might access too. </p>\n\n<p>Alternatively, and I have no idea if this will work, you could try mounting your Git repository as a FUSE mount. I <a href=\"https://www.presslabs.org/gitfs/\" rel=\"nofollow noreferrer\">found this</a> in a quick Google search. This will let you download the files you need on demand, and of course when you compile your program, it will only include the code needed. </p>\n"}], "owner": {"reputation": 49, "user_id": 8420318, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Hz06_ai_rOk/AAAAAAAAAAI/AAAAAAAAAAA/7pvwVEZcmEU/photo.jpg?sz=128", "display_name": "Ahmad Al-Bassyiouni", "link": "https://stackoverflow.com/users/8420318/ahmad-al-bassyiouni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1530601016, "creation_date": 1530564759, "last_edit_date": 1530601016, "question_id": 51143581, "link": "https://stackoverflow.com/questions/51143581/connect-golang-to-github", "title": "Connect GoLang to GitHub", "body": "<p>I have a fairly large project in github that I would like not to download in its entirety. The file is mostly Go based. Unfortunately, most of the file's packages call each other. I would like to use some of the files within this repo to test my code before I push it with the rest. Is their any way to import it into golang without downloading the file (using go get github.com/foo)?</p>\n\n<p>As stated above, I've tried using go get github.com/etc. but it's way to large for that.</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "edited": false, "score": 1, "creation_date": 1530566660, "post_id": 51143456, "comment_id": 89271950, "body": "Do these answers help? <a href=\"https://stackoverflow.com/questions/19167970/mock-functions-in-go\" title=\"mock functions in go\">stackoverflow.com/questions/19167970/mock-functions-in-go</a>"}], "answers": [{"tags": [], "owner": {"reputation": 506, "user_id": 2832138, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a572640dcd7416b0783869fe6759d32?s=128&d=identicon&r=PG", "display_name": "Maxim", "link": "https://stackoverflow.com/users/2832138/maxim"}, "is_accepted": true, "score": 2, "last_activity_date": 1530705110, "last_edit_date": 1530705110, "creation_date": 1530703196, "answer_id": 51172437, "question_id": 51143456, "link": "https://stackoverflow.com/questions/51143456/writing-tests-for-cli-input/51172437#51172437", "title": "Writing tests for cli input", "body": "<p>If all of your tasks/commands have different sets of flags I would end up with introducing some kind of Command abstraction. The best example can be found in the Go source code itself:</p>\n\n<pre><code>base.Commands = []*base.Command{\n        work.CmdBuild,\n        clean.CmdClean,\n        doc.CmdDoc,\n        envcmd.CmdEnv,\n        bug.CmdBug,\n        fix.CmdFix,\n        //...\n}\n</code></pre>\n\n<p>Each command can have its own flag.FlagSet to parse command-specific flags:</p>\n\n<pre><code>// A Command is an implementation of a go command\n// like go build or go fix.\ntype Command struct {\n    // Run runs the command.\n    // The args are the arguments after the command name.\n    Run func(cmd *Command, args []string)\n\n    // UsageLine is the one-line usage message.\n    // The first word in the line is taken to be the command name.\n    UsageLine string\n\n    // Short is the short description shown in the 'go help' output.\n    Short string\n\n    // Long is the long message shown in the 'go help &lt;this-command&gt;' output.\n    Long string\n\n    // Flag is a set of flags specific to this command.\n    Flag flag.FlagSet\n\n    // CustomFlags indicates that the command will do its own\n    // flag parsing.\n    CustomFlags bool\n}\n</code></pre>\n\n<p>Using this approach you can separate commands' flags parsing from the execution.</p>\n"}], "owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 51172437, "answer_count": 1, "score": 1, "last_activity_date": 1530705110, "creation_date": 1530564120, "last_edit_date": 1530600975, "question_id": 51143456, "link": "https://stackoverflow.com/questions/51143456/writing-tests-for-cli-input", "title": "Writing tests for cli input", "body": "<p>I have a small Go app with a cli using flags and I've been asked to make it more testable.</p>\n\n<p>My app gets called on the command line like \n<code>deploy.exe &lt;task&gt; &lt;command&gt; -tenant tenant_name -validate -package \"c:\\some dir\\\\\"</code></p>\n\n<p>Based on which <code>task</code> and <code>command</code> a different execution path is called and ultimately a func residing in another package is called like:</p>\n\n<pre><code>if command == \"db\" {\n     dbhelper.RunDBCmds(*tenant, *validate, *package)\n}\n</code></pre>\n\n<p>I need to write unit tests for just the flag parsing, without calling the actual functions at the end.</p>\n\n<p>I'm fairly new to Go and I'm struggling figuring out how to accomplish this.   I've thought about adding my Os.Args() and Flag parsing to a function that takes input and outputs a pointer of sorts to the <code>RunDBCmds(*tenant, ...)</code> func.  However, I'm just not sure I can accomplish returning a pointer to a function.      </p>\n\n<p>I'd appreciate any advice on how I can make my code more testable without actually invoking the functions.</p>\n"}, {"tags": ["go", "redis"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530564565, "post_id": 51143439, "comment_id": 89271222, "body": "Can you post the code with your attempted implementation and details on the issue you ran into?"}, {"owner": {"reputation": 131, "user_id": 5001230, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nqo0Ar8nIUg/AAAAAAAAAAI/AAAAAAAABdI/6cpDBkb_ypE/photo.jpg?sz=128", "display_name": "Nidhi Sharma", "link": "https://stackoverflow.com/users/5001230/nidhi-sharma"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530565194, "post_id": 51143439, "comment_id": 89271430, "body": "I have posted the code for making connection with redis, but what i dont know is how to query if the loading value is 0 which we get by &quot;info persistence&quot; on redis cli."}], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 5001230, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nqo0Ar8nIUg/AAAAAAAAAAI/AAAAAAAABdI/6cpDBkb_ypE/photo.jpg?sz=128", "display_name": "Nidhi Sharma", "link": "https://stackoverflow.com/users/5001230/nidhi-sharma"}, "edited": false, "score": 0, "creation_date": 1531175212, "post_id": 51145099, "comment_id": 89488614, "body": "Thanks, how we can check this thing every 10 miliseconds ?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 131, "user_id": 5001230, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nqo0Ar8nIUg/AAAAAAAAAAI/AAAAAAAABdI/6cpDBkb_ypE/photo.jpg?sz=128", "display_name": "Nidhi Sharma", "link": "https://stackoverflow.com/users/5001230/nidhi-sharma"}, "edited": false, "score": 0, "creation_date": 1531175739, "post_id": 51145099, "comment_id": 89488742, "body": "@NidhiSharma Call the code above in a loop.  Either loop and <a href=\"https://godoc.org/time#Sleep\" rel=\"nofollow noreferrer\">sleep</a> on each iteration or range over a <a href=\"https://godoc.org/time#Ticker.C\" rel=\"nofollow noreferrer\">ticker channel</a>."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 0, "last_activity_date": 1530580132, "last_edit_date": 1530580132, "creation_date": 1530576635, "answer_id": 51145099, "question_id": 51143439, "link": "https://stackoverflow.com/questions/51143439/how-to-query-redis-db-using-golang-if-its-up-and-running-for-taking-connections/51145099#51145099", "title": "how to query redis Db using golang if its up and running for taking connections?", "body": "<p>Get the info:</p>\n\n<pre><code> info, err := redis.String(c.Do(\"INFO\", \"persistence\"))\n if err != nil {\n     // handle error\n }\n</code></pre>\n\n<p>Check the loading field:</p>\n\n<pre><code> re := regexp.MustCompile(\"^loading:0$\") // this can be done once and stored as a package level variable.\n if re.MatchString(info) {\n       // loading is zero!\n }\n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 5001230, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-nqo0Ar8nIUg/AAAAAAAAAAI/AAAAAAAABdI/6cpDBkb_ypE/photo.jpg?sz=128", "display_name": "Nidhi Sharma", "link": "https://stackoverflow.com/users/5001230/nidhi-sharma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 51145099, "answer_count": 1, "score": -1, "last_activity_date": 1532376688, "creation_date": 1530564033, "last_edit_date": 1532376688, "question_id": 51143439, "link": "https://stackoverflow.com/questions/51143439/how-to-query-redis-db-using-golang-if-its-up-and-running-for-taking-connections", "title": "how to query redis Db using golang if its up and running for taking connections?", "body": "<p>My redis db has huge number of keys, so when I start my code, at that time if I do info persistence (on redis CLI) it gives me following, Loading: 1 means that redis is not ready to take the connections,while loading :0 means redis up and running and ready to take connections.</p>\n\n<pre><code>loading:1\nrdb_changes_since_last_save:1024\nrdb_bgsave_in_progress:0\nrdb_last_save_time:1530558451\nrdb_last_bgsave_status:ok\nrdb_last_bgsave_time_sec:-1\nrdb_current_bgsave_time_sec:-1 \nrdb_last_cow_size:0\naof_enabled:0\naof_rewrite_in_progress:0\naof_rewrite_scheduled:0\naof_last_rewrite_time_sec:-1\naof_current_rewrite_time_sec:-1\naof_last_bgrewrite_status:ok\naof_last_write_status:ok\naof_last_cow_size:0\n</code></pre>\n\n<p>My code to establish the connection with redis is as follows:</p>\n\n<pre><code>var DefaultPool = NewPool(\"redis\", 6379)\n\n/*NewPool - create a new redis pool accessible at the given address */\nfunc NewPool(host string, port int) *redis.Pool {\n  var address string\n  if os.Getenv(\"DOCKER\") != \"\" {\n    address = fmt.Sprintf(\"%v:6379\", host)\n  } else {\n    address = fmt.Sprintf(\"127.0.0.1:%v\", port)\n  }\n   return &amp;redis.Pool{\n     MaxIdle:   80,\n     MaxActive: 1000, // max number of connections\n     Dial: func() (redis.Conn, error) {\n        c, err := redis.Dial(\"tcp\", address)\n        if err != nil {\n            panic(err.Error())\n        }\n        return c, err\n      },\n   }\n}\n</code></pre>\n\n<p>How I can constantly check if loading value is 0.</p>\n"}, {"tags": ["go", "interface"], "comments": [{"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 0, "creation_date": 1530560082, "post_id": 51142577, "comment_id": 89269447, "body": "One of the go &quot;special&quot; things. There is no way to convert slice of one type to the other. You have to do it by hand in a <code>for</code> loop... As far as printing the length what you have done <code>fmt.Printf()</code> is the way."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1530602138, "post_id": 51142577, "comment_id": 89281159, "body": "Duplicate. See the Go FAQ: <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">golang.org/doc/faq#convert_slice_of_interface</a>"}], "answers": [{"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 1, "last_activity_date": 1530561391, "creation_date": 1530561391, "answer_id": 51142952, "question_id": 51142577, "link": "https://stackoverflow.com/questions/51142577/parameter-thats-a-list-of-interface/51142952#51142952", "title": "Parameter that&#39;s a list of interface{}", "body": "<p>You can use <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\">reflect</a> package - <a href=\"https://play.golang.org/p/GUDKkATrtGk\" rel=\"nofollow noreferrer\">playground</a></p>\n\n<pre><code>import (\n    \"fmt\"\n    \"reflect\"\n)\nfunc printLength(lis interface{}) {\n    fmt.Printf(\"Length: %d\", reflect.ValueOf(lis).Len())\n}\n</code></pre>\n"}], "owner": {"reputation": 3271, "user_id": 7607701, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-0eLxeTB_SdQ/AAAAAAAAAAI/AAAAAAAAABg/XZT1oaa0wqA/photo.jpg?sz=128", "display_name": "Aaron N. Brock", "link": "https://stackoverflow.com/users/7607701/aaron-n-brock"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "closed_date": 1530602185, "answer_count": 1, "score": -3, "last_activity_date": 1530561391, "creation_date": 1530559545, "question_id": 51142577, "link": "https://stackoverflow.com/questions/51142577/parameter-thats-a-list-of-interface", "closed_reason": "Duplicate", "title": "Parameter that&#39;s a list of interface{}", "body": "<p>I'm trying to create a function that prints out the <code>len</code> of a list passed into it, regardless of the type of the list.  My naive way of doing this was: </p>\n\n<pre><code>func printLength(lis []interface{}) {\n    fmt.Printf(\"Length: %d\", len(lis))\n}\n</code></pre>\n\n<p>However, when trying to use it via</p>\n\n<pre><code>func main() {\n    strs := []string{\"Hello,\", \"World!\"}\n    printLength(strs)\n}\n</code></pre>\n\n<p>It complains saying</p>\n\n<pre><code>cannot use strs (type []string) as type []interface {} in argument to printLength\n</code></pre>\n\n<p>But, a <code>string</code> can be used as a <code>interface{}</code>, so why can't a <code>[]string</code> be used as a <code>[]interface{}</code>?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1530558049, "post_id": 51142255, "comment_id": 89268671, "body": "<code>rows</code> is a struct, and you&#39;re printing out the internal values. Follow the documentation on how to use the <a href=\"https://golang.org/pkg/database/sql/#Rows\" rel=\"nofollow noreferrer\"><code>*sql.Rows</code></a> returned from a <code>DB.Query</code>: <a href=\"https://golang.org/pkg/database/sql/#DB.Query\" rel=\"nofollow noreferrer\">golang.org/pkg/database/sql/#DB.Query</a>"}], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 3, "last_activity_date": 1530558606, "creation_date": 1530558606, "answer_id": 51142388, "question_id": 51142255, "link": "https://stackoverflow.com/questions/51142255/querying-a-postgres-with-golang/51142388#51142388", "title": "Querying a Postgres with Golang", "body": "<blockquote>\n  <p>I was expecting my entire table to return in a somewhat readable format.</p>\n</blockquote>\n\n<p>It does not come back in a \"readable\" format, why would it?</p>\n\n<p><code>Query</code> returns a struct that you can use to iterate through the rows that matched the query.</p>\n\n<p>Adapting the example in the docs to your case, and assuming your <code>title</code> field is a <code>VARCHAR</code>, something like this should work for you:</p>\n\n<pre><code>rows, err := db.Query(\"SELECT title FROM blogs;\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer rows.Close()\nfor rows.Next() {\n    var title string\n    if err := rows.Scan(&amp;title); err != nil {\n            log.Fatal(err)\n    }\n    fmt.Println(title)\n}\nif err := rows.Err(); err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 1185, "user_id": 6907941, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/15451877a4ff142541b59b1d68212451?s=128&d=identicon&r=PG&f=1", "display_name": "Jonas Bergner", "link": "https://stackoverflow.com/users/6907941/jonas-bergner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3398, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1530558606, "creation_date": 1530557933, "last_edit_date": 1530558310, "question_id": 51142255, "link": "https://stackoverflow.com/questions/51142255/querying-a-postgres-with-golang", "title": "Querying a Postgres with Golang", "body": "<p>I am slightly confused by the output i'm receiving from my Postgres when querying it with the use of go.\nSince I am very new to this I have a hard time even forming the right question for this problem I have, so I'll just leave a code block here, with the output I'm receiving and what I expected to happen. I hope this makes it more understandable.</p>\n\n<p>The connection to the postgres db seems to work fine</p>\n\n<pre><code>        rows, err := db.Query(\"SELECT title FROM blogs;\")                                                                                                                                                      \n        fmt.Println(\"output\", rows) \n</code></pre>\n\n<p>However, this is the output I am receiving.</p>\n\n<pre><code>output &amp;{0xc4200ea180 0x4c0e20 0xc42009a3c0 0x4b4f90 &lt;nil&gt; {{0 0} 0 0 0 0} false &lt;nil&gt; []}\n</code></pre>\n\n<p>As I said, I am new to postgres and go, and I have no Idea what I am dealing with here.</p>\n\n<p>I was expecting my entire table to return in a somewhat readable format.</p>\n"}, {"tags": ["go", "recursion", "concurrency", "goroutine", "quadtree"], "comments": [{"owner": {"reputation": 2914, "user_id": 1162491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/S3MH1.jpg?s=128&g=1", "display_name": "Momer", "link": "https://stackoverflow.com/users/1162491/momer"}, "edited": false, "score": 0, "creation_date": 1530593732, "post_id": 51140856, "comment_id": 89277761, "body": "Just a quick note on verbiage- this is not parallel, this is concurrent."}, {"owner": {"reputation": 91, "user_id": 5642158, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5wim1.jpg?s=128&g=1", "display_name": "ashishmax31", "link": "https://stackoverflow.com/users/5642158/ashishmax31"}, "reply_to_user": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "edited": false, "score": 1, "creation_date": 1530596125, "post_id": 51140856, "comment_id": 89278517, "body": "@bigless No i&#39;m not sharing any objects between go-routines, each child has a different <code>q.Points</code>."}], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 5642158, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5wim1.jpg?s=128&g=1", "display_name": "ashishmax31", "link": "https://stackoverflow.com/users/5642158/ashishmax31"}, "edited": false, "score": 0, "creation_date": 1530608098, "post_id": 51148853, "comment_id": 89284346, "body": "Makes sense, So using concurrency/parallelism for this problem is a wrong idea?"}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "reply_to_user": {"reputation": 91, "user_id": 5642158, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5wim1.jpg?s=128&g=1", "display_name": "ashishmax31", "link": "https://stackoverflow.com/users/5642158/ashishmax31"}, "edited": false, "score": 2, "creation_date": 1530608318, "post_id": 51148853, "comment_id": 89284480, "body": "Hard to say; it&#39;s possible that there&#39;s a way to make it faster with concurrency. At the moment you create loads of new goroutines, instead you could try having a buffered channel, and putting the work on that channel. Then having a pool of 4 worker go routines that read from that channel. This should reduce some of the contention. But might not necessarily make it faster."}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": true, "score": 2, "last_activity_date": 1530602945, "creation_date": 1530602945, "answer_id": 51148853, "question_id": 51140856, "link": "https://stackoverflow.com/questions/51140856/recursive-concurrency-for-quadtree-with-golang/51148853#51148853", "title": "recursive concurrency for quadtree with golang", "body": "<p>This is much slower because the work that you are doing in each of the goroutines is very cheap, and there are very many goroutines.</p>\n\n<p>For those that will criticise the terminology in this answer, I am going to use parallelism and concurrency interchangeably. Even though strictly, parallelism is a property of the runtime / computer, and concurrency is a property of the code. Some code can still be concurrent if it is running on hardware with a single processor, but it will not be running in parallel.</p>\n\n<p>The reason that the concurrent version here is slower is because there is still some synchronisation required when using channels etc. Under the hood, channels use a mutex to synchronise the sends / receives on a channel. This means that you are introducing contention between the goroutines.  </p>\n\n<p>Each time you call <code>parallelquery(area)</code> you are starting 4 more goroutines that must be scheduled, but (using a semaphore channel) you've limited the number of concurrent goroutines to 4.</p>\n\n<p>After a n recursions you've got 4^n goroutines all trying to receive a value from the semaphore channel, this causes a lot of contention. </p>\n\n<p>Using a blocking CPU profiler on this you will probably find that most of the execution time is spent on contention attempting to get a token from the semaphore.</p>\n"}], "owner": {"reputation": 91, "user_id": 5642158, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5wim1.jpg?s=128&g=1", "display_name": "ashishmax31", "link": "https://stackoverflow.com/users/5642158/ashishmax31"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 0, "accepted_answer_id": 51148853, "answer_count": 1, "score": 1, "last_activity_date": 1530602945, "creation_date": 1530551589, "last_edit_date": 1530596053, "question_id": 51140856, "link": "https://stackoverflow.com/questions/51140856/recursive-concurrency-for-quadtree-with-golang", "title": "recursive concurrency for quadtree with golang", "body": "<p>I'm trying to parallelize my quadtree lookup by using go-routines to share the recursive lookup.</p>\n\n<p>My Quadtree struct looks like this:</p>\n\n<pre><code>type Quadtree struct {\n    Rectangle //Boundary of the quadtree\n    Points   []Point\n    Ne       *Quadtree\n    Se       *Quadtree\n    Sw       *Quadtree\n    Nw       *Quadtree\n    Divided  bool\n    Capacity int\n    Parent   *Quadtree\n}\n</code></pre>\n\n<p>I have a method called <code>QueryForNearestPoints</code> which accepts a <code>Point</code> and a <code>searchRadius</code> and returns all the points within the <code>searcharea</code> in the Quadtree. If no points are found within the given <code>searchRadius</code>, then the <code>searchRadius</code> is increased and tried again. </p>\n\n<p><code>points</code> is the channel to which points in the search-radius are send to. I'm also using a <code>sync.WaitGroup</code> <code>wg</code> to wait for all go-routines to finish.  </p>\n\n<pre><code>func (q *Quadtree) QueryForNearestPoints(p Point, searchRadius float64) []QueryResult {\n    searcharea = Circle{p, searchRadius}\n    var testResults []QueryResult\n\n    for {\n\n        go func() {\n        loop:\n            for {\n                select {\n                case item, _ := &lt;-points:\n                    testResults = append(testResults, item)\n                case &lt;-done:\n                    break loop\n                }\n            }\n        }()\n        wg.Add(1)\n        go q.query(searcharea)\n        wg.Wait()\n        done &lt;- true\n        if len(testResults) &gt; 0 {\n            break\n        } else {\n            // Proportionally increase the search radius if no points are found.\n            searcharea = Circle{p, searcharea.Radius + searcharea.Radius*50/100}\n        }\n    }\n    return testResults\n}\n</code></pre>\n\n<p>The parallelized quadtree's query method:</p>\n\n<pre><code>func (q *Quadtree) query(area Circle) {\n    defer wg.Done()\n    if !q.overlapsCircle(area) {\n        return\n    }\n    if len(q.Points) &gt; 0 {\n        for i, point := range q.Points {\n            if area.contains(point) {\n                points &lt;- QueryResult{point, i, q}\n            }\n        }\n    }\n    if q.Divided {\n        wg.Add(4)\n        go q.Ne.parallelquery(area)\n        go q.Se.parallelquery(area)\n        go q.Sw.parallelquery(area)\n        go q.Nw.parallelquery(area)\n    }\n}\n</code></pre>\n\n<p><code>(q *Quadtree) parallelquery</code> method:</p>\n\n<pre><code>func (q *Quadtree) parallelquery(area Circle) {\n    semaphore &lt;- struct{}{}\n    defer func() {\n        &lt;-semaphore\n    }()\n    q.query(area)\n}\n</code></pre>\n\n<p>If I'm not wrong this is a cpu-bound workload so having 1000's of go-routines isn't going to help, so I'm using a buffered channel <code>semaphore</code> as a counting semaphore to make sure that at any point only n number of go-routines are active.(Here I made n as 4 because my computer has 4 cpus.)</p>\n\n<p>The only problem is that this approach is significantly slower than the normal non-concurrent sequential approach. What am I missing here? How can i make this faster?</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1530556933, "post_id": 51140111, "comment_id": 89268213, "body": "Relying on the order of execution of concurrent operations is a design flaw. If you find yourself in a situation where you think this is necessary, consider another design approach - for example, putting work in a channel (which <i>is</i> a FIFO queue) so you can worry about the order execution of <i>work</i> rather than the order of execution of <i>threads</i>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2494770"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530564557, "post_id": 51140111, "comment_id": 89271220, "body": "Thanks for the tip, the question was more about if it was the right tool for order which reading the source proves it is not."}, {"owner": {"user_type": "does_not_exist", "display_name": "user2494770"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530565124, "post_id": 51140111, "comment_id": 89271403, "body": "@Adrian FWIW channels suffer the same problem you have no guarantee that goroutines will push onto a channel in the order that they block. Same applies to popping."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1530624964, "post_id": 51140111, "comment_id": 89295331, "body": "You&#39;re missing the point. You shouldn&#39;t care what order the goroutines execute in. If you care what order a <i>task</i> is executed in, wrap it in a struct and put it on a channel. Messages are read from channels FIFO, and it doesn&#39;t matter which of a pool of identical workers picks up the message. Tasks will still be executed in the order they&#39;re queued."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user2494770"}, "is_accepted": false, "score": 6, "last_activity_date": 1530548616, "creation_date": 1530548616, "answer_id": 51140234, "question_id": 51140111, "link": "https://stackoverflow.com/questions/51140111/is-sync-mutex-lock-a-fifo/51140234#51140234", "title": "Is sync.Mutex.Lock a FIFO?", "body": "<p>From the <a href=\"https://golang.org/src/sync/mutex.go?s=765:813#L42\" rel=\"noreferrer\">source</a>:</p>\n\n<pre><code>// Mutex fairness.\n//\n// Mutex can be in 2 modes of operations: normal and starvation.\n// In normal mode waiters are queued in FIFO order, but a woken up waiter\n// does not own the mutex and competes with new arriving goroutines over\n// the ownership. New arriving goroutines have an advantage -- they are\n// already running on CPU and there can be lots of them, so a woken up\n// waiter has good chances of losing. In such case it is queued at front\n// of the wait queue. If a waiter fails to acquire the mutex for more than 1ms,\n// it switches mutex to the starvation mode.\n//\n// In starvation mode ownership of the mutex is directly handed off from\n// the unlocking goroutine to the waiter at the front of the queue.\n// New arriving goroutines don't try to acquire the mutex even if it appears\n// to be unlocked, and don't try to spin. Instead they queue themselves at\n// the tail of the wait queue.\n//\n// If a waiter receives ownership of the mutex and sees that either\n// (1) it is the last waiter in the queue, or (2) it waited for less than 1 ms,\n// it switches mutex back to normal operation mode.\n//\n// Normal mode has considerably better performance as a goroutine can acquire\n// a mutex several times in a row even if there are blocked waiters.\n// Starvation mode is important to prevent pathological cases of tail latency.\n</code></pre>\n\n<p>So guaranteeing order across threads cannot be achieved by simply using a mutex.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2494770"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1080, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1530548825, "creation_date": 1530548050, "last_edit_date": 1530548825, "question_id": 51140111, "link": "https://stackoverflow.com/questions/51140111/is-sync-mutex-lock-a-fifo", "title": "Is sync.Mutex.Lock a FIFO?", "body": "<p>If many threads lock on a <a href=\"https://golang.org/pkg/sync/#Mutex\" rel=\"nofollow noreferrer\">mutex</a> do they queue up in a FIFO order or is there some amount of randomness to which goroutine acquires the lock when it becomes unlocked?</p>\n"}, {"tags": ["go", "imagemagick"], "comments": [{"owner": {"reputation": 144829, "user_id": 2836621, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/suHg4.jpg?s=128&g=1", "display_name": "Mark Setchell", "link": "https://stackoverflow.com/users/2836621/mark-setchell"}, "edited": false, "score": 1, "creation_date": 1530546761, "post_id": 51138922, "comment_id": 89263655, "body": "There&#39;s too much information missing for a sensible answer. Are you running an ancient version? Are you running on a Raspberry Pi Zero? What image are you using?"}, {"owner": {"reputation": 27168, "user_id": 7355741, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6CMNt.jpg?s=128&g=1", "display_name": "fmw42", "link": "https://stackoverflow.com/users/7355741/fmw42"}, "edited": false, "score": 0, "creation_date": 1530555280, "post_id": 51138922, "comment_id": 89267519, "body": "PNG compression takes more time than JPG compression. Please post your input image and we can time test conversion for you. Perhaps your Imagemagick version is old or your libpng is old."}, {"owner": {"reputation": 144829, "user_id": 2836621, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/suHg4.jpg?s=128&g=1", "display_name": "Mark Setchell", "link": "https://stackoverflow.com/users/2836621/mark-setchell"}, "edited": false, "score": 0, "creation_date": 1530555530, "post_id": 51138922, "comment_id": 89267612, "body": "Unlike JPEG compression, PNG compression performance is very dependent on the quality setting in a non-linear way, and image contents so it would also help to see your actual code and actual image."}, {"owner": {"reputation": 27168, "user_id": 7355741, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6CMNt.jpg?s=128&g=1", "display_name": "fmw42", "link": "https://stackoverflow.com/users/7355741/fmw42"}, "edited": false, "score": 0, "creation_date": 1530581255, "post_id": 51138922, "comment_id": 89275262, "body": "PNG compression is more computationally intensive than JPG compression. But it would pay to check your libpng delegate and update if not current."}, {"owner": {"reputation": 45, "user_id": 9833158, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Sainath", "link": "https://stackoverflow.com/users/9833158/sainath"}, "edited": false, "score": 0, "creation_date": 1530600632, "post_id": 51138922, "comment_id": 89280380, "body": "The version of ImageMagick  we are using is 7.0.5-4 and we are running on a UBUNTU box of version 16.04. Every time we get a request we download it in to the disk and read from it and we delete the image. This reading takes less time for jpgs when it is 100 rps but this reading time increases eventually for pngs when the requests rate is more than 20 rps!!"}, {"owner": {"reputation": 27168, "user_id": 7355741, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6CMNt.jpg?s=128&g=1", "display_name": "fmw42", "link": "https://stackoverflow.com/users/7355741/fmw42"}, "edited": false, "score": 0, "creation_date": 1530639469, "post_id": 51138922, "comment_id": 89303772, "body": "JPG images are 8-bits and are smaller in file size than the equivalent 24-bit PNG images. So upload or reading the PNGs will take longer and use more resources."}, {"owner": {"reputation": 45, "user_id": 9833158, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Sainath", "link": "https://stackoverflow.com/users/9833158/sainath"}, "edited": false, "score": 0, "creation_date": 1530684231, "post_id": 51138922, "comment_id": 89316557, "body": "So does it mean even though both jpeg and PNG images are of same file size, PNG images take more resources than JPEG? What do you mean when you say about resources?"}, {"owner": {"reputation": 45, "user_id": 9833158, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Sainath", "link": "https://stackoverflow.com/users/9833158/sainath"}, "edited": false, "score": 0, "creation_date": 1530686475, "post_id": 51138922, "comment_id": 89317651, "body": "I have also observed that read time of PNGs is increased only because write time is increased  i.e, first write time is increased because of which read time is increased!"}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 9833158, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Sainath", "link": "https://stackoverflow.com/users/9833158/sainath"}, "edited": false, "score": 0, "creation_date": 1530607688, "post_id": 51148225, "comment_id": 89284092, "body": "The problem is not with the compression but with the reading and writing!! I have given more information above."}, {"owner": {"reputation": 144829, "user_id": 2836621, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/suHg4.jpg?s=128&g=1", "display_name": "Mark Setchell", "link": "https://stackoverflow.com/users/2836621/mark-setchell"}, "reply_to_user": {"reputation": 45, "user_id": 9833158, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Sainath", "link": "https://stackoverflow.com/users/9833158/sainath"}, "edited": false, "score": 0, "creation_date": 1530616054, "post_id": 51148225, "comment_id": 89289398, "body": "I have updated my answer with some graphs - hopefully you can see that the quality setting has a significant influence on write time and size - and also in a different way with different types of images."}], "tags": [], "owner": {"reputation": 144829, "user_id": 2836621, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/suHg4.jpg?s=128&g=1", "display_name": "Mark Setchell", "link": "https://stackoverflow.com/users/2836621/mark-setchell"}, "is_accepted": false, "score": 1, "last_activity_date": 1530608936, "last_edit_date": 1530608936, "creation_date": 1530600637, "answer_id": 51148225, "question_id": 51138922, "link": "https://stackoverflow.com/questions/51138922/why-does-readimage-and-writeimage-takes-a-lot-of-time-for-png-images-in-imagemag/51148225#51148225", "title": "Why does readimage and writeimage takes a lot of time for PNG images in imagemagick?", "body": "<p>The compression quality parameter has a different effect and meaning when dealing with PNG files from when dealing with JPEG files.</p>\n\n<p>PNG compression is <strong>always lossless</strong> and the appearance is <strong>never affected</strong> by the quality. As I cannot see your images, I would suggest you either don't bother compressing since it will happen anyway, or that you use a quality of 75. If you tell me you are saving cartoons or line drawings, I might advise differently.</p>\n\n<p>Please have a read <a href=\"https://www.imagemagick.org/script/command-line-options.php#quality\" rel=\"nofollow noreferrer\">here</a> and do some experiments yourself with the tradeoff between time and filesize.</p>\n\n<p>I have made you some plots to show the effect on time to compress and  compressed size for different quality settings using two different kinds of images - cartoons and photos - so you can see the effect.</p>\n\n<p>Here is a cartoon:</p>\n\n<p><a href=\"https://i.stack.imgur.com/qqky3.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/qqky3.png\" alt=\"enter image description here\"></a></p>\n\n<p>Look at how the quality setting (0-100) affects time and size with JPEG output:</p>\n\n<p><a href=\"https://i.stack.imgur.com/QOjAz.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/QOjAz.png\" alt=\"enter image description here\"></a></p>\n\n<p>Now look what happens if you use those same quality settings (0-100) when generating PNG output:</p>\n\n<p><a href=\"https://i.stack.imgur.com/zzBGg.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/zzBGg.png\" alt=\"enter image description here\"></a></p>\n\n<hr>\n\n<p>Now let's look at compressing an iPhone photo to JPEG:</p>\n\n<p><a href=\"https://i.stack.imgur.com/oA3jE.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/oA3jE.png\" alt=\"enter image description here\"></a></p>\n\n<p>And when compressing an iPhone photo to a PNG:</p>\n\n<p><a href=\"https://i.stack.imgur.com/3b9LE.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/3b9LE.png\" alt=\"enter image description here\"></a></p>\n\n<hr>\n\n<p>Hopefully you can see that using one quality setting from your config file for both PNG and JPEG and with photos and cartoons/line drawings is not ideal.</p>\n"}], "owner": {"reputation": 45, "user_id": 9833158, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Sainath", "link": "https://stackoverflow.com/users/9833158/sainath"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1530608936, "creation_date": 1530543330, "last_edit_date": 1530607604, "question_id": 51138922, "link": "https://stackoverflow.com/questions/51138922/why-does-readimage-and-writeimage-takes-a-lot-of-time-for-png-images-in-imagemag", "title": "Why does readimage and writeimage takes a lot of time for PNG images in imagemagick?", "body": "<p>I'm using Imagemagick version 7.0.5-4 to perform image processing operations like crop, resize etc with <a href=\"https://github.com/gographics/imagick\" rel=\"nofollow noreferrer\">go-graphics</a> library. I also manage a pool of magickwand objects.</p>\n\n<pre><code>Features: Cipher DPC HDRI Modules\nDelegates (built-in): bzlib freetype jng jpeg ltdl lzma png tiff xml zlib\n</code></pre>\n\n<p>The read time of image to MagickWand object as <code>magickWand.ReadImage(&lt;url&gt;)</code> in png images is very high compared that of jpg images. For images of size around 22kb, reading a jpg file takes around 300ms and that of png image takes around 1-2 minutes.</p>\n\n<p>Edited:</p>\n\n<p>When a single request is sent to server, the read operation takes around 20ms, but when on load of 100rps, it goes till 2-4 minutes. This trend is only in png images, not in jpg. </p>\n\n<p>Any ideas on what can be done different in reading png files and how it can be made performant? Its fine to reduce the quality of images to around 60%. Tried options like <code>SetImageDepth</code> but it made no difference.</p>\n"}, {"tags": ["algorithm", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1530544144, "post_id": 51138901, "comment_id": 89262287, "body": "What have you tried? What problems did you encounter? Include your code."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1530549929, "post_id": 51138901, "comment_id": 89265127, "body": "What are the patterns for <code>02072221000 - 02072221145</code>?"}, {"owner": {"reputation": 963, "user_id": 695170, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/485fac06fbf316d3457541866edaa86b?s=128&d=identicon&r=PG", "display_name": "Darren", "link": "https://stackoverflow.com/users/695170/darren"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530550392, "post_id": 51138901, "comment_id": 89265317, "body": "@Flimzy I&#39;m struggling to get any code down so far since I just can&#39;t work out what the logic would be. I&#39;ve tried working backwards from the end of the number checking for 9s.  It&#39;s mostly scribbles on paper at this point."}, {"owner": {"reputation": 963, "user_id": 695170, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/485fac06fbf316d3457541866edaa86b?s=128&d=identicon&r=PG", "display_name": "Darren", "link": "https://stackoverflow.com/users/695170/darren"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1530550400, "post_id": 51138901, "comment_id": 89265322, "body": "@peterSO Good question -- I sat staring at that for a moment.  I&#39;ll check with one of the CM guys."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530551147, "post_id": 51138901, "comment_id": 89265606, "body": "If you&#39;re still at the algorithm definition stage, then this question isn&#39;t about Go. But you should still be able to show your work/thought process, rather than asking us to do it for you."}, {"owner": {"reputation": 963, "user_id": 695170, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/485fac06fbf316d3457541866edaa86b?s=128&d=identicon&r=PG", "display_name": "Darren", "link": "https://stackoverflow.com/users/695170/darren"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530552875, "post_id": 51138901, "comment_id": 89266363, "body": "Sorry @Flimzy but what I have is next to useless hence the question. But you\u2019re right, at this point it isn\u2019t go, but will be implemented in go so any code samples we share might be in go."}, {"owner": {"reputation": 963, "user_id": 695170, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/485fac06fbf316d3457541866edaa86b?s=128&d=identicon&r=PG", "display_name": "Darren", "link": "https://stackoverflow.com/users/695170/darren"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1530605346, "post_id": 51138901, "comment_id": 89282745, "body": "@peterSO in answer to your question, the range 02072221000 - 02072221145 would have three matching entries as follows:   020722210XX  covers 1000 - 1099 020722211[0-3]X  covers 1100 - 1139 0207222114[0-5]  covers 1140 - 1145"}], "answers": [{"comments": [{"owner": {"reputation": 963, "user_id": 695170, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/485fac06fbf316d3457541866edaa86b?s=128&d=identicon&r=PG", "display_name": "Darren", "link": "https://stackoverflow.com/users/695170/darren"}, "edited": false, "score": 0, "creation_date": 1530565305, "post_id": 51143101, "comment_id": 89271473, "body": "Thank you so much for this very comprehensive answer. What you\u2019re saying kind of makes sense. I was thinking similarly regarding working from the least significant number, just couldn\u2019t get the next bit. I will be able to take another look at this tomorrow and hope to give what you have suggested a try. Thanks once again. Your time is hugely appreciated."}, {"owner": {"reputation": 963, "user_id": 695170, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/485fac06fbf316d3457541866edaa86b?s=128&d=identicon&r=PG", "display_name": "Darren", "link": "https://stackoverflow.com/users/695170/darren"}, "edited": false, "score": 0, "creation_date": 1530610776, "post_id": 51143101, "comment_id": 89285996, "body": "I had a very similar loop to get the diffLength.  I&#39;ve tested a couple of ranges and it feels like it&#39;s almost there.  Just going to have a go at tweaking it."}, {"owner": {"reputation": 3581, "user_id": 2487355, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Wy9dj.jpg?s=128&g=1", "display_name": "Don", "link": "https://stackoverflow.com/users/2487355/don"}, "reply_to_user": {"reputation": 963, "user_id": 695170, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/485fac06fbf316d3457541866edaa86b?s=128&d=identicon&r=PG", "display_name": "Darren", "link": "https://stackoverflow.com/users/695170/darren"}, "edited": false, "score": 0, "creation_date": 1530622782, "post_id": 51143101, "comment_id": 89293745, "body": "Yeah the only thing I can think of to condense the outputs is to add another loop through the outputs at the end of the function, handling cases where you can condense. Keeping track of that sort of stuff in the logic of the loop I have there I think would be too much..."}], "tags": [], "owner": {"reputation": 3581, "user_id": 2487355, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Wy9dj.jpg?s=128&g=1", "display_name": "Don", "link": "https://stackoverflow.com/users/2487355/don"}, "is_accepted": false, "score": 2, "last_activity_date": 1530563455, "last_edit_date": 1592644375, "creation_date": 1530562146, "answer_id": 51143101, "question_id": 51138901, "link": "https://stackoverflow.com/questions/51138901/how-can-i-identify-a-matching-pattern-for-a-given-number-using-go/51143101#51143101", "title": "How can I identify a matching pattern for a given number using go?", "body": "<p>I believe I found a decent algorithm which should handle this for you. I apologize ahead of time if any of the explanation isn't detailed enough, but a lot of this came to intuition which can be hard to explain.</p>\n<p>I started with more simplified cases, figuring out a method for how to get the fewest number of patterns from a comparison. For my examples I'll be comparing <code>211234</code> to <code>245245</code>.\nAfter a bit of thinking I worked out that you need to take the range of numbers from the smaller number up to 9 and handle the special case for the lowest digit in the smaller number. To explain in a bit more detail, in the number <code>211234</code> the ideal is to represent the last digit as an <code>X</code> but we can only do that for cases where the digit may be <code>[0-9]</code> the only case in this example where we can't use <code>[0-9]</code> is when our tens digit is <code>3</code> because we have a lower limit of <code>4</code>. This logic then propagates up the rest of the number as we head toward the most significant digit. So for the tens digit in the next case we have a lower bound based on the previous example of <code>4</code> because we're handling the case when we allow a <code>3</code> specially. So for our tens range we end up with a <code>4-9</code> because the next digit over does not restrict our range.</p>\n<p>In fact we won't be restricted until the most significant digit which is bounded by the numbers in the range between the numbers we're comparing. After working a few problems out by hand I noticed a bit of a pattern of the pyramid of Xs in the cases where the numbers digits were significantly apart:</p>\n<pre><code>compare: 211234\nto:      245245\n\n\n21123[4-9]\n2112[4-9]X\n211[3-9]XX\n21[2-9]XXX\n2[2-3]XXXX\n24[0-4]XXX\n245[0-1]XX\n2452[0-3]X\n24514[0-5]\n</code></pre>\n<p>This was my first hint as to how to handle it. Starting from the least significant moving up, taking advantage of the symmetry, but handling the case where we hit the &quot;top of the pyramid&quot;. This example is easy though, there are many corner cases which will cause issues. For the sake of brevity I'm not going to go into detail for each but I'll give a short explanation for each:</p>\n<h3>What do you do when the 2 compared digits has one number between them, such as between <code>4</code> and <code>6</code>?</h3>\n<p>In this case simply use the single digit in place of a range.</p>\n<h3>What do you do when the 2 compared digits have no number between them, such as between <code>4</code> and <code>5</code>?</h3>\n<p>In this case throw away the row in which you'd handle the numbers between the digits as all cases will be handled explicitly.</p>\n<h3>What do you do when the minimum number in the range is <code>8</code>?</h3>\n<p>In this case when we add 1 to the number to get a lower bound for the range we get a 9, which means we can simply substitute in a <code>9</code> rather than a range of <code>[9-9]</code></p>\n<h3>What do you do when the minimum number in the range is <code>9</code>?</h3>\n<p>In this case we simply don't bother handling that number as when handling the next digit up it should be covered by its use of <code>X</code></p>\n<p>I'm sure I'm missing some corner cases which I handle in the code which I simply didn't think to put in this list. I'm willing to clarify any part of the code if you just leave a comment asking.</p>\n<p>Below is my stab at it in Go. It could probably be a bit more DRY but this is what I came up with after fiddling for a bit. I'm also pretty new to Go so please notify me of any spirit fouls in the comments and I'll correct them.</p>\n<p>I don't guarantee this will handle every case, but it handled every case I threw at it. It's up to you to turn it into a script which takes in 2 strings ;)</p>\n<p><strong>Edit:</strong> I just realized via the example in the question (which for some reason I never ran) that this doesn't always condense the provided range in to the smallest number of outputs, but it should always give patterns which cover every case. Despite this drawback I think it's a good step in the right direction for you to work on top of. I'll update the answer if I find the time to get it to condense cases where the previous range is <code>1-9</code> and the special case is <code>0</code>. The best means for which might end up being after the initial generation condensing these cases &quot;manually&quot;.</p>\n<pre><code>package main\n\nimport (\n    &quot;strconv&quot;\n    &quot;fmt&quot;\n)\n\n\nfunc getStringFromMinAndMax(min int, max int) (string, bool){\n    minstr := strconv.Itoa(min)\n    maxstr := strconv.Itoa(max)\n    if max == min {\n        return minstr, false\n    }\n    if max &lt; min{\n        return minstr, false\n    }\n    return &quot;[&quot;+minstr+&quot;-&quot;+maxstr+&quot;]&quot;, true\n}\nfunc main(){\n    str1 := &quot;211234&quot;\n    str2 := &quot;245245&quot;\n\n    diffLength := 0\n    for i := 0; i &lt; len(str1); i++{\n        diffLength = i+1\n        number1, _ := strconv.Atoi(str1[:len(str1)-i-1])\n        number2, _ := strconv.Atoi(str2[:len(str2)-i-1])\n        if number1 == number2 {\n            break\n        }\n\n    }\n\n    elems := (diffLength * 2)-1\n    output := make([]*[]string, elems+1)\n    for i := 0; i &lt; elems; i++ {\n        newSlice := make([]string, diffLength)\n        output[i] = &amp;newSlice\n    }\n\n    for digit := 0; digit &lt; diffLength; digit++ {\n        for j := 0; j &lt; diffLength; j++ {\n            if j == digit {\n                if output[j] != nil {\n                    min, _ := strconv.Atoi(string(str1[len(str1)-(digit+1)]))\n                    max := 9\n                    if digit == diffLength-1 {\n                        max, _ = strconv.Atoi(string(str2[len(str1)-(digit+1)]))\n                        max = max - 1\n                    }\n                    if digit != 0{\n                        min = min+1\n                    }\n\n                    if min &lt; 10 {\n                        maxchar := strconv.Itoa(max)[0]\n                        minchar := strconv.Itoa(min)[0]\n                        newVal, safe := getStringFromMinAndMax(min, max)\n                        if digit == diffLength-1 &amp;&amp; !safe &amp;&amp; (str1[len(str1)-(digit+1)] == maxchar || str2[len(str2)-(digit+1)] == minchar) {\n                            output[j] = nil\n                        } else {\n                            (*output[j])[diffLength-digit-1] = newVal\n                        }\n                    } else {\n                        output[j] = nil\n                    }\n                }\n                if j != diffLength-1 &amp;&amp; output[elems-1-j] != nil {\n                    min := 0\n                    max, _ := strconv.Atoi(string(str2[len(str1)-(digit+1)]))\n                    if digit != 0{\n                        max = max-1\n                    }\n                    if max &gt;= 0{\n                        newVal, _ := getStringFromMinAndMax(min, max)\n                        (*output[elems-1-j])[diffLength-digit-1] = newVal\n                    } else {\n                        output[elems-1-j] = nil\n                    }\n                }\n            } else {\n                if j &gt; digit {\n                    if output[j] != nil {\n                        (*output[j])[diffLength-digit-1] = &quot;X&quot;\n                    }\n                    if j != diffLength-1 &amp;&amp; output[elems-1-j] != nil {\n                        (*output[elems-1-j])[diffLength-digit-1] = &quot;X&quot;\n                    }\n                } else {\n                    if output[j] != nil {\n                        (*output[j])[diffLength-digit-1] = string(str1[len(str1)-digit-1])\n                    }\n                    if j != diffLength-1 &amp;&amp; output[elems-1-j] != nil {\n                        (*output[elems-1-j])[diffLength-digit-1] = string(str2[len(str2)-digit-1])\n                    }\n                }\n            }\n        }\n    }\n\n\n    for _, list := range output {\n        if list != nil{\n            if len(str1) != diffLength{\n                fmt.Printf(str1[:len(str1)-diffLength])\n            }\n            for _, element := range *list {\n                fmt.Printf(element)\n            }\n            fmt.Printf(&quot;\\n&quot;)\n        }\n    }\n}\n</code></pre>\n<p>Footnotes:</p>\n<ul>\n<li><code>diffLength</code> is the number of characters on the end of the strings which differ, I couldn't think of a better way to get this number than what's in the script...</li>\n<li>Me setting an output to <code>nil</code> is me saying, &quot;This one will be handled explicitly, so throw it away&quot;</li>\n<li><code>j</code> is a variable for which output I'm setting... But this also gets mirrored to the bottom, so I couldn't think of a concise name to give it thus I left it j.</li>\n<li><code>digit</code> is tracking which digit <em>from the right</em> we are modifying</li>\n</ul>\n"}], "owner": {"reputation": 963, "user_id": 695170, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/485fac06fbf316d3457541866edaa86b?s=128&d=identicon&r=PG", "display_name": "Darren", "link": "https://stackoverflow.com/users/695170/darren"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1530563455, "creation_date": 1530543262, "question_id": 51138901, "link": "https://stackoverflow.com/questions/51138901/how-can-i-identify-a-matching-pattern-for-a-given-number-using-go", "title": "How can I identify a matching pattern for a given number using go?", "body": "<p>I'm trying to identify pattern matches for a given telephone number range to use in a Cisco Communications Manager platform.  </p>\n\n<p>Essentially, an 'X' matches the numbers 0-9 in a telephone number, and you can specify a range of digits using the [x-y] notation.</p>\n\n<p>Given a telephone number range of 02072221000-02072221149 consisting of 150 numbers, this would create and should output two patterns: 020722210XX and 020722211[0-4]X</p>\n\n<p>Obviously I'd like it to work on any range provided.  I just can't seem to get my head around how to generate those patterns given the number ranges.</p>\n\n<p>Any thoughts would be greatly appreciated.\nMany thanks.</p>\n"}, {"tags": ["arrays", "go", "channel"], "answers": [{"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": true, "score": 6, "last_activity_date": 1530542160, "last_edit_date": 1530542160, "creation_date": 1530539980, "answer_id": 51137944, "question_id": 51137709, "link": "https://stackoverflow.com/questions/51137709/iterate-through-two-collections-concurrently/51137944#51137944", "title": "Iterate through two collections concurrently", "body": "<p>There's a saying in go </p>\n\n<blockquote>\n  <p>\"Don't communicate by sharing memory, share memory by communicating\"</p>\n</blockquote>\n\n<p>It basically boils down to; </p>\n\n<p>\"Don't share state across 2 goroutines, instead pass the values needed between the routines, using channels\"</p>\n\n<p>It may be a biproduct of your simplified example, but instead of passing the indicies, why can't you limit the scope of the <code>arrA</code> and <code>arrB</code> to be inside a single goroutine, some kind of producer or generator that will send the values. The receiver of those values can do the work on them, in this case equal comparisons.</p>\n\n<pre><code>type pair struct {\n    a, b int\n}\n\nc := make(chan pair, len(arrA))\nfor i := range arrA {\n    c &lt;- pair{a: arrA[i], b: arrB[i]}\n}\nclose(c)\n\npoolSize := 3\nvar wg sync.WaitGroup\nwg.Add(poolSize)\n\nfor _ := range poolSize {\n    go func() {\n        defer wg.Done()\n        for p := range c {\n            fmt.Printf(\"%v == %v\\n\", p.a, p.b)\n        }\n    }\n}\n</code></pre>\n\n<p>This might seem like a trivially small change but the benefits are:</p>\n\n<ol>\n<li><strong>Isolation</strong>: you are limiting the scope of accessors to arrA and arrB to a single producing goroutine, limit the scope for race conditions / complex logic / bugs later on in the code.</li>\n<li><strong>Reuse</strong>: you can reuse the code functions that consume a <code>chan pair</code> elsewhere in the codebase as they do not directly access the values in specific arrays, instead are passed all the values they need.</li>\n</ol>\n\n<p>To extend this; assuming that you only need the value from <code>arrB</code> and do not care about the index, then you should send that value on the channel, and remove the need for the <code>pair</code> type.</p>\n"}], "owner": {"reputation": 1027, "user_id": 1640382, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ZOekS.png?s=128&g=1", "display_name": "AMT", "link": "https://stackoverflow.com/users/1640382/amt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 1, "accepted_answer_id": 51137944, "answer_count": 1, "score": 2, "last_activity_date": 1530542616, "creation_date": 1530539210, "last_edit_date": 1530542616, "question_id": 51137709, "link": "https://stackoverflow.com/questions/51137709/iterate-through-two-collections-concurrently", "title": "Iterate through two collections concurrently", "body": "<p>In Go, what is the best way to iterate through 2 collections concurrently?</p>\n\n<p>In my program, I have one function that creates two arrays, and another function that need to iterate over them simultaneously (in each iteration access the I'th element in both of the arrays).</p>\n\n<p>If I had a single input, I would have created a channel in the first function (instead of an array), and used range loops to iterate over it from various goroutines.</p>\n\n<p>In this case, is there a simpler solution than creating a channel of indexes and using it to access the arrays?</p>\n\n<pre><code>func main() {\n    // Prepare two arrays.\n    arrA := [12]int{1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89, 144}\n    arrB := arrA\n\n    // Create a channel with the indexes.\n    c := make(chan int, len(arrA))\n    for i := range arrA {\n        c &lt;- i\n    }\n    close(c)\n\n    poolSize := 3\n    var wg sync.WaitGroup\n    wg.Add(poolSize)\n\n    for i := 1; i &lt;= poolSize; i++ {\n        go func() {\n            defer wg.Done()\n            for j := range c {\n                fmt.Printf(\"%v == %v\\n\", arrA[j], arrB[j])\n            }\n        }()\n    }\n\n    wg.Wait()\n}\n</code></pre>\n"}, {"tags": ["go", "channel"], "answers": [{"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 2, "creation_date": 1530539211, "post_id": 51137486, "comment_id": 89259326, "body": "1. He is not guarding reading from a channel; he is guarding change the value of that channel. 2. There is indeed difference, like you said in your point 3. 3. There is no reason why Variant B is not valid, or idomatic."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1531041605, "last_edit_date": 1531041605, "creation_date": 1530538531, "answer_id": 51137486, "question_id": 51137056, "link": "https://stackoverflow.com/questions/51137056/rewrite-channel-while-listening-on-it-and-for-loop-handling/51137486#51137486", "title": "Rewrite channel while listening on it and for loop handling", "body": "<ol>\n<li><p>Sending and reading from a channel do <em>not</em> need to be protected by a mutex: They act as synchronisation primitives by <em>themself</em> (that's one of the main ideas behind sending/receiving) on a channel.</p></li>\n<li><p>There is no difference between variant A and B because you do not close the channel. But...</p></li>\n<li><p>Resigning a new channel to <code>strChannel</code> while iterating the old channel is wrong. Don't do that. Not even with the B variant. Think about <code>range strChannel</code> as \"please range over the values in the channel currently stored in the variable <code>strChannel</code>\". This range will \"continue on the original channel\" and storing a new channel in the same variable doesn't change this. Avoid such code! </p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 2, "last_activity_date": 1530541141, "last_edit_date": 1530541141, "creation_date": 1530540145, "answer_id": 51138003, "question_id": 51137056, "link": "https://stackoverflow.com/questions/51137056/rewrite-channel-while-listening-on-it-and-for-loop-handling/51138003#51138003", "title": "Rewrite channel while listening on it and for loop handling", "body": "<p>In Go, <code>for</code> statement evaluate the value on the right side of <code>range</code> before the loop begins.</p>\n\n<p>That means changing the value of the variable on the right side of <code>range</code> will take no effects. So in your code, in Variant A, <code>msg</code> is ever-iterating over the orignal channel and never changed. In Varaint B, it works as intended as the channel is being evaluated per iteration.</p>\n\n<p>The concept is a little bit tricky. It does not mean you cannot modify <em>items</em> of the <code>slice</code> or <code>map</code> on the right side of <code>range</code>. If you look deeper into it, you will find that in Go, <code>map</code> and <code>slice</code> stores a pointer, and modify its item does not change that pointer, so it has effects.</p>\n\n<p>It is even more trickier in case of <code>array</code>. Modifying <em>item</em> of an <code>array</code> on the right side of <code>range</code> has no effects. This is due to Go's mechanism about storing array as a value.</p>\n\n<p>Playground examples: <a href=\"https://play.golang.org/p/wzPfGHFYrnv\" rel=\"nofollow noreferrer\">https://play.golang.org/p/wzPfGHFYrnv</a></p>\n"}], "owner": {"reputation": 158, "user_id": 3584906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f47b52341fabcfee97c2c3dbca41338?s=128&d=identicon&r=PG&f=1", "display_name": "Mahesh S", "link": "https://stackoverflow.com/users/3584906/mahesh-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 51138003, "answer_count": 2, "score": 2, "last_activity_date": 1531041605, "creation_date": 1530537182, "last_edit_date": 1530542706, "question_id": 51137056, "link": "https://stackoverflow.com/questions/51137056/rewrite-channel-while-listening-on-it-and-for-loop-handling", "title": "Rewrite channel while listening on it and for loop handling", "body": "<p>While trying few experiments in channels, I came up with below code:</p>\n\n<pre><code>var strChannel = make(chan string, 30)\nvar mutex = &amp;sync.Mutex{}\n\nfunc main() {\n\n    go sampleRoutine()\n\n    for i := 0; i &lt; 10; i++ {\n        mutex.Lock()\n        strChannel &lt;- strconv.FormatInt(int64(i), 10)\n        mutex.Unlock()\n        time.Sleep(1 * time.Second)\n    }\n\n    time.Sleep(10 * time.Second)\n}\n\nfunc sampleRoutine() {\n/*  A: for msg := range strChannel{*/\n/*  B: for {\n        msg := &lt;-strChannel*/\n        log.Println(\"got message \", msg, strChannel)\n        if msg == \"3\" {\n            mutex.Lock()\n            strChannel = make(chan string, 20)\n            mutex.Unlock()\n        }\n    }\n}\n</code></pre>\n\n<p>Basically here while listening to a given channel, I am assigning the channel variable to a new channel in a specific condition (here when msg == 3).</p>\n\n<p>When I use the code in comment block B it works as expected, i.e. the loop moves on to the newly created channel and prints 4-10.</p>\n\n<p>However comment block A which I believe is just a different way to write the loop doesn't work i.e. after printing \"3\" it stops.</p>\n\n<p>Could someone please let me know the reason for this behavior?</p>\n\n<p>And also is code like this where a routine listening on a channel, creating a new one safe?</p>\n"}, {"tags": ["arrays", "go", "channels"], "comments": [{"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 0, "creation_date": 1530697281, "post_id": 51136589, "comment_id": 89323707, "body": "this is a valid question and not just for ease-of-use. When you know how many elements will be added you can pre-allocate buffers and avoid excessive garbage collection due to reallocations. The important information here though is the capacity, not the actual contents of the array. You already provided a capacity for your channel."}, {"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 0, "creation_date": 1530697612, "post_id": 51136589, "comment_id": 89323896, "body": "<i>Channels</i> though aren&#39;t collections, even if they can be used like that. As the name implies, they are a channel of communication between processes/workers. The capacity specifies how many items can be queued before blocking. If the consumer is fast enough you won&#39;t need a large capacity even if you send a large array to the  channel. The capacity is needed to <i>prevent</i> the producer from flooding the channel with unprocessed messages"}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 1, "last_activity_date": 1530538710, "last_edit_date": 1530538710, "creation_date": 1530537851, "answer_id": 51137268, "question_id": 51136589, "link": "https://stackoverflow.com/questions/51136589/create-a-channel-from-an-array/51137268#51137268", "title": "Create a channel from an array", "body": "<p>In <a href=\"https://golang.org/ref/spec#Channel_types\" rel=\"nofollow noreferrer\">Golang Spec on Channels</a> It is defined as:-</p>\n\n<blockquote>\n  <p>A single channel may be used in send statements, receive operations,\n  and calls to the built-in functions cap and len by any number of\n  goroutines without further synchronization.</p>\n</blockquote>\n\n<p>There is one more way to assign complete slice or array to the channel as:</p>\n\n<pre><code>func main() {\n    c := make(chan [3]int)\n\n    elms := [3]int{1, 2, 3}\n\n    go func() {\n        c &lt;- elms\n    }()\n\n    for _, i := range &lt;-c {\n        fmt.Println(i)\n    }\n}\n</code></pre>\n\n<p>Check working example on <a href=\"https://play.golang.org/p/14RECb5xS5h\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n\n<p>For information on channels view this link <a href=\"https://dave.cheney.net/tag/golang-3\" rel=\"nofollow noreferrer\">https://dave.cheney.net/tag/golang-3</a></p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1531169104, "last_edit_date": 1531169104, "creation_date": 1530538791, "answer_id": 51137575, "question_id": 51136589, "link": "https://stackoverflow.com/questions/51136589/create-a-channel-from-an-array/51137575#51137575", "title": "Create a channel from an array", "body": "<p>Code should be correct, maintainable, robust, reasonably efficient, and, most importantly, readable.</p>\n\n<p>By design, Go is simple, but powerful. Everybody can read and memorize the specification: <a href=\"https://golang.org/ref/spec#Selectors\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a>. You can learn Go in a day or so. The simplicity makes Go code very readable.</p>\n\n<p>The complexity of syntactic sugar induces cognitive overload. After working alongside <a href=\"http://www.stroustrup.com/\" rel=\"nofollow noreferrer\">Bjarne Stroustrup</a> (C++) and <a href=\"https://gvanrossum.github.io/\" rel=\"nofollow noreferrer\">Guido van Rossum</a> (Python), the Go authors deliberately avoided syntactic sugar.</p>\n\n<p>Read Bjarne Stroustrup's recent lament about the complexity of C++: <a href=\"http://www.stroustrup.com/P0977-remember-the-vasa.pdf\" rel=\"nofollow noreferrer\">Remember the Vasa!</a>.</p>\n\n<p>It's easy to see what this code does:</p>\n\n<pre><code>package main\n\nfunc main() {\n    elms := [3]int{1, 2, 3}\n    c := make(chan int, len(elms))\n    for _, elm := range elms {\n        c &lt;- elm\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1027, "user_id": 1640382, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ZOekS.png?s=128&g=1", "display_name": "AMT", "link": "https://stackoverflow.com/users/1640382/amt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 249, "favorite_count": 0, "accepted_answer_id": 51137575, "answer_count": 2, "score": 0, "last_activity_date": 1531169104, "creation_date": 1530535583, "last_edit_date": 1530542718, "question_id": 51136589, "link": "https://stackoverflow.com/questions/51136589/create-a-channel-from-an-array", "title": "Create a channel from an array", "body": "<p>What is the simplest way to add all the elements of an array to a channel?</p>\n\n<p>I can do this:</p>\n\n<pre><code>elms := [3]int{1, 2, 3}\nc := make(chan int, 3)\n\nfor _, e := range elms {\n    c &lt;- e\n}\n</code></pre>\n\n<p>But I wonder if there is a syntactic sugar for this.</p>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1530536194, "post_id": 51136455, "comment_id": 89257507, "body": "How are you building your package?"}, {"owner": {"reputation": 41, "user_id": 9939850, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TGeMh.jpg?s=128&g=1", "display_name": "daniel-scholz", "link": "https://stackoverflow.com/users/9939850/daniel-scholz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1530536823, "post_id": 51136455, "comment_id": 89257842, "body": "<code>go build github.com&#47;path&#47;to&#47;pkg&#47;main</code>  and all of those files are in <code>package main</code>  edit: editing path to package main"}, {"owner": {"reputation": 41, "user_id": 9939850, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TGeMh.jpg?s=128&g=1", "display_name": "daniel-scholz", "link": "https://stackoverflow.com/users/9939850/daniel-scholz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1530540340, "post_id": 51136455, "comment_id": 89260073, "body": "i actually did that, i just commented incorrectly."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1530540624, "post_id": 51136455, "comment_id": 89260222, "body": "the error says you have &quot;multiple definitions&quot; when including <code>foo.h</code>, but a header should only have declarations. Check the contents of the header file."}, {"owner": {"reputation": 41, "user_id": 9939850, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TGeMh.jpg?s=128&g=1", "display_name": "daniel-scholz", "link": "https://stackoverflow.com/users/9939850/daniel-scholz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1530595813, "post_id": 51136455, "comment_id": 89278413, "body": "the <code>foo.h</code> contains multiple headers, in particular some <code>winnt.h</code> and <code>intrin-impl.h</code>, which are not defined by me"}], "owner": {"reputation": 41, "user_id": 9939850, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TGeMh.jpg?s=128&g=1", "display_name": "daniel-scholz", "link": "https://stackoverflow.com/users/9939850/daniel-scholz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 512, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1530535129, "creation_date": 1530535129, "question_id": 51136455, "link": "https://stackoverflow.com/questions/51136455/how-do-i-include-one-header-file-in-multiple-go-files", "title": "How do I include one header file in multiple .go files?", "body": "<p>I've got one header <code>foo.h</code> and two source files <code>main.go</code> and <code>bar.go</code>.  </p>\n\n<p><code>foo.h</code>contains two functions: <code>foo()</code>, <code>bar()</code></p>\n\n<p>In <code>main.go</code> I am calling <code>C.foo()</code>, in <code>bar.go</code> I am calling <code>C.bar()</code>.</p>\n\n<p>Both import pseudo-package \"C\" and <code>#include \"foo.h\"</code></p>\n\n<p>Although I added include guards to <code>foo.h</code>, I am getting the following error:</p>\n\n<p>In function <code>foo</code>: <code>/path/too/foo.h</code>: multiple definitions of <code>foo</code></p>\n\n<p>Likewise for function <code>bar()</code></p>\n"}, {"tags": ["go", "receiver"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1530531983, "post_id": 51135292, "comment_id": 89255020, "body": "This is all wrong. There are two types and each has <i>one</i> Abs() method and the &quot;feature of the receiver&quot; is how interfaces work. Nothing special here."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1530533141, "post_id": 51135292, "comment_id": 89255714, "body": "This is not a feature of receivers. Receivers are attached to methods and used when calling those methods upon receivers."}, {"owner": {"reputation": 517, "user_id": 9956279, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iStX1.jpg?s=128&g=1", "display_name": "Sushilinux", "link": "https://stackoverflow.com/users/9956279/sushilinux"}, "edited": false, "score": 2, "creation_date": 1530533785, "post_id": 51135292, "comment_id": 89256102, "body": "Thank you for answering. But one thing I doubt is the use of upvote and downvote,  is stackoverflow a place to ask questions or a place to gather  correct understanding of issues? hmmmm"}, {"owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "edited": false, "score": 1, "creation_date": 1530534331, "post_id": 51135292, "comment_id": 89256441, "body": "Please check <a href=\"https://stackoverflow.com/help/on-topic\">What topics can I ask about here?</a>"}, {"owner": {"reputation": 761, "user_id": 7849087, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/OZ7yQ.jpg?s=128&g=1", "display_name": "saddam", "link": "https://stackoverflow.com/users/7849087/saddam"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1530535155, "post_id": 51135292, "comment_id": 89256903, "body": "@peterSO Thanks for the information well I have not downvoted I have answered OP comment of <code>is stackoverflow a place to ask questions or a place to gather correct understanding of issue</code>"}, {"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 0, "creation_date": 1530611076, "post_id": 51135292, "comment_id": 89286201, "body": "@ShiningGo I doubt <i>you</i> misunderstand how upvote/downvote works. I dare say there&#39;s something .. smelly .. in the kingdom of the Go tag. Far, far too many question downvotes, non-answers that quote specs instead of asnwering and comments that violate the <a href=\"https://stackoverflow.com/help/be-nice\">Be nice policy</a>. <i>30 downvotes in a single day!!!!</i>"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1530535476, "last_edit_date": 1530535476, "creation_date": 1530534793, "answer_id": 51136344, "question_id": 51135292, "link": "https://stackoverflow.com/questions/51135292/do-receivers-identify-which-method-to-apply/51136344#51136344", "title": "Do receivers identify which method to apply?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">Method sets</a></p>\n  \n  <p>A type may have a method set associated with it. The method set of an\n  interface type is its interface. The method set of any other type T\n  consists of all methods declared with receiver type T. The method set\n  of the corresponding pointer type *T is the set of all methods\n  declared with receiver *T or T (that is, it also contains the method\n  set of T). Further rules apply to structs containing embedded fields,\n  as described in the section on struct types. Any other type has an\n  empty method set. In a method set, each method must have a unique\n  non-blank method name.</p>\n  \n  <p>The method set of a type determines the interfaces that the type\n  implements and the methods that can be called using a receiver of that\n  type.</p>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p>The method set of a type determines the interfaces that the type\n  implements and the methods that can be called using a receiver of that\n  type.</p>\n</blockquote>\n\n<p>For example, simplifying the Go Tour example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\ntype Abser interface {\n    Abs() float64\n}\n\ntype Vertex struct {\n    X, Y float64\n}\n\nfunc (v *Vertex) Abs() float64 {\n    return math.Sqrt(v.X*v.X + v.Y*v.Y)\n}\n\nfunc main() {\n    var a Abser\n    a = &amp;Vertex{3, 4} // a *Vertex implements Abser\n    fmt.Println(a.Abs())\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/cf3WMcBI0WJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/cf3WMcBI0WJ</a></p>\n\n<p>Output:</p>\n\n<pre><code>5\n</code></pre>\n\n<p>Variable <code>a</code> of type <code>Abser</code> can contain any variable type that has the <code>Abser</code> method set : <code>Abs() float64</code>. Variable <code>a</code> contains a <code>*Vertex</code> which satisfies <code>Abser</code> with method set <code>func (v *Vertex) Abs() float64</code>. The expression <code>a.Abs()</code> executes the method <code>Abs()</code> for the type <code>*Vertex</code> that it currently contains. </p>\n"}], "owner": {"reputation": 517, "user_id": 9956279, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iStX1.jpg?s=128&g=1", "display_name": "Sushilinux", "link": "https://stackoverflow.com/users/9956279/sushilinux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 1, "accepted_answer_id": 51136344, "answer_count": 1, "score": -1, "last_activity_date": 1530535476, "creation_date": 1530531384, "last_edit_date": 1530535256, "question_id": 51135292, "link": "https://stackoverflow.com/questions/51135292/do-receivers-identify-which-method-to-apply", "title": "Do receivers identify which method to apply?", "body": "<p>A Tour of Go: <a href=\"https://tour.golang.org/methods/9\" rel=\"nofollow noreferrer\">https://tour.golang.org/methods/9</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\ntype Abser interface {\n    Abs() float64\n}\n\nfunc main() {\n    var a Abser\n    f := MyFloat(-math.Sqrt2)\n    v := Vertex{3, 4}\n\n    a = f  // a MyFloat implements Abser\n    a = &amp;v // a *Vertex implements Abser\n\n    // In the following line, v is a Vertex (not *Vertex)\n    // and does NOT implement Abser.\n    a = v\n\n    fmt.Println(a.Abs())\n}\n\ntype MyFloat float64\n\nfunc (f MyFloat) Abs() float64 {\n    if f &lt; 0 {\n        return float64(-f)\n    }\n    return float64(f)\n}\n\ntype Vertex struct {\n    X, Y float64\n}\n\nfunc (v *Vertex) Abs() float64 {\n    return math.Sqrt(v.X*v.X + v.Y*v.Y)\n}\n</code></pre>\n\n<p>In this exercise, there are two <code>Abs()</code> methods. But it seems that line 24, <code>fmt.Println(a.Abs())</code>, automatically applies the one that has a receiver with the same type as the variable.</p>\n\n<p>Is this a feature of receivers?</p>\n"}, {"tags": ["go", "json-rpc", "gorilla"], "comments": [{"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1530522926, "post_id": 51132609, "comment_id": 89249846, "body": "Try calling <code>NewJsonRpcReq</code> with <code>[]string{}</code> instead of <code>nil</code> or <code>interface{}{}</code>"}, {"owner": {"reputation": 43, "user_id": 8408799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0992a459af908b09ed75c1cbb3d498b?s=128&d=identicon&r=PG&f=1", "display_name": "zhiping chen", "link": "https://stackoverflow.com/users/8408799/zhiping-chen"}, "reply_to_user": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1530523436, "post_id": 51132609, "comment_id": 89250161, "body": "I tried it just now, but the content is <code>{&quot;method&quot;:&quot;status&quot;,&quot;params&quot;:[[]],&quot;id&quot;:5577006791947779410}</code>, it still raises the same error."}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1530541957, "post_id": 51132609, "comment_id": 89261037, "body": "Do you control the definition of <code>JsonRpcReq</code> or is it some kind of generated code?"}], "owner": {"reputation": 43, "user_id": 8408799, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f0992a459af908b09ed75c1cbb3d498b?s=128&d=identicon&r=PG&f=1", "display_name": "zhiping chen", "link": "https://stackoverflow.com/users/8408799/zhiping-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 247, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1530531985, "creation_date": 1530522672, "last_edit_date": 1530531985, "question_id": 51132609, "link": "https://stackoverflow.com/questions/51132609/how-to-set-null-value-for-params-when-i-use-gorilla-rpc-json", "title": "How to set null value for params when i use gorilla/rpc/json?", "body": "<p>I tried to send a request to a RPC interface, but the interface doesn't need params. It means the params field should be <code>\"params\":[]</code>, but when I use <code>json.EncodeClientRequest(method string, args interface{})</code>, the value of params is always <code>\"params\":[{}]</code> or <code>\"params\":[null]</code>. So it always causes the error: <code>map[code:-32602 message:Invalid method parameters]</code>. How could I set a null value for params. Next is my request struct: </p>\n\n<pre><code>// request struct\ntype JsonRpcReq struct {\n    Id      uint32       `json:\"id\"`\n    Url     string       `json:\"url\"`\n    Method  string       `json:\"method\"`\n    Params  *interface{} `json:\"params\"`\n    JsonRpc string       `json:\"jsonrpc\"`\n}\n</code></pre>\n\n<p>The error of sentence is: </p>\n\n<pre><code>// request method\nfunc (r *JsonRpcReq) Send() (interface{}, error) {\n    message, err := json.EncodeClientRequest(r.Method, r.Params)\n    fmt.Println(string(message))\n    if err != nil {\n        return nil, err\n    }\n    ...\n}\n</code></pre>\n\n<p>The request sentence is:</p>\n\n<pre><code>req := NewJsonRpcReq(\"http://finance.test.cppp.com/rpc/healthCheck\", \"status\", nil)\n</code></pre>\n\n<p>The <code>NewJsonRpcReq</code> method is:</p>\n\n<pre><code>func NewJsonRpcReq(url, method string, params *interface{}) *JsonRpcReq {\n    return &amp;JsonRpcReq{Id: 0, Url: url, Method: method, Params: params, JsonRpc: \"2.0\"}\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 472, "user_id": 7414754, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0d8a029a39a846a27ec35008ddf4cdad?s=128&d=identicon&r=PG&f=1", "display_name": "nicksheen", "link": "https://stackoverflow.com/users/7414754/nicksheen"}, "edited": false, "score": 0, "creation_date": 1530520720, "post_id": 51131908, "comment_id": 89248696, "body": "maybe the empty interface could help you <a href=\"https://tour.golang.org/methods/14\" rel=\"nofollow noreferrer\">tour.golang.org/methods/14</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 5, "creation_date": 1530520998, "post_id": 51131908, "comment_id": 89248823, "body": "This is a terrible idea. Your code will be cluttered with type conversions, because every package except your own accepts and returns standard types. This will be especially painful with slices. Why do you want methods on standard types anyway? You can just as easily define functions instead. <a href=\"https://en.wikipedia.org/wiki/You_aren%27t_gonna_need_it\" rel=\"nofollow noreferrer\">YAGNI</a>, and if you do: refactoring is easy in Go."}, {"owner": {"reputation": 1397, "user_id": 4940278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/06NHi.jpg?s=128&g=1", "display_name": "Luna Lovegood", "link": "https://stackoverflow.com/users/4940278/luna-lovegood"}, "edited": false, "score": 1, "creation_date": 1530522281, "post_id": 51131908, "comment_id": 89249496, "body": "it wont internally create 2 objects, but like Peter said,Why do you want methods on standard types anyway?"}, {"owner": {"reputation": 408, "user_id": 3216211, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8950c03d82dfe75bbdbf42fe5b4ce4e3?s=128&d=identicon&r=PG", "display_name": "Matt Smeets", "link": "https://stackoverflow.com/users/3216211/matt-smeets"}, "edited": false, "score": 1, "creation_date": 1530535005, "post_id": 51131908, "comment_id": 89256797, "body": "Creating a struct with an Int in it is not the same as creating an extension of the Int type. Using type NewInt Int means that Int ==== NewInt. The other one is not the same, but rather a &quot;class&quot; with a field in it of type int"}, {"owner": {"reputation": 266, "user_id": 2669614, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c01c17d70ba9d15c84bda553e48002ba?s=128&d=identicon&r=PG", "display_name": "Bovaz", "link": "https://stackoverflow.com/users/2669614/bovaz"}, "reply_to_user": {"reputation": 472, "user_id": 7414754, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0d8a029a39a846a27ec35008ddf4cdad?s=128&d=identicon&r=PG&f=1", "display_name": "nicksheen", "link": "https://stackoverflow.com/users/7414754/nicksheen"}, "edited": false, "score": 0, "creation_date": 1530535039, "post_id": 51131908, "comment_id": 89256825, "body": "@nicksheen Sorry if this comment is OT, as I am using the questions here on SO to help learn go. Am I correct in saying that the empty interface sort of does the job of generics in c# (and perhaps java, but I know it way less than c#)?"}, {"owner": {"reputation": 472, "user_id": 7414754, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0d8a029a39a846a27ec35008ddf4cdad?s=128&d=identicon&r=PG&f=1", "display_name": "nicksheen", "link": "https://stackoverflow.com/users/7414754/nicksheen"}, "reply_to_user": {"reputation": 266, "user_id": 2669614, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c01c17d70ba9d15c84bda553e48002ba?s=128&d=identicon&r=PG", "display_name": "Bovaz", "link": "https://stackoverflow.com/users/2669614/bovaz"}, "edited": false, "score": 0, "creation_date": 1530539209, "post_id": 51131908, "comment_id": 89259324, "body": "@Bovaz <a href=\"https://golang.org/doc/faq#generics\" rel=\"nofollow noreferrer\">golang.org/doc/faq#generics</a> according to this I would say that you can use them for that yes"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1530544217, "post_id": 51131908, "comment_id": 89262325, "body": "The basic types have no methods. Go is not Ruby. There are certainly cases where it can be very useful to create types based on primitive types, but I can&#39;t think of any case whatsoever where you&#39;d want to use the same primitive-based type everywhere in your application. It sounds like you&#39;re trying to solve problems you haven&#39;t encountered yet - before you try to make Go do things it&#39;s not supposed to, just work with the language and standard library until you <i>actually encounter a problem</i>, rather than creating problems for yourself preemptively."}, {"owner": {"reputation": 266, "user_id": 2669614, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c01c17d70ba9d15c84bda553e48002ba?s=128&d=identicon&r=PG", "display_name": "Bovaz", "link": "https://stackoverflow.com/users/2669614/bovaz"}, "reply_to_user": {"reputation": 472, "user_id": 7414754, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0d8a029a39a846a27ec35008ddf4cdad?s=128&d=identicon&r=PG&f=1", "display_name": "nicksheen", "link": "https://stackoverflow.com/users/7414754/nicksheen"}, "edited": false, "score": 0, "creation_date": 1530604773, "post_id": 51131908, "comment_id": 89282450, "body": "@nicksheen thank you"}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1530544298, "post_id": 51132221, "comment_id": 89262359, "body": "Besides the use of interfaces, <i>there are no methods to override on the Go primitives</i>. The question is based on a faulty premise."}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1530545284, "post_id": 51132221, "comment_id": 89262883, "body": "I agree, I think the question is based on the assumption that there would be methods defined on new types, and then those methods could some how be mocked etc."}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 6, "last_activity_date": 1530521275, "creation_date": 1530521275, "answer_id": 51132221, "question_id": 51131908, "link": "https://stackoverflow.com/questions/51131908/decorating-basic-data-types-in-go/51132221#51132221", "title": "decorating basic data types in go", "body": "<p>I think the fundamental route that you are going down will cause you problems.</p>\n\n<p>You shouldn't really be wrapping / mocking the primitive data types, such as <code>int</code>, <code>string</code> etc. But instead creating higher level abstractions; in the form of interfaces.</p>\n\n<p>You mention needing to \"overwite some methods\" on your new types; but this should be done at the interface level and not the data type level.</p>\n\n<p>You will also find it <strong>much</strong> harder to consume any other go packages, as you will constantly be converting from <code>NewInt</code> to <code>int</code> to pass into other packages.</p>\n\n<p>If you provide an example of <em>when</em> you plan on using the <code>NewInt</code> type datatypes, then I can provide an example of how to do it with interfaces instead.</p>\n"}], "owner": {"reputation": 744, "user_id": 6819874, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ic7D9.jpg?s=128&g=1", "display_name": "lokanadham100", "link": "https://stackoverflow.com/users/6819874/lokanadham100"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 1, "answer_count": 1, "score": -3, "last_activity_date": 1530521444, "creation_date": 1530520119, "question_id": 51131908, "link": "https://stackoverflow.com/questions/51131908/decorating-basic-data-types-in-go", "title": "decorating basic data types in go", "body": "<p>I am starting new application in go. </p>\n\n<p>I know that we can't monkey patch go code. So if we want to do some hacks with basic data types like int, float, string, etc.. its not possible.</p>\n\n<p>So, i am thinking to create new type for these basic things and use them througout the application instead of the basic ones. Later if we want to overwrite some of these methods or we want to add some new methods, we can overwrite these new types.</p>\n\n<p>Is this good way of doing?? </p>\n\n<p>Following is the sample code:</p>\n\n<pre><code>type NewInt Int\n</code></pre>\n\n<p>or </p>\n\n<pre><code>type NewInt struct{\n    Int\n}\n</code></pre>\n\n<p>Here if i am creating a variable like <code>var test NewInt = 16</code>, will it create 2 objects internally(one for basic int and other for newint) by creating memory issue?? or will it use same object for both??</p>\n\n<p>How can i debug this scenario?? How can i collect all the existing objects in heap after creating a variable??</p>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 0, "creation_date": 1530519130, "post_id": 51131240, "comment_id": 89247926, "body": "In your <code>Send()</code> perhaps you can <code>select</code> on <code>connHandler.done</code> of the receiving userB."}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 5344628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5540be9319329325996ffaba0f5c3962?s=128&d=identicon&r=PG&f=1", "display_name": "\u8881\u5d07\u6770", "link": "https://stackoverflow.com/users/5344628/%e8%a2%81%e5%b4%87%e6%9d%b0"}, "edited": false, "score": 0, "creation_date": 1530520539, "post_id": 51131782, "comment_id": 89248610, "body": "I think use select here indeed solve my problem, so simple but I didn&#39;t see it! Thank you very much."}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": true, "score": 4, "last_activity_date": 1530519608, "creation_date": 1530519608, "answer_id": 51131782, "question_id": 51131240, "link": "https://stackoverflow.com/questions/51131240/what-is-the-right-way-to-safely-finish-goroutines-in-my-code/51131782#51131782", "title": "What is the right way to safely finish goroutines in my code?", "body": "<p>Your example looks pretty good, and I think you've got 90% of what you need.</p>\n\n<p>I think the problem that you are seeing is with sending, when you might actually be \"done\".</p>\n\n<p>You can use the \"done\" channel to notify to <strong>all</strong> the go routines that you've finished. You will always be able to read a value from a closed channel (it will be the zero value). This means that you can update your <code>Send(msg)</code> method to consider the done channel.</p>\n\n<pre><code>func (connHandler *connHandler) Send(msg string) {\n    select {\n    case connHandler.writeChan &lt;- msg:\n    case &lt;- connHandler.done:\n        log.Debug(\"connHandler is done, exiting Send without sending.\")\n    case &lt;-time.After(10 * time.Second):\n        log.Warning(connHandler.Addr() + \" send msg timeout:\" + msg)\n    }\n}\n</code></pre>\n\n<p>What will happen in this select now is one of:</p>\n\n<ol>\n<li>msg is sent to <code>writeChan</code></li>\n<li><code>close(done)</code> has been called elsewhere, the done chan is closed. You will be able to read from done, breaking the select.</li>\n<li>time.After(...) will get to 10seconds, and you will be able to timeout the send.</li>\n</ol>\n"}], "owner": {"reputation": 53, "user_id": 5344628, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5540be9319329325996ffaba0f5c3962?s=128&d=identicon&r=PG&f=1", "display_name": "\u8881\u5d07\u6770", "link": "https://stackoverflow.com/users/5344628/%e8%a2%81%e5%b4%87%e6%9d%b0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 379, "favorite_count": 1, "accepted_answer_id": 51131782, "answer_count": 1, "score": 5, "last_activity_date": 1530519608, "creation_date": 1530517275, "question_id": 51131240, "link": "https://stackoverflow.com/questions/51131240/what-is-the-right-way-to-safely-finish-goroutines-in-my-code", "title": "What is the right way to safely finish goroutines in my code?", "body": "<p>I am writing a simple tcp server, the goroutine model is very straight forward: </p>\n\n<p>One goroutine is responsible for accepting new connections; for every new connection, three goroutines are started :</p>\n\n<ol>\n<li>one for read</li>\n<li>one for process and handle application logic</li>\n<li>one for write </li>\n</ol>\n\n<p>Currently one server will serve no more than 1000 users, so I don't try to limit goroutine numbers.</p>\n\n<pre><code>for {\n    conn, err := listener.Accept()\n    // ....\n    connHandler := connHandler{\n        conn:      conn,\n        done:      make(chan struct{}),\n        readChan:  make(chan string, 100),\n        writeChan: make(chan string, 100),\n    }\n    // ....\n    go connHandler.readAll()    \n    go connHandler.processAll() \n    go connHandler.writeAll()   \n}\n</code></pre>\n\n<p>I use the <code>done</code> channel to notify all three channels to finish, when user logout or a permanent network error happened, <code>done</code> channel will be closed (use sync.Once to make sure closing only happen once):</p>\n\n<pre><code>func (connHandler *connHandler) Close() {\n    connHandler.doOnce.Do(func() {\n        connHandler.isClosed = true\n        close(connHandler.done)\n    })\n}\n</code></pre>\n\n<p>Below is the code of <code>writeAll()</code> method:</p>\n\n<pre><code>func (connHandler *connHandler) writeAll() {\n    writer := bufio.NewWriter(connHandler.conn)\n\n    for {\n        select {\n        case &lt;-connHandler.done:\n            connHandler.conn.Close()\n            return\n        case msg := &lt;-connHandler.writeChan:\n            connHandler.writeOne(msg, writer)\n        }\n    }\n}\n</code></pre>\n\n<p>There is a <code>Send</code> method to send message to a user, by sending strings to the write channel:</p>\n\n<pre><code>func (connHandler *connHandler) Send(msg string) {\n    case connHandler.writeChan &lt;- msg:\n}\n</code></pre>\n\n<p>The <code>Send</code> method will be called mainly in <code>processAll()</code> goroutine, but also in many other goroutines because different users need to communicate with each other.</p>\n\n<p>Now is the problem: if userA logout or network failed, userB send a message to userA, userB's goroutine may be permanently blocked because no one will ever receive the message from the channel.</p>\n\n<p><strong>My solution:</strong></p>\n\n<p>My first thought is to use a boolean value to make sure connHanler is not closed when sending to it:</p>\n\n<pre><code>func (connHandler *connHandler) Send(msg string) {\n    if !connHandler.isClosed {\n        connHandler.writeChan &lt;- msg\n    }\n}\n</code></pre>\n\n<p>But I think <code>connHandler.writeChan &lt;- msg</code> and <code>close(done)</code> can still happen at the same time, the possibility of blocking still exist. So I have to add a timeout:</p>\n\n<pre><code>func (connHandler *connHandler) Send(msg string) {\n    if !connHandler.isClosed {\n        timer := time.NewTimer(10 * time.Second)\n        defer timer.Stop()\n        select {\n        case connHandler.writeChan &lt;- msg:\n        case &lt;-timer.C:\n            log.Warning(connHandler.Addr() + \" send msg timeout:\" + msg)\n        }\n    }\n\n}\n</code></pre>\n\n<p>Now I feel the code is safe, but also ugly, and start a timer every time when sending a message feels like an unnecessary overhead.</p>\n\n<p>Then I read this article:  <a href=\"https://go101.org/article/channel-closing.html\" rel=\"noreferrer\">https://go101.org/article/channel-closing.html</a>, My problem looks like the second example in the article: </p>\n\n<blockquote>\n  <p>One receiver, N senders, the receiver says \"please stop sending more\"\n  by closing an additional signal channel</p>\n</blockquote>\n\n<p>But I think this solution can't eliminate the possibility of blocking in my circumstance.</p>\n\n<p>Maybe the easiest solution is to just close the write channel and let the <code>Send</code> method panic, then use <code>recover</code> to handle the panic? But this looks like an ugly way, too.</p>\n\n<p>So is there a simple and straight forward way to accomplish what I want to do?</p>\n\n<p>(My English is not good, so if there is any ambiguity, please point out, thanks.)</p>\n"}, {"tags": ["postgresql", "go", "libpq", "pq"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1530521707, "post_id": 51130658, "comment_id": 89249221, "body": "Make sure to &quot;unpack&quot; the rowdata slice (using <code>...</code>) when you are passing it to <code>Exec</code>. i.e. <code>_, err := db.Exec(qry2, rowdata...)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 149, "user_id": 3849807, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WWPvBqYCdPY/AAAAAAAAAAI/AAAAAAAACDs/zIofyaq-1K0/photo.jpg?sz=128", "display_name": "Alexys", "link": "https://stackoverflow.com/users/3849807/alexys"}, "edited": false, "score": 1, "creation_date": 1571283528, "post_id": 51132288, "comment_id": 103190989, "body": "Very useful, thankyou. I have a improve to your code using buffer: <a href=\"https://play.golang.org/p/3z0JQ-Leaix\" rel=\"nofollow noreferrer\">play.golang.org/p/3z0JQ-Leaix</a>"}, {"owner": {"reputation": 712, "user_id": 8868419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44a530d27369c9d4f6ecf421fe83d2b4?s=128&d=identicon&r=PG&f=1", "display_name": "Madeo", "link": "https://stackoverflow.com/users/8868419/madeo"}, "reply_to_user": {"reputation": 149, "user_id": 3849807, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WWPvBqYCdPY/AAAAAAAAAAI/AAAAAAAACDs/zIofyaq-1K0/photo.jpg?sz=128", "display_name": "Alexys", "link": "https://stackoverflow.com/users/3849807/alexys"}, "edited": false, "score": 0, "creation_date": 1613272391, "post_id": 51132288, "comment_id": 117023606, "body": "@Alexys why did you use buffers? Thanks"}, {"owner": {"reputation": 149, "user_id": 3849807, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WWPvBqYCdPY/AAAAAAAAAAI/AAAAAAAACDs/zIofyaq-1K0/photo.jpg?sz=128", "display_name": "Alexys", "link": "https://stackoverflow.com/users/3849807/alexys"}, "reply_to_user": {"reputation": 712, "user_id": 8868419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44a530d27369c9d4f6ecf421fe83d2b4?s=128&d=identicon&r=PG&f=1", "display_name": "Madeo", "link": "https://stackoverflow.com/users/8868419/madeo"}, "edited": false, "score": 1, "creation_date": 1618606385, "post_id": 51132288, "comment_id": 118662414, "body": "@Madeo I used buffers b/c when you use strings is slower. Buffers are optimal to this kind of process."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 8, "last_activity_date": 1530521500, "creation_date": 1530521500, "answer_id": 51132288, "question_id": 51130658, "link": "https://stackoverflow.com/questions/51130658/how-to-insert-multiple-rows-into-postgres-sql-in-a-go/51132288#51132288", "title": "How to insert multiple rows into postgres SQL in a go", "body": "<p>You could do something like this:</p>\n\n<pre><code>samples := // the slice of samples you want to insert\n\nquery := `insert into samples (&lt;the list of columns&gt;) values `\n\nvalues := []interface{}{}\nfor i, s := range samples {\n    values = append(values, s.&lt;field1&gt;, s.&lt;field2&gt;, &lt; ... &gt;)\n\n    numFields := 15 // the number of fields you are inserting\n    n := i * numFields\n\n    query += `(`\n    for j := 0; j &lt; numFields; j++ {\n        query += `$`+strconv.Itoa(n+j+1) + `,`\n    }\n    query = query[:len(query)-1] + `),`\n}\nquery = query[:len(query)-1] // remove the trailing comma\n\ndb.Exec(query, values...)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/YqNJKybpwWB\" rel=\"noreferrer\">https://play.golang.org/p/YqNJKybpwWB</a></p>\n"}], "owner": {"reputation": 77, "user_id": 9738307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1f05380da6300ef30e5e3206f712105?s=128&d=identicon&r=PG&f=1", "display_name": "pretty08", "link": "https://stackoverflow.com/users/9738307/pretty08"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4156, "favorite_count": 1, "accepted_answer_id": 51132288, "answer_count": 1, "score": 1, "last_activity_date": 1530521500, "creation_date": 1530514906, "last_edit_date": 1530519684, "question_id": 51130658, "link": "https://stackoverflow.com/questions/51130658/how-to-insert-multiple-rows-into-postgres-sql-in-a-go", "title": "How to insert multiple rows into postgres SQL in a go", "body": "<ol>\n<li><p>Is it possible to insert multiple rows into Postgres database at once? Could someone please suggest if there is a way to insert a slice of slices into database. I have created a slice for each row and created a another slice(multiple rows) by appending all the row slices to it. how do I insert the slice(multiple rows) into db?</p></li>\n<li><p>When I create a row slice, I'm using <code>row := []interface{}{}</code> . Because I have fields which are strings and int in each row. Looks like I\nget an error when I'm inserting data and the error is <code>unsupported type []interface {}, a slice of interface</code></p></li>\n</ol>\n\n<p>Implementation:</p>\n\n<pre><code>rowdata := []interface{}{}\nrow := []interface{}{data.ScenarioUUID, data.Puid, data.Description, data.Status, data.CreatedBy, data.CreatedAt, data.UpdatedBy, data.UpdatedAt, data.ScopeStartsAt, data.ScopeEndsAt, Metric, MetricName, Channel, date, timeRangeValue}\nrowdata = append(rowdata, row)\n\nqry2 := `INSERT INTO sample (scenarioUuid,\n            puId,\n            description,\n            status,\n            createdBy,\n            createdAt,\n            updatedBy,\n            updatedAt,\n            scopeStartsAt,\n            scopeEndsAt,\n            metric,\n            metric_name,\n            channel,\n            time,\n            value) VALUES ($1, $2, $3,$4,$5,$6,$7,$8,$9,$10,$11,$12,$13,$14,$15)`\n\nif _, err := db.Exec(qry2, rowdata); err != nil {\n    panic(err)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4420, "user_id": 1360318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a60c954665247aae8de274c26e843867?s=128&d=identicon&r=PG", "display_name": "mbuechmann", "link": "https://stackoverflow.com/users/1360318/mbuechmann"}, "edited": false, "score": 0, "creation_date": 1530515540, "post_id": 51130318, "comment_id": 89246230, "body": "Does the downvoter care to explain? I think that this is a perfectly valid question."}], "answers": [{"comments": [{"owner": {"reputation": 355, "user_id": 10019917, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qoQ4MMftuuA/AAAAAAAAAAI/AAAAAAAAAA0/G4mu8VtJ-Zw/photo.jpg?sz=128", "display_name": "Andrew Moffat", "link": "https://stackoverflow.com/users/10019917/andrew-moffat"}, "edited": false, "score": 0, "creation_date": 1530518445, "post_id": 51130503, "comment_id": 89247591, "body": "Aha, I get it.  My mismatched pointer/value implementation was biting me.  The value of the Node contained a reference to a pointer whose value was about to be changed to the returned Node.  Thank you!"}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 3, "last_activity_date": 1530514276, "creation_date": 1530514276, "answer_id": 51130503, "question_id": 51130318, "link": "https://stackoverflow.com/questions/51130318/go-variable-struct-reassignment-bug/51130503#51130503", "title": "Go variable struct reassignment bug?", "body": "<p>You make a node with data \"a\" and store this node in a variable head which is <em>not</em> a pointer to a Node but a Node. Then you do some weird stuff to change the data of that node and nothing else: The call to link will first get the address of your Node a (to call the pointer method). Then you create a new Node value which has Next point to the Node a. You return that node (and not a pointer to it). Then you overwrite everything in your node head with the new stuff, i.e. Data and Next.</p>\n\n<p>Use pointers througout:</p>\n\n<pre><code>func (n *Node) Link(data string) *Node { return &amp;Node{Data: data, Next: n} }\n\nfunc main() {\n    head := &amp;Node{Data: \"a\"}\n    fmt.Printf(\"head = %+v\\n\", *head)\n    head = head.Link(\"b\")\n    fmt.Printf(\"head = %+v\\n\", *head)\n    fmt.Printf(\"head.Next = %+v\\n\", *head.Next)\n}\n</code></pre>\n"}], "owner": {"reputation": 355, "user_id": 10019917, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-qoQ4MMftuuA/AAAAAAAAAAI/AAAAAAAAAA0/G4mu8VtJ-Zw/photo.jpg?sz=128", "display_name": "Andrew Moffat", "link": "https://stackoverflow.com/users/10019917/andrew-moffat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 51130503, "answer_count": 1, "score": 1, "last_activity_date": 1530515409, "creation_date": 1530513434, "question_id": 51130318, "link": "https://stackoverflow.com/questions/51130318/go-variable-struct-reassignment-bug", "title": "Go variable struct reassignment bug?", "body": "<p>I'm trying to understand the behavior of this small snippet, taken from a larger singly linked-list implementation:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Node struct {\n    Next *Node\n    Data string\n}\n\nfunc (n *Node) Link(data string) Node {\n    link := Node{Data: data, Next: n}\n    return link\n}\n\nfunc main() {\n    head := Node{Data: \"a\"}\n    head = head.Link(\"b\")\n    fmt.Printf(\"head = %+v\\n\", head)\n    fmt.Printf(\"head.Next = %+v\\n\", head.Next)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>head = {Next:0xc42000a060 Data:b}\nhead.Next = &amp;{Next:0xc42000a060 Data:b}\n</code></pre>\n\n<p>Why is head.Next being linked to itself, and not the \"a\" node?  It has something to do with the re-assignment of the variable name \"head\", because if you change the line:</p>\n\n<pre><code>head = head.Link(\"b\")\n</code></pre>\n\n<p>to</p>\n\n<pre><code>head2 := head.Link(\"b\")\n</code></pre>\n\n<p>and printf head2, everything is correct.  Can someone shed light on this unexpected behavior?</p>\n"}, {"tags": ["go", "amazon-s3", "goroutine"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1530500562, "post_id": 51128286, "comment_id": 89242149, "body": "Your question reminded me of this article. <a href=\"http://marcio.io/2015/07/handling-1-million-requests-per-minute-with-golang/\" rel=\"nofollow noreferrer\">marcio.io/2015/07/&hellip;</a> The authors had to figure out a way to upload to s3 at scale. Might be a worthwhile read for you."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1530500768, "post_id": 51128286, "comment_id": 89242179, "body": "Also, you may not want to create a new s3 session with every POST, that won&#39;t scale well. You can create a single instance of a session and a single instance of an s3manager that you then can use for the life cycle of your server. It will reduce object/memory churn, reduce GC, and therefore your program will be faster."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1530504284, "post_id": 51128286, "comment_id": 89242754, "body": "To avoid race conditions, you may want to consider using <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/s3manager/#Uploader.UploadWithIterator\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/sdk-for-go/api/service/s3/s3manager/&hellip;</a>. It is safe to use Upload concurrently to upload WHOLE files. It breaks those files into parts for you. You aren&#39;t sending in whole files but parts of the same file. How do you expect it to maintain order? Hence the race condition. If you want to use Upload read the whole file and send that off to AWS."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1530504286, "post_id": 51128286, "comment_id": 89242755, "body": "Lastly, if you do use upload, UploadInput&#39;s Body is a io.Reader, you can pass the body of the Request directly into upload, let it handle consuming the body in parts and defer close the Body to ensure you release your memory"}], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 8773359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe16d59d9b3e4b39a8a81e0f1106dff8?s=128&d=identicon&r=PG&f=1", "display_name": "Yevgeniy Vasilyev", "link": "https://stackoverflow.com/users/8773359/yevgeniy-vasilyev"}, "edited": false, "score": 1, "creation_date": 1531099030, "post_id": 51128850, "comment_id": 89453345, "body": "Thank you so much for the useful tips! The example you gave is perfect for a single file upload so I made a few edits myself to make applicable for multiple files at the same time."}], "tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": true, "score": 0, "last_activity_date": 1530502614, "creation_date": 1530502614, "answer_id": 51128850, "question_id": 51128286, "link": "https://stackoverflow.com/questions/51128286/golang-aws-s3manager-multipartreader-w-goroutines/51128850#51128850", "title": "Golang AWS S3manager multipartreader w/ Goroutines", "body": "<p>^ see all the comments above, </p>\n\n<p>here is some modified code example, channels not useful here.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"io\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"strings\"\n    \"sync\"\n\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/service/s3/s3manager\"\n)\n\nvar (\n    setupUploaderOnce sync.Once\n    uploader          *s3manager.Uploader\n    bucket            string\n    region            string\n)\n// ensure sessions and uploader are setup only once using a Singleton pattern\nfunc setupUploader() {\n    setupUploaderOnce.Do(func() {\n        bucket = os.Getenv(\"BUCKET\")\n        region = os.Getenv(\"REGION\")\n        sess, err := session.NewSession(&amp;aws.Config{Region: aws.String(region)})\n        if err != nil {\n            log.Fatal(err)\n        }\n        uploader := s3manager.NewUploader(sess)\n    })\n}\n\n// normally singleton stuff is packaged out and called before starting the server, but to keep the example a single file, load it up here\nfunc init() {\n    setupUploader()\n}\n\nfunc uploadHandler(w http.ResponseWriter, r *http.Request) {\n    counter := 0\n    switch r.Method {\n    // GET to display the upload form.\n    case \"GET\":\n        err := templates.Execute(w, nil)\n        if err != nil {\n            log.Print(err)\n        }\n        // POST uploads each file and sends them to S3\n    case \"POST\":\n        var buf bytes.Buffer\n        // \"file\" is defined by the form field, change it to whatever your form sets it too\n        file, header, err := r.FormFile(\"file\")\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n            return\n        }\n        // close the file\n        defer file.Close()\n        fileName := strings.Split(header.Filename, \".\")\n        // load the entire file data to the buffer\n        _, err = io.Copy(&amp;buf, file)\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n            return\n        }\n\n        // copy each part to destination.\n        go S3Upload(buf, fileName[0])\n        // displaying a success message.\n        err = templates.Execute(w, \"Upload successful.\")\n        if err != nil {\n            log.Print(err)\n        }\n    default:\n        w.WriteHeader(http.StatusMethodNotAllowed)\n    }\n}\n\n// keeping this simple, do something with the err, like log\n// if the uploader fails in the goroutine, there is potential\n// for false positive uploads... channels are not really good here\n// either, for that, bubble the error up,\n// and don't spin up a goroutine.. same thing as waiting for the channel to return.\nfunc S3Upload(body bytes.Buffer, fileName string) {\n    _, err := uploader.Upload(&amp;s3manager.UploadInput{\n        Bucket: aws.String(bucket),\n        Key:    aws.String(fileName),\n        Body:   bytes.NewReader(body.Bytes()),\n    })\n}\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 8773359, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe16d59d9b3e4b39a8a81e0f1106dff8?s=128&d=identicon&r=PG&f=1", "display_name": "Yevgeniy Vasilyev", "link": "https://stackoverflow.com/users/8773359/yevgeniy-vasilyev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 951, "favorite_count": 1, "accepted_answer_id": 51128850, "answer_count": 1, "score": 0, "last_activity_date": 1530502614, "creation_date": 1530496241, "question_id": 51128286, "link": "https://stackoverflow.com/questions/51128286/golang-aws-s3manager-multipartreader-w-goroutines", "title": "Golang AWS S3manager multipartreader w/ Goroutines", "body": "<p>I'm creating an endpoint that allows a user to upload several files at the same time and store them in S3. Currently I'm able to achieve this using MultipartReader and s3manager but only in a non-synchronous fashion. </p>\n\n<p>I'm trying to implement Go routines to speed this functionality up and have multiple files uploaded to S3 concurrently, but a data race error is causing trouble. I think *s3manager might not be goroutine safe as the docs say it is.\n(Code works synchronously if go-statement is replaced with function code).</p>\n\n<p>Could implementing mutex locks possibly fix my error?</p>\n\n<pre><code>func uploadHandler(w http.ResponseWriter, r *http.Request) {\n    counter := 0\n    switch r.Method {\n    // GET to display the upload form.\n    case \"GET\":\n        err := templates.Execute(w, nil)\n        if err != nil {\n            log.Print(err)\n        }\n        // POST uploads each file and sends them to S3\n    case \"POST\":\n        c := make(chan string)\n        // grab the request.MultipartReader\n        reader, err := r.MultipartReader()\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n            return\n        }\n        // copy each part to destination.\n        for {\n            part, err := reader.NextPart()\n            if err == io.EOF {\n                break\n            }\n            // if part.FileName() is empty, skip this iteration.\n            if part.FileName() == \"\" {\n                continue\n            }\n            counter++\n            go S3Upload(c, part)\n        }\n        for i := 0; i &lt; counter; i++ {\n          fmt.Println(&lt;-c)\n         }\n        // displaying a success message.\n        err = templates.Execute(w, \"Upload successful.\")\n        if err != nil {\n            log.Print(err)\n        }\n    default:\n        w.WriteHeader(http.StatusMethodNotAllowed)\n    }\n}  \n\nfunc S3Upload(c chan string, part *multipart.Part) {\n    bucket := os.Getenv(\"BUCKET\")\n    sess, err := session.NewSession(&amp;aws.Config{\n        Region: aws.String(os.Getenv(\"REGION\"))},\n    )\n    if err != nil {\n        c &lt;- \"error occured creating session\"\n        return\n    }\n    uploader := s3manager.NewUploader(sess)\n    _, err = uploader.Upload(&amp;s3manager.UploadInput{\n        Bucket: aws.String(bucket),\n        Key:    aws.String(part.FileName()),\n        Body:   part,\n    })\n    if err != nil {\n        c &lt;- \"Error occurred attempting to upload to S3\"\n        return\n    }\n    // successful upload\n    c &lt;- \"successful upload\"\n}\n</code></pre>\n"}, {"tags": ["docker", "go", "vgo"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1530478667, "post_id": 51126349, "comment_id": 89238842, "body": "Maybe I&#39;m missing something, but why can&#39;t you run <code>vgo mod -vendor</code> as a Dockerfile command?"}, {"owner": {"reputation": 3331, "user_id": 42559, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa7c1350d93036592f58f165318044db?s=128&d=identicon&r=PG", "display_name": "llimllib", "link": "https://stackoverflow.com/users/42559/llimllib"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1530490440, "post_id": 51126349, "comment_id": 89240673, "body": "@TimCooper for that to work I think I need the whole directory copied to the docker image, which means it\u2019ll re-run every time I modify a go file, even if it doesn\u2019t change any imports"}, {"owner": {"reputation": 3331, "user_id": 42559, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa7c1350d93036592f58f165318044db?s=128&d=identicon&r=PG", "display_name": "llimllib", "link": "https://stackoverflow.com/users/42559/llimllib"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1530490932, "post_id": 51126349, "comment_id": 89240724, "body": "@TimCooper verified, if you try it with only a go.mod file in a directory you get <code>vgo: no dependencies to vendor</code>"}], "answers": [{"comments": [{"owner": {"reputation": 3331, "user_id": 42559, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa7c1350d93036592f58f165318044db?s=128&d=identicon&r=PG", "display_name": "llimllib", "link": "https://stackoverflow.com/users/42559/llimllib"}, "edited": false, "score": 1, "creation_date": 1533695610, "post_id": 51723998, "comment_id": 90436116, "body": "Very cool! I think you&#39;ll be excited about <code>go mod download</code>, which should come out in the next release."}], "tags": [], "owner": {"reputation": 85, "user_id": 7378594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82a10205cfb7feba2a7e299288080a8e?s=128&d=identicon&r=PG", "display_name": "Artem Co", "link": "https://stackoverflow.com/users/7378594/artem-co"}, "is_accepted": false, "score": 1, "last_activity_date": 1533652039, "last_edit_date": 1533652039, "creation_date": 1533636038, "answer_id": 51723998, "question_id": 51126349, "link": "https://stackoverflow.com/questions/51126349/how-to-download-all-dependencies-with-vgo-and-a-given-go-mod/51723998#51723998", "title": "How to download all dependencies with vgo and a given go.mod?", "body": "<p>I had an exact same problem, wanted to make Docker caching more accurate.</p>\n\n<p>So I've just written my own tool for that: <a href=\"https://github.com/gladkikhartem/gomodget\" rel=\"nofollow noreferrer\">https://github.com/gladkikhartem/gomodget</a></p>\n\n<p>Now my docker-in-docker pipelines are just 10 seconds and the docker build log looks like this:</p>\n\n<pre><code>Step 4/15 : RUN go get -u golang.org/x/vgo\n ---&gt; Using cache\n ---&gt; 12c672a07a16\nStep 5/15 : RUN go get github.com/gladkikhartem/gomodget\n ---&gt; Using cache\n ---&gt; acc70fea0edc\nStep 7/15 : COPY go.mod .\n ---&gt; Using cache\n ---&gt; 41bae1ca7428\nStep 8/15 : RUN gomodget\n ---&gt; Using cache\n ---&gt; 758100f7dde2\nStep 9/15 : COPY . .\n ---&gt; cc833c5bc810\nStep 10/15 : RUN vgo build -ldflags '-extldflags \"-static\"' -o /bin/app \n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3331, "user_id": 42559, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa7c1350d93036592f58f165318044db?s=128&d=identicon&r=PG", "display_name": "llimllib", "link": "https://stackoverflow.com/users/42559/llimllib"}, "is_accepted": true, "score": 9, "last_activity_date": 1556328270, "last_edit_date": 1556328270, "creation_date": 1533695583, "answer_id": 51737839, "question_id": 51126349, "link": "https://stackoverflow.com/questions/51126349/how-to-download-all-dependencies-with-vgo-and-a-given-go-mod/51737839#51737839", "title": "How to download all dependencies with vgo and a given go.mod?", "body": "<p>tl;dr: In current go master and in future go releases, <code>go mod download</code> will do this job. For now you need a hack.</p>\n\n<p>On the gophers slack, I was referred to this issue: <a href=\"https://github.com/golang/go/issues/26610\" rel=\"noreferrer\">https://github.com/golang/go/issues/26610</a> where I learned that this would do more or less what I want (assuming here that you're using go version 1.11beta3):</p>\n\n<pre><code># Populate the module cache based on the go.{mod,sum} files.\nCOPY go.mod .\nCOPY go.sum .\nRUN go list -e $(go list -f '{{.Path}}' -m all)\n</code></pre>\n\n<p>Later in the thread, Russ Cox implements <code>go mod download</code>, which will be available in the next release of <code>go</code>, allowing me to remove the silly <code>go list</code> hack above.</p>\n\n<p>update: <code>go mod download</code> is now widely available and you should use it on go 1.12 and later</p>\n"}], "owner": {"reputation": 3331, "user_id": 42559, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/aa7c1350d93036592f58f165318044db?s=128&d=identicon&r=PG", "display_name": "llimllib", "link": "https://stackoverflow.com/users/42559/llimllib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6815, "favorite_count": 3, "accepted_answer_id": 51737839, "answer_count": 2, "score": 9, "last_activity_date": 1556328270, "creation_date": 1530473209, "last_edit_date": 1530497945, "question_id": 51126349, "link": "https://stackoverflow.com/questions/51126349/how-to-download-all-dependencies-with-vgo-and-a-given-go-mod", "title": "How to download all dependencies with vgo and a given go.mod?", "body": "<p>I'm working on a go project, using vgo, with a Dockerfile, and I'd like docker to cache the dependencies of the project such that it has two properties:</p>\n\n<ol>\n<li>If the <code>go.mod</code> file changes, the dependencies will be re-downloaded</li>\n<li>If I change a file in the package, but do not change <code>go.mod</code>, the dependencies will not be re-downloaded.</li>\n</ol>\n\n<p>Right now, I do:</p>\n\n<pre><code>...\nRUN go get -u golang.org/x/vgo\nCOPY . /go/src/whatever\nRUN vgo install\n...\n</code></pre>\n\n<p>But if you change a go file, the dockerfile will have to be rebuilt from the <code>COPY</code> layer onwards.</p>\n\n<p>What I'd like, in short, is to do:</p>\n\n<pre><code>...\nRUN go get -u golang.org/x/vgo\nCOPY go.mod /go/src/whatever\nRUN vgo install_dependencies\nCOPY . /go/src/whatever\nRUN vgo install\n...\n</code></pre>\n\n<p>That way, if I change <code>go.mod</code>, all the dependencies will be downloaded and rebuilt, but otherwise, we can proceed right to building the binary.</p>\n\n<p>I can see a couple of ways to get behavior like this, but all of them have drawbacks:</p>\n\n<ol>\n<li>I could copy <code>$GOPATH/src/mod</code> into the docker container, but that's going to have lots of files I don't need</li>\n<li>I could <code>vgo mod -vendor</code> before I build the docker container, and copy the vendor directory, but that relies on the developer to remember to run <code>vgo mod -vendor</code> every time that <code>go.mod</code> changes, otherwise the app won't build and they'll have to run <code>vgo mod -vendor</code> before retrying the docker build.</li>\n</ol>\n\n<p>Can you think of a way for me to get behavior like my imaginary <code>vgo install_dependencies</code>? Am I missing a vgo trick to do so?</p>\n"}, {"tags": ["docker", "go", "digital-ocean"], "comments": [{"owner": {"reputation": 2906, "user_id": 4472220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd20282840e7a39d6edb51ea1c902e8d?s=128&d=identicon&r=PG", "display_name": "Peter Grainger", "link": "https://stackoverflow.com/users/4472220/peter-grainger"}, "edited": false, "score": 0, "creation_date": 1530465163, "post_id": 51125309, "comment_id": 89235640, "body": "do you have the logs from when you run docker compose on the droplet?"}, {"owner": {"reputation": 459, "user_id": 4413286, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/zyADZ.jpg?s=128&g=1", "display_name": "Cris", "link": "https://stackoverflow.com/users/4413286/cris"}, "reply_to_user": {"reputation": 2906, "user_id": 4472220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd20282840e7a39d6edb51ea1c902e8d?s=128&d=identicon&r=PG", "display_name": "Peter Grainger", "link": "https://stackoverflow.com/users/4472220/peter-grainger"}, "edited": false, "score": 1, "creation_date": 1530466624, "post_id": 51125309, "comment_id": 89235944, "body": "Can you elaborate please?"}, {"owner": {"reputation": 2906, "user_id": 4472220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd20282840e7a39d6edb51ea1c902e8d?s=128&d=identicon&r=PG", "display_name": "Peter Grainger", "link": "https://stackoverflow.com/users/4472220/peter-grainger"}, "edited": false, "score": 0, "creation_date": 1530518883, "post_id": 51125309, "comment_id": 89247800, "body": "I&#39;m assuming on the droplet you are starting the containers using the command <code>docker-compose up</code>?  Do you have the logs from the running of this command?"}, {"owner": {"reputation": 459, "user_id": 4413286, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/zyADZ.jpg?s=128&g=1", "display_name": "Cris", "link": "https://stackoverflow.com/users/4413286/cris"}, "reply_to_user": {"reputation": 2906, "user_id": 4472220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd20282840e7a39d6edb51ea1c902e8d?s=128&d=identicon&r=PG", "display_name": "Peter Grainger", "link": "https://stackoverflow.com/users/4472220/peter-grainger"}, "edited": false, "score": 0, "creation_date": 1530529459, "post_id": 51125309, "comment_id": 89253552, "body": "Mmmh I can&#39;t find any logs. I tried <code>docker logs -t -f &lt;container-name&gt;</code> and then <code>curl localhost:8080</code> but it doesn&#39;t spit out anything."}], "owner": {"reputation": 459, "user_id": 4413286, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/zyADZ.jpg?s=128&g=1", "display_name": "Cris", "link": "https://stackoverflow.com/users/4413286/cris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2012, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1530552802, "creation_date": 1530464709, "last_edit_date": 1530552802, "question_id": 51125309, "link": "https://stackoverflow.com/questions/51125309/empty-response-from-docker-container", "title": "Empty response from Docker container", "body": "<p>I'm trying to deploy a simple example webserver on a Droplet instance from Digital Ocean. This example works on my development machine (Windows) but not on my server (Ubuntu). </p>\n\n<p>Tried from inside the Droplet:</p>\n\n<p><code>curl localhost:8080</code></p>\n\n<p>Obtained:</p>\n\n<p><code>curl: (52) Empty reply from server</code></p>\n\n<p><code>docker ps</code> shows: </p>\n\n<pre><code>CONTAINER ID        IMAGE                    COMMAND              CREATED             STATUS              PORTS                            NAMES\n9325cfbc60d5        myapp.com                \"/bin/sh -c ./app\"   36 minutes ago      Up 36 minutes       80/tcp, 0.0.0.0:8080-&gt;8080/tcp   myappcom_website_1\n</code></pre>\n\n<p>Application:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"strings\"\n)\n\nfunc sayHello(w http.ResponseWriter, r *http.Request) {\n    message := r.URL.Path\n    message = strings.TrimPrefix(message, \"/\")\n    message = \"Hello \" + message\n\n    w.Write([]byte(message))\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", sayHello)\n    if err := http.ListenAndServe(\":8080\", nil); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>Dockerfile:</p>\n\n<pre><code># Build stage\nFROM golang:alpine AS builder\nWORKDIR /go/src/app\nCOPY . .\nRUN apk add --no-cache curl \nRUN curl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh\nRUN dep ensure\nRUN go install \n\n# Final stage\nFROM alpine:latest\nCOPY --from=builder /go/bin/app /app\nENTRYPOINT ./app\nLABEL Name=myapp.com Version=0.0.1\nEXPOSE 8080:8080\n</code></pre>\n\n<p>docker-compose.yml:</p>\n\n<pre><code>version: '3.6'\n\nservices:\n  website:\n    image: myapp.com\n    build: .\n    ports:\n      - 8080:8080\n</code></pre>\n\n<p>Why?</p>\n\n<p>EDIT: I noted that if I <code>docker ps</code> on my dev machine, under \"ports\" it shows <code>0.0.0.0:8080-&gt;8080/tcp</code>, without the port 80 like in the droplet. I didn't expose port 80 on my droplet, so I wonder why it is showed there. Maybe digital ocean docker image is messing something up?</p>\n"}, {"tags": ["go", "datadog"], "comments": [{"owner": {"reputation": 153, "user_id": 4453119, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5OTN4.jpg?s=128&g=1", "display_name": "Rea Sand", "link": "https://stackoverflow.com/users/4453119/rea-sand"}, "edited": false, "score": 0, "creation_date": 1530481550, "post_id": 51124961, "comment_id": 89239414, "body": "What kind of data did you collect? If it&#39;s generic enough, you might want to have a look at <a href=\"https://github.com/influxdata/telegraf\" rel=\"nofollow noreferrer\">telegraf</a> instead of rolling your own. It&#39;s a plugin-driven tool for collecting and distributing metrics. Among others it has a datadog output plugin. If you need to collected custom, specialized metrics you might want to have a look at <a href=\"https://github.com/DataDog/datadog-go\" rel=\"nofollow noreferrer\">this client</a> to get an idea."}, {"owner": {"reputation": 153, "user_id": 4453119, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5OTN4.jpg?s=128&g=1", "display_name": "Rea Sand", "link": "https://stackoverflow.com/users/4453119/rea-sand"}, "edited": false, "score": 0, "creation_date": 1530481697, "post_id": 51124961, "comment_id": 89239441, "body": "Just saw the client was already linked in the answer below. You can just look at the example on GitHub."}], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 9699047, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/803630c30c8c916a86c9b2db119ea06a?s=128&d=identicon&r=PG&f=1", "display_name": "TalkingJson", "link": "https://stackoverflow.com/users/9699047/talkingjson"}, "edited": false, "score": 0, "creation_date": 1530468459, "post_id": 51125051, "comment_id": 89236400, "body": "ok, about agent and DogStatsD i understand, but example of <b>full</b> Go program i still not find"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 71, "user_id": 9699047, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/803630c30c8c916a86c9b2db119ea06a?s=128&d=identicon&r=PG&f=1", "display_name": "TalkingJson", "link": "https://stackoverflow.com/users/9699047/talkingjson"}, "edited": false, "score": 1, "creation_date": 1530486861, "post_id": 51125051, "comment_id": 89240191, "body": "@TalkingJson: edited my answer to include an example"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 2, "last_activity_date": 1530486842, "last_edit_date": 1530486842, "creation_date": 1530462356, "answer_id": 51125051, "question_id": 51124961, "link": "https://stackoverflow.com/questions/51124961/send-data-to-datadog-using-go/51125051#51125051", "title": "Send data to Datadog using Go", "body": "<p>First step is to install the DataDog agent on the server in which you are running your application:</p>\n\n<p><a href=\"https://docs.datadoghq.com/agent/\" rel=\"nofollow noreferrer\">https://docs.datadoghq.com/agent/</a></p>\n\n<p>You then need to enable the <code>DogStatsD</code> service in the DataDog agent:</p>\n\n<p><a href=\"https://docs.datadoghq.com/developers/dogstatsd/\" rel=\"nofollow noreferrer\">https://docs.datadoghq.com/developers/dogstatsd/</a></p>\n\n<p>After that, you can send metrics to the <code>statsd</code> agent using any Go library that connects to <code>statsd</code>.</p>\n\n<p>For example:</p>\n\n<p><a href=\"https://github.com/DataDog/datadog-go\" rel=\"nofollow noreferrer\">https://github.com/DataDog/datadog-go</a></p>\n\n<p><a href=\"https://github.com/go-kit/kit/tree/master/metrics/statsd\" rel=\"nofollow noreferrer\">https://github.com/go-kit/kit/tree/master/metrics/statsd</a></p>\n\n<p>Here's an example program sending some counts using the first library:</p>\n\n<pre><code>import (\n    \"github.com/DataDog/datadog-go/statsd\"\n    \"log\"\n)\n\nfunc main() {\n    // Create the client\n    c, err := statsd.New(\"127.0.0.1:8125\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    // Prefix every metric with the app name\n    c.Namespace = \"myapp.\"\n    // Count two events\n    err = c.Count(\"my_counter\", 2, nil, 1)\n    if err != nil {\n        log.Fatal(err)\n    }\n    // Close the client\n    err = c.Close()\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": false, "score": 0, "last_activity_date": 1530579656, "creation_date": 1530579656, "answer_id": 51145348, "question_id": 51124961, "link": "https://stackoverflow.com/questions/51124961/send-data-to-datadog-using-go/51145348#51145348", "title": "Send data to Datadog using Go", "body": "<p>Here is a convenience wrapper for DD. It uses ENV vars to configure it, but it's a nice utility to package out common DD calls once you have the agent running in the background.</p>\n\n<pre><code>package datadog\n\nimport (\n    \"errors\"\n    \"log\"\n    \"os\"\n    \"regexp\"\n    \"sort\"\n    \"sync\"\n    \"time\"\n\n    \"github.com/DataDog/datadog-go/statsd\"\n)\n\nvar (\n    mu     sync.RWMutex\n    client = newClient()\n\n    GlobalTags Tags = Tags{}\n)\n\n// Sometimes, the connection to datadog can fail, but because UDP is connectionless, we don't get insight into\n// those failures. This loop just makes sure that once a minute, the client is refreshed.\nfunc init() {\n    go func() {\n        for range time.Tick(time.Minute) {\n            c := newClient()\n            if c != nil {\n                mu.Lock()\n                client = c\n                mu.Unlock()\n            }\n        }\n    }()\n}\n\nfunc newClient() *statsd.Client {\n    hp := os.Getenv(\"DOGSTATSD_HOST_PORT\")\n    if hp == \"\" {\n        hp = \"127.0.0.1:8125\"\n    }\n\n    c, err := statsd.New(hp)\n    if err != nil {\n        log.Println(\"stat/datadog\", \"Could not create a datadog statsd client.\", \"error\", err)\n    }\n\n    return c\n}\n\ntype Tags map[string]string\n\nfunc (tags Tags) StringSlice() []string {\n    var stringSlice []string\n    for k, v := range tags {\n        if k != \"\" &amp;&amp; v != \"\" {\n            stringSlice = append(stringSlice, formatName(k)+\":\"+formatName(v))\n        }\n    }\n    sort.Strings(stringSlice)\n    return stringSlice\n}\n\nfunc mergeTags(tagsSlice []Tags) Tags {\n    merged := Tags{}\n    for k, v := range GlobalTags {\n        merged[formatName(k)] = formatName(v)\n    }\n    for _, tags := range tagsSlice {\n        for k, v := range tags {\n            merged[formatName(k)] = formatName(v)\n        }\n    }\n    return merged\n}\n\nfunc Gauge(name string, value float64, tags ...Tags) error {\n    mu.RLock()\n    defer mu.RUnlock()\n    if client == nil {\n        return errors.New(\"datadog: nil client\")\n    }\n    return client.Gauge(formatName(name), value, mergeTags(tags).StringSlice(), 1)\n}\n\nfunc Count(name string, value int64, tags ...Tags) error {\n    mu.RLock()\n    defer mu.RUnlock()\n    if client == nil {\n        return errors.New(\"datadog: nil client\")\n    }\n    return client.Count(formatName(name), value, mergeTags(tags).StringSlice(), 1)\n}\n\nfunc Histogram(name string, value float64, tags ...Tags) error {\n    mu.RLock()\n    defer mu.RUnlock()\n    if client == nil {\n        return errors.New(\"datadog: nil client\")\n    }\n    return client.Histogram(formatName(name), value, mergeTags(tags).StringSlice(), 1)\n}\n\nfunc Incr(name string, tags ...Tags) error {\n    mu.RLock()\n    defer mu.RUnlock()\n    if client == nil {\n        return errors.New(\"datadog: nil client\")\n    }\n    return client.Incr(formatName(name), mergeTags(tags).StringSlice(), 1)\n}\n\nfunc Decr(name string, tags ...Tags) error {\n    mu.RLock()\n    defer mu.RUnlock()\n    if client == nil {\n        return errors.New(\"datadog: nil client\")\n    }\n    return client.Decr(formatName(name), mergeTags(tags).StringSlice(), 1)\n}\n\nfunc Set(name string, value string, tags ...Tags) error {\n    mu.RLock()\n    defer mu.RUnlock()\n    if client == nil {\n        return errors.New(\"datadog: nil client\")\n    }\n    return client.Set(formatName(name), value, mergeTags(tags).StringSlice(), 1)\n}\n\nfunc Timing(name string, value time.Duration, tags ...Tags) error {\n    mu.RLock()\n    defer mu.RUnlock()\n    if client == nil {\n        return errors.New(\"datadog: nil client\")\n    }\n    return client.Timing(formatName(name), value, mergeTags(tags).StringSlice(), 1)\n}\n\n// Datadog allows '.', '_' and alphas only.\n// If we don't validate this here then the datadog error logs can fill up disk really quickly\nvar nameRegex = regexp.MustCompile(`[^\\._a-zA-Z0-9]+`)\n\nfunc formatName(name string) string {\n    return nameRegex.ReplaceAllString(name, \"_\")\n}\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 9699047, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/803630c30c8c916a86c9b2db119ea06a?s=128&d=identicon&r=PG&f=1", "display_name": "TalkingJson", "link": "https://stackoverflow.com/users/9699047/talkingjson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2820, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1530579656, "creation_date": 1530461627, "question_id": 51124961, "link": "https://stackoverflow.com/questions/51124961/send-data-to-datadog-using-go", "title": "Send data to Datadog using Go", "body": "<p>i'm collect data using Go and want to visualize it, i chose Datadog, but didn't find examples or live projects where Go used for sending metrics to Datadog. But in offical site says that Go is supported.</p>\n"}, {"tags": ["go", "crypt"], "answers": [{"comments": [{"owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "edited": false, "score": 1, "creation_date": 1530464180, "post_id": 51123954, "comment_id": 89235445, "body": "note to self -- the string <code>$2a$09$f5561d2634fb28a969f2dO8QeQ70f4bjCnF&#47;.GvPpjj.8jgmtzZP2</code> appears to have been hashed already.  The <code>$2a$</code> may suggest that PHP5.3 or earlier used crypt() function with CRYPT_BLOWFISH .   As far as I can tell with my introductory knowledge to how golang works, the kless/tredoe package makes no references to CRYPT_BLOWFISH, which may lead to other problems I do not understand."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "edited": false, "score": 1, "creation_date": 1530472142, "post_id": 51123954, "comment_id": 89237388, "body": "@John: The prefix &quot;$2a$&quot; or &quot;$2b$&quot; (or &quot;$2y$&quot;) in a hash string in a shadow password file indicates that hash string is a bcrypt hash in modular crypt format. bcrypt is a password hashing function, based on the Blowfish cipher, <a href=\"https://en.wikipedia.org/wiki/Bcrypt\" rel=\"nofollow noreferrer\">bcrypt - Wikipedia</a>. Go <a href=\"https://godoc.org/golang.org/x/crypto/bcrypt\" rel=\"nofollow noreferrer\">package bcrypt</a>: <code>import &quot;golang.org&#47;x&#47;crypto&#47;bcrypt&quot;</code>."}, {"owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "edited": false, "score": 1, "creation_date": 1530541642, "post_id": 51123954, "comment_id": 89260838, "body": "As a related topic, I finally solved my original question here based on your comments - <a href=\"https://stackoverflow.com/questions/51119682/golang-equivalent-of-php-crypt/51138267\" title=\"golang equivalent of php crypt\">stackoverflow.com/questions/51119682/&hellip;</a>"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 5, "last_activity_date": 1530547989, "last_edit_date": 1530547989, "creation_date": 1530453537, "answer_id": 51123954, "question_id": 51123718, "link": "https://stackoverflow.com/questions/51123718/why-does-my-crypt-package-give-me-invalid-magic-prefix-error/51123954#51123954", "title": "Why does my crypt package give me invalid magic prefix error?", "body": "<blockquote>\n  <p>Why does this happen and how do I resolve it?</p>\n</blockquote>\n\n<hr>\n\n<p>You have an invalid magic prefix.</p>\n\n<hr>\n\n<blockquote>\n<pre><code>github.com/tredoe/osutil/user/crypt/sha512_crypt/sha512_crypt.go\n\nif !bytes.HasPrefix(salt, c.Salt.MagicPrefix) {\n  return \"\", common.ErrSaltPrefix\n}\n</code></pre>\n</blockquote>\n\n<p>Read the crypt package code.</p>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"http://php.net/manual/en/function.crypt.php\" rel=\"nofollow noreferrer\">PHP: crypt \u2014 One-way string\n  hashing</a></p>\n  \n  <p><a href=\"http://php.net/manual/en/function.password-hash.php\" rel=\"nofollow noreferrer\">PHP: password_hash \u2014 Creates a password hash</a></p>\n</blockquote>\n\n<p>Read the PHP documentation.</p>\n\n<p>See your earlier question: <a href=\"https://stackoverflow.com/questions/51119682/\">golang equivalent of PHP crypt()</a>.</p>\n\n<hr>\n\n<p>Provide a valid magic prefix.</p>\n\n<hr>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/kless/osutil/user/crypt/sha512_crypt\"\n)\n\nfunc main() {\n    c := sha512_crypt.New()\n    magic := sha512_crypt.MagicPrefix\n    hash, err := c.Generate(\n        []byte(\"enter-new-password\"),\n        []byte(magic+\"$2a$09$f5561d2634fb28a969f2dO8QeQ70f4bjCnF/.GvPpjj.8jgmtzZP2\"),\n    )\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(hash)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$6$$.AVE44JRnLFr9TZx3zASJX6V3Uu0jpnrOV6fW1T5NHy3MUKPaJXHGvjooxrAkYsuIL2HwS/sYgzUZ.cg8FTtz/\n</code></pre>\n\n<hr>\n\n<p>NOTE:</p>\n\n<pre><code>import \"github.com/kless/osutil/user/crypt/sha512_crypt\"\n</code></pre>\n\n<p>is now an alias for the new location</p>\n\n<pre><code>import \"github.com/tredoe/osutil/user/crypt/sha512_crypt\"\n</code></pre>\n"}], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 499, "favorite_count": 1, "accepted_answer_id": 51123954, "answer_count": 1, "score": -5, "last_activity_date": 1530547989, "creation_date": 1530451736, "last_edit_date": 1530453364, "question_id": 51123718, "link": "https://stackoverflow.com/questions/51123718/why-does-my-crypt-package-give-me-invalid-magic-prefix-error", "title": "Why does my crypt package give me invalid magic prefix error?", "body": "<p>I have the following code:</p>\n\n<pre><code>import \"github.com/kless/osutil/user/crypt/sha512_crypt\"\nc := sha512_crypt.New()\nhash, err := c.Generate([]byte(\"enter-new-password\"), []byte(\"$2a$09$f5561d2634fb28a969f2dO8QeQ70f4bjCnF/.GvPpjj.8jgmtzZP2\"))\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>And it produced the following error</p>\n\n<blockquote>\n  <p>http: panic serving 192.168.0.16:56730: invalid magic prefix</p>\n</blockquote>\n\n<p>Why does this happen and how do I resolve it?</p>\n"}, {"tags": ["go", "endianness"], "answers": [{"comments": [{"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1530466117, "post_id": 51123337, "comment_id": 89235825, "body": "You can pull out the loop invariant <code>len(b)-1</code> from this (call it &#39;last&#39; or something)."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 6, "last_activity_date": 1530448400, "creation_date": 1530448400, "answer_id": 51123337, "question_id": 51123309, "link": "https://stackoverflow.com/questions/51123309/converting-a-big-int-to-little-endian-byte-slice/51123337#51123337", "title": "Converting a big.Int to little-endian byte slice", "body": "<p>The simplest solution is to reverse the slice returned from <code>Bytes()</code>:</p>\n\n<pre><code>b := bigInt.Bytes()\nfor i := 0; i &lt; len(b)/2; i++ {\n    b[i], b[len(b)-i-1] = b[len(b)-i-1], b[i]\n}\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 4518319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0025f1831e4acc54f8691674c1e6f4a6?s=128&d=identicon&r=PG", "display_name": "Shahul Hameed", "link": "https://stackoverflow.com/users/4518319/shahul-hameed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 808, "favorite_count": 0, "accepted_answer_id": 51123337, "answer_count": 1, "score": 5, "last_activity_date": 1530448400, "creation_date": 1530448186, "question_id": 51123309, "link": "https://stackoverflow.com/questions/51123309/converting-a-big-int-to-little-endian-byte-slice", "title": "Converting a big.Int to little-endian byte slice", "body": "<p>I have a big.Int and want to convert it to a little-endian byte slice. If I use <a href=\"https://golang.org/pkg/math/big/#Int.Bytes\" rel=\"noreferrer\">Int.Bytes</a>, I get the big-endian byte slice. </p>\n\n<p>Is there any way to get little-endian byte slice for big.Int?</p>\n"}, {"tags": ["go", "goquery"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1530461671, "post_id": 51123249, "comment_id": 89234837, "body": "Put the solution in an answer to the question, and not in your question itself."}], "answers": [{"tags": [], "owner": {"reputation": 3134, "user_id": 3884750, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100003183948251/picture?type=large", "display_name": "Oleg  Sobchuk", "link": "https://stackoverflow.com/users/3884750/oleg-sobchuk"}, "is_accepted": false, "score": 0, "last_activity_date": 1530467291, "creation_date": 1530467291, "answer_id": 51125634, "question_id": 51123249, "link": "https://stackoverflow.com/questions/51123249/scraper-find-element-by-text/51125634#51125634", "title": "Scraper Find element by text", "body": "<p>SOLVED</p>\n\n<p>As goQuery uses jQuery finders, I changed goQuery finder in a next way</p>\n\n<pre><code>doc.Find(\"tr:contains('Second')\").Find(\"td\").First().Next().Text()\n</code></pre>\n"}], "owner": {"reputation": 3134, "user_id": 3884750, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100003183948251/picture?type=large", "display_name": "Oleg  Sobchuk", "link": "https://stackoverflow.com/users/3884750/oleg-sobchuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 136, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1530467313, "creation_date": 1530447695, "last_edit_date": 1530467313, "question_id": 51123249, "link": "https://stackoverflow.com/questions/51123249/scraper-find-element-by-text", "title": "Scraper Find element by text", "body": "<p>for example, I have next table</p>\n\n<pre><code>&lt;table&gt;\n  &lt;tr&gt;\n    &lt;td&gt;\n      First\n    &lt;/td&gt;\n    &lt;td&gt;\n      1\n    &lt;/td&gt;\n  &lt;/tr&gt;\n  &lt;tr&gt;\n    &lt;td&gt;\n      Second\n    &lt;/td&gt;\n    &lt;td&gt;\n      2\n    &lt;/td&gt;\n  &lt;/tr&gt;\n&lt;/table&gt;\n</code></pre>\n\n<p>how can I find element by text, for example \"Second\" and then get value \"2\"?</p>\n\n<p>Of course, I can do something like</p>\n\n<pre><code>doc, _ := goquery.NewDocumentFromReader(resp.Body)\ncaseSize := doc.Find(\"tr\").Each(func(i int, element *goquery.Selection){\n  // here I check each element by needed text\n})\n</code></pre>\n\n<p>but maybe there is may be another, more simple way, some specific finder?</p>\n"}, {"tags": ["git", "go", "github", "version-control", "gitlab"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 5, "creation_date": 1530435546, "post_id": 51121797, "comment_id": 89228887, "body": "<code>go get</code> also retrieves transitive dependencies of the project while <code>git clone</code> doesn&#39;t. Also <code>go get</code> clone into the right folder while with <code>git clone</code> you have to do it correct yourself."}, {"owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 4, "creation_date": 1530436036, "post_id": 51121797, "comment_id": 89228996, "body": "<a href=\"https://golang.org/cmd/go/#hdr-Download_and_install_packages_and_dependencies\" rel=\"nofollow noreferrer\">golang.org/cmd/go/&hellip;</a>. It is a good explanation of <code>go get</code>."}, {"owner": {"reputation": 15076, "user_id": 3702377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Ac4wz.jpg?s=128&g=1", "display_name": "Benyamin Jafari", "link": "https://stackoverflow.com/users/3702377/benyamin-jafari"}, "edited": false, "score": 1, "creation_date": 1530437534, "post_id": 51121797, "comment_id": 89229343, "body": "what&#39;s reason of downvotes?"}, {"owner": {"reputation": 15076, "user_id": 3702377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Ac4wz.jpg?s=128&g=1", "display_name": "Benyamin Jafari", "link": "https://stackoverflow.com/users/3702377/benyamin-jafari"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 2, "creation_date": 1530441292, "post_id": 51121797, "comment_id": 89230084, "body": "@peterSO I google difference between two command but not any appear, so I thought maybe this difference and usage of each one useful for other and me."}, {"owner": {"reputation": 2624, "user_id": 989920, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/01e16ed8a3bc3246278001359f7a0257?s=128&d=identicon&r=PG", "display_name": "evolutionxbox", "link": "https://stackoverflow.com/users/989920/evolutionxbox"}, "edited": false, "score": 2, "creation_date": 1530444149, "post_id": 51121797, "comment_id": 89230736, "body": "One command is for git, the other is for go. The git command has no knowledge, or care for, go."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1530462419, "post_id": 51121847, "comment_id": 89235024, "body": "Plus, neither the named packages nor the dependencies need to be Git repositories. Other VCS are supported as well."}], "tags": [], "owner": {"reputation": 206, "user_id": 9824786, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FQ8tK.jpg?s=128&g=1", "display_name": "Jere", "link": "https://stackoverflow.com/users/9824786/jere"}, "is_accepted": true, "score": 18, "last_activity_date": 1530435590, "creation_date": 1530435590, "answer_id": 51121847, "question_id": 51121797, "link": "https://stackoverflow.com/questions/51121797/difference-between-go-get-and-git-clone/51121847#51121847", "title": "Difference between `go get` and `git clone`?", "body": "<p>The <code>git clone</code> command will clone a repo into a newly created directory, while <code>go get</code> downloads and installs the packages named by the import paths, along with their dependencies.</p>\n"}], "owner": {"reputation": 15076, "user_id": 3702377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Ac4wz.jpg?s=128&g=1", "display_name": "Benyamin Jafari", "link": "https://stackoverflow.com/users/3702377/benyamin-jafari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8440, "favorite_count": 2, "accepted_answer_id": 51121847, "answer_count": 1, "score": 14, "last_activity_date": 1554134912, "creation_date": 1530435149, "last_edit_date": 1554134912, "question_id": 51121797, "link": "https://stackoverflow.com/questions/51121797/difference-between-go-get-and-git-clone", "title": "Difference between `go get` and `git clone`?", "body": "<p>I had a problem with <code>go-modbus</code> in an <a href=\"https://github.com/goburrow/modbus/issues/30\" rel=\"noreferrer\">issue</a> in Github.<br>\nAuthor suggested me to use:   </p>\n\n<pre><code>$ go get github.com/goburrow/modbus  \n</code></pre>\n\n<p><strong>instead of</strong>      </p>\n\n<pre><code>$ git clone https://github.com/goburrow/modbus.git\n</code></pre>\n\n<p>What is the difference between that two commands?</p>\n"}, {"tags": ["go", "gopath", "govendor"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1530416742, "post_id": 51120207, "comment_id": 89225951, "body": "Why would you expect a vendor directory?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1530417102, "post_id": 51120207, "comment_id": 89225982, "body": "&quot;What are the possible reasons the vendor folder is not generated?&quot; --- it&#39;s not done automatically. If you haven&#39;t done it explicitly - it&#39;s not created and used. Check <a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">github.com/golang/dep</a>"}, {"owner": {"reputation": 1159, "user_id": 2158478, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/aab8eb00b849fd0797099e958c0c8494?s=128&d=identicon&r=PG", "display_name": "bunny", "link": "https://stackoverflow.com/users/2158478/bunny"}, "edited": false, "score": 0, "creation_date": 1530417655, "post_id": 51120207, "comment_id": 89226048, "body": "Thank you! Will look into the link provided."}], "answers": [{"tags": [], "owner": {"reputation": 1728, "user_id": 1589165, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/g0kW4.jpg?s=128&g=1", "display_name": "Harshil Sharma", "link": "https://stackoverflow.com/users/1589165/harshil-sharma"}, "is_accepted": true, "score": 4, "last_activity_date": 1530418574, "creation_date": 1530418574, "answer_id": 51120351, "question_id": 51120207, "link": "https://stackoverflow.com/questions/51120207/cannot-find-vendor-directory-under-golang-project/51120351#51120351", "title": "cannot find vendor directory under golang project", "body": "<p>Vendor directory is used as an alternative to <code>GOPATH</code> when resolving dependencies. A dependency is first looked up in <code>/vendor</code> then in <code>GOPATH</code> then in <code>GOROOT</code>. </p>\n\n<p>If you <code>go get</code> all your dependencies they'll be in <code>GOPATH/src</code> instead of <code>/vendor</code>. </p>\n\n<p>To start adding project specific dependencies to vendor dir you need to use a dependency manager such as <code>glide</code> or <code>dep</code> or manually copy everything to <code>/vendor</code>.</p>\n\n<p>This SO answer goes into more detail on using vendor dir in Go - <a href=\"https://stackoverflow.com/a/37238226/1589165\">https://stackoverflow.com/a/37238226/1589165</a></p>\n"}], "owner": {"reputation": 1159, "user_id": 2158478, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/aab8eb00b849fd0797099e958c0c8494?s=128&d=identicon&r=PG", "display_name": "bunny", "link": "https://stackoverflow.com/users/2158478/bunny"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2760, "favorite_count": 0, "accepted_answer_id": 51120351, "answer_count": 1, "score": 1, "last_activity_date": 1530418574, "creation_date": 1530415939, "last_edit_date": 1530417725, "question_id": 51120207, "link": "https://stackoverflow.com/questions/51120207/cannot-find-vendor-directory-under-golang-project", "title": "cannot find vendor directory under golang project", "body": "<p>My golang version is go1.10.2 linux/amd64. I can build and run my go project(under gopath/src) without any problem but I cannot see vendor directory under my project folder. I would like to know if the vendor folder is a hidden directory? What are the possible reasons the vendor folder is not generated?</p>\n"}, {"tags": ["go", "go-interface"], "answers": [{"comments": [{"owner": {"reputation": 2335, "user_id": 963182, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82b8397cc8b711c38b1f1a4dee765af9?s=128&d=identicon&r=PG", "display_name": "Invictus", "link": "https://stackoverflow.com/users/963182/invictus"}, "edited": false, "score": 0, "creation_date": 1530416047, "post_id": 51120157, "comment_id": 89225874, "body": "Awesome explanation, thanks a lot. I had a understanding of interfaces. But, got confused with interface embedding. But, now its crystal clear. Thanks"}, {"owner": {"reputation": 73, "user_id": 5612481, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jb91U.jpg?s=128&g=1", "display_name": "jack_t", "link": "https://stackoverflow.com/users/5612481/jack-t"}, "edited": false, "score": 0, "creation_date": 1610551693, "post_id": 51120157, "comment_id": 116170956, "body": "This is very good explanation @eugenioy. But does it mean embedding interfaces into another could pose the risks?"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 73, "user_id": 5612481, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jb91U.jpg?s=128&g=1", "display_name": "jack_t", "link": "https://stackoverflow.com/users/5612481/jack-t"}, "edited": false, "score": 0, "creation_date": 1610983584, "post_id": 51120157, "comment_id": 116298448, "body": "not sure what you mean by risks @jack_t, embedding is a way to simplify composition in Go"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 7, "last_activity_date": 1530415234, "creation_date": 1530415234, "answer_id": 51120157, "question_id": 51120089, "link": "https://stackoverflow.com/questions/51120089/understanding-interface-inside-interfaceembedded-interface/51120157#51120157", "title": "Understanding interface inside interface(Embedded Interface)", "body": "<p>In this definition:</p>\n\n<pre><code>type MyprojectV1alpha1Interface interface {\n    RESTClient() rest.Interface\n    SamplesGetter\n}\n</code></pre>\n\n<p>Your <code>MyprojectV1alpha1Interface</code> embeds the <code>SamplesGetter</code> interface.</p>\n\n<p>Embedding an interface inside another interface means all of the methods of the embedded interface (<code>SamplesGetter</code>) can be invoked over the embedding interface (<code>MyprojectV1alpha1Interface</code>).</p>\n\n<p>That means you can invoke any of the <code>SamplesGetter</code> methods on any object that implements <code>MyprojectV1alpha1Interface</code>.</p>\n\n<p>So once you get a <code>MyprojectV1alpha1Interface</code> object in your <code>temp</code> variable, you can call the <code>Samples</code> method (with suitable <code>namespace</code>, which I cannot guess from the code you posted):</p>\n\n<pre><code>sampleInt := temp.Samples(\"namespace here\")\n</code></pre>\n\n<p><code>sampleInt</code> will then have a <code>SampleInterface</code> object, so you can then invoke the <code>Create</code> function using your <code>sampleInt</code> variable:</p>\n\n<pre><code>sample, err := sampleInt.Create(&lt;you should use a *v1alpha1.Sample here&gt;)\n</code></pre>\n\n<p>For more details about how interfaces work, I'd suggest you go to the official specs and examples:</p>\n\n<p><a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"noreferrer\">https://golang.org/ref/spec#Interface_types</a></p>\n\n<p><a href=\"https://gobyexample.com/interfaces\" rel=\"noreferrer\">https://gobyexample.com/interfaces</a></p>\n"}], "owner": {"reputation": 2335, "user_id": 963182, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/82b8397cc8b711c38b1f1a4dee765af9?s=128&d=identicon&r=PG", "display_name": "Invictus", "link": "https://stackoverflow.com/users/963182/invictus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2682, "favorite_count": 3, "accepted_answer_id": 51120157, "answer_count": 1, "score": 6, "last_activity_date": 1530478302, "creation_date": 1530414096, "last_edit_date": 1530478302, "question_id": 51120089, "link": "https://stackoverflow.com/questions/51120089/understanding-interface-inside-interfaceembedded-interface", "title": "Understanding interface inside interface(Embedded Interface)", "body": "<p>I was trying to understand the Interface embedding with the following code.</p>\n\n<p>I have the following: </p>\n\n<pre><code>type MyprojectV1alpha1Interface interface {\n    RESTClient() rest.Interface\n    SamplesGetter\n}\n\n// SamplesGetter has a method to return a SampleInterface.\n// A group's client should implement this interface.\ntype SamplesGetter interface {\n    Samples(namespace string) SampleInterface\n}\n\n// SampleInterface has methods to work with Sample resources.\ntype SampleInterface interface {\n    Create(*v1alpha1.Sample) (*v1alpha1.Sample, error)\n    Update(*v1alpha1.Sample) (*v1alpha1.Sample, error)\n    Delete(name string, options *v1.DeleteOptions) error\n    DeleteCollection(options *v1.DeleteOptions, listOptions v1.ListOptions) error\n    Get(name string, options v1.GetOptions) (*v1alpha1.Sample, error)\n    List(opts v1.ListOptions) (*v1alpha1.SampleList, error)\n    Watch(opts v1.ListOptions) (watch.Interface, error)\n    Patch(name string, pt types.PatchType, data []byte, subresources ...string) (result *v1alpha1.Sample, err error)\n    SampleExpansion\n}\n</code></pre>\n\n<p>Now if I have the follwoing:</p>\n\n<pre><code>func returninterface() MyprojectV1alpha1Interface {\n//does something and returns me MyprojectV1alpha1Interface\n}\ntemp := returninterface()\n</code></pre>\n\n<p>Now, from the MyprojectV1alpha1Interface if I want to call the </p>\n\n<blockquote>\n  <p>Create function  of SampleInterface</p>\n</blockquote>\n\n<p>what I need to do?</p>\n\n<p>Also, please explain me how this interfaces work in Golang.</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1530421877, "post_id": 51120033, "comment_id": 89226534, "body": "There is a lot of example in the web, have you tried something?"}], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 6, "last_activity_date": 1530414455, "creation_date": 1530414455, "answer_id": 51120114, "question_id": 51120033, "link": "https://stackoverflow.com/questions/51120033/how-to-test-http-calls-in-go/51120114#51120114", "title": "How to test http calls in go", "body": "<p>Take a look here:</p>\n\n<p><a href=\"https://golang.org/pkg/net/http/httptest/#example_Server\" rel=\"noreferrer\">https://golang.org/pkg/net/http/httptest/#example_Server</a></p>\n\n<p>Basically, you can create a new \"mock\" http server using <code>httptest.NewServer</code> function.</p>\n\n<p>You can have your mock server return whatever response you need from the test, and you can also have your mock server store the request that your <code>HTTPPost</code> function made in order to assert over it.</p>\n\n<pre><code>func TestYourHTTPPost(t *testing.T){\n\n    ts := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        fmt.Fprintln(w, `response from the mock server goes here`)\n        // you can also inspect the contents of r (the request) to assert over it\n    }))\n    defer ts.Close()\n\n    mockServerURL = ts.URL\n\n    message := \"the message you want to test\"\n\n    resp, err := HTTPPost(message, mockServerURL)\n\n    // assert over resp and err here\n}\n</code></pre>\n"}], "owner": {"reputation": 344, "user_id": 1538016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0571ecc6828cf8c1c55fb8e89dc51663?s=128&d=identicon&r=PG&f=1", "display_name": "gautam", "link": "https://stackoverflow.com/users/1538016/gautam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3214, "favorite_count": 2, "accepted_answer_id": 51120114, "answer_count": 1, "score": 4, "last_activity_date": 1530421851, "creation_date": 1530413307, "last_edit_date": 1530421851, "question_id": 51120033, "link": "https://stackoverflow.com/questions/51120033/how-to-test-http-calls-in-go", "title": "How to test http calls in go", "body": "<p>I have the following code:</p>\n\n<pre><code>// HTTPPost to post json messages to the specified url\nfunc HTTPPost(message interface{}, url string) (*http.Response, error) {\n    jsonValue, err := json.Marshal(message)\n    if err != nil {\n        logger.Error(\"Cannot Convert to JSON: \", err)\n        return nil, err\n    }\n    logger.Info(\"Calling http post with url: \", url)\n    resp, err := getClient().Post(url, \"application/json\", bytes.NewBuffer(jsonValue))\n    if err != nil {\n        logger.Error(\"Cannot post to the url: \", url, err)\n        return nil, err\n    }\n    err = IsErrorResp(resp, url)\n    return resp, err\n}\n</code></pre>\n\n<p>I'd like to write the tests for this, but I am not sure how to use httptest package .   </p>\n"}, {"tags": ["go", "architecture", "clean-architecture"], "answers": [{"comments": [{"owner": {"reputation": 903, "user_id": 3027614, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5c2d0d0b4cd3457db67aefcf03fd0d01?s=128&d=identicon&r=PG", "display_name": "mark.sagikazar", "link": "https://stackoverflow.com/users/3027614/mark-sagikazar"}, "edited": false, "score": 1, "creation_date": 1530453389, "post_id": 51122516, "comment_id": 89232941, "body": "I&#39;ve already read this article and I think this is great, but it also solves the problem by simply returning the response and does not call the presenter from the use case. I would rather see a solution for that. But thanks anyway!"}], "tags": [], "owner": {"reputation": 159, "user_id": 1183632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qs8EG.jpg?s=128&g=1", "display_name": "Danilo", "link": "https://stackoverflow.com/users/1183632/danilo"}, "is_accepted": false, "score": 3, "last_activity_date": 1530441525, "creation_date": 1530441525, "answer_id": 51122516, "question_id": 51119690, "link": "https://stackoverflow.com/questions/51119690/how-to-implement-the-presenter-in-golang-according-to-the-clean-architecture/51122516#51122516", "title": "How to implement the presenter in Golang according to the Clean Architecture?", "body": "<p>I can tell you about my experience according to Clean Architecture. I spent time on that issue, reading articles and testing code. So I'd like to suggest you the following post and the source code attached, it helped me a lot:</p>\n\n<ul>\n<li><a href=\"http://manuel.kiessling.net/2012/09/28/applying-the-clean-architecture-to-go-applications/\" rel=\"nofollow noreferrer\">Applying The Clean Architecture to Go applications</a></li>\n</ul>\n\n<p>It's a really good starting point, I'm designing my software in that way developing restful web app up to the presentation to the user passing through jQuery and Bootstrap. I can claim that now my software is really diveded into indipendent layers. Also it helped me to undestand the power of te golang interfaces and finally make simple testing each part of software.\nHope this help you too.</p>\n"}, {"comments": [{"owner": {"reputation": 1179, "user_id": 2246881, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/57559d546953ae3d0ccd8ba47bac13ab?s=128&d=identicon&r=PG", "display_name": "Boaz Hoch", "link": "https://stackoverflow.com/users/2246881/boaz-hoch"}, "edited": false, "score": 0, "creation_date": 1578757345, "post_id": 58167566, "comment_id": 105546703, "body": "I don&#39;t think this is what uncle bob meant, what if you take the web out of the controller or the presenter?  The presenter should be injected into controller, controller should be injected to web and web needs to deal response, request, cookies, headers etc.  this way if you would have a console app, the functions of controller and presenter remain intact.  But this is not possible since the way go http handlers work as a closure."}, {"owner": {"reputation": 1481, "user_id": 469898, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/Qf9DF.jpg?s=128&g=1", "display_name": "Dr.eel", "link": "https://stackoverflow.com/users/469898/dr-eel"}, "reply_to_user": {"reputation": 1179, "user_id": 2246881, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/57559d546953ae3d0ccd8ba47bac13ab?s=128&d=identicon&r=PG", "display_name": "Boaz Hoch", "link": "https://stackoverflow.com/users/2246881/boaz-hoch"}, "edited": false, "score": 0, "creation_date": 1578903691, "post_id": 58167566, "comment_id": 105576720, "body": "@BoazHoch Controllers it&#39;s only a glue between the Domain usecase and the infrastructure - it can&#39;t be universal. When one connects any new infrastructure to the app he have to create new controllers related to it. For example you attaching CLI interface, so you glue it to the domain logic by &quot;cli controller&quot;. May be the word <code>controller</code> is misleading and we think about different conceptions."}, {"owner": {"reputation": 1179, "user_id": 2246881, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/57559d546953ae3d0ccd8ba47bac13ab?s=128&d=identicon&r=PG", "display_name": "Boaz Hoch", "link": "https://stackoverflow.com/users/2246881/boaz-hoch"}, "edited": false, "score": 0, "creation_date": 1579156352, "post_id": 58167566, "comment_id": 105672711, "body": "I don&#39;t see why you would need to create a new controller for each infrastructure. If the controller expect an @input or implements some kind of interface which is well defined, all other infrastructure would need to obey to it. I&#39;d rather think that a new adapter should be presented taking care of converting the incoming data from the new infrastructure into that conforming to the controller interface."}], "tags": [], "owner": {"reputation": 1481, "user_id": 469898, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/Qf9DF.jpg?s=128&g=1", "display_name": "Dr.eel", "link": "https://stackoverflow.com/users/469898/dr-eel"}, "is_accepted": false, "score": 0, "last_activity_date": 1569845040, "creation_date": 1569845040, "answer_id": 58167566, "question_id": 51119690, "link": "https://stackoverflow.com/questions/51119690/how-to-implement-the-presenter-in-golang-according-to-the-clean-architecture/58167566#58167566", "title": "How to implement the presenter in Golang according to the Clean Architecture?", "body": "<p>I think you can pass the <code>rw http.ResponseWriter</code> to the <code>presenter</code> to allow write the actual response. It would look like this:</p>\n\n<pre><code>type presenter interface {\n    present(rw http.ResponseWriter, response interface{})\n}\n\ntype myPresenter struct {}\nfunc (p *myPresenter) present(rw http.ResponseWriter, response interface{}) {\n  fmt.Fprintf(rw, \"Hello, %+v\", response)\n}\n</code></pre>\n\n<p>Or another way is to pass a request writer within a closure. Here the code with Gin-gonic \n HTTP handler:</p>\n\n<pre><code>  // presenter.go\n  type successWriter func(result interface{})\n  type errorWriter func(err error)\n\n  type Presenter interface {\n    OnSuccess(dw successWriter, result interface{})\n    OnError(ew errorWriter, err error, meta map[string]string) // we pass error and some extras\n  }\n\n  type resourcePresenter struct{}\n\n  func (p *resourcePresenter) OnSuccess(dw successWriter, data interface{}) {\n    preaparedResult = ... // prepare response data with data        \n    dw(preaparedResult)\n  }\n\n  func (p *resourcePresenter) OnError(ew errorWriter, err error, meta map[string]string) \n  {\n    // here we can wrap error to add extra information\n    enrichedError := &amp;MyError{ err: err, meta: meta }\n    ew(enrichedError)\n  }\n</code></pre>\n\n<p>And a call to the presenter in the controller:</p>\n\n<pre><code>// controller.go\n// RegisterController attaches component to route. \nfunc RegisterController(rg *gin.RouterGroup, uc MyUsecase) {\n    ctl := &amp;Controller{\n        usecase: uc,\n        presenter: &amp;resourcePresenter{},\n    }\n    rg.GET(\"\", ctl.list())\n}\nfunc (ctl *aController) list() gin.HandlerFunc {\n   return func(c *gin.Context) {\n      usecaseResp, err := ctl.usecase.List()\n      if err != nil {\n        ctl.presenter.OnError(\n          func(err error) { // closure to pass the HTTP context (ResposeWriter)\n            c.Error(err) // add error to gin.Errors, middleware will handle it\n          }, \n          err, \n          map[string]string{\n            \"client\": c.ClientIP(),\n          }\n        )\n      }\n      return\n   }\n   ctl.presenter.OnSuccess(func(data interface{}) {\n            fmt.Println(`ctl.presenter.OnSuccess `)\n            c.JSON(http.StatusOK, data)\n        }, usecaseResp)\n}\n</code></pre>\n"}], "owner": {"reputation": 903, "user_id": 3027614, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/5c2d0d0b4cd3457db67aefcf03fd0d01?s=128&d=identicon&r=PG", "display_name": "mark.sagikazar", "link": "https://stackoverflow.com/users/3027614/mark-sagikazar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1395, "favorite_count": 4, "answer_count": 2, "score": 9, "last_activity_date": 1569845040, "creation_date": 1530407591, "last_edit_date": 1530522498, "question_id": 51119690, "link": "https://stackoverflow.com/questions/51119690/how-to-implement-the-presenter-in-golang-according-to-the-clean-architecture", "title": "How to implement the presenter in Golang according to the Clean Architecture?", "body": "<p>Proper software architecture is key to create a project that is maintainable. What proper means is 100% subjective,\nbut lately I like and try to follow <a href=\"https://8thlight.com/blog/uncle-bob/2012/08/13/the-clean-architecture.html\" rel=\"noreferrer\">Clean Architecture</a> by Robert C. Martin (aka Uncle Bob).</p>\n\n<p>Although I really like the theory, it lacks some sort of practical implementation guide for common technical challenges developers may face.\nOne of the things I've been struggling with for example is properly implementing the presenter layer.</p>\n\n<p>The presenter is responsible for accepting the \"response\" from my use case and formatting it in a way\nthat it can be \"presented\" to my output device (regardless if it is a web or a CLI application).</p>\n\n<p>There are multiple approaches for this problem, but they usually fall under one of these categories:</p>\n\n<ol>\n<li>The presenter is called by the use case itself through some sort of output interface</li>\n<li>The use case returns the response model and the controller (which originally called the use case) passes this model to the presenter</li>\n</ol>\n\n<p>Option 1 is more or less the same as what Clean Architecture/Uncle Bob says (in the book and in various posts, see later), Option 2 is rather an alternative approach which works.</p>\n\n<p>Sounds cool, but let's see how we can implement them in Go.</p>\n\n<p>Here is my first version. For simplicity, our output goes to the web now.</p>\n\n<p>Also, please excuse my brevity.</p>\n\n<pre><code>package my_domain\n\nimport \"http\"\n\ntype useCase struct {\n    presenter presenter\n}\n\nfunc (uc *useCase) doSomething(arg string) {\n    uc.presenter(\"success\")\n}\n\ntype presenter interface {\n    present(respone interface{})\n}\n\ntype controller struct {\n    useCase useCase\n}\n\nfunc (c *controller) Action(rw http.ResponseWriter, req *http.Request) {\n    c.useCase(\"argument\")\n}\n</code></pre>\n\n<p>Basically it does exactly as described above and in Clean Architecture: There is a controller which calls a use case (through a boundary, which is not present here). The use case does something and calls the presenter (which is not implemented, but it's exactly the question).</p>\n\n<p>Our next step could be implementing the presenter....but given how output works in Go HTTP handlers there is a nice problem to solve. Namely: request scope.</p>\n\n<p>Every request has it's own response writer (passed to the http handler) where the response should be written. There is no global request scope that can be accessed by the presenter, it needs the response writer. So if I want to follow option 1 (use case calling the presenter), I have to pass it somehow to the presenter which becomes request scoped this way, while the rest of the application is completely stateless and not request scoped, they are instantiated once.</p>\n\n<p>That also means that I either pass the response writer itself to the use case and the presenter (and I would rather not do that) or create a new presenter for each request.</p>\n\n<p>Where can I do that:</p>\n\n<ol>\n<li>In the controller via factories</li>\n<li>In the use case via factories (but then again: the use case would have to receive the response writer as a parameter)</li>\n</ol>\n\n<p>This bring in another problem: if the presenter is request scoped, is the use case too?</p>\n\n<p>If I want to inject the presenter into the use case struct, then yes it is and the use case has to be created in the controller as well.</p>\n\n<p>Alternatively I can make the presenter a parameter of the use case (noone said a dependency must be injected at \"construction time\"). But that would still somewhat couple the presenter to the controller.</p>\n\n<p>There are other, unanswered issues (like where should I send HTTP headers for example), but those are less Go specific.</p>\n\n<p>This is a theoretical question as I'm not yet sure that I want to use this pattern, but I've spent quite an amount of time thinking about this problem without finding the perfect one so far.</p>\n\n<p>Based on the <a href=\"https://gist.github.com/sagikazarmark/97d5bde2c6dff5065e46828fad9c03b7\" rel=\"noreferrer\">articles and questions</a> I've read about the topic: others haven't either.</p>\n"}, {"tags": ["php", "go", "crypt"], "comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1530410597, "post_id": 51119682, "comment_id": 89225333, "body": "Would <a href=\"https://stackoverflow.com/a/26203018/6309\">stackoverflow.com/a/26203018/6309</a> help?"}, {"owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "reply_to_user": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1530445067, "post_id": 51119682, "comment_id": 89230927, "body": "@VonC  i just tried your recommendation but I get an error for &quot;invalid magic prefix&quot;.  I&#39;ve posted the details in Attempt 3 of my question.  Your recommendation does sound more promising if I can only get over this error."}], "answers": [{"tags": [], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "is_accepted": true, "score": 4, "last_activity_date": 1530541411, "last_edit_date": 1530541411, "creation_date": 1530541051, "answer_id": 51138267, "question_id": 51119682, "link": "https://stackoverflow.com/questions/51119682/golang-equivalent-of-php-crypt/51138267#51138267", "title": "golang equivalent of PHP crypt()", "body": "<p>Although I haven't found an exact \"Go crypt function\" equivalent of PHP's crypt function, I found an alternative.</p>\n\n<p>The following solved my problem</p>\n\n<pre><code>import \"golang.org/x/crypto/bcrypt\"\n// check will be nil if the bcrypt version of \"enter-new-password\" is the same as the \"$2a$09$f5561d2634fb28a969f2dO8QeQ70f4bjCnF/.GvPpjj.8jgmtzZP2\" .  Otherwise check will be an error object\ncheck := bcrypt.CompareHashAndPassword([]byte(\"$2a$09$f5561d2634fb28a969f2dO8QeQ70f4bjCnF/.GvPpjj.8jgmtzZP2\"),[]byte(\"enter-new-password\"))\nlog.Println(check)\n</code></pre>\n\n<p>The <code>golang.org/x/crypto/bcrypt/bcrypt_test.go</code> has some useful examples of how to use this module.</p>\n\n<hr>\n\n<p>Apparently PHP's crypt function has many different ways of hashing a value, like sha256, sha512, blowfish etc... It seems there are many go lang modules out there, but you have to explicitly state the hash type, the cost, etc...  In my question, the existence of <code>$2a$</code> as a prefix to the hash value suggested the use of some blowfish type hash.  Some of my earlier attempts didn't consider this. In fact, the module in attempt 3 does not have support for blowfish.</p>\n"}], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 897, "favorite_count": 3, "accepted_answer_id": 51138267, "answer_count": 1, "score": 7, "last_activity_date": 1530541411, "creation_date": 1530407388, "last_edit_date": 1530460753, "question_id": 51119682, "link": "https://stackoverflow.com/questions/51119682/golang-equivalent-of-php-crypt", "title": "golang equivalent of PHP crypt()", "body": "<p>This line of code in PHP evaluates to true</p>\n\n<pre><code>echo '$2a$09$f5561d2634fb28a969f2dO8QeQ70f4bjCnF/.GvPpjj.8jgmtzZP2' == crypt(\"enter-new-password\",'$2a$09$f5561d2634fb28a969f2dO8QeQ70f4bjCnF/.GvPpjj.8jgmtzZP2');\n</code></pre>\n\n<p>What I need is a crypt function in Golang that will also evaluate to true.</p>\n\n<p><strong>ATTEMPT 1</strong></p>\n\n<p>I tried this but it evaluated to false:</p>\n\n<pre><code>import \"github.com/nyarla/go-crypt\"\nlog.Println(\"$2a$09$f5561d2634fb28a969f2dO8QeQ70f4bjCnF/.GvPpjj.8jgmtzZP2\" == crypt.Crypt(\"enter-new-password\",\"$2a$09$f5561d2634fb28a969f2dO8QeQ70f4bjCnF/.GvPpjj.8jgmtzZP2\"))\n</code></pre>\n\n<p><strong>ATTEMPT 2</strong></p>\n\n<p>I also tried to define and use this crypt function that I found somewhere else, but it also returned false:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\n// #cgo LDFLAGS: -lcrypt\n// #define _GNU_SOURCE\n// #include &lt;crypt.h&gt;\n// #include &lt;stdlib.h&gt;\nimport \"C\"\n\n// crypt wraps C library crypt_r\nfunc crypt(key, salt string) string {\n    data := C.struct_crypt_data{}\n    ckey := C.CString(key)\n    csalt := C.CString(salt)\n    out := C.GoString(C.crypt_r(ckey, csalt, &amp;data))\n    C.free(unsafe.Pointer(ckey))\n    C.free(unsafe.Pointer(csalt))\n    return out\n}\n</code></pre>\n\n<p><strong>ATTEMPT 3</strong></p>\n\n<p>I also tried this, but it doesn't seem to have support for CRYPT_BLOWFISH, which was what was used by an older PHP5.3 and earlier:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/51123718/why-do-golang-give-me-invalid-magic-prefix-error\">Why does my crypt package give me invalid magic prefix error?</a></p>\n\n<p><strong>So my question is:</strong></p>\n\n<p>How do I get a golang crypt function to behave exactly like the PHP crypt function for the strings <code>enter-new-password</code> and <code>$2a$09$f5561d2634fb28a969f2dO8QeQ70f4bjCnF/.GvPpjj.8jgmtzZP2</code>?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 251, "user_id": 4206073, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh5.googleusercontent.com/-92XQ7FEndPU/AAAAAAAAAAI/AAAAAAAAAGk/auXe5UZpHe0/photo.jpg?sz=128", "display_name": "A.kadir olmez", "link": "https://stackoverflow.com/users/4206073/a-kadir-olmez"}, "is_accepted": false, "score": 0, "last_activity_date": 1530566821, "creation_date": 1530566821, "answer_id": 51143941, "question_id": 51119676, "link": "https://stackoverflow.com/questions/51119676/go-user-login-using-gin-gonic/51143941#51143941", "title": "Go User Login Using GIn-Gonic", "body": "<p>you use file extension (.html). if you want to use master page or not?</p>\n\n<p>if you want to use master page then you not write any extension for example \"home/index\".</p>\n\n<p>if you want to use not master page then you write full path \"home/index.html\"</p>\n"}], "owner": {"reputation": 11, "user_id": 9920916, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-4cY7jxqGToA/AAAAAAAAAAI/AAAAAAAAAAc/-A0wcTFLBZw/photo.jpg?sz=128", "display_name": "btslove", "link": "https://stackoverflow.com/users/9920916/btslove"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1741, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1530566821, "creation_date": 1530407271, "question_id": 51119676, "link": "https://stackoverflow.com/questions/51119676/go-user-login-using-gin-gonic", "title": "Go User Login Using GIn-Gonic", "body": "<p>I'm having a bit of trouble in logging in using gin-gonic in making a web application. I'm currently using an API for it. where I can make requests for entry. This is my code snippets:</p>\n\n<p><strong>main</strong></p>\n\n<pre><code>// LOGIN\nrouter.GET(\"/login\", loginUser)\nrouter.POST(\"/login\", login)\n</code></pre>\n\n<p><strong>snippet for login function</strong></p>\n\n<pre><code>// LOGIN FUNCTIONS\n\nfunc loginUser(c *gin.Context) {\nc.HTML(200, \"login.html\", gin.H{})\n\n}\n\nfunc login(c *gin.Context) {\n\n\nemail := c.PostForm(\"email\")\npassword := c.PostForm(\"password\")\n\n\n\nr := gin.Default()\nr.LoadHTMLGlob(\"templates/*\")\nr.POST(\"/api/user/login\", func(c *gin.Context) {\n    var json common.Login\n    if err := common.Bind(c, &amp;json); err == nil {\n\n        if json.Email == email &amp;&amp; json.Password == password {\n            c.JSON(200, gin.H{\"email\":email, \"password\": password,})\n            fmt.Println(email)\n            fmt.Println(password)       \n\n        } else {\n            c.JSON(401, common.NewError(\"user\", errors.New(\"wrong username or password\")))\n            c.HTML(404, \"404notification.html\", gin.H{})\n\n        }\n        c.HTML(200, \"notification.html\", gin.H{\"email\": email})\n\n    } else {\n        c.JSON(422, common.NewValidatorError(err))\n    }\n})\nr.Run()\n\n\n\n\n}\n</code></pre>\n\n<p>As you can see im trying to post request my credentials in order to login. </p>\n\n<p>When I click submit on my form box in function <code>loginUser</code>-  <strong>login</strong> recieves the post request and then redirects itself to the html when success and the 404error html if wrong. </p>\n\n<p>I dont know if my understanding is right, it's my second day learning this to make web apps. Help pls</p>\n"}, {"tags": ["pointers", "debugging", "go", "struct", "goland"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1530400992, "post_id": 51119150, "comment_id": 89224361, "body": "I just tried it and both output lines have &quot;John&quot; in them. What happens if you compile and run this program from the command line (<code>go run file.go</code>)?"}, {"owner": {"reputation": 241, "user_id": 5672542, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/29ab50545414b03b9c669d03bb631019?s=128&d=identicon&r=PG&f=1", "display_name": "Chelovek", "link": "https://stackoverflow.com/users/5672542/chelovek"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1530402073, "post_id": 51119150, "comment_id": 89224477, "body": "I have edited the question. fmt.Printf shows John in both structs. The main problem is that built-in Goland&#39;s Debugger does not show John inside &#39;aRecord&#39;. I wonder why is that and how to fix it."}, {"owner": {"reputation": 241, "user_id": 5672542, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/29ab50545414b03b9c669d03bb631019?s=128&d=identicon&r=PG&f=1", "display_name": "Chelovek", "link": "https://stackoverflow.com/users/5672542/chelovek"}, "edited": false, "score": 0, "creation_date": 1530402852, "post_id": 51119150, "comment_id": 89224563, "body": "try to inspect them in debugger. you will be surprised..."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1530405739, "post_id": 51119150, "comment_id": 89224911, "body": "Questions seeking debugging help (&quot;why isn&#39;t this code working?&quot;) must include the desired behavior, a specific problem or error and the shortest code necessary to reproduce it in the question itself. Questions without a clear problem statement are not useful to other readers. See: <a href=\"http://stackoverflow.com/help/mcve\">How to create a Minimal, Complete, and Verifiable example.</a>"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1530405777, "post_id": 51119150, "comment_id": 89224916, "body": "Here is an MCVE which produces the expected result: <a href=\"https://play.golang.org/p/O_TkFDcunUU\" rel=\"nofollow noreferrer\">play.golang.org/p/O_TkFDcunUU</a> Please provide precise, detailed instructions on how to reproduce your issue."}, {"owner": {"reputation": 241, "user_id": 5672542, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/29ab50545414b03b9c669d03bb631019?s=128&d=identicon&r=PG&f=1", "display_name": "Chelovek", "link": "https://stackoverflow.com/users/5672542/chelovek"}, "edited": false, "score": 0, "creation_date": 1530418773, "post_id": 51119150, "comment_id": 89226172, "body": "&#39;play.golang.org&#39; has no debugger on their website. To reproduce the problem you can debug the code in Goland program of the specified version. Set a breakpoint on a last line of the code and inspect two variables which i mentioned. Do you understand what i tell you?"}, {"owner": {"reputation": 241, "user_id": 5672542, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/29ab50545414b03b9c669d03bb631019?s=128&d=identicon&r=PG&f=1", "display_name": "Chelovek", "link": "https://stackoverflow.com/users/5672542/chelovek"}, "edited": false, "score": 0, "creation_date": 1530419230, "post_id": 51119150, "comment_id": 89226226, "body": "Here is the evidence of a strange behaviour of the debugger. 2 Images. Feel the difference. 1. <a href=\"https://imghost.io/image/fGdA8\" rel=\"nofollow noreferrer\">imghost.io/image/fGdA8</a> 2. <a href=\"https://imghost.io/image/fGcjX\" rel=\"nofollow noreferrer\">imghost.io/image/fGcjX</a> Do you understand now?"}], "answers": [{"comments": [{"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "reply_to_user": {"reputation": 241, "user_id": 5672542, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/29ab50545414b03b9c669d03bb631019?s=128&d=identicon&r=PG&f=1", "display_name": "Chelovek", "link": "https://stackoverflow.com/users/5672542/chelovek"}, "edited": false, "score": 0, "creation_date": 1530563042, "post_id": 51123627, "comment_id": 89270625, "body": "And a small update. This will be fixed in 2018.2 release, and if you want to try it earlier, you can use the next EAP release after 2018.2 EAP 3."}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": true, "score": 1, "last_activity_date": 1530450911, "creation_date": 1530450911, "answer_id": 51123627, "question_id": 51119150, "link": "https://stackoverflow.com/questions/51119150/problems-with-golands-debugger/51123627#51123627", "title": "Problems with Goland&#39;s Debugger", "body": "<p>This is a problem in how GoLand handles the nesting for the values of these variables at runtime.</p>\n\n<p>I created <a href=\"https://youtrack.jetbrains.com/issue/GO-5880\" rel=\"nofollow noreferrer\">this issue</a> to track and fix it.</p>\n\n<p>Meanwhile, you can use the \"Watches\" functionality to watch for \"aRecord.UnionField.Group.People\" as an example, which will then correctly display the values. Sorry for the inconvenience.</p>\n"}], "owner": {"reputation": 241, "user_id": 5672542, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/29ab50545414b03b9c669d03bb631019?s=128&d=identicon&r=PG&f=1", "display_name": "Chelovek", "link": "https://stackoverflow.com/users/5672542/chelovek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 1, "accepted_answer_id": 51123627, "answer_count": 1, "score": 0, "last_activity_date": 1530450911, "creation_date": 1530399394, "last_edit_date": 1530405605, "question_id": 51119150, "link": "https://stackoverflow.com/questions/51119150/problems-with-golands-debugger", "title": "Problems with Goland&#39;s Debugger", "body": "<p>I have got a strange bug in Golang. </p>\n\n<blockquote>\n  <p>OS: Linux Ubuntu 18.04.</p>\n  \n  <p>CPU: AMD with 64 Bit Support.</p>\n  \n  <p>IDE is Goland 2018.1.5.</p>\n  \n  <p>Go version is 1.10.1.</p>\n  \n  <p>Compiler is set to: 'Any'. </p>\n</blockquote>\n\n<p>I have tried both 'gc' and 'gccgo' compilers. Result is the same.</p>\n\n<p>In the program below, Debugger shows strange things. The 'aUnion' variable has \"John\" inside it, but the 'aRecord' variable which has a Union type in it, has no \"John\" inside. </p>\n\n<p>If i 'fmt.Printf' them, they are both there, but Debugger shows no John inside 'aRecord'.\nIs that a debugger's bug?</p>\n\n<p>The program is very simple. Just nested structs passed as a pointer.</p>\n\n<pre><code>    // 33.go.\n\n    package main\n\n    import \"fmt\"\n\n    type Person struct {\n        Name string\n        Age  int\n    }\n    type GroupOfPeople struct {\n        Name   string\n        People []*Person\n    }\n    type Union struct {\n        ID    int\n        Group *GroupOfPeople\n    }\n    type Record struct {\n        UnionField *Union\n        Type       int\n    }\n\n    func main() {\n\n        var aPerson *Person\n        var people []*Person\n        var aGroup *GroupOfPeople\n        var aUnion *Union\n        var aRecord *Record\n\n        aPerson = &amp;Person{\n            Name: \"John\",\n            Age:  10,\n        }\n        people = []*Person{aPerson}\n        aGroup = &amp;GroupOfPeople{\n            Name:   \"A Group\",\n            People: people,\n        }\n        aUnion = &amp;Union{\n            ID:    123,\n            Group: aGroup,\n        } // John is inside 'aUnion'.\n        aRecord = &amp;Record{\n            UnionField: aUnion,\n            Type:       666,\n        }\n        // John is NOT inside 'aRecord'.\n        // WHY ?!\n        fmt.Printf(\"aUnion: %+v.\\r\\n\", aUnion.Group.People[0])\n        fmt.Printf(\"aRecord: %+v.\\r\\n\", aRecord.UnionField.Group.People[0])\n    }\n</code></pre>\n\n<p>Thank you for help!</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 5, "last_activity_date": 1553441861, "last_edit_date": 1553441861, "creation_date": 1530398778, "answer_id": 51119089, "question_id": 51118691, "link": "https://stackoverflow.com/questions/51118691/should-i-add-go-dep-vendor-to-gitignore/51119089#51119089", "title": "Should I add go dep vendor/ to .gitignore?", "body": "<p><a href=\"https://github.com/github/gitignore/blob/master/Go.gitignore\" rel=\"nofollow noreferrer\"><code>github/gitignore/Go.gitignore</code></a> doesn't add <code>vendor/</code> to its <code>.gitignore</code> file.</p>\n\n<p>This causes its content should be versioned, recorded in the Git repository, instead of being potentially generated, and may respond to the following needs:</p>\n\n<ul>\n<li>avoiding reference changes</li>\n<li>dissapearing projects</li>\n<li>vendoring tool may evolve (<strong><a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">dep</a></strong> to <strong><a href=\"https://github.com/golang/vgo\" rel=\"nofollow noreferrer\">vgo</a></strong> to <strong><a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">modules</a></strong>), ...  </li>\n<li>if you made modifications to vendor dependencies in your Git repository, you should probably track those</li>\n</ul>\n\n<p>On the other hand, <a href=\"https://www.gitignore.io/api/go\" rel=\"nofollow noreferrer\"><code>gitignore.io/api/go</code></a> <strong>does</strong> add <code>vendor/</code> to its <code>.gitignore</code>.</p>\n\n<p>So in conclusion, you might as well ignore it if you're not under any of the situations stated above.</p>\n"}], "owner": {"reputation": 103, "user_id": 8473116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3e2e057c777b28e7df531d07a64ec6b?s=128&d=identicon&r=PG&f=1", "display_name": "Andrei", "link": "https://stackoverflow.com/users/8473116/andrei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4255, "favorite_count": 2, "closed_date": 1530477773, "accepted_answer_id": 51119089, "answer_count": 1, "score": 7, "last_activity_date": 1553441861, "creation_date": 1530394575, "question_id": 51118691, "link": "https://stackoverflow.com/questions/51118691/should-i-add-go-dep-vendor-to-gitignore", "closed_reason": "Duplicate", "title": "Should I add go dep vendor/ to .gitignore?", "body": "<p>Should I add <code>go dep</code> <code>vendor/</code> folder to <code>.gitignore</code>?\nNow I have <code>vendor/</code> in <code>.gitignore</code>, so every deploy will call <code>dep ensure</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1530520009, "post_id": 51118583, "comment_id": 89248337, "body": "What version of go are you using?  I thought the difference between <code>&quot;context&quot;</code> and <code>&quot;golang.org&#47;x&#47;net&#47;context&quot;</code> was handled by the compiler.  Maybe because it&#39;s vendored that&#39;s not the case."}, {"owner": {"reputation": 3126, "user_id": 85010, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/5a1b964e34cc2b1d3e233fa387b791b0?s=128&d=identicon&r=PG", "display_name": "fiskeben", "link": "https://stackoverflow.com/users/85010/fiskeben"}, "reply_to_user": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1530605238, "post_id": 51118583, "comment_id": 89282684, "body": "@zak I&#39;m using go 1.10.3, so I guess the vendoring could be it."}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1530606120, "post_id": 51118583, "comment_id": 89283160, "body": "What happens if you temporarily delete / remove the checked in, vendored package <code>github.com&#47;docker&#47;docker&#47;vendor&#47;golang.org&#47;x&#47;net&#47;context</code>"}, {"owner": {"reputation": 3126, "user_id": 85010, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/5a1b964e34cc2b1d3e233fa387b791b0?s=128&d=identicon&r=PG", "display_name": "fiskeben", "link": "https://stackoverflow.com/users/85010/fiskeben"}, "reply_to_user": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 1, "creation_date": 1530606507, "post_id": 51118583, "comment_id": 89283390, "body": "Turns out my docker dependency was too old. I checked <a href=\"https://github.com/moby/moby/blob/53683bd8326b988977650337ee43b281d2830076/client/container_inspect.go\" rel=\"nofollow noreferrer\">the source on github</a> and the <a href=\"https://github.com/moby/moby/commit/7d62e40f7e4f3c17d229a7687d6fcca5448de813\" rel=\"nofollow noreferrer\">latest commit</a> to one of the files I depend on actually migrated from <code>golang.org&#47;x&#47;net&#47;context</code> to <code>context</code>. I updated it, deleted my <code>vendor</code> folder, and after running <code>dep ensure -update</code> everything is as expected. Thanks for the pointers :)"}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1530606647, "post_id": 51118583, "comment_id": 89283473, "body": "Great! really pleased you sorted it :+1:"}], "owner": {"reputation": 3126, "user_id": 85010, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/5a1b964e34cc2b1d3e233fa387b791b0?s=128&d=identicon&r=PG", "display_name": "fiskeben", "link": "https://stackoverflow.com/users/85010/fiskeben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 122, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1530403807, "creation_date": 1530393674, "question_id": 51118583, "link": "https://stackoverflow.com/questions/51118583/go-mock-interface-with-vendored-imports", "title": "Go mock interface with vendored imports", "body": "<p>I'm using the Docker API and pass the <code>Client</code> to a function like this:</p>\n\n<pre><code>func DoStuffToDocker(ctx context.Context, c *client.Client, ID string) {\n    c.ContainerInspect(ctx, ID)\n    // do stuff\n}\n</code></pre>\n\n<p>I create an interface that defines the functions I use so that I can pass a mock in my tests:</p>\n\n<pre><code>type dockerClient interface {\n    ContainerInspect(ctx context.Context, containerID string) (types.ContainerJSON, error)\n}\n</code></pre>\n\n<p>... and then change the signature of my function to accept the interface instead of the client.</p>\n\n<p>My problem is that the compiler complains that the client doesn't implement the interface. From what I can tell the reason is that the implementation of <code>ContainerInspect</code> uses the <code>golang.org/x/net/context</code> context which the API has vendored (so the import is actually <code>github.com/docker/docker/vendor/golang.org/x/net/context</code>).</p>\n\n<p>How can I create the interface so that the client implements it?</p>\n"}, {"tags": ["json", "go", "mapping", "unmarshalling"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1530389353, "post_id": 51117920, "comment_id": 89222295, "body": "<code>struct { Borrow, Free, Freezed map[string]interface{} }</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1530394294, "post_id": 51117920, "comment_id": 89223330, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/44011905/parse-dynamic-json-object\" title=\"parse dynamic json object\">stackoverflow.com/questions/44011905/parse-dynamic-json-obje&zwnj;&#8203;ct</a>"}], "answers": [{"tags": [], "owner": {"reputation": 117, "user_id": 5559718, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/1068554619822559/picture?type=large", "display_name": "jgulacsy", "link": "https://stackoverflow.com/users/5559718/jgulacsy"}, "is_accepted": true, "score": 1, "last_activity_date": 1530390094, "creation_date": 1530390094, "answer_id": 51118219, "question_id": 51117920, "link": "https://stackoverflow.com/questions/51117920/parsing-dynamic-json-in-go/51118219#51118219", "title": "Parsing dynamic json in go", "body": "<p>By unmarshalling into the following struct I can loop through the desired fields.</p>\n\n<pre><code>type Fields struct {\nResult bool `json:\"result\"`\nInfo   struct {\n    Funds struct {\n        Borrow, Free, Freezed map[string]interface{}\n    } `json:\"funds\"`\n} `json:\"info\"`\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 251, "user_id": 4206073, "user_type": "registered", "accept_rate": 62, "profile_image": "https://lh5.googleusercontent.com/-92XQ7FEndPU/AAAAAAAAAAI/AAAAAAAAAGk/auXe5UZpHe0/photo.jpg?sz=128", "display_name": "A.kadir olmez", "link": "https://stackoverflow.com/users/4206073/a-kadir-olmez"}, "is_accepted": false, "score": 0, "last_activity_date": 1530567356, "creation_date": 1530567356, "answer_id": 51144034, "question_id": 51117920, "link": "https://stackoverflow.com/questions/51117920/parsing-dynamic-json-in-go/51144034#51144034", "title": "Parsing dynamic json in go", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype Root struct {\n    Result bool `json:\"result\"`\n    Info   Info `json:\"info\"`\n}\n\ntype Info struct {\n    Funds struct {\n        Borrow, Free, Freezed map[string]interface{}\n    } `json:\"funds\"`\n}\n\nfunc main() {\n    var rootObject Root\n    jsonContent := \" {\\\"result\\\":true,\\\"info\\\":{\\\"funds\\\":{\\\"borrow\\\":{\\\"val1\\\":\\\"0\\\",\\\"val2\\\":\\\"0\\\"},\\\"free\\\":{\\\"val1\\\":\\\"0\\\",\\\"val2\\\":\\\"0\\\"},\\\"freezed\\\":{\\\"val1\\\":\\\"0\\\",\\\"val2\\\":\\\"0\\\"}}}}\"\n\n    if err := json.Unmarshal([]byte(jsonContent), &amp;rootObject); err != nil {\n        panic(err)\n    }\n    fmt.Println(rootObject)\n}\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 5559718, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/1068554619822559/picture?type=large", "display_name": "jgulacsy", "link": "https://stackoverflow.com/users/5559718/jgulacsy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 406, "favorite_count": 1, "accepted_answer_id": 51118219, "answer_count": 2, "score": 1, "last_activity_date": 1530567356, "creation_date": 1530387124, "question_id": 51117920, "link": "https://stackoverflow.com/questions/51117920/parsing-dynamic-json-in-go", "title": "Parsing dynamic json in go", "body": "<p>I am trying to parse the following json structure, where the fields marked with \"val1\" and \"val2\" are constantly changing, so I cannot use a predefined struct. How could I parse this json in a way to be able to loop through every single \"val\"? Thank you!</p>\n\n<pre><code> {\"result\":true,\"info\":{\"funds\":{\"borrow\":{\"val1\":\"0\",\"val2\":\"0\"},\"free\":{\"val1\":\"0\",\"val2\":\"0\"},\"freezed\":{\"val1\":\"0\",\"val2\":\"0\"}}}}\n</code></pre>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 114, "user_id": 8981190, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8d63264d8f864c99bc9ea90100b9b91?s=128&d=identicon&r=PG&f=1", "display_name": "Maximilian Lehrbaum", "link": "https://stackoverflow.com/users/8981190/maximilian-lehrbaum"}, "edited": false, "score": 0, "creation_date": 1530387102, "post_id": 51117806, "comment_id": 89221863, "body": "You could try to use an 2d map. You would still need 2 loops because of the two arrays but you wouldn&#39;t need to change template or copy and paste anything. In template you could write {{ range $key, $value := . }} And then iterate over value for every key."}], "answers": [{"tags": [], "owner": {"reputation": 480, "user_id": 9448870, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ckK5P.jpg?s=128&g=1", "display_name": "Daniel Sch&#252;tte", "link": "https://stackoverflow.com/users/9448870/daniel-sch%c3%bctte"}, "is_accepted": false, "score": 0, "last_activity_date": 1530733734, "last_edit_date": 1530733734, "creation_date": 1530731477, "answer_id": 51179705, "question_id": 51117806, "link": "https://stackoverflow.com/questions/51117806/ranging-over-a-struct-containing-slices-of-multiple-structs-in-a-template/51179705#51179705", "title": "Ranging over a struct containing slices of multiple structs in a template", "body": "<p>This template should do want you want; it <code>range</code>s over your first and second slice and print all the stock information:</p>\n\n<pre><code>&lt;html&gt;\n&lt;body&gt;\n    &lt;h1&gt;All Stocks&lt;/h1&gt;\n    &lt;table&gt;\n{{ range $key, $val := . }}\n        &lt;tr&gt;\n            &lt;td&gt;Portfolio Number: {{ $key }}&lt;/td&gt;\n        &lt;/tr&gt;\n        &lt;tr&gt;\n            &lt;td&gt;Buy Price&lt;/td&gt;\n            &lt;td&gt;Sell Price&lt;/td&gt;\n        &lt;/tr&gt;\n{{ range $val2 := . }}\n        &lt;tr&gt;\n            &lt;td&gt;{{ $val2.BuyPrice }}&lt;/td&gt;\n            &lt;td&gt;{{ $val2.SellPrice }}&lt;/td&gt;\n        &lt;/tr&gt;\n{{ end }}\n{{ end }}\n    &lt;/table&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>But this solution requires a little bit of restructuring. That is, a <code>Portfolio</code> is now a slice of slices of <code>Stock</code>s:</p>\n\n<pre><code>// Portfolio is a slice of slices of stocks\ntype Portfolio [][]Stock\n\n....\n\nstockA := []Stock{stockAUSD, stockAEURO}\nstockB := []Stock{stockBUSD, stockBEURO}\nportfolio := Portfolio([][]Stock{stockA, stockB}) // for illustrative purposes\n\n....\n</code></pre>\n\n<p>This should give you a nicely formatted table without the necessity to manually loop over all <code>Stock</code>s.</p>\n"}], "owner": {"reputation": 45, "user_id": 10015441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/584a0d240fdb66b4adcf97bc8e5078fc?s=128&d=identicon&r=PG&f=1", "display_name": "stream_entry", "link": "https://stackoverflow.com/users/10015441/stream-entry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 404, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1530733734, "creation_date": 1530385739, "last_edit_date": 1530465194, "question_id": 51117806, "link": "https://stackoverflow.com/questions/51117806/ranging-over-a-struct-containing-slices-of-multiple-structs-in-a-template", "title": "Ranging over a struct containing slices of multiple structs in a template", "body": "<p>I am attempting to pass a struct containing multiple slices of structs into a template. Is there a way to refactor the template so that I can display all the data with using only a single loop (so as to avoid copying and pasting for every single Stock struct that I have). I have tried passing in a 2d array and was unable to access the elements I needed and haven't been able to refactor the template to only one use loop myself.</p>\n\n<p>The following code is a simplified version of what I'm working with.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"html/template\"\n    \"os\"\n)\n\ntype Stock struct {\n    BuyPrice  string\n    SellPrice string\n}\n\ntype StockPortfolio struct {\n    StockA []Stock\n    StockB []Stock\n}\n\nfunc main() {\n\n    // Stocks aren't combined from the get-go because I have more\n    // struct fields relating to each individial trading pair\n\n    stockAUSD := Stock{\n        BuyPrice:  \"1.00 USD\",\n        SellPrice: \"1.10 USD\",\n    }\n    stockAEURO := Stock{\n        BuyPrice:  \"0.85 EUR\",\n        SellPrice: \"0.94 EUR\",\n    }\n    stockBUSD := Stock{\n        BuyPrice:  \"2.00 USD\",\n        SellPrice: \"2.10 USD\",\n    }\n    stockBEURO := Stock{\n        BuyPrice:  \"1.70 EUR\",\n        SellPrice: \"1.88 EUR\",\n    }\n\n    stockA := []Stock{stockAUSD, stockAEURO}\n    stockB := []Stock{stockBUSD, stockBEURO}\n\n    portfolio := StockPortfolio{stockA, stockB}\n\n    tmpl := `\n&lt;table&gt;\n&lt;tr&gt;\n    &lt;td&gt;Price A&lt;/td&gt;\n{{range .StockA}}\n    &lt;td&gt;{{ .BuyPrice }}&lt;/td&gt;\n    &lt;td&gt;{{ .SellPrice }}&lt;/td&gt;\n{{end}}\n&lt;/tr&gt;\n&lt;tr&gt;\n    &lt;td&gt;Price B&lt;/td&gt;\n{{range .StockB}}\n    &lt;td&gt;{{ .BuyPrice }}&lt;/td&gt;\n    &lt;td&gt;{{ .SellPrice }}&lt;/td&gt;\n{{end}}\n&lt;/tr&gt;\n&lt;/table&gt;\n`\n    t := template.Must(template.New(\"tmpl\").Parse(tmpl))\n\n    err := t.Execute(os.Stdout, portfolio)\n    if err != nil {\n        fmt.Println(\"executing template:\", err)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "reflection"], "answers": [{"comments": [{"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1530394888, "post_id": 51118539, "comment_id": 89223444, "body": "Hi, thanks for your answer :) Your solution seems doesn&#39;t satisfy the requirement, because of the <code>Data(m).Execute()</code> only allows to call <code>Execute</code> for <code>Data</code> instead of an arbitrary type that implements <code>Task</code> interface. The goal is to wrap the poller inside an individual package, introduce <code>Data</code> seems makes the code more invasive. Let&#39;s say we have multiple tasks in the database, we need to define a slice of <code>Task</code> so that we can retrieve task data from database one by one, therefore we need a way to concatenate <code>tasks = append(tasks, task)</code>, any thoughts?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1530396846, "post_id": 51118539, "comment_id": 89223732, "body": "@Euryugasaki: You asked how to handle a specific JSON related type, <code>map[string]interface{}</code>, If you have this or any other type that satisfies the <code>Task</code> interface, append it to <code>tasks</code> asd <code>Execute()</code> it.."}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1530401840, "post_id": 51118539, "comment_id": 89224455, "body": "umm. However, you defined the <code>Execute()</code> inside the package. Now assume we built the package called <code>poller</code>, a user wants to call the <code>poller</code> package, let&#39;s say <code>poller.Initialize()</code>, it is not possible to let the user implement <code>Execute</code> method inside <code>poller</code> package. What I was expecting is the <code>poller.Initialize(arg)</code> takes an <code>CustomTask</code> as <code>arg</code> to let the <code>poller</code> package know that <code>poller</code> is now handling type of <code>CustomTask</code> and then perform its <code>Execute()</code>"}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1530443574, "post_id": 51118539, "comment_id": 89230622, "body": "Hi, thanks for your solution, I got some inspiration that I can finally cast a <code>map[string]interface{}</code> to an arbitrary <code>Task</code>:       <code>bytes, _ := json.Marshal(r.Data)</code>     <code>temp := reflect.New(reflect.ValueOf(task).Elem().Type()).Interface()&zwnj;&#8203;.(Task)</code>     <code>json.Unmarshal(bytes, &amp;temp)</code>"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1530398515, "last_edit_date": 1530398515, "creation_date": 1530393278, "answer_id": 51118539, "question_id": 51117781, "link": "https://stackoverflow.com/questions/51117781/restore-a-struct-that-satisfy-a-defined-interface-from-json-string/51118539#51118539", "title": "Restore a struct that satisfy a defined interface from JSON string", "body": "<blockquote>\n  <p><code>r.Data</code> is actually type of <code>interface{}</code> (<code>map[string]interface{}</code>\n  more specifically).</p>\n</blockquote>\n\n<p>You need a method set that satisfies the <code>Task</code> interface. For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Task interface {\n    // Identifier returns a unique string of a task\n    Identifier() string\n    // Data should be persistent\n    Data() interface{}\n    // Execute a task\n    Execute()\n}\n\ntype Record struct {\n    Identifier string      `json:\"identifier\"`\n    Data       interface{} `json:\"data\"`\n}\n\ntype Data map[string]interface{}\n\n// Task interface methods\nfunc (d Data) Identifier() string { return \"\" }\nfunc (d Data) Data() interface{}  { return nil }\nfunc (d Data) Execute()           { fmt.Println(\"Execute()\") }\n\nfunc main() {\n    r := Record{Data: map[string]interface{}{}}\n    fmt.Printf(\"r.Data: %[1]T %[1]v\\n\", r.Data)\n    if m, ok := r.Data.(map[string]interface{}); ok {\n        r.Data = Data(m)\n    }\n\n    var tasks []Task\n    if task, ok := r.Data.(Task); ok {\n        tasks = append(tasks, task)\n    }\n\n    for _, task := range tasks {\n        fmt.Printf(\"%T: \", task)\n        task.Execute()\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/SC9Ff8e-_pP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/SC9Ff8e-_pP</a></p>\n\n<p>Output:</p>\n\n<pre><code>r.Data: map[string]interface {} map[]\nmain.Data: Execute()\n</code></pre>\n"}], "owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 1, "accepted_answer_id": 51118539, "answer_count": 1, "score": 1, "last_activity_date": 1530398515, "creation_date": 1530385543, "last_edit_date": 1530390367, "question_id": 51117781, "link": "https://stackoverflow.com/questions/51117781/restore-a-struct-that-satisfy-a-defined-interface-from-json-string", "title": "Restore a struct that satisfy a defined interface from JSON string", "body": "<p>I am implementing a task poller (restore unfinished task from a database).</p>\n\n<p>The task must satisfy a defined <code>Task</code> interface:</p>\n\n<pre><code>type Task interface {\n    // Identifier returns a unique string of a task\n    Identifier() string\n    // Data should be persistent\n    Data() interface{}\n    // Execute a task\n    Execute()\n}\n</code></pre>\n\n<p>The data stored in database satisfy the following struct:</p>\n\n<pre><code>type Record struct {\n    Identifier string      `json:\"identifier\"`\n    Data       interface{} `json:\"data\"`\n}\n</code></pre>\n\n<p>When task poller starts, it read the stored data from the database, then (let's just ignore error handling for now):</p>\n\n<pre><code>r := &amp;Record{}\nresult := database.Get(key)\njson.Unmarshal([]byte(result), r)\n</code></pre>\n\n<p>we restored the saved data from the database into <code>r</code>.</p>\n\n<p>A problem appears that I cannot call the <code>Execute()</code> method because <code>r.Data</code> is actually type of <code>interface{}</code> (<code>map[string]interface{}</code> more specifically ) other than type of <code>Task</code>.</p>\n\n<p>How can I convert or transform the <code>r.Data</code> to become a struct that satisfies <code>Task</code> interface so that I can successfully call <code>Execute()</code> method?</p>\n"}, {"tags": ["go", "heroku"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 9882474, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Safal Aryal", "link": "https://stackoverflow.com/users/9882474/safal-aryal"}, "edited": false, "score": 1, "creation_date": 1530540450, "post_id": 51126691, "comment_id": 89260142, "body": "I fixed it! The directory and target were named wrong."}], "tags": [], "owner": {"reputation": 480, "user_id": 9448870, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ckK5P.jpg?s=128&g=1", "display_name": "Daniel Sch&#252;tte", "link": "https://stackoverflow.com/users/9448870/daniel-sch%c3%bctte"}, "is_accepted": true, "score": 0, "last_activity_date": 1530476009, "creation_date": 1530476009, "answer_id": 51126691, "question_id": 51114811, "link": "https://stackoverflow.com/questions/51114811/heroku-with-go-and-dep-push-rejected-failed-to-compile-go-app/51126691#51126691", "title": "Heroku with go and dep: `push rejected: failed to compile Go app`", "body": "<p>It looks like your import paths in </p>\n\n<p><code>main.go:7:2:</code> ==> <code>\"backend/database\"</code></p>\n\n<p>and </p>\n\n<p><code>main.go:6:2:</code> ==> <code>\"backend/user\"</code></p>\n\n<p>are not set correctly. Are you able to run your app locally? Are those two imports your own, user-defined packages? If so, please provide a schematic of your project directory structure. I am pretty sure fixing the import paths will fix the problem.</p>\n"}, {"tags": [], "owner": {"reputation": 176, "user_id": 4469888, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/qvshv.png?s=128&g=1", "display_name": "Gabo", "link": "https://stackoverflow.com/users/4469888/gabo"}, "is_accepted": false, "score": 0, "last_activity_date": 1537210249, "creation_date": 1537210249, "answer_id": 52374079, "question_id": 51114811, "link": "https://stackoverflow.com/questions/51114811/heroku-with-go-and-dep-push-rejected-failed-to-compile-go-app/52374079#52374079", "title": "Heroku with go and dep: `push rejected: failed to compile Go app`", "body": "<p>just in case someone still have the this problem, I fixed by specifying the following Gopkg.toml:</p>\n\n<pre><code>[metadata.heroku]\n  root-package = \"the-name-of-my-proyect\"\n  install = [\"./...\"]\n</code></pre>\n\n<p>in my case I didn't specify go version so it took the default one. Also I specified the install - [\"./...\"] because I have a monorepo in which the go code is in a sub folder</p>\n"}], "owner": {"reputation": 33, "user_id": 9882474, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Safal Aryal", "link": "https://stackoverflow.com/users/9882474/safal-aryal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1556, "favorite_count": 0, "accepted_answer_id": 51126691, "answer_count": 2, "score": 2, "last_activity_date": 1537210249, "creation_date": 1530360743, "question_id": 51114811, "link": "https://stackoverflow.com/questions/51114811/heroku-with-go-and-dep-push-rejected-failed-to-compile-go-app", "title": "Heroku with go and dep: `push rejected: failed to compile Go app`", "body": "<p>I am trying to deploy my Go Heroku app that uses <code>dep</code> to manage dependencies. However, when I attempt to push it, the logs say this.</p>\n\n<pre><code>Total 818 (delta 147), reused 0 (delta 0)\nremote: Compressing source files... done.\nremote: Building source:\nremote: \nremote: -----&gt; Go app detected\nremote: -----&gt; Fetching jq... done\nremote: -----&gt; Fetching tq... done\nremote:  !!    \nremote:  !!    Deprecated or unsupported version of go (go1.10.1)\nremote:  !!    See https://devcenter.heroku.com/articles/go-support#go-versions for supported version information.\nremote:  !!    \nremote: -----&gt; Installing go1.10.1\nremote: -----&gt; Fetching go1.10.1.linux-amd64.tar.gz... done\nremote:  !!    Installing package '.' (default)\nremote:  !!    \nremote:  !!    To install a different package spec set 'metadata.heroku.pkg-spec' in 'Gopkg.toml'\nremote:  !!    \nremote:  !!    For more details see: https://devcenter.heroku.com/articles/go-apps-with-dep#build-configuration\nremote:  !!    \nremote: -----&gt; Fetching dep... done\nremote: -----&gt; Fetching any unsaved dependencies (dep ensure)\nremote: -----&gt; Running: go install -v -tags heroku . \nremote: main.go:7:2: cannot find package \"backend/database\" in any of:\nremote:         /tmp/tmp.2P0hB8CCKz/.go/src/main/vendor/backend/database (vendor tree)\nremote:         /app/tmp/cache/go1.10.1/go/src/backend/database (from $GOROOT)\nremote:         /tmp/tmp.2P0hB8CCKz/.go/src/backend/database (from $GOPATH)\nremote: main.go:6:2: cannot find package \"backend/user\" in any of:\nremote:         /tmp/tmp.2P0hB8CCKz/.go/src/main/vendor/backend/user (vendor tree)\nremote:         /app/tmp/cache/go1.10.1/go/src/backend/user (from $GOROOT)\nremote:         /tmp/tmp.2P0hB8CCKz/.go/src/backend/user (from $GOPATH)\nremote:  !     Push rejected, failed to compile Go app.\nremote: \nremote:  !     Push failed\nremote: Verifying deploy...\nremote: \nremote: !       Push rejected to thindan.\nremote: \n</code></pre>\n\n<p>It nags and complains about a GOPATH that is already correct on my system. I wonder why this is happening? My dep configuration file looks like this.</p>\n\n<pre><code># Gopkg.toml example\n#\n# Refer to https://github.com/golang/dep/blob/master/docs/Gopkg.toml.md\n# for detailed Gopkg.toml documentation.\n#\n# required = [\"github.com/user/thing/cmd/thing\"]\n# ignored = [\"github.com/user/project/pkgX\", \"bitbucket.org/user/project/pkgA/pkgY\"]\n#\n# [[constraint]]\n#   name = \"github.com/user/project\"\n#   version = \"1.0.0\"\n#\n# [[constraint]]\n#   name = \"github.com/user/project2\"\n#   branch = \"dev\"\n#   source = \"github.com/myfork/project2\"\n#\n# [[override]]\n#  name = \"github.com/x/y\"\n#  version = \"2.4.0\"\n\n\n[[constraint]]\n  name = \"github.com/boltdb/bolt\"\n  version = \"1.3.1\"\n\n[[constraint]]\n  branch = \"master\"\n  name = \"golang.org/x/crypto\"\n\n[metadata.heroku]\nroot-package = \"backend\"\ngo-version = \"1.10.1\"\nbuild = [\".\"]\nensure = \"false\"\n</code></pre>\n\n<p>What is wrong, and how can I fix it?</p>\n"}, {"tags": ["go", "ssh", "scp"], "comments": [{"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "edited": false, "score": 1, "creation_date": 1530355913, "post_id": 51114171, "comment_id": 89214630, "body": "See how you could implement scp: <a href=\"https://github.com/viant/toolbox/blob/master/ssh\" rel=\"nofollow noreferrer\">github.com/viant/toolbox/blob/master/ssh</a>"}, {"owner": {"reputation": 53, "user_id": 8139532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/187d3b35488579d0afdca17a53da009f?s=128&d=identicon&r=PG&f=1", "display_name": "gbatt", "link": "https://stackoverflow.com/users/8139532/gbatt"}, "reply_to_user": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "edited": false, "score": 0, "creation_date": 1530358153, "post_id": 51114171, "comment_id": 89215190, "body": "Thanks but I was really looking for a simple solution. I already tried a few scp implementations."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1530359307, "post_id": 51114171, "comment_id": 89215488, "body": "Have you looked if <code>cmd</code> has some output? It does not necessarily return, as it may say wrong password or other things."}, {"owner": {"reputation": 53, "user_id": 8139532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/187d3b35488579d0afdca17a53da009f?s=128&d=identicon&r=PG&f=1", "display_name": "gbatt", "link": "https://stackoverflow.com/users/8139532/gbatt"}, "edited": false, "score": 0, "creation_date": 1530359528, "post_id": 51114171, "comment_id": 89215542, "body": "No writing to stdIn just has no effect. I even tried setting the input to os.stdin and then writing with os.stdin.write but it does not work. It only works if I enter it manually. I&#39;m quite confident now that scp creates a subprocess that no longer uses the old pipe once it writes user@10.1.1.2&#39; password to the output."}], "answers": [{"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 0, "last_activity_date": 1530365875, "last_edit_date": 1530365875, "creation_date": 1530365168, "answer_id": 51115364, "question_id": 51114171, "link": "https://stackoverflow.com/questions/51114171/running-scp-via-go-exec-cmd/51115364#51115364", "title": "Running SCP via go exec.cmd", "body": "<p>scp and ssh insist on reading the password from a tty (or psuedo tty)</p>\n\n<p>stdin from a remote session is not this so it will not work</p>\n\n<p>The standard go <a href=\"https://godoc.org/golang.org/x/crypto/ssh\" rel=\"nofollow noreferrer\">golang.org/x/crypto/ssh</a> package does support sending passwords so presumably has a work around.  <a href=\"https://stackoverflow.com/questions/37558853/how-scp-secure-copy-protocol-file-transfer-working\">scp is implemented as a server that is invoked by ssh</a> so probably extending the existing go ssh support would not be difficult</p>\n\n<p>However, there is always an external program based workaround!  As  discussed <a href=\"https://stackoverflow.com/a/13955428/1153938\">here</a>, \nthis involves using the <code>sshpass</code> program</p>\n"}, {"comments": [{"owner": {"reputation": 53, "user_id": 8139532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/187d3b35488579d0afdca17a53da009f?s=128&d=identicon&r=PG&f=1", "display_name": "gbatt", "link": "https://stackoverflow.com/users/8139532/gbatt"}, "edited": false, "score": 0, "creation_date": 1530392756, "post_id": 51118454, "comment_id": 89223008, "body": "The github package looks like the best way to go. My software has to run with as few as dependencies possible so sshpass is not really an option. Thank you."}], "tags": [], "owner": {"reputation": 91, "user_id": 9911189, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FpQ1Ants5QU/AAAAAAAAAAI/AAAAAAAAAAc/E4smqVInW44/photo.jpg?sz=128", "display_name": "Arthur Ruckman", "link": "https://stackoverflow.com/users/9911189/arthur-ruckman"}, "is_accepted": true, "score": 1, "last_activity_date": 1530392431, "creation_date": 1530392431, "answer_id": 51118454, "question_id": 51114171, "link": "https://stackoverflow.com/questions/51114171/running-scp-via-go-exec-cmd/51118454#51118454", "title": "Running SCP via go exec.cmd", "body": "<p>I will assume you are on Linux. If you want to pass a password to <code>scp</code> from the command line, the best way is with <code>sshpass</code>. It should be available for install from the default package repositories on major Linux distros, just install it with <code>apt</code> or <code>yum</code>. The syntax is <code>sshpass -p [password] scp ...</code></p>\n\n<p>Here I spawn a <code>bash</code> session and pipe commands to it from the <code>StdinPipe</code>:</p>\n\n<pre><code>func main() { \n    cmd := exec.Command(\"bash\")\n    cmdWriter, _ := cmd.StdinPipe()\n    cmd.Start()\n\n    cmdString := fmt.Sprintf(\"sshpass -p %s scp -r %s %s@%s:%s\", password, src, user, client, dest)\n\n    cmdWriter.Write([]byte(cmdString + \"\\n\"))\n    cmdWriter.Write([]byte(\"exit\"    + \"\\n\"))\n\n    cmd.Wait()\n}\n</code></pre>\n\n<p>I have ignored errors and simplified your code a little for brevity. </p>\n\n<hr>\n\n<p>However, the \"github.com/pkg/sftp\" package is much easier to use for file transfers like this. You can find a simple example of how to use it <a href=\"https://stackoverflow.com/questions/36786068/golang-copy-remote-file-to-local-folder-using-sftp-golang-library\">here</a>. Note that using <code>nil</code> for <code>HostKeyCallback</code> in the client config is deprecated - use <code>HostKeyCallback: ssh.InsecureIgnoreHostKey()</code> if you absolutely need to accept all host keys.</p>\n"}], "owner": {"reputation": 53, "user_id": 8139532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/187d3b35488579d0afdca17a53da009f?s=128&d=identicon&r=PG&f=1", "display_name": "gbatt", "link": "https://stackoverflow.com/users/8139532/gbatt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1316, "favorite_count": 0, "accepted_answer_id": 51118454, "answer_count": 2, "score": 0, "last_activity_date": 1530392431, "creation_date": 1530355648, "question_id": 51114171, "link": "https://stackoverflow.com/questions/51114171/running-scp-via-go-exec-cmd", "title": "Running SCP via go exec.cmd", "body": "<p>I'm trying to run scp as command via golang's exec.cmd because the non-official implementations available for scp transfer did not work for me. Scp executes until it asks for the password and then I'm unable to write data to the stdin. Could it be possible that the stdin is redirected somewhere else?</p>\n\n<pre><code>var cmd *exec.Cmd\nif m.IsDir() {\n    cmd = exec.Command(\"scp\", \"-r\", src, user+\"@\"+client.Host+\":\"+dest)\n} else {\n    cmd = exec.Command(\"scp\", src, user+\"@\"+client.Host+\":\"+dest)\n}\n\ncmdWriter, err := cmd.StdinPipe()\nif err != nil {\n    return err\n}\n\nerr = cmd.Start()\n\nif cred.Typ() == \"PW\" {\n    cmdWriter.Write( []byte(cred.Data()+\"\\n\") )\n} else {\n    log.Println( \"credential typ not supported\" )\n}\n\nerr = cmd.Wait()\nlog.Println( \"done\" )\nreturn err\n</code></pre>\n\n<p>Setting cmd.Stdin to os.Stdin works but of course I have to manually enter the password which is not what I want. \nOr would you overall not recommend this way to run scp? I'm able to run simple SSH commands on the server (with \"golang.org/x/crypto/ssh\"). Is there maybe a way to transfer binaries just via a SSH session?\nThanks in advance.</p>\n"}, {"tags": ["dictionary", "go", "set"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 6, "creation_date": 1530353028, "post_id": 51113528, "comment_id": 89214055, "body": "No, Go will never support this, as it doesn&#39;t make sense. There&#39;s no way to know what the value should be without providing it. But in future, if you want to know what&#39;s planned for Go, or suggest your own ideas, just visit the <a href=\"https://github.com/golang/go\" rel=\"nofollow noreferrer\">Go issue tracker</a>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1530353489, "post_id": 51113528, "comment_id": 89214137, "body": "Also consider: If you know the value is always true, then using a <code>bool</code> is entirely unnecessary. You can instead use a map as a only list of arbitrary keys by using a <code>map[string]struct{}</code>. It&#39;s a bit cumbersome to read and set, but it conveys the intention more clearly, since a <code>struct{}</code> cannot contain any value at all. This is as close as you can come to a <code>map[string]nil</code>."}, {"owner": {"reputation": 303, "user_id": 2806281, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/L34mH.jpg?s=128&g=1", "display_name": "cnby", "link": "https://stackoverflow.com/users/2806281/cnby"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530500046, "post_id": 51113528, "comment_id": 89242078, "body": "Thank you @Flimzy, In my machine-learning scenario, &#39;set&#39; is a very high frequency data structure, so I try to find a simple way to init a set. BTW, In such scenario, people always compare with python."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1530516529, "post_id": 51113528, "comment_id": 89246714, "body": "Having a <code>set</code> primitive may or may not make sense--although Go is unlikely to adopt one. Having a <code>set</code> library probably does make sense (and does exist, as provided in an answer). In any case, your proposed <code>map</code> initialization syntax does not make sense."}], "answers": [{"comments": [{"owner": {"reputation": 303, "user_id": 2806281, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/L34mH.jpg?s=128&g=1", "display_name": "cnby", "link": "https://stackoverflow.com/users/2806281/cnby"}, "edited": false, "score": 1, "creation_date": 1530502640, "post_id": 51113870, "comment_id": 89242483, "body": "Thank you for good solutions @icza. But I think built-in data-structure is more efficient way. VS Python ( T_T )"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 303, "user_id": 2806281, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/L34mH.jpg?s=128&g=1", "display_name": "cnby", "link": "https://stackoverflow.com/users/2806281/cnby"}, "edited": false, "score": 0, "creation_date": 1530516690, "post_id": 51113870, "comment_id": 89246775, "body": "@cnby: More efficient how?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1530354001, "last_edit_date": 1530354001, "creation_date": 1530353057, "answer_id": 51113870, "question_id": 51113528, "link": "https://stackoverflow.com/questions/51113528/does-golang-have-the-plan-for-supporting-set-datastructure/51113870#51113870", "title": "Does golang have the plan for supporting set datastructure?", "body": "<p>I don't know about such plans.</p>\n\n<p>What you may do to ease the initialization:</p>\n\n<p><strong>Use a one-letter <code>bool</code> constant:</strong></p>\n\n<pre><code>const t = true\ncountrySet := map[string]bool{\"US\": t, \"JP\": t, \"KR\": t}\n</code></pre>\n\n<p><strong>Use a loop to add the keys, so you only need to list the keys:</strong></p>\n\n<pre><code>countrySet := map[string]bool{}\nfor _, v := range []string{\"US\", \"JP\", \"KR\"} {\n    countrySet[v] = true\n}\n</code></pre>\n\n<p>This is only profitable if you have more elements.</p>\n\n<p><strong>But you can always create a helper function:</strong></p>\n\n<pre><code>func createSet(es ...string) map[string]bool {\n    m := map[string]bool{}\n    for _, v := range es {\n        m[v] = true\n    }\n    return m\n}\n</code></pre>\n\n<p>And then using it:</p>\n\n<pre><code>countrySet := createSet(\"US\", \"JP\", \"KR\")\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 303, "user_id": 2806281, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/L34mH.jpg?s=128&g=1", "display_name": "cnby", "link": "https://stackoverflow.com/users/2806281/cnby"}, "edited": false, "score": 0, "creation_date": 1530607582, "post_id": 51114884, "comment_id": 89284028, "body": "Thank you for your answer @peterSO. I&#39;m using a wrapper like this."}, {"owner": {"reputation": 795, "user_id": 4297035, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/my4fZ.jpg?s=128&g=1", "display_name": "Soroush", "link": "https://stackoverflow.com/users/4297035/soroush"}, "edited": false, "score": 0, "creation_date": 1603706079, "post_id": 51114884, "comment_id": 114110466, "body": "<a href=\"https://github.com/soroushj/menge\" rel=\"nofollow noreferrer\"><code>github.com&#47;soroushj&#47;menge</code></a> is another one."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 5, "last_activity_date": 1530361225, "creation_date": 1530361225, "answer_id": 51114884, "question_id": 51113528, "link": "https://stackoverflow.com/questions/51113528/does-golang-have-the-plan-for-supporting-set-datastructure/51114884#51114884", "title": "Does golang have the plan for supporting set datastructure?", "body": "<p>The plan is not to support everything in the Go standard library. The plan is to encourage open source, independently developed packages. For example, one of many,</p>\n\n<blockquote>\n  <p><a href=\"https://godoc.org/k8s.io/apimachinery/pkg/util/sets\" rel=\"noreferrer\">package sets</a></p>\n  \n  <p><code>import \"k8s.io/apimachinery/pkg/util/sets\"</code></p>\n  \n  <p>Package sets has auto-generated set types.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1618062730, "creation_date": 1618062730, "answer_id": 67035137, "question_id": 51113528, "link": "https://stackoverflow.com/questions/51113528/does-golang-have-the-plan-for-supporting-set-datastructure/67035137#67035137", "title": "Does golang have the plan for supporting set datastructure?", "body": "<p>I think the <code>map[string]bool</code> is a good option. Another option is\n<code>map[string]struct{}</code>:</p>\n<pre><code>package main\nimport &quot;fmt&quot;\n\nfunc main() {\n   s := map[string]struct{}{\n      &quot;JP&quot;: {}, &quot;KR&quot;: {}, &quot;US&quot;: {},\n   }\n   s[&quot;UA&quot;] = struct{}{}\n   if _, ok := s[&quot;UA&quot;]; ok {\n      println(&quot;ok&quot;)\n   }\n   fmt.Println(s)\n}\n</code></pre>\n<p>Its marginally better than <code>bool</code>, as the values take up zero bytes versus one\nbyte, but its a little more awkward to work with. Another option is\n<code>fstest.MapFS</code>:</p>\n<pre><code>package main\n\nimport (\n   &quot;fmt&quot;\n   &quot;testing/fstest&quot;\n)\n\nfunc main() {\n   s := fstest.MapFS{&quot;JP&quot;: nil, &quot;KR&quot;: nil, &quot;US&quot;: nil}\n   s[&quot;UA&quot;] = nil\n   if _, ok := s[&quot;UA&quot;]; ok {\n      println(&quot;ok&quot;)\n   }\n   a, e := s.Glob(&quot;U*&quot;)\n   if e != nil {\n      panic(e)\n   }\n   fmt.Println(a) // [UA US]\n}\n</code></pre>\n<p>This is neat because you can do pattern matching on the Set items.</p>\n<p><a href=\"https://golang.org/pkg/testing/fstest\" rel=\"nofollow noreferrer\">https://golang.org/pkg/testing/fstest</a></p>\n"}], "owner": {"reputation": 303, "user_id": 2806281, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/L34mH.jpg?s=128&g=1", "display_name": "cnby", "link": "https://stackoverflow.com/users/2806281/cnby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2618, "favorite_count": 2, "accepted_answer_id": 51113870, "answer_count": 3, "score": 2, "last_activity_date": 1618062730, "creation_date": 1530350216, "last_edit_date": 1530353717, "question_id": 51113528, "link": "https://stackoverflow.com/questions/51113528/does-golang-have-the-plan-for-supporting-set-datastructure", "title": "Does golang have the plan for supporting set datastructure?", "body": "<p>This feature can be implemented with 'map'. </p>\n\n<pre><code>countrySet := map[string]bool{\n  \"US\": true,\n  \"JP\": true, \n  \"KR\": true,\n}\n</code></pre>\n\n<p>But to ease the eyes of readers, 'set' is a necessary data structure.</p>\n\n<pre><code>countrySet := set[string]{\"US\", \"JP\", \"KR\"}\n</code></pre>\n\n<p>Or init 'map' with keys only. For example:</p>\n\n<pre><code>countrySet := map[string]bool{\"US\", \"JP\", \"KR\"}\n</code></pre>\n\n<p>Does golang have the plan for supporting syntax like this?</p>\n"}, {"tags": ["for-loop", "go", "panic"], "answers": [{"comments": [{"owner": {"reputation": 806, "user_id": 7172003, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/10211461727358276/picture?type=large", "display_name": "Ahsan Naseem", "link": "https://stackoverflow.com/users/7172003/ahsan-naseem"}, "edited": false, "score": 0, "creation_date": 1530349048, "post_id": 51113348, "comment_id": 89213221, "body": "thanks @icza for your answer and explanation, your logic and solution help me such cases create separate function for panic and recovery.  Again thanks!"}, {"owner": {"reputation": 2764, "user_id": 5326634, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/agDBB.jpg?s=128&g=1", "display_name": "Siyaram Malav", "link": "https://stackoverflow.com/users/5326634/siyaram-malav"}, "edited": false, "score": 0, "creation_date": 1590922136, "post_id": 51113348, "comment_id": 109858548, "body": "@icza, I could not understand the logic behind it. Please can you explain , why it&#39;s happening by shifting recovery calls near to panic or something like this. ?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1530348658, "creation_date": 1530348658, "answer_id": 51113348, "question_id": 51113193, "link": "https://stackoverflow.com/questions/51113193/recover-and-continue-for-loop-if-panic-occur-golang/51113348#51113348", "title": "Recover and continue for loop if panic occur Golang", "body": "<p>You can do that if the body of the loop is executed as a function, either anonymous or a named one, and in that function you use a deferred function to recover.</p>\n\n<p>Here's how it looks like with anonymous functions:</p>\n\n<pre><code>func goFrom1To10() {\n    for i := 0; i &lt;= 10; i++ {\n        func() {\n            defer func() {\n                if r := recover(); r != nil {\n                    fmt.Println(\"panic occured: \", r)\n                }\n            }()\n\n            if i == 2 {\n                panic(\"got 2\")\n            }\n            fmt.Println(i)\n        }()\n    }\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/Ii77rO3VHlY\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>0\n1\npanic occured:  got 2\n3\n4\n5\n6\n7\n8\n9\n10\n</code></pre>\n\n<p>It's nicer and easier to understand if you move it to a named function:</p>\n\n<pre><code>func goFrom1To10() {\n    for i := 0; i &lt;= 10; i++ {\n        task(i)\n    }\n}\n\nfunc task(i int) {\n    defer func() {\n        if r := recover(); r != nil {\n            fmt.Println(\"panic occured: \", r)\n        }\n    }()\n\n    if i == 2 {\n        panic(\"got 2\")\n    }\n    fmt.Println(i)\n}\n</code></pre>\n\n<p>Output is the same. Try this one on the <a href=\"https://play.golang.org/p/NVOTA2z_XIs\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 806, "user_id": 7172003, "user_type": "registered", "accept_rate": 70, "profile_image": "https://graph.facebook.com/10211461727358276/picture?type=large", "display_name": "Ahsan Naseem", "link": "https://stackoverflow.com/users/7172003/ahsan-naseem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2775, "favorite_count": 1, "accepted_answer_id": 51113348, "answer_count": 1, "score": 3, "last_activity_date": 1530348658, "creation_date": 1530347433, "question_id": 51113193, "link": "https://stackoverflow.com/questions/51113193/recover-and-continue-for-loop-if-panic-occur-golang", "title": "Recover and continue for loop if panic occur Golang", "body": "<p>so my case is quite complex but for asking question in clean and clear context I am using simple for loop that initiate from 0 and goes upto 10. Now what I am trying to do is when <code>i becomes equal to 2</code> program will consider this as panic. It will go to recover state using defer and then after recovery loop will resume.</p>\n\n<p>So desired output should be something like that:</p>\n\n<pre><code>0\n1\npanic occured: got 2\n3\n4\n.\n.\n.\n.\n.\n10\n</code></pre>\n\n<p>Actual output I am getting</p>\n\n<pre><code>0\n1\npanic occured got:  got 2\n</code></pre>\n\n<p>Code block:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    goFrom1To10()\n}\n\nfunc goFrom1To10() {\n    defer recovery()\n    for i := 0; i &lt;= 10; i++ {\n\n        if i == 2 {\n            panic(\"got 2\")\n\n        }\n        fmt.Println(i)\n    }\n\n}\n\nfunc recovery() {\n    if r := recover(); r != nil {\n        fmt.Println(\"panic occured: \", r)\n    }\n\n}\n</code></pre>\n\n<p>Can this be achievable in go like when panic occur somehow we can recover and complete our loop?</p>\n"}, {"tags": ["json", "go", "protocol-buffers"], "answers": [{"tags": [], "owner": {"reputation": 966, "user_id": 2166750, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/b7a98a414302c4331caa45d56a522202?s=128&d=identicon&r=PG", "display_name": "Bert Verhees", "link": "https://stackoverflow.com/users/2166750/bert-verhees"}, "is_accepted": false, "score": 0, "last_activity_date": 1530394490, "last_edit_date": 1530394490, "creation_date": 1530360012, "answer_id": 51114712, "question_id": 51113048, "link": "https://stackoverflow.com/questions/51113048/store-and-retrieve-interfaces-in-golang/51114712#51114712", "title": "Store and retrieve interfaces in golang", "body": "<p>Intersting question, like Volkel says, undoable as you want it. But as you redesign then there are possibilities. Normally, try to avoid using reflection. It\u2019s not idiomatic, but it\u2019s very powerful in particular cases and it maybe just what you are  looking for, especially, often there are not many candidates for structs which are applicable, and you can keep inside your application the unmarshall method generic in its parameter, because the type-discovery procedure is inside the function, and not visible in the function call.</p>\n\n<p>So sometimes, you can solve it by using it inside the UnMarshall function.</p>\n\n<pre><code>if (f.Type() == reflect.TypeOf(Entity{})) {\n  //reflected type is of type \"Entity\", you can now Unmarshal\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 572, "user_id": 2445413, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2fdeb3092b84e3480d179ed27c1be4b5?s=128&d=identicon&r=PG", "display_name": "sourabh1024", "link": "https://stackoverflow.com/users/2445413/sourabh1024"}, "edited": false, "score": 0, "creation_date": 1530434075, "post_id": 51117748, "comment_id": 89228597, "body": "Can you point me to some document where I can read how to design common pipeline for different data structs where data needs to be stored. ?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 572, "user_id": 2445413, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2fdeb3092b84e3480d179ed27c1be4b5?s=128&d=identicon&r=PG", "display_name": "sourabh1024", "link": "https://stackoverflow.com/users/2445413/sourabh1024"}, "edited": false, "score": 0, "creation_date": 1530471960, "post_id": 51117748, "comment_id": 89237332, "body": "One solution is: Anything is serialised as a tuple (type, actual-encoding). Decoding  goes the other way around: Read the tuple and reconstruct the actual type based on the type. You&#39;ll find several answer on SO how to do this with Go and JSON. But of course this depends on you knowing all types involved (well, that is not specific to GO)."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 0, "last_activity_date": 1530385379, "creation_date": 1530385379, "answer_id": 51117748, "question_id": 51113048, "link": "https://stackoverflow.com/questions/51113048/store-and-retrieve-interfaces-in-golang/51117748#51117748", "title": "Store and retrieve interfaces in golang", "body": "<blockquote>\n  <p>However the problem is how to unmarshal it back in some generic way which is not tied to my Data struct.</p>\n</blockquote>\n\n<p>Yes, this is undoable. Redesign.</p>\n"}, {"comments": [{"owner": {"reputation": 572, "user_id": 2445413, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2fdeb3092b84e3480d179ed27c1be4b5?s=128&d=identicon&r=PG", "display_name": "sourabh1024", "link": "https://stackoverflow.com/users/2445413/sourabh1024"}, "edited": false, "score": 0, "creation_date": 1530460749, "post_id": 51123422, "comment_id": 89234625, "body": "I considered this , but the problem is I need to change unmarshal method everytime I add or remove a data struct. Also in this the common struct X should know all the data structs possible. I want to decouple the logic"}], "tags": [], "owner": {"reputation": 8230, "user_id": 2876830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/23e4baefc1b032e53e723ce13f34f9c3?s=128&d=identicon&r=PG&f=1", "display_name": "YaFred", "link": "https://stackoverflow.com/users/2876830/yafred"}, "is_accepted": false, "score": 0, "last_activity_date": 1530449106, "creation_date": 1530449106, "answer_id": 51123422, "question_id": 51113048, "link": "https://stackoverflow.com/questions/51113048/store-and-retrieve-interfaces-in-golang/51123422#51123422", "title": "Store and retrieve interfaces in golang", "body": "<p>It is easier if you think only of the data ...</p>\n\n<p>Your X should not be an interface but a struct so that you can marshall it.</p>\n\n<p>To make the process generic, you can consider X holds a choice</p>\n\n<pre><code>type A struct {\n    A int64\n}\n\ntype B struct {\n    S string\n}\n\ntype Choice int\n\nconst (\n    XisA Choice = iota\n    XisB\n)\n\ntype X struct {\n    Choice\n    A\n    B\n}\n</code></pre>\n\n<p>Before marshalling, you just need to set the choice for each item of your array</p>\n\n<pre><code>a := A{\n    A: 1,\n}\n\nb := B{\n    S: \"2\",\n}\n\nx1 := X{\n    Choice: XisA,\n    A:      a,\n}\nx2 := X{\n    Choice: XisB,\n    B:      b,\n}\nx := [2]X{x1, x2}\n</code></pre>\n\n<p>After unmarshalling, you just need to retrieve the choice you made for each item of the array</p>\n\n<pre><code>for _, item := range decoded {\n    switch {\n    case item.Choice == XisA:\n        println(item.A.GetKey())\n    case item.Choice == XisB:\n        println(item.B.GetKey())\n    }\n}\n</code></pre>\n\n<p>Here is an example: <a href=\"https://play.golang.org/p/RtzF6DmNlKL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/RtzF6DmNlKL</a></p>\n"}], "owner": {"reputation": 572, "user_id": 2445413, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2fdeb3092b84e3480d179ed27c1be4b5?s=128&d=identicon&r=PG", "display_name": "sourabh1024", "link": "https://stackoverflow.com/users/2445413/sourabh1024"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 466, "favorite_count": 0, "answer_count": 3, "score": -1, "last_activity_date": 1530478409, "creation_date": 1530346193, "last_edit_date": 1530478409, "question_id": 51113048, "link": "https://stackoverflow.com/questions/51113048/store-and-retrieve-interfaces-in-golang", "title": "Store and retrieve interfaces in golang", "body": "<p>How can we store array of different structs into some file and retrieve it back in the same format without losing its properties(methods it provides).</p>\n\n<p>For example: I have data <code>struct A</code> and <code>struct B</code>, both implementing a common <code>interface X {}</code> with some methods. </p>\n\n<p>One options is to write both save and retrieve method to accept the interface X slice. </p>\n\n<p>However the problem is how to unmarshal it back in some generic way which is not tied to my Data struct. i.e., every time I add a new data struct I need not to change my save or retrieve functions to retrieve back the slice of interface X so that its methods can be used independent of data struct.</p>\n\n<p>Example where Unmarshaling throws error :</p>\n\n<p><a href=\"https://play.golang.org/p/nfk3VvdBOK1\" rel=\"nofollow noreferrer\">Go PlayGround Link with a small Example</a></p>\n"}, {"tags": ["go", "cryptography", "ethereum", "ecdsa", "go-ethereum"], "comments": [{"owner": {"reputation": 79299, "user_id": 589259, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/vJbKg.jpg?s=128&g=1", "display_name": "Maarten Bodewes", "link": "https://stackoverflow.com/users/589259/maarten-bodewes"}, "edited": false, "score": 0, "creation_date": 1530436921, "post_id": 51111605, "comment_id": 89229199, "body": "This could be a good question <i>if</i> more code and input / output is provided (preferably in hex)."}], "answers": [{"tags": [], "owner": {"reputation": 17856, "user_id": 1439168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd72ad672b055a7d59cfb1c30d1c724f?s=128&d=identicon&r=PG", "display_name": "Miguel Mota", "link": "https://stackoverflow.com/users/1439168/miguel-mota"}, "is_accepted": false, "score": 3, "last_activity_date": 1546050316, "last_edit_date": 1546050316, "creation_date": 1530529876, "answer_id": 51134839, "question_id": 51111605, "link": "https://stackoverflow.com/questions/51111605/how-do-i-recover-ecdsa-public-key-correctly-from-hashed-message-and-signature-in/51134839#51134839", "title": "How do I recover ECDSA public key correctly from hashed message and signature in R || S || V format?", "body": "<p>Here's a complete working example of how to generate and verify signatures using go-ethereum.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"crypto/ecdsa\"\n    \"fmt\"\n    \"log\"\n\n    \"github.com/ethereum/go-ethereum/common/hexutil\"\n    \"github.com/ethereum/go-ethereum/crypto\"\n)\n\nfunc main() {\n    privateKey, err := crypto.HexToECDSA(\"fad9c8855b740a0b7ed4c221dbad0f33a83a49cad6b3fe8d5817ac83d38b6a19\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    publicKey := privateKey.PublicKey\n\n    publicKeyBytes := crypto.FromECDSAPub(&amp;publicKey)\n\n    data := []byte(\"hello\")\n    hash := crypto.Keccak256Hash(data)\n    fmt.Println(hash.Hex()) // 0x1c8aff950685c2ed4bc3174f3472287b56d9517b9c948127319a09a7a36deac8\n\n    signature, err := crypto.Sign(hash.Bytes(), privateKey)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(hexutil.Encode(signature)) // 0x789a80053e4927d0a898db8e065e948f5cf086e32f9ccaa54c1908e22ac430c62621578113ddbb62d509bf6049b8fb544ab06d36f916685a2eb8e57ffadde02301\n\n    sigPublicKey, err := crypto.Ecrecover(hash.Bytes(), signature)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    matches := bytes.Equal(sigPublicKey, publicKeyBytes)\n    fmt.Println(matches) // true\n\n    sigPublicKeyECDSA, err := crypto.SigToPub(hash.Bytes(), signature)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    sigPublicKeyBytes := crypto.FromECDSAPub(sigPublicKeyECDSA)\n    matches = bytes.Equal(sigPublicKeyBytes, publicKeyBytes)\n    fmt.Println(matches) // true\n\n    signatureNoRecoverID := signature[:len(signature)-1] // remove recovery id\n    verified := crypto.VerifySignature(publicKeyBytes, hash.Bytes(), signatureNoRecoverID)\n    fmt.Println(verified) // true\n}\n</code></pre>\n\n<p>Check out the <a href=\"https://github.com/miguelmota/ethereum-development-with-go-book\" rel=\"nofollow noreferrer\">Ethereum Development with Go</a> guide book for more examples on using go-ethereum.</p>\n"}], "owner": {"reputation": 41, "user_id": 1901320, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83165815092d9eaf6d308a143740eac9?s=128&d=identicon&r=PG&f=1", "display_name": "Samikshan Bairagya", "link": "https://stackoverflow.com/users/1901320/samikshan-bairagya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1487, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1546050316, "creation_date": 1530331213, "question_id": 51111605, "link": "https://stackoverflow.com/questions/51111605/how-do-i-recover-ecdsa-public-key-correctly-from-hashed-message-and-signature-in", "title": "How do I recover ECDSA public key correctly from hashed message and signature in R || S || V format?", "body": "<p>I have used the following code to generate an ecdsa key-pair(<code>privKey</code> and <code>pubKey</code>), encode them and then decode them back: <a href=\"https://stackoverflow.com/a/41315404/1901320\">https://stackoverflow.com/a/41315404/1901320</a>.</p>\n\n<p>Next I create a hash for a message (<code>txnData.Payload()</code> is of type <code>[]byte</code>) using <code>crypto.Keccak256()</code> and sign it using <code>crypto.Sign()</code> from Ethereum's crypto package (<code>github.com/ethereum/go-ethereum/crypto</code>). This creates a 65 bit ECDSA signature in R || S || V format.</p>\n\n<pre><code>    hashData := crypto.Keccak256(txnData.Payload)\n    sig, _ := crypto.Sign(hashData, privKey)\n\n    pkey, _ := crypto.Ecrecover(hashData, sig) // This and pubKey do not match\n</code></pre>\n\n<p>When I try to get back the public key from the <code>hashData</code> and the ECDSA signature using <code>crypto.Ecrecover()</code> and compare it with the public key <code>pubKey</code> corresponding to the <code>privKey</code> used to  create the signature, I find that the public keys do not match. This doesn't seem like something that should happen. Any idea as to where I am going wrong with this?</p>\n"}, {"tags": ["mysql", "go", "amazon-rds"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1530342809, "post_id": 51111364, "comment_id": 89211952, "body": "In general one would set the ServerName of the <a href=\"https://golang.org/pkg/crypto/tls/#Config\" rel=\"nofollow noreferrer\">tls.Config</a> to the canonical name."}], "owner": {"reputation": 95, "user_id": 4493778, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/dfa3b4a76a24983501a69172500bc560?s=128&d=identicon&r=PG&f=1", "display_name": "needmorehalp", "link": "https://stackoverflow.com/users/4493778/needmorehalp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 215, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1530331654, "creation_date": 1530327720, "last_edit_date": 1530331654, "question_id": 51111364, "link": "https://stackoverflow.com/questions/51111364/golang-mysql-driver-with-aws-rds-ca-cert-not-valid-with-cname", "title": "Golang MySQL driver with AWS RDS ca cert not valid with CNAME", "body": "<p>I'm attempting to connect my golang application with <code>AWS RDS</code> via a SSL connection using the MySQL driver. Everything seems to be working correctly but because the hostname address I'm using is a <code>Route53 CNAME</code> record, the CA root cert (provided by AWS) doesn't seem to be valid.</p>\n\n<p>The exact error I get is:</p>\n\n<blockquote>\n  <p>x509: certificate is valid for\n  <strong><em>.cluster-</em></strong>.us-east-1.rds.amazonaws.com, <strong><em>.cluster-ro-</em></strong>.us-east-1.rds.amazonaws.com, <strong><em>.</em></strong>.us-east-1.rds.amazonaws.com, not {CNAME HERE}</p>\n</blockquote>\n\n<p>I know this works if I <em>don't</em> use the CNAME in the DSN... but I'm wondering if there is? This is simply the benefit of keeping the addresses clean and memorable.</p>\n"}, {"tags": ["go", "cursor", "odbc", "ignite"], "comments": [{"owner": {"reputation": 418, "user_id": 5980388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5d1dc54a2cc65111e7b1be94a7565b6?s=128&d=identicon&r=PG&f=1", "display_name": "isapego", "link": "https://stackoverflow.com/users/5980388/isapego"}, "edited": false, "score": 1, "creation_date": 1530516498, "post_id": 51110661, "comment_id": 89246699, "body": "What is Ignite version you are on?"}, {"owner": {"reputation": 17, "user_id": 8034689, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LBqDA.png?s=128&g=1", "display_name": "Ti Zhang", "link": "https://stackoverflow.com/users/8034689/ti-zhang"}, "reply_to_user": {"reputation": 418, "user_id": 5980388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5d1dc54a2cc65111e7b1be94a7565b6?s=128&d=identicon&r=PG&f=1", "display_name": "isapego", "link": "https://stackoverflow.com/users/5980388/isapego"}, "edited": false, "score": 0, "creation_date": 1530639854, "post_id": 51110661, "comment_id": 89303975, "body": "@isapego was on 2.5.0 and as of today I installed 2.6.0 but still getting the same issue"}, {"owner": {"reputation": 17, "user_id": 8034689, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LBqDA.png?s=128&g=1", "display_name": "Ti Zhang", "link": "https://stackoverflow.com/users/8034689/ti-zhang"}, "reply_to_user": {"reputation": 418, "user_id": 5980388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5d1dc54a2cc65111e7b1be94a7565b6?s=128&d=identicon&r=PG&f=1", "display_name": "isapego", "link": "https://stackoverflow.com/users/5980388/isapego"}, "edited": false, "score": 0, "creation_date": 1530640073, "post_id": 51110661, "comment_id": 89304069, "body": "just noticed that you have answered me in the Ignite Mailing list as well, thank you so much for your time"}], "owner": {"reputation": 17, "user_id": 8034689, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LBqDA.png?s=128&g=1", "display_name": "Ti Zhang", "link": "https://stackoverflow.com/users/8034689/ti-zhang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 220, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1561973707, "creation_date": 1530316752, "last_edit_date": 1561973707, "question_id": 51110661, "link": "https://stackoverflow.com/questions/51110661/is-it-possible-to-configure-apache-ignite-querycursor-to-be-autocloseable-in-the", "title": "Is it possible to configure Apache Ignite QueryCursor to be autocloseable in the xml configuration file?", "body": "<p>I am writing a program in Golang that connects to local Ignite clusters through an ODBC driver package written in Go. </p>\n\n<p>During development I began getting this error repeatedly: </p>\n\n<blockquote>\n  <p>Too many open cursors (either close other open cursors or increase the\n  limit through\n  ClientConnectorConfiguration.maxOpenCursorsPerConnection)\n  [maximum=128, current=128]</p>\n</blockquote>\n\n<p>After opening an issue with the golang odbc packgage I was using and providing a sample app, the author was kind enough to help me verify there was no issue in the golang code that would result in leaving cursors opened: <a href=\"https://github.com/alexbrainman/odbc/issues\" rel=\"nofollow noreferrer\">https://github.com/alexbrainman/odbc/issues</a> </p>\n\n<p>I have since attempted to configure the setting for QueryCursor to value <code>autoclose</code> in the xml file I use for Ignite Configuration on initiating a cluster. I have used this doc as reference: <a href=\"https://ignite.apache.org/releases/latest/javadoc/index.html\" rel=\"nofollow noreferrer\">https://ignite.apache.org/releases/latest/javadoc/index.html</a></p>\n\n<p>However after some attempts I am not sure whether my syntax is wrong, or this is simply not a configurable property through the xml configuration file, and that the only way to tell Ignite to close the cursor is in the code, after queries. </p>\n"}, {"tags": ["sorting", "go"], "answers": [{"tags": [], "owner": {"reputation": 510, "user_id": 929861, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/78b7fffa0b32c016b013c5edd1c945d9?s=128&d=identicon&r=PG&f=1", "display_name": "tonymke", "link": "https://stackoverflow.com/users/929861/tonymke"}, "is_accepted": false, "score": 0, "last_activity_date": 1530321971, "creation_date": 1530321971, "answer_id": 51111003, "question_id": 51110579, "link": "https://stackoverflow.com/questions/51110579/sorting-in-go-on-multiple-struct-fields/51111003#51111003", "title": "Sorting in Go on multiple struct fields", "body": "<p>Translate the arbitrary type values into something that <em>is</em> sortable in the way your requirements ask.</p>\n\n<pre><code>func ThingTypeSortable(thing *Thing) int {\n    if thing == nil {\n        return 0\n    }\n\n    if thing.isTypeA() {\n        return 1\n    }\n    if thing.isTypeB() {\n        return 2\n    }\n    if thing.isTypeC() {\n        return 3\n    }\n\n    return 0\n}\n</code></pre>\n\n<p>...then it's just another thing to sort by if the timestamps are equal.</p>\n\n<pre><code>sort.Slice(inputs, func(i, j int) bool {\n    if inputs[i].t.UTC() != inputs[j].t.UTC() {\n        return inputs[i].t.Before(inputs[j].t)\n    }\n\n    return ThingTypeSortable(inputs[i]) &lt; ThingTypeSortable(inputs[j])\n})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1530336176, "last_edit_date": 1530336176, "creation_date": 1530322985, "answer_id": 51111066, "question_id": 51110579, "link": "https://stackoverflow.com/questions/51110579/sorting-in-go-on-multiple-struct-fields/51111066#51111066", "title": "Sorting in Go on multiple struct fields", "body": "<p>Use <a href=\"https://godoc.org/sort#Slice\" rel=\"nofollow noreferrer\">sort.Slice</a> by comparing the fields in sort priority order. </p>\n\n<p>Given variable <code>a</code> of type <code>[]SomeType</code>, sort like this:</p>\n\n<pre><code>sort.Slice(a, func(i, j int) bool {\n    if !a[i].timeStamp.Equal(a[j].timeStamp) {\n        return a[i].timeStamp.Before(a[j].timeStamp)\n    }\n    if a[i].isTypeA() != a[j].isTypeA() {\n        return a[i].isTypeA()\n    }\n    if a[i].isTypeB() != a[j].isTypeB() {\n        return a[i].isTypeB()\n    }\n    return a[i].isTypeC()\n})\n</code></pre>\n\n<p>This code handles isTypeA(), isTypeB() and isTypeC() as separate fields, even though they are derived from the same underlying field. </p>\n\n<p>I assume you meant to use type <code>time.Time</code> for the <code>timeStamp</code> field. The function uses  <a href=\"https://godoc.org/time#Time.Equal\" rel=\"nofollow noreferrer\">Time.Equal</a> to correctly compare <code>time.Time</code> values for equality.</p>\n"}], "owner": {"reputation": 161, "user_id": 1534235, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fcdcd0928f9bc885822872ba8700010b?s=128&d=identicon&r=PG", "display_name": "user1534235", "link": "https://stackoverflow.com/users/1534235/user1534235"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 789, "favorite_count": 0, "closed_date": 1530385432, "answer_count": 2, "score": 0, "last_activity_date": 1530336176, "creation_date": 1530315858, "question_id": 51110579, "link": "https://stackoverflow.com/questions/51110579/sorting-in-go-on-multiple-struct-fields", "closed_reason": "Duplicate", "title": "Sorting in Go on multiple struct fields", "body": "<p>I have an array/slice of members:</p>\n\n<pre><code>type SomeType struct {\n    timeStamp time\n    typeName string\n    other variables...\n}\n</code></pre>\n\n<p>And there are 3 methods on this structure based on typeName, like:</p>\n\n<pre><code>isTypeA(): returns bool\nisTypeB(): returns bool\nisTypeC(): returns bool\n</code></pre>\n\n<p>Now this is how my sorting needs to work:\n - Sort based on timeStamp in ascending order\n - If the timeStamp is same, then typeA's should come before typeB's which should come before typeC's.\n(type A, B, C is not really alphabetical)</p>\n\n<p>I am using sort.Slice to sort on timeStamp, but I am not sure how to do the type A,B,C sorting.</p>\n"}, {"tags": ["json", "parsing", "go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1530340484, "post_id": 51110538, "comment_id": 89211527, "body": "you can unmarshal any nested json by creating nested struct. The only thing is dynamic value of <code>uniqueurl_1</code>, for that you can create interface{}."}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 4955427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c69fb0bd7d6dc11f93e017b55e909ff?s=128&d=identicon&r=PG&f=1", "display_name": "Igeneous", "link": "https://stackoverflow.com/users/4955427/igeneous"}, "edited": false, "score": 0, "creation_date": 1530347287, "post_id": 51110654, "comment_id": 89212850, "body": "so basically the &quot;create a legion of structs&quot; type of thing? Kinda not Golang related but would a different language say python be better at constructing this thing? (Json-&gt;Json (modified))"}, {"owner": {"reputation": 159, "user_id": 1183632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qs8EG.jpg?s=128&g=1", "display_name": "Danilo", "link": "https://stackoverflow.com/users/1183632/danilo"}, "reply_to_user": {"reputation": 45, "user_id": 4955427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c69fb0bd7d6dc11f93e017b55e909ff?s=128&d=identicon&r=PG&f=1", "display_name": "Igeneous", "link": "https://stackoverflow.com/users/4955427/igeneous"}, "edited": false, "score": 0, "creation_date": 1530348969, "post_id": 51110654, "comment_id": 89213207, "body": "Both solutions, Golang and Python, are long, at first look Go is more readable. Choose the one you prefer."}, {"owner": {"reputation": 45, "user_id": 4955427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c69fb0bd7d6dc11f93e017b55e909ff?s=128&d=identicon&r=PG&f=1", "display_name": "Igeneous", "link": "https://stackoverflow.com/users/4955427/igeneous"}, "edited": false, "score": 0, "creation_date": 1530552561, "post_id": 51110654, "comment_id": 89266215, "body": "Hi, it looks like this solution can deeply go into my structure, but the issue is each of my links are unique. Say I have another &quot;uniqueurl_2&quot; (not named 1, 2, 3... of course), then when I run the code I won&#39;t get uniqueurl_2. Does this mean I&#39;d have to make a separate struct to contain each and every &quot;uniqueurl_N&quot; field?"}, {"owner": {"reputation": 159, "user_id": 1183632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qs8EG.jpg?s=128&g=1", "display_name": "Danilo", "link": "https://stackoverflow.com/users/1183632/danilo"}, "reply_to_user": {"reputation": 45, "user_id": 4955427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c69fb0bd7d6dc11f93e017b55e909ff?s=128&d=identicon&r=PG&f=1", "display_name": "Igeneous", "link": "https://stackoverflow.com/users/4955427/igeneous"}, "edited": false, "score": 0, "creation_date": 1530552974, "post_id": 51110654, "comment_id": 89266406, "body": "Well, you can implement an array of links, replace the <code>Links</code> struct as follow: <code>type Links struct {     Uniqueurl1 []Uniqueurl1 </code>json:&quot;uniqueurl_1&quot;` }`"}, {"owner": {"reputation": 45, "user_id": 4955427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c69fb0bd7d6dc11f93e017b55e909ff?s=128&d=identicon&r=PG&f=1", "display_name": "Igeneous", "link": "https://stackoverflow.com/users/4955427/igeneous"}, "edited": false, "score": 0, "creation_date": 1530553618, "post_id": 51110654, "comment_id": 89266720, "body": "Won&#39;t I have an array of Uniqueurl1&#39;s though, and I want to have a Uniqueurl1, 2, 3, etc. The Links struct you provided contains an array of objects all of type Uniqueurl1 right?"}, {"owner": {"reputation": 159, "user_id": 1183632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qs8EG.jpg?s=128&g=1", "display_name": "Danilo", "link": "https://stackoverflow.com/users/1183632/danilo"}, "reply_to_user": {"reputation": 45, "user_id": 4955427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c69fb0bd7d6dc11f93e017b55e909ff?s=128&d=identicon&r=PG&f=1", "display_name": "Igeneous", "link": "https://stackoverflow.com/users/4955427/igeneous"}, "edited": false, "score": 0, "creation_date": 1530556019, "post_id": 51110654, "comment_id": 89267819, "body": "Yes, it is. If it&#39;s not so much trouble you can change <code>Uniqueurl1</code> in <code>Uniqueurl</code> and add an index field (where to put 1,2...N) to the struct other than A."}], "tags": [], "owner": {"reputation": 159, "user_id": 1183632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qs8EG.jpg?s=128&g=1", "display_name": "Danilo", "link": "https://stackoverflow.com/users/1183632/danilo"}, "is_accepted": true, "score": 1, "last_activity_date": 1530316661, "creation_date": 1530316661, "answer_id": 51110654, "question_id": 51110538, "link": "https://stackoverflow.com/questions/51110538/how-to-get-a-json-unique-fields-name-and-deeply-nested-child-fields-value-in-g/51110654#51110654", "title": "How to get a JSON unique field&#39;s name and deeply nested child field&#39;s value in Golang?", "body": "<p>in your JSON is missing opening brace.\nHave a try in this way:</p>\n\n<pre><code>{\n  \"links\": {\n    \"uniqueurl_1\": {\n      \"a\": {\n        \"b\": [\n          \"stuff\"\n        ],\n        \"I\": {\n          \"want\": {\n            \"to\": \"morestuff\",\n            \"go\": {\n              \"in\": {\n                \"here\": {\n                  \"and\": \"array\",\n                  \"itis\": {\n                    \"very\": \"string\",\n                    \"deep\": \"stringIwant\"\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n</code></pre>\n\n<p>And use the following code to access you data:</p>\n\n<pre><code>package main\n\nimport \"encoding/json\"\n\nfunc UnmarshalNotSoDeep(data []byte) (NotSoDeep, error) {\n    var r NotSoDeep\n    err := json.Unmarshal(data, &amp;r)\n    return r, err\n}\n\nfunc (r *NotSoDeep) Marshal() ([]byte, error) {\n    return json.Marshal(r)\n}\n\ntype NotSoDeep struct {\n    Links Links `json:\"links\"`\n}\n\ntype Links struct {\n    Uniqueurl1 Uniqueurl1 `json:\"uniqueurl_1\"`\n}\n\ntype Uniqueurl1 struct {\n    A A `json:\"a\"`\n}\n\ntype A struct {\n    B []string `json:\"b\"`\n    I I        `json:\"I\"`\n}\n\ntype I struct {\n    Want Want `json:\"want\"`\n}\n\ntype Want struct {\n    To string `json:\"to\"`\n    Go Go     `json:\"go\"`\n}\n\ntype Go struct {\n    In In `json:\"in\"`\n}\n\ntype In struct {\n    Here Here `json:\"here\"`\n}\n\ntype Here struct {\n    And  string `json:\"and\"` \n    Itis Itis   `json:\"itis\"`\n}\n\ntype Itis struct {\n    Very string `json:\"very\"`\n    Deep string `json:\"deep\"`\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 342, "user_id": 9955790, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "RimeBeliskner", "link": "https://stackoverflow.com/users/9955790/rimebeliskner"}, "is_accepted": false, "score": 2, "last_activity_date": 1530353007, "last_edit_date": 1592644375, "creation_date": 1530353007, "answer_id": 51113865, "question_id": 51110538, "link": "https://stackoverflow.com/questions/51110538/how-to-get-a-json-unique-fields-name-and-deeply-nested-child-fields-value-in-g/51113865#51113865", "title": "How to get a JSON unique field&#39;s name and deeply nested child field&#39;s value in Golang?", "body": "<p>For this case you can use <a href=\"https://github.com/thedevsaddam/gojsonq\" rel=\"nofollow noreferrer\">gojsonq - A simple Go package to Query over JSON Data</a> library.\nHere is <a href=\"https://github.com/thedevsaddam/gojsonq/wiki/Queries#selectproperties\" rel=\"nofollow noreferrer\">full list of available queries</a>.</p>\n<p>So if you want get the value (<code>stringIwant</code>), you can choose or method <a href=\"https://github.com/thedevsaddam/gojsonq/wiki/Queries#frompath\" rel=\"nofollow noreferrer\">From</a> or method <a href=\"https://github.com/thedevsaddam/gojsonq/wiki/Queries#findpath\" rel=\"nofollow noreferrer\">Find</a>.</p>\n<p>Example below:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n\n    &quot;github.com/thedevsaddam/gojsonq&quot;\n)\n\nconst json = `{\n  &quot;links&quot;: {\n    &quot;uniqueurl_1&quot;: {\n      &quot;a&quot;: {\n        &quot;b&quot;: [\n          &quot;stuff&quot;\n        ],\n        &quot;I&quot;: {\n          &quot;want&quot;: {\n            &quot;to&quot;: &quot;morestuff&quot;,\n            &quot;go&quot;: {\n              &quot;in&quot;: {\n                &quot;here&quot;: {\n                  &quot;and&quot;: &quot;array&quot;,\n                  &quot;itis&quot;: {\n                    &quot;very&quot;: &quot;string&quot;,\n                    &quot;deep&quot;: &quot;stringIwant&quot;\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}`\n\nfunc main() {\n    key := &quot;uniqueurl_1&quot;\n    query := &quot;links.&quot; + key + &quot;.a.I.want.go.in.here.itis.deep&quot;\n    fmt.Println(gojsonq.New().JSONString(json).From(query).Get())\n    fmt.Println(gojsonq.New().JSONString(json).Find(query).(string))\n}\n</code></pre>\n<p>Output:</p>\n<blockquote>\n<p>stringIwant</p>\n<p>stringIwant</p>\n</blockquote>\n"}], "owner": {"reputation": 45, "user_id": 4955427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c69fb0bd7d6dc11f93e017b55e909ff?s=128&d=identicon&r=PG&f=1", "display_name": "Igeneous", "link": "https://stackoverflow.com/users/4955427/igeneous"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 639, "favorite_count": 0, "accepted_answer_id": 51110654, "answer_count": 2, "score": 1, "last_activity_date": 1530353007, "creation_date": 1530315428, "last_edit_date": 1530341294, "question_id": 51110538, "link": "https://stackoverflow.com/questions/51110538/how-to-get-a-json-unique-fields-name-and-deeply-nested-child-fields-value-in-g", "title": "How to get a JSON unique field&#39;s name and deeply nested child field&#39;s value in Golang?", "body": "<p>I have a json file that looks like this </p>\n\n<pre><code>{\n  \"links\": {\n    \"uniqueurl_1\": {\n      \"a\": {\n        \"b\": [\n          \"stuff\"\n        ],\n        \"I\": {\n          \"want\": {\n            \"to\": \"morestuff\",\n            \"go\": {\n              \"in\": {\n                \"here\": {\n                  \"and\": \"array\",\n                  \"itis\": {\n                    \"very\": \"string\",\n                    \"deep\": \"stringIwant\"\n                  }\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n}\n</code></pre>\n\n<p>And I want to get the <code>uniqueurl_1</code> (that is always different for each link), and I also want to get the \"deep\" field's value (\"stringIwant\")</p>\n\n<p>I know if it's not too deeply nested, you can just create a bunch of structs in Golang, but when it's this deep would it still be the only/best way to do it?</p>\n"}, {"tags": ["go", "mux"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1530311703, "post_id": 51110146, "comment_id": 89207354, "body": "Packages are looked up in GOROOT first, because that&#39;s where the stdlib lives. <code>go list</code> doesn&#39;t work at the root of <code>GOPATH</code> because the go tool works on packages. Does the directory <code>&#47;Users&#47;myname&#47;go&#47;src&#47;github.com&#47;gorrila&#47;mux</code> actually exist, and does it contain <code>.go</code> files?"}, {"owner": {"reputation": 77, "user_id": 5230627, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/abdee2a47545a6d7e88fa185f15cd0e0?s=128&d=identicon&r=PG&f=1", "display_name": "user9503053", "link": "https://stackoverflow.com/users/5230627/user9503053"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1530311957, "post_id": 51110146, "comment_id": 89207418, "body": "@JimB Looking in my directory in the terminal I see that <code>&#47;Users&#47;myname&#47;go&#47;src&#47;github.com&#47;gorrila&#47;mux</code> does exist and it contains files like mux.go, mux_test.go, route.go, etc"}], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 5230627, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/abdee2a47545a6d7e88fa185f15cd0e0?s=128&d=identicon&r=PG&f=1", "display_name": "user9503053", "link": "https://stackoverflow.com/users/5230627/user9503053"}, "edited": false, "score": 0, "creation_date": 1530332021, "post_id": 51110536, "comment_id": 89210227, "body": "Hi, I set that exactly within my <code>.bash_profile</code> and am receiving the identical error as listed above."}], "tags": [], "owner": {"reputation": 159, "user_id": 1183632, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qs8EG.jpg?s=128&g=1", "display_name": "Danilo", "link": "https://stackoverflow.com/users/1183632/danilo"}, "is_accepted": false, "score": 0, "last_activity_date": 1530315383, "creation_date": 1530315383, "answer_id": 51110536, "question_id": 51110146, "link": "https://stackoverflow.com/questions/51110146/cannot-find-package-github-com-gorrila-mux-in-any-of/51110536#51110536", "title": "cannot find package &quot;github.com/gorrila/mux&quot; in any of", "body": "<p>Can you try to set your <code>.bash_profile</code> in this way:</p>\n\n<pre><code>export GOPATH=$HOME/go\nexport GOBIN=$GOPATH/bin\nexport PATH=$PATH:$GOBIN\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 77, "user_id": 5230627, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/abdee2a47545a6d7e88fa185f15cd0e0?s=128&d=identicon&r=PG&f=1", "display_name": "user9503053", "link": "https://stackoverflow.com/users/5230627/user9503053"}, "edited": false, "score": 0, "creation_date": 1530399542, "post_id": 51116665, "comment_id": 89224179, "body": "Got it, I did misspell the toolkit in my file. Thank you."}], "tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": true, "score": 1, "last_activity_date": 1530376380, "creation_date": 1530376380, "answer_id": 51116665, "question_id": 51110146, "link": "https://stackoverflow.com/questions/51110146/cannot-find-package-github-com-gorrila-mux-in-any-of/51116665#51116665", "title": "cannot find package &quot;github.com/gorrila/mux&quot; in any of", "body": "<p>It looks like you misspelled <code>\"github.com/gorilla/mux\"</code> \u2013 it has one \"r\" and two \"l\"'s.  (Carefully compare the <code>go get</code> command you quoted and the <code>import</code> statement in your source file.)</p>\n"}], "owner": {"reputation": 77, "user_id": 5230627, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/abdee2a47545a6d7e88fa185f15cd0e0?s=128&d=identicon&r=PG&f=1", "display_name": "user9503053", "link": "https://stackoverflow.com/users/5230627/user9503053"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2177, "favorite_count": 0, "accepted_answer_id": 51116665, "answer_count": 2, "score": -2, "last_activity_date": 1530376380, "creation_date": 1530311478, "question_id": 51110146, "link": "https://stackoverflow.com/questions/51110146/cannot-find-package-github-com-gorrila-mux-in-any-of", "title": "cannot find package &quot;github.com/gorrila/mux&quot; in any of", "body": "<p>The error message is:</p>\n\n<pre><code>app.go:9:3: cannot find package \"github.com/gorrila/mux\" in any of:\n    /usr/local/Cellar/go/1.10.3/libexec/src/github.com/gorrila/mux (from \n$GOROOT)\n    /Users/myname/go/src/github.com/gorrila/mux (from $GOPATH)\n</code></pre>\n\n<p>I understand GOROOT is for compiler tools that come with installation, so I am not sure why it looks for mux there. But I do see mux in the second location in my directory I created for go code.</p>\n\n<p>I know this question was asked <a href=\"https://stackoverflow.com/questions/41539909/cannot-find-package-github-com-gorilla-mux-in-any-of/41540554\">once before</a> and I tried to debug following the advice from that question.</p>\n\n<p>I used homebrew and installed go version <code>go1.10.3 darwin/amd64</code>.</p>\n\n<p>Here is what I believe to be the relevant portion of my go env:</p>\n\n<pre><code>GOPATH=\"/Users/myname/go\"\nGORACE=\"\"\nGOROOT=\"/usr/local/Cellar/go/1.10.3/libexec\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/usr/local/Cellar/go/1.10.3/libexec/pkg/tool/darwin_amd64\"\n</code></pre>\n\n<p>I also set my bash profile, excluding GOROOT because <a href=\"https://dave.cheney.net/2013/06/14/you-dont-need-to-set-goroot-really\" rel=\"nofollow noreferrer\">that is no longer required</a>:</p>\n\n<pre><code>export GOPATH=\"/Users/myname/go/src/github.com\"\nexport PATH=\"/Users/myname/go/src/github.com/bin:$PATH\"\n</code></pre>\n\n<p>And did <code>source ~/.bash_profile</code>.</p>\n\n<p>This setup was enough that I can run basic go programs like hello world. So I then tried to run code using the <code>mux</code> library. </p>\n\n<p>I first installed mux within the directory of my program (cd'd into <code>/Users/myname/go/src/github.com/myname/restapi</code>).</p>\n\n<p>Then I ran:</p>\n\n<pre><code>go get -u github.com/gorilla/mux\n</code></pre>\n\n<p>I can see the folder exists in my finder. I also looked in terminal:</p>\n\n<pre><code>ls -l /Users/myname/go/src/github.com | grep gorilla\n=&gt; drwxr-xr-x  3 myname  staff  102 Jun 29 14:35 gorilla\n</code></pre>\n\n<p>Then:</p>\n\n<pre><code>cd $GOPATH (/Users/myname/go)\ngo list ... | grep gorilla \n=&gt; can't load package: package ../..: no Go files in /Users\n</code></pre>\n\n<p>So I saw gorilla in the first command but not the second. However, I do see the gorilla directory further within my go directory, so I'm not sure what the issue is.</p>\n\n<p>Running <code>go build</code> returns the package of concern:</p>\n\n<pre><code>app.go:9:3: cannot find package \"github.com/gorrila/mux\" in any of:\n      /usr/local/Cellar/go/1.10.3/libexec/src/github.com/gorrila/mux \n(from $GOROOT)\n  /Users/myname/go/src/github.com/gorrila/mux (from $GOPATH)\n</code></pre>\n\n<p>I am not sure why it is looking for mux within the usr directory. Is there an issue with any of my paths? I keep checking that last path to see that the mux directory is there.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1530477730, "last_edit_date": 1530477730, "creation_date": 1530310807, "answer_id": 51110073, "question_id": 51109957, "link": "https://stackoverflow.com/questions/51109957/wrapping-one-of-many-methods-on-a-type-struct/51110073#51110073", "title": "Wrapping one of many methods on a type struct?", "body": "<p>You don't need to proxy the method calls to delegate them, this is exactly what <a href=\"https://golang.org/doc/effective_go.html#embedding\" rel=\"nofollow noreferrer\">embedding</a> is for.</p>\n\n<pre><code>type Foo struct {\n}\n\nfunc (f *Foo) method1() int { return 1 }\nfunc (f *Foo) method2() int { return 2 }\nfunc (f *Foo) method3() int { return 3 }\n\ntype Foo2 struct {\n    *Foo\n}\n\nfunc (f Foo2) method1() int {\n    fmt.Println(\"WRAPPED\")\n    return f.Foo.method1()\n}\n</code></pre>\n\n<p><code>Foo2</code> has the same method set as <code>Foo</code>, but <code>method1</code> is \"intercepted\" by <code>Foo2</code>, which explicitly calls <code>Foo.method1</code> internally.</p>\n\n<p><a href=\"https://play.golang.org/p/q8tea5ZuHl4\" rel=\"nofollow noreferrer\">https://play.golang.org/p/q8tea5ZuHl4</a></p>\n"}], "owner": {"reputation": 40063, "user_id": 446554, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/gmL3R.jpg?s=128&g=1", "display_name": "Cory Klein", "link": "https://stackoverflow.com/users/446554/cory-klein"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 51110073, "answer_count": 1, "score": 2, "last_activity_date": 1530477730, "creation_date": 1530309893, "question_id": 51109957, "link": "https://stackoverflow.com/questions/51109957/wrapping-one-of-many-methods-on-a-type-struct", "title": "Wrapping one of many methods on a type struct?", "body": "<p>A library I use has a type with multiple methods:</p>\n\n<pre><code>type Foo struct {\n}\n\nfunc (f *Foo) method1() int { ... }\nfunc (f *Foo) method2() int { ... }\nfunc (f *Foo) method3() int { ... }\n// ... and so on\n</code></pre>\n\n<p>I'd really like to apply some specific behavior anytime I call <code>method1</code> on this type:</p>\n\n<pre><code>func (f *Foo) method1Wrapper() int {\n    incrementCounter()\n    return f.method1()\n}\n</code></pre>\n\n<p>But this adds a <em>new</em> method I'd have to call <em>instead</em> of just directly calling <code>method1()</code> itself.</p>\n\n<p>Alternatively, I imagine I could create my own type:</p>\n\n<pre><code>type Foo2 struct {\n    Foo\n}\n\nfunc (f *Foo2) method1() int {\n    incrementCounter()\n    return f.Foo.method1()\n}\n</code></pre>\n\n<p>But then I'd have to create a bunch of boilerplate code to proxy all the calls to <code>method2</code>, <code>method3</code>, etc down to the <code>Foo</code> implementation, <em>and</em> I'd have to change all my usages of <code>Foo</code> to <code>Foo2</code>. \ud83d\ude29</p>\n\n<p>Is it possible to directly patch or wrap <code>Foo.method1()</code> itself <em>without</em> creating a subclass?</p>\n"}, {"tags": ["go", "nats.io"], "answers": [{"comments": [{"owner": {"reputation": 1630, "user_id": 714143, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbccc8facbd1a98a5f6c7eb569897f0f?s=128&d=identicon&r=PG", "display_name": "TedMeftah", "link": "https://stackoverflow.com/users/714143/tedmeftah"}, "edited": false, "score": 0, "creation_date": 1530397901, "post_id": 51118833, "comment_id": 89223890, "body": "I\u2019m trying to stop the work on the request from proceeding if no one is going to use it, to my understanding the transmission of the reply does not matter if no one is listening right?"}, {"owner": {"reputation": 101, "user_id": 276354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea379ae84d8493303e3fb77d2017d724?s=128&d=identicon&r=PG", "display_name": "derek", "link": "https://stackoverflow.com/users/276354/derek"}, "reply_to_user": {"reputation": 1630, "user_id": 714143, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbccc8facbd1a98a5f6c7eb569897f0f?s=128&d=identicon&r=PG", "display_name": "TedMeftah", "link": "https://stackoverflow.com/users/714143/tedmeftah"}, "edited": false, "score": 1, "creation_date": 1530411518, "post_id": 51118833, "comment_id": 89225429, "body": "ok so the response is intensive and takes multiple seconds to produce? If so then yes you can send a separate message that kills it. Most architectures let the responder continue and throw away the result.."}, {"owner": {"reputation": 1630, "user_id": 714143, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbccc8facbd1a98a5f6c7eb569897f0f?s=128&d=identicon&r=PG", "display_name": "TedMeftah", "link": "https://stackoverflow.com/users/714143/tedmeftah"}, "edited": false, "score": 0, "creation_date": 1530454504, "post_id": 51118833, "comment_id": 89233214, "body": "thanks a lot for the clarification Derek, can you move that comment to the answer so I can accept it"}], "tags": [], "owner": {"reputation": 101, "user_id": 276354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea379ae84d8493303e3fb77d2017d724?s=128&d=identicon&r=PG", "display_name": "derek", "link": "https://stackoverflow.com/users/276354/derek"}, "is_accepted": false, "score": 0, "last_activity_date": 1530395809, "creation_date": 1530395809, "answer_id": 51118833, "question_id": 51109574, "link": "https://stackoverflow.com/questions/51109574/how-to-check-if-a-nats-request-was-cancelled/51118833#51118833", "title": "How to check if a NATS request was cancelled", "body": "<p>What are you trying to save from cancelling the request? The work on the request or the transmission of a reply that you know will not be used?</p>\n"}, {"tags": [], "owner": {"reputation": 101, "user_id": 276354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea379ae84d8493303e3fb77d2017d724?s=128&d=identicon&r=PG", "display_name": "derek", "link": "https://stackoverflow.com/users/276354/derek"}, "is_accepted": true, "score": 1, "last_activity_date": 1530476497, "creation_date": 1530476497, "answer_id": 51126740, "question_id": 51109574, "link": "https://stackoverflow.com/questions/51109574/how-to-check-if-a-nats-request-was-cancelled/51126740#51126740", "title": "How to check if a NATS request was cancelled", "body": "<p>If the response is intensive and takes multiple seconds to produce, then yes you can send a separate message that kills the request. Most architectures however let the responder continue and throw away the result.</p>\n"}], "owner": {"reputation": 1630, "user_id": 714143, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbccc8facbd1a98a5f6c7eb569897f0f?s=128&d=identicon&r=PG", "display_name": "TedMeftah", "link": "https://stackoverflow.com/users/714143/tedmeftah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 238, "favorite_count": 0, "accepted_answer_id": 51126740, "answer_count": 2, "score": 0, "last_activity_date": 1530476497, "creation_date": 1530307397, "question_id": 51109574, "link": "https://stackoverflow.com/questions/51109574/how-to-check-if-a-nats-request-was-cancelled", "title": "How to check if a NATS request was cancelled", "body": "<p>When a user hits a route, I make a NATS request, and wait for the reply:</p>\n\n<pre><code>ctx := r.Context()\nreply, err := natsConnection.RequestWithContext(ctx, \"Subject\", payload)\n</code></pre>\n\n<p>The subscriber will do a task that will be resources intensive:</p>\n\n<pre><code>natsConnection.Subscribe(\"Subject\", func(m *nats.Msg) {\n    //do consuming task and cancel if the request was cancelled. \n    natsConnection.Publish(m.Reply, []byte(\"Reply\"))\n})\n</code></pre>\n\n<p>How can I tell the subscriber to stop working if the request was cancelled.</p>\n\n<p>I thought creating a <code>context</code> for each message recived by the worker then give the sender a new <code>inbox</code> to wait for a reply in it, or send a cancel notice to it: </p>\n\n<pre><code>contextMap := map[string]func(){}\nnatsConnection.Subscribe(\"Subject\", func(m *nats.Msg) {\n    ctx, cancel := context.WithTimeout(context.Background(), 10*time.Second)\n\n    //create new inbox\n    inbox := nats.NewInbox()\n\n    //subscribe to the new inbox and cancel and clean up the current task is something is recived\n    newSub, err := natsConnection.Subscribe(inbox, func(m *nats.Msg) {\n        contextMap[inbox]()\n    })\n\n    contextMap[inbox] = func() {\n        fmt.Println(\"recived\")\n        cancel()\n        delete(contextMap, inbox)\n        newSub.Unsubscribe()\n    }\n\n    //tell the requester to wait for reply in this inbox\n    natsConnection.Publish(m.Reply, []byte(inbox))\n\n    //do the work and send the reply when finished\n    tick(ctx)\n    natsConnection.Publish(inbox, []byte(\"done\"))\n})\n</code></pre>\n\n<p>On the requester end, I send the first request and wait in the specifed <code>inbox</code> for the reply or the <code>context</code> to be canceled in which case I send a message to the <code>inbox</code> letting the reciver know:</p>\n\n<pre><code>ctx := r.Context()\ninbox, _ := natsConnection.RequestWithContext(ctx, \"Subject\", []byte(\"Payload\"))\n\nreply := make(chan *nats.Msg, 1)\nnatsConnection.ChanSubscribe(string(inbox.Data), reply)\n\nselect {\ncase &lt;-ctx.Done():\n    fmt.Println(\"Canceled\")\n    natsConnection.Publish(string(inbox.Data), []byte(\"\"))\n    return\ncase r := &lt;-reply:\n    fmt.Println(string(r.Data))\n}\n</code></pre>\n\n<p><code>tick</code> is just a function that tick:</p>\n\n<pre><code>func tick(ctx context.Context) {\n    ticker := time.NewTicker(time.Millisecond * 500)\n    for {\n        select {\n        case &lt;-ctx.Done():\n            ticker.Stop()\n            fmt.Println(\"context was canceled\", ctx.Err())\n            return\n        case &lt;-ticker.C:\n            fmt.Println(\"Tick\")\n        }\n    }\n}\n</code></pre>\n\n<p>Right now this works, but i was wondering if there is simpler way to do it, or if not how can i make this code better?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2577, "user_id": 3512709, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/sA5RZ.jpg?s=128&g=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/3512709/adam"}, "edited": false, "score": 0, "creation_date": 1530310846, "post_id": 51109877, "comment_id": 89207159, "body": "That&#39;s definitely the issue. Dang, wishing vgo was powerful enough to handle this."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1530309415, "creation_date": 1530309415, "answer_id": 51109877, "question_id": 51109529, "link": "https://stackoverflow.com/questions/51109529/vgo-case-insensitive-import-collision/51109877#51109877", "title": "vgo case-insensitive import collision", "body": "<p>It's may be a case change issue: Sirupsen versus sirupsen. For example, one of many,</p>\n\n<p><a href=\"https://github.com/sirupsen/logrus/issues/570\" rel=\"nofollow noreferrer\">Rename back to Sirupsen/logrus #570</a></p>\n"}], "owner": {"reputation": 2577, "user_id": 3512709, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/sA5RZ.jpg?s=128&g=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/3512709/adam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 534, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1530309415, "creation_date": 1530307052, "last_edit_date": 1530307856, "question_id": 51109529, "link": "https://stackoverflow.com/questions/51109529/vgo-case-insensitive-import-collision", "title": "vgo case-insensitive import collision", "body": "<p>I'm trying to use vgo and I'm getting the following error</p>\n\n<pre><code>$ vgo build ./...\nvgo: resolving import \"github.com/Sirupsen/logrus\"\nvgo: finding github.com/Sirupsen/logrus (latest)\nvgo: adding github.com/Sirupsen/logrus v1.0.5\n../../../mod/github.com/docker/go-events@v0.0.0-20170721190031-9461782956ad/broadcast.go:7:2: case-insensitive import collision: \"github.com/sirupsen/logrus\" and \"github.com/Sirupsen/logrus\"\n</code></pre>\n\n<p>I've tried adding the following to my go.mod file:</p>\n\n<pre><code>exclude github.com/Sirupsen/logrus v1.0.5\n\nrequire (\n    ...\n    github.com/sirupsen/logrus v1.0.5\n    ...\n)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>replace github.com/Sirupsen/logrus v1.0.5 =&gt; github.com/sirupsen/logrus v1.0.5\n</code></pre>\n\n<p>but then I just get the following:</p>\n\n<pre><code>$ vgo build ./...\nvgo: resolving import \"github.com/Sirupsen/logrus\"\nvgo: finding github.com/Sirupsen/logrus v1.0.4\nvgo: finding github.com/Sirupsen/logrus (latest)\nvgo: adding github.com/Sirupsen/logrus v1.0.4\nvgo: downloading github.com/Sirupsen/logrus v1.0.4\n../../../mod/github.com/docker/go-events@v0.0.0-20170721190031-9461782956ad/broadcast.go:7:2: case-insensitive import collision: \"github.com/sirupsen/logrus\" and \"github.com/Sirupsen/logrus\"\n</code></pre>\n\n<p>I don't know which package is causing the issue. Any help appreciated, thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1530337057, "post_id": 51109460, "comment_id": 89210920, "body": "@ThunderCat I don&#39;t know whether it is a well-known format or not. What I have with the string is: string with <code>key:value</code> pattern concatenate by <code>;</code>. Basically the string can be considered as a map[string]string"}], "answers": [{"comments": [{"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1530339841, "post_id": 51112199, "comment_id": 89211410, "body": "Thank you very much! I guess this is my first time to use go reflect"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1530407980, "last_edit_date": 1530407980, "creation_date": 1530338622, "answer_id": 51112199, "question_id": 51109460, "link": "https://stackoverflow.com/questions/51109460/parse-and-validate-key1value1-key2value2-string-to-go-struct-efficiently/51112199#51112199", "title": "Parse and validate &quot;key1:value1; key2:value2&quot; string to Go struct efficiently?", "body": "<p>I'll assume that you can parse the data to a map[string]interface{}. </p>\n\n<p>Use the <a href=\"https://godoc.org/reflect\" rel=\"nofollow noreferrer\">reflect</a> package to set the fields.  Here's the basic function:</p>\n\n<pre><code>// set sets fields in struct pointed to by pv to values in data.\nfunc set(pv interface{}, data map[string]interface{}) {\n    // pv is assumed to be pointer to a struct\n    s := reflect.ValueOf(pv).Elem()\n\n    // Loop through fields\n    t := s.Type()\n    for i := 0; i &lt; t.NumField(); i++ {\n\n        // Set field if there's a data value for the field.\n        f := t.Field(i)\n        if d, ok := data[f.Tag.Get(\"name\")]; ok {\n            s.Field(i).Set(reflect.ValueOf(d))\n        }\n    }\n}\n</code></pre>\n\n<p>This code assumes that the  values in the data map are assignable to the corresponding field in the struct and that the first argument is a pointer to a struct.  The code will panic if these assumptions are not true.  You can protect against this by checking types and assignability using the reflect package.</p>\n\n<p><a href=\"https://play.golang.org/p/9-dzMbd44Fv\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 51112199, "answer_count": 1, "score": 1, "last_activity_date": 1530407980, "creation_date": 1530306705, "last_edit_date": 1530336904, "question_id": 51109460, "link": "https://stackoverflow.com/questions/51109460/parse-and-validate-key1value1-key2value2-string-to-go-struct-efficiently", "title": "Parse and validate &quot;key1:value1; key2:value2&quot; string to Go struct efficiently?", "body": "<p>I have a \"key1:value1; key2:value2\" like string (string with <code>key:value</code> pattern concated by <code>;</code>).</p>\n\n<p>Now I wish to parse this string to a Go struct:</p>\n\n<pre><code>type CustomStruct struct {\n   KeyName1 string `name:\"key1\" somevalidation:\"xxx\"`\n   KeyName2 int    `name:\"key2\" somevalidation:\"yyy\"`\n}\n</code></pre>\n\n<p>In the above example, the struct tag defines the name of the key in the string and can provide some validation for its corresponding value (it can set a default value if validation fails). For instance, <code>KeyName2</code> is an <code>int</code> value, so I wish the <code>somevalidation</code> can check whether the <code>KeyName2</code> satisfy, let's say, greater than 30 and less equal than 100.</p>\n\n<p>And in another senario, I can define another struct <code>CustomStruct2</code> for string like <code>key3:value3; key4:value4;</code></p>\n\n<p>How can I archive this kind of requirement efficiently and elegantly?</p>\n"}, {"tags": ["arrays", "go", "printf", "double-quotes", "single-quotes"], "comments": [{"owner": {"reputation": 997, "user_id": 678491, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uppbW.jpg?s=128&g=1", "display_name": "k1m190r", "link": "https://stackoverflow.com/users/678491/k1m190r"}, "edited": false, "score": 0, "creation_date": 1530307997, "post_id": 51109001, "comment_id": 89206393, "body": "by the looks of you have to do it separately: step 1 get the <code>[&quot;go&quot;, &quot;lang&quot;]</code> string, step2 <code>strings.Replace()</code> double-quotes <code>&quot;</code> with single <code>&#39;</code>."}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "edited": false, "score": 0, "creation_date": 1530309715, "post_id": 51109001, "comment_id": 89206917, "body": "What (Go) value are you supplying for that <code>%q</code> that produces <code>[&quot;go&quot;, &quot;lang&quot;]</code>? The behavior of <code>%q</code> depends on what value you give it BTW. Also, which database accepts array as <code>[&#39;go&#39;, &#39;lang&#39;]</code>? I&#39;m familiar with <code>array[&#39;go&#39;,&#39;lang&#39;]</code> and <code>&#39;{go,lang}&#39;</code> but not the one."}, {"owner": {"reputation": 870, "user_id": 4522501, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/929253393772654/picture?type=large", "display_name": "Javier Salas", "link": "https://stackoverflow.com/users/4522501/javier-salas"}, "edited": false, "score": 0, "creation_date": 1530311266, "post_id": 51109001, "comment_id": 89207238, "body": "I had to Create a variable and do a strings.join() due that is an array [], just joined with &quot;&#39;,&#39;&quot; and was modified to <code>Query = fmt.Sprintf(&quot;INSERT INTO persons (name, age, dimensions) VALUES (&#39;%s&#39;, %d, [&#39;%v&#39;])&quot;)</code>"}], "owner": {"reputation": 870, "user_id": 4522501, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/929253393772654/picture?type=large", "display_name": "Javier Salas", "link": "https://stackoverflow.com/users/4522501/javier-salas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 932, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1530353125, "creation_date": 1530304201, "last_edit_date": 1530353125, "question_id": 51109001, "link": "https://stackoverflow.com/questions/51109001/how-to-escape-single-quote-in-a-string-taken-by-yaml-file-using-sprintf", "title": "How to escape single quote in a string taken by YAML file using Sprintf", "body": "<p>I'm using Go but I'm having issues while trying to get an array that contains a single quote, I'm making a query structure to create a .sql file with that query, the issue is with an array field that is adding double quotes instead of a single quote.</p>\n\n<p>This is what I have:</p>\n\n<p>Yaml File:</p>\n\n<pre><code>Name: 'Myname'\nAge: 9\nDimensions ['go', 'lang']\n</code></pre>\n\n<p>Go code Syntaxis:</p>\n\n<pre><code>var Query string = \"\";\nQuery = fmt.Sprintf(\"INSERT INTO persons (name, age, dimensions) VALUES ('%s', %d, %q)\")\n</code></pre>\n\n<p>OUTPUT:</p>\n\n<pre><code> Query:\n INSERT INTO persons (name, age, dimensions) VALUES ('MyName', 9, [\"go\", \"lang\"])\n</code></pre>\n\n<p>I don't want \"go\" and \"lang\" double quoted, I want it as the YAML file came, with single quote.</p>\n\n<p>Is supposed that \"%q\" escape the single quote...</p>\n\n<p>any idea what to do?</p>\n"}, {"tags": ["go", "http-post", "iso-8859-1"], "comments": [{"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 2, "creation_date": 1530307685, "post_id": 51108488, "comment_id": 89206294, "body": "There is no way to &quot;escape&quot; characters in ISO-8859-1 (or any other charset). You can only use characters supported by charset and thats it."}, {"owner": {"reputation": 7554, "user_id": 700471, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ebb4cc58c1fce4f22abc59a1226ee8e2?s=128&d=identicon&r=PG", "display_name": "Matt Mc", "link": "https://stackoverflow.com/users/700471/matt-mc"}, "reply_to_user": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1530310967, "post_id": 51108488, "comment_id": 89207188, "body": "@ain Thanks.  Would care you expand on that and post an answer?  Then your input could be upvoted and possibly Accepted."}], "owner": {"reputation": 7554, "user_id": 700471, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/ebb4cc58c1fce4f22abc59a1226ee8e2?s=128&d=identicon&r=PG", "display_name": "Matt Mc", "link": "https://stackoverflow.com/users/700471/matt-mc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 535, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1530305779, "creation_date": 1530301646, "last_edit_date": 1530305779, "question_id": 51108488, "link": "https://stackoverflow.com/questions/51108488/encoding-special-characters-for-iso-8859-1-api", "title": "Encoding Special Characters for ISO-8859-1 API", "body": "<p>I'm writing a Go package for communicating with a 3rd-party vendor's API.  Their documentation states roughly this:</p>\n\n<blockquote>\n  <p>Our API uses the ISO-8859-1 encoding.  If you fail to use ISO-8859-1 for encoding special characters, this will result in unexpected errors or malformed strings.</p>\n</blockquote>\n\n<p>I've been doing research on the subject of charsets and encodings, trying to figure out how to \"encode special characters\" in ISO-8859-1, but based on what I've found this seems to be a red herring.</p>\n\n<p>From <a href=\"https://stackoverflow.com/a/7048774/700471\">StackOverflow</a>, emphasis mine:</p>\n\n<blockquote>\n  <p>UTF-8 is a multibyte encoding that can represent any Unicode character. ISO 8859-1 is a <strong>single-byte encoding</strong> that can represent the first 256 Unicode characters. Both encode ASCII exactly the same way.</p>\n</blockquote>\n\n<p>ISO-8859-1 is a <em>binary encoding format</em> where each possible value of a single byte maps to a specific character.  It's certainly within my power to have my HTTP POST body encoded in this way, but <em>not</em> any characters beyond the 256 defined in the spec.</p>\n\n<p>I gather that, to encode a special character (such as the Euro symbol) in ISO-8859-1, it would first need to be <em>escaped</em> in some way.</p>\n\n<p><strong>Is there some kind of standard ISO-8859-1 escaping?</strong>  Would it suffice to URL-encode any special characters and then encode my POST body in ISO-8859-1?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 2, "creation_date": 1530304278, "post_id": 51108149, "comment_id": 89205107, "body": "Questions seeking debugging help (&quot;why isn&#39;t this code working?&quot;) must include the desired behavior, a specific problem or error and the shortest code necessary to reproduce it in the question itself. Questions without a clear problem statement are not useful to other readers. See: <a href=\"http://stackoverflow.com/help/mcve\">How to create a Minimal, Complete, and Verifiable example.</a>  How can we reproduce your error?"}, {"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 0, "creation_date": 1530341026, "post_id": 51108149, "comment_id": 89211631, "body": "whats not working ? what is your expectation ?"}], "answers": [{"tags": [], "owner": {"reputation": 91, "user_id": 9911189, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FpQ1Ants5QU/AAAAAAAAAAI/AAAAAAAAAAc/E4smqVInW44/photo.jpg?sz=128", "display_name": "Arthur Ruckman", "link": "https://stackoverflow.com/users/9911189/arthur-ruckman"}, "is_accepted": false, "score": 0, "last_activity_date": 1530407224, "creation_date": 1530407224, "answer_id": 51119674, "question_id": 51108149, "link": "https://stackoverflow.com/questions/51108149/how-can-i-make-multiples-request-and-get-response-with-goroutines/51119674#51119674", "title": "how can I make multiples request and get response with goroutines", "body": "<p>The reason your code only processes one request at a time is that you are waiting for a response from your channel in the requests loop:</p>\n\n<p><code>resp := &lt;-done</code></p>\n\n<p>I find it much easier to work with waitgroups and mutexes than to work with channels, so I use them in my example: </p>\n\n<pre><code>var protocolsMutex sync.Mutex\nvar wg             sync.WaitGroup\n\nfunc main() {\n    requestTestGoRoutine()\n    log.Println(\"END\")\n}\n\nfunc requestTestGoRoutine() {\n    for _, r := range requests {\n        wg.Add(1)\n        go execute(r)\n    }\n\n    wg.Wait()\n\n    fmt.Println(\"protocols:\", protocols)\n}\n\nfunc execute(r map[string]interface{}, done chan *http.Response) {\n    defer wg.Done()\n\n    bodyRequest := new(bytes.Buffer)\n    json.NewEncoder(bodyRequest).Encode(r)\n    resp, _ := requestControlTower(url, bodyRequest)\n\n    var p protocol\n    json.NewDecoder(resp.Body).Decode(&amp;p)\n\n    protocolsMutex.Lock()\n    log.Println(\"Fazendo request...\")\n    protocols = append(protocols, p)\n    protocolsMutex.Unlock()\n}\n</code></pre>\n\n<p>Here, for each request in the requests loop in <code>requestTestGoRoutine()</code>, I increment the <code>sync.WaitGroup</code> by one and start a <code>execute</code> goroutine for the request. In the <code>execute</code> function, I run <code>defer wg.Done()</code>, which will de-increment the waitgroup by one once the goroutine returns. </p>\n\n<p>After the requests loop, I run <code>wg.Wait()</code>, which will wait until all goroutines have called <code>wg.Done()</code> before printing the <code>protocols</code> slice.</p>\n\n<p>A <code>sync.Mutex</code> is used to control access to the <code>protocols</code> slice so that only one goroutine can access it at a time. If the mutex is locked, the other goroutines will wait until it is unlocked before continuing to the next section of code. Without the mutex, more than one goroutine could write to the slice at once, causing a race condition. I also moved the <code>log.Println</code> statement into this mutex to prevent more than one goroutine from logging at once, which could cause jumbled lines in your log.</p>\n\n<p>I don't have access to all of your code, so this is untested. If something doesn't doesn't work feel free to let me know in a comment.</p>\n"}], "owner": {"reputation": 57, "user_id": 9208689, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13ec365c3daa9a726d3296e81de9aec9?s=128&d=identicon&r=PG&f=1", "display_name": "Matheus Alc&#226;ntara", "link": "https://stackoverflow.com/users/9208689/matheus-alc%c3%a2ntara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1530407224, "creation_date": 1530299968, "question_id": 51108149, "link": "https://stackoverflow.com/questions/51108149/how-can-i-make-multiples-request-and-get-response-with-goroutines", "title": "how can I make multiples request and get response with goroutines", "body": "<p>I need to make multiple request in url and get the return and save in a slice of return to work with then later, but it doesn't work\nmy code:</p>\n\n<pre><code>func main() {\nrequestTestGoRoutine()\nlog.Println(\"END\")\n}\n\nfunc requestTestGoRoutine() {\n    done := make(chan *http.Response)\n    defer close(done)\n    for _, r := range requests {\n        go execute(r, done)\n        var p protocol\n        resp := &lt;-done\n        json.NewDecoder(resp.Body).Decode(&amp;p)\n        fmt.Println(\"protocol:\", p)\n        protocols = append(protocols, p)\n\n    }\n    fmt.Println(\"protocols:\", protocols)\n}\n\nfunc execute(r map[string]interface{}, done chan *http.Response) {\n    bodyRequest := new(bytes.Buffer)\n    json.NewEncoder(bodyRequest).Encode(r)\n    log.Println(\"Fazendo request...\")\n    resp, err := requestControlTower(url, bodyRequest)\n    if err != nil {\n        log.Fatal(err)\n    }\n    done &lt;- resp\n}\n</code></pre>\n\n<p>my output in terminal:</p>\n\n<pre><code>2018/06/29 16:10:26 Fazendo request...\nprotocol: {123456 Aprovado}\n2018/06/29 16:10:38 Fazendo request...\nprotocol: {123457 Aprovado}\n2018/06/29 16:10:48 Fazendo request...\nprotocol: {123458 Aprovado}\n2018/06/29 16:10:58 Fazendo request...\nprotocol: {123459 Aprovado}\n2018/06/29 16:11:08 Fazendo request...\nprotocol: {123410 Aprovado}\n2018/06/29 16:11:18 Fazendo request...\nprotocol: {123411 Aprovado}\nprotocols: [{123456 Aprovado} {123457 Aprovado} {123458 Aprovado} {123459         \nAprovado} {123410 Aprovado} {123411 Aprovado}]\n2018/06/29 16:11:29 END\n</code></pre>\n\n<p>anyone could help me?</p>\n"}, {"tags": ["go", "kubernetes"], "comments": [{"owner": {"reputation": 22353, "user_id": 225016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77d3c3ab5ddcf93a8ca1bfe1b481be1c?s=128&d=identicon&r=PG", "display_name": "mdaniel", "link": "https://stackoverflow.com/users/225016/mdaniel"}, "edited": false, "score": 1, "creation_date": 1530343306, "post_id": 51106923, "comment_id": 89212049, "body": "I would <i>assume</i> it&#39;s the same syntax as <code>kubectl</code>&#39;s <code>--selector</code> argument: <code>some-key=some-value,other-key=something-else</code>; have you already tried that? In your specific case, I would think: <code>labelSelector: fmt.Sprintf(&quot;version=%s&quot;, version),</code>"}], "answers": [{"comments": [{"owner": {"reputation": 480, "user_id": 9448870, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ckK5P.jpg?s=128&g=1", "display_name": "Daniel Sch&#252;tte", "link": "https://stackoverflow.com/users/9448870/daniel-sch%c3%bctte"}, "edited": false, "score": 0, "creation_date": 1530727878, "post_id": 51121580, "comment_id": 89340613, "body": "Please try to make this a complete answer to help others who read the question to understand your solution."}], "tags": [], "owner": {"reputation": 817, "user_id": 293406, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/72d77d157a7ad6f6d24cae43f30f7aee?s=128&d=identicon&r=PG", "display_name": "AlexS", "link": "https://stackoverflow.com/users/293406/alexs"}, "is_accepted": false, "score": 6, "last_activity_date": 1530876581, "last_edit_date": 1530876581, "creation_date": 1530433171, "answer_id": 51121580, "question_id": 51106923, "link": "https://stackoverflow.com/questions/51106923/labelselector-for-secrets-list-in-k8s/51121580#51121580", "title": "LabelSelector for Secrets List in k8s", "body": "<pre><code>func GetSecret( version string, param2 string) (retVal interface{}, err error){\n    clientset := GetClientOutOfCluster()\n    labelSelector := fmt.Sprintf(\"version=%s, param2=%s\", version, param2)\n\n    listOptions := metav1.ListOptions{\n        LabelSelector: labelSelector,\n        Limit:         100,\n    }\n    secretList, err := clientset.CoreV1().Secrets(\"namespace\").List( listOptions )\n    retVal = secretList.Items[0]\n    return retVal, err\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 395, "user_id": 794559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2edf8764f2bbbb1fe31e7b6df924653a?s=128&d=identicon&r=PG", "display_name": "larry.li", "link": "https://stackoverflow.com/users/794559/larry-li"}, "is_accepted": false, "score": 6, "last_activity_date": 1559120949, "creation_date": 1559120949, "answer_id": 56356932, "question_id": 51106923, "link": "https://stackoverflow.com/questions/51106923/labelselector-for-secrets-list-in-k8s/56356932#56356932", "title": "LabelSelector for Secrets List in k8s", "body": "<p>You can use the k8s provided function to do the toString operation</p>\n\n<pre><code>import \"k8s.io/apimachinery/pkg/labels\"\n...\n\nfunc GetSecret(version string) (retVal interface{}, err error){\n  clientset := GetClientOutOfCluster()\n  labelSelector := metav1.LabelSelector{MatchLabels: map[string]string{\"version\":version}}\n\n  listOptions := metav1.ListOptions{\n    LabelSelector: labels.Set(labelSelector.MatchLabels).String(),\n    Limit:         100,\n  }\n  secretList, err := clientset.CoreV1().Secrets(\"namespace\").List(listOptions)\n  retVal = secretList.Items[0]\n  return retVal, err\n}\n</code></pre>\n"}], "owner": {"reputation": 817, "user_id": 293406, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/72d77d157a7ad6f6d24cae43f30f7aee?s=128&d=identicon&r=PG", "display_name": "AlexS", "link": "https://stackoverflow.com/users/293406/alexs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9795, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1559120949, "creation_date": 1530293958, "last_edit_date": 1530296069, "question_id": 51106923, "link": "https://stackoverflow.com/questions/51106923/labelselector-for-secrets-list-in-k8s", "title": "LabelSelector for Secrets List in k8s", "body": "<p>I want to get Secret object from k8s cluster using go-client API</p>\n\n<p>I have function that looks like that</p>\n\n<pre><code>func GetSecret( version string) (retVal interface{}, err error){\n    clientset := GetClientOutOfCluster()\n    labelSelector := metav1.LabelSelector{MatchLabels: map[string]string{\"version\":version}}\n\n    listOptions := metav1.ListOptions{\n        LabelSelector: labelSelector.String(),\n        Limit:         100,\n    }\n    secretList, err := clientset.CoreV1().Secrets(\"namespace\").List( listOptions )\n    retVal = secretList.Items[0]\n    return retVal, err\n}\n</code></pre>\n\n<p>GetClientOutOfCluster is basically retrieves configuration from cluster or from local ~/.kube/config</p>\n\n<p>I used metav1.LabelSelector just like i do when i generate new Deployment object.So i thought i was cool. But ListOptions.LabelSelector is a string.\nWhen i run my function it fails.</p>\n\n<pre><code>unable to parse requirement: invalid label key \"&amp;LabelSelector{MatchLabels:map[string]string{version:\": name part must consist of alphanumeric characters, '-', '_' or '.', and must start and end with an alphanumeric character (e.g. 'MyName',  or 'my.name',  or '123-abc', regex used for validation is '([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9]')\n</code></pre>\n\n<p>I cannot find example of usage of this function anywhere. Documentation assumes that you know what is LabelSelector.</p>\n\n<p>What is format of LabelSelector for ListOptions?</p>\n\n<p>Thanks</p>\n"}]