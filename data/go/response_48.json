[{"tags": ["angularjs", "go", "routing", "angular-ui-router", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 1073, "user_id": 2232573, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/207cb35beb3a38a12e8ec83fd12511f0?s=128&d=identicon&r=PG", "display_name": "nurp", "link": "https://stackoverflow.com/users/2232573/nurp"}, "edited": false, "score": 0, "creation_date": 1449705672, "post_id": 34191218, "comment_id": 56129074, "body": "Ok I tried this and it works (despite many errors in the console window) but I want the same functionality when I go to <a href=\"http://localhost\" rel=\"nofollow noreferrer\">localhost</a> where another module is responsible and I use ngNewRouter, it redirects automatically to <a href=\"http://localhost:8080/#/\" rel=\"nofollow noreferrer\">localhost:8080/#</a> while html5 is not enabled."}, {"owner": {"reputation": 5237, "user_id": 4135178, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/XoHxp.png?s=128&g=1", "display_name": "Avijit Gupta", "link": "https://stackoverflow.com/users/4135178/avijit-gupta"}, "reply_to_user": {"reputation": 1073, "user_id": 2232573, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/207cb35beb3a38a12e8ec83fd12511f0?s=128&d=identicon&r=PG", "display_name": "nurp", "link": "https://stackoverflow.com/users/2232573/nurp"}, "edited": false, "score": 1, "creation_date": 1449705910, "post_id": 34191218, "comment_id": 56129145, "body": "Your application must have a main module in which all the other modules are injected, attach it to that module&#39;s config function to get it to function in your whole of the application."}], "tags": [], "owner": {"reputation": 5237, "user_id": 4135178, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/XoHxp.png?s=128&g=1", "display_name": "Avijit Gupta", "link": "https://stackoverflow.com/users/4135178/avijit-gupta"}, "is_accepted": false, "score": 0, "last_activity_date": 1449704875, "creation_date": 1449704875, "answer_id": 34191218, "question_id": 34191096, "link": "https://stackoverflow.com/questions/34191096/ui-routing-without-urlrouterprovider-otherwise/34191218#34191218", "title": "ui routing without urlRouterProvider.otherwise", "body": "<p>By default, Angular adds the <strong>hashPrefix</strong> in front of urls. So when you navigate to <code>http://localhost:8080/admin</code> , You don't see index.html since you have not yet visited the url as defined in the angular's ui-router. You will have to navigate to <code>http://localhost:8080/admin/#/</code> to actuall be in the <code>/</code> state of your application. </p>\n\n<p>It is the same reason that your app doesn't work without the <code>.otherwise()</code>, since then it automatically redirects you to the <code>/</code> state later. </p>\n\n<p>For a possible fix:</p>\n\n<p>Inside your <code>.config</code> function:</p>\n\n<pre><code>// This is in your app module config.\n$locationProvider.html5Mode(true);\n</code></pre>\n\n<p>And in your <code>index.html</code>:</p>\n\n<pre><code>// This is in your index.html head.\n&lt;base href=\"/\" /&gt;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2834, "user_id": 1390477, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/04c7b875d0bfa119d7877633beda54fa?s=128&d=identicon&r=PG", "display_name": "Jo&#227;o Mosmann", "link": "https://stackoverflow.com/users/1390477/jo%c3%a3o-mosmann"}, "is_accepted": false, "score": 0, "last_activity_date": 1449704899, "creation_date": 1449704899, "answer_id": 34191224, "question_id": 34191096, "link": "https://stackoverflow.com/questions/34191096/ui-routing-without-urlrouterprovider-otherwise/34191224#34191224", "title": "ui routing without urlRouterProvider.otherwise", "body": "<p>The problem is not with not having a declared <code>otherwise</code>.</p>\n\n<p>The problem lays on your route. You're specifying the url to be <code>'/'</code>, that means the state <strong>home</strong> is accessible only through <strong><a href=\"http://localhost:8080/admin/\" rel=\"nofollow\">http://localhost:8080/admin/</a></strong> and NOT through <strong><a href=\"http://localhost:8080/admin\" rel=\"nofollow\">http://localhost:8080/admin</a></strong></p>\n\n<p>What the <code>otherwise</code> does is. When you access the url <strong><a href=\"http://localhost:8080/admin\" rel=\"nofollow\">http://localhost:8080/admin</a></strong> the router try to find a state that matches the url, but don't find it. So it redirects to <strong><a href=\"http://localhost:8080/admin/\" rel=\"nofollow\">http://localhost:8080/admin/</a></strong> which matches with your <strong>home</strong> state.</p>\n"}], "owner": {"reputation": 1073, "user_id": 2232573, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/207cb35beb3a38a12e8ec83fd12511f0?s=128&d=identicon&r=PG", "display_name": "nurp", "link": "https://stackoverflow.com/users/2232573/nurp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 323, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1449704899, "creation_date": 1449704214, "question_id": 34191096, "link": "https://stackoverflow.com/questions/34191096/ui-routing-without-urlrouterprovider-otherwise", "title": "ui routing without urlRouterProvider.otherwise", "body": "<p>Routing doesn't occur if I don't include $urlRouterProvider.otherwise('/'); in the config.</p>\n\n<p>my go app engine setting with gorilla is</p>\n\n<pre><code>r := mux.NewRouter()\nr.HandleFunc(/admin, handleAdmin)\n</code></pre>\n\n<p>and angularjs config is;</p>\n\n<pre><code>angular.module('admin')\n    .config(function($stateProvider, $urlRouterProvider) {\n      $stateProvider.state('home', {\n        url: '/',\n        templateUrl: '/admin/index.html',\n        controller: 'AdminController as admin'\n      });\n  //$urlRouterProvider.otherwise('/');\n})\n</code></pre>\n\n<p>when I don't call $urlRouterProvider.othwerwise line, and I open <a href=\"http://localhost:8080/admin\" rel=\"nofollow\">http://localhost:8080/admin</a> I expect to see admin/index.html, but I don't. I see it only if I navigate to <a href=\"http://localhost:8080/admin#/\" rel=\"nofollow\">http://localhost:8080/admin#/</a> manually.\nBut if I add $urlRouterProvider.othwerwise option and go to <a href=\"http://localhost:8080/admin\" rel=\"nofollow\">http://localhost:8080/admin</a> it redirects automatically to <a href=\"http://localhost:8080/admin#/\" rel=\"nofollow\">http://localhost:8080/admin#/</a>\nI don't think this is usual way to do it because I may want \"otherwise\" to route to a custom 404 page. What point do I miss?</p>\n"}, {"tags": ["go", "types", "interface"], "comments": [{"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 2, "creation_date": 1449701339, "post_id": 34190170, "comment_id": 56127373, "body": "Interfaces are generally explicit contracts in any language. The main reason here that you can&#39;t have your method signature return <code>Foo</code> is because the interface says it returns a <code>fmt.Stringer</code>. This is not isolated to Go. For example, this C# code also fails because of the same reason: <a href=\"https://dotnetfiddle.net/4xZ2tk\" rel=\"nofollow noreferrer\">dotnetfiddle.net/4xZ2tk</a>. The compiler simply cannot guarantee that you&#39;re going to return an object that satisfies the interface unless you tell it that you promise you will (by having the signature match the interface)."}, {"owner": {"reputation": 2428, "user_id": 345350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/50cb4981bbaa51b1713269a29f78d826?s=128&d=identicon&r=PG", "display_name": "donatJ", "link": "https://stackoverflow.com/users/345350/donatj"}, "reply_to_user": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 1, "creation_date": 1449709393, "post_id": 34190170, "comment_id": 56130278, "body": "The difference though is C# interfaces are checked on definition, Go interfaces are checked on use.  It would seem like the compiler would be able to check that return interface statically."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 2, "last_activity_date": 1449702090, "creation_date": 1449702090, "answer_id": 34190663, "question_id": 34190170, "link": "https://stackoverflow.com/questions/34190170/go-interface-method-returning-interface-doesnt-match-method-returning-concrete/34190663#34190663", "title": "Go Interface Method Returning Interface Doesn&#39;t Match Method Returning Concrete Type", "body": "<blockquote>\n  <p>I want to be able to write my own structs as well that fulfill said interfaces, so interfacing against the concrete return type isn't an option either.</p>\n</blockquote>\n\n<p>\"I want\" and Go does not match well.</p>\n\n<blockquote>\n  <p>I have to assume there is a way to do this.</p>\n</blockquote>\n\n<p>No, there is not. Interfaces match exactly. Go has no notion of supertype or specialisation.</p>\n"}, {"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 1, "last_activity_date": 1449706876, "creation_date": 1449706876, "answer_id": 34191583, "question_id": 34190170, "link": "https://stackoverflow.com/questions/34190170/go-interface-method-returning-interface-doesnt-match-method-returning-concrete/34191583#34191583", "title": "Go Interface Method Returning Interface Doesn&#39;t Match Method Returning Concrete Type", "body": "<p>As others have stated, Go does not support what you are trying to do.</p>\n\n<p>Have you considered that you may be over complicating your design a bit?</p>\n\n<p>You don't often find factory of factory patterns in Go like you would in other languages like Java (for example).</p>\n\n<p>At least, that's what I assume you are doing by having interfaces that return interfaces that return a thing.  </p>\n\n<p>You could always make a new package to hold the factory factory interfaces.  </p>\n\n<p>But usually, I'd first try to see if that level of abstraction is worth the readability hit you will take in the code base.  There may be a simpler way to solve your problem.</p>\n"}, {"comments": [{"owner": {"reputation": 2428, "user_id": 345350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/50cb4981bbaa51b1713269a29f78d826?s=128&d=identicon&r=PG", "display_name": "donatJ", "link": "https://stackoverflow.com/users/345350/donatj"}, "edited": false, "score": 1, "creation_date": 1449709554, "post_id": 34191891, "comment_id": 56130334, "body": "&quot;Your problem is that you&#39;re trying to cause someone else&#39;s type to conform to an interface that it doesn&#39;t actually conform to. You can&#39;t do that.&quot; Isn&#39;t that specifically what Go&#39;s type system is designed to let you do. Isn&#39;t that why they&#39;re checked on use rather than definition?"}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "reply_to_user": {"reputation": 2428, "user_id": 345350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/50cb4981bbaa51b1713269a29f78d826?s=128&d=identicon&r=PG", "display_name": "donatJ", "link": "https://stackoverflow.com/users/345350/donatj"}, "edited": false, "score": 0, "creation_date": 1449710626, "post_id": 34191891, "comment_id": 56130660, "body": "@donatJ not across packages. Packages are masters of their own types. What if two different packages extended the same type in different ways? Which would win? You can have complex rules, but Go just says &quot;you can&#39;t do that.&quot;"}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": false, "score": 3, "last_activity_date": 1449754958, "last_edit_date": 1449754958, "creation_date": 1449708801, "answer_id": 34191891, "question_id": 34190170, "link": "https://stackoverflow.com/questions/34190170/go-interface-method-returning-interface-doesnt-match-method-returning-concrete/34191891#34191891", "title": "Go Interface Method Returning Interface Doesn&#39;t Match Method Returning Concrete Type", "body": "<p>Your problem is that you're trying to cause someone else's (i.e. another package's) type to conform to an interface that it doesn't actually conform to. You can't do that. But you can make <em>your</em> type conform to anything you want. And you can make <em>your</em> type wrap their type. There are two ways to do this. <a href=\"http://play.golang.org/p/05qRNyCFxE\" rel=\"nofollow\">Here's one</a>:</p>\n\n<pre><code>type MyBar Bar\n\nfunc (b *MyBar) GetStringer() fmt.Stringer {\n    return &amp;Foo{\"foo\"}\n}\n\nfunc main() {\n    f := MyBar(Bar{})\n    Printer(&amp;f)\n}\n</code></pre>\n\n<p>Now we've created a new type, <code>MyBar</code> that wraps a <code>Bar</code> and provides the interface you want. This approach doesn't \"inherit\" any other functionality from <code>Bar</code>, however. You have to wrap every individual thing you want, and you may have to reimplement (because you don't have access to the underlying impl).</p>\n\n<p>But you can also embed <code>Bar</code>, and \"inherit\" everything you don't change and get access to the underlying impl (which is probably closer to what you want here). <a href=\"http://play.golang.org/p/sz7ATtQjW7\" rel=\"nofollow\">For example</a>:</p>\n\n<pre><code>type MyBar struct{ Bar }\n\nfunc (b *MyBar) GetStringer() fmt.Stringer {\n    return b.Bar.GetStringer()\n}\n\nfunc main() {\n    f := MyBar{Bar{}}\n    Printer(&amp;f)\n}\n</code></pre>\n\n<p>Now if <code>Bar</code> has additional methods, they'll show up on <code>MyBar</code> for free. Either can be useful depending on your problem. You can use this technique to help other packages types conform to whatever you want.</p>\n\n<p>This doesn't mean that <code>Bar</code> and <code>MyBar</code> are interchangeable, but they're pretty close and it's pretty easy to convert between them as you need.</p>\n"}], "owner": {"reputation": 2428, "user_id": 345350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/50cb4981bbaa51b1713269a29f78d826?s=128&d=identicon&r=PG", "display_name": "donatJ", "link": "https://stackoverflow.com/users/345350/donatj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1178, "favorite_count": 0, "answer_count": 3, "score": 4, "last_activity_date": 1449754958, "creation_date": 1449699843, "question_id": 34190170, "link": "https://stackoverflow.com/questions/34190170/go-interface-method-returning-interface-doesnt-match-method-returning-concrete", "title": "Go Interface Method Returning Interface Doesn&#39;t Match Method Returning Concrete Type", "body": "<p>I'm trying to get Go interfaces to work, and the problem I am having is that a Go <strong>interface method</strong> returning a go <strong>interface</strong> only works if the implementation declares the <strong>interface</strong> and not a concrete type that implements the interface.</p>\n\n<p>In the following example I receive:</p>\n\n<blockquote>\n  <p>prog.go:29: cannot use &amp;f (type *Bar) as type StringerGetter in\n  argument to Printer:  *Bar does not implement StringerGetter (wrong\n  type for GetStringer method)      have GetStringer() *Foo         want\n  GetStringer() fmt.Stringer</p>\n</blockquote>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Foo struct {\n    val string\n}\n\nfunc (f *Foo) String() string {\n    return f.val\n}\n\ntype StringerGetter interface {\n    GetStringer() fmt.Stringer\n}\n\ntype Bar struct{}\n\nfunc (b *Bar) GetStringer() *Foo {\n    return &amp;Foo{\"foo\"}\n}\n\nfunc Printer(s StringerGetter) {\n    fmt.Println(s.GetStringer())\n}\n\nfunc main() {\n    f := Bar{}\n    Printer(&amp;f)\n}\n</code></pre>\n\n<p>However if I change <code>func (b *Bar) GetStringer() *Foo {</code> to <code>func (b *Bar) GetStringer() fmt.Stringer {</code> it works as expected.</p>\n\n<p><code>Foo</code> does fulfill <code>fmt.Stringer</code></p>\n\n<p>The rub is that the above is simple example code illustrating the problem. </p>\n\n<p>In the case of the code I am trying to write, the interfaces I created are in my <code>\"main\"</code> package, whereas the <strong>concrete types</strong> I'm writing interfaces against are in a 3rd party package I'd prefer not to modify.</p>\n\n<p>I want to be able to write my own structs as well that fulfill said interfaces, so interfacing against the concrete return type isn't an option either.  </p>\n\n<p>I have to assume there is a way to do this.</p>\n"}, {"tags": ["git", "go", "exec"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1449700936, "post_id": 34190121, "comment_id": 56127196, "body": "You would need to parse the output just like a user at the terminal. Why not provide the password without using the interactive prompt? (or even better, use the preferred and more secure method of an ssh key)"}, {"owner": {"reputation": 307, "user_id": 1864805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0393fcefefad7c5a1ce9434a2897a79?s=128&d=identicon&r=PG", "display_name": "Konoha", "link": "https://stackoverflow.com/users/1864805/konoha"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449702430, "post_id": 34190121, "comment_id": 56127821, "body": "@JimB : I am not clear on how to provide the password by any other way. I would greatly appreciate if you could point me towards a better approach."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1449702770, "post_id": 34190121, "comment_id": 56127981, "body": "See the <a href=\"https://git-scm.com/docs/gitcredentials\" rel=\"nofollow noreferrer\">git-credentials</a> docs for git related functionality. The best solution is really to use a proper ssh public key (which should be encrypted and accessed via an ssh agent for even more security)"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1449705039, "post_id": 34190121, "comment_id": 56128837, "body": "Another useful resource I&#39;ve used to set up my ssh for git on several systems; <a href=\"https://help.github.com/articles/generating-ssh-keys/\" rel=\"nofollow noreferrer\">help.github.com/articles/generating-ssh-keys</a>"}, {"owner": {"reputation": 307, "user_id": 1864805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0393fcefefad7c5a1ce9434a2897a79?s=128&d=identicon&r=PG", "display_name": "Konoha", "link": "https://stackoverflow.com/users/1864805/konoha"}, "edited": false, "score": 0, "creation_date": 1449761882, "post_id": 34190121, "comment_id": 56156178, "body": "Thanks guys. I got it to work by setting the GIT_ASKPASS environment variable. However I would have liked a cleaner way of getting it done. Also I agree the SSH option is more secure, however having it as a requirement for users to use my application is kind of limiting."}], "owner": {"reputation": 307, "user_id": 1864805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0393fcefefad7c5a1ce9434a2897a79?s=128&d=identicon&r=PG", "display_name": "Konoha", "link": "https://stackoverflow.com/users/1864805/konoha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 401, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1464436041, "creation_date": 1449699676, "last_edit_date": 1449701296, "question_id": 34190121, "link": "https://stackoverflow.com/questions/34190121/how-to-create-interactive-command-execution-in-golang", "title": "How to create interactive command execution in Golang?", "body": "<p>I am trying to automate a git push from my Golang program. Is there any way I can pass username and password from the parent program into the exec-command?</p>\n\n<pre><code>func gitPush(gitExeLocation string, currentDir string) {\n\n    fmt.Println(\"Pushing ...\")\n    args  := []string{\"push\", \"-f\", \"origin\", \"HEAD\"}\n\n    cmd := exec.Command(gitExeLocation, args...)\n    cmd.Dir = currentDir\n    cmd.Stdout = os.Stdout\n    cmd.Stderr = os.Stderr\n\n    stdin, err := cmd.StdinPipe()\n    if err != nil {\n        fmt.Println(err) \n    }\n    defer stdin.Close()\n    err = cmd.Start()\n    if err != nil {\n        fmt.Println(err) \n        return\n    }\n\n    time.Sleep(5 * time.Second)\n    io.WriteString(stdin, \"&lt;Username&gt;\\n\")\n    time.Sleep(3 * time.Second)\n    io.WriteString(stdin, \"&lt;Password&gt;\\n\")\n\n    err = cmd.Wait()\n    if err != nil {\n        fmt.Println(err) \n        return\n    }\n\n    fmt.Println(\"Succeeded.\\n\")\n\n}\n</code></pre>\n"}, {"tags": ["go", "revel"], "comments": [{"owner": {"reputation": 3417, "user_id": 5463877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e88da9f0b09bd7ddb86d1336e75980fd?s=128&d=identicon&r=PG", "display_name": "Xiaomin Wu", "link": "https://stackoverflow.com/users/5463877/xiaomin-wu"}, "edited": false, "score": 0, "creation_date": 1449706482, "post_id": 34190020, "comment_id": 56129353, "body": "did you setup your workspace properly?"}, {"owner": {"reputation": 750, "user_id": 1748069, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/QOMeY.jpg?s=128&g=1", "display_name": "Matthew S", "link": "https://stackoverflow.com/users/1748069/matthew-s"}, "reply_to_user": {"reputation": 3417, "user_id": 5463877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e88da9f0b09bd7ddb86d1336e75980fd?s=128&d=identicon&r=PG", "display_name": "Xiaomin Wu", "link": "https://stackoverflow.com/users/5463877/xiaomin-wu"}, "edited": false, "score": 0, "creation_date": 1449772600, "post_id": 34190020, "comment_id": 56162825, "body": "yes it&#39;s correct. the package command outputs the zipped folder to the current directory."}], "answers": [{"comments": [{"owner": {"reputation": 750, "user_id": 1748069, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/QOMeY.jpg?s=128&g=1", "display_name": "Matthew S", "link": "https://stackoverflow.com/users/1748069/matthew-s"}, "edited": false, "score": 0, "creation_date": 1449786198, "post_id": 34209979, "comment_id": 56170146, "body": "Like I said, I revoke the question. It&#39;s working just fine. Thanks."}], "tags": [], "owner": {"reputation": 3417, "user_id": 5463877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e88da9f0b09bd7ddb86d1336e75980fd?s=128&d=identicon&r=PG", "display_name": "Xiaomin Wu", "link": "https://stackoverflow.com/users/5463877/xiaomin-wu"}, "is_accepted": false, "score": -1, "last_activity_date": 1449776731, "last_edit_date": 1449776731, "creation_date": 1449775138, "answer_id": 34209979, "question_id": 34190020, "link": "https://stackoverflow.com/questions/34190020/running-revel-package-on-windows-fails/34209979#34209979", "title": "Running Revel package on windows fails", "body": "<p>i would think you should place your source code under \"%GOPATH%\\src\",  but you are running your app under \"C:\\app\". are you sure you are working at the right folder?</p>\n\n<p>another thing i notice is, you should run your revel app with revel command. I don`t think \"go run\" will compatible with revel.</p>\n\n<p><a href=\"https://github.com/shrimpy/reveltry\" rel=\"nofollow\">Here is a sample revel app repo</a> that runs on Azure App Service (OS is windows). Please reference <a href=\"https://github.com/shrimpy/reveltry/blob/master/RevelDeploy.cmd\" rel=\"nofollow\">RevelDeploy.cmd</a> and <a href=\"https://github.com/shrimpy/reveltry/blob/master/CustomRun.bat\" rel=\"nofollow\">CustomRun.bat</a>, should be able to provide you some guidance.</p>\n"}], "owner": {"reputation": 750, "user_id": 1748069, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/QOMeY.jpg?s=128&g=1", "display_name": "Matthew S", "link": "https://stackoverflow.com/users/1748069/matthew-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 401, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1449776731, "creation_date": 1449699295, "last_edit_date": 1449701247, "question_id": 34190020, "link": "https://stackoverflow.com/questions/34190020/running-revel-package-on-windows-fails", "title": "Running Revel package on windows fails", "body": "<p>When I run my packaged Revel app on Windows I get the following error:</p>\n\n<p>C:\\app>go run main.go\nERROR 2015/12/09 16:02:21 revel.go:276: Failed to import  with error: import \"\": invalid import path\nexit status 1</p>\n\n<p>I'm running version: v0.12.0 </p>\n\n<p>Is this a known issue?</p>\n\n<p>UPDATE:\nI revoke this question. Works perfectly well. Packaged artifacts from running (revel package appname) go to current directory. It was creating main.go in my apps's src directory, but this isn't valid.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1449698749, "post_id": 34189401, "comment_id": 56126119, "body": "The <a href=\"https://golang.org/pkg/bufio/#pkg-constants\" rel=\"nofollow noreferrer\">maximum scanner token size</a> is 64k. There&#39;s an <a href=\"https://golang.org/pkg/bufio/#example_Scanner_lines\" rel=\"nofollow noreferrer\">example of how to use the Scanner in the docs</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1449749099, "post_id": 34189401, "comment_id": 56147572, "body": "You can&#39;t test this by pasting text into a terminal. In cooked mode the tty has a hard coded input buffer in the kernel, usually 4096 on Linux and 1024 on Darwin."}, {"owner": {"reputation": 1739, "user_id": 57357, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/46b892c9b15be26fec41fe9112410d5f?s=128&d=identicon&r=PG", "display_name": "Dan Tanner", "link": "https://stackoverflow.com/users/57357/dan-tanner"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449758571, "post_id": 34189401, "comment_id": 56153897, "body": "Argh - thanks JimB.  I was unaware of this, and that&#39;s what was tripping me up.  It was confusing because my terminal tool (iTerm on Darwin) allows more than 1024 chars when not running as part of a command."}], "answers": [{"comments": [{"owner": {"reputation": 1739, "user_id": 57357, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/46b892c9b15be26fec41fe9112410d5f?s=128&d=identicon&r=PG", "display_name": "Dan Tanner", "link": "https://stackoverflow.com/users/57357/dan-tanner"}, "edited": false, "score": 0, "creation_date": 1449711736, "post_id": 34189446, "comment_id": 56130936, "body": "Thanks sberry - I tried the suggestion and am still having a problem.  If you have time please see my updated code."}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": false, "score": 5, "last_activity_date": 1449696942, "creation_date": 1449696942, "answer_id": 34189446, "question_id": 34189401, "link": "https://stackoverflow.com/questions/34189401/go-how-increase-maximum-stdin-input-length/34189446#34189446", "title": "Go - How increase maximum Stdin input length?", "body": "<p>You are ignoring the return value of <code>scanner.Scan()</code> which is a <code>bool</code> indicating whether you have reached the end.</p>\n\n<p>Specifically:</p>\n\n<blockquote>\n  <p>It returns false when the scan stops, either by reaching the end of\n  the input or an error. After Scan returns false, the Err method will\n  return any error that occurred during scanning, except that if it was\n  io.EOF, Err will return nil.</p>\n</blockquote>\n\n<p>So you need to continue running <code>scanner.Scan()</code> in a loop, until it returns false, then check <code>.Err()</code> to ensure you didn't stop scanning because of a non-EOF error.</p>\n"}, {"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1449699359, "post_id": 34189925, "comment_id": 56126449, "body": "ReadString or ReadBytes does this for you (from the ReadLine doc: &quot;Most callers should use ReadBytes(&#39;\\n&#39;) or ReadString(&#39;\\n&#39;) instead or use a Scanner.&quot;)"}, {"owner": {"reputation": 1739, "user_id": 57357, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/46b892c9b15be26fec41fe9112410d5f?s=128&d=identicon&r=PG", "display_name": "Dan Tanner", "link": "https://stackoverflow.com/users/57357/dan-tanner"}, "edited": false, "score": 0, "creation_date": 1449711828, "post_id": 34189925, "comment_id": 56130962, "body": "Thanks FogleBird - I tried a variation of your suggestion and still had the same issue as I mentioned above."}], "tags": [], "owner": {"reputation": 65147, "user_id": 90308, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7b7aefbc459629eb4c864b825894c9c4?s=128&d=identicon&r=PG", "display_name": "FogleBird", "link": "https://stackoverflow.com/users/90308/foglebird"}, "is_accepted": false, "score": 0, "last_activity_date": 1449698953, "creation_date": 1449698953, "answer_id": 34189925, "question_id": 34189401, "link": "https://stackoverflow.com/questions/34189401/go-how-increase-maximum-stdin-input-length/34189925#34189925", "title": "Go - How increase maximum Stdin input length?", "body": "<p>You can do this instead of using <code>Scanner</code>...</p>\n\n<pre><code>reader := bufio.NewReaderSize(os.Stdin, 65536)\nline, isPrefix, err := reader.ReadLine()\n</code></pre>\n\n<p>Write a helper function to keep reading until you've read a complete line...</p>\n\n<pre><code>func ReadLine(reader *bufio.Reader) (string, error) {\n    result := \"\"\n    for {\n        line, isPrefix, err := reader.ReadLine()\n        if err != nil {\n            return result, err\n        }\n        result += string(line)\n        if !isPrefix {\n            return result, nil\n        }\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1739, "user_id": 57357, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/46b892c9b15be26fec41fe9112410d5f?s=128&d=identicon&r=PG", "display_name": "Dan Tanner", "link": "https://stackoverflow.com/users/57357/dan-tanner"}, "edited": false, "score": 0, "creation_date": 1449758897, "post_id": 34193703, "comment_id": 56154123, "body": "Marking this as the answer because it cleans up the sample code nicely, so thanks for that.  JimB&#39;s comment in the question was also my problem. i.e. This situation: <a href=\"http://unix.stackexchange.com/questions/131105/how-to-read-over-4k-input-without-new-lines-on-a-terminal\" title=\"how to read over 4k input without new lines on a terminal\">unix.stackexchange.com/questions/131105/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1125, "user_id": 4224724, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XMleNi8A3cE/AAAAAAAAAAI/AAAAAAAACzU/_LZ3Rgct8Xk/photo.jpg?sz=128", "display_name": "Danver Braganza", "link": "https://stackoverflow.com/users/4224724/danver-braganza"}, "is_accepted": true, "score": 1, "last_activity_date": 1449722545, "last_edit_date": 1449722545, "creation_date": 1449721783, "answer_id": 34193703, "question_id": 34189401, "link": "https://stackoverflow.com/questions/34189401/go-how-increase-maximum-stdin-input-length/34193703#34193703", "title": "Go - How increase maximum Stdin input length?", "body": "<p>The main problem with this code is that the return value of scanner.Scan is not <code>true</code> if the scanner is done, but <code>true</code> if the scanner is not done.</p>\n\n<p>While we're fixing that, let's tidy up another thing, since you don't need to use </p>\n\n<pre><code>if done == true\n</code></pre>\n\n<p>but can simply do</p>\n\n<pre><code>if done\n</code></pre>\n\n<p>Also, remember that <code>done = Scanner.Text()</code>, and serves as the terminating condition, and we can tidy up the code really nicely with:</p>\n\n<pre><code>for scanner.Scan() { // This does what you want, looping until scanner\n                     // is no longer true.\n    buffer.WriteString(scanner.Text())\n}\nif err := scanner.Err(); err != nil {           // Let's hold on to err...\n    log.Fatalf(\"Error scanning input: %s\", err) // and use it here.\n}\n</code></pre>\n\n<p>You get to discard a lot of lines, and you only check Err() once at the end of the loop. No need to use break.</p>\n\n<p>Hope that works for you, and send me a line if you need something else.</p>\n\n<p>Edit: Two more things to be aware of. </p>\n\n<p>1) <code>bufio.Scanner.Scan()</code> will be eating all your separator tokens. Maybe that's okay, or maybe you want to keep adding them back in.</p>\n\n<p>2) <code>bufio.Scanner.Scan()</code> may panic if your SplitFunc is wrong, or someone is crafting poor input for your SplitFunc, and <code>bytes.Buffer.WriteString()</code> may panic if the buffer gets too large. If you're using these in a production system, make sure that you handle these panics in whatever way makes sense.</p>\n"}], "owner": {"reputation": 1739, "user_id": 57357, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/46b892c9b15be26fec41fe9112410d5f?s=128&d=identicon&r=PG", "display_name": "Dan Tanner", "link": "https://stackoverflow.com/users/57357/dan-tanner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1241, "favorite_count": 1, "accepted_answer_id": 34193703, "answer_count": 3, "score": 3, "last_activity_date": 1449722545, "creation_date": 1449696786, "last_edit_date": 1449711684, "question_id": 34189401, "link": "https://stackoverflow.com/questions/34189401/go-how-increase-maximum-stdin-input-length", "title": "Go - How increase maximum Stdin input length?", "body": "<p>What's the recommended way to allow more than 1024 characters when reading from standard input in Go?</p>\n\n<p>For example, this code using <code>bufio.Scanner</code> has a maximum input length of 1024.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    scanner := bufio.NewScanner(os.Stdin)\n    scanner.Scan()\n    input := scanner.Text()\n    fmt.Println(input)\n}\n</code></pre>\n\n<p>Update after some suggested answers...\nSorry guys - I must still be doing something wrong, or misstated the question.  I tried both suggestions and still see the same issue.  Below is an updated version of the code.  The symptom is that the scanner won't accept input after the 1024th character. e.g. Try to run this then paste in a string that's 1025 characters long, and it'll stop accepting input after character 1024. </p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"bytes\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    var buffer bytes.Buffer\n    scanner := bufio.NewScanner(os.Stdin)\n\n    for {\n        done := scanner.Scan()\n        buffer.WriteString(scanner.Text())\n        if done == true {\n            if scanner.Err() != nil {\n                log.Fatal(\"Error scanning input\")\n            }\n            break\n        }\n    }\n    fmt.Println(buffer.String())\n}\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1449687228, "post_id": 34186710, "comment_id": 56119837, "body": "You can do it with either maps or structs. What have you tried, and what errors have you received?"}], "answers": [{"comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 1, "creation_date": 1449695956, "post_id": 34187044, "comment_id": 56124622, "body": "this isn&#39;t a question about unmarshalling."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1449696164, "post_id": 34187044, "comment_id": 56124741, "body": "@hobbs good catch, I think you&#39;re right. I&#39;ll update for the OP. I gave him most of what is necessary already anyway."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 4, "last_activity_date": 1449696346, "last_edit_date": 1449696346, "creation_date": 1449688199, "answer_id": 34187044, "question_id": 34186710, "link": "https://stackoverflow.com/questions/34186710/how-do-i-create-this-this-json-object/34187044#34187044", "title": "How do I create this this JSON object?", "body": "<p>In Go you can unmarshal into a variety of different structures. The most ambiguous being an <code>interface{}</code>. I recommend against that though as you forgo the opportunity to have any real type safety. The other extreme is to use structs, for your example json they would look like this;</p>\n\n<pre><code>type Wrapper struct {\n    Query Query `json:\"query\"`\n}\n\ntype Query struct {\n    QueryString QueryString `json:\"query_string\"`\n}\n\ntype QueryString struct {\n     Query string `json:\"query\"`\n}\n</code></pre>\n\n<p>Something in the middle, given you example json would be a <code>map[string]map[string]map[string]</code>. Check out the example here if you don't know how to make use of the <code>encoding/json</code> package. <a href=\"https://golang.org/pkg/encoding/json/#example_Unmarshal\" rel=\"nofollow\">https://golang.org/pkg/encoding/json/#example_Unmarshal</a></p>\n\n<p>It's pretty straight forward, if you have your input in a <code>[]byte</code> and then you instantiate the type you want to unmarshal it into you can just call <code>json.Unmarhsal(jsonBytes, &amp;ThingToUnmarshalInto)</code></p>\n\n<p>EDIT: based on hobbs' comment it appears you're actually trying to make that json to send to the server. In which case, use the structs above. The example supplied in the other answer demonstrates everything you need. Everything is pretty much the same as I described above except you're calling <code>json.Marshal</code> with an instance of what you want to be turned in to a json string, rather than taking the json string as a <code>[]byte</code> and passing it into unmarshal to get a struct. I mistakenly thought you were receiving that json, not trying to form it.</p>\n"}, {"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 3, "last_activity_date": 1449699478, "creation_date": 1449699478, "answer_id": 34190064, "question_id": 34186710, "link": "https://stackoverflow.com/questions/34186710/how-do-i-create-this-this-json-object/34190064#34190064", "title": "How do I create this this JSON object?", "body": "<p>Here's an example on <a href=\"http://play.golang.org/p/4ZTQrxE7qm\" rel=\"nofollow\">Play</a> using both the map way and the struct way.</p>\n\n<p>As you can see, the map form is less code in general and more clear if you need to send one off requests like this.   </p>\n\n<p>Struct form will tend to be more performant and possibly more clear if there are a lot of nested or shared types in your requests.  If you end up going the struct route, you would likely want something that resembles evanmcdonnal's answer.  I used anonymous structs here for brevity.</p>\n\n<pre><code>package main\n\nimport \"encoding/json\"\nimport \"log\"\n\ntype M map[string]interface{}\n\ntype Query struct {\n    Query struct {\n        QueryString struct {\n            Query string `json:\"query\"`\n        } `json:\"query_string\"`\n    } `json:\"query\"`\n}\n\nfunc main() {\n    b, err := json.Marshal(M{\"query\": M{\"query_string\": M{\"query\": \"query goes here\"}}})\n    if err != nil {\n        log.Fatalln(err)\n    }\n    log.Println(\"   As Map:\", string(b))\n\n\n    var q Query\n    q.Query.QueryString.Query = \"query in a struct\"\n    b, err = json.Marshal(q)\n    if err != nil {\n        log.Fatalln(err)\n    }\n    log.Println(\"As Struct:\", string(b))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 1, "last_activity_date": 1449729953, "creation_date": 1449729953, "answer_id": 34195394, "question_id": 34186710, "link": "https://stackoverflow.com/questions/34186710/how-do-i-create-this-this-json-object/34195394#34195394", "title": "How do I create this this JSON object?", "body": "<p><code>Anonymous Struct</code> is one of nice features of Go. This is an equivalent Go <code>struct</code> for your <code>JSON</code> to get marshaled/unmarshaled to/from using <em>encoding/json</em> package:</p>\n\n<pre><code>type MyType struct {\n    Query struct {\n        QueryString struct {\n            Query string `json:\"query\"`\n        } `json:\"query_string\"`\n    } `json:\"query\"`\n}\n</code></pre>\n\n<p>And yes, you could just use a typed variable without introducing a new type (if this is proper to use in your case):</p>\n\n<pre><code>var myVar struct {\n    Query struct {\n        QueryString struct {\n            Query string `json:\"query\"`\n        } `json:\"query_string\"`\n    } `json:\"query\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 373, "user_id": 5641538, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/8b268f431d5fa6d9f3fc10e059d995a2?s=128&d=identicon&r=PG&f=1", "display_name": "devinov", "link": "https://stackoverflow.com/users/5641538/devinov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11636, "favorite_count": 1, "answer_count": 3, "score": 5, "last_activity_date": 1610957216, "creation_date": 1449687002, "last_edit_date": 1610957216, "question_id": 34186710, "link": "https://stackoverflow.com/questions/34186710/how-do-i-create-this-this-json-object", "title": "How do I create this this JSON object?", "body": "<pre><code>{\n  \"query\": {\n    \"query_string\": {\n      \"query\": \"&lt;query string&gt;\"\n    }\n  }\n}\n</code></pre>\n\n<p>The API I'm using requires that I send my queries in this format. I've been trying to find a way to to create this using maps but I keep getting errors and haven't been able to find any solutions online. </p>\n\n<p>Edit: I found a way to do it, is there a better way?</p>\n\n<pre><code>    test := map[string]map[string]map[string]string {\n        \"query\": map[string]map[string]string {\n            \"query_string\": map[string]string{\n                \"query\": query,\n             },\n        },\n    }\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1449685787, "post_id": 34186071, "comment_id": 56118951, "body": "It&#39;s not that it isn&#39;t allowed, or that neither path may have been executed, it&#39;s simply that Go is lexically scoped using blocks (doesn&#39;t have anything to do with the type system either)"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449686028, "post_id": 34186071, "comment_id": 56119113, "body": "@JimB good point, that was poor wording. You know what I mean, but it&#39;s technically wrong. Maybe I&#39;ll edit, maybe your comment is sufficient."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 2, "last_activity_date": 1449686572, "last_edit_date": 1449686572, "creation_date": 1449684869, "answer_id": 34186071, "question_id": 34186008, "link": "https://stackoverflow.com/questions/34186008/undefined-variable-in-go/34186071#34186071", "title": "Undefined variable in Go", "body": "<p>It's because you declare it in a switch statement. There is no guarantee that either will have been defined by the time the <code>err := c.BindJSON(&amp;req)</code> line executes. You may know, based on some outside understanding of the input, that won't happen but the compiler cannot. The variables you declare within each case statement are therefor scoped for that statement.</p>\n\n<p>You just need to do a little refactoring. You could move this <code>err := c.BindJSON(&amp;req)</code> into the case statements. You could use an interface to declare the variable more generically and deal with it's type later on ect. Do what you think reads best. Likely you've encountered this in other languages with somewhat similar type systems (same happens in C, C++, C# and Java for example).</p>\n"}, {"comments": [{"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1449685660, "post_id": 34186098, "comment_id": 56118867, "body": "Thanks for this - I forgot to show that I call <code>req</code> further down too so I&#39;m still going to be left with the same error. Could you amend your answer slightly? I&#39;ve updated my code sample."}], "tags": [], "owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "is_accepted": false, "score": 2, "last_activity_date": 1449684953, "creation_date": 1449684953, "answer_id": 34186098, "question_id": 34186008, "link": "https://stackoverflow.com/questions/34186008/undefined-variable-in-go/34186098#34186098", "title": "Undefined variable in Go", "body": "<p>Move your <code>BindJSON</code> logic into the <code>switch</code> statement:</p>\n\n<pre><code>var err error\nswitch path {\ncase \"user.save\":\n    var req SaveRequest\n    err = c.BindJSON(&amp;req)\ncase \"user.update\": \n    var req UpdateRequest\n    err = c.BindJSON(&amp;req)\n}\n\nif  err != nil {\n    c.JSON(http.StatusOK, gin.H{\"error_code\": \"SERVER_ERROR\", \"message\": \"Request is not valid JSON\"})\n    return   \n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1449686195, "post_id": 34186448, "comment_id": 56119199, "body": "Thanks - yes I understand scope. I&#39;m just not sure how to best structure the code in this instance!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1449686349, "post_id": 34186448, "comment_id": 56119289, "body": "@tommyd456: if you want <code>req</code> to possibly be multiple types, you need to use an <code>interface{}</code> (or a more specific common interface if there is one)"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1449686457, "post_id": 34186448, "comment_id": 56119348, "body": "Thanks - I didn&#39;t know about using <code>interface{}</code> in that way."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1449686211, "last_edit_date": 1449686211, "creation_date": 1449686054, "answer_id": 34186448, "question_id": 34186008, "link": "https://stackoverflow.com/questions/34186008/undefined-variable-in-go/34186448#34186448", "title": "Undefined variable in Go", "body": "<p>Go is <a href=\"https://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow\">lexically scoped using blocks</a>. This means that the declarations of <code>req</code> are only visible within their code block, the <code>case</code> block in this instance.</p>\n\n<p>You need to declare <code>req</code> in the same scope, or an outer scope, from where you want to use it. </p>\n\n<pre><code>var req interface{}\nswitch path {\ncase \"user.save\":\n    req = &amp;SaveRequest{}\ncase \"user.update\": \n    req = &amp;UpdateRequest{}\n}\n\nerr := c.BindJSON(req)\n</code></pre>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 711, "favorite_count": 0, "accepted_answer_id": 34186448, "answer_count": 3, "score": -1, "last_activity_date": 1449686572, "creation_date": 1449684705, "last_edit_date": 1449685581, "question_id": 34186008, "link": "https://stackoverflow.com/questions/34186008/undefined-variable-in-go", "title": "Undefined variable in Go", "body": "<p>I'm getting an error: <strong>undefined: req</strong> during compilation. I understand why I'm getting the error but I'm not sure how to overcome it. This is my code: </p>\n\n<pre><code>switch path {\ncase \"user.save\":\n    var req SaveRequest\ncase \"user.update\": \n    var req UpdateRequest\n}\n\nerr := c.BindJSON(&amp;req)\nif  err != nil {\n    c.JSON(http.StatusOK, gin.H{\"error_code\": \"SERVER_ERROR\", \"message\": \"Request is not valid JSON\"})\n    return   \n}\n\nc.Set(\"req\", req)\n</code></pre>\n\n<p>I'm trying to parse JSON requests and then add them to the context. I reaslise that if I define my <code>req</code> variable before the <code>switch</code> statement then this should overcome the problem but I don't know what type to declare it as initially?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 5660432, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-82BrdnWDfaw/AAAAAAAAAAI/AAAAAAAAWRM/LmDE-Hcs1z8/photo.jpg?sz=128", "display_name": "Alexander Balakersky", "link": "https://stackoverflow.com/users/5660432/alexander-balakersky"}, "edited": false, "score": 0, "creation_date": 1449761743, "post_id": 34185810, "comment_id": 56156081, "body": "I ended up using Ainar-G&#39;s version to save on typing. But i have tested with both answers.  Thank you both for your help"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 1, "last_activity_date": 1449683997, "creation_date": 1449683997, "answer_id": 34185810, "question_id": 34185677, "link": "https://stackoverflow.com/questions/34185677/golang-issue-with-reusing-variable-outside-of-if-for-loops/34185810#34185810", "title": "golang issue with reusing variable outside of if/for loops", "body": "<p><code>os.Stdout</code> is an <code>io.Writer</code> too, so you can simplify your code to</p>\n\n<pre><code>w := bufio.NewWriter(os.Stdout)\nif *logFile == \"yes\" {\n    // ...\n    w = bufio.NewWriter(f)\n}\n\nfor _, v := range mySlice {\n        fmt.Fprintln(w, v)\n}\nw.Flush()\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 5660432, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-82BrdnWDfaw/AAAAAAAAAAI/AAAAAAAAWRM/LmDE-Hcs1z8/photo.jpg?sz=128", "display_name": "Alexander Balakersky", "link": "https://stackoverflow.com/users/5660432/alexander-balakersky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 0, "accepted_answer_id": 34185810, "answer_count": 1, "score": 1, "last_activity_date": 1449684272, "creation_date": 1449683602, "question_id": 34185677, "link": "https://stackoverflow.com/questions/34185677/golang-issue-with-reusing-variable-outside-of-if-for-loops", "title": "golang issue with reusing variable outside of if/for loops", "body": "<p>I am new to Go and have been working through different issues I am having with the code I am trying to write. One problem though has me scratching my head. I have been searching net but so far did not find a way to solve this.</p>\n\n<p>As you will see in the below code, I am using <code>flag</code> to specify whether to create log file or not. The problem I am running into is that if I put <code>w := bufio.NewWriter(f)</code> inside the <code>if</code> loop then <code>w</code> is inaccessible from the following <code>for</code> loop. If I leave it outside of the <code>if</code> loop then <code>buffio</code> cannot access <code>f</code>. </p>\n\n<p>I know I am missing something dead simple, but I am at a loss at this moment. </p>\n\n<p>Does anyone have any suggestions?</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"flag\"\n    \"fmt\"\n    \"os\"\n    \"time\"\n    \"path/filepath\"\n    \"strconv\"\n)\n\nvar (\n    logFile = flag.String(\"file\", \"yes\", \"Save output into file\")\n    t      = time.Now()\n    dir, _ = filepath.Abs(filepath.Dir(os.Args[0]))\n)\n\nfunc main() {\n    flag.Parse()\n\n    name := dir + \"/\" + \"output_\" + strconv.FormatInt(t.Unix(), 10) + \".log\"\n\n    if *logFile == \"yes\" {\n        f, err := os.Create(name)\n        if err != nil {\n            panic(err)\n        }\n        defer f.Close()\n    }\n    w := bufio.NewWriter(f)\n\n    for _, v := range my_slice {\n        switch {\n        case *logFile == \"yes\":\n            fmt.Fprintln(w, v)\n        case *logFile != \"yes\":\n            fmt.Println(v)\n        }\n    }\n    w.Flush()\n}\n</code></pre>\n"}, {"tags": ["go", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 427, "user_id": 2745493, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/vNkb0.png?s=128&g=1", "display_name": "CobbLiu", "link": "https://stackoverflow.com/users/2745493/cobbliu"}, "edited": false, "score": 0, "creation_date": 1449714472, "post_id": 34181821, "comment_id": 56131675, "body": "This code just passed compile. It crashed when run it. :("}], "tags": [], "owner": {"reputation": 427, "user_id": 2745493, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/vNkb0.png?s=128&g=1", "display_name": "CobbLiu", "link": "https://stackoverflow.com/users/2745493/cobbliu"}, "is_accepted": false, "score": 0, "last_activity_date": 1449672707, "creation_date": 1449672707, "answer_id": 34181821, "question_id": 34181584, "link": "https://stackoverflow.com/questions/34181584/cgo-how-to-pass-a-2-dimensional-slice-to-c-function/34181821#34181821", "title": "CGo: how to pass a 2 dimensional slice to C function", "body": "<p>Solved by:<br>\n<code>C.fill_2d_array((*[16]C.char)(unsafe.Pointer(&amp;dirs)))</code></p>\n"}], "owner": {"reputation": 427, "user_id": 2745493, "user_type": "registered", "accept_rate": 12, "profile_image": "https://i.stack.imgur.com/vNkb0.png?s=128&g=1", "display_name": "CobbLiu", "link": "https://stackoverflow.com/users/2745493/cobbliu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 235, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1449672707, "creation_date": 1449672091, "question_id": 34181584, "link": "https://stackoverflow.com/questions/34181584/cgo-how-to-pass-a-2-dimensional-slice-to-c-function", "title": "CGo: how to pass a 2 dimensional slice to C function", "body": "<p>My code is:  </p>\n\n<pre><code>package main\n\n/*                                                                                                                                                                                                                \n#include &lt;stdio.h&gt;                                                                                                                                                                                                \n#include &lt;string.h&gt;                                                                                                                                                                                               \n\nvoid fill_2d_array(char (*s)[16]) {                                                                                                                                                                               \n    strcpy(s[0], \"hello\");                                                                                                                                                                                        \n    strcpy(s[1],\"cgo\");                                                                                                                                                                                           \n}                                                                                                                                                                                                                 \n*/\nimport \"C\"\nimport \"fmt\"\nimport \"unsafe\"\n\nfunc main() {\n        dirs := make([][]byte, 4)\n        for i := 0; i &lt; 4; i++ {\n            dirs[i] = make([]byte, 16)\n        }\n        C.fill_2d_array(((*C.char)[16])(unsafe.Pointer(&amp;dirs)))\n\n        fmt.Println(dirs)\n}\n</code></pre>\n\n<p>When I run with <code>go run test.go</code>, it failed and said:  </p>\n\n<pre><code>./test.go:21: type *C.char is not an expression\n</code></pre>\n\n<p>My Question is how to pass a 2 dimensional slice to a C function like <code>fill_2d_array</code> above?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "redis"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449671782, "post_id": 34180858, "comment_id": 56109022, "body": "If you&#39;re getting an error about a closed connection, you need to reconnect to the DB. Shouldn&#39;t have anything to do with the SETEX command (which by the way is superseded in newer versions by using SET with options)"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449671941, "post_id": 34180858, "comment_id": 56109146, "body": "I&#39;ve added my code to show how I manage the Redis connection - are there any obvious issues with it at all? Thanks for the info on the SET (with options) command."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449672190, "post_id": 34180858, "comment_id": 56109359, "body": "I can&#39;t tell from the code out of context where the defer will happen, but you should keep connections around and reuse them whenever possible. Usually you want a <a href=\"https://godoc.org/github.com/garyburd/redigo/redis#Pool\" rel=\"nofollow noreferrer\"><code>redis.Pool</code></a>. See my answer here as well: <a href=\"http://stackoverflow.com/questions/30244080/sharing-redis-settings-across-routes/30244721#30244721\" title=\"sharing redis settings across routes\">stackoverflow.com/questions/30244080/&hellip;</a>"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449672369, "post_id": 34180858, "comment_id": 56109487, "body": "Great - I wasn&#39;t sure when i would need a pool but I guess it&#39;s now."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449672869, "post_id": 34180858, "comment_id": 56109909, "body": "If @JimB&#39;s answer does not work, then run the application with the <a href=\"http://blog.golang.org/race-detector\" rel=\"nofollow noreferrer\">race detector</a> and read the Redigo documentation <a href=\"https://godoc.org/github.com/garyburd/redigo/redis#hdr-Concurrency\" rel=\"nofollow noreferrer\">regarding concurrency</a>."}], "answers": [{"comments": [{"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1449673205, "post_id": 34181762, "comment_id": 56110176, "body": "So as you pointed out in the other answer I just use something like <code>conn = pool.Get()</code> each time I need a new connection?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1449673652, "post_id": 34181762, "comment_id": 56110470, "body": "@tommyd456: yes, every time you need a connection you call <code>pool.Get()</code>, and then call <code>conn.Close</code> to return the connection to the pool."}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1449673702, "post_id": 34181762, "comment_id": 56110507, "body": "I assume it&#39;s prefable to defer the close operation"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1449673863, "post_id": 34181762, "comment_id": 56110620, "body": "And also, as this is an API I&#39;m making - would I create the connection each time a route is hit just before the Redis operation itself?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1449674219, "post_id": 34181762, "comment_id": 56110894, "body": "@tommyd456: yes, you need to ensure you call Close, or the connection won&#39;t go back into the pool. You get a connection from the pool when you need a connection, and return it when you&#39;re done."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 7, "last_activity_date": 1449672559, "creation_date": 1449672559, "answer_id": 34181762, "question_id": 34180858, "link": "https://stackoverflow.com/questions/34180858/setex-error-use-of-closed-network-connection/34181762#34181762", "title": "SETEX error - &quot;Use of closed network connection&quot;", "body": "<p>You can use a <a href=\"https://godoc.org/github.com/garyburd/redigo/redis#Pool\" rel=\"noreferrer\"><code>redis.Pool</code></a> to manage multiple connections, check that idle connections are alive, and get new connections automatically. You can also do the AUTH step automatically when dialing a new connection:</p>\n\n<pre><code>func newPool(server, password string) *redis.Pool {\n    return &amp;redis.Pool{\n        MaxIdle: 3,\n        IdleTimeout: 240 * time.Second,\n        Dial: func () (redis.Conn, error) {\n            c, err := redis.Dial(\"tcp\", server)\n            if err != nil {\n                return nil, err\n            }\n            if _, err := c.Do(\"AUTH\", password); err != nil {\n                c.Close()\n                return nil, err\n            }\n            return c, err\n        },\n        TestOnBorrow: func(c redis.Conn, t time.Time) error {\n            _, err := c.Do(\"PING\")\n            return err\n        },\n    }\n}\n\nvar (\n    pool *redis.Pool\n    redisServer = flag.String(\"redisServer\", \":6379\", \"\")\n    redisPassword = flag.String(\"redisPassword\", \"\", \"\")\n)\n\nfunc main() {\n    flag.Parse()\n    pool = newPool(*redisServer, *redisPassword)\n    ...\n}\n</code></pre>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3210, "favorite_count": 0, "accepted_answer_id": 34181762, "answer_count": 1, "score": 5, "last_activity_date": 1449672559, "creation_date": 1449670150, "last_edit_date": 1449671874, "question_id": 34180858, "link": "https://stackoverflow.com/questions/34180858/setex-error-use-of-closed-network-connection", "title": "SETEX error - &quot;Use of closed network connection&quot;", "body": "<p>I'm using the following code to execute a SET and EXPIRE from my Go app.</p>\n\n<pre><code>_, err = C.Cache.Do(\"SETEX\", key, 3600, data)\n</code></pre>\n\n<p>but I've started to get an error: <strong>Use of closed network connection</strong>. I use Gary Burd's <a href=\"https://github.com/garyburd/redigo\" rel=\"noreferrer\">Redigo</a> package and RedisLabs.</p>\n\n<p>My code to connect to Redis is:</p>\n\n<pre><code>//Connect to cache (Redis)\ncache, err := connectToCache()\nif err != nil {\n    log.Printf(\"Cache connection settings are invalid\")\n    os.Exit(1)\n}\ndefer cache.Close()\n\nfunc connectToCache() (redis.Conn, error) {\n    cache, err := redis.Dial(\"tcp\", CACHE_URI)\n    if err != nil {\n        return nil, err\n    }\n    _, err = cache.Do(\"AUTH\", CACHE_AUTH)\n    if err != nil {\n        cache.Close()\n        return nil, err\n    }\n    return cache, nil\n}\n</code></pre>\n"}, {"tags": ["logging", "go"], "comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1449668391, "post_id": 34180072, "comment_id": 56106592, "body": "did you check the std packages ? <a href=\"https://godoc.org/log/syslog\" rel=\"nofollow noreferrer\">godoc.org/log/syslog</a> <a href=\"https://godoc.org/log\" rel=\"nofollow noreferrer\">godoc.org/log</a> whats wrong  with the std log"}, {"owner": {"reputation": 315, "user_id": 5412970, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/73b1e43211e66f1f6fc52e3ac90e1acf?s=128&d=identicon&r=PG&f=1", "display_name": "Andre Minov", "link": "https://stackoverflow.com/users/5412970/andre-minov"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1449668722, "post_id": 34180072, "comment_id": 56106795, "body": "@MIkCode  godoc.org/log/syslog  as stayed in Go doc used to log system events and has not possibility to write to file, standart  <a href=\"https://godoc.org/log\" rel=\"nofollow noreferrer\">godoc.org/log</a> has this possibility. but limited in log levels."}, {"owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "edited": false, "score": 0, "creation_date": 1449669990, "post_id": 34180072, "comment_id": 56107650, "body": "Maybe <a href=\"https://github.com/avelino/awesome-go#logging\" rel=\"nofollow noreferrer\">this list</a> helps?"}, {"owner": {"reputation": 1851, "user_id": 762175, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b0aa8cfe6ad2d1060dd861c28343c38c?s=128&d=identicon&r=PG", "display_name": "Ethan Reesor", "link": "https://stackoverflow.com/users/762175/ethan-reesor"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1458149299, "post_id": 34180072, "comment_id": 59734491, "body": "@MIkCode log4j has A) numerous log levels, none of which result in an exception (panic) or exit (fatal), B) lets the developer and/or user configure what levels to actually output C) per zone, where a zone is usually a class"}], "answers": [{"tags": [], "owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "is_accepted": false, "score": 0, "last_activity_date": 1478627158, "last_edit_date": 1478627158, "creation_date": 1478620637, "answer_id": 40491286, "question_id": 34180072, "link": "https://stackoverflow.com/questions/34180072/go-configurable-logger-with-file-logging-possibility/40491286#40491286", "title": "Go configurable logger with file logging possibility", "body": "<p>The std lib <code>log</code> package handles a lot of this for you.  You can either log to STDOUT/STDERR or set the output of the log package itself by doing as follows:</p>\n\n<pre><code>log.SetOutput(&lt;something that implements io.Writer&gt;)\nlog.Println(\"some message\")\n</code></pre>\n\n<p>And depending on what that io.Writer is (i.e. an os.File, net.TCPConn, net.UDPConn, etc) it will log \"some message\" to it.  </p>\n\n<p>This can also be done on a per logger basis like so</p>\n\n<pre><code>logger := log.New(&lt;something that implements io.Writer&gt;, &lt;log prefix string&gt;, &lt;log flags https://golang.org/pkg/log/#pkg-constants&gt;)\nlogger.Println(\"Some message\")\n</code></pre>\n\n<p>This example will accomplish the same thing and add a prefix to each log.  The second example is a struct instead of functions from the package, so that will have to be shared across Goroutines correrctly.  This example can implement log levels by having each level be its own logger instance.</p>\n\n<p>It's also worth taking a look at logrus <a href=\"https://github.com/Sirupsen/logrus\" rel=\"nofollow noreferrer\">https://github.com/Sirupsen/logrus</a> it handles a lot of the boilerplate for you.</p>\n"}, {"tags": [], "owner": {"reputation": 161, "user_id": 11339140, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-_oZaOqfxYFI/AAAAAAAAAAI/AAAAAAAAADw/o9Jcv0YYArU/photo.jpg?sz=128", "display_name": "\u041d\u0438\u043a\u0438\u0444\u043e\u0440 \u0421\u0435\u0440\u044f\u043a\u043e\u0432", "link": "https://stackoverflow.com/users/11339140/%d0%9d%d0%b8%d0%ba%d0%b8%d1%84%d0%be%d1%80-%d0%a1%d0%b5%d1%80%d1%8f%d0%ba%d0%be%d0%b2"}, "is_accepted": false, "score": 0, "last_activity_date": 1575800694, "creation_date": 1575800694, "answer_id": 59234457, "question_id": 34180072, "link": "https://stackoverflow.com/questions/34180072/go-configurable-logger-with-file-logging-possibility/59234457#59234457", "title": "Go configurable logger with file logging possibility", "body": "<p>I dare to recommend you my own logger that supports not just log levels but more granular selection of what to log.</p>\n\n<p><a href=\"https://github.com/nikandfor/tlog#conditional-logging\" rel=\"nofollow noreferrer\">https://github.com/nikandfor/tlog#conditional-logging</a></p>\n"}], "owner": {"reputation": 315, "user_id": 5412970, "user_type": "registered", "accept_rate": 17, "profile_image": "https://www.gravatar.com/avatar/73b1e43211e66f1f6fc52e3ac90e1acf?s=128&d=identicon&r=PG&f=1", "display_name": "Andre Minov", "link": "https://stackoverflow.com/users/5412970/andre-minov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 642, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1575800694, "creation_date": 1449667888, "question_id": 34180072, "link": "https://stackoverflow.com/questions/34180072/go-configurable-logger-with-file-logging-possibility", "title": "Go configurable logger with file logging possibility", "body": "<p>I'm looking for logging library in Go, something similar like log4j in java.</p>\n\n<ol>\n<li><p>As I understood build-in logger from 'log' package have restricted possibility in configurations and log levels.</p></li>\n<li><p>Maybe someone used one of <a href=\"https://godoc.org/github.com/op/go-logging\" rel=\"nofollow\">https://godoc.org/github.com/op/go-logging</a>, <a href=\"https://github.com/cihub/seelog\" rel=\"nofollow\">https://github.com/cihub/seelog</a>?</p></li>\n<li><p>What about concurrency issues? What is the best way to store logger in system? One per program or create loggers every time?</p></li>\n</ol>\n\n<p>Thanks!</p>\n"}, {"tags": ["file-upload", "go", "amazon-s3"], "answers": [{"comments": [{"owner": {"reputation": 907, "user_id": 1279730, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c143e62707810f29f4fb207c1cf797ad?s=128&d=identicon&r=PG", "display_name": "machete", "link": "https://stackoverflow.com/users/1279730/machete"}, "edited": false, "score": 0, "creation_date": 1449689062, "post_id": 34178106, "comment_id": 56120825, "body": "hm looks like I can only use ReaderSeeker for the body which I think implies that direct streaming isn&#39;t possible"}], "tags": [], "owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "is_accepted": false, "score": -2, "last_activity_date": 1449661682, "creation_date": 1449661682, "answer_id": 34178106, "question_id": 34177137, "link": "https://stackoverflow.com/questions/34177137/stream-file-upload-to-aws-s3-using-go/34178106#34178106", "title": "Stream file upload to AWS S3 using go", "body": "<p>I didn't try it but  if i were you id try the multi part upload option .</p>\n\n<p>you can read the doc <a href=\"http://docs.aws.amazon.com/AmazonS3/latest/dev/mpuoverview.html\" rel=\"nofollow\">multipartupload</a> .</p>\n\n<p><a href=\"https://github.com/aws/aws-sdk-go/blob/0d69769150f236a0fee9a372c2faee638f57bba4/service/s3/examples_test.go\" rel=\"nofollow\">here</a>  is go example for multipart upload and multipart upload abort.</p>\n"}, {"tags": [], "owner": {"reputation": 306, "user_id": 3879341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1767df6c85e9574a53d18175be1d6db?s=128&d=identicon&r=PG&f=1", "display_name": "khc", "link": "https://stackoverflow.com/users/3879341/khc"}, "is_accepted": false, "score": 1, "last_activity_date": 1450220509, "creation_date": 1450220509, "answer_id": 34301091, "question_id": 34177137, "link": "https://stackoverflow.com/questions/34177137/stream-file-upload-to-aws-s3-using-go/34301091#34301091", "title": "Stream file upload to AWS S3 using go", "body": "<p>Another option is to mount the S3 bucket with <a href=\"https://github.com/kahing/goofys\" rel=\"nofollow\">goofys</a> and then stream your writes to the mountpoint. goofys does not buffer the content locally so it will work fine with large files.</p>\n"}, {"comments": [{"owner": {"reputation": 1081, "user_id": 1185148, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/bhzy9.jpg?s=128&g=1", "display_name": "meshkati", "link": "https://stackoverflow.com/users/1185148/meshkati"}, "edited": false, "score": 1, "creation_date": 1564574541, "post_id": 34398045, "comment_id": 101075072, "body": "I think it&#39;s not the proper answer, cause here we can&#39;t have control on parts, while the AWS API gives us access to uploads each part separately and send initial/complete/abort upload commands."}, {"owner": {"reputation": 7988, "user_id": 584947, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5c0e998a5b4fdce4f95cbec31e6dab22?s=128&d=identicon&r=PG", "display_name": "anon58192932", "link": "https://stackoverflow.com/users/584947/anon58192932"}, "edited": false, "score": 0, "creation_date": 1596743538, "post_id": 34398045, "comment_id": 111917108, "body": "The example linked here doesn&#39;t actually use <code>PubObject</code> to stream."}], "tags": [], "owner": {"reputation": 1814, "user_id": 2390296, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/54f269214e94a824edf4e32e31ad0a81?s=128&d=identicon&r=PG", "display_name": "koolhead17", "link": "https://stackoverflow.com/users/2390296/koolhead17"}, "is_accepted": true, "score": 7, "last_activity_date": 1450708276, "creation_date": 1450708276, "answer_id": 34398045, "question_id": 34177137, "link": "https://stackoverflow.com/questions/34177137/stream-file-upload-to-aws-s3-using-go/34398045#34398045", "title": "Stream file upload to AWS S3 using go", "body": "<p>you can do this using <a href=\"https://github.com/minio/minio-go\" rel=\"noreferrer\">minio-go</a> :</p>\n\n<pre><code>n, err := s3Client.PutObject(\"bucket-name\", \"objectName\", object, size, \"application/octet-stream\")\n</code></pre>\n\n<p>PutObject() automatically does multipart upload internally. <a href=\"https://github.com/minio/minio-go/blob/master/examples/s3/putobject.go\" rel=\"noreferrer\">Example</a></p>\n"}, {"comments": [{"owner": {"reputation": 8456, "user_id": 1879101, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/knzYU.jpg?s=128&g=1", "display_name": "Vitaly Zdanevich", "link": "https://stackoverflow.com/users/1879101/vitaly-zdanevich"}, "edited": false, "score": 0, "creation_date": 1554299396, "post_id": 55484701, "comment_id": 97700619, "body": "Thank you for the answer. If my file is below 5 MB it still will be streamed to S3? But as I understand anyway this file will appear on S3 only after been fully uploaded?"}, {"owner": {"reputation": 3961, "user_id": 801278, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ba1b768ca6fc39c49d7d8c37930c4ebc?s=128&d=identicon&r=PG", "display_name": "maaz", "link": "https://stackoverflow.com/users/801278/maaz"}, "reply_to_user": {"reputation": 8456, "user_id": 1879101, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/knzYU.jpg?s=128&g=1", "display_name": "Vitaly Zdanevich", "link": "https://stackoverflow.com/users/1879101/vitaly-zdanevich"}, "edited": false, "score": 0, "creation_date": 1554314776, "post_id": 55484701, "comment_id": 97709536, "body": "yes, it will be streamed in one part. correct, the file will appear once fully uploaded."}], "tags": [], "owner": {"reputation": 3961, "user_id": 801278, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ba1b768ca6fc39c49d7d8c37930c4ebc?s=128&d=identicon&r=PG", "display_name": "maaz", "link": "https://stackoverflow.com/users/801278/maaz"}, "is_accepted": false, "score": 22, "last_activity_date": 1554247148, "last_edit_date": 1554247148, "creation_date": 1554246225, "answer_id": 55484701, "question_id": 34177137, "link": "https://stackoverflow.com/questions/34177137/stream-file-upload-to-aws-s3-using-go/55484701#55484701", "title": "Stream file upload to AWS S3 using go", "body": "<p>You can use <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3\" rel=\"noreferrer\">upload manager</a> to stream the file and upload it, you can read comments in <a href=\"https://github.com/aws/aws-sdk-go/blob/master/service/s3/s3manager/upload.go#L162\" rel=\"noreferrer\">source code</a> \nyou can also configure params to set the <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/s3manager/#Uploader\" rel=\"noreferrer\">part size, concurrency &amp; max upload parts</a>, below is a sample code for reference.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n\n    \"github.com/aws/aws-sdk-go/aws/credentials\"\n\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/service/s3/s3manager\"\n)\n\nvar filename = \"file_name.zip\"\nvar myBucket = \"myBucket\"\nvar myKey = \"file_name.zip\"\nvar accessKey = \"\"\nvar accessSecret = \"\"\n\nfunc main() {\n    var awsConfig *aws.Config\n    if accessKey == \"\" || accessSecret == \"\" {\n        //load default credentials\n        awsConfig = &amp;aws.Config{\n            Region: aws.String(\"us-west-2\"),\n        }\n    } else {\n        awsConfig = &amp;aws.Config{\n            Region:      aws.String(\"us-west-2\"),\n            Credentials: credentials.NewStaticCredentials(accessKey, accessSecret, \"\"),\n        }\n    }\n\n    // The session the S3 Uploader will use\n    sess := session.Must(session.NewSession(awsConfig))\n\n    // Create an uploader with the session and default options\n    //uploader := s3manager.NewUploader(sess)\n\n    // Create an uploader with the session and custom options\n    uploader := s3manager.NewUploader(sess, func(u *s3manager.Uploader) {\n        u.PartSize = 5 * 1024 * 1024 // The minimum/default allowed part size is 5MB\n        u.Concurrency = 2            // default is 5\n    })\n\n    //open the file\n    f, err := os.Open(filename)\n    if err != nil {\n        fmt.Printf(\"failed to open file %q, %v\", filename, err)\n        return\n    }\n    //defer f.Close()\n\n    // Upload the file to S3.\n    result, err := uploader.Upload(&amp;s3manager.UploadInput{\n        Bucket: aws.String(myBucket),\n        Key:    aws.String(myKey),\n        Body:   f,\n    })\n\n    //in case it fails to upload\n    if err != nil {\n        fmt.Printf(\"failed to upload file, %v\", err)\n        return\n    }\n    fmt.Printf(\"file uploaded to, %s\\n\", result.Location)\n}\n</code></pre>\n"}], "owner": {"reputation": 907, "user_id": 1279730, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c143e62707810f29f4fb207c1cf797ad?s=128&d=identicon&r=PG", "display_name": "machete", "link": "https://stackoverflow.com/users/1279730/machete"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12884, "favorite_count": 10, "accepted_answer_id": 34398045, "answer_count": 4, "score": 12, "last_activity_date": 1554247148, "creation_date": 1449658912, "question_id": 34177137, "link": "https://stackoverflow.com/questions/34177137/stream-file-upload-to-aws-s3-using-go", "title": "Stream file upload to AWS S3 using go", "body": "<p>I want to stream a multipart/form-data (large) file upload directly to AWS S3 with as little memory and file disk footprint as possible. How can I achieve this? Resources online only explain how to upload a file and store it locally on the server.</p>\n"}, {"tags": ["sql", "database", "go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1449668106, "post_id": 34175299, "comment_id": 56106399, "body": "Important to remember is that Close() has no guarantee of firing, especially if you call <code>defer db.Close()</code>. A SIGTERM signal will terminate the program immediately (unless you catch it) and Close() won&#39;t be called. lib/pq (the most popular Postgres) driver doesn&#39;t seem to hang onto connections when Close() isn&#39;t called, in my experience."}], "answers": [{"tags": [], "owner": {"reputation": 3269, "user_id": 429555, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e970e0e5d130ae179f5cfa9b3079b76?s=128&d=identicon&r=PG", "display_name": "ferhat", "link": "https://stackoverflow.com/users/429555/ferhat"}, "is_accepted": true, "score": 4, "last_activity_date": 1449686843, "last_edit_date": 1449686843, "creation_date": 1449656694, "answer_id": 34176370, "question_id": 34175299, "link": "https://stackoverflow.com/questions/34175299/do-we-need-to-close-db-connection-before-closing-application-in-go/34176370#34176370", "title": "Do we need to close DB connection before closing application in Go?", "body": "<p>DB will do its best to detect but with no luck, it may not be able to detect. Better to release what is acquired as soon as possible.</p>\n\n<p><code>send()</code> system call will wait for TCP connection to send data but client won't receive anything.</p>\n\n<ol>\n<li><p>Power failure, network issue or bare exit happened without properly releasing resources. TCP keepalive mechanism will kick in and try to detect that connection is dead.</p></li>\n<li><p>Client is paused and doesn't receive any data, in this case <code>send()</code> will block.</p></li>\n</ol>\n\n<p>As a result, it may prevent</p>\n\n<ol>\n<li>Graceful shutdown of cluster.</li>\n<li>Advancing event horizon if it was holding exclusive locks as a part of transaction such as <code>auto vacuum</code> in postgresql.</li>\n</ol>\n\n<p>Server keepalive config could be shortened to detect it earlier. (For example, <code>~2h 12m</code> default in postgresql will be very long according to workload).</p>\n\n<p>There may be a hard limit on max open connections, until detection, some connections will be zombie (there, unusable but decreases limit).</p>\n"}, {"tags": [], "owner": {"reputation": 1274, "user_id": 2056908, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e377dc7a85bd71485eb514a49d64e362?s=128&d=identicon&r=PG", "display_name": "mattsch", "link": "https://stackoverflow.com/users/2056908/mattsch"}, "is_accepted": false, "score": 0, "last_activity_date": 1449658023, "creation_date": 1449658023, "answer_id": 34176824, "question_id": 34175299, "link": "https://stackoverflow.com/questions/34175299/do-we-need-to-close-db-connection-before-closing-application-in-go/34176824#34176824", "title": "Do we need to close DB connection before closing application in Go?", "body": "<p>If you're initialising a connection in any function, you're normally better off deferring the call to close immediately, i.e.</p>\n\n<pre><code>conn := sql.Connect() // for example\ndefer conn.Close()\n</code></pre>\n\n<p>Which will close the connection once the enclosing function exits.</p>\n\n<p>This is handy when used in a <code>main</code> function since once the program exits, the call to <code>Close()</code> will happen.</p>\n"}, {"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 2, "last_activity_date": 1449660523, "creation_date": 1449660523, "answer_id": 34177721, "question_id": 34175299, "link": "https://stackoverflow.com/questions/34175299/do-we-need-to-close-db-connection-before-closing-application-in-go/34177721#34177721", "title": "Do we need to close DB connection before closing application in Go?", "body": "<p>The database will notice the connection had died and take appropriate actions: for instance, all uncommitted transactions active on that connection will be rolled back and the user session will be terminated.</p>\n\n<p>But notice that this is a \"recovery\" scenario from the point of view of the database engine: it cannot just throw up when a client disconnects; it rather have to take explicit actions to have consistent state.</p>\n\n<p>On the other hand, to shut down property when the program goes down \"the normal way\" (that is, not because of a panic or <code>log.Fatal()</code>) is really not that hard.  And since the <code>sql.DB</code> instance is usually a program-wide global variable, its even simpler: just try closing it in <code>main()</code> like Matt suggested.</p>\n"}], "owner": {"reputation": 6730, "user_id": 297094, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/08a7e4ec1109264bc3d18a519d15146c?s=128&d=identicon&r=PG", "display_name": "Robert Zaremba", "link": "https://stackoverflow.com/users/297094/robert-zaremba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2555, "favorite_count": 1, "accepted_answer_id": 34176370, "answer_count": 3, "score": 6, "last_activity_date": 1457822125, "creation_date": 1449653819, "last_edit_date": 1457822125, "question_id": 34175299, "link": "https://stackoverflow.com/questions/34175299/do-we-need-to-close-db-connection-before-closing-application-in-go", "title": "Do we need to close DB connection before closing application in Go?", "body": "<p>In Go, when using a SQL database, does one need to close the DB (<code>db.Close</code>) before closing an application? Will the DB automatically detect that the connection has died?</p>\n"}, {"tags": ["arrays", "data-structures", "go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 5, "last_activity_date": 1449642477, "creation_date": 1449642477, "answer_id": 34172108, "question_id": 34172001, "link": "https://stackoverflow.com/questions/34172001/how-to-retrieve-array-of-elements-from-array-of-structure-in-golang/34172108#34172108", "title": "How to retrieve array of elements from array of structure in golang?", "body": "<p>No, go does not provide a lot of helper methods as python or ruby. So you have to iterate over the array of structures and populate your array.</p>\n"}, {"comments": [{"owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1449678406, "post_id": 34174170, "comment_id": 56113984, "body": "@kostya, show off... Since question came from someone new to Go, I wanted to be as explicit as possible. (Less possibility for confusion)"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 1, "creation_date": 1449716299, "post_id": 34174170, "comment_id": 56132110, "body": "it is still part of Go syntax, used fairly often and you have to know about it when you read Go code. It is less explicit but I believe it is worth mentioning, especially to someone who is new to Go."}], "tags": [], "owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "is_accepted": true, "score": 24, "last_activity_date": 1449650312, "creation_date": 1449650312, "answer_id": 34174170, "question_id": 34172001, "link": "https://stackoverflow.com/questions/34172001/how-to-retrieve-array-of-elements-from-array-of-structure-in-golang/34174170#34174170", "title": "How to retrieve array of elements from array of structure in golang?", "body": "<p>Nope, loops are the way to go.</p>\n\n<p>Here's a working example.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype User struct {\n    UserName string\n    Category string\n    Age      int\n}\n\ntype Users []User\n\nfunc (u Users) NameList() []string {\n    var list []string\n    for _, user := range u {\n        list = append(list, user.UserName)\n    }\n    return list\n}\n\nfunc main() {\n    users := Users{\n        User{UserName: \"Bryan\", Category: \"Human\", Age: 33},\n        User{UserName: \"Jane\", Category: \"Rocker\", Age: 25},\n        User{UserName: \"Nancy\", Category: \"Mother\", Age: 40},\n        User{UserName: \"Chris\", Category: \"Dude\", Age: 19},\n        User{UserName: \"Martha\", Category: \"Cook\", Age: 52},\n    }\n\n    UserList := users.NameList()\n\n    fmt.Println(UserList)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10600, "user_id": 869033, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/a2c7db871281fd9b0d07076db5af2662?s=128&d=identicon&r=PG", "display_name": "Nick N.", "link": "https://stackoverflow.com/users/869033/nick-n"}, "is_accepted": false, "score": 3, "last_activity_date": 1567003535, "last_edit_date": 1567003535, "creation_date": 1566562127, "answer_id": 57626056, "question_id": 34172001, "link": "https://stackoverflow.com/questions/34172001/how-to-retrieve-array-of-elements-from-array-of-structure-in-golang/57626056#57626056", "title": "How to retrieve array of elements from array of structure in golang?", "body": "<p>No, not out of the box.</p>\n\n<p>But, there is a <code>Go</code> package which has a lot of helper methods for this.\n<a href=\"https://github.com/ahmetb/go-linq\" rel=\"nofollow noreferrer\">https://github.com/ahmetb/go-linq</a></p>\n\n<p>If you import this you could use:</p>\n\n<pre><code>From(users).SelectT(func(u User) string { return u.UserName })\n</code></pre>\n\n<p>This package is based on C# .NET <code>LINQ</code>, which is perfect for this kind of operations.</p>\n"}], "owner": {"reputation": 720, "user_id": 1752124, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f37430e935542dafdc7f86c6e9fa03e4?s=128&d=identicon&r=PG", "display_name": "ravi", "link": "https://stackoverflow.com/users/1752124/ravi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9406, "favorite_count": 2, "accepted_answer_id": 34174170, "answer_count": 3, "score": 14, "last_activity_date": 1567003535, "creation_date": 1449642072, "last_edit_date": 1449642773, "question_id": 34172001, "link": "https://stackoverflow.com/questions/34172001/how-to-retrieve-array-of-elements-from-array-of-structure-in-golang", "title": "How to retrieve array of elements from array of structure in golang?", "body": "<p>I am new to golang, and got stuck at this. I have an array of structure:</p>\n\n<pre><code>Users []struct {\n   UserName string \n   Category string\n   Age string\n}\n</code></pre>\n\n<p>I want to retrieve all the UserName from this array of structure. So, output would be of type:</p>\n\n<pre><code>UserList []string \n</code></pre>\n\n<p>I know the brute force method of using a loop to retrieve the elements manually and constructing an array from that. Is there any other way to do this?</p>\n"}, {"tags": ["struct", "go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1449624077, "post_id": 34169073, "comment_id": 56085713, "body": "Couple things; can you check the accepts headers on the server? Little search says this will occur if the content-type supplied in the request doesn&#39;t match one in the accepts headers. Secondly, can you please get the body into a string and print it and include that output? It might have something more useful like a message written by one of the API&#39;s developers."}, {"owner": {"reputation": 199, "user_id": 1656401, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/88a8ff7a834711547980d080cca1b5bc?s=128&d=identicon&r=PG", "display_name": "vbatista", "link": "https://stackoverflow.com/users/1656401/vbatista"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1449626014, "post_id": 34169073, "comment_id": 56086268, "body": "@evanmcdonnal tks for your reply. Just inserted the return body on code. I checked on server and it does not expect an <code>Accept</code> header. I tested using postman(using the post body generated by the above code) and it works as expected."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1449626502, "post_id": 34169073, "comment_id": 56086400, "body": "OK, yeah the bit about accepts headers doesn&#39;t make sense, I was thinking they&#39;re coming from the server but that&#39;s in the request. For the body I meant the response body, not the request."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1449627338, "post_id": 34169073, "comment_id": 56086600, "body": "Perhaps the server has a faulty media type parser. Try &quot;application/json;  charset=utf-8&quot;  (note the space after ;) and &quot;application/json&quot;."}, {"owner": {"reputation": 199, "user_id": 1656401, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/88a8ff7a834711547980d080cca1b5bc?s=128&d=identicon&r=PG", "display_name": "vbatista", "link": "https://stackoverflow.com/users/1656401/vbatista"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1449628256, "post_id": 34169073, "comment_id": 56086844, "body": "@CodingPickle @evanmcdonnal: Thanks a lot! Just found the answer. After printing the response.body, I found a message stating that the Content-Type should be set to <code>application&#47;json;charset=UTF-8</code>(in upper case). The original header was set to <code>utf-8</code>(in lower case), which was causing all the trouble. Just realised I really need to take some nap after that. Thanks again!"}], "answers": [{"tags": [], "owner": {"reputation": 199, "user_id": 1656401, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/88a8ff7a834711547980d080cca1b5bc?s=128&d=identicon&r=PG", "display_name": "vbatista", "link": "https://stackoverflow.com/users/1656401/vbatista"}, "is_accepted": true, "score": 3, "last_activity_date": 1449628502, "creation_date": 1449628502, "answer_id": 34169817, "question_id": 34169073, "link": "https://stackoverflow.com/questions/34169073/golang-http-newrequest-invalid-content-type/34169817#34169817", "title": "Golang http.NewRequest: Invalid content-type", "body": "<p>After printing the response body, the following has been returned:</p>\n\n<pre><code>2015/12/09 00:32:11 Response Body {\"httpStatusCode\":415,\"errorCode\":\"415\",\"message\":\"Content-type:[application/json;charset=utf-8] invalido. Utilizar content-type:[application/json;charset=UTF-8]\"}\n</code></pre>\n\n<p>From portuguese: \"Invalid Content-Type. Please use <code>application/json;charset=UTF-8</code>.</p>\n\n<p>The detail was in the case used on <code>UTF-8</code> string, which should be uppercase, not lower as previously. Thanks @evanmcdonnal and @CodingPickle for support.</p>\n"}], "owner": {"reputation": 199, "user_id": 1656401, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/88a8ff7a834711547980d080cca1b5bc?s=128&d=identicon&r=PG", "display_name": "vbatista", "link": "https://stackoverflow.com/users/1656401/vbatista"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3199, "favorite_count": 0, "accepted_answer_id": 34169817, "answer_count": 1, "score": 6, "last_activity_date": 1449649957, "creation_date": 1449623490, "last_edit_date": 1449649957, "question_id": 34169073, "link": "https://stackoverflow.com/questions/34169073/golang-http-newrequest-invalid-content-type", "title": "Golang http.NewRequest: Invalid content-type", "body": "<p>I am trying to post a <code>struct</code> using Go's <code>http.POST</code>, however I am not being succeeded with that.</p>\n\n<p>Please look:</p>\n\n<pre><code>//SKUStock definition\ntype SkuStock struct {\n    Sku string `json:\"id\"`;\n    Quantity int64 `json:\"stockQuantity\"`;\n}\n\ntype StockJson struct {\n    Items []SkuStock `json:\"skus\"`;\n}\n</code></pre>\n\n<p>After loading some data from a database, I have the following, in order to perform the POST itself:</p>\n\n<pre><code>//Sends the skuStock Information to server\nfunc SendSkuData(stockItems []SkuStock) {\n\n//creates a json like {\"skus\":[{\"id\":\"ITEM1576\",\"stockQuantity\":995}]}\n    stockPayload, err := json.Marshal(StockJson{stockItems}); \n    if err != nil {\n        log.Fatal(err);\n    }\n\n    client := &amp;http.Client{}\n\n    apiRequestUrl := os.Getenv(\"api.protocol\") + \"://\" + os.Getenv(\"api.address\") + \"/batch/sku/stock\";\n    req, err := http.NewRequest(\"POST\", apiRequestUrl, bytes.NewBuffer(stockPayload));\n    req.Header.Add(\"Content-Type\", \"application/json;charset=utf-8\");\n    req.SetBasicAuth(os.Getenv(\"api.key\"), \"\");\n\n    log.Printf(\"Request body: %s\", string(stockPayload));\n    log.Printf(\"Request %s\", req);\n\n    resp, err := client.Do(req);\n    if(err != nil) {\n        log.Fatal(err);\n    }\n    defer resp.Body.Close();\n\n    log.Printf(\"Response %s\", resp);\n\n}\n</code></pre>\n\n<p>Unfortunately, the return I get from server is not as expected:</p>\n\n<pre><code>2015/12/08 23:42:47 Request body: {\"skus\":[{\"id\":\"ITEM1576\",\"stockQuantity\":995}]}\n2015/12/08 23:42:47 Request &amp;{POST http://api-sandbox.bonmarketplace.com.br/batch/sku/stock HTTP/1.1 %!s(int=1) %!s(    int=1) map[Authorization:[Basic REMzRjAyNjUwNDE5RDAzQUJBNjEyM0E0QUZCMzJGQUQ6] Content-Type:[application/    json;charset=utf-8]] {{\"skus\":[{\"id\":\"ITEM1576\",\"stockQuantity\":995}]}} %!s(int64=48) [] %!s(bool=false) api-sandbox.    bonmarketplace.com.br map[] map[] %!s(*multipart.Form=&lt;nil&gt;) map[]   %!s(*tls.ConnectionState=&lt;nil&gt;) %!s(&lt;-chan struct     {}=&lt;nil&gt;)}\n2015/12/08 23:42:47 Response &amp;{415 Unsupported Media Type %!s(int=415) HTTP/1.1 %!s(int=1) %!s(int=1) map[Server:[    nginx/1.7.5] Date:[Wed, 09 Dec 2015 01:40:18 GMT] Content-Type:[application/json;charset=utf-8] Content-Length:[163]     Connection:[keep-alive] X-Access-Control-Realm:[external]] %!s(*http.bodyEOFSignal=&amp;{0xc820122000 {0 0} false &lt;nil&gt;     0xd78a0 0xd7840}) %!s(int64=163) [] %!s(bool=false) map[] %!s(*http.Request=&amp;{POST 0xc820064480 HTTP/1.1 1 1 map[Content-    Type:[application/json;charset=utf-8] Authorization:[Basic REMzRjAyNjUwNDE5RDAzQUJBNjEyM0E0QUZCMzJGQUQ6]] {0xc82000e460}     48 [] false api-sandbox.bonmarketplace.com.br map[] map[] &lt;nil&gt; map[]   &lt;nil&gt; &lt;nil&gt;}) %!s(*tls.ConnectionState=&lt;nil&gt;)}\n</code></pre>\n\n<p><strong>Edit</strong>: inserted the post body(first line on program's output). If I run the request on Postman, with this body, it works as expected. Server does not check <code>Accept</code> header, just the <code>Content-Type</code>, which is already set to <code>application/json;charset=utf-8</code>.</p>\n\n<p>What am I doing wrong? I have spent the last hours looking into this, but no luck at all.</p>\n"}, {"tags": ["session", "go", "beego"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1449865516, "post_id": 34167007, "comment_id": 56207717, "body": "Sorry, what is your question?"}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1449865733, "post_id": 34167007, "comment_id": 56207823, "body": "I don&#39;t understand do I need to type assert the profile session and assign to Data map to reference the data in the template context. A few examples I saw just get the session and render the template and the data is available in the context."}, {"owner": {"reputation": 599, "user_id": 4327041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ZbnQ.jpg?s=128&g=1", "display_name": "abm", "link": "https://stackoverflow.com/users/4327041/abm"}, "edited": false, "score": 0, "creation_date": 1449899466, "post_id": 34167007, "comment_id": 56216520, "body": "@pie-o-pah I am too having trouble reading what is it that you expect to be displayed on the template. What&#39;s being rendered on your template? Because I see that your <code>&lt;img src={{ .picture }}</code> is missing the <b>&quot;</b>. Also, you are reading these values from the <b>Auth0Controller</b>. Are you sure these values are being set correctly? What happens if you just hardcode the values in UserController like: <code>this.Data[&quot;nickname&quot;] = &quot;User&#39;s Nickname&quot;</code> and <code>this.Data[&quot;picture&quot;] = &quot;&#47;path&#47;to&#47;img.jpg&quot;</code>"}, {"owner": {"reputation": 599, "user_id": 4327041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ZbnQ.jpg?s=128&g=1", "display_name": "abm", "link": "https://stackoverflow.com/users/4327041/abm"}, "edited": false, "score": 0, "creation_date": 1449899690, "post_id": 34167007, "comment_id": 56216547, "body": "@pie-o-pah Also, could you add to your question how you are configuring begoo and how your project&#39;s file and folder structure looks like?"}], "answers": [{"comments": [{"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "edited": false, "score": 0, "creation_date": 1450123181, "post_id": 34237192, "comment_id": 56292954, "body": "Thanks I totally missed the part that Beego always need to set template data with <code>this.Data[]</code> while in vanilla Go the data can be passed into the <code>RenderTemplate</code> method. Still, thanks for pointing out!"}], "tags": [], "owner": {"reputation": 599, "user_id": 4327041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ZbnQ.jpg?s=128&g=1", "display_name": "abm", "link": "https://stackoverflow.com/users/4327041/abm"}, "is_accepted": true, "score": 1, "last_activity_date": 1449903159, "creation_date": 1449903159, "answer_id": 34237192, "question_id": 34167007, "link": "https://stackoverflow.com/questions/34167007/beego-session-not-passing-data-to-template-automatically/34237192#34237192", "title": "Beego Session Not Passing Data to Template Automatically", "body": "<p>I just tried running the <a href=\"http://beego.me/docs/quickstart/\" rel=\"nofollow\">Beego quickstart</a> project and ran it successfully. </p>\n\n<p>Make sure you have both the <a href=\"http://beego.me/docs/install\" rel=\"nofollow\">beego</a> and <a href=\"http://beego.me/docs/install/bee.md\" rel=\"nofollow\">bee</a> installed. After creating a new project with <code>bee new projectname</code> make sure you edit the <strong>projectname/conf/app.conf</strong> file and add the <strong>sessionon = true</strong>:</p>\n\n<pre><code>appname = quickstart\nhttpport = 8080\nrunmode = dev\nsessionon = true\n</code></pre>\n\n<p>I created a redirect controller like:</p>\n\n<pre><code>type RedirectController struct {\n    beego.Controller\n}\n\nfunc (c *RedirectController) Get() {\n    profile := make(map[string]interface{})\n    profile[\"nickname\"] = \"User's Nickname\"\n    profile[\"picture\"] = \"/path/to/img.jpg\"\n\n    c.SetSession(\"profile\", profile)\n    c.Redirect(\"/\", 301)\n}\n</code></pre>\n\n<p>The main controller:</p>\n\n<pre><code>type MainController struct {\n    beego.Controller\n}\n\nfunc (c *MainController) Get() {\n    profile := c.GetSession(\"profile\")\n\n    c.Data[\"nickname\"] = profile.(map[string]interface{})[\"nickname\"]\n    c.Data[\"picture\"] = profile.(map[string]interface{})[\"picture\"]\n    c.TplNames = \"index.tpl\"\n}\n</code></pre>\n\n<p>My index.tpl file:</p>\n\n<pre><code>&lt;p&gt;Nickname: {{.nickname}}&lt;/p&gt;\n&lt;p&gt;Picture: {{.picture}}&lt;/p&gt;\n</code></pre>\n\n<p>And the router:</p>\n\n<pre><code>func init() {\n    beego.Router(\"/\", &amp;controllers.MainController{})\n    beego.Router(\"/redirect\", &amp;controllers.RedirectController{})\n}\n</code></pre>\n\n<p>I would also recommend you to use a structure to store the profile values like: </p>\n\n<pre><code>// Define struct.\ntype Profile struct{\n    Nickname string\n    Picture  string\n}\n\n// Save it for template rendering.\nthis.Data[\"profile\"] = &amp;Profile{Nickname:\"astaxie\", Picture:\"img.jpg\"}\n\n// And render it like this:\nNickname: {{.profile.Nickname}}\nPicture:  {{.profile.Picture}}\n</code></pre>\n\n<p>Make sure to read <a href=\"http://beego.me/docs/mvc/view/view.md#template-data\" rel=\"nofollow\">this</a> to understand how template rendering is done. I hope this is what you were asking for, if not, please edit your question and add more helpful information and I will edit this answer.</p>\n"}], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1291, "favorite_count": 0, "accepted_answer_id": 34237192, "answer_count": 1, "score": 2, "last_activity_date": 1449974058, "creation_date": 1449612566, "last_edit_date": 1449974058, "question_id": 34167007, "link": "https://stackoverflow.com/questions/34167007/beego-session-not-passing-data-to-template-automatically", "title": "Beego Session Not Passing Data to Template Automatically", "body": "<p>Upon getting session information of type <code>map[string]interface{}</code> with <code>this.GetSession(\"session_key\")</code>, I did have to explicitly set the context and type assert the session like this in order to explicitly pass the data to the template.</p>\n\n<pre><code>// Get the session\nprofile := this.GetSession(\"profile\")\n\n// Have to add data to the template's context\nthis.Data[\"nickname\"] = profile.(map[string]interface{})[\"nickname\"].(string)\nthis.Data[\"picture\"] = profile.(map[string]interface{})[\"picture\"].(string)\n\n// Render template\nthis.TplNames = \"user.html\"\n</code></pre>\n\n<p>The session data (type <code>map[string]interface{}</code>) looks like this:</p>\n\n<pre><code>{\"nickname\": \"joe\", \"picture\": \"urltotheimg\"}\n</code></pre>\n\n<p>However, according to the Beego's session <a href=\"http://beego.me/docs/mvc/controller/session.md\" rel=\"nofollow\">doc</a>,  it looks like the session is passed implicitly without any need of type assertions or context passing (the template has immediate access to session values i.e. <code>{{.nickname}}</code> and <code>{{.picture}}</code>)</p>\n\n<p>This is the controller setting the session before redirecting to <code>/user</code></p>\n\n<pre><code>// Inherit beego's base controller\ntype MyController struct {\n    beego.Controller\n}\n\nfunc (this *MyController) Get() {\n\n    // code for getting token here\n\n    // Getting the User information\n    client := conf.Client(oauth2.NoContext, token)\n    resp, err := client.Get(\"https://\" + domain + \"/userinfo\")\n    if err != nil {\n        this.Redirect(\"/error\", 500)\n        return\n    }\n\n    // Reading the body for user's information\n    raw, err := ioutil.ReadAll(resp.Body)\n    defer resp.Body.Close()\n    if err != nil {\n        this.Redirect(\"/error\", 500)\n        return\n    }\n\n    // Unmarshalling the JSON of the Profile\n    var profile map[string]interface{}\n    if err := json.Unmarshal(raw, &amp;profile); err != nil {\n        this.Redirect(\"/error\", 500)\n        return\n    }\n\n    // Saving the information to the session.\n    this.SetSession(\"profile\", profile)\n\n    // redirect to /user\n    this.Redirect(\"/user\", 301)\n}\n</code></pre>\n\n<p>This is the controller of \"/user\"</p>\n\n<pre><code>type UserController struct {\n    beego.Controller\n}\n\nfunc (this *UserController) Get() {\n    // get the saved session\n    profile := this.GetSession(\"profile\")\n\n    // without setting the template data here, the session data won't be\n    // available in user.html\n    this.Data[\"nickname\"] = profile.(map[string]interface{})[\"nickname\"].(string)\n    this.Data[\"picture\"] = profile.(map[string]interface{})[\"picture\"].(string)\n    this.TplNames = \"user.html\"\n}\n</code></pre>\n\n<p>Only this then I can map the template to the data like this:</p>\n\n<pre><code>&lt;img src=\"{{ .picture }}\"&gt;\n&lt;p&gt;Hello, {{ .nickname }}&lt;/p&gt;\n</code></pre>\n\n<p>I'm quite sure it's necessary to set the template data. I'm just not sure why the above doc didn't do that. </p>\n\n<p>Any help would be appreciated.</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 38484, "user_id": 121332, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3f0d8a55b2dacb482fe57b31ea260173?s=128&d=identicon&r=PG", "display_name": "Alex Brown", "link": "https://stackoverflow.com/users/121332/alex-brown"}, "edited": false, "score": 0, "creation_date": 1449611031, "post_id": 34166569, "comment_id": 56080513, "body": "Try adding a zero or two  just before 1 (to make \\001).  Octals start with 0."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 1, "creation_date": 1449611621, "post_id": 34166569, "comment_id": 56080832, "body": "I am afraid there is no backreferences inside a pattern support in Go."}, {"owner": {"reputation": 9576, "user_id": 8388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7274ab8bec883e16147dba44e10817c?s=128&d=identicon&r=PG", "display_name": "Joe Hildebrand", "link": "https://stackoverflow.com/users/8388/joe-hildebrand"}, "edited": false, "score": 0, "creation_date": 1449616258, "post_id": 34166569, "comment_id": 56083020, "body": "There are also other ideas here: <a href=\"http://stackoverflow.com/questions/23968992/how-to-match-a-regex-with-backreference-in-go\" title=\"how to match a regex with backreference in go\">stackoverflow.com/questions/23968992/&hellip;</a>"}], "owner": {"reputation": 189, "user_id": 3822666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3182d23392d6948e5c89310db84dcf3?s=128&d=identicon&r=PG", "display_name": "terryp", "link": "https://stackoverflow.com/users/3822666/terryp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 58, "favorite_count": 1, "closed_date": 1449611733, "answer_count": 0, "score": 0, "last_activity_date": 1449611139, "creation_date": 1449610946, "last_edit_date": 1449611139, "question_id": 34166569, "link": "https://stackoverflow.com/questions/34166569/go-regular-expression-something-im-not-used-to", "closed_reason": "Duplicate", "title": "Go Regular Expression / Something I&#39;m Not Used To", "body": "<p>We all know what they say about regular expressions ... two problems, and what not. Today, I was poking around with regular expressions in Go and I noticed something kind of strange. </p>\n\n<p>Let's say we have this regular expression:</p>\n\n<pre><code>(..).*\\1\n</code></pre>\n\n<p>If we break this down, step by step it works out to something like:</p>\n\n<pre><code>() / This is a group of things. \n.  / Any character\n.  / Any character again \n.  / ... and again\n*  / Zero or more matches\n\\1 / Something that matches the first group in the ()\n</code></pre>\n\n<p>But here's the thing, if you put this in Go you end up getting this kind of error:</p>\n\n<pre><code># command-line-arguments\n....: non-octal character in escape sequence: \"\n</code></pre>\n\n<p>It's seeing \\1 as a possible octal sequence but when I'm trying to compile this regular expression it isn't working. I've tried backticks, single quotes, etc. I can't find in the docs where it says what to do with this, and it's kind of weird because this is how regular expressions work in most languages (yes, I know that doesn't mean it'll work in all of them.)</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1449607624, "post_id": 34163625, "comment_id": 56078553, "body": "Yes, if you have the json string &quot;null&quot; you&#39;re going to get the null value for your reference type (not in Go, in most languages). Please don&#39;t ask obvious questions and then answer them yourself 5 minutes later."}, {"owner": {"reputation": 594, "user_id": 2654541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acfa49aaf3b8bbf839a09a9a2e8414bb?s=128&d=identicon&r=PG", "display_name": "MicahStetson", "link": "https://stackoverflow.com/users/2654541/micahstetson"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1449700048, "post_id": 34163625, "comment_id": 56126760, "body": "Maybe I&#39;m dumber than most, but I spent the better part of a day figuring out why this wasn&#39;t a bug in the standard library. It would have been obvious if I had not been using the Go interface specifically designed to override the default decoding rules."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1449700505, "post_id": 34163625, "comment_id": 56126996, "body": "I wouldn&#39;t go that far. My comment was made on the basis of you answering the question as soon as you asked it. Perhaps it will prove helpful to others. I would consider it a pretty common thing to run into deserializing json though."}], "answers": [{"tags": [], "owner": {"reputation": 594, "user_id": 2654541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acfa49aaf3b8bbf839a09a9a2e8414bb?s=128&d=identicon&r=PG", "display_name": "MicahStetson", "link": "https://stackoverflow.com/users/2654541/micahstetson"}, "is_accepted": false, "score": 1, "last_activity_date": 1449600367, "creation_date": 1449600367, "answer_id": 34163626, "question_id": 34163625, "link": "https://stackoverflow.com/questions/34163625/in-go-why-is-json-null-sometimes-not-passed-to-unmarshaljson-for-decoding/34163626#34163626", "title": "In Go, why is JSON null sometimes not passed to UnmarshalJSON for decoding?", "body": "<p>This is because setting the pointer to <code>nil</code> is the most common way to handle a JSON <code>null</code>, and there is no way for an <code>UnmarshalJSON</code> method of <code>*T</code> to do that on its own. If <code>UnmarshalJSON</code> were called in this case, you would have to define <code>(**T).UnmarshalJSON</code> to set the <code>*T</code> to <code>nil</code>. This would make the most common case very awkward.</p>\n\n<p>If you don't want JSON <code>null</code> to become Go <code>nil</code>, don't use a pointer.</p>\n"}], "owner": {"reputation": 594, "user_id": 2654541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acfa49aaf3b8bbf839a09a9a2e8414bb?s=128&d=identicon&r=PG", "display_name": "MicahStetson", "link": "https://stackoverflow.com/users/2654541/micahstetson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1449600367, "creation_date": 1449600367, "question_id": 34163625, "link": "https://stackoverflow.com/questions/34163625/in-go-why-is-json-null-sometimes-not-passed-to-unmarshaljson-for-decoding", "title": "In Go, why is JSON null sometimes not passed to UnmarshalJSON for decoding?", "body": "<p>Go provides the <code>encoding/json.Unmarshaler</code> interface so types can control the way they are decoded from JSON. In almost all cases, the encoded JSON value is passed directly to the <code>UnmarshalJSON</code> method, but not if the <code>Unmarshaler</code> is a pointer and the JSON value is <code>null</code>. In that case, the pointer is set to <code>nil</code> without calling <code>UnmarshalJSON</code> at all. Here's an example:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype T string\n\nfunc (v *T) UnmarshalJSON(b []byte) error {\n    if b[0] == 'n' {\n        *v = \"null\"\n    } else {\n        *v = \"not null\"\n    }\n    return nil\n}\n\nfunc main() {\n    var a struct {\n        T   T\n        PT1 *T\n        PT2 *T\n    }\n    a.PT1 = nil // just to be explicit\n    a.PT2 = new(T)\n    err := json.Unmarshal([]byte(`{\"T\":null,\"PT1\":\"foo\",\"PT2\":null}`), &amp;a)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"a.T is %#v\\n\", a.T)\n    if a.PT1 == nil {\n        fmt.Println(\"a.PT1 is nil\")\n    } else {\n        fmt.Printf(\"a.PT1 points to %#v\\n\", *a.PT1)\n    }\n    if a.PT2 == nil {\n        fmt.Println(\"a.PT2 is nil\")\n    } else {\n        fmt.Printf(\"a.PT2 points to %#v\\n\", *a.PT2)\n    }\n}\n</code></pre>\n\n<p>I expected this to print</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>a.T is \"null\"\na.PT1 points to \"not null\"\na.PT2 points to \"null\"\n</code></pre>\n\n<p>Instead, it prints</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>a.T is \"null\"\na.PT1 points to \"not null\"\na.PT2 is nil\n</code></pre>\n\n<p>So <code>json.Unmarshal</code> allocates a new <code>T</code> for <code>a.PT1</code>, which is initially <code>nil</code>. But it sets <code>a.PT2</code> to <code>nil</code> without calling <code>UnmarshalJSON</code>, even though <code>a.PT2</code> was not <code>nil</code>. Why?</p>\n"}, {"tags": ["reflection", "go", "type-conversion", "slice"], "answers": [{"comments": [{"owner": {"reputation": 8149, "user_id": 616644, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wVwGC.png?s=128&g=1", "display_name": "Rick Smith", "link": "https://stackoverflow.com/users/616644/rick-smith"}, "edited": false, "score": 0, "creation_date": 1449600438, "post_id": 34163477, "comment_id": 56074051, "body": "Thanks for your answers, however I can&#39;t get them to work.  I would need to be able to do the type assertion with the reflect type...so .(*[]Demo) would not work.  Also, o.Elem() returns the error <code>(type interface {} is interface with no methods)</code>.  Not sure what to do with that..."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 8149, "user_id": 616644, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wVwGC.png?s=128&g=1", "display_name": "Rick Smith", "link": "https://stackoverflow.com/users/616644/rick-smith"}, "edited": false, "score": 0, "creation_date": 1449600645, "post_id": 34163477, "comment_id": 56074183, "body": "@RickSmith: No, you can&#39;t use a type assertion with reflection. Cut&amp;pasted into your code: <a href=\"https://play.golang.org/p/aTv4y4Ye9C\" rel=\"nofollow noreferrer\">play.golang.org/p/aTv4y4Ye9C</a> (added a call to Interface() which is probably more like what you intended)"}, {"owner": {"reputation": 8149, "user_id": 616644, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wVwGC.png?s=128&g=1", "display_name": "Rick Smith", "link": "https://stackoverflow.com/users/616644/rick-smith"}, "edited": false, "score": 0, "creation_date": 1449601028, "post_id": 34163477, "comment_id": 56074426, "body": "Oh I see, I thought you renamed <code>typedSlice</code> to <code>o</code>...but you didn&#39;t.  Sometimes I make unfounded and crazy assumptions that make things not work :(  I think this has answered my question; thank you for your answer and your patience."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1449600658, "last_edit_date": 1449600658, "creation_date": 1449599872, "answer_id": 34163477, "question_id": 34163174, "link": "https://stackoverflow.com/questions/34163174/cant-use-range-on-slice-made-with-reflect-then-passed-json-unmarshal/34163477#34163477", "title": "Can&#39;t use range on slice made with reflect then passed json.Unmarshal", "body": "<blockquote>\n  <p>invalid indirect of typedSlice (type interface {})</p>\n</blockquote>\n\n<p>You can't dereference <code>typedSlice</code>, because it's an <code>interface{}</code>. You would have to extract the pointer with a type assertion</p>\n\n<pre><code>realSlice := *typedSlice.(*[]Demo)\n</code></pre>\n\n<blockquote>\n  <p>cannot range over typedSlice (type interface {})</p>\n</blockquote>\n\n<p>Again, since <code>typedSlice</code> is an <code>interface{}</code>, you can't range over it. If you want to range over the values you need to use a type assertion, or iterate manually via reflect:</p>\n\n<pre><code>for i := 0; i &lt; o.Elem().Len(); i++ {\n    ret = append(ret, o.Elem().Index(i).Interface())\n}\n</code></pre>\n"}], "owner": {"reputation": 8149, "user_id": 616644, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wVwGC.png?s=128&g=1", "display_name": "Rick Smith", "link": "https://stackoverflow.com/users/616644/rick-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 352, "favorite_count": 1, "accepted_answer_id": 34163477, "answer_count": 1, "score": 0, "last_activity_date": 1449600658, "creation_date": 1449598867, "last_edit_date": 1592644375, "question_id": 34163174, "link": "https://stackoverflow.com/questions/34163174/cant-use-range-on-slice-made-with-reflect-then-passed-json-unmarshal", "title": "Can&#39;t use range on slice made with reflect then passed json.Unmarshal", "body": "<p>I am getting the following errors from the code below:</p>\n<blockquote>\n<p>invalid indirect of typedSlice (type interface {})</p>\n<p>cannot range over typedSlice (type interface {})</p>\n</blockquote>\n<p>This is confusing to me because <code>reflect.TypeOf(copy)</code> matches the type of <code>t</code>.</p>\n<pre><code>func Unmarshal(t reflect.Type) []interface{} {\n\n    ret := []interface{}{}\n    s := `[{&quot;Name&quot;:&quot;The quick...&quot;}]`\n\n    slice := reflect.Zero(reflect.SliceOf(t))\n    o := reflect.New(slice.Type())\n    o.Elem().Set(slice)\n    typedSlice := o.Interface()\n\n    json.Unmarshal([]byte(s), typedSlice)\n\n    fmt.Println(typedSlice)                 // &amp;[{The quick...}]\n    fmt.Println(reflect.TypeOf(typedSlice)) //same type as t\n    fmt.Println(*typedSlice)                // invalid indirect of copy (type interface {})\n\n    for _, l := range typedSlice {          //cannot range over copy (type interface {})\n        ret = append(ret, &amp;l)\n    }\n\n    return ret\n}\n</code></pre>\n<p>I've created a <a href=\"https://play.golang.org/p/VNKnuzRaiH\" rel=\"nofollow noreferrer\">go playground</a> with working code to help.</p>\n<p>Why does it appear that this slice prints one type but compiles as another?</p>\n"}, {"tags": ["go", "docker"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1449593072, "post_id": 34159742, "comment_id": 56069437, "body": "Can you show an example of what&#39;s not working? It hard to check what you might be doing wrong without knowing what you&#39;re doing. There&#39;s no reason you can&#39;t attach stdin when starting a container a second time, as it&#39;s the same process as starting it the first time."}], "owner": {"reputation": 1392, "user_id": 1088579, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/30fbed619b1897bc04c9ca894af9a616?s=128&d=identicon&r=PG", "display_name": "TeknasVaruas", "link": "https://stackoverflow.com/users/1088579/teknasvaruas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1449588576, "creation_date": 1449588576, "question_id": 34159742, "link": "https://stackoverflow.com/questions/34159742/stdin-not-getting-attached-to-restarted-docker-container", "title": "STDIN not getting attached to restarted docker container", "body": "<p>If a container is stopped and started again, the data on the STDIN attached is passed to the container only during the first start. On all subsequent starts, no data is found on the STDIN.</p>\n\n<p>I'm using <code>fsouza/go-dockerclient</code>. Any help would be appreciated on this. I found a related <a href=\"https://github.com/docker/docker/issues/4487\" rel=\"nofollow\">issue</a>, but it does not lead anywhere. If this behavior is intended, what are the workarounds, if any? I need to have two phases of the container, with different STDIN data each time.</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-storage"], "comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1449587966, "post_id": 34158670, "comment_id": 56065699, "body": "you need to create http client  with sufficient permission to do stuff on the bucket . Ill will send you example later  need to run to the bus :) storageService, err := storage.New(oauthHttpClient)"}, {"owner": {"reputation": 5183, "user_id": 2534777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f9d1450403b864d6b17f30ba0ce0aee3?s=128&d=identicon&r=PG", "display_name": "orcaman", "link": "https://stackoverflow.com/users/2534777/orcaman"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1449588439, "post_id": 34158670, "comment_id": 56066096, "body": "@MIkCode thanks, looking forward. Please note two things: 1. I am able to delete objects and buckets with the same permissions, so I don&#39;t think it&#39;s a simple perms issue - more likely something in the way I am trying to update the ACL 2. I have to run this on GAE, which has some special limitations"}, {"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1449597150, "post_id": 34158670, "comment_id": 56072019, "body": "did you set the scope to storage.ScopeFullControl ?"}, {"owner": {"reputation": 5183, "user_id": 2534777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f9d1450403b864d6b17f30ba0ce0aee3?s=128&d=identicon&r=PG", "display_name": "orcaman", "link": "https://stackoverflow.com/users/2534777/orcaman"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1449640765, "post_id": 34158670, "comment_id": 56090630, "body": "there appears to be no such scope in the storage package above mentioned: &quot;undefined: storage.ScopeFullControl&quot;. I&#39;m using &quot;scope.DevstorageFullControlScope&quot; - which allows me to create/delete buckets and objects so I don&#39;t think that&#39;s the issue"}, {"owner": {"reputation": 5183, "user_id": 2534777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f9d1450403b864d6b17f30ba0ce0aee3?s=128&d=identicon&r=PG", "display_name": "orcaman", "link": "https://stackoverflow.com/users/2534777/orcaman"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1449641186, "post_id": 34158670, "comment_id": 56090786, "body": "meanwhile my workaround was to create a designated bucket for this action, and on that bucket I set default ACL to public read as explained here: <a href=\"https://cloud.google.com/storage/docs/gsutil/commands/defacl\" rel=\"nofollow noreferrer\">cloud.google.com/storage/docs/gsutil/commands/defacl</a>"}], "owner": {"reputation": 5183, "user_id": 2534777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f9d1450403b864d6b17f30ba0ce0aee3?s=128&d=identicon&r=PG", "display_name": "orcaman", "link": "https://stackoverflow.com/users/2534777/orcaman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 198, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1449585625, "creation_date": 1449585625, "question_id": 34158670, "link": "https://stackoverflow.com/questions/34158670/setting-public-read-for-cloud-storage-object-via-golang-in-gae", "title": "Setting public read for cloud storage object via Golang in GAE", "body": "<p>I'm trying to set public permissions to a google cloud storage object that I have uploaded.</p>\n\n<p>The upload happens via a go application that runs on Google App Engine, using the <code>google.golang.org/api/storage/v1</code> package. </p>\n\n<p>From the same code, I am able to create and delete any object, however trying to set public read fails with the following error:</p>\n\n<p><code>googleapi: Error 403: Insufficient Permission, insufficientPermissions</code></p>\n\n<p>This is my code:</p>\n\n<pre><code>if _, err := service.ObjectAccessControls.Update(bucketNameDone, object, \"allUsers\", &amp;storage.ObjectAccessControl{Role: \"READER\", Object: object}).Do(); err != nil {\n    log.Errorf(ctx, \"failed to set public perms for %s: %v\", object, err)\n}\n</code></pre>\n\n<p>The docs for this suck pretty badly so I can't figure out what I am missing. Any ideas?</p>\n"}, {"tags": ["testing", "go", "mocking"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 16, "creation_date": 1449577300, "post_id": 34154904, "comment_id": 56058295, "body": "A folder named <code>testdata</code> is usually used for this purpose as it is ignored by the go tool (see <code>go help packages</code>)"}, {"owner": {"reputation": 127, "user_id": 2902513, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d01d16d5fca258a1f16a45eaca363885?s=128&d=identicon&r=PG&f=1", "display_name": "Miller", "link": "https://stackoverflow.com/users/2902513/miller"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1449577644, "post_id": 34154904, "comment_id": 56058548, "body": "Ah yes I see it.   &quot;Directory and file names that begin with &quot;.&quot; or &quot;_&quot; are ignored by the go tool, as are directories named &quot;testdata&quot;  Didn&#39;t spot that. Thank you"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1449613248, "post_id": 34154904, "comment_id": 56081696, "body": "Admittedly, this is the lazy approach, but I put my testdata right next to the <code>*_test.go</code> files: Easy to access, easy to find and I do not mind to have them around. Another option would be to use <code>&#47;&#47;go:generate</code> and <a href=\"https://github.com/jteeuwen/go-bindata\" rel=\"nofollow noreferrer\">go-bindata</a> before creating a dist."}], "answers": [{"tags": [], "owner": {"reputation": 1261, "user_id": 22079, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a07336bf2b6ecaca5e87cda7b99b9253?s=128&d=identicon&r=PG", "display_name": "Jeff Allen", "link": "https://stackoverflow.com/users/22079/jeff-allen"}, "is_accepted": false, "score": 13, "last_activity_date": 1455384647, "creation_date": 1455384647, "answer_id": 35383006, "question_id": 34154904, "link": "https://stackoverflow.com/questions/34154904/testing-using-local-files/35383006#35383006", "title": "Testing using local files", "body": "<p>A folder named testdata is usually used for this purpose as it is ignored by the go tool (see go help packages).</p>\n"}, {"tags": [], "owner": {"reputation": 1275, "user_id": 3044418, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af7f92727ba68dfe3edd434be8ecb309?s=128&d=identicon&r=PG&f=1", "display_name": "Anfernee", "link": "https://stackoverflow.com/users/3044418/anfernee"}, "is_accepted": true, "score": 8, "last_activity_date": 1458330535, "last_edit_date": 1458330535, "creation_date": 1458319740, "answer_id": 36089940, "question_id": 34154904, "link": "https://stackoverflow.com/questions/34154904/testing-using-local-files/36089940#36089940", "title": "Testing using local files", "body": "<p>This is my current test setup:</p>\n\n<pre><code>app/\n   main.go\n   main_test.go\n   main_testdata\n\n   package1/\n     package1.go \n     package1_test.go \n     package1_testdata1\n\n   package2/\n     package2.go \n     package2_test.go \n     package2_testdata1\n</code></pre>\n\n<p>All the test data that is specific to a single package, is placed within the directory of that package. Common test data that will be used by multiple packages are either placed in the application root or in <code>$HOME</code>.</p>\n\n<p>This set up works for me. Its easy to change the data and test, without having to do extra typing:</p>\n\n<p><code>vim package1_test_data1; go test app/package1</code></p>\n"}], "owner": {"reputation": 127, "user_id": 2902513, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/d01d16d5fca258a1f16a45eaca363885?s=128&d=identicon&r=PG&f=1", "display_name": "Miller", "link": "https://stackoverflow.com/users/2902513/miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4157, "favorite_count": 1, "accepted_answer_id": 36089940, "answer_count": 2, "score": 12, "last_activity_date": 1604260811, "creation_date": 1449574663, "last_edit_date": 1604260811, "question_id": 34154904, "link": "https://stackoverflow.com/questions/34154904/testing-using-local-files", "title": "Testing using local files", "body": "<p>I'm looking for what best practice I should use when it comes to testing with Go using local files.</p>\n<p>By using local files, I mean that in order to test functionality, the application needs some local files, as the application reads from these files frequently.</p>\n<p>I'm not sure if I should write temporary files myself just before running the tests using the ioutil package tempdir and tempfile functions, or create a test folder like so;</p>\n<pre><code>testing/...test_files_here\nmain.go\nmain_test.go\n</code></pre>\n<p>and then read from the contents inside</p>\n<pre><code>testing/...\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1449574384, "post_id": 34154779, "comment_id": 56056353, "body": "Use the proper format string. Duplicate."}], "answers": [{"comments": [{"owner": {"reputation": 243983, "user_id": 35070, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f92354195e8874dbee44d5c8714d506?s=128&d=identicon&r=PG", "display_name": "phihag", "link": "https://stackoverflow.com/users/35070/phihag"}, "reply_to_user": {"reputation": 81, "user_id": 4144950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6bf844bd59130dc492249c8eaf050e83?s=128&d=identicon&r=PG&f=1", "display_name": "Liao", "link": "https://stackoverflow.com/users/4144950/liao"}, "edited": false, "score": 1, "creation_date": 1449576627, "post_id": 34154995, "comment_id": 56057874, "body": "If this (or any other) answer solved your problem, please consider <a href=\"http://meta.stackexchange.com/a/5235/141962\">accepting it</a>. Thanks!"}], "tags": [], "owner": {"reputation": 243983, "user_id": 35070, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/6f92354195e8874dbee44d5c8714d506?s=128&d=identicon&r=PG", "display_name": "phihag", "link": "https://stackoverflow.com/users/35070/phihag"}, "is_accepted": true, "score": 6, "last_activity_date": 1449574942, "creation_date": 1449574942, "answer_id": 34154995, "question_id": 34154779, "link": "https://stackoverflow.com/questions/34154779/golang-time-parse-get-0001-01-01-000000-0000-utc/34154995#34154995", "title": "Golang time.Parse() get 0001-01-01 00:00:00 +0000 UTC", "body": "<p>You need to use the reference timestamp <code>2006-01-02 15:04:05</code> for the layout parameter (<a href=\"https://play.golang.org/p/vl3i4PL-6m\" rel=\"noreferrer\">playground</a>):</p>\n\n<pre><code>t, _ := time.Parse(\"1/2/2006 15:04:05\", \"12/8/2015 12:00:00\")\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 4144950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6bf844bd59130dc492249c8eaf050e83?s=128&d=identicon&r=PG&f=1", "display_name": "Liao", "link": "https://stackoverflow.com/users/4144950/liao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4869, "favorite_count": 0, "closed_date": 1449575631, "accepted_answer_id": 34154995, "answer_count": 1, "score": 2, "last_activity_date": 1449574942, "creation_date": 1449574277, "last_edit_date": 1449574540, "question_id": 34154779, "link": "https://stackoverflow.com/questions/34154779/golang-time-parse-get-0001-01-01-000000-0000-utc", "closed_reason": "Duplicate", "title": "Golang time.Parse() get 0001-01-01 00:00:00 +0000 UTC", "body": "<p>This is my code:   </p>\n\n<pre><code>t, _ := time.Parse(\"12/1/2015 12:00:00\", \"12/8/2015 12:00:00\")\nfmt.Println(t)\n</code></pre>\n\n<p>This is the result: <code>0001-01-01 00:00:00 +0000 UTC</code></p>\n\n<p>How to get correct the date string?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["inheritance", "go"], "answers": [{"comments": [{"owner": {"reputation": 1792, "user_id": 257364, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/fd01dd06eefc977f4746b1ff55799c2b?s=128&d=identicon&r=PG", "display_name": "Volksman", "link": "https://stackoverflow.com/users/257364/volksman"}, "edited": false, "score": 0, "creation_date": 1488700985, "post_id": 34152076, "comment_id": 72341677, "body": "Multiple inheritance typically refers to inheriting more than one class, not implementing multiple interfaces, and is never good. Implementing multiple interfaces is possible in Go and in traditional languages like C++ and Java without any fuss and is good/necessary where appropriate. Multiple inheritance was possible in C++ but frowned on (except if all but one class were acting as interface - i.e. no attributes or method impls). It is illegal in Java so you can&#39;t be naughty even if you want to :)"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 18, "last_activity_date": 1449566425, "last_edit_date": 1592644375, "creation_date": 1449566425, "answer_id": 34152076, "question_id": 34151961, "link": "https://stackoverflow.com/questions/34151961/inheritance-in-go/34152076#34152076", "title": "Inheritance in Go", "body": "<p>This was answered by the language creators in the <a href=\"https://golang.org/doc/faq#inheritance\" rel=\"noreferrer\">F.A.Q.</a>:</p>\n<blockquote>\n<p>Object-oriented programming, at least in the best-known languages, involves too much discussion of the relationships between types, relationships that often could be derived automatically. Go takes a different approach.</p>\n<p>Rather than requiring the programmer to declare ahead of time that two types are related, in Go a type automatically satisfies any interface that specifies a subset of its methods. Besides reducing the bookkeeping, this approach has real advantages. Types can satisfy many interfaces at once, without the complexities of traditional multiple inheritance. Interfaces can be very lightweight\u2014an interface with one or even zero methods can express a useful concept. Interfaces can be added after the fact if a new idea comes along or for testing\u2014without annotating the original types. Because there are no explicit relationships between types and interfaces, there is no type hierarchy to manage or discuss.</p>\n</blockquote>\n<p>See also: <a href=\"https://en.wikipedia.org/wiki/Composition_over_inheritance\" rel=\"noreferrer\">Composition over inheritance principle</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 435, "user_id": 2702193, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/a3f6bf97c0a7c87befa99a1fe1a92c34?s=128&d=identicon&r=PG&f=1", "display_name": "rox", "link": "https://stackoverflow.com/users/2702193/rox"}, "is_accepted": false, "score": 4, "last_activity_date": 1468739913, "creation_date": 1468739913, "answer_id": 38418827, "question_id": 34151961, "link": "https://stackoverflow.com/questions/34151961/inheritance-in-go/38418827#38418827", "title": "Inheritance in Go", "body": "<p>If you need inheritance for reusable, this example shows how I reuse the width/height of a shape interface, </p>\n\n<pre><code>package main\n\n// compare to a c++ example: http://www.tutorialspoint.com/cplusplus/cpp_interfaces.htm\n\nimport (\n    \"fmt\"\n)\n\n// interface\ntype Shape interface {\n    Area() float64\n    GetWidth() float64\n    GetHeight() float64\n    SetWidth(float64)\n    SetHeight(float64)\n}\n\n// reusable part, only implement SetWidth and SetHeight method of the interface\n// {\n\ntype WidthHeight struct {\n    width  float64\n    height float64\n}\n\nfunc (this *WidthHeight) SetWidth(w float64) {\n    this.width = w\n}\nfunc (this *WidthHeight) SetHeight(h float64) {\n    this.height = h\n}\nfunc (this *WidthHeight) GetWidth() float64 {\n    return this.width\n}\nfunc (this *WidthHeight) GetHeight() float64 {\n    fmt.Println(\"in WidthHeight.GetHeight\")\n    return this.height\n}\n\n// }\n\ntype Rectangle struct {\n    WidthHeight\n}\n\nfunc (this *Rectangle) Area() float64 {\n    return this.GetWidth() * this.GetHeight() / 2\n}\n\n// override\nfunc (this *Rectangle) GetHeight() float64 {\n    fmt.Println(\"in Rectangle.GetHeight\")\n    // in case you still needs the WidthHeight's GetHeight method\n    return this.WidthHeight.GetHeight()\n}\n\nfunc main() {\n    var r Rectangle\n    var i Shape = &amp;r\n    i.SetWidth(4)\n    i.SetHeight(6)\n\n    fmt.Println(i)\n    fmt.Println(\"width: \",i.GetWidth())\n    fmt.Println(\"height: \",i.GetHeight())\n    fmt.Println(\"area: \",i.Area())\n\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>&amp;{{4 6}}\nwidth:  4\nin Rectangle.GetHeight\nin WidthHeight.GetHeight\nheight:  6\nin Rectangle.GetHeight\nin WidthHeight.GetHeight\narea:  12\n</code></pre>\n"}], "owner": {"reputation": 441, "user_id": 5252482, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/6la8h.jpg?s=128&g=1", "display_name": "Murali Manohar", "link": "https://stackoverflow.com/users/5252482/murali-manohar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2859, "favorite_count": 4, "accepted_answer_id": 34152076, "answer_count": 2, "score": 6, "last_activity_date": 1468739913, "creation_date": 1449566058, "last_edit_date": 1459896598, "question_id": 34151961, "link": "https://stackoverflow.com/questions/34151961/inheritance-in-go", "title": "Inheritance in Go", "body": "<p>Why doesn't Go have Type Inheritance. </p>\n\n<p><strong>(The concept that when a class of an objects is defined, any subclass that is defined can inherit the definitions of one or more general classes)</strong></p>\n"}, {"tags": ["database", "postgresql", "struct", "go"], "comments": [{"owner": {"reputation": 185, "user_id": 2147751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e580f6ab14ac6ca552f30ace3599ff89?s=128&d=identicon&r=PG", "display_name": "Kipz", "link": "https://stackoverflow.com/users/2147751/kipz"}, "edited": false, "score": 0, "creation_date": 1449534500, "post_id": 34145775, "comment_id": 56039720, "body": "i ment, build or convert a struct from a postgres db"}, {"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 1, "creation_date": 1449534804, "post_id": 34145775, "comment_id": 56039809, "body": "Your conditional is incorrect. You&#39;ve got <code>if queryErr != nil</code> ... but the block beneath that is for when the error is actually <code>nil</code>. Perhaps fixing that will print the underlying error for you to diagnose. We will need to know what &quot;it breaks&quot; means. Surely theres a panic or something that is being hidden by that incorrect conditional."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1449537074, "post_id": 34145775, "comment_id": 56040430, "body": "I also strongly recommend using sqlx (<a href=\"https://github.com/jmoiron/sqlx\" rel=\"nofollow noreferrer\">github.com/jmoiron/sqlx</a>) - which can help turn query-results-into-structs."}, {"owner": {"reputation": 185, "user_id": 2147751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e580f6ab14ac6ca552f30ace3599ff89?s=128&d=identicon&r=PG", "display_name": "Kipz", "link": "https://stackoverflow.com/users/2147751/kipz"}, "reply_to_user": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1449572030, "post_id": 34145775, "comment_id": 56054732, "body": "@SimonWhitehead thanks! that solved the error, now i just need to make it handle more than 1 row"}], "answers": [{"comments": [{"owner": {"reputation": 185, "user_id": 2147751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e580f6ab14ac6ca552f30ace3599ff89?s=128&d=identicon&r=PG", "display_name": "Kipz", "link": "https://stackoverflow.com/users/2147751/kipz"}, "edited": false, "score": 1, "creation_date": 1449572814, "post_id": 34145994, "comment_id": 56055329, "body": "this along with @SimonWhitehead solved the issue, thanks!!"}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 1, "last_activity_date": 1449541628, "last_edit_date": 1449541628, "creation_date": 1449534906, "answer_id": 34145994, "question_id": 34145775, "link": "https://stackoverflow.com/questions/34145775/getting-a-struct-from-postgres-db/34145994#34145994", "title": "Getting a struct from PostGres DB", "body": "<p>For the bool, it depends on the type of the actual column.  If it isn't boolean, it won't map directly. </p>\n\n<p>You may need to store in a temporary variable first and then translate and assign to the field in Button to match.</p>\n\n<p>As for reading all rows, here's an example adapted from the <a href=\"https://golang.org/pkg/database/sql/#example_DB_Query\" rel=\"nofollow\">docs</a>. </p>\n\n<p>You use Query instead of QueryRow to get all rows.</p>\n\n<pre><code>rows, err := db.Query(\"SELECT id_printer, name, has_children FROM button WHERE id_parent IS NULL;\")\nif err != nil {\n        log.Fatal(err)\n}\ndefer rows.Close()\nvar buttons []Button\nfor rows.Next() {\n        var b Button\n        if err := rows.Scan(&amp;b.ID, &amp;b.Name, &amp;b.Children); err != nil {\n                log.Fatal(err)\n        }\n        buttons = append(buttons,b)\n}\n// At this point, you have all your rows in the \"buttons\" variable\n</code></pre>\n"}], "owner": {"reputation": 185, "user_id": 2147751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e580f6ab14ac6ca552f30ace3599ff89?s=128&d=identicon&r=PG", "display_name": "Kipz", "link": "https://stackoverflow.com/users/2147751/kipz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 34145994, "answer_count": 1, "score": 0, "last_activity_date": 1449541628, "creation_date": 1449533440, "question_id": 34145775, "link": "https://stackoverflow.com/questions/34145775/getting-a-struct-from-postgres-db", "title": "Getting a struct from PostGres DB", "body": "<p>I followed a thread in here and came up with this</p>\n\n<pre><code>var b Button\n\nqueryErr := connection.QueryRow(\"SELECT id_printer, name, has_children FROM button WHERE id_parent IS NULL;\").Scan(&amp;b.ID, &amp;b.Name, &amp;b.Children)\nif queryErr != nil {\n    response, err := json.MarshalIndent(b, \"\", \"  \")\n    fmt.Fprint(w, string(response))\n    if err != nil {\n        log.Println(\"Error on jsonmarshalindent Starter\")\n    }\n} else {\n    log.Println(\"Error on queryErr  starter\")\n    log.Println(queryErr)\n\n    fmt.Fprint(w, \"Error getting starter button\")\n}\n</code></pre>\n\n<p>it has 2 problems:</p>\n\n<ol>\n<li>It breaks on b.Children</li>\n<li>I don't know how to make it dynamically. for instance, the query returns 3 rows, but it depends on the company's client, it can be 3 or any number.</li>\n</ol>\n\n<p>the struct is</p>\n\n<pre><code>type Starter struct {\n    Buttons []Button `json:buttons`\n}\n\ntype Button struct {\n    ID       int    `json:id`\n    Name     string `json:name`\n    Children bool   `json:children`\n}\n</code></pre>\n\n<p>Can someone shed some light in this please? </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 451, "user_id": 1082884, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/150055b45b9362a8b27b709c9938d8f1?s=128&d=identicon&r=PG", "display_name": "rino", "link": "https://stackoverflow.com/users/1082884/rino"}, "edited": false, "score": 0, "creation_date": 1449537973, "post_id": 34145213, "comment_id": 56040676, "body": "How can that work when passing a rather than &amp;a? In that case I can&#39;t see how you can set a new value to a."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 451, "user_id": 1082884, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/150055b45b9362a8b27b709c9938d8f1?s=128&d=identicon&r=PG", "display_name": "rino", "link": "https://stackoverflow.com/users/1082884/rino"}, "edited": false, "score": 1, "creation_date": 1449541688, "post_id": 34145213, "comment_id": 56041633, "body": "It is not possible to set a value <code>a</code> using <code>reflect.ValueOf(a)</code>."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1449541487, "last_edit_date": 1449541487, "creation_date": 1449530436, "answer_id": 34145213, "question_id": 34145072, "link": "https://stackoverflow.com/questions/34145072/can-you-initialise-a-pointer-variable-with-golang-reflect/34145213#34145213", "title": "Can you initialise a pointer variable with Golang reflect?", "body": "<p>Get addressable value for variable <code>a</code>:</p>\n\n<pre><code>var a *A\nva := reflect.ValueOf(&amp;a).Elem()\n</code></pre>\n\n<p>Allocate a new <code>A</code>:</p>\n\n<pre><code>v := reflect.New(va.Type().Elem())\n</code></pre>\n\n<p>Assign the pointer to newly allocated <code>A</code> to the variable <code>a</code>:</p>\n\n<pre><code>va.Set(v)\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/mFdvf95_BX\" rel=\"nofollow\">playground example</a></p>\n\n<p>Because Go passes arguments by value, it is not possible to set a value to <code>a</code> starting with <code>relfect.ValueOf(a)</code>.</p>\n"}], "owner": {"reputation": 451, "user_id": 1082884, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/150055b45b9362a8b27b709c9938d8f1?s=128&d=identicon&r=PG", "display_name": "rino", "link": "https://stackoverflow.com/users/1082884/rino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 960, "favorite_count": 0, "accepted_answer_id": 34145213, "answer_count": 1, "score": 1, "last_activity_date": 1449541487, "creation_date": 1449529755, "last_edit_date": 1449530126, "question_id": 34145072, "link": "https://stackoverflow.com/questions/34145072/can-you-initialise-a-pointer-variable-with-golang-reflect", "title": "Can you initialise a pointer variable with Golang reflect?", "body": "<p>Suppose</p>\n\n<pre><code>type A struct {\n   A1 int\n}\nvar a *A\n</code></pre>\n\n<p>can we initialise \"a\" with reflect? reflect.ValueOf(a).Type().Elem() gives the type but it seems reflect.ValueOf(a).Elem() is the zero Value and not addressable.</p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1449527987, "post_id": 34144642, "comment_id": 56037400, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/33749342/golang-appengine-project-wont-build\">Golang Appengine Project won&#39;t build</a>"}, {"owner": {"reputation": 87, "user_id": 4957438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f05cbb8a908ef71d0516bba78ba6b6?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron Alpar", "link": "https://stackoverflow.com/users/4957438/aaron-alpar"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1449616987, "post_id": 34144642, "comment_id": 56083301, "body": "Within the context of the referenced question, my question could be stated: &quot;Are Google&#39;s supplied instructions incorrect or am I doing something wrong?  The instructions appear to direct the user to use an library that requires <code>syscall</code> support with a platform that doesn&#39;t support it.&quot;"}, {"owner": {"reputation": 3493, "user_id": 4270992, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JZTDS.jpg?s=128&g=1", "display_name": "Nick", "link": "https://stackoverflow.com/users/4270992/nick"}, "edited": false, "score": 0, "creation_date": 1449622770, "post_id": 34144642, "comment_id": 56085357, "body": "Is this error part of a larger stack trace? Could you provide more clear steps to how someone could reproduce this issue?"}, {"owner": {"reputation": 87, "user_id": 4957438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f05cbb8a908ef71d0516bba78ba6b6?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron Alpar", "link": "https://stackoverflow.com/users/4957438/aaron-alpar"}, "edited": false, "score": 0, "creation_date": 1450897318, "post_id": 34144642, "comment_id": 56625729, "body": "Nick - are you aware of a case where the instructions work for appengine-1.9.23?  The setting of the GOPATH in Google&#39;s instructions are ambiguous and could effect the result of the compilation, although I have not found a value that produces a correct result.  There is no stack trace for the error since it is a compilation error (&quot;parse:&quot;)."}, {"owner": {"reputation": 8208, "user_id": 41742, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/f45066b1408b3df9b2f48a7e53aa59a7?s=128&d=identicon&r=PG&f=1", "display_name": "Curyous", "link": "https://stackoverflow.com/users/41742/curyous"}, "edited": false, "score": 1, "creation_date": 1452723215, "post_id": 34144642, "comment_id": 57301152, "body": "I&#39;m encountering the same thing and was about to ask this question myself. Have you found a resolution yet?"}, {"owner": {"reputation": 87, "user_id": 4957438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f05cbb8a908ef71d0516bba78ba6b6?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron Alpar", "link": "https://stackoverflow.com/users/4957438/aaron-alpar"}, "edited": false, "score": 0, "creation_date": 1453149641, "post_id": 34144642, "comment_id": 57466669, "body": "I do not have a resolution yet, but I am working through the issue with paid google support."}, {"owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "edited": false, "score": 0, "creation_date": 1470098864, "post_id": 34144642, "comment_id": 64797831, "body": "@AaronAlpar Solution yet?"}], "answers": [{"comments": [{"owner": {"reputation": 722, "user_id": 3072751, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/8J58M.jpg?s=128&g=1", "display_name": "thurt", "link": "https://stackoverflow.com/users/3072751/thurt"}, "edited": false, "score": 0, "creation_date": 1524590376, "post_id": 41090727, "comment_id": 87031437, "body": "clear explanation, thanks!  for 1) a typical culprit is the &quot;net&quot; package (so any custom TCP/UDP/Unix Socket code) because it imports syscall. for 2) I think <a href=\"https://stackoverflow.com/a/48132666/3072751\">stackoverflow.com/a/48132666/3072751</a> provides a good solution if you are using vendor/."}], "tags": [], "owner": {"reputation": 5284, "user_id": 3953357, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2f0b6d4522d8c03a21c5c41d5ba5a23?s=128&d=identicon&r=PG&f=1", "display_name": "Adam", "link": "https://stackoverflow.com/users/3953357/adam"}, "is_accepted": false, "score": 2, "last_activity_date": 1481920642, "last_edit_date": 1495541809, "creation_date": 1481487570, "answer_id": 41090727, "question_id": 34144642, "link": "https://stackoverflow.com/questions/34144642/bad-import-syscall-for-cloud-storage-apis/41090727#41090727", "title": "bad import &quot;syscall&quot; for cloud storage APIs", "body": "<p>This error is caused by either of two scenarios:</p>\n\n<p>1) Implicitly importing <code>syscall</code> by importing another package that uses it, as referenced in <a href=\"https://stackoverflow.com/questions/33749342/golang-appengine-project-wont-build\">this related question</a>.</p>\n\n<p>2) Having your package source files in your <code>GOPATH</code> located in a directory at or below the same level as your project's app.yaml (eg. <em>app.yaml</em> in <em>~/go</em>, and packages sources in <em>~/go/gopath/src</em>). If a package like <code>x/net/internal/nettest</code> exists in your GOPATH the <code>syscall</code> import will be parsed by <code>goapp</code> at compile time and throw the compilation error.</p>\n\n<p>Avoiding these two scenarios should be sufficient to prevent any <code>bad import \"syscall\"</code> errors or related compilation errors.</p>\n"}, {"tags": [], "owner": {"reputation": 1184, "user_id": 6938128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7fcdfa61a165fe77418b79dc6eb5efb0?s=128&d=identicon&r=PG&f=1", "display_name": "George", "link": "https://stackoverflow.com/users/6938128/george"}, "is_accepted": false, "score": 0, "last_activity_date": 1484235327, "creation_date": 1484235327, "answer_id": 41617132, "question_id": 34144642, "link": "https://stackoverflow.com/questions/34144642/bad-import-syscall-for-cloud-storage-apis/41617132#41617132", "title": "bad import &quot;syscall&quot; for cloud storage APIs", "body": "<p>Reproduced the initial steps above and got a similar error, even if not explicitly mentioning syscall. However, running \u201cgoapp serve\u201d in the appengine-hello directory results in no error at all. </p>\n\n<p>Adam\u2019s explanation at point 2 applies here correctly: one needs to place the app.yaml file at the right level in the directory structure.</p>\n"}, {"tags": [], "owner": {"reputation": 463, "user_id": 1474495, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a9fc74a4e39e82aca03da5aa2c1426fb?s=128&d=identicon&r=PG", "display_name": "Hunor Kov&#225;cs", "link": "https://stackoverflow.com/users/1474495/hunor-kov%c3%a1cs"}, "is_accepted": false, "score": 0, "last_activity_date": 1570917855, "creation_date": 1570917855, "answer_id": 58358945, "question_id": 34144642, "link": "https://stackoverflow.com/questions/34144642/bad-import-syscall-for-cloud-storage-apis/58358945#58358945", "title": "bad import &quot;syscall&quot; for cloud storage APIs", "body": "<p><code>sirupsen/logrus</code> references <code>syscall</code>.</p>\n\n<p>They have an appengine tag specified, not to include syscall so it's usable in AppEngine, something like <code>go build -tags appengine</code> as per <a href=\"https://github.com/Sirupsen/logrus/issues/310\" rel=\"nofollow noreferrer\">issue 310</a>.</p>\n\n<p>However I haven't yet succeeded including it in an AppEngine project so that this build param could be forwarded and specified somewhere so that it goes through. I'll come back to update if I manage.</p>\n"}], "owner": {"reputation": 87, "user_id": 4957438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f05cbb8a908ef71d0516bba78ba6b6?s=128&d=identicon&r=PG&f=1", "display_name": "Aaron Alpar", "link": "https://stackoverflow.com/users/4957438/aaron-alpar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1598, "favorite_count": 1, "answer_count": 3, "score": 5, "last_activity_date": 1570917855, "creation_date": 1449527835, "last_edit_date": 1450897180, "question_id": 34144642, "link": "https://stackoverflow.com/questions/34144642/bad-import-syscall-for-cloud-storage-apis", "title": "bad import &quot;syscall&quot; for cloud storage APIs", "body": "<p>I am following the instructions on <code>https://cloud.google.com/appengine/docs/go/googlecloudstorageclient/download</code> to begin migrating some code from the, now deprecated, Files API to the new Cloud Storage API without success.</p>\n\n<p>The steps I'm following are ...</p>\n\n<p>I'm running appengine v1.9.23 which is later than the required appengine v1.8.1.</p>\n\n<p>My $GOPATH is set, so I skip step #1.</p>\n\n<p>I proceed to step #2:</p>\n\n<p><code>goapp get -u golang.org/x/oauth2</code></p>\n\n<p><code>goapp get -u google.golang.org/cloud/storage</code></p>\n\n<p>I am not developing on a managed VM, so I skip step #3.</p>\n\n<p>Now when I run the application, I get:</p>\n\n<p><code>go-app-builder: Failed parsing input: parser: bad import \"syscall\" in goapp/src/golang.org/x/net/internal/nettest/error_posix.go</code></p>\n\n<p>What am I doing wrong?</p>\n\n<hr>\n\n<h1>Steps to reproduce</h1>\n\n<ul>\n<li><p>Download an install the Google Appengine runtime, version 1.9.23 from <a href=\"https://console.cloud.google.com/storage/browser/appengine-sdks/featured/\" rel=\"noreferrer\">https://console.cloud.google.com/storage/browser/appengine-sdks/featured/</a> .  Follow the installation instructions documented on <a href=\"https://cloud.google.com/appengine/downloads?hl=en\" rel=\"noreferrer\">https://cloud.google.com/appengine/downloads?hl=en</a></p></li>\n<li><p>Create an appengine project directory:</p></li>\n</ul>\n\n<p><code>% mkdir $HOME/myapp</code></p>\n\n<ul>\n<li>Create a new <code>app.yaml</code> file as <code>~/myapp/app.yaml</code>.  Read the directions on the Google website for details: <a href=\"https://cloud.google.com/appengine/docs/go/config/appconfig\" rel=\"noreferrer\">https://cloud.google.com/appengine/docs/go/config/appconfig</a></li>\n</ul>\n\n<p>I use a version that does not have the static resources:</p>\n\n<pre><code>application: myapp\nversion: alpha-001\nruntime: go\napi_version: go1\n\nhandlers:\n- url: /.*\n  script: _go_app\n</code></pre>\n\n<ul>\n<li>Create a location for the Go source files.</li>\n</ul>\n\n<p><code>% mkdir $HOME/myapp/go</code></p>\n\n<ul>\n<li>Set your GOPATH to the location of your sources</li>\n</ul>\n\n<p><code>% export GOPATH=$HOME/myapp/go</code></p>\n\n<ul>\n<li>Get the Go appengine example project: <a href=\"https://github.com/golang/example\" rel=\"noreferrer\">https://github.com/golang/example</a></li>\n</ul>\n\n<p><code>% goapp get github.com/golang/example/appengine-hello</code></p>\n\n<p>This command will download the example app to the first path entry in the GOPATH</p>\n\n<ul>\n<li>Install the Google Cloud Storage client libraries as directed in <a href=\"https://cloud.google.com/appengine/docs/go/googlecloudstorageclient/download\" rel=\"noreferrer\">https://cloud.google.com/appengine/docs/go/googlecloudstorageclient/download</a> .  Reference the steps at the top of this question for more details.  Following the directions should result in you running 2 commands:</li>\n</ul>\n\n<p><code>% go get -u golang.org/x/oauth2</code></p>\n\n<p><code>% go get -u google.golang.org/cloud/storage</code></p>\n\n<ul>\n<li>Attempt to run your go application</li>\n</ul>\n\n<p><code>% goapp serve</code></p>\n\n<p>You will see the following compilation error (no stack trace):</p>\n\n<p><code>2015/12/23 10:37:07 go-app-builder: Failed parsing input: parser: bad import \"syscall\" in go/src/golang.org/x/net/ipv6/control_unix.go</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2202, "user_id": 1452497, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/9WtY4.png?s=128&g=1", "display_name": "Antiga", "link": "https://stackoverflow.com/users/1452497/antiga"}, "edited": false, "score": 0, "creation_date": 1449527736, "post_id": 34144571, "comment_id": 56037298, "body": "Are you asking about a ternary operator? If so, see here for the idiomatic way to do conditionals. <a href=\"http://stackoverflow.com/questions/19979178/what-is-idiomatic-gos-equivalent-of-cs-ternary-operator\" title=\"what is idiomatic gos equivalent of cs ternary operator\">stackoverflow.com/questions/19979178/&hellip;</a>"}, {"owner": {"reputation": 109950, "user_id": 86989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bd262de5d82a235eeb64f71e4058198?s=128&d=identicon&r=PG", "display_name": "newacct", "link": "https://stackoverflow.com/users/86989/newacct"}, "edited": false, "score": 0, "creation_date": 1449542792, "post_id": 34144571, "comment_id": 56041999, "body": "Go is statically-typed. There isn&#39;t a concept of &quot;falsey&quot; in any type other than <code>bool</code>."}], "answers": [{"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": true, "score": 3, "last_activity_date": 1449527822, "creation_date": 1449527822, "answer_id": 34144637, "question_id": 34144571, "link": "https://stackoverflow.com/questions/34144571/does-golang-have-the-equivalent-of-this-python-short-circuit-idiom-z-x-or-y/34144637#34144637", "title": "Does golang have the equivalent of this Python short circuit idiom `z = x or y`", "body": "<p>No, you have to use if/else:</p>\n\n<pre><code>s1, s2 := \"\", \"hello\"\nvar x string\n\nif s1 == \"\" {\n    x = s2\n} else {\n    x = s1\n}\n</code></pre>\n"}], "owner": {"reputation": 6641, "user_id": 121725, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/149e29e5d24dde5c8ec5a146c4594348?s=128&d=identicon&r=PG", "display_name": "cerberos", "link": "https://stackoverflow.com/users/121725/cerberos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1116, "favorite_count": 0, "accepted_answer_id": 34144637, "answer_count": 1, "score": 1, "last_activity_date": 1449527822, "creation_date": 1449527563, "question_id": 34144571, "link": "https://stackoverflow.com/questions/34144571/does-golang-have-the-equivalent-of-this-python-short-circuit-idiom-z-x-or-y", "title": "Does golang have the equivalent of this Python short circuit idiom `z = x or y`", "body": "<p>In Python <code>z = x or y</code> can be understood as assign <code>z</code> as <a href=\"https://docs.python.org/2/library/stdtypes.html#boolean-operations-and-or-not\" rel=\"nofollow\">if x is falsey, then y, else x</a>, is there a similar idiom in golang? </p>\n\n<p>Specifically the two variables on the right are strings, I'd like to assign the first if it's non-emtpy, otherwise the second.</p>\n"}, {"tags": ["android", "go", "gomobile"], "comments": [{"owner": {"reputation": 14081, "user_id": 1316684, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/39d684c5718a97709d5fa679000db350?s=128&d=identicon&r=PG", "display_name": "hardPass", "link": "https://stackoverflow.com/users/1316684/hardpass"}, "edited": false, "score": 0, "creation_date": 1449566511, "post_id": 34139371, "comment_id": 56050982, "body": "Sorry, such a stupid question asked by myself. The log just said scheme is    empty. I should use &quot;http://&quot; in the url &quot;www.google.com&quot;.  In golang code, I test the <code>func</code> with correct url, and it works. In android project, the url is coming from user input. So, I should never ignore the log.  This thing bugs me all day until now , I saw the window clicked."}], "answers": [{"tags": [], "owner": {"reputation": 14081, "user_id": 1316684, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/39d684c5718a97709d5fa679000db350?s=128&d=identicon&r=PG", "display_name": "hardPass", "link": "https://stackoverflow.com/users/1316684/hardpass"}, "is_accepted": false, "score": 2, "last_activity_date": 1449566631, "creation_date": 1449566631, "answer_id": 34152133, "question_id": 34139371, "link": "https://stackoverflow.com/questions/34139371/how-to-use-gomobile-build-sdk-arr-libs-to-access-to-web/34152133#34152133", "title": "How to use gomobile build sdk-arr-libs to access to web?", "body": "<p>It's nothing to do with <code>gomobile</code>. The url <code>www.google.com</code> should started with <code>http://</code>. </p>\n"}], "owner": {"reputation": 14081, "user_id": 1316684, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/39d684c5718a97709d5fa679000db350?s=128&d=identicon&r=PG", "display_name": "hardPass", "link": "https://stackoverflow.com/users/1316684/hardpass"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1449566631, "creation_date": 1449508614, "question_id": 34139371, "link": "https://stackoverflow.com/questions/34139371/how-to-use-gomobile-build-sdk-arr-libs-to-access-to-web", "title": "How to use gomobile build sdk-arr-libs to access to web?", "body": "<p>I use <code>gomobile bind</code> generated an <code>.arr</code> file. </p>\n\n<pre><code>gomobile version\ngomobile version +e154aff Wed Dec 2 14:48:43 2015 +0000 (android); androidSDK=D:\\android\\sdk\\platforms\\android-23\n\ngo version\ngo version go1.5.2 windows/amd64\n</code></pre>\n\n<p>Go code include a <code>func</code> which access to web.</p>\n\n<pre><code>client := &amp;http.Client{}\nreq, err := http.NewRequest(\"GET\", url, nil)\nif err != nil {\n    log.Fatal(err.Error())\n}\nresp, err := client.Do(req)\n</code></pre>\n\n<p>I add this <code>.arr</code> to my Android project in <code>Android Studio</code>, build and install a apk to Virtual Devices.</p>\n\n<p>But the app can't access to web.</p>\n\n<p>After running app it comes out:</p>\n\n<pre><code> GoLog: Get www.google.com: unsupported protocol scheme \"\"\n</code></pre>\n\n<p>I must missed something, please help me.</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"comments": [{"owner": {"reputation": 3730, "user_id": 464064, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5b106b3ab0dfec1dcc591dd7b8d309fb?s=128&d=identicon&r=PG", "display_name": "John F.", "link": "https://stackoverflow.com/users/464064/john-f"}, "edited": false, "score": 0, "creation_date": 1449507924, "post_id": 34138550, "comment_id": 56026160, "body": "<code>Addr()</code> got me out of that pickle. Also, did not realize I could use []*Camera vs *[]Camera. That&#39;s something else I need to read up on."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 3730, "user_id": 464064, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5b106b3ab0dfec1dcc591dd7b8d309fb?s=128&d=identicon&r=PG", "display_name": "John F.", "link": "https://stackoverflow.com/users/464064/john-f"}, "edited": false, "score": 0, "creation_date": 1449508112, "post_id": 34138550, "comment_id": 56026279, "body": "GetAll supports result argument types of  *[]Camera and *[]*Camera.  In both cases, GetAll allocates the result slice.  In the second case, GetAll also allocates the elements."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1449507386, "last_edit_date": 1449507386, "creation_date": 1449506105, "answer_id": 34138550, "question_id": 34137787, "link": "https://stackoverflow.com/questions/34137787/slice-and-interface-manipulation/34138550#34138550", "title": "Slice and interface manipulation", "body": "<p>Because the method is on a pointer receiver (as it should be), use the <a href=\"https://godoc.org/reflect#Value.Addr\" rel=\"nofollow\">address</a> of the slice element:</p>\n\n<pre><code>entity := dv.Index(i).Addr().Interface().(Queryable)\n</code></pre>\n\n<p>An alternative approach is to use a slice of pointers for the result:</p>\n\n<pre><code>var result []*Camera\nerr := c.RunQuery(ctx, q, &amp;result)\n</code></pre>\n\n<p>The code can be written to work with both []Camera or []*Camera as follows:</p>\n\n<pre><code>var queryableType = reflect.TypeOf((*Queryable)(nil)).Elem()\nneedAddr := !dv.Type().Implements(queryableType)\n\n...\n\nvar entity Queryable\nif needAddr {\n    entity = dv.Index(i).Addr().Interface().(Queryable)\n} else {\n    entity = dv.Index(i).Interface().(Queryable)\n}\n</code></pre>\n"}], "owner": {"reputation": 3730, "user_id": 464064, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5b106b3ab0dfec1dcc591dd7b8d309fb?s=128&d=identicon&r=PG", "display_name": "John F.", "link": "https://stackoverflow.com/users/464064/john-f"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 34138550, "answer_count": 1, "score": 3, "last_activity_date": 1449507386, "creation_date": 1449503747, "question_id": 34137787, "link": "https://stackoverflow.com/questions/34137787/slice-and-interface-manipulation", "title": "Slice and interface manipulation", "body": "<p>I have recently started programming with Go on Google App Engine and I have run into a road block. I come from Java land so it's been a slight struggle to adapt to Go.</p>\n\n<p>I want to have a method that allows me to pass in a pointer to a slice that I can then pass into the <code>datastore.GetAll</code> call to retrieve the results. I then want to iterate through the results and use an assertion to cast as a specific interface (Queryable) in order to call a method Map().</p>\n\n<p>Initially, I had this functioning properly:</p>\n\n<pre><code>func (s ProjectService) RunQuery(context context.Context, q *datastore.Query, projects *[]Project) error {\n    keys, err := q.GetAll(context, projects)\n    if err != nil {\n        return err\n    }\n\n    for i, key := range keys {\n        (*projects)[i].Id = key.Encode()\n        (*projects)[i].CompanyId = (*projects)[i].Company.Encode()\n    }\n    return nil\n}\n</code></pre>\n\n<p>I want to have a more generic method that can be applied to any entity that implements a <code>Queryable</code> interface. The idea is to have a hook that allows me to perform some post processing after retrieving the results. I've looked into the <code>ProperyLoadSaver</code> interface however I have no access to the actual key that is associated to the entity. I would like to store the string representation of the datastore.Key in the entity.</p>\n\n<p>This is the <code>Queryable</code> interface:</p>\n\n<pre><code>type Queryable interface {\n    Map(*datastore.Key) error\n}\n</code></pre>\n\n<p>Here's an example entity that I am persisting to the GAE store:</p>\n\n<pre><code>type Camera struct {\n    Id        string `datastore:\"-\"`\n    ProjectId string `datastore:\"-\"`\n    Name      string\n    Project   *datastore.Key `json:\"-\"`\n    Active    bool\n    Timestamp Timestamp\n}\n\n// Implement Queryable interface. Let me perform any additional mapping\nfunc (c *Camera) Map(key *datastore.Key) error {\n    c.Name = \"Maybe do other things here\"\n    c.Id = key.Encode()\n    return nil\n}\n</code></pre>\n\n<p>The idea is to have something like the snippet below.</p>\n\n<pre><code>func (c Crud) RunQuery(context context.Context, q *datastore.Query, entities interface{}) error {\n    keys, err := q.GetAll(context, entities)    \n    v := reflect.ValueOf(entities)\n    dv := v.Elem()\n\n    for i, key := range keys {          \n// I left this in to show that this worked however this won't let me enforce the interface contract\n//dv.Index(i).FieldByName(\"Id\").Set(reflect.ValueOf(key.Encode())) \n\n        entity := dv.Index(i).Interface().(Queryable)\n        entity.Map(key)    \n    }\n\n    return err\n}\n</code></pre>\n\n<p>However, when this executes, it panics with the following:</p>\n\n<p><code>PANIC: interface conversion: entity.Camera is not entity.Queryable: missing method Map goroutine 9 [running]:</code> </p>\n\n<p>Just as a note, I realize the appropriate way to perform an assertion is to do if as, <code>ok := elem.(Type); ok {}</code> but I just wanted to see what the error was</p>\n\n<p>I am guessing I am getting this error because I have defined my parameter with a pointer receiver <code>func (c *Camera) Map(key *datastore.Key) error</code> <strong>and not</strong> <code>func (c Camera) Map(key *datastore.Key) error</code>  However, I want to modify the actual value. </p>\n\n<p>Where am I going wrong with this? Is my Java-ness showing?</p>\n\n<p>Being that I am very new to Go, I may be approaching this completely wrong.</p>\n"}, {"tags": ["json", "database", "postgresql", "go", "key"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1449494105, "post_id": 34134068, "comment_id": 56016640, "body": "Your column names are in <code>queryColumns</code>, but you don&#39;t use it anywhere but <code>len(queryColumns)</code>. Have you forgot to copy it into <code>rawResult</code>?"}, {"owner": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 1, "creation_date": 1449497527, "post_id": 34134068, "comment_id": 56018844, "body": "Is there any particular reason that you&#39;re not having Postgres <a href=\"http://www.postgresql.org/docs/9.3/static/functions-json.html\" rel=\"nofollow noreferrer\">create</a> the JSON for you?"}, {"owner": {"reputation": 185, "user_id": 2147751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e580f6ab14ac6ca552f30ace3599ff89?s=128&d=identicon&r=PG", "display_name": "Kipz", "link": "https://stackoverflow.com/users/2147751/kipz"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1449533692, "post_id": 34134068, "comment_id": 56039476, "body": "@Ainar-G yeah i forgot about that. But a coworker told me that you really don&#39;t use the column names from the db to make the json, instead you define them with a struct, is this correct?"}, {"owner": {"reputation": 185, "user_id": 2147751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e580f6ab14ac6ca552f30ace3599ff89?s=128&d=identicon&r=PG", "display_name": "Kipz", "link": "https://stackoverflow.com/users/2147751/kipz"}, "reply_to_user": {"reputation": 3446, "user_id": 2061590, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nSoY0.jpg?s=128&g=1", "display_name": "Dmitri Goldring", "link": "https://stackoverflow.com/users/2061590/dmitri-goldring"}, "edited": false, "score": 0, "creation_date": 1449533698, "post_id": 34134068, "comment_id": 56039480, "body": "@DmitriGoldring It&#39;s my first project in Go, and I am still getting used to some stuff, that&#39;s why most of my code is so gross :/"}], "owner": {"reputation": 185, "user_id": 2147751, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e580f6ab14ac6ca552f30ace3599ff89?s=128&d=identicon&r=PG", "display_name": "Kipz", "link": "https://stackoverflow.com/users/2147751/kipz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 121, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1449493888, "creation_date": 1449492860, "last_edit_date": 1449493888, "question_id": 34134068, "link": "https://stackoverflow.com/questions/34134068/get-column-name-from-postgresql", "title": "Get column name from PostgreSQL", "body": "<p>I've started my journey with the lang a couple of months ago, so I can't figure out some stuff yet.</p>\n\n<p>I had a friend help me building an api, and now we are in the middle of the project when I noticed something was missing.</p>\n\n<p>When I make a request to the api, the column name from the BD is not returned, so it doesn't build a correct json.</p>\n\n<p>Can someone help me figure out how can I do it? </p>\n\n<p>I have this code:</p>\n\n<pre><code>func QueryAndReturnStrings(query string) [][]string {\n    var final [][]string\n    rows, queryErr := connection.Query(query) // execute our query and get back the rows object from the sql library\n    if queryErr != nil {\n        log.Fatal(queryErr)\n    }\n\n    defer rows.Close() // defer rows.close() so we give our connection back when we\u2019re done\n    queryColumns, colErr := rows.Columns()\n    if colErr != nil {\n        log.Fatal(colErr)\n    }\n\n    // Result is your slice string.\n    rawResult := make([][]byte, len(queryColumns)) // Then we make rawResult which is an array of array of bytes which is the length of the # of columns in our sql table (that\u2019s pretty important)\n    var result []string\n\n    // dest = destination\n    dest := make([]interface{}, len(queryColumns)) // A temporary interface{} slice | then we create dest which is an array of interface{}\n    // we loop through dest and set it equal to a pointer to the corresponding index in rawResult so we have dest which is an array of pointers to arrays of bytes. (if you don\u2019t really understand pointers, this is going to get really nuts.)\n    for i := range rawResult {\n        dest[i] = &amp;rawResult[i] // Put pointers to each string in the interface slice\n    }\n\n    leng := len(queryColumns)\n    count := 0\n\n    for rows.Next() { //  loops through each row in it\u2019s raw sql form\n        err := rows.Scan(dest...)\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        for _, raw := range rawResult {\n            count++\n            if raw == nil {\n                result = append(result, \"\\\\N\")\n            } else {\n                result = append(result, string(raw))\n            }\n\n            if count == leng {\n                count = 0\n                final = append(final, result)\n                result = nil\n            }\n        }\n    }\n    return final\n}\n</code></pre>\n"}, {"tags": ["time", "go", "unix-timestamp"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 31, "last_activity_date": 1471847571, "last_edit_date": 1471847571, "creation_date": 1449478074, "answer_id": 34129540, "question_id": 34129276, "link": "https://stackoverflow.com/questions/34129276/get-3-years-ago-timestamp-in-golang/34129540#34129540", "title": "Get 3 years ago timestamp in golang?", "body": "<p>Simply use the <a href=\"https://golang.org/pkg/time/#Time.AddDate\" rel=\"noreferrer\"><code>Time.AddDate()</code></a> method where you can specify the time to add in years, months and days, all of which can also be negative if you want to go back in time:</p>\n\n<p><code>AddDate()</code> method declaration:</p>\n\n<pre><code>func (t Time) AddDate(years int, months int, days int) Time\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>t := time.Now()\nfmt.Println(t)\nt2 := t.AddDate(-3, 0, 0)\nfmt.Println(t2)\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/eNSqOcBkUJ\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>2009-11-10 23:00:00 +0000 UTC\n2006-11-10 23:00:00 +0000 UTC\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 614, "user_id": 131005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z2JqP.jpg?s=128&g=1", "display_name": "Tom Anderson", "link": "https://stackoverflow.com/users/131005/tom-anderson"}, "edited": false, "score": 0, "creation_date": 1598601449, "post_id": 60508175, "comment_id": 112517777, "body": "So you&#39;re saying, to adjust the &quot;now&quot; by a &quot;shift&quot; number of years: <code>now.AddDate(shift, 0, 0)</code>  The current time can be adjusted to @roger&#39;s three years previous with your function using the following: <code>timeShift(time.Now(), year, -3)</code>"}], "tags": [], "owner": {"reputation": 422, "user_id": 7327955, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Te8cv.jpg?s=128&g=1", "display_name": "Eds_k", "link": "https://stackoverflow.com/users/7327955/eds-k"}, "is_accepted": false, "score": 0, "last_activity_date": 1583241538, "creation_date": 1583241538, "answer_id": 60508175, "question_id": 34129276, "link": "https://stackoverflow.com/questions/34129276/get-3-years-ago-timestamp-in-golang/60508175#60508175", "title": "Get 3 years ago timestamp in golang?", "body": "<p>Maybe you can do this</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc timeShift(now time.Time, timeType string, shift int) time.Time {\n    var shiftTime time.Time\n    switch timeType {\n    case \"year\":\n        shiftTime = now.AddDate(shift, 0, 0)\n    case \"month\":\n        shiftTime = now.AddDate(0, shift, 0)\n    case \"day\":\n        shiftTime = now.AddDate(0, 0, shift)\n    case \"hour\":\n        shiftTime = now.Add(time.Hour * time.Duration(shift))\n    case \"minute\":\n        shiftTime = now.Add(time.Minute * time.Duration(shift))\n    case \"second\":\n        shiftTime = now.Add(time.Second * time.Duration(shift))\n    default:\n        shiftTime = now\n    }\n    return shiftTime\n}\n\nfunc main(){\n    d := time.Now().UTC()\n    fmt.Println(timeShift(d, \"month\", 1))\n    fmt.Println(timeShift(d, \"day\", -1))\n    fmt.Println(timeShift(d, \"hour\", -1))\n    fmt.Println(timeShift(d, \"minute\", -1))\n    fmt.Println(timeShift(d, \"second\", -1))\n}\n\n</code></pre>\n"}], "owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9040, "favorite_count": 3, "accepted_answer_id": 34129540, "answer_count": 2, "score": 12, "last_activity_date": 1583241538, "creation_date": 1449477054, "last_edit_date": 1449504522, "question_id": 34129276, "link": "https://stackoverflow.com/questions/34129276/get-3-years-ago-timestamp-in-golang", "title": "Get 3 years ago timestamp in golang?", "body": "<p>I want to get the time unix time stamp 3 years ago, I use this now:</p>\n\n<pre><code>time.Now().Unix(() - 3 * 3600 * 24 * 365\n</code></pre>\n\n<p>This is not that accurate anyway (because year may have 366 days).</p>\n"}, {"tags": ["go", "namespaces", "package"], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1449471284, "post_id": 34127944, "comment_id": 56004098, "body": "You might also mention specifying output name: <code>go build -o myexename</code>."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 3, "last_activity_date": 1449471003, "creation_date": 1449471003, "answer_id": 34127944, "question_id": 34127810, "link": "https://stackoverflow.com/questions/34127810/go-lang-workspace-duplicate-package-name-executable-collision/34127944#34127944", "title": "Go Lang Workspace Duplicate Package Name Executable Collision", "body": "<p>This collision happens only for executables and <em>never</em> for packages. Executables are much less common and often have distinguishing names so in practice I never encountered this problem.</p>\n\n<p>The \"fix\" or \"best practice\" is obvious and dead simple: Just rename the binary after installing.  </p>\n"}], "owner": {"reputation": 205, "user_id": 3331119, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/7b73af83bab5857f80eed64cd4c0e71d?s=128&d=identicon&r=PG&f=1", "display_name": "user3331119", "link": "https://stackoverflow.com/users/3331119/user3331119"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 752, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1449471003, "creation_date": 1449470367, "question_id": 34127810, "link": "https://stackoverflow.com/questions/34127810/go-lang-workspace-duplicate-package-name-executable-collision", "title": "Go Lang Workspace Duplicate Package Name Executable Collision", "body": "<p>If following the GoLang documentation for workspace structure it is possible that two executable packages will share the same package name.</p>\n\n<p>For example, there are two packages from github:</p>\n\n<pre><code>$ $GOPATH/src/github.com/alpha/import\n$ $GOPATH/src/github.com/beta/import\n</code></pre>\n\n<p>The <code>import</code> package from user <code>alpha</code> is first installed:</p>\n\n<pre><code>$ go install github.com/alpha/import\n</code></pre>\n\n<p>The binary executable is now available in <code>$GOPATH/bin</code> and is named <code>import</code>.</p>\n\n<p>Then the second package from user <code>beta</code> is installed:</p>\n\n<pre><code>$ go install github.com/beta/import\n</code></pre>\n\n<p>This install/build will replace the existing <code>import</code> binary from user <code>alpha</code> with the <code>import</code> binary from user <code>beta</code>.</p>\n\n<p>A better naming convention could avoid this collision; however, is there a standard practice for fixing this issue when using third party libraries?</p>\n"}, {"tags": ["json", "struct", "go", "beego"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1449468104, "post_id": 34127023, "comment_id": 56002908, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/26327391/go-json-marshalstruct-returns\">Go json.Marshal(struct) returns &quot;{}&quot;</a>"}, {"owner": {"reputation": 1220, "user_id": 2578409, "user_type": "registered", "profile_image": "https://graph.facebook.com/100003551172293/picture?type=large", "display_name": "Bruce", "link": "https://stackoverflow.com/users/2578409/bruce"}, "edited": false, "score": 0, "creation_date": 1514950011, "post_id": 34127023, "comment_id": 83115174, "body": "The same question here: <a href=\"https://stackoverflow.com/questions/8270816/converting-go-struct-to-json\" title=\"converting go struct to json\">stackoverflow.com/questions/8270816/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 8, "last_activity_date": 1449467895, "creation_date": 1449467895, "answer_id": 34127352, "question_id": 34127023, "link": "https://stackoverflow.com/questions/34127023/json-response-in-beego-controller/34127352#34127352", "title": "JSON Response in Beego Controller", "body": "<p>You need to <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"noreferrer\">export</a> the fields in ErrorJson by starting the name with an uppercase character. Use field tags to specify the lowercase names in the output.</p>\n\n<pre><code>type ErrorJson struct {\n    S string `json:\"s\"`\n    D string `json:\"d\"`\n}\n</code></pre>\n\n<p>The encoding/json package and similar packages ignore unexported fields.</p>\n"}, {"tags": [], "owner": {"reputation": 1948, "user_id": 1924657, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/gumlg.jpg?s=128&g=1", "display_name": "Bryce", "link": "https://stackoverflow.com/users/1924657/bryce"}, "is_accepted": false, "score": 1, "last_activity_date": 1451962348, "creation_date": 1451962348, "answer_id": 34603463, "question_id": 34127023, "link": "https://stackoverflow.com/questions/34127023/json-response-in-beego-controller/34603463#34603463", "title": "JSON Response in Beego Controller", "body": "<p>The <code>s</code> &amp; <code>d</code>, low case in golang is not visable. </p>\n"}], "owner": {"reputation": 373, "user_id": 3414989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/497106b8161a35b4e7b5e87f7dd9a48b?s=128&d=identicon&r=PG&f=1", "display_name": "GokulSrinivas", "link": "https://stackoverflow.com/users/3414989/gokulsrinivas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4050, "favorite_count": 0, "accepted_answer_id": 34127352, "answer_count": 2, "score": 4, "last_activity_date": 1451962348, "creation_date": 1449466054, "last_edit_date": 1449484262, "question_id": 34127023, "link": "https://stackoverflow.com/questions/34127023/json-response-in-beego-controller", "title": "JSON Response in Beego Controller", "body": "<p>I'm a newbie to beego trying to get a JSON response on a route.</p>\n\n<p>I have a controller defined as such.</p>\n\n<pre><code>package controllers\n\nimport (\n    \"github.com/astaxie/beego\"\n)\n\ntype ErrorController struct {\n    beego.Controller\n}\n\ntype ErrorJson struct {\n    s string\n    d string\n}\n\nfunc (this *ErrorController) Get() {\n\n    var responseJson ErrorJson\n    responseJson = ErrorJson{\n        s: \"asdf\",\n        d: \"qwer\",\n    }\n\n    this.Data[\"json\"] = responseJson\n    this.ServeJson()\n}\n</code></pre>\n\n<p>My router is defined as </p>\n\n<pre><code>beego.Router(\"/api\", &amp;controllers.ErrorController{})\n</code></pre>\n\n<p>When I visit the route, I get an Empty JSON object without any properties.</p>\n\n<pre><code>{}\n</code></pre>\n\n<p>If I replace the json struct with a string, I get a response. So beego is aware of the controller and the method. </p>\n\n<pre><code>this.Data[\"json\"] = \"Hello World\"\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["unicode", "go"], "answers": [{"comments": [{"owner": {"reputation": 345, "user_id": 3875388, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/55ed443f429fad4949ce495f5d0f5bd8?s=128&d=identicon&r=PG&f=1", "display_name": "user3875388", "link": "https://stackoverflow.com/users/3875388/user3875388"}, "edited": false, "score": 0, "creation_date": 1592987169, "post_id": 34127730, "comment_id": 110618454, "body": "How handle the string like this &quot;\\u0070\\x68\\x65\\x72&quot; which already in quote. I my test, it can&#39;t."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 345, "user_id": 3875388, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/55ed443f429fad4949ce495f5d0f5bd8?s=128&d=identicon&r=PG&f=1", "display_name": "user3875388", "link": "https://stackoverflow.com/users/3875388/user3875388"}, "edited": false, "score": 0, "creation_date": 1592987706, "post_id": 34127730, "comment_id": 110618745, "body": "@user3875388 If it already contains quotes, simply don&#39;t add quotes. See working example on <a href=\"https://play.golang.org/p/Q3WIPOkmjaB\" rel=\"nofollow noreferrer\">play.golang.org/p/Q3WIPOkmjaB</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1489360873, "last_edit_date": 1489360873, "creation_date": 1449469914, "answer_id": 34127730, "question_id": 34126749, "link": "https://stackoverflow.com/questions/34126749/convert-unicode-code-point-to-literal-character-in-go/34127730#34127730", "title": "Convert unicode code point to literal character in Go", "body": "<p>You can use the <a href=\"https://golang.org/pkg/strconv/#Unquote\" rel=\"nofollow noreferrer\"><code>strconv.Unquote()</code></a> and <a href=\"https://golang.org/pkg/strconv/#UnquoteChar\" rel=\"nofollow noreferrer\"><code>strconv.UnquoteChar()</code></a> functions to do the conversion.</p>\n\n<p>One thing you should be aware of is that <code>strconv.Unquote()</code> can only unquote strings that are in quotes (e.g. start and end with a quote char <code>\"</code> or a back quote char <code>`</code>),  so we have to manually append that.</p>\n\n<p>See this example:</p>\n\n<pre><code>lines := []string{\n    `\\u0053`,\n    `\\u0075`,\n    `\\u006E`,\n}\nfmt.Println(lines)\n\nfor i, v := range lines {\n    var err error\n    lines[i], err = strconv.Unquote(`\"` + v + `\"`)\n    if err != nil {\n        fmt.Println(err)\n    }\n}\nfmt.Println(lines)\n\nfmt.Println(strconv.Unquote(`\"Go\\u0070\\x68\\x65\\x72\"`))\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/BZO5J0233H\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[\\u0053 \\u0075 \\u006E]\n[S u n]\nGopher &lt;nil&gt;\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 3, "last_activity_date": 1449504629, "creation_date": 1449504629, "answer_id": 34138076, "question_id": 34126749, "link": "https://stackoverflow.com/questions/34126749/convert-unicode-code-point-to-literal-character-in-go/34138076#34138076", "title": "Convert unicode code point to literal character in Go", "body": "<p>A slightly different approach is using <a href=\"https://golang.org/pkg/strconv/#ParseInt\" rel=\"nofollow\"><code>strconv.ParseInt</code></a>, this generates less garbage and uses less internal logic (<a href=\"https://golang.org/src/strconv/quote.go?s=7947:7991#L296\" rel=\"nofollow\"><code>Unquote</code></a> does a lot of other checks) for parsing the lines:</p>\n\n<pre><code>for i, v := range lines {\n    if len(v) != 6 {\n        continue\n    }\n\n    if r, err := strconv.ParseInt(v[2:], 16, 32); err == nil {\n        lines[i] = string(r)\n    }\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/MrVgUN_p7Y\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n"}], "owner": {"reputation": 5024, "user_id": 1419891, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/bb825cd3f1905f42c16408393480a65b?s=128&d=identicon&r=PG", "display_name": "425nesp", "link": "https://stackoverflow.com/users/1419891/425nesp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1670, "favorite_count": 1, "accepted_answer_id": 34127730, "answer_count": 2, "score": 5, "last_activity_date": 1489360873, "creation_date": 1449464375, "question_id": 34126749, "link": "https://stackoverflow.com/questions/34126749/convert-unicode-code-point-to-literal-character-in-go", "title": "Convert unicode code point to literal character in Go", "body": "<p>Let's say I have a text file like this.</p>\n\n<pre><code>\\u0053\n\\u0075\n\\u006E\n</code></pre>\n\n<p>Is there a way I can convert that to this?</p>\n\n<pre><code>S\nu\nn\n</code></pre>\n\n<p>Currently, I'm using <code>ioutil.ReadFile(\"data.txt\")</code>, but when I print the data, I get the unicode code points instead of the string literals. I realize this is the correct behavior for <code>ReadFile</code>, it's just not want I want.</p>\n\n<p>I'm aiming for a substitution of the code points with their literal characters.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1449477248, "post_id": 34126083, "comment_id": 56006562, "body": "gofmt needs to parse its input, so the input must use Go syntax. If 99% of your code are templates that are not valid Go, you might consider creating your own templatefmt tool."}, {"owner": {"reputation": 2446, "user_id": 1366749, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/1511f0e35161decf1a62a8318b3eb97e?s=128&d=identicon&r=PG", "display_name": "Kevin Bullaughey", "link": "https://stackoverflow.com/users/1366749/kevin-bullaughey"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1449518678, "post_id": 34126083, "comment_id": 56032422, "body": "It&#39;s not that 99% of my code are templates, it&#39;s 99% of each template is regular go code (only 1% are dynamic pieces that are evaluated during template rendering). Only a tiny fraction of my overall code base is templates."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1449540135, "post_id": 34126083, "comment_id": 56041226, "body": "sorry, I miss-understood. Still this will require a separate tool."}], "answers": [{"comments": [{"owner": {"reputation": 2446, "user_id": 1366749, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/1511f0e35161decf1a62a8318b3eb97e?s=128&d=identicon&r=PG", "display_name": "Kevin Bullaughey", "link": "https://stackoverflow.com/users/1366749/kevin-bullaughey"}, "edited": false, "score": 0, "creation_date": 1449674153, "post_id": 34126322, "comment_id": 56110830, "body": "That is very helpful to know how to do this programmatically (and so I&#39;ve voted you up), but it doesn&#39;t answer my question, which appears may not have a good answer, unfortunately. What is the SO etiquette for this? Leave the question without an accepted answer in case a solution comes along?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 2446, "user_id": 1366749, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/1511f0e35161decf1a62a8318b3eb97e?s=128&d=identicon&r=PG", "display_name": "Kevin Bullaughey", "link": "https://stackoverflow.com/users/1366749/kevin-bullaughey"}, "edited": false, "score": 0, "creation_date": 1450545252, "post_id": 34126322, "comment_id": 56488348, "body": "@KevinBullaughey The question assumes a solution to the underlying problem: how does one produce gofmt&#39;ed output from go generate?  One work around for accepting this answer is to edit the question to ask about the underlying problem. Because gofmt&#39;ing the template does not ensure that the output will be gofmt&#39;ed, it&#39;s not worth the effort to gofmt templates."}, {"owner": {"reputation": 2446, "user_id": 1366749, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/1511f0e35161decf1a62a8318b3eb97e?s=128&d=identicon&r=PG", "display_name": "Kevin Bullaughey", "link": "https://stackoverflow.com/users/1366749/kevin-bullaughey"}, "edited": false, "score": 0, "creation_date": 1450554242, "post_id": 34126322, "comment_id": 56491104, "body": "Actually, I think you did answer the question. I didn&#39;t think about it carefully enough. The short answer is &#39;no&#39; and the reason is a bit subtle: (1) as you point out it&#39;s unnecessary because one can easily ensure the output is always properly formatted, and (2) even if one wanted to build such a tool, it would be impossible to parse the template based on the go language grammar because the template might be missing critical symbols, keywords, etc. and so even the concept of a properly formatted template is ill-defined. Thanks!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 14, "last_activity_date": 1449675812, "last_edit_date": 1449675812, "creation_date": 1449461565, "answer_id": 34126322, "question_id": 34126083, "link": "https://stackoverflow.com/questions/34126083/is-it-possible-to-use-gofmt-on-templates-that-are-designed-to-be-used-with-go-ge/34126322#34126322", "title": "Is it possible to use gofmt on templates that are designed to be used with go generate?", "body": "<p>Most generation tools execute the template to a *bytes.Buffer, format the buffer bytes using <a href=\"https://godoc.org/go/format#Source\" rel=\"noreferrer\">format.Source</a> and write the result to the output file.</p>\n\n<p>Given template <code>t</code> and output writer <code>w</code>, the code looks something like this:</p>\n\n<pre><code>var buf bytes.Buffer\nif err := t.Execute(&amp;buf, data); err != nil {\n    // handle error\n}\np, err := format.Source(buf.Bytes())\nif err != nil {\n    // handle error\n}\nw.Write(p)\n</code></pre>\n\n<p>Gofmting the template does not ensure that the output will be gofmted. Given how easy it is to gofmt the output using the go/format package, there's little value in creating a tool to gofmt templates.</p>\n"}], "owner": {"reputation": 2446, "user_id": 1366749, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/1511f0e35161decf1a62a8318b3eb97e?s=128&d=identicon&r=PG", "display_name": "Kevin Bullaughey", "link": "https://stackoverflow.com/users/1366749/kevin-bullaughey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1774, "favorite_count": 1, "accepted_answer_id": 34126322, "answer_count": 1, "score": 5, "last_activity_date": 1449675812, "creation_date": 1449459830, "question_id": 34126083, "link": "https://stackoverflow.com/questions/34126083/is-it-possible-to-use-gofmt-on-templates-that-are-designed-to-be-used-with-go-ge", "title": "Is it possible to use gofmt on templates that are designed to be used with go generate?", "body": "<p>I am using go:generate to handle automatically generating some database models and I was hoping to run my go template through <code>gofmt</code>, but it chokes with all the extra <code>{{ ... }}</code> dynamic sections. </p>\n\n<p>Am I missing something obvious? I was hoping that this was a use case the <code>gofmt</code> people had addressed, given both <code>gofmt</code> and <code>go generate</code> are prominent parts of the go toolchain. </p>\n\n<p>Obviously, it works to just run <code>go fmt</code> after <code>go generate</code> but it just feels dirty to have poorly formatted templates that are 99% go code sitting around. </p>\n"}, {"tags": ["go", "constants", "iota"], "comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1449445979, "post_id": 34124294, "comment_id": 55997322, "body": "Can you write a little bit more clear your problem? What exactly do you want to get?"}, {"owner": {"reputation": 19346, "user_id": 2793118, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5da03d2e233e1a40a4f1923acfb9d433?s=128&d=identicon&r=PG", "display_name": "Filipe Gon&#231;alves", "link": "https://stackoverflow.com/users/2793118/filipe-gon%c3%a7alves"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1449446204, "post_id": 34124294, "comment_id": 55997367, "body": "@SalvadorDali Sorry if I wasn&#39;t clear. The question is basically how you would solve the exercise? Because it looks like I&#39;m supposed to use <code>iota</code> in some way, given the context."}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 2, "creation_date": 1449446961, "post_id": 34124294, "comment_id": 55997561, "body": "What about <code>const ( KB = 1000; MB = 1000 * KB; GB = 1000 * MB; TB = 1000 * GB; &#47;* ... *&#47; )</code>?  Not as slick as the powers of 1024 using iota and implicit repetition, but I can&#39;t think of anything more compact if you want them to be constants."}], "answers": [{"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": true, "score": 3, "last_activity_date": 1449448780, "creation_date": 1449448780, "answer_id": 34124734, "question_id": 34124294, "link": "https://stackoverflow.com/questions/34124294/writing-powers-of-10-as-constants-compactly/34124734#34124734", "title": "Writing powers of 10 as constants compactly", "body": "<p>I would say that this is impossible because what you want is to represent a function <code>10^(3i)</code> where <code>i</code> is a positive integer as some function <code>f(i)</code>, where <code>f</code> is a compositive function of your elementary go functions (+, -, /, *).</p>\n\n<p>It was possible for <code>2^(10i)</code> only because go introduced another elementary function integer exponentiation. So if <code>1 &lt;&lt; y</code> would allow y being float, you would be able to modify your code to use <code>1 &lt;&lt; (log2(10) * 3 * i)</code>. This would worked because this is equivalent to solving <code>10^(3i) = 2^y</code>. Taking log2 of both sides <code>y = log2(10) * 3 * i</code>.</p>\n\n<p>But sadly enough bitwise shift is an integer operation.</p>\n"}, {"comments": [{"owner": {"reputation": 19346, "user_id": 2793118, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5da03d2e233e1a40a4f1923acfb9d433?s=128&d=identicon&r=PG", "display_name": "Filipe Gon&#231;alves", "link": "https://stackoverflow.com/users/2793118/filipe-gon%c3%a7alves"}, "edited": false, "score": 1, "creation_date": 1449533213, "post_id": 34145667, "comment_id": 56039315, "body": "Thanks, I do believe there is no &quot;clever&quot; way with <code>iota</code>, especially after Salvador&#39;s answer. I appreciate you taking the time to answer my question but unfortunately I can only accept one answer. I like the floating-point approach, but I prefer the other where you multiply by the previous - it&#39;s clearer and it doesn&#39;t yield constants where the underlying type is a float."}, {"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "reply_to_user": {"reputation": 19346, "user_id": 2793118, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5da03d2e233e1a40a4f1923acfb9d433?s=128&d=identicon&r=PG", "display_name": "Filipe Gon&#231;alves", "link": "https://stackoverflow.com/users/2793118/filipe-gon%c3%a7alves"}, "edited": false, "score": 2, "creation_date": 1449558519, "post_id": 34145667, "comment_id": 56047047, "body": "@FilipeGon&#231;alves the underlying types must be floats, ZB and YB will overflow uint64.  What&#39;s interesting is that the const declarations will be fine, but your code will fail once you try to use them.  Golang is funny about types of constants: <a href=\"https://blog.golang.org/constants\" rel=\"nofollow noreferrer\">blog.golang.org/constants</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 8, "last_activity_date": 1449579778, "last_edit_date": 1449579778, "creation_date": 1449532843, "answer_id": 34145667, "question_id": 34124294, "link": "https://stackoverflow.com/questions/34124294/writing-powers-of-10-as-constants-compactly/34145667#34145667", "title": "Writing powers of 10 as constants compactly", "body": "<p>You quoted it yourself:</p>\n\n<blockquote>\n  <p>The <code>iota</code> mechanism has its limits. For example, it's not possible to generate the more familiar powers of 1000 (KB, MB, and so son) because there is no exponentiation operator.</p>\n</blockquote>\n\n<p>The authors don't want you to still find a way despite they not knowing any. The authors want you to create constant declarations for KB, MB etc. <em>as compact as you can</em>.</p>\n\n<h3>With Floating-point literals</h3>\n\n<p>Here's a compact way. This utilizes <a href=\"https://golang.org/ref/spec#Floating-point_literals\" rel=\"noreferrer\">Floating-point literals</a> with exponent part. Think of it: writing <code>1e3</code> is even shorter than writing <code>1000</code> (not to mention the rest...).</p>\n\n<p>Also it compresses all identifiers into one constant specification, so we reduce the <code>=</code> signs to 1.</p>\n\n<p>Here it is, just one line (<strong>67 characters</strong> without spaces):</p>\n\n<pre><code>const ( KB, MB, GB, TB, PB, EB, ZB, YB = 1e3, 1e6, 1e9, 1e12, 1e15, 1e18, 1e21, 1e24 )\n</code></pre>\n\n<p>Note that since we used floating-point literals, the constant identifiers (<code>KB</code>, <code>MB</code>...) denote floating-point constants, even though the literals' fractional parts are zero.</p>\n\n<h3>With integer literal, using <code>KB</code> as the multiplier</h3>\n\n<p>If we want untyped integer constants, we have to write <code>1000</code> for the <code>KB</code>. And to get the next one, we would automatically turn to multiply the previous identifier with <code>1000</code>. But note that we can also multiply the next one with <code>KB</code> because it's exactly <code>1000</code> - but shorter by two characters :).</p>\n\n<p>And so here are the untyped integer constant declarations (<strong>77 characters</strong> without spaces):</p>\n\n<pre><code>const (KB,MB,GB,TB,PB,EB,ZB,YB = 1000,KB*KB,MB*KB,GB*KB,TB*GB,PB*KB,EB*KB,ZB*KB)\n</code></pre>\n\n<p>(Sorry for removing spaces, but wanted it to fit in one line.)</p>\n\n<h3>With integer literal, using an extra <code>x</code> const as the multiplier</h3>\n\n<p>You can even gain 3 characters from the last solution if you also introduce a 1-char length const <code>x</code> which you use multiple times to do the multiplication instead of the <code>*KB</code>:</p>\n\n<p>With an extra <code>x</code> const (<strong>74 characters</strong> without spaces):</p>\n\n<pre><code>const (x,KB,MB,GB,TB,PB,EB,ZB,YB = 1000,x,x*x,MB*x,GB*x,TB*GB,PB*x,EB*x,ZB*x)\n</code></pre>\n\n<h3>With <code>rune</code> literal</h3>\n\n<p>We can even shorten it one more character if we specify the <code>1000</code> constant as a rune constant, with a rune whose code point is <code>1000</code>, which is <code>'\u03e8'</code> - which is 1 character less :)</p>\n\n<p>With a <code>rune</code> literal <code>'\u03e8'</code> const (<strong>73 characters</strong> without spaces):</p>\n\n<pre><code>const (x,KB,MB,GB,TB,PB,EB,ZB,YB = '\u03e8',x,x*x,MB*x,GB*x,TB*GB,PB*x,EB*x,ZB*x)\n</code></pre>\n\n<p>Note that these will be rune constants, but just as all other numeric constants, they represent values of arbitrary precision and do not overflow.</p>\n"}], "owner": {"reputation": 19346, "user_id": 2793118, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5da03d2e233e1a40a4f1923acfb9d433?s=128&d=identicon&r=PG", "display_name": "Filipe Gon&#231;alves", "link": "https://stackoverflow.com/users/2793118/filipe-gon%c3%a7alves"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1918, "favorite_count": 2, "accepted_answer_id": 34124734, "answer_count": 2, "score": 7, "last_activity_date": 1595355604, "creation_date": 1449445621, "last_edit_date": 1595355604, "question_id": 34124294, "link": "https://stackoverflow.com/questions/34124294/writing-powers-of-10-as-constants-compactly", "title": "Writing powers of 10 as constants compactly", "body": "<p>I'm reading the recently released <a href=\"http://www.gopl.io/\" rel=\"nofollow noreferrer\">The Go Programming Language</a>, and it's been a joy so far (with Brian Kernighan being one of the authors, I wouldn't expect anything other than excellence anyway).</p>\n<p>I've come across the following exercise on chapter 3:</p>\n<blockquote>\n<p><strong>Exercise 3.13</strong>\nWrite <code>const</code> declarations for KB, MB, up through YB as compactly as you can.</p>\n</blockquote>\n<p>(<strong>NOTE</strong>: in this context, KB, MB, etc, denote powers of 1000)</p>\n<p>This is preceded by a section where <code>iota</code> is introduced as a useful constants generator mechanism; in particular, the previous paragraph shows a nice and compact way to define the powers of 1024 as constants:</p>\n<pre><code>const (\n    _ = 1 &lt;&lt; (10 * iota)\n    KiB\n    MiB\n    GiB\n    TiB\n    PiB\n    EiB\n    ZiB\n    YiB\n)\n</code></pre>\n<p>The authors further mention this regarding powers of 10:</p>\n<blockquote>\n<p>The <code>iota</code> mechanism has its limits. For example, it's not possible to generate the more familiar powers of 1000 (KB, MB, and so son) because there is no exponentiation operator.</p>\n</blockquote>\n<p>I'm struggling with this exercise because it looks like the expected solution is something a little more elaborate than simply spelling out the powers of 1000 by hand (especially since it appears after <code>iota</code> is introduced). I feel like there is some clever way to do this that uses <code>iota</code> in a subtle way combined with something else.</p>\n<p>I thought about finding a systematic way to subtract the &quot;excess&quot; amount out of each of the powers of 1024 to get the powers of 1000, but it led me to nowhere. Then I looked at the binary representations to try and infer a general pattern where <code>iota</code> could be useful, but again, I got nothing.</p>\n<p>I really can't see how one would generate powers of 1000 out of a single incrementing value (<code>iota</code>) without an exponentiation operator.</p>\n<p>Any ideas?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 7506, "user_id": 622391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cea6f87ff9eacc4b168afcb647d69977?s=128&d=identicon&r=PG", "display_name": "Simon M\u1d9cKenzie", "link": "https://stackoverflow.com/users/622391/simon-m%e1%b6%9ckenzie"}, "edited": false, "score": 7, "creation_date": 1449445468, "post_id": 34124246, "comment_id": 55997199, "body": "That&#39;s what <code>FindString</code> does: <a href=\"https://golang.org/pkg/regexp/#Regexp.FindString\" rel=\"nofollow noreferrer\">golang.org/pkg/regexp/#Regexp.FindString</a>. If you want all matches, you should be using <code>FindAllString</code>: <a href=\"https://golang.org/pkg/regexp/#Regexp.FindAllString\" rel=\"nofollow noreferrer\">golang.org/pkg/regexp/#Regexp.FindAllString</a>"}], "answers": [{"tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": false, "score": 1, "last_activity_date": 1453676294, "creation_date": 1453676294, "answer_id": 34982617, "question_id": 34124246, "link": "https://stackoverflow.com/questions/34124246/regular-expression-only-printing-first-string-per-line/34982617#34982617", "title": "Regular expression only printing first string per line", "body": "<p>As Simon mentioned, you should be using <code>FindAllString</code> to find all matches. Also, you need to remove the ^ from the beginning of the RE (^ anchors the pattern to the beginning of the string). You should also move the regexp.Compile outside the loop for efficiency.</p>\n"}, {"tags": [], "owner": {"reputation": 615, "user_id": 4762316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9df8162515eab0a6d4fed9c4674aa36?s=128&d=identicon&r=PG&f=1", "display_name": "Apoorva Manjunath", "link": "https://stackoverflow.com/users/4762316/apoorva-manjunath"}, "is_accepted": false, "score": 0, "last_activity_date": 1458372230, "creation_date": 1458372230, "answer_id": 36099046, "question_id": 34124246, "link": "https://stackoverflow.com/questions/34124246/regular-expression-only-printing-first-string-per-line/36099046#36099046", "title": "Regular expression only printing first string per line", "body": "<p><a href=\"https://play.golang.org/p/Q_yfub0k80\" rel=\"nofollow\">https://play.golang.org/p/Q_yfub0k80</a></p>\n\n<p>As mentioned here, <code>FindAllString</code> returns a slice of all successive matches of the regular expression. But, <code>FindString</code> returns  the leftmost match.</p>\n"}], "owner": {"reputation": 111, "user_id": 5647889, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a88f5cab6a050cd4b0d04f07d702633?s=128&d=identicon&r=PG&f=1", "display_name": "yoyoma207", "link": "https://stackoverflow.com/users/5647889/yoyoma207"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1458372230, "creation_date": 1449445203, "last_edit_date": 1449445256, "question_id": 34124246, "link": "https://stackoverflow.com/questions/34124246/regular-expression-only-printing-first-string-per-line", "title": "Regular expression only printing first string per line", "body": "<p>I'm trying to get more experience with Go by writing a program that takes input from a .txt file, then sorts each string alphabetically and prints each one out with it's corresponding line number. Right now I'm having a problem where my program is only printing out the first string per line when I pass it my input.txt file</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"regexp\"\nimport \"bufio\"\nimport \"log\"\nimport \"os\"\nimport \"strings\"\n\nfunc main() {\n\n    var i int = 0 //counter for loop\n\n    var words1 string\n\n    scanner := bufio.NewScanner(os.Stdin)\n\n    //holdWords := make(map[string]int)\n    //Loop through the txt doc and cleanup the lines of strings\n    for scanner.Scan(){\n        i=i+1\n\n        words1=scanner.Text(); //get the text from line\n        words1=strings.TrimSpace(words1) //trim the trailing and leading whitespace\n\n        reg, err:=  regexp.Compile(\"^[a-zA-Z]+\") //regex to look for letters/spaces\n\n        if err != nil{\n            log.Fatal(err)\n        }\n\n        fmt.Println(reg.FindString(words1))//just testing to see if it prints correct values\n\n    }\n}\n</code></pre>\n"}, {"tags": ["sockets", "go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 4, "creation_date": 1449432952, "post_id": 34119757, "comment_id": 55993101, "body": "why are you building the entire client, dialer, transport, etc stack for each call? why not use a single client for everything? the client does connection pooling and recycling, etc."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 8, "creation_date": 1449452827, "post_id": 34119757, "comment_id": 55999034, "body": "You have no timeout for your requests, so any request that hangs will leave an open connection. You also have disabled TCP keepalives, so broken connections may never be detected."}, {"owner": {"reputation": 221, "user_id": 587170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/788a968014b84617ffcae5fa6c574204?s=128&d=identicon&r=PG", "display_name": "user587170", "link": "https://stackoverflow.com/users/587170/user587170"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449455131, "post_id": 34119757, "comment_id": 55999562, "body": "@JimB thanks for your answer."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1449499615, "post_id": 34119757, "comment_id": 56020193, "body": "Other possible issue in the code: Your error handling isn&#39;t correct, and is very verbose for the sake of just changing the error string slightly. You&#39;re sending Connection: close a second time for no reason. You have read/write timeouts on the server side, but no way to exit the handler early (another place that may be keeping sockets from closing). You shouldn&#39;t create new Transports (or Clients) for each call, and use the DefaultTransport unless you have a reason to override it. The code samples you&#39;ve cited in comments aren&#39;t really correct, refer to the official docs."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1478531896, "post_id": 34119757, "comment_id": 68181387, "body": "Indeed, as @JimB suspects, &#39;lsof&#39; prints &quot;can&#39;t identify protocol&quot; for half-open sockets."}, {"owner": {"reputation": 2445, "user_id": 1505341, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9XpLu.jpg?s=128&g=1", "display_name": "Kerem", "link": "https://stackoverflow.com/users/1505341/kerem"}, "edited": false, "score": 4, "creation_date": 1487515576, "post_id": 34119757, "comment_id": 71809766, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/7911840/seeing-too-many-lsof-cant-identify-protocol\">Seeing too many lsof can&#39;t identify protocol</a>"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1507590686, "post_id": 34119757, "comment_id": 80261655, "body": "@JimB Why don&#39;t you post an answer? This is AFAIK, the top voted &quot;unanswered&quot; go question."}], "answers": [{"comments": [{"owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "edited": false, "score": 1, "creation_date": 1517492348, "post_id": 47757356, "comment_id": 84123910, "body": "What is the rationale for downvoting? I did a serious effort to reproduce &amp; understand the problem, then gave the feedback based on that. How the downvoter would do it better, exactly?"}], "tags": [], "owner": {"reputation": 1881, "user_id": 229154, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/79qdK.jpg?s=128&g=1", "display_name": "Wojciech Kaczmarek", "link": "https://stackoverflow.com/users/229154/wojciech-kaczmarek"}, "is_accepted": false, "score": 1, "last_activity_date": 1513010157, "creation_date": 1513010157, "answer_id": 47757356, "question_id": 34119757, "link": "https://stackoverflow.com/questions/34119757/socket-cant-identify-protocol-socket-leak/47757356#47757356", "title": "Socket can&#39;t identify protocol (socket leak)", "body": "<p>There are couple of points here.</p>\n\n<p>I was unable to reproduce your behavior, anyway, <code>can't identify protocol</code> is usually tied to sockets not being properly closed.</p>\n\n<p>Some commenters suggested you don't have to create http client inside each handler - that's true. Simply create it once and reuse.</p>\n\n<p>Second, I'm not sure why are you creating your own <code>http.Client</code> struct and why you're disabling keepalives. Can't you just go with <code>http.Get</code> ? Simpler code is easier to debug.</p>\n\n<p>Third, not sure why are you overwriting <code>transport.Dial</code> function. Even if you must do it, the documentation (for Go 1.9.2) says:</p>\n\n<pre><code>% go doc http.transport.dial\ntype Transport struct {\n    // Dial specifies the dial function for creating unencrypted TCP\n    connections.\n    //\n    // Deprecated: Use DialContext instead, which allows the transport\n    // to cancel dials as soon as they are no longer needed.\n    // If both are set, DialContext takes priority.\n    Dial func(network, addr string) (net.Conn, error)\n</code></pre>\n\n<p>That comment about deprecation and lack of dials reuse may point to the source of your problems.</p>\n\n<p>To sum up, when in your shoes, I'd do two things:\n* move client creation to the code which executes once, or just use default client with <code>http.Get</code>\n* I'd clean up this thing with overwriting default transport fields, if you must do it then I'd use <code>DialContext</code> as suggested.</p>\n\n<p>Good luck.</p>\n"}, {"tags": [], "owner": {"reputation": 2126, "user_id": 4407613, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k0ty3.png?s=128&g=1", "display_name": "Devidas", "link": "https://stackoverflow.com/users/4407613/devidas"}, "is_accepted": false, "score": 0, "last_activity_date": 1522313651, "creation_date": 1522313651, "answer_id": 49551776, "question_id": 34119757, "link": "https://stackoverflow.com/questions/34119757/socket-cant-identify-protocol-socket-leak/49551776#49551776", "title": "Socket can&#39;t identify protocol (socket leak)", "body": "<p>I couldn't reproduce the issue. But here are my 2 cents (no pun intended)</p>\n\n<ol>\n<li>Simmilar issue was found in SockJS-node noticed in an article <a href=\"https://idea.popcount.org/2012-12-09-lsof-cant-identify-protocol/\" rel=\"nofollow noreferrer\">https://idea.popcount.org/2012-12-09-lsof-cant-identify-protocol/</a> according to this issue was observed on FreeBSD. But the issue was \"websockets are not bieng properly cleaned up\"</li>\n<li>Another test test I would like ou to do if you still have hands on same environment. If possible post wireshark logs. just to confirm there are not subtle things in network frames which may have caused this.</li>\n</ol>\n\n<p>I am sorry I cann't install Go 1.5.1 just to reproduce this issue.\nHope this was helpful.</p>\n"}], "owner": {"reputation": 221, "user_id": 587170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/788a968014b84617ffcae5fa6c574204?s=128&d=identicon&r=PG", "display_name": "user587170", "link": "https://stackoverflow.com/users/587170/user587170"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3593, "favorite_count": 1, "answer_count": 2, "score": 22, "last_activity_date": 1522313651, "creation_date": 1449419162, "last_edit_date": 1475990051, "question_id": 34119757, "link": "https://stackoverflow.com/questions/34119757/socket-cant-identify-protocol-socket-leak", "title": "Socket can&#39;t identify protocol (socket leak)", "body": "<p>I have a Go1.5.1 process/app. When I run <code>/usr/sbin/lsof -p</code> on that process, I see a lot of \"can't identify protocol\".</p>\n\n<pre><code>monitor_ 13105 root  101u  sock      0,6      0t0 16960100 can't identify protocol\nmonitor_ 13105 root  102u  sock      0,6      0t0 21552427 can't identify protocol\nmonitor_ 13105 root  103u  sock      0,6      0t0 17565091 can't identify protocol\nmonitor_ 13105 root  104u  sock      0,6      0t0 18476870 can't identify protocol\n</code></pre>\n\n<p>proc status/limit/fd</p>\n\n<pre><code>[root@Monitor_q ~]# cat /proc/13105/status \nName:   monitor_client\nState:  S (sleeping)\nTgid:   13105\nPid:    13105\nPPid:   13104\nTracerPid:  0\nUid:    0   0   0   0\nGid:    0   0   0   0\nUtrace: 0\nFDSize: 16384\nGroups: \n...\n\n\n[root@Monitor_q ~]# cat /proc/13105/limits \nLimit                     Soft Limit           Hard Limit           Units     \nMax cpu time              unlimited            unlimited            seconds   \nMax file size             unlimited            unlimited            bytes     \nMax data size             unlimited            unlimited            bytes     \nMax stack size            10485760             unlimited            bytes     \nMax core file size        0                    unlimited            bytes     \nMax resident set          unlimited            unlimited            bytes     \nMax processes             3870                 3870                 processes \nMax open files            9999                 9999                 files     \nMax locked memory         65536                65536                bytes     \nMax address space         unlimited            unlimited            bytes     \nMax file locks            unlimited            unlimited            locks     \nMax pending signals       3870                 3870                 signals   \nMax msgqueue size         819200               819200               bytes     \nMax nice priority         0                    0                    \nMax realtime priority     0                    0                    \nMax realtime timeout      unlimited            unlimited            us\n\n[root@Monitor_q ~]# ll /proc/13105/fd/\nlrwx------ 1 root root 64 Dec  7 00:15 8382 -&gt; socket:[52023221]\nlrwx------ 1 root root 64 Dec  7 00:15 8383 -&gt; socket:[51186627]\nlrwx------ 1 root root 64 Dec  7 00:15 8384 -&gt; socket:[51864232]\nlrwx------ 1 root root 64 Dec  7 00:15 8385 -&gt; socket:[52435453]\nlrwx------ 1 root root 64 Dec  7 00:15 8386 -&gt; socket:[51596071]\nlrwx------ 1 root root 64 Dec  7 00:15 8387 -&gt; socket:[52767667]\nlrwx------ 1 root root 64 Dec  7 00:15 8388 -&gt; socket:[52090632]\nlrwx------ 1 root root 64 Dec  7 00:15 8389 -&gt; socket:[51739068]\nlrwx------ 1 root root 64 Dec  7 00:15 839 -&gt; socket:[22963529]\nlrwx------ 1 root root 64 Dec  7 00:15 8390 -&gt; socket:[52023223]\nlrwx------ 1 root root 64 Dec  7 00:15 8391 -&gt; socket:[52560389]\nlrwx------ 1 root root 64 Dec  7 00:15 8392 -&gt; socket:[52402565]\n...\n</code></pre>\n\n<p>but there is no similar output in <code>netstat -a</code>.</p>\n\n<p>What are these sockets and how can I find out what they do?</p>\n\n<p>monitor_client.go</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"net\"\n    \"net/http\"\n    nurl \"net/url\"\n    \"strconv\"\n    \"strings\"\n    \"syscall\"\n    \"time\"\n)\n\ntype Result struct {\n    Error      string        `json:\"error\"`\n    HttpStatus int           `json:\"http_status\"`\n    Stime      time.Duration `json:\"http_time\"`\n}\n\n//http://stackoverflow.com/questions/20990332/golang-http-timeout-and-goroutines-accumulation\n//http://3.3.3.3/http?host=3.2.4.2&amp;servername=a.test&amp;path=/&amp;port=33&amp;timeout=5&amp;scheme=http\nfunc MonitorHttp(w http.ResponseWriter, r *http.Request) {\n    var host, servername, path, port, scheme string\n    var timeout int\n    u, err := nurl.Parse(r.RequestURI)\n    if err != nil {\n        log.Fatal(err)\n        return\n    }\n    if host = u.Query().Get(\"host\"); host == \"\" {\n        host = \"127.0.0.0\"\n    }\n    if servername = u.Query().Get(\"servername\"); servername == \"\" {\n        servername = \"localhost\"\n    }\n    if path = u.Query().Get(\"path\"); path == \"\" {\n        path = \"/\"\n    }\n    if port = u.Query().Get(\"port\"); port == \"\" {\n        port = \"80\"\n    }\n    if scheme = u.Query().Get(\"scheme\"); scheme == \"\" {\n        scheme = \"http\"\n    }\n\n    if timeout, _ = strconv.Atoi(u.Query().Get(\"timeout\")); timeout == 0 {\n        timeout = 5\n    }\n\n    //log.Printf(\"(host)=%s (servername)=%s (path)=%s (port)=%s (timeout)=%d\", host, servername, path, port, timeout)\n\n    w.Header().Set(\"Content-Type\", \"application/json\")\n\n    res := httptool(host, port, servername, scheme, path, timeout)\n    result, _ := json.Marshal(res)\n    fmt.Fprintf(w, \"%s\", result)\n}\n\nfunc httptool(ip, port, servername, scheme, path string, timeout int) Result {\n\n    var result Result\n    startTime := time.Now()\n    host := ip + \":\" + port\n\n    transport := &amp;http.Transport{\n        TLSClientConfig:   &amp;tls.Config{InsecureSkipVerify: true},\n        DisableKeepAlives: true,\n    }\n\n    dialer := net.Dialer{\n        Timeout:   time.Duration(timeout) * time.Second,\n        KeepAlive: 0 * time.Second,\n    }\n    transport.Dial = func(network, address string) (net.Conn, error) {\n        return dialer.Dial(network, address)\n    }\n\n    client := &amp;http.Client{\n        Transport: transport,\n    }\n    rawquery := \"\"\n    url := fmt.Sprintf(\"%s://%s%s%s\", scheme, host, path, rawquery)\n    req, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        result.HttpStatus = -1\n        errs := strings.Split(err.Error(), \": \")\n        result.Error = errs[len(errs)-1]\n        result.Stime = time.Now().Sub(startTime) / time.Millisecond\n        return result\n    }\n    req.Header.Set(\"User-Agent\", \"monitor worker\")\n    req.Header.Set(\"Connection\", \"close\")\n    req.Host = servername\n    resp, err := client.Do(req)\n    //https://github.com/Basiclytics/neverdown/blob/master/check.go\n    if err != nil {\n        nerr, ok := err.(*nurl.Error)\n        if ok {\n            switch cerr := nerr.Err.(type) {\n            case *net.OpError:\n                switch cerr.Err.(type) {\n                case *net.DNSError:\n                    errs := strings.Split(cerr.Error(), \": \")\n                    result.Error = \"dns: \" + errs[len(errs)-1]\n                default:\n                    errs := strings.Split(cerr.Error(), \": \")\n                    result.Error = \"server: \" + errs[len(errs)-1]\n                }\n            default:\n                switch nerr.Err.Error() {\n                case \"net/http: request canceled while waiting for connection\":\n                    errs := strings.Split(cerr.Error(), \": \")\n                    result.Error = \"timeout: \" + errs[len(errs)-1]\n\n                default:\n                    errs := strings.Split(cerr.Error(), \": \")\n                    result.Error = \"unknown: \" + errs[len(errs)-1]\n                }\n            }\n\n        } else {\n            result.Error = \"unknown: \" + err.Error()\n        }\n        result.HttpStatus = -2\n        result.Stime = time.Now().Sub(startTime) / time.Millisecond\n        return result\n    }\n    resp.Body.Close()\n    result.HttpStatus = resp.StatusCode\n    result.Error = \"noerror\"\n    result.Stime = time.Now().Sub(startTime) / time.Millisecond //spend time (ms)\n    return result\n}\n\nfunc setRlimit() {\n    var rLimit syscall.Rlimit\n    err := syscall.Getrlimit(syscall.RLIMIT_NOFILE, &amp;rLimit)\n    if err != nil {\n        log.Printf(\"Unable to obtain rLimit\", err)\n    }\n    if rLimit.Cur &lt; rLimit.Max {\n        rLimit.Max = 9999\n        rLimit.Cur = 9999\n        err = syscall.Setrlimit(syscall.RLIMIT_NOFILE, &amp;rLimit)\n        if err != nil {\n            log.Printf(\"Unable to increase number of open files limit\", err)\n        }\n    }\n}\n\nfunc main() {\n    setRlimit()\n    s := &amp;http.Server{\n        Addr:         \":59059\",\n        ReadTimeout:  7 * time.Second,\n        WriteTimeout: 7 * time.Second,\n    }\n    http.HandleFunc(\"/http\", MonitorHttp)\n\n    log.Fatal(s.ListenAndServe())\n}\n</code></pre>\n"}, {"tags": ["go", "arguments", "package", "command-line-arguments", "flags"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449414609, "post_id": 34118732, "comment_id": 55986657, "body": "This is a mixture of what the shell does (the quoted string grouping) and the particular behavior of gnu option parsing tools (the interspersed args and flags, and different long/short flag format). I&#39;m not aware of anyone combining these into a package."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1449444567, "post_id": 34118732, "comment_id": 55996981, "body": "A quick hack (if you are flexible to change the way you provide the input) would be (please see <code>flag</code> package&#39;s documentation): \t  \tset := &amp;flag.FlagSet{} \t \tv := set.Bool(&quot;v&quot;, false, &quot;&quot;) \tformat := set.String(&quot;format&quot;, &quot;&quot;, &quot;&quot;) \ti := set.String(&quot;i&quot;, &quot;&quot;, &quot;&quot;) \t \tset.Parse([]string{<code>-v</code>, <code>--format=&quot;some example&quot;</code>, <code>-i=test</code>}) \tfor k, v := range set.Args() { \t\tlog.Println(k, v) \t} \t \tlog.Printf(&quot;v=%v format=%v i=%v&quot;, *v, *format, *i)"}, {"owner": {"reputation": 5024, "user_id": 1419891, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/bb825cd3f1905f42c16408393480a65b?s=128&d=identicon&r=PG", "display_name": "425nesp", "link": "https://stackoverflow.com/users/1419891/425nesp"}, "edited": false, "score": 0, "creation_date": 1449464795, "post_id": 34118732, "comment_id": 56001865, "body": "I&#39;m not sure if I understand. Are you planning on doing something like: <code>cmd -v --format &quot;some example&quot; -i test</code>? If so, you could just grab all of the arguments from <code>os.Args</code>."}, {"owner": {"reputation": 78861, "user_id": 561309, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/6d833d9f0ffa2265a01359ccecd26d54?s=128&d=identicon&r=PG&f=1", "display_name": "laurent", "link": "https://stackoverflow.com/users/561309/laurent"}, "edited": false, "score": 6, "creation_date": 1449584507, "post_id": 34118732, "comment_id": 56063155, "body": "I don&#39;t know how that question could have attracted &quot;opinionated answers and spam&quot;, as it&#39;s a specific problem, which would require a specific answer. Anyway I couldn&#39;t find any package so I&#39;ve ended up doing it myself. Solution is there: <a href=\"https://github.com/laurent22/massren/blob/ae4c57da1e09a95d9383f7eb645a9f69790dec6c/main.go#L172\" rel=\"nofollow noreferrer\">github.com/laurent22/massren/blob/&hellip;</a>"}, {"owner": {"reputation": 3113, "user_id": 1601989, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/7a6b7d41b5db7c3b1fe3b1f66c256fe9?s=128&d=identicon&r=PG", "display_name": "DavidG", "link": "https://stackoverflow.com/users/1601989/davidg"}, "edited": false, "score": 0, "creation_date": 1461352723, "post_id": 34118732, "comment_id": 61177459, "body": "@this.lau_ take a look at <a href=\"https://github.com/DavidGamba/go-getoptions\" rel=\"nofollow noreferrer\">go-getoptions</a>, I needed extra flexibility. Using <code>opt.SetUnknownMode(&quot;pass&quot;)</code> will leave things as you want them in the <code>remaining</code> slice."}, {"owner": {"reputation": 830, "user_id": 3872894, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/100006705821837/picture?type=large", "display_name": "Jared Hooper", "link": "https://stackoverflow.com/users/3872894/jared-hooper"}, "edited": false, "score": 1, "creation_date": 1478529372, "post_id": 34118732, "comment_id": 68179576, "body": "@this.lau_: Super useful for me. Thanks for posting a link to your codebase for massren :]"}, {"owner": {"reputation": 773, "user_id": 1288429, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0f06a128f967681d01f952fd5db81b37?s=128&d=identicon&r=PG", "display_name": "Alex Emelin", "link": "https://stackoverflow.com/users/1288429/alex-emelin"}, "edited": false, "score": 0, "creation_date": 1484042388, "post_id": 34118732, "comment_id": 70335998, "body": "@this.lau_ also useful for me, thanks! Though I modified example a bit to iterate over runes in string (not bytes) to handle unicode"}], "answers": [{"tags": [], "owner": {"reputation": 78861, "user_id": 561309, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/6d833d9f0ffa2265a01359ccecd26d54?s=128&d=identicon&r=PG&f=1", "display_name": "laurent", "link": "https://stackoverflow.com/users/561309/laurent"}, "is_accepted": true, "score": 10, "last_activity_date": 1509102330, "creation_date": 1509102330, "answer_id": 46973603, "question_id": 34118732, "link": "https://stackoverflow.com/questions/34118732/parse-a-command-line-string-into-flags-and-arguments-in-golang/46973603#46973603", "title": "Parse a command line string into flags and arguments in Golang", "body": "<p>For information, this is the function I've ended up creating.</p>\n\n<p>It splits a command into its arguments. For example, <code>cat -v \"some file.txt\"</code>, will return <code>[\"cat\", \"-v\", \"some file.txt\"]</code>.</p>\n\n<p>It also correctly handles escaped characters, spaces in particular. So <code>cat -v some\\ file.txt</code> will also correctly be split into <code>[\"cat\", \"-v\", \"some file.txt\"]</code></p>\n\n<pre><code>func parseCommandLine(command string) ([]string, error) {\n    var args []string\n    state := \"start\"\n    current := \"\"\n    quote := \"\\\"\"\n    escapeNext := true\n    for i := 0; i &lt; len(command); i++ {\n        c := command[i]\n\n        if state == \"quotes\" {\n            if string(c) != quote {\n                current += string(c)\n            } else {\n                args = append(args, current)\n                current = \"\"\n                state = \"start\"\n            }\n            continue\n        }\n\n        if (escapeNext) {\n            current += string(c)\n            escapeNext = false\n            continue\n        }\n\n        if (c == '\\\\') {\n            escapeNext = true\n            continue\n        }\n\n        if c == '\"' || c == '\\'' {\n            state = \"quotes\"\n            quote = string(c)\n            continue\n        }\n\n        if state == \"arg\" {\n            if c == ' ' || c == '\\t' {\n                args = append(args, current)\n                current = \"\"\n                state = \"start\"\n            } else {\n                current += string(c)\n            }\n            continue\n        }\n\n        if c != ' ' &amp;&amp; c != '\\t' {\n            state = \"arg\"\n            current += string(c)\n        }\n    }\n\n    if state == \"quotes\" {\n        return []string{}, errors.New(fmt.Sprintf(\"Unclosed quote in command line: %s\", command))\n    }\n\n    if current != \"\" {\n        args = append(args, current)\n    }\n\n    return args, nil\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3436, "user_id": 307614, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/671aed37f0d4a6668053a70a75f5c715?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/307614/dave"}, "is_accepted": false, "score": 4, "last_activity_date": 1527393477, "creation_date": 1527393477, "answer_id": 50548884, "question_id": 34118732, "link": "https://stackoverflow.com/questions/34118732/parse-a-command-line-string-into-flags-and-arguments-in-golang/50548884#50548884", "title": "Parse a command line string into flags and arguments in Golang", "body": "<p>If the args were passed to your program on the command line then the shell should handle this and <code>os.Args</code> will be populated correctly. For example, in your case <code>os.Args[1:]</code> will equal</p>\n\n<pre><code>[]string{\"-v\", \"--format\", \"some example\", \"-i\", \"test\"}\n</code></pre>\n\n<p>If you just have the string though, for some reason, and you'd like to mimic what the shell would do with it, then I recommend a package like <a href=\"https://github.com/kballard/go-shellquote\" rel=\"nofollow noreferrer\">https://github.com/kballard/go-shellquote</a></p>\n"}, {"tags": [], "owner": {"reputation": 135, "user_id": 6375060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1992b61867769b7ae3a3a9234cae996?s=128&d=identicon&r=PG&f=1", "display_name": "hedzr", "link": "https://stackoverflow.com/users/6375060/hedzr"}, "is_accepted": false, "score": 0, "last_activity_date": 1559205594, "creation_date": 1559205594, "answer_id": 56374627, "question_id": 34118732, "link": "https://stackoverflow.com/questions/34118732/parse-a-command-line-string-into-flags-and-arguments-in-golang/56374627#56374627", "title": "Parse a command line string into flags and arguments in Golang", "body": "<p><a href=\"https://github.com/hedzr/cmdr\" rel=\"nofollow noreferrer\">hedzr/cmdr</a> might be good. it's a getopt-like command-line parser, light weight, fluent api or classical style.</p>\n"}, {"comments": [{"owner": {"reputation": 1419, "user_id": 146032, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1TQf1.jpg?s=128&g=1", "display_name": "bithavoc", "link": "https://stackoverflow.com/users/146032/bithavoc"}, "edited": false, "score": 1, "creation_date": 1605738221, "post_id": 62355699, "comment_id": 114747278, "body": "Should be the official answer."}], "tags": [], "owner": {"reputation": 61, "user_id": 13738026, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0328d2e792e78ae6e3d28a9d87e2efc5?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey Odinokov", "link": "https://stackoverflow.com/users/13738026/alexey-odinokov"}, "is_accepted": false, "score": 6, "last_activity_date": 1592024016, "creation_date": 1592024016, "answer_id": 62355699, "question_id": 34118732, "link": "https://stackoverflow.com/questions/34118732/parse-a-command-line-string-into-flags-and-arguments-in-golang/62355699#62355699", "title": "Parse a command line string into flags and arguments in Golang", "body": "<p>Looks similar to <a href=\"https://godoc.org/github.com/google/shlex\" rel=\"noreferrer\">shlex</a>:</p>\n\n<pre><code>import \"github.com/google/shlex\"\nshlex.Split(\"one \\\"two three\\\" four\") -&gt; []string{\"one\", \"two three\", \"four\"}\n</code></pre>\n"}], "owner": {"reputation": 78861, "user_id": 561309, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/6d833d9f0ffa2265a01359ccecd26d54?s=128&d=identicon&r=PG&f=1", "display_name": "laurent", "link": "https://stackoverflow.com/users/561309/laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7278, "favorite_count": 3, "accepted_answer_id": 46973603, "answer_count": 4, "score": 12, "last_activity_date": 1592024016, "creation_date": 1449413603, "last_edit_date": 1509102339, "question_id": 34118732, "link": "https://stackoverflow.com/questions/34118732/parse-a-command-line-string-into-flags-and-arguments-in-golang", "title": "Parse a command line string into flags and arguments in Golang", "body": "<p>I'm looking for a package that would take a string such as <code>-v --format \"some example\" -i test</code> and parse it into a slice of strings, handling quotes, spaces, etc. properly:</p>\n\n<pre><code>-v\n--format\nsome example\n-i\ntest\n</code></pre>\n\n<p>I've checked the built-in <code>flag</code> package as well as other flag handling packages on Github but none of them seem to handle this particular case of parsing a raw string into tokens. Before trying to do it myself I'd rather look for a package as I'm sure there are a lot of special cases to handle.</p>\n\n<p>Any suggestion?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1449384700, "post_id": 34114861, "comment_id": 55979252, "body": "accepted by which community?"}, {"owner": {"reputation": 477, "user_id": 2152283, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/37b689f85eb38fbb9ce8a1ce1b415e8d?s=128&d=identicon&r=PG&f=1", "display_name": "fr00z1", "link": "https://stackoverflow.com/users/2152283/fr00z1"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1449384726, "post_id": 34114861, "comment_id": 55979256, "body": "go community sorry for not being specific.."}, {"owner": {"reputation": 477, "user_id": 2152283, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/37b689f85eb38fbb9ce8a1ce1b415e8d?s=128&d=identicon&r=PG&f=1", "display_name": "fr00z1", "link": "https://stackoverflow.com/users/2152283/fr00z1"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1449384824, "post_id": 34114861, "comment_id": 55979274, "body": "Also, as a side reference I was noting that the following doc located at golang: <a href=\"https://golang.org/doc/code.html#Organization\" rel=\"nofollow noreferrer\">golang_layout</a> only has a flat example. This triggered my question above."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1449388968, "post_id": 34114861, "comment_id": 55979979, "body": "Every &quot;directory&quot; needs to be its own package, hence why you see many projects favor a flatter structure. It&#39;s also likely a reaction to the &quot;too many modules&quot; that node and Ruby projects suffer from."}, {"owner": {"reputation": 477, "user_id": 2152283, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/37b689f85eb38fbb9ce8a1ce1b415e8d?s=128&d=identicon&r=PG&f=1", "display_name": "fr00z1", "link": "https://stackoverflow.com/users/2152283/fr00z1"}, "edited": false, "score": 0, "creation_date": 1449389275, "post_id": 34114861, "comment_id": 55980045, "body": "Thanks for the reply. This is good feedback and you are on point about the &quot;too many modules&quot;."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1449389862, "post_id": 34114861, "comment_id": 55980142, "body": "Some further reading: <a href=\"https://forum.golangbridge.org/t/best-structure-to-prevent-a-given-cycle-import/1613\" rel=\"nofollow noreferrer\">forum.golangbridge.org/t/&hellip;</a> &amp; <a href=\"https://forum.golangbridge.org/t/how-should-i-structure-packages-for-a-multiple-binary-web-application/665\" rel=\"nofollow noreferrer\">forum.golangbridge.org/t/&hellip;</a>"}, {"owner": {"reputation": 477, "user_id": 2152283, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/37b689f85eb38fbb9ce8a1ce1b415e8d?s=128&d=identicon&r=PG&f=1", "display_name": "fr00z1", "link": "https://stackoverflow.com/users/2152283/fr00z1"}, "edited": false, "score": 0, "creation_date": 1449390527, "post_id": 34114861, "comment_id": 55980275, "body": "Thank you for the links.. Going to read up on them now."}, {"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "edited": false, "score": 0, "creation_date": 1449393401, "post_id": 34114861, "comment_id": 55980844, "body": "You should have a look at &quot;internal&quot; packages too: <a href=\"https://docs.google.com/document/d/1e8kOo3r51b2BWtTs_1uADIA5djfXhPT36s6eHVRIvaU/edit\" rel=\"nofollow noreferrer\">docs.google.com/document/d/&hellip;</a>"}, {"owner": {"reputation": 477, "user_id": 2152283, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/37b689f85eb38fbb9ce8a1ce1b415e8d?s=128&d=identicon&r=PG&f=1", "display_name": "fr00z1", "link": "https://stackoverflow.com/users/2152283/fr00z1"}, "edited": false, "score": 0, "creation_date": 1449394569, "post_id": 34114861, "comment_id": 55981129, "body": "Thanks Hector.. Great stuff."}, {"owner": {"reputation": 477, "user_id": 2152283, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/37b689f85eb38fbb9ce8a1ce1b415e8d?s=128&d=identicon&r=PG&f=1", "display_name": "fr00z1", "link": "https://stackoverflow.com/users/2152283/fr00z1"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1449394676, "post_id": 34114861, "comment_id": 55981158, "body": "@elithrar if you wanted to post your comments as the answer I will mark it and upvote it if that matters to you. Thanks again!"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 2, "creation_date": 1449396166, "post_id": 34114861, "comment_id": 55981527, "body": "<a href=\"http://stackoverflow.com/a/15051192/720999\">This answer</a> contains an example and pointers to further reading--please consider reading them through.  Basically, the idea is to have packages in your application where they are convenient to have (they define &quot;namespaces&quot; as if you <code>import &quot;foo&#47;bar&#47;baz&quot;</code> you access the exported interface of that package through the name <code>baz</code>). Packages also provide for easier (separate) testing etc. Please also read <a href=\"https://blog.golang.org/package-names\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 477, "user_id": 2152283, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/37b689f85eb38fbb9ce8a1ce1b415e8d?s=128&d=identicon&r=PG&f=1", "display_name": "fr00z1", "link": "https://stackoverflow.com/users/2152283/fr00z1"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1449396851, "post_id": 34114861, "comment_id": 55981663, "body": "Thanks Kostix.. The suggestions @elithrar mentioned lead me to the answer I was looking for, so I was going to provide credit for the first individual who helped me to ascertain that (supplemented with findings of course). I also appreciate your comments, and this definitely provides more perspective. Take care!"}], "owner": {"reputation": 477, "user_id": 2152283, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/37b689f85eb38fbb9ce8a1ce1b415e8d?s=128&d=identicon&r=PG&f=1", "display_name": "fr00z1", "link": "https://stackoverflow.com/users/2152283/fr00z1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 1, "closed_date": 1449414287, "answer_count": 0, "score": 2, "last_activity_date": 1449384639, "creation_date": 1449384456, "last_edit_date": 1449384639, "question_id": 34114861, "link": "https://stackoverflow.com/questions/34114861/is-organizing-libs-in-a-web-project-bad-practice-for-go", "closed_reason": "Opinion-based", "title": "Is organizing libs in a web project bad practice for go?", "body": "<p>I started to create a project with the following format for a go project:</p>\n\n<pre><code>github.com\n    coolproject\n        datasources\n        coolapp\n</code></pre>\n\n<p>Within datasources this can be a database or a file, and it seems like there is enough of them that they warrant another dir for organization.</p>\n\n<p>Under datasources I was thinking of organizing as follows:</p>\n\n<pre><code>datasources\n    databases\n        pgsql.go\n        mysql.go\n    configfiles\n        yaml.go\n        json.go\n</code></pre>\n\n<p>The names of the dirs and files have been generalized a little bit for simplicity.</p>\n\n<p>However, it appears most projects encourage a flat structure where datasources wouldn't exist, and databases and configfiles would be at the same directory level as coolapp. </p>\n\n<p>Question is - is an additional level of organization for common libs considered bad practice?</p>\n\n<p>I am most interested in what is considered idiomatic and accepted by the community.</p>\n"}, {"tags": ["go", "binary", "bytearray"], "answers": [{"comments": [{"owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "edited": false, "score": 0, "creation_date": 1449376609, "post_id": 34113879, "comment_id": 55977846, "body": "Thank you David! I noticed that on the file .Read after os.Open I get the number of bytes read too, regardless of the size of my byte array - this set me off looking at that in further detail so thank you."}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "reply_to_user": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "edited": false, "score": 1, "creation_date": 1449376814, "post_id": 34113879, "comment_id": 55977890, "body": "Yes, most byte readable things have that same signature of &quot;func Read([]byte) (int, error)&quot;.  So you use the same code for reading files, sockets, umm... other stuff that gives you bytes (drawing a blank)..."}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 3, "last_activity_date": 1449376579, "last_edit_date": 1449376579, "creation_date": 1449374454, "answer_id": 34113879, "question_id": 34113679, "link": "https://stackoverflow.com/questions/34113679/terminating-indicator-for-binary-byte-array-in-golang/34113879#34113879", "title": "Terminating indicator for binary byte array in Golang?", "body": "<p><a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow\">io.Reader's</a> Read function returns the number of bytes read.</p>\n\n<p>You can then create a sub-slice of that size.\nFor example:</p>\n\n<pre><code>data := make([]byte,1024)\nn, err := reader.Read(arr)\nif err != nil {\n    // do something with error\n} else {\n    rightSized := data[:n] \n    // rightSized is []byte of N length now and shares the underlying \n    // backing array so it's both space and time efficient\n    // this will contain whatever was read from the reader\n}\n</code></pre>\n"}], "owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 34113879, "answer_count": 1, "score": 2, "last_activity_date": 1449376579, "creation_date": 1449372446, "question_id": 34113679, "link": "https://stackoverflow.com/questions/34113679/terminating-indicator-for-binary-byte-array-in-golang", "title": "Terminating indicator for binary byte array in Golang?", "body": "<p>In Golang if I have a byte array of binary data how do I determine the termination of actual data if it is in a larger array.  For example if I do the following, reading a file when it is plain text:</p>\n\n<pre><code>    chunk := make([]byte, 1024)\n..read some data into the chunk but only 10 bytes are filled from the file...\n</code></pre>\n\n<p>I can then determine the actual size of the data by doing the following:        </p>\n\n<pre><code>n := bytes.IndexByte(chunk, 0)\n</code></pre>\n\n<p>When it is plain text n will give me the end of the actual data - how do I do that if the data is binary? </p>\n"}, {"tags": ["eclipse", "debugging", "go", "gdb", "preferences"], "comments": [{"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1449522158, "post_id": 34112474, "comment_id": 56034343, "body": "I suggest using <a href=\"https://code.visualstudio.com/\" rel=\"nofollow noreferrer\">Visual Studio Code</a> with the <a href=\"https://github.com/microsoft/vscode-go\" rel=\"nofollow noreferrer\">vscode-go</a> plugin, doesn&#39;t answer your question but just a suggestion!"}], "answers": [{"tags": [], "owner": {"reputation": 412, "user_id": 6860684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe1eb236c15f40edfd8a5e2f9c888844?s=128&d=identicon&r=PG&f=1", "display_name": "trker", "link": "https://stackoverflow.com/users/6860684/trker"}, "is_accepted": true, "score": 3, "last_activity_date": 1474587238, "creation_date": 1474587238, "answer_id": 39650389, "question_id": 34112474, "link": "https://stackoverflow.com/questions/34112474/cant-find-gdb-option-in-eclipse-on-mac/39650389#39650389", "title": "Can&#39;t find GDB option in Eclipse on mac", "body": "<p>For anyone coming here looking for an answer:\n<a href=\"https://www.ics.uci.edu/~pattis/common/handouts/macmingweclipse/allexperimental/mac-gdb-install.html#eclipse\" rel=\"nofollow\">https://www.ics.uci.edu/~pattis/common/handouts/macmingweclipse/allexperimental/mac-gdb-install.html#eclipse</a></p>\n\n<blockquote>\n  <p>If there is no GDB section in the C/C++Debug subtree, close the preferences window, and try to first start a debugging session for any project that you can already run without problems. You can do it by either clicking the Debug button on the toolbar, or selecting RunDebug from the main menu. This attempt will, of course, fail with an error message about the gdb command, but it will force the said C/C++DebugGDB settings to appear in the preferences.</p>\n</blockquote>\n"}], "owner": {"reputation": 167, "user_id": 2585073, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3478605d2726eddbe05a158ebf4b41fc?s=128&d=identicon&r=PG", "display_name": "mudejar", "link": "https://stackoverflow.com/users/2585073/mudejar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 704, "favorite_count": 1, "accepted_answer_id": 39650389, "answer_count": 1, "score": 3, "last_activity_date": 1474587238, "creation_date": 1449360715, "question_id": 34112474, "link": "https://stackoverflow.com/questions/34112474/cant-find-gdb-option-in-eclipse-on-mac", "title": "Can&#39;t find GDB option in Eclipse on mac", "body": "<p>I'm new to Macs but I don't think this is a problem that comes from that. I've been attempting to set up GDB as a debugger for programming in golang on Eclipse. I know how to do it for the most part, but at some point one of the steps is to open up your debug preferences in the C/C++ configuration and fill in the path of where the debugger is located. Unfortunately, the option doesn't even show up for me:\n<a href=\"https://i.stack.imgur.com/Cro5d.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Cro5d.png\" alt=\"enter image description here\"></a></p>\n\n<p>Why doesn't the \"GDB\" option show up under Preferences >> C/C++ >> Debug? If i'm not mistaken, it should be a part of the CDT package correct? Am I just using the wrong version? It should be giving me this option:</p>\n\n<p><a href=\"https://i.stack.imgur.com/mF32e.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/mF32e.png\" alt=\"enter image description here\"></a></p>\n\n<p>At least it does for Neil Craft, the author of <a href=\"http://ntraft.com/installing-gdb-on-os-x-mavericks/\" rel=\"nofollow noreferrer\">this tutorial</a></p>\n"}, {"tags": ["string", "file", "input", "go", "newline"], "answers": [{"tags": [], "owner": {"reputation": 665, "user_id": 5637191, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153306510364021/picture?type=large", "display_name": "Jens Grabarske", "link": "https://stackoverflow.com/users/5637191/jens-grabarske"}, "is_accepted": true, "score": 39, "last_activity_date": 1449360959, "creation_date": 1449360959, "answer_id": 34112497, "question_id": 34112382, "link": "https://stackoverflow.com/questions/34112382/golang-issues-replacing-newlines-in-a-string-from-a-text-file/34112497#34112497", "title": "Golang: Issues replacing newlines in a string from a text file", "body": "<p>I guess that you are running the code using Windows. Observe that if you print out the length of the resulting string, it will show something over 100 characters. The reason is that Windows uses not only newlines (<code>\\n</code>) but also carriage returns (<code>\\r</code>) - so a newline in Windows is actually <code>\\r\\n</code>, not <code>\\n</code>. To properly filter them out of your string, use:</p>\n\n<pre><code>re = regexp.MustCompile(`\\r?\\n`)\ninput = re.ReplaceAllString(input, \" \")\n</code></pre>\n\n<p>The backticks will make sure that you don't need to quote the backslashes in the regular expression. I used the question mark for the carriage return to make sure that your code works on other platforms as well.</p>\n"}, {"comments": [{"owner": {"reputation": 332, "user_id": 5550193, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-TQVV3XBtWaA/AAAAAAAAAAI/AAAAAAAAW4k/VM8a1-MvxCg/photo.jpg?sz=128", "display_name": "madsen", "link": "https://stackoverflow.com/users/5550193/madsen"}, "edited": false, "score": 3, "creation_date": 1449366861, "post_id": 34112642, "comment_id": 55976025, "body": "That wouldn&#39;t solve the issue though, since \u2014 as Jens mentioned \u2014 Windows newlines (<code>\\r\\n</code>) are causing the described effect when only the <code>\\n</code> is replaced while leaving the <code>\\r</code> in the string."}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "reply_to_user": {"reputation": 332, "user_id": 5550193, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-TQVV3XBtWaA/AAAAAAAAAAI/AAAAAAAAW4k/VM8a1-MvxCg/photo.jpg?sz=128", "display_name": "madsen", "link": "https://stackoverflow.com/users/5550193/madsen"}, "edited": false, "score": 3, "creation_date": 1449367071, "post_id": 34112642, "comment_id": 55976064, "body": "@madsen have you thought that if <code>\\r\\n</code> is causing a problem, may be it makes sense to remove <code>\\r\\n</code>? Or is substituting the line <code>strings.Replace(input, &quot;\\n&quot;,&quot;&quot;,-1)</code> to <code>strings.Replace(input, &quot;\\r\\n&quot;,&quot;&quot;,-1)</code> an impossible task for you?"}, {"owner": {"reputation": 332, "user_id": 5550193, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-TQVV3XBtWaA/AAAAAAAAAAI/AAAAAAAAW4k/VM8a1-MvxCg/photo.jpg?sz=128", "display_name": "madsen", "link": "https://stackoverflow.com/users/5550193/madsen"}, "edited": false, "score": 9, "creation_date": 1449367521, "post_id": 34112642, "comment_id": 55976157, "body": "No reason to get aggressive. Your point about not necessarily needing regex is fine, but your answer doesn&#39;t help OP solve his actual problem."}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "reply_to_user": {"reputation": 332, "user_id": 5550193, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-TQVV3XBtWaA/AAAAAAAAAAI/AAAAAAAAW4k/VM8a1-MvxCg/photo.jpg?sz=128", "display_name": "madsen", "link": "https://stackoverflow.com/users/5550193/madsen"}, "edited": false, "score": 2, "creation_date": 1449367901, "post_id": 34112642, "comment_id": 55976214, "body": "@madsen there is no aggression here. Just surprised that for some people it is so hard to modify the working solution to suit their needs even if the modification is as trivial as adding 2 characters. My answer will help OP if he will figure out how his original file looks like (which is really obvious to find). You point was that Jens answer mention Windows, but if you will read OP question you will see nothing about OP&#39;s OS. I can guess, give suggestion, but this is rather useless in my opinion."}, {"owner": {"reputation": 332, "user_id": 5550193, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-TQVV3XBtWaA/AAAAAAAAAAI/AAAAAAAAW4k/VM8a1-MvxCg/photo.jpg?sz=128", "display_name": "madsen", "link": "https://stackoverflow.com/users/5550193/madsen"}, "edited": false, "score": 8, "creation_date": 1449368967, "post_id": 34112642, "comment_id": 55976409, "body": "If it wasn&#39;t for Jens&#39; answer, OP wouldn&#39;t know that the <code>\\r</code> was the problem (and OP&#39;s output is more than enough to know that that is in fact the case). Your answer just provides OP with a different way of getting where he already is. It&#39;s not about inability to modify a working solution, it&#39;s about the fact that your solution is ... well ... not a solution to OP&#39;s problem."}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "reply_to_user": {"reputation": 332, "user_id": 5550193, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-TQVV3XBtWaA/AAAAAAAAAAI/AAAAAAAAW4k/VM8a1-MvxCg/photo.jpg?sz=128", "display_name": "madsen", "link": "https://stackoverflow.com/users/5550193/madsen"}, "edited": false, "score": 0, "creation_date": 1449369453, "post_id": 34112642, "comment_id": 55976498, "body": "@madsen, you are basing your justification on the fact, that Jen&#39;s answer solved OP&#39;s problem. Up till now I see that 2 hours passed and OP has not told anything. Which might mean that Jen&#39;s answer has not fixed anything."}, {"owner": {"reputation": 332, "user_id": 5550193, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-TQVV3XBtWaA/AAAAAAAAAAI/AAAAAAAAW4k/VM8a1-MvxCg/photo.jpg?sz=128", "display_name": "madsen", "link": "https://stackoverflow.com/users/5550193/madsen"}, "edited": false, "score": 2, "creation_date": 1449403563, "post_id": 34112642, "comment_id": 55983362, "body": "You got to be kidding. If you know what <code>\\r</code> does, then you know that OP&#39;s output is caused by exactly that \u2014 not by whether or not he&#39;s using regexes. Your answer only works if you apply Jens&#39; fix too, otherwise it won&#39;t make any difference at all."}], "tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 5, "last_activity_date": 1449362271, "creation_date": 1449362271, "answer_id": 34112642, "question_id": 34112382, "link": "https://stackoverflow.com/questions/34112382/golang-issues-replacing-newlines-in-a-string-from-a-text-file/34112642#34112642", "title": "Golang: Issues replacing newlines in a string from a text file", "body": "<p>I do not think that you need to use regex for such an easy task. This can be achieved with just</p>\n\n<pre><code>absPath, _ := filepath.Abs(\"../Go/input.txt\")\ndata, _ := ioutil.ReadFile(absPath)\ninput := string(data)\nstrings.Replace(input, \"\\n\",\"\",-1)\n</code></pre>\n\n<p><kbd><a href=\"http://play.golang.org/p/5TD9k8p3yz\" rel=\"noreferrer\">example of removing \\n</a></kbd></p>\n"}], "owner": {"reputation": 1055, "user_id": 3326720, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/SeWCu.png?s=128&g=1", "display_name": "Orange Receptacle", "link": "https://stackoverflow.com/users/3326720/orange-receptacle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 26698, "favorite_count": 2, "accepted_answer_id": 34112497, "answer_count": 2, "score": 19, "last_activity_date": 1449362271, "creation_date": 1449359926, "last_edit_date": 1592644375, "question_id": 34112382, "link": "https://stackoverflow.com/questions/34112382/golang-issues-replacing-newlines-in-a-string-from-a-text-file", "title": "Golang: Issues replacing newlines in a string from a text file", "body": "<p>I've been trying to have a File be read, which will then put the read material into a string. Then the string will get split by line into multiple strings:</p>\n<pre><code>absPath, _ := filepath.Abs(&quot;../Go/input.txt&quot;)\ndata, err := ioutil.ReadFile(absPath)\nif err != nil {\n    panic(err)\n}\ninput := string(data)\n</code></pre>\n<p>The input.txt is read as:</p>\n<blockquote>\n<p>a</p>\n<p>strong little bird</p>\n<p>with a very</p>\n<p>big heart</p>\n<p>went</p>\n<p>to school one day and</p>\n<p>forgot his food at</p>\n<p>home</p>\n</blockquote>\n<p>However,</p>\n<pre><code>re = regexp.MustCompile(&quot;\\\\n&quot;)\ninput = re.ReplaceAllString(input, &quot; &quot;)\n</code></pre>\n<p>turns the text into a mangled mess of:</p>\n<blockquote>\n<p>homeot his food atand</p>\n</blockquote>\n<p>I'm not sure how replacing newlines can mess up so badly to the point where the text inverts itself</p>\n"}, {"tags": ["c", "go"], "comments": [{"owner": {"reputation": 76134, "user_id": 417501, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/703f62ead2e305b1dff62066065a0554?s=128&d=identicon&r=PG", "display_name": "fuz", "link": "https://stackoverflow.com/users/417501/fuz"}, "edited": false, "score": 5, "creation_date": 1449356223, "post_id": 34111893, "comment_id": 55973589, "body": "Also read: <a href=\"https://golang.org/doc/faq#Why_is_my_trivial_program_such_a_large_binary\" rel=\"nofollow noreferrer\">Why is my trivial program such a large binary?</a>."}, {"owner": {"reputation": 6685, "user_id": 5045227, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/33d94e8bd370131f074aeb3e26622e8f?s=128&d=identicon&r=PG&f=1", "display_name": "BugHunterUK", "link": "https://stackoverflow.com/users/5045227/bughunteruk"}, "edited": false, "score": 0, "creation_date": 1449356226, "post_id": 34111893, "comment_id": 55973590, "body": "I didn&#39;t ask how to reduce it, I asked why it&#39;s larger."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1449380397, "post_id": 34111893, "comment_id": 55978512, "body": "@BugHunterUK Maybe you shouldn&#39;t behave like a smarty pants and simply read the link. You&#39;ll be astonished."}, {"owner": {"reputation": 6685, "user_id": 5045227, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/33d94e8bd370131f074aeb3e26622e8f?s=128&d=identicon&r=PG&f=1", "display_name": "BugHunterUK", "link": "https://stackoverflow.com/users/5045227/bughunteruk"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1449390427, "post_id": 34111893, "comment_id": 55980262, "body": "@MarkusWMahlberg the origional comment FUZxxl left did not answer the question I asked. It seems like they&#39;ve been removed."}], "owner": {"reputation": 6685, "user_id": 5045227, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/33d94e8bd370131f074aeb3e26622e8f?s=128&d=identicon&r=PG&f=1", "display_name": "BugHunterUK", "link": "https://stackoverflow.com/users/5045227/bughunteruk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 220, "favorite_count": 0, "closed_date": 1449356419, "answer_count": 0, "score": 2, "last_activity_date": 1449356290, "creation_date": 1449356022, "last_edit_date": 1449356290, "question_id": 34111893, "link": "https://stackoverflow.com/questions/34111893/large-size-difference-between-go-and-c-executable", "closed_reason": "Duplicate", "title": "Large size difference between Go and C executable", "body": "<p>I tried Go tonight, and upon building a very simple program I noticed the file size of the executable was much larger than it would be in C.</p>\n\n<p>A simple hello world program in Go is 1.5mb after being built:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"hello world\")\n}\n</code></pre>\n\n<p>And here it is in C, which is much smaller at 4.9kb</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main(int argc, char** argv)\n{\n    printf(\"Hello World\\n\");\n    return 1;\n}\n</code></pre>\n\n<p>Why the large size difference if both are being compiled to machine code?</p>\n\n<p><strong>Edit:</strong> I am not asking how to reduce the size of the executable, I am asking why it's larger.</p>\n"}, {"tags": ["arrays", "go", "set", "unique", "slice"], "comments": [{"owner": {"reputation": 5024, "user_id": 1419891, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/bb825cd3f1905f42c16408393480a65b?s=128&d=identicon&r=PG", "display_name": "425nesp", "link": "https://stackoverflow.com/users/1419891/425nesp"}, "edited": false, "score": 0, "creation_date": 1449465383, "post_id": 34111476, "comment_id": 56002055, "body": "You can typically do something like <code>map[string]struct{}{}</code> if you want a list to only contain unique entries. An empty struct doesn&#39;t take up any memory."}], "answers": [{"comments": [{"owner": {"reputation": 189, "user_id": 3822666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3182d23392d6948e5c89310db84dcf3?s=128&d=identicon&r=PG", "display_name": "terryp", "link": "https://stackoverflow.com/users/3822666/terryp"}, "edited": false, "score": 1, "creation_date": 1449354380, "post_id": 34111576, "comment_id": 55972998, "body": "Thanks you so much for the guidance, feedback and revision. Like I said, I&#39;m new to Go. Thanks again!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 12, "last_activity_date": 1579543400, "last_edit_date": 1579543400, "creation_date": 1449353909, "answer_id": 34111576, "question_id": 34111476, "link": "https://stackoverflow.com/questions/34111476/finding-unique-items-in-a-go-slice-or-array/34111576#34111576", "title": "Finding Unique Items in a Go Slice or Array", "body": "<p>There are multiple errors in your code. The most serious is that since you're comparing each specific element of the <code>visited</code> slice to <strong>all</strong> of the elements of <code>unique</code>, you will end up appending it if <code>unique</code> contains at least one which is different. And going forward, you will end up appending it multiple times if there are more elements in <code>unique</code> which differ as your inner <code>for</code> loop doesn't \"break\". This is not what you want, you want to append elements which equals to <strong>none</strong> of <code>unique</code>.</p>\n\n<p>Also note that a <code>struct</code> in Go is comparable if each of its fields are comparable. Since your <code>visit</code> struct contains only 2 <code>int</code> fields, it is comparable and so you can compare values of <code>visit</code> type simply with the <code>==</code> operator, no need that ugly <code>reflect.DeepEqual()</code>. See <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"nofollow noreferrer\">Spec: Comparison operators</a>:</p>\n\n<blockquote>\n  <p>Struct values are comparable if all their fields are comparable. Two struct values are equal if their corresponding non-<a href=\"https://golang.org/ref/spec#Blank_identifier\" rel=\"nofollow noreferrer\">blank</a> fields are equal.</p>\n</blockquote>\n\n<p>Here's a simplified, correct version that applies your logic:</p>\n\n<pre><code>visited := []visit{\n    visit{1, 100},\n    visit{2, 2},\n    visit{1, 100},\n    visit{1, 1},\n}\nvar unique []visit\n\nfor _, v := range visited {\n    skip := false\n    for _, u := range unique {\n        if v == u {\n            skip = true\n            break\n        }\n    }\n    if !skip {\n        unique = append(unique, v)\n    }\n}\n\nfmt.Println(unique)\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/yXpLNvx0m0\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[{1 100} {2 2} {1 1}]\n</code></pre>\n\n<h3>Alternative</h3>\n\n<p>It's true that Go doesn't have a built-in set type, but you can use a <code>map[visit]bool</code> easily as a set. With that, it becomes really simple! Note that <code>visit</code> can be used as key in the map because it is comparable (see above).</p>\n\n<pre><code>visited := []visit{\n    visit{1, 100},\n    visit{2, 2},\n    visit{1, 100},\n    visit{1, 1},\n}\nunique := map[visit]bool{}\n\nfor _, v := range visited {\n    unique[v] = true\n}\n\nfmt.Println(unique)\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/MT-da7OU0V\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>map[{2 2}:true {1 1}:true {1 100}:true]\n</code></pre>\n\n<p>The unique \"list\" is the list of keys in the map.</p>\n\n<p>If you want the unique <code>visit</code> values as a slice, see this variant:</p>\n\n<pre><code>var unique []visit\nm := map[visit]bool{}\n\nfor _, v := range visited {\n    if !m[v] {\n        m[v] = true\n        unique = append(unique, v)\n    }\n}\n\nfmt.Println(unique)\n</code></pre>\n\n<p>Output (as expected, try it on the <a href=\"http://play.golang.org/p/A6l6DW6LM1\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[{1 100} {2 2} {1 1}]\n</code></pre>\n\n<p>Note that this index expression: <code>m[v]</code> evaluates to <code>true</code> if <code>v</code> is already in the map (as a key, <code>true</code> is the value we stored in the map). If <code>v</code> is not yet in the map, <code>m[v]</code> yields the zero value of the value type which is <code>false</code> for the type <code>bool</code>, properly telling that the value <code>v</code> is not yet in the map. See <a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"nofollow noreferrer\">Spec: Index expressions</a>:</p>\n\n<blockquote>\n  <p>For a of <a href=\"https://golang.org/ref/spec#Map_types\" rel=\"nofollow noreferrer\">map type</a> <code>M</code>:</p>\n  \n  <p>...if the map is <code>nil</code> or does not contain such an entry, <code>a[x]</code> is the <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero value</a> for the value type of <code>M</code></p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 5356, "user_id": 1885921, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/02ba513b62ef9f2f7798b9bac1ccf822?s=128&d=identicon&r=PG", "display_name": "vodolaz095", "link": "https://stackoverflow.com/users/1885921/vodolaz095"}, "is_accepted": false, "score": 2, "last_activity_date": 1449353946, "creation_date": 1449353946, "answer_id": 34111583, "question_id": 34111476, "link": "https://stackoverflow.com/questions/34111476/finding-unique-items-in-a-go-slice-or-array/34111583#34111583", "title": "Finding Unique Items in a Go Slice or Array", "body": "<p>i think you can make a <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow\">map</a> of visits.\nSomething like this</p>\n\n<pre><code>visited := make(map[visit]Boolean)\n</code></pre>\n\n<p>than you can set the value of the visited.</p>\n\n<pre><code>visited[visit]=true\n</code></pre>\n\n<p>and lastly, you can fetch all visited locations by this code</p>\n\n<pre><code>for k, _ := range visited {\n    unique = append(unique, k)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 19, "user_id": 1869633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6563c8537ae3d360673910880538e6e7?s=128&d=identicon&r=PG", "display_name": "Arief Darmawan", "link": "https://stackoverflow.com/users/1869633/arief-darmawan"}, "is_accepted": false, "score": 1, "last_activity_date": 1449396355, "creation_date": 1449396355, "answer_id": 34116184, "question_id": 34111476, "link": "https://stackoverflow.com/questions/34111476/finding-unique-items-in-a-go-slice-or-array/34116184#34116184", "title": "Finding Unique Items in a Go Slice or Array", "body": "<p>I think you can use help of Map to solve this puzzle </p>\n\n<p><a href=\"https://play.golang.org/p/b7JtHYQ3N8\" rel=\"nofollow\">https://play.golang.org/p/b7JtHYQ3N8</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype visit struct {\n    x, y int\n}\n\nfunc main() {\n    var visited []visit\n    var unique []visit\n\n    uniqueMap := map[visit]int{}\n\n    visited = append(visited, visit{1, 100})\n    visited = append(visited, visit{2, 2})\n    visited = append(visited, visit{1, 100})\n    visited = append(visited, visit{1, 1})\n\n    for _, v := range visited {\n        if _, exist := uniqueMap[v]; !exist {\n            uniqueMap[v] = 1\n            unique = append(unique, v)\n        } else {\n            uniqueMap[v]++\n        }\n    }\n    fmt.Printf(\"Uniques: %v\\nMaps:%v\\n\", unique, uniqueMap)\n}\n</code></pre>\n"}], "owner": {"reputation": 189, "user_id": 3822666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3182d23392d6948e5c89310db84dcf3?s=128&d=identicon&r=PG", "display_name": "terryp", "link": "https://stackoverflow.com/users/3822666/terryp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8662, "favorite_count": 0, "accepted_answer_id": 34111576, "answer_count": 3, "score": 5, "last_activity_date": 1579543400, "creation_date": 1449353219, "last_edit_date": 1449357844, "question_id": 34111476, "link": "https://stackoverflow.com/questions/34111476/finding-unique-items-in-a-go-slice-or-array", "title": "Finding Unique Items in a Go Slice or Array", "body": "<p>I'm pretty new to go and I'm really, really confused right now. </p>\n\n<p>Let's say I have a list of coordinates and lets say I have some doubles in this list of coordinates. I can't for the life of me figure out how to make a unique list. Normally in Python I can \"cheat\" with sets and other built-ins. Not so much in Go.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype visit struct {\n    x, y int\n}\n\nfunc main() {\n    var visited []visit\n    var unique []visit\n\n    visited = append(visited, visit{1, 100})\n    visited = append(visited, visit{2, 2})\n    visited = append(visited, visit{1, 100})\n    visited = append(visited, visit{1, 1})\n\n    unique = append(unique, visit{1, 1})\n\n    fmt.Println(unique)\n\n    // Go through the visits and find the unique elements\n    for _, v := range visited {\n        for _, u := range unique {\n\n            fmt.Printf(\"Here's unique: %v\\n\", unique)\n            fmt.Printf(\"Comparing %v to %v is %v\\n\", v, u, reflect.DeepEqual(v, u))\n\n            if reflect.DeepEqual(v, u) {\n                fmt.Println(\"Skip\")\n            } else {\n                unique = append(unique, v)\n            }\n        }\n    }\n\n    fmt.Println(unique)\n}\n</code></pre>\n\n<p><kbd><a href=\"https://play.golang.org/p/7lYjfSaBP0\" rel=\"nofollow\">Run it on Playground</a></kbd></p>\n"}, {"tags": ["html", "forms", "http", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1449347539, "last_edit_date": 1449347539, "creation_date": 1449346741, "answer_id": 34110377, "question_id": 34108987, "link": "https://stackoverflow.com/questions/34108987/retrieving-form-option-id-through-parseform/34110377#34110377", "title": "Retrieving form option id through ParseForm()", "body": "<p>That is not how HTML <a href=\"http://www.w3schools.com/tags/tag_form.asp\"><code>&lt;form&gt;</code></a> works. When you use a <a href=\"http://www.w3schools.com/tags/tag_select.asp\"><code>&lt;select&gt;</code></a> in a <code>&lt;form&gt;</code>, you have to specify the <code>name</code> attribute at the <code>&lt;select&gt;</code> - you did this right. And you have to specify the <code>value</code> attribute for the <a href=\"http://www.w3schools.com/tags/tag_option.asp\"><code>&lt;option&gt;</code></a> tags, <strong>not</strong> the <code>id</code>. You may specify the <code>id</code> attribute too (e.g. if you want to refer to the tag by its id), but that is not what gets sent when the form is submitted.</p>\n\n<p>When the form is submitted, a <code>\"key\"=\"value\"</code> pair will be sent for the <code>&lt;select&gt;</code>, where <code>\"key\"</code> will be the value of the <code>name</code> attribute of <code>&lt;select&gt;</code>, and <code>\"value\"</code> will be the value of the <code>value</code> attribute of the <code>&lt;option&gt;</code> that is selected.</p>\n\n<p>And you can get the value of a submitted form field by its name using <a href=\"https://golang.org/pkg/net/http/#Request.FormValue\"><code>Request.FormValue()</code></a>, note that this also calls <a href=\"https://golang.org/pkg/net/http/#Request.ParseForm\"><code>Request.Parseform()</code></a> if necessary so you can even omit that call.</p>\n\n<p>See this working example:</p>\n\n<pre><code>func formHandler(w http.ResponseWriter, r *http.Request) {\n    if selectedFilm := r.FormValue(\"film\"); selectedFilm != \"\" {\n        log.Println(\"Selected film:\", r.FormValue(\"film\"))\n    }\n\n    w.Write([]byte(html))\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", formHandler)\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n\nconst html = `&lt;html&gt;&lt;body&gt;\n&lt;form method=\"POST\" action=\"/\"&gt;\n    &lt;select name=\"film\" id=\"films\"&gt;\n        &lt;option value=\"1\"&gt;The Godfather&lt;/option&gt;\n        &lt;option value=\"2\"&gt;The Godfather: Part II&lt;/option&gt;\n    &lt;/select&gt;\n    &lt;input type=\"submit\" value=\"Submit\"&gt;\n&lt;/form&gt;\n&lt;/body&gt;&lt;/html&gt;`\n</code></pre>\n\n<p>When you select <code>\"The Godfather\"</code> and submit, the console shows:</p>\n\n<pre><code>2015/12/05 21:18:42 Selected film: 1\n</code></pre>\n\n<p>When you select <code>\"The Godfather: Part II\"</code> and submit, the console shows:</p>\n\n<pre><code>2015/12/05 21:18:45 Selected film: 2\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 4359590, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/ckOk8.png?s=128&g=1", "display_name": "nolem", "link": "https://stackoverflow.com/users/4359590/nolem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 311, "favorite_count": 0, "accepted_answer_id": 34110377, "answer_count": 1, "score": 2, "last_activity_date": 1449347539, "creation_date": 1449338595, "last_edit_date": 1449347290, "question_id": 34108987, "link": "https://stackoverflow.com/questions/34108987/retrieving-form-option-id-through-parseform", "title": "Retrieving form option id through ParseForm()", "body": "<p>I am trying to get the option value id from HTML form dropdown.</p>\n\n<p>Let's say I have these lines in my HTML file:</p>\n\n<pre><code>&lt;select name=\"film\" id=\"films\"&gt;\n&lt;option id=\"1\"&gt;Godfather&lt;/option&gt;\n&lt;/select&gt;\n</code></pre>\n\n<p>And this in my Go file:</p>\n\n<pre><code>func filmFunc(w http.ResponseWriter, r *http.Request) {\n    r.ParseForm()\n    film_raw := r.Form[\"film\"]\n    film := film_raw[0]\n    ...\n}\n</code></pre>\n\n<p>This will give me the text from the option (<code>\"Godfather\"</code>), but I need to get the option id (<code>\"1\"</code>) and save it as a variable. How can I do it?</p>\n"}, {"tags": ["go", "channel", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "is_accepted": true, "score": 5, "last_activity_date": 1449338335, "creation_date": 1449338335, "answer_id": 34108936, "question_id": 34108862, "link": "https://stackoverflow.com/questions/34108862/golang-program-hangs-without-finishing-execution/34108936#34108936", "title": "Golang program hangs without finishing execution", "body": "<p>The problem is that ranging over a channel in a for loop will continue forever unless the channel is closed. If you want to read precisely <code>len(urls)</code> values from the channel, you should loop that many times:</p>\n\n<pre><code>for i := 0; i &lt; len(urls); i++ {\n    fmt.Println(&lt;-ch)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": false, "score": 0, "last_activity_date": 1449418327, "creation_date": 1449418327, "answer_id": 34119598, "question_id": 34108862, "link": "https://stackoverflow.com/questions/34108862/golang-program-hangs-without-finishing-execution/34119598#34119598", "title": "Golang program hangs without finishing execution", "body": "<p>Another good dirty devious trick would be to use <code>sync.WaitGroup</code> and increment it per <code>goroutine</code> and then monitor it with a <code>Wait</code> and after its done it will close your channel allowing the next blocks of code to run, the reason I am offering you this approach is because it gets away from using a static number in a loop like <code>len(urls)</code> so that you can have a dynamic slice that might change and what not. </p>\n\n<p>The reason <code>Wait</code> and <code>close</code> are in their own goroutine is so that your code can reach the <code>for loop</code> to <code>range</code> over your channel</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"time\"\n    \"sync\"\n)\n\nvar urls = []string{\n    \"http://www.google.com/\",\n    \"http://golang.org/\",\n    \"http://yahoo.com/\",\n}\n\ntype HttpResponse struct {\n    url      string\n    response *http.Response\n    err      error\n    status   string\n}\n\nfunc asyncHttpGets(url string, ch chan *HttpResponse, wg *sync.WaitGroup) {\n    client := http.Client{}\n    if url == \"http://www.google.com/\" {\n        time.Sleep(500 * time.Millisecond) //google is down\n    }\n\n    fmt.Printf(\"Fetching %s \\n\", url)\n    resp, err := client.Get(url)\n    u := &amp;HttpResponse{url, resp, err, \"fetched\"}\n    ch &lt;- u\n    fmt.Println(\"sent to chan\")\n    wg.Done()\n}\n\nfunc main() {\n    fmt.Println(\"start\")\n    ch := make(chan *HttpResponse, len(urls))\n    var wg sync.WaitGroup\n    for _, url := range urls {\n        wg.Add(1)\n        go asyncHttpGets(url, ch, &amp;wg)\n    }\n\n    go func() {\n        wg.Wait()\n        close(ch)\n    }()\n\n    for i := range ch {\n        fmt.Println(i)\n    }\n    fmt.Println(\"Im done\")\n\n}\n</code></pre>\n"}], "owner": {"reputation": 11396, "user_id": 2768067, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hSTUv.png?s=128&g=1", "display_name": "Komu", "link": "https://stackoverflow.com/users/2768067/komu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3185, "favorite_count": 1, "accepted_answer_id": 34108936, "answer_count": 2, "score": 2, "last_activity_date": 1449418327, "creation_date": 1449338075, "last_edit_date": 1449359866, "question_id": 34108862, "link": "https://stackoverflow.com/questions/34108862/golang-program-hangs-without-finishing-execution", "title": "Golang program hangs without finishing execution", "body": "<p>I have the following golang program;</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"time\"\n)\n\nvar urls = []string{\n    \"http://www.google.com/\",\n    \"http://golang.org/\",\n    \"http://yahoo.com/\",\n}\n\ntype HttpResponse struct {\n    url      string\n    response *http.Response\n    err      error\n    status   string\n}\n\nfunc asyncHttpGets(url string, ch chan *HttpResponse) {\n    client := http.Client{}\n    if url == \"http://www.google.com/\" {\n        time.Sleep(500 * time.Millisecond) //google is down\n    }\n\n    fmt.Printf(\"Fetching %s \\n\", url)\n    resp, err := client.Get(url)\n    u := &amp;HttpResponse{url, resp, err, \"fetched\"}\n    ch &lt;- u\n    fmt.Println(\"sent to chan\")\n}\n\nfunc main() {\n    fmt.Println(\"start\")\n    ch := make(chan *HttpResponse, len(urls))\n    for _, url := range urls {\n        go asyncHttpGets(url, ch)\n    }\n\n    for i := range ch {\n        fmt.Println(i)\n    }\n    fmt.Println(\"Im done\")\n\n}\n</code></pre>\n\n<p><kbd><a href=\"https://play.golang.org/p/TfzA_SQn5e\" rel=\"nofollow\">Run it on Playground</a></kbd></p>\n\n<p>However when I run it; it hangs (ie the last part that ought to print <code>Im done</code> doesnt run.)\nHere's the terminal output;;<br>\n$ go run get.go<br>\nstart<br>\nFetching <a href=\"http://yahoo.com/\" rel=\"nofollow\">http://yahoo.com/</a><br>\nFetching <a href=\"http://golang.org/\" rel=\"nofollow\">http://golang.org/</a><br>\nFetching <a href=\"http://www.google.com/\" rel=\"nofollow\">http://www.google.com/</a><br>\nsent to chan<br>\n&amp;{<a href=\"http://www.google.com/\" rel=\"nofollow\">http://www.google.com/</a> 0xc820144120  fetched}<br>\nsent to chan<br>\n&amp;{<a href=\"http://golang.org/\" rel=\"nofollow\">http://golang.org/</a> 0xc82008b710  fetched}<br>\nsent to chan<br>\n&amp;{<a href=\"http://yahoo.com/\" rel=\"nofollow\">http://yahoo.com/</a> 0xc82008b7a0  fetched}</p>\n"}, {"tags": ["encryption", "go", "cryptography", "aes"], "comments": [{"owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 1, "creation_date": 1449340595, "post_id": 34108194, "comment_id": 55968422, "body": "CBC != CFB check your modes"}, {"owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "reply_to_user": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 0, "creation_date": 1449342650, "post_id": 34108194, "comment_id": 55969090, "body": "Thank you Artjom, I&#39;ve updated the code and that certainly puts me in the ball park now - thank you!  I&#39;m experimenting with trying to replicate the padding that the Python encryption routine is doing but I&#39;m stuck with the same output now - though - thanks to you further along and on the correct playing field now."}, {"owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "reply_to_user": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 0, "creation_date": 1449346534, "post_id": 34108194, "comment_id": 55970463, "body": "Thank you again Artjom. I&#39;ve got the padding working like the Python now (updated my example) but there is still something I&#39;m missing/not seeing.  It seems SO close now after your feedback."}, {"owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "reply_to_user": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 1, "creation_date": 1449347316, "post_id": 34108194, "comment_id": 55970718, "body": "I&#39;ve got it sorted now and posted the solution in my Go code - thank you so much for taking the time to look at my code and point out the CBC != CFB mode difference.  I would not have made any progress without your having pointed that out!  Please post that as an answer and I&#39;ll accept it."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1449380763, "post_id": 34108194, "comment_id": 55978559, "body": "Erm, what is the reason not to use <a href=\"https://golang.org/pkg/crypto/aes/\" rel=\"nofollow noreferrer\">crypto/aes</a>? The reason why I am asking is that chances are not too bad that you&#39;ll introduce a bug during porting, whereas an existing implementation likely already was checked a couple of times."}, {"owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "edited": false, "score": 0, "creation_date": 1449409726, "post_id": 34108194, "comment_id": 55985112, "body": "Erm, I had not seen that yet.  Thank you for the tip.  I will give that a try and as long as it is compatible with the calling Python and C then, as you said, a lot less error prone."}, {"owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1449452670, "post_id": 34108194, "comment_id": 55998999, "body": "@MarkusWMahlberg, I&#39;ve reviewed the docs - I am using the crypto/aes libraries.  I derive the key and IV the way I do to be compatible with the Python and C that are in place and will be decrypting what I encrypt.  Thank you again for the heads up to double check the docs."}], "answers": [{"tags": [], "owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "is_accepted": true, "score": 0, "last_activity_date": 1449451530, "last_edit_date": 1449451530, "creation_date": 1449450944, "answer_id": 34124980, "question_id": 34108194, "link": "https://stackoverflow.com/questions/34108194/porting-python-aes-encryption-routies-to-golang/34124980#34124980", "title": "Porting Python AES encryption routies to Golang", "body": "<p>Here is the working encryption routine:</p>\n\n<pre><code>func pyEncrypt(password string, pathToInFile string, pathToOutFile string){\n    bs := int(aes.BlockSize)\n    salt := make([]byte, aes.BlockSize - len(\"Salted__\")) \n    _, err := rand.Read(salt)\n    if err != nil {panic(err)}\n\n    key, iv := deriveKeyAndIV([]byte(password), salt, bs)   \n    block, err := aes.NewCipher(key)\n    if err != nil {panic(err)}\n\n    cbc := cipher.NewCBCEncrypter(block, iv)\n\n    fin, err := os.Open(pathToInFile)\n    if err != nil {panic(err)}\n    defer fin.Close()\n\n    fout, err := os.Create(pathToOutFile)\n    if err != nil {panic(err)}\n    defer fout.Close()\n\n    _,err = fout.Write([]byte(\"Salted__\"))\n    if err != nil {panic(err)}\n    _,err = fout.Write(salt)\n    if err != nil {panic(err)}\n\n    for true{\n        chunk := make([]byte, 1024 * bs)\n\n        n,err := fin.Read(chunk)\n        if err == io.EOF{\n        break\n        }else if err != nil{\n            panic(err)\n        }\n\n        if n == 0 || n % bs != 0 {//need to pad up to block size :bs\n            paddingLength := (bs - n % bs) \n            paddingChr := []byte(string(rune(paddingLength)))\n            paddingBytes := make([]byte, paddingLength)\n\n            for i := 0; i &lt; paddingLength; i++{\n                paddingBytes[i] = paddingChr[0]\n            }\n\n            chunk = append(chunk[0:n], []byte(paddingBytes)...)\n        }else{\n            chunk = chunk[0:n]//no padding needed           \n        }\n\n        ciphertext := make([]byte, len(chunk))\n        cbc.CryptBlocks(ciphertext,chunk)\n        fout.Write(ciphertext)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 559, "favorite_count": 0, "accepted_answer_id": 34124980, "answer_count": 1, "score": 1, "last_activity_date": 1449474670, "creation_date": 1449334815, "last_edit_date": 1449474670, "question_id": 34108194, "link": "https://stackoverflow.com/questions/34108194/porting-python-aes-encryption-routies-to-golang", "title": "Porting Python AES encryption routies to Golang", "body": "<p>I am trying to port the following Python AES file encryption routines over to Go:</p>\n\n<pre><code>def derive_key_and_iv(password, salt, key_length, iv_length):\n    d = d_i = ''\n    while len(d) &lt; key_length + iv_length:\n        d_i = md5(d_i + password + salt).digest()\n        d += d_i\n    return d[:key_length], d[key_length:key_length+iv_length]\n\n\ndef encrypt(in_file, out_file, password, key_length=32):\n    bs = AES.block_size\n    salt = Random.new().read(bs - len('Salted__'))\n    key, iv = derive_key_and_iv(password, salt, key_length, bs)\n    cipher = AES.new(key, AES.MODE_CBC, iv)\n    out_file.write('Salted__' + salt)\n    finished = False\n    while not finished:\n        chunk = in_file.read(1024 * bs)\n        if len(chunk) == 0 or len(chunk) % bs != 0:\n            padding_length = (bs - len(chunk) % bs) or bs\n            chunk += padding_length * chr(padding_length)\n            finished = True\n        out_file.write(cipher.encrypt(chunk))\n\n\ndef decrypt(in_file, out_file, password, key_length=32):\n    bs = AES.block_size\n    print(bs)\n    salt = in_file.read(bs)[len('Salted__'):]\n    key, iv = derive_key_and_iv(password, salt, key_length, bs)\n    cipher = AES.new(key, AES.MODE_CBC, iv)\n    next_chunk = ''\n    finished = False\n    while not finished:\n        chunk, next_chunk = next_chunk, cipher.decrypt(in_file.read(1024 * bs))\n        if len(next_chunk) == 0:\n            padding_length = ord(chunk[-1])\n            chunk = chunk[:-padding_length]\n            finished = True\n        out_file.write(chunk)\n</code></pre>\n\n<p>I have the following Go routines coded up but I'm not quite able to get it working. I am trying to get the encryption routines working in Go for callers that call the decrypt in Python and C so I'm really only interested in figuring out how to get my Golang encryption routine working but have included all the Python bits for clarity.</p>\n\n<p>My current Go routines look like this:</p>\n\n<pre><code>package main\nimport (\n    \"crypto/aes\"\n    \"crypto/cipher\"\n    \"crypto/rand\"\n    \"encoding/base64\"\n    \"errors\"\n    \"fmt\"\n    \"io\"\n    \"log\"     \n    \"crypto/md5\"  \n    \"os\"\n    )\n\n\nfunc pyEncrypt(password []byte, pathToInFile string, pathToOutFile string){\n    bs := int(aes.BlockSize)\n    salt := make([]byte, aes.BlockSize - len(\"Salted__\")) \n    _, err := rand.Read(salt)\n    if err != nil {panic(err)}\n\n    key, iv := deriveKeyAndIV(password, salt, bs)   \n    block, err := aes.NewCipher(key)\n    if err != nil {panic(err)}\n\n    cfb := cipher.NewCFBEncrypter(block, iv)\n\n    fin, err := os.Open(pathToInFile)\n    if err != nil {panic(err)}\n    defer fin.Close()\n\n    fout, err := os.Create(pathToOutFile)\n    if err != nil {panic(err)}\n    defer fout.Close()\n\n    _, err = fout.Write([]byte(\"Salted__\")) \n    if err != nil {panic(err)}\n    _, err = fout.Write(salt)\n    if err != nil {panic(err)}\n\n    for true{\n        ciphertext := make([]byte, 1024 *bs)\n        chunk := make([]byte, 1024 * bs)\n        _, err := fin.Read(chunk)\n        if err == io.EOF{\n        break\n        }else if err != nil{\n            panic(err)\n        }\n        cfb.XORKeyStream(ciphertext, chunk)     \n        fout.Write(ciphertext)\n    }\n}\n\n\nfunc deriveKeyAndIV(password []byte, salt []byte, bs int) ([]byte, []byte) {\n    var digest []byte\n    hash := md5.New()\n    out := make([]byte, 32 + bs) //right now I'm just matching the default key size (32) from the python script so 32 represents the default from python\n    for i := 0; i &lt; 32 + bs ; i += len(digest) {\n        hash.Reset()\n        hash.Write(digest)\n        hash.Write(password)\n        hash.Write(salt)\n        digest = hash.Sum(digest[:0])\n        copy(out[i:], digest)\n    }\n    return out[:32], out[32:32+bs] //matching the default key size from Python as that is what the application uses\n}\n\nfunc main() {\n    pwd := []byte(\"test123\")\n\n    pyEncrypt(pwd, \"/home/chris/pt.txt\", \"/home/chris/genc.txt\")    \n}\n</code></pre>\n\n<p>Right now it runs, lol, generates an encrypted file that looks right and the Python \"decrypts\" without error but it generates gibberish and doesn't actually produce the clear text.  The Python routines work by stand-alone but I can't get my Golang encrypt producing output that the Python decrypt can decrypt.  I have to match the Python encryption routine for compatibility with the callers.  Do you see what I'm doing wrong in my Golang encryption routine?  Thank you so much for your assistance.</p>\n"}, {"tags": ["json", "go", "marshalling"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1449362214, "post_id": 34108129, "comment_id": 55975104, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/26327391/go-json-marshalstruct-returns\">Go json.Marshal(struct) returns &quot;{}&quot;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2947, "user_id": 1309092, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/3aaf7c52bb728e358ccc72d3a8f288e1?s=128&d=identicon&r=PG&f=1", "display_name": "Rubber Duck", "link": "https://stackoverflow.com/users/1309092/rubber-duck"}, "edited": false, "score": 0, "creation_date": 1473813900, "post_id": 34108411, "comment_id": 66280867, "body": "Wow, that&#39;s subtle."}], "tags": [], "owner": {"reputation": 1183, "user_id": 2959387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459784500061e41da68ed5af11f92183?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Thakkar", "link": "https://stackoverflow.com/users/2959387/prashant-thakkar"}, "is_accepted": true, "score": 6, "last_activity_date": 1449335893, "creation_date": 1449335893, "answer_id": 34108411, "question_id": 34108129, "link": "https://stackoverflow.com/questions/34108129/marshal-returns-empty-json-of-my-struct/34108411#34108411", "title": "Marshal returns empty json of my struct", "body": "<p>In order to marshal and unmarshal json, fields/property of struct needs to be public. To make the field/property of struct public it should start with Upper Case. In your all the fields are in lower case.</p>\n\n<pre><code>type Fic struct {\n    Nom     string    `json:\"fileName\"`\n    Lon     int64     `json:\"size\"`\n    Tim     time.Time `json:\"lastFileUpdate\"`\n    Md5hash []byte    `json:\"md5\"`\n}\n\n// folder's struct\ntype Fol struct {\n    SubFol []Fol     `json:\"listFolders\"`\n    Files  []Fic     `json:\"listFiles\"`\n    Nom    string    `json:\"folderName\"`\n    Tim    time.Time `json:\"lastFolderUpdate\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 4339576, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TGXyl.jpg?s=128&g=1", "display_name": "kindermoumoute", "link": "https://stackoverflow.com/users/4339576/kindermoumoute"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 34108411, "answer_count": 1, "score": 0, "last_activity_date": 1449335893, "creation_date": 1449334401, "question_id": 34108129, "link": "https://stackoverflow.com/questions/34108129/marshal-returns-empty-json-of-my-struct", "title": "Marshal returns empty json of my struct", "body": "<p>I'm working on a code that scan a repertory into a struct in order to export it to json.</p>\n\n<p>Currently, my code scans finely a repertory with the <code>ScanDir</code> function, but when I try to Marshal my struct it only returns <code>{}</code>.</p>\n\n<pre><code>// file's struct\ntype Fic struct {\n    nom     string    `json:\"fileName\"`\n    lon     int64     `json:\"size\"`\n    tim     time.Time `json:\"lastFileUpdate\"`\n    md5hash []byte    `json:\"md5\"`\n}\n\n// folder's struct\ntype Fol struct {\n    subFol []Fol     `json:\"listFolders\"`\n    files  []Fic     `json:\"listFiles\"`\n    nom    string    `json:\"folderName\"`\n    tim    time.Time `json:\"lastFolderUpdate\"`\n}\n\nfunc main() {\n    var root Fol\n    err := ScanDir(\"./folder\", &amp;root)   // scan a folder and fill my struct\n    check(err)\n    b, err := json.Marshal(root)\n    check(err)\n    os.Stdout.Write(b)\n}\n\nfunc check(err error) {\nif err != nil {\n    fmt.Fprintf(os.Stderr, \"Fatal error : %s\", err.Error())\n    os.Exit(1)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1677, "user_id": 82854, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/45509e07d8ad7abef901b87cb55a5f84?s=128&d=identicon&r=PG", "display_name": "Nick ", "link": "https://stackoverflow.com/users/82854/nick"}, "edited": false, "score": 0, "creation_date": 1449345176, "post_id": 34110074, "comment_id": 55969950, "body": "Looks like the pcre library solves my problem. Thanks"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 5, "last_activity_date": 1449344974, "last_edit_date": 1495542655, "creation_date": 1449344974, "answer_id": 34110074, "question_id": 34107791, "link": "https://stackoverflow.com/questions/34107791/how-do-i-match-a-any-repeating-character-using-regexp/34110074#34110074", "title": "how do I match a any repeating character using regexp?", "body": "<p>Since backreference is <a href=\"https://swtch.com/~rsc/regexp/regexp3.html\" rel=\"nofollow noreferrer\">not supported by re2</a>, you would need:</p>\n\n<ul>\n<li>either to use <a href=\"https://godoc.org/?q=pcre\" rel=\"nofollow noreferrer\">another regex library</a> (like <a href=\"https://github.com/glenn-brown/golang-pkg-pcre\" rel=\"nofollow noreferrer\"><code>glenn-brown/golang-pkg-pcre</code></a>)</li>\n<li>or <a href=\"https://stackoverflow.com/a/2285561/6309\">code a loop</a> which does the analysis without regexp</li>\n</ul>\n"}], "owner": {"reputation": 1677, "user_id": 82854, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/45509e07d8ad7abef901b87cb55a5f84?s=128&d=identicon&r=PG", "display_name": "Nick ", "link": "https://stackoverflow.com/users/82854/nick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 2, "accepted_answer_id": 34110074, "answer_count": 1, "score": 4, "last_activity_date": 1449344974, "creation_date": 1449332582, "last_edit_date": 1449337398, "question_id": 34107791, "link": "https://stackoverflow.com/questions/34107791/how-do-i-match-a-any-repeating-character-using-regexp", "title": "how do I match a any repeating character using regexp?", "body": "<p>I need to match any character that's repeated twice, for example: </p>\n\n<pre><code>\"abccdeff\"\n</code></pre>\n\n<p>Should match \"cc\" and \"ff\". In any other regex syntax, let's use Javascript as a quick example, I could do:</p>\n\n<pre><code>var str = \"abccdeff\";\nvar r = /([a-z]{1})\\1/g\nconsole.log(str.match(r))\n</code></pre>\n\n<p>Which returns</p>\n\n<pre><code>[ 'cc', 'ff' ]\n</code></pre>\n\n<p>But Go's regexp doesn't seem to allow that. Is it possible to do this in Go?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1449316891, "post_id": 34104519, "comment_id": 55960552, "body": "Your folder name is <code>template</code> but your refer to files like <code>&quot;templates&#47;xxx&quot;</code> (note the plural <code>&quot;s&quot;</code>). But don&#39;t ever parse templates in the handler function, see this for more details: <a href=\"http://stackoverflow.com/questions/28451675/it-takes-too-much-time-when-using-template-package-to-generate-a-dynamic-web-p\">It takes too much time when using \u201ctemplate\u201d package to generate a dynamic web page to client in golang</a>. Also <code>Execute()</code> returns an error, please check the returned error!"}, {"owner": {"reputation": 11, "user_id": 5642678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0441007b98a92825e5a2a7ad18ae1079?s=128&d=identicon&r=PG&f=1", "display_name": "Ya Boobey", "link": "https://stackoverflow.com/users/5642678/ya-boobey"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1449317139, "post_id": 34104519, "comment_id": 55960627, "body": "sorry, actually it&#39;s <b>templetes</b>. it&#39;s not the reason of a problem."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1449317356, "post_id": 34104519, "comment_id": 55960687, "body": "Please show header and footer."}, {"owner": {"reputation": 11, "user_id": 5642678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0441007b98a92825e5a2a7ad18ae1079?s=128&d=identicon&r=PG&f=1", "display_name": "Ya Boobey", "link": "https://stackoverflow.com/users/5642678/ya-boobey"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1449317762, "post_id": 34104519, "comment_id": 55960795, "body": "@Markus W Mahlberg updated"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1449320253, "post_id": 34104519, "comment_id": 55961439, "body": "Hm, in writeHandler, <code>fmt.Fprintf((w), &quot;write&quot;)</code> looks odd to me. Will check that."}, {"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1449330099, "post_id": 34104519, "comment_id": 55964571, "body": "Can&#39;t reproduce here, it works for me. Do what @icza said, check the error returned by t.ExecuteTemplate <a href=\"https://golang.org/pkg/html/template/#Template.ExecuteTemplate\" rel=\"nofollow noreferrer\">golang.org/pkg/html/template/#Template.ExecuteTemplate</a>"}, {"owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "edited": false, "score": 0, "creation_date": 1449356311, "post_id": 34104519, "comment_id": 55973621, "body": "I commented out fmt.Fprintf((w), &quot;write&quot;) and got the result I think you&#39;re after."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "edited": false, "score": 0, "creation_date": 1449380940, "post_id": 34104519, "comment_id": 55978594, "body": "@Snowman Thanks, relieves me from that. ;)"}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1449416563, "post_id": 34104519, "comment_id": 55987337, "body": "@MarkusWMahlberg so was this solved or?"}], "owner": {"reputation": 11, "user_id": 5642678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0441007b98a92825e5a2a7ad18ae1079?s=128&d=identicon&r=PG&f=1", "display_name": "Ya Boobey", "link": "https://stackoverflow.com/users/5642678/ya-boobey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 323, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1449320321, "creation_date": 1449316033, "last_edit_date": 1449320321, "question_id": 34104519, "link": "https://stackoverflow.com/questions/34104519/golang-empty-responce-in-new-template", "title": "Golang, empty responce in new template", "body": "<p>indexHandler works perfect!\nwriteHandler - returs me blank page. Templates are the same. Can't understand what's the problem. Please check code bellow </p>\n\n<pre><code>func indexHandler(w http.ResponseWriter, r *http.Request) {\n    t, err := template.ParseFiles(\"templates/index.html\", \"templates/header.html\", \"templates/footer.html\")\n    if err != nil {\n        fmt.Fprintf(w, err.Error())\n    }\n    t.ExecuteTemplate(w, \"index\", nil)\n}\n\nfunc writeHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf((w), \"write\")\n\n    t, err := template.ParseFiles(\"templates/write.html\", \"templates/header.html\", \"templates/footer.html\")\n    if err != nil {\n        fmt.Fprintf(w, err.Error())\n    }\n\n    t.ExecuteTemplate(w, \"write\", nil)\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", indexHandler)\n    http.HandleFunc(\"/write\", writeHandler)\n    http.ListenAndServe(\":3000\", nil)\n}\n</code></pre>\n\n<p>write.html look's like</p>\n\n<pre><code>{{ define \"write\" }}\n\n{{ template \"header\" }}\n\n&lt;h1&gt;It works!&lt;/h1&gt;\n\n{{ template \"footer\" }}\n\n{{ end }}\n</code></pre>\n\n<p>header:</p>\n\n<pre><code>{{ define \"header\" }}\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n&lt;body&gt;\n&lt;h1&gt;HEADER&lt;/h1&gt;\n{{ end }}\n</code></pre>\n\n<p>footer:</p>\n\n<pre><code>{{ define \"footer\" }}\n&lt;/body&gt;\n&lt;/html&gt;\n{{ end }}\n</code></pre>\n\n<p>source tree:</p>\n\n<pre><code>templates\n---header.html\n---index.html\n---footer.html\n---write.html\n</code></pre>\n"}, {"tags": ["css", "go", "gorilla"], "comments": [{"owner": {"reputation": 155, "user_id": 5541509, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/408e9fd99c0a3e83a09f3173a8498ca8?s=128&d=identicon&r=PG&f=1", "display_name": "bama_programmer", "link": "https://stackoverflow.com/users/5541509/bama-programmer"}, "edited": false, "score": 0, "creation_date": 1449316170, "post_id": 34104447, "comment_id": 55960312, "body": "I have tried passing the string argument &quot;assets&quot; to http.Dir as well."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1449319250, "post_id": 34104447, "comment_id": 55961152, "body": "Are you running your program from the same directory as your <code>assets&#47;</code> folder exists in? Specifically, you should be doing <code>go build &amp; .&#47;&lt;programname&gt;</code> instead of <code>go run main.go</code> (which will run it from a temp dir)"}, {"owner": {"reputation": 155, "user_id": 5541509, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/408e9fd99c0a3e83a09f3173a8498ca8?s=128&d=identicon&r=PG&f=1", "display_name": "bama_programmer", "link": "https://stackoverflow.com/users/5541509/bama-programmer"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1449319718, "post_id": 34104447, "comment_id": 55961282, "body": "Yes, my main function resides in a file called femp.go, which is located in the same directory as assets/.  I do <code>go build</code> then (on my Windows machine) <code>femp.exe --settings=settings.xml</code>, where settings is a custom flag that unmarshals an xml file containing server and db specs."}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1449419067, "post_id": 34104447, "comment_id": 55988217, "body": "@bama_programmer can you show your template scripts"}], "owner": {"reputation": 155, "user_id": 5541509, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/408e9fd99c0a3e83a09f3173a8498ca8?s=128&d=identicon&r=PG&f=1", "display_name": "bama_programmer", "link": "https://stackoverflow.com/users/5541509/bama-programmer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 272, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1449324969, "creation_date": 1449315727, "last_edit_date": 1449324969, "question_id": 34104447, "link": "https://stackoverflow.com/questions/34104447/how-do-i-properly-configure-a-golang-gorilla-pat-router-to-serve-static-asset-fo", "title": "How do I properly configure a Golang gorilla/pat router to serve static asset folders?", "body": "<p>I have two html files that are parsed as follows: </p>\n\n<pre><code>var LoginTemplate = template.Must(template.ParseFiles(\n    \"views/_base.html\",\n    \"views/login.html\",\n))\n</code></pre>\n\n<p>And executed as such:</p>\n\n<pre><code>func LoginFormHandler(w http.ResponseWriter, r *http.Request, ctx *models.Context) error {\n    err := LoginTemplate.Execute(w, ctx)\n\n    if err != nil {\n        http.Error(w, err.Error(), 404)\n    }\n    return nil\n}\n</code></pre>\n\n<p>Here are the contents of _base.html:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n\n  &lt;head&gt;\n      &lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\"&gt;\n      &lt;!-- Meta, title, CSS, favicons, etc. --&gt;\n      &lt;meta charset=\"utf-8\"&gt;\n\n      &lt;title&gt;{{ template \"title\" . }}&lt;/title&gt;\n\n      &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"&gt;\n      &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;\n      {{ template \"styles\" . }}\n      {{ template \"scripts\" . }}\n  &lt;/head&gt;\n\n  {{ template \"content\" . }}\n\n&lt;/html&gt;\n</code></pre>\n\n<p>The templates specified above are all defined in login.html.  For example, \"styles\" wraps all of my CSS links, etc. In my main function, I use a gorilla/pat router to handle several page requests to the server.  Additionally, I want to serve my static assets folders like this:</p>\n\n<pre><code>router.PathPrefix(\"/assets/\").Handler(http.StripPrefix(\"/assets/\", http.FileServer(http.Dir(\"./assets/\"))))\n\n  if err := http.ListenAndServe(\":\"+settings.Server.Port, router); err != nil {\n        panic(err)\n  } \n</code></pre>\n\n<p>However, upon building and running my program, then navigating to local host, I see that none of the CSS or js appears to be rendering.  My css and js folders are in this tree:</p>\n\n<blockquote>\n  <p>ROOT/</p>\n  \n  <blockquote>\n    <p>assets/</p>\n    \n    <blockquote>\n      <p>css/<br>\n      js/  </p>\n    </blockquote>\n  </blockquote>\n</blockquote>\n"}, {"tags": ["parse-platform", "go"], "comments": [{"owner": {"reputation": 1942, "user_id": 1209272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97e49723c518649025bd10ea6bf113b5?s=128&d=identicon&r=PG", "display_name": "Chief", "link": "https://stackoverflow.com/users/1209272/chief"}, "edited": false, "score": 0, "creation_date": 1449333094, "post_id": 34103249, "comment_id": 55965615, "body": "Seems parse is trying to send a https request that&#39;s failing. Did you change anything in your <code>&#47;etc&#47;ssl</code> folder? It&#39;s usually required by net/http to access the system roots"}, {"owner": {"reputation": 2440, "user_id": 4274296, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/R1y4M.png?s=128&g=1", "display_name": "GPack", "link": "https://stackoverflow.com/users/4274296/gpack"}, "reply_to_user": {"reputation": 1942, "user_id": 1209272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97e49723c518649025bd10ea6bf113b5?s=128&d=identicon&r=PG", "display_name": "Chief", "link": "https://stackoverflow.com/users/1209272/chief"}, "edited": false, "score": 0, "creation_date": 1449333752, "post_id": 34103249, "comment_id": 55965882, "body": "not changed /etc/ssl"}, {"owner": {"reputation": 2440, "user_id": 4274296, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/R1y4M.png?s=128&g=1", "display_name": "GPack", "link": "https://stackoverflow.com/users/4274296/gpack"}, "reply_to_user": {"reputation": 1942, "user_id": 1209272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97e49723c518649025bd10ea6bf113b5?s=128&d=identicon&r=PG", "display_name": "Chief", "link": "https://stackoverflow.com/users/1209272/chief"}, "edited": false, "score": 0, "creation_date": 1449340120, "post_id": 34103249, "comment_id": 55968269, "body": "Now I get this, after requesting password: panic: runtime error: invalid memory address or nil pointer dereference [signal 0xb code=0x1 addr=0x1 pc=0x8097025]"}], "answers": [{"tags": [], "owner": {"reputation": 2440, "user_id": 4274296, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/R1y4M.png?s=128&g=1", "display_name": "GPack", "link": "https://stackoverflow.com/users/4274296/gpack"}, "is_accepted": true, "score": 0, "last_activity_date": 1449516620, "creation_date": 1449516620, "answer_id": 34141617, "question_id": 34103249, "link": "https://stackoverflow.com/questions/34103249/parse-deploy-command-error-x509/34141617#34141617", "title": "Parse deploy command error x509", "body": "<p>I solved executing an update-ca-certificates command. I think that certificates were broken and it stopped to work, but I dont know why.</p>\n"}], "owner": {"reputation": 2440, "user_id": 4274296, "user_type": "registered", "accept_rate": 51, "profile_image": "https://i.stack.imgur.com/R1y4M.png?s=128&g=1", "display_name": "GPack", "link": "https://stackoverflow.com/users/4274296/gpack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 34141617, "answer_count": 1, "score": 1, "last_activity_date": 1449516620, "creation_date": 1449307258, "last_edit_date": 1449397348, "question_id": 34103249, "link": "https://stackoverflow.com/questions/34103249/parse-deploy-command-error-x509", "title": "Parse deploy command error x509", "body": "<p>On <code>parse deploy</code> command I get this error, how can I solve it? </p>\n\n<blockquote>\n  <p>x509: failed to load system roots and no roots provided.\n  /home/travis/gopath/src/github.com/ParsePlatform/parse-cli/main.go:143      checkIfSupported\n  /home/travis/gopath/src/github.com/ParsePlatform/parse-cli/main.go:101      main\n  /home/travis/.gimme/versions/go1.4.2.linux.amd64/src/runtime/proc.go:72     main\n  /home/travis/.gimme/versions/go1.4.2.linux.amd64/src/runtime/asm_386.s:2288 goexit</p>\n</blockquote>\n\n<p><strong>(OS Ubuntu 14.04 LTS 64)</strong></p>\n\n<p><strong>UPDATE</strong>\nNow sometimes, one in ten attempts, it requests email and password. But, after input password, I get:</p>\n\n<blockquote>\n  <p>panic: runtime error: invalid memory address or nil pointer dereference [signal 0xb code=0x1 addr=0x1 pc=0x8097025]</p>\n</blockquote>\n"}, {"tags": ["json", "go", "decode"], "answers": [{"comments": [{"owner": {"reputation": 78, "user_id": 2714220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9ce22312f1bfb76154a140c5d6f2126?s=128&d=identicon&r=PG&f=1", "display_name": "Mariodiar", "link": "https://stackoverflow.com/users/2714220/mariodiar"}, "edited": false, "score": 0, "creation_date": 1449332651, "post_id": 34104185, "comment_id": 55965469, "body": "Thanks! I will try it out. And yes i dont know what the reddit devs were thinking when generating that Json."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 3, "last_activity_date": 1449314092, "creation_date": 1449314092, "answer_id": 34104185, "question_id": 34103157, "link": "https://stackoverflow.com/questions/34103157/golang-unmarshal-json-that-starts-as-an-array/34104185#34104185", "title": "Golang unmarshal json that starts as an array", "body": "<p>The json data you are unmarshaling does not conform with your data, and if the names of the fields are not like in your struct, you should use struct tags as well. It should be more like this:</p>\n\n<pre><code>type Response []struct {\n        Kind string `json:\"kind\"`\n        Data struct {\n            Children []struct {\n                Data struct {\n                    Replies []struct {\n                       // whatever...\n                    } `json:\"replies\"`\n                } `json:\"data\"`\n            } `json:\"children\"`\n        } `json:\"data\"`\n    }\n}\n</code></pre>\n\n<p>Of course I'd replace the inline types with real, named types, but I'm just making a point here in regards to the data hierarchy.</p>\n\n<p>Goddamn, that's some ugly bloated JSON BTW.</p>\n"}, {"comments": [{"owner": {"reputation": 528, "user_id": 2986873, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/f8f097306d3eb502769d4b4d2557d47a?s=128&d=identicon&r=PG", "display_name": "jwanglof", "link": "https://stackoverflow.com/users/2986873/jwanglof"}, "edited": false, "score": 0, "creation_date": 1605779300, "post_id": 34111168, "comment_id": 114758599, "body": "Holy cow, this website is awesome. Thank you so much for sharing!"}], "tags": [], "owner": {"reputation": 88, "user_id": 2477534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b016a639f94c25aa1fdfd025e3449839?s=128&d=identicon&r=PG", "display_name": "pierre.zemb", "link": "https://stackoverflow.com/users/2477534/pierre-zemb"}, "is_accepted": false, "score": 7, "last_activity_date": 1449351281, "creation_date": 1449351281, "answer_id": 34111168, "question_id": 34103157, "link": "https://stackoverflow.com/questions/34103157/golang-unmarshal-json-that-starts-as-an-array/34111168#34111168", "title": "Golang unmarshal json that starts as an array", "body": "<p>For everyone that is struggling to create the right structure for JSON unmarshalling, here's a cool website that convert any JSON to the right Go struct: <a href=\"https://mholt.github.io/json-to-go/\" rel=\"noreferrer\">JSON-to-Go</a></p>\n"}], "owner": {"reputation": 78, "user_id": 2714220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b9ce22312f1bfb76154a140c5d6f2126?s=128&d=identicon&r=PG&f=1", "display_name": "Mariodiar", "link": "https://stackoverflow.com/users/2714220/mariodiar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 609, "favorite_count": 1, "accepted_answer_id": 34104185, "answer_count": 2, "score": 1, "last_activity_date": 1449351281, "creation_date": 1449306537, "question_id": 34103157, "link": "https://stackoverflow.com/questions/34103157/golang-unmarshal-json-that-starts-as-an-array", "title": "Golang unmarshal json that starts as an array", "body": "<p>I'm trying to unmarshal this json <a href=\"https://www.reddit.com/r/videos/comments/3vgdsb/recruitment_2016.json\" rel=\"nofollow\">https://www.reddit.com/r/videos/comments/3vgdsb/recruitment_2016.json</a></p>\n\n<p>It starts as an array of two different objects, and I only need data on the second object.</p>\n\n<p>I want to retrieve the comments body, it doesn't give me any error when i'm trying to decode it, but it doesn't capture the data I want. </p>\n\n<p>This is the output I get from running this:</p>\n\n<pre><code>//Response struct when initialized: []\n//Response struct decoded: [{{{[]}}} {{{[]}}}]\n</code></pre>\n\n<p>////</p>\n\n<pre><code>type Response []struct {\n    Parent struct {\n        Data struct {\n            Children []struct {\n                Com Comment\n            }\n        }\n    }\n}\n\ntype Comment struct {\n    Name string `json:\"body\"`\n}\n\nfunc init() {\n    http.HandleFunc(\"/api/getcomments\", getComments)\n}\n\nfunc getComments(w http.ResponseWriter, r *http.Request) {\n\n    url := \"https://www.reddit.com/r/videos/comments/3vgdsb/recruitment_2016.json\"\n    c := appengine.NewContext(r)\n    client := urlfetch.Client(c)\n    resp, err := client.Get(url)\n    if err != nil { fmt.Fprint(w, \"Error client.Get(): \", err) }\n\n    re := new(Response)\n    fmt.Fprint(w, \"Response struct: \", re, \"\\n\")\n\n    errTwo := json.NewDecoder(resp.Body).Decode(&amp;re)\n    if errTwo != nil {  fmt.Fprint(w, \"Error decoding: \", errTwo, \"\\n\") }\n\n    fmt.Fprint(w, \"Response struct: \", re)\n}\n</code></pre>\n"}, {"tags": ["arrays", "multidimensional-array", "go", "append", "slice"], "answers": [{"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 1, "last_activity_date": 1449307157, "creation_date": 1449307157, "answer_id": 34103232, "question_id": 34102704, "link": "https://stackoverflow.com/questions/34102704/golang-how-to-delete-an-element-from-a-2d-slice/34103232#34103232", "title": "GoLang: How to delete an element from a 2D slice?", "body": "<p>Here is one of the possible approaches <kbd><a href=\"https://play.golang.org/p/4XX5G5Ttny\" rel=\"nofollow\">Go Playground</a></kbd>.</p>\n\n<pre><code>b := [][]int{\n    []int{1, 2, 3, 4},\n    []int{5, 6, 7, 8},\n    []int{9, 0, -1, -2},\n    []int{-3, -4, -5, -6},\n}\nprint2D(b)\ni, j := 2, 2\n\n\ntmp := append(b[i][:j], b[i][j+1:]...)\nc := append(b[:i], tmp)\nc = append(c, b[i+1:]...)\nprint2D(c)\n</code></pre>\n\n<p>Basically I am extracting the <code>i-th</code> row, remove the element from it <code>append(b[i][:j], b[i][j+1:]...)</code> and then put this row between the rows.</p>\n\n<p>If someone would tell how to append many elements, it would look even nicer.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1602934679, "last_edit_date": 1602934679, "creation_date": 1449318184, "answer_id": 34104841, "question_id": 34102704, "link": "https://stackoverflow.com/questions/34102704/golang-how-to-delete-an-element-from-a-2d-slice/34104841#34104841", "title": "GoLang: How to delete an element from a 2D slice?", "body": "<p>A 2D slice in Go is nothing more than a slice of slices. So if you want to remove an element from this 2D slice, effectively you still only have to remove an element from a slice (which is an element of another slice).</p>\n<p>There is nothing more involved. Only thing you have to look out is that when you remove an element from the row-slice, the result will only be the &quot;new&quot; value of the row (an element) of the &quot;outer&quot; slice, and not the 2D slice itself. So you have to assign the result to an element of the outer slice, to the row whose element you just removed:</p>\n<pre><code>// Remove element at the ith row and jth column:\ns[i] = append(s[i][:j], s[i][j+1:]...)\n</code></pre>\n<p>Note that this is identical to the simple &quot;removal from slice&quot; if we substitute <code>s[i]</code> with <code>a</code> (not surprisingly, because <code>s[i]</code> denotes the &quot;row-slice&quot; whose <code>jth</code> element we're removing):</p>\n<pre><code>a = append(a[:j], a[j+1:]...)\n</code></pre>\n<p>See this complete example:</p>\n<pre><code>s := [][]int{\n    {0, 1, 2, 3},\n    {4, 5, 6, 7},\n    {8, 9, 10, 11},\n}\n\nfmt.Println(s)\n\n// Delete element s[1][2] (which is 6)\ni, j := 1, 2\ns[i] = append(s[i][:j], s[i][j+1:]...)\n\nfmt.Println(s)\n</code></pre>\n<p>Output (try it on the <a href=\"http://play.golang.org/p/ooeqs2P3Gn\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n<pre><code>[[0 1 2 3] [4 5 6 7] [8 9 10 11]]\n[[0 1 2 3] [4 5 7] [8 9 10 11]]\n</code></pre>\n"}], "owner": {"reputation": 1055, "user_id": 3326720, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/SeWCu.png?s=128&g=1", "display_name": "Orange Receptacle", "link": "https://stackoverflow.com/users/3326720/orange-receptacle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2083, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1602934679, "creation_date": 1449302688, "last_edit_date": 1449305815, "question_id": 34102704, "link": "https://stackoverflow.com/questions/34102704/golang-how-to-delete-an-element-from-a-2d-slice", "title": "GoLang: How to delete an element from a 2D slice?", "body": "<p>I've recently been messing around with Go and I wanted to see how it would be to delete an element from a two-dimensional slice.</p>\n\n<p>For deleting an element from a one-dimensional slice, I can successfully use:</p>\n\n<pre><code>data = append(data[:i], data[i+1:]...)\n</code></pre>\n\n<p>However, with a two-dimensional slice, using:</p>\n\n<pre><code>data = append(data[i][:j], data[i][j+1:]...)\n</code></pre>\n\n<p>throws the error:</p>\n\n<pre><code>cannot use append(data[i][:j], data[i][j+1:]...) (type []string) as type [][]string in assignment\n</code></pre>\n\n<p>Would tackling this require a different approach?</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1449292333, "post_id": 34101475, "comment_id": 55954867, "body": "OP explicitly said he knows he can use a <code>sync.WaitGroup</code> but is looking for an alternative using channels so you haven&#39;t really answered his question at all."}, {"owner": {"reputation": 16582, "user_id": 864236, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/cf2143f14e4018a342ce93aa0fad00c6?s=128&d=identicon&r=PG", "display_name": "mjibson", "link": "https://stackoverflow.com/users/864236/mjibson"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1449292392, "post_id": 34101475, "comment_id": 55954887, "body": "See the second paragraph of my answer were I give him such an alternative. I referenced <code>sync.WaitGroup</code> because it is the better solution, regardless of if he wants to use it or not."}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1449292490, "post_id": 34101475, "comment_id": 55954903, "body": "@mjibson The only reason I don&#39;t want to use <code>sync.WaitGroup</code> is because I have a few nested database loops I&#39;m going to end up having so I can get all relational database things, so I don&#39;t want <code>wg.Add(1)</code> and <code>wg.Done()</code> all over the place nested 15 times I thought channels were supposed to be a better solution"}, {"owner": {"reputation": 16582, "user_id": 864236, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/cf2143f14e4018a342ce93aa0fad00c6?s=128&d=identicon&r=PG", "display_name": "mjibson", "link": "https://stackoverflow.com/users/864236/mjibson"}, "edited": false, "score": 0, "creation_date": 1449292608, "post_id": 34101475, "comment_id": 55954919, "body": "In either case I think you&#39;ll have to pass down a reference to either the channel or the wait group. Both of them equate to &quot;run a function that tells something else to decrement the number of things it&#39;s waiting for&quot;."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1449292720, "post_id": 34101475, "comment_id": 55954933, "body": "Yeah good point. I think channels can work better than <code>WaitGroup</code> in scenarios like Datsik describes. However I need to think more to apply it here. The suggest mjibson made is alright, but it&#39;s relying on simple arithmetic to know it&#39;s done... I did an implementation more like you describe with a tree or lists of lists passing channels into every goroutine and then waiting for them to finish or be shutdown/aborted in a select nested in a for loop. I could possibly provide some kind of example but it&#39;s not gonna be right now."}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1449293057, "post_id": 34101475, "comment_id": 55954984, "body": "@mjibson Sorry I left out 2 lines in the code, I added another channel to better describe what I was attempting to do"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1449293067, "post_id": 34101475, "comment_id": 55954986, "body": "In either case the code gets complicated quickly. If you&#39;re doing serious work in these goroutines, you&#39;ll probably have to add an abort channel after finding that you can shut down your program. You have to have the data out channel so you have at least two now. The func run in a goroutine now needs a select so it can receive it&#39;s abort signal while sending on the out channel -- After thinking a little more I believe I allocated a slice of channels so they were paired 1 to 1 with the goroutines and ranged over that collection waiting for the goroutine to close or signal on another channel."}], "tags": [], "owner": {"reputation": 16582, "user_id": 864236, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/cf2143f14e4018a342ce93aa0fad00c6?s=128&d=identicon&r=PG", "display_name": "mjibson", "link": "https://stackoverflow.com/users/864236/mjibson"}, "is_accepted": false, "score": 3, "last_activity_date": 1449291588, "creation_date": 1449291588, "answer_id": 34101475, "question_id": 34101421, "link": "https://stackoverflow.com/questions/34101421/how-can-i-use-channels-to-know-when-all-goroutines-started-by-a-loop-are-complet/34101475#34101475", "title": "How can I use channels to know when all goroutines started by a loop are completed", "body": "<p>Using <code>sync.WaitGroup</code> is a great solution, and the one usually used.</p>\n\n<p>Alternatively, you can receive on <code>mainthreadsFetched</code> <code>len(containers)</code> times, instead of just 1. That will guarantee that all go routines have completed. You'll need to move the send line to the end of the go routine (or, better, into a defer).</p>\n\n<p>Also, since <code>containerid</code> is in the for loop, its value changes. You need to pass it as a parameter to the go routine closure.</p>\n"}, {"tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": false, "score": 0, "last_activity_date": 1449373081, "creation_date": 1449373081, "answer_id": 34113736, "question_id": 34101421, "link": "https://stackoverflow.com/questions/34101421/how-can-i-use-channels-to-know-when-all-goroutines-started-by-a-loop-are-complet/34113736#34113736", "title": "How can I use channels to know when all goroutines started by a loop are completed", "body": "<p>So the best way I could come up with doing this is to use <code>sync.WaitGroup</code> and do something like this:</p>\n\n<pre><code>var wg sync.WaitGroup\nvar mainThreadFetched = make(chan MainThread)\nfor containerid := range containers {\n    wg.Add(1)\n    go func(containerid int64) {\n        rows, err := db.Query(\"SELECT thread_id, belongs_to, thread_name, access_level FROM forum_mainthread WHERE belongs_to = ?\", containerid)\n        defer rows.Close()\n        if err != nil {\n            log.Println(err)\n        }\n        for rows.Next() {\n            mainthread := MainThread{}\n            err := rows.Scan(&amp;mainthread.MainThreadID, &amp;mainthread.BelongsTo, &amp;mainthread.ThreadName, &amp;mainthread.AccessLevel)\n            if err != nil {\n                log.Println(err)\n            }\n            mainThreadFetched &lt;- mainthread\n        }\n        wg.Done()\n    }(containerid)\n}\n\ngo func() {\n    wg.Wait()\n    close(mainThreadFetched)\n}()\n\nfor mainthread := range mainThreadFetched {\n    containers[mainthread.BelongsTo].MainThreads = append(containers[mainthread.BelongsTo].MainThreads, mainthread)\n}\n\n// Do other stuff\n</code></pre>\n\n<p>Now I can read from the <code>mainThreadFetched</code> channel and then when the <code>WaitGroup</code> is satisfied it will close the channel allowing the loop to end and continue on</p>\n"}, {"tags": [], "owner": {"reputation": 14588, "user_id": 244393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55eb813499c0cf9fd47e95690782bf83?s=128&d=identicon&r=PG", "display_name": "Crast", "link": "https://stackoverflow.com/users/244393/crast"}, "is_accepted": false, "score": 0, "last_activity_date": 1449376057, "creation_date": 1449376057, "answer_id": 34114040, "question_id": 34101421, "link": "https://stackoverflow.com/questions/34101421/how-can-i-use-channels-to-know-when-all-goroutines-started-by-a-loop-are-complet/34114040#34114040", "title": "How can I use channels to know when all goroutines started by a loop are completed", "body": "<p>I don't see where you are reading mainthreads. If it's not a buffered channel, you would need to solve that some way or another. I'm going to provide a few solutions for solving it - None are more \"correct\" than the other - it just depends on your needs.</p>\n\n<p><strong>Variant A</strong>\nThis is the simplest solution but it presumes you have some other goroutine reading mainthreads (which may already be the case)</p>\n\n<pre><code>var mainthreads = make(chan *mainthread)\nvar mainthreadsFetched = make(chan struct{})\ngo somethingWhichReadsMainThreads()\nfor containerid := range containers {\n    go func(containerid int) {\n        // build query omitted for brevity\n        for rows.Next() {\n            // omitted for brevity\n            mainthreads &lt;- mainthread\n        }\n        mainthreadsFetched &lt;- struct{}{}\n    }(containerid)\n}\n\nfor i := 0; i &lt; len(containers); i++ {\n    &lt;-mainThreadsFetched\n}\nclose(mainthreads)\n// Do other stuff after complete\n</code></pre>\n\n<hr>\n\n<p><strong>Variant B</strong>\nThis one uses the <a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"nofollow\">select</a> statement to deal with reading the threads separate from the completion notifications without needing yet another goroutine.</p>\n\n<pre><code>var mainthreads = make(chan *mainthread)\nvar mainthreadsFetched = make(chan struct{})\nfor containerid := range containers {\n    go func(containerid int) {\n        // build query omitted for brevity\n        for rows.Next() {\n            // omitted for brevity\n            mainthreads &lt;- mainthread\n        }\n        mainthreadsFetched &lt;- struct{}{}\n    }(containerid)\n}\n\nnumComplete := 0\nreadRunning := true\nfor readRunning {\n    select {\n    case thread := &lt;-mainthreads:\n        // do something with thread, like threads = append(threads, thread)\n    case &lt;-mainthreadsFetched:\n        numFetched++\n        if numFetched == len(containers) {\n            readRunning = False\n        }\n    }\n}\n// Do other stuff after complete\n</code></pre>\n\n<hr>\n\n<p><strong>Variant C</strong>\nThis one uses the fact that you aren't using the 'zero value' (nil) for passing real data, so you can use that as a signal value instead of a separate struct channel. It has the advantage that it is far less code, but it does feel like spooky action at a distance.</p>\n\n<pre><code>var mainthreads = make(chan *mainthread)\nfor containerid := range containers {\n    go func(containerid int) {\n        // build query omitted for brevity\n        for rows.Next() {\n            // omitted Scan for brevity\n            mainthreads &lt;- mainthread\n        }\n        mainthreads &lt;- nil // nil signals to us we are done\n    }(containerid)\n}\n\nnumComplete := 0\nfor thread := range mainthreads {\n    if thread != nil {\n        // do something with thread, like threads = append(threads, thread)\n    } else {\n        numFetched++\n        if numFetched == len(containers) {\n            break\n        }\n    }\n}\n// Do other stuff after complete\n</code></pre>\n"}], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1449376057, "creation_date": 1449291090, "last_edit_date": 1449373005, "question_id": 34101421, "link": "https://stackoverflow.com/questions/34101421/how-can-i-use-channels-to-know-when-all-goroutines-started-by-a-loop-are-complet", "title": "How can I use channels to know when all goroutines started by a loop are completed", "body": "<p>I'm currently trying to <code>range</code> over a <code>map</code> to do concurrent database requests rather than synchronously, obviously because of the speed boost.</p>\n\n<p>My problem is I have something like this:</p>\n\n<pre><code>var mainthreads = make(chan *mainthread)\nvar mainthreadsFetched = make(chan struct{})\nfor containerid := range containers {\n    go func() {\n        rows, err := db.Query(\"SELECT thread_id, belongs_to, thread_name, access_level FROM forum_mainthread WHERE belongs_to = ?\", containerid)\n        defer rows.Close()\n        if err != nil {\n            log.Println(err)\n        }\n        for rows.Next() {\n            mainthread := &amp;MainThread{}\n            err := rows.Scan(&amp;mainthread.MainThreadID, &amp;mainthread.BelongsTo, &amp;mainthread.ThreadName, &amp;mainthread.AccessLevel)\n            if err != nil {\n                log.Println(err)\n            }\n            mainthreads &lt;- mainthread\n        }\n    }()\n    mainthreadsFetched &lt;- struct{}{}\n}\n\n// Get all mainthreads\n&lt;-mainthreadsFetched\n// Do other stuff after complete\n</code></pre>\n\n<p>Obviously <code>mainthreadsFetched &lt;- struct{}{}</code> is being called almost instantly because the loop finishes faster than you can blink, how can I create a new channel per loop that will not block each new <code>goroutine</code> from starting, but rather let the loop start all <code>goroutines</code> and then send out on a channel when every <code>goroutine</code> is done.</p>\n"}, {"tags": ["go", "package"], "comments": [{"owner": {"reputation": 1183, "user_id": 2959387, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459784500061e41da68ed5af11f92183?s=128&d=identicon&r=PG&f=1", "display_name": "Prashant Thakkar", "link": "https://stackoverflow.com/users/2959387/prashant-thakkar"}, "edited": false, "score": 0, "creation_date": 1449291119, "post_id": 34101360, "comment_id": 55954653, "body": "Go, is based on &quot;has a&quot; relationship, hence when using users in main, fmt package from users is not available to main and need to be imported explicitly in main."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1449324443, "post_id": 34101360, "comment_id": 55962957, "body": "You shouldn&#39;t use relative import paths if you want the standard build tools to work with your project."}], "answers": [{"tags": [], "owner": {"reputation": 3262, "user_id": 5273921, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kvzQp.jpg?s=128&g=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/5273921/mike"}, "is_accepted": false, "score": 3, "last_activity_date": 1449296882, "last_edit_date": 1449296882, "creation_date": 1449296161, "answer_id": 34101940, "question_id": 34101360, "link": "https://stackoverflow.com/questions/34101360/golang-import-package-inside-package/34101940#34101940", "title": "Golang import package inside package", "body": "<p>You need to import <code>fmt</code> in <code>main</code> as well.</p>\n\n<p>Simply write <code>\"fmt\"</code> in <code>import()</code> in <code>main.go</code> and it should run.</p>\n\n<pre><code>import(    \n    \"fmt\"  \n    \"./users\"\n)\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 5641897, "user_type": "registered", "profile_image": "https://graph.facebook.com/830299570412588/picture?type=large", "display_name": "Baiyu Liu", "link": "https://stackoverflow.com/users/5641897/baiyu-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1480, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1449296882, "creation_date": 1449290528, "question_id": 34101360, "link": "https://stackoverflow.com/questions/34101360/golang-import-package-inside-package", "title": "Golang import package inside package", "body": "<p>Go structure:</p>\n\n<pre><code>|--main.go\n|\n|--users\n     |\n     |---users.go\n</code></pre>\n\n<p>The two files are very simple:\nmain.go:</p>\n\n<pre><code>package main\n\nimport \"./users\"\n\nfunc main() {\n    resp := users.GetUser(\"abcde\")\n    fmt.Println(resp)\n}\n</code></pre>\n\n<p>users.go:</p>\n\n<pre><code>package users\n\nimport \"fmt\"\n\nfunc GetUser(userTok string) string {\n    fmt.Sprint(\"sf\")\n    return \"abcde\"\n}\n</code></pre>\n\n<p>But it seems fmt is not accessible in main.go. When I try to run the program, it gives</p>\n\n<pre><code>undefined: fmt in fmt.Println\n</code></pre>\n\n<p>Anybody knows how to make fmt accessible in main.go?</p>\n"}, {"tags": ["go", "github-api"], "answers": [{"comments": [{"owner": {"reputation": 1585, "user_id": 853038, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a9773c9d75baea0919e4412aeb4c89f8?s=128&d=identicon&r=PG", "display_name": "Enze Chi", "link": "https://stackoverflow.com/users/853038/enze-chi"}, "edited": false, "score": 0, "creation_date": 1449294260, "post_id": 34101405, "comment_id": 55955174, "body": "Thanks for your reply and it confirm it is not something wrong in my code(kind of). I tried the <code>golang&#47;go&#47;tags</code>, it returns tags like <code>weekly.*</code>. I think Github should do something to make sure the release created is compliance with their own API"}, {"owner": {"reputation": 980, "user_id": 1716704, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/S8zFC.png?s=128&g=1", "display_name": "Kalin Borisov", "link": "https://stackoverflow.com/users/1716704/kalin-borisov"}, "edited": false, "score": 1, "creation_date": 1540390939, "post_id": 34101405, "comment_id": 92849117, "body": "In bash maybe that could help to get at least latest version <code>wget -qO- https:&#47;&#47;github.com&#47;golang&#47;go&#47;tags|sed -e &#39;s&#47;&lt;[^&gt;]*&gt;&#47;&#47;g&#39;|sed &#39;&#47;^\\s*$&#47;d&#39;| grep release-branch|awk &#39;{ print $2 }&#39;|grep -v runtime|sort -V|tail -1</code>"}], "tags": [], "owner": {"reputation": 599, "user_id": 4327041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ZbnQ.jpg?s=128&g=1", "display_name": "abm", "link": "https://stackoverflow.com/users/4327041/abm"}, "is_accepted": false, "score": 2, "last_activity_date": 1449291815, "last_edit_date": 1449291815, "creation_date": 1449290935, "answer_id": 34101405, "question_id": 34100738, "link": "https://stackoverflow.com/questions/34100738/how-to-get-releases-for-golang-go-with-go-github/34101405#34101405", "title": "How to get releases for golang/go with go-github", "body": "<h2><strong>Edit:</strong></h2>\n\n<p>Taking a closer look at the Go repository, the releases are actually just tags and not Github releases, that's why it's returning an empty array. Try this:</p>\n\n<pre><code>// https://api.github.com/repos/jp9000/obs-studio/releases\nreleases, rsp, err := client.Repositories.ListReleases(\"jp9000\", \"obs-studio\", opt)\n</code></pre>\n\n<p>This should correctly return all releases for jp9000's obs-studio repository.</p>\n\n<p><strong>Original Answer:</strong></p>\n\n<p>Looking at the docs, the code looks good but this might be an issue with Github's API though. For instance, if you go to <a href=\"https://api.github.com/repos/golang/go/releases\" rel=\"nofollow\">https://api.github.com/repos/golang/go/releases</a> you get an empty array, but if you search for the tags using <a href=\"https://api.github.com/repos/golang/go/tags\" rel=\"nofollow\">https://api.github.com/repos/golang/go/tags</a> it lists all tasks without any problem.</p>\n\n<p>And if you go to <a href=\"https://api.github.com/repos/golang/go/releases/1\" rel=\"nofollow\">https://api.github.com/repos/golang/go/releases/1</a> you get a 404. I took these addresses from the Github Developer's page: <a href=\"https://developer.github.com/v3/repos/releases/#list-releases-for-a-repository\" rel=\"nofollow\">https://developer.github.com/v3/repos/releases/#list-releases-for-a-repository</a></p>\n"}], "owner": {"reputation": 1585, "user_id": 853038, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a9773c9d75baea0919e4412aeb4c89f8?s=128&d=identicon&r=PG", "display_name": "Enze Chi", "link": "https://stackoverflow.com/users/853038/enze-chi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 623, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1449291815, "creation_date": 1449284193, "question_id": 34100738, "link": "https://stackoverflow.com/questions/34100738/how-to-get-releases-for-golang-go-with-go-github", "title": "How to get releases for golang/go with go-github", "body": "<p>Learning Go and try to get the release list of golang/go with go-github.</p>\n\n<p>Here is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/google/go-github/github\"\n    \"fmt\"\n)\n\n\nfunc main() {\n    client := github.NewClient(nil)\n\n    opt := &amp;github.ListOptions{Page: 2, PerPage: 10}\n    releases, rsp, err := client.Repositories.ListReleases(\"golang\", \"go\", opt)\n\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Printf(\"\\n%+v\\n\", releases)\n    fmt.Printf(\"\\n%+v\\n\", rsp)\n\n}\n</code></pre>\n\n<p>When I run it, the release list is empty (as below):</p>\n\n<pre><code>[]\n\ngithub.Rate{Limit:60, Remaining:59, Reset:github.Timestamp{2015-12-05 14:47:55 +1100 AEDT}}\n</code></pre>\n\n<p>I don't know what I am doing wrong.</p>\n"}, {"tags": ["function", "go", "field", "accessor"], "answers": [{"comments": [{"owner": {"reputation": 8200, "user_id": 79202, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/397f829eea921e02e35c37c22f9e6d3b?s=128&d=identicon&r=PG", "display_name": "theory", "link": "https://stackoverflow.com/users/79202/theory"}, "edited": false, "score": 0, "creation_date": 1449276467, "post_id": 34099885, "comment_id": 55951825, "body": "Ah-ha. And here I thought that value-based &quot;objects&quot; were do-able. Fine that they&#39;re not, they make more sense as pointers, anyway."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 8200, "user_id": 79202, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/397f829eea921e02e35c37c22f9e6d3b?s=128&d=identicon&r=PG", "display_name": "theory", "link": "https://stackoverflow.com/users/79202/theory"}, "edited": false, "score": 0, "creation_date": 1449276548, "post_id": 34099885, "comment_id": 55951841, "body": "@theory yep. This seems to be the biggest gotcha I&#39;ve seen for people learning Go. I would pretty much always avoid a value type receiver unless I want my object to be immutable."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 3, "creation_date": 1449276626, "post_id": 34099885, "comment_id": 55951859, "body": "N.B. that instantiating as a pointer is unnecessary. <code>foo := Foo{...}</code> works as well. The important part is to use a pointer receiver."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 3, "creation_date": 1449276759, "post_id": 34099885, "comment_id": 55951891, "body": "Just remember that methods that change state must receive pointers. If it doesn&#39;t change state, it&#39;s more clear to receive values."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 5, "last_activity_date": 1449296568, "last_edit_date": 1449296568, "creation_date": 1449276306, "answer_id": 34099885, "question_id": 34099860, "link": "https://stackoverflow.com/questions/34099860/why-doesnt-a-go-function-field-setter-retain-the-function/34099885#34099885", "title": "Why Doesn&#39;t a Go Function Field Setter Retain the Function?", "body": "<p>In Go, the item on the left of the function name is the receiving type. This is the type from which a function can be called. However, receiver can be both pointers or value types. In this case, it is a value. The receiver is purely for the purpose of organization, under the covers, it is passed to the function like any other argument. You're passing by value so a copy of <code>foo</code> is passed into <code>SetDoer</code>, the value is modified, then the setter returns, the value goes out of scope and in the calling scope you're working with the original.</p>\n\n<p>Try this;</p>\n\n<pre><code>// make the receiver a pointer\nfunc (f *Foo) SetDoer(doer func()) {\n    f.doer = doer\n}\n// instantiate as pointer\nfoo := &amp;Foo{func() { fmt.Println(\"original\") }}\nfoo.SetDoer(func() { fmt.Println(\"replacement\") })\n// now the version of doer on foo has been updated.\n</code></pre>\n\n<p>playground example; <a href=\"https://play.golang.org/p/ZQlvKiluu3\" rel=\"nofollow\">https://play.golang.org/p/ZQlvKiluu3</a></p>\n"}], "owner": {"reputation": 8200, "user_id": 79202, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/397f829eea921e02e35c37c22f9e6d3b?s=128&d=identicon&r=PG", "display_name": "theory", "link": "https://stackoverflow.com/users/79202/theory"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 34099885, "answer_count": 1, "score": 2, "last_activity_date": 1449296568, "creation_date": 1449276180, "question_id": 34099860, "link": "https://stackoverflow.com/questions/34099860/why-doesnt-a-go-function-field-setter-retain-the-function", "title": "Why Doesn&#39;t a Go Function Field Setter Retain the Function?", "body": "<p>Given this short program:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Foo struct {\n    doer func()\n}\n\nfunc (f Foo) SetDoer(doer func()) {\n    f.doer = doer\n}\n\nfunc main() {\n    foo := Foo{func() { fmt.Println(\"original\") }}\n    foo.doer()\n    foo.SetDoer(func() { fmt.Println(\"replacement\") })\n    foo.doer()\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>original\noriginal\n</code></pre>\n\n<p>I had expected it to be:</p>\n\n<pre><code>original\nreplacement\n</code></pre>\n\n<p>Why isn't it? Note that the output is as expected if I set <code>foo.doer</code> directly in <code>main()</code>. Just not if I use the <code>SetDoer</code> method.</p>\n"}, {"tags": ["go", "reflection", "go-reflect"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 7, "last_activity_date": 1449272890, "last_edit_date": 1449272890, "creation_date": 1449271029, "answer_id": 34099099, "question_id": 34098936, "link": "https://stackoverflow.com/questions/34098936/how-to-i-convert-reflect-news-return-value-back-to-the-original-type/34099099#34099099", "title": "How to I convert reflect.New&#39;s return value back to the original type", "body": "<p>You use the <a href=\"https://golang.org/pkg/reflect/#Value.Interface\" rel=\"nofollow\"><code>Value.Interface</code></a> method to get an <code>interface{}</code>, then you can use a type assertion to extract value:</p>\n\n<pre><code>t := reflect.TypeOf(Foo{})\nval := reflect.New(t)\nnewT := val.Interface().(*Foo)\n</code></pre>\n\n<p>If you don't want a pointer, you use the <a href=\"https://golang.org/pkg/reflect/#Zero\" rel=\"nofollow\"><code>reflect.Zero</code></a> function to create a zero-value for the type. You then use the same interface and type assertion method to extract the new value.</p>\n\n<pre><code>t := reflect.TypeOf(Foo{})\nf := reflect.Zero(t)\nnewF := f.Interface().(Foo)\n</code></pre>\n"}], "owner": {"reputation": 8149, "user_id": 616644, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wVwGC.png?s=128&g=1", "display_name": "Rick Smith", "link": "https://stackoverflow.com/users/616644/rick-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 931, "favorite_count": 0, "accepted_answer_id": 34099099, "answer_count": 1, "score": 2, "last_activity_date": 1471850381, "creation_date": 1449270101, "last_edit_date": 1471850381, "question_id": 34098936, "link": "https://stackoverflow.com/questions/34098936/how-to-i-convert-reflect-news-return-value-back-to-the-original-type", "title": "How to I convert reflect.New&#39;s return value back to the original type", "body": "<p>I'm using reflection in <code>go</code> and I noticed the oddity expressed below:</p>\n\n<pre><code>package main\n\nimport (\n        \"log\"\n        \"reflect\"\n)\n\ntype Foo struct {\n        a int\n        b int\n}\n\nfunc main() {\n        t := reflect.TypeOf(Foo{})\n        log.Println(t) // main.Foo\n        log.Println(reflect.TypeOf(reflect.New(t))) // reflect.Value not main.Foo\n}\n</code></pre>\n\n<p>How can I convert the <code>reflect.Value</code> back to <code>main.Foo</code>?</p>\n\n<p>I've provided a <a href=\"https://play.golang.org/p/qUcYpnP5iB\" rel=\"nofollow\">go playground</a> for convenience.</p>\n"}, {"tags": ["go", "command-line-interface"], "comments": [{"owner": {"reputation": 5298, "user_id": 12606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1086eadc88de1e47fbffca9a73fd82?s=128&d=identicon&r=PG", "display_name": "Stuart Carnie", "link": "https://stackoverflow.com/users/12606/stuart-carnie"}, "edited": false, "score": 0, "creation_date": 1449259099, "post_id": 34095768, "comment_id": 55945146, "body": "I suspect it is a buffering issue. Are you writing to Stdout and how are you capturing the output to verify it in the test?"}, {"owner": {"reputation": 5041, "user_id": 4288305, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-SabTTMIHSb8/AAAAAAAAAAI/AAAAAAAAAjQ/EmdFmLWi2MY/photo.jpg?sz=128", "display_name": "Integralist", "link": "https://stackoverflow.com/users/4288305/integralist"}, "reply_to_user": {"reputation": 5298, "user_id": 12606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1086eadc88de1e47fbffca9a73fd82?s=128&d=identicon&r=PG", "display_name": "Stuart Carnie", "link": "https://stackoverflow.com/users/12606/stuart-carnie"}, "edited": false, "score": 0, "creation_date": 1449261257, "post_id": 34095768, "comment_id": 55946042, "body": "@StuartCarnie hmm, I&#39;ve just realised that I&#39;m executing <code>output.Error</code> and that internally is calling <code>os.Exit(1)</code>. That is likely not helping"}, {"owner": {"reputation": 5041, "user_id": 4288305, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-SabTTMIHSb8/AAAAAAAAAAI/AAAAAAAAAjQ/EmdFmLWi2MY/photo.jpg?sz=128", "display_name": "Integralist", "link": "https://stackoverflow.com/users/4288305/integralist"}, "reply_to_user": {"reputation": 5298, "user_id": 12606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1086eadc88de1e47fbffca9a73fd82?s=128&d=identicon&r=PG", "display_name": "Stuart Carnie", "link": "https://stackoverflow.com/users/12606/stuart-carnie"}, "edited": false, "score": 0, "creation_date": 1449261441, "post_id": 34095768, "comment_id": 55946120, "body": "@StuartCarnie that&#39;s exactly the problem. If I comment out <code>os.Exit(1)</code> then the command will display the error (same as before) but now it shows either <code>null</code> or <code>[]</code> depending on the type of error triggered. But it does mean the <code>&#47;&#47; Output:</code> is actually failing because the output isn&#39;t quite the same (e.g. it&#39;s adding an extra line for <code>null</code> or <code>[]</code>)"}, {"owner": {"reputation": 5041, "user_id": 4288305, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-SabTTMIHSb8/AAAAAAAAAAI/AAAAAAAAAjQ/EmdFmLWi2MY/photo.jpg?sz=128", "display_name": "Integralist", "link": "https://stackoverflow.com/users/4288305/integralist"}, "reply_to_user": {"reputation": 5298, "user_id": 12606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1086eadc88de1e47fbffca9a73fd82?s=128&d=identicon&r=PG", "display_name": "Stuart Carnie", "link": "https://stackoverflow.com/users/12606/stuart-carnie"}, "edited": false, "score": 0, "creation_date": 1449261506, "post_id": 34095768, "comment_id": 55946150, "body": "So I need to figure out how to either keep <code>os.Exit(1)</code> in place and swap it out during the test with a mock OR remove it permanently and figure out how to handle the response <code>null</code> and <code>[]</code>"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1449265832, "post_id": 34095768, "comment_id": 55948161, "body": "Have your functions return errors, and only call log.Fatal or os.Exit in main(). You can then unit test your functions without having to mock anything."}, {"owner": {"reputation": 5298, "user_id": 12606, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e1086eadc88de1e47fbffca9a73fd82?s=128&d=identicon&r=PG", "display_name": "Stuart Carnie", "link": "https://stackoverflow.com/users/12606/stuart-carnie"}, "edited": false, "score": 0, "creation_date": 1449270250, "post_id": 34095768, "comment_id": 55950010, "body": "without seeing your code, I can&#39;t comment on the <code>os.Exit(1)</code> call"}], "answers": [{"tags": [], "owner": {"reputation": 5041, "user_id": 4288305, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-SabTTMIHSb8/AAAAAAAAAAI/AAAAAAAAAjQ/EmdFmLWi2MY/photo.jpg?sz=128", "display_name": "Integralist", "link": "https://stackoverflow.com/users/4288305/integralist"}, "is_accepted": true, "score": 0, "last_activity_date": 1449578869, "creation_date": 1449578869, "answer_id": 34156313, "question_id": 34095768, "link": "https://stackoverflow.com/questions/34095768/unable-to-test-a-golang-cli-tools-output/34156313#34156313", "title": "Unable to test a Golang CLI tool&#39;s output", "body": "<p>OK so the solution to this problem was part architecture and part removal/refactor of code.</p>\n\n<ol>\n<li><p>I extracted the private functions from the cli command package so they became public functions in a separate function</p></li>\n<li><p>I refactored the code so that all dependencies were injected, this then allowed me to mock these objects and verify the the expected methods were called</p></li>\n<li><p>Now the private functions are in a package and made public, I'm able to test those things specifically, outside of the cli context</p></li>\n<li><p>Finally, I removed the use of os.Exit as that was a nightmare to deal with and wasn't really necessary</p></li>\n</ol>\n"}], "owner": {"reputation": 5041, "user_id": 4288305, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-SabTTMIHSb8/AAAAAAAAAAI/AAAAAAAAAjQ/EmdFmLWi2MY/photo.jpg?sz=128", "display_name": "Integralist", "link": "https://stackoverflow.com/users/4288305/integralist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 228, "favorite_count": 0, "accepted_answer_id": 34156313, "answer_count": 1, "score": 0, "last_activity_date": 1449578869, "creation_date": 1449256319, "question_id": 34095768, "link": "https://stackoverflow.com/questions/34095768/unable-to-test-a-golang-cli-tools-output", "title": "Unable to test a Golang CLI tool&#39;s output", "body": "<p>I have a cli tool written in Go which produces the following output:</p>\n\n<pre><code>  Command: config get\n      Env: int\nComponent: foo-component\n\nUnable to find any configuration within Cosmos (http://api.foo.com) for foo-component.\n</code></pre>\n\n<p>I would like to verify this output within a test.</p>\n\n<p>The test I have written (and doesn't pass) is as follows:</p>\n\n<pre><code>package command\n\nimport (\n    \"testing\"\n\n    \"github.com/my/package/foo\"\n)\n\ntype FakeCliContext struct{}\n\nfunc (s FakeCliContext) String(name string) string {\n    return \"foobar\"\n}\n\nfunc ExampleInvalidComponentReturnsError() {\n    fakeBaseURL := \"http://api.foo.com\"\n    fakeCliContext := &amp;FakeCliContext{}\n    fakeFetchFlag := func(foo.CliContext) (map[string]string, error) {\n        return map[string]string{\n            \"env\":       \"int\",\n            \"component\": \"foo-component\",\n        }, nil\n    }\n\n    GetConfig(*fakeCliContext, fakeFetchFlag, fakeBaseURL)\n\n    // Output:\n    //   Command: config get\n    //       Env: int\n    // Component: foo-component\n    //\n    // Unable to find any configuration within Cosmos (http://api.foo.com) for foo-component.\n}\n</code></pre>\n\n<p>The majority of the code is creating fake objects that I'm injecting into my function call <code>GetConfig</code>.</p>\n\n<p>Effectively there is no return value from <code>GetConfig</code> only a side effect of text being printed to stdout.</p>\n\n<p>So I'm using the <code>Example&lt;NameOfTest&gt;</code> format to try and verify the output.</p>\n\n<p>But all I just back when I run <code>go test -v</code> is:</p>\n\n<pre><code>=== RUN   ExampleInvalidComponentReturnsError\nexit status 1\nFAIL    github.com/my/package/thing 0.418s\n</code></pre>\n\n<p>Does anyone know what I might be missing?</p>\n\n<p>I've found that if I add an additional test after the 'Example' one above, for example called <code>Test&lt;NameOfTest&gt;</code> (but consistenting of effectively the same code), then this will actually display the function's output into my stdout when running the test:</p>\n\n<pre><code>func TestInvalidComponentReturnsError(t *testing.T) {\n    fakeBaseURL := \"http://api.foo.com\"\n    fakeCliContext := &amp;FakeCliContext{}\n    fakeFetchFlag := func(utils.CliContext) (map[string]string, error) {\n        return map[string]string{\n            \"env\":       \"int\",\n            \"component\": \"foo-component\",\n        }, nil\n    }\n\n    GetConfig(*fakeCliContext, fakeFetchFlag, fakeBaseURL)\n}\n</code></pre>\n\n<p>The above example test will now show the following output when executing <code>go test -v</code>:</p>\n\n<pre><code>=== RUN   TestInvalidComponentReturnsError\n  Command: config get\n      Env: int\nComponent: foo-component\n\nUnable to find any configuration within Cosmos (http://api.foo.com) for foo-component.\nexit status 1\nFAIL    github.com/bbc/apollo/command   0.938s\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449256768, "post_id": 34095254, "comment_id": 55943965, "body": "you don&#39;t want to defer like that, since if the function returns before the cmd starts, Process will be nil, and you get another panic."}, {"owner": {"reputation": 14724, "user_id": 37141, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ee2a5efb85a0f3f18bdfd7345c1d1d98?s=128&d=identicon&r=PG", "display_name": "Slava V", "link": "https://stackoverflow.com/users/37141/slava-v"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449256803, "post_id": 34095254, "comment_id": 55943986, "body": "@JimB Thanks for the notice!"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1449256850, "post_id": 34095254, "comment_id": 55944011, "body": "Please add a <a href=\"http://www.stackoverflow.com/help/mcve\">minimal, complete and verifiable example</a>."}, {"owner": {"reputation": 14724, "user_id": 37141, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ee2a5efb85a0f3f18bdfd7345c1d1d98?s=128&d=identicon&r=PG", "display_name": "Slava V", "link": "https://stackoverflow.com/users/37141/slava-v"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1449258071, "post_id": 34095254, "comment_id": 55944675, "body": "@MarkusWMahlberg Added, thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 14724, "user_id": 37141, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ee2a5efb85a0f3f18bdfd7345c1d1d98?s=128&d=identicon&r=PG", "display_name": "Slava V", "link": "https://stackoverflow.com/users/37141/slava-v"}, "edited": false, "score": 0, "creation_date": 1449256745, "post_id": 34095869, "comment_id": 55943948, "body": "Yes, sorry, forgot to mention - I need a cross-platform solution. But, thanks!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 14724, "user_id": 37141, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ee2a5efb85a0f3f18bdfd7345c1d1d98?s=128&d=identicon&r=PG", "display_name": "Slava V", "link": "https://stackoverflow.com/users/37141/slava-v"}, "edited": false, "score": 0, "creation_date": 1449256986, "post_id": 34095869, "comment_id": 55944106, "body": "There is no cross-platform solution. An old cross-platform trick was to have a lifeline socket fd given to the child process, and have the child exit when it closes, but that requires cooperation with the child process of course."}, {"owner": {"reputation": 413, "user_id": 5483904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f81b62d6c7607ab3516c9636172d0740?s=128&d=identicon&r=PG", "display_name": "Dustin Spicuzza", "link": "https://stackoverflow.com/users/5483904/dustin-spicuzza"}, "edited": false, "score": 0, "creation_date": 1603299117, "post_id": 34095869, "comment_id": 113995434, "body": "@JimB this bit of code is necessary, but not sufficient to guarantee that the child stays around. See discussion at <a href=\"https://github.com/golang/go/issues/27505\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/27505</a>, including a full example that guarantees the child stays alive."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1449258169, "last_edit_date": 1449258169, "creation_date": 1449256697, "answer_id": 34095869, "question_id": 34095254, "link": "https://stackoverflow.com/questions/34095254/panic-in-other-goroutine-not-stopping-child-process/34095869#34095869", "title": "Panic in other goroutine not stopping child process", "body": "<p>There's no cross-platform solution to automatically kill a child process. </p>\n\n<p>On Linux, you can use the <code>pdeathsig</code> functionality:</p>\n\n<pre><code>cmd := exec.Command(\"./long-process\")\n\ncmd.SysProcAttr = &amp;syscall.SysProcAttr{\n    Pdeathsig: syscall.SIGTERM,\n}\n</code></pre>\n\n<p>On other platforms, the child needs to determine when to exit on its own. One way is to monitor a pipe or socket FD given to it from the parent. You could also have a process manager of some sort monitor the processes and cleanup if something goes wrong. </p>\n\n<p>In general though, panics should be rare and get fixed. If you do have areas of code that are prone to panic'ing, you can recover locally and call for the cleanup of child processes before exiting. </p>\n"}], "owner": {"reputation": 14724, "user_id": 37141, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/ee2a5efb85a0f3f18bdfd7345c1d1d98?s=128&d=identicon&r=PG", "display_name": "Slava V", "link": "https://stackoverflow.com/users/37141/slava-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2024, "favorite_count": 0, "accepted_answer_id": 34095869, "answer_count": 1, "score": 2, "last_activity_date": 1449261086, "creation_date": 1449254394, "last_edit_date": 1449261086, "question_id": 34095254, "link": "https://stackoverflow.com/questions/34095254/panic-in-other-goroutine-not-stopping-child-process", "title": "Panic in other goroutine not stopping child process", "body": "<p>I need to run a long-running child process and kill it if I quit (for any reason) out of parent application. </p>\n\n<p>Here is the code:</p>\n\n<pre><code>cmd := exec.Command(\"./long-process\")\n\ndefer cmd.Process.Kill()\n\nif err != nil {\n    log.Fatal(err)\n}\n\nvar fail io.ReadCloser\nfail.Close()\n</code></pre>\n\n<p>The <code>fail</code> here produces obvious</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n</code></pre>\n\n<p>It works as expected - the child process is killed.</p>\n\n<p>But this happens in a goroutine:</p>\n\n<pre><code>cmd := exec.Command(\"./long-process\")\n\ndefer cmd.Process.Kill()\n\nif err != nil {\n    log.Fatal(err)\n}\n\ngo func() {\n    var fail io.ReadCloser\n    fail.Close()\n}()\n</code></pre>\n\n<p>The panic still happens, but then it seems <code>defer</code> is not called and the child process is not killed.</p>\n\n<p>Any way to go around this? </p>\n\n<p><strong>UPDATE</strong> I need a cross-platform solution (at least for Linux and FreeBSD)</p>\n\n<p>Minimal example:</p>\n\n<p><code>infinite-loop.sh</code></p>\n\n<pre><code>#!/bin/bash\n\nwhile true; do\n  sleep 1\ndone\n</code></pre>\n\n<p>Don't forget to </p>\n\n<pre><code>chmod +x infinite-loop.sh\n</code></pre>\n\n<p><code>test1.go</code> (error checking left out for brevity):</p>\n\n<pre><code>package main\n\nimport (\n    \"time\"\n    \"io\"\n    \"os/exec\"\n    \"runtime\"\n)\n\nfunc main() {\n\n    cmd := exec.Command(\"./infinite-loop.sh\")\n\n    cmd.Start()\n\n    defer cmd.Process.Kill()\n\n    go func() {\n        time.Sleep(100 * time.Millisecond)\n        var fail io.ReadCloser\n        fail.Close()\n    }()\n\n    for {\n        runtime.Gosched()\n    }\n}\n</code></pre>\n\n<p>Let's run</p>\n\n<pre><code>ps aux | grep infinite-loop.sh | grep -v grep | wc -l; \\\ngo run test1.go; \\\nps aux | grep infinite-loop.sh | grep -v grep | wc -l\n\n\n     0 &lt;--- !!\n\n\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xb code=0x1 addr=0x20 pc=0x2130]\n\ngoroutine 5 [running]:\nmain.main.func1()\n.../multiline/test1.go:19 +0x30\ncreated by main.main\n.../multiline/test1.go:20 +0x9a\n\ngoroutine 1 [runnable]:\nruntime.Gosched()\n/usr/local/Cellar/go/1.5.1/libexec/src/runtime/proc.go:166 +0x14\nmain.main()\n.../multiline/test1.go:23 +0x9f\nexit status 2\n\n     1 &lt;--- !!\n</code></pre>\n\n<p>0 processes before and 1 after exit. </p>\n\n<p>If you comment out goroutine code - it works fine.</p>\n\n<p>Now we can kill it:</p>\n\n<pre><code>kill $(ps aux | grep infinite-loop.sh | grep -v grep | awk {'print $2'})\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449248251, "post_id": 34093333, "comment_id": 55939354, "body": "does <code>go test .&#47;...</code> work? (and what does <code>go build gopkg.in&#47;tomb.v2</code> have to do with this?)"}, {"owner": {"reputation": 397892, "user_id": 95592, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/utY5u.jpg?s=128&g=1", "display_name": "Matthew Rankin", "link": "https://stackoverflow.com/users/95592/matthew-rankin"}, "edited": false, "score": 0, "creation_date": 1449248776, "post_id": 34093333, "comment_id": 55939647, "body": "Potential duplicate of <a href=\"http://stackoverflow.com/questions/16353016/\">How to <code>go test</code> all testings in my project?</a> and <a href=\"http://stackoverflow.com/questions/19200235/\">Golang tests in sub-directory</a>."}, {"owner": {"reputation": 5728, "user_id": 2184930, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/460a48b8097cbd52e7315e349f6a84f3?s=128&d=identicon&r=PG", "display_name": "suman j", "link": "https://stackoverflow.com/users/2184930/suman-j"}, "edited": false, "score": 0, "creation_date": 1449251368, "post_id": 34093333, "comment_id": 55941110, "body": "I have no idea where gopkg.in/tomb.v2 is coming from. <code>go test .&#47;...</code> also did not work."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1449251893, "post_id": 34093333, "comment_id": 55941369, "body": "Something is trying to build &quot;gopkg.in/tomb.v2&quot;, have you tried getting that dependency?"}, {"owner": {"reputation": 5728, "user_id": 2184930, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/460a48b8097cbd52e7315e349f6a84f3?s=128&d=identicon&r=PG", "display_name": "suman j", "link": "https://stackoverflow.com/users/2184930/suman-j"}, "reply_to_user": {"reputation": 397892, "user_id": 95592, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/utY5u.jpg?s=128&g=1", "display_name": "Matthew Rankin", "link": "https://stackoverflow.com/users/95592/matthew-rankin"}, "edited": false, "score": 0, "creation_date": 1449518133, "post_id": 34093333, "comment_id": 56032119, "body": "@MatthewRankin It is not a duplicate :)"}], "answers": [{"tags": [], "owner": {"reputation": 397892, "user_id": 95592, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/utY5u.jpg?s=128&g=1", "display_name": "Matthew Rankin", "link": "https://stackoverflow.com/users/95592/matthew-rankin"}, "is_accepted": false, "score": 0, "last_activity_date": 1449248214, "creation_date": 1449248214, "answer_id": 34093528, "question_id": 34093333, "link": "https://stackoverflow.com/questions/34093333/go-build-works-but-go-test-does-not/34093528#34093528", "title": "go build works but go test does not", "body": "<p>To test all subdirectories use:</p>\n\n<pre><code>$ go test ./...\n</code></pre>\n\n<p>From the <a href=\"https://golang.org/cmd/go/#hdr-Relative_import_paths\" rel=\"nofollow\">Relative import paths</a> section of the <a href=\"https://golang.org/doc/cmd\" rel=\"nofollow\">Command go</a> documentation:</p>\n\n<blockquote>\n  <p>Relative patterns are also allowed, like <code>go test ./...</code> to test all subdirectories. See 'go help packages' for details on the pattern syntax.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 5728, "user_id": 2184930, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/460a48b8097cbd52e7315e349f6a84f3?s=128&d=identicon&r=PG", "display_name": "suman j", "link": "https://stackoverflow.com/users/2184930/suman-j"}, "is_accepted": true, "score": 0, "last_activity_date": 1449518054, "creation_date": 1449518054, "answer_id": 34142000, "question_id": 34093333, "link": "https://stackoverflow.com/questions/34093333/go-build-works-but-go-test-does-not/34142000#34142000", "title": "go build works but go test does not", "body": "<p>The problem was with the directory structure. My project source should be in <code>$GOPATH</code>. But it was inside <code>$GOPATH/src</code>.</p>\n\n<p><strong>Incorrect</strong> /user/home/go/<strong>src</strong>/github.com/my_go_proj <br>\n<strong>Correct</strong> /user/home/go/github.com/my_go_proj</p>\n"}], "owner": {"reputation": 5728, "user_id": 2184930, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/460a48b8097cbd52e7315e349f6a84f3?s=128&d=identicon&r=PG", "display_name": "suman j", "link": "https://stackoverflow.com/users/2184930/suman-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2749, "favorite_count": 0, "accepted_answer_id": 34142000, "answer_count": 2, "score": 2, "last_activity_date": 1449518054, "creation_date": 1449247662, "last_edit_date": 1449251439, "question_id": 34093333, "link": "https://stackoverflow.com/questions/34093333/go-build-works-but-go-test-does-not", "title": "go build works but go test does not", "body": "<p>Below is my project structure:</p>\n\n<pre>\n/user/home/go/src/github.com/my_go_proj\n                                       /main.go\n                                       /mypackage\n                                                 /service.go\n                                                 /service_test.go\n\nGOPATH points to /user/home/go\ncd /user/home/go/src/github.com/my_go_proj\ngo build ---> This works and creates the `my_go_proj` executable.\ngo test\n?       github.com/my_go_proj   [no test files]\ngo test github.com/my_go_proj/mypackage\ngo build gopkg.in/tomb.v2: no buildable Go source files in \nFAIL    github.com/my_go_proj/mypackage [build failed]\n\ngo test ./...\n?       github.com/my_go_proj   [no test files]\ngo build gopkg.in/tomb.v2: no buildable Go source files in \nFAIL    github.com/my_go_proj/mypackage [build failed]\n\n</pre>\n\n<p>How do I run <code>go test</code> to run the service_test.go test inside mypackage?</p>\n\n<p><strong>Update:</strong> updated the behaviour for <code>go test ./...</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449247422, "post_id": 34093038, "comment_id": 55938840, "body": "The error describes what&#39;s happening, the Dial is timing out trying to connect to the server. Have you checked that the server can actually accept more connections?"}, {"owner": {"reputation": 71, "user_id": 5613532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7fcfda0f73fa7a2fc20924a755b7356?s=128&d=identicon&r=PG&f=1", "display_name": "Tesseract", "link": "https://stackoverflow.com/users/5613532/tesseract"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449249229, "post_id": 34093038, "comment_id": 55939879, "body": "I updated the original post with more information regarding the connection usage. I have tried ss multiple time but the number of total connection do not exceed 1.5k."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449249761, "post_id": 34093038, "comment_id": 55940187, "body": "The SYN_RECV count looks strange. Either your server can&#39;t keep up with the requests, or a client is somehow not completing the TCP handshake. I&#39;m guessing the former, but I wouldn&#39;t rule out crashing clients, network problems, etc."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449250114, "post_id": 34093038, "comment_id": 55940396, "body": "BTW, you should check if <code>err != nil</code>, not the response in the client. There&#39;s no guarantee that the Body is not nil if there&#39;s an error. Also, there&#39;s no need for the <code>response.Write(nil)</code>"}, {"owner": {"reputation": 71, "user_id": 5613532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7fcfda0f73fa7a2fc20924a755b7356?s=128&d=identicon&r=PG&f=1", "display_name": "Tesseract", "link": "https://stackoverflow.com/users/5613532/tesseract"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449251519, "post_id": 34093038, "comment_id": 55941179, "body": "@JimB Thanks for the input. I actually do check for the err != nil but i didn&#39;t add it in the snipper since i wanted to highlight that body was being closed for client reuse. It definitely doesn&#39;t seem like it&#39;s the server since the resources are not maximized (the servers is using 5-10% CPU). In my test where I test the indexing aspect, I can generally get 80-90% CPU load without issues. I think it might be on the client side, so I will try to investigate bit more. Thanks!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449251662, "post_id": 34093038, "comment_id": 55941254, "body": "If it is the server&#39;s problem, load had nothing to do with it. It has to do with how fast you are accepting connections. You generally shouldn&#39;t see much if any syn backlog, as the buffer is usually very small."}, {"owner": {"reputation": 71, "user_id": 5613532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7fcfda0f73fa7a2fc20924a755b7356?s=128&d=identicon&r=PG&f=1", "display_name": "Tesseract", "link": "https://stackoverflow.com/users/5613532/tesseract"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449253116, "post_id": 34093038, "comment_id": 55942016, "body": "Thanks Jim. I&#39;m assuming you on the server the SYN_RECV value is too high right? (sorry, I&#39;m quite new to this so there is bit of a learning curve)"}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1449457776, "post_id": 34093038, "comment_id": 56000216, "body": "the backlog meaning. refer <code>http:&#47;&#47;veithen.github.io&#47;2014&#47;01&#47;01&#47;how-tcp-backlog-works-in&zwnj;&#8203;-linux.html</code>"}], "owner": {"reputation": 71, "user_id": 5613532, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7fcfda0f73fa7a2fc20924a755b7356?s=128&d=identicon&r=PG&f=1", "display_name": "Tesseract", "link": "https://stackoverflow.com/users/5613532/tesseract"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3095, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1449249071, "creation_date": 1449246831, "last_edit_date": 1449249071, "question_id": 34093038, "link": "https://stackoverflow.com/questions/34093038/dial-tcp-addrport-i-o-timeout-eof-and-connection-reset-by-peer", "title": "Dial tcp addr:port: i/o timeout, EOF, and Connection reset by peer", "body": "<p>Hi I have a simple server setup that intermittently errors out with the following errors. </p>\n\n<blockquote>\n  <ul>\n  <li>dial tcp address:port: i/o timeout</li>\n  <li>EOF</li>\n  <li>connection reset by peer</li>\n  </ul>\n</blockquote>\n\n<p>Client code: </p>\n\n<pre><code>request, err := http.NewRequest(\"POST\", \"http://someaddress/abc?key=somekey\", bytes.NewReader(value))\nif err != nil {\n    return\n}\nrequest.Header.Set(\"Content-Type\", \"application/json\")\nrequest.Header.Set(\"Content-Length\", strconv.Itoa(len(value)))\nrequest.Header.Set(\"Connection\", \"Keep-Alive\")\n\nresponse, err := client.Do(request)\nif response != nil {\n    io.Copy(ioutil.Discard, response.Body)\n    response.Body.Close()\n}\n</code></pre>\n\n<p>Server code:</p>\n\n<pre><code>func HandleMe(response http.ResponseWriter, request *http.Request) {\n    query := request.URL.Query()\n\n    key := query.Get(\"key\")\n    if key == \"\" {\n        response.Write(nil)\n        return\n    }\n\n    body, err := ioutil.ReadAll(request.Body)\n    if err != nil {\n        response.Write(nil)\n        return\n    }\n\n    index(key, string(body))\n    response.Write(nil)\n    return\n}\n</code></pre>\n\n<p>The index function basically takes the request and adds to a buffered channel and returns immediately. The channel has capacity of 100000 entries for burst loads. Even during the peak times with burst load, the channel does not have more than 500 entries. On the other side of the channel are 20 workers which do additional processing for the data before adding the processed data to database.</p>\n\n<p>Now the weird issue is that I get the 3 errors outlined above occasionally. The server processes gets around 30k requests per second at peak times. The three errors outlined above happen 2-3 times per minute, and in vast majority of the cases it's dial tcp address:port: i/o timeout issue. Does anyone happen to know what I'm doing wrong here? </p>\n\n<p>Edit: \nSome stats on that server</p>\n\n<blockquote>\n  <p>ss -s Total: 648 (kernel 0) TCP:   547 (estab 528, closed 1, orphaned\n  4, synrecv 0, timewait 0/0), ports 0</p>\n  \n  <p>Transport Total     IP        IPv6\n  *   0         -         - RAW   0         0         0 UDP   12        9         3 TCP   546       31        515 INET    558       40<br>\n  518 FRAG    0         0         0</p>\n  \n  <p>netstat -ant | awk '{print $6}' | sort | uniq -c | sort -n\n        1 established)\n        1 Foreign\n        4 LAST_ACK\n       14 LISTEN\n       24 TIME_WAIT\n      234 SYN_RECV</p>\n</blockquote>\n"}, {"tags": ["exception", "go", "exception-handling", "thrift"], "answers": [{"tags": [], "owner": {"reputation": 12067, "user_id": 499466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3cc0612ec9a2b6af96500cc6e4bfdc7c?s=128&d=identicon&r=PG", "display_name": "JensG", "link": "https://stackoverflow.com/users/499466/jensg"}, "is_accepted": false, "score": 4, "last_activity_date": 1449258229, "creation_date": 1449258229, "answer_id": 34096231, "question_id": 34091508, "link": "https://stackoverflow.com/questions/34091508/how-to-implement-golang-service-based-on-apache-thrift-with-exceptions/34096231#34096231", "title": "How to implement golang service based on Apache Thrift with exceptions?", "body": "<p>Here the <a href=\"https://thrift.apache.org/tutorial/go\" rel=\"nofollow\">Apache Thrift tutorial for Go</a> comes into play. The tutorial consists of a <a href=\"https://git-wip-us.apache.org/repos/asf?p=thrift.git;a=blob_plain;f=tutorial/tutorial.thrift\" rel=\"nofollow\">small service</a>:</p>\n\n<pre><code>enum Operation {\n    ADD = 1,\n    SUBTRACT = 2,\n    MULTIPLY = 3,\n    DIVIDE = 4\n}\n\nstruct Work {\n    1: i32 num1 = 0,\n    2: i32 num2,\n    3: Operation op,\n    4: optional string comment,\n}\n\nservice Calculator extends shared.SharedService {\n    i32 calculate(1:i32 logid, 2:Work w) throws (1:InvalidOperation ouch),\n\n    // some other methods ...\n}\n</code></pre>\n\n<p>If the client passes a calculation operation to the server in this way:</p>\n\n<pre><code>work := tutorial.NewWork()\nwork.Op = tutorial.Operation_DIVIDE\nwork.Num1 = 1\nwork.Num2 = 0\nquotient, err := client.Calculate(1, work)\nif err != nil {\n    switch v := err.(type) {\n    case *tutorial.InvalidOperation:\n        fmt.Println(\"Invalid operation:\", v)\n    default:\n        fmt.Println(\"Error during operation:\", err)\n    }\n    return err\n} else {\n    fmt.Println(\"Whoa we can divide by 0 with new value:\", quotient)\n}\n</code></pre>\n\n<p>the server should throw an exception as shown below. A similar thing happens when some unknown value for the <code>w.Op</code> is passed:</p>\n\n<pre><code>func (p *CalculatorHandler) Calculate(logid int32, w *tutorial.Work) (val int32, err error) {\n\nswitch w.Op {\n    case tutorial.Operation_DIVIDE:\n        if w.Num2 == 0 {\n            ouch := tutorial.NewInvalidOperation()\n            ouch.WhatOp = int32(w.Op)\n            ouch.Why = \"Cannot divide by 0\"\n            err = ouch\n            return\n        }\n        val = w.Num1 / w.Num2\n        break\n\n    // other cases omitted\n\n    default:\n        ouch := tutorial.NewInvalidOperation()\n        ouch.WhatOp = int32(w.Op)\n        ouch.Why = \"Unknown operation\"\n        err = ouch\n        return\n    }\n\n    // more stuff omitted\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4579, "user_id": 1114274, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ebd3b90b30e78d29cc01c13ba6ebb090?s=128&d=identicon&r=PG", "display_name": "Mike Graf", "link": "https://stackoverflow.com/users/1114274/mike-graf"}, "is_accepted": false, "score": 0, "last_activity_date": 1474318460, "creation_date": 1474318460, "answer_id": 39581945, "question_id": 34091508, "link": "https://stackoverflow.com/questions/34091508/how-to-implement-golang-service-based-on-apache-thrift-with-exceptions/39581945#39581945", "title": "How to implement golang service based on Apache Thrift with exceptions?", "body": "<p>The short answer is that Thrift Interfaces implement the <code>error</code> <a href=\"https://golang.org/doc/effective_go.html#errors\" rel=\"nofollow\">interface</a> (<code>Error() string</code> function) .  Thus can be returned just like any go <code>error</code>, usually like <code>return nil, err</code>. </p>\n"}], "owner": {"reputation": 369, "user_id": 2075157, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/iimCG.jpg?s=128&g=1", "display_name": "Maxim Galushka", "link": "https://stackoverflow.com/users/2075157/maxim-galushka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2672, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1474318460, "creation_date": 1449242138, "last_edit_date": 1449257644, "question_id": 34091508, "link": "https://stackoverflow.com/questions/34091508/how-to-implement-golang-service-based-on-apache-thrift-with-exceptions", "title": "How to implement golang service based on Apache Thrift with exceptions?", "body": "<p>I have a service <strong>thrift</strong> interface for <code>result</code> method as follows:</p>\n\n<pre><code>exception SomeException {\n    1: string message;\n}\n\nstring result(\n    1: string token,\n    2: string identifier\n) throws (\n    1: SomeException ex,\n);\n</code></pre>\n\n<p>How di I implement this properly in <strong>golang</strong>? I want exceptions to be thrown properly for clients of this Thrift service.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1449241725, "post_id": 34089750, "comment_id": 55934876, "body": "It behaves like documented. You read the doc, didn&#39;t you?"}, {"owner": {"reputation": 5578, "user_id": 308977, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d7f5a4fc0b3cfb34d543599d9e2fb398?s=128&d=identicon&r=PG", "display_name": "Rizky Ramadhan", "link": "https://stackoverflow.com/users/308977/rizky-ramadhan"}, "edited": false, "score": 1, "creation_date": 1517440933, "post_id": 34089750, "comment_id": 84102586, "body": "Well, yeah... but this behavior is kind of unexpected. Is there another marshal that will convert my []byte as string ?"}], "answers": [{"tags": [], "owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "is_accepted": true, "score": 30, "last_activity_date": 1449236832, "creation_date": 1449236832, "answer_id": 34089818, "question_id": 34089750, "link": "https://stackoverflow.com/questions/34089750/marshal-byte-to-json-giving-a-strange-string/34089818#34089818", "title": "Marshal []byte to JSON, giving a strange string", "body": "<p>As per the docs: <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"noreferrer\">https://golang.org/pkg/encoding/json/#Marshal</a></p>\n\n<blockquote>\n  <p>Array and slice values encode as JSON arrays, except that []byte encodes as a base64-encoded string, and a nil slice encodes as the null JSON object.</p>\n</blockquote>\n\n<p>The value <code>AAAAAQID</code> is a base64 representation of your byte slice - e.g.</p>\n\n<pre><code>b, err := base64.StdEncoding.DecodeString(\"AAAAAQID\")\nif err != nil {\n    log.Fatal(err)\n}\n\nfmt.Printf(\"%v\", b)\n// Outputs: [0 0 0 1 2 3]\n</code></pre>\n"}], "owner": {"reputation": 325, "user_id": 3511452, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/161b9d9d432b60e1be27647d4794e631?s=128&d=identicon&r=PG&f=1", "display_name": "someblue", "link": "https://stackoverflow.com/users/3511452/someblue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 30353, "favorite_count": 3, "closed_date": 1598813761, "accepted_answer_id": 34089818, "answer_count": 1, "score": 17, "last_activity_date": 1598813716, "creation_date": 1449236595, "last_edit_date": 1598813716, "question_id": 34089750, "link": "https://stackoverflow.com/questions/34089750/marshal-byte-to-json-giving-a-strange-string", "closed_reason": "Duplicate", "title": "Marshal []byte to JSON, giving a strange string", "body": "<p>When I try to marshal []byte to JSON format, I only got a strange string.</p>\n\n<p>Please look the following code.</p>\n\n<p>I have two doubt:</p>\n\n<p>How can I marshal []byte to JSON?</p>\n\n<p>Why []byte become this string?</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    type ColorGroup struct {\n        ByteSlice    []byte\n        SingleByte   byte\n        IntSlice     []int\n    }\n    group := ColorGroup{\n        ByteSlice:  []byte{0,0,0,1,2,3},\n        SingleByte: 10,\n        IntSlice:   []int{0,0,0,1,2,3},\n    }\n    b, err := json.Marshal(group)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n    os.Stdout.Write(b)\n}\n</code></pre>\n\n<p>the output is:</p>\n\n<pre><code>{\"ByteSlice\":\"AAAAAQID\",\"SingleByte\":10,\"IntSlice\":[0,0,0,1,2,3]}\n</code></pre>\n\n<p>golang playground: <a href=\"https://play.golang.org/p/wanppBGzNR\" rel=\"noreferrer\">https://play.golang.org/p/wanppBGzNR</a></p>\n"}, {"tags": ["postgresql", "go", "orm", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 599, "user_id": 4327041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ZbnQ.jpg?s=128&g=1", "display_name": "abm", "link": "https://stackoverflow.com/users/4327041/abm"}, "is_accepted": true, "score": 2, "last_activity_date": 1449245560, "last_edit_date": 1449245560, "creation_date": 1449245103, "answer_id": 34092469, "question_id": 34088054, "link": "https://stackoverflow.com/questions/34088054/gorm-ignoring-sqlindex-tags/34092469#34092469", "title": "`gorm` Ignoring `sql:&quot;index&quot;` Tags", "body": "<p>From my experience, the db.CreateTable only creates the table and it's fields. You are better off using the AutoMigrate function with the model structure that you want to migrate:</p>\n\n<pre><code>db, err := gorm.Open(\"postgres\", connectionString)\n...\n// error checking\n...\n\ndb.AutoMigrate(&amp;Model)\n</code></pre>\n\n<p>Also, I tried AutoMigrating the model you posted and got an error saying that multiple primary keys are not allowed, so I changed the model to:</p>\n\n<pre><code>type Model struct {\n    Id        int64 `sql:\"type:bigint;default:0\"`\n    CreatedAt time.Time\n    UpdatedAt time.Time\n    DeletedAt *time.Time `sql:\"index\"`\n}\n</code></pre>\n\n<p>and the AutoMigration created all PKs and indexes just fine.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>Checking the GORM's README, on this <a href=\"https://github.com/jinzhu/gorm#define-models-structs\" rel=\"nofollow\">example</a>, the Email structure goes as:</p>\n\n<pre><code>type Email struct {\n    ID      int\n    UserID  int     `sql:\"index\"` // Foreign key (belongs to), tag `index` will create index for this field when using AutoMigrate\n    Email   string  `sql:\"type:varchar(100);unique_index\"` // Set field's sql type, tag `unique_index` will create unique index\n    Subscribed bool\n}\n</code></pre>\n\n<p>Notice the comment on the UserId field saying it will create the index when using AutoMigrate.</p>\n\n<p>Also, it's worth taking a look at how the <a href=\"https://github.com/jinzhu/gorm#migration\" rel=\"nofollow\">AutoMigrate</a> does it's job:</p>\n\n<pre><code>// Automating Migration\ndb.AutoMigrate(&amp;User{})\ndb.Set(\"gorm:table_options\", \"ENGINE=InnoDB\").AutoMigrate(&amp;User{})\ndb.AutoMigrate(&amp;User{}, &amp;Product{}, &amp;Order{})\n// Feel free to change your struct, AutoMigrate will keep your database up-to-date.\n// AutoMigrate will ONLY add *new columns* and *new indexes*,\n// WON'T update current column's type or delete unused columns, to protect your data.\n// If the table is not existing, AutoMigrate will create the table automatically.\n</code></pre>\n"}], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1571, "favorite_count": 1, "accepted_answer_id": 34092469, "answer_count": 1, "score": 1, "last_activity_date": 1449245560, "creation_date": 1449230832, "question_id": 34088054, "link": "https://stackoverflow.com/questions/34088054/gorm-ignoring-sqlindex-tags", "title": "`gorm` Ignoring `sql:&quot;index&quot;` Tags", "body": "<p>Why <code>gorm</code> is ignoring <code>sql:\"index\"</code> tags? No indexes got created.</p>\n\n<p>Database in use here is PostgreSQL (importing <code>_ \"github.com/lib/pq\"</code>). This <code>Model</code> struct is used (because default <code>gorm.Model</code> uses an auto increment number - <code>serial</code> - as primary key and I wanted to set <code>id</code> myself):</p>\n\n<pre><code>type Model struct {\n    ID        int64 `sql:\"type:bigint PRIMARY KEY;default:0\"`\n    CreatedAt time.Time\n    UpdatedAt time.Time\n    DeletedAt *time.Time `sql:\"index\"`\n}\n</code></pre>\n\n<p>And one of actual models is:</p>\n\n<pre><code>type TUHistory struct {\n    Model\n\n    TUID        int64  `json:\"tu_id,string\" gorm:\"column:tu_id\" sql:\"index\"`\n}\n\nfunc (x *TUHistory) TableName() string {\n    return \"tu_history\"\n}\n</code></pre>\n\n<p>And the table is created by <code>db.CreateTable(&amp;TUHistory{})</code> which creates the table correctly except for indexes.</p>\n\n<p>As a temporary work around, I do <code>db.Model(&amp;TUHistory{}).AddIndex(\"ix_tuh_tu_id\", \"tu_id\")</code> to create indexes.</p>\n"}, {"tags": ["go", "net-http"], "comments": [{"owner": {"reputation": 1142, "user_id": 98605, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/63a3bf6cd81eb70fcbda3512fc73a309?s=128&d=identicon&r=PG", "display_name": "Glyn Normington", "link": "https://stackoverflow.com/users/98605/glyn-normington"}, "edited": false, "score": 0, "creation_date": 1449225995, "post_id": 34085418, "comment_id": 55925172, "body": "Should <code>sysn.Pool</code> be <code>sync.Pool</code>?"}, {"owner": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "reply_to_user": {"reputation": 1142, "user_id": 98605, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/63a3bf6cd81eb70fcbda3512fc73a309?s=128&d=identicon&r=PG", "display_name": "Glyn Normington", "link": "https://stackoverflow.com/users/98605/glyn-normington"}, "edited": false, "score": 0, "creation_date": 1449226200, "post_id": 34085418, "comment_id": 55925290, "body": "Sorry for wrong word, It is <code>sync.Pool</code>."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1449226753, "post_id": 34085418, "comment_id": 55925637, "body": "The <a href=\"https://golang.org/src/net/http/server.go\" rel=\"nofollow noreferrer\"><code>conn</code></a> struct is relatively small and holds configuration parameters/state, so the benefit of a re-usable pool isn&#39;t likely worth it for the tiny amount of garbage it generates. If this were a 4K buffer being thrown away every connection, then yes, a pool <i>may</i> (after benchmarking!) be useful."}, {"owner": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "edited": false, "score": 0, "creation_date": 1449228818, "post_id": 34085418, "comment_id": 55926856, "body": "thank you for your hints!"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1449237401, "post_id": 34085418, "comment_id": 55931901, "body": "You actually read the source code. For this I gave you an upvote. Even if the concern smells like premature optimisation. Keep reading the source code."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1449245119, "post_id": 34085418, "comment_id": 55937267, "body": "The http server already has a pool in a sense, keepalive, which reuses the connections as often as possible. Plus, it&#39;s usually not worth the effort to zero out all the fields in a struct like this when the GC can do that for you more efficiently."}], "answers": [{"comments": [{"owner": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "edited": false, "score": 0, "creation_date": 1449228607, "post_id": 34086503, "comment_id": 55926725, "body": "Thanks for your hints.  I am fresh with golang. It seem can know at what point the connection is no longer used from what I saw in the source code in <code>http&#47;server.go</code> line 1365: <code>w.finishRequest()</code>, but I don`t know whether  have really done."}, {"owner": {"reputation": 1142, "user_id": 98605, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/63a3bf6cd81eb70fcbda3512fc73a309?s=128&d=identicon&r=PG", "display_name": "Glyn Normington", "link": "https://stackoverflow.com/users/98605/glyn-normington"}, "reply_to_user": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "edited": false, "score": 0, "creation_date": 1449228905, "post_id": 34086503, "comment_id": 55926912, "body": "You&#39;re welcome. Reading the Go standard libraries is a good way to become familiar with idiomatic Go code. If you would like a good textbook on Go, I recommend <a href=\"http://www.gopl.io/\" rel=\"nofollow noreferrer\">&quot;D&amp;K&quot;</a>. The <a href=\"http://golangweekly.com/\" rel=\"nofollow noreferrer\">Go Newsletter</a> is worth subscribing to - regularly includes interesting articles and videos."}, {"owner": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "edited": false, "score": 0, "creation_date": 1449229141, "post_id": 34086503, "comment_id": 55927044, "body": "Yes, I have subscribed Go Newsletter."}], "tags": [], "owner": {"reputation": 1142, "user_id": 98605, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/63a3bf6cd81eb70fcbda3512fc73a309?s=128&d=identicon&r=PG", "display_name": "Glyn Normington", "link": "https://stackoverflow.com/users/98605/glyn-normington"}, "is_accepted": false, "score": 0, "last_activity_date": 1449225952, "creation_date": 1449225952, "answer_id": 34086503, "question_id": 34085418, "link": "https://stackoverflow.com/questions/34085418/doubts-about-the-source-code-of-connection-on-net-http-in-golang/34086503#34086503", "title": "Doubts about the source code of connection on net/http in golang", "body": "<p>Does this question stem from measuring performance of an application or simply, as the title implies, from reading the source code? The basic rule of performance optimisation is \"measure, don't guess\" (see, for example, <a href=\"http://www.javacodegeeks.com/2013/12/performance-tuning-measure-dont-guess.html\" rel=\"nofollow\">this article</a>).</p>\n\n<p>Apart from performance, there may be a good reason for not using <code>sync.Pool</code> here. You would need to know at what point the connection is no longer used and can safely be put back in the pool.</p>\n\n<p>That said, your suggestion <em>may</em> have some merit if it is obvious at what point(s) in the code the connection needs to be returned to the pool. Why not measure the performance improvement for a (realistic if small) application that could benefit? If there's a really significant benefit, it might be worth proposing to the Go community. However, the main benefit of <code>sync.Pool</code> is to reduce GC overhead, so the application would have to create <em>many</em> connections for there to be a noticeable benefit.</p>\n"}], "owner": {"reputation": 1241, "user_id": 1233410, "user_type": "registered", "accept_rate": 28, "profile_image": "https://www.gravatar.com/avatar/876e9c31e7af3c04eaab42ac466674f1?s=128&d=identicon&r=PG", "display_name": "sope", "link": "https://stackoverflow.com/users/1233410/sope"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 257, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1449226241, "creation_date": 1449222811, "last_edit_date": 1449226241, "question_id": 34085418, "link": "https://stackoverflow.com/questions/34085418/doubts-about-the-source-code-of-connection-on-net-http-in-golang", "title": "Doubts about the source code of connection on net/http in golang", "body": "<p>I am learning source code about golang , at the source code create new connection for each request in net/http, like:</p>\n\n<pre><code>// Create new connection from rwc.\nfunc (srv *Server) newConn(rwc net.Conn) (c *conn, err error) {\n    c = new(conn)\n    c.remoteAddr = rwc.RemoteAddr().String()\n    c.server = srv\n    c.rwc = rwc\n    c.w = rwc\n    if debugServerConnections {\n        c.rwc = newLoggingConn(\"server\", c.rwc)\n    }\n    c.sr.r = c.rwc\n    c.lr = io.LimitReader(&amp;c.sr, noLimit).(*io.LimitedReader)\n    br := newBufioReader(c.lr)\n    bw := newBufioWriterSize(checkConnErrorWriter{c}, 4&lt;&lt;10)\n    c.buf = bufio.NewReadWriter(br, bw)\n    return c, nil\n}\n</code></pre>\n\n<p>why <code>new(conn)</code> at this place, is there can improve performance do with get <code>conn</code> from <code>sync.Pool</code></p>\n"}, {"tags": ["linux", "go", "darwin", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1449244165, "post_id": 34084597, "comment_id": 55936596, "body": "Do you have clang or gcc setup properly to cross-compile?"}, {"owner": {"reputation": 363, "user_id": 483990, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JQxyg.png?s=128&g=1", "display_name": "Nicolas", "link": "https://stackoverflow.com/users/483990/nicolas"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1449479964, "post_id": 34084597, "comment_id": 56007967, "body": "I am not sure, what does &quot;setup properly&quot; mean and how can I check?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1449501963, "post_id": 34084597, "comment_id": 56021905, "body": "You need to be able to cross-compile a C program in order to cross-compile a go program that uses cgo; go can&#39;t do that for you. Once you have the setup, you can set the proper env variables to tell go which compiler to call for the requested target: <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">golang.org/cmd/cgo</a>"}, {"owner": {"reputation": 363, "user_id": 483990, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JQxyg.png?s=128&g=1", "display_name": "Nicolas", "link": "https://stackoverflow.com/users/483990/nicolas"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1450688391, "post_id": 34084597, "comment_id": 56525133, "body": "I don&#39;t get it. I have gcc and clang installed (not sure what &quot;setup&quot; is required) and I am able to compile my program for linux 386 (&quot;native&quot;) so doesn&#39;t that mean it compiles the C code successfully? I don&#39;t understand why the compilation of the C code is different (and fails) when the target is darwin."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1450715104, "post_id": 34084597, "comment_id": 56541579, "body": "Simply having a C compiler isn&#39;t enough to target another OS/architecture; you need all the associated headers and libraries compiled for the target as well. Compiling to darwin from Linux isn&#39;t a very common task, but I did see a GH repo someone built with tooling to help: github.com/tpoechtrager/osxcross."}, {"owner": {"reputation": 363, "user_id": 483990, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JQxyg.png?s=128&g=1", "display_name": "Nicolas", "link": "https://stackoverflow.com/users/483990/nicolas"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1450949443, "post_id": 34084597, "comment_id": 56642474, "body": "Thanks for this - it seems to be what I need. I have successfully installed the toolchain following the instructions (phew!) but when I try to compile my program even for linux 64 (&quot;native&quot;) I get the following error:        <code>&#47;usr&#47;local&#47;go&#47;pkg&#47;tool&#47;linux_amd64&#47;link: running o64-clang failed: exit status 1   ld: library not found for -lgobject-2.0   clang: error: linker command failed with exit code 1 (use -v to see invocation)</code>    Not sure what that means... :/"}, {"owner": {"reputation": 363, "user_id": 483990, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JQxyg.png?s=128&g=1", "display_name": "Nicolas", "link": "https://stackoverflow.com/users/483990/nicolas"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1450950194, "post_id": 34084597, "comment_id": 56642826, "body": "Ok I realized maybe it doesn&#39;t make sense to try to use that to compile for linux so now when I target darwin amd64 I have the following errors: <code># github.com&#47;mattn&#47;go-gtk&#47;pango ld: library not found for -lpango-1.0 clang: error: linker command failed with exit code 1 (use -v to see invocation)</code> and <code># github.com&#47;mattn&#47;go-gtk&#47;glib ld: library not found for -lgobject-2.0 clang: error: linker command failed with exit code 1 (use -v to see invocation)</code> ; what does that mean?"}], "answers": [{"tags": [], "owner": {"reputation": 363, "user_id": 483990, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JQxyg.png?s=128&g=1", "display_name": "Nicolas", "link": "https://stackoverflow.com/users/483990/nicolas"}, "is_accepted": true, "score": 4, "last_activity_date": 1588194652, "last_edit_date": 1588194652, "creation_date": 1451376065, "answer_id": 34506947, "question_id": 34084597, "link": "https://stackoverflow.com/questions/34084597/cross-compilation-of-cgo-for-darwin-fails/34506947#34506947", "title": "Cross-compilation of cgo (for darwin) fails", "body": "<p>I am now able to compile successfully my code on linux for darwin thanks to the comments by JimB.</p>\n\n<p>What I needed was a osx toolchain such as <a href=\"https://github.com/tpoechtrager/osxcross\" rel=\"nofollow noreferrer\">github.com/tpoechtrager/osxcross</a>.</p>\n\n<p>Then I compiled my code by doing <code>env OSXCROSS_NO_INCLUDE_PATH_WARNINGS=1 MACOSX_DEPLOYMENT_TARGET=10.6 CC=o64-clang CXX=o64-clang++ GOOS=darwin GOARCH=amd64 CGO_ENABLED=1 go build -v mywork/myprogram</code>.</p>\n\n<p>Some of my programs compile successfully, some throw errors at linking time but I guess that's another issue so I'll mark this question as solved as far as the cross-compilation goes.</p>\n"}], "owner": {"reputation": 363, "user_id": 483990, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JQxyg.png?s=128&g=1", "display_name": "Nicolas", "link": "https://stackoverflow.com/users/483990/nicolas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2517, "favorite_count": 1, "accepted_answer_id": 34506947, "answer_count": 1, "score": 4, "last_activity_date": 1588194652, "creation_date": 1449220340, "question_id": 34084597, "link": "https://stackoverflow.com/questions/34084597/cross-compilation-of-cgo-for-darwin-fails", "title": "Cross-compilation of cgo (for darwin) fails", "body": "<p>I am fairly new to go and even Linux in general.</p>\n\n<p>I have built an app in a Linux environment which makes use of a gtk lib based on cgo (<a href=\"https://github.com/mattn/go-gtk/\" rel=\"nofollow\">https://github.com/mattn/go-gtk/</a>). The application builds fine in its native environment (linux 64bit) but when I try to compile for darwin 64bit I get the following result:</p>\n\n<pre><code># net\ncould not determine kind of name for C.AI_MASK\n# net\ncould not determine kind of name for C.AI_MASK\n</code></pre>\n\n<p>The command line I use to build:</p>\n\n<pre><code>env GOOS=$1 GOARCH=$2 CGO_ENABLED=1 go build $3\n</code></pre>\n\n<p>Where $1 is darwin and $2 amd64 (and $3 the path to my app).</p>\n\n<p>As the error seems to come from the lib I import, I am not sure what to do to fix it. I have also read that cross compiling cgo does not really work as it relies on native macos stuff so it would need to be built on a mac. Is this true or is there something I can do to make it work in my environment?</p>\n\n<p>I am also slightly confused as it seems most people discussing this subject are talking of go pre 1.5 which was entirely different when it comes to cross-compiling if I understand correctly.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["data-structures", "go", "concurrency"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1478390622, "post_id": 34080734, "comment_id": 68135681, "body": "We need more of the context to work with this. What does the map contain?  Is it huge? How fast is releasing a thing? (What <i>is</i> releasing?) Is it a disaster if a released object is used by another goroutine, and if so, what determines how long an object picked out of the map remains in use? What is the application and what are its priorities (e.g. maximizing throughput vs. limiting latency)?"}], "answers": [{"comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478376525, "post_id": 34083197, "comment_id": 68131863, "body": "Does the method given in this answer actually suffice?   (Esp. after the 1.6 changes?)   Is there a place in the language specification where this is cleared up / definitively answered?"}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478426185, "post_id": 34083197, "comment_id": 68141858, "body": "In the code sample above the map is accessed from a single goroutine, so no synchronisation is necessary as there is no concurrent access."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478439032, "post_id": 34083197, "comment_id": 68145100, "body": "Of course OP is assuming there will be concurrent writers during the iteration.   He says:  &quot;I don&#39;t want to read lock the map since that would make delete/modifying keys during the iteration impossible.&quot;  Just because he doesn&#39;t /show/ the writers doesn&#39;t mean they&#39;re not involved."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1478592351, "post_id": 34083197, "comment_id": 68207541, "body": "I am not quite sure what the question is. If you are asking if it is safe to read/write a map from multiple goroutines without synchronisation then the answer is no. However sometimes it is possible to re-write the code to make access single threaded. That is what I attempted to show in my answer by moving <code>delete(m, k)</code> out of a separate goroutine. It is hard to tell if this answer meets OP requirements though as there are not enough of them in the question."}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 4, "last_activity_date": 1449214661, "creation_date": 1449214661, "answer_id": 34083197, "question_id": 34080734, "link": "https://stackoverflow.com/questions/34080734/golang-concurrent-map-access-with-range/34083197#34083197", "title": "Golang concurrent map access with range", "body": "<p>You do not state all the requirements (e.g. can the release of multiple objects happen simultaneously, etc) but the simplest solution I can think of is to remove elements and launch a release goroutine for each of the removed elements:</p>\n\n<pre><code>for key := range keysToRemove {\n    if v, ok := m[k]; ok {\n        delete(m, k)\n        go release(k, v)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 2, "last_activity_date": 1503855421, "last_edit_date": 1503855421, "creation_date": 1478424295, "answer_id": 40447793, "question_id": 34080734, "link": "https://stackoverflow.com/questions/34080734/golang-concurrent-map-access-with-range/40447793#40447793", "title": "Golang concurrent map access with range", "body": "<p>Update August 2017 (<a href=\"https://golang.org/doc/go1.9#sync-map\" rel=\"nofollow noreferrer\">golang 1.9</a>)</p>\n\n<p>You now have a new <a href=\"https://golang.org/pkg/sync/#Map\" rel=\"nofollow noreferrer\"><code>Map</code></a> type in the <a href=\"https://golang.org/pkg/sync\" rel=\"nofollow noreferrer\"><code>sync</code></a> package is a concurrent map with amortized-constant-time loads, stores, and deletes.<br>\nIt is safe for multiple goroutines to call a Map's methods concurrently. </p>\n\n<hr>\n\n<p>Original answer Nov. 2016</p>\n\n<blockquote>\n  <p>I don't want to read lock the map </p>\n</blockquote>\n\n<p>That makes sense, since a deleting from a map is  considered a write operation, and must be serialized with all other reads and writes. That implies a write lock to complete the delete. (source: <a href=\"https://stackoverflow.com/a/36755150/6309\">this answer</a>)</p>\n\n<p>Assuming the worst case scenario (multiple writers and readers), you can take a look at the implementation of <a href=\"https://github.com/orcaman/concurrent-map\" rel=\"nofollow noreferrer\"><code>orcaman/concurrent-map</code></a>, which has a <a href=\"https://github.com/orcaman/concurrent-map/blob/8bf1e9bacbf65b10c81d0f4314cf2b1ebef728b5/concurrent_map.go#L116-L123\" rel=\"nofollow noreferrer\"><code>Remove()</code> method</a> using multiple <code>sync.RWMutex</code> because, to avoid lock bottlenecks, this concurrent map is dived to several (<code>SHARD_COUNT</code>) map shards.<br>\nThis is faster than using only one <code>RWMutex</code> <a href=\"https://gist.github.com/fatih/6206844\" rel=\"nofollow noreferrer\">as in this example</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": false, "score": 6, "last_activity_date": 1478480645, "last_edit_date": 1478480645, "creation_date": 1478480339, "answer_id": 40456363, "question_id": 34080734, "link": "https://stackoverflow.com/questions/34080734/golang-concurrent-map-access-with-range/40456363#40456363", "title": "Golang concurrent map access with range", "body": "<p>There are a bunch of ways you can clean up things from a <code>map</code> without racy map accesses. What works for your application depends a lot on what it's doing. </p>\n\n<p>0) Just lock the map while you work on it. If the map's not too big, or you have some latency tolerance, it gets the job done quickly (in terms of time <em>you</em> spend on it) and you can move on to thinking about other stuff. If it becomes a problem later, you can come back to the problem then.</p>\n\n<p>1) Copy the objects or pointers out and clear the map while holding a lock, then release the objects in the background. If the problem is that the slowness of releasing itself will keep the lock held a long time, this is the simple workaround for that.</p>\n\n<p>2) If efficient reads are basically all that matters, use <code>atomic.Value</code>. That lets you entirely replace one map with a new and different one. If writes are essentially 0% of your workload, the efficient reads balance out the cost of creating a new map on every change. That's rare, but it happens, e.g., <code>encoding/gob</code> has a global map of types managed this way.</p>\n\n<p>3) If none of those do everything you need, tweak how you store the data (e.g. shard the map). Replace your map with 16 maps and hash keys yourself to decide which map a thing belongs in, and then you can lock one shard at a time, for cleanup or any other write.</p>\n\n<p>There's also the issue of a race between release and use: goroutine A gets something from the map, B clears the map and releases the thing, A uses the released thing. </p>\n\n<p>One strategy there is to lock each value while you use or release it; then you need locks but not global ones. </p>\n\n<p>Another is to tolerate the consequences of races if they're known and not disastrous; for example, concurrent access to <code>net.Conn</code>s is explicitly allowed by its docs, so closing an in-use connection may cause a request on it to error but won't lead to undefined app behavior. You have to really be sure you know what you're getting into then, though, 'cause <a href=\"https://blog.golang.org/race-detector\" rel=\"noreferrer\">many benign-seeming races aren't</a>.</p>\n\n<p>Finally, maybe your application already is ensuring no in-use objects are released, e.g. there's a safely maintained reference count on objects and only unused objects are released. Then, of course, you don't have to worry.</p>\n\n<p>It may be tempting to try to replace these locks with channels somehow but I don't see any gains from it. It's <em>nice</em> when you can design your app thinking mainly in terms of communication between processes rather than shared data, but when you do have shared data, there's no use in pretending otherwise. Excluding unsafe access to shared data is what locks are for.</p>\n"}], "owner": {"reputation": 121, "user_id": 2569415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b855f57384920f7864f73a4d5a36cb24?s=128&d=identicon&r=PG", "display_name": "JeffJen", "link": "https://stackoverflow.com/users/2569415/jeffjen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1810, "favorite_count": 3, "answer_count": 3, "score": 12, "last_activity_date": 1503855421, "creation_date": 1449201789, "question_id": 34080734, "link": "https://stackoverflow.com/questions/34080734/golang-concurrent-map-access-with-range", "title": "Golang concurrent map access with range", "body": "<p>I have a map with objects that needs to be released before clearing the map.  I am tempted to iterate over the map and remove/release objects as I walk through it.</p>\n\n<p>Here is a mock up example \n<a href=\"https://play.golang.org/p/kAtPoUgMsq\" rel=\"noreferrer\">https://play.golang.org/p/kAtPoUgMsq</a></p>\n\n<p>Since the only way to iterate the map is through range, how would I synchronize multiple producers and multiple consumers?</p>\n\n<p>I don't want to read lock the map since that would make delete/modifying keys during the iteration impossible.</p>\n"}, {"tags": ["ubuntu", "go", "kubernetes", "apt-get"], "answers": [{"comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 14298, "user_id": 2106207, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/960430ab7aba908bb9aa62d530618a75?s=128&d=identicon&r=PG", "display_name": "Nan Xiao", "link": "https://stackoverflow.com/users/2106207/nan-xiao"}, "edited": false, "score": 0, "creation_date": 1449653545, "post_id": 34081489, "comment_id": 56097181, "body": "@NanXiao Is it official? I don&#39;t see any evolution on <a href=\"https://github.com/kubernetes/kubernetes/issues/16229\" rel=\"nofollow noreferrer\">github.com/kubernetes/kubernetes/issues/16229</a> though..."}, {"owner": {"reputation": 14298, "user_id": 2106207, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/960430ab7aba908bb9aa62d530618a75?s=128&d=identicon&r=PG", "display_name": "Nan Xiao", "link": "https://stackoverflow.com/users/2106207/nan-xiao"}, "edited": false, "score": 0, "creation_date": 1450159281, "post_id": 34081489, "comment_id": 56305801, "body": "But I try to build it with the newest go 1.5.2, and it is OK."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 14298, "user_id": 2106207, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/960430ab7aba908bb9aa62d530618a75?s=128&d=identicon&r=PG", "display_name": "Nan Xiao", "link": "https://stackoverflow.com/users/2106207/nan-xiao"}, "edited": false, "score": 0, "creation_date": 1450159536, "post_id": 34081489, "comment_id": 56305921, "body": "@NanXiao Great! I have included your conclusion in the answer for more visibility."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 1, "last_activity_date": 1450159519, "last_edit_date": 1495542337, "creation_date": 1449206904, "answer_id": 34081489, "question_id": 34080574, "link": "https://stackoverflow.com/questions/34080574/the-kubernetes-cant-find-correct-go-in-ubuntu/34081489#34081489", "title": "The kubernetes can&#39;t find correct go in ubuntu", "body": "<p>As explained in \"<a href=\"https://askubuntu.com/a/151943/5470\">How can you completely remove a package?</a>\", a <code>sudo apt-get --purge autoremove</code> might have removed go completely.<br>\nBut that doesn't mean it has cleaned what was compiled before</p>\n\n<p>Make sure that <code>/home/nan/kubernetes/Godeps/_workspace</code> and <code>/home/nan/kubernetes/_output</code> are deleted after a <strong><code>make clean</code></strong> (See <a href=\"https://github.com/kubernetes/kubernetes/issues/16771\" rel=\"nofollow noreferrer\">issue 16771</a>).<br>\nMake sure <code>/usr/local/go/pkg</code> is writable for the user <code>nan</code>. (See <a href=\"https://github.com/kubernetes/kubernetes/blob/a5100ef05726237e4e1f44997852963c955b608c/hack/lib/golang.sh#L323-L325\" rel=\"nofollow noreferrer\"><code>hack/lib/golang.sh</code></a>)</p>\n\n<p>Finally, <a href=\"https://github.com/kubernetes/kubernetes/issues/16229\" rel=\"nofollow noreferrer\">issue 16229</a> mentions:</p>\n\n<blockquote>\n  <p>Would be nice to at least update the docs to indicate that you can't use go>1.4.</p>\n</blockquote>\n\n<p>So try and <strong>install go 1.4.x only</strong>.</p>\n\n<p>Update: the <a href=\"https://stackoverflow.com/users/2106207/nan-xiao\">OP Nan Xiao</a> reports <a href=\"https://stackoverflow.com/questions/34080574/the-kubernetes-cant-find-correct-go-in-ubuntu/34081489#comment56305801_34081489\">in the comments</a> having managed to build it with go 1.5.1 or 1.5.2 without any more issue.</p>\n"}], "owner": {"reputation": 14298, "user_id": 2106207, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/960430ab7aba908bb9aa62d530618a75?s=128&d=identicon&r=PG", "display_name": "Nan Xiao", "link": "https://stackoverflow.com/users/2106207/nan-xiao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 690, "favorite_count": 1, "accepted_answer_id": 34081489, "answer_count": 1, "score": 2, "last_activity_date": 1450159519, "creation_date": 1449200716, "question_id": 34080574, "link": "https://stackoverflow.com/questions/34080574/the-kubernetes-cant-find-correct-go-in-ubuntu", "title": "The kubernetes can&#39;t find correct go in ubuntu", "body": "<p>My OS is <code>ubuntu 14.04.3</code> Server, and I want to build <code>kubernetes</code>.</p>\n\n<p>Firstly, I use \"<code>apt-get</code>\" command install <code>Golang</code>, but the version is <code>1.2.1</code>, so I  use <code>apt-get --purge autoremove</code> command to remove it.And install the newest <code>1.5.1</code> from golang website.</p>\n\n<p>But executing <code>make</code> command, it seems <code>kubernetes</code> always \"think\" current <code>golang</code> is <code>1.2.1</code>:</p>\n\n<pre><code>$ make\nhack/build-go.sh\n+++ [1203 06:20:30] Building go targets for linux/amd64:\n    cmd/kube-proxy\n    cmd/kube-apiserver\n    cmd/kube-controller-manager\n    cmd/kubelet\n    cmd/kubemark\n    cmd/hyperkube\n    cmd/linkcheck\n    plugin/cmd/kube-scheduler\n    cmd/kubectl\n    cmd/integration\n    cmd/gendocs\n    cmd/genkubedocs\n    cmd/genman\n    cmd/mungedocs\n    cmd/genbashcomp\n    cmd/genconversion\n    cmd/gendeepcopy\n    cmd/genswaggertypedocs\n    examples/k8petstore/web-server/src\n    github.com/onsi/ginkgo/ginkgo\n    test/e2e/e2e.test\n+++ [1203 06:20:30] +++ Warning: stdlib pkg with cgo flag not found.\n+++ [1203 06:20:30] +++ Warning: stdlib pkg cannot be rebuilt since /usr/local/go/pkg is not writable by nan\n+++ [1203 06:20:30] +++ Warning: Make /usr/local/go/pkg writable for nan for a one-time stdlib install, Or\n+++ [1203 06:20:30] +++ Warning: Rebuild stdlib using the command 'CGO_ENABLED=0 go install -a -installsuffix cgo std'\n+++ [1203 06:20:30] +++ Falling back to go build, which is slower\n    # k8s.io/kubernetes/pkg/util/yaml\n_output/local/go/src/k8s.io/kubernetes/pkg/util/yaml/decoder.go:26: import /home/nan/kubernetes/Godeps/_workspace/pkg/linux_amd64/github.com/ghodss/yaml.a: object is [linux amd64 go1.2.1 X:none] expected [linux amd64 go1.5.1 X:none]\n# k8s.io/kubernetes/pkg/util/validation\n_output/local/go/src/k8s.io/kubernetes/pkg/util/validation/errors.go:23: import /home/nan/kubernetes/_output/local/go/pkg/linux_amd64/k8s.io/kubernetes/pkg/util/errors.a: object is [linux amd64 go1.2.1 X:none] expected [linux amd64 go1.5.1 X:none]\n# k8s.io/kubernetes/pkg/api/resource\n_output/local/go/src/k8s.io/kubernetes/pkg/api/resource/quantity.go:27: import /home/nan/kubernetes/Godeps/_workspace/pkg/linux_amd64/speter.net/go/exp/math/dec/inf.a: object is [linux amd64 go1.2.1 X:none] expected [linux amd64 go1.5.1 X:none]\n# github.com/spf13/cobra\nGodeps/_workspace/src/github.com/spf13/cobra/command.go:27: import /home/nan/kubernetes/Godeps/_workspace/pkg/linux_amd64/github.com/inconshreveable/mousetrap.a: object is [linux amd64 go1.2.1 X:none] expected [linux amd64 go1.5.1 X:none]\n# k8s.io/kubernetes/pkg/util/iptables\n_output/local/go/src/k8s.io/kubernetes/pkg/util/iptables/iptables.go:27: import /home/nan/kubernetes/Godeps/_workspace/pkg/linux_amd64/github.com/coreos/go-semver/semver.a: object is [linux amd64 go1.2.1 X:none] expected [linux amd64 go1.5.1 X:none]\n# github.com/prometheus/common/expfmt\nGodeps/_workspace/src/github.com/prometheus/common/expfmt/decode.go:23: import /home/nan/kubernetes/Godeps/_workspace/pkg/linux_amd64/github.com/prometheus/client_model/go.a: object is [linux amd64 go1.2.1 X:none] expected [linux amd64 go1.5.1 X:none]\n# github.com/emicklei/go-restful\nGodeps/_workspace/src/github.com/emicklei/go-restful/container.go:16: import /home/nan/kubernetes/Godeps/_workspace/pkg/linux_amd64/github.com/emicklei/go-restful/log.a: object is [linux amd64 go1.2.1 X:none] expected [linux amd64 go1.5.1 X:none]\n!!! Error in /home/nan/kubernetes/hack/lib/golang.sh:376\n  'CGO_ENABLED=0 go build -o \"${outfile}\" \"${goflags[@]:+${goflags[@]}}\" -ldflags \"${goldflags}\" \"${binary}\"' exited with status 2\nCall stack:\n  1: /home/nan/kubernetes/hack/lib/golang.sh:376 kube::golang::build_binaries_for_platform(...)\n  2: /home/nan/kubernetes/hack/lib/golang.sh:535 kube::golang::build_binaries(...)\n  3: hack/build-go.sh:26 main(...)\nExiting with status 1\n!!! Error in /home/nan/kubernetes/hack/lib/golang.sh:456\n  '( kube::golang::setup_env; local host_platform; host_platform=$(kube::golang::host_platform); local goflags goldflags; eval \"goflags=(${KUBE_GOFLAGS:-})\"; goldflags=\"${KUBE_GOLDFLAGS:-} $(kube::version::ldflags)\"; local use_go_build; local -a targets=(); local arg; for arg in \"$@\";\ndo\n    if [[ \"${arg}\" == \"--use_go_build\" ]]; then\n        use_go_build=true;\n    else\n        if [[ \"${arg}\" == -* ]]; then\n            goflags+=(\"${arg}\");\n        else\n            targets+=(\"${arg}\");\n        fi;\n    fi;\ndone; if [[ ${#targets[@]} -eq 0 ]]; then\n    targets=(\"${KUBE_ALL_TARGETS[@]}\");\nfi; local -a platforms=(\"${KUBE_BUILD_PLATFORMS[@]:+${KUBE_BUILD_PLATFORMS[@]}}\"); if [[ ${#platforms[@]} -eq 0 ]]; then\n    platforms=(\"${host_platform}\");\nfi; local binaries; binaries=($(kube::golang::binaries_from_targets \"${targets[@]}\")); local parallel=false; if [[ ${#platforms[@]} -gt 1 ]]; then\n    local gigs; gigs=$(kube::golang::get_physmem); if [[ ${gigs} -ge ${KUBE_PARALLEL_BUILD_MEMORY} ]]; then\n        kube::log::status \"Multiple platforms requested and available ${gigs}G &gt;= threshold ${KUBE_PARALLEL_BUILD_MEMORY}G, building platforms in parallel\"; parallel=true;\n    else\n        kube::log::status \"Multiple platforms requested, but available ${gigs}G &lt; threshold ${KUBE_PARALLEL_BUILD_MEMORY}G, building platforms in serial\"; parallel=false;\n    fi;\nfi; if [[ \"${parallel}\" == \"true\" ]]; then\n    kube::log::status \"Building go targets for ${platforms[@]} in parallel (output will appear in a burst when complete):\" \"${targets[@]}\"; local platform; for platform in \"${platforms[@]}\";\n    do\n        ( kube::golang::set_platform_envs \"${platform}\"; kube::log::status \"${platform}: go build started\"; kube::golang::build_binaries_for_platform ${platform} ${use_go_build:-}; kube::log::status \"${platform}: go build finished\" ) &amp;&gt; \"/tmp//${platform//\\//_}.build\" &amp;\n    done; local fails=0; for job in $(jobs -p);\n    do\n        wait ${job} || let \"fails+=1\";\n    done; for platform in \"${platforms[@]}\";\n    do\n        cat \"/tmp//${platform//\\//_}.build\";\n    done; exit ${fails};\nelse\n    for platform in \"${platforms[@]}\";\n    do\n        kube::log::status \"Building go targets for ${platform}:\" \"${targets[@]}\"; kube::golang::set_platform_envs \"${platform}\"; kube::golang::build_binaries_for_platform ${platform} ${use_go_build:-};\n    done;\nfi )' exited with status 1\nCall stack:\n  1: /home/nan/kubernetes/hack/lib/golang.sh:456 kube::golang::build_binaries(...)\n  2: hack/build-go.sh:26 main(...)\nExiting with status 1\nmake: *** [all] Error 1\n</code></pre>\n\n<p>But the <code>go</code> in \"<code>PATH</code>\" is <code>1.5.1</code>:</p>\n\n<pre><code>$ echo $PATH\n/usr/local/bin:/usr/bin:/bin:/usr/local/games:/usr/games:/usr/local/go/bin\n$ which go\n/usr/local/go/bin/go\n$ go version\ngo version go1.5.1 linux/amd64\n</code></pre>\n\n<p>So how can I fix this issue? </p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "is_accepted": false, "score": 7, "last_activity_date": 1449198215, "last_edit_date": 1449198215, "creation_date": 1449197187, "answer_id": 34080073, "question_id": 34080050, "link": "https://stackoverflow.com/questions/34080050/why-local-variable-is-different-parameter-at-anonymous-function-in-goroutine/34080073#34080073", "title": "why local variable is different parameter at anonymous function in goroutine", "body": "<p>This topic is well covered (across multiple languages) - but the short version is this:</p>\n\n<p>Your current output is like this:</p>\n\n<pre><code>1 100\n2 100\n3 100\n4 100\n...\n</code></pre>\n\n<p>The variable <code>i</code> becomes part of a closure. This means that its value actually outlasts its scope (its moved off to the side so that when the goroutine executes it knows where to find <code>i</code>).</p>\n\n<p>By the time the scheduler gets around to executing your goroutines, the <code>for</code> loop has finished and the value of <code>i</code> is going to be 100 (or close to it if you're running on a slow machine).</p>\n\n<p>The fix is to store the value every iteration and use that:</p>\n\n<pre><code>for i := 0; i &lt; 100; i++ {\n    x := i            // &lt;------ Store the value of i each loop iteration\n    go func(n int) {\n        fmt.Println(n, x) // &lt;---- Use the new, local, closed over value, not the main closed over one\n    }(i)\n} \n</code></pre>\n\n<p>Now every goroutine references its own copy of a closed over variable <code>x</code>, and your output becomes:</p>\n\n<pre><code>1 1\n2 2\n3 3\n4 4\n...\n</code></pre>\n\n<p>This phenomenon is not isolated to Go.</p>\n\n<p>You can see a working sample on the playground:\n<a href=\"http://play.golang.org/p/OT39us6AQ3\" rel=\"noreferrer\"><kbd>View it on the Playground</kbd></a></p>\n"}], "owner": {"reputation": 21, "user_id": 5527179, "user_type": "registered", "profile_image": "https://graph.facebook.com/892928630793889/picture?type=large", "display_name": "hanwool  kim", "link": "https://stackoverflow.com/users/5527179/hanwool-kim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 447, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1449198215, "creation_date": 1449196921, "last_edit_date": 1449197373, "question_id": 34080050, "link": "https://stackoverflow.com/questions/34080050/why-local-variable-is-different-parameter-at-anonymous-function-in-goroutine", "title": "why local variable is different parameter at anonymous function in goroutine", "body": "<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"runtime\"\n)\n\nfunc main() {\n  runtime.GOMAXPROCS(runtime.NumCPU())\n  fmt.Println(runtime.GOMAXPROCS(0))\n\n  // s := \"hello world \\n\"\n\n  for i := 0; i &lt; 100; i++ {\n    go func(n int) {\n        fmt.Println(n, i)\n    }(i)\n  }\n\n  fmt.Scanln()\n}\n</code></pre>\n\n<p>I just wondering why <code>n</code> is not equal to <code>i</code> every go routine.</p>\n\n<p>Also <code>i</code> sometimes has the same value as in the previous call.</p>\n\n<p>What is the matter in this code?</p>\n"}, {"tags": ["image", "go", "base64", "blob"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1449197370, "post_id": 34080015, "comment_id": 55913339, "body": "How are you passing the output to the browser? The output you <i>are</i> showing are the raw bytes with <code>%20</code> representing spaces."}, {"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1449198712, "post_id": 34080015, "comment_id": 55913648, "body": "The output definitely looks like the escaped representation of a byte slice being printed as a string."}], "answers": [{"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 1, "last_activity_date": 1449198766, "creation_date": 1449198766, "answer_id": 34080287, "question_id": 34080015, "link": "https://stackoverflow.com/questions/34080015/image-blob-to-base64/34080287#34080287", "title": "Image blob to base64", "body": "<p>To present image as a base64 you do not need <code>[[</code> symbols. Here is an <a href=\"https://en.wikipedia.org/wiki/Data_URI_scheme\" rel=\"nofollow\">example</a>: </p>\n\n<pre><code>&lt;img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUA\nAAAFCAYAAACNbyblAAAAHElEQV....\n</code></pre>\n\n<p>And <a href=\"https://jsfiddle.net/v619u8kd/1/\" rel=\"nofollow\">here is how it will look</a>.</p>\n\n<p>Take a look at the data you get from your database. It should be a <a href=\"https://golang.org/pkg/bytes/\" rel=\"nofollow\">byteArray</a> or something that you can convert to byteArray. Having a byteArray you can base64 encode it with:</p>\n\n<pre><code>sEnc := b64.StdEncoding.EncodeToString(byteArr)\n</code></pre>\n\n<p>Take a look at my <kbd><a href=\"http://play.golang.org/p/P0heGBXSvm\" rel=\"nofollow\">Go playground</a></kbd> to see how I got the abovementioned base64 image.</p>\n"}], "owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1135, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1449198766, "creation_date": 1449196681, "question_id": 34080015, "link": "https://stackoverflow.com/questions/34080015/image-blob-to-base64", "title": "Image blob to base64", "body": "<p>Im trying to read a blob from database and show it to browser as a base64 image (I think its the only way to show it)</p>\n\n<p>My code is the following</p>\n\n<pre><code>    rows, err := database.Conn.Query(\"SELECT a.id, a.name, a.creationdata, b.logo, c.name FROM guilds a, cloaka_guilds b, players c WHERE a.ownerid = c.id AND b.guild_id = a.id ORDER BY creationdata DESC\")\n    if err != nil {\n        return nil, err\n    }\n    guild_list := []*Guild{}\n    for rows.Next() {\n        guild := &amp;Guild{}\n        rows.Scan(&amp;guild.Id, &amp;guild.Name, &amp;guild.Creationdata, &amp;guild.Logo, &amp;guild.Owner)\n        guild.Logo_str = base64.StdEncoding.EncodeToString(guild.Logo)\n        guild_list = append(guild_list, guild)\n    }\n    return guild_list, nil\n</code></pre>\n\n<p>b.logo holds an image []byte. Im sure of that. To be even more sure IntelliJ IDEA shows on the database row</p>\n\n<blockquote>\n  <p>88x88 Image 1.68K PNG</p>\n</blockquote>\n\n<p>On the browser im rendering with something like</p>\n\n<pre><code>&lt;img src=\"data:image/jpeg;base64,[[ $element.Logo ]]\"&gt;\n</code></pre>\n\n<p>But something is clearly wrong since I get this</p>\n\n<pre><code>&lt;img src=\"data:image/jpeg;base64,[137%2080%2078%2071%2013%2010%2026%20.........]\"&gt;\n</code></pre>\n\n<p>As for the struct guild.Logo is []byte type</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 1, "creation_date": 1449193421, "post_id": 34079466, "comment_id": 55912303, "body": "Sounds to me like you could perhaps just write functions that accept an instance of a <code>Properties</code> object and operate on it, rather than attaching them to it. This is how embedding in Go works though ... so I&#39;m not sure theres a way around that. Composition, not inheritance."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1449215054, "post_id": 34079466, "comment_id": 55918996, "body": "Embedding is called embedding for a reason ;) All Properties fields get embedded into Node."}], "answers": [{"comments": [{"owner": {"reputation": 5954, "user_id": 230392, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uwtL7.jpg?s=128&g=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/230392/jeff"}, "edited": false, "score": 0, "creation_date": 1449249815, "post_id": 34083564, "comment_id": 55940216, "body": "Hi David! I would be interested to hear why that design choice was made.  It&#39;s probably in the spec somewhere just deep between the lines. Hope all is well with you."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 5954, "user_id": 230392, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uwtL7.jpg?s=128&g=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/230392/jeff"}, "edited": false, "score": 0, "creation_date": 1449264711, "post_id": 34083564, "comment_id": 55947635, "body": "@Jeff: The design choice here is that Go doesn&#39;t have inheritance, and doesn&#39;t have method overloading. Embedding is just a convenient method for automatic delegation, with specific rules about how the selector can promote fields and methods (you can always call them directly too), nothing is &quot;inherited&quot;."}], "tags": [], "owner": {"reputation": 19167, "user_id": 432193, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/87f2efac0ff72169aa6e92fc3c613189?s=128&d=identicon&r=PG", "display_name": "Endophage", "link": "https://stackoverflow.com/users/432193/endophage"}, "is_accepted": true, "score": 3, "last_activity_date": 1506467379, "last_edit_date": 1506467379, "creation_date": 1449216387, "answer_id": 34083564, "question_id": 34079466, "link": "https://stackoverflow.com/questions/34079466/embedded-struct/34083564#34083564", "title": "Embedded struct", "body": "<p>So you're running into an idiosyncrasy of Go here. Embedding is the only way in which methods of one struct can get \"promoted\" to appear to exist on another struct. While it feels intuitive that <code>type Node Properties</code> should expose the <code>Properties</code> methods on <code>Node</code>, that effect of that syntax is for <code>Node</code> to take on the memory layout of <code>Properties</code> but not any of its methods.</p>\n\n<p>It doesn't explain why this design choice was made but the <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">Go Spec</a> is at least specific if dry. If you read it exactly as it appears, with no interpretation, it is very accurate:</p>\n\n<blockquote>\n  <p>The method set of an interface type is its interface. The method set of any other type T consists of all methods declared\n  with receiver type T</p>\n</blockquote>\n\n<p><code>GetString</code> has a receiver of type <code>Properties</code> not <code>Node</code>, seriously, interpret the spec like you're an accountant with no imagination. With that said:</p>\n\n<blockquote>\n  <p>Further rules apply to structs containing anonymous fields, as described in the section on struct types.</p>\n  \n  <p>...</p>\n  \n  <p>A field or method f of an anonymous field in a struct x is called promoted if x.f is a legal selector that denotes that field or method f.</p>\n  \n  <p>Promoted fields act like ordinary fields of a struct except that they\n  cannot be used as field names in composite literals of the struct.</p>\n  \n  <p>Given a struct type S and a type named T, promoted methods are\n  included in the method set of the struct as follows:</p>\n  \n  <ul>\n  <li>If S contains an anonymous field T, the method sets of S and *S both\n  include promoted methods with receiver T. The method set of *S also\n  includes promoted methods with receiver *T. </li>\n  <li>If S contains an anonymous\n  field *T, the method sets of S and *S both include promoted methods\n  with receiver T or *T.</li>\n  </ul>\n</blockquote>\n\n<p>That line about composite literals is this thing that forces you to declare <code>Properties</code> inside every <code>Node</code> you create.</p>\n\n<p>p.s. Hi Jeff!</p>\n"}, {"tags": [], "owner": {"reputation": 20459, "user_id": 1120221, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/0977d36f1cf30241c35121f1d741c8e9?s=128&d=identicon&r=PG&f=1", "display_name": "Salah Eddine Taouririt", "link": "https://stackoverflow.com/users/1120221/salah-eddine-taouririt"}, "is_accepted": false, "score": 1, "last_activity_date": 1449216490, "creation_date": 1449216490, "answer_id": 34083588, "question_id": 34079466, "link": "https://stackoverflow.com/questions/34079466/embedded-struct/34083588#34083588", "title": "Embedded struct", "body": "<p>The short answer to your last question is simply <strong>No</strong>.</p>\n\n<p>There is a big difference between type declaration and embedding in <a href=\"/questions/tagged/golang\" class=\"post-tag\" title=\"show questions tagged &#39;golang&#39;\" rel=\"tag\">golang</a>, you can make your last example working by manually make a type conversion between <code>Node</code> and <code>Properties</code>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Properties map[string]interface{}\n\nfunc (p Properties) GetString(key string) string {\n    return p[key].(string)\n}\n\ntype Nodes map[string]*Node\n\ntype Node Properties\n\nfunc main() {\n    allNodes := Nodes{\"1\": &amp;Node{\"test\": \"foo\"}} // :)\n    singleNode := allNodes[\"1\"]\n    fmt.Println(Properties(*singleNode).GetString(\"test\")) // :D\n}\n</code></pre>\n\n<p>But it's clearly that is not what you want, you want a struct embedding with a syntax of type aliasing, which is not possible in <a href=\"/questions/tagged/golang\" class=\"post-tag\" title=\"show questions tagged &#39;golang&#39;\" rel=\"tag\">golang</a>, I think that you should stuck with the your first approach and ignore the the fact the code is redundant and ugly .  </p>\n"}], "owner": {"reputation": 5954, "user_id": 230392, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uwtL7.jpg?s=128&g=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/230392/jeff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9145, "favorite_count": 2, "accepted_answer_id": 34083564, "answer_count": 2, "score": 9, "last_activity_date": 1594202790, "creation_date": 1449192862, "last_edit_date": 1594202790, "question_id": 34079466, "link": "https://stackoverflow.com/questions/34079466/embedded-struct", "title": "Embedded struct", "body": "<p>Is it possible to inherit methods of a type without using embedded structs?</p>\n\n<p>The first snippet of code is working code that embeds the <code>Property</code> struct in <code>Node</code> and I'm able to call <code>node.GetString</code> that's a method on <code>Properties</code>.  The thing I don't like about this is when I initialize <code>Node</code> I have(?) to initialize the <code>Properties</code> struct within it.  Is there a way around this?  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Properties map[string]interface{}\n\nfunc (p Properties) GetString(key string) string {\n    return p[key].(string)\n}\n\ntype Nodes map[string]*Node\n\ntype Node struct {\n    *Properties\n}\n\nfunc main() {\n    allNodes := Nodes{\"1\": &amp;Node{&amp;Properties{\"test\": \"foo\"}}} // :'(\n    singleNode := allNodes[\"1\"]\n    fmt.Println(singleNode.GetString(\"test\"))\n}\n</code></pre>\n\n<p>Ultimately, I would like to do something like the following.  Where <code>Node</code> is of type <code>Properties</code> and initializing does not require initializing a <code>Property</code> struct too.  The following code doesn't work but may be clear what my goal is.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Properties map[string]interface{}\n\nfunc (p Properties) GetString(key string) string {\n    return p[key].(string)\n}\n\ntype Nodes map[string]*Node\n\ntype Node Properties\n\nfunc main() {\n    allNodes := Nodes{\"1\": &amp;Node{\"test\": \"foo\"}} // :)\n    singleNode := allNodes[\"1\"]\n    fmt.Println(singleNode.GetString(\"test\")) // :D\n}\n</code></pre>\n\n<p>I'll be adding more structs that will use <code>Properties</code>'s methods which is why I'm asking.  If I only had <code>Node</code>, I would just have methods for <code>Node</code> and be done.  But because I'll have more than <code>Node</code> I find it kind of redundant to add the same methods to all the structs that embed <code>Properties</code></p>\n\n<p>I guess more to the exact problem, I want to use <code>Properties</code> methods from <code>Node</code> without having to initialize <code>Properties</code>.</p>\n"}, {"tags": ["go", "binaryfiles"], "comments": [{"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 1, "creation_date": 1449193052, "post_id": 34078427, "comment_id": 55912208, "body": "Not being a Python dev there&#39;s only so much I can tell you ... but having had a quick look at the documentation for the <code>struct.pack</code> method, your <code>fmt</code> of <code>iih</code> means &quot;32 bit Integer, 32 bit Integer, 16 bit Short&quot;. Your struct in Go has three 32 bit integers ... not two 32 bit integers and a 16 bit short. There&#39;s also a few mentions of padding/alignment in the Python documentation so you need to take that in to consideration potentially."}, {"owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "reply_to_user": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 1, "creation_date": 1449200696, "post_id": 34078427, "comment_id": 55914164, "body": "Thank you Simon - that got me looking a bit closer at the data types and sizes.  Python i is 4 bytes and h is 2 bytes - I&#39;ve updated my code and am able to read the data and get the correct values now.  Now I need to figure out how to loop through the file."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1449226537, "post_id": 34078427, "comment_id": 55925519, "body": "You might want to have a look into <a href=\"https://en.m.wikipedia.org/wiki/Protocol_Buffers\" rel=\"nofollow noreferrer\">Protocol Buffers</a> which were created for exactly your use case. Works like a charm for me, though I use them for Golang to Java."}, {"owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "edited": false, "score": 0, "creation_date": 1449227920, "post_id": 34078427, "comment_id": 55926329, "body": "Thank you for the tip Markus.  I will check that out.  I figured out A solution but would certainly like to use the most appropriate solution.  I also want to write the data too (same 4 byte and 2 byte ints) so I&#39;ll look into the Protocol Buffers for that too."}], "answers": [{"comments": [{"owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "edited": false, "score": 0, "creation_date": 1449228618, "post_id": 34087237, "comment_id": 55926731, "body": "The Python format string iih means two 4 byte ints followed by a 2 byte int per the documentation on packed binary via the Python struct: <a href=\"https://docs.python.org/2/library/struct.html\" rel=\"nofollow noreferrer\">docs.python.org/2/library/struct.html</a>  I figured out A solution, posted in an update, and am now looking for alternative solutions that would be more appropriate."}, {"owner": {"reputation": 128, "user_id": 2097649, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RXe2k.jpg?s=128&g=1", "display_name": "mjois", "link": "https://stackoverflow.com/users/2097649/mjois"}, "reply_to_user": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "edited": false, "score": 0, "creation_date": 1449228889, "post_id": 34087237, "comment_id": 55926905, "body": "If all your binary data is structured like this, I recommend the struct approach, as you can create a slice of binData structs and access each one&#39;s a,b,c attributes easily with the correct type."}, {"owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "edited": false, "score": 0, "creation_date": 1449238704, "post_id": 34087237, "comment_id": 55932795, "body": "mjois, I&#39;m not seeing how to go from the 4 and 2 byte integer arrays to the struct.  In my current working example I can go from those 4 and 2 byte arrays to the int32 and int16 but I don&#39;t see how to take it directly from those byte arrays to the struct.  Now, certainly I could assign what I have to the struct and then create a struct that contains the binData struct but that would seem to have a lot of overhead.  Any thoughts, examples of how you&#39;d go about it?"}, {"owner": {"reputation": 128, "user_id": 2097649, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RXe2k.jpg?s=128&g=1", "display_name": "mjois", "link": "https://stackoverflow.com/users/2097649/mjois"}, "reply_to_user": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "edited": false, "score": 0, "creation_date": 1449272298, "post_id": 34087237, "comment_id": 55950666, "body": "You don&#39;t need the integer arrays or byte arrays at all, you can just call <code>binary.Read</code> with the struct address as the third argument (you had it as your first attempt originally). Even better, you can create a slice <code>[]binData</code>, loop through the input and read a struct every iteration, then append to the slice. Even further better, if you know in advance you are going to read N structs, you can do <code>slice := make([]binData, N); binary.Read(fp, binary.LittleEndian, slice)</code>."}, {"owner": {"reputation": 128, "user_id": 2097649, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RXe2k.jpg?s=128&g=1", "display_name": "mjois", "link": "https://stackoverflow.com/users/2097649/mjois"}, "reply_to_user": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "edited": false, "score": 1, "creation_date": 1449380279, "post_id": 34087237, "comment_id": 55978493, "body": "I just tried...and it worked. I did have to change a,b,c to A,B,C to get them exported though, so <code>binary.Read</code> could fill them in. And I promise you this is the most Go-elegant way to do this."}, {"owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "edited": false, "score": 0, "creation_date": 1449502842, "post_id": 34087237, "comment_id": 56022523, "body": "I just tested again and <b>you are right, it DOES work</b> and it is certainly the most Go-elegant way posted thus far - thank you! I am re-testing on my work computer now but had originally tested at home.  I&#39;m looking forward to reviewing the code at home again to see what I missed when testing this solution."}, {"owner": {"reputation": 1012, "user_id": 1767653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2cb101000ada68d5db2a87ef6a8c2add?s=128&d=identicon&r=PG", "display_name": "EvertW", "link": "https://stackoverflow.com/users/1767653/evertw"}, "edited": false, "score": 0, "creation_date": 1601060047, "post_id": 34087237, "comment_id": 113297479, "body": "&quot;the Python packing didn&#39;t specify the endianness explicitly&quot; The python package does explicitly specify endianness. The default endianness is &quot;native&quot;, i.e. the endianness native to your CPU, but you can set it to &#39;network&#39;, &#39;little&#39; or &#39;big&#39; endian by using specific format characters."}], "tags": [], "owner": {"reputation": 128, "user_id": 2097649, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RXe2k.jpg?s=128&g=1", "display_name": "mjois", "link": "https://stackoverflow.com/users/2097649/mjois"}, "is_accepted": true, "score": 4, "last_activity_date": 1449380514, "last_edit_date": 1449380514, "creation_date": 1449228164, "answer_id": 34087237, "question_id": 34078427, "link": "https://stackoverflow.com/questions/34078427/how-to-read-packed-binary-data-in-go/34087237#34087237", "title": "How to read packed binary data in Go?", "body": "<p>The Python format string is <code>iih</code>, meaning two 32-bit signed integers and one 16-bit signed integer (see the <a href=\"https://docs.python.org/2/library/struct.html#format-strings\" rel=\"nofollow\">docs</a>). You can simply use your first example but change the struct to:</p>\n\n<pre><code>type binData struct {\n    A int32\n    B int32\n    C int16\n}\n\nfunc main() {\n        fp, err := os.Open(\"tst.bin\")\n\n        if err != nil {\n                panic(err)\n        }\n\n        defer fp.Close()\n\n        for {\n            thing := binData{}\n            err := binary.Read(fp, binary.LittleEndian, &amp;thing)\n\n            if err == io.EOF{\n                break\n            }\n\n            fmt.Println(thing.A, thing.B, thing.C)\n        }\n}\n</code></pre>\n\n<p>Note that the Python packing didn't specify the endianness explicitly, but if you're sure the system that ran it generated little-endian binary, this should work.</p>\n\n<p><strong>Edit:</strong> Added <code>main()</code> function to explain what I mean.</p>\n\n<p><strong>Edit 2:</strong> Capitalized struct fields so <code>binary.Read</code> could write into them.</p>\n"}, {"tags": [], "owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "is_accepted": false, "score": 0, "last_activity_date": 1449239898, "creation_date": 1449239898, "answer_id": 34090756, "question_id": 34078427, "link": "https://stackoverflow.com/questions/34078427/how-to-read-packed-binary-data-in-go/34090756#34090756", "title": "How to read packed binary data in Go?", "body": "<p>As I mentioned in my post, I'm not sure this is THE idiomatic way to do this in Go but this is the solution that I came up with after a fair bit of tinkering and adapting several different examples.  Note again that this unpacks 4 and 2 byte int into Go int32 and int16 respectively.  Posting so that there is a valid answer in case someone comes looking.  Hopefully someone will post a more idiomatic way of accomplishing this but for now, this works.</p>\n\n<pre><code>package main\n\n    import (\n            \"fmt\"\n            \"os\"\n            \"encoding/binary\"\n            \"io\"\n            )\n\n    func main() {\n            fp, err := os.Open(\"tst.bin\")\n\n            if err != nil {\n                    panic(err)\n            }\n\n            defer fp.Close()\n\n            lineBuf := make([]byte, 10) //4 byte int, 4 byte int, 2 byte int per line\n\n            for true {\n                _, err := fp.Read(lineBuf)\n\n                if err == io.EOF{\n                    break\n                }\n\n                aVal := int32(binary.LittleEndian.Uint32(lineBuf[0:4])) // same as: int32(uint32(b[0]) | uint32(b[1])&lt;&lt;8 | uint32(b[2])&lt;&lt;16 | uint32(b[3])&lt;&lt;24)\n                bVal := int32(binary.LittleEndian.Uint32(lineBuf[4:8]))\n                cVal := int16(binary.LittleEndian.Uint16(lineBuf[8:10])) //same as: int16(uint32(b[0]) | uint32(b[1])&lt;&lt;8)\n                fmt.Println(aVal, bVal, cVal)\n            }\n    }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "edited": false, "score": 0, "creation_date": 1449241670, "post_id": 34091278, "comment_id": 55934839, "body": "Markus, thank you so much for the example! I&#39;ll be stepping through and comparing.  I will be reading some large binary files at times up to ~ 80GB so this is helpful.  As you know there is a huge difference between working and working well with enough performance!"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "edited": false, "score": 0, "creation_date": 1449241939, "post_id": 34091278, "comment_id": 55935001, "body": "@ChrisTownsend Feel free to use the code from the repo: It is licensed under the polite version of the WTFPL."}], "tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 4, "last_activity_date": 1613156767, "last_edit_date": 1613156767, "creation_date": 1449241460, "answer_id": 34091278, "question_id": 34078427, "link": "https://stackoverflow.com/questions/34078427/how-to-read-packed-binary-data-in-go/34091278#34091278", "title": "How to read packed binary data in Go?", "body": "<p>A well portable and rather easy way to handle the problem are <a href=\"https://developers.google.com/protocol-buffers/\" rel=\"nofollow noreferrer\">Google's &quot;Protocol Buffers&quot;</a>. Though this is too late now since you got it working, I took some effort in explaining and coding it, so I am posting it anyway.</p>\n<p>You can find the code on <a href=\"https://github.com/mwmahlberg/ProtoBufDemo\" rel=\"nofollow noreferrer\">https://github.com/mwmahlberg/ProtoBufDemo</a></p>\n<p>You need to install the protocol buffers for python using your preferred method (pip, OS package management, source) and for <a href=\"https://github.com/golang/protobuf\" rel=\"nofollow noreferrer\">Go</a></p>\n<h2>The <code>.proto</code> file</h2>\n<p>The <code>.proto</code> file is rather simple for our example. I called it <code>data.proto</code></p>\n<pre class=\"lang-porto prettyprint-override\"><code>syntax = &quot;proto2&quot;;\npackage main;\n\nmessage Demo {\n  required uint32  A = 1;\n  required uint32 B = 2;\n\n  // A shortcomning: no 16 bit ints\n  // We need to make this sure in the applications\n  required uint32 C = 3;\n}\n</code></pre>\n<p>Now you need to call <code>protoc</code> on the file and have it provide the code for both Python and Go:</p>\n<pre><code>protoc --go_out=. --python_out=. data.proto\n</code></pre>\n<p>which generates the files <code>data_pb2.py</code> and <code>data.pb.go</code>. Those files provide the language specific access to the protocol buffer data.</p>\n<p>When using the code from github, all you need to do is to issue</p>\n<pre><code>go generate\n</code></pre>\n<p>in the source directory.</p>\n<h2>The Python code</h2>\n<pre><code>import data_pb2\n\ndef main():\n\n    # We create an instance of the message type &quot;Demo&quot;...\n    data = data_pb2.Demo()\n\n    # ...and fill it with data\n    data.A = long(5)\n    data.B = long(5)\n    data.C = long(2015)\n\n\n    print &quot;* Python writing to file&quot;\n    f = open('tst.bin', 'wb')\n\n    # Note that &quot;data.SerializeToString()&quot; counterintuitively\n    # writes binary data\n    f.write(data.SerializeToString())\n    f.close()\n\n    f = open('tst.bin', 'rb')\n    read = data_pb2.Demo()\n    read.ParseFromString(f.read())\n    f.close()\n\n    print &quot;* Python reading from file&quot;\n    print &quot;\\tDemo.A: %d, Demo.B: %d, Demo.C: %d&quot; %(read.A, read.B, read.C)\n\nif __name__ == '__main__':\n    main()\n</code></pre>\n<p>We import the file generated by <code>protoc</code> and use it. Not much magic here.</p>\n<h2>The Go File</h2>\n<pre><code>package main\n\n//go:generate protoc --python_out=. data.proto\n//go:generate protoc --go_out=. data.proto\nimport (\n    &quot;fmt&quot;\n    &quot;os&quot;\n\n    &quot;github.com/golang/protobuf/proto&quot;\n)\n\nfunc main() {\n\n    // Note that we do not handle any errors for the sake of brevity\n    d := Demo{}\n    f, _ := os.Open(&quot;tst.bin&quot;)\n    fi, _ := f.Stat()\n\n    // We create a buffer which is big enough to hold the entire message\n    b := make([]byte,fi.Size())\n\n    f.Read(b)\n\n    proto.Unmarshal(b, &amp;d)\n    fmt.Println(&quot;* Go reading from file&quot;)\n\n    // Note the explicit pointer dereference, as the fields are pointers to a pointers\n    fmt.Printf(&quot;\\tDemo.A: %d, Demo.B: %d, Demo.C: %d\\n&quot;,*d.A,*d.B,*d.C)\n}\n</code></pre>\n<p>Note that we do not need to explicitly import, as the package of <code>data.proto</code> is <code>main</code>.</p>\n<h2>The result</h2>\n<p>After generation the required files and compiling the source, when you issue</p>\n<pre><code>$ python writer.py &amp;&amp; ./ProtoBufDemo\n</code></pre>\n<p>the result is</p>\n<pre><code>* Python writing to file\n* Python reading from file\n    Demo.A: 5, Demo.B: 5, Demo.C: 2015\n* Go reading from file\n    Demo.A: 5, Demo.B: 5, Demo.C: 2015\n</code></pre>\n<p>Note that the Makefile in the repository offers a shorcut for generating the code, compiling the <code>.go</code> files and run both programs:</p>\n<pre><code>make run\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 445, "user_id": 4265763, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_XuweyYACIs/AAAAAAAAAAI/AAAAAAAAAEI/OvebLDs1Rlo/photo.jpg?sz=128", "display_name": "Sirui Zhuang", "link": "https://stackoverflow.com/users/4265763/sirui-zhuang"}, "is_accepted": false, "score": 0, "last_activity_date": 1455203911, "creation_date": 1455203911, "answer_id": 35343149, "question_id": 34078427, "link": "https://stackoverflow.com/questions/34078427/how-to-read-packed-binary-data-in-go/35343149#35343149", "title": "How to read packed binary data in Go?", "body": "<p>Try <a href=\"https://github.com/zhuangsirui/binpacker\" rel=\"nofollow\">binpacker</a> libary.</p>\n\n<h2>Example:</h2>\n\n<p>Example data:</p>\n\n<pre><code>buffer := new(bytes.Buffer)\npacker := binpacker.NewPacker(buffer)\nunpacker := binpacker.NewUnpacker(buffer)\npacker.PushByte(0x01)\npacker.PushUint16(math.MaxUint16)\n</code></pre>\n\n<p>Unpack:</p>\n\n<pre><code>var val1 byte\nvar val2 uint16\nvar err error\nval1, err = unpacker.ShiftByte()\nval2, err = unpacker.ShiftUint16()\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>var val1 byte\nvar val2 uint16\nvar err error\nunpacker.FetchByte(&amp;val1).FetchUint16(&amp;val2)\nunpacker.Error() // Make sure error is nil\n</code></pre>\n"}], "owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5941, "favorite_count": 1, "accepted_answer_id": 34087237, "answer_count": 4, "score": 7, "last_activity_date": 1613156767, "creation_date": 1449186224, "last_edit_date": 1449229998, "question_id": 34078427, "link": "https://stackoverflow.com/questions/34078427/how-to-read-packed-binary-data-in-go", "title": "How to read packed binary data in Go?", "body": "<p>I'm trying to figure out the best way to read a packed binary file in Go that was produced by Python like the following:</p>\n\n<pre><code>import struct\nf = open('tst.bin', 'wb')\nfmt = 'iih' #please note this is packed binary: 4byte int, 4byte int, 2byte int\nf.write(struct.pack(fmt,4, 185765, 1020))\nf.write(struct.pack(fmt,4, 185765, 1022))\nf.close()\n</code></pre>\n\n<p>I have been tinkering with some of the examples I've seen on Github.com and a few other sources <del>but I can't seem to get anything working correctly</del> (update shows working method).  <strong>What is the idiomatic way to do this sort of thing in Go?</strong> This is one of several attempts</p>\n\n<p><strong>UPDATE and WORKING</strong></p>\n\n<pre><code>package main\n\n    import (\n            \"fmt\"\n            \"os\"\n            \"encoding/binary\"\n            \"io\"\n            )\n\n    func main() {\n            fp, err := os.Open(\"tst.bin\")\n\n            if err != nil {\n                    panic(err)\n            }\n\n            defer fp.Close()\n\n            lineBuf := make([]byte, 10) //4 byte int, 4 byte int, 2 byte int per line\n\n            for true {\n                _, err := fp.Read(lineBuf)\n\n                if err == io.EOF{\n                    break\n                }\n\n                aVal := int32(binary.LittleEndian.Uint32(lineBuf[0:4])) // same as: int32(uint32(b[0]) | uint32(b[1])&lt;&lt;8 | uint32(b[2])&lt;&lt;16 | uint32(b[3])&lt;&lt;24)\n                bVal := int32(binary.LittleEndian.Uint32(lineBuf[4:8]))\n                cVal := int16(binary.LittleEndian.Uint16(lineBuf[8:10])) //same as: int16(uint32(b[0]) | uint32(b[1])&lt;&lt;8)\n                fmt.Println(aVal, bVal, cVal)\n            }\n    }\n</code></pre>\n"}, {"tags": ["go", "binaryfiles"], "comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 1, "creation_date": 1449183752, "post_id": 34077889, "comment_id": 55909255, "body": "show people the result of your tinkering and where are you stuck"}, {"owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 1, "creation_date": 1449230428, "post_id": 34077889, "comment_id": 55927823, "body": "Salvador, I&#39;ve mostly been working on the read end of this at the moment <a href=\"http://stackoverflow.com/questions/34078427/how-to-read-packed-binary-data-in-go\" title=\"how to read packed binary data in go\">stackoverflow.com/questions/34078427/&hellip;</a> I&#39;ll post my code once it is not embarrassing."}, {"owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1449233262, "post_id": 34077889, "comment_id": 55929449, "body": "Working example posted but still would love feedback on a better, more idiomatic way of doing this."}], "answers": [{"tags": [], "owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "is_accepted": false, "score": 0, "last_activity_date": 1449241441, "last_edit_date": 1449241441, "creation_date": 1449240131, "answer_id": 34090841, "question_id": 34077889, "link": "https://stackoverflow.com/questions/34077889/what-is-the-idiomatic-way-to-write-a-packed-binary-file-in-go-that-would-produce/34090841#34090841", "title": "What is the idiomatic way to write a packed binary file in Go that would produce the same output as this Python?", "body": "<p>As I mentioned in my question, I'm not sure this is THE idiomatic way to do this but after a fair bit of tinkering this does solve the problem I was having.  Posting so there is at least one answer in case someone else comes looking:</p>\n\n<pre><code>package main\nimport (\n        \"fmt\"\n        \"os\"\n        \"encoding/binary\"\n        )\n\n\nfunc main() {\n        fp, err := os.Create(\"tst.bin\")\n\n        if err != nil {\n                panic(err)\n        }\n\n        defer fp.Close()\n\n        aBuf := make([]byte, 4)\n        bBuf := make([]byte, 4)\n        cBuf := make([]byte, 2)\n\n        binary.LittleEndian.PutUint32(aBuf, 4)\n        binary.LittleEndian.PutUint32(bBuf, 185765)\n        binary.LittleEndian.PutUint16(cBuf, 1020)\n\n        binary.Write(fp, binary.LittleEndian, aBuf)\n        binary.Write(fp, binary.LittleEndian, bBuf)\n        binary.Write(fp, binary.LittleEndian, cBuf)\n}\n</code></pre>\n\n<p>Slightly cleaning this up to make it more brief I'll be doing something like this:</p>\n\n<pre><code>func main() {\n        fp, err := os.Create(\"tst.bin\")\n\n        if err != nil {\n                panic(err)\n        }\n\n        defer fp.Close()\n\n        lineBuf := make([]byte, 10) //sized large enough to hold my two 4 byte ints and one 2 byte int\n\n        binary.LittleEndian.PutUint32(lineBuf[0:4], 4) //packing into 4 bytes\n        binary.LittleEndian.PutUint32(lineBuf[4:8], 185765) \n        binary.LittleEndian.PutUint16(lineBuf[8:10], 1020) //packing into 2 bytes\n\n        binary.Write(fp, binary.LittleEndian, lineBuf)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "is_accepted": true, "score": 0, "last_activity_date": 1449503823, "creation_date": 1449503823, "answer_id": 34137822, "question_id": 34077889, "link": "https://stackoverflow.com/questions/34077889/what-is-the-idiomatic-way-to-write-a-packed-binary-file-in-go-that-would-produce/34137822#34137822", "title": "What is the idiomatic way to write a packed binary file in Go that would produce the same output as this Python?", "body": "<p>After a little more tinkering and some feedback on another question I was able to come up with this (seems much cleaner but will post feedback on performance after testing with generating some large files):</p>\n\n<pre><code>package main\nimport (\n        \"os\"\n        \"encoding/binary\"\n        )\n\ntype binData struct {\n    A int32\n    B int32\n    C int16\n}\n\nfunc main() {\n        fp, err := os.Create(\"tst.bin\")\n\n        if err != nil {\n                panic(err)\n        }\n\n        defer fp.Close()\n        bd := binData{A:4, B:185765, C:1020}\n\n        binary.Write(fp, binary.LittleEndian, &amp;bd)\n}\n</code></pre>\n"}], "owner": {"reputation": 2532, "user_id": 809198, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/f9aa79f93a3c988f32b7fa40d097c6be?s=128&d=identicon&r=PG", "display_name": "Chris Townsend", "link": "https://stackoverflow.com/users/809198/chris-townsend"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 0, "accepted_answer_id": 34137822, "answer_count": 2, "score": 0, "last_activity_date": 1449503823, "creation_date": 1449183671, "last_edit_date": 1449233580, "question_id": 34077889, "link": "https://stackoverflow.com/questions/34077889/what-is-the-idiomatic-way-to-write-a-packed-binary-file-in-go-that-would-produce", "title": "What is the idiomatic way to write a packed binary file in Go that would produce the same output as this Python?", "body": "<p>I'm trying to figure out <del>how</del> the best way to write a binary file in Go that corresponds with the following Python:</p>\n\n<pre><code>import struct\nf = open('tst.bin', 'wb')\nfmt = 'iih'\nf.write(struct.pack(fmt,4, 185765, 1020))\nf.close()\n</code></pre>\n\n<p>I have been tinkering with some of the examples I've seen on Github.com and a few other sources <del>but I can't seem to get anything working correctly</del>.  <strong>What is the idiomatic way to do this sort of thing in Go?</strong></p>\n\n<p>Here is how I am accomplishing this now (Golang):</p>\n\n<pre><code>package main\nimport (\n        \"fmt\"\n        \"os\"\n        \"encoding/binary\"\n        )\n\n\nfunc main() {\n        fp, err := os.Create(\"tst.bin\")\n\n        if err != nil {\n                panic(err)\n        }\n\n        defer fp.Close()\n\n        aBuf := make([]byte, 4)\n        bBuf := make([]byte, 4)\n        cBuf := make([]byte, 2)\n\n        binary.LittleEndian.PutUint32(aBuf, 4)\n        binary.LittleEndian.PutUint32(bBuf, 185765)\n        binary.LittleEndian.PutUint16(cBuf, 1020)\n\n        binary.Write(fp, binary.LittleEndian, aBuf)\n        binary.Write(fp, binary.LittleEndian, bBuf)\n        binary.Write(fp, binary.LittleEndian, cBuf)\n}\n</code></pre>\n\n<p>Verified with this Python:</p>\n\n<pre><code>import numpy as np\n\ndata = np.fromfile('tst.bin', dtype='i4,i4,i2')\n\nprint(data)\n</code></pre>\n"}, {"tags": ["go", "tcp"], "comments": [{"owner": {"reputation": 1105, "user_id": 3051060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dZeQp.jpg?s=128&g=1", "display_name": "rcmgleite", "link": "https://stackoverflow.com/users/3051060/rcmgleite"}, "edited": false, "score": 0, "creation_date": 1449175885, "post_id": 34075513, "comment_id": 55905035, "body": "check this answer <a href=\"http://stackoverflow.com/questions/17915952/golang-tcp-socket-does-not-send-message-after-write-immediately\" title=\"golang tcp socket does not send message after write immediately\">stackoverflow.com/questions/17915952/&hellip;</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1449176328, "post_id": 34075513, "comment_id": 55905295, "body": "The network doesn&#39;t care whether you send a <code>\\n</code> or not. Is this the <i>exact</i> code you&#39;re running?"}], "answers": [{"comments": [{"owner": {"reputation": 1105, "user_id": 3051060, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dZeQp.jpg?s=128&g=1", "display_name": "rcmgleite", "link": "https://stackoverflow.com/users/3051060/rcmgleite"}, "edited": false, "score": 0, "creation_date": 1449182402, "post_id": 34076134, "comment_id": 55908705, "body": "Tested here too. version go1.4.2 linux/amd64 and works fine"}, {"owner": {"reputation": 11, "user_id": 5636711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a83d53db87af8388340c7ba53bea58e3?s=128&d=identicon&r=PG&f=1", "display_name": "Aptann", "link": "https://stackoverflow.com/users/5636711/aptann"}, "edited": false, "score": 0, "creation_date": 1449184599, "post_id": 34076134, "comment_id": 55909650, "body": "Just tried 1.5.1 linux/amd64, works as expected. I guess it&#39;s a bug?"}], "tags": [], "owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "is_accepted": false, "score": 0, "last_activity_date": 1449176835, "creation_date": 1449176835, "answer_id": 34076134, "question_id": 34075513, "link": "https://stackoverflow.com/questions/34075513/tcpconn-write-does-nothing-until-socket-closes-or-newline-is-written/34076134#34076134", "title": "TCPConn Write does nothing until socket closes or newline is written", "body": "<p>Running the code verbatim (client write hello world remains commented) shows: </p>\n\n<p>Server:</p>\n\n<pre><code>2015/12/04 09:57:00 client connected\n2015/12/04 09:57:00 got: hello\n2015/12/04 09:57:01 got: hello\n2015/12/04 09:57:02 got: hello\n2015/12/04 09:57:03 got: hello\n2015/12/04 09:57:04 got: hello\n2015/12/04 09:57:06 client disconnected\n</code></pre>\n\n<p>Client:</p>\n\n<pre><code>2015/12/04 09:57:00 wrote hello\n2015/12/04 09:57:01 wrote hello\n2015/12/04 09:57:02 wrote hello\n2015/12/04 09:57:03 wrote hello\n2015/12/04 09:57:04 wrote hello\n</code></pre>\n\n<p>It seems to work as expected, the server outputs once per second, as the client writes.</p>\n\n<p>This was tested on:\ngo version devel +54bd5a7 Sat Nov 21 10:19:16 2015 +0000 linux/amd64</p>\n\n<p>What go version are you running?</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 5636711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a83d53db87af8388340c7ba53bea58e3?s=128&d=identicon&r=PG&f=1", "display_name": "Aptann", "link": "https://stackoverflow.com/users/5636711/aptann"}, "is_accepted": true, "score": 0, "last_activity_date": 1449490915, "last_edit_date": 1449490915, "creation_date": 1449243697, "answer_id": 34092000, "question_id": 34075513, "link": "https://stackoverflow.com/questions/34075513/tcpconn-write-does-nothing-until-socket-closes-or-newline-is-written/34092000#34092000", "title": "TCPConn Write does nothing until socket closes or newline is written", "body": "<p>Thanks for giving it a go, I ran it on a Ubuntu vm where it worked as expected. So, as of 1.5.1 for Windows, it seems to be a bug.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>Turns out it's Eset Smart Security's protocol filtering, go isn't the culprit</p>\n"}], "owner": {"reputation": 11, "user_id": 5636711, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a83d53db87af8388340c7ba53bea58e3?s=128&d=identicon&r=PG&f=1", "display_name": "Aptann", "link": "https://stackoverflow.com/users/5636711/aptann"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 996, "favorite_count": 1, "accepted_answer_id": 34092000, "answer_count": 2, "score": 1, "last_activity_date": 1449490915, "creation_date": 1449174413, "question_id": 34075513, "link": "https://stackoverflow.com/questions/34075513/tcpconn-write-does-nothing-until-socket-closes-or-newline-is-written", "title": "TCPConn Write does nothing until socket closes or newline is written", "body": "<p>Calling TCPConn.Write without any newline or null byte delimiter doesn't seem to do anything until the socket or writer is closed.</p>\n\n<p>In this example I'd expect conn.Write to trigger the read on the server as soon as the write is complete, but nothing happens until the socket is closed. If I Write a string with a newline character before writing the ones without it works fine. Is this intended behavior? Are delimiters required? Or am I just missing something here..</p>\n\n<p>Server</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net\"\n)\n\nfunc main() {\n    addr, _ := net.ResolveTCPAddr(\"tcp4\", \":8080\")\n    l, err := net.ListenTCP(\"tcp4\", addr)\n    if err != nil {\n        log.Fatal(err.Error())\n    }\n\n    defer l.Close()\n\n    for {\n        var conn *net.TCPConn\n        if conn, err = l.AcceptTCP(); err != nil {\n            log.Println(err.Error())\n            continue\n        }\n\n        log.Println(\"client connected\")\n        go handleConnection(conn)\n    }\n}\n\nfunc handleConnection(conn *net.TCPConn) {\n    defer conn.Close()\n\n    for {\n        var b = make([]byte, 128)\n        bytesRead, err := conn.Read(b)\n        if err != nil {\n            break\n        }\n\n        log.Printf(\"got: %s\\n\", string(b[:bytesRead]))\n    }\n\n    log.Println(\"client disconnected\")\n}\n</code></pre>\n\n<p>Client</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net\"\n    \"time\"\n)\n\nfunc main() {\n    addr, _ := net.ResolveTCPAddr(\"tcp\", \"localhost:8080\")\n    conn, err := net.DialTCP(\"tcp\", nil, addr)\n    if err != nil {\n        log.Fatal(err.Error())\n    }\n\n    // uncommenting the following line will make the following writes work as expected\n    //conn.Write([]byte(\"hello world\\n\"))\n\n    for i := 0; i &lt; 5; i++ {\n        conn.Write([]byte(\"hello\"))\n        log.Println(\"wrote hello\")\n        time.Sleep(time.Second)\n    }\n\n    time.Sleep(time.Second)\n    conn.Close()\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 3, "creation_date": 1449172842, "post_id": 34075029, "comment_id": 55903348, "body": "<a href=\"https://golang.org/ref/spec#Blank_identifier\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Blank_identifier</a> \u2014 please try to do a little bit more research before asking a question."}, {"owner": {"reputation": 409, "user_id": 2564491, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/91f1466f57d4beb59fb98bc5263b2b4e?s=128&d=identicon&r=PG", "display_name": "mid", "link": "https://stackoverflow.com/users/2564491/mid"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1512317467, "post_id": 34075029, "comment_id": 82198538, "body": "@9000 Yes, and <a href=\"https://stackoverflow.com/questions/11227809/why-is-it-faster-to-process-a-sorted-array-than-an-unsorted-array\">ridiculous</a> <a href=\"https://stackoverflow.com/questions/927358/how-to-undo-the-last-commits-in-git\">questions</a> <a href=\"https://stackoverflow.com/questions/477816/what-is-the-correct-json-content-type\">like</a> <a href=\"https://stackoverflow.com/questions/231767/what-does-the-yield-keyword-do\">these</a> get upvoted. The whole point of StackOverflow is to ask."}, {"owner": {"reputation": 769, "user_id": 6155692, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/0e4ef26e040c1b1fbc5f10777e5b0649?s=128&d=identicon&r=PG&f=1", "display_name": "Zac", "link": "https://stackoverflow.com/users/6155692/zac"}, "reply_to_user": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 2, "creation_date": 1537701633, "post_id": 34075029, "comment_id": 91872846, "body": "@9000 Also, if you didn&#39;t know it was called a blank identifier, I imagine it would be fairly difficult to find the answer"}], "answers": [{"comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 1, "creation_date": 1449175327, "post_id": 34075092, "comment_id": 55904736, "body": "Do not write answers to duplicates. Close them: <a href=\"http://stackoverflow.com/q/27764421/1090562\">stackoverflow.com/q/27764421/1090562</a>"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1449176011, "post_id": 34075092, "comment_id": 55905104, "body": "good point. I&#39;ll vote close and delete. Except I can&#39;t delete now."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 8, "last_activity_date": 1449172875, "creation_date": 1449172875, "answer_id": 34075092, "question_id": 34075029, "link": "https://stackoverflow.com/questions/34075029/what-does-mean/34075092#34075092", "title": "What does _, mean?", "body": "<p>Because <code>os.Stat</code> returns two values, you have to have somewhere to receive those if you want any of them. The <code>_</code> is a placeholder that essentially means \"I don't care about this particular return value.\" Here, we only care to check the error, but don't need to do anything with the actual FileInfo Stat gives us.</p>\n\n<p>The compiler will just throw that value away. </p>\n"}], "owner": {"reputation": 533, "user_id": 5613000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d21885cdf3eab3a31152c12315051c78?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan Fitzpatrick", "link": "https://stackoverflow.com/users/5613000/ryan-fitzpatrick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3207, "favorite_count": 2, "closed_date": 1449176219, "accepted_answer_id": 34075092, "answer_count": 1, "score": 4, "last_activity_date": 1589789898, "creation_date": 1449172642, "last_edit_date": 1589789898, "question_id": 34075029, "link": "https://stackoverflow.com/questions/34075029/what-does-mean", "closed_reason": "Duplicate", "title": "What does _, mean?", "body": "<p>I'm new to Go and came across this line of code while browsing through some other threads:</p>\n\n<pre><code>if _, err := os.Stat(\"/path/to/whatever\"); os.IsNotExist(err)\n</code></pre>\n\n<p>What does the _, after the if mean? Is it specifying that something will be assigned in the if condition (as it appears is happening with err)? I couldn't find an example of this syntax on the wiki and I'm very curious to see what it's used for.</p>\n\n<p>Here's a link to the thread I was looking at if it helps:\n<a href=\"https://stackoverflow.com/questions/12518876/how-to-check-if-a-file-exists-in-go\">How to check if a file exists in Go?</a></p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1449169009, "post_id": 34073844, "comment_id": 55901115, "body": "like so? <a href=\"http://stackoverflow.com/questions/32346117/unmarshalling-a-json-that-may-or-may-not-return-an-array\" title=\"unmarshalling a json that may or may not return an array\">stackoverflow.com/questions/32346117/&hellip;</a>"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1449170235, "post_id": 34073844, "comment_id": 55901835, "body": "You definitely could but it would probably be a lot easier to just try with one type and if it fails try the other. Few other little things worth mentioning; 1) you can definitely have a single <code>Person</code> definition with <code>Name</code>, <code>Address</code> and <code>Pet</code>., 2) your first json snippet is one closing brace short of being valid. 3) in both cases there is an outer object which you don&#39;t account for in the models posted here (ie it is an object that contains an array called people which has objects of type person, not an array with objects of type person)."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1449172121, "post_id": 34073844, "comment_id": 55902965, "body": "Easier maybe isn&#39;t correct. To do it nicely you still have to write some code, I just think it&#39;s simpler to reason about. I recommend exposing a single type or interface and within the package where you unmarhsal while hiding the actual types you use. What you expose should be dictated by what&#39;s more intuitive for consumers. Like if the array response could have more than 2 Person&#39;s in it, I&#39;d probably just return an array. Maybe I&#39;d add a <code>Role</code> field and assign <code>&quot;admin&quot;</code> or <code>&quot;user&quot;</code> there when the response is of the first form. If it&#39;s always an admin and user I&#39;d just return the first type."}], "answers": [{"tags": [], "owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "is_accepted": false, "score": 0, "last_activity_date": 1450288446, "creation_date": 1450288446, "answer_id": 34318883, "question_id": 34073844, "link": "https://stackoverflow.com/questions/34073844/go-unmarshall-json-whose-key-can-be-one-of-2-types/34318883#34318883", "title": "Go Unmarshall json whose key can be one of 2 types", "body": "<p>I'd decode <code>people</code> to a map then do type assertion to figure whether it's an array or an object.</p>\n"}], "owner": {"reputation": 11, "user_id": 2209645, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6ba2db4666214f5c1d961e073754bdd?s=128&d=identicon&r=PG", "display_name": "user2209645", "link": "https://stackoverflow.com/users/2209645/user2209645"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1450288446, "creation_date": 1449168500, "question_id": 34073844, "link": "https://stackoverflow.com/questions/34073844/go-unmarshall-json-whose-key-can-be-one-of-2-types", "title": "Go Unmarshall json whose key can be one of 2 types", "body": "<p>An api endpoint, not within my control, returns json with a key people that can have one of 2 types.</p>\n\n<p>Json:</p>\n\n<pre><code>{\n    \"people\":{\n       \"admin\":{\n           \"Name\": \"John Smith\",\n           \"Address\": \"123 main street\"\n        },\n       \"user\":{\n           \"Name\": \"Jane Doe\",\n           \"Address\": \"321 broad street\",\n       }\n}\n</code></pre>\n\n<p>Json type 2:</p>\n\n<pre><code>{\n    \"people\":[\n        {\n            \"name\": \"Jon Snow\",\n            \"pet\": \"Ghost\"\n        },\n        {\n            \"name\": \"Sansa Stark\",\n            \"pet\": \"Lady\",\n        }\n    ]\n}\n</code></pre>\n\n<p>For the first type, I can create a structs as so</p>\n\n<pre><code>type People struct {\n   Admin *Person `json:\"admin,omitempty\"`\n   User  *Person `json:\"user,omitempty\"`\n}\n\ntype Person struct {\n   Name string `json:\"name,omitempty\"`\n   Address string `json:\"adress,omitempty\"`\n}\n</code></pre>\n\n<p>or the second type as</p>\n\n<pre><code>type People []*Person\ntype Person struct{\n    Name string `json:\"name,omitempty\"`\n    Pet  string `json:\"pet,omitempty\"`\n}\n</code></pre>\n\n<p>Is there a way to design a single struct such that I can unmarshal either type of response?</p>\n"}, {"tags": ["http", "go", "server", "standard-library"], "answers": [{"comments": [{"owner": {"reputation": 10150, "user_id": 341362, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/deb483e59f08e28083464e8e35a352db?s=128&d=identicon&r=PG", "display_name": "Charles", "link": "https://stackoverflow.com/users/341362/charles"}, "edited": false, "score": 0, "creation_date": 1449167877, "post_id": 34073501, "comment_id": 55900393, "body": "So you recommend using <code>WriteHeader</code> and <code>io.WriteString</code> directly?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 10150, "user_id": 341362, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/deb483e59f08e28083464e8e35a352db?s=128&d=identicon&r=PG", "display_name": "Charles", "link": "https://stackoverflow.com/users/341362/charles"}, "edited": false, "score": 0, "creation_date": 1449169042, "post_id": 34073501, "comment_id": 55901134, "body": "@Charles that would be one way. Another option is to instantiate an instance of <code>http.Response</code> than then do <code>resp.Write(w)</code> and it will write the response into the <code>ResponseWriter</code>. That was you can explicitly set whatever values you want which is more what I was thinking of."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 3, "last_activity_date": 1449169292, "last_edit_date": 1449169292, "creation_date": 1449167229, "answer_id": 34073501, "question_id": 34073377, "link": "https://stackoverflow.com/questions/34073377/changing-http-code-with-http-servefile/34073501#34073501", "title": "Changing HTTP code with http.ServeFile", "body": "<p>From reading the source I don't see any way to change the status code (other than the method failing which means you won't get your error page served). I think it's implied that if the files is served then it was an <code>HTTP 200</code> which isn't entirely unreasonable.</p>\n\n<p>I recommend reading the error page file into a string then using this method; <a href=\"https://golang.org/pkg/net/http/#Error\" rel=\"nofollow\">https://golang.org/pkg/net/http/#Error</a></p>\n\n<p>EDIT: That may actually not be specific enough for you even. It wants the error message as plain text so what I suggested is likely a misuse. In which case you're left with no useful abstractions to do what you want.</p>\n\n<p>In response to comment, my personal preference would be something more along the line of; </p>\n\n<pre><code>func main() {\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/sendstrailers\", func(w http.ResponseWriter, req *http.Request) {\n        resp := &amp;http.Response{\n            StatusCode: 404,\n        }\n        resp.Write(w)\n    })\n}\n</code></pre>\n\n<p>but you could also just use <code>w.WriteHeader(http.StatusForbidden)</code> or whatever if that's your preference. Whatever better suites you needs. My experience would be with preparing response object in a scope different than that of the mux so for that reason I think I prefer the bit above (it makes more sense than having helper methods return unstructured data you then write in to the responsewriter).</p>\n"}], "owner": {"reputation": 10150, "user_id": 341362, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/deb483e59f08e28083464e8e35a352db?s=128&d=identicon&r=PG", "display_name": "Charles", "link": "https://stackoverflow.com/users/341362/charles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 1, "accepted_answer_id": 34073501, "answer_count": 1, "score": 3, "last_activity_date": 1449169292, "creation_date": 1449166766, "question_id": 34073377, "link": "https://stackoverflow.com/questions/34073377/changing-http-code-with-http-servefile", "title": "Changing HTTP code with http.ServeFile", "body": "<p>I'm writing a server in Go, and I'm currently implementing error pages (404, 500, etc.) I have files which can be served for these errors, but if I use <code>http.ServeFile</code> then I get HTTP code 200 instead of the appropriate code.</p>\n\n<p>Is there a way to change the status code, or do I need to rewrite <code>http.ServeFile</code> for this use case?</p>\n"}, {"tags": ["windows", "sockets", "go", "posix"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449167414, "post_id": 34073103, "comment_id": 55900076, "body": "why are you trying to bypass the <code>net</code> package? This makes your program non-portable, since windows and linux used different syscalls to manipulate sockets."}, {"owner": {"reputation": 43, "user_id": 4339576, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TGXyl.jpg?s=128&g=1", "display_name": "kindermoumoute", "link": "https://stackoverflow.com/users/4339576/kindermoumoute"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449173644, "post_id": 34073103, "comment_id": 55903774, "body": "To make it simple, my teacher wants it. :/"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449174409, "post_id": 34073103, "comment_id": 55904222, "body": "It&#39;s far from simple, but maybe it&#39;s a learning experience. Read the windows specific code in the net package, it&#39;s already done for you there (hint, windows doesn&#39;t use the <code>write</code> syscall on sockets)"}, {"owner": {"reputation": 43, "user_id": 4339576, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TGXyl.jpg?s=128&g=1", "display_name": "kindermoumoute", "link": "https://stackoverflow.com/users/4339576/kindermoumoute"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449186531, "post_id": 34073103, "comment_id": 55910348, "body": "Yeah as you said, it&#39;s a learning experience. The aim is to use POSIX librairys."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1449189084, "post_id": 34073103, "comment_id": 55911124, "body": "Except the Windows socket api is definitely not posix."}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 4339576, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TGXyl.jpg?s=128&g=1", "display_name": "kindermoumoute", "link": "https://stackoverflow.com/users/4339576/kindermoumoute"}, "edited": false, "score": 0, "creation_date": 1449179385, "post_id": 34075868, "comment_id": 55907092, "body": "Thank you so much @Abelardo, I just had to fix Len&#39;s type :  <code>Len: uint32(len(data),</code> and it works perfectly ! :)"}, {"owner": {"reputation": 599, "user_id": 4327041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ZbnQ.jpg?s=128&g=1", "display_name": "abm", "link": "https://stackoverflow.com/users/4327041/abm"}, "reply_to_user": {"reputation": 43, "user_id": 4339576, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TGXyl.jpg?s=128&g=1", "display_name": "kindermoumoute", "link": "https://stackoverflow.com/users/4339576/kindermoumoute"}, "edited": false, "score": 0, "creation_date": 1449179535, "post_id": 34075868, "comment_id": 55907196, "body": "No problem @kindermoumoute :) . will change that on my answer in case someone else needs it."}, {"owner": {"reputation": 43, "user_id": 4339576, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TGXyl.jpg?s=128&g=1", "display_name": "kindermoumoute", "link": "https://stackoverflow.com/users/4339576/kindermoumoute"}, "edited": false, "score": 0, "creation_date": 1452866729, "post_id": 34075868, "comment_id": 57367503, "body": "do you have an idea : <a href=\"http://stackoverflow.com/questions/34803056/wsarecv-doesnt-stop-reading\">link</a> ?"}], "tags": [], "owner": {"reputation": 599, "user_id": 4327041, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8ZbnQ.jpg?s=128&g=1", "display_name": "abm", "link": "https://stackoverflow.com/users/4327041/abm"}, "is_accepted": true, "score": 2, "last_activity_date": 1449179910, "last_edit_date": 1449179910, "creation_date": 1449175831, "answer_id": 34075868, "question_id": 34073103, "link": "https://stackoverflow.com/questions/34073103/use-socket-with-windows/34075868#34075868", "title": "Use socket with windows", "body": "<p>Like JimB mentioned, on Windows <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms742203%28v=vs.85%29.aspx?f=255&amp;MSPPError=-2147217396\" rel=\"nofollow\">WSASend</a> is used to send data over the network. </p>\n\n<p>So basically, what you have to change on your client code is:</p>\n\n<pre><code> _, err = s.Write(sd, make([]byte, 500,42))\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>data := make([]byte, 4)\nbuf := &amp;s.WSABuf{\n    Len: uint32(len(data)),\n    Buf: &amp;data[0],\n}\nvar sent *uint32\noverlapped := s.Overlapped{}\ncroutine := byte(0)\n\nerr = s.WSASendto(sd, buf, 1, sent, uint32(0), &amp;sa, &amp;overlapped, &amp;croutine)\ncheck(err)\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 4339576, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TGXyl.jpg?s=128&g=1", "display_name": "kindermoumoute", "link": "https://stackoverflow.com/users/4339576/kindermoumoute"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 34075868, "answer_count": 1, "score": 2, "last_activity_date": 1449179910, "creation_date": 1449165829, "question_id": 34073103, "link": "https://stackoverflow.com/questions/34073103/use-socket-with-windows", "title": "Use socket with windows", "body": "<p>I'm currently working on a server/client project with go where I need to work with sockets without the net package. So I use POSIX functions I founded on syscall package. My server program in on Linux and my client in on Windows (8).</p>\n\n<p>So basically, I want to connect the client to the server. The problem is when the client wants to Write in the socket it says \"Fatal error : not supported by windows\".</p>\n\n<p>Client :</p>\n\n<pre><code>    package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"runtime\"\n    s \"syscall\"\n)\n\nconst (\n    MAXSIZE = 500\n    PORT    = 3000\n)\n\nvar (\n    ADDR = [4]byte{10, 8, 0, 1}\n)\n\nfunc Dial() (s.Handle, s.SockaddrInet4, error) {\n    var sa s.SockaddrInet4 = s.SockaddrInet4{Port: PORT, Addr: ADDR}\n    var d s.WSAData\n    var sd s.Handle\n\n    // a previous error told me to this\n    if runtime.GOOS == \"windows\" {\n        err := s.WSAStartup(uint32(0x202), &amp;d)\n        if err != nil {\n            return sd, sa, err\n        }\n    }\n\n    sd, err := s.Socket(s.AF_INET, s.SOCK_STREAM, 0)\n    if err != nil {\n        return sd, sa, err\n    }\n\n    s.Connect(sd, &amp;sa)\n    return sd, sa, err\n}\n\nfunc main() {\n    sd, sa, err := Dial()\n    check(err)\n    defer s.Close(sd)\n\n    _, err = s.Write(sd, make([]byte, 500,42))\n    check(err)\n}\n\nfunc check(err error) {\n    if err != nil {\n        fmt.Fprintf(os.Stderr, \"Fatal error: %s\", err.Error())\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<p>Server (works well) :</p>\n\n<pre><code>    package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    s \"syscall\"\n)\n\nconst (\n    PORT = 3000\n)\n\nfunc main() {\n    var sa s.SockaddrInet4\n    fmt.Println(sa)\n    fd, err := s.Socket(s.AF_INET, s.SOCK_STREAM, 0)\n    if err != nil {\n        check(err)\n    }\n    defer s.Close(fd)\n    if err := s.Bind(fd, &amp;s.SockaddrInet4{Port: PORT, Addr: [4]byte{0, 0, 0, 0}}); err != nil {\n        check(err)\n    }\n\n    if err := s.Listen(fd, 5); err != nil {\n        check(err)\n    }\n\n    for {\n        nfd, sa, err := s.Accept(fd)\n        if err != nil {\n            check(err)\n        }\n\n        go func(nfd int, sa s.Sockaddr) {\n            var n int\n\n            fmt.Println(sa)\n            defer s.Close(nfd)\n\n            b := make([]byte, 500)\n            n, err = s.Read(nfd, b)\n            check(err)\n            fmt.Println(n)\n\n        }(nfd, sa)\n    }\n}\n\nfunc check(err error) {\n    if err != nil {\n        fmt.Fprintf(os.Stderr, \"Fatal error: %s\", err.Error())\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<p>(Sry if my english is bad, I'm French)</p>\n"}, {"tags": ["go", "garbage-collection", "metrics"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 7, "last_activity_date": 1449164741, "creation_date": 1449164741, "answer_id": 34072767, "question_id": 34072626, "link": "https://stackoverflow.com/questions/34072626/collect-real-time-gc-metrics-golang/34072767#34072767", "title": "Collect real time GC metrics - Golang", "body": "<p>You can use the <code>GODEBUG=gctrace=1</code> to get continuous output, which is documented in the <a href=\"https://golang.org/pkg/runtime\" rel=\"noreferrer\">runtime package</a>.</p>\n\n<p>Otherwise, you need to collect information from <a href=\"https://golang.org/pkg/runtime/#MemStats\" rel=\"noreferrer\"><code>runtime.MemStats</code></a> and <a href=\"https://golang.org/pkg/runtime/debug/#GCStats\" rel=\"noreferrer\"><code>debug.GCStats</code></a>.</p>\n"}], "owner": {"reputation": 1992, "user_id": 1313897, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a90642da56ff524692c54a16449a3c2e?s=128&d=identicon&r=PG", "display_name": "Feras", "link": "https://stackoverflow.com/users/1313897/feras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2545, "favorite_count": 2, "accepted_answer_id": 34072767, "answer_count": 1, "score": 4, "last_activity_date": 1449164741, "creation_date": 1449164207, "question_id": 34072626, "link": "https://stackoverflow.com/questions/34072626/collect-real-time-gc-metrics-golang", "title": "Collect real time GC metrics - Golang", "body": "<p>Is there a straightforward way in Go to get information about the GC and heap sizes in order to expose them to a monitoring dashboard. I had a look at the runtime package but there doesnt seem to be anything that does that there. Ideally this shouldnt require any overhead like running the application in profiling mode, etc, but should be production ready.</p>\n"}, {"tags": ["string", "go", "slice"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "edited": false, "score": 6, "creation_date": 1449158362, "post_id": 34070369, "comment_id": 55894154, "body": "<a href=\"http://stackoverflow.com/questions/25025409/delete-element-in-a-slice\" title=\"delete element in a slice\">stackoverflow.com/questions/25025409/delete-element-in-a-sli&zwnj;&#8203;ce</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2316, "user_id": 2213164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wllwh.jpg?s=128&g=1", "display_name": "Stanislav", "link": "https://stackoverflow.com/users/2213164/stanislav"}, "edited": false, "score": 0, "creation_date": 1536843006, "post_id": 34070691, "comment_id": 91575314, "body": "Fails in cases with multiple occurrence such as <code>s := []string{&quot;one&quot;, &quot;two&quot;, &quot;two&quot;, &quot;three&quot;}</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2316, "user_id": 2213164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wllwh.jpg?s=128&g=1", "display_name": "Stanislav", "link": "https://stackoverflow.com/users/2213164/stanislav"}, "edited": false, "score": 0, "creation_date": 1536843089, "post_id": 34070691, "comment_id": 91575361, "body": "@Stanislav That&#39;s right, because intention was not to remove all occurrences, but to remove <i>a</i> string from a slice (as the question title says)."}, {"owner": {"reputation": 544, "user_id": 2469559, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/7DCjy.jpg?s=128&g=1", "display_name": "Benjamin R", "link": "https://stackoverflow.com/users/2469559/benjamin-r"}, "reply_to_user": {"reputation": 2316, "user_id": 2213164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wllwh.jpg?s=128&g=1", "display_name": "Stanislav", "link": "https://stackoverflow.com/users/2213164/stanislav"}, "edited": false, "score": 1, "creation_date": 1594607246, "post_id": 34070691, "comment_id": 111174473, "body": "In defence of @Stanislav I get where he is coming from. I have no idea why <code>append</code> is a built-in but <code>remove</code> is not. Especially, when dealing with slices of strings, these are standard functions that practically every language in broad use other than C comes with out of the box. How many times has this sort of function had to be implemented when it could have been included in the standard library? We have a <code>strings</code> library for operating on string types as a slice of runes. This is part of the problem with an interface definition only being fulfilled on structs..."}, {"owner": {"reputation": 659, "user_id": 1155514, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mjZMX.jpg?s=128&g=1", "display_name": "Muhammad Tariq", "link": "https://stackoverflow.com/users/1155514/muhammad-tariq"}, "edited": false, "score": 0, "creation_date": 1612874616, "post_id": 34070691, "comment_id": 116897504, "body": "Before removal, I have 2 elements <code>[602139dfb72f0dec8cf66da6 602139dfb72f0dec8cf66da7]</code> and after removal I get <code>[          602139dfb72f0dec8cf66da6]</code>. You can see that I am getting a space. Do I need to trim this ? and how?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 659, "user_id": 1155514, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mjZMX.jpg?s=128&g=1", "display_name": "Muhammad Tariq", "link": "https://stackoverflow.com/users/1155514/muhammad-tariq"}, "edited": false, "score": 1, "creation_date": 1612875208, "post_id": 34070691, "comment_id": 116897763, "body": "@MuhammadTariq No, you do not. I don&#39;t see your code so I can&#39;t help you. It works for me."}, {"owner": {"reputation": 659, "user_id": 1155514, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mjZMX.jpg?s=128&g=1", "display_name": "Muhammad Tariq", "link": "https://stackoverflow.com/users/1155514/muhammad-tariq"}, "edited": false, "score": 0, "creation_date": 1612877896, "post_id": 34070691, "comment_id": 116898928, "body": "@icza, Here is the code <code>for k, value := range mySlice{   if value == questionID {     myslice = append(mySlice[:k], mySlice[k+1:]...)     break     }  }</code> When I print <code>mySlice</code>, I get the space as defined in above comment."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1612878140, "post_id": 34070691, "comment_id": 116899029, "body": "You can&#39;t <code>range</code> over a slice and modify it at the same time. See <a href=\"https://stackoverflow.com/questions/29005825/how-to-remove-element-of-struct-array-in-loop-in-golang/29006008#29006008\">How to remove element of struct array in loop in golang</a>"}, {"owner": {"reputation": 659, "user_id": 1155514, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mjZMX.jpg?s=128&g=1", "display_name": "Muhammad Tariq", "link": "https://stackoverflow.com/users/1155514/muhammad-tariq"}, "edited": false, "score": 0, "creation_date": 1612879164, "post_id": 34070691, "comment_id": 116899510, "body": "Thanks @icza. Actually the problem was my slice declaration <code>var mySlice = make([]string,10)</code>. After some hit and try, I changed the capacity to ZERO <code>var mySlice = make([]string,0)</code> and it solved the problem. I checked with <code>range</code> and it gave me the correct result."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 18, "last_activity_date": 1503430808, "last_edit_date": 1503430808, "creation_date": 1449158682, "answer_id": 34070691, "question_id": 34070369, "link": "https://stackoverflow.com/questions/34070369/removing-a-string-from-a-slice-in-go/34070691#34070691", "title": "Removing a string from a slice in Go", "body": "<p>Find the element you want to remove and remove it like you would any element from any other slice.</p>\n\n<p>Finding it is a linear search. Removing is one of the following <a href=\"https://github.com/golang/go/wiki/SliceTricks\" rel=\"noreferrer\">slice tricks</a>:</p>\n\n<pre><code>a = append(a[:i], a[i+1:]...)\n// or\na = a[:i+copy(a[i:], a[i+1:])]\n</code></pre>\n\n<p>Here is the complete solution (try it on the <a href=\"http://play.golang.org/p/9vyR6W-41m\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>s := []string{\"one\", \"two\", \"three\"}\n\n// Find and remove \"two\"\nfor i, v := range s {\n    if v == \"two\" {\n        s = append(s[:i], s[i+1:]...)\n        break\n    }\n}\n\nfmt.Println(s) // Prints [one three]\n</code></pre>\n\n<p>If you want to wrap it into a function:</p>\n\n<pre><code>func remove(s []string, r string) []string {\n    for i, v := range s {\n        if v == r {\n            return append(s[:i], s[i+1:]...)\n        }\n    }\n    return s\n}\n</code></pre>\n\n<p>Using it:</p>\n\n<pre><code>s := []string{\"one\", \"two\", \"three\"}\ns = remove(s, \"two\")\nfmt.Println(s) // Prints [one three]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8320, "user_id": 1490882, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/eab10aa15343ee5af3d88a8f6275572c?s=128&d=identicon&r=PG", "display_name": "Romin", "link": "https://stackoverflow.com/users/1490882/romin"}, "is_accepted": false, "score": 1, "last_activity_date": 1449159741, "creation_date": 1449159741, "answer_id": 34071075, "question_id": 34070369, "link": "https://stackoverflow.com/questions/34070369/removing-a-string-from-a-slice-in-go/34071075#34071075", "title": "Removing a string from a slice in Go", "body": "<p>Here is a function to remove the element at a particular index:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"errors\"\n\nfunc main() {\n    strings := []string{}\n    strings = append(strings, \"one\")\n    strings = append(strings, \"two\")\n    strings = append(strings, \"three\")\n    strings, err := remove(strings, 1)\n    if err != nil {\n        fmt.Println(\"Something went wrong : \", err)\n    } else {\n        fmt.Println(strings)\n    }\n\n}\n\nfunc remove(s []string, index int) ([]string, error) {\n    if index &gt;= len(s) {\n        return nil, errors.New(\"Out of Range Error\")\n    }\n    return append(s[:index], s[index+1:]...), nil\n}\n</code></pre>\n\n<p>Try it on <a href=\"https://play.golang.org/p/6dBqnzx3SI\" rel=\"nofollow\">Go Playground</a> </p>\n"}], "owner": {"reputation": 289, "user_id": 4768715, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/55e2ba38b11b464ad4146a33abbb391d?s=128&d=identicon&r=PG&f=1", "display_name": "Patrick Reck", "link": "https://stackoverflow.com/users/4768715/patrick-reck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18864, "favorite_count": 1, "closed_date": 1449160930, "answer_count": 2, "score": 8, "last_activity_date": 1503430808, "creation_date": 1449157951, "last_edit_date": 1449210647, "question_id": 34070369, "link": "https://stackoverflow.com/questions/34070369/removing-a-string-from-a-slice-in-go", "closed_reason": "Duplicate", "title": "Removing a string from a slice in Go", "body": "<p>I have a slice of strings, and I want to remove a specific one.</p>\n\n<pre><code>strings := []string\nstrings = append(strings, \"one\")\nstrings = append(strings, \"two\")\nstrings = append(strings, \"three\")\n</code></pre>\n\n<p>Now how can I remove the string <code>\"two\"</code> from <code>strings</code>?</p>\n"}, {"tags": ["mongodb", "go"], "answers": [{"comments": [{"owner": {"reputation": 448, "user_id": 4742941, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03597e35f96065ea034b3baaeb27f908?s=128&d=identicon&r=PG&f=1", "display_name": "leylandski", "link": "https://stackoverflow.com/users/4742941/leylandski"}, "edited": false, "score": 0, "creation_date": 1449152680, "post_id": 34068087, "comment_id": 55889773, "body": "I know it&#39;s premature optimisation, but in your opinion is it better to have one session per service or a global session used by multiple services?"}, {"owner": {"reputation": 1775, "user_id": 1241805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e69b9940a6d0998eabedda2452d8e7c?s=128&d=identicon&r=PG", "display_name": "Ezequiel Moreno", "link": "https://stackoverflow.com/users/1241805/ezequiel-moreno"}, "reply_to_user": {"reputation": 448, "user_id": 4742941, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03597e35f96065ea034b3baaeb27f908?s=128&d=identicon&r=PG&f=1", "display_name": "leylandski", "link": "https://stackoverflow.com/users/4742941/leylandski"}, "edited": false, "score": 0, "creation_date": 1449208276, "post_id": 34068087, "comment_id": 55916296, "body": "You can share and copy the mongo session among services. Btw. If you think the answer is OK.. Could you please select accept it?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1449226954, "post_id": 34068087, "comment_id": 55925756, "body": "I object to always reuse a single session. All operations would share a single stack server side (which has a fixed size of 1MB). Actually, from my experience the best performance is to be gained by <code>.Copy()</code> a session (which retains authentication) in a &quot;StructFactory&quot; for large operations."}], "tags": [], "owner": {"reputation": 1775, "user_id": 1241805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e69b9940a6d0998eabedda2452d8e7c?s=128&d=identicon&r=PG", "display_name": "Ezequiel Moreno", "link": "https://stackoverflow.com/users/1241805/ezequiel-moreno"}, "is_accepted": true, "score": 4, "last_activity_date": 1449152100, "last_edit_date": 1449152100, "creation_date": 1449151554, "answer_id": 34068087, "question_id": 34067825, "link": "https://stackoverflow.com/questions/34067825/is-it-wise-to-keep-a-mongodb-session-open-for-the-lifetime-of-an-object/34068087#34068087", "title": "Is it wise to keep a MongoDB session open for the lifetime of an object?", "body": "<p>Opening a connection to MongoDB or any other DB is an expensive task that should be done once and kept operative as much as possible inside your service.</p>\n\n<p>You have three options:</p>\n\n<ol>\n<li>A local package level MongoDB instance.</li>\n<li>Using Contexts and  Composing Handlers.</li>\n<li>A method receiver which holds the MongoDB Instance.</li>\n</ol>\n\n<p>This is a <a href=\"http://www.alexedwards.net/blog/organising-database-access\" rel=\"nofollow\">very informative blog post</a> for handling DBs connections.\nTake a look to this <a href=\"https://medium.com/@matryer/production-ready-mongodb-in-go-for-beginners-ef6717a77219#.h2p93mbok\" rel=\"nofollow\">example</a>, especially for MongoDB</p>\n"}], "owner": {"reputation": 448, "user_id": 4742941, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03597e35f96065ea034b3baaeb27f908?s=128&d=identicon&r=PG&f=1", "display_name": "leylandski", "link": "https://stackoverflow.com/users/4742941/leylandski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 867, "favorite_count": 0, "accepted_answer_id": 34068087, "answer_count": 1, "score": 4, "last_activity_date": 1449152100, "creation_date": 1449150824, "question_id": 34067825, "link": "https://stackoverflow.com/questions/34067825/is-it-wise-to-keep-a-mongodb-session-open-for-the-lifetime-of-an-object", "title": "Is it wise to keep a MongoDB session open for the lifetime of an object?", "body": "<p>I have a struct that abstracts MongoDB for specific objects in my system, and during the factory function for it I set a few variables like hostname and other connection information. At the moment in each of the <code>UserService</code>'s methods* it creates a new session, does what it needs to, then closes the session when it's done.</p>\n\n<p>The system itself is the backend of a web application, so the lifetime of each <code>UserService</code> struct is usually only a few seconds at most, but more than one operation might be performed for each request that comes in. So I'm wondering whether to make <code>session</code> a member of the struct, initialise it when I create my <code>UserService</code>, and then ensure the request handler function that creates it calls a close function once it's done all the operations it needs to. I haven't been able to find anything that encourages or discourages this behaviour so I'm not really sure if the mgo package I'm using is designed that way.</p>\n\n<p>This is my proposed code:</p>\n\n<pre><code>type UserService struct {\n    callingUserId id.ID //The ID of the user calling this service.\n    host string //The host name.\n    session mgo.Session //The active session.\n}\n\nfunc NewUserService(userId id.ID) *UserService {\n    nus := new(UserService)\n    nus.callingUserId = userId\n    nus.host = \"localhost\" //TODO change this to read from file or buffer.\n    nus.session, sessionErr = mgo.Dial(nos.host)\n    if sessionErr != nil {\n        //TODO log error.\n    }\n    return nus\n} \n\nfunc (us UserService) GetById(usrId id.ID) *users.User {        \n    //TODO get a user from the database with the matching ID using the existing session.        \n}\n</code></pre>\n\n<p>There will also be a function called <code>UserService.CloseSession</code>, which as I mentioned, will be called after all the required operations are done by the handler function that creates the service.</p>\n\n<p>Does anyone know if this is a sensible idea or should I just call <code>mgo.Dial</code> in every function on <code>UserService</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "edited": false, "score": 0, "creation_date": 1449145848, "post_id": 34064825, "comment_id": 55885145, "body": "What do you mean by &quot;set/call defer&quot; ? It doesn&#39;t make much sense. Maybe this link can clarify things for you: <a href=\"https://blog.golang.org/defer-panic-and-recover\" rel=\"nofollow noreferrer\">blog.golang.org/defer-panic-and-recover</a>"}, {"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1449147089, "post_id": 34064825, "comment_id": 55885913, "body": "can you describe what exactly you are trying to achieve"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1449150257, "post_id": 34064825, "comment_id": 55888057, "body": "Don&#39;t use <code>SetFinalizer</code>, since that will close your session at an unpredictable time, or it may never close your session. From the documentation:  <code>typical usage scenario is to have one global session object to interact with the whole Cassandra cluster</code>"}, {"owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "edited": false, "score": 0, "creation_date": 1449151054, "post_id": 34064825, "comment_id": 55888635, "body": "Hej JimB. Will you comment on the update that I made - using a GetSession() to return a session? Thanks, it sounds like you know this :-)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1449151655, "post_id": 34064825, "comment_id": 55889027, "body": "<code>defer</code> runs when the function returns. If you <code>defer</code> there, the session will be closed before it&#39;s ever been used; why are you trying to use <code>defer</code>? You can&#39;t use it if something exists outside the scope of a single function."}, {"owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "edited": false, "score": 0, "creation_date": 1449151896, "post_id": 34064825, "comment_id": 55889219, "body": "You are right, I will use it by passing around the session. Thanks"}], "answers": [{"comments": [{"owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "edited": false, "score": 0, "creation_date": 1449154849, "post_id": 34068895, "comment_id": 55891403, "body": "Right on - thanks man"}], "tags": [], "owner": {"reputation": 1775, "user_id": 1241805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e69b9940a6d0998eabedda2452d8e7c?s=128&d=identicon&r=PG", "display_name": "Ezequiel Moreno", "link": "https://stackoverflow.com/users/1241805/ezequiel-moreno"}, "is_accepted": true, "score": 1, "last_activity_date": 1449153930, "creation_date": 1449153930, "answer_id": 34068895, "question_id": 34064825, "link": "https://stackoverflow.com/questions/34064825/where-to-set-defer-on-a-structdestructor-variable/34068895#34068895", "title": "Where to set defer on a struct(destructor) variable", "body": "<p>You may compose your handlers using a context for setting the Cassandra session, use it and release afterwards, returning it to your pool of sessions.</p>\n\n<p>Take a look <a href=\"http://www.alexedwards.net/blog/organising-database-access\" rel=\"nofollow\">to this blog post</a> about about how to organize your access to DB services.</p>\n"}], "owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 792, "favorite_count": 0, "closed_date": 1449157272, "accepted_answer_id": 34068895, "answer_count": 1, "score": -1, "last_activity_date": 1449153930, "creation_date": 1449142023, "last_edit_date": 1449150964, "question_id": 34064825, "link": "https://stackoverflow.com/questions/34064825/where-to-set-defer-on-a-structdestructor-variable", "closed_reason": "Needs details or clarity", "title": "Where to set defer on a struct(destructor) variable", "body": "<p>I have a struct with a database session variable. Where should I set/call defer on this - like a constructor/destructor?</p>\n\n<pre><code>type MyType struct {\n    session    *gocql.Session\n}\n</code></pre>\n\n<p>I am attaching an instance of *gocql.Session and it should live as long as the struct.</p>\n\n<pre><code>func (this *myType) function_one_using_the_session(){}\nfunc (this *myType) function_two_using_the_session(){}\n</code></pre>\n\n<p>I found <a href=\"http://lk4d4.darth.io/posts/finalizers/\" rel=\"nofollow\">this</a>: <code>runtime.SetFinalizer(a, func(a *Test) { fmt.Println(\"I AM DEAD\") })</code></p>\n\n<p>I will probably do that or write my own <code>Close()</code> function.</p>\n\n<p>This might do the trick - other comments is welcome?</p>\n\n<p>I am trying to use only so many sessions. But should I defer the session in the following function:</p>\n\n<pre><code>    func GetSession() *gocql.Session {\n        if cluster == nil {\n            cluster = gocql.NewCluster(\"ip\")\n            cluster.Keyspace = \"Keyspace\"\n            session, _ = cluster.CreateSession()\n            return session\n        } else {\n            session, _ = cluster.CreateSession()\n            // defer session.Close()\n            }\n    return session\n}\n</code></pre>\n"}, {"tags": ["go", "io", "race-condition"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1449141984, "post_id": 34063291, "comment_id": 55882608, "body": "The docs mention that &quot;It is safe to call Read and Write in parallel with each other or with Close. Close will complete once pending I/O is done&quot;, so I don&#39;t see where could a race occur."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1449142139, "post_id": 34063291, "comment_id": 55882728, "body": "Stop worrying and run the code under the race detector :-). Note that reads and writes are matched: The data you write <i>is</i> been read the moment you write it. Just reads after close drop data. Just make sure that reads actually consume all you want to write."}, {"owner": {"reputation": 3436, "user_id": 307614, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/671aed37f0d4a6668053a70a75f5c715?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/307614/dave"}, "edited": false, "score": 1, "creation_date": 1449145211, "post_id": 34063291, "comment_id": 55884721, "body": "The race detector?! Amazing, I didn&#39;t realise <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">there was such a thing</a>. Taking a look now. I&#39;ll play with it later."}], "answers": [{"tags": [], "owner": {"reputation": 19346, "user_id": 2793118, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5da03d2e233e1a40a4f1923acfb9d433?s=128&d=identicon&r=PG", "display_name": "Filipe Gon&#231;alves", "link": "https://stackoverflow.com/users/2793118/filipe-gon%c3%a7alves"}, "is_accepted": true, "score": 3, "last_activity_date": 1449148032, "creation_date": 1449148032, "answer_id": 34066891, "question_id": 34063291, "link": "https://stackoverflow.com/questions/34063291/race-conditions-in-io-pipe/34066891#34066891", "title": "Race conditions in io.Pipe?", "body": "<p>No, there are no race conditions. As the documentation mentions, reads on one end are matched with writes on the other. So, when <code>CloseWithError()</code> is reached, it means every <code>Write</code> has successfully completed and been matched with a corresponding <code>Read</code> - so the other end must have read everything there was to read.</p>\n"}], "owner": {"reputation": 3436, "user_id": 307614, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/671aed37f0d4a6668053a70a75f5c715?s=128&d=identicon&r=PG", "display_name": "Dave", "link": "https://stackoverflow.com/users/307614/dave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 609, "favorite_count": 0, "accepted_answer_id": 34066891, "answer_count": 1, "score": 4, "last_activity_date": 1449148032, "creation_date": 1449137960, "question_id": 34063291, "link": "https://stackoverflow.com/questions/34063291/race-conditions-in-io-pipe", "title": "Race conditions in io.Pipe?", "body": "<p>I have a function which returns the <code>Reader</code> end of an <code>io.Pipe</code> and kicks off a go-routine which writes data to the <code>Writer</code> end of it, and then closes the pipe.</p>\n\n<pre><code>func GetPipeReader() io.ReadCloser {\n    r, w := io.Pipe()\n    go func() {\n        _, err := io.CopyN(w, SomeReaderOfSize(N), N)\n        w.CloseWithError(err)\n    }()\n    return r\n}\n\nfunc main() {\n    var buf bytes.Buffer\n    io.Copy(&amp;buf, GetPipeReader())\n    println(\"got\", buf.Len(), \"bytes\")\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/OAijIwmtRr\" rel=\"nofollow\">https://play.golang.org/p/OAijIwmtRr</a></p>\n\n<p>This seems to always work in my testing, in that I get all the data I wrote. But the <a href=\"https://golang.org/pkg/io/#Pipe\" rel=\"nofollow\">API docs</a> are a bit worrying to me:</p>\n\n<blockquote>\n  <p><strong>func Pipe() (*PipeReader, *PipeWriter)</strong></p>\n  \n  <p><em>Pipe creates a synchronous in-memory pipe. [...] Reads on one end are\n  matched with writes on the other, [...] there is no internal\n  buffering.</em></p>\n  \n  <p><strong>func (w *PipeWriter) CloseWithError(err error) error</strong></p>\n  \n  <p><em>CloseWithError closes the writer; subsequent reads from the read half\n  of the pipe will return no bytes and the error err, or EOF if err is\n  nil.</em></p>\n</blockquote>\n\n<p>What I want to know is, what are the possible race conditions here? Is is plausible that my go-routine will write a bunch of data and then close the pipe before I can read it all?</p>\n\n<p>Do I need to use a channel for some signalling on when to close? What can go wrong, basically.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": false, "score": 0, "last_activity_date": 1449134030, "creation_date": 1449134030, "answer_id": 34061897, "question_id": 34061783, "link": "https://stackoverflow.com/questions/34061783/cant-figure-out-why-this-loop-is-a-data-race/34061897#34061897", "title": "Can&#39;t figure out why this loop is a data race", "body": "<blockquote>\n  <p>Right now it is impossible to AddNewMember if the goroutine SendReadyCheck is running ``because it is protected by an if statement that checks if the goroutine is running</p>\n</blockquote>\n\n<p>You didn't actually show that part of the code, but presumably it's not impossible. What if SendReadyCheck starts running <em>after</em> the if test but before AddNewMember does its modification?</p>\n"}], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1449134030, "creation_date": 1449133647, "question_id": 34061783, "link": "https://stackoverflow.com/questions/34061783/cant-figure-out-why-this-loop-is-a-data-race", "title": "Can&#39;t figure out why this loop is a data race", "body": "<p>I have a loop that is apparently causing a data race its near the bottom of this function and I will have it marked:</p>\n\n<pre><code>func (p *PartialParty) SendReadyCheck(party PartialParty) {\n    msg, err := json.Marshal(&amp;ReadyCheckMsg{\"ReadyCheck\", \"\"})\n    if err != nil {\n        log.Println(err)\n    }\n\n    for _, member := range party.Members {\n        member.Conn.send &lt;- msg\n    }\n\n    counter := 0\n    loopBreaker := true\n    for {\n        select {\n        case &lt;-p.Accept:\n            counter++\n            resp, err := json.Marshal(&amp;ReadyCheckMsg{\"ReadyAccepted\", \"\"})\n            if err != nil {\n                log.Println(err)\n            }\n            for _, member := range party.Members {\n                member.Conn.send &lt;- resp\n            }\n            if counter == 2 {\n                // Create a new party with all members\n                partyid := PartyID(feeds.NewUUID().String())\n                db := common.Db()\n                newParty := &amp;Party{\n                    Active:    true,\n                    Members:   p.Members,\n                    Broadcast: make(chan []byte),\n                    PartyID:   partyid,\n                }\n\n                // Insert the new party into the database\n                _, err := db.Exec(\"INSERT INTO party SET party_id = ?, active = ?\", partyid.String(), true)\n                if err != nil {\n                    log.Println(err)\n                }\n\n                // Go through the members and update the database\n                var wg sync.WaitGroup\n\n                for _, member := range party.Members {\n                    wg.Add(1)\n                    m := member\n                    go func() {\n                        _, err := db.Exec(\"UPDATE party_members SET active = ? WHERE steamid = ?\", false, m.SteamID)\n                        if err != nil {\n                            log.Println(err)\n                        }\n                        _, err = db.Exec(\"INSERT INTO party_members SET belongs_to =?, active = ?, steamid = ?\", partyid.String(), true, m.SteamID)\n                        if err != nil {\n                            log.Println(err)\n                        }\n                        wg.Done()\n                    }()\n                }\n\n                // Wait for all the database stuff to finish\n                wg.Wait()\n                PHub.AddNewParty(newParty)\n                loopBreaker = false\n                break\n            }\n        case conn := &lt;-p.Decline:\n            if conn.Ready {\n                break\n            }\n            conn.Ready = false\n            conn.InQueue = false\n            conn.CurrentParty = \"\"\n            resp, err := json.Marshal(&amp;ReadyCheckMsg{\"ReadyCheckDeclined\", \"\"})\n            if err != nil {\n                log.Println(err)\n            }\n            p.Accepting = true\n            identifier := conn.Identifier\n            if _, ok := party.Members[identifier]; ok {\n                delete(p.Members, identifier)\n            }\n            for _, m := range party.Members {\n                member := m\n                member.Conn.send &lt;- resp\n            }\n            log.Println(\"Here\")\n            loopBreaker = false\n            break\n        case &lt;-time.After(30 * time.Second):\n            if counter == 2 {\n                return\n            }\n            p.Accepting = true\n            failedMsg, err := json.Marshal(&amp;ReadyCheckMsg{\"FailedToReady\", \"\"})\n            if err != nil {\n                log.Println(err)\n            }\n            somebodyDeclinedMsg, err := json.Marshal(&amp;ReadyCheckMsg{\"ReadyCheckDeclined\", \"\"})\n            if err != nil {\n                log.Println(err)\n            }\n\n\n    &gt;&gt;&gt;&gt;     for _, member := range party.Members { ***&lt;&lt;&lt;&lt; This Line***\n                m := member\n                if !m.Conn.Ready {\n                    m.Conn.Ready = false\n                    m.Conn.InQueue = false\n                    m.Conn.CurrentParty = \"\"\n                    m.Conn.send &lt;- failedMsg\n                } else {\n                    m.Conn.Ready = false\n                    m.Conn.send &lt;- somebodyDeclinedMsg\n                }\n            }\n            loopBreaker = false\n            break\n        }\n        if !loopBreaker {\n            break\n        }\n    }\n}\n</code></pre>\n\n<p>It is apparently conflicting with this:</p>\n\n<pre><code>// AddNewMember will add a new user to the party\nfunc (p *PartyHub) AddNewMember(member *Member, partyid PartyID) {\n    p.Lock()\n    defer p.Unlock()\n&gt;&gt;&gt; p.PartialPartys[partyid].Members[member.Conn.Identifier] = member\n}\n\ntype PartialParty struct {\n    Accepting bool\n    Members   map[Identifier]*Member\n    Accept    chan *Connection\n    Decline   chan *Connection\n    PartyID   PartyID\n    sync.Mutex\n}\n</code></pre>\n\n<p>Right now it is impossible to <code>AddNewMember</code> if the goroutine <code>SendReadyCheck</code>  is running ``because it is protected by an if statement that checks if the goroutine is running, so I'm not sure why they are saying they are racing each other. Any help on clearing this up would be great. I've tried setting a variable inside the loop to try to get away from it but it doesn't seem to cause it</p>\n"}, {"tags": ["templates", "go", "go-templates"], "comments": [{"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1449125671, "post_id": 34059404, "comment_id": 55872801, "body": "Why not using template files?"}], "answers": [{"comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1449137928, "post_id": 34060339, "comment_id": 55879662, "body": "I have a problem in <a href=\"https://github.com/kaihendry/dc/commit/9fe0e8f60fa7bf3ad5fbef98d7ec54a7012c1dc3\" rel=\"nofollow noreferrer\">github.com/kaihendry/dc/commit/&hellip;</a> where the included template is not being executed and the values filled in. So my output is just <b>Hours since are</b> which is wrong. What am I missing?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 1, "creation_date": 1449138203, "post_id": 34060339, "comment_id": 55879861, "body": "@hendry That is because you passed a <code>nil</code> pipeline to the included template. If you want to pass on the pipeline (the params), include it like this: <code>{{template &quot;content&quot; .}} </code>. I edited the answer and examples to show passing the pipeline."}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1449143743, "post_id": 34060339, "comment_id": 55883777, "body": "Thank you! If anything could be better with <a href=\"https://github.com/kaihendry/dc\" rel=\"nofollow noreferrer\">github.com/kaihendry/dc</a> RE templating... please let me know. I don&#39;t like separate templates since they aren&#39;t in the binary."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1537885950, "last_edit_date": 1537885950, "creation_date": 1449128565, "answer_id": 34060339, "question_id": 34059404, "link": "https://stackoverflow.com/questions/34059404/golang-index-template-including/34060339#34060339", "title": "Golang index template including", "body": "<p>What you should know is that a value of <a href=\"https://golang.org/pkg/html/template/#Template\" rel=\"nofollow noreferrer\"><code>template.Template</code></a> can be a collection of multiple templates, see its <a href=\"https://golang.org/pkg/html/template/#Template.Templates\" rel=\"nofollow noreferrer\"><code>Template.Templates()</code></a> method which returns this collection.</p>\n\n<p>Each template in the collection has a unique name that it can be referred to by (see <a href=\"https://golang.org/pkg/html/template/#Template.Name\" rel=\"nofollow noreferrer\"><code>Template.Name()</code></a>). And there is a <code>{{template \"name\" pipeline}}</code> action, and using that you can include other templates in a template, another template which is part of the collection.</p>\n\n<p>See this example. Let's define 2 templates:</p>\n\n<pre><code>const tmain = `&lt;html&gt;&lt;body&gt;\nSome body. Now include the other template:\n{{template \"content\" .}}\n&lt;/body&gt;&lt;/html&gt;\n`\nconst tcontent = `I'M THE CONTENT, param passed is: {{.Param}}`\n</code></pre>\n\n<p>As you can see, <code>tmain</code> includes another template named <code>\"content\"</code>. You can use the <a href=\"https://golang.org/pkg/html/template/#Template.New\" rel=\"nofollow noreferrer\"><code>Template.New()</code></a> method (stressing: <strong>method</strong>, not to be confused with the func <a href=\"https://golang.org/pkg/html/template/#New\" rel=\"nofollow noreferrer\"><code>template.New()</code></a> ) to create a new associated, named template that will be part of the template whose method you're calling. As a result, they can refer to each other, e.g. they can include each other.</p>\n\n<p>Let's see code that parses these 2 templates into one <code>template.Template</code> so they can refer to each other (error check omitted for brevity):</p>\n\n<pre><code>t := template.Must(template.New(\"main\").Parse(tmain))\nt.New(\"content\").Parse(tcontent)\n\nparam := struct{ Param string }{\"paramvalue\"}\n\nif err := t.ExecuteTemplate(os.Stdout, \"main\", param); err != nil {\n    fmt.Println(err)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/xs4Dw1ZEmw\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&lt;html&gt;&lt;body&gt;\nSome body. Now include the other template:\nI'M THE CONTENT, param passed is: paramvalue\n&lt;/body&gt;&lt;/html&gt;\n</code></pre>\n\n<h3>Alternative</h3>\n\n<p>Also note that if you have many and bigger templates, this becomes less readable and maintainable. You should consider saving your templates as files, and you can use <a href=\"https://golang.org/pkg/html/template/#ParseFiles\" rel=\"nofollow noreferrer\"><code>template.ParseFiles()</code></a> and <a href=\"https://golang.org/pkg/html/template/#ParseGlob\" rel=\"nofollow noreferrer\"><code>template.ParseGlob()</code></a>, both which can parse multiple files at once and they build the template collection from them, so they can refer to each other. The names of the templates will be the names of the files.</p>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 809, "favorite_count": 0, "accepted_answer_id": 34060339, "answer_count": 1, "score": 1, "last_activity_date": 1539094547, "creation_date": 1449124944, "last_edit_date": 1539094547, "question_id": 34059404, "link": "https://stackoverflow.com/questions/34059404/golang-index-template-including", "title": "Golang index template including", "body": "<p>I have two templates in <a href=\"https://github.com/kaihendry/dc\" rel=\"nofollow\">my project</a> like so:</p>\n\n<pre><code>var indextemplate = template.Must(template.New(\"\").Parse(`&lt;!DOCTYPE html&gt;\n&lt;form action=\"/compare\" method=\"post\"&gt;\n&lt;input type=\"date\" name=\"from\" required&gt;\n&lt;input type=\"submit\"&gt;\n&lt;/form&gt;`))\n\nvar comparetemplate = template.Must(template.New(\"\").Parse(\"Hours since {{.From}} are {{.Duration}}\"))\n</code></pre>\n\n<p>I don't understand how to structure the code so I have the HTML template (with a head and <code>&lt;/html&gt;</code> at the end) and just include those templates into the body.</p>\n\n<p>I also don't quite understand what is best practice to structure the code so that the template matches the handler. Since IIUC you need to best compile the template outside the handler.</p>\n"}, {"tags": ["parsing", "templates", "dictionary", "go", "func"], "answers": [{"comments": [{"owner": {"reputation": 136, "user_id": 2632893, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PHgQM.png?s=128&g=1", "display_name": "Johnson", "link": "https://stackoverflow.com/users/2632893/johnson"}, "edited": false, "score": 0, "creation_date": 1449805842, "post_id": 34059701, "comment_id": 56176166, "body": "Sorry for this stupid question. Because I mixed the parameter of template.New(name string) and t.ParseFiles(filenames...string).  It should be template.New(filename string)."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1449131158, "last_edit_date": 1495542192, "creation_date": 1449126069, "answer_id": 34059701, "question_id": 34058772, "link": "https://stackoverflow.com/questions/34058772/how-to-use-go-template-to-parse-html-files-with-funcmap/34059701#34059701", "title": "How to use go template to parse html files with FuncMap", "body": "<p>What's wrong is that your program (the <code>html/template</code> package) can't find the <code>test.html</code> file. When you specify relative paths (yours are relative), they are resolved to the current working directory.</p>\n\n<p>You have to make sure the html files/templates are in the right place. If you start your app with <code>go run ...</code> for example, relative paths are resolved to the folder you're in, that will be the working directory.</p>\n\n<p>This relative path: <code>\"./templates/test.html\"</code> will try to parse the file being in the <code>templates</code> subfolder of the current folder. Make sure it's there.</p>\n\n<p>Another option is to use absolute paths.</p>\n\n<p><strong>And also another important note:</strong> Do not parse templates in your handler function! That runs to serve each incoming request. Instead parse them in the package <code>init()</code> functions once.</p>\n\n<p>More details on this:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/28451675/it-takes-too-much-time-when-using-template-package-to-generate-a-dynamic-web-p\">It takes too much time when using &quot;template&quot; package to generate a dynamic web page to client in golang</a></p>\n"}], "owner": {"reputation": 136, "user_id": 2632893, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PHgQM.png?s=128&g=1", "display_name": "Johnson", "link": "https://stackoverflow.com/users/2632893/johnson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1916, "favorite_count": 0, "accepted_answer_id": 34059701, "answer_count": 1, "score": 2, "last_activity_date": 1449131158, "creation_date": 1449121832, "question_id": 34058772, "link": "https://stackoverflow.com/questions/34058772/how-to-use-go-template-to-parse-html-files-with-funcmap", "title": "How to use go template to parse html files with FuncMap", "body": "<p>I use following code to parse html template. It works well.</p>\n\n<pre><code>func test(w http.ResponseWriter, req *http.Request) {\n\n    data := struct {A int B int }{A: 2, B: 3}\n\n    t := template.New(\"test.html\").Funcs(template.FuncMap{\"add\": add})\n\n    t, err := t.ParseFiles(\"test.html\")\n\n    if err!=nil{\n        log.Println(err)\n    }\n    t.Execute(w, data)\n}\n\nfunc add(a, b int) int {\n    return a + b\n}\n</code></pre>\n\n<p>and html template test.html.</p>\n\n<pre><code>&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;input type=\"text\" value=\"{{add .A .B}}\"&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>But when I move html file to another directory. Then use the following code. The output is always empty.</p>\n\n<pre><code>t := template.New(\"./templates/test.html\").Funcs(template.FuncMap{\"add\": add})\n\nt, err := t.ParseFiles(\"./templates/test.html\")\n</code></pre>\n\n<p>Can anyone tell me what's wrong? Or html/template package can not be used like this? </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 5562, "user_id": 931934, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/63f35d9e50dfd73281126b051a51668a?s=128&d=identicon&r=PG", "display_name": "nickcoxdotme", "link": "https://stackoverflow.com/users/931934/nickcoxdotme"}, "edited": false, "score": 0, "creation_date": 1449123074, "post_id": 34058973, "comment_id": 55871750, "body": "Thanks! This got me the XML as expected. But even though <code>xml.Unmarshal</code> takes a <code>[]byte</code>, when I pass this in, it doesn&#39;t seem to populate the <code>Album</code> struct with the data (last line of <code>main</code>). Any thoughts?"}, {"owner": {"reputation": 5562, "user_id": 931934, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/63f35d9e50dfd73281126b051a51668a?s=128&d=identicon&r=PG", "display_name": "nickcoxdotme", "link": "https://stackoverflow.com/users/931934/nickcoxdotme"}, "edited": false, "score": 0, "creation_date": 1449123401, "post_id": 34058973, "comment_id": 55871859, "body": "I&#39;ve also double and triple checked the XML structure."}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "reply_to_user": {"reputation": 5562, "user_id": 931934, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/63f35d9e50dfd73281126b051a51668a?s=128&d=identicon&r=PG", "display_name": "nickcoxdotme", "link": "https://stackoverflow.com/users/931934/nickcoxdotme"}, "edited": false, "score": 0, "creation_date": 1449123616, "post_id": 34058973, "comment_id": 55871929, "body": "can you add the XML to your original question?  hard to help troubleshoot that if we don&#39;t know the input to the xml parser"}, {"owner": {"reputation": 5562, "user_id": 931934, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/63f35d9e50dfd73281126b051a51668a?s=128&d=identicon&r=PG", "display_name": "nickcoxdotme", "link": "https://stackoverflow.com/users/931934/nickcoxdotme"}, "edited": false, "score": 0, "creation_date": 1449124170, "post_id": 34058973, "comment_id": 55872127, "body": "Good suggestion. As soon as I mentioned the XML structure, I realized that might be it."}, {"owner": {"reputation": 5562, "user_id": 931934, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/63f35d9e50dfd73281126b051a51668a?s=128&d=identicon&r=PG", "display_name": "nickcoxdotme", "link": "https://stackoverflow.com/users/931934/nickcoxdotme"}, "edited": false, "score": 0, "creation_date": 1449126796, "post_id": 34058973, "comment_id": 55873330, "body": "I figured it out based on your answer, so I&#39;ll mark it correct."}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 2, "last_activity_date": 1449122763, "creation_date": 1449122763, "answer_id": 34058973, "question_id": 34058531, "link": "https://stackoverflow.com/questions/34058531/go-xml-api-returns-oddly-encoded-string/34058973#34058973", "title": "Go: XML API returns oddly encoded string", "body": "<p>The <a href=\"https://golang.org/pkg/net/http/#Response\" rel=\"nofollow\">http.Response</a>'s Body is an io.ReaderCloser.  The odd output you are seeing is the values of the fields of struct used as the response body.</p>\n\n<p>if you want the actual content to print out, you must read it from the Body first.</p>\n\n<p>Try ioutil.<a href=\"https://golang.org/pkg/io/ioutil/#ReadAll\" rel=\"nofollow\">ReadAll</a> by doing:</p>\n\n<pre><code>b, err := ioutil.ReadAll(resp.Body) // b is a []byte here\nif err != nil { \n   fmt.Println(\"Got error:\",err)\n} else {\n    fmt.Println(string(b)) // convert []byte to string for printing to the screen.\n}\n</code></pre>\n"}], "owner": {"reputation": 5562, "user_id": 931934, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/63f35d9e50dfd73281126b051a51668a?s=128&d=identicon&r=PG", "display_name": "nickcoxdotme", "link": "https://stackoverflow.com/users/931934/nickcoxdotme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 34058973, "answer_count": 1, "score": 0, "last_activity_date": 1449159339, "creation_date": 1449120604, "last_edit_date": 1449159339, "question_id": 34058531, "link": "https://stackoverflow.com/questions/34058531/go-xml-api-returns-oddly-encoded-string", "title": "Go: XML API returns oddly encoded string", "body": "<p>I'm trying to parse the XML response from an API, and when call <code>fmt.Println</code> and pass the response body, I get a weird string:</p>\n\n<p><code>&amp;{0xc8200e6140 {0 0} false &lt;nil&gt; 0xc2030 0xc1fd0}</code></p>\n\n<p>I've confirmed that I can <code>curl</code> the API and get XML as expected. (I also get the same response sending a <code>GET</code> request with the Postman Chrome extension.) Is this an encoding issue?</p>\n\n<p>Here's the relevant code:</p>\n\n<pre><code>type Album struct {\n    Title     string `xml:\"album&gt;name\"`\n    Artist    string `xml:\"album&gt;artist&gt;name\"`\n    PlayCount uint64 `xml:\"album&gt;playcount\"`\n}\n\nconst lastFMAPIKey string = \"&lt;My api key&gt;\"\nconst APIURL string = \"http://ws.audioscrobbler.com/2.0/\"\n\nfunc perror(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n\nfunc getListeningInfo(url string) []byte {\n    resp, err := http.Get(url)\n    perror(err)\n    defer resp.Body.Close()\n    // this is the line that prints the string above\n    fmt.Println(resp.Body)\n    body, err2 := ioutil.ReadAll(resp.Body)\n    perror(err2)\n    return body\n}\n\nfunc main() {\n    url := APIURL + \"?method=user.getTopAlbums&amp;user=iamnicholascox&amp;period=1month&amp;limit=1&amp;api_key=\" + lastFMAPIKey\n    album := Album{}\n    err := xml.Unmarshal(getListeningInfo(url), &amp;album)\n    perror(err)\n    fmt.Printf(album.Artist)\n}\n</code></pre>\n\n<p>For reference, printing out <code>resp</code> instead of just <code>resp.Body</code> gives this:</p>\n\n<pre><code>{200 OK 200 HTTP/1.1 1 1 map[Ntcoent-Length:[871]\nConnection:[keep-alive] Access-Control-Max-Age:[86400]\nCache-Control:[private] Date:[Thu, 03 Dec 2015 05:16:34 GMT]\nContent-Type:[text/xml; charset=UTF-8]\nAccess-Control-Request-Headers:[Origin, X-Atmosphere-tracking-id, X-Atmosphere-Framework, X-Cache-Date,\nContent-Type, X-Atmosphere-Transport, *]\nAccess-Control-Allow-Methods:[POST, GET, OPTIONS]\nAccess-Control-Allow-Origin:[*]\nServer:[openresty/1.7.7.2]]\n0xc8200f6040 -1 [] false map[] 0xc8200b8000 &lt;nil&gt;}\n</code></pre>\n"}, {"tags": ["go", "io", "channel", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 7548, "user_id": 194784, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8abfd9cab0b3a81452ac7939e1367d13?s=128&d=identicon&r=PG", "display_name": "Ryan Lynch", "link": "https://stackoverflow.com/users/194784/ryan-lynch"}, "edited": false, "score": 0, "creation_date": 1449117659, "post_id": 34057942, "comment_id": 55869830, "body": "Thanks mate. Banging my head against the wall on that one for a long time. Why would it write some of the content to the file though in my app?"}, {"owner": {"reputation": 7548, "user_id": 194784, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8abfd9cab0b3a81452ac7939e1367d13?s=128&d=identicon&r=PG", "display_name": "Ryan Lynch", "link": "https://stackoverflow.com/users/194784/ryan-lynch"}, "edited": false, "score": 0, "creation_date": 1449117722, "post_id": 34057942, "comment_id": 55869844, "body": "nvm, I see the bit about buffering in the link you posted. Thanks again."}], "tags": [], "owner": {"reputation": 1775, "user_id": 1241805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e69b9940a6d0998eabedda2452d8e7c?s=128&d=identicon&r=PG", "display_name": "Ezequiel Moreno", "link": "https://stackoverflow.com/users/1241805/ezequiel-moreno"}, "is_accepted": true, "score": 3, "last_activity_date": 1449117304, "creation_date": 1449117304, "answer_id": 34057942, "question_id": 34057795, "link": "https://stackoverflow.com/questions/34057795/go-file-io-fails-when-writing-while-iterating-over-a-channel/34057942#34057942", "title": "Go file IO fails when writing while iterating over a channel", "body": "<p>You are missing <code>writer.Flush()</code> at the end of your function.</p>\n\n<p>More info <a href=\"https://golang.org/pkg/encoding/csv/#example_Writer\" rel=\"nofollow\">here</a></p>\n"}], "owner": {"reputation": 7548, "user_id": 194784, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8abfd9cab0b3a81452ac7939e1367d13?s=128&d=identicon&r=PG", "display_name": "Ryan Lynch", "link": "https://stackoverflow.com/users/194784/ryan-lynch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 34057942, "answer_count": 1, "score": 0, "last_activity_date": 1449117304, "creation_date": 1449116159, "question_id": 34057795, "link": "https://stackoverflow.com/questions/34057795/go-file-io-fails-when-writing-while-iterating-over-a-channel", "title": "Go file IO fails when writing while iterating over a channel", "body": "<p>I'm having an issue with writing lines to a csv file while iterating over a channel. I'm new to Go, but the syntax for file IO looks synchronous to me. Given that I would expect that a write operation returning successfully would indicate that the write is complete, but that's not what I'm observing. This is essentially what I have going on in my application:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/csv\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    file, err := os.Create(\"test.csv\")\n    if err != nil {\n        log.Fatalf(\"Error opening file: %s\", err.Error())\n    }\n    defer file.Close()\n\n    writer := csv.NewWriter(file)\n    channel := make(chan []string)\n    counter := 0\n\n    go func() {\n        defer close(channel)\n\n        for i := 0; i &lt; 100; i++ {\n            channel &lt;- []string{\"col1\", \"col2\"}\n        }\n    }()\n\n    for vals := range channel {\n        if err := writer.Write(vals); err != nil {\n            log.Fatalf(\"Error writing to csv: %s\", err.Error())\n        }\n        counter++\n    }\n\n    log.Printf(\"%d lines written\", counter)\n}\n</code></pre>\n\n<p>There's a go routine passing values through a channel, and I'm iterating over those values and writing them to a CSV file. I get no errors, and at the end it logs that 100 lines have been written. </p>\n\n<p>When I check the CSV file though it's empty. The behavior I'm seeing in my application is the file is written incompletely; it'll stop halfway through writing a record. I'm sure I'm missing something, but if the write returns with no errors why is there nothing in the file?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1449104056, "post_id": 34055946, "comment_id": 55865972, "body": "It&#39;s not a parameter. It&#39;s meant to be called with a variable of that type."}, {"owner": {"reputation": 429, "user_id": 3957528, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9cl47.jpg?s=128&g=1", "display_name": "Hua2308", "link": "https://stackoverflow.com/users/3957528/hua2308"}, "reply_to_user": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1449104325, "post_id": 34055946, "comment_id": 55866068, "body": "Could you please elaborate on any variable that can be used within a function but not passing in as parameter?"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1449118671, "post_id": 34055946, "comment_id": 55870165, "body": "@SalvadorDali I don&#39;t agree that this is a duplicate of that. One is asking &quot;Are there methods in Go.&quot; The other is asking &quot;Is a receiver a return value.&quot; The answers aren&#39;t even the same, and you can&#39;t derive the answer to this from the answer to that unless you ALREADY KNEW the answer. These are clearly <i>not</i> duplicate questions (though the duplicate to this is probably out there."}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "reply_to_user": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 0, "creation_date": 1449121901, "post_id": 34055946, "comment_id": 55871298, "body": "@AdamSmith they are similar enough to be treated as duplicates. Take a look at these two questions. <code>how to increment number in go</code> and another <code>go syntax demystification. What is num++</code>. In your opinion they are not duplicates, because they are super different in wording, the answer to one can be more focused on different aspect, and some people can&#39;t derive the answer, because without knowing that syntax construct exist you can&#39;t accidentally start using it. But in my opinion answers are close enough that they can be treated as duplicates."}, {"owner": {"reputation": 4231, "user_id": 1343321, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/20d625be6a7f95fd700dd975e4167848?s=128&d=identicon&r=PG", "display_name": "Depado", "link": "https://stackoverflow.com/users/1343321/depado"}, "edited": false, "score": 1, "creation_date": 1449134391, "post_id": 34055946, "comment_id": 55877288, "body": "<a href=\"https://tour.golang.org/methods/1\" rel=\"nofollow noreferrer\">tour.golang.org/methods/1</a> Please consider following the <code>Tour of Go</code>"}], "answers": [{"comments": [{"owner": {"reputation": 429, "user_id": 3957528, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9cl47.jpg?s=128&g=1", "display_name": "Hua2308", "link": "https://stackoverflow.com/users/3957528/hua2308"}, "edited": false, "score": 0, "creation_date": 1449104381, "post_id": 34055990, "comment_id": 55866083, "body": "Would receiver mean return value or something else?"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 429, "user_id": 3957528, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9cl47.jpg?s=128&g=1", "display_name": "Hua2308", "link": "https://stackoverflow.com/users/3957528/hua2308"}, "edited": false, "score": 0, "creation_date": 1449104460, "post_id": 34055990, "comment_id": 55866105, "body": "@Hua2308 no, return value means return value. This method returns nothing. This is a new piece of vocabulary for you -- the receiver is the type that will be implementing the method."}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": false, "score": 1, "last_activity_date": 1449104097, "creation_date": 1449104097, "answer_id": 34055990, "question_id": 34055946, "link": "https://stackoverflow.com/questions/34055946/go-function-demystification/34055990#34055990", "title": "Go function demystification", "body": "<p><code>a Ips</code> is the receiver of the method. Its parameters are <code>i int</code> and <code>j int</code>. This is a method bound to the <code>Ips</code> type that two strings in the array and returns nothing.</p>\n\n<p>Try it <a href=\"http://play.golang.org/p/Z9XEtL7IG-\" rel=\"nofollow\">on the playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1449104751, "last_edit_date": 1449104751, "creation_date": 1449104695, "answer_id": 34056093, "question_id": 34055946, "link": "https://stackoverflow.com/questions/34055946/go-function-demystification/34056093#34056093", "title": "Go function demystification", "body": "<p><code>(a Ips)</code> is called the 'receiver'. It is the type on which the method is called. Under the covers it is in fact passed into the method like any other parameter (think back to that class where they talk about pushing arguments on the stack). In this case it is a value type, so like other values types used as parameters, a copy of the argument is made and then that's what's pushed on the stack. That also means it will go out of scope as the method returns and the stack gets popped.</p>\n\n<p>The main difference is you need an instance of the receiving type in order to call the method. If the method doesn't have a receiving type, then it is packaged scoped and can be called anywhere inside the package or, if exported, can be called from the packages alias where imported.</p>\n"}], "owner": {"reputation": 429, "user_id": 3957528, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/9cl47.jpg?s=128&g=1", "display_name": "Hua2308", "link": "https://stackoverflow.com/users/3957528/hua2308"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "closed_date": 1449150459, "answer_count": 2, "score": -2, "last_activity_date": 1449104751, "creation_date": 1449103865, "question_id": 34055946, "link": "https://stackoverflow.com/questions/34055946/go-function-demystification", "closed_reason": "Duplicate", "title": "Go function demystification", "body": "<p>Just got a basic Go question regarding this code:</p>\n\n<pre><code>type Ips []string\nfunc (a Ips) Swap(i, j int) { a[i], a[j] = a[j], a[i] }\n</code></pre>\n\n<p>I believe <code>(a Ips)</code> is a parameter of Swap function, but why could it be not inside parenthesis?</p>\n"}]