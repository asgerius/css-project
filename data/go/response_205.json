[{"tags": ["email", "go", "mime", "multipart"], "answers": [{"comments": [{"owner": {"reputation": 21992, "user_id": 712765, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/oLlVJ.jpg?s=128&g=1", "display_name": "Old Pro", "link": "https://stackoverflow.com/users/712765/old-pro"}, "reply_to_user": {"reputation": 1207, "user_id": 472728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92d7a4b6cd0965c2c89d9a7d944457a1?s=128&d=identicon&r=PG", "display_name": "Colin Godsey", "link": "https://stackoverflow.com/users/472728/colin-godsey"}, "edited": false, "score": 1, "creation_date": 1605317175, "post_id": 53798744, "comment_id": 114622159, "body": "@ColinGodsey You absolutely can give bounty points if you want to. Click on &quot;start a bounty&quot; just below the question and choose the reason &quot;Reward existing answer&quot;."}], "tags": [], "owner": {"reputation": 21992, "user_id": 712765, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/oLlVJ.jpg?s=128&g=1", "display_name": "Old Pro", "link": "https://stackoverflow.com/users/712765/old-pro"}, "is_accepted": false, "score": 13, "last_activity_date": 1544927167, "last_edit_date": 1544927167, "creation_date": 1544924379, "answer_id": 53798744, "question_id": 53752824, "link": "https://stackoverflow.com/questions/53752824/how-to-create-a-nested-multipart-mime-envelope-for-email-in-go/53798744#53798744", "title": "How to create a nested multipart / MIME envelope for Email in Go?", "body": "<p>Unfortunately, the standard library support for writing multi-part MIME messages has a bad API for nesting. The problem is that you have to set the <code>boundary</code> string in the header before creating the writer, but the generated boundary string is obviously not available before creating the writer. So you have to set the boundary strings explicitly. </p>\n\n<p>Here is my solution (<a href=\"https://play.golang.org/p/UwksTnIvq6P\" rel=\"noreferrer\">runnable in the Go Playground</a>), simplified for brevity. I have chosen to use the outer writer's boundary to set the inner one, and added labels to make it easier to keep track when reading the output.</p>\n\n<pre><code>package main\n\nimport (\"bytes\"; \"fmt\"; \"io\"; \"log\"; \"math/rand\"; \"mime/multipart\"; \"net/textproto\")\n\n//  multipart/mixed\n//  |- multipart/related\n//  |  |- multipart/alternative\n//  |  |  |- text/plain\n//  |  |  `- text/html\n//  |  `- inlines..\n//  `- attachments..\n\nfunc main() {\n    mixedContent := &amp;bytes.Buffer{}\n    mixedWriter := multipart.NewWriter(mixedContent)\n\n    // related content, inside mixed\n    var newBoundary = \"RELATED-\" + mixedWriter.Boundary()\n    mixedWriter.SetBoundary(first70(\"MIXED-\" + mixedWriter.Boundary()))\n\n    relatedWriter, newBoundary := nestedMultipart(mixedWriter, \"multipart/related\", newBoundary)\n    altWriter, newBoundary := nestedMultipart(relatedWriter, \"mulitpart/alternative\", \"ALTERNATIVE-\" + newBoundary)\n\n    // Actual content alternatives (finally!)\n    var childContent io.Writer\n\n    childContent, _ = altWriter.CreatePart(textproto.MIMEHeader{\"Content-Type\": {\"text/plain\"}})\n    childContent.Write([]byte(\"This is a line of text\\r\\n\\r\\n\"))\n    childContent, _ = altWriter.CreatePart(textproto.MIMEHeader{\"Content-Type\": {\"text/html\"}})\n    childContent.Write([]byte(\"&lt;html&gt;HTML goes here\\r\\n&lt;/html&gt;\\r\\n\"))\n    altWriter.Close()\n\n    relatedWriter.Close()\n\n    // Attachments\n    filename := fmt.Sprintf(\"File_%d.jpg\", rand.Int31())\n    var fileContent io.Writer\n\n    fileContent, _ = mixedWriter.CreatePart(textproto.MIMEHeader{\"Content-Type\": {\"application/octet-stream\"}, \"Content-Disposition\": {\"attachment; filename=\" + filename}})\n    fileContent.Write([]byte(\"AABBCCDDEEFF\"))\n\n    mixedWriter.Close()\n\n    fmt.Print(`From: Bob &lt;bob@example.com&gt;\nTo: Alice &lt;alias@example.com&gt;\nSubject: Formatted text mail\nMIME-Version: 1.0\nContent-Type: multipart/mixed; boundary=`)\n    fmt.Print(mixedWriter.Boundary(), \"\\n\\n\")\n    fmt.Println(mixedContent.String())\n\n}\n\nfunc nestedMultipart(enclosingWriter *multipart.Writer, contentType, boundary string) (nestedWriter *multipart.Writer, newBoundary string) {\n\n    var contentBuffer io.Writer\n    var err error\n\n    boundary = first70(boundary)\n    contentWithBoundary := contentType + \"; boundary=\\\"\" + boundary + \"\\\"\"\n    contentBuffer, err = enclosingWriter.CreatePart(textproto.MIMEHeader{\"Content-Type\": {contentWithBoundary}})\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    nestedWriter = multipart.NewWriter(contentBuffer)\n    newBoundary = nestedWriter.Boundary()\n    nestedWriter.SetBoundary(boundary)\n    return\n}\n\nfunc first70(str string) string {\n    if len(str) &gt; 70 {\n        return string(str[0:69])\n    }\n    return str\n}\n</code></pre>\n"}], "owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1403, "favorite_count": 2, "answer_count": 1, "score": 14, "last_activity_date": 1615744169, "creation_date": 1544656427, "last_edit_date": 1544988454, "question_id": 53752824, "link": "https://stackoverflow.com/questions/53752824/how-to-create-a-nested-multipart-mime-envelope-for-email-in-go", "title": "How to create a nested multipart / MIME envelope for Email in Go?", "body": "<p>I'm trying to figure out how to build <a href=\"https://stackoverflow.com/questions/3902455/mail-multipart-alternative-vs-multipart-mixed\">multipart/mime envelopes</a> for emails in Go. The following code generates correctly-nested bodies - but the boundaries are not inserted correctly. </p>\n\n<p>You can see a demo on <a href=\"https://play.golang.org/p/XLc4DQFObRn\" rel=\"noreferrer\">https://play.golang.org/p/XLc4DQFObRn</a></p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"math/rand\"\n    \"mime/multipart\"\n    \"mime/quotedprintable\"\n    \"net/textproto\"\n)\n\n//  multipart/mixed\n//  |- multipart/related\n//  |  |- multipart/alternative\n//  |  |  |- text/plain\n//  |  |  `- text/html\n//  |  `- inlines..\n//  `- attachments..\n\n\nfunc main() {\n\n    body := &amp;bytes.Buffer{}\n    writer := multipart.NewWriter(body)\n\n    var part io.Writer\n    var err error\n\n    // Text Content\n    part, err = writer.CreatePart(textproto.MIMEHeader{\"Content-Type\": {\"multipart/alternative\"}})\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    childWriter := multipart.NewWriter(part)\n\n    var subpart io.Writer\n    for _, contentType := range []string{\"text/plain\", \"text/html\"} {\n        subpart, err = CreateQuoteTypePart(childWriter, contentType)\n        if err != nil {\n            log.Fatal(err)\n        }\n        _, err := subpart.Write([]byte(\"This is a line of text that needs to be wrapped by quoted-printable before it goes to far.\\r\\n\\r\\n\"))\n        if err != nil {\n            log.Fatal(err)\n        }\n    }\n\n    // Attachments\n    filename := fmt.Sprintf(\"File_%d.jpg\", rand.Int31())\n    part, err = writer.CreatePart(textproto.MIMEHeader{\"Content-Type\": {\"application/octet-stream\"}, \"Content-Disposition\": {\"attachment; filename=\" + filename}})\n    if err != nil {\n        log.Fatal(err)\n    }\n    part.Write([]byte(\"AABBCCDDEEFF\"))\n\n    writer.Close()\n\n    fmt.Print(`From: Bob &lt;bob@example.com&gt;\nTo: Alice &lt;alias@example.com&gt;\nSubject: Formatted text mail\nMIME-Version: 1.0\nContent-Type: multipart/mixed; boundary=`)\n    fmt.Println(writer.Boundary())\n    fmt.Println(body.String())\n\n}\n\n// https://github.com/domodwyer/mailyak/blob/master/attachments.go#L142\nfunc CreateQuoteTypePart(writer *multipart.Writer, contentType string) (part io.Writer, err error) {\n    header := textproto.MIMEHeader{\n        \"Content-Type\":              []string{contentType},\n        \"Content-Transfer-Encoding\": []string{\"quoted-printable\"},\n    }\n\n    part, err = writer.CreatePart(header)\n    if err != nil {\n        return\n    }\n    part = quotedprintable.NewWriter(part)\n    return\n}\n</code></pre>\n\n<p>I want to stick to answers from the standard library (stdlib) and avoid <a href=\"https://github.com/domodwyer/mailyak/blob/master/mime.go#L57\" rel=\"noreferrer\">third</a> party <a href=\"https://github.com/scorredoira/email/blob/master/email.go#L171\" rel=\"noreferrer\">attempts</a> to wing it.</p>\n"}, {"tags": ["go", "channel", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 1118, "user_id": 5385625, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/CKfR0.jpg?s=128&g=1", "display_name": "Sam Orozco", "link": "https://stackoverflow.com/users/5385625/sam-orozco"}, "edited": false, "score": 0, "creation_date": 1544655205, "post_id": 53752577, "comment_id": 94358059, "body": "Hey, JimB,  can you explain why I wasn&#39;t able to reproduce this on my machine?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1118, "user_id": 5385625, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/CKfR0.jpg?s=128&g=1", "display_name": "Sam Orozco", "link": "https://stackoverflow.com/users/5385625/sam-orozco"}, "edited": false, "score": 0, "creation_date": 1544655673, "post_id": 53752577, "comment_id": 94358211, "body": "@SamOrozco: it&#39;s a data race, so it requires precise timing to get the corrupted output. The race detector however will show the problem even if the output is correct."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 7, "last_activity_date": 1544654915, "creation_date": 1544654915, "answer_id": 53752577, "question_id": 53752527, "link": "https://stackoverflow.com/questions/53752527/broken-output-from-a-buffered-channel-range-in-a-go-routine/53752577#53752577", "title": "Broken output from a buffered channel range in a GO routine", "body": "<p>From the <a href=\"https://golang.org/pkg/bufio/#Scanner.Bytes\" rel=\"noreferrer\"><code>buffer.Scanner</code></a> docs:</p>\n\n<blockquote>\n  <p>The underlying array may point to data that will be overwritten by a subsequent call to Scan</p>\n</blockquote>\n\n<p>You have a data race around the use of the slices you're passing over the channel. You need to copy the data you're sending. In this example, that is most easily accomplished by using a <code>string</code> instead of <code>[]byte</code>, and calling <a href=\"https://golang.org/pkg/bufio/#Scanner.Text\" rel=\"noreferrer\"><code>scanner.Text</code></a></p>\n"}], "owner": {"reputation": 29, "user_id": 6203875, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6nSeY.jpg?s=128&g=1", "display_name": "Simo P. M.", "link": "https://stackoverflow.com/users/6203875/simo-p-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 53752577, "answer_count": 1, "score": 1, "last_activity_date": 1544654915, "creation_date": 1544654651, "question_id": 53752527, "link": "https://stackoverflow.com/questions/53752527/broken-output-from-a-buffered-channel-range-in-a-go-routine", "title": "Broken output from a buffered channel range in a GO routine", "body": "<p>Why a GO routine like the following outputs sequences of bytes in a random order when using a buffered channel?</p>\n\n<p>Here is the code to replicate the buggy behaviour, where <code>data.csv</code> is a simple CSV of 1000 rows of random data (100 bytes per row approximately) plus the header row (1001 rows in total).</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"os\"\n    \"time\"\n)\n\nfunc main() {\n\n    var channelLength = 10000\n    var channel = make(chan []byte, channelLength)\n\n    go func() {\n        for c := range channel {\n            println(string(c))\n        }\n    }()\n\n    file, _ := os.Open(\"./data.csv\")\n    scanner := bufio.NewScanner(file)\n\n    for scanner.Scan() {\n        channel &lt;- scanner.Bytes()\n    }\n\n    &lt;-time.After(time.Second * time.Duration(3600))\n\n}\n</code></pre>\n\n<p>Here are the first 6 lines of the output as an example of what I mean for \"broken output\":</p>\n\n<pre><code>979,C\ntharine,Vero,cveror6@blinklist.com,Female,133.153.12.53\n980,Mauriz\na,Ilett,milettr7@theguardian.com,Female,226.123.252.118\n981\nSher,De Laci,sdelacir8@nps.gov,Female,137.207.30.217\n[...]\n</code></pre>\n\n<p>On the other hand, the code runs smoothly if channelLength = 0, so with an unbuffered channel (first 6 lines, again):</p>\n\n<pre><code>id,first_name,last_name,email,gender,ip_address\n1,Hebert,Edgecumbe,hedgecumbe0@apple.com,Male,108.84.217.38\n2,Minor,Lakes,mlakes1@marriott.com,Male,231.185.189.39\n3,Faye,Spurdens,fspurdens2@oakley.com,Female,80.173.161.81\n4,Kris,Proppers,kproppers3@gmpg.org,Male,10.80.182.51\n5,Bronnie,Branchet,bbranchet4@squarespace.com,Male,118.117.0.5\n[...]\n</code></pre>\n\n<p>Data is random generated.</p>\n"}, {"tags": ["mysql", "ssl", "go", "google-cloud-platform", "google-cloud-sql"], "answers": [{"tags": [], "owner": {"reputation": 141, "user_id": 10783162, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GgUa4-NFE7I/AAAAAAAAAAI/AAAAAAAAAG8/aLiNYeSctU0/photo.jpg?sz=128", "display_name": "roudy16", "link": "https://stackoverflow.com/users/10783162/roudy16"}, "is_accepted": false, "score": 8, "last_activity_date": 1544661008, "last_edit_date": 1544661008, "creation_date": 1544654083, "answer_id": 53752416, "question_id": 53752383, "link": "https://stackoverflow.com/questions/53752383/how-do-you-create-a-tls-connection-to-a-cloud-sql-database-using-go/53752416#53752416", "title": "How do you create a TLS connection to a Cloud SQL database using Go?", "body": "<p>They key things I was missing was that the version of Go I was using was several months old and did not contain a specific fix and I did not specify the hostname associated with my Cloud SQL instance. I could not find an answer for this problem anywhere and found the solution myself by stepping through the TLS handshake code to see what went wrong and why.</p>\n\n<p>Versions of Go released before September 2018 would not correctly validate the hostnames that Cloud SQL uses in the TLS server certificate. Cloud SQL hostnames contain a ':' character and that caused the hostname and therefore the server certificate to be considered invalid. That has been fixed.</p>\n\n<p>The correct way to connect to a Cloud SQL instance using TLS is to follow these steps:</p>\n\n<ol>\n<li><p>Update your Go so that you have the change that allows validation of Cloud SQL hostnames that are in the server certificate.</p></li>\n<li><p>Create client certificates using the Cloud SQL console.</p></li>\n<li><p>Create the TLS connection as follows:</p></li>\n</ol>\n\n<blockquote>\n<pre><code>import (\n    \"crypto/tls\"\n    \"crypto/x509\"\n    \"database/sql\"\n    \"github.com/go-sql-driver/mysql\"\n    \"io/ioutil\"\n)\n\nrootCertPool := x509.NewCertPool()\n\npem, err := ioutil.ReadFile(\"/path/server-ca.pem\")\nif err != nil {\n    log.Fatal(err)\n}\n\nif ok := rootCertPool.AppendCertsFromPEM(pem); !ok {\n    log.Fatal(\"Failed to append PEM.\")\n}\n\nclientCert := make([]tls.Certificate, 0, 1)\ncerts, err := tls.LoadX509KeyPair(\"/path/client-cert.pem\",\n                                  \"/path/client-key.pem\")\nif err != nil {\n    log.Fatal(err)\n}\n\nclientCert = append(clientCert, certs)\nmysql.RegisterTLSConfig(\"custom\", &amp;tls.Config{\n    RootCAs: rootCertPool,\n    Certificates: clientCert,\n    ServerName: \"&lt;gcp-project-id&gt;:&lt;cloud-sql-instance&gt;\", // hostname\n})\n\ndb, err := sql.Open(\"mysql\",\n        \"&lt;user&gt;:&lt;password&gt;@tcp(&lt;cloud sql ip&gt;:3306)/&lt;db_name&gt;?tls=custom\")\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 141, "user_id": 10783162, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-GgUa4-NFE7I/AAAAAAAAAAI/AAAAAAAAAG8/aLiNYeSctU0/photo.jpg?sz=128", "display_name": "roudy16", "link": "https://stackoverflow.com/users/10783162/roudy16"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 698, "favorite_count": 2, "answer_count": 1, "score": 5, "last_activity_date": 1544787606, "creation_date": 1544653892, "last_edit_date": 1544787606, "question_id": 53752383, "link": "https://stackoverflow.com/questions/53752383/how-do-you-create-a-tls-connection-to-a-cloud-sql-database-using-go", "title": "How do you create a TLS connection to a Cloud SQL database using Go?", "body": "<p>I'm trying to create a TLS connection to a Cloud SQL database but I'm getting the following error when trying to prepare a statement:</p>\n\n<pre><code>x509: cannot validate certificate for &lt;cloud sql instance ip&gt;\n      because it doesn't contain any IP SANs\n</code></pre>\n\n<p>Here is my setup code:</p>\n\n<blockquote>\n<pre><code>rootCertPool := x509.NewCertPool()\n\npem, err := ioutil.ReadFile(\"/path/server-ca.pem\")\nif err != nil {\n    log.Fatal(err)\n}\n\nif ok := rootCertPool.AppendCertsFromPEM(pem); !ok {\n    log.Fatal(\"Failed to append PEM.\")\n}\n\nclientCert := make([]tls.Certificate, 0, 1)\ncerts, err := tls.LoadX509KeyPair(\"/path/client-cert.pem\",\n                                  \"/path/client-key.pem\")\nif err != nil {\n    log.Fatal(err)\n}\n\nclientCert = append(clientCert, certs)\nmysql.RegisterTLSConfig(\"custom\", &amp;tls.Config{\n    RootCAs: rootCertPool,\n    Certificates: clientCert,\n})\n\ndb, err := sql.Open(\"mysql\",\n        \"&lt;user&gt;:&lt;password&gt;@tcp(&lt;cloud sql ip&gt;:3306)/&lt;db_name&gt;?tls=custom\")\n</code></pre>\n</blockquote>\n"}, {"tags": ["unit-testing", "go", "asynchronous", "gomock"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1544648705, "post_id": 53751228, "comment_id": 94355312, "body": "This question doesn&#39;t really make sense - the only &quot;async function call&quot; in Go is <code>go &lt;function&gt;</code>, which doesn&#39;t appear in the code shown. And the way to wait for some number of goroutines before continuing execution of some function would be a <code>sync.WaitGroup</code>."}, {"owner": {"reputation": 183, "user_id": 4540358, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/fef7d412c2feb404328d053f14b219b9?s=128&d=identicon&r=PG&f=1", "display_name": "Arushi", "link": "https://stackoverflow.com/users/4540358/arushi"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544649228, "post_id": 53751228, "comment_id": 94355535, "body": "<code>RunAsync()</code> function implements this, I did not explicitly mention it."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544650825, "post_id": 53751228, "comment_id": 94356209, "body": "If you&#39;ve mocked <code>x</code> then the mock&#39;s <code>RunAsync</code> needn&#39;t run asynchronously."}], "answers": [{"comments": [{"owner": {"reputation": 183, "user_id": 4540358, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/fef7d412c2feb404328d053f14b219b9?s=128&d=identicon&r=PG&f=1", "display_name": "Arushi", "link": "https://stackoverflow.com/users/4540358/arushi"}, "edited": false, "score": 0, "creation_date": 1544649171, "post_id": 53751330, "comment_id": 94355508, "body": "Thanks a ton! Since it is a stub, I can use this. But what if it was otherwise?"}, {"owner": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "reply_to_user": {"reputation": 183, "user_id": 4540358, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/fef7d412c2feb404328d053f14b219b9?s=128&d=identicon&r=PG&f=1", "display_name": "Arushi", "link": "https://stackoverflow.com/users/4540358/arushi"}, "edited": false, "score": 2, "creation_date": 1544653878, "post_id": 53751330, "comment_id": 94357551, "body": "Check out <a href=\"https://medium.com/@poy/gomock-and-go-routines-6a7c01d989d5\" rel=\"nofollow noreferrer\">medium.com/@poy/gomock-and-go-routines-6a7c01d989d5</a> for some advice."}, {"owner": {"reputation": 183, "user_id": 4540358, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/fef7d412c2feb404328d053f14b219b9?s=128&d=identicon&r=PG&f=1", "display_name": "Arushi", "link": "https://stackoverflow.com/users/4540358/arushi"}, "edited": false, "score": 0, "creation_date": 1545033383, "post_id": 53751330, "comment_id": 94470064, "body": "In accordance of your article : What if Bar() returns something. If we put Return() additionally, it shows error. Also if you use DoAndReturn(), then also it says too many argument error."}, {"owner": {"reputation": 183, "user_id": 4540358, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/fef7d412c2feb404328d053f14b219b9?s=128&d=identicon&r=PG&f=1", "display_name": "Arushi", "link": "https://stackoverflow.com/users/4540358/arushi"}, "edited": false, "score": 0, "creation_date": 1545070010, "post_id": 53751330, "comment_id": 94490051, "body": "type Foo interface { \tBar (arg1 Arg1, arg2 chan *Arg2) (*ReturnArg, error) }"}, {"owner": {"reputation": 183, "user_id": 4540358, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/fef7d412c2feb404328d053f14b219b9?s=128&d=identicon&r=PG&f=1", "display_name": "Arushi", "link": "https://stackoverflow.com/users/4540358/arushi"}, "edited": false, "score": 0, "creation_date": 1545070380, "post_id": 53751330, "comment_id": 94490220, "body": "Sorry I am very new to Go!"}, {"owner": {"reputation": 183, "user_id": 4540358, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/fef7d412c2feb404328d053f14b219b9?s=128&d=identicon&r=PG&f=1", "display_name": "Arushi", "link": "https://stackoverflow.com/users/4540358/arushi"}, "edited": false, "score": 0, "creation_date": 1545070527, "post_id": 53751330, "comment_id": 94490284, "body": "so, if I put Do and Return both it says <code>too many arguments for function call</code>"}, {"owner": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "reply_to_user": {"reputation": 183, "user_id": 4540358, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/fef7d412c2feb404328d053f14b219b9?s=128&d=identicon&r=PG&f=1", "display_name": "Arushi", "link": "https://stackoverflow.com/users/4540358/arushi"}, "edited": false, "score": 0, "creation_date": 1545070921, "post_id": 53751330, "comment_id": 94490450, "body": "File an issue with github.com/golang/mock and we can continue the conversation there (It will be easier to paste code and such)."}, {"owner": {"reputation": 183, "user_id": 4540358, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/fef7d412c2feb404328d053f14b219b9?s=128&d=identicon&r=PG&f=1", "display_name": "Arushi", "link": "https://stackoverflow.com/users/4540358/arushi"}, "reply_to_user": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "edited": false, "score": 0, "creation_date": 1545071323, "post_id": 53751330, "comment_id": 94490623, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/185371/discussion-between-arushi-and-poy\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "is_accepted": true, "score": 1, "last_activity_date": 1544648733, "creation_date": 1544648733, "answer_id": 53751330, "question_id": 53751228, "link": "https://stackoverflow.com/questions/53751228/how-to-ensure-that-all-async-functions-run-before-defer-is-executed/53751330#53751330", "title": "How to ensure that all Async functions Run before defer is executed", "body": "<p>If the test double is being used as a stub, then you should call <code>.AnyTimes()</code> on it. This way gomock won't care if the go routine has finished or not.</p>\n\n<p>If however you are wanting to make assertions on it (and therefore its a mock and not a stub), then you need to ensure the go routine has executed before letting the test finish.</p>\n"}], "owner": {"reputation": 183, "user_id": 4540358, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/fef7d412c2feb404328d053f14b219b9?s=128&d=identicon&r=PG&f=1", "display_name": "Arushi", "link": "https://stackoverflow.com/users/4540358/arushi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 512, "favorite_count": 0, "accepted_answer_id": 53751330, "answer_count": 1, "score": -2, "last_activity_date": 1544690402, "creation_date": 1544648271, "last_edit_date": 1544690402, "question_id": 53751228, "link": "https://stackoverflow.com/questions/53751228/how-to-ensure-that-all-async-functions-run-before-defer-is-executed", "title": "How to ensure that all Async functions Run before defer is executed", "body": "<p>I have a function say </p>\n\n<pre><code>Myfunction() {  \n      x.RunAsync() //Async Function call \n}\n</code></pre>\n\n<p>I have to write a test case for <code>Myfunction()</code>. I am using go-mock for this. Also  have mocked <code>x</code>. </p>\n\n<pre><code>Test_MyFunction() {\n   mockCtrl := gomock.NewController(t)\n   defer mockCtrl.Finish()\n   //EXPECT() call to stub RunAsync()\n}\n</code></pre>\n\n<p>Problem now is my test runs successfully, but somehow at the end it panics saying, that call to <code>mockX.RunAsync()</code> is missing.\nI think this is because defer is being executed before my RunAsync was stubbed.\nHow do I ensure that all Async functions run before defer is executed.</p>\n"}, {"tags": ["docker", "go", "dockerfile"], "comments": [{"owner": {"reputation": 413, "user_id": 4614306, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1vO71.jpg?s=128&g=1", "display_name": "Alirus", "link": "https://stackoverflow.com/users/4614306/alirus"}, "edited": false, "score": 0, "creation_date": 1544645676, "post_id": 53750330, "comment_id": 94354058, "body": "Have you tried to disable <i>CGO</i> by setting <code>CGO_ENABLED</code> environment variable to <code>0</code> (zero)?"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "reply_to_user": {"reputation": 413, "user_id": 4614306, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1vO71.jpg?s=128&g=1", "display_name": "Alirus", "link": "https://stackoverflow.com/users/4614306/alirus"}, "edited": false, "score": 0, "creation_date": 1544645834, "post_id": 53750330, "comment_id": 94354130, "body": "@Alirus - yes I did it and it doesnt work, same error"}, {"owner": {"reputation": 413, "user_id": 4614306, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1vO71.jpg?s=128&g=1", "display_name": "Alirus", "link": "https://stackoverflow.com/users/4614306/alirus"}, "edited": false, "score": 0, "creation_date": 1544646018, "post_id": 53750330, "comment_id": 94354203, "body": "Maybe, and just maybe, you&#39;re not doing it right. Try to prepend it to the <code>make lint</code> command, such as <code>RUN CGO_ENABLED=0 &amp;&amp; make lint</code>, and see the result."}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "reply_to_user": {"reputation": 413, "user_id": 4614306, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1vO71.jpg?s=128&g=1", "display_name": "Alirus", "link": "https://stackoverflow.com/users/4614306/alirus"}, "edited": false, "score": 0, "creation_date": 1544646055, "post_id": 53750330, "comment_id": 94354217, "body": "@Alirus - Ok I will try it now"}, {"owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "reply_to_user": {"reputation": 413, "user_id": 4614306, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1vO71.jpg?s=128&g=1", "display_name": "Alirus", "link": "https://stackoverflow.com/users/4614306/alirus"}, "edited": false, "score": 0, "creation_date": 1544646975, "post_id": 53750330, "comment_id": 94354606, "body": "@Alirus - Thanks, I try that either and same erorr I got , any other hint pls?"}], "answers": [{"tags": [], "owner": {"reputation": 3839, "user_id": 275491, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Gd1Wr.jpg?s=128&g=1", "display_name": "majgis", "link": "https://stackoverflow.com/users/275491/majgis"}, "is_accepted": true, "score": 2, "last_activity_date": 1544657784, "creation_date": 1544657784, "answer_id": 53753009, "question_id": 53750330, "link": "https://stackoverflow.com/questions/53750330/build-docker-go-application-with-command-to-lint/53753009#53753009", "title": "Build docker go application with command to lint", "body": "<p>You are not correctly setting the <a href=\"https://docs.docker.com/engine/reference/builder/#env\" rel=\"nofollow noreferrer\">environment variable in your Dockerfile</a>.</p>\n\n<p><code>RUN CGO_ENABLED=0\n</code></p>\n\n<p>should be</p>\n\n<p><code>ENV CGO_ENABLED=0\n</code></p>\n"}], "owner": {"reputation": 2317, "user_id": 3012133, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/40901b470f6e02cb5426bccd3f594308?s=128&d=identicon&r=PG&f=1", "display_name": "07_05_GuyT", "link": "https://stackoverflow.com/users/3012133/07-05-guyt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 210, "favorite_count": 1, "accepted_answer_id": 53753009, "answer_count": 1, "score": 1, "last_activity_date": 1544657784, "creation_date": 1544643983, "last_edit_date": 1544647242, "question_id": 53750330, "link": "https://stackoverflow.com/questions/53750330/build-docker-go-application-with-command-to-lint", "title": "Build docker go application with command to lint", "body": "<p>I've created the following docker container , all works except on thing which is the make lint</p>\n\n<p>In the project root I've <code>Makefile</code> with the current entry</p>\n\n<pre><code>lint:\n    gometalinter --config=gometalinter.json ./...\n</code></pre>\n\n<p>when I use it locally in my machine (macbook) and if for example file is not formatted <code>go fmt</code> I get error when executing above code.</p>\n\n<p>The problem is that when I create the docker image via <code>docker build command</code></p>\n\n<p>I got different linting issues which is not related to my project.\nin the <code>gometalinter.json</code> I've the following entry to bypass the vendor directory </p>\n\n<pre><code>{\n  \"vendor\": true\n}\n</code></pre>\n\n<p>This is the docker content</p>\n\n<pre><code>FROM golang:1.11.1-alpine3.7 \n\nRUN apk add --update --no-cache git make curl bash\n\nADD https://github.com/golang/dep/releases/download/v0.5.0/dep-linux-amd64 /usr/bin/dep\nRUN chmod +x /usr/bin/dep\n\nWORKDIR /go/src/my-proj\n\nCOPY . ./\n\nCOPY Gopkg.toml Gopkg.lock ./\n\nRUN dep ensure \n# From the error it seems that this is related to cgo but even adding the next line doesnt helps, same error occurred \nRUN CGO_ENABLED=0\n# this command download gometalinter which is running OK\nRUN make download \n\nRUN make lint\n</code></pre>\n\n<p>when I run the lint this is what I got which is not related to my project</p>\n\n<pre><code>../../../usr/local/go/src/net/lookup_unix.go:80:24:warning: error return value not checked (undeclared name: cgoLookupHost) (errcheck)\n../../../usr/local/go/src/net/lookup_unix.go:95:24:warning: error return value not checked (undeclared name: cgoLookupIP) (errcheck)\n../../../usr/local/go/src/net/lookup_unix.go:107:23:warning: error return value not checked (undeclared name: cgoLookupPort) (errcheck)\n../../../usr/local/go/src/net/lookup_unix.go:123:24:warning: error return value not checked (undeclared name: cgoLookupCNAME) (errcheck)\n../../../usr/local/go/src/net/lookup_unix.go:323:23:warning: error return value not checked (undeclared name: cgoLookupPTR) (errcheck)\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 16, "last_activity_date": 1544639273, "creation_date": 1544639273, "answer_id": 53749212, "question_id": 53749097, "link": "https://stackoverflow.com/questions/53749097/how-to-append-to-a-file-if-it-exists-else-create-a-new-and-write-to-it/53749212#53749212", "title": "How to append to a file if it exists else create a new and write to it", "body": "<p>The <a href=\"https://godoc.org/os#example-OpenFile--Append\" rel=\"noreferrer\">OpenFile</a> example shows how to append to existing file or create a new file.  The code is:</p>\n\n<pre><code>// If the file doesn't exist, create it, or append to the file\nf, err := os.OpenFile(\"access.log\", os.O_APPEND|os.O_CREATE|os.O_WRONLY, 0644)\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 1463, "user_id": 1892775, "user_type": "registered", "accept_rate": 16, "profile_image": "https://www.gravatar.com/avatar/a05d3ed9866b27ffd474053d3884394e?s=128&d=identicon&r=PG", "display_name": "user1892775", "link": "https://stackoverflow.com/users/1892775/user1892775"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6636, "favorite_count": 0, "closed_date": 1544639263, "answer_count": 1, "score": 4, "last_activity_date": 1544641582, "creation_date": 1544638782, "last_edit_date": 1544641582, "question_id": 53749097, "link": "https://stackoverflow.com/questions/53749097/how-to-append-to-a-file-if-it-exists-else-create-a-new-and-write-to-it", "closed_reason": "Duplicate", "title": "How to append to a file if it exists else create a new and write to it", "body": "<p>I have a file that I would like to add some contents to. I first check if that file exists. If it does, I add contents to it. If not, I just create a new file with that name and write to it. For this, I am doing something like:</p>\n\n<pre><code>if _, err := os.Stat(filename); os.IsNotExist(err) {\n    f, err := os.Create(filename)\n    if err != nil {\n        panic(err)\n    }\n        ....\n} else {\n    f, _ := os.OpenFile(filename, os.O_RDWR|os.O_APPEND, 0660);\n    ....\n}\n</code></pre>\n\n<p>Is it possible to make this code shorter like 1-2 liner?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 3, "last_activity_date": 1544633348, "creation_date": 1544633348, "answer_id": 53747701, "question_id": 53747539, "link": "https://stackoverflow.com/questions/53747539/why-does-golang-extern-go-use-1skip-1/53747701#53747701", "title": "Why does GoLang Extern.go use 1+skip-1?", "body": "<p>This is addressed in <a href=\"https://github.com/golang/go/issues/26437\" rel=\"nofollow noreferrer\">#26437</a>, and has since <a href=\"https://github.com/golang/go/commit/68527ff4fb32c98b1f15367c65c526c2b2b3a57a\" rel=\"nofollow noreferrer\">been removed</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1544633356, "creation_date": 1544633356, "answer_id": 53747702, "question_id": 53747539, "link": "https://stackoverflow.com/questions/53747539/why-does-golang-extern-go-use-1skip-1/53747702#53747702", "title": "Why does GoLang Extern.go use 1+skip-1?", "body": "<p>See <a href=\"https://github.com/golang/go/issues/26437\" rel=\"nofollow noreferrer\">Issue 26437</a>.  </p>\n\n<p>The code was changed from <code>1+skip</code> to <code>1+skip-1</code> in <a href=\"https://codereview.appspot.com/4810054\" rel=\"nofollow noreferrer\">this change</a>.  The code could have been changed to just <code>skip</code>, but it was not.  The extra +1 -1 was removed in <a href=\"https://go-review.googlesource.com/c/go/+/124895/\" rel=\"nofollow noreferrer\">this change</a>.</p>\n"}], "owner": {"reputation": 141, "user_id": 3213788, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/954c2dffcc1769835d3a88b6bce25414?s=128&d=identicon&r=PG&f=1", "display_name": "TeckFudge", "link": "https://stackoverflow.com/users/3213788/teckfudge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 53747702, "answer_count": 2, "score": 1, "last_activity_date": 1544633356, "creation_date": 1544632721, "question_id": 53747539, "link": "https://stackoverflow.com/questions/53747539/why-does-golang-extern-go-use-1skip-1", "title": "Why does GoLang Extern.go use 1+skip-1?", "body": "<p>In the GoLang source <a href=\"https://golang.org/src/runtime/extern.go\" rel=\"nofollow noreferrer\">https://golang.org/src/runtime/extern.go</a> on line 179, there is a function call that doesn't make sense on the surface. What are the side effects of <code>1+skip-1</code> that caused the Go Authors to write this instead of simply using <code>skip</code> in the function call?</p>\n\n<pre><code>if callers(1+skip-1, rpc[:]) &lt; 2 {\n    return\n}\n</code></pre>\n"}, {"tags": ["linux", "go", "virtual-memory", "gccgo", "memory-overcommitment"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1544632685, "post_id": 53747493, "comment_id": 94347487, "body": "Virtual memory usage is pretty irrelevant, and comparing VmSize to physical memory is completely irrelevant. Resident size is what actually matters."}, {"owner": {"reputation": 150, "user_id": 837824, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/51ecbcda65e4c5170ac48b72e570d03f?s=128&d=identicon&r=PG", "display_name": "Aaron Wright", "link": "https://stackoverflow.com/users/837824/aaron-wright"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544632979, "post_id": 53747493, "comment_id": 94347647, "body": "@Adrian, doesn&#39;t it mean that the executable allocated it and could potentially use it at some point? This device doesn&#39;t have a swap file, so if the executable attempted to use 800 MiB of RAM it would fail."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1544634421, "post_id": 53747493, "comment_id": 94348395, "body": "No, it doesn&#39;t. It is &quot;the virtual size of a process, which is the sum of memory it is actually using, memory it has mapped into itself (for instance the video card\u2019s RAM for the X server), files on disk that have been mapped into it (most notably shared libraries), and memory shared with other processes.&quot;"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544634551, "post_id": 53747493, "comment_id": 94348460, "body": "Even with no pagefile, memory-mapped files (including the binary itself and any loaded shared libraries) can be swapped to/from disk, because they already exist on disk. A second copy needn&#39;t be written to a swap file to use them in virtual memory."}, {"owner": {"reputation": 150, "user_id": 837824, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/51ecbcda65e4c5170ac48b72e570d03f?s=128&d=identicon&r=PG", "display_name": "Aaron Wright", "link": "https://stackoverflow.com/users/837824/aaron-wright"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544635751, "post_id": 53747493, "comment_id": 94349151, "body": "I feel like you&#39;re addressing virtual memory in general, and not VmData specifically, which is what the question is asking. The things you describe would be VmExe and VmLib, which seem to be reasonable numbers here, and are not part of my question."}], "answers": [{"comments": [{"owner": {"reputation": 150, "user_id": 837824, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/51ecbcda65e4c5170ac48b72e570d03f?s=128&d=identicon&r=PG", "display_name": "Aaron Wright", "link": "https://stackoverflow.com/users/837824/aaron-wright"}, "edited": false, "score": 0, "creation_date": 1544651832, "post_id": 53750024, "comment_id": 94356682, "body": "Libraries would not count towards VmData."}], "tags": [], "owner": {"reputation": 18530, "user_id": 3344003, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/988af95d5692ee66b1fc2fe725ba738e?s=128&d=identicon&r=PG&f=1", "display_name": "user3344003", "link": "https://stackoverflow.com/users/3344003/user3344003"}, "is_accepted": false, "score": 0, "last_activity_date": 1544642730, "creation_date": 1544642730, "answer_id": 53750024, "question_id": 53747493, "link": "https://stackoverflow.com/questions/53747493/how-can-i-reduce-the-virtual-memory-required-by-gccgo-compiled-executable/53750024#53750024", "title": "How can I reduce the virtual memory required by gccgo compiled executable?", "body": "<p>The likely cause is that you are linking libraries into the code. My guess is that you'd be able to get a smaller logical address space if you were to explicitly link to static libraries so that you get the minimum added to your executable. In any event, there is minimum harm in having a large logical address space.</p>\n"}, {"tags": [], "owner": {"reputation": 150, "user_id": 837824, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/51ecbcda65e4c5170ac48b72e570d03f?s=128&d=identicon&r=PG", "display_name": "Aaron Wright", "link": "https://stackoverflow.com/users/837824/aaron-wright"}, "is_accepted": true, "score": 1, "last_activity_date": 1544824598, "creation_date": 1544824598, "answer_id": 53787408, "question_id": 53747493, "link": "https://stackoverflow.com/questions/53747493/how-can-i-reduce-the-virtual-memory-required-by-gccgo-compiled-executable/53787408#53787408", "title": "How can I reduce the virtual memory required by gccgo compiled executable?", "body": "<p>I was able to locate where gccgo is asking for so much memory. It's in the libgo/go/runtime/malloc.go file in the mallocinit function:</p>\n\n<pre><code>// If we fail to allocate, try again with a smaller arena.\n// This is necessary on Android L where we share a process\n// with ART, which reserves virtual memory aggressively.\n// In the worst case, fall back to a 0-sized initial arena,\n// in the hope that subsequent reservations will succeed.\narenaSizes := [...]uintptr{\n  512 &lt;&lt; 20,\n  256 &lt;&lt; 20,\n  128 &lt;&lt; 20,\n  0,\n}\n\nfor _, arenaSize := range &amp;arenaSizes {\n  // SysReserve treats the address we ask for, end, as a hint,\n  // not as an absolute requirement. If we ask for the end\n  // of the data segment but the operating system requires\n  // a little more space before we can start allocating, it will\n  // give out a slightly higher pointer. Except QEMU, which\n  // is buggy, as usual: it won't adjust the pointer upward.\n  // So adjust it upward a little bit ourselves: 1/4 MB to get\n  // away from the running binary image and then round up\n  // to a MB boundary.\n  p = round(getEnd()+(1&lt;&lt;18), 1&lt;&lt;20)\n  pSize = bitmapSize + spansSize + arenaSize + _PageSize\n  if p &lt;= procBrk &amp;&amp; procBrk &lt; p+pSize {\n    // Move the start above the brk,\n    // leaving some room for future brk\n    // expansion.\n    p = round(procBrk+(1&lt;&lt;20), 1&lt;&lt;20)\n  }\n  p = uintptr(sysReserve(unsafe.Pointer(p), pSize, &amp;reserved))\n  if p != 0 {\n    break\n  }\n}\nif p == 0 {\n  throw(\"runtime: cannot reserve arena virtual address space\")\n}\n</code></pre>\n\n<p>The interesting part is that it falls back to smaller arena sizes if larger ones fail. So limiting the virtual memory available to a go executable will actually limit how much it will successfully allocate.</p>\n\n<p>I was able to use <code>ulimit -v 327680</code> to limit the virtual memory to smaller numbers:</p>\n\n<pre><code>VmPeak:   300772 kB\nVmSize:   300772 kB\nVmLck:         0 kB\nVmPin:         0 kB\nVmHWM:      5712 kB\nVmRSS:      5712 kB\nVmData:   296276 kB\nVmStk:       132 kB\nVmExe:      2936 kB\nVmLib:         0 kB\nVmPTE:        56 kB\nVmPMD:         0 kB\nVmSwap:        0 kB\n</code></pre>\n\n<p>These are still big numbers, but the best that a gccgo executable can achieve. So the answer to the question is, yes you can reduce the VmData of a gccgo compiled executable, but you really shouldn't worry about it. <em>(On a 64 bit machine gccgo tries to allocate 512 GB.)</em></p>\n"}], "owner": {"reputation": 150, "user_id": 837824, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/51ecbcda65e4c5170ac48b72e570d03f?s=128&d=identicon&r=PG", "display_name": "Aaron Wright", "link": "https://stackoverflow.com/users/837824/aaron-wright"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 529, "favorite_count": 0, "accepted_answer_id": 53787408, "answer_count": 2, "score": -5, "last_activity_date": 1549852926, "creation_date": 1544632605, "last_edit_date": 1549852926, "question_id": 53747493, "link": "https://stackoverflow.com/questions/53747493/how-can-i-reduce-the-virtual-memory-required-by-gccgo-compiled-executable", "title": "How can I reduce the virtual memory required by gccgo compiled executable?", "body": "<p>When I compile this simple hello world example using gccgo, the resulting executable uses over 800 MiB of VmData. I would like to know why, and if there is anything I can do to lower that. The sleep is just to give me time to observe the memory usage.</p>\n\n<p>The source:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"time\"\n)\n\nfunc main() {\n  fmt.Println(\"hello world\")\n  time.Sleep(1000000000 * 5)\n}\n</code></pre>\n\n<p>The script I use to compile:</p>\n\n<pre><code>#!/bin/bash\n\nTOOLCHAIN_PREFIX=i686-linux-gnu\nOPTIMIZATION_FLAG=\"-O3\"\n\nCGO_ENABLED=1 \\\nCC=${TOOLCHAIN_PREFIX}-gcc-8 \\\nCXX=${TOOLCHAIN_PREFIX}-g++-8 \\\nAR=${TOOLCHAIN_PREFIX}-ar \\\nGCCGO=${TOOLCHAIN_PREFIX}-gccgo-8 \\\nCGO_CFLAGS=\"-g ${OPTIMIZATION_FLAG}\" \\\nCGO_CPPFLAGS=\"\" \\\nCGO_CXXFLAGS=\"-g ${OPTIMIZATION_FLAG}\" \\\nCGO_FFLAGS=\"-g ${OPTIMIZATION_FLAG}\" \\\nCGO_LDFLAGS=\"-g ${OPTIMIZATION_FLAG}\" \\\nGOOS=linux \\\nGOARCH=386 \\\ngo build -x \\\n   -compiler=gccgo \\\n   -gccgoflags=all=\"-static -g ${OPTIMIZATION_FLAG}\" \\\n   $1\n</code></pre>\n\n<p>The version of gccgo:</p>\n\n<pre><code>$ i686-linux-gnu-gccgo-8 --version\ni686-linux-gnu-gccgo-8 (Ubuntu 8.2.0-1ubuntu2~18.04) 8.2.0\nCopyright (C) 2018 Free Software Foundation, Inc.\nThis is free software; see the source for copying conditions.  There is NO\nwarranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n</code></pre>\n\n<p>The output from /proc/&lt;pid&gt;/status:</p>\n\n<pre><code>VmPeak:  811692 kB\nVmSize:  811692 kB\nVmLck:        0 kB\nVmPin:        0 kB\nVmHWM:     5796 kB\nVmRSS:     5796 kB\nVmData:  807196 kB\nVmStk:      132 kB\nVmExe:     2936 kB\nVmLib:        0 kB\nVmPTE:       52 kB\nVmPMD:        0 kB\nVmSwap:       0 kB\n</code></pre>\n\n<p>I ask because my device only has 512 MiB of RAM. I know that this is virtual memory but I would like to reduce or remove the overcommit if possible. It does not seem reasonable to me for a simple executable to require that much allocation.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1544632595, "post_id": 53747368, "comment_id": 94347441, "body": "Unrelated to the root question but you might want to read <a href=\"https://golang.org/doc/effective_go.html#names\" rel=\"nofollow noreferrer\">Effective Go</a> and consider running a linter against your code. These VARIABLE_NAMES look more like Bash than Go and are pretty distracting, especially with as much code as you&#39;ve posted here."}, {"owner": {"reputation": 2942, "user_id": 477340, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a858a54895a4242c16f7f43f92fd343d?s=128&d=identicon&r=PG", "display_name": "khinester", "link": "https://stackoverflow.com/users/477340/khinester"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544634520, "post_id": 53747368, "comment_id": 94348442, "body": "I am simply following the aws lambda convention <a href=\"https://docs.aws.amazon.com/lambda/latest/dg/current-supported-versions.html#lambda-environment-variables\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/lambda/latest/dg/&hellip;</a> to name my variables"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544634632, "post_id": 53747368, "comment_id": 94348502, "body": "Those conventions are for environment variables, and those are perfectly normal names for environment variables, and completely un-idiomatic names for Go variables. When you read an environment variable and store it in a Go variable, there is no reason to use environment variable naming conventions for the Go variables you store their values in."}], "answers": [{"comments": [{"owner": {"reputation": 3063, "user_id": 1433639, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/Z5c6l.jpg?s=128&g=1", "display_name": "Chitrank Dixit", "link": "https://stackoverflow.com/users/1433639/chitrank-dixit"}, "edited": false, "score": 1, "creation_date": 1554188414, "post_id": 53769682, "comment_id": 97648515, "body": "My Lambda function has max memory 3008 Mb and I am only using 1300 mb but still I am getting the <code>curl: (56) Unexpected EOF</code>, I have also set timeout to 15 mins and my request is completed in 6 mins."}, {"owner": {"reputation": 2942, "user_id": 477340, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a858a54895a4242c16f7f43f92fd343d?s=128&d=identicon&r=PG", "display_name": "khinester", "link": "https://stackoverflow.com/users/477340/khinester"}, "reply_to_user": {"reputation": 3063, "user_id": 1433639, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/Z5c6l.jpg?s=128&g=1", "display_name": "Chitrank Dixit", "link": "https://stackoverflow.com/users/1433639/chitrank-dixit"}, "edited": false, "score": 0, "creation_date": 1554229445, "post_id": 53769682, "comment_id": 97672457, "body": "are you able to run it locally? else add some print statements and see if your function breaks in between"}], "tags": [], "owner": {"reputation": 2942, "user_id": 477340, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a858a54895a4242c16f7f43f92fd343d?s=128&d=identicon&r=PG", "display_name": "khinester", "link": "https://stackoverflow.com/users/477340/khinester"}, "is_accepted": false, "score": 0, "last_activity_date": 1544733350, "creation_date": 1544733350, "answer_id": 53769682, "question_id": 53747368, "link": "https://stackoverflow.com/questions/53747368/why-am-i-getting-an-unexpected-eof-from-this-api-call/53769682#53769682", "title": "Why am I getting an unexpected EOF from this API call?", "body": "<p>the issue was that my lambda function had only 128Mb memory and the endpoint served 130Mb file, so increasing this fixed the issue</p>\n"}], "owner": {"reputation": 2942, "user_id": 477340, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a858a54895a4242c16f7f43f92fd343d?s=128&d=identicon&r=PG", "display_name": "khinester", "link": "https://stackoverflow.com/users/477340/khinester"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1687, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1544733350, "creation_date": 1544632189, "last_edit_date": 1544633785, "question_id": 53747368, "link": "https://stackoverflow.com/questions/53747368/why-am-i-getting-an-unexpected-eof-from-this-api-call", "title": "Why am I getting an unexpected EOF from this API call?", "body": "<p>I have the following Go code which I am running as an AWS Lambda cron, but I am unsure why I get this error:</p>\n\n<pre><code>sls logs --stage prod --region eu-west-1 --function esCronFn\n2018/12/12 12:07:01 unexpected EOF\n2018/12/12 12:07:01 unexpected EOF\nEND RequestId: 6bf33d28-fe03-11e8-949d-f39174c57cab\nREPORT RequestId: 6bf33d28-fe03-11e8-949d-f39174c57cab  Duration: 464734.47 ms  Billed Duration: 464800 ms      Memory Size: 256 MB     Max Memory Used: 257 MB\n\nRequestId: 6bf33d28-fe03-11e8-949d-f39174c57cab Process exited before completing request\n</code></pre>\n\n<p>this is my main.go - it basically connects to an external API and pulls records which I am processing and uploading to an S3 bucket.</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"bytes\"\n    \"encoding/csv\"\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"net/url\"\n    \"os\"\n    \"strings\"\n    \"time\"\n\n    \"github.com/aws/aws-lambda-go/lambda\"\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/service/s3\"\n    \"github.com/aws/aws-sdk-go/service/s3/s3iface\"\n)\n\nvar (\n    // ENDPOINT is the endpoint from which incomplete CSV records are downloaded\n    ENDPOINT = os.Getenv(\"ENDPOINT\")\n\n    PARSED_ENDPOINT *url.URL\n\n    // TOKEN authenticates requests sent to eshot API\n    TOKEN = os.Getenv(\"TOKEN\")\n\n    // BUCKET is the S3 bucket to which CSV files are uploaded\n    BUCKET = os.Getenv(\"BUCKET\")\n\n    svc s3iface.S3API\n)\n\n// Record is the JSON response returned by a successful request to API\ntype EsRecord struct {\n    Salutation   string    `json:\"Salutation\"`\n    Firstname    string    `json:\"Firstname\"`\n    Lastname     string    `json:\"Lastname\"`\n    Company      string    `json:\"Company\"`\n    EEA          string    `json:\"EEA\"`\n    ModifiedDate time.Time `json:\"ModifiedDate\"`\n    SubaccountID string    `json:\"SubaccountId\"`\n    Email        string    `json:\"Email\"`\n}\n\n// CsvData holds reference to underlying buffer and the csv writer\ntype CsvData struct {\n    Buffer *bytes.Buffer\n    Writer *csv.Writer\n}\n\nfunc init() {\n    today := time.Now()\n\n    // If ENDPOINT is empty, It'll use this hardcoded endpoint. The ENDPOINT variable should not contain any text after \"ModifiedDate gt\". The actual date is currentDay-1\n    if ENDPOINT == \"\" {\n        ENDPOINT = \"https://rest-api.domain.tld/Export/?$select=Email,Firstname,Lastname,SubaccountId,EEA,ModifiedDate&amp;$filter=(EEA eq '' or EEA eq null) and ModifiedDate gt\"\n    }\n\n    // Append CurrentDay-1 in YYYY-MM-DDTHH:MM:SSZ format.\n    // The time is NOT in UTC. It's the local time of the machine on which lambda function was running\n    ENDPOINT = fmt.Sprintf(\"%s %sT00:00:00Z\", ENDPOINT, today.AddDate(0, 0, -1).Format(\"2006-01-02\"))\n\n    var err error\n    PARSED_ENDPOINT, err = url.Parse(ENDPOINT)\n    if err != nil {\n        log.Fatalln(\"Invalid $ENDPOINT\", err)\n    }\n\n    PARSED_ENDPOINT.RawQuery = QueryEscape(PARSED_ENDPOINT.RawQuery)\n}\n\nfunc main() {\n    if TOKEN == \"\" {\n        log.Fatalln(\"$TOKEN is empty\")\n    }\n    if BUCKET == \"\" {\n        log.Fatalln(\"$BUCKET is empty\")\n    }\n    // Create S3 session\n    svc = s3iface.S3API(s3.New(session.Must(session.NewSession())))\n\n    lambda.Start(CreateAndUploadCsvToS3)\n}\n\nfunc CreateAndUploadCsvToS3() error {\n\n    resp, err := fetchRecords()\n    if err != nil {\n        return fmt.Errorf(\"error in fetching records: %s\", err)\n    }\n    defer resp.Body.Close()\n\n    if resp.StatusCode != http.StatusOK {\n        b, _ := ioutil.ReadAll(resp.Body)\n        return fmt.Errorf(\"api returned non 200 response(%d), URL: %s, %s\", resp.StatusCode, PARSED_ENDPOINT.String(), string(b))\n    }\n\n    // API returns array of EshotRecord\n    esRecords := []EsRecord{}\n\n    err = json.NewDecoder(resp.Body).Decode(&amp;esRecords)\n    if err != nil {\n        b, _ := ioutil.ReadAll(resp.Body)\n        return fmt.Errorf(\"error in parsing response %s: %s\", err, string(b))\n    }\n\n    recordsMap := ParseEsRecordsJSON(esRecords)\n\n    ct := time.Now().String()\n    for k, v := range recordsMap {\n\n        key := fmt.Sprintf(\"%s_%s.csv\", k, ct)\n\n        _, err := svc.PutObject(&amp;s3.PutObjectInput{\n            Bucket: aws.String(BUCKET),\n            // Key is in format, &lt;subaccountid&gt;_&lt;current timestamp&gt;.csv\n            Key:  aws.String(key),\n            Body: bytes.NewReader(v.Buffer.Bytes()),\n        })\n        if err != nil {\n            return fmt.Errorf(\"error in uploading %s: %s\", key, err)\n        }\n    }\n\n    return nil\n}\n\n// ParseEsRecordsJSON takes an array of EsRecord\n// Seperates each record by subAccountId\n// Creates CSV files for each SubAccountId\n// Returns the hashmap\nfunc ParseEsRecordsJSON(esRecords []EsRecord) map[string]CsvData {\n    recordsMap := make(map[string]CsvData)\n\n    for _, v := range esRecords {\n        // If v.SubaccountID was encountered for the first time\n        // 1. Create a Buffer\n        // 2. Write CSV headers to this buffer\n        // 3. Store reference to this buffer and csv writer in hashmap\n        if _, ok := recordsMap[v.SubaccountID]; !ok {\n            var buf bytes.Buffer\n\n            writer := csv.NewWriter(&amp;buf)\n            // Write CSV headers\n            err := writer.Write([]string{\"Firstname\", \"Lastname\", \"Email\"})\n            if err != nil {\n                log.Printf(\"error occurred in inserting headers for subAccountId(%s): %s\\n\", v.SubaccountID, err)\n            }\n\n            // store reference to writer object for this subaccountid in hashmap\n            recordsMap[v.SubaccountID] = CsvData{\n                Buffer: &amp;buf,\n                Writer: writer,\n            }\n        }\n        csvRef := recordsMap[v.SubaccountID]\n\n        err := csvRef.Writer.Write([]string{v.Firstname, v.Lastname, v.Email})\n        if err != nil {\n            log.Printf(\"error occurred in inserting headers for subAccountId(%s): %s\\n\", v.SubaccountID, err)\n        }\n        csvRef.Writer.Flush()\n    }\n    return recordsMap\n}\n\n// FetchRecords makes a request to API and returns http.Response\nfunc fetchRecords() (*http.Response, error) {\n    req, err := http.NewRequest(\"GET\", PARSED_ENDPOINT.String(), nil)\n    if err != nil {\n        return nil, err\n    }\n\n    req.Header.Set(\"Authorization\", fmt.Sprintf(\"Token %s\", TOKEN))\n    client := &amp;http.Client{}\n    return client.Do(req)\n}\n\n// QueryEscape replaces URL unsafe characters as listed in HTTP RFC with their HEX values.\n// The QueryEscape function in Go strictly adheres to the RFC and replaces all the characters listed in RFC with their HEX values.\n// Curl/Postman only encodes parameters on a strict \"need\" only bases. Presumably, the endpoint does not seems to be working with Go's encoded string.\n// This code escapes all the charactes and then performs uses string replace to make the URL more like what CURL would have done.\nfunc QueryEscape(s string) string {\n    s = url.QueryEscape(s)\n\n    s = strings.Replace(s, \"%2C\", \",\", -1)\n    s = strings.Replace(s, \"%24\", \"$\", -1)\n    s = strings.Replace(s, \"%3D\", \"=\", -1)\n    s = strings.Replace(s, \"+\", \"%20\", -1)\n    s = strings.Replace(s, \"%26\", \"&amp;\", -1)\n    s = strings.Replace(s, \"%3A\", \":\", -1)\n\n    return s\n}\n</code></pre>\n\n<p>If I change the <code>ENDPOINT</code> from:</p>\n\n<pre><code>ENDPOINT = \"https://rest-api.domain.tld/Export/?$select=Email,Firstname,Lastname,SubaccountId,EEA,ModifiedDate&amp;$filter=(EEA eq '' or EEA eq null) and ModifiedDate gt\"\n</code></pre>\n\n<p>to</p>\n\n<pre><code>ENDPOINT = \"https://rest-api.domain.tld/Export/?$select=Email,Firstname,Lastname,SubaccountId,EEA,ModifiedDate&amp;$filter=EEA eq '' and ModifiedDate gt\"\n</code></pre>\n\n<p>I don't get the <code>EOF</code> error, but then I don't get the full list, running curl, I get the data I need, so I am unsure why my code is failing and how best to track where it is failing?</p>\n"}, {"tags": ["dictionary", "go", "data-structures", "tree", "big-o"], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1544868488, "creation_date": 1544630311, "last_edit_date": 1544868488, "question_id": 53746810, "link": "https://stackoverflow.com/questions/53746810/what-data-structure-could-be-used-to-support-foreign-keys-constraints", "title": "what data structure could be used to support foreign keys constraints", "body": "<p>Giving some context, I am implementing a fan-out (streaming) using gRPC, on the server every time a client connects,  I save the stream into a map and when the client disconnects I just remove it from the map so that I could keep the map updated with only \"live\" clients/connections.</p>\n\n<p>So the initial map looks something like this:</p>\n\n<pre><code>key        value\nclient1    stream\nclient2    stream\nclient3    stream\n</code></pre>\n\n<p>The problem with this implementation is that if a client connects multiple times, only the last client (using the same <code>key id</code>) will receive the \"broadcasted\" message, since the map will overwrite the existing stream with the latest one from the client connecting, therefore I need to either use a unique key or to find a way to match, relate clients and connections.</p>\n\n<p>I found easy to just switch the map and use as the key the connection ID, something like this</p>\n\n<pre><code>conn_id   client_id\nconn1     client1\nconn2     client2 \\\nconn3     client2  &gt; 3 connections for client ID 2\nconn4     client2 /\n</code></pre>\n\n<p>This works and helps to send a message to all connected clients, but makes things more complex if I would like to send a message to a specific client since I would need to range/traverse the full map to match the value with the desired client.</p>\n\n<p>In an attempt to fix this, I switched back the map using the client_id, but instead of using the stream as the value, I am using a list of slices </p>\n\n<pre><code>key        value\nclient1   [stream, stream, stream]\nclient2   [stream]\nclient3   [stream, stream] \n</code></pre>\n\n<p>The problem persists since in order to send a message to all the clients the full map still needs to be traverse/range to get streams per client and send the message to each.</p>\n\n<p>Therefore without using a database wondering what data structure could it be used following best practices regarding the <a href=\"https://en.wikipedia.org/wiki/Time_complexity#Table_of_common_time_complexities\" rel=\"nofollow noreferrer\">big O notation</a>?</p>\n\n<p>Mainly would like to find something that behaves similarly to database <a href=\"https://en.wikipedia.org/wiki/Foreign_key\" rel=\"nofollow noreferrer\">foreign keys</a>, probably having 2 maps one keeping all connections and other just keeping status or number of connections per client, for example:</p>\n\n<pre><code>key      value            client_id   # streams \nconn1    client1          client1     1   \nconn2    client2          client2     3\nconn3    client2\nconn4    client2\n</code></pre>\n\n<p>But how to \"atomically\" remove a client from the <code>clients</code> map when there are no more connections from that client in the <code>connections</code> map.</p>\n\n<p>This is a try but wondering if could be improved:</p>\n\n<p><a href=\"https://play.golang.org/p/VEoLsWh6dbJ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VEoLsWh6dbJ</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n\n    clients := &amp;sync.Map{}\n    for i := 0; i &lt; 100; i++ {\n        clientID := fmt.Sprintf(\"client-%d\", i%5)\n        connID := fmt.Sprintf(\"conn-%d\", i)\n        client, ok := clients.LoadOrStore(clientID, connID)\n        if ok {\n            switch c := client.(type) {\n            case string:\n                client = []string{c, connID}\n            case []string:\n                client = append(client.([]string), connID)\n            }\n            clients.Store(clientID, client)\n        }\n    }\n\n    list := func(k, v interface{}) bool {\n        fmt.Printf(\"k: %+v v: %v\\n\", k, v)\n        return true\n    }\n\n    clients.Range(list)\n\n    // Get all connections\n    broadcast := func(k, v interface{}) bool {\n        fmt.Printf(\"To all connections from= %q\\n\", k)\n        for _, v := range v.([]string) {\n            fmt.Printf(\"msg to conn = %s\\n\", v)\n        }\n        return true\n    }\n    clients.Range(broadcast)\n}\n</code></pre>\n\n<p>Here my try only using maps (easy to handle deletions) is slower but allocate fewer bytes:</p>\n\n<p><a href=\"https://play.golang.org/p/hz5uRX-VAvH\" rel=\"nofollow noreferrer\">https://play.golang.org/p/hz5uRX-VAvH</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    clients := &amp;sync.Map{}\n    for i := 0; i &lt; 100; i++ {\n        clientID := fmt.Sprintf(\"client-%d\", i%5)\n        connID := fmt.Sprintf(\"conn-%d\", i)\n        conns, ok := clients.Load(clientID)\n        if ok {\n            conns.(*sync.Map).Store(connID, i)\n        } else {\n            conns := &amp;sync.Map{}\n            conns.Store(connID, i)\n            clients.Store(clientID, conns)\n        }\n    }\n\n    list := func(k, v interface{}) bool {\n        fmt.Printf(\"k: %v\\n\", k)\n        listValue := func(j, l interface{}) bool {\n            fmt.Printf(\"  j = %+v\\n\", j)\n            return true\n        }\n        v.(*sync.Map).Range(listValue)\n        return true\n    }\n\n    clients.Range(list)\n\n    // Get all connections\n    broadcast := func(k, v interface{}) bool {\n        fmt.Printf(\"To all connections from= %q\\n\", k)\n        listValue := func(j, l interface{}) bool {\n            fmt.Printf(\"  msg to conn = %s -- %v\\n\", j, l)\n            return true\n        }\n        v.(*sync.Map).Range(listValue)\n        return true\n    }\n    clients.Range(broadcast)\n}\n</code></pre>\n"}, {"tags": ["html", "go", "web-scraping", "extract", "goquery"], "answers": [{"comments": [{"owner": {"reputation": 333, "user_id": 5685796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3879ab371603d4d1e0c30e26e9e8a7d9?s=128&d=identicon&r=PG&f=1", "display_name": "Dentrax", "link": "https://stackoverflow.com/users/5685796/dentrax"}, "edited": false, "score": 0, "creation_date": 1544630969, "post_id": 53746676, "comment_id": 94346502, "body": "I doesn&#39;t work. Returns 0 node. I create a loop and checked it out, but it always turns 0."}, {"owner": {"reputation": 333, "user_id": 5685796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3879ab371603d4d1e0c30e26e9e8a7d9?s=128&d=identicon&r=PG&f=1", "display_name": "Dentrax", "link": "https://stackoverflow.com/users/5685796/dentrax"}, "edited": false, "score": 0, "creation_date": 1544640612, "post_id": 53746676, "comment_id": 94351649, "body": "Hmm, So How can i get movies list? Should i parse <code>search-results-root </code> as a JSON format?"}, {"owner": {"reputation": 6770, "user_id": 3658660, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5b40f4e2bead9eca6951da110a3c84e7?s=128&d=identicon&r=PG&f=1", "display_name": "hlscalon", "link": "https://stackoverflow.com/users/3658660/hlscalon"}, "reply_to_user": {"reputation": 333, "user_id": 5685796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3879ab371603d4d1e0c30e26e9e8a7d9?s=128&d=identicon&r=PG&f=1", "display_name": "Dentrax", "link": "https://stackoverflow.com/users/5685796/dentrax"}, "edited": false, "score": 0, "creation_date": 1544641382, "post_id": 53746676, "comment_id": 94352044, "body": "You have the movies there, for sure, but I don&#39;t think you can parse them with goquery."}], "tags": [], "owner": {"reputation": 6770, "user_id": 3658660, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5b40f4e2bead9eca6951da110a3c84e7?s=128&d=identicon&r=PG&f=1", "display_name": "hlscalon", "link": "https://stackoverflow.com/users/3658660/hlscalon"}, "is_accepted": false, "score": 0, "last_activity_date": 1544633853, "last_edit_date": 1544633853, "creation_date": 1544629853, "answer_id": 53746676, "question_id": 53746518, "link": "https://stackoverflow.com/questions/53746518/how-to-retrieve-search-list-using-goquery-from-rottentomatoes/53746676#53746676", "title": "How to retrieve search list using goquery from RottenTomatoes?", "body": "<p>There are some (many) alternatives but if you want a list of all links of films this should work:</p>\n\n<pre><code>#movieSection &gt; .results_ul &gt; li &gt; div.details &gt; span.bold &gt; a.articleLink\n</code></pre>\n\n<p>This will lead you directly to the links (<code>a</code>), so maybe you'll have to change your function to print names or stop one step before (<code>span</code>)</p>\n\n<p><strong>Edit</strong></p>\n\n<p>Actually, I think can't use goquery to scrap that page. It uses <code>react</code>, so when you download the page (ie <code>curl \"https://www.rottentomatoes.com/search/?search=test\"</code>), you will see this:</p>\n\n<pre><code>&lt;div id=\"main_container\" class=\"container \"&gt;\n    &lt;div class=\"col col-left-center col-full-xs\"&gt;\n        &lt;div id=\"search-results-root\"&gt;&lt;/div&gt;\n            &lt;script&gt;\n                require(['jquery', 'globals', 'search-results', 'bootstrap'], function($, RT, mount) {\n                mount($(\"#search-results-root\").get(0), RT.PrivateApiV2FrontendHost, 'test', {\"actorCount\"....\n</code></pre>\n\n<p>When goquery is expecting html only</p>\n"}], "owner": {"reputation": 333, "user_id": 5685796, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/3879ab371603d4d1e0c30e26e9e8a7d9?s=128&d=identicon&r=PG&f=1", "display_name": "Dentrax", "link": "https://stackoverflow.com/users/5685796/dentrax"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 215, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1544633853, "creation_date": 1544629264, "last_edit_date": 1544631412, "question_id": 53746518, "link": "https://stackoverflow.com/questions/53746518/how-to-retrieve-search-list-using-goquery-from-rottentomatoes", "title": "How to retrieve search list using goquery from RottenTomatoes?", "body": "<p>I'm currently trying to get search list from RottenTomatoes for some researching purposes. I have integrated <code>goquery</code> in an easy way for different sites. But the situation for RottenTomatoes was not the same. I can't get the search list even though I have tried different comminutions with queries.</p>\n\n<p>Testing URL: <code>https://www.rottentomatoes.com/search/?search=test</code></p>\n\n<p>The <strong>text</strong> I want to get: <code>Testament</code></p>\n\n<p><code>doc.Text()</code> <strong>Output:</strong> <code>https://pastebin.com/SsWHYXTH</code></p>\n\n<p><a href=\"https://i.stack.imgur.com/v4zVl.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/v4zVl.png\" alt=\"movie\"></a></p>\n\n<p>Here is what i do:</p>\n\n<pre><code>func ParseSearchMovies(doc *goquery.Document) *models.SearchResponse {\n    result := new(models.SearchResponse)\n    finder0 := doc.Find(\"section &gt; section &gt; ul\")\n    finder1 := doc.Find(\"section.movieSection &gt; ul\")\n    finder2 := doc.Find(\"section.movieSection &gt; ul &gt; li\")\n    finder3 := doc.Find(\"movieSection\")\n    finder4 := doc.Find(\"section.movieSection\")\n    finder5 := doc.Find(\"section.movieSection ul.results_ul\")\n    finder6 := doc.Find(\"div.Search.Results li.bottom_divider.clearfix\")\n    finder7 := doc.Find(\"div.search-results-root span.bold\")\n    finder8 := doc.Find(\"div.search-results-root #details\")\n    finder9 := doc.Find(\"div.search-results-root li.bottom_divider.clearfix\")\n    finder10 := doc.Find(\"#movieSection &gt; ul &gt; li:nth-child(1)\")\n    finder11 := doc.Find(\"#movieSection &gt; ul\")\n    finder12 := doc.Find(\"#movieSection &gt; ul .bottom_divider.clearfix\")\n    finder13 := doc.Find(\"#movieSection &gt; ul &gt; li\")\n    finder14 := doc.Find(\"section.Search.Results .movieSection\")\n    finder15 := doc.Find(\"#search-results-root section\")\n    finder16 := doc.Find(\"#search-results-root .section\")\n    finder17 := doc.Find(\"#search-results-root .section .section\")\n    finder18 := doc.Find(\"#search-results-root &gt; section &gt; section\")\n    finder19 := doc.Find(\"#search-results-root &gt; section .section\")\n\n    //From hlscalon's answer\n    finder20 := doc.Find(\"#movieSection &gt; .results_ul &gt; li &gt; div.details\")\n    finder21 := doc.Find(\"#movieSection &gt; .results_ul &gt; li\")\n    finder22 := doc.Find(\"#movieSection &gt; .results_ul\")\n    finder23 := doc.Find(\"#movieSection\")\n\n    fmt.Printf(\"%d\", len(finder0.Nodes))\n    fmt.Printf(\"%d\", len(finder1.Nodes))\n    fmt.Printf(\"%d\", len(finder2.Nodes))\n    fmt.Printf(\"%d\", len(finder3.Nodes))\n    fmt.Printf(\"%d\", len(finder4.Nodes))\n    fmt.Printf(\"%d\", len(finder5.Nodes))\n    fmt.Printf(\"%d\", len(finder6.Nodes))\n    fmt.Printf(\"%d\", len(finder7.Nodes))\n    fmt.Printf(\"%d\", len(finder8.Nodes))\n    fmt.Printf(\"%d\", len(finder9.Nodes))\n    fmt.Printf(\"%d\", len(finder10.Nodes))\n    fmt.Printf(\"%d\", len(finder11.Nodes))\n    fmt.Printf(\"%d\", len(finder12.Nodes))\n    fmt.Printf(\"%d\", len(finder13.Nodes))\n    fmt.Printf(\"%d\", len(finder14.Nodes))\n    fmt.Printf(\"%d\", len(finder15.Nodes))\n    fmt.Printf(\"%d\", len(finder16.Nodes))\n    fmt.Printf(\"%d\", len(finder17.Nodes))\n    fmt.Printf(\"%d\", len(finder18.Nodes))\n    fmt.Printf(\"%d\", len(finder19.Nodes))\n    fmt.Printf(\"%d\", len(finder20.Nodes))\n    fmt.Printf(\"%d\", len(finder21.Nodes))\n    fmt.Printf(\"%d\", len(finder22.Nodes))\n    fmt.Printf(\"%d\", len(finder23.Nodes))\n}\n</code></pre>\n\n<ul>\n<li><p><code>Expected:</code> 9 (Movie count in <code>&lt;section id=\"movieSection\"&gt;</code>)</p></li>\n<li><p><code>Actual:</code> All the results are returns 0. Output: <code>000000000000000000000000</code></p></li>\n</ul>\n\n<p><strong>P.S:</strong> When I print the result to the console via <code>doc.Text()</code>, whole the page comes correctly.</p>\n\n<p>To print all movie names in order:</p>\n\n<pre><code>if len(myFinder.Nodes) &gt; 0 {\n    doc.Find(\"MY QUERY\").Each(func(i int, s *goquery.Selection) {\n        name := s.Find(\"a\")\n\n        fmt.Println(name)\n    })\n}\n</code></pre>\n"}, {"tags": ["postgresql", "docker", "go", "docker-compose", "go-gorm"], "comments": [{"owner": {"reputation": 15752, "user_id": 16998, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/PstY2.jpg?s=128&g=1", "display_name": "jrwren", "link": "https://stackoverflow.com/users/16998/jrwren"}, "edited": false, "score": 1, "creation_date": 1544623255, "post_id": 53744332, "comment_id": 94341766, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/21959148/ssl-is-not-enabled-on-the-server\">SSL is not enabled on the server</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1544623411, "post_id": 53744332, "comment_id": 94341841, "body": "You <i>must</i> put the relevant code in your question. Links are great for added detail, but a question must be complete on its own."}, {"owner": {"reputation": 1733, "user_id": 10490857, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GA97O.jpg?s=128&g=1", "display_name": "Maxim", "link": "https://stackoverflow.com/users/10490857/maxim"}, "edited": false, "score": 0, "creation_date": 1544681233, "post_id": 53744332, "comment_id": 94364183, "body": "Your docker-compose.yml file has not provide settings to Postgres with any allowing remote connections. See <a href=\"https://blog.bigbinary.com/2016/01/23/configure-postgresql-to-allow-remote-connection.html\" rel=\"nofollow noreferrer\">blog.bigbinary.com/2016/01/23/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 6367, "user_id": 4451732, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/UQN4l.jpg?s=128&g=1", "display_name": "Franklin Yu", "link": "https://stackoverflow.com/users/4451732/franklin-yu"}, "edited": false, "score": 0, "creation_date": 1544624278, "post_id": 53744867, "comment_id": 94342350, "body": "Any benefit of enabling SSL if the database container is not exposed? It should be pretty safe staying in the default bridge network."}, {"owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "reply_to_user": {"reputation": 6367, "user_id": 4451732, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/UQN4l.jpg?s=128&g=1", "display_name": "Franklin Yu", "link": "https://stackoverflow.com/users/4451732/franklin-yu"}, "edited": false, "score": 0, "creation_date": 1544630957, "post_id": 53744867, "comment_id": 94346490, "body": "@FranklinYu That depends on your local environment and what attacks you want to defend against. If containers are deployed on different hosts using overlay networking without IPSec configured, then there&#39;s a network sniffing risk. Otherwise, I believe most do not encrypt since any attacks I can think of would already have root access to the host."}], "tags": [], "owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "is_accepted": false, "score": 3, "last_activity_date": 1544623762, "creation_date": 1544623762, "answer_id": 53744867, "question_id": 53744332, "link": "https://stackoverflow.com/questions/53744332/ssl-connection-issues-between-go-scratch-container-and-pg-container-how-to-reso/53744867#53744867", "title": "SSL connection issues between go Scratch container and PG container. How to resolve?", "body": "<p>You can follow the code to find the documentation on how to use the Postgres calls.</p>\n\n<ul>\n<li>github.com/jinzhu/gorm calls</li>\n<li>database/sql which calls</li>\n<li>lib/pq</li>\n</ul>\n\n<p>And lib/pq <a href=\"https://godoc.org/github.com/lib/pq\" rel=\"nofollow noreferrer\">documents it's usage</a> including:</p>\n\n<blockquote>\n  <ul>\n  <li>dbname - The name of the database to connect to</li>\n  <li>user - The user to sign in as</li>\n  <li>password - The user's password</li>\n  <li>host - The host to connect to. Values that start with / are for unix   domain sockets. (default is localhost)</li>\n  <li>port - The port to bind to. (default is 5432)</li>\n  <li>sslmode - Whether or not to use SSL (default is require, this is not   the default for libpq)</li>\n  <li>fallback_application_name - An application_name to fall back to if one isn't provided.</li>\n  <li>connect_timeout - Maximum wait for connection, in seconds. Zero or   not specified means wait indefinitely.</li>\n  <li>sslcert - Cert file location. The file must contain PEM encoded data.</li>\n  <li>sslkey - Key file location. The file must contain PEM encoded data.</li>\n  <li>sslrootcert - The location of the root certificate file. The file   must contain PEM encoded data.</li>\n  </ul>\n</blockquote>\n\n<p>And:</p>\n\n<blockquote>\n  <ul>\n  <li>disable - No SSL</li>\n  <li>require - Always SSL (skip verification)</li>\n  <li>verify-ca - Always SSL (verify that the certificate presented by the   server was signed by a trusted CA)</li>\n  <li>verify-full - Always SSL (verify that the certification presented by   the server was signed by a trusted CA and the server host name<br>\n  matches the one in the certificate)</li>\n  </ul>\n</blockquote>\n\n<p>So your connect string for a database without SSL is simply:</p>\n\n<pre><code>db, err := gorm.Open(\"postgres\", \"host='postgres' port=5432 user=docker dbname='docker' password='password' sslmode=disable\")\n</code></pre>\n\n<p>Or you could configure Postgres with an SSL key. That's less trivial, but to implement you'd need to modify the postgresql.conf file to enable the ssl settings and mount the TLS key pair as a volume, or preferably a secret with swarm mode. One of the many examples of how to do this can be found at: <a href=\"https://gist.github.com/likwid/86193ef581c530ea55d3\" rel=\"nofollow noreferrer\">https://gist.github.com/likwid/86193ef581c530ea55d3</a></p>\n"}], "owner": {"reputation": 2724, "user_id": 354007, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/6c577241666b544e9fa19d9a013f964c?s=128&d=identicon&r=PG", "display_name": "IrishGringo", "link": "https://stackoverflow.com/users/354007/irishgringo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1473, "favorite_count": 1, "closed_date": 1544624870, "answer_count": 1, "score": 0, "last_activity_date": 1544633133, "creation_date": 1544621950, "last_edit_date": 1592644375, "question_id": 53744332, "link": "https://stackoverflow.com/questions/53744332/ssl-connection-issues-between-go-scratch-container-and-pg-container-how-to-reso", "closed_reason": "Not suitable for this site", "title": "SSL connection issues between go Scratch container and PG container. How to resolve?", "body": "<h2>UPDATE</h2>\n<p>I believe I resolved this issue with this connection...</p>\n<pre><code>db, err := gorm.Open(&quot;postgres&quot;, &quot;host='postgres'&amp;user:docker&amp;port=5432&amp;dbname='docker'&amp;password='password'&amp;sslmode=disable&quot;)\n</code></pre>\n<hr />\n<p>I am getting a connection refused between a Docker PG container and a GoLang Scratch container. The error is:</p>\n<pre><code>============   exiting ==========\ntodo_1      | pq: SSL is not enabled on the server\ntodo_1      | panic: failed to connect database e\n</code></pre>\n<p><a href=\"https://github.com/vinceyoumans/achal/blob/master/docker-compose.yml\" rel=\"nofollow noreferrer\">The docker-compose.yml file </a></p>\n<p><a href=\"https://github.com/vinceyoumans/achal/blob/master/go_amex/main.go\" rel=\"nofollow noreferrer\">The main.go file which is panicking</a></p>\n<p><a href=\"https://github.com/vinceyoumans/achal\" rel=\"nofollow noreferrer\">Complete code base with Docker files</a></p>\n<p>OTHER NOTE:</p>\n<ul>\n<li>I am using GORM library to connect with PG.</li>\n</ul>\n<p>REQUEST:\nPlease look over code and give some hints on where and how to resolve this SSL issue.</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-sdk", "aws-transcribe"], "comments": [{"owner": {"reputation": 475, "user_id": 2407809, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/1f74d31bda8fe6fe3cd66b12996400ae?s=128&d=identicon&r=PG", "display_name": "ds011591", "link": "https://stackoverflow.com/users/2407809/ds011591"}, "edited": false, "score": 0, "creation_date": 1548688709, "post_id": 53743785, "comment_id": 95620506, "body": "Where did you find that url? <a href=\"https://docs.aws.amazon.com/general/latest/gr/rande.html#transcribe_region\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/general/latest/gr/&hellip;</a>"}, {"owner": {"reputation": 3001, "user_id": 671580, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ce9e871134885854d5c3e3ab5fa83c3b?s=128&d=identicon&r=PG", "display_name": "shelll", "link": "https://stackoverflow.com/users/671580/shelll"}, "reply_to_user": {"reputation": 475, "user_id": 2407809, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/1f74d31bda8fe6fe3cd66b12996400ae?s=128&d=identicon&r=PG", "display_name": "ds011591", "link": "https://stackoverflow.com/users/2407809/ds011591"}, "edited": false, "score": 0, "creation_date": 1548689633, "post_id": 53743785, "comment_id": 95621105, "body": "@ds011591 it is in the linked Java example. The documentation link you provided is for the &quot;non&quot; streaming transcribe."}, {"owner": {"reputation": 372, "user_id": 10070034, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-NmI6ulz5HiA/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rty-ufJQrzNH85Ac9tX_Wgh3UPjQ/mo/photo.jpg?sz=128", "display_name": "Stephen A. Lizcano", "link": "https://stackoverflow.com/users/10070034/stephen-a-lizcano"}, "edited": false, "score": 0, "creation_date": 1552309554, "post_id": 53743785, "comment_id": 96947696, "body": "Were you ever able to get this working?"}, {"owner": {"reputation": 3001, "user_id": 671580, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ce9e871134885854d5c3e3ab5fa83c3b?s=128&d=identicon&r=PG", "display_name": "shelll", "link": "https://stackoverflow.com/users/671580/shelll"}, "reply_to_user": {"reputation": 372, "user_id": 10070034, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-NmI6ulz5HiA/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rty-ufJQrzNH85Ac9tX_Wgh3UPjQ/mo/photo.jpg?sz=128", "display_name": "Stephen A. Lizcano", "link": "https://stackoverflow.com/users/10070034/stephen-a-lizcano"}, "edited": false, "score": 0, "creation_date": 1552311413, "post_id": 53743785, "comment_id": 96948901, "body": "@stephenlizcano no, I was not able to solve this yet :("}, {"owner": {"reputation": 3001, "user_id": 671580, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ce9e871134885854d5c3e3ab5fa83c3b?s=128&d=identicon&r=PG", "display_name": "shelll", "link": "https://stackoverflow.com/users/671580/shelll"}, "reply_to_user": {"reputation": 372, "user_id": 10070034, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-NmI6ulz5HiA/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rty-ufJQrzNH85Ac9tX_Wgh3UPjQ/mo/photo.jpg?sz=128", "display_name": "Stephen A. Lizcano", "link": "https://stackoverflow.com/users/10070034/stephen-a-lizcano"}, "edited": false, "score": 0, "creation_date": 1552313826, "post_id": 53743785, "comment_id": 96950527, "body": "@stephenlizcano I re-tested my code and now there is a different behaviour. I have updated my answer with more info. Still no solution though."}, {"owner": {"reputation": 733, "user_id": 9194674, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N843Y.png?s=128&g=1", "display_name": "Manoj", "link": "https://stackoverflow.com/users/9194674/manoj"}, "edited": false, "score": 0, "creation_date": 1552595828, "post_id": 53743785, "comment_id": 97082427, "body": "@shelll, I just have a feeling that JSON body you are sending may not exactly be a json, I am not sure though. Just take a look at this link <a href=\"https://docs.aws.amazon.com/transcribe/latest/dg/streaming-format.html\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/transcribe/latest/dg/streaming-format.ht&zwnj;&#8203;ml</a> and I am looking at the diagram that they had in there. Did you prepare the &quot;Audioevent&quot; from your audio chunk ? I found some ref for &quot;Audioevent&quot; in this link <a href=\"https://docs.aws.amazon.com/transcribe/latest/dg/API_streaming_AudioStream.html#transcribe-Type-streaming_AudioStream-AudioEvent\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/transcribe/latest/dg/&hellip;</a>"}, {"owner": {"reputation": 7049, "user_id": 1544715, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/be85f7bc23d6fa1addc8d35e39870579?s=128&d=identicon&r=PG", "display_name": "Magnus", "link": "https://stackoverflow.com/users/1544715/magnus"}, "edited": false, "score": 0, "creation_date": 1574924109, "post_id": 53743785, "comment_id": 104402648, "body": "Did you ever figure out what caused the <code>A complete signal was sent without the preceding empty frame</code> issue?"}, {"owner": {"reputation": 3001, "user_id": 671580, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ce9e871134885854d5c3e3ab5fa83c3b?s=128&d=identicon&r=PG", "display_name": "shelll", "link": "https://stackoverflow.com/users/671580/shelll"}, "reply_to_user": {"reputation": 7049, "user_id": 1544715, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/be85f7bc23d6fa1addc8d35e39870579?s=128&d=identicon&r=PG", "display_name": "Magnus", "link": "https://stackoverflow.com/users/1544715/magnus"}, "edited": false, "score": 0, "creation_date": 1574948754, "post_id": 53743785, "comment_id": 104415135, "body": "@Magnus No I did not. I think though it is because I was sending the audio bytes in wrong message format (I sent the raw bytes directly up the HTTP/2 stream) thus AWS just terminated the connection with this message."}], "answers": [{"comments": [{"owner": {"reputation": 3001, "user_id": 671580, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ce9e871134885854d5c3e3ab5fa83c3b?s=128&d=identicon&r=PG", "display_name": "shelll", "link": "https://stackoverflow.com/users/671580/shelll"}, "edited": false, "score": 0, "creation_date": 1552488717, "post_id": 55138651, "comment_id": 97030089, "body": "Now I do not get the <code>SerializationException</code>, but IAM issue and the AWS IAM console does not have <code>transcription:StartStreamTranscription</code> permission and I had to attach it as a raw JSON permission :D After that, I have a new exception <code>exception{&quot;Message&quot;:&quot;A complete signal was sent without the preceding empty frame.&quot;}</code>. There is also a new documentation page <a href=\"https://docs.aws.amazon.com/transcribe/latest/dg/streaming-format.html\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/transcribe/latest/dg/streaming-format.ht&zwnj;&#8203;ml</a> which shows new <code>content-type</code> but has a typo in the host :D This is a complete mess :("}, {"owner": {"reputation": 3001, "user_id": 671580, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ce9e871134885854d5c3e3ab5fa83c3b?s=128&d=identicon&r=PG", "display_name": "shelll", "link": "https://stackoverflow.com/users/671580/shelll"}, "edited": false, "score": 0, "creation_date": 1552490898, "post_id": 55138651, "comment_id": 97031714, "body": "The new documentation for streaming transcription is also bad. When using its <code>content-type</code> the HTTP request return 404 Not Found with <code>&lt;UnknownOperationException&#47;&gt;</code> in the body. And their HTTP2 messages for streaming the audio are horrible :("}, {"owner": {"reputation": 134, "user_id": 589045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea4ce2707d7d0ce23a418c87323a1ccd?s=128&d=identicon&r=PG", "display_name": "gpeng", "link": "https://stackoverflow.com/users/589045/gpeng"}, "reply_to_user": {"reputation": 3001, "user_id": 671580, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ce9e871134885854d5c3e3ab5fa83c3b?s=128&d=identicon&r=PG", "display_name": "shelll", "link": "https://stackoverflow.com/users/671580/shelll"}, "edited": false, "score": 0, "creation_date": 1552567429, "post_id": 55138651, "comment_id": 97064553, "body": "Totally feel your pain. I&#39;ve gone through basically the same set of errors. I&#39;m at a dead end with it for now. There are encoders for the EventStream format you mentioned from the docs in the SDKs -&gt; <a href=\"https://github.com/aws/aws-sdk-go/blob/master/private/protocol/eventstream/encode.go\" rel=\"nofollow noreferrer\">github.com/aws/aws-sdk-go/blob/master/private/protocol/&hellip;</a> but I didn&#39;t get too far with the Ruby equivalent. There&#39;s a <a href=\"https://github.com/aws/aws-sdk-ruby/pull/1945\" rel=\"nofollow noreferrer\">Ruby SDK PR open</a> and an <a href=\"https://github.com/aws/aws-sdk-ruby/pull/1946\" rel=\"nofollow noreferrer\">event signing PR</a> that has just been merged so I think we&#39;ll hold out for that."}, {"owner": {"reputation": 3001, "user_id": 671580, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ce9e871134885854d5c3e3ab5fa83c3b?s=128&d=identicon&r=PG", "display_name": "shelll", "link": "https://stackoverflow.com/users/671580/shelll"}, "edited": false, "score": 0, "creation_date": 1552572448, "post_id": 55138651, "comment_id": 97068292, "body": "That EventStream encoder looks promising, thanks! As this is no longer a high priority issue for me, I will probable wait for official support in the AWS Go SDK. I will probably revisit this in couple of months."}, {"owner": {"reputation": 1566, "user_id": 6348032, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f74db67cb21f62d9c506fa0d873fae6a?s=128&d=identicon&r=PG&f=1", "display_name": "Asym", "link": "https://stackoverflow.com/users/6348032/asym"}, "edited": false, "score": 0, "creation_date": 1554040799, "post_id": 55138651, "comment_id": 97599250, "body": "Guys, I&#39;m doing the same thing in Python. After the success of step 1 and 2 i.e. getting the &#39;complete signal was sent&#39; message. Did you guys figure out how to create audio event and audio event message?"}, {"owner": {"reputation": 838, "user_id": 7697652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d2fb63b6ac1dfa5dcf705f48a5a7d65?s=128&d=identicon&r=PG&f=1", "display_name": "Kshitij Saxena", "link": "https://stackoverflow.com/users/7697652/kshitij-saxena"}, "reply_to_user": {"reputation": 1566, "user_id": 6348032, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f74db67cb21f62d9c506fa0d873fae6a?s=128&d=identicon&r=PG&f=1", "display_name": "Asym", "link": "https://stackoverflow.com/users/6348032/asym"}, "edited": false, "score": 0, "creation_date": 1558434061, "post_id": 55138651, "comment_id": 99091041, "body": "@Asym could you please share how did you connect the stream (Step 1) using python?"}, {"owner": {"reputation": 1566, "user_id": 6348032, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/f74db67cb21f62d9c506fa0d873fae6a?s=128&d=identicon&r=PG&f=1", "display_name": "Asym", "link": "https://stackoverflow.com/users/6348032/asym"}, "edited": false, "score": 0, "creation_date": 1558445947, "post_id": 55138651, "comment_id": 99097884, "body": "<a href=\"https://pastebin.com/0SbR703K\" rel=\"nofollow noreferrer\">pastebin.com/0SbR703K</a> Here is what I have. I don&#39;t think it even accomplishes step 1. Do let me know if you manage to get it done. Thanks!"}], "tags": [], "owner": {"reputation": 134, "user_id": 589045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea4ce2707d7d0ce23a418c87323a1ccd?s=128&d=identicon&r=PG", "display_name": "gpeng", "link": "https://stackoverflow.com/users/589045/gpeng"}, "is_accepted": false, "score": 1, "last_activity_date": 1552477095, "last_edit_date": 1552477095, "creation_date": 1552470163, "answer_id": 55138651, "question_id": 53743785, "link": "https://stackoverflow.com/questions/53743785/amazon-transcribe-streaming-api-without-sdk/55138651#55138651", "title": "Amazon Transcribe Streaming API without SDK", "body": "<p>Try not setting the content type header and see what response you get. I'm trying to do the same thing (but in Ruby) and that 'fixed' the <code>SerializationException</code>. Still can't get it to work but I've now got a new error to think about :) </p>\n\n<p>UPDATE: I have got it working now. My issue was with the signature. If both <code>host</code> and <code>authority</code> headers are passed they are joined with <code>,</code> and treated as <code>host</code> on the server side when the signature is checked so the signatures never match. That doesn't seem like correct behaviour on the AWS side but it doesn't look like it's going to be an issue for you in Go.</p>\n"}, {"comments": [{"owner": {"reputation": 3001, "user_id": 671580, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ce9e871134885854d5c3e3ab5fa83c3b?s=128&d=identicon&r=PG", "display_name": "shelll", "link": "https://stackoverflow.com/users/671580/shelll"}, "edited": false, "score": 2, "creation_date": 1554815939, "post_id": 55587988, "comment_id": 97884187, "body": "Their documentation is a mess, with errors and contradictions. I have given up currently and I will try it once they have a Go SDK. There are other providers of real-time speech recognition with punctuation and with more supported languages. The AWS streaming transcribe support US English only, so it is not worth to fight their API."}], "tags": [], "owner": {"reputation": 10456, "user_id": 774907, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/ea9ux.jpg?s=128&g=1", "display_name": "rodrigo-silveira", "link": "https://stackoverflow.com/users/774907/rodrigo-silveira"}, "is_accepted": false, "score": 0, "last_activity_date": 1554797478, "last_edit_date": 1592644375, "creation_date": 1554797478, "answer_id": 55587988, "question_id": 53743785, "link": "https://stackoverflow.com/questions/53743785/amazon-transcribe-streaming-api-without-sdk/55587988#55587988", "title": "Amazon Transcribe Streaming API without SDK", "body": "<p>I'm still fighting this thing with Node.js as well. What is not clear about the docs is that <a href=\"https://docs.aws.amazon.com/transcribe/latest/dg/API_streaming_StartStreamTranscription.html\" rel=\"nofollow noreferrer\">in one place</a> it says that the <code>Content-Type</code> should not be <code>application/json</code>, but <a href=\"https://docs.aws.amazon.com/transcribe/latest/dg/streaming-format.html\" rel=\"nofollow noreferrer\">in some other place</a>, it makes it look like that payload should be encoded as <code>application/vnd.amazon.eventstream</code>. It looks like the payload should be carefully formatted in a binary format instead of a JSON object as follows:</p>\n<blockquote>\n<p>Amazon Transcribe uses a format called event stream encoding for streaming transcription. This format encoded binary data with header information that describes the contents of each event. You can use this information for applications that call the Amazon Transcribe endpoint without using the Amazon Transcribe SDK.\nAmazon Transcribe uses the HTTP/2 protocol for streaming transcriptions. The key components for a streaming request are:</p>\n<ul>\n<li><p>A header frame. This contains the HTTP headers for the request, and a signature in the authorization header that Amazon Transcribe uses as a seed signature to sign the following data frames.</p>\n</li>\n<li><p>One or message frames in event stream encoding. The frame contains metadata and the raw audio bytes.</p>\n</li>\n<li><p>An end frame. This is a signed message in event stream encoding with an empty body.</p>\n</li>\n</ul>\n</blockquote>\n<p>There is a sample function that shows how to <a href=\"https://docs.aws.amazon.com/transcribe/latest/dg/streaming-client.html\" rel=\"nofollow noreferrer\">implement all of that using Java</a> which might shed some light in how this encoding is to be done.</p>\n"}, {"tags": [], "owner": {"reputation": 101, "user_id": 11724061, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d4840cac0f2d3bbd35c6a1026f18d2a?s=128&d=identicon&r=PG", "display_name": "Calvin", "link": "https://stackoverflow.com/users/11724061/calvin"}, "is_accepted": false, "score": 4, "last_activity_date": 1564566374, "last_edit_date": 1564566374, "creation_date": 1561983409, "answer_id": 56835558, "question_id": 53743785, "link": "https://stackoverflow.com/questions/53743785/amazon-transcribe-streaming-api-without-sdk/56835558#56835558", "title": "Amazon Transcribe Streaming API without SDK", "body": "<p>I reached out to AWS support and they now recommend using websockets instead of HTTP/2 when possible (blog post <a href=\"https://aws.amazon.com/blogs/aws/amazon-transcribe-streaming-now-supports-websockets/\" rel=\"nofollow noreferrer\">here</a>)</p>\n\n<p>If this fits your usecase I would highly recommend checking out the new example repo at: <a href=\"https://github.com/aws-samples/amazon-transcribe-websocket-static\" rel=\"nofollow noreferrer\">https://github.com/aws-samples/amazon-transcribe-websocket-static</a> which shows a browser-based solution in JS. </p>\n\n<p>I've also noticed that the author of the demo has an express example on his personal Github at: <a href=\"https://github.com/brandonmwest/amazon-transcribe-websocket-express\" rel=\"nofollow noreferrer\">https://github.com/brandonmwest/amazon-transcribe-websocket-express</a> but I haven't confirmed if this is working. </p>\n\n<p>Appreciate these examples aren't in Python but I think you'll have better luck using the Websocket client as opposed to HTTP/2 (which let's be honest, is still a bit terrifying :P)</p>\n"}, {"tags": [], "owner": {"reputation": 3, "user_id": 10597392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/933ed7c81c58bc5033d95a9f95d9767d?s=128&d=identicon&r=PG&f=1", "display_name": "Muhammad Qasim", "link": "https://stackoverflow.com/users/10597392/muhammad-qasim"}, "is_accepted": false, "score": 0, "last_activity_date": 1585500819, "last_edit_date": 1585500819, "creation_date": 1585441753, "answer_id": 60908759, "question_id": 53743785, "link": "https://stackoverflow.com/questions/53743785/amazon-transcribe-streaming-api-without-sdk/60908759#60908759", "title": "Amazon Transcribe Streaming API without SDK", "body": "<p>I had a similar requirement for using the AWS transcribe service with their WebSocket API in node js. Seeing as there was no support for this in the official package as of yet, I have gone ahead and written a package that is called AWS-transcribe and can be found <a href=\"https://www.npmjs.com/package/aws-transcribe\" rel=\"nofollow noreferrer\">here</a>. I hope that helps. </p>\n\n<p>It provides a stream interface around the WebSocket, and can be used like the below example</p>\n\n<pre><code>import { AwsTranscribe, StreamingClient } from \"aws-transcribe\"\n\nconst client = new AwsTranscribe({\n    // if these aren't provided, they will be taken from the environment\n    accessKeyId: \"ACCESS KEY HERE\",\n    secretAccessKey: \"SECRET KEY HERE\",\n})\n\nconst transcribeStream = client\n    .createStreamingClient({\n        region: \"eu-west-1\",\n        sampleRate,\n        languageCode: \"en-US\",\n    })\n    // enums for returning the event names which the stream will emit\n    .on(StreamingClient.EVENTS.OPEN, () =&gt; console.log(`transcribe connection opened`))\n    .on(StreamingClient.EVENTS.ERROR, console.error)\n    .on(StreamingClient.EVENTS.CLOSE, () =&gt; console.log(`transcribe connection closed`))\n    .on(StreamingClient.EVENTS.DATA, (data) =&gt; {\n        const results = data.Transcript.Results\n\n        if (!results || results.length === 0) {\n            return\n        }\n\n        const result = results[0]\n        const final = !result.IsPartial\n        const prefix = final ? \"recognized\" : \"recognizing\"\n        const text = result.Alternatives[0].Transcript\n        console.log(`${prefix} text: ${text}`)\n    })\n\nsomeStream.pipe(transcribeStream)\n</code></pre>\n"}], "owner": {"reputation": 3001, "user_id": 671580, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ce9e871134885854d5c3e3ab5fa83c3b?s=128&d=identicon&r=PG", "display_name": "shelll", "link": "https://stackoverflow.com/users/671580/shelll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3057, "favorite_count": 2, "answer_count": 4, "score": 14, "last_activity_date": 1590068268, "creation_date": 1544620180, "last_edit_date": 1552652960, "question_id": 53743785, "link": "https://stackoverflow.com/questions/53743785/amazon-transcribe-streaming-api-without-sdk", "title": "Amazon Transcribe Streaming API without SDK", "body": "<p>I am trying to use Amazon's new streaming transcribe API from Go 1.11. Currently Amazon provides Java SDK only so I am trying the low-level way.</p>\n\n<p>The only relevant piece of documentation is <a href=\"https://docs.aws.amazon.com/transcribe/latest/dg/API_streaming_StartStreamTranscription.html\" rel=\"noreferrer\">here</a> but it does not show the endpoint. I have found it in a <a href=\"https://github.com/aws-samples/aws-transcribe-streaming-example-java/blob/master/src/main/java/com/amazonaws/transcribestreaming/TranscribeStreamingClientWrapper.java\" rel=\"noreferrer\">Java example</a> that it is <code>https://transcribestreaming.&lt;region&gt;.amazonaws.com</code> and I am trying the Ireland region i.e. <code>https://transcribestreaming.eu-west-1.amazonaws.com</code>. Here is my code to open an HTTP/2 bi-directional stream:</p>\n\n<pre><code>import (\n    \"crypto/tls\"\n    \"github.com/aws/aws-sdk-go-v2/aws\"\n    \"github.com/aws/aws-sdk-go-v2/aws/external\"\n    \"github.com/aws/aws-sdk-go-v2/aws/signer/v4\"\n    \"golang.org/x/net/http2\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"time\"\n)\n\nconst (\n    HeaderKeyLanguageCode   = \"x-amzn-transcribe-language-code\"  // en-US\n    HeaderKeyMediaEncoding  = \"x-amzn-transcribe-media-encoding\" // pcm only\n    HeaderKeySampleRate     = \"x-amzn-transcribe-sample-rate\"    // 8000, 16000 ... 48000\n    HeaderKeySessionId      = \"x-amzn-transcribe-session-id\"     // For retrying a session. Pattern: [a-fA-F0-9]{8}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{4}-[a-fA-F0-9]{12}\n    HeaderKeyVocabularyName = \"x-amzn-transcribe-vocabulary-name\"\n    HeaderKeyRequestId = \"x-amzn-request-id\"\n)\n\n...\n\nregion := \"eu-west-1\"\n\ncfg, err := external.LoadDefaultAWSConfig(aws.Config{\n    Region: region,\n})\nif err != nil {\n    log.Printf(\"could not load default AWS config: %v\", err)\n    return\n}\n\nsigner := v4.NewSigner(cfg.Credentials)\n\ntransport := &amp;http2.Transport{\n    TLSClientConfig: &amp;tls.Config{\n        // allow insecure just for debugging\n        InsecureSkipVerify: true,\n    },\n}\nclient := &amp;http.Client{\n    Transport: transport,\n}\n\nsignTime := time.Now()\n\nheader := http.Header{}\nheader.Set(HeaderKeyLanguageCode, \"en-US\")\nheader.Set(HeaderKeyMediaEncoding, \"pcm\")\nheader.Set(HeaderKeySampleRate, \"16000\")\nheader.Set(\"Content-type\", \"application/json\")\n\n// Bi-directional streaming via a pipe.\npr, pw := io.Pipe()\n\nreq, err := http.NewRequest(http.MethodPost, \"https://transcribestreaming.eu-west-1.amazonaws.com/stream-transcription\", ioutil.NopCloser(pr))\nif err != nil {\n    log.Printf(\"err: %+v\", err)\n    return\n}\nreq.Header = header\n\n_, err = signer.Sign(req, nil, \"transcribe\", region, signTime)\nif err != nil {\n    log.Printf(\"problem signing headers: %+v\", err)\n    return\n}\n\n// This freezes and ends after 5 minutes with \"unexpected EOF\".\nres, err := client.Do(req)\n...\n</code></pre>\n\n<p>Problem is that executing the request (<code>client.Do(req)</code>) freezes for five minutes and then ends with the \"unexpected EOF\" error.</p>\n\n<p>Any ideas what I am doing wrong? Did someone successfully use the new streaming transcribe API without the Java SDK?</p>\n\n<p><strong>EDIT (March 11, 2019):</strong></p>\n\n<p>I tested this again and now it does not time out but immediately returns <code>200 OK</code> response. There is an \"exception\" in the response body though: <code>{\"Output\":{\"__type\":\"com.amazon.coral.service#SerializationException\"},\"Version\":\"1.0\"}</code></p>\n\n<p>I tried opening the HTTP2 stream with <code>io.Pipe</code> (like the code above) and also with a JSON body described in the documentation:</p>\n\n<pre><code>{\n    \"AudioStream\": { \n        \"AudioEvent\": { \n            \"AudioChunk\": \"\"\n        }\n    }\n}\n</code></pre>\n\n<p>The result was the same.</p>\n\n<p><strong>EDIT (March 13, 2019):</strong></p>\n\n<p>As mentioned by @gpeng, removing the <code>content-type</code> from headers will fix the <code>SerializationException</code>. But then there is an IAM exception and it is needed to add the <code>transcription:StartStreamTranscription</code> permission to your IAM user. That is though nowhere in the AWS IAM console and must be added manually as a custom JSON permission :/</p>\n\n<p>There is also a new/another documentation document <a href=\"https://docs.aws.amazon.com/transcribe/latest/dg/streaming-format.html\" rel=\"noreferrer\">here</a> which shows incorrect <code>host</code> and a new <code>content-type</code> (do not use that <code>content-type</code>, the request will return 404 with it).</p>\n\n<p>After removing the <code>content-type</code>, and adding the new permission, now I am getting an exception <code>{\"Message\":\"A complete signal was sent without the preceding empty frame.\"}</code>. Also writing to the pipe blocks forever, so I am stuck again. The messages described in the new documentation are different than in the old one, now finally binary, but I do not understand them. Any ideas how to send such HTTP2 messages in Go?</p>\n\n<p><strong>EDIT (Match 15, 2019):*</strong></p>\n\n<p>If you get HTTP 403 error about signature mismatch, then do not set the <code>transfer-encoding</code> and <code>x-amz-content-sha256</code> HTTP headers. When I set them, sign the request with AWS SDK's V4 signer, then I receive HTTP 403 <code>The request signature we calculated does not match the signature you provided.</code></p>\n"}, {"tags": ["go", "slice", "mutex", "goroutine"], "comments": [{"owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 1, "creation_date": 1544621365, "post_id": 53743126, "comment_id": 94340631, "body": "Looks like there are only crutches could help you. Try to use channels instead of mutex to sync goroutines."}, {"owner": {"reputation": 143, "user_id": 4258405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e29f8ed058fadb526be28ce6277506f?s=128&d=identicon&r=PG&f=1", "display_name": "starttter", "link": "https://stackoverflow.com/users/4258405/starttter"}, "reply_to_user": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "edited": false, "score": 0, "creation_date": 1544622550, "post_id": 53743126, "comment_id": 94341360, "body": "@bayrinat with channels I won&#39;t be able to wake all my waiting goroutine and determine which one I need to launch ?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544626311, "post_id": 53743126, "comment_id": 94343583, "body": "A channel is a thread-safe FIFO-ordered queue. You don&#39;t need to wake them all to see which one you want to launch, you can just insert them in order."}, {"owner": {"reputation": 143, "user_id": 4258405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e29f8ed058fadb526be28ce6277506f?s=128&d=identicon&r=PG&f=1", "display_name": "starttter", "link": "https://stackoverflow.com/users/4258405/starttter"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544627538, "post_id": 53743126, "comment_id": 94344337, "body": "@Adrian if I make a channel without capacity and have multiple goroutine trying to write at the same time on this channel won&#39;t they try to concurrently try to write on the channel ? so I won&#39;t be able to control which one of the goroutine is writing the channel"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544628102, "post_id": 53743126, "comment_id": 94344652, "body": "Correct, which is why you wouldn&#39;t want to use an unbuffered channel."}], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 4258405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e29f8ed058fadb526be28ce6277506f?s=128&d=identicon&r=PG&f=1", "display_name": "starttter", "link": "https://stackoverflow.com/users/4258405/starttter"}, "edited": false, "score": 0, "creation_date": 1544624940, "post_id": 53744761, "comment_id": 94342731, "body": "my program will run for a long time period what do you think of something like: <a href=\"https://play.golang.org/p/YriIBFB58s5\" rel=\"nofollow noreferrer\">play.golang.org/p/YriIBFB58s5</a>"}], "tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": true, "score": 2, "last_activity_date": 1544623386, "creation_date": 1544623386, "answer_id": 53744761, "question_id": 53743126, "link": "https://stackoverflow.com/questions/53743126/acquire-lock-synchronized-by-lock-asking-time/53744761#53744761", "title": "Acquire lock synchronized by lock asking time", "body": "<p>Give the goroutines an internal id and then get them to call each other in sequence.  Example of how this might work below</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    var wg sync.WaitGroup\n    var c [5]chan int\n    for i := range c {\n        c[i] = make(chan int)\n        wg.Add(1)\n        go func(id int) {\n            defer wg.Done()\n            f := &lt;-c[id]\n            fmt.Println(\"called from \", f, \".  My id \", id)\n            if id &lt; 4 {\n                fmt.Println(id+1, \" next\")\n                c[id+1] &lt;- id\n            }\n            fmt.Println(\"ending \", id)\n        }(i)\n    }\n    c[0] &lt;- 99\n\n    wg.Wait()\n    fmt.Println(\"bye\")\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/psF8ISodJU_3\" rel=\"nofollow noreferrer\">https://play.golang.org/p/psF8ISodJU_3</a></p>\n"}], "owner": {"reputation": 143, "user_id": 4258405, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e29f8ed058fadb526be28ce6277506f?s=128&d=identicon&r=PG&f=1", "display_name": "starttter", "link": "https://stackoverflow.com/users/4258405/starttter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 53744761, "answer_count": 1, "score": 0, "last_activity_date": 1544625116, "creation_date": 1544618009, "last_edit_date": 1544625116, "question_id": 53743126, "link": "https://stackoverflow.com/questions/53743126/acquire-lock-synchronized-by-lock-asking-time", "title": "Acquire lock synchronized by lock asking time", "body": "<p>I have a program with a goroutine that we will call mainRoutine which lock a ressource, on the other side other goroutines of fired which we will name goroutine-0 goroutine-1 goroutine-2 .... this routine try to acquire the lock, after the mainRoutine stop I need my other goroutine to acquire the lock in a synchronized way, what I mean is that I want the goroutine-0 then goroutine-1 ...\nWhat I've done to face this problem is a slice of time.Time that is populate with the time.Now() at which the goroutine was launched, and made use of sync.Cond.\nSome code example to illustrate:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc condition(myTime time.Time, timeSlice []time.Time) bool {\n    for _, v := range timeSlice {\n        if myTime.After(v) {\n            return false\n        }\n    }\n    return true\n}\n\nfunc removeFromSlice(myTime time.Time, timeSlice []time.Time) {\n    var place int\n    for i, v := range timeSlice {\n        if myTime.Equal(v) {\n            place = i\n            break\n        }\n    }\n\n    timeSlice = append(timeSlice[:place], timeSlice[place+1:]...)\n}\n\nfunc main() {\n    var m sync.Mutex\n    c := sync.NewCond(&amp;m)\n\n    c.L.Lock()\n    fmt.Println(\"Locker locked\")\n    go func() {\n        time.Sleep(time.Second * 1)\n\n        c.L.Unlock()\n        fmt.Println(\"Locker unlocked\")\n    }()\n\n    var wg sync.WaitGroup\n    var timeSlice []time.Time\n    wg.Add(100)\n\n    for i := 0; i &lt; 100; i++ {\n        now := time.Now()\n        timeSlice = append(timeSlice, now)\n        time.Sleep(time.Nanosecond * 1) // ensure there's at leat 1 nanosec of diff between 2 time.Now\n        go func(i int, myTime time.Time) {\n            fmt.Printf(\"Before %d %d\\n\", i, myTime.Unix())\n            c.L.Lock()\n            for !condition(myTime, timeSlice) {\n                c.Wait()\n            }\n            c.L.Unlock()\n            removeFromSlice(myTime, timeSlice)\n            c.Broadcast()\n            wg.Done()\n            fmt.Printf(\"After done %d\\n\", i)\n        }(i, now)\n    }\n    wg.Wait()\n\n    fmt.Println(\"Hello, playground\")\n}\n</code></pre>\n\n<p>I don't think it's the right way to do this kind of thing it seems really hacky, is there a better way?</p>\n\n<p>-- EDIT --\nAfter the answer of @Vorsprung I think the best approach in my case is making a slice of func which always call the 1st elem of the slice   </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc makeFunc(id int) func() {\n    return func() {\n        fmt.Printf(\"called %d\\n\", id)\n    }\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n    var funcSlice []func()\n    var m sync.Mutex\n\n    for i := 0; i &lt; 5; i++ {\n        funcSlice = append(funcSlice, makeFunc(i))\n        wg.Add(1)\n        go func() {\n            defer wg.Done()\n            m.Lock()\n            defer m.Unlock()\n            funcSlice[0]()\n            funcSlice = funcSlice[1:]\n        }()\n    }\n    wg.Wait()\n    fmt.Println(\"finished\")\n}\n</code></pre>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1544626460, "post_id": 53743099, "comment_id": 94343686, "body": "Why does this matter? A max-size slice of <code>struct{}</code> is useless, and a max-size slice of anything else will likely exceed available memory."}, {"owner": {"reputation": 393, "user_id": 2664120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95e396f6a7678066cf12a38350f80a3e?s=128&d=identicon&r=PG", "display_name": "Nordiii", "link": "https://stackoverflow.com/users/2664120/nordiii"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544627296, "post_id": 53743099, "comment_id": 94344196, "body": "I&#39;m writing an adapter for a Linear Programming c-library. This library has multiple functions which are taking arrays of ints with a possible sizeof struct_t. I used an empty struct because I ran out of memory, doesn&#39;t mean that the server/computer used for solving math problems will."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544628248, "post_id": 53743099, "comment_id": 94344754, "body": "The address space is determined by the same factor (32 or 64 bit architecture) as the maximum slice length. If your slice was of <code>byte</code>, you could theoretically store a max size slice on a machine with maximum memory for its architecture, but that would leave zero space for OS, Go runtime, or the rest of your program. So... yes, the server/computer running it will indeed run out of memory."}], "answers": [{"comments": [{"owner": {"reputation": 393, "user_id": 2664120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95e396f6a7678066cf12a38350f80a3e?s=128&d=identicon&r=PG", "display_name": "Nordiii", "link": "https://stackoverflow.com/users/2664120/nordiii"}, "edited": false, "score": 0, "creation_date": 1544620803, "post_id": 53743772, "comment_id": 94340313, "body": "Thanks for clarifying and posting the issue on github! Have a great day :)"}, {"owner": {"reputation": 393, "user_id": 2664120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95e396f6a7678066cf12a38350f80a3e?s=128&d=identicon&r=PG", "display_name": "Nordiii", "link": "https://stackoverflow.com/users/2664120/nordiii"}, "edited": false, "score": 0, "creation_date": 1544626290, "post_id": 53743772, "comment_id": 94343567, "body": "I don&#39;t know if its relevant (safety issues or alike) but when executing your sniped with a non empty struct, like <a href=\"https://play.golang.org/p/IAOFh2ZOrfh\" rel=\"nofollow noreferrer\">play.golang.org/p/IAOFh2ZOrfh</a> , on my local machine with &#39;GOARCH=386 go run test.go&#39; I get a segmentation violation"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 393, "user_id": 2664120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95e396f6a7678066cf12a38350f80a3e?s=128&d=identicon&r=PG", "display_name": "Nordiii", "link": "https://stackoverflow.com/users/2664120/nordiii"}, "edited": false, "score": 0, "creation_date": 1544626950, "post_id": 53743772, "comment_id": 94343999, "body": "@Nordiii It is related to this issue (length becomes negative). Once the bug is fixed, the code will not get that far, and will properly stop with a runtime panic (<code>rowslice: cap out of range</code>)."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1544623507, "last_edit_date": 1592644375, "creation_date": 1544620148, "answer_id": 53743772, "question_id": 53743099, "link": "https://stackoverflow.com/questions/53743099/behavior-of-append-when-appending-item-to-a-max-size-slice/53743772#53743772", "title": "Behavior of append when appending item to a max size slice", "body": "<p>The spec says about <a href=\"https://golang.org/ref/spec#Length_and_capacity\" rel=\"nofollow noreferrer\">length and capacity</a> of any slice:</p>\n<blockquote>\n<p>At any time the following relationship holds:</p>\n<pre><code>0 &lt;= len(s) &lt;= cap(s)\n</code></pre>\n</blockquote>\n<p>This is clearly violated, as the length becomes negative, and thus less than 0. So this is a bug, already reported it and progress can be tracked here: <a href=\"https://github.com/golang/go/issues/29190\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/29190</a></p>\n<p>Ian Lance Taylor confirms this is a bug and not how it should work. The proper behavior would be a panic saying <code>growslice: cap out of range</code>, which should originate from <a href=\"https://github.com/golang/go/blob/master/src/runtime/slice.go\" rel=\"nofollow noreferrer\"><code>slice.go / growslice()</code></a> function (<code>growslice()</code> is called from <code>append()</code>).</p>\n<p>If we slightly modify your example to this:</p>\n<pre><code>s := make([]struct{}, math.MaxInt32-2)\nfmt.Println(len(s), cap(s))\nfor i := 0; i &lt; 5; i++ {\n    s = append(s, struct{}{})\n    fmt.Println(len(s), cap(s))\n}\n</code></pre>\n<p>And run it on the <a href=\"https://play.golang.org/p/AUKUBmQld_e\" rel=\"nofollow noreferrer\">Go Playground</a>:</p>\n<pre><code>2147483645 2147483645\n2147483646 2147483646\n2147483647 2147483647\n-2147483648 2147483647\n-2147483647 2147483647\n-2147483646 2147483647\n</code></pre>\n<p>As we can see, the capacity stops growing once it reaches <code>MaxInt32</code> on 32-bit architectures, and <code>MaxInt64</code> on 64-bit architectures.</p>\n"}], "owner": {"reputation": 393, "user_id": 2664120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95e396f6a7678066cf12a38350f80a3e?s=128&d=identicon&r=PG", "display_name": "Nordiii", "link": "https://stackoverflow.com/users/2664120/nordiii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 53743772, "answer_count": 1, "score": 3, "last_activity_date": 1544623507, "creation_date": 1544617930, "last_edit_date": 1544618175, "question_id": 53743099, "link": "https://stackoverflow.com/questions/53743099/behavior-of-append-when-appending-item-to-a-max-size-slice", "title": "Behavior of append when appending item to a max size slice", "body": "<p>I'm confused about the behavior when appending to a slice which already has the max possible size.</p>\n\n<p>As far as my understanding goes a slice can either have a max size of int32 or int64 depending on your system.</p>\n\n<p>When executing <code>test := make([]struct{},math.MaxInt64+1)</code> I get the error <code>len argument too large in make([]struct {})</code> which is within my expectations.\nBut when doing something like: </p>\n\n<pre><code>test := make([]struct{},math.MaxInt64)\nfor i:=0;i&lt;100 ; i++ {\n    test = append(test, struct{}{})\n}\nfmt.Println(len(test))\n</code></pre>\n\n<p>I expect the program to panic but surprisingly the code runs with out any problems and <code>len</code> returns an overflowed value with <code>-9223372036854775709</code>.</p>\n\n<p>Could someone maybe elaborate the behavior? </p>\n\n<p>(I'm using go1.11.2 linux/amd64)</p>\n"}, {"tags": ["ssl", "go", "certificate", "tls1.2"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1544624265, "post_id": 53743094, "comment_id": 94342340, "body": "&quot;self sign certificate issued by local Root CA&quot; is an oxymoron. Which one is it, self-signed or issued by some CA? Can you add the certificate(s) to the question?"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1544683658, "post_id": 53743094, "comment_id": 94364988, "body": "@Peter It seems by &quot;self-signed&quot; they mean &quot;issued from a local root certificate&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 0, "last_activity_date": 1544683847, "creation_date": 1544683847, "answer_id": 53756428, "question_id": 53743094, "link": "https://stackoverflow.com/questions/53743094/how-to-validate-self-signed-certificate-of-a-server/53756428#53756428", "title": "How to validate self signed certificate of a server", "body": "<p>I see a couple of problems with the ca cert you posted already, but it is hard to diagnose without the server certificate issued from it as well. The SAN names on that will need to match the hostnames your client is hitting, and it seems they might not.</p>\n\n<p>Looking at the flags on that cert (using <a href=\"https://www.certlogik.com/decoder/\" rel=\"nofollow noreferrer\">this site</a> works), it looks like that ca cert does not have the CA bit set, and so will not be a valid issuer for any child certs. You need a root certificate with that extension enabled, and then you can generate valid certs from it.</p>\n"}], "owner": {"reputation": 825, "user_id": 570200, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/c1f1eb2f77f0fc96d61e5d2252b179dc?s=128&d=identicon&r=PG", "display_name": "Abhinav", "link": "https://stackoverflow.com/users/570200/abhinav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 456, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1544683847, "creation_date": 1544617915, "last_edit_date": 1544631480, "question_id": 53743094, "link": "https://stackoverflow.com/questions/53743094/how-to-validate-self-signed-certificate-of-a-server", "title": "How to validate self signed certificate of a server", "body": "<p>I am trying to validate self sign certificate issued by local Root CA. My application also has the same Root CA. I am using a proxy service to reach server. The basic role of the proxy service is simple redirecting the request to server. Below is the code I am trying to use it</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"crypto/tls\"\n    \"log\"\n    \"crypto/x509\"\n    \"flag\"\n)\n\nconst localCertFile = `-----BEGIN CERTIFICATE-----\nMIIDwzCCAqugAwIBAgIJAI6nmnGw6bGbMA0GCSqGSIb3DQEBCwUAMIGgMQswCQYD\nVQQGEwJVUzETMBEGA1UECAwKTmV3IEplcnNleTEWMBQGA1UEBwwNQmFza2luZyBS\naWRnZTESMBAGA1UECgwJQXZheWEgSW5jMQwwCgYDVQQLDANHQ1MxIDAeBgNVBAMM\nF2Nsb3VkLXRydXN0Y2EuYXZheWEuY29tMSAwHgYJKoZIhvcNAQkBFhFzdXBwb3J0\nQGF2YXlhLmNvbTAeFw0xODA1MjUxMDE2MjNaFw0yODA1MjIxMDE2MjNaMIGgMQsw\nCQYDVQQGEwJVUzETMBEGA1UECAwKTmV3IEplcnNleTEWMBQGA1UEBwwNQmFza2lu\nZyBSaWRnZTESMBAGA1UECgwJQXZheWEgSW5jMQwwCgYDVQQLDANHQ1MxIDAeBgNV\nBAMMF2Nsb3VkLXRydXN0Y2EuYXZheWEuY29tMSAwHgYJKoZIhvcNAQkBFhFzdXBw\nb3J0QGF2YXlhLmNvbTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKJp\nsdLWk3S9MefVajUSaEZf4pjo58Z6t3vqvxNaJ1oDBDRuBJZzHv4Grs7SfQFnzRRH\nivZTa6vNHJCaDMds5qztf6BhpyEwwdQdtCCQgiaAIV1HuLA1dnR4iAT2jUH4Pvxt\n/BDj60j2YDFfV5j6Fh20lH5sKpkVEftPZ8PClEhqJ286h+U3i96WnTR54FIu6DKU\n4RQjp3Cu2an/824HjNSLy5Tgr5N3RrosOJ4cZga9663p0DuIfpkQUvf+uPPafKUO\nCt90QwFpEDrX7jYB1VIy9by4OI/UvZjijCJ4Q/5Xl+SKZLD1gs5/QXSccOSyayEk\n7/941MbGqwKjZXcszC8CAwEAATANBgkqhkiG9w0BAQsFAAOCAQEAihQiDedCG3un\nV0TWmo9e4gHkoMfMgeKOEtNLiIFejZjMILyiY9/bv/vemp27WR1tbKz/Mo/zcJbU\noxDyHrEszp4ZYAwK2vFRT1T2r3rIGgUf4XyPSu8fEYLnPeCdm3BFpCrC4jIsaxJ3\nBJYvmFUSCLw1IjcgCrBp4lpMRKySjCPpZiisldDBKrJrulNwx7g1I1CYxLn2jkIu\nb/uL0SOJPDMriS3UZ0eqByBJTZ57rkVAeW6VUbwXxIBXQX1aC2PIT2n1svywHgY2\nHlK5YUaCPPL3C1MiL2Qn9ZIQwcW/eY758polgOQIo6iys9MkG7sdYlpP61V5tZud\n6FqDS2taqA==\n-----END CERTIFICATE-----`\n\nfunc main() {\n    insecure := flag.Bool(\"insecure-ssl\", false, \"Accept/Ignore all server SSL certificates\")\n    flag.Parse()\n\n    rootCA, _ := x509.SystemCertPool()\n    if rootCA == nil {\n        rootCA = x509.NewCertPool()\n    }\n    /*cert, err := ioutil.ReadFile(localCertFile)\n\n    if err != nil {\n        log.Fatalf(\"Failed to append %q to RootCAs: %v\", localCertFile, err)\n    }*/\n\n    if ok := rootCA.AppendCertsFromPEM([]byte(localCertFile)); !ok {\n        log.Println(\"No certs appended, using system certs only\")\n    }\n\n    config := &amp;tls.Config{\n        InsecureSkipVerify: *insecure,\n        RootCAs: rootCA,\n        //ServerName: \"trust.170918167.comsubjectKeyIdentifier   = hash\",\n    }\n\n    tr := &amp;http.Transport{TLSClientConfig: config}\n    client := &amp;http.Client{Transport: tr}\n\n    req, _ := http.NewRequest(http.MethodGet, \"https://cmm-register.default.svc.cluster.local:7070/MediaManager/ws/sysconfig\", nil)\n    resp, err := client.Do(req)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    log.Println(resp)\n\n\n\n\n    //Error when ServerName is diabled\n            //Get https://service:7070/sysconfig: x509: certificate is valid for trust.170918167.comsubjectKeyIdentifier   = hash, not service\n            //When ServerName is set\n            //Get https://service:7070/sysconfig: x509: certificate signed by unknown authority (possibly\n            //because of \"x509: invalid signature: parent certificate cannot sign this kind of certificate\" while trying to verify candidate authority certificate \"cloud-trustca.test.com\")\n}\n</code></pre>\n\n<p>So how to fix this issue as I need to validate the server certificate using the same CA. When I try to use openssl to verify the server certificate it get validated properly using the same root ca.</p>\n\n<p>Currently I am using Go v1.9.</p>\n"}, {"tags": ["go", "build"], "comments": [{"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 3, "creation_date": 1544616237, "post_id": 53742626, "comment_id": 94337777, "body": "this means 2 main func in one package which is not possible"}, {"owner": {"reputation": 167, "user_id": 6178132, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/00f0fdab57f56e84365bf5d0d4c289b9?s=128&d=identicon&r=PG&f=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/6178132/patryk"}, "reply_to_user": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "edited": false, "score": 0, "creation_date": 1544616413, "post_id": 53742626, "comment_id": 94337875, "body": "@danicheeta are there any other options to get multiple binary files into one location with single command?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 3, "creation_date": 1544616798, "post_id": 53742626, "comment_id": 94338126, "body": "Please start with <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a>"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 4, "last_activity_date": 1544616916, "last_edit_date": 1544616916, "creation_date": 1544616392, "answer_id": 53742684, "question_id": 53742626, "link": "https://stackoverflow.com/questions/53742626/go-build-multiple-programs-in-one-folder/53742684#53742684", "title": "&quot;go build&quot; multiple programs in one folder", "body": "<p>Go packages are scoped per directory. This means you can have only one package, and thus, at most one 'main' package, in a single directory. What you're trying to do simply isn't possible<sup>*</sup>.</p>\n\n<p>You'll need to create subdirectories instead:</p>\n\n<pre><code>functions/hello/hello.go\nfunctions/hello2/hello2.go\n</code></pre>\n\n<p>Then you can build them thus:</p>\n\n<pre><code>go build functions/...\n</code></pre>\n\n<p><sup>*</sup> Technically speaking, you <em>can</em> accomplish the organization you want, by completely abusing the go tool chain, and specifying the specific go packages to compile, which takes precedence over the other files in the directory. This will only work on the tiniest of programs (basically, a program contained within a single .go file, or a small, manageable number of .go files) This would require multiple commands, and moreover this should <em>NEVER BE DONE</em>, so I'm not even going to explain how it could be done. Simply: <em>NEVER DO THIS!</em></p>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1544626521, "post_id": 53743857, "comment_id": 94343722, "body": "<code>go build -o</code> is a cleaner solution than <code>GOBIN=... go install</code>."}], "tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": false, "score": 1, "last_activity_date": 1544620416, "creation_date": 1544620416, "answer_id": 53743857, "question_id": 53742626, "link": "https://stackoverflow.com/questions/53742626/go-build-multiple-programs-in-one-folder/53743857#53743857", "title": "&quot;go build&quot; multiple programs in one folder", "body": "<p>you can have 2 seperate package, both with <code>main</code> func, then issue this command in both directories:\n<code>GOBIN={compiled-dir} go install</code></p>\n"}], "owner": {"reputation": 167, "user_id": 6178132, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/00f0fdab57f56e84365bf5d0d4c289b9?s=128&d=identicon&r=PG&f=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/6178132/patryk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 702, "favorite_count": 0, "accepted_answer_id": 53742684, "answer_count": 2, "score": -2, "last_activity_date": 1544620416, "creation_date": 1544616184, "question_id": 53742626, "link": "https://stackoverflow.com/questions/53742626/go-build-multiple-programs-in-one-folder", "title": "&quot;go build&quot; multiple programs in one folder", "body": "<p>I have <code>functions/hello.go</code> file</p>\n\n<p>Running <code>go build</code> results in creating new binary file <code>functions</code> inside the same directory.</p>\n\n<p>I'd like to have two source files in <code>functions</code> directory: <code>hello.go</code> and <code>hello2.go</code> and be able to run <code>go build</code> which results in two binary files: <code>hello</code> and <code>hello2</code>.</p>\n\n<p>How to achieve this?</p>\n"}, {"tags": ["authentication", "go", "buffalo"], "owner": {"reputation": 907, "user_id": 10088259, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/590a29bb9182f252bc6e7e5885f3423a?s=128&d=identicon&r=PG&f=1", "display_name": "Fred Hors", "link": "https://stackoverflow.com/users/10088259/fred-hors"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 345, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1544626115, "creation_date": 1544615131, "last_edit_date": 1544626115, "question_id": 53742344, "link": "https://stackoverflow.com/questions/53742344/gobuffalo-and-authboss-authentication-system-integration", "title": "GoBuffalo and Authboss (authentication system) integration", "body": "<p>I'm trying to use <code>authboss</code> (<a href=\"https://github.com/volatiletech/authboss\" rel=\"nofollow noreferrer\">https://github.com/volatiletech/authboss</a>) with <code>GoBuffalo</code> (<a href=\"https://github.com/gobuffalo/buffalo\" rel=\"nofollow noreferrer\">https://github.com/gobuffalo/buffalo</a>).</p>\n\n<p><em>I'm still learning Go and I think this is a good exercise.</em></p>\n\n<p>I created a new GoBuffalo app, you can find it here: <a href=\"https://github.com/frederikhors/buffalo-authboss-sample\" rel=\"nofollow noreferrer\">https://github.com/frederikhors/buffalo-authboss-sample</a></p>\n\n<p><strong>STEPS TO REPRODUCE</strong></p>\n\n<ul>\n<li><p><code>git clone https://github.com/frederikhors/buffalo-authboss-sample</code></p></li>\n<li><p><code>cd</code> in project root</p></li>\n<li><p><code>go get -u -v github.com/gobuffalo/buffalo/buffalo</code></p></li>\n<li><p><code>go mod tidy</code></p></li>\n<li><p><code>buffalo dev</code></p></li>\n</ul>\n\n<p>As you can see the new buffalo app is minimal (all the features are commented).</p>\n\n<p>I copied a very small set of instructions from this sample repo: <a href=\"https://github.com/volatiletech/authboss-sample\" rel=\"nofollow noreferrer\">https://github.com/volatiletech/authboss-sample</a></p>\n\n<p>The app starts but I can't open <a href=\"http://localhost:3000/auth/login\" rel=\"nofollow noreferrer\">http://localhost:3000/auth/login</a> (404 page not found).</p>\n\n<p>Using <code>app.Mount(\"/auth\", http.StripPrefix(\"/auth\", ab.Config.Core.Router))</code> creates routes as you can see in dashboard (<a href=\"http://localhost:3000/\" rel=\"nofollow noreferrer\">http://localhost:3000/</a>) or in the screen below.</p>\n\n<p><strong>Buffalo routes</strong>:</p>\n\n<pre><code>GET     /auth/{path:.+}/    authPath    github.com/gobuffalo/buffalo.WrapHandler.func1\nPUT     /auth/{path:.+}/    authPath    github.com/gobuffalo/buffalo.WrapHandler.func1\nPATCH   /auth/{path:.+}/    authPath    github.com/gobuffalo/buffalo.WrapHandler.func1\nHEAD    /auth/{path:.+}/    authPath    github.com/gobuffalo/buffalo.WrapHandler.func1\nOPTIONS /auth/{path:.+}/    authPath    github.com/gobuffalo/buffalo.WrapHandler.func1\nDELETE  /auth/{path:.+}/    authPath    github.com/gobuffalo/buffalo.WrapHandler.func1\nPOST    /auth/{path:.+}/    authPath    github.com/gobuffalo/buffalo.WrapHandler.func1\n</code></pre>\n\n<p><strong>I can't understand how to tell Buffalo to render authboss views for that routes.</strong></p>\n"}, {"tags": ["http", "go", "facebook-graph-api"], "comments": [{"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1544609394, "post_id": 53739503, "comment_id": 94333764, "body": "loose the NewReader and the for loop and try <code>body, err := ioutil.ReadAll(resp.Body)</code>  <code>log.Printf(&quot;%v&quot;, body)</code> . Maybe there are no newlines in the json output from the graph"}], "owner": {"reputation": 467, "user_id": 8106002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e477ad83a0db8ad842418b2a4ee15fa?s=128&d=identicon&r=PG&f=1", "display_name": "pat", "link": "https://stackoverflow.com/users/8106002/pat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 166, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1544605848, "creation_date": 1544605794, "last_edit_date": 1544605848, "question_id": 53739503, "link": "https://stackoverflow.com/questions/53739503/unable-to-retrieve-facebook-live-comments-in-real-time", "title": "Unable to retrieve facebook live comments in real-time", "body": "<p>I want to retrieve facebook live comments in real time. I have read this <a href=\"https://developers.facebook.com/docs/graph-api/server-sent-events/endpoints/live-comments\" rel=\"nofollow noreferrer\">documentation</a>\nThis is my implementation:</p>\n\n<pre><code>func getLiveComments(liveId, token string) {\n    url := fmt.Sprintf(\"https://streaming-graph.facebook.com/%s/live_comments?access_token=%s&amp;comment_rate=one_per_two_seconds&amp;fields=from{name,id},message\",\n        liveId, url.QueryEscape(token))\n    resp, err := http.Get(url)\n    if err != nil {\n        fmt.Printf(\"Get: %s\\n\", err)\n        return\n    }\n    defer resp.Body.Close()\n\n    reader := bufio.NewReader(resp.Body)\n    for {\n        // got stuck here\n        line, err := reader.ReadBytes('\\n')\n        if err != nil {\n            break\n        }\n        log.Println(string(line))\n    }\n}\n</code></pre>\n\n<p>But it got stuck at <code>line, err := reader.ReadBytes('\\n')</code>.\nI can use the <code>liveId</code> and <code>token</code> to get comments from <a href=\"https://developers.facebook.com/tools/explorer/?method=GET&amp;path=%7Blive-video-id%7D%2Fcomments&amp;version=v3.2\" rel=\"nofollow noreferrer\">facebook Graph API</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1544605444, "post_id": 53739286, "comment_id": 94331343, "body": "But they do have values, the error struct is like this: <code>{Value:number Type:string Offset:16 Struct:Sample Field:a_string}</code>, try it on the <a href=\"https://play.golang.org/p/rNCjaLM4y6r\" rel=\"nofollow noreferrer\">Go Playground</a>. What is your question?"}, {"owner": {"reputation": 1604, "user_id": 3351097, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/yInN3.jpg?s=128&g=1", "display_name": "Maxian Nicu", "link": "https://stackoverflow.com/users/3351097/maxian-nicu"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1544605671, "post_id": 53739286, "comment_id": 94331454, "body": "@icza interesting. Playground gives me a different result comparing to my local one. Will check what&#39;s wrong with my environment..."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1544605958, "post_id": 53739286, "comment_id": 94331638, "body": "It also works on my local computer, so if you get something else, it must be your environment. What is the output of <code>go version</code> and <code>go env</code>?"}, {"owner": {"reputation": 1604, "user_id": 3351097, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/yInN3.jpg?s=128&g=1", "display_name": "Maxian Nicu", "link": "https://stackoverflow.com/users/3351097/maxian-nicu"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1544606159, "post_id": 53739286, "comment_id": 94331791, "body": "go version go1.11.1 darwin/amd64"}], "answers": [{"tags": [], "owner": {"reputation": 1604, "user_id": 3351097, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/yInN3.jpg?s=128&g=1", "display_name": "Maxian Nicu", "link": "https://stackoverflow.com/users/3351097/maxian-nicu"}, "is_accepted": true, "score": 2, "last_activity_date": 1544616424, "last_edit_date": 1544616424, "creation_date": 1544608494, "answer_id": 53740316, "question_id": 53739286, "link": "https://stackoverflow.com/questions/53739286/go-getting-failed-field-from-unmarshaltypeerror/53740316#53740316", "title": "Go getting failed field from UnmarshalTypeError", "body": "<p>Issue was reproduced only on my local environment. After removing golang(I had 3 version installed with brew) and installing go once again, it started to work as expected. <code>Struct</code> and <code>Field</code> are populating again.</p>\n\n<p>Also, there is a <a href=\"https://github.com/golang/go/issues/27275\" rel=\"nofollow noreferrer\">issue on github GO repository</a></p>\n"}], "owner": {"reputation": 1604, "user_id": 3351097, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/yInN3.jpg?s=128&g=1", "display_name": "Maxian Nicu", "link": "https://stackoverflow.com/users/3351097/maxian-nicu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 293, "favorite_count": 0, "accepted_answer_id": 53740316, "answer_count": 1, "score": 1, "last_activity_date": 1544616424, "creation_date": 1544604993, "question_id": 53739286, "link": "https://stackoverflow.com/questions/53739286/go-getting-failed-field-from-unmarshaltypeerror", "title": "Go getting failed field from UnmarshalTypeError", "body": "<p>According to GO stdlib, there is an error returned when JSON property type is different than struct's one. Here is definition:</p>\n\n<pre><code>// An UnmarshalTypeError describes a JSON value that was\n// not appropriate for a value of a specific Go type.\ntype UnmarshalTypeError struct {\n    Value  string       // description of JSON value - \"bool\", \"array\", \"number -5\"\n    Type   reflect.Type // type of Go value it could not be assigned to\n    Offset int64        // error occurred after reading Offset bytes\n    Struct string       // name of the struct type containing the field\n    Field  string       // name of the field holding the Go value\n}\n</code></pre>\n\n<p>Now, I'm trying to simulate a type conversion fail, by having an string field inside struct and providing int to this one.</p>\n\n<pre><code>import (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Sample struct {\n    StringProp string `json:\"a_string\"`\n}\n\nfunc main(){\n    jsonString := `{ \"a_string\" : 1 }`\n    s := Sample{}\n    err := json.Unmarshal([]byte(jsonString), &amp;s)\n    if err != nil {\n        typeErr := err.(*json.UnmarshalTypeError)\n        fmt.Print(typeErr.Field)\n    }\n}\n</code></pre>\n\n<p>But unfortunately, the error doesn't have any values for \"Struct\" or \"Field\" property. What are these properties for?\nIs there a way to detect at which property unmarshal failed?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 4, "creation_date": 1544601094, "post_id": 53738228, "comment_id": 94329219, "body": "If you publish the repo to one of godoc.org&#39;s supported services (GitHub for example), then godoc.org will display the doc for you.  See <a href=\"https://godoc.org/-/about#howto\" rel=\"nofollow noreferrer\">godoc.org/-/about#howto</a>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "edited": false, "score": 0, "creation_date": 1544612717, "post_id": 53738810, "comment_id": 94335768, "body": "Thanks, assume I&#39;ve more than one package and I want to expose all except one or just one except from all, how can I do it ?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1544613597, "post_id": 53738810, "comment_id": 94336262, "body": "Then you need to put your private packages in a private repo."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1544602953, "creation_date": 1544602953, "answer_id": 53738810, "question_id": 53738228, "link": "https://stackoverflow.com/questions/53738228/how-to-use-go-doc-in-public-repo/53738810#53738810", "title": "How to use go doc in public repo", "body": "<p>You don't need to do anything. <strong>godoc.org</strong> will automatically fetch your doc the first time it's requested, and frequently updates its cache, in case of changes to your package.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user4445419"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 53738810, "answer_count": 1, "score": -1, "last_activity_date": 1544603269, "creation_date": 1544600578, "last_edit_date": 1544603269, "question_id": 53738228, "link": "https://stackoverflow.com/questions/53738228/how-to-use-go-doc-in-public-repo", "title": "How to use go doc in public repo", "body": "<p>I've some question regard <code>godoc</code> . I have a private git repository and I want to make it public. How does the documentation work? I've used the command <code>godoc -html my-tool/cmd&gt; doc.html</code> to generate it locally make fixes etc, but when we go public how the docs will be there , should I do something or this is automatically generated from public function etc?</p>\n\n<p>Should I submit the generated local doc file either? I guess not but not sure...</p>\n"}, {"tags": ["docker", "go", "docker-ce", "docker-ee"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 1, "creation_date": 1544616521, "post_id": 53737573, "comment_id": 94337950, "body": "The server code is thread-safe, and if you make two requests to create a container, you should always get two containers.  Is that the behavior you expect?"}, {"owner": {"reputation": 1438, "user_id": 4260303, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e5ffc35d29354418bfb03c44dcf5fae5?s=128&d=identicon&r=PG&f=1", "display_name": "curiousengineer", "link": "https://stackoverflow.com/users/4260303/curiousengineer"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1544635789, "post_id": 53737573, "comment_id": 94349185, "body": "@DavidMaze, I might be sending create container request back to back with same name, will only one of them make it finally and all other be rejected as it is thread safe?"}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1544637611, "post_id": 53737573, "comment_id": 94350136, "body": "It\u2019s just code, and the error is just an error.  What happens if you try it?"}, {"owner": {"reputation": 1438, "user_id": 4260303, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e5ffc35d29354418bfb03c44dcf5fae5?s=128&d=identicon&r=PG&f=1", "display_name": "curiousengineer", "link": "https://stackoverflow.com/users/4260303/curiousengineer"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1544637867, "post_id": 53737573, "comment_id": 94350277, "body": "@DavidMaze, i used docker sdk create that gets triggered via aws sqs which can get replayed at random, if docker create rejects all but one command, I can rely on it. That was the intent of asking the Q. I still have to try but from docker code I must get this <code>ErrNameReserved = errors.New(&quot;name is reserved&quot;)</code>. Am I right so far and I can rely on docker was my Q"}], "owner": {"reputation": 1438, "user_id": 4260303, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e5ffc35d29354418bfb03c44dcf5fae5?s=128&d=identicon&r=PG&f=1", "display_name": "curiousengineer", "link": "https://stackoverflow.com/users/4260303/curiousengineer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1544597749, "creation_date": 1544597749, "question_id": 53737573, "link": "https://stackoverflow.com/questions/53737573/docker-sdk-for-container-creation", "title": "docker sdk for container creation", "body": "<p>I am using go-sdk for docker to create a container by code along the following lines</p>\n\n<pre><code>resp, err := cli.ContainerCreate(ctx, &amp;container.Config{\n        Image: \"alpine\",\n        Cmd:   []string{\"echo\", \"hello world\"},\n    }, nil, nil, \"\"/* This is container name argument*/)\n</code></pre>\n\n<p>I understand that the argument that takes container name, if i use the same name twice, docker engine will reject it. Also unless a stopped container is removed, the name cannot be used. My question now is that if i send such a request back to back, is the server side code thread safe or it is possible that 2 such containers may come up for a short while? Basically I looked at the rest api server handler for that and did not understand much as to what the behavior will be.</p>\n"}, {"tags": ["arrays", "go", "slice", "prepend"], "comments": [{"owner": {"reputation": 3971, "user_id": 2840714, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/s9vli.jpg?s=128&g=1", "display_name": "ChuckCottrill", "link": "https://stackoverflow.com/users/2840714/chuckcottrill"}, "edited": false, "score": 0, "creation_date": 1544597099, "post_id": 53737435, "comment_id": 94327656, "body": "Append and reverse?"}, {"owner": {"reputation": 81, "user_id": 2853187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0809f882891bd0b93b1539cbfe353f4b?s=128&d=identicon&r=PG", "display_name": "geunho", "link": "https://stackoverflow.com/users/2853187/geunho"}, "edited": false, "score": 2, "creation_date": 1544597583, "post_id": 53737435, "comment_id": 94327854, "body": "You should make the first parameter to array which you want to prepend(push)."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 79, "last_activity_date": 1544722149, "last_edit_date": 1544722149, "creation_date": 1544597887, "answer_id": 53737602, "question_id": 53737435, "link": "https://stackoverflow.com/questions/53737435/how-to-prepend-int-to-slice/53737602#53737602", "title": "How to prepend int to slice", "body": "<p>Use a slice <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"noreferrer\">composite literal</a>: <code>[]int{1}</code>, For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var x []int\n    for i := 2; i &lt; 10; i += 2 {\n        x = append(x, i)\n    }\n    fmt.Println(x)\n\n    x = append([]int{1}, x...)\n\n    fmt.Println(x)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/Yc87gO7gJlD\" rel=\"noreferrer\">https://play.golang.org/p/Yc87gO7gJlD</a></p>\n\n<p>Output:</p>\n\n<pre><code>[2 4 6 8]\n[1 2 4 6 8]\n</code></pre>\n\n<hr>\n\n<p>However, this more efficient version may make fewer allocations, An allocation is only necessary when there is no spare slice capacity.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    var x []int\n    for i := 2; i &lt; 10; i += 2 {\n        x = append(x, i)\n    }\n    fmt.Println(x)\n\n    x = append(x, 0)\n    copy(x[1:], x)\n    x[0] = 1\n\n    fmt.Println(x)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/fswXul_YfvD\" rel=\"noreferrer\">https://play.golang.org/p/fswXul_YfvD</a></p>\n\n<p>Output:</p>\n\n<pre><code>[2 4 6 8]\n[1 2 4 6 8]\n</code></pre>\n\n<hr>\n\n<p>Good code must be readable. In Go, we often hide implementaion details inside a function. Go compilers are optimizing compilers, small, simple functions (like <code>prependInt</code>) are inlined.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc prependInt(x []int, y int) []int {\n    x = append(x, 0)\n    copy(x[1:], x)\n    x[0] = y\n    return x\n}\n\nfunc main() {\n    var x []int\n    for i := 2; i &lt; 10; i += 2 {\n        x = append(x, i)\n    }\n    fmt.Println(len(x), cap(x), x)\n\n    x = prependInt(x, 1)\n\n    fmt.Println(len(x), cap(x), x)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/wl6gvoXraKH\" rel=\"noreferrer\">https://play.golang.org/p/wl6gvoXraKH</a></p>\n\n<p>Output:</p>\n\n<pre><code>4 4 [2 4 6 8]\n5 8 [1 2 4 6 8]\n</code></pre>\n\n<hr>\n\n<p>See <a href=\"https://github.com/golang/go/wiki/SliceTricks\" rel=\"noreferrer\">Go SliceTricks</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 769, "user_id": 7627013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7a5f89a1d1c5be396122df378bae1221?s=128&d=identicon&r=PG", "display_name": "sanchezcl", "link": "https://stackoverflow.com/users/7627013/sanchezcl"}, "is_accepted": false, "score": 2, "last_activity_date": 1606910588, "creation_date": 1606910588, "answer_id": 65107723, "question_id": 53737435, "link": "https://stackoverflow.com/questions/53737435/how-to-prepend-int-to-slice/65107723#65107723", "title": "How to prepend int to slice", "body": "<p>The current version is go1.14.11</p>\n<p>Prepend without a for loop:</p>\n<pre><code>package main\n\nimport &quot;fmt&quot;\nfunc main () {\n  data := []int{1, 2, 3, 4}\n  fmt.Println(data)\n  data = append([]int{99}, data...)\n  fmt.Println(data)\n}\n</code></pre>\n<p>Example taken form: <a href=\"https://codingair.wordpress.com/2014/07/18/go-appendprepend-item-into-slice/\" rel=\"nofollow noreferrer\">https://codingair.wordpress.com/2014/07/18/go-appendprepend-item-into-slice/</a></p>\n<p>Works with integers: <a href=\"https://play.golang.org/p/gaLhB5_d1Iu\" rel=\"nofollow noreferrer\">https://play.golang.org/p/gaLhB5_d1Iu</a></p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1619062521, "creation_date": 1619062521, "answer_id": 67206372, "question_id": 53737435, "link": "https://stackoverflow.com/questions/53737435/how-to-prepend-int-to-slice/67206372#67206372", "title": "How to prepend int to slice", "body": "<p>Another option is linked list:</p>\n<pre><code>package main\n\nimport (\n   &quot;container/list&quot;\n   &quot;fmt&quot;\n)\n\nfunc main() {\n   x := list.New()\n   // append\n   for i := 2; i &lt; 10; i += 2 {\n      x.PushBack(i)\n   }\n   // prepend\n   x.PushFront(2)\n   // print\n   for i := x.Front(); i != nil; i = i.Next() {\n      fmt.Println(i.Value)\n   }\n}\n</code></pre>\n<p>Result:</p>\n<pre><code>2\n2\n4\n6\n8\n</code></pre>\n<p><a href=\"https://golang.org/pkg/container/list\" rel=\"nofollow noreferrer\">https://golang.org/pkg/container/list</a></p>\n"}], "owner": {"reputation": 1099, "user_id": 2525417, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/79e1d9b6e282ec579cbf332f1ebc0a40?s=128&d=identicon&r=PG", "display_name": "coda", "link": "https://stackoverflow.com/users/2525417/coda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 30301, "favorite_count": 5, "accepted_answer_id": 53737602, "answer_count": 3, "score": 34, "last_activity_date": 1619062521, "creation_date": 1544596986, "last_edit_date": 1544641026, "question_id": 53737435, "link": "https://stackoverflow.com/questions/53737435/how-to-prepend-int-to-slice", "title": "How to prepend int to slice", "body": "<p>I am fairly new to Go and thus my question might seem a bit naive.</p>\n\n<p>i have a slice which I created using</p>\n\n<pre><code>var x []int;\nfor i := 2; i &lt; 10; i += 2 {\n    x = append(x, i);\n}\n</code></pre>\n\n<p>I want to prepend an integer to this slice, something like</p>\n\n<pre><code>x = append(2, x)\n</code></pre>\n\n<p>but obviously it won't work since append needs a slice as the first argument.</p>\n\n<p>I have tried <a href=\"https://codingair.wordpress.com/2014/07/18/go-appendprepend-item-into-slice/\" rel=\"noreferrer\">this</a> but it only works for strings and it's not working in my case.</p>\n"}, {"tags": ["pointers", "for-loop", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1544596989, "post_id": 53737075, "comment_id": 94327601, "body": "Your reasoning is too complex, the problem is much simpler. In the <code>for</code> loop there is just one variable <code>v</code> for <b>each</b> loop iteration: The variable v is <i>reused</i> for each and every iteration, only its value is updated. A single variable has a single address, so the address is the same for each iteration. So all goroutines are spawned with the same address. Once they start working the will work on the same address, this happens very likely after terminating the for loop, so all will work in the last element. See <a href=\"https://golang.org/doc/faq#closures_and_goroutines\" rel=\"nofollow noreferrer\">golang.org/doc/faq#closures_and_goroutines</a>"}, {"owner": {"reputation": 1463, "user_id": 6355435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1137693062918547/picture?type=large", "display_name": "David Chen", "link": "https://stackoverflow.com/users/6355435/david-chen"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1544597339, "post_id": 53737075, "comment_id": 94327758, "body": "@Volker Thank you for providing the link, it&#39;s kind of  embarrassing that later on I figured it out why the correct version works. Could you check my <b>Update</b> block?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1544597385, "post_id": 53737075, "comment_id": 94327780, "body": "There are more ways to fix the incorrect version. Using a slice of pointers is just one way. Two other ways are describes in the link to the FAQ entry (and I think these are the better solutions). I&#39;d recommend to read all the official documentation first before diving into some arbitrary blog post. Take the Tour of Go, read Effective Go, read the whole FAQ, then the language spec, then the blog post on &quot;array and slices&quot;, &quot;strings, bytes and runes&quot;, and the &quot;concurrency patterns&quot;. And then do this all once more."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1544597460, "post_id": 53737075, "comment_id": 94327813, "body": "Yes, the &quot;Update&quot; is also a solution."}], "answers": [{"tags": [], "owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "is_accepted": false, "score": 1, "last_activity_date": 1544599939, "last_edit_date": 1544599939, "creation_date": 1544598805, "answer_id": 53737810, "question_id": 53737075, "link": "https://stackoverflow.com/questions/53737075/to-use-goroutine-in-for-loop-why-iterating-over-pointers-to-struct-but-not-stru/53737810#53737810", "title": "To use goroutine in for loop, why iterating over pointers to struct but not structs themselves works", "body": "<p>Your receiver is a poniter and you have to define your field slice as pointer this is why this code works</p>\n\n<pre><code>data := []*field{{\"one\"}, {\"two\"}, {\"three\"}}\n</code></pre>\n\n<p>if you change your receiver to non pointer you code works too .</p>\n\n<pre><code>func (p field) print() {\n    fmt.Println(p.name)\n}\n\ndata := []field{{\"one\"}, {\"two\"}, {\"three\"}}\n</code></pre>\n"}], "owner": {"reputation": 1463, "user_id": 6355435, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1137693062918547/picture?type=large", "display_name": "David Chen", "link": "https://stackoverflow.com/users/6355435/david-chen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1544599939, "creation_date": 1544595181, "last_edit_date": 1544596716, "question_id": 53737075, "link": "https://stackoverflow.com/questions/53737075/to-use-goroutine-in-for-loop-why-iterating-over-pointers-to-struct-but-not-stru", "title": "To use goroutine in for loop, why iterating over pointers to struct but not structs themselves works", "body": "<h2>Background</h2>\n\n<p>I'm reading 50 shades in Go, specifically <a href=\"http://devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-golang/index.html#closure_for_it_vars\" rel=\"nofollow noreferrer\">Iteration Variables and Closures in \"for\" Statements</a>, and I'm going to take an excerpt from it.</p>\n\n<h3>Incorrect</h3>\n\n<pre><code>    package main\n\n    import (  \n        \"fmt\"\n        \"time\"\n    )\n\n    type field struct {  \n        name string\n    }\n\n    func (p *field) print() {  \n        fmt.Println(p.name)\n    }\n\n    func main() {  \n        data := []field{{\"one\"},{\"two\"},{\"three\"}}\n\n        for _,v := range data {\n            go v.print()\n        }\n\n        time.Sleep(3 * time.Second)\n        //goroutines print: three, three, three\n    }\n</code></pre>\n\n<h3>Correct</h3>\n\n<p>Change <code>[]field{{\"one\"},{\"two\"},{\"three\"}}</code> to <code>[]*field{{\"one\"},{\"two\"},{\"three\"}}</code>, and <code>one</code>, <code>two</code>, and <code>three</code> will be printed in some order.</p>\n\n<h2>My Thought Process</h2>\n\n<ol>\n<li><p>In the incorrect one, <code>go v.print()</code> is replaced by <code>go (&amp;v).print()</code> by compiler because <code>print()</code> is defined on pointer receiver.</p></li>\n<li><p>Until the spawned goroutine is executed, runtime only knows that goroutine should execute<code>print()</code>, but has no idea pointer of which instance should be passed as the receiver.</p></li>\n<li><p>When the spawned goroutine is executed, it's highly possible that the for loop has terminated, so when we want to decide which value should be passed as the receiver, we get the address of <code>v</code>, which is shared during the entire loop and updated in each iteration, so we pass the address of the last element of <code>data</code> as the receiver to <code>print()</code>, and that's why we get 3 <code>three</code> printed.</p></li>\n</ol>\n\n<h2>Problem</h2>\n\n<p>To me, changing <code>[]field</code> to <code>[]*field</code> only lets compiler skip the step 1, but does not change step 2 and step 3, so I don't know why that fixes the problem.</p>\n\n<p>I guess there must be some flaws in my thought process, and I appreciate any advice.</p>\n\n<h2>Update</h2>\n\n<p>I happened to see another correct implementation <a href=\"http://marcio.io/2015/07/handling-1-million-requests-per-minute-with-golang/#comment-3338317553\" rel=\"nofollow noreferrer\">here</a>, and I think I might know where went wrong in my thought process.</p>\n\n<pre><code>data := []field{{\"one\"}, {\"two\"}, {\"three\"}}\n\nfor i := range data {\n    go data[i].print()\n}\n</code></pre>\n\n<p>The thing is, the pointer to be passed to <code>print()</code> as the receiver, is determined in step 2 instead of step 3. That means in the incorrect version, we're passing the same address in each iteration, but the content it points to  (<code>data</code>) is updated in each iteration. However, in the correct version, the pointers being passed to <code>print()</code> as the receiver, point to the actual elements of <code>field</code>. The same applies to the case using indices.</p>\n"}, {"tags": ["postgresql", "go", "docker-compose"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1544603898, "post_id": 53735948, "comment_id": 94330521, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/53732507/how-to-make-connection-between-docker-containers\">How to make connection between Docker Containers</a>"}], "answers": [{"comments": [{"owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "edited": false, "score": 3, "creation_date": 1544610105, "post_id": 53736196, "comment_id": 94334214, "body": "From version 2 of the compose file and newer, a default network is created for the project or stack if you do not define one. <a href=\"https://docs.docker.com/compose/networking/\" rel=\"nofollow noreferrer\">docs.docker.com/compose/networking</a>"}, {"owner": {"reputation": 2724, "user_id": 354007, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/6c577241666b544e9fa19d9a013f964c?s=128&d=identicon&r=PG", "display_name": "IrishGringo", "link": "https://stackoverflow.com/users/354007/irishgringo"}, "edited": false, "score": 2, "creation_date": 1544622521, "post_id": 53736196, "comment_id": 94341329, "body": "is the networks:  actually required here?  I understood there to be a network already added in Version 3 of docker compose.   I am getting about issue here: <a href=\"https://stackoverflow.com/questions/53744332/ssl-connection-issues-between-go-scratch-container-and-pg-container-how-to-reso\" title=\"ssl connection issues between go scratch container and pg container how to reso\">stackoverflow.com/questions/53744332/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1462, "user_id": 7796179, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tyfLZr62aSI/AAAAAAAAAAI/AAAAAAAAAAs/-4ja6CFAsQM/photo.jpg?sz=128", "display_name": "yomateo", "link": "https://stackoverflow.com/users/7796179/yomateo"}, "is_accepted": false, "score": 1, "last_activity_date": 1544589685, "creation_date": 1544589685, "answer_id": 53736196, "question_id": 53735948, "link": "https://stackoverflow.com/questions/53735948/cannot-get-connection-between-containers/53736196#53736196", "title": "Cannot get connection between containers", "body": "<p>You're missing the networking configuration. This is required if you want to communicate between containers.</p>\n\n<pre><code>version: '3.6'\nservices:\n  postgres: # you were missing the 's'\n    image: postgres:11.1-alpine\n    ports:\n      - '5432:5432'\n    networks:\n      - mynet\n\n    environment:\n      POSTGRES_USER: 'user'\n      POSTGRES_PASSWORD: 'password'\n      POSTGRESS_DB: 'db_amex01'\n    volumes:\n      - ./init:/docker-entrypoint-initdb.d/\n\n  todo:\n    build: ./go_amex/\n    ports:\n      - \"8000:8000\" # I looked at your main.go file, it's port 8000!\n    networks:\n      - mynet\n\nnetworks:\n  mynet:\n    driver: bridge\n</code></pre>\n\n<p>Now you can see (via dns resolution) each service from within the containers by using the service name as the hostname.</p>\n"}, {"comments": [{"owner": {"reputation": 2724, "user_id": 354007, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/6c577241666b544e9fa19d9a013f964c?s=128&d=identicon&r=PG", "display_name": "IrishGringo", "link": "https://stackoverflow.com/users/354007/irishgringo"}, "edited": false, "score": 0, "creation_date": 1544622382, "post_id": 53740801, "comment_id": 94341250, "body": "thanks...   that fixed my issue...   but now Ihave another... SSL issue.  if you could look it over I would appreciate it.  <a href=\"https://stackoverflow.com/questions/53744332/ssl-connection-issues-between-go-scratch-container-and-pg-container-how-to-reso\" title=\"ssl connection issues between go scratch container and pg container how to reso\">stackoverflow.com/questions/53744332/&hellip;</a>"}], "tags": [], "owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "is_accepted": true, "score": 4, "last_activity_date": 1544610797, "last_edit_date": 1544610797, "creation_date": 1544609977, "answer_id": 53740801, "question_id": 53735948, "link": "https://stackoverflow.com/questions/53735948/cannot-get-connection-between-containers/53740801#53740801", "title": "Cannot get connection between containers", "body": "<p>You have a typo in your compose file. A DNS alias is automatically configured for the service name, and a default docker network is also created for your project. So all that should be needed is to connect to the service name, which in your case was \"postgre\" instead of \"postgres\". To fix that, try this compose file:</p>\n\n<pre><code>version: '3.6'\nservices:\n  postgres:\n    image: postgres:11.1-alpine\n    ports:\n      - '5432:5432'\n    environment:\n      POSTGRES_USER: 'user'\n      POSTGRES_PASSWORD: 'password'\n      POSTGRESS_DB: 'db_amex01'\n    volumes:\n      - ./init:/docker-entrypoint-initdb.d/\n\n  todo:\n    build: ./go_amex/\n    # ports:\n    #   - \"8000:8080\"\n</code></pre>\n\n<p>For more details on compose file networking, see: <a href=\"https://docs.docker.com/compose/networking/\" rel=\"nofollow noreferrer\">https://docs.docker.com/compose/networking/</a></p>\n\n<p>Note that the next error you will likely see is a connection refused. Compose will start both containers simultaneously, and your application will likely be running before the database finishes starting. To solve that, you will want a retry loop with a short delay between retries, and a timeout or retry limit, in your application code.</p>\n"}, {"tags": [], "owner": {"reputation": 2724, "user_id": 354007, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/6c577241666b544e9fa19d9a013f964c?s=128&d=identicon&r=PG", "display_name": "IrishGringo", "link": "https://stackoverflow.com/users/354007/irishgringo"}, "is_accepted": false, "score": 1, "last_activity_date": 1544708086, "creation_date": 1544708086, "answer_id": 53763085, "question_id": 53735948, "link": "https://stackoverflow.com/questions/53735948/cannot-get-connection-between-containers/53763085#53763085", "title": "Cannot get connection between containers", "body": "<p>The issue was a typo in the docker_compose file. I had the postgres container labeled as postgre. That fixed the network lookup issue. Please advice if I should delete this post.</p>\n"}], "owner": {"reputation": 2724, "user_id": 354007, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/6c577241666b544e9fa19d9a013f964c?s=128&d=identicon&r=PG", "display_name": "IrishGringo", "link": "https://stackoverflow.com/users/354007/irishgringo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12525, "favorite_count": 1, "accepted_answer_id": 53740801, "answer_count": 3, "score": 3, "last_activity_date": 1598370597, "creation_date": 1544587780, "last_edit_date": 1598370597, "question_id": 53735948, "link": "https://stackoverflow.com/questions/53735948/cannot-get-connection-between-containers", "title": "Cannot get connection between containers", "body": "<p>I have included the code here..\n<a href=\"https://github.com/vinceyoumans/achal\" rel=\"nofollow noreferrer\">https://github.com/vinceyoumans/achal</a></p>\n<p><strong>PROBLEM:</strong>  Two containers in a docker compose file. one is standard Postgress container.  The second is a goLang Scratch container.  The GoLang main.go file panics when the postgres connection fails. you can see the code on github.</p>\n<h2>The error is:</h2>\n<h3>dial tcp: lookup postgres on 127.0.0.11:53: no such host</h3>\n<p><strong>REQUEST:</strong>\nlook over the main.go and dockercompose file to see what is wrong with this network.. what I am missing.</p>\n<h2>main.go</h2>\n<pre><code>db, err := gorm.Open(&quot;postgres&quot;, &quot;host='postgres' port=5432 user=docker dbname='docker' password='password'&quot;)\n\nif err != nil {\n    fmt.Println(&quot;============   exiting ==========&quot;)\n    fmt.Println(err)\n    panic(&quot;failed to connect database e&quot;)\n    //  the error i get... dial tcp: lookup postgres on 127.0.0.11:53: no such host\n    // panic(&quot;failed to connect database: &quot; + err)\n}\n</code></pre>\n<p>The docker-compose.yml</p>\n<pre><code>version: '3.6'\nservices:\n  postgre:\n    image: postgres:11.1-alpine\n    ports:\n      - '5432:5432'\n    #network_mode: bridge\n    #container_name: postgres\n \n    environment:\n      POSTGRES_USER: 'user'\n      POSTGRES_PASSWORD: 'password'\n      POSTGRESS_DB: 'db_amex01'\n    volumes:\n      - ./init:/docker-entrypoint-initdb.d/\n\n  todo:\n    build: ./go_amex/\n    # ports:\n    #   - &quot;8000:8080&quot;\n\n# sudo docker-compose -f docker-compose.yml up\n\n#  HELP:  how would I add the goLang service from this point?\n</code></pre>\n"}, {"tags": ["security", "go", "oauth-2.0", "http-headers"], "answers": [{"tags": [], "owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "is_accepted": true, "score": 3, "last_activity_date": 1544587233, "creation_date": 1544587233, "answer_id": 53735866, "question_id": 53735769, "link": "https://stackoverflow.com/questions/53735769/how-to-pass-the-header-in-post-method/53735866#53735866", "title": "How to pass the header in POST method?", "body": "<p>Your code sends POST request and after request is processed it adds headers to <strong>response</strong> struct:</p>\n\n<blockquote>\n  <p><strong>response</strong>, err := http.Post(url, \"application/json\", bytes.NewBuffer(jsonStr))</p>\n</blockquote>\n\n<p>You should set headers first and send request after that:</p>\n\n<pre><code>// create request\nreq, err := http.NewRequest(\"POST\", url, bytes.NewBuffer(jsonStr))\nif err != nil {\n   panic(err)\n}\n\n// set headers\nreq.Header.Add(\"Authorization\", \"Bearer \"+bearerToken)\nreq.Header.Add(\"Accept\", \"application/json\")\n\n// send request with headers\nclient := &amp;http.Client{}\nresponse, err := client.Do(req)\n</code></pre>\n"}], "owner": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 591, "favorite_count": 0, "accepted_answer_id": 53735866, "answer_count": 1, "score": -1, "last_activity_date": 1544587233, "creation_date": 1544586429, "question_id": 53735769, "link": "https://stackoverflow.com/questions/53735769/how-to-pass-the-header-in-post-method", "title": "How to pass the header in POST method?", "body": "<p>Here I have a function in which I'm sending a POST request which is used to save customer in the squareup with data and also set the headers with Authentication using <code>variable_name.Header.Set()</code>\nBut in body response it will always give me error of the:-</p>\n\n<pre><code>\"errors\":[\n     {\"category\":\"AUTHENTICATION_ERROR\",\n      \"code\":\"UNAUTHORIZED\",\n      \"detail\":\"Your request did not include an `Authorization` http header with an access token. }]}\n</code></pre>\n\n<p>But In the function I'm setting the authentication token.</p>\n\n<p>Code:-</p>\n\n<pre><code>func CreateCustomer(c *gin.Context) {\ncustomer := models.Customer{}\nbearer := strings.Split(c.Request.Header[\"Authorization\"][0], \"Bearer\")// token pass in the postman.\nbearerToken := strings.TrimSpace(bearer[1])\n\ncustomerErr := json.NewDecoder(c.Request.Body).Decode(&amp;customer)\nif customerErr != nil {\n    fmt.Println(customerErr)\n    return\n}\nfmt.Println(customer)\nbindData, err := json.Marshal(customer)\nif err != nil {\n    panic(err)\n}\nvar jsonStr = []byte(string(bindData))\nurl :=\"https://connect.squareup.com/v2/customers\"\nfmt.Println(url)\n\nreq, err := http.Post(url, \"application/json\", bytes.NewBuffer(jsonStr))\n// I used this one too.\n// req.Header.Set(\"Authorization\", \"Bearer \"+bearerToken)\n// req.Header.Set(\"Accept\", \"application/json\")\nreq.Header.Add(\"Authorization\", \"Bearer \"+bearerToken)\nreq.Header.Add(\"Accept\", \"application/json\")\nfmt.Println(req.Header)\nif err != nil {\n    panic(err)\n}\ndefer req.Body.Close()\nbody, _ := ioutil.ReadAll(req.Body)\nfmt.Println(\"response Body:\", string(body))\n}\n\ntype Customer struct {\n  GivenName    string   `json:\"given_name\" bson:\"given_name\"`\n  FamilyName   string   `json:\"family_name\" bson:\"family_name\"`\n  CompanyName  string   `json:\"company_name\" bson:\"company_name\"`\n  Nickname     string   `json:\"nickname\" bson:\"nickname\"`\n  EmailAddress string   `json:\"email_address\" bson:\"email_address\"`\n  Address      Addresss `json:\"address\" bson:\"address\"`\n  PhoneNumber  string   `json:\"phone_number\" bson:\"phone_number\"`\n  ReferenceId  string   `json:\"reference_id\" bson:\"reference_id\"`\n  Note         string   `json:\"note\" bson:\"note\"`\n}\n</code></pre>\n\n<p>The <code>req.Header</code> result is:-</p>\n\n<pre><code>map[X-Xss-Protection:[1; mode=block] \n    Keep-Alive:[timeout=60] \n    Accept:[application/json] \n    X-Permitted-Cross-Domain-Policies:[none] \n    Content-Type:[application/json] \n    Vary:[Origin, Accept-Encoding] \n    X-Content-Type-Options:[nosniff] \n    X-Download-Options:[noopen] \n    X-Frame-Options:[SAMEORIGIN] \n    Date:[Wed, 12 Dec 2018 03:41:16 GMT] \n    Strict-Transport-Security:[max-age=631152000] \n    Authorization:[Bearer YOUR_TOKEN HERE]]\n</code></pre>\n\n<p>Can anyone tell me that what error should I'm doing or where I do correction that it will able to save customer in the Squareup?</p>\n"}, {"tags": ["go", "google-cloud-dataflow", "apache-beam"], "comments": [{"owner": {"reputation": 1805, "user_id": 7598113, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/afa022bfb89a6089383cb2f018438855?s=128&d=identicon&r=PG&f=1", "display_name": "kuza", "link": "https://stackoverflow.com/users/7598113/kuza"}, "edited": false, "score": 1, "creation_date": 1546852645, "post_id": 53735145, "comment_id": 94975562, "body": "Encountered similar issue with Apache Beam Python SDK. Using direct runner pipeline works flawlessly but when starting with dataflow runner \u2014 same issue. Dataflow UI shows everything is fine but in logs you see the pod being restarted with the same error cyclically."}, {"owner": {"reputation": 1805, "user_id": 7598113, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/afa022bfb89a6089383cb2f018438855?s=128&d=identicon&r=PG&f=1", "display_name": "kuza", "link": "https://stackoverflow.com/users/7598113/kuza"}, "edited": false, "score": 0, "creation_date": 1546853110, "post_id": 53735145, "comment_id": 94975793, "body": "<i>This question might be a duplicate of <a href=\"https://stackoverflow.com/q/52117053/7598113\">this</a> question.</i>"}, {"owner": {"reputation": 159, "user_id": 4451156, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh5.googleusercontent.com/-NN6xAfr-5-8/AAAAAAAAAAI/AAAAAAAAB6k/c3qgAW-HJ14/photo.jpg?sz=128", "display_name": "florianrosenberg", "link": "https://stackoverflow.com/users/4451156/florianrosenberg"}, "edited": false, "score": 1, "creation_date": 1547150571, "post_id": 53735145, "comment_id": 95103745, "body": "Seeing the exact same thing. Tried to re-push the worker harness image to my own docker account but it also fails. Seems like something is broken. This was working a week back when I last ran the job."}], "answers": [{"tags": [], "owner": {"reputation": 1670, "user_id": 755720, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3604cd9b2bace5309fbec61d569ede16?s=128&d=identicon&r=PG", "display_name": "andrewrjones", "link": "https://stackoverflow.com/users/755720/andrewrjones"}, "is_accepted": false, "score": 1, "last_activity_date": 1552401089, "creation_date": 1552401089, "answer_id": 55123987, "question_id": 53735145, "link": "https://stackoverflow.com/questions/53735145/google-cloud-data-flow-stuck-with-repeated-error-error-syncing-pod-failed-to/55123987#55123987", "title": "Google Cloud Data flow stuck with repeated error &#39;Error syncing pod...failed to &quot;StartContainer&quot; for &quot;sdk&quot; with CrashLoopBackOff&#39;", "body": "<p>We had something similar and found that is was an inability to start the workers (for us due to an slf4j issue, but it could be anything that prevents the worker from starting in whatever language).</p>\n\n<p>If you look at the Stackdriver Logs (view Logs in the UI, and click the link to go to Stackdriver) you should be able to view the <code>worker_startup</code> logs.</p>\n"}, {"tags": [], "owner": {"reputation": 699, "user_id": 110305, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/b096c64fce30d77f065d29e92e8fbd33?s=128&d=identicon&r=PG", "display_name": "Felix", "link": "https://stackoverflow.com/users/110305/felix"}, "is_accepted": false, "score": 0, "last_activity_date": 1554777614, "creation_date": 1554777614, "answer_id": 55584344, "question_id": 53735145, "link": "https://stackoverflow.com/questions/53735145/google-cloud-data-flow-stuck-with-repeated-error-error-syncing-pod-failed-to/55584344#55584344", "title": "Google Cloud Data flow stuck with repeated error &#39;Error syncing pod...failed to &quot;StartContainer&quot; for &quot;sdk&quot; with CrashLoopBackOff&#39;", "body": "<p>I ran into the same problem today, and followed the instructions <a href=\"https://github.com/apache/beam/blob/master/sdks/CONTAINERS.md\" rel=\"nofollow noreferrer\">here</a> to build my own image, pushed it to a public repo and used it with the <code>--worker_harness_container_image</code> option and it worked for me. </p>\n"}], "owner": {"reputation": 2427, "user_id": 270797, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/26bef0b1ae5672af7f225d6b9ff4ed33?s=128&d=identicon&r=PG", "display_name": "Tim", "link": "https://stackoverflow.com/users/270797/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 936, "favorite_count": 0, "answer_count": 2, "score": 6, "last_activity_date": 1563979111, "creation_date": 1544580916, "question_id": 53735145, "link": "https://stackoverflow.com/questions/53735145/google-cloud-data-flow-stuck-with-repeated-error-error-syncing-pod-failed-to", "title": "Google Cloud Data flow stuck with repeated error &#39;Error syncing pod...failed to &quot;StartContainer&quot; for &quot;sdk&quot; with CrashLoopBackOff&#39;", "body": "<p>SDK: Apache Beam SDK for Go 0.5.0</p>\n\n<p>Our Golang job has been running fine on Google Cloud Data flow for weeks. We haven't made any updates to the job itself and the SDK version seems to be the same as it has been. Last night it failed, and I'm not sure exactly why. It gets to the 1 hour time limit and the job is cancelled due to no worker activity.</p>\n\n<p>Looking at the Stackdriver logs the only thing I can see that stands out is repeated errors with <code>Error syncing pod...failed to \"StartContainer\" for \"sdk\" with CrashLoopBackOff</code></p>\n\n<p>It seems that it's somehow failing to sync the pod(?) and thus waiting 5 minutes before retrying.</p>\n\n<p>Could anyone shed some light on what might be causing this and how we might go about either finding more information, or diagnosing the cause of the problem?</p>\n\n<p>Note: I checked the status for Google Cloud Data flow and there doesn't appear to be any outages with the service.</p>\n"}, {"tags": ["unit-testing", "go", "testing"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1544589963, "post_id": 53734945, "comment_id": 94325438, "body": "&quot;tests are run for only 1/4 go files&quot;. No. Like all normal .go files are compiled into a package <b>all</b> _test.go files are part of the test and the coverage report (unless explicitly excluded by build constraints). You are doing something wrong."}, {"owner": {"reputation": 1499, "user_id": 1430428, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/9cad3584982ca55f14f5d57114773c97?s=128&d=identicon&r=PG&f=1", "display_name": "piy26", "link": "https://stackoverflow.com/users/1430428/piy26"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1544590420, "post_id": 53734945, "comment_id": 94325533, "body": "You mean to say that go test -v pkg should be running all the test cause ? Can you please point me places where I might have gone wrong ?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1544596488, "post_id": 53734945, "comment_id": 94327421, "body": "I&#39;m not saying it &quot;should&quot; run all the the test, I say it <i>does</i> run all the tests. Things to look for: 1. The obvious: You interpret the coverage result wrong (most likely and you did not show the actual output, what you expect and why you expect the different outcome than the actual one). 2. Build constraints. 3. Skipped tests. 4. Typo in the file name like _test<b>s</b>.go. I&#39;d bet on 1."}], "answers": [{"comments": [{"owner": {"reputation": 1285, "user_id": 4227700, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/BKZJV.jpg?s=128&g=1", "display_name": "northsideknight", "link": "https://stackoverflow.com/users/4227700/northsideknight"}, "edited": false, "score": 0, "creation_date": 1544610089, "post_id": 53735010, "comment_id": 94334199, "body": "Why did this get a downvote?  Does it not answer the question/not work?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1544628232, "post_id": 53735010, "comment_id": 94344739, "body": "This is fine to run, but the question only contains one package."}, {"owner": {"reputation": 1285, "user_id": 4227700, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/BKZJV.jpg?s=128&g=1", "display_name": "northsideknight", "link": "https://stackoverflow.com/users/4227700/northsideknight"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1544630906, "post_id": 53735010, "comment_id": 94346465, "body": "Ah yes, that is why I specified you should be in the package directory when running it.  I am not sure you can specify packages when running <code>go test</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1544632093, "post_id": 53735010, "comment_id": 94347155, "body": "Look at the usage for <code>go test</code>, the arguments after flags is one or more package names. (the relative path wildcard <code>.&#47;...</code> itself resolves to one or more package names)"}], "tags": [], "owner": {"reputation": 1285, "user_id": 4227700, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/BKZJV.jpg?s=128&g=1", "display_name": "northsideknight", "link": "https://stackoverflow.com/users/4227700/northsideknight"}, "is_accepted": false, "score": 2, "last_activity_date": 1544579945, "creation_date": 1544579945, "answer_id": 53735010, "question_id": 53734945, "link": "https://stackoverflow.com/questions/53734945/how-to-run-multiple-test-files-in-a-go-package/53735010#53735010", "title": "How to run multiple test files in a go package", "body": "<p>if your working directory is that of your package, to test all of the files you could run:</p>\n\n<pre><code>go test ./...\n</code></pre>\n\n<p>if you wanted to get test coverage, you could run:</p>\n\n<pre><code>go test ./... -cover\n</code></pre>\n"}], "owner": {"reputation": 1499, "user_id": 1430428, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/9cad3584982ca55f14f5d57114773c97?s=128&d=identicon&r=PG&f=1", "display_name": "piy26", "link": "https://stackoverflow.com/users/1430428/piy26"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2145, "favorite_count": 1, "answer_count": 1, "score": -4, "last_activity_date": 1544579945, "creation_date": 1544579339, "question_id": 53734945, "link": "https://stackoverflow.com/questions/53734945/how-to-run-multiple-test-files-in-a-go-package", "title": "How to run multiple test files in a go package", "body": "<p>I have a project structure like this:</p>\n\n<pre><code>pkg\n|\n--pkg.go\n--pkg_test.go\n--a.go\n--a_test.go\n--b.go\n--b_test.go\n--c.go\n--c_test.go\n</code></pre>\n\n<p>I wish to get the coverage for all the source files belonging to the package i.e.(pkg.go, a.go, b.go and c.go). However, when I run:</p>\n\n<p><code>go test -v pkg</code> </p>\n\n<p>tests are run for only 1/4 go files.</p>\n\n<p>Is there any way I can test my package without moving all the test codes within one file and keeping the file structure intact ?</p>\n"}, {"tags": ["go", "aws-lambda", "netlify"], "answers": [{"tags": [], "owner": {"reputation": 11277, "user_id": 2597114, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/766587f9276e9d48db0047f2a53bd3c9?s=128&d=identicon&r=PG", "display_name": "talves", "link": "https://stackoverflow.com/users/2597114/talves"}, "is_accepted": true, "score": 3, "last_activity_date": 1544637175, "creation_date": 1544637175, "answer_id": 53748721, "question_id": 53734532, "link": "https://stackoverflow.com/questions/53734532/netlify-functions-aws-lambda-example-hello-golang-function-invalid-or-unexp/53748721#53748721", "title": "Netlify functions (AWS Lambda) example &quot;hello&quot; Golang function: Invalid or unexpected token", "body": "<blockquote>\n  <p>I have not tested a zipped go function on Netlify.</p>\n</blockquote>\n\n<p>If you do not want to do the manual build in this case, you can inline your build commands on Netlify deploy.</p>\n\n<p>Add a build command that does both builds for the project.</p>\n\n<pre class=\"lang-toml prettyprint-override\"><code>[build]\n  command = \"make build &amp;&amp; hugo\"\n  functions = \"functions\"\n  publish = \"public\"\n[build.environment]\n  # Change this path with the path to your repository\n  GO_IMPORT_PATH = \"github.com/netlify/aws-lambda-go-example\"\n</code></pre>\n\n\n"}], "owner": {"reputation": 167, "user_id": 6178132, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/00f0fdab57f56e84365bf5d0d4c289b9?s=128&d=identicon&r=PG&f=1", "display_name": "Patryk", "link": "https://stackoverflow.com/users/6178132/patryk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 563, "favorite_count": 0, "accepted_answer_id": 53748721, "answer_count": 1, "score": 2, "last_activity_date": 1544637175, "creation_date": 1544575781, "question_id": 53734532, "link": "https://stackoverflow.com/questions/53734532/netlify-functions-aws-lambda-example-hello-golang-function-invalid-or-unexp", "title": "Netlify functions (AWS Lambda) example &quot;hello&quot; Golang function: Invalid or unexpected token", "body": "<p>I'm trying to get Netlify Functions work with Go.\nFirst, I tried cloning official example repo (<a href=\"https://github.com/netlify/aws-lambda-go-example\" rel=\"nofollow noreferrer\">https://github.com/netlify/aws-lambda-go-example</a>) and it worked.</p>\n\n<p>My problem is, I have a Hugo website which require <code>hugo</code> build command and I don't know how to build Hugo with <code>hugo</code> and Go source files with <code>make build</code> (like in example repo) - I think it could solve the problem, but I couldn't find relevant docs describing this option.</p>\n\n<p>So my next step was to manually compile Go function file and put it into <code>functions</code> folder.</p>\n\n<p>source file (from the example above):</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/aws/aws-lambda-go/events\"\n    \"github.com/aws/aws-lambda-go/lambda\"\n)\n\nfunc handler(request events.APIGatewayProxyRequest) (events.APIGatewayProxyResponse, error) {\n    return events.APIGatewayProxyResponse{\n        StatusCode: 200,\n        Body:       \"Hello AWS Lambda and Netlify\",\n    }, nil\n}\n\nfunc main() {\n    // Make the handler available for Remote Procedure Call by AWS Lambda\n    lambda.Start(handler)\n}\n</code></pre>\n\n<p>I used instruction available at <a href=\"https://github.com/aws/aws-lambda-go#building-your-function\" rel=\"nofollow noreferrer\">https://github.com/aws/aws-lambda-go#building-your-function</a> to compile Go binary:</p>\n\n<pre><code>GOOS=linux GOARCH=amd64 go build -o hello hello.go\nzip hello.zip hello\nmv hello.zip ./functions/hello.zip\n</code></pre>\n\n<p>This was pushed to Git and therefore deployed to Netlify. So far so good, my function appeared in Netlify UI.</p>\n\n<p><a href=\"https://i.stack.imgur.com/YrzwD.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/YrzwD.png\" alt=\"hello.js\"></a></p>\n\n<p>But when I requested the function URL, I got error message:</p>\n\n<pre><code>    {\n  \"errorMessage\": \"Invalid or unexpected token\",\n  \"errorType\": \"SyntaxError\",\n  \"stackTrace\": [\n    \"\",\n    \"SyntaxError: Invalid or unexpected token\",\n    \"createScript (vm.js:80:10)\",\n    \"Object.runInThisContext (vm.js:139:10)\",\n    \"Module._compile (module.js:616:28)\",\n    \"Object.Module._extensions..js (module.js:663:10)\",\n    \"Module.load (module.js:565:32)\",\n    \"tryModuleLoad (module.js:505:12)\",\n    \"Function.Module._load (module.js:497:3)\",\n    \"Module.require (module.js:596:17)\",\n    \"require (internal/module.js:11:18)\"\n  ]\n}\n</code></pre>\n\n<p>This is function log from Netlify:</p>\n\n<pre><code>1:18:16 AM: hello invoked\n1:18:17 AM: Syntax error in module 'hello': SyntaxError\n(function (exports, require, module, __filename, __dirname) { ELF\n                                                              ^\nSyntaxError: Invalid or unexpected token\n    at createScript (vm.js:80:10)\n    at Object.runInThisContext (vm.js:139:10)\n    at Module._compile (module.js:616:28)\n    at Object.Module._extensions..js (module.js:663:10)\n    at Module.load (module.js:565:32)\n    at tryModuleLoad (module.js:505:12)\n    at Function.Module._load (module.js:497:3)\n    at Module.require (module.js:596:17)\n    at require (internal/module.js:11:18)\n1:19:02 AM: hello invoked\n1:19:03 AM: Syntax error in module 'hello': SyntaxError\n                                                              ^\nSyntaxError: Invalid or unexpected token\n    at createScript (vm.js:80:10)\n    at Object.runInThisContext (vm.js:139:10)\n    at Module._compile (module.js:616:28)\n    at Object.Module._extensions..js (module.js:663:10)\n    at Module.load (module.js:565:32)\n    at tryModuleLoad (module.js:505:12)\n    at Function.Module._load (module.js:497:3)\n    at Module.require (module.js:596:17)\n    at require (internal/module.js:11:18)\n</code></pre>\n\n<p>Also, function name appears to be <code>hello.js</code> in Netlify UI - I don't know if it should be like that. It seems to me that AWS thinks it's Javascript instead of Go.</p>\n"}, {"tags": ["go", "concurrency", "channel", "goroutine"], "comments": [{"owner": {"reputation": 7510, "user_id": 1566990, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/b5172d640930b0917f2ac3daa23a9373?s=128&d=identicon&r=PG", "display_name": "James Dunn", "link": "https://stackoverflow.com/users/1566990/james-dunn"}, "edited": false, "score": 0, "creation_date": 1544632255, "post_id": 53734488, "comment_id": 94347228, "body": "Could you provide a code sample (even if it&#39;s incomplete) that shows us what you&#39;re trying to figure out?  Even if it&#39;s pseudocode, it would still help and we&#39;d have an easier time answering your question."}], "answers": [{"comments": [{"owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "edited": false, "score": 0, "creation_date": 1544581571, "post_id": 53734637, "comment_id": 94323756, "body": "this is exactly what I&#39;m looking for, thanks!"}], "tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": true, "score": 1, "last_activity_date": 1544576706, "creation_date": 1544576706, "answer_id": 53734637, "question_id": 53734488, "link": "https://stackoverflow.com/questions/53734488/goroutines-select-with-range-loop/53734637#53734637", "title": "Goroutines select with range loop", "body": "<p>You can put a <a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"nofollow noreferrer\"><code>select</code> statement</a> in a <code>for</code> loop (this is one of the examples in the language spec).  Unlike a <code>for...range</code> loop, this will let you read from both channels.  It also won't automatically terminate if one of the channels closes.  When you <a href=\"https://golang.org/ref/spec#Receive_operator\" rel=\"nofollow noreferrer\">receive from a closed channel</a>, a closed channel is always ready to receive and always produces a zero value, and there is a two-valued form of it that tells you whether the channel is open or not.</p>\n\n<p>Your function might loosely look like</p>\n\n<pre><code>func HandleStuff(numbers &lt;-chan int, signals &lt;-chan os.Signal) {\n    var goingToExit bool\n    for {\n        select {\n        case n := &lt;-numbers:\n            if n == 0 {\n                fmt.Printf(\"zero\\n\")\n            } else if n == 1 {\n                goingToExit = true\n            }\n        case sig, ok := &lt;-signals:\n            if !ok { // the channel is closed\n                return\n            } else if goingToExit {\n                os.Exit(0)\n            }\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "closed_date": 1544632305, "accepted_answer_id": 53734637, "answer_count": 1, "score": 0, "last_activity_date": 1544576706, "creation_date": 1544575366, "question_id": 53734488, "link": "https://stackoverflow.com/questions/53734488/goroutines-select-with-range-loop", "closed_reason": "Not suitable for this site", "title": "Goroutines select with range loop", "body": "<p>I want to spawn a goroutine to listen to two channels of type <code>chan int</code> and <code>chan os.Signal</code>. I want the behavior to be specific depending on what's received on either channels. Meaning some <code>os.Signal</code> may cause <code>os.exit()</code> and some may not, some <code>int</code> received through <code>chan int</code> may print a statement and some may call a function, so I need this gorountine to be always running since the behaviors are different. And I'd like this to be all handed by one function.</p>\n\n<p>I'm having a hard time figuring out how to achieve this syntactically. It doesn't seem like I can have <code>range</code> loops inside of a <code>select</code> block nor does it seem like I can have a <code>select</code> block inside a <code>range</code> loop. I can't find any resource online on this. Can someone give me an example?</p>\n"}, {"tags": ["database", "go", "global", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "is_accepted": true, "score": 1, "last_activity_date": 1544585617, "creation_date": 1544585617, "answer_id": 53735670, "question_id": 53734018, "link": "https://stackoverflow.com/questions/53734018/is-this-data-access-pattern-thread-safe/53735670#53735670", "title": "Is this data access pattern thread-safe?", "body": "<p>This design should be good.</p>\n\n<p><code>sql.DB</code> handles concurrent access and implements pooling. <code>gorm</code> inherits these features from it.</p>\n\n<p>One change I would made though. Global variables are hard to manage.\nYou can inject <code>db</code> into your code that uses it.</p>\n\n<pre><code>// to be removed\n// var dbClient *DbClient\n\nfunc main() {\n    db, err := GetDBClient()\n    if err != nil {\n        panic(err)\n    }\n    defer db.Close()\n\n    CodeThatUsesDB(db)\n    ...\n} \n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 10693474, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/011cab7e8d5c649e53716af2f00bc6f4?s=128&d=identicon&r=PG&f=1", "display_name": "user10693474", "link": "https://stackoverflow.com/users/10693474/user10693474"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 53735670, "answer_count": 1, "score": 0, "last_activity_date": 1544694858, "creation_date": 1544571602, "last_edit_date": 1544694858, "question_id": 53734018, "link": "https://stackoverflow.com/questions/53734018/is-this-data-access-pattern-thread-safe", "title": "Is this data access pattern thread-safe?", "body": "<p>I've implemented <code>dao.go</code> file with the following realization:</p>\n\n<ul>\n<li><code>type DbClient struct {\n    db *gorm.DB\n}</code></li>\n<li><p><code>GetDBClient()</code> initializes connection with database and returns <code>(*DbClient, error)</code></p></li>\n<li><p><code>func (db *DbClient) Close() {\n    db.db.Close()\n}</code></p></li>\n<li>Different CRUD methods of <code>DbClient</code></li>\n</ul>\n\n<p>And the <code>main.go</code> file that serves all the handlers consumes it like this:</p>\n\n<pre><code>var dbClient *DbClient\n\nfunc main() {\n    db, err := GetDBClient()\n    if err != nil {\n        panic(err)\n    }\n    dbClient = db\n    defer dbClient.Close()\n    ...\n}\n</code></pre>\n\n<p>So all the handlers of the <code>main.go</code> use global <code>dbClient</code>.<br>\nIs this architecture thread safe and does it provide atomicity of operations with database?</p>\n"}, {"tags": ["go", "go-map"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 2, "creation_date": 1544571383, "post_id": 53733948, "comment_id": 94321666, "body": "The error you should be getting is <code>invalid operation: z[id] (type *Zones does not support indexing)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 1083, "user_id": 5584140, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/B8T3h.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/5584140/martin"}, "edited": false, "score": 0, "creation_date": 1544571476, "post_id": 53733995, "comment_id": 94321693, "body": "Thank you very much! :)"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1544571385, "creation_date": 1544571385, "answer_id": 53733995, "question_id": 53733948, "link": "https://stackoverflow.com/questions/53733948/check-if-a-value-exists-in-map-using-an-internal-function-from-that-struct/53733995#53733995", "title": "Check if a value exists in map using an internal function from that struct", "body": "<p>The type <code>*Zone</code> does not support indexing. It's a pointer, not a map.  Dereference the pointer to fix the code:</p>\n\n<pre><code>func (z *Zones) findById(id uint64) (Zone, error) {\n    if zone, ok := (*z)[id]; ok { // &lt;-- note change on this line\n        return zone, nil\n    } else {\n        return Zone{}, errors.New(fmt.Sprintf(\"Zone %d not found\", id))\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1083, "user_id": 5584140, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/B8T3h.jpg?s=128&g=1", "display_name": "Martin", "link": "https://stackoverflow.com/users/5584140/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 53733995, "answer_count": 1, "score": -1, "last_activity_date": 1544571385, "creation_date": 1544571123, "question_id": 53733948, "link": "https://stackoverflow.com/questions/53733948/check-if-a-value-exists-in-map-using-an-internal-function-from-that-struct", "title": "Check if a value exists in map using an internal function from that struct", "body": "<p>I've this struct</p>\n\n<pre><code>type Zones map[uint64]Zone\n</code></pre>\n\n<p>And I want to have a method to find a value in that map, something like this.</p>\n\n<pre><code>func (z *Zones) findById(id uint64) (Zone, error) {\n    if zone, ok := z[id]; ok {\n        return zone, nil\n    } else {\n        return zone{}, errors.New(fmt.Sprintf(\"Zone %d not found\", id))\n    }\n}\n</code></pre>\n\n<p>But in this line:</p>\n\n<pre><code>if zone, ok := z[id]; ok {\n</code></pre>\n\n<p>I'm getting this error:</p>\n\n<blockquote>\n  <p>Assignment count mismatch: 2=1.</p>\n</blockquote>\n\n<p>Theres a lot of links which suggest that we can check if a value exists in a map with that line, I have no idea what is happening. What am I doing wrong?</p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["http", "go", "server", "hot-reload"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1544569083, "post_id": 53733482, "comment_id": 94320964, "body": "You have a dynamic list of routes, not a dynamic list of handlers. Make a single handler that handles all requests and do whatever you like."}], "owner": {"reputation": 89, "user_id": 10122942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09825561ecab09d723592d136eacc40b?s=128&d=identicon&r=PG&f=1", "display_name": "pjmonk", "link": "https://stackoverflow.com/users/10122942/pjmonk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 714, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1544568294, "creation_date": 1544568294, "question_id": 53733482, "link": "https://stackoverflow.com/questions/53733482/golang-net-http-server-handler-hot-reload", "title": "Golang net/http Server Handler Hot-Reload", "body": "<p>Is it possible to change the http Server's Handler struct field whilst the Server is running? I have a dynamic list of routes which can change throughout the lifetime of the server, but want to avoid any downtime.</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc main() {\n    // construct the handler for the first time\n    handler, err := constructHandler()\n    if err != nil {\n        return nil, err\n    }\n\n    // create the server\n    s := &amp;http.Server{\n        Addr:    \":80\",\n        Handler: handler,\n    }\n\n    // start the server in on a separate goroutine.\n    go func() {\n        if err := s.ListenAndServe(); err != nil {\n            log.Fatalf(\"unable to start http server: %v\", err)\n        }\n    }()\n\n    // recreate and hot-reload the handler every 30 seconds\n    for range time.Tick(30 * time.Second) {\n        handler, err = constructHandler()\n        if err != nil {\n            log.Printf(\"cannot reload: unable to construct handler: %v\", err)\n            continue\n        }\n\n        // only hot-reload the handler if there wasn't an error\n        s.Handler = handler\n    }\n}\n\nfunc constructHandler() (handler http.Handler, err error) {\n    // handler gets created.\n    // this could involve making calls to a database.\n    // ...\n    return handler, err\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-platform", "google-sheets-api"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 6684879, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mmVcrHzkGKk/AAAAAAAAAAI/AAAAAAAAI0E/ZuVREzbzJW4/photo.jpg?sz=128", "display_name": "Stas Vitko", "link": "https://stackoverflow.com/users/6684879/stas-vitko"}, "edited": false, "score": 0, "creation_date": 1544571395, "post_id": 53733206, "comment_id": 94321671, "body": "Thank you. It may work.  The problem is that similar code was working on previous version of Go runtime in GAE. Example: <a href=\"https://github.com/vistrcm/gae-spreadsheet-issue/blob/runtime_go/main.go\" rel=\"nofollow noreferrer\">github.com/vistrcm/gae-spreadsheet-issue/blob/runtime_go/&hellip;</a>  Trying to understand why it is broken for new version."}, {"owner": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "reply_to_user": {"reputation": 23, "user_id": 6684879, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mmVcrHzkGKk/AAAAAAAAAAI/AAAAAAAAI0E/ZuVREzbzJW4/photo.jpg?sz=128", "display_name": "Stas Vitko", "link": "https://stackoverflow.com/users/6684879/stas-vitko"}, "edited": false, "score": 0, "creation_date": 1544574808, "post_id": 53733206, "comment_id": 94322442, "body": "Well it&#39;s the 2nd gen runtime. They aren&#39;t one to one the same"}, {"owner": {"reputation": 413, "user_id": 6039122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cfac0207c5bc06a9542737ff0ec9e12?s=128&d=identicon&r=PG&f=1", "display_name": "alextru", "link": "https://stackoverflow.com/users/6039122/alextru"}, "reply_to_user": {"reputation": 23, "user_id": 6684879, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mmVcrHzkGKk/AAAAAAAAAAI/AAAAAAAAI0E/ZuVREzbzJW4/photo.jpg?sz=128", "display_name": "Stas Vitko", "link": "https://stackoverflow.com/users/6684879/stas-vitko"}, "edited": false, "score": 0, "creation_date": 1556105473, "post_id": 53733206, "comment_id": 98322715, "body": "Hi @StasVitko, can you confirm if this answer solved your issue?"}, {"owner": {"reputation": 23, "user_id": 6684879, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mmVcrHzkGKk/AAAAAAAAAAI/AAAAAAAAI0E/ZuVREzbzJW4/photo.jpg?sz=128", "display_name": "Stas Vitko", "link": "https://stackoverflow.com/users/6684879/stas-vitko"}, "reply_to_user": {"reputation": 413, "user_id": 6039122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cfac0207c5bc06a9542737ff0ec9e12?s=128&d=identicon&r=PG&f=1", "display_name": "alextru", "link": "https://stackoverflow.com/users/6039122/alextru"}, "edited": false, "score": 0, "creation_date": 1556214998, "post_id": 53733206, "comment_id": 98371613, "body": "Hello @alextru, this workaround works for me. I switched from Application Default Credentials to explicitly set credentials via JSON file."}, {"owner": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "reply_to_user": {"reputation": 23, "user_id": 6684879, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mmVcrHzkGKk/AAAAAAAAAAI/AAAAAAAAI0E/ZuVREzbzJW4/photo.jpg?sz=128", "display_name": "Stas Vitko", "link": "https://stackoverflow.com/users/6684879/stas-vitko"}, "edited": false, "score": 0, "creation_date": 1556215049, "post_id": 53733206, "comment_id": 98371635, "body": "@StasVitko Is this still necessary? I believe they fixed some of that. Do you mind checking?"}, {"owner": {"reputation": 23, "user_id": 6684879, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mmVcrHzkGKk/AAAAAAAAAAI/AAAAAAAAI0E/ZuVREzbzJW4/photo.jpg?sz=128", "display_name": "Stas Vitko", "link": "https://stackoverflow.com/users/6684879/stas-vitko"}, "edited": false, "score": 0, "creation_date": 1556344983, "post_id": 53733206, "comment_id": 98414737, "body": "@poy, checked today. Same error: &quot;googleapi: Error 403: Request had insufficient authentication scopes., forbidden&quot;"}, {"owner": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "reply_to_user": {"reputation": 23, "user_id": 6684879, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mmVcrHzkGKk/AAAAAAAAAAI/AAAAAAAAI0E/ZuVREzbzJW4/photo.jpg?sz=128", "display_name": "Stas Vitko", "link": "https://stackoverflow.com/users/6684879/stas-vitko"}, "edited": false, "score": 0, "creation_date": 1556827739, "post_id": 53733206, "comment_id": 98570746, "body": "@StasVitko ah bummer. Thanks for checking."}], "tags": [], "owner": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "is_accepted": true, "score": 1, "last_activity_date": 1544566780, "creation_date": 1544566780, "answer_id": 53733206, "question_id": 53733022, "link": "https://stackoverflow.com/questions/53733022/google-app-engine-go-1-11-application-can-not-access-google-spreadsheets/53733206#53733206", "title": "Google App Engine Go 1.11 application can not access Google Spreadsheets", "body": "<p>I've ran into this before as well with App Engine to G Suite integrations. You need to use a service account key. The default one does not suffice (I believe because it does not have a private key, but that might be wrong).</p>\n\n<p>Essentially you will need to upload a key with your code and use that to get a <code>Client</code> (instead of using the default one):</p>\n\n<pre><code>func getOauthClient(serviceAccountKeyPath string) *http.Client {\n    ctx := context.Background()\n    data, err := ioutil.ReadFile(serviceAccountKeyPath)\n    if err != nil {\n        log.Fatal(err)\n    }\n    creds, err := google.CredentialsFromJSON(ctx, data, \"https://www.googleapis.com/auth/spreadsheets.readonly\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    return oauth2.NewClient(ctx, creds.TokenSource)\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 6684879, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mmVcrHzkGKk/AAAAAAAAAAI/AAAAAAAAI0E/ZuVREzbzJW4/photo.jpg?sz=128", "display_name": "Stas Vitko", "link": "https://stackoverflow.com/users/6684879/stas-vitko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 355, "favorite_count": 1, "accepted_answer_id": 53733206, "answer_count": 1, "score": 2, "last_activity_date": 1544775413, "creation_date": 1544565822, "last_edit_date": 1544775413, "question_id": 53733022, "link": "https://stackoverflow.com/questions/53733022/google-app-engine-go-1-11-application-can-not-access-google-spreadsheets", "title": "Google App Engine Go 1.11 application can not access Google Spreadsheets", "body": "<p>I'm trying to access google spreadsheet via API from the application running on <a href=\"https://cloud.google.com/appengine/docs/standard/go111/\" rel=\"nofollow noreferrer\">Google App Engine Go 1.11 Standard Environment</a>.\nUnfortunately, the application cannot read <a href=\"https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit\" rel=\"nofollow noreferrer\">this spreadsheet</a>.</p>\n\n<p>I'm getting next error on <a href=\"https://godoc.org/google.golang.org/api/sheets/v4#SpreadsheetsValuesService.Get\" rel=\"nofollow noreferrer\"><code>Spreadsheets.Values.Get</code></a> call:</p>\n\n<pre><code>googleapi: Error 403: Request had insufficient authentication scopes., forbidden\n</code></pre>\n\n<p><strong>sample code</strong></p>\n\n<pre><code>// Sample app showing issue with GAE -&gt; google spreadsheets\npackage main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n\n    \"cloud.google.com/go/compute/metadata\"\n    \"golang.org/x/oauth2/google\"\n    \"google.golang.org/api/sheets/v4\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/\", indexHandler)\n\n    // [START setting_port]\n    port := os.Getenv(\"PORT\")\n    if port == \"\" {\n        port = \"8080\"\n        log.Printf(\"Defaulting to port %s\\n\", port)\n    }\n\n    // let's check app engine instance scopes\n    scopes, _ := metadata.Get(\"instance/service-accounts/default/scopes\")\n    log.Printf(\"[DEBUG] metadata scopes: %s.\\n\", scopes)\n\n    log.Printf(\"Listening on port %s\", port)\n    log.Fatal(http.ListenAndServe(fmt.Sprintf(\":%s\", port), nil))\n    // [END setting_port]\n}\n\n// indexHandler responds to requests with our greeting.\nfunc indexHandler(w http.ResponseWriter, r *http.Request) {\n    ctx := context.Background()\n    client, _ := google.DefaultClient(ctx, \"https://www.googleapis.com/auth/spreadsheets.readonly\")\n    srv, err := sheets.New(client)\n\n    // Prints the names and majors of students in a sample spreadsheet:\n    // https://docs.google.com/spreadsheets/d/1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms/edit\n    spreadsheetId := \"1BxiMVs0XRA5nFMdKvBdBZjgmUUqptlbs74OgvE2upms\"\n    readRange := \"Class Data!A2:E\"\n    resp, err := srv.Spreadsheets.Values.Get(spreadsheetId, readRange).Do()\n    if err != nil {\n        log.Fatalf(\"Unable to retrieve data from sheet: %v\\n\", err)\n    }\n\n    if len(resp.Values) == 0 {\n        fmt.Fprintf(w, \"No data found.\\n\")\n    } else {\n        fmt.Fprintf(w, \"Name, Major:\\n\")\n        for _, row := range resp.Values {\n            // Print columns A and E, which correspond to indices 0 and 4.\n            fmt.Fprintf(w, \"%s, %s\\n\", row[0], row[4])\n        }\n    }\n\n}\n</code></pre>\n\n<p><strong>steps to reproduce:</strong></p>\n\n<p>1) deploy app: <code>gcloud app deploy</code><br>\n2) open in a browser (you will get 502): <code>gcloud app browse</code><br>\n3) check logs: <code>gcloud app logs read</code>  </p>\n\n<pre><code>2018-12-11 21:44:56 default[20181211t134352]  \"GET / HTTP/1.1\" 502\n2018-12-11 21:44:57 default[20181211t134352]  2018/12/11 21:44:57 [DEBUG] metadata scopes: https://www.googleapis.com/auth/appengine.apis\n2018-12-11 21:44:57 default[20181211t134352]  https://www.googleapis.com/auth/cloud-platform\n2018-12-11 21:44:57 default[20181211t134352]  https://www.googleapis.com/auth/cloud_debugger\n2018-12-11 21:44:57 default[20181211t134352]  https://www.googleapis.com/auth/devstorage.full_control\n2018-12-11 21:44:57 default[20181211t134352]  https://www.googleapis.com/auth/logging.write\n2018-12-11 21:44:57 default[20181211t134352]  https://www.googleapis.com/auth/monitoring.write\n2018-12-11 21:44:57 default[20181211t134352]  https://www.googleapis.com/auth/trace.append\n2018-12-11 21:44:57 default[20181211t134352]  https://www.googleapis.com/auth/userinfo.email\n2018-12-11 21:44:57 default[20181211t134352]  .\n2018-12-11 21:44:57 default[20181211t134352]  2018/12/11 21:44:57 Listening on port 8081\n2018-12-11 21:44:58 default[20181211t134352]  2018/12/11 21:44:58 Unable to retrieve data from sheet: googleapi: Error 403: Request had insufficient authentication scopes., forbidden\n</code></pre>\n\n<p>Could someone please help to understand how to fix it?</p>\n\n<p>Sample project: <a href=\"https://github.com/vistrcm/gae-spreadsheet-issue\" rel=\"nofollow noreferrer\">https://github.com/vistrcm/gae-spreadsheet-issue</a></p>\n"}, {"tags": ["go", "concurrency", "multiprocessing", "deadlock"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1544564078, "post_id": 53732645, "comment_id": 94319200, "body": "Because are no sends to channel <code>c</code>, the program blocks forever on receive from <code>c</code>.  I am guessing you intended to <code>c &lt;- 2.5</code> instead of <code>return 2.5</code> in the <code>change</code> function."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544564080, "post_id": 53732645, "comment_id": 94319201, "body": "Before you get to the loop, you try to receive on <code>c</code>, but nothing ever sends on <code>c</code>."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1544564304, "post_id": 53732645, "comment_id": 94319290, "body": "Look at the stack trace carefully and you will see that main never makes it to the for loop. <a href=\"https://tour.golang.org/concurrency/2\" rel=\"nofollow noreferrer\">The Tour</a> explains channels step by step. &quot;Deadlock happens when the main function ends while goroutines didn&#39;t end yet&quot; is incorrect. When main finishes the program terminates, no matter what."}], "answers": [{"comments": [{"owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "edited": false, "score": 0, "creation_date": 1544600656, "post_id": 53733283, "comment_id": 94329031, "body": "Thanks! This is indeed what I intended to do. Your code doesn&#39;t do what I expected it to do though. I expect it to start printing out <code>s</code> when it&#39;s still <code>1.1</code>, have <code>change()</code> change the value of <code>s</code> after 2 seconds, and see that reflected in the printed out value. So I expect it to print out <code>1.1</code> for 2 seconds, after which the value that is printed changes to <code>2.5</code>. So I expect the line <code>s = &lt;-c</code> to work like a callback, but it doesn&#39;t. The program waits for a value to come out of the channel and then proceeds. Any idea how to make it update the value of <code>s</code> in the middle of the loop?"}], "tags": [], "owner": {"reputation": 9005, "user_id": 675637, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/8X97W.jpg?s=128&g=1", "display_name": "poy", "link": "https://stackoverflow.com/users/675637/poy"}, "is_accepted": true, "score": 1, "last_activity_date": 1544632864, "last_edit_date": 1544632864, "creation_date": 1544567138, "answer_id": 53733283, "question_id": 53732645, "link": "https://stackoverflow.com/questions/53732645/why-do-i-have-a-deadlock-even-though-it-includes-an-endless-loop/53733283#53733283", "title": "Why do I have a deadlock even though it includes an endless loop?", "body": "<p>It looks like you might have a misunderstanding on channels and go routines.</p>\n\n<p>The line:</p>\n\n<pre><code>go change(c)\n</code></pre>\n\n<p>seems to indicate that the function <code>change</code> is going to write to <code>c</code>. However it ends up just returning a value after a period of time.</p>\n\n<p>This value (<code>2.5</code>) doesn't get received anywhere. Also, <code>c</code> doesn't get written to anywhere. I suspect you intended the <code>2.5</code> to be written to the channel <code>c</code>. The syntax for that is as follows:</p>\n\n<pre><code>c&lt;-2.5\n</code></pre>\n\n<p>Therefore, if you change your <code>change</code> function to:</p>\n\n<pre><code>func change(c chan float64) {\n    time.Sleep(2 * time.Second)\n    c &lt;- 2.5\n}\n</code></pre>\n\n<p>You should not see the deadlock anymore. Notice I am not returning a <code>float64</code> anymore.</p>\n\n<p>I made a playground to ensure this: <a href=\"https://play.golang.org/p/SgLiUmPpcAZ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/SgLiUmPpcAZ</a></p>\n\n<p><strong>Update for Comment</strong></p>\n\n<p>The <code>1.1</code> will always be overwritten by the value of the channel. If however you want to print <code>s</code>'s initial value (as stated in the comment), you will have to change the flow a bit and use a <code>select</code> statement: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc change(c chan float64) {\n    time.Sleep(2 * time.Second)\n    c &lt;- 2.5\n}\n\nfunc main() {\n\n    s := 1.1\n\n    c := make(chan float64)\n    go change(c)\n\n    for {\n        select {\n        case s = &lt;-c:\n        default:\n            // c isn't ready yet\n        }\n        fmt.Println(s)\n        time.Sleep(100 * time.Millisecond)\n    }\n}\n</code></pre>\n\n<p>Now that you have a <code>select</code> statement, you can use it with a <code>time.Ticker</code> as well:</p>\n\n<pre><code>ticker := time.NewTicker(100 * time.Millisecond)\nfor {\n    select {\n    case s = &lt;-c:\n    case &lt;-ticker.C:\n        fmt.Println(s)\n    default:\n        // c isn't ready yet\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 53733283, "answer_count": 1, "score": -1, "last_activity_date": 1544632864, "creation_date": 1544563947, "last_edit_date": 1544597941, "question_id": 53732645, "link": "https://stackoverflow.com/questions/53732645/why-do-i-have-a-deadlock-even-though-it-includes-an-endless-loop", "title": "Why do I have a deadlock even though it includes an endless loop?", "body": "<p>So I've started messing around with Go, and I'm fascinated by go routines. I now wrote a simple test to see if I can change the value of a variable while I continuously print it out. </p>\n\n<p>I now have the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc change(c chan float64) float64 {\n    time.Sleep(2 * time.Second)\n    return 2.5\n}\n\nfunc main() {\n\n    s := 1.1\n\n    c := make(chan float64)\n    go change(c)\n    s = &lt;-c\n\n    for {\n        fmt.Println(s)\n        time.Sleep(100 * time.Millisecond)\n    }    \n}\n</code></pre>\n\n<p>Unfortunately it ends in an error:</p>\n\n<pre><code>fatal error: all goroutines are asleep - deadlock!\n\ngoroutine 1 [chan receive]:\nmain.main()\n        /home/kramer65/repos/go/src/messing_around/main.go:19 +0x7d\nexit status 2\n</code></pre>\n\n<p>I searched around and found that this deadlock happens when the main function ends while goroutines didn't end yet. But since I have an endless loop I wouldn't know what else is wrong with my code.</p>\n\n<p>Could anybody enlighten me as to what is wrong with this code, and how I can change the value of a variable while I continuously print it out? All tips are welcome!</p>\n"}, {"tags": ["postgresql", "go", "docker-compose", "go-gorm"], "comments": [{"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 0, "creation_date": 1544565077, "post_id": 53732507, "comment_id": 94319601, "body": "Do you run you go program outside docker? Did you try to changing the host from <code>postgres</code> to <code>localhost</code> or <code>postgre</code>? What system you are using?"}], "answers": [{"comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 2, "creation_date": 1544576870, "post_id": 53733673, "comment_id": 94322869, "body": "In a Docker context <code>localhost</code> is almost always wrong.  You probably want <code>postgre</code>, the name of the other server block in the <code>docker-compose.yml</code> file; it will be resolvable as a host name to a private IP address for the other container."}, {"owner": {"reputation": 2724, "user_id": 354007, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/6c577241666b544e9fa19d9a013f964c?s=128&d=identicon&r=PG", "display_name": "IrishGringo", "link": "https://stackoverflow.com/users/354007/irishgringo"}, "edited": false, "score": 0, "creation_date": 1544587260, "post_id": 53733673, "comment_id": 94324840, "body": "I was using local host when I was trying to make connection from outside of the docker container.  I have tried a lot of combinations and updated my github page with the latest code...  and description of issue.  I also include the connection error."}, {"owner": {"reputation": 89, "user_id": 10122942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09825561ecab09d723592d136eacc40b?s=128&d=identicon&r=PG&f=1", "display_name": "pjmonk", "link": "https://stackoverflow.com/users/10122942/pjmonk"}, "reply_to_user": {"reputation": 2724, "user_id": 354007, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/6c577241666b544e9fa19d9a013f964c?s=128&d=identicon&r=PG", "display_name": "IrishGringo", "link": "https://stackoverflow.com/users/354007/irishgringo"}, "edited": false, "score": 0, "creation_date": 1544614710, "post_id": 53733673, "comment_id": 94336915, "body": "@IrishGringo I&#39;ve updated my answer to include the correct solution."}], "tags": [], "owner": {"reputation": 89, "user_id": 10122942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/09825561ecab09d723592d136eacc40b?s=128&d=identicon&r=PG&f=1", "display_name": "pjmonk", "link": "https://stackoverflow.com/users/10122942/pjmonk"}, "is_accepted": false, "score": 2, "last_activity_date": 1544614596, "last_edit_date": 1544614596, "creation_date": 1544569463, "answer_id": 53733673, "question_id": 53732507, "link": "https://stackoverflow.com/questions/53732507/how-to-make-connection-between-docker-containers/53733673#53733673", "title": "How to make connection between Docker Containers", "body": "<p>It appears as though you're discarding the error returned from <code>gorm.Open()</code>. To know exactly why gorm failed to open the connection, you'd need to output the error.</p>\n\n<p>Instead of:</p>\n\n<pre><code>panic(\"failed to connect database\")\n</code></pre>\n\n<p>Use:</p>\n\n<pre><code>panic(\"failed to connect database: \" + err)\n</code></pre>\n\n<p>At a glance, it could be that your host is misconfigured</p>\n\n<pre><code>host='postgres' port=5432 user=user dbname='db_amex01' password='password'\n</code></pre>\n\n<p>Should be:</p>\n\n<pre><code>host=localhost port=5432 user=user dbname=db_amex01 password=password\n</code></pre>\n\n<p>But it's hard to tell without the error from <code>gorm.Open()</code></p>\n\n<p>One other thing to note, too; don't call <code>db.Close()</code> before first checking the error. It's possible that in the case of an error, <code>db</code> may be <code>nil</code>, causing calls to any of <code>db</code>'s methods to panic. You're also calling <code>db.Close()</code> twice in the code snippet you posted. Don't do this. Golang's documentation on <code>io.Closer</code>:</p>\n\n<blockquote>\n  <p>Closer is the interface that wraps the basic Close method.</p>\n  \n  <p>The behavior of Close after the first call is undefined. Specific\n  implementations may document their own behavior.</p>\n</blockquote>\n\n<p>Edit (12/12/2018):</p>\n\n<p>When I ran your code locally, the error I got from gorm was regarding SSL, because you're running your postgres server via docker-compose without any SSL configuration. You can add the <code>sslmode=disable</code> flag to your connection string to fix this issue.</p>\n\n<p>Also there's a typo in your <code>docker-compose.yml</code>: <code>POSTGRESS_DB</code> should be <code>POSTGRES_DB</code>.</p>\n\n<p>Here's a full working example that I got running locally:</p>\n\n<p><code>docker-compose.yml</code>:</p>\n\n<pre><code>version: '3.6'\nservices:\n  postgres:\n    image: postgres:11.1-alpine\n    ports:\n      - '5432:5432'\n    environment:\n      POSTGRES_USER: 'test_user'\n      POSTGRES_PASSWORD: 'test_password'\n      POSTGRES_DB: 'test_database'\n    volumes:\n      - ./init:/docker-entrypoint-initdb.d/\n</code></pre>\n\n<p><code>main.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/jinzhu/gorm/dialects/postgres\"\n)\n\nconst (\n    host     = \"localhost\"\n    port     = \"5432\"\n    user     = \"test_user\"\n    password = \"test_password\"\n    dbname   = \"test_database\"\n)\n\nfunc main() {\n    url := fmt.Sprintf(\"postgres://%s:%s@%s:%s/%s?sslmode=disable\",\n        user,\n        password,\n        host,\n        port,\n        dbname,\n    )\n\n    db, err := gorm.Open(\"postgres\", url)\n    if err != nil {\n        log.Fatalf(\"error connecting to database: %v\", err)\n    }\n    defer db.Close()\n\n    if err := db.DB().Ping(); err != nil {\n        log.Fatalf(\"error pinging database: %v\", err)\n    }\n\n    fmt.Println(\"Success!\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 144207, "user_id": 596285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b6975c494d3d9c404dd3d7af2edf3133?s=128&d=identicon&r=PG", "display_name": "BMitch", "link": "https://stackoverflow.com/users/596285/bmitch"}, "is_accepted": true, "score": 3, "last_activity_date": 1544610559, "creation_date": 1544610559, "answer_id": 53740983, "question_id": 53732507, "link": "https://stackoverflow.com/questions/53732507/how-to-make-connection-between-docker-containers/53740983#53740983", "title": "How to make connection between Docker Containers", "body": "<p>There's a typo in your compose file, you name the service postgre but connect to postgres. Docker uses the service name for the DNS alias on a shared network, so this will break your connection attempt. To fix, just rename your service:</p>\n\n<pre><code>version: '3.6'\nservices:\n  postgres:\n    image: postgres:11.1-alpine\n    ports:\n      - '5432:5432'\n    environment:\n      POSTGRES_USER: 'user'\n      POSTGRES_PASSWORD: 'password'\n      POSTGRESS_DB: 'db_amex01'\n    volumes:\n      - ./init:/docker-entrypoint-initdb.d/\n</code></pre>\n"}], "owner": {"reputation": 2724, "user_id": 354007, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/6c577241666b544e9fa19d9a013f964c?s=128&d=identicon&r=PG", "display_name": "IrishGringo", "link": "https://stackoverflow.com/users/354007/irishgringo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 957, "favorite_count": 0, "accepted_answer_id": 53740983, "answer_count": 2, "score": 0, "last_activity_date": 1544614596, "creation_date": 1544563187, "last_edit_date": 1544597960, "question_id": 53732507, "link": "https://stackoverflow.com/questions/53732507/how-to-make-connection-between-docker-containers", "title": "How to make connection between Docker Containers", "body": "<p>I am having connection issues when I try to connect my goLang GORM service to a Docker Postgress container.  I believe the problem is my golang code at the bottom at the connection string.</p>\n\n<pre><code>docker-compose up\nRecreating postgress_postgre_1 ... done\nAttaching to postgres\npostgres   | 2018-12-11 21:08:48.283 UTC [1] LOG:  listening on IPv4 address \"0.0.0.0\", port 5432\npostgres   | 2018-12-11 21:08:48.283 UTC [1] LOG:  listening on IPv6 address \"::\", port 5432\npostgres   | 2018-12-11 21:08:48.291 UTC [1] LOG:  listening on Unix socket \"/var/run/postgresql/.s.PGSQL.5432\"\npostgres   | 2018-12-11 21:08:48.316 UTC [20] LOG:  database system was shut down at 2018-12-11 21:08:44 UTC\npostgres   | 2018-12-11 21:08:48.328 UTC [1] LOG:  database system is ready to accept connections\n</code></pre>\n\n<p>===\nwhen I run the golang I get...  panic: failed to connect database</p>\n\n<p>===============\ndocker-compose.yml</p>\n\n<pre><code>version: '3.6'\nservices:\n  postgre:\n    image: postgres:11.1-alpine\n    ports:\n      - '5432:5432'\n    network_mode: bridge\n    container_name: postgres\n\n    environment:\n      POSTGRES_USER: 'user'\n      POSTGRES_PASSWORD: 'password'\n      POSTGRESS_DB: 'db_amex01'\n    volumes:\n      - ./init:/docker-entrypoint-initdb.d/\n</code></pre>\n\n<p>==== main.go</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n    \"github.com/jinzhu/gorm\"\n\n    // _ \"github.com/jinzhu/gorm/dialects/sqlite\"\n    _ \"github.com/jinzhu/gorm/dialects/postgres\"\n)\n\n// _ \"github.com/jinzhu/gorm/blob/master/dialects/postgres\"\n\ntype ToDo struct {\n    gorm.Model\n    ID          int    `json:\"id\"`\n    TASK_STRING string `json:\"task_string\"`\n    DONE        bool   `json:\"done\"`\n}\n\nvar db *gorm.DB\nvar err error\n\nfunc main() {\n    const (\n        host     = \"localhost\"\n        port     = 5432\n        user     = \"postgres\"\n        password = \"password\"\n        dbname   = \"db_amex01\"\n    )\n\n\n// this is the problem I believe I am having...\n\n    db, err := gorm.Open(\"postgres\", \"host='postgres' port=5432 user=user dbname='db_amex01' password='password'\")\n\n\n\n    defer db.Close()\n\n    if err != nil {\n        panic(\"failed to connect database\")\n    }\n\n    defer db.Close()\n</code></pre>\n"}, {"tags": ["datetime", "go", "timezone", "timezone-offset"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1544563570, "post_id": 53732459, "comment_id": 94318966, "body": "&quot;When parsing a time with a zone abbreviation like MST, if the zone abbreviation has a defined offset in the current location, then that offset is used. [...] If the zone abbreviation is unknown, Parse records the time as being in a fabricated location with the given zone abbreviation and a zero offset.&quot; <a href=\"https://golang.org/pkg/time/#Parse\" rel=\"nofollow noreferrer\">golang.org/pkg/time/#Parse</a> Abbreviations are generally ambiguous. Use ParseInLocation instead of Parse."}, {"owner": {"reputation": 14205, "user_id": 968244, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/I9DXX.jpg?s=128&g=1", "display_name": "isapir", "link": "https://stackoverflow.com/users/968244/isapir"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1544563904, "post_id": 53732459, "comment_id": 94319122, "body": "@Peter, please post it as an answer and I will accept it."}], "owner": {"reputation": 14205, "user_id": 968244, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/I9DXX.jpg?s=128&g=1", "display_name": "isapir", "link": "https://stackoverflow.com/users/968244/isapir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 37, "favorite_count": 0, "closed_date": 1544598101, "answer_count": 0, "score": 0, "last_activity_date": 1544562962, "creation_date": 1544562962, "question_id": 53732459, "link": "https://stackoverflow.com/questions/53732459/how-to-parse-unix-log-time-in-go", "closed_reason": "Duplicate", "title": "How to Parse Unix Log Time in Go", "body": "<p>I'm trying to parse the time portion of a *nix log line which is in EST time zone, and get the value in UTC.  e.g.</p>\n\n<pre><code>dts   := \"Dec 11 15:03:58 EST\"\ndt, _ := time.Parse(\"Jan 2 15:04:05 MST\", dts)\nfmt.Printf(\"EST: %s \\t UTC: %s\\n\", dt, dt.In(time.UTC))\n</code></pre>\n\n<p>But both values  are the same:</p>\n\n<blockquote>\n  <p>EST: 0000-12-11 15:03:58 +0000 EST<br>\n  UTC: 0000-12-11 15:03:58 +0000 UTC</p>\n</blockquote>\n\n<p>I expected the UTC time to be 20:03:58</p>\n\n<p>What am I doing wrong?</p>\n\n<p>Go Playground at <a href=\"https://play.golang.org/p/54PsZ6y8R9_Y\" rel=\"nofollow noreferrer\">https://play.golang.org/p/54PsZ6y8R9_Y</a></p>\n"}, {"tags": ["mongodb", "go", "struct", "mongodb-query", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 2812, "user_id": 3738542, "user_type": "registered", "profile_image": "https://graph.facebook.com/100002024985258/picture?type=large", "display_name": "oren", "link": "https://stackoverflow.com/users/3738542/oren"}, "edited": false, "score": 0, "creation_date": 1544564700, "post_id": 53732541, "comment_id": 94319454, "body": "Hey, is there any advantages to use bson type over a custom struct? or even map[string]string? I always used to think it doesn&#39;t really matter and preferred to use my domain entities&#39; structs and maps, so I could easier make changes in the entity and not in the repo.."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2812, "user_id": 3738542, "user_type": "registered", "profile_image": "https://graph.facebook.com/100002024985258/picture?type=large", "display_name": "oren", "link": "https://stackoverflow.com/users/3738542/oren"}, "edited": false, "score": 0, "creation_date": 1544565307, "post_id": 53732541, "comment_id": 94319692, "body": "@oren It&#39;s handy to use structs to model your data, so you can easily work with it in Go code. It&#39;s not that handy to use structs for querying (has its pros and cons), but I usually just use <code>bson.M</code> values for querying, as queries can vary a lot, and I don&#39;t want to make compromises in the model just for the sake of simpler queries."}, {"owner": {"reputation": 2812, "user_id": 3738542, "user_type": "registered", "profile_image": "https://graph.facebook.com/100002024985258/picture?type=large", "display_name": "oren", "link": "https://stackoverflow.com/users/3738542/oren"}, "edited": false, "score": 0, "creation_date": 1544566743, "post_id": 53732541, "comment_id": 94320241, "body": "Thanks, very helpful! I usually use structs for inserts and map[string]interface{} for queries. I want to be agnostic about mgo in the application repo. It comes at handy now when I\u2019m trying both mgo and the mongodb alpha driver. Well maybe it deserves a post of its own, to find out more about the advantages when using their package types"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1544563357, "creation_date": 1544563357, "answer_id": 53732541, "question_id": 53732328, "link": "https://stackoverflow.com/questions/53732328/mongodb-in-go-in-relation-to-json-and-bson/53732541#53732541", "title": "MongoDB in Go in relation to JSON and BSON", "body": "<blockquote>\n  <ol>\n  <li>Should I avoid the BSON import?</li>\n  </ol>\n</blockquote>\n\n<p>I see no reason to do so. MongoDB (through <code>mgo</code>) and BSON walk hand-in-hand. It doesn't matter if you import <code>bson</code> or not, <code>bson</code> will still be used under the hood (to serialize / represent the data sent back and forth).</p>\n\n<blockquote>\n  <ol start=\"2\">\n  <li>Can I query for all matching patterns wtihout using BSON or specifying the entire interface?</li>\n  </ol>\n</blockquote>\n\n<p>Yes, you can, if you use the <code>omitempty</code> option when specifying the <code>\"bson\"</code> tags, like this:</p>\n\n<pre><code>type Person struct {\n    Name  string `bson:\"name,omitempty\"`\n    Phone string `bson:\"phone,omitempty\"`\n}\n</code></pre>\n\n<p>Now if you do a query like this:</p>\n\n<pre><code>err = c.Find(Person{\n    Name: \"Alice\",\n}).All(&amp;result)\n</code></pre>\n\n<p>Then when the filter value is marshalled into BSON, it will only contain a <code>\"name\"</code> field, because <code>Phone</code> is its zero value, so it will not be marshaled.</p>\n\n<p>Of course using <code>omitempty</code> may not be what you want when you do insert / update, so using a single type for representing and querying persons may not be sufficient. Generally, you should \"tag\" <code>Person</code> how you want to represent your data, and you should use simple <code>bson.M</code> values to query, or create another struct that models how you want to query.</p>\n\n<blockquote>\n  <ol start=\"3\">\n  <li>Should I specify BOTH JSON and BSON keys like in <code>json:\"name\"</code> or are they interchangeable?</li>\n  </ol>\n</blockquote>\n\n<p>They are not interchangeable, so if you only specify <code>json</code> tags, those are not used (ignored) by the <code>bson</code> package, and similarly, if you only specify <code>bson</code> tags, the <code>encoding/json</code> package of the standard library will not use those. They are 2 different tags, used for 2 different purposes, used by 2 different libraries (packages).</p>\n\n<p>You may or may not specify both. If you never intend to serialize your data into JSON, you don't have to specify <code>json</code> tags.</p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1544568806, "last_edit_date": 1544568806, "creation_date": 1544563368, "answer_id": 53732543, "question_id": 53732328, "link": "https://stackoverflow.com/questions/53732328/mongodb-in-go-in-relation-to-json-and-bson/53732543#53732543", "title": "MongoDB in Go in relation to JSON and BSON", "body": "<p>The mgo/bson package is used to encode and decode all database commands and results, even when the application does not use the package directly.</p>\n\n<p>The composite literal <code>Person{ Name: \"Alice\" }</code> returns a <code>Person</code> value with the <code>Phone</code> field set to <code>\"\"</code>.  The BSON encoder encodes this value to what is logically the value <code>{\"Name\": \"Alice\", \"Phone\": \"\"}</code>.  A query with this value returns all documents with Name equal \"Alice\" AND Phone equal to \"\".  Apparently there are no documents that match this query in the collection.</p>\n\n<p>The query document must have a Name field only to query all documents with Name equal \"Alice\" and Phone with any value or not set at all.</p>\n\n<blockquote>\n  <p>Should I avoid the BSON import?</p>\n</blockquote>\n\n<p>No, use the bson package directly when it's helpful.</p>\n\n<blockquote>\n  <p>Can I query for all matching patterns without using BSON or specifying the entire interface?</p>\n</blockquote>\n\n<p>The <code>bson.M</code> type is usually the best way to construct queries, but you can do it without it.  For example, you can query for all documents with name \"Alice\" like this:</p>\n\n<pre><code>c.Find(struct { Name string }{Name: \"Alice\"}).All(&amp;result)\n</code></pre>\n\n<p>You can also use <code>map[string]interface{}</code>:</p>\n\n<pre><code>c.Find(map[string]interface{}{\"Name\": \"Alice\"}).All(&amp;result)\n</code></pre>\n\n<p>Finally, you can use the BSON encoder's \"omitempty\" feature to omit empty fields from the encoded value.  I do not recommend this approach because it prevents you from querying for documents where the field is equal to \"\". Change the struct type to the following for this approach:</p>\n\n<pre><code>type Person struct {\n    Name  string `bson:\",omitempty\"`\n    Phone string `bson:\",omitempty\"`\n}\n</code></pre>\n\n<blockquote>\n  <p>Should I specify BOTH JSON and BSON keys like in json:\"name\" or are they interchangeable?</p>\n</blockquote>\n\n<p>They are not interchangeable. Specify the tags as needed for the BSON encoder and the JSON encoder.</p>\n"}], "owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1140, "favorite_count": 0, "accepted_answer_id": 53732543, "answer_count": 2, "score": 4, "last_activity_date": 1544607589, "creation_date": 1544562319, "last_edit_date": 1544607589, "question_id": 53732328, "link": "https://stackoverflow.com/questions/53732328/mongodb-in-go-in-relation-to-json-and-bson", "title": "MongoDB in Go in relation to JSON and BSON", "body": "<p>I'm learning how to use the community maintained <code>mgo</code> repo linked <a href=\"https://github.com/globalsign/mgo\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>I've discovered through this <a href=\"https://gist.github.com/border/3489566\" rel=\"nofollow noreferrer\">example</a> that the way to query for some pieces of data seems to be done through BSON (The community maintained version of the BSON library is linked <a href=\"https://godoc.org/github.com/globalsign/mgo/bson\" rel=\"nofollow noreferrer\">here</a>):</p>\n\n<pre><code>type Person struct {\n    Name      string\n    Phone     string\n}\n\nc.Find(bson.M{\"name\": \"Alice\"}).All(&amp;result)\n</code></pre>\n\n<p>Which will give me all <code>Person</code> with name <code>Alice</code>.</p>\n\n<p>I have also discovered that I don't need BSON to do this query. <code>Find()</code> takes any interface:</p>\n\n<pre><code>c.Find(Person{\n    Name: \"Alice\",\n    Phone: \"1234\",\n}).All(&amp;result)\n</code></pre>\n\n<p>Will also work, but only returning the specified exact query. If I leave out piece of the struct like this:</p>\n\n<pre><code>c.Find(Person{\n    Name: \"Alice\",\n}).All(&amp;result)\n</code></pre>\n\n<p><code>result</code> will be empty.</p>\n\n<hr>\n\n<p>It seems to me that avoiding BSON is more intuitive and simpler. So my questions are:</p>\n\n<ol>\n<li>Should I avoid the BSON import?</li>\n<li>Can I query for all matching patterns without using BSON or specifying the entire interface?</li>\n<li>Should I specify BOTH JSON and BSON keys like in <code>json:\"name\"</code> or\nare they interchangeable?</li>\n</ol>\n"}, {"tags": ["algorithm", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1544556589, "post_id": 53731049, "comment_id": 94315828, "body": "Improve in what way? What specifically are your concerns with this code? As written this post seems better suited to <a href=\"https://codereview.stackexchange.com/\">codereview.stackexchange.com</a> than SO."}, {"owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544556715, "post_id": 53731049, "comment_id": 94315883, "body": "I&#39;m unsure of how to futureproof it without hardcoding. For example I am basically doing an if statement where I say &quot;if number is 100 to 1000 then add 100 to the first digit of your number and set the rest to zero&quot;, &quot;if between 1000 and 10000....&quot;"}, {"owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544556720, "post_id": 53731049, "comment_id": 94315888, "body": "If that makes sense?"}, {"owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544556845, "post_id": 53731049, "comment_id": 94315938, "body": "Man, I just cannot seem to ask positive rep questions"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1544557155, "post_id": 53731049, "comment_id": 94316080, "body": "You could probably work something out with a loop using <code>for i = 10; ; i = i * 10</code> to iterate in orders of magnitude. You also probably want to familiarize yourself with the modulo operator <code>%</code>, as doing all this numeric logic using strings is probably sub-optimal."}, {"owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544557515, "post_id": 53731049, "comment_id": 94316276, "body": "That seems like a much smarter way of handling it, thanks a lot - I don&#39;t think the string manipulation is clever either, but I couldn&#39;t think of another way at the time"}], "answers": [{"comments": [{"owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "edited": false, "score": 0, "creation_date": 1544558012, "post_id": 53731330, "comment_id": 94316496, "body": "If I can transfer what you&#39;ve done into Go easily, then yeah... what a mess I created!"}, {"owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "edited": false, "score": 0, "creation_date": 1544558389, "post_id": 53731330, "comment_id": 94316675, "body": "Edited my answer to the Go version of what you have, thanks a lot :)"}], "tags": [], "owner": {"reputation": 36328, "user_id": 5483526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec50563f80bacd2a7fed69bd31d0c810?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Timmermans", "link": "https://stackoverflow.com/users/5483526/matt-timmermans"}, "is_accepted": true, "score": 1, "last_activity_date": 1544557686, "creation_date": 1544557686, "answer_id": 53731330, "question_id": 53731049, "link": "https://stackoverflow.com/questions/53731049/how-to-improve-my-function-that-rounds-floats-to-nearest-10-if-2-digit-number-1/53731330#53731330", "title": "How to improve my function that rounds floats to nearest 10 if 2 digit number, 100 if 3 digit number etc", "body": "<p>Wow, that's a pretty complicated procedure you have.  This is how I would do it if the numbers aren't enormous.  I don't know go, so I'm going to guess about how to write it in that language:</p>\n\n<pre><code>func getMaxYAxisValueForChart(float float64) {\n\n    place := 1.0;\n    while float &gt;= place*10.0 {\n        place *= 10.0;\n    }\n    return math.Ceil(float/place) * place;\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1544558793, "post_id": 53731419, "comment_id": 94316855, "body": "...yes there is :)"}], "tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 1, "last_activity_date": 1544558748, "last_edit_date": 1544558748, "creation_date": 1544558074, "answer_id": 53731419, "question_id": 53731049, "link": "https://stackoverflow.com/questions/53731049/how-to-improve-my-function-that-rounds-floats-to-nearest-10-if-2-digit-number-1/53731419#53731419", "title": "How to improve my function that rounds floats to nearest 10 if 2 digit number, 100 if 3 digit number etc", "body": "<p>Take the length of the string and calculate that 10 to the power of that length</p>\n\n<p>Or...better take the Log base 10, get the integer part, add 1 and then return that to the power of 10 :)</p>\n\n<pre><code>    import (\n        \"fmt\"\n        \"math\"\n    )\n\n    //func PowerScale(x int) int64{\n    //   return int64(math.Pow(10,float64(len((fmt.Sprintf(\"%d\",x))))))\n    //}\n\n    func PowerScale(x int) int64 {\n     return int64(math.Pow(10,float64(int(math.Log10(float64(x))+1))))\n}\n\n    func main() {\n        fmt.Println(PowerScale(829))\n        fmt.Println(PowerScale(7))\n    }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1544559642, "post_id": 53731532, "comment_id": 94317264, "body": "snap.   I am wondering if there is some &quot;print the number, count the digits&quot; that is faster than doing Logs.  Not sure ICBA benchmarking it though.  Doing it this way is more elegant"}, {"owner": {"reputation": 36328, "user_id": 5483526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec50563f80bacd2a7fed69bd31d0c810?s=128&d=identicon&r=PG&f=1", "display_name": "Matt Timmermans", "link": "https://stackoverflow.com/users/5483526/matt-timmermans"}, "edited": false, "score": 0, "creation_date": 1544559726, "post_id": 53731532, "comment_id": 94317298, "body": "Hmm... I think this actually always works OK (neglecting the overflow), but it could use a comment explaining why the result is valid even when the log is rounded up, because <code>Log10</code> returns a float result that is greater than the exact value."}], "tags": [], "owner": {"reputation": 35626, "user_id": 224370, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/CPH4K.jpg?s=128&g=1", "display_name": "Ian Mercer", "link": "https://stackoverflow.com/users/224370/ian-mercer"}, "is_accepted": false, "score": 1, "last_activity_date": 1544558488, "creation_date": 1544558488, "answer_id": 53731532, "question_id": 53731049, "link": "https://stackoverflow.com/questions/53731049/how-to-improve-my-function-that-rounds-floats-to-nearest-10-if-2-digit-number-1/53731532#53731532", "title": "How to improve my function that rounds floats to nearest 10 if 2 digit number, 100 if 3 digit number etc", "body": "<p>You can get the magnitude of a number using Math.Log10</p>\n\n<pre><code>int magnitude = (int)Math.Pow(10, (int)Math.Log10(value));\n</code></pre>\n\n<p>Use that to divide the number down, calculate ceiling and then scale it back up. </p>\n\n<p><em>No strings, no while loops.</em> </p>\n"}, {"tags": [], "owner": {"reputation": 16399, "user_id": 4016285, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/SvSVV.png?s=128&g=1", "display_name": "B. M.", "link": "https://stackoverflow.com/users/4016285/b-m"}, "is_accepted": false, "score": 1, "last_activity_date": 1544564587, "last_edit_date": 1544564587, "creation_date": 1544564068, "answer_id": 53732667, "question_id": 53731049, "link": "https://stackoverflow.com/questions/53731049/how-to-improve-my-function-that-rounds-floats-to-nearest-10-if-2-digit-number-1/53732667#53732667", "title": "How to improve my function that rounds floats to nearest 10 if 2 digit number, 100 if 3 digit number etc", "body": "<p>Since 829 is an int, or can be cast to, a pure integer solution :</p>\n\n<pre><code>func getMaxYAxisValueForChart(int int64) {\n    base := 10;\n    while int &gt; base*10 {\n        base := 10 * base; \n    }\n    return int + (base - int) % base;\n}\n</code></pre>\n"}], "owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 53731330, "answer_count": 4, "score": 0, "last_activity_date": 1544564587, "creation_date": 1544556470, "last_edit_date": 1544558355, "question_id": 53731049, "link": "https://stackoverflow.com/questions/53731049/how-to-improve-my-function-that-rounds-floats-to-nearest-10-if-2-digit-number-1", "title": "How to improve my function that rounds floats to nearest 10 if 2 digit number, 100 if 3 digit number etc", "body": "<p>I am drawing bar charts and i've come across a tricky problem. How to programmatically set the max value for the y axis label depending on the max value for a given series. So if you had a bar with a value of 7, you might want the y axis to go up to 10</p>\n\n<p>My approach is not ideal but works like this:</p>\n\n<ul>\n<li>Get a number to round, like 829</li>\n<li>Count the number of digits (3)</li>\n<li>Use a loop to convert to a string of 0s (\"000\")</li>\n<li>Add a 1 to the start of the string then convert to a float (1000)</li>\n<li>Find the difference (1000 - 829 = 171)</li>\n<li>Get the first digit of the difference (1) and then add that to the first digit of the float, with the remaining set to zero (\"900\"), then convert to a number (900)</li>\n</ul>\n\n<p>This means that 725 will see a y axis max label number of 800, and 829 of 900</p>\n\n<p>My code works, but I feel like it's a piece of crap with a hacky approach</p>\n\n<p>I have to code for big numbers. For example, if the float I want to find the max value for is >10000 then take the first two digits, and add 1000 to it. If >100,000 add 10,000</p>\n\n<p><strong>How can I improve here? I'm a little stuck, is my idea of converting to strings even right?!</strong></p>\n\n<p>Full code here:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n\n    myFloat := 899175.0\n\n    x := getMaxYAxisValueForChart(myFloat)\n    fmt.Println(\"The number to find the maximum value for is: \", myFloat)\n    fmt.Println(\"This should be the max value for the y axis: \", x)\n}\n\nfunc getMaxYAxisValueForChart(float float64) (YAxisMaximum float64) {\n    //Convert to string with no decimals\n    floatAsString := fmt.Sprintf(\"%.f\", float)\n\n    //Get length of the string float\n    floatAsStringLength := len(floatAsString)\n\n    //For each digit in the string, make a zero-string\n    stringPowerTen := \"0\"\n    for i := 1; i &lt; floatAsStringLength; i++ {\n        stringPowerTen += \"0\"\n    }\n\n    //Add a 1 to the 0 string to get the difference from the float\n    stringPowerTenWithOne := \"1\" + stringPowerTen\n\n    //Convert the number string to a float\n    convertStringPowerTenToFloat := ConvertStringsToFloat(stringPowerTenWithOne)\n\n    //Get the difference from the denominator from the numerator\n    difference := convertStringPowerTenToFloat - float\n\n    //We want to isolate the first digit to check how far the float is (100 is far from 1000) and then correct if so\n    floatAsStringDifference := fmt.Sprintf(\"%.f\", difference)\n    runes := []rune(floatAsStringDifference)\n    floatAsStringDifferenceFirstDigit := string(runes[0])\n\n    //For the denominator we want to take away the difference that is rounded to the nearest ten, hundred etc\n    runes = []rune(stringPowerTen)\n    differenceLastDigitsAsString := \"\"\n    if difference &lt; 10 {\n        differenceLastDigitsAsString = \"1\"\n    } else if difference &lt; 30 &amp;&amp; difference &lt; 100 {\n        differenceLastDigitsAsString = \"0\"\n    } else {\n        differenceLastDigitsAsString = floatAsStringDifferenceFirstDigit + string(runes[1:])\n    }\n\n    //Convert the number difference string from total to a float\n    convertDifferenceStringPowerTenToFloat := ConvertStringsToFloat(differenceLastDigitsAsString)\n\n    YAxisMaximum = convertStringPowerTenToFloat - convertDifferenceStringPowerTenToFloat\n\n    //If float is less than 10,0000\n    if float &lt; 10000 &amp;&amp; (YAxisMaximum-float &gt;= 500) {\n        YAxisMaximum = YAxisMaximum - 500\n    }\n\n    if float &lt; 10000 &amp;&amp; (YAxisMaximum-float &lt; 500) {\n        YAxisMaximum = YAxisMaximum\n    }\n\n    //If number bigger than 10,000 then get the nearest 1,000\n    if float &gt; 10000 {\n\n        runes = []rune(floatAsString)\n        floatAsString = string(runes[0:2])\n        runes = []rune(stringPowerTen)\n        stringPowerTen = string(runes[2:])\n        runes = []rune(stringPowerTenWithOne)\n        stringPowerTenWithOne = string(runes[0:(len(stringPowerTenWithOne) - 2)])\n\n        YAxisMaximum = ConvertStringsToFloat(floatAsString+stringPowerTen) + ConvertStringsToFloat(stringPowerTenWithOne)\n    }\n\n    if float &gt; 10000 {\n\n        runes = []rune(floatAsString)\n        floatAsString = string(runes[0:2])\n        runes = []rune(stringPowerTen)\n        stringPowerTen = string(runes[:])\n        runes = []rune(stringPowerTenWithOne)\n        stringPowerTenWithOne = string(runes[0:(len(stringPowerTenWithOne))])\n\n        YAxisMaximum = ConvertStringsToFloat(floatAsString+stringPowerTen) + ConvertStringsToFloat(stringPowerTenWithOne)\n    }\n\n    return YAxisMaximum\n}\n\nfunc ConvertStringsToFloat(stringToConvert string) (floatOutput float64) {\n    floatOutput, Error := strconv.ParseFloat(stringToConvert, 64)\n    if Error != nil {\n        fmt.Println(Error)\n    }\n\n    return floatOutput\n}\n</code></pre>\n\n<hr>\n\n<p><strong>Here is the solution based off of Matt Timmermans answer, but converted to work in Go:</strong></p>\n\n<pre><code>func testing(float float64) (YAxisMaximum float64) {\n    place := 1.0\n    for float &gt;= place*10.0 {\n        place *= 10.0\n    }\n    return math.Ceil(float/place) * place\n}\n</code></pre>\n"}, {"tags": ["php", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1544554278, "post_id": 53730375, "comment_id": 94314772, "body": "You shouldn&#39;t be putting your env variables in <code>.bashrc</code>, use the profile files. I&#39;m not familiar with how PHP calls exec, but you should be familiar with how and where the shell gets it&#39;s environment. Read the <code>INVOCATION</code> section in the bash man page."}, {"owner": {"reputation": 142, "user_id": 6608470, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o080o.jpg?s=128&g=1", "display_name": "Cleiton Oliveira", "link": "https://stackoverflow.com/users/6608470/cleiton-oliveira"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1544555331, "post_id": 53730375, "comment_id": 94315267, "body": "Change it to ~/.profile is enough? I&#39;m reading it but apply and understand everything necessary to that takes time. Also, that could help me or it&#39;s off-topic?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1544559400, "post_id": 53730375, "comment_id": 94317145, "body": "If you are using shell_exec you can just set GOPATH right there: <code>shell_exec(&#39;GOPATH=&#47;var&#47;www go get ...&#39;)</code>. However, you should really just compile your Go program once (with <code>go build</code> or <code>go install</code>) and then execute <i>that</i> instead of go."}, {"owner": {"reputation": 142, "user_id": 6608470, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o080o.jpg?s=128&g=1", "display_name": "Cleiton Oliveira", "link": "https://stackoverflow.com/users/6608470/cleiton-oliveira"}, "edited": false, "score": 0, "creation_date": 1544604475, "post_id": 53730375, "comment_id": 94330813, "body": "That&#39;s true, completely forgot go is compiled. I&#39;ll try it."}, {"owner": {"reputation": 142, "user_id": 6608470, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o080o.jpg?s=128&g=1", "display_name": "Cleiton Oliveira", "link": "https://stackoverflow.com/users/6608470/cleiton-oliveira"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1544631966, "post_id": 53730375, "comment_id": 94347081, "body": "Problem solved. thank you guys. @Peter you want to make an answer?"}], "owner": {"reputation": 142, "user_id": 6608470, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/o080o.jpg?s=128&g=1", "display_name": "Cleiton Oliveira", "link": "https://stackoverflow.com/users/6608470/cleiton-oliveira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1544553350, "creation_date": 1544553350, "question_id": 53730375, "link": "https://stackoverflow.com/questions/53730375/calling-go-using-phps-shell-exec-is-changing-gopath", "title": "Calling Go using PHP&#39;s shell_exec is changing GOPATH", "body": "<p>I have a Go app that must run from a PHP script with <code>shell_exec()</code>/<code>exec()</code>. The problem is when I call the Go script that way, the GOPATH changes or can't be found, and the imports from <code>go get</code> can't be found too. Everything is fine when I call it manually on terminal.</p>\n\n<p>Trying to solve it, the GOPATH was set to <code>/var/www</code> on .bashrc and updated with <code>source ~/.bashrc</code>), but when I use <code>go env</code> under apache's user (www-data), the folders act like the Apache user can't read the environment variables and read the default values but the root folder from Go's view is <code>/var/www</code>, not <code>/</code>.</p>\n\n<p>How can I make apache/PHP run Go properly?</p>\n"}, {"tags": ["go", "amazon-s3"], "comments": [{"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 1, "creation_date": 1544557119, "post_id": 53729538, "comment_id": 94316063, "body": "I started to figure this out and quickly found the duplicate answer above by seeing that the Download method wanted a io.WriterAt as a first parameter, then googling for it"}, {"owner": {"reputation": 74, "user_id": 3357984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7263d56135694c5f1f362759782f3b1?s=128&d=identicon&r=PG&f=1", "display_name": "not_fubar_yet", "link": "https://stackoverflow.com/users/3357984/not-fubar-yet"}, "reply_to_user": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1544560935, "post_id": 53729538, "comment_id": 94317866, "body": "thanks! i really did try to google it but failed to use &quot;buffer&quot;.  my searches &quot;golang aws download to struct, not file&quot; or variants didnt show up this. i consider myself a novice and dont know the proper terms yet."}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1544560997, "post_id": 53729538, "comment_id": 94317883, "body": "The AWS documentation is very good and is a great place to take a look if you are stuck"}, {"owner": {"reputation": 74, "user_id": 3357984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7263d56135694c5f1f362759782f3b1?s=128&d=identicon&r=PG&f=1", "display_name": "not_fubar_yet", "link": "https://stackoverflow.com/users/3357984/not-fubar-yet"}, "reply_to_user": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1544576118, "post_id": 53729538, "comment_id": 94322715, "body": "@vorsprung. yup aws docs generally are great. thats where i started. i even linked it in the 1st place, but I was too dumb to implement that buffer you showed me, which isnt in aws docs."}], "answers": [{"comments": [{"owner": {"reputation": 74, "user_id": 3357984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7263d56135694c5f1f362759782f3b1?s=128&d=identicon&r=PG&f=1", "display_name": "not_fubar_yet", "link": "https://stackoverflow.com/users/3357984/not-fubar-yet"}, "edited": false, "score": 0, "creation_date": 1544552980, "post_id": 53729618, "comment_id": 94314185, "body": "thanks. i dont have a problem with json marshalling... my problem is the s3 download function seems to require that i create an in app file. Is there a way to skip that and download straight to my struct?"}], "tags": [], "owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "is_accepted": false, "score": 0, "last_activity_date": 1544550346, "creation_date": 1544550346, "answer_id": 53729618, "question_id": 53729538, "link": "https://stackoverflow.com/questions/53729538/aws-s3-download-file-into-struct-golang/53729618#53729618", "title": "aws s3 download file into struct golang", "body": "<p>It looks like golang does have a pickle equivalent so to speak, <a href=\"https://golang.org/pkg/encoding/gob/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/gob/</a>.  </p>\n\n<p>But I'd use JSON to do this if at all possible.  You can unmarshal the json into your struct pretty easily (<a href=\"https://gist.github.com/dmikalova/5693142\" rel=\"nofollow noreferrer\">https://gist.github.com/dmikalova/5693142</a> for example).  More importantly, by choosing a more generic storage format, you'll be able to read the files from any language and your data will be distinct from your in-application model, which is a very friendly approach for cloud or micro- services.  </p>\n"}], "owner": {"reputation": 74, "user_id": 3357984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7263d56135694c5f1f362759782f3b1?s=128&d=identicon&r=PG&f=1", "display_name": "not_fubar_yet", "link": "https://stackoverflow.com/users/3357984/not-fubar-yet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1628, "favorite_count": 0, "closed_date": 1544560845, "answer_count": 1, "score": -2, "last_activity_date": 1544550346, "creation_date": 1544550064, "question_id": 53729538, "link": "https://stackoverflow.com/questions/53729538/aws-s3-download-file-into-struct-golang", "closed_reason": "Duplicate", "title": "aws s3 download file into struct golang", "body": "<p>I have a json file on AWS s3. I want to download them into a struct, not into a file. is this possible? or a way to delete the file after i put the data into a struct? i dont want extra files generated in my application.</p>\n\n<p>I see the <a href=\"https://github.com/awsdocs/aws-doc-sdk-examples/blob/master/go/example_code/s3/s3_download_object.go\" rel=\"nofollow noreferrer\">go example AWS s3 provides here</a></p>\n\n<p>and reading the <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/s3manager/#Downloader.Download\" rel=\"nofollow noreferrer\">go aws s3 docs on the download func</a> it writes to io.WriterAt\n is \"io.writerAt\" only can be a file type?</p>\n\n<p>my problem is when i read S3 json files, and load my data into a struct, but it also ends up creating files in the application due to what i think io.writerAt must be a file type.</p>\n\n<p>heres my code that reads in the AWS s3 json file, creates a file(which i dont want), and loads it into struct to pass along the rest of the code.</p>\n\n<pre><code>sess, _ := session.NewSession(&amp;aws.Config{\n    Region: aws.String(c.AwsLocation),\n})\ndownloader := s3manager.NewDownloader(sess)\n\ndoc := \"myfile.json\" \n\nfile, err := os.Create(doc) //PROBLEM creates file.\n//todo err\ndefer file.Close()\n\nnumBytes, err := downloader.Download(file,\n    &amp;s3.GetObjectInput{\n        Bucket: aws.String(c.AwsBucket),\n        Key:    aws.String(doc),\n    })\n//todo err\nfmt.Println(\"Downloaded\", file.Name(), numBytes, \"bytes\")\n\n//take data, and put in struct\nbyteValue, _ := ioutil.ReadAll(file)\nvar output myStruct\njson.Unmarshal(byteValue, &amp;output)\nreturn output\n</code></pre>\n"}, {"tags": ["html", "go", "bootstrap-modal"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1544548314, "post_id": 53728976, "comment_id": 94311907, "body": "So when you open the modal, the rest of the page stops updating? Is that the problem?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1544549380, "post_id": 53728976, "comment_id": 94312435, "body": "Each generated modal has the same id <code>id=&quot;informatie&quot;</code> and each button has the same target <code>data-target=&quot;#informatie&quot;</code>. Bootstrap can&#39;t tell which one you want so it picks the first one."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1544549561, "post_id": 53728976, "comment_id": 94312520, "body": "... you can fix that by adding the index to the id. <a href=\"https://play.golang.com/p/tD-M95boBpl\" rel=\"nofollow noreferrer\">play.golang.com/p/tD-M95boBpl</a>"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1544549600, "post_id": 53728976, "comment_id": 94312546, "body": "Just a nit-pick, but why are the names of your fields English, bar the last one (<code>Ingredienten</code> =&gt; <code>Ingredients</code>). Might not seem like a big deal, but consistency matters, whether it be code-style, naming, or whatever... Also check the golang code review pages. Constants are <code>CamelCased</code>, for example. And oh yes, never add a static id within a loop in your templates. ID&#39;s are unique"}], "owner": {"reputation": 27, "user_id": 10352020, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a392ebff53d4ebfefab59a34e89369a?s=128&d=identicon&r=PG&f=1", "display_name": "Wobelaar", "link": "https://stackoverflow.com/users/10352020/wobelaar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1544548276, "creation_date": 1544547839, "last_edit_date": 1544548276, "question_id": 53728976, "link": "https://stackoverflow.com/questions/53728976/using-a-modals-causes-my-range-to-reset", "title": "Using a modals causes my &#39;range&#39; to reset", "body": "<p>We are working on a school project which consists of making a pizza application. The page where all the pizzas are shown is loading the pizzas from a json file. The json file is loaded through Go and ranged in HTML. However, since I wanted to make it a bit fancier I thought it would be nice to add some modals with information about the ingredients in the pizzas. When opening a modal the range stops ranging though. So it just loads the ingredients for the first pizza and shows it at all of them.</p>\n\n<p>This is my HTML code:</p>\n\n<pre><code>    &lt;html&gt;\n    &lt;head&gt;\n        &lt;title&gt;Pizza House - De lijst met pizza's&lt;/title&gt;\n        &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;\n        &lt;link href=\"../html/main.css\" rel=\"stylesheet\" type=\"text/css\" /&gt;\n        &lt;link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css\" integrity=\"sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO\" crossorigin=\"anonymous\"&gt;\n        &lt;script src=\"https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js\"&gt;&lt;/script&gt;\n        &lt;script src=\"https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js\"&gt;&lt;/script&gt;\n        &lt;script src=\"https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js\"&gt;&lt;/script&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;div&gt;\n            &lt;img src=\"../images/pizzahouse.png\" height=\"100px\" style=\"vertical-align:middle\"&gt; &lt;span class=\"title\"&gt;Pizza House - Voor de lekkerste pizza's&lt;/span&gt;\n        &lt;/div&gt;\n        &lt;div class=\"row\"&gt;\n        &lt;h1&gt;De lijst met pizza's&lt;/h1&gt;\n            {{range .}}\n                &lt;div class=\"col-sm-3\"&gt;\n                    &lt;img src=\"{{.Image}}\"/&gt;\n                    &lt;p&gt;{{.Name}}&lt;span&gt;{{.Price | printf \"%.2f\"}}&lt;/span&gt;&lt;/p&gt;\n                    &lt;button type=\"button\" class=\"btn btn-primary\" data-toggle=\"modal\" data-target=\"#informatie\"&gt;\n                        i\n                    &lt;/button&gt;\n\n                    &lt;div class=\"modal fade\" id=\"informatie\"&gt;\n                        &lt;div class=\"modal-dialog\"&gt;\n                            &lt;div class=\"modal-content\"&gt;\n                                &lt;div class=\"modal-header\"&gt;\n                                    &lt;h3&gt;Titel&lt;/h3&gt;\n                                &lt;/div&gt;\n                                &lt;div class=\"modal-body\"&gt;\n                                    &lt;p&gt;&lt;span&gt;{{.Ingredienten}}&lt;/p&gt;\n                                &lt;/div&gt;\n                                &lt;div class=\"modal-footer\"&gt;\n                                    &lt;button type=\"button\" class=\"btn btn-default\" data-dismiss=\"modal\"&gt;terug&lt;/button&gt;\n                                &lt;/div&gt;\n                            &lt;/div&gt;\n                        &lt;/div&gt;\n                    &lt;/div&gt;\n                &lt;/div&gt;\n            {{end}}\n            &lt;div class=\"col-sm-3\"&gt;\n                &lt;img src=\"../images/custompizza.png\"/&gt;\n                &lt;a href=\"../view/custompizza\"&gt;Custom pizza&lt;/a&gt;\n            &lt;/div&gt;\n        &lt;/div&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>Here is the go part which affects it:</p>\n\n<pre><code>const (\n    CUSTOMERFILE = \"./data/customers.json\"\n    PIZZAFILE    = \"./data/pizzas.json\"\n    ORDERFILE    = \"./data/orders.json\"\n    INGREDIENTFILE    = \"./data/ingredients.json\"\n)\n\nfunc loadData(f string, vv interface{}) error {\n    raw, err := ioutil.ReadFile(f)\n    if err != nil {\n        return err\n    }\n    err = json.Unmarshal(raw, &amp;vv)\n    if err != nil {\n        return err\n    }\n    return nil\n}\nfunc GetPizza(name string) (Pizza, error) {\n    pp, _ := LoadPizzas()\n    for _, p := range pp {\n        if p.Name == name {\n            return p, nil\n        }\n    }\n    return Pizza{}, errors.New(\"pizza not found\")\n}\n\nfunc LoadPizzas() ([]Pizza, error) {\n    var pp []Pizza\n    err := loadData(PIZZAFILE, &amp;pp)\n\n    return pp, err\n}\n</code></pre>\n\n<p>And here is the the piece of the types file it uses as reference:</p>\n\n<pre><code>type Pizza struct {\n    Name         string  `json:\"name\"`\n    Price        float32 `json:\"price\"`\n    Image        string  `json:\"image\"`\n    Ingredienten string  `json:\"ingredienten\"`\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1544547602, "post_id": 53728896, "comment_id": 94311539, "body": "There is no automatic way to do this. You&#39;ll have to keep track of which files you have open in write mode, and exclude them."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1544547835, "post_id": 53728896, "comment_id": 94311661, "body": "BTW, there&#39;s never any reason to use <code>continue</code> (or anything else) after <code>log.Fatal</code>, because <code>log.Fatal</code> causes the program to exit."}, {"owner": {"reputation": 31, "user_id": 10774390, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UzP_njWJnpM/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-hR6KbjXRyXdQwa6DbdicQBj7rF2w/mo/photo.jpg?sz=128", "display_name": "kshirol", "link": "https://stackoverflow.com/users/10774390/kshirol"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1544549159, "post_id": 53728896, "comment_id": 94312311, "body": "Its a oversight.    Regarding the file in write mode, what happens if the file writer is a seperate go application ? I guess I am trying to find if there is any way we can know that fact."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1544559659, "post_id": 53728896, "comment_id": 94317269, "body": "Moving files into the directory after they are completely written isn&#39;t an option?"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1544564987, "post_id": 53728896, "comment_id": 94319566, "body": "Most software seems to use a temporary upload directory. Or names the files something with &quot;.part&quot; or &quot;.partial&quot; on the end. In both cases the file is renamed when it is complete. Otherwise, other software has no way to know if the file is completely uploaded or not."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1544597716, "post_id": 53728896, "comment_id": 94327896, "body": "If the writer is a separate application, the problem is the same, and the solution will just require some sort of inter-process communication."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 10774390, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UzP_njWJnpM/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-hR6KbjXRyXdQwa6DbdicQBj7rF2w/mo/photo.jpg?sz=128", "display_name": "kshirol", "link": "https://stackoverflow.com/users/10774390/kshirol"}, "edited": false, "score": 0, "creation_date": 1544562683, "post_id": 53729423, "comment_id": 94318612, "body": "Thanks for the answer. It is really helpful"}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 0, "last_activity_date": 1544556039, "last_edit_date": 1544556039, "creation_date": 1544549610, "answer_id": 53729423, "question_id": 53728896, "link": "https://stackoverflow.com/questions/53728896/how-do-i-print-the-contents-of-a-files-in-a-directory-but-ignore-files-which-are/53729423#53729423", "title": "How do I print the contents of a files in a directory but ignore files which are opened in write mode?", "body": "<p>That is not how it's done.</p>\n\n<p>Off the top of my head I can think of these options:</p>\n\n<ul>\n<li><p>If both goroutines are working in the same program,\nthere is little problem: make the \"producer\" goroutine register\nthe names of the files it <em>has completed</em> modifying into some\nregistry, and make the \"consumer\" goroutine read (and delete)\nfrom that registry.</p>\n\n<p>In the simplest case that could be a buffered channel.</p>\n\n<p>If the producer works much faster than the consumer,\nand you don't want to block the former for some reason\nthen a slice protected by a mutex would fit the bill.</p></li>\n<li><p>If the goroutines work in different processes on the same\nmachine but you control both programs, make the producer\nprocess communicate the same data to the consumer process\nvia any suitable sort of IPC.</p>\n\n<p>What method to do IPC is better depends on how the\nprocesses start up, interact etc.</p>\n\n<p>There is a wide variety of options.</p></li>\n<li><p>If you control both processes but do not want to mess with\nIPC between them (there are reasons, too), then make the producer\nfollow best practices on how to write a file\n(more on this in a moment), and make the consumer use any\nfilesystem-monitoring facility to report which files get created (\"appear\") once produced by the producer.\nYou may start with <a href=\"https://github.com/fsnotify/fsnotify\" rel=\"nofollow noreferrer\"><code>github.com/fsnotify/fsnotify</code></a>.</p>\n\n<p>To properly write a file, the producer have to write its\ndata to a temporary file\u2014that is, a file located in the same\ndirectory but having a filename which is well understood to\nindicate that the file is not done with yet\u2014for instance,\n\".foobar.data.part\" or \"foobar.data.276gd14054.tmp\" is OK for writing \"foobar.data\".\n(Other approaches exist but this one is good enough to\nstart with.)</p>\n\n<p>Once the file is ready, the producer have to rename the\nfile from its temporary name to its \"proper\", final name.\nThis operation is atomic on all sensible OSes/filesystems,\nand makes file atomically \"spring into existense\" from the PoV\nof the consumer. For instance, <a href=\"https://manpages.debian.org/7/inotify\" rel=\"nofollow noreferrer\"><code>inotify</code> on Linux generates\nan event of type \"moved to\" for such an appearance</a>.</p>\n\n<p>If you don't feel like doing the proper thing yourself, <a href=\"https://github.com/dchest/safefile\" rel=\"nofollow noreferrer\"><code>github.com/dchest/safefile</code></a> is a good cross-platform start.</p>\n\n<p>As you can see, with this approach you know\nthe file is done just from the fact it was reported\nto having appeared.</p></li>\n<li><p>If you do not control the producer, you may need to resort to\nguessing.</p>\n\n<p>The simpest is to, again, monitor the filesystem for\nevents\u2014but this time for \"file updated\" events, not \"file created\"\nevents. For each file reported as updated you had to remember\nthe timestamp of that event, and when certain amount of time passes, you may <em>declare</em> that the file is done by the producer.</p>\n\n<p>IMO this approach is the worst of all, but if you have no\nbetter options it's at least something.</p></li>\n</ul>\n"}], "owner": {"reputation": 31, "user_id": 10774390, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UzP_njWJnpM/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-hR6KbjXRyXdQwa6DbdicQBj7rF2w/mo/photo.jpg?sz=128", "display_name": "kshirol", "link": "https://stackoverflow.com/users/10774390/kshirol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 53729423, "answer_count": 1, "score": 0, "last_activity_date": 1544556039, "creation_date": 1544547534, "last_edit_date": 1544547577, "question_id": 53728896, "link": "https://stackoverflow.com/questions/53728896/how-do-i-print-the-contents-of-a-files-in-a-directory-but-ignore-files-which-are", "title": "How do I print the contents of a files in a directory but ignore files which are opened in write mode?", "body": "<p>I have a goroutine which periodically checks for new files in a directory and then prints the contents of the files. However there is another goroutine which creates a file, writes contents into it and then saves the file.</p>\n\n<p>How do I ignore the files which are open in WRITE mode in a directory?</p>\n\n<p>Sample Code:</p>\n\n<pre><code>for {\n fileList, err := ioutil.ReadDir(\"/uploadFiles\")\n  if err != nil {\n     log.Fatal(err)\n     continue\n  }\n\n for _, f := range fileList {\n      log.Println(\"File : \", f.Name())\n      go printContents(f.Name())\n }\n\n time.Sleep(time.Second * 5)\n}\n</code></pre>\n\n<p>In the printContents goroutine I want to ignore the files which are open in WRITE mode.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1544541938, "post_id": 53727185, "comment_id": 94308001, "body": "When you run <code>go install &amp;&amp; project-name -port 19000</code> on the shell, that&#39;s being parsed by the shell as two separate commands and a boolean response value check. <code>exec</code> does not run through a shell, so you must either pass your command to e.g. <code>bash -c</code> or do the logic yourself  within Go (checking the exit code of <code>go install</code> before running <code>program-name</code>.  Also note that your array is missing the program name."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544542139, "post_id": 53727185, "comment_id": 94308129, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/31467153/golang-failed-exec-command-that-works-in-terminal\">golang failed exec command that works in terminal</a>"}], "answers": [{"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 2, "last_activity_date": 1544545182, "creation_date": 1544545182, "answer_id": 53728257, "question_id": 53727185, "link": "https://stackoverflow.com/questions/53727185/how-to-pass-port-value-to-start-a-server-using-exec-and-syscall-packages-golang/53728257#53728257", "title": "How to pass port value to start a server using exec and syscall packages golang", "body": "<p>This does not work for two reasons</p>\n\n<pre><code>args := []string{\"go\", \"install\", \"&amp;&amp;\", \"-port\", \"18000\"}\n</code></pre>\n\n<p>First, \"project-name\" is missing.  I assume this is a simple typo.</p>\n\n<p>Second, syscall Exec does not use a shell to launch commands.  The <code>&amp;&amp;</code> construct and running multiple commands from one line are shell features</p>\n\n<p>To make syscall Exec do this you could call it, check the return value and then call it again with the second command</p>\n\n<p>Or you could use syscall Exec to launch a shell.  Below there is an example of \nlaunching a shell - (with os/exec, but this is very similar in this case) to run\ntwo commands with a <code>&amp;&amp;</code></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os/exec\"\n)\n\nfunc main() {\n    args := []string{\"-c\", \"touch a &amp;&amp; ls -l\"}\n    cmd := exec.Command(\"bash\", args...)\n    stuff, err := cmd.Output()\n    fmt.Printf(\"Command finished with error: %v\", err)\n    fmt.Printf(\"%s\", string(stuff))\n}\n</code></pre>\n"}], "owner": {"reputation": 109, "user_id": 8807669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6a0c06065758f0a6808250af10bc323?s=128&d=identicon&r=PG&f=1", "display_name": "Bharath Kuppala", "link": "https://stackoverflow.com/users/8807669/bharath-kuppala"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1544545182, "creation_date": 1544541650, "question_id": 53727185, "link": "https://stackoverflow.com/questions/53727185/how-to-pass-port-value-to-start-a-server-using-exec-and-syscall-packages-golang", "title": "How to pass port value to start a server using exec and syscall packages golang", "body": "<p>We are trying to implement a program in go which runs another go program from the specified path like</p>\n\n<pre><code>path, _ := exec.LookPath(\"program-name\")\n</code></pre>\n\n<p>Next we have given a set of go commands to run the go program like</p>\n\n<pre><code>args := []string{\"go\", \"install\", \"&amp;&amp;\", \"-port\", \"18000\"}\n</code></pre>\n\n<p>We passed both path and args along with <code>os.Environ()</code> to the syscall.Exec(). In order to run the project which we are calling has a check which tells us -port is required. As -port is not an executable command so it not taking the port value.</p>\n\n<p>The requirement is when we type go install &amp;&amp; project-name -port 19000 the program should run.</p>\n\n<p>The query is there any way to achieve this and how can we pass the port value to get the desired outcome.</p>\n"}, {"tags": ["image", "go", "metadata", "meta", "iptc"], "comments": [{"owner": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "edited": false, "score": 0, "creation_date": 1544544203, "post_id": 53726914, "comment_id": 94309522, "body": "I don&#39;t know about brew, but under Linux you would have to install both <code>libiptcdata</code> (which contains the actual library) and <code>libiptcdata-dev</code> (which contains the source code). Maybe that&#39;s the reason why the <code>iptc-data.h</code> file is not present?"}, {"owner": {"reputation": 13, "user_id": 10776395, "user_type": "registered", "profile_image": "https://graph.facebook.com/966884223522215/picture?type=large", "display_name": "Stephen", "link": "https://stackoverflow.com/users/10776395/stephen"}, "reply_to_user": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "edited": false, "score": 0, "creation_date": 1544550529, "post_id": 53726914, "comment_id": 94313038, "body": "yepp, file does not exist where the code looking for it if you check for example this: <a href=\"https://github.com/Melraidin/iptc\" rel=\"nofollow noreferrer\">github.com/Melraidin/iptc</a> there is how to install it with brew, and they do not say anything about the dev, BUT thank you, and I will start tomorrow with trying your suggestion."}, {"owner": {"reputation": 13, "user_id": 10776395, "user_type": "registered", "profile_image": "https://graph.facebook.com/966884223522215/picture?type=large", "display_name": "Stephen", "link": "https://stackoverflow.com/users/10776395/stephen"}, "reply_to_user": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "edited": false, "score": 0, "creation_date": 1544605997, "post_id": 53726914, "comment_id": 94331669, "body": "it was a part of the solution, but with, it still does not worked yet, now it is, will write how."}], "answers": [{"tags": [], "owner": {"reputation": 13, "user_id": 10776395, "user_type": "registered", "profile_image": "https://graph.facebook.com/966884223522215/picture?type=large", "display_name": "Stephen", "link": "https://stackoverflow.com/users/10776395/stephen"}, "is_accepted": false, "score": 0, "last_activity_date": 1544606129, "creation_date": 1544606129, "answer_id": 53739600, "question_id": 53726914, "link": "https://stackoverflow.com/questions/53726914/golang-image-iptc-metadata/53739600#53739600", "title": "Golang image iptc metadata", "body": "<p>First, I have removed the brew installed \"libiptcdata\" libary, than installed the following libaries:</p>\n\n<p>\"libiptcdata0\"\n\"libiptcdata0-dev\"\n\"python-iptcdata\"</p>\n\n<p>with these three, the \"go get\" is managed to run, and could continue working on the original problem...</p>\n"}], "owner": {"reputation": 13, "user_id": 10776395, "user_type": "registered", "profile_image": "https://graph.facebook.com/966884223522215/picture?type=large", "display_name": "Stephen", "link": "https://stackoverflow.com/users/10776395/stephen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 308, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1544606129, "creation_date": 1544540702, "question_id": 53726914, "link": "https://stackoverflow.com/questions/53726914/golang-image-iptc-metadata", "title": "Golang image iptc metadata", "body": "<p>I need to get the meta data, especially the iptc meta data from the uploaded files on the server.</p>\n\n<p>I have found two packages I can import, but both of them require the \"libiptcdata\" libary. It should not be a problem, but after I installed the libary with brew, as it is written on both of the packages page, and typed go get \"<a href=\"https://github.com/Melraidin/iptc\" rel=\"nofollow noreferrer\">https://github.com/Melraidin/iptc</a>\" (for example, one of the two packages I wanted to use), I got the following error:</p>\n\n<p><code>../../github.com/Melraidin/iptc/main.go:10:10: fatal error: libiptcdata/iptc-data.h: No such file or directory\n #include &lt;libiptcdata/iptc-data.h&gt;\n          ^~~~~~~~~~~~~~~~~~~~~~~~~\ncompilation terminated.</code></p>\n\n<p>The error is real, the file is really is not there, but how then it could work at anyone else? I found these 2 packages suggestion of using on a few page.</p>\n\n<p>Thank you for your help</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1461, "user_id": 1741753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a8f485be30960038f792beab9785ada?s=128&d=identicon&r=PG", "display_name": "John Corry", "link": "https://stackoverflow.com/users/1741753/john-corry"}, "edited": false, "score": 0, "creation_date": 1544539846, "post_id": 53726515, "comment_id": 94306622, "body": "I can&#39;t tell what you&#39;re trying to do, your method/variable names are confusing. It seems like you might want to store your input ints in a slice of ints. That would let you easily iterate over the slice to evaluate whether an incoming input is already present."}, {"owner": {"reputation": 45, "user_id": 10759999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83f6b5075ad3d56a96b2cf8c0ccbf58b?s=128&d=identicon&r=PG&f=1", "display_name": "C0d3r42", "link": "https://stackoverflow.com/users/10759999/c0d3r42"}, "reply_to_user": {"reputation": 1461, "user_id": 1741753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a8f485be30960038f792beab9785ada?s=128&d=identicon&r=PG", "display_name": "John Corry", "link": "https://stackoverflow.com/users/1741753/john-corry"}, "edited": false, "score": 0, "creation_date": 1544540083, "post_id": 53726515, "comment_id": 94306774, "body": "I was trying to use structs to get how they work. But I come from PHP and find it crazy that you cant loop over a struct? Unless I am wrong? Yes I have a var and want to see if any of the data within the struct matches that var. Basically want to loop over the struct and check the output with a var. But not sure that is possible?  Sorry for the confusion I am not very good at explaining myself."}, {"owner": {"reputation": 1461, "user_id": 1741753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a8f485be30960038f792beab9785ada?s=128&d=identicon&r=PG", "display_name": "John Corry", "link": "https://stackoverflow.com/users/1741753/john-corry"}, "edited": false, "score": 1, "creation_date": 1544540262, "post_id": 53726515, "comment_id": 94306895, "body": "I have a lot of PHP experience too. Think of structs as objects, slices as arrays. In PHP you&#39;d never loop over an object...nor is there a need to loop over structs in Go. I am thinking you might want to rethink your data structure."}, {"owner": {"reputation": 45, "user_id": 10759999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83f6b5075ad3d56a96b2cf8c0ccbf58b?s=128&d=identicon&r=PG&f=1", "display_name": "C0d3r42", "link": "https://stackoverflow.com/users/10759999/c0d3r42"}, "reply_to_user": {"reputation": 1461, "user_id": 1741753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a8f485be30960038f792beab9785ada?s=128&d=identicon&r=PG", "display_name": "John Corry", "link": "https://stackoverflow.com/users/1741753/john-corry"}, "edited": false, "score": 0, "creation_date": 1544540439, "post_id": 53726515, "comment_id": 94307022, "body": "Yeah I see your point - I was sort of seeing them as supped up array."}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 10759999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83f6b5075ad3d56a96b2cf8c0ccbf58b?s=128&d=identicon&r=PG&f=1", "display_name": "C0d3r42", "link": "https://stackoverflow.com/users/10759999/c0d3r42"}, "edited": false, "score": 0, "creation_date": 1544540233, "post_id": 53726692, "comment_id": 94306865, "body": "ok, so change it to use a slice rather than a struct? I don&#39;t understand while you can not loop over a struct, seems a little limited?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 45, "user_id": 10759999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83f6b5075ad3d56a96b2cf8c0ccbf58b?s=128&d=identicon&r=PG&f=1", "display_name": "C0d3r42", "link": "https://stackoverflow.com/users/10759999/c0d3r42"}, "edited": false, "score": 2, "creation_date": 1544540354, "post_id": 53726692, "comment_id": 94306959, "body": "You can&#39;t loop over a struct using <code>range</code> because a struct&#39;s fields can be different types. You could loop over it using reflection, but that would be extremely slow and overly complex. Your data structure is a numbered list of items which are all the same type; this is the exact use case for slices/arrays, so there is no reason to use a struct for this."}, {"owner": {"reputation": 45, "user_id": 10759999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83f6b5075ad3d56a96b2cf8c0ccbf58b?s=128&d=identicon&r=PG&f=1", "display_name": "C0d3r42", "link": "https://stackoverflow.com/users/10759999/c0d3r42"}, "edited": false, "score": 0, "creation_date": 1544540548, "post_id": 53726692, "comment_id": 94307091, "body": "ok thanks, that makes it clear. I knew your could not range over a struct but could not see why. But yeah I get it if they are all different data types there would be no way of doing that. Many thanks."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1544539977, "creation_date": 1544539977, "answer_id": 53726692, "question_id": 53726515, "link": "https://stackoverflow.com/questions/53726515/how-to-compare-int-var-with-contents-of-a-struct/53726692#53726692", "title": "How To Compare Int Var With Contents of A Struct", "body": "<p>I'm not sure what your specific use case is but based purely on the code shown, this should really be a slice or array instead of a struct. A struct with numbered fields is a very unusual design. A struct with numbered fields is a very unusual design and very difficult to work with, as you've found. If it were a slice, you could simply loop over it:</p>\n\n<pre><code>func checkInput(userInput int, pastInputs []int) bool {\n    for _,i := range pastInputs {\n        if userInput == i {\n            return flase\n        }\n    }\n    return true\n}\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 10759999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/83f6b5075ad3d56a96b2cf8c0ccbf58b?s=128&d=identicon&r=PG&f=1", "display_name": "C0d3r42", "link": "https://stackoverflow.com/users/10759999/c0d3r42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 53726692, "answer_count": 1, "score": -2, "last_activity_date": 1544539977, "creation_date": 1544539343, "question_id": 53726515, "link": "https://stackoverflow.com/questions/53726515/how-to-compare-int-var-with-contents-of-a-struct", "title": "How To Compare Int Var With Contents of A Struct", "body": "<p>Using Go 1.11. Got the following struct,</p>\n\n<pre><code>type inputsData struct {\n  TurnOne   int\n  TurnTwo   int\n  TurnThree int\n  TurnFour  int\n  TurnFive  int\n  TurnSix   int\n  TurnSeven int\n  TurnEight int\n  TurnNine  int\n}\n</code></pre>\n\n<p>Which holds the data from user input. That is all fine but I want to check from <code>TurnTwo</code> if what the user inputs is already been entered?</p>\n\n<p>Example, <code>Input 1 -> 6</code>, <code>Input 2 -> 4</code>, <code>Input 3 -> 6</code></p>\n\n<p>So what would happen is once the user inputs 6 for turn 3 again, it would log, sorry try again...</p>\n\n<p>So this is how I am checking, </p>\n\n<pre><code>func checkInputTwo(userInput int) bool {\n   var ok bool\n   ok = true\n   if userInput == t.TurnOne {\n    ok = false\n   }\n   if userInput == t.TurnTwo {\n    ok = false\n   }\n   if userInput == t.TurnThree {\n    ok = false\n   }\n   if userInput == t.TurnFour {\n    ok = false\n   }\n   if userInput == t.TurnFive {\n    ok = false\n   }\n   if userInput == t.TurnSix {\n    ok = false\n   }\n   if userInput == t.TurnSeven {\n    ok = false\n   }\n   if userInput == t.TurnEight {\n    ok = false\n   }\n   if userInput == t.TurnNine {\n    ok = false\n   }\n\n   return ok\n}\n</code></pre>\n\n<p>This is how I am loading that function, </p>\n\n<pre><code>func checkStageTwo(input int) int {\n  var ok bool\n\n   fmt.Println(ok)\n\n   for ok {\n      ok = checkInputTwo(input)\n      fmt.Println(ok)\n   }\n\n   fmt.Println(ok)\n\n   return input\n}\n</code></pre>\n\n<p>And I just load that function supplying it a input. This does not work. It allows the same input in, but once that match, I just get stuck within my for loop printing false?</p>\n\n<p>So basically I want to check what the user input is and if its within the contents of my struct. I have load the struct package wide so its available for all the functions. </p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "plugins", "dynamic-library"], "comments": [{"owner": {"reputation": 475, "user_id": 1681234, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0f42b79ce1072c3756fc5526d36f3c48?s=128&d=identicon&r=PG", "display_name": "Oswin", "link": "https://stackoverflow.com/users/1681234/oswin"}, "edited": false, "score": 0, "creation_date": 1554478651, "post_id": 53725679, "comment_id": 97781224, "body": "I&#39;m running into the same, did you finally found out what was the problem ?"}, {"owner": {"reputation": 1734, "user_id": 1565238, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cd5ac413e588dd1a030e00f1dea143ee?s=128&d=identicon&r=PG", "display_name": "Aleksander Alekseev", "link": "https://stackoverflow.com/users/1565238/aleksander-alekseev"}, "reply_to_user": {"reputation": 475, "user_id": 1681234, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0f42b79ce1072c3756fc5526d36f3c48?s=128&d=identicon&r=PG", "display_name": "Oswin", "link": "https://stackoverflow.com/users/1681234/oswin"}, "edited": false, "score": 0, "creation_date": 1554481291, "post_id": 53725679, "comment_id": 97782639, "body": "Yep. After facing a few more problems we came to the following conclusion. Just never use go plugins for anything :)"}, {"owner": {"reputation": 475, "user_id": 1681234, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0f42b79ce1072c3756fc5526d36f3c48?s=128&d=identicon&r=PG", "display_name": "Oswin", "link": "https://stackoverflow.com/users/1681234/oswin"}, "edited": false, "score": 0, "creation_date": 1554728927, "post_id": 53725679, "comment_id": 97847177, "body": "That&#39;s not the answer I was hoping for :-/ For others, I don&#39;t run into this problem if I build from the root folder. In your example &quot;go build -buildmode=plugin plugin/plugin.so&quot; works. After that I run into this problem : <a href=\"https://github.com/golang/go/issues/18671\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/18671</a> so not sure if I&#39;m now a step further or not :-/"}], "owner": {"reputation": 1734, "user_id": 1565238, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/cd5ac413e588dd1a030e00f1dea143ee?s=128&d=identicon&r=PG", "display_name": "Aleksander Alekseev", "link": "https://stackoverflow.com/users/1565238/aleksander-alekseev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 756, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1544536747, "creation_date": 1544536747, "question_id": 53725679, "link": "https://stackoverflow.com/questions/53725679/reducing-plugin-so-size-in-go-using-buildmode-shared-and-linkshared-flags", "title": "Reducing plugin (.so) size in Go using -buildmode=shared and -linkshared flags", "body": "<p>I would like to reduce the size of the plugin (.so file) by removing common symbols used in both the plugin and the main program, e.g. go runtime and standard library.</p>\n\n<p>Here is my test project.</p>\n\n<p>main.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"plugin\"\n)\n\ntype Plugin interface {\n    SayHello()\n    SayGoodbye()\n}\n\nfunc main() {\n    if len(os.Args) &lt; 2 {\n        fmt.Fprintf(os.Stderr, \"Usage: %s &lt;plugin.so&gt;\\n\", os.Args[0])\n        os.Exit(1)\n    }\n\n    p, err := plugin.Open(os.Args[1])\n    if err != nil {\n        fmt.Fprintf(os.Stderr, \"plugin.Open: %v\\n\", err)\n        os.Exit(1)\n    }\n\n    piTemp, err := p.Lookup(\"Plugin\")\n    if err != nil {\n        fmt.Fprintf(os.Stderr, \"plugin.Open: %v\\n\", err)\n        os.Exit(1)\n    }\n\n    pi, ok := piTemp.(Plugin)\n    if !ok {\n        fmt.Fprintf(os.Stderr, \"Unable to cast helloTemp to Plugin interface\\n\")\n        os.Exit(1)\n    }\n\n    pi.SayHello()\n    pi.SayGoodbye()\n}\n</code></pre>\n\n<p>plugin/plugin.go:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype PluginImpl struct {}\n\nvar Plugin PluginImpl\n\nfunc (pi *PluginImpl) SayHello() {\n    fmt.Printf(\"Hello from the plugin!\\n\")\n}\n\nfunc (pi *PluginImpl) SayGoodbye() {\n    fmt.Printf(\"Goodbye from the plugin!\\n\")\n}\n</code></pre>\n\n<p>build.sh:</p>\n\n<pre><code>#!/bin/sh\n\nset -e\n\ngo clean ./...\ngo build\ncd plugin\ngo build -buildmode=plugin\n</code></pre>\n\n<p>Usage example:</p>\n\n<pre><code>$ ./plugins-test ./plugin/plugin.so\nHello from the plugin!\nGoodbye from the plugin!\n</code></pre>\n\n<p>I tried to follow the steps from <a href=\"https://blog.ksub.org/bytes/2017/02/12/exploring-shared-objects-in-go/\" rel=\"nofollow noreferrer\">this article</a> and here what I got:</p>\n\n<pre><code>$ go install -buildmode=shared std\n$ go install -buildmode=shared -linkshared go-sandbox/plugins-test\npanic: runtime error: index out of range\n\ngoroutine 1 [running]:\ncmd/go/internal/work.(*Builder).linkSharedAction.func2(0x84607e0)\n    /usr/local/go/src/cmd/go/internal/work/action.go:745 +0x7dd\ncmd/go/internal/work.(*Builder).cacheAction(0x8d7cfc0, 0x90fdd00, 0x14, 0x0, 0x8efc740, 0x90fdd00)\n    /usr/local/go/src/cmd/go/internal/work/action.go:314 +0x84\ncmd/go/internal/work.(*Builder).linkSharedAction(0x8d7cfc0, 0x1, 0x1, 0x8e2373a, 0x6, 0x8eec840, 0x8e2373a)\n    /usr/local/go/src/cmd/go/internal/work/action.go:738 +0x201\ncmd/go/internal/work.(*Builder).buildmodeShared(0x8d7cfc0, 0x1, 0x1, 0x8c18050, 0x1, 0x2, 0x0, 0x0, 0x0, 0x8eec840, ...)\n    /usr/local/go/src/cmd/go/internal/work/action.go:649 +0xe8\ncmd/go/internal/work.InstallPackages(0x8c18050, 0x1, 0x2, 0x0, 0x0, 0x0)\n    /usr/local/go/src/cmd/go/internal/work/build.go:503 +0xb9c\ncmd/go/internal/work.runInstall(0x884ae20, 0x8c18050, 0x1, 0x2)\n    /usr/local/go/src/cmd/go/internal/work/build.go:417 +0x52\nmain.main()\n    /usr/local/go/src/cmd/go/main.go:219 +0x8a4\n</code></pre>\n\n<p>The behavior is the same on <code>go1.11.2 linux/386</code> and <code>go1.11.2 linux/arm</code>. On MacOS the feature seems to be missing --- <code>-buildmode=shared not supported on darwin/amd64</code>.</p>\n\n<p>Am I doing something wrong or this feature is a little bit broken?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1544530668, "post_id": 53723775, "comment_id": 94301439, "body": "I don&#39;t know what that means. Your question is very difficult to understand."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1544534519, "post_id": 53723775, "comment_id": 94303393, "body": "<code>d</code> is not an array, it&#39;s a map and they are not one and the same in Go. Since you&#39;re using a map of interfaces getting any item from the map is gonna get ugly and the more nested the item is the more uglier the code gets. I would recommend you use struct types instead of maps or use a 3rd party lib that makes the traversing of a map easier. To see how ulgy it can get, consider the solution to get d.ask.assets[0].name: <code>d[&quot;ask&quot;].(map[string]interface{})[&quot;assets&quot;].([]interface{})[&zwnj;&#8203;0].(map[string]inter&zwnj;&#8203;face{})[&quot;name&quot;].(str&zwnj;&#8203;ing)</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1123, "user_id": 5198054, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H6xkh.jpg?s=128&g=1", "display_name": "Hasan", "link": "https://stackoverflow.com/users/5198054/hasan"}, "is_accepted": false, "score": 1, "last_activity_date": 1544532087, "last_edit_date": 1544532087, "creation_date": 1544531620, "answer_id": 53724331, "question_id": 53723775, "link": "https://stackoverflow.com/questions/53723775/how-can-i-create-structure-for-object-and-get-values-in-golang/53724331#53724331", "title": "How can I create structure for object and get values in golang?", "body": "<p>I did not get so much from your explanation but you can cycle through the arrays like this with range operation which returns index and value. </p>\n\n<p><code>for index, value := range !YourArray!{\n        //Do your stuff here\n    }</code></p>\n\n<p>edit:</p>\n\n<p>Just to get single value from for loop with range you can use _ operator to neglect the unwanted variable.</p>\n\n<pre><code>    for _, u := range urls {\n</code></pre>\n\n<p>Above index variable neglected,</p>\n\n<pre><code>    for i, _ := range urls {\n</code></pre>\n\n<p>Value variable neglected.</p>\n"}], "owner": {"reputation": 19, "user_id": 5058102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80c50cc86f91f116cfb7cbde3e37ab5d?s=128&d=identicon&r=PG&f=1", "display_name": "Nikita Dubrovin", "link": "https://stackoverflow.com/users/5058102/nikita-dubrovin"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "closed_date": 1544531899, "answer_count": 1, "score": -3, "last_activity_date": 1544611998, "creation_date": 1544529616, "last_edit_date": 1544611998, "question_id": 53723775, "link": "https://stackoverflow.com/questions/53723775/how-can-i-create-structure-for-object-and-get-values-in-golang", "closed_reason": "Duplicate", "title": "How can I create structure for object and get values in golang?", "body": "<p>I'm trying to write a function that will take an encoded string, send a request to the jsonrpc service, then I need to choose a boring data (ask:assets:interface) and create a new variables</p>\n\n<p>How can I create structure for object:</p>\n\n<pre><code>{\n  \"ask\": {\n  \"amount\": 0,\n  \"assets\": [\n    {\n      \"assetref\": \"74-266-27408\",\n      \"name\": \"USD\",\n      \"qty\": 5000\n    }\n  ]\n  },\n  \"cancomplete\": true,\n  \"candisable\": true,\n  \"complete\": false,\n  \"offer\": {\n  \"amount\": 0,\n  \"assets\": [\n    {\n      \"assetref\": \"73-266-61482\",\n      \"name\": \"BTC\",\n      \"qty\": 1\n    }\n  ]\n  },\n  \"requiredfee\": 0\n}\n</code></pre>\n\n<p>And make a function wich decode hex string:</p>\n\n<pre><code>type Order struct {\n    Ask []Ask `json:\"ask\"`\n    Cancomplete bool `json:\"cancomplete\"`\n    Candisable bool `json:\"candisable\"`\n    Complete bool `json:\"complete\"`\n    Offer []Offer `json:\"offer\"`\n    Requiredfee int `json:\"requiredfee\"`\n}\n\nfunc DecodeOrder(datahex string) (Order)   {\n    order, _ := rpcClient.Call(\"decoderawexchange\", datahex)\n    var d = make([]Order, 0, 100)\n    err := order.GetObject(&amp;d)\n    if err != nil || d == nil {\n        panic(err)\n    }\n\n    return d\n}\n</code></pre>\n\n<p>Issue resolved using generated structure:</p>\n\n<pre><code>type Order struct {\n    Ask struct {\n        Amount float64 `json:\"amount\"`\n        Assets []struct {\n            Assetref string `json:\"assetref\"`\n            Name     string `json:\"name\"`\n            Qty      float64    `json:\"qty\"`\n        } `json:\"assets\"`\n    } `json:\"ask\"`\n    Cancomplete bool `json:\"cancomplete\"`\n    Candisable  bool `json:\"candisable\"`\n    Complete    bool `json:\"complete\"`\n    Offer       struct {\n        Amount float64 `json:\"amount\"`\n        Assets []struct {\n            Assetref string `json:\"assetref\"`\n            Name     string `json:\"name\"`\n            Qty      float64    `json:\"qty\"`\n        } `json:\"assets\"`\n    } `json:\"offer\"`\n    Requiredfee float64 `json:\"requiredfee\"`\n}\n</code></pre>\n"}, {"tags": ["go", "short-circuiting"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1544525829, "post_id": 53722288, "comment_id": 94298746, "body": "I think lazy evaluation usually refers to a variable whose value isn&#39;t calculated or fetched (from a DB or API, for example) until it&#39;s accessed."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1544526965, "post_id": 53722288, "comment_id": 94299400, "body": "Somewhat related: there is short circuit evaluation in <i>Go code</i>, but Go&#39;s  template engine does not use short circuit evaluation. Details: <a href=\"https://stackoverflow.com/questions/51165642/golang-template-and-testing-for-valid-fields/51167460?r=SearchResults#51167460\">Golang template and testing for Valid fields</a>"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1544552113, "post_id": 53722288, "comment_id": 94313748, "body": "@icza, thanks, included."}], "answers": [{"tags": [], "owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "is_accepted": false, "score": 10, "last_activity_date": 1544525429, "creation_date": 1544525429, "answer_id": 53722506, "question_id": 53722288, "link": "https://stackoverflow.com/questions/53722288/short-circuit-evaluation-in-go/53722506#53722506", "title": "Short circuit evaluation in Go", "body": "<p>This is called <em>short circuit evaluation</em>. According to <a href=\"https://kuree.gitbooks.io/the-go-programming-language-report/content/22/text.html\" rel=\"noreferrer\">this tutorial</a>, the boolean operators use this:</p>\n\n<blockquote>\n  <p>Although in the <a href=\"https://golang.org/ref/spec#Logical_operators\" rel=\"noreferrer\">Go language specification</a> it does not explicitly\n  state that Go uses short circuit evaluation, it does mentiong that</p>\n  \n  <blockquote>\n    <p>Logical operators apply to boolean values and yield a result of the same type as the operands. The right operand is evaluated\n    conditionally.</p>\n  </blockquote>\n  \n  <p>Here is a quick example to prove that Go uses short circuit evaluation</p>\n  \n  <p>[\u2026]</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 7, "last_activity_date": 1544552101, "last_edit_date": 1544552101, "creation_date": 1544525576, "answer_id": 53722555, "question_id": 53722288, "link": "https://stackoverflow.com/questions/53722288/short-circuit-evaluation-in-go/53722555#53722555", "title": "Short circuit evaluation in Go", "body": "<p>What you're referring to is called \"short circut evaluation\"\u2014that is, the subexpressions are evaluated using the normal associativity rules only for as long as the complete result is available and evaluation of the rest of the expressions won't change it according to the rules of the binary operator(s) in question.</p>\n\n<p>Go does implement short circuit evaluation of logical expressions (see <a href=\"https://stackoverflow.com/a/53722506/720999\">the other answer</a>).</p>\n\n<p>(@icza commented: Somewhat related: there is short circuit evaluation in Go code, but Go's template engine does not use short circuit evaluation. Details: <a href=\"https://stackoverflow.com/questions/51165642/golang-template-and-testing-for-valid-fields/51167460?r=SearchResults#51167460\">Golang template and testing for Valid fields</a>.)</p>\n\n<p>\"Lazy evaluation\" is completely another thing\u2014usually implemented in the so-called \"functional\" programming languages, and it's not directly implemented in Go.</p>\n\n<hr>\n\n<p>Having said that, I'd note that while Go does not have <em>direct</em> (as with the syntax and runtime) support for lazy evaluation, it may be used where needed.</p>\n\n<p>For instance, you may have a goroutine reading potentially infinite number of items from a channel, and processing them in one way or another, and another goroutine\u2014or several of them\u2014producing these values and sending them through the channel. This way, the values only \"materialize\" at the receiving end no faster than they are actually ready to be handled.</p>\n"}, {"tags": [], "owner": {"reputation": 345, "user_id": 3272239, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/RIUFx.png?s=128&g=1", "display_name": "stizz96", "link": "https://stackoverflow.com/users/3272239/stizz96"}, "is_accepted": true, "score": 10, "last_activity_date": 1544526089, "creation_date": 1544526089, "answer_id": 53722705, "question_id": 53722288, "link": "https://stackoverflow.com/questions/53722288/short-circuit-evaluation-in-go/53722705#53722705", "title": "Short circuit evaluation in Go", "body": "<p>Thank you to Kostix and mkrieger for their answers - they are correct, I'm referring to short circuit evaluation and not lazy evaluation.</p>\n\n<p>Go does implement normal short circuit evaluation, as can be deduced with the following code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    for i := 0; i &lt; 10; i++ {\n        if testFunc(1) || testFunc(2) {\n            // do nothing\n        }\n    }\n}\n\nfunc testFunc(i int) bool {\n    fmt.Printf(\"function %d called\\n\", i)\n    return true\n}\n</code></pre>\n\n<p>...which will always give:</p>\n\n<pre><code>$ function 1 called\n$ function 1 called\n$ function 1 called\n$ function 1 called\n$ function 1 called\n$ function 1 called\n$ function 1 called\n$ function 1 called\n$ function 1 called\n$ function 1 called\n</code></pre>\n"}], "owner": {"reputation": 345, "user_id": 3272239, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/RIUFx.png?s=128&g=1", "display_name": "stizz96", "link": "https://stackoverflow.com/users/3272239/stizz96"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5609, "favorite_count": 3, "accepted_answer_id": 53722705, "answer_count": 3, "score": 10, "last_activity_date": 1544552101, "creation_date": 1544524664, "last_edit_date": 1544526192, "question_id": 53722288, "link": "https://stackoverflow.com/questions/53722288/short-circuit-evaluation-in-go", "title": "Short circuit evaluation in Go", "body": "<p>My understanding of short circuit evaluation is that an expression is only called when needed in an if statement. Does Go follow this?</p>\n\n<p>For instance, would I get better performance on average from:</p>\n\n<pre><code>if !isValidQueryParams(&amp;queries) || r == nil || len(queries) == 0 {\n    return \"\", fmt.Errorf(\"invalid querystring\")\n}\n</code></pre>\n\n<p>...to this:</p>\n\n<pre><code>if r == nil || len(queries) == 0 || !isValidQueryParams(&amp;queries) {\n    return \"\", fmt.Errorf(\"invalid querystring\")\n}\n</code></pre>\n\n<p>...since <code>isValidQueryParams</code> is a function with much more overhead than <code>r == nil</code> or testing the length of a map?</p>\n\n<p>i.e. will the interpreter evaluate r == nil first, see it's true and not bother to evaluate the other conditions?</p>\n\n<p>EDIT: Incorrectly referred to short circuit evaluation as lazy evaluation</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 4, "creation_date": 1544526133, "post_id": 53722124, "comment_id": 94298928, "body": "You are not calling any methods here, so the quote doesn&#39;t really apply. fmt.Println and related functions check if an argument implements fmt.Stringer, but type <code>Bar</code> doesn&#39;t, only <code>*Bar</code> does."}], "answers": [{"tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 2, "last_activity_date": 1544526294, "last_edit_date": 1544526294, "creation_date": 1544524738, "answer_id": 53722308, "question_id": 53722124, "link": "https://stackoverflow.com/questions/53722124/difference-between-method-signatures-of-structs/53722308#53722308", "title": "Difference between method signatures of structs", "body": "<p>Just add <code>&amp;</code> to the <code>Bar{}</code> and make it pointer receiver, like this:  </p>\n\n<pre><code>fmt.Println(&amp;Bar{}) // \"Bar\"\n</code></pre>\n\n<p>Here a little adjustment to your code that outputs:</p>\n\n<pre><code>Foo\nBar\n</code></pre>\n\n<p>see:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Foo struct{}\n\nfunc (Foo) String() string {\n    return \"Foo\"\n}\n\ntype Bar struct{}\n\nfunc (*Bar) String() string {\n    return \"Bar\"\n}\n\nfunc main() {\n    fmt.Println(Foo{}) // \"Foo\"\n    pb := &amp;Bar{}\n    fmt.Println(pb) // \"Bar\"\n}\n</code></pre>\n\n<hr>\n\n<p>Notes:</p>\n\n<blockquote>\n  <p>Receiver name should be a reflection of its identity; don't use\n  generic names such as \"this\" or \"self\"</p>\n</blockquote>\n\n<p>And you don't need names here for your example.</p>\n\n<p>And nice to read <a href=\"https://flaviocopes.com/golang-methods-receivers/\" rel=\"nofollow noreferrer\">Golang methods receivers</a>:</p>\n\n<blockquote>\n  <p>Value receivers operate on a copy of the original type value. This\n  means that there is a cost involved, especially if the struct is very\n  large, and pointer received are more efficient.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "is_accepted": false, "score": 1, "last_activity_date": 1581623793, "last_edit_date": 1581623793, "creation_date": 1544526621, "answer_id": 53722868, "question_id": 53722124, "link": "https://stackoverflow.com/questions/53722124/difference-between-method-signatures-of-structs/53722868#53722868", "title": "Difference between method signatures of structs", "body": "<p>Because Bar does not implement <code>stringer</code> *Bar does. </p>\n\n<p>If you remove implementation of <code>stringer</code> from Foo, you will get \"{}\".</p>\n\n<p>Similarly, When you write <code>fmt.Println(Bar{})</code> it means it will look for something like <code>func (Bar) String()</code> and not <code>func (*Bar) String()</code></p>\n\n<p>Additioanlly , story is different when you write <code>fmt.Println(&amp;Foo{})</code>, you might think it will print \"{}\" because there is no <code>func (*Foo) String()</code> but it will print \"Foo\".</p>\n\n<p>For that, you will have to understand Interfaces. These are my experiences so please do your own research too. The <code>fmt.Print</code> function calls String() on passed arguments. So actually the String() is not called on your struct but rather than an variable of type stringer. </p>\n\n<blockquote>\n  <p>interface type can hold a type(which implemented it) or pointer to it,\n  if it was implemented with value receiver. That is why <code>Foo{}</code> and\n  <code>&amp;Foo{}</code> both work.</p>\n  \n  <p>interface type can hold a type's pointer (which implemented it)only,\n  if it was implemented with pointer receiver. Why? Because when you\n  implement an interface with pointer receiver, it needs an address\n  which can only be provided with a pointer. That is why only <code>&amp;Bar{}</code>\n  works and not <code>Bar{}</code></p>\n</blockquote>\n"}], "owner": {"reputation": 6043, "user_id": 793961, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/367cd54226af527423507c1f89abb25a?s=128&d=identicon&r=PG", "display_name": "muffel", "link": "https://stackoverflow.com/users/793961/muffel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 53722308, "answer_count": 2, "score": 1, "last_activity_date": 1581623793, "creation_date": 1544524061, "last_edit_date": 1544524106, "question_id": 53722124, "link": "https://stackoverflow.com/questions/53722124/difference-between-method-signatures-of-structs", "title": "Difference between method signatures of structs", "body": "<p>As a programmer coming from other languages like C++, I find it rather strange that go allows to specify methods for structs that allow either a pointer or an instance as a parameter. According to <a href=\"https://gobyexample.com/methods\" rel=\"nofollow noreferrer\">go by example</a> once could use either of them if we didn't want to modify the origin:</p>\n\n<blockquote>\n  <p>Go automatically handles conversion between values and pointers for method calls. You may want to use a pointer receiver type to avoid copying on method calls or to allow the method to mutate the receiving struct.</p>\n</blockquote>\n\n<p>Consider the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Foo struct {}\n\ntype Bar struct {}\n\nfunc (this Foo) String() string {\n  return \"Foo\"\n}\n\nfunc (this *Bar) String() string {\n  return \"Bar\"\n}\n\nfunc main() {\n  fmt.Println(Foo{}) // \"Foo\"\n  fmt.Println(Bar{}) // \"{}\"\n}\n</code></pre>\n\n<p>Why can't I use both signature versions to modify the <em>stringify</em> (I don't know how it is actually called in go) behavior of the structs?</p>\n\n<p>Just to be clear: I don't really care about the stringify, but want to understand how the language behaves.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1544529834, "post_id": 53722060, "comment_id": 94301011, "body": "&quot;Shouldn&#39;t the behavior be similar in both cases.&quot; No, not at all. &quot;If not, why?&quot; These cases are very different. IN the first case t is nil in the second &amp;t is non nil."}, {"owner": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1544529998, "post_id": 53722060, "comment_id": 94301089, "body": "@Volker Thank you, again"}, {"owner": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1544530448, "post_id": 53722060, "comment_id": 94301306, "body": "@Volker Please stop with downvotes. I do not think, this question deserved this. That way you are not exactly making SO beginer friendly."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1544532424, "post_id": 53722060, "comment_id": 94302360, "body": "The question&#39;s title ask about some complicated stuff in regard to interface but the error is very basic error: You cannot dereference nil pointers and <code>var t *T</code> gives a nil. Wrapping this with a lot of interface jumbomumbo is unnecessary and not helpful to others."}], "answers": [{"tags": [], "owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "is_accepted": false, "score": 2, "last_activity_date": 1544527199, "creation_date": 1544527199, "answer_id": 53723051, "question_id": 53722060, "link": "https://stackoverflow.com/questions/53722060/why-does-assigning-interface-with-pointer-and-then-an-address-shows-different-be/53723051#53723051", "title": "why does assigning interface with pointer and then an address shows different behaviour in Golang", "body": "<p>You didn't initialized T.<br>\nDo this :</p>\n\n<pre><code>var t *T = &amp;T{\"Hello World\"}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "edited": false, "score": 0, "creation_date": 1544527339, "post_id": 53723058, "comment_id": 94299625, "body": "Thank you. For accompanying details."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 3, "last_activity_date": 1544527214, "creation_date": 1544527214, "answer_id": 53723058, "question_id": 53722060, "link": "https://stackoverflow.com/questions/53722060/why-does-assigning-interface-with-pointer-and-then-an-address-shows-different-be/53723058#53723058", "title": "why does assigning interface with pointer and then an address shows different behaviour in Golang", "body": "<p>You are declaring, but not explicitly defining a variable named <code>t</code> in both cases. If you don't specify a value, the zero value for the variable's type is assigned</p>\n\n<p>The zero value for all pointer types, including <code>*T</code> is nil. The zero value for a struct type is a value of that struct with all fields set to their zero values.</p>\n\n<blockquote>\n  <p>When storage is allocated for a variable [...] and no explicit initialization is provided, the variable or value is given a default value. Each element of such a variable or value is set to the zero value for its type: false for booleans, 0 for numeric types, \"\" for strings, and nil for pointers, functions, interfaces, slices, channels, and maps. This initialization is done recursively, so for instance each element of an array of structs will have its fields zeroed if no value is specified.</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#The_zero_value</a></p>\n\n<p>Consequently this stores nil in the interface value <code>i</code>:</p>\n\n<pre><code>var i interface{ M() }\nvar t *T \ni = t\n// i stores nil\n</code></pre>\n\n<p>And this stores a struct value in the interface value <code>i</code>:</p>\n\n<pre><code>var i interface{ M() }\nvar t T \ni = t\n// i stores T{S:\"\"}\n</code></pre>\n\n<p>So in the first case, <code>(nil).M()</code> is called (which panics), and in the second case <code>(T{}).M()</code> is called.</p>\n"}], "owner": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 134, "favorite_count": 0, "accepted_answer_id": 53723058, "answer_count": 2, "score": -1, "last_activity_date": 1544527657, "creation_date": 1544523854, "last_edit_date": 1544524329, "question_id": 53722060, "link": "https://stackoverflow.com/questions/53722060/why-does-assigning-interface-with-pointer-and-then-an-address-shows-different-be", "title": "why does assigning interface with pointer and then an address shows different behaviour in Golang", "body": "<p>I'm new to golang. I'm starting with a tour of go.\nHere is the <a href=\"https://play.golang.org/p/_Y1u3aVoPfL\" rel=\"nofollow noreferrer\">go playground link</a></p>\n\n<p>Here is the code :</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype I interface {\n    M()\n}\n\ntype T struct {\n    S string\n}\n\nfunc (t *T) M() {\n\n    fmt.Println(t.S)\n}\n\nfunc main() {\n    var i I\n\n    var t *T \n    i = t\n\n    i.M()\n}\n</code></pre>\n\n<p>It is panicing</p>\n\n<blockquote>\n  <p>panic: runtime error: invalid memory address or nil pointer\n  dereference\n      [signal SIGSEGV: segmentation violation code=0xffffffff addr=0x0 \n      pc=0xd3ea6]\n      goroutine 1 [running]:\n      main.(*T).M(0x0, 0x434070)    /tmp/sandbox696069628/main.go:15 +0x26\n      main.main()   /tmp/sandbox696069628/main.go:24 +0x40</p>\n</blockquote>\n\n<p>However when I change </p>\n\n<pre><code>var t *T \ni = t\n</code></pre>\n\n<p>to </p>\n\n<pre><code>var t T \ni = &amp;t\n</code></pre>\n\n<p>It does not panic anymore</p>\n\n<p>Shouldn't the behavior be similar in both cases. If not, why?</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 1, "creation_date": 1544522137, "post_id": 53721437, "comment_id": 94296570, "body": "then once you have the respBody, make a struct to decode it and do <code>json.Unmarshall(respBody, jstruct)</code>"}, {"owner": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "edited": false, "score": 0, "creation_date": 1544522895, "post_id": 53721437, "comment_id": 94297062, "body": "@arcteezy it will not marshal with the given struct see in the code"}, {"owner": {"reputation": 3395, "user_id": 10409167, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blZR5.jpg?s=128&g=1", "display_name": "Arcteezy", "link": "https://stackoverflow.com/users/10409167/arcteezy"}, "edited": false, "score": 0, "creation_date": 1544522916, "post_id": 53721437, "comment_id": 94297075, "body": "You can unmarshal the content into a map from where you can decode it using the key s."}, {"owner": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "edited": false, "score": 0, "creation_date": 1544522962, "post_id": 53721437, "comment_id": 94297105, "body": "@Arcteezy Please provide me a small example"}], "tags": [], "owner": {"reputation": 3395, "user_id": 10409167, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/blZR5.jpg?s=128&g=1", "display_name": "Arcteezy", "link": "https://stackoverflow.com/users/10409167/arcteezy"}, "is_accepted": true, "score": 5, "last_activity_date": 1544523125, "last_edit_date": 1544523125, "creation_date": 1544521883, "answer_id": 53721437, "question_id": 53721330, "link": "https://stackoverflow.com/questions/53721330/how-to-read-the-data-in-json-format/53721437#53721437", "title": "How to read the data in json format?", "body": "<p>Try this,</p>\n\n<pre><code>respBody, Err := ioutil.ReadAll(req.Body)\n\nfmt.Println(string(respBody))\n\nvar temp TokenResponse\n\nerr := json.Unmarshal(respBody, &amp;temp)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "edited": false, "score": 0, "creation_date": 1544522914, "post_id": 53721489, "comment_id": 94297074, "body": "it will not marshal with the given struct see in the code"}], "tags": [], "owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "is_accepted": false, "score": 3, "last_activity_date": 1544523379, "last_edit_date": 1544523379, "creation_date": 1544522022, "answer_id": 53721489, "question_id": 53721330, "link": "https://stackoverflow.com/questions/53721330/how-to-read-the-data-in-json-format/53721489#53721489", "title": "How to read the data in json format?", "body": "<p>You have to read response data like this :</p>\n\n<pre><code>body, err := ioutil.ReadAll(req.Body)\nresponse := map[string]interface{}\njson.Unmarshal(body,&amp;response)\n</code></pre>\n"}], "owner": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 53721437, "answer_count": 2, "score": -2, "last_activity_date": 1544523379, "creation_date": 1544521498, "last_edit_date": 1544522839, "question_id": 53721330, "link": "https://stackoverflow.com/questions/53721330/how-to-read-the-data-in-json-format", "title": "How to read the data in json format?", "body": "<p>I have a function in which I have to post the data to a url in json format. When I send the data then it will give response in json. But there it will showing me like:-</p>\n\n<p>Output given by code</p>\n\n<pre><code>&amp;{200 OK 200 HTTP/1.1 1 1 \nmap[Content-Type:[application/json] X-Request-Id:[CgiFzq669pAYzRABGBAiCQiRtaznvJffAg] \nKeep-Alive:[timeout=60] \nVary:[Accept-Encoding] \nX-Content-Type-Options:[nosniff] \nX-Download-Options:[noopen] \nX-Permitted-Cross-Domain-Policies:[none] \nStrict-Transport-Security:[max-age=631152000] \nX-Frame-Options:[DENY] \nX-Xss-Protection:[1; mode=block] \nDate:[Tue, 11 Dec 2018 09:35:22 GMT] \nAccess-Control-Allow-Headers:[Content-Type, Authorization, Accept] \nAccess-Control-Allow-Origin:[*] \nAccess-Control-Expose-Headers:[Link]] 0xc420442080 -1 [] false true map[] 0xc42023e100 0xc4200e0d10}\n</code></pre>\n\n<p>code is :-</p>\n\n<pre><code>func Token(c *gin.Context) {\n   code := c.Query(\"code\")\n   responseToken :=TokenResponse{}\n   token := models.PostToken{\n     ClientID:     \"appllication Id\",\n     ClientSecret: \"applicationSecreteId\",\n     Code:         \"code\",\n     RedirectUri:  c.Request.Host + c.Request.URL.RequestURI(),\n   }\n   bindData, err := json.Marshal(token)\n   if err != nil {\n     panic(err)\n   }\n   var jsonStr = []byte(string(bindData))\n   url :=\"https://connect.squareup.com/oauth2/token\"\n   req, err := http.Post(url, \"application/json\", bytes.NewBuffer(jsonStr))\n   fmt.Println(req, err)\n}\n\ntype TokenResponse struct {\n  Token      string `json:\"access_token\"`\n  Type       string `json:\"token_type\"`\n  ExpiresAt  string `json:\"expires_at\"`\n  MerchantId string `json:\"merchant_id\"`\n}\n</code></pre>\n\n<p>Expected output:-</p>\n\n<pre><code>{\n  \"access_token\": \"token\",\n  \"token_type\": \"bearer\",\n  \"expires_at\": \"2019-01-10T08:20:59Z\",\n  \"merchant_id\": \"id\"\n}\n</code></pre>\n\n<p>But when I hit \"<a href=\"https://connect.squareup.com/oauth2/token\" rel=\"nofollow noreferrer\">https://connect.squareup.com/oauth2/token</a>\" url in postman then it will give me json but In golang code it will not showing any json it will return the above data. Can anyone  tell me that how i will get the json data from above response?</p>\n"}, {"tags": ["c++", "go"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1544524476, "post_id": 53721215, "comment_id": 94297969, "body": "Chances are high you&#39;ve hit the effect of your C++ compiler applying <a href=\"https://en.wikipedia.org/wiki/Name_mangling\" rel=\"nofollow noreferrer\">name mangling</a> to the name of your exported function, so it really is <i>not</i> named the way you expect in the library&#39;s export table. You can verify that with tools like <code>objdump</code> or, say, the venerable <a href=\"http://www.dependencywalker.com/\" rel=\"nofollow noreferrer\"><code>depends.exe</code></a>. The simplest approach is to wrap the declaration of your exported function into <code>extern &quot;C&quot; { ... }</code>\u2014see <a href=\"https://isocpp.org/wiki/faq/mixing-c-and-cpp#call-cpp\" rel=\"nofollow noreferrer\">this</a> for a refresher."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1544524555, "post_id": 53721215, "comment_id": 94298018, "body": "BTW <a href=\"https://tip.golang.org/doc/faq#go_or_golang\" rel=\"nofollow noreferrer\">the language is called &quot;Go&quot;</a>."}, {"owner": {"reputation": 3, "user_id": 8872200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ca7b6457a605f08ed33ff59dd76517f?s=128&d=identicon&r=PG", "display_name": "Arktische", "link": "https://stackoverflow.com/users/8872200/arktische"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1544528115, "post_id": 53721215, "comment_id": 94300048, "body": "Thanks a lot, it works after wrapped with \u201cextern \u201cC\u201d {}\u201d.And thanks for your correction, I have been worried that my broken English will cause misunderstandings since I\u2019m not a native speaker \ud83d\ude02"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1544528817, "post_id": 53721215, "comment_id": 94300432, "body": "OK, glad it helper. Converted it to a proper answer then; please accept it."}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 0, "last_activity_date": 1544528794, "creation_date": 1544528794, "answer_id": 53723523, "question_id": 53721215, "link": "https://stackoverflow.com/questions/53721215/syscall-mustloaddll-mustfindproc-throws-the-specified-procedure-could-not-be-fo/53723523#53723523", "title": "syscall.MustLoadDll.MustFindProc throws &quot;The specified procedure could not be found&quot;", "body": "<p>Chances are high you've hit the effect of your C++ compiler applying <a href=\"https://en.wikipedia.org/wiki/Name_mangling\" rel=\"nofollow noreferrer\">name mangling</a> to the name of your exported function, so it really is not named the way you expect in the library's export table. You can verify that with tools like objdump or, say, the venerable <a href=\"http://www.dependencywalker.com/\" rel=\"nofollow noreferrer\"><code>depends.exe</code></a>. The simplest approach is to wrap the declaration of your exported function into <code>extern \"C\" { ... }</code>\u2014see <a href=\"https://isocpp.org/wiki/faq/mixing-c-and-cpp#call-cpp\" rel=\"nofollow noreferrer\">this</a> for a refresher.</p>\n"}], "owner": {"reputation": 3, "user_id": 8872200, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4ca7b6457a605f08ed33ff59dd76517f?s=128&d=identicon&r=PG", "display_name": "Arktische", "link": "https://stackoverflow.com/users/8872200/arktische"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 205, "favorite_count": 0, "accepted_answer_id": 53723523, "answer_count": 1, "score": -1, "last_activity_date": 1544528794, "creation_date": 1544521036, "last_edit_date": 1592644375, "question_id": 53721215, "link": "https://stackoverflow.com/questions/53721215/syscall-mustloaddll-mustfindproc-throws-the-specified-procedure-could-not-be-fo", "title": "syscall.MustLoadDll.MustFindProc throws &quot;The specified procedure could not be found&quot;", "body": "<p>I have written a dynamic link library in c++ and export it correctly, in order to enable Go to fetch adapter infomation using Win32 API. But when I call its function in Go, it throws &quot;The specified procedure could not be found&quot; error.\nI'm totally new with Go, so I have no idea how to solve it. Could anybody help me?</p>\n<p>Here's some infomation about my environment:</p>\n<blockquote>\n<p>platform: windows 10 x64</p>\n<p>CXX compiler: visual c++ 15.3</p>\n<p>go version: go1.11.2 windows/amd64</p>\n</blockquote>\n<p>Here is my code:</p>\n<pre><code>#include &quot;stdafx.h&quot;\n#include &lt;WinSock2.h&gt;\n#include &lt;iphlpapi.h&gt;\n#include &lt;iostream&gt;\n#include &lt;vector&gt;\n\nusing namespace std;\n__declspec(dllexport) const char *get_default_gateway();\n\nvector &lt;string&gt; default_gateway;\n\nconst char *get_default_gateway()\n{\n\n    PIP_ADAPTER_INFO pIpAdapterInfo = new IP_ADAPTER_INFO();\n    PIP_ADAPTER_INFO info_p;\n\n    unsigned long stSize = sizeof(IP_ADAPTER_INFO);\n\n    int nRel = GetAdaptersInfo(pIpAdapterInfo, &amp;stSize);\n    info_p = pIpAdapterInfo;\n\n    if (ERROR_BUFFER_OVERFLOW == nRel)\n    {\n        delete pIpAdapterInfo;\n    \n        pIpAdapterInfo = (PIP_ADAPTER_INFO)new BYTE[stSize];\n    \n        nRel = GetAdaptersInfo(pIpAdapterInfo, &amp;stSize);\n        info_p = pIpAdapterInfo;\n    }\n    if (ERROR_SUCCESS == nRel)\n    {\n    \n        while (info_p)\n        {\n        \n            IP_ADDR_STRING *pIpAddrString = &amp;(info_p-&gt;IpAddressList);\n            do\n            {\n                string gateway_tmp = info_p-&gt;GatewayList.IpAddress.String;\n                if (gateway_tmp != &quot;0.0.0.0&quot;) {\n                    default_gateway.push_back(info_p-&gt;GatewayList.IpAddress.String);\n                }\n                pIpAddrString = pIpAddrString-&gt;Next;\n            } while (pIpAddrString);\n            info_p = info_p-&gt;Next;\n        }\n\n    }\n\n    if (pIpAdapterInfo)\n    {\n        delete []pIpAdapterInfo;\n    }\n\n    const char *gateway = default_gateway.at(0).c_str();\n    return gateway;\n}\n</code></pre>\n<p>Here is my golang code:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;syscall&quot;\n    &quot;unsafe&quot;\n)\n\nfunc main() {\n    dll := syscall.MustLoadDLL(&quot;getAdapterInfo.dll&quot;)\n    getDefaultGateWay := dll.MustFindProc(&quot;get_default_gateway&quot;)\n\n    r, _, _ := getDefaultGateWay.Call()\n    p := (*byte)(unsafe.Pointer(r))\n    data := make([]byte, 0)\n\n    for *p != 0 {\n        data = append(data, *p)        \n        r += unsafe.Sizeof(byte(0))    \n        p = (*byte)(unsafe.Pointer(r)) \n    }\n    str := string(data) \n\n    fmt.Printf(&quot;%s\\n&quot;, str)\n}\n</code></pre>\n<p>Here is the terminal output info:</p>\n<pre><code>panic: Failed to find get_default_gateway procedure in getAdapterInfo.dll: \nThe specified procedure could not be found.\n\ngoroutine 1 [running]:\nsyscall.(*DLL).MustFindProc(0xc000056400, 0x4c4934, 0x13, 0xc000081f48)\n        E:/Go/src/syscall/dll_windows.go:109 +0x80\nmain.main()\n        E:/GOPATH/src/github.com/Arktische/test/main.go:11 +0x67\n</code></pre>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 5614, "user_id": 1177790, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/tjFKT.jpg?s=128&g=1", "display_name": "Paritosh Singh", "link": "https://stackoverflow.com/users/1177790/paritosh-singh"}, "edited": false, "score": 0, "creation_date": 1544522278, "post_id": 53721208, "comment_id": 94296662, "body": "Can you paste struct for school server db and its debug function? Also what is struct for dayz/"}, {"owner": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "reply_to_user": {"reputation": 5614, "user_id": 1177790, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/tjFKT.jpg?s=128&g=1", "display_name": "Paritosh Singh", "link": "https://stackoverflow.com/users/1177790/paritosh-singh"}, "edited": false, "score": 0, "creation_date": 1544527342, "post_id": 53721208, "comment_id": 94299629, "body": "@ParitoshSingh Please provide more info/"}, {"owner": {"reputation": 5614, "user_id": 1177790, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/tjFKT.jpg?s=128&g=1", "display_name": "Paritosh Singh", "link": "https://stackoverflow.com/users/1177790/paritosh-singh"}, "reply_to_user": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "edited": false, "score": 0, "creation_date": 1544587073, "post_id": 53721208, "comment_id": 94324796, "body": "@MostafaSolati Did you mean @PrimeGrandLol? :)"}, {"owner": {"reputation": 3, "user_id": 10302906, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-uRTYeScmC50/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPAzxJ-UONaHz97KnRxMwQMAlac_Q/mo/photo.jpg?sz=128", "display_name": "PrimeGrand Lol", "link": "https://stackoverflow.com/users/10302906/primegrand-lol"}, "reply_to_user": {"reputation": 1105, "user_id": 1262319, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/pIk9w.jpg?s=128&g=1", "display_name": "Mostafa Solati", "link": "https://stackoverflow.com/users/1262319/mostafa-solati"}, "edited": false, "score": 0, "creation_date": 1544594925, "post_id": 53721208, "comment_id": 94326866, "body": "@MostafaSolati Updated info. Actually, I guess I misunderstand the Gorm workflow rather than having problems with source code"}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 10302906, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-uRTYeScmC50/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPAzxJ-UONaHz97KnRxMwQMAlac_Q/mo/photo.jpg?sz=128", "display_name": "PrimeGrand Lol", "link": "https://stackoverflow.com/users/10302906/primegrand-lol"}, "edited": false, "score": 0, "creation_date": 1544644923, "post_id": 53741397, "comment_id": 94353738, "body": "Thank you very much for help! This solved the issue!"}], "tags": [], "owner": {"reputation": 11023, "user_id": 1924666, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/YzCUy.jpg?s=128&g=1", "display_name": "Shahriar", "link": "https://stackoverflow.com/users/1924666/shahriar"}, "is_accepted": true, "score": 1, "last_activity_date": 1544612257, "last_edit_date": 1544612257, "creation_date": 1544611954, "answer_id": 53741397, "question_id": 53721208, "link": "https://stackoverflow.com/questions/53721208/golang-gorm-search-conditions/53741397#53741397", "title": "Golang GORM search conditions", "body": "<p>There is no problem with your <strong>Search Condition</strong>. Simply you have provided multiple IDs in your queries from second iteration. One in <code>Where</code> and another in <code>Find</code>. </p>\n\n<p>Let me write an example like yours</p>\n\n<pre><code>ids := []int{1, 2}\nvar org database.Organization\nfor _, i := range ids {\n    db, _ := connection.NewPGConnection(info)\n    db = db.Debug().New()\n    db.Where(\"id = ?\", i).Find(&amp;org)\n}\n</code></pre>\n\n<p>Here, SQL query in first iteration is as  below:</p>\n\n<pre><code>SELECT * FROM \"organizations\"  WHERE \"organizations\".\"deleted_at\" IS NULL AND ((id = '1'))\n</code></pre>\n\n<p>And in second iteration it will be:</p>\n\n<pre><code>SELECT * FROM \"organizations\"  WHERE \"organizations\".\"deleted_at\" IS NULL AND \"organizations\".\"id\" = '1' AND \"organizations\".\"code\" = 'mir' AND ((id = '2'))\n</code></pre>\n\n<p>Why? Because, you have used same variable <strong>day</strong>, to read row result. </p>\n\n<p>First time, Its ok. But second time, your <em>day</em> <strong>variable has already an ID in it</strong>. And you have provide another one in <code>Where</code>. Thats why, its running query with two ids.</p>\n\n<blockquote>\n  <p>You are actually providing two <code>id</code>, one in <code>where</code> clause and another in <code>Find</code>.</p>\n</blockquote>\n\n<p>Change your code to redeclare your variable <strong>day</strong> each time. Like this.</p>\n\n<pre><code>ids := []int{1, 2}\nfor _, i := range ids {\n    db, _ := connection.NewPGConnection(info)\n    db = db.Debug().New()\n    var org database.Organization  // &lt;----- move your variable day here\n    db.Where(\"id = ?\", i).Find(&amp;org)\n}\n</code></pre>\n\n<p>Each time, new and clean variable will be used. And your problem will be solved. </p>\n\n<p>Thank you. Hope this will help you.</p>\n"}], "owner": {"reputation": 3, "user_id": 10302906, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-uRTYeScmC50/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPAzxJ-UONaHz97KnRxMwQMAlac_Q/mo/photo.jpg?sz=128", "display_name": "PrimeGrand Lol", "link": "https://stackoverflow.com/users/10302906/primegrand-lol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1469, "favorite_count": 0, "accepted_answer_id": 53741397, "answer_count": 1, "score": -1, "last_activity_date": 1544612257, "creation_date": 1544521019, "last_edit_date": 1544594640, "question_id": 53721208, "link": "https://stackoverflow.com/questions/53721208/golang-gorm-search-conditions", "title": "Golang GORM search conditions", "body": "<p>Writing a webserver in Golang with gorm &amp; postgres, I got stuck misunderstanding what's exactly going on at the second loop iteration in the following code:</p>\n\n<pre><code>...\nfor _, t := range tasks {\n    newDbConn := db.SchoolServerDB.Debug().New()\n    err = newDbConn.Where(\"id = ?\", t.DayID).First(&amp;day).Error\n    if err != nil {\n        return errors.Wrapf(err, \"Error query day with id='%v'\", t.DayID)\n    }\n    ...\n}\n...\n</code></pre>\n\n<p>First iteration debug:</p>\n\n<pre><code>SELECT * FROM \"days\"  WHERE \"days\".\"deleted_at\" IS NULL AND ((id = '8')) ORDER BY \"days\".\"id\" ASC LIMIT 1\n</code></pre>\n\n<p>Second iteration debug:</p>\n\n<pre><code>SELECT * FROM \"days\"  WHERE \"days\".\"deleted_at\" IS NULL AND \"days\".\"id\" = '8' AND ((id = '38')) ORDER BY \"days\".\"id\" ASC LIMIT 1\n</code></pre>\n\n<p>The key question is: why search conditions are accumulated despite there's a new connection being created each iteration? According to <a href=\"https://godoc.org/github.com/jinzhu/gorm#DB.New\" rel=\"nofollow noreferrer\">docs</a> search conditions must be cleared every time. I'd like to get the second result like this:</p>\n\n<pre><code>SELECT * FROM \"days\"  WHERE \"days\".\"deleted_at\" IS NULL AND ((id = '38')) ORDER BY \"days\".\"id\" ASC LIMIT 1\n</code></pre>\n\n<p>Any help appreciated!</p>\n\n<p><strong>UPD:</strong><br>\ndb.SchoolServerDb is just *gorm.DB and Debug() is its method</p>\n\n<p>Table 'days' is made of struct Day:</p>\n\n<pre><code>type Day struct {\n    gorm.Model\n    StudentID uint // parent id\n    Date string `sql:\"size:255\"`\n    Tasks []Task // has-many relation\n    Lessons []Lesson // has-many relation\n}\n</code></pre>\n"}, {"tags": ["arrays", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 10774559, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-j19W-C6rUew/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-hLY6cs_DsdvQ-ZyJCkdEDGLa2Fnw/mo/photo.jpg?sz=128", "display_name": "Osama Aftab", "link": "https://stackoverflow.com/users/10774559/osama-aftab"}, "edited": false, "score": 0, "creation_date": 1544519398, "post_id": 53720683, "comment_id": 94294870, "body": "Great, that was the issue. Thanks"}], "tags": [], "owner": {"reputation": 1763, "user_id": 4010835, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MrAii.jpg?s=128&g=1", "display_name": "KibGzr", "link": "https://stackoverflow.com/users/4010835/kibgzr"}, "is_accepted": false, "score": 4, "last_activity_date": 1544519255, "creation_date": 1544519255, "answer_id": 53720683, "question_id": 53720553, "link": "https://stackoverflow.com/questions/53720553/struct-array-inside-another-struct-in-golang/53720683#53720683", "title": "Struct array inside another struct in golang", "body": "<p><code>OutletList</code> must be uppercase if you want to export this field</p>\n\n<pre><code>type Payment struct {\n    Discount   string        `json:\"Discount\"`\n    OutletList [] OutletItem `json:\"outletList\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 10774559, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-j19W-C6rUew/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-hLY6cs_DsdvQ-ZyJCkdEDGLa2Fnw/mo/photo.jpg?sz=128", "display_name": "Osama Aftab", "link": "https://stackoverflow.com/users/10774559/osama-aftab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 188, "favorite_count": 0, "closed_date": 1544533053, "answer_count": 1, "score": -2, "last_activity_date": 1544520244, "creation_date": 1544518703, "last_edit_date": 1544520244, "question_id": 53720553, "link": "https://stackoverflow.com/questions/53720553/struct-array-inside-another-struct-in-golang", "closed_reason": "Duplicate", "title": "Struct array inside another struct in golang", "body": "<p>I am new to <code>golang</code> and trying to create <code>json</code> in this format using <code>golang</code></p>\n\n<pre><code>{\n    \"Title\": \"You are awesome\",\n    \"Url\": \"www.youareawesome.com\",\n    \"Desc\": \"your awesome desc is here\",\n    \"Payment\": {\n        \"Discount\": \"15%\",\n        \"outlets\": [\n            {\n                \"Location\": \"nowhere\"\n            },\n            {\n                \"Location\": \"everywhere\"\n            }\n        ]\n    }\n}\n</code></pre>\n\n<p>below is my code for <code>struct</code></p>\n\n<pre><code>type Partner struct {\n    Title   string `json:\"Title\"`\n    URL     string `json:\"Url\"`\n    Desc    string `json:\"Desc\"`\n    Payment Payment `json:\"Payment\"`\n}\n\ntype Payment struct {\n    Discount string `json:\"Discount\"`\n    outletList [] OutletItem `json:\"outletList\"`\n} \n\ntype OutletItem struct {\n    Location string `json:\"Location\"`\n}\n</code></pre>\n\n<p>this is how i am doing </p>\n\n<pre><code>partner := Partner{} \npayment := Payment{}\npartner.Title = \"You are awesome\"\npartner.Desc = \"your awesome desc is here\"\npayment.Discount = \"15%\"\npayment.AddOutletItem(OutletItem{Location:\"nowhere\"})\npartner.Payment = payment\npartner.Url = \"www.youareawesome.com\"\njson.NewEncoder(w).Encode(partner)\n\n\nfunc (payment *Payment) AddOutletItem(item OutletItem) []OutletItem {\n    payment.outletList = append(payment.outletList, item)\n    return payment.outletList\n}\n</code></pre>\n\n<p>I am unable to see the outlet array in the payment object i am not sure if i have missed out any thing.</p>\n"}, {"tags": ["go", "junit", "cobertura", "ginkgo", "shippable-ci"], "answers": [{"tags": [], "owner": {"reputation": 2454, "user_id": 2520628, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/0zmcN.jpg?s=128&g=1", "display_name": "Tejashwi Kalp Taru", "link": "https://stackoverflow.com/users/2520628/tejashwi-kalp-taru"}, "is_accepted": false, "score": 0, "last_activity_date": 1544527373, "creation_date": 1544527373, "answer_id": 53723105, "question_id": 53720432, "link": "https://stackoverflow.com/questions/53720432/ginkgo-to-cobertura-and-junit/53723105#53723105", "title": "Ginkgo to cobertura and JUnit", "body": "<p>To create the Cobertura format:</p>\n\n<p>Nevermind, figured out myself.</p>\n\n<p>Generate the cover using covermode as set</p>\n\n<p><code>ginkgo -r -cover -covermode=set -outputdir=shippable/codecoverage/ -coverprofile=coverage.out</code></p>\n\n<p>Now, we need to remove duplicate entries of <code>mode: set</code></p>\n\n<p><code>awk '!seen[$0]++' shippable/codecoverage/coverage.out &gt; shippable/codecoverage/coverage-fix.out</code></p>\n\n<p>Finally, convert to Cobertura</p>\n\n<p><code>bash gocov convert shippable/codecoverage/coverage-fix.out | gocov-xml &gt; shippable/codecoverage/coverage.xml</code></p>\n"}], "owner": {"reputation": 2454, "user_id": 2520628, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/0zmcN.jpg?s=128&g=1", "display_name": "Tejashwi Kalp Taru", "link": "https://stackoverflow.com/users/2520628/tejashwi-kalp-taru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 399, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1544527373, "creation_date": 1544518226, "question_id": 53720432, "link": "https://stackoverflow.com/questions/53720432/ginkgo-to-cobertura-and-junit", "title": "Ginkgo to cobertura and JUnit", "body": "<p>I am using Shippable as my CI and my project is based on Go 1.11. All the unit tests are written in BDD style using Ginkgo and Gomega. In my test pipeline, I have something like:</p>\n\n<pre><code>gocov test ./... | gocov-xml &gt; shippable/codecoverage/coverage.xml\ngo test -v ./... | go-junit-report &gt; shippable/testresults/junitresults.xml\n</code></pre>\n\n<p>This will create the coverage file in Cobertura format and unit test report in JUnit format.</p>\n\n<p>In my project, we have multiple test suites. I am planning to use Ginkgo CLI to perform coverage and unit test instead of <code>gocov</code> and <code>go test</code>. Something like:</p>\n\n<pre><code>ginkgo -r -cover -outputdir=./shippable/codecoverage/ -coverprofile=coverage.txt\nginkgo -r -focus=\"\\[Unit\\]\" -outputdir=./shippable/testresults/ -coverprofile=unit.txt\n</code></pre>\n\n<p>Now the problem is that I am unable to convert the coverage.txt file to equivalent Cobertura format XML file (which shippable will require) and unit.txt file to equivalent JUnit XML file.</p>\n\n<p>I've seen <a href=\"https://onsi.github.io/ginkgo/#generating-junit-xml-output\" rel=\"nofollow noreferrer\">how to generate the JUnit file from a test suite</a> but in my project, we have multiple test suite, which will result in multiple JUnit files, which I don't want.</p>\n\n<p>Any idea, how can I convert and use them?</p>\n"}, {"tags": ["docker", "google-app-engine", "go", "google-cloud-platform"], "answers": [{"comments": [{"owner": {"reputation": 145, "user_id": 8977506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2ee24fcf3227c57fa268e0a2b60225?s=128&d=identicon&r=PG", "display_name": "Chaoming Li", "link": "https://stackoverflow.com/users/8977506/chaoming-li"}, "edited": false, "score": 0, "creation_date": 1544518148, "post_id": 53719485, "comment_id": 94294111, "body": "I don&#39;t want to use container with App Engine. I just want to use container for development so we don&#39;t have to waste time to setup the development environment over and over again for new dev."}, {"owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "reply_to_user": {"reputation": 145, "user_id": 8977506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2ee24fcf3227c57fa268e0a2b60225?s=128&d=identicon&r=PG", "display_name": "Chaoming Li", "link": "https://stackoverflow.com/users/8977506/chaoming-li"}, "edited": false, "score": 0, "creation_date": 1544518362, "post_id": 53719485, "comment_id": 94294226, "body": "I am sorry, I misunderstood your question."}], "tags": [], "owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "is_accepted": false, "score": 0, "last_activity_date": 1544514220, "creation_date": 1544514220, "answer_id": 53719485, "question_id": 53719388, "link": "https://stackoverflow.com/questions/53719388/is-it-possible-to-use-docker-as-dev-enviornment-for-golang-app-engine-standard-e/53719485#53719485", "title": "Is it possible to use docker as dev enviornment for golang app engine standard enviornment?", "body": "<p>You cannot use Containers with App Engine Standard. You can use containers with App Engine Flexible.</p>\n"}, {"comments": [{"owner": {"reputation": 145, "user_id": 8977506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2ee24fcf3227c57fa268e0a2b60225?s=128&d=identicon&r=PG", "display_name": "Chaoming Li", "link": "https://stackoverflow.com/users/8977506/chaoming-li"}, "edited": false, "score": 0, "creation_date": 1544583984, "post_id": 53722860, "comment_id": 94324208, "body": "Thanks, is there any docker image that contains development server you would recommend?"}, {"owner": {"reputation": 864, "user_id": 8456296, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a114e79267550524bf4c8e48f08f3ee1?s=128&d=identicon&r=PG&f=1", "display_name": "dhauptman", "link": "https://stackoverflow.com/users/8456296/dhauptman"}, "reply_to_user": {"reputation": 145, "user_id": 8977506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2ee24fcf3227c57fa268e0a2b60225?s=128&d=identicon&r=PG", "display_name": "Chaoming Li", "link": "https://stackoverflow.com/users/8977506/chaoming-li"}, "edited": false, "score": 0, "creation_date": 1544605584, "post_id": 53722860, "comment_id": 94331406, "body": "There&#39;s the official Cloud SDK docker image which comes with all components installed, which may include the devserver. You can take a look <a href=\"https://github.com/GoogleCloudPlatform/cloud-sdk-docker\" rel=\"nofollow noreferrer\">here</a> for more details and try it. As I&#39;ve never used it I&#39;m not sure you&#39;ll be able to achieve what you want with this."}], "tags": [], "owner": {"reputation": 864, "user_id": 8456296, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a114e79267550524bf4c8e48f08f3ee1?s=128&d=identicon&r=PG&f=1", "display_name": "dhauptman", "link": "https://stackoverflow.com/users/8456296/dhauptman"}, "is_accepted": true, "score": 2, "last_activity_date": 1544527109, "last_edit_date": 1544527109, "creation_date": 1544526587, "answer_id": 53722860, "question_id": 53719388, "link": "https://stackoverflow.com/questions/53719388/is-it-possible-to-use-docker-as-dev-enviornment-for-golang-app-engine-standard-e/53722860#53722860", "title": "Is it possible to use docker as dev enviornment for golang app engine standard enviornment?", "body": "<p>You can build <a href=\"https://cloud.google.com/appengine/docs/flexible/custom-runtimes/build\" rel=\"nofollow noreferrer\">custom runtimes</a> using Docker, you will only need App Engine Flexible if you want to deploy them. In your case, as you want to deploy to App Engine Standard, I would recommend using the <a href=\"https://cloud.google.com/appengine/docs/standard/go/tools/using-local-server\" rel=\"nofollow noreferrer\">Development Server</a> to simulate  correctly the environment.</p>\n"}], "owner": {"reputation": 145, "user_id": 8977506, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cc2ee24fcf3227c57fa268e0a2b60225?s=128&d=identicon&r=PG", "display_name": "Chaoming Li", "link": "https://stackoverflow.com/users/8977506/chaoming-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 53722860, "answer_count": 2, "score": 3, "last_activity_date": 1544527109, "creation_date": 1544513806, "last_edit_date": 1544518037, "question_id": 53719388, "link": "https://stackoverflow.com/questions/53719388/is-it-possible-to-use-docker-as-dev-enviornment-for-golang-app-engine-standard-e", "title": "Is it possible to use docker as dev enviornment for golang app engine standard enviornment?", "body": "<p>My understanding is that docker needs App Engine Flexible Environment.</p>\n\n<p>But I want to use Docker to create dev and local testing environment only, so that it will be easier and faster to replicate the environment on dev machines. I still want to deploy the <a href=\"https://www.golang.org\" rel=\"nofollow noreferrer\">GoLang</a> app to App Engine Standard Environment. I am wondering if there is a way?</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1544513724, "post_id": 53719260, "comment_id": 94292123, "body": "Hi and welcome! You might want to read <a href=\"http://stackoverflow.com/help/how-to-ask\">How do I ask a good question</a>, which enhances the probability for getting a useful answer <i>drastically</i>. Also you may find <a href=\"https://en.m.wikipedia.org/wiki/Eric_S._Raymond\" rel=\"nofollow noreferrer\">ESR</a>&#39;s excellent essay <a href=\"http://catb.org/~esr/faqs/smart-questions.html\" rel=\"nofollow noreferrer\">How To Ask Questions The Smart Way</a> helpful, too - despite its rather harsh title... ;) Frankly, the exact output (redacted, if need be) would be more helpful than a description of it."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1544517089, "post_id": 53719260, "comment_id": 94293545, "body": "Apart from a few useless string conversions (use <code>bytes.NewReader(fileContents)</code> and <code>len(fileContents)</code>), and incorrect error handling for <code>ioutil.ReadFile</code> (don&#39;t keep going if there is an error) there is nothing obviously wrong here. We can&#39;t debug the server by looking at the client code. You should inspect the response body. Hopefully the server gives you a hint about why it&#39;s failing."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1544519635, "post_id": 53719260, "comment_id": 94295017, "body": "One thing which comes to my mind is that we might be uploading to a form handler. In this case, we would talk of a multipart-mime upload - which <i>could</i> lead to said problems. But as Peter pointed out - we need more information on the server."}], "answers": [{"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": true, "score": 1, "last_activity_date": 1544523972, "last_edit_date": 1544523972, "creation_date": 1544523610, "answer_id": 53721982, "question_id": 53719260, "link": "https://stackoverflow.com/questions/53719260/http-put-request-to-upload-zip-file-in-golang/53721982#53721982", "title": "http PUT request to upload zip file in golang", "body": "<p>This is a working example.</p>\n\n<p>Most likely, it comes down to the fact that the server is a bit simple and takes the filename literally. And since you are not using <code>filepath.Base</code> on your <code>uploadFileName</code>, it might have path elements on it. Simply use it on your filename for testing purposes.</p>\n\n<p>The resets might be caused by the timeouts.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"flag\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"mime/multipart\"\n    \"net\"\n    \"net/http\"\n    \"os\"\n    \"path/filepath\"\n    \"sync\"\n)\n\nvar (\n    targetPath string\n    filename   string\n    port       int\n    handlerLog *log.Logger\n    mainLog    *log.Logger\n)\n\n// This is automatically called after vars have been initialized and before main\nfunc init() {\n    flag.StringVar(&amp;targetPath, \"target\", \"./tmp\", \"target directory for uploads\")\n    flag.StringVar(&amp;filename, \"file\", \"\", \"file to upload\")\n    flag.IntVar(&amp;port, \"port\", 0, \"port to listen on. When 0, a random port is assigned\")\n    handlerLog = log.New(os.Stdout, \"[handler] \", log.LstdFlags)\n    mainLog = log.New(os.Stdout, \"[main   ] \", log.LstdFlags)\n}\n\n// By returning a handler, we have an elegant way of initializing path.\nfunc uploadHandler(path string) http.Handler {\n\n    // We make sure path is an existing directory when the handler takes over\n    if s, err := os.Stat(path); err != nil {\n        if os.IsNotExist(err) {\n            handlerLog.Printf(\"Target '%s' does not exist. Creating it...\", path)\n            if cerr := os.MkdirAll(path, 0755); cerr != nil {\n                handlerLog.Fatalf(\"Creating target: %s\", err)\n            }\n        } else {\n            handlerLog.Fatalf(\"Error accessing '%s': %s\", path, err)\n        }\n    } else if !s.IsDir() {\n        handlerLog.Fatalf(\"Target '%s' is not a directory\", path)\n    }\n\n    // Do NOT use this handler in production!!!\n    // It is lacking all sorts of safety measures.\n    // However, it is enough to demonstrate.\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        handlerLog.Println(\"Handling file upload...\")\n\n        handlerLog.Println(\"Parsing form...\")\n        if err := r.ParseMultipartForm(32 &lt;&lt; 20); err != nil {\n            handlerLog.Fatalf(\"Parsing form: %s\", err)\n        }\n        f, h, err := r.FormFile(\"file\")\n        if err != nil {\n            handlerLog.Printf(\"Error accessing file: %s\", err)\n            http.Error(w, http.StatusText(http.StatusBadRequest), http.StatusBadRequest)\n            return\n        }\n        defer f.Close()\n\n        handlerLog.Println(\"Opening output file...\")\n        t, err := os.OpenFile(filepath.Join(path, filepath.Base(h.Filename)), os.O_CREATE|os.O_TRUNC|os.O_WRONLY, 0644)\n        if err != nil {\n            handlerLog.Printf(\"Opening output file: %s\", err)\n            http.Error(w, http.StatusText(http.StatusInternalServerError)+\": \"+err.Error(), http.StatusInternalServerError)\n            return\n        }\n        defer t.Close()\n\n        handlerLog.Println(\"Copying to output file...\")\n        if _, err = io.Copy(t, f); err != nil {\n            handlerLog.Printf(\"Copying to output file: %s\", err)\n\n            http.Error(w, http.StatusText(http.StatusInternalServerError)+\": \"+err.Error(), http.StatusInternalServerError)\n            return\n        }\n        handlerLog.Println(\"Finished handler!\")\n    })\n}\n\nfunc main() {\n    flag.Parse()\n\n    // Check input\n    if filename == \"\" {\n        mainLog.Fatal(\"No filename given. Exiting...\")\n    }\n\n    mainLog.Println(\"Setting up upload handler...\")\n    http.Handle(\"/upload\", uploadHandler(targetPath))\n\n    wg := sync.WaitGroup{}\n    wg.Add(1)\n\n    // We want to finish the program after upload, as we only want to demonstrate\n    go func() {\n        mainLog.Println(\"Setting up listener...\")\n\n        listener, err := net.Listen(\"tcp\", fmt.Sprintf(\"127.0.0.1:%d\", port))\n        if err != nil {\n            mainLog.Fatalf(\"%s\", err)\n        }\n        defer listener.Close()\n\n        port = listener.Addr().(*net.TCPAddr).Port\n        mainLog.Printf(\"Listening to port %d on localhost\", port)\n\n        wg.Done()\n        http.Serve(listener, nil)\n    }()\n\n    buf := bytes.NewBuffer(nil)\n    bodyWriter := multipart.NewWriter(buf)\n\n    // We need to truncate the input filename, as the server might be stupid and take the input\n    // filename verbatim. Then, he will have directory parts which do not exist on the server.\n    fileWriter, err := bodyWriter.CreateFormFile(\"file\", filepath.Base(filename))\n    if err != nil {\n        mainLog.Fatalf(\"Creating fileWriter: %s\", err)\n    }\n\n    file, err := os.Open(filename)\n    if err != nil {\n        mainLog.Fatalf(\"Opening file: %s\", err)\n    }\n    defer file.Close()\n\n    if _, err := io.Copy(fileWriter, file); err != nil {\n        mainLog.Fatalf(\"Buffering file: %s\", err)\n    }\n\n    // We have all the data written to the bodyWriter.\n    // Now we can infer the content type\n    contentType := bodyWriter.FormDataContentType()\n\n    // This is mandatory as it flushes the buffer.\n    bodyWriter.Close()\n\n    // As we wait for the server to spin up, we need to wait here.\n    mainLog.Println(\"Waiting for the listener to be set up...\")\n    wg.Wait()\n\n    req, err := http.NewRequest(http.MethodPut, fmt.Sprintf(\"http://127.0.0.1:%d/upload\", port), buf)\n    if err != nil {\n        mainLog.Fatalf(\"Creating request: %s\", err)\n    }\n    req.Header.Set(\"Content-Type\", contentType)\n\n    client := http.Client{}\n\n    mainLog.Println(\"Sending file\")\n    res, err := client.Do(req)\n    if err != nil {\n        mainLog.Fatalf(\"Sending file: %s\", err)\n    }\n\n    mainLog.Printf(\"Received %s from server. Exiting...\", res.Status)\n}\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 10774390, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-UzP_njWJnpM/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-hR6KbjXRyXdQwa6DbdicQBj7rF2w/mo/photo.jpg?sz=128", "display_name": "kshirol", "link": "https://stackoverflow.com/users/10774390/kshirol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3417, "favorite_count": 1, "accepted_answer_id": 53721982, "answer_count": 1, "score": 1, "last_activity_date": 1544633498, "creation_date": 1544513138, "question_id": 53719260, "link": "https://stackoverflow.com/questions/53719260/http-put-request-to-upload-zip-file-in-golang", "title": "http PUT request to upload zip file in golang", "body": "<p>I have client code which is basically trying to upload a tar.gz file to the server using a HTTP PUT METHOD. However the server seems to not like it and always seems to send me a 500 ERROR Response. Following is the code. I am not sure what is going wrong.</p>\n\n<pre><code> func upLoadFileToServer (uploadFileName string) {\n    tr := &amp;http.Transport{\n          TLSClientConfig: &amp;tls.Config{InsecureSkipVerify: true},\n          ExpectContinueTimeout : 30 * time.Second,\n        }\n\n    client := &amp;http.Client{ Transport:tr,\n                          Timeout: 20 * time.Second}\n\n    timeCurrent = time.Now()\n    fileContents, err := ioutil.ReadFile(uploadFileName)\n    if err != nil {\n     log.Println(\"Failed to Read the File\", uploadFileName, err)\n    }\n\n    PutReq, _ := http.NewRequest(\"PUT\", \"https://www.example.com/upload\", strings.NewReader(string(fileContents)))\n\n    PutReq.Header.Set(\"Content-Type\", \"application/zip\")\n    PutReq.ContentLength = int64(len(string(fileContents)))\n\n\n    PutReq.Header.Set(\"Expect\", \"100-continue\")\n    PutReq.Header.Set(\"Accept\", \"*/*\")\n    PutReq.Header.Set(\"Date\", timeCurrent.Format(time.RFC1123))\n    PutResp, err := client.Do(inventoryPutReq)\n    }\n</code></pre>\n\n<p>Sometimes I notice Connection RESET by PEER error. But most of the times it is 500. I try the exact same request using POSTMAN and it seems to work fine. </p>\n"}, {"tags": ["security", "go", "oauth-2.0"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1544512787, "post_id": 53718902, "comment_id": 94291758, "body": "1) <code>RedirectUri</code> is missing the scheme (&quot;https://&quot; presumably). 2) This is not a <a href=\"https://tools.ietf.org/html/rfc6749#section-4.1.3\" rel=\"nofollow noreferrer\">standard token request</a>. Standard requests use form data, not JSON, include a grant_type field, and no client secret. Double check the documentation and make sure you&#39;re supposed to send JSON."}], "answers": [{"tags": [], "owner": {"reputation": 470, "user_id": 9219620, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f7bddbf0c416e48b5224e84c43caf022?s=128&d=identicon&r=PG&f=1", "display_name": "Puneet", "link": "https://stackoverflow.com/users/9219620/puneet"}, "is_accepted": false, "score": -1, "last_activity_date": 1544595516, "creation_date": 1544595516, "answer_id": 53737144, "question_id": 53718902, "link": "https://stackoverflow.com/questions/53718902/how-to-get-authenticate-with-the-squareup-using-backend-golang/53737144#53737144", "title": "How to get authenticate with the squareup using backend golang?", "body": "<p>You have to do some points I mentioned:-</p>\n\n<ul>\n<li>First check your application Id.</li>\n<li>In second parameter <code>ClientSecret</code> you have to use Oauth Application Secret key Which you will got from the application dashboard -> Oauth option.</li>\n<li>In <code>Code</code> you don't have send the split code send simple string code value which your getting in the variable name <code>code</code>.</li>\n<li>Fourth parameter is optional as the documentation says <a href=\"https://docs.connect.squareup.com/api/oauth#post-token\" rel=\"nofollow noreferrer\">here</a>.</li>\n</ul>\n\n<p>Then you will got what you want :D.</p>\n"}], "owner": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1544595516, "creation_date": 1544511388, "last_edit_date": 1544511809, "question_id": 53718902, "link": "https://stackoverflow.com/questions/53718902/how-to-get-authenticate-with-the-squareup-using-backend-golang", "title": "How to get authenticate with the squareup using backend golang?", "body": "<p>In sqaureup application <code>Aplication_name</code> in oauth option there is a redirect url Which will redirect a given url with the QueryString code. While I'm hitting <code>https://connect.squareup.com/oauth2/authorize?client_id=YOUR_CLIENT_ID</code> this url in the browser then it will redirect me to a given url in oauth with attached code. And  then to take a <code>access_token</code> you have to give a <code>POST</code> request to given url <code>https://connect.squareup.com/oauth2/token</code> with the body </p>\n\n<pre><code>{\n  \"client_id\": \"YOUR_APPLICATION_ID\",\n  \"client_secret\": \"YOUR_APPLICATION_SECRET\",\n  \"code\": \"M-Q7k-N0Emx_3cBqwbVLTQ\",\n  \"redirect_uri\": \"YOUR_REDIRECT_URI\"\n}\n</code></pre>\n\n<p>I do it same and send By method <code>POST</code> to this url with json data but it will gives me the error:-</p>\n\n<pre><code>{\n \"message\": \"Not Authorized\",\n \"type\": \"service.not_authorized\"\n}\n</code></pre>\n\n<p>The Golang Code I'm using for this is :-</p>\n\n<pre><code>func Token(c *gin.Context) {\n code := c.Query(\"code\") // code be something like:-sq0cgp-wLVQt5HOLfug6xiVdmCDCf\n splitCode := strings.Split(code, \"-\")\n token := models.PostToken{\n    ClientID:     \"YOUR_APPLICATION_ID\",\n    ClientSecret: \"YOUR_APPLICATION_SECRET\",\n    Code:         splitCode[1],\n    RedirectUri:  c.Request.Host + c.Request.URL.RequestURI(),\n }\n bindData, err := json.Marshal(token)\n if err != nil {\n    panic(err)\n }\n   var jsonStr = []byte(string(bindData))\n   url := \"https://connect.squareup.com/oauth2/token\"\n   req, err := http.Post(url, \"application/json\", bytes.NewBuffer(jsonStr))\n   fmt.Println(req, err)\n}\n</code></pre>\n\n<p>Models struct:-</p>\n\n<pre><code>type PostToken struct {\n  ClientID     string `json:\"client_id\" bson:\"client_id\"`\n  ClientSecret string `json:\"client_secret\" bson:\"client_secret\"`\n  Code         string `json:\"code\" bson:\"code\"`\n  RedirectUri  string `json:\"redirect_uri\" bson:\"redirect_uri\"`\n}\n</code></pre>\n"}, {"tags": ["go", "numbers", "complextype"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1544510205, "post_id": 53718545, "comment_id": 94290804, "body": "In mathematics there are a <i>lot</i> of number systems. You might be familiar with natural numbers (0, 1, 2, 3, ...), whole numbers or integers (..., -2, -1, 0, 1, 2, ...), fractions, rationals (1/2, 7/9, -3/6), real numbers (3.14159, 7.2333...). Each system allows more calculations, e.g. you cannot dived 7 by 3 in the integers, but you can with fractions. Some things still cannot be done in reals (float64) like finding a x with <code>x*x == -1</code>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1544510494, "post_id": 53718545, "comment_id": 94290916, "body": "This is why there are more elaborate number systems like the complex numbers or quaternions. Complex numbers are kinda pair of two real numbers, one is named the real part and the other is named the imaginary part of the complex numbers. These are defined technical <i>names</i> (call them Hans and Horst if you get confused by real and imaginary). Do not think of an imaginary number as a real which is imaginary in the every day speed. This &quot;imaginary&quot; has a technical meaning and that meaning only. Google complex numbers or consult your school books for more details."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 5, "creation_date": 1544512439, "post_id": 53718545, "comment_id": 94291618, "body": "I&#39;m voting to close this question as off-topic because it is missing a basic understanding of what complex numbers are - this is a topic of math and not of software development. See <a href=\"https://en.wikipedia.org/wiki/Complex_number\" rel=\"nofollow noreferrer\">Wikipedia: Complex Number</a> for more information."}, {"owner": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 3, "creation_date": 1544514662, "post_id": 53718545, "comment_id": 94292479, "body": "<a href=\"http://math.stackexchange.com/\">Mathematics Stack Exchange</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1544540604, "post_id": 53718545, "comment_id": 94307125, "body": "If you don&#39;t know what complex, real, or imaginary numbers are, don&#39;t use those types. You don&#39;t need them."}], "answers": [{"tags": [], "owner": {"reputation": 177, "user_id": 9022359, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-6R4yW8qwpC4/AAAAAAAAAAI/AAAAAAAAAAc/FN8-Wu-zaXY/photo.jpg?sz=128", "display_name": "being of habits", "link": "https://stackoverflow.com/users/9022359/being-of-habits"}, "is_accepted": true, "score": 1, "last_activity_date": 1555074151, "last_edit_date": 1555074151, "creation_date": 1544510551, "answer_id": 53718734, "question_id": 53718545, "link": "https://stackoverflow.com/questions/53718545/whats-the-difference-between-real-and-imaginary-parts-of-a-complex-numer-in/53718734#53718734", "title": "What&#39;s the difference between &quot;real&quot; and &quot;imaginary&quot; parts of a complex numer in Go?", "body": "<p>The question isn't dedicated to GoLang, to be honest.</p>\n\n<p>Complex numbers are a mathematical concept.</p>\n\n<p>Here is an example:</p>\n\n<pre><code>import (\n  \"fmt\"\n  \"math/cmplx\"\n)\nfunc main() {\n  fmt.Println(cmplx.Sqrt(-1))\n}\n</code></pre>\n\n<p>Expected output:</p>\n\n<pre><code>(0+1i)\n</code></pre>\n\n<p>There is a package named \"cmplx\" to work with complex numbers. So Sqrt of cmplx is similar to math one, but it returns a complex number instead.</p>\n\n<p>As you see, and output consists of <code>0</code> and <code>1i</code>, and the last one is an imaginary part as we are not able to get a square root of <code>\"-1\"</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "is_accepted": false, "score": 1, "last_activity_date": 1560768949, "last_edit_date": 1560768949, "creation_date": 1544520109, "answer_id": 53720927, "question_id": 53718545, "link": "https://stackoverflow.com/questions/53718545/whats-the-difference-between-real-and-imaginary-parts-of-a-complex-numer-in/53720927#53720927", "title": "What&#39;s the difference between &quot;real&quot; and &quot;imaginary&quot; parts of a complex numer in Go?", "body": "<p>For complex numbers, see <a href=\"https://en.wikipedia.org/wiki/Complex_number\" rel=\"nofollow noreferrer\">Wikipedia</a>.</p>\n\n<p>The only Go-specific topic is that the \"complex\" types are built-in in Go, so unlike in other languages you can perform basic operations on them without importing additional packages:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n)\n\nfunc main() {\n  c1 := 1i\n  c2 := 2 + 3i\n  fmt.Println(c1 * c1) // i^2 = -1\n  fmt.Println(c1 + c2) // i + (2+3i) = 2+4i\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/VYUkRSLSct2\" rel=\"nofollow noreferrer\">Playground</a>.</p>\n\n<p>For more advanced operations, you can use the <code>math/cmplx</code> package, similar to the <code>math</code> package for real numbers (as in being of habits' answer).</p>\n"}], "owner": {"reputation": 3548, "user_id": 10415695, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ex5vb.jpg?s=128&g=1", "display_name": "LogicalBranch", "link": "https://stackoverflow.com/users/10415695/logicalbranch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 318, "favorite_count": 0, "closed_date": 1544592149, "accepted_answer_id": 53718734, "answer_count": 2, "score": -4, "last_activity_date": 1560768949, "creation_date": 1544509595, "last_edit_date": 1544515490, "question_id": 53718545, "link": "https://stackoverflow.com/questions/53718545/whats-the-difference-between-real-and-imaginary-parts-of-a-complex-numer-in", "closed_reason": "Not suitable for this site", "title": "What&#39;s the difference between &quot;real&quot; and &quot;imaginary&quot; parts of a complex numer in Go?", "body": "<p>I was reading Go's documentation for the <a href=\"https://godoc.org/builtin#complex128\" rel=\"nofollow noreferrer\">complex128</a> and <a href=\"https://godoc.org/builtin#complex64\" rel=\"nofollow noreferrer\">complex64</a> data types when I came across something odd:</p>\n\n<blockquote>\n  <p><em>\"complex128 is the set of all complex numbers with float64 real and imaginary parts.\"</em></p>\n</blockquote>\n\n<p>And:</p>\n\n<blockquote>\n  <p><em>\"complex64 is the set of all complex numbers with float32 real and imaginary parts.\"</em></p>\n</blockquote>\n\n<p>More specifically:</p>\n\n<blockquote>\n  <p><em>\"real and imaginary parts.\"</em></p>\n</blockquote>\n\n<p>What's meant by this? How can a number be <em>\"real\"</em> or <em>\"imaginary\"</em>?</p>\n"}, {"tags": ["web", "go", "logging", "websocket", "kubernetes"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1544511854, "post_id": 53718437, "comment_id": 94291397, "body": "Add code to read the connection as described <a href=\"https://godoc.org/github.com/gorilla/websocket#hdr-Control_Messages\" rel=\"nofollow noreferrer\">here</a>.   Otherwise, the code looks OK.  What problems are you having?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1544512273, "post_id": 53718437, "comment_id": 94291568, "body": "You&#39;re not handling the error from <code>conn.WriteMessage</code>, so the handler doesn&#39;t exit when the browser disconnects."}, {"owner": {"reputation": 1240, "user_id": 770721, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/9996cfcbfdc5bc1d57fe42ade6ca7978?s=128&d=identicon&r=PG", "display_name": "aisensiy", "link": "https://stackoverflow.com/users/770721/aisensiy"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1544512588, "post_id": 53718437, "comment_id": 94291681, "body": "@ThunderCat It did not look like a real time log, it flush serval seconds."}, {"owner": {"reputation": 1240, "user_id": 770721, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/9996cfcbfdc5bc1d57fe42ade6ca7978?s=128&d=identicon&r=PG", "display_name": "aisensiy", "link": "https://stackoverflow.com/users/770721/aisensiy"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1544512711, "post_id": 53718437, "comment_id": 94291736, "body": "@Peter So if <code>conn.WriteMessage</code> got <code>error</code> I should <code>return</code>?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1544513052, "post_id": 53718437, "comment_id": 94291865, "body": "How you handle the error is up to you. I can&#39;t tell you what&#39;s correct or reasonable for your use case."}, {"owner": {"reputation": 18939, "user_id": 2756409, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UIrGI.jpg?s=128&g=1", "display_name": "TylerH", "link": "https://stackoverflow.com/users/2756409/tylerh"}, "edited": false, "score": 0, "creation_date": 1544819960, "post_id": 53718437, "comment_id": 94424721, "body": "Best? Better? By what metrics?"}], "answers": [{"tags": [], "owner": {"reputation": 1240, "user_id": 770721, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/9996cfcbfdc5bc1d57fe42ade6ca7978?s=128&d=identicon&r=PG", "display_name": "aisensiy", "link": "https://stackoverflow.com/users/770721/aisensiy"}, "is_accepted": true, "score": 1, "last_activity_date": 1546042211, "creation_date": 1546042211, "answer_id": 53965609, "question_id": 53718437, "link": "https://stackoverflow.com/questions/53718437/expose-kubernetes-logs-to-browser-through-websocket/53965609#53965609", "title": "Expose kubernetes logs to browser through websocket", "body": "<p>Put my final code here, thanks for the tips from @Peter:</p>\n\n<pre><code>func serveWs(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    conn, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        if _, ok := err.(websocket.HandshakeError); !ok {\n            log.Println(err)\n        }\n        return\n    }\n\n    log.Println(\"create new connection\")\n\n    defer func() {\n        conn.Close()\n        log.Println(\"connection close\")\n    }()\n\n    logsClient, err := InitKubeLogsClient(config.InCluster)\n    if err != nil {\n        log.Println(err)\n        return\n    }\n\n    stream, err := logsClient.GetLogs(config.Namespace, config.PodName, config.ContainerName)\n    if err != nil {\n        log.Println(err)\n        return\n    }\n    defer stream.Close()\n    reader := bufio.NewReaderSize(stream, 16)\n    lastLine := \"\"\n    for {\n        data, isPrefix, err := reader.ReadLine()\n        if err != nil {\n            log.Println(err)\n            return\n        }\n\n        lines := strings.Split(string(data), \"\\r\")\n\n        length := len(lines)\n\n        if len(lastLine) &gt; 0 {\n            lines[0] = lastLine + lines[0]\n            lastLine = \"\"\n        }\n\n        if isPrefix {\n            lastLine = lines[length-1]\n            lines = lines[:(length - 1)]\n        }\n\n        for _, line := range lines {\n            if err := conn.WriteMessage(websocket.TextMessage, []byte(line)); err != nil {\n                log.Println(err)\n                return\n            }\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1240, "user_id": 770721, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/9996cfcbfdc5bc1d57fe42ade6ca7978?s=128&d=identicon&r=PG", "display_name": "aisensiy", "link": "https://stackoverflow.com/users/770721/aisensiy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 505, "favorite_count": 0, "accepted_answer_id": 53965609, "answer_count": 1, "score": 0, "last_activity_date": 1546042211, "creation_date": 1544509082, "question_id": 53718437, "link": "https://stackoverflow.com/questions/53718437/expose-kubernetes-logs-to-browser-through-websocket", "title": "Expose kubernetes logs to browser through websocket", "body": "<p>I am trying to use sidecar mode in kubernetes to create a logs sidecar to expose specific container logs. And I am using kubernetes client to fetch logs from kubernetes api and send it out by websocket. The code shows below:</p>\n\n<pre><code>func serveWs(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    conn, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        if _, ok := err.(websocket.HandshakeError); !ok {\n            log.Println(err)\n        }\n        return\n    }\n\n    defer conn.Close()\n\n    logsClient, err := InitKubeLogsClient(config.InCluster)\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    stream, err := logsClient.GetLogs(config.Namespace, config.PodName, config.ContainerName)\n    if err != nil {\n        log.Fatalln(err)\n    }\n    defer stream.Close()\n    reader := bufio.NewReader(stream)\n\n    for {\n        line, err := reader.ReadString('\\n')\n        if err != nil {\n            log.Fatalln(err)\n        }\n        conn.WriteMessage(websocket.TextMessage, []byte(line))\n    }\n}\n</code></pre>\n\n<p>I am using <a href=\"https://github.com/gorilla/websocket\" rel=\"nofollow noreferrer\">https://github.com/gorilla/websocket</a> as the websocket lib. And on the browser</p>\n\n<p>Is this the best way to do what I want? Is there some better way to just expose the logs api from k8s to websocket?</p>\n"}, {"tags": ["multithreading", "go", "concurrency", "real-time"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1544512142, "post_id": 53718146, "comment_id": 94291519, "body": "See<a href=\"https://github.com/golang/go/wiki/MutexOrChannel\" rel=\"nofollow noreferrer\">Mutex or Channel</a>.  Key points: use sync.Mutex for state as in the problem; don&#39;t be afraid to use sync.Mutex if it fits your problem."}], "answers": [{"comments": [{"owner": {"reputation": 1770, "user_id": 1054397, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f8218beaae675c36460465d04d068e69?s=128&d=identicon&r=PG", "display_name": "ardnew", "link": "https://stackoverflow.com/users/1054397/ardnew"}, "edited": false, "score": 0, "creation_date": 1544588281, "post_id": 53718448, "comment_id": 94325080, "body": "i wasn&#39;t aware of these atomic routines available in the standard lib. they reduce the size of critical sections, but they also increase the number of them. not sure yet which is easier to read, but this combined with @ThunderCat comment i&#39;m more confident in my approach. thanks a bunch"}, {"owner": {"reputation": 1770, "user_id": 1054397, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f8218beaae675c36460465d04d068e69?s=128&d=identicon&r=PG", "display_name": "ardnew", "link": "https://stackoverflow.com/users/1054397/ardnew"}, "edited": false, "score": 0, "creation_date": 1544805351, "post_id": 53718448, "comment_id": 94418695, "body": "and for the record, the 64-bit flavor of these atomic routines have <a href=\"https://golang.org/pkg/sync/atomic/#pkg-note-BUG\" rel=\"nofollow noreferrer\">a very easily overlooked bug</a> when running on 32-bit x86/ARM. be mindful of how you align 64-bit struct fields accessed via those routines... also, see <a href=\"https://github.com/golang/go/issues/599\" rel=\"nofollow noreferrer\">here</a>"}], "tags": [], "owner": {"reputation": 4669, "user_id": 63814, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/607eab54ab44ecd7ebefa443e1925596?s=128&d=identicon&r=PG", "display_name": "MahlerFive", "link": "https://stackoverflow.com/users/63814/mahlerfive"}, "is_accepted": true, "score": 3, "last_activity_date": 1544509165, "creation_date": 1544509165, "answer_id": 53718448, "question_id": 53718146, "link": "https://stackoverflow.com/questions/53718146/how-to-limit-concurrent-access-to-a-single-real-time-resource/53718448#53718448", "title": "How to limit concurrent access to a single real-time resource", "body": "<p>Since all you're doing is locking on a single counter, you could simplify and just use the <a href=\"https://golang.org/pkg/sync/atomic/\" rel=\"nofollow noreferrer\">sync/atomic</a> package. Call <code>AddInt32(&amp;x, 1)</code> when starting a goroutine, and <code>AddInt32(&amp;x, -1)</code> when ending it. Call <code>LoadInt32(&amp;x)</code> from your drawing goroutine.</p>\n"}, {"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1544513675, "post_id": 53718861, "comment_id": 94292104, "body": "I wouldn&#39;t call this coordination. I don&#39;t know the book, so I don&#39;t know if the author defined her use of the term, but to me it includes some kind of before/after relationship of goroutines. On the hand a counter is certainly state, and using a mutex to protect it seems much simpler than sending increments over a channel. I have never seen this in real code so far. Calling it &quot;more idiomatic&quot; than a mutex is a stretch."}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1544514300, "post_id": 53718861, "comment_id": 94292334, "body": "@Peter: Hi, Thanks for the comment, I made it more clear, do you agree with this now?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1544515917, "post_id": 53718861, "comment_id": 94293060, "body": "Not really, but I don&#39;t have to. I was just offering another point of view."}, {"owner": {"reputation": 1770, "user_id": 1054397, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f8218beaae675c36460465d04d068e69?s=128&d=identicon&r=PG", "display_name": "ardnew", "link": "https://stackoverflow.com/users/1054397/ardnew"}, "edited": false, "score": 0, "creation_date": 1544589317, "post_id": 53718861, "comment_id": 94325299, "body": "sorry i wasn&#39;t entirely clear, but i&#39;m not coordinating the number of goroutines from the UI; i&#39;m trying to reflect the current state of goroutines via UI (goroutines spawned from non-UI related events). also i&#39;m admittedly not that familiar with go, so this approach was initially more difficult for me to understand versus traditional mutex primitives."}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 1, "last_activity_date": 1544515173, "last_edit_date": 1544515173, "creation_date": 1544511195, "answer_id": 53718861, "question_id": 53718146, "link": "https://stackoverflow.com/questions/53718146/how-to-limit-concurrent-access-to-a-single-real-time-resource/53718861#53718861", "title": "How to limit concurrent access to a single real-time resource", "body": "<p>It is use case dependent (and you may choose what you wish, and no body cares until you produce a bug or hit the performance penalty), Channels hide Lock inside and make the coding <strong>simpler</strong> with a little performance cost - so I recommend using channels for the general use cases unless you are considering more  performance):<br>\nUse channels if:<br>\n1 - transferring ownership<br>\n2 - coordinating   </p>\n\n<p>Use primitives if:<br>\n3 - <strong>performance critical</strong><br>\n4 - Guarding internal state of struct<br>\nref: <a href=\"http://shop.oreilly.com/product/0636920046189.do\" rel=\"nofollow noreferrer\">page 33</a></p>\n\n<hr>\n\n<p>Since you are using soft real time UI coordinating the number of goroutines, and <strong>not performance critical</strong> code, I recommend using channels, I simplified your code <strong>here in this example</strong>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc main() {\n    for i := 0; i &lt; 100; i++ {\n        go job() // e.g.: run all jobs\n    }\n    busy := 0\n    time.Sleep(10 * time.Millisecond) // or make sure at least on goroutine started\n    // 10Hz:\n    tick := time.NewTicker(100 * time.Millisecond)\n    defer tick.Stop()\n    for {\n        select {\n        case n := &lt;-ch:\n            busy += n\n        case &lt;-tick.C:\n            // forces the UI to redraw all changed screen regions\n            fmt.Printf(\" %d    \\r\", busy)\n            if busy == 0 {\n                return\n            }\n        }\n    }\n}\n\nfunc job() {\n    ch &lt;- +1\n    time.Sleep(time.Duration(rand.Intn(2000)) * time.Millisecond)\n    ch &lt;- -1\n}\n\nvar ch = make(chan int, 1)\n</code></pre>\n"}], "owner": {"reputation": 1770, "user_id": 1054397, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f8218beaae675c36460465d04d068e69?s=128&d=identicon&r=PG", "display_name": "ardnew", "link": "https://stackoverflow.com/users/1054397/ardnew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 166, "favorite_count": 0, "accepted_answer_id": 53718448, "answer_count": 2, "score": 1, "last_activity_date": 1544515173, "creation_date": 1544507503, "question_id": 53718146, "link": "https://stackoverflow.com/questions/53718146/how-to-limit-concurrent-access-to-a-single-real-time-resource", "title": "How to limit concurrent access to a single real-time resource", "body": "<p>I'm trying to identify or understand an appropriate technique, idiom, whatever for a specific concurrent programming problem I'm having.</p>\n\n<p>For simplicity's sake, assume I have a real-time graphical user interface (UI) that is redrawn on screen at 10Hz always and forever. </p>\n\n<p>I would like to display a \"Busy\" indicator on this UI whenever at least one instance of a group of different threads are running, and I want that indicator to stop displaying when precisely 0 of these threads are running. These threads could feasibly be started and stopped at any time as long as the UI is up.</p>\n\n<p>I'm currently implementing this in golang (with relevant snippets further below). But in general, I'm solving this as follows:</p>\n\n<ul>\n<li><p>Keep R+W access to a counter int <code>waitCount</code> (number of threads requesting we indicate \"Busy\") protected via mutex <code>waitLock</code>.</p></li>\n<li><p>function <code>drawStatus()</code>: Redraw the entire UI (occurs every 100ms):</p>\n\n<ol>\n<li>acquire mutex <code>waitLock</code></li>\n<li>if int <code>waitCount</code> > 0:\n\n<ol start=\"2\">\n<li>draw the \"Busy\" indicator</li>\n</ol></li>\n<li>release mutex <code>waitLock</code></li>\n</ol></li>\n<li><p>function <code>startWait()</code>: When a thread needs to indicate busy:</p>\n\n<ol>\n<li>acquire mutex <code>waitLock</code></li>\n<li>increment int <code>waitCount</code></li>\n<li>release mutex <code>waitLock</code></li>\n</ol></li>\n<li><p>function <code>stopWait()</code>: When a thread no longer needs to indicate busy:</p>\n\n<ol>\n<li>acquire mutex <code>waitLock</code></li>\n<li>decrement int <code>waitCount</code></li>\n<li>release mutex <code>waitLock</code></li>\n</ol></li>\n</ul>\n\n<p>To me, it feels like I'm not taking full advantage of golang's concurrency facilities and resorting to the mutexes I'm familiar with. But even still, there is a bug in this code wherein the \"Busy\" indicator gets dismissed prematurely.</p>\n\n<p>I'm honestly not looking for anyone to help identify that bug, but rather I'm trying to convey the specific logic I'm interested in. Is there a more idiomatic golang way to approach this problem? Or is there a more general programming pattern that I should investigate? Does this technique I'm using have any particular name? And suggestions or pointers on doing this properly would be great. Thanks.</p>\n\n<hr>\n\n<p>And here's some doctor'd up snippets that implement the above logic</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>    var WaitCycle = [...]rune{'\ud83c\udf11', '\ud83c\udf12', '\ud83c\udf13', '\ud83c\udf14', '\ud83c\udf15', '\ud83c\udf16', '\ud83c\udf17', '\ud83c\udf18'}\n\n    // type Layout holds the high level components of the terminal user interface\n    type Layout struct {\n        //\n        // ... other fields hidden for example ...\n        //\n        waitLock  sync.Mutex\n        waitIndex int // the current index of the \"busy\" rune cycle\n        waitCount int // the current number of tasks enforcing the \"busy\" state\n    }\n\n    // function show() starts drawing the user interface.\n    func (l *Layout) show() *ReturnCode {\n\n        // timer forcing a redraw @ 10Hz\n        go func(l *Layout) {\n            tick := time.NewTicker(100 * time.Millisecond)\n            defer tick.Stop()\n            for {\n                select {\n                case &lt;-tick.C:\n                    // forces the UI to redraw all changed screen regions\n                    l.ui.QueueUpdateDraw(func() {})\n                }\n            }\n        }(l)\n\n        if err := l.ui.Run(); err != nil {\n            return rcTUIError.specf(\"show(): ui.Run(): %s\", err)\n        }\n        return nil\n    }\n\n    // function drawStatus() draws the \"Busy\" indicator at a specific UI position\n    func (l *Layout) drawStatus(...) {\n\n        l.waitLock.Lock()\n        if l.waitCount &gt; 0 {\n          l.waitIndex = (l.waitIndex + 1) % WaitCycleLength\n          waitRune := fmt.Sprintf(\" %c \", WaitCycle[l.waitIndex])\n          drawToScreen(waitRune, x-1, y, width)\n        }\n        l.waitLock.Unlock()\n    }\n\n    // function startWait() safely fires off the \"Busy\" indicator on the status bar\n    // by resetting the current index of the status rune cycle and incrementing the\n    // number of goroutines requesting the \"Busy\" indicator.\n    func (l *Layout) startWait() {\n        l.waitLock.Lock()\n        if 0 == l.waitCount {\n          l.waitIndex = 0\n        }\n        l.waitCount++\n        l.waitLock.Unlock()\n    }\n\n    // function stopWait() safely hides the \"Busy\" indicator on the status bar by\n    // decrementing the number of goroutines requesting the \"Busy\" indicator.\n    func (l *Layout) stopWait() {\n        l.waitLock.Lock()\n        l.waitCount--\n        l.waitLock.Unlock()\n    }\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 11, "user_id": 10769022, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mQHEsVCb7o0/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jYosTpWUE0Ymr4WXjXZV7hIMEyPA/mo/photo.jpg?sz=128", "display_name": "Neetha P U", "link": "https://stackoverflow.com/users/10769022/neetha-p-u"}, "edited": false, "score": 0, "creation_date": 1544505495, "post_id": 53717547, "comment_id": 94289345, "body": "Thank you.. I was trying to analyzing this part of code  func (cdc *Codec) parseFieldOptions(field reflect.StructField) (skip bool, fopts FieldOptions) { \tbinTag := field.Tag.Get(&quot;binary&quot;) \taminoTag := field.Tag.Get(&quot;amino&quot;) jsonTag := field.Tag.Get(&quot;json&quot;)"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1544504931, "last_edit_date": 1544504931, "creation_date": 1544504546, "answer_id": 53717649, "question_id": 53717547, "link": "https://stackoverflow.com/questions/53717547/what-is-the-value-assigned-to-bintag-after-this-line-bintag-field-tag-get/53717649#53717649", "title": "what is the value assigned to &quot;bintag&quot; after this line &quot;binTag := field.Tag.Get(&quot;binary&quot;)&quot; where field is one of the struct field in GOLang", "body": "<p>See the <a href=\"https://godoc.org/reflect#StructTag\" rel=\"nofollow noreferrer\">StructTag documentation</a> for a description of the tag format.  </p>\n\n<p>See the <a href=\"https://godoc.org/reflect#example-StructTag\" rel=\"nofollow noreferrer\">StructTag example</a> and the <a href=\"https://godoc.org/reflect#example-StructTag\" rel=\"nofollow noreferrer\">StructTag.Lookup</a> examples examples of tags.</p>\n\n<p>The value of <code>binTag</code> is <code>\"\"</code> because the tag does not contain a value for the key \"binary\", nor does the tag following the convention for formatting struct tags.</p>\n\n<p>This code shows how to access the tag:</p>\n\n<pre><code>v := reflect.TypeOf(T{})\nsf, _ := v.FieldByName(\"f1\")\nfmt.Println(sf.Tag)               // prints \"f one\"\nfmt.Println(sf.Tag.Get(\"binary\")) // prints blank line\n</code></pre>\n\n<p>Here's an example with a valid tag with key \"binary\":</p>\n\n<pre><code>type U struct {\n    g1 string `binary:\"hello\"`\n}\n\nv := reflect.TypeOf(U{})\nsf, _ := v.FieldByName(\"g1\")\nfmt.Println(sf.Tag)               // prints binary:\"hello\"\nfmt.Println(sf.Tag.Get(\"binary\")) // prints hello\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 10769022, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-mQHEsVCb7o0/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jYosTpWUE0Ymr4WXjXZV7hIMEyPA/mo/photo.jpg?sz=128", "display_name": "Neetha P U", "link": "https://stackoverflow.com/users/10769022/neetha-p-u"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 1, "accepted_answer_id": 53717649, "answer_count": 1, "score": -2, "last_activity_date": 1544504931, "creation_date": 1544503922, "last_edit_date": 1544504791, "question_id": 53717547, "link": "https://stackoverflow.com/questions/53717547/what-is-the-value-assigned-to-bintag-after-this-line-bintag-field-tag-get", "title": "what is the value assigned to &quot;bintag&quot; after this line &quot;binTag := field.Tag.Get(&quot;binary&quot;)&quot; where field is one of the struct field in GOLang", "body": "<p>I was trying to analyse the GO program, when I encountered this line<br>\n<em>\"binTag := field.Tag.Get(\"binary\")\"</em><br>\nI was confused with value that <em>\"binTag\"</em> will be assigned.</p>\n\n<p>I searched in the GO reflect Package for the syntax explanation and I found this,</p>\n\n<p><strong><em>func (tag StructTag) Get(key string) string</em></strong></p>\n\n<p><em>Get returns the value associated with key in the tag string. If there is no such key in the tag, Get returns the empty string. If the tag does not have the conventional format, the value returned by Get is unspecified. To determine whether a tag is explicitly set to the empty string, use Lookup.</em></p>\n\n<p>Then I searched what is Tag mean in Golang, as an example I got this</p>\n\n<p><em>Tag</em></p>\n\n<p><em>A field declaration may be followed by an optional string literal (tag) which becomes an attribute of all the fields in the corresponding field declaration.</em></p>\n\n<pre><code>type T struct {\n    f1     string \"f one\"\n    f2     string\n    f3     string `f three`\n    f4, f5 int64  `f four and five`\n}\n</code></pre>\n\n<p>So, now I am bit confused on exact value assigned to <em>\"binTag\"</em> after execution.</p>\n\n<p><strong>Thanks in Advance.</strong></p>\n"}, {"tags": ["macos", "qt", "go", "sparkle"], "comments": [{"owner": {"reputation": 2576, "user_id": 631612, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/b7d2a769fa193f9efa36668148deb9f5?s=128&d=identicon&r=PG", "display_name": "quanta", "link": "https://stackoverflow.com/users/631612/quanta"}, "edited": false, "score": 0, "creation_date": 1545303152, "post_id": 53717370, "comment_id": 94581561, "body": "The reason is <code>NSAlert</code> needs a run loop to work. I asked another question: <a href=\"https://stackoverflow.com/questions/53772889/how-to-start-gos-main-function-from-within-the-nsapplication-event-loop\" title=\"how to start gos main function from within the nsapplication event loop\">stackoverflow.com/questions/53772889/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2576, "user_id": 631612, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/b7d2a769fa193f9efa36668148deb9f5?s=128&d=identicon&r=PG", "display_name": "quanta", "link": "https://stackoverflow.com/users/631612/quanta"}, "is_accepted": true, "score": 0, "last_activity_date": 1545703966, "creation_date": 1545703966, "answer_id": 53918866, "question_id": 53717370, "link": "https://stackoverflow.com/questions/53717370/no-up-to-date-message-when-running-the-latest-version/53918866#53918866", "title": "No &quot;up to date&quot; message when running the latest version?", "body": "<p>Look carefully at the <a href=\"https://github.com/sparkle-project/Sparkle/blob/master/Sparkle/SUUpdater.h#L86\" rel=\"nofollow noreferrer\"><code>checkForUpdatesInBackground</code></a>:</p>\n\n<pre><code>/*!\n Checks for updates, but does not display any UI unless an update is found.\n\n This is meant for programmatically initating a check for updates. That is,\n it will display no UI unless it actually finds an update, in which case it\n proceeds as usual.\n\n If automatic downloading of updates it turned on and allowed, however,\n this will invoke that behavior, and if an update is found, it will be downloaded\n in the background silently and will be prepped for installation.\n\n This will not find updates that the user has opted into skipping.\n */\n- (void)checkForUpdatesInBackground;\n</code></pre>\n\n<p>So, with this method, the UI will only be shown if an update is found.</p>\n\n<p>What I want is <a href=\"https://github.com/sparkle-project/Sparkle/blob/master/Sparkle/SUUpdater.h#L66\" rel=\"nofollow noreferrer\"><code>checkForUpdates</code></a>:</p>\n\n<pre><code>/*!\n Explicitly checks for updates and displays a progress dialog while doing so.\n\n This method is meant for a main menu item.\n Connect any menu item to this action in Interface Builder,\n and Sparkle will check for updates and report back its findings verbosely\n when it is invoked.\n\n This will find updates that the user has opted into skipping.\n */\n - (IBAction)checkForUpdates:(id)sender;\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/juxna.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/juxna.jpg\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 2576, "user_id": 631612, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/b7d2a769fa193f9efa36668148deb9f5?s=128&d=identicon&r=PG", "display_name": "quanta", "link": "https://stackoverflow.com/users/631612/quanta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 299, "favorite_count": 1, "accepted_answer_id": 53918866, "answer_count": 1, "score": 6, "last_activity_date": 1545703966, "creation_date": 1544502360, "last_edit_date": 1544577647, "question_id": 53717370, "link": "https://stackoverflow.com/questions/53717370/no-up-to-date-message-when-running-the-latest-version", "title": "No &quot;up to date&quot; message when running the latest version?", "body": "<p>I'm trying to use <a href=\"https://sparkle-project.org\" rel=\"noreferrer\">Sparkle</a> with Qt (<a href=\"https://github.com/therecipe/qt\" rel=\"noreferrer\">binding for Go</a>) app.</p>\n\n<p>sparkle.m:</p>\n\n<pre><code>#import &lt;Headers/SUUpdater.h&gt;\n\nstatic SUUpdater* updater = nil;\n\nvoid sparkle_checkUpdates()\n{\n    if (!updater) {\n        updater = [[SUUpdater sharedUpdater] retain];\n    }\n\n    [updater setUpdateCheckInterval:3600];\n    [updater checkForUpdatesInBackground];\n}\n</code></pre>\n\n<p>sparke.go:</p>\n\n<pre><code>// +build darwin windows\n\npackage main\n\n/*\n#cgo CFLAGS: -I ${SRCDIR}/Sparkle.framework\n#cgo LDFLAGS: -F ${SRCDIR} -framework Sparkle\n\nvoid sparkle_checkUpdates();\n*/\nimport \"C\"\n\nfunc sparkle_checkUpdates() {\n    C.sparkle_checkUpdates()\n}\n</code></pre>\n\n<p>And in <code>main.go</code>, I added a menu to call that func:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/therecipe/qt/widgets\"\n)\n\nfunc main() {\n    action := widgets.NewQMenuBar(nil).AddMenu2(\"\").AddAction(\"Check for Updates...\")\n    // http://doc.qt.io/qt-5/qaction.html#MenuRole-enum\n    action.SetMenuRole(widgets.QAction__ApplicationSpecificRole)\n    action.ConnectTriggered(func(bool) { sparkle_checkUpdates() })\n}\n</code></pre>\n\n<p>It is working fine when there is an update: download, extract, install, relaunch, ...\n<a href=\"https://i.stack.imgur.com/9sdDZ.jpg\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/9sdDZ.jpg\" alt=\"enter image description here\"></a>\nBut when running the latest version, click \"Check for Updates...\" menu and nothing happens. There is no popup said that we are up-to-date, something like this:\n<a href=\"https://i.stack.imgur.com/shOlW.png\" rel=\"noreferrer\"><img src=\"https://i.stack.imgur.com/shOlW.png\" alt=\"enter image description here\"></a>\nIn Console, I only see this:</p>\n\n<pre><code>[3 &lt;private&gt; stream, pid: 90977, url: https://example.com/appcast.xml, traffic class: 200, tls] cancelled\n    [3.1 70A1F65B-7E7A-4ED2-AB8B-A21621ED7658 &lt;private&gt;.58040&lt;-&gt;&lt;private&gt;]\n    Connected Path: satisfied (Path is satisfied), interface: en0, ipv4, dns\n    Duration: 0.497s, DNS @0.000s took 0.001s, TCP @0.003s took 0.051s, TLS took 0.113s\n    bytes in/out: 4481/675, packets in/out: 6/3, rtt: 0.053s, retransmitted packets: 0, out-of-order packets: 0\n</code></pre>\n\n<p>appcast.xml:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" standalone=\"yes\"?&gt;\n&lt;rss xmlns:sparkle=\"http://www.andymatuschak.org/xml-namespaces/sparkle\" version=\"2.0\"&gt;\n  &lt;channel&gt;\n    &lt;title&gt;Premium VPN&lt;/title&gt;\n    &lt;item&gt;\n      &lt;title&gt;1.0.0.2905&lt;/title&gt;\n      &lt;pubDate&gt;Tue, 11 Dec 2018 11:09:10 +0800&lt;/pubDate&gt;\n      &lt;sparkle:minimumSystemVersion&gt;10.7&lt;/sparkle:minimumSystemVersion&gt;\n      &lt;enclosure url=\"https://example.com/x.zip\" sparkle:version=\"1.0.0.2905\" sparkle:shortVersionString=\"1.0.0.2905\" sparkle:edSignature=\"x\" length=\"104408678\" type=\"application/octet-stream\"/&gt;\n    &lt;/item&gt;\n  &lt;/channel&gt;\n&lt;/rss&gt;\n</code></pre>\n\n<p>Info.plist:</p>\n\n<pre><code>    &lt;key&gt;SUFeedURL&lt;/key&gt;\n    &lt;string&gt;https://example.com/appcast.xml&lt;/string&gt;\n    &lt;key&gt;SUPublicEDKey&lt;/key&gt;\n    &lt;string&gt;x&lt;/string&gt;\n</code></pre>\n\n<p>Did I miss something?</p>\n"}, {"tags": ["amazon-web-services", "go", "https"], "comments": [{"owner": {"reputation": 2869, "user_id": 1082646, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Iwxkz.jpg?s=128&g=1", "display_name": "shapeshifter", "link": "https://stackoverflow.com/users/1082646/shapeshifter"}, "edited": false, "score": 2, "creation_date": 1544500273, "post_id": 53717087, "comment_id": 94288068, "body": "There&#39;s a space in your address string.  Should be &quot;:443&quot;."}, {"owner": {"reputation": 29, "user_id": 6665689, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd8f21752807e3e69d39793b8ed679ee?s=128&d=identicon&r=PG&f=1", "display_name": "QuanDT", "link": "https://stackoverflow.com/users/6665689/quandt"}, "reply_to_user": {"reputation": 2869, "user_id": 1082646, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Iwxkz.jpg?s=128&g=1", "display_name": "shapeshifter", "link": "https://stackoverflow.com/users/1082646/shapeshifter"}, "edited": false, "score": 0, "creation_date": 1544502652, "post_id": 53717087, "comment_id": 94288555, "body": "Really thanks! You save my day! I can&#39;t believe it cause by a simple mistake like that :))"}], "owner": {"reputation": 29, "user_id": 6665689, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd8f21752807e3e69d39793b8ed679ee?s=128&d=identicon&r=PG&f=1", "display_name": "QuanDT", "link": "https://stackoverflow.com/users/6665689/quandt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1544520964, "creation_date": 1544499964, "last_edit_date": 1544520964, "question_id": 53717087, "link": "https://stackoverflow.com/questions/53717087/golang-https-setting-trouble", "title": "Golang https setting trouble", "body": "<p>I'm having trouble setting up https on AWS:</p>\n\n<p>I get a certificate from letsencrypt by using certbot command on my server:</p>\n\n<pre><code>./certbot-auto certonly --standalone -d go.minmacro.com --debug --agree-tos\n</code></pre>\n\n<p>and I got success message:</p>\n\n<p>Congratulations! Your certificate and chain have been saved at:</p>\n\n<blockquote>\n  <p>/etc/letsencrypt/live/go.minmacro.com/fullchain.pem</p>\n</blockquote>\n\n<p>Your key file has been saved at:</p>\n\n<blockquote>\n  <p>/etc/letsencrypt/live/go.minmacro.com/privkey.pem</p>\n</blockquote>\n\n<p>in my go code i'm using:</p>\n\n<pre><code>err := http.ListenAndServeTLS(\":443 \", \"/etc/letsencrypt/live/go.minmacro.com/fullchain.pem\", \"/etc/letsencrypt/live/go.minmacro.com/privkey.pem\", r)\n\nfmt.Println(err)\n</code></pre>\n\n<p>when i run this code, go thrown an error:</p>\n\n<blockquote>\n  <p>listen tcp: address tcp/443 : unknown port</p>\n</blockquote>\n\n<p>even though i've already added https to my sercurity group</p>\n\n<p>Could anyone give me a suggestion? I've been struggle with this trouble for few days</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 770, "user_id": 2100305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e8fc185f148ce14611ff3dbf19a1d68?s=128&d=identicon&r=PG", "display_name": "Alice Heaton", "link": "https://stackoverflow.com/users/2100305/alice-heaton"}, "edited": false, "score": 0, "creation_date": 1544693855, "post_id": 53716468, "comment_id": 94369699, "body": "I don&#39;t have Windows and can&#39;t try this myself, but reading the documentation and issue queue of Webview it is stated that it uses MSHTML (IE10 or IE11) on Windows. There is work in progress to make it support Edge, and that is not yet finished, see: <a href=\"https://github.com/zserge/webview/issues/85\" rel=\"nofollow noreferrer\">github.com/zserge/webview/issues/85</a> . Are you sure it&#39;s using Edge? Maybe you&#39;re having a different issue - such ActiveX controls being disabled for security reasons?"}, {"owner": {"reputation": 49, "user_id": 6729608, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d069a5489b0107ee595f0c1f32f8738f?s=128&d=identicon&r=PG&f=1", "display_name": "user6729608", "link": "https://stackoverflow.com/users/6729608/user6729608"}, "reply_to_user": {"reputation": 770, "user_id": 2100305, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e8fc185f148ce14611ff3dbf19a1d68?s=128&d=identicon&r=PG", "display_name": "Alice Heaton", "link": "https://stackoverflow.com/users/2100305/alice-heaton"}, "edited": false, "score": 0, "creation_date": 1545393230, "post_id": 53716468, "comment_id": 94615026, "body": "Thanks for you comments, By use JavaScript web browser test, the results is Edge, from now on,I don\u2019t have solutions to deal this issue, so I change to use C# to implement the requirements"}], "owner": {"reputation": 49, "user_id": 6729608, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d069a5489b0107ee595f0c1f32f8738f?s=128&d=identicon&r=PG&f=1", "display_name": "user6729608", "link": "https://stackoverflow.com/users/6729608/user6729608"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 600, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1544514371, "creation_date": 1544494874, "last_edit_date": 1544514371, "question_id": 53716468, "link": "https://stackoverflow.com/questions/53716468/how-can-i-specified-a-browser-in-golang-webview", "title": "How can I specified a browser in golang webview?", "body": "<p>I need build native app in windows, but in some case, I need integrate an IE to call active X plugin,  so I use <a href=\"https://github.com/zserge/webview\" rel=\"nofollow noreferrer\">zserge/webview</a> to open the page. but webview use EDG by default in window 10, my question is. How can I specify IE webview?</p>\n"}, {"tags": ["go", "intellij-idea", "goland"], "answers": [{"comments": [{"owner": {"reputation": 2121, "user_id": 874076, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/fee340a9680083fcb62accb860f66fb9?s=128&d=identicon&r=PG", "display_name": "Kilokahn", "link": "https://stackoverflow.com/users/874076/kilokahn"}, "edited": false, "score": 0, "creation_date": 1544586594, "post_id": 53727524, "comment_id": 94324697, "body": "Thanks! will try out with the new version."}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": false, "score": 2, "last_activity_date": 1544542746, "creation_date": 1544542746, "answer_id": 53727524, "question_id": 53716270, "link": "https://stackoverflow.com/questions/53716270/intellij-golang-plugin-debug-always-compiles/53727524#53727524", "title": "intellij golang plugin debug always compiles", "body": "<p>Regardless if you use IntelliJ IDEA Ultimate or GoLand, the IDE won't compile the source code itself, it will defer that to the Go compiler.</p>\n\n<p>If you want to speed up the compilation step, upgrade to the latest Go available, Go 1.11.2 at the time of writing, as the Go compiler suffered massive improvements to build caching in Go 1.10. As you haven't specified which Go version you are running, I'm going to assume it's 1.9 or earlier.</p>\n"}], "owner": {"reputation": 2121, "user_id": 874076, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/fee340a9680083fcb62accb860f66fb9?s=128&d=identicon&r=PG", "display_name": "Kilokahn", "link": "https://stackoverflow.com/users/874076/kilokahn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 153, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1544586437, "creation_date": 1544493261, "last_edit_date": 1544586437, "question_id": 53716270, "link": "https://stackoverflow.com/questions/53716270/intellij-golang-plugin-debug-always-compiles", "title": "intellij golang plugin debug always compiles", "body": "<p>i am using <code>181.4668.90</code> version of the Go plugin in Intellij and everything looks great. When debugging a golang test case, it necessarily does a <code>compiling</code> step, which is somewhat understandable. However, even when there is no changes to the golang source code, in the subsequent debug invocation, there is again the <code>compiling</code> step, which takes up a pretty significant amount of time. </p>\n\n<p>Are there any workarounds that can be employed? I don't see any exceptions or the kind on the ide logs.</p>\n\n<p>In general, does Intellij look for the compiled sources to be available on <code>GOPATH</code> before starting the debugger?\n Thanks!</p>\n\n<p><code>\nIntelliJ IDEA 2018.1.3 (Ultimate Edition)\nBuild #IU-181.4892.42, built on May 7, 2018\nmacOS 10.13.5\ngo version go1.9.6 darwin/amd64\n</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1544491593, "post_id": 53715796, "comment_id": 94286392, "body": "&quot;I will remove items&quot; How, exactly."}, {"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1544498570, "post_id": 53715796, "comment_id": 94287744, "body": "@peterSO so if I am storing the items in a slice I would do <code>a = append(a[:i], a[i+1:]...)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1544501708, "last_edit_date": 1544501708, "creation_date": 1544499855, "answer_id": 53717070, "question_id": 53715796, "link": "https://stackoverflow.com/questions/53715796/understanding-how-memory-allocation-works-and-the-garbage-collector/53717070#53717070", "title": "Understanding how memory allocation works and the garbage collector", "body": "<p>How, exactly, will you remove items?</p>\n\n<blockquote>\n  <p>Comment:</p>\n  \n  <p>so if I am storing the items in a slice I would do a = append(a[:i],\n  a[i+1:]...) \u2013 Blankman</p>\n</blockquote>\n\n<p>Which may or may not work. What type is the slice?</p>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://github.com/golang/go/wiki/SliceTricks\" rel=\"nofollow noreferrer\">Go SliceTricks</a></p>\n  \n  <p>Cut</p>\n\n<pre><code>a = append(a[:i], a[j:]...)\n</code></pre>\n  \n  <p>Delete</p>\n\n<pre><code>a = append(a[:i], a[i+1:]...)\n// or\na = a[:i+copy(a[i:], a[i+1:])]\n</code></pre>\n  \n  <p>Delete without preserving order</p>\n\n<pre><code>a[i] = a[len(a)-1] \na = a[:len(a)-1]\n</code></pre>\n  \n  <p>NOTE If the type of the element is a pointer or a struct with pointer\n  fields, which need to be garbage collected, the above implementations\n  of Cut and Delete have a potential memory leak problem: some elements\n  with values are still referenced by slice a and thus can not be\n  collected. The following code can fix this problem:</p>\n  \n  <p>Cut</p>\n\n<pre><code>copy(a[i:], a[j:])\nfor k, n := len(a)-j+i, len(a); k &lt; n; k++ {\n  a[k] = nil // or the zero value of T\n}\na = a[:len(a)-j+i]\n</code></pre>\n  \n  <p>Delete</p>\n\n<pre><code>copy(a[i:], a[i+1:])\na[len(a)-1] = nil // or the zero value of T\na = a[:len(a)-1]\n</code></pre>\n  \n  <p>Delete without preserving order</p>\n\n<pre><code>a[i] = a[len(a)-1]\na[len(a)-1] = nil\na = a[:len(a)-1]\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>In simple terms, the Go GC (garbage collector) retains memory until it is no longer used. Amongst other things, the GC follows all pointers in used memory, a deep usage analysis.</p>\n\n<hr>\n\n<p><a href=\"https://golang.org/doc/faq\" rel=\"nofollow noreferrer\">Go Frequently Asked Questions (FAQ)</a>: <a href=\"https://golang.org/doc/faq#garbage_collection\" rel=\"nofollow noreferrer\">Why do garbage collection? Won't it be too expensive?</a></p>\n\n<p><a href=\"https://blog.golang.org/go15gc\" rel=\"nofollow noreferrer\">The Go Blog: Go GC: Prioritizing low latency and simplicity</a></p>\n\n<p><a href=\"https://blog.golang.org/ismmkeynote\" rel=\"nofollow noreferrer\">The Go Blog: Getting to Go: The Journey of Go's Garbage Collector</a></p>\n\n<p><a href=\"https://docs.google.com/document/d/16Y4IsnNRCN43Mx0NZc5YXZLovrHvvLhK_h0KN8woTO4/\" rel=\"nofollow noreferrer\">Go 1.4+ GC Plan and Roadmap</a></p>\n\n<p><a href=\"http://gchandbook.org/\" rel=\"nofollow noreferrer\">The Garbage Collection Handbook: The Art of Automatic Memory Management (Chapman &amp; Hall/CRC Applied Algorithms and Data Structures series) R. Jones, A. Hosking, E. Moss</a></p>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 1, "answer_count": 1, "score": -4, "last_activity_date": 1544511085, "creation_date": 1544488677, "last_edit_date": 1544511085, "question_id": 53715796, "link": "https://stackoverflow.com/questions/53715796/understanding-how-memory-allocation-works-and-the-garbage-collector", "title": "Understanding how memory allocation works and the garbage collector", "body": "<p>Say I am making an in-memory cache of several gigs.\nIn order to free up space when the cache is reaching its maximum size, I will remove items that have not been accessed as often.</p>\n\n<p>When I remove these items, will the memory be freed up for the computer to allocate to other processes and/or my application?\nI know Go uses a garbage collector so presumably, the operating system will not have access to that memory until it is garbage collected and then my application will consume fewer memory resources.</p>\n\n<p>Is this correct?</p>\n"}, {"tags": ["go", "channel"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1544464200, "post_id": 53710814, "comment_id": 94276510, "body": "That&#39;s how channels work. When receiving on a channel, it waits until there is something to receieve. Likewise when sending on a channel, it waits until something is available to receive it. This is covered in the <a href=\"https://tour.golang.org/concurrency/2\" rel=\"nofollow noreferrer\">Tour of Go</a>."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1544467511, "post_id": 53710814, "comment_id": 94277952, "body": "Note that executing <code>receiverSide</code> in a goroutine is silly here, since main doesn&#39;t do anything until <code>receiverSide</code> is done."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 9618663, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Tung Luu", "link": "https://stackoverflow.com/users/9618663/tung-luu"}, "edited": false, "score": 0, "creation_date": 1544464821, "post_id": 53710977, "comment_id": 94276771, "body": "I mean that If I have only a goroutine <code>go senderSide(data)</code> and adding <code>close(data)</code> at the end senderSide function, the program will print <code>Result: 15</code> right? And I want the program should print <code>Result: 30</code> when I call one more <code>go senderSide(data)</code> and so on. How can I achieve it?"}, {"owner": {"reputation": 21, "user_id": 9618663, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Tung Luu", "link": "https://stackoverflow.com/users/9618663/tung-luu"}, "edited": false, "score": 0, "creation_date": 1544465118, "post_id": 53710977, "comment_id": 94276911, "body": "But multiple goroutines are using that channel. Close will cause <b>panic: send on closed channel</b> when other goroutine send data on it."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 21, "user_id": 9618663, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Tung Luu", "link": "https://stackoverflow.com/users/9618663/tung-luu"}, "edited": false, "score": 0, "creation_date": 1544465244, "post_id": 53710977, "comment_id": 94276966, "body": "Yes, you have to wait until both goroutines finish to close the channel."}, {"owner": {"reputation": 21, "user_id": 9618663, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Tung Luu", "link": "https://stackoverflow.com/users/9618663/tung-luu"}, "edited": false, "score": 0, "creation_date": 1544465551, "post_id": 53710977, "comment_id": 94277100, "body": "Sorry, but I  really don&#39;t know when both goroutines finish to close. Adding <code>close(data)</code> at the end <code>senderSide</code> function didn&#39;t work."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 21, "user_id": 9618663, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Tung Luu", "link": "https://stackoverflow.com/users/9618663/tung-luu"}, "edited": false, "score": 2, "creation_date": 1544467314, "post_id": 53710977, "comment_id": 94277873, "body": "@TungLuu, use a <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">sync.WaitGroup</a> to wait for both senders to finish, then close the channel."}, {"owner": {"reputation": 21, "user_id": 9618663, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Tung Luu", "link": "https://stackoverflow.com/users/9618663/tung-luu"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1544486333, "post_id": 53710977, "comment_id": 94285294, "body": "@Peter thank you so much, your solution is great. It works :D"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1544464067, "creation_date": 1544464067, "answer_id": 53710977, "question_id": 53710814, "link": "https://stackoverflow.com/questions/53710814/how-does-receiver-side-know-data-on-a-single-channel-was-empty-if-there-are-mult/53710977#53710977", "title": "How does receiver side know data on a single channel was empty if there are multiple senders send data on that channel?", "body": "<p>I don't really understand your question, but the deadlock is simple to explain. You never close the <code>data</code> chan, so the loop in <code>recevierSide</code> never closes, because it's constantly waiting for more data.</p>\n\n<p>This in turn means it never sends the response, so the program deadlocks.</p>\n"}], "owner": {"reputation": 21, "user_id": 9618663, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Tung Luu", "link": "https://stackoverflow.com/users/9618663/tung-luu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1544464067, "creation_date": 1544463420, "question_id": 53710814, "link": "https://stackoverflow.com/questions/53710814/how-does-receiver-side-know-data-on-a-single-channel-was-empty-if-there-are-mult", "title": "How does receiver side know data on a single channel was empty if there are multiple senders send data on that channel?", "body": "<p>I have a simple example and don't know how to fix it to make it works as I expected. </p>\n\n<p>It should print <code>Result: 30</code> but the screen showed: <strong>fatal error: all goroutines are asleep - deadlock!</strong></p>\n\n<p>I think the problem at here is the statement <code>for val := range data</code>. It still wait to receive data when the data channel was empty. But I don't how to solve it, please help me out.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc senderSide(data chan int) {\n    num := 5\n    for i := 1; i &lt;= num; i++ {\n        data &lt;- i\n    }\n    // close(data) //panic: send on closed channel if uncomment it\n}\n\nfunc receiverSide(data chan int, resp chan int) {\n    sum := 0\n    for val := range data {\n        sum += val\n    }\n    resp &lt;- sum\n}\n\nfunc main() {\n    data := make(chan int)\n    resp := make(chan int)\n    go senderSide(data)\n    go senderSide(data)\n    go receiverSide(data, resp)\n    result := &lt;-resp\n    fmt.Printf(\"Result: %v\\n\", result) //result = 30\n}\n</code></pre>\n"}, {"tags": ["go", "mutex"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544458999, "post_id": 53709617, "comment_id": 94273790, "body": "&quot;unlock of unlocked mutex&quot; means just what it says - something is calling <code>Unlock</code> on a mutex that isn&#39;t locked, which is not allowed. This isn&#39;t possible from the code shown, so it&#39;s being caused somewhere in the code that is not shown. Please post a <a href=\"https://stackoverflow.com/help/mcve\">Minimal, Complete, Verifiable Example</a> that reproduces the issue."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1544459075, "post_id": 53709617, "comment_id": 94273838, "body": "Also note that your code makes no sense as written, because the mutex is created inside the function where it&#39;s used. Thus each call to <code>handle</code> will be using its own mutex, and there will be no actual mutual exclusion."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1544459151, "post_id": 53709617, "comment_id": 94273882, "body": "This example is reassigning <code>mutex</code> every time <code>handle</code> is called, which sort of defeats the purpose of the mutex. Is that the actual code, and have to tried it with the race detector?"}, {"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "edited": false, "score": 0, "creation_date": 1544459292, "post_id": 53709617, "comment_id": 94273955, "body": "The other logic of this example do http call to login that it the most of the relevant code"}, {"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "edited": false, "score": 0, "creation_date": 1544459453, "post_id": 53709617, "comment_id": 94274050, "body": "I added more code that will look like my example with the logic"}, {"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "edited": false, "score": 0, "creation_date": 1544459536, "post_id": 53709617, "comment_id": 94274102, "body": "and the mutex is global so everyone that login to the function is locked , does it work like this ? so if I got many calls only the first one will do the hanlde the login logic and then the others will do the logic"}, {"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "edited": false, "score": 0, "creation_date": 1544459808, "post_id": 53709617, "comment_id": 94274251, "body": "i did the mutex as a global variable does it should work ?"}, {"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544460046, "post_id": 53709617, "comment_id": 94274390, "body": "@Adrian - why nd there will be no actual mutual exclusion , I want to lock it when it call to handle because there is logic to connect"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1544460074, "post_id": 53709617, "comment_id": 94274403, "body": "It&#39;s a global variable, but it&#39;s being re-initialized every time you run handle(). Which is probably why you have an error... if you reinitialize it in one goroutine, then another tries to unlock it, you&#39;ll get the error you observe."}, {"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1544460157, "post_id": 53709617, "comment_id": 94274449, "body": "@Flimzy - how I can solve it ?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1544460280, "post_id": 53709617, "comment_id": 94274515, "body": "By not re-initializing the variable every time you run <code>handle()</code>."}, {"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1544460697, "post_id": 53709617, "comment_id": 94274725, "body": "@Flimzy - do I need to do it local variable ?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1544460744, "post_id": 53709617, "comment_id": 94274752, "body": "No. You just need to stop re-initializing it. That&#39;s it."}, {"owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1544460947, "post_id": 53709617, "comment_id": 94274860, "body": "@Flimzy = sorry but what do you mean to re-initializing ? where I need to do the  mutex = sync.Mutex{} ?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1544460999, "post_id": 53709617, "comment_id": 94274886, "body": "You need to remove that."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 7, "last_activity_date": 1544460982, "creation_date": 1544460982, "answer_id": 53710223, "question_id": 53709617, "link": "https://stackoverflow.com/questions/53709617/how-to-lock-function/53710223#53710223", "title": "How to lock function", "body": "<p>You have a race condition in your code. You're using a global variable (which is fine, as far as it goes), but then you're constantly resetting the mutex variable:</p>\n\n<pre><code>func handle() bool {\n    mutex = sync.Mutex{} // Here you are re-initializing the mutex every time\n    mutex.Lock()\n    defer mutex.Unlock()\n    ....some logic.... do login...\n    return true\n}\n</code></pre>\n\n<p>Instead, simply <em>don't</em> reset the variable:</p>\n\n<pre><code>func handle() bool {\n    mutex.Lock()\n    defer mutex.Unlock()\n    ....some logic.... do login...\n    return true\n}\n</code></pre>\n\n<p>To visualize the problem, imagine you have a single goroutine going through these steps:</p>\n\n<ol>\n<li>Reset the mutex.  <code>mutex = sync.Mutex{}</code></li>\n<li>Lock the mutex.  <code>mutex.Lock()</code></li>\n<li>Do stuff <code>...some logic....</code></li>\n<li>Release the lock. <code>defer mutex.Unlock()</code></li>\n</ol>\n\n<p>All is fine.</p>\n\n<p>But now imagine you have two groutines, <strong>A</strong> and <strong>B</strong> simultaneously running:</p>\n\n<ol>\n<li><strong>A</strong> resets the mutex: <code>mutex = sync.Mutex{}</code></li>\n<li><strong>A</strong> locks the mutex: <code>mutex.Lock()</code></li>\n<li><strong>A</strong> Do stuff</li>\n<li><strong>B</strong> resets the mutex: <code>mutex = sync.Mutex{}</code>  <strong>NOTE:</strong> The mutex is now unlocked for all goroutines, because it's a global variable!!</li>\n<li><strong>A</strong> Unlock mutex, and crash, because it's already unlocked</li>\n</ol>\n"}], "owner": {"reputation": 5073, "user_id": 1365697, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0cb3baa9178e40e8d47248ac73c4a24e?s=128&d=identicon&r=PG", "display_name": "user1365697", "link": "https://stackoverflow.com/users/1365697/user1365697"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1289, "favorite_count": 1, "closed_date": 1544469782, "accepted_answer_id": 53710223, "answer_count": 1, "score": -3, "last_activity_date": 1610014510, "creation_date": 1544458857, "last_edit_date": 1610014510, "question_id": 53709617, "link": "https://stackoverflow.com/questions/53709617/how-to-lock-function", "closed_reason": "Not suitable for this site", "title": "How to lock function", "body": "<pre><code>var mutex sync.Mutex\nfunc main() {\n     handle()\n    go register()\n}\n\nfunc register(){\n   myObject.OnEvent().DoFunc(HandleConnect)\n}\nfunc HandleConnect(){\n    handle()\n}\nfunc handle() bool {\n\n    mutex = sync.Mutex{}\n    mutex.Lock()\n    defer mutex.Unlock()\n    ....some logic.... do login...\n    return true\n}\n</code></pre>\n\n<p>I have a HandleConnect that is called many times in my application\nI want to lock the handle because if there are many calls I want that only one will do the logic of the login\nWhen I run it I got an error\n<strong>fatal error: sync: unlock of unlocked mutex</strong></p>\n\n<p>How I can solve it ?</p>\n"}, {"tags": ["go", "reflection"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1544464312, "last_edit_date": 1544464312, "creation_date": 1544463374, "answer_id": 53710801, "question_id": 53709480, "link": "https://stackoverflow.com/questions/53709480/create-a-function-that-test-marshalling-unmarshalling-from-an-interface/53710801#53710801", "title": "Create a function that test marshalling/unmarshalling from an interface", "body": "<p>Use <a href=\"https://godoc.org/reflect#New\" rel=\"nofollow noreferrer\">reflect.New</a> to create an addressable value. </p>\n\n<pre><code>data, err := json.Marshal(record)\nrequire.NoError(t, err)\ndst := reflect.New(reflect.TypeOf(record)) \nerr = json.Unmarshal(data, dst.Interface())  // dst.Interface() is pointer to the value.\nrequire.NoError(t, err)\nrequire.Equal(t, record, dst.Elem().Interface()) // dst.Elem().Interface() is the value.\n</code></pre>\n"}], "owner": {"reputation": 786, "user_id": 1021344, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/69e6f7ca78d95f08d0c71c50aa558976?s=128&d=identicon&r=PG", "display_name": "Geod24", "link": "https://stackoverflow.com/users/1021344/geod24"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1097, "favorite_count": 1, "accepted_answer_id": 53710801, "answer_count": 1, "score": -2, "last_activity_date": 1544464312, "creation_date": 1544458371, "last_edit_date": 1544459719, "question_id": 53709480, "link": "https://stackoverflow.com/questions/53709480/create-a-function-that-test-marshalling-unmarshalling-from-an-interface", "title": "Create a function that test marshalling/unmarshalling from an interface", "body": "<p>I want to create a simple function to test that marshalling/unmarshalling a record works as intended. I'm just using JSON for this example:</p>\n\n<pre><code>package test\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"testing\"\n    \"reflect\"\n\n    \"github.com/stretchr/testify/require\"\n)\n\nfunc CheckRoundTripJSON(t *testing.T, record interface{}) {\n    data, err := json.Marshal(record)\n    require.NoError(t, err)\n    fmt.Println(\"Record: \", record, \" was encoded to: \", data, \" - Type: \", reflect.TypeOf(record))\n\n    result := reflect.Zero(reflect.TypeOf(record))\n    inter := result.Interface()\n    fmt.Println(\"Result: \", reflect.TypeOf(result), \", Inter: \", reflect.TypeOf(inter))\n\n    {\n        err = json.Unmarshal(data, &amp;result)\n        require.NoError(t, err)\n        fmt.Println(data, \" was deserialized to \", result, \"type: \", reflect.TypeOf(result))\n        require.Equal(t, record, result)\n    }\n    {\n        err = json.Unmarshal(data, &amp;inter)\n        require.NoError(t, err)\n        fmt.Println(data, \" was deserialized to \", inter, \"type: \", reflect.TypeOf(inter))\n        require.Equal(t, record, inter)\n    }\n}\n\n\ntype Person struct {\n    FirstName  string\n    LastName   string\n    Age        uint8\n}\n\nfunc TestPersonMarshalling(t *testing.T) {\n    CheckRoundTripJSON(t, Person{\n        FirstName: \"Leonard\",\n        LastName:  \"Nimoy\",\n        Age:       84,\n    })\n}\n</code></pre>\n\n<p>Both code blocks will error. The first one leaves <code>result</code> default-initialized, and the second one makes <code>inter</code> point to a map containing the deserialized data.</p>\n\n<p>I was wondering if there's a way to have provide this interface &amp; functionality in Golang. I originally tried with <code>result.Addr()</code> but the result of <code>Zero</code> is not addressable, according to the documentation.</p>\n"}, {"tags": ["go", "logging"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544455638, "post_id": 53708650, "comment_id": 94271929, "body": "&quot;in main function it can&#39;t&quot; meaning what? What happens?"}, {"owner": {"reputation": 320, "user_id": 2803909, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LFlVf.jpg?s=128&g=1", "display_name": "Minh Tri Le", "link": "https://stackoverflow.com/users/2803909/minh-tri-le"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544457042, "post_id": 53708650, "comment_id": 94272684, "body": "Sorry, I mean that when I call Error.Println in initLog function it work. However when I call Error.Println in main function it doesn&#39;t work."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544457165, "post_id": 53708650, "comment_id": 94272753, "body": "Right. Please specify what &quot;doesn&#39;t work&quot; means. Won&#39;t compile, crashes, generates an error, doesn&#39;t print anything, prints the wrong thing... there are a million things &quot;doesn&#39;t work&quot; could mean here."}, {"owner": {"reputation": 320, "user_id": 2803909, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LFlVf.jpg?s=128&g=1", "display_name": "Minh Tri Le", "link": "https://stackoverflow.com/users/2803909/minh-tri-le"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1544457836, "post_id": 53708650, "comment_id": 94273186, "body": "yep, I got it. In this context I mean it doesn&#39;t write any thing to the log file."}], "answers": [{"comments": [{"owner": {"reputation": 320, "user_id": 2803909, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LFlVf.jpg?s=128&g=1", "display_name": "Minh Tri Le", "link": "https://stackoverflow.com/users/2803909/minh-tri-le"}, "edited": false, "score": 0, "creation_date": 1544456869, "post_id": 53708759, "comment_id": 94272584, "body": "I am learning golang, and I am researching about how to write log in golang. I felt that it is not easy like in java."}, {"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "reply_to_user": {"reputation": 320, "user_id": 2803909, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LFlVf.jpg?s=128&g=1", "display_name": "Minh Tri Le", "link": "https://stackoverflow.com/users/2803909/minh-tri-le"}, "edited": false, "score": 0, "creation_date": 1544457288, "post_id": 53708759, "comment_id": 94272834, "body": "It&#39;s easy enough, Google it and you&#39;ll find many examples, see:  <a href=\"https://blog.scalyr.com/2018/06/go-logging/\" rel=\"nofollow noreferrer\">1</a>, <a href=\"https://logmatic.io/blog/our-guide-to-a-golang-logs-world/\" rel=\"nofollow noreferrer\">2</a>, <a href=\"https://dave.cheney.net/2015/11/05/lets-talk-about-logging\" rel=\"nofollow noreferrer\">3</a>."}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": true, "score": 0, "last_activity_date": 1544456061, "last_edit_date": 1544456061, "creation_date": 1544455741, "answer_id": 53708759, "question_id": 53708650, "link": "https://stackoverflow.com/questions/53708650/write-log-by-golang-logger/53708759#53708759", "title": "Write log by Golang logger", "body": "<p>You're closing the file when returning from <code>initLog()</code>   using <code>defer errorFile.Close()</code> so inside <code>main()</code> the file <code>errorFile</code> is closed.</p>\n\n<p>So comment this line:  </p>\n\n<pre><code>defer errorFile.Close()\n</code></pre>\n\n<p>And move it to the <code>main()</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 393, "user_id": 2664120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95e396f6a7678066cf12a38350f80a3e?s=128&d=identicon&r=PG", "display_name": "Nordiii", "link": "https://stackoverflow.com/users/2664120/nordiii"}, "is_accepted": false, "score": 0, "last_activity_date": 1544456205, "creation_date": 1544456205, "answer_id": 53708896, "question_id": 53708650, "link": "https://stackoverflow.com/questions/53708650/write-log-by-golang-logger/53708896#53708896", "title": "Write log by Golang logger", "body": "<p>You're calling <code>defer errorFile.Close()</code> in <code>initLog()</code>. As soon as <code>initLog()</code> returns the defer is executed and because of this, when <code>Error.Println(\"Test write log\")</code> is called in your main, the io.Writer is already closed.</p>\n\n<p>Also you should check for errors first and then call <code>defer &lt;what ever you need to do&gt;</code> like</p>\n\n<pre><code>errorFile, err := os.OpenFile(\"error.log\", os.O_RDWR|os.O_APPEND, 0660)\nif err != nil {\n    log.Fatal(err)\n}\ndefer errorFile.Close()\n</code></pre>\n"}], "owner": {"reputation": 320, "user_id": 2803909, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LFlVf.jpg?s=128&g=1", "display_name": "Minh Tri Le", "link": "https://stackoverflow.com/users/2803909/minh-tri-le"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 146, "favorite_count": 0, "accepted_answer_id": 53708759, "answer_count": 2, "score": 0, "last_activity_date": 1544462723, "creation_date": 1544455313, "last_edit_date": 1544462723, "question_id": 53708650, "link": "https://stackoverflow.com/questions/53708650/write-log-by-golang-logger", "title": "Write log by Golang logger", "body": "<p>I am trying to write log by using <code>log.Logger</code>, my code is like bellow. I don't understand why my log can be written using Error inside <code>initLog</code> function but in <code>main</code> function it can't be written to the log file.<br>\nCan anybody explain for me?<br>\nThanks.</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"os\"\n)\n\nconst (\n    PORT = \":8081\"\n)\n\nvar (\n    Error *log.Logger\n)\n\nfunc initLog() {\n    errorFile, err := os.OpenFile(\"error.log\", os.O_RDWR|os.O_APPEND, 0660)\n    defer errorFile.Close()\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    Error = log.New(errorFile, \"ERROR: \", log.Ldate|log.Ltime)\n    Error.SetOutput(errorFile)\n    Error.Println(\"Log error will be written into error.log\")\n\n}\n\nfunc main() {\n    initLog()\n    Error.Println(\"Test write log\")\n    http.ListenAndServe(PORT, http.FileServer(http.Dir('.')))\n}\n</code></pre>\n"}, {"tags": ["go", "struct", "interface"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1544474514, "last_edit_date": 1544474514, "creation_date": 1544454808, "answer_id": 53708501, "question_id": 53708429, "link": "https://stackoverflow.com/questions/53708429/can-i-use-an-interface-as-a-parameter-when-writing-a-function-which-could-end-up/53708501#53708501", "title": "Can I use an interface as a parameter when writing a function which could end up being passed any kind of struct?", "body": "<p>You could approach it that way, but then inside <code>setDate()</code> you would need to use reflection to set the <code>Date</code> field. Go is a statically typed language, so if the (static) type of <code>data</code> is <code>interface{}</code> (which says nothing about it), you can't really do anything useful with it (you can't refer to its <code>Date</code> field, because there is no guarantee that its value has a <code>Date</code> field).</p>\n\n<p>Instead you should define a <code>HasDate</code> interface which contains a single method:</p>\n\n<pre><code>type HasDate interface {\n    SetDate(s time.Time)\n}\n</code></pre>\n\n<p>The ability to set the date. And your function should expect a value of this interface type:</p>\n\n<pre><code>func setDate(s time.Time, data HasDate) {\n    data.SetDate(s)\n}\n</code></pre>\n\n<p>Anyone who implements this <code>HasDate</code> interface can be passed to your <code>setDate()</code> function. Note that in Go implementing interfaces is implicit: there is no declaration of intent. This means any type that has a <code>SetDate(time.Time)</code> method implements this <code>HasDate</code> interface without even knowing this interface exists.</p>\n\n<p>This is an example type that implements it (more precisely its pointer <code>*MyType</code>):</p>\n\n<pre><code>type MyType struct {\n    date time.Time\n}\n\nfunc (mt *MyType) SetDate(s time.Time) {\n    mt.date = s\n}\n</code></pre>\n\n<p>Example testing it (try it on the <a href=\"https://play.golang.org/p/3eMElK1Tolz\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>mt := &amp;MyType{}\n\nsetDate(time.Now(), mt)\n\nfmt.Println(mt.date)\n</code></pre>\n"}], "owner": {"reputation": 780, "user_id": 5261088, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/8256e8a248d8bcde285d3b97f77e36b0?s=128&d=identicon&r=PG&f=1", "display_name": "MickeyThreeSheds", "link": "https://stackoverflow.com/users/5261088/mickeythreesheds"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 53708501, "answer_count": 1, "score": 0, "last_activity_date": 1544474514, "creation_date": 1544454584, "last_edit_date": 1544455041, "question_id": 53708429, "link": "https://stackoverflow.com/questions/53708429/can-i-use-an-interface-as-a-parameter-when-writing-a-function-which-could-end-up", "title": "Can I use an interface as a parameter when writing a function which could end up being passed any kind of struct?", "body": "<p>I am trying to write a function which could end up taking any kind of struct... let's say it is like this : </p>\n\n<pre><code>func setDate(s timestamp, data interface{}){\n    data.Date = timestamp\n}\n</code></pre>\n\n<p>I realize that I wouldn't need a function to set this value in real life, I am trying to learn more about how interfaces work, etc. </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "edited": false, "score": 0, "creation_date": 1544453552, "post_id": 53708111, "comment_id": 94270751, "body": "<b>0x80000000</b> seems to be important, but I can&#39;t do <code>(i &amp; 0x80000000) != 0</code>"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1544457204, "last_edit_date": 1544457204, "creation_date": 1544453390, "answer_id": 53708111, "question_id": 53708070, "link": "https://stackoverflow.com/questions/53708070/javascripts-boolean-translation-to-golang/53708111#53708111", "title": "Javascript&#39;s Boolean translation to Golang", "body": "<p>In JavaScript, coercing any non-boolean value to boolean just does a \"falsiness\" check; for the most part, any non-empty value is false and everything else is true. So the Go equivalent for an integer value would simply be:</p>\n\n<pre><code>return i != 0\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 1, "last_activity_date": 1544457064, "creation_date": 1544457064, "answer_id": 53709138, "question_id": 53708070, "link": "https://stackoverflow.com/questions/53708070/javascripts-boolean-translation-to-golang/53709138#53709138", "title": "Javascript&#39;s Boolean translation to Golang", "body": "<p>To put it all together</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n//function SomeFunc(i) {\n//    var f = 0x80000000;\n//\n //   return Boolean(i &amp; f);\n//}\n\nfunc SomeFunc(i uint64) bool{\n return i &amp; 0x80000000 != 0\n}\n\nfunc main() {\n    fmt.Println(SomeFunc(0x800))\n    fmt.Println(SomeFunc(0x81234567))\n}\n</code></pre>\n"}], "owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 53708111, "answer_count": 2, "score": -2, "last_activity_date": 1544457204, "creation_date": 1544453283, "question_id": 53708070, "link": "https://stackoverflow.com/questions/53708070/javascripts-boolean-translation-to-golang", "title": "Javascript&#39;s Boolean translation to Golang", "body": "<p>In JavaScript I see functions like:</p>\n\n<pre><code>function SomeFunc(i) {\n    var f = 0x80000000;\n\n    return Boolean(i &amp; f);\n}\n</code></pre>\n\n<p>What would be an analog in Golang? First of all, I see <strong>0x80000000</strong> is not possible, syntax is the second question</p>\n"}, {"tags": ["go", "dll", "dllimport", "cgo"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1544456946, "post_id": 53707314, "comment_id": 94272630, "body": "From a cursory look, my impression is what&#39;s missing is an inclusion of a header file actually <i>defining</i> (for <code>cgo</code> and <code>gcc</code> it will call) the types and functions in the DLL. I mean, &quot;old&quot; DLLs (not those files produced by .NET compilers which bear almost no resemblance to those &quot;old&quot; libraries except the extension part of their filenames) do not contain any information in them directly digestible by <code>cgo</code>. The latter has no direct support for COM and won&#39;t extract TLB info from the DLL (even if present)."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1544457067, "post_id": 53707314, "comment_id": 94272695, "body": "So the question is: does that &quot;redemption&quot; thing provide one or more &quot;public&quot; <code>.h</code> files suitable for feeding to a C compiler? Also note that while <code>cgo</code> is able to build C++ sources, it&#39;s not able to parse C++ from header files\u2014hence it only is able to <i>compile</i> C++ code, but if you want to use it via <code>cgo</code>, the library must export a set of symbols using the C++&#39;s <code>extern &quot;C&quot; { ... }</code> declaration."}, {"owner": {"reputation": 1, "user_id": 10107341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7fce44dd2600d3c8d3deb8080bb07c4?s=128&d=identicon&r=PG&f=1", "display_name": "frieder", "link": "https://stackoverflow.com/users/10107341/frieder"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1544480158, "post_id": 53707314, "comment_id": 94283524, "body": "Thank you for this information, I did not know <code>cgo</code> needs a <code>.h</code> file to digest a DLL library. To your question: As far as I know, the only <code>.h</code> file that I can access is the <code>RedemptionLoader.h</code> file which comes together with the <code>RedemptionLoader.cpp</code> file. And if I see this correctly the <code>RedemptionLoader.h</code> file is written in C++."}, {"owner": {"reputation": 1, "user_id": 10107341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7fce44dd2600d3c8d3deb8080bb07c4?s=128&d=identicon&r=PG&f=1", "display_name": "frieder", "link": "https://stackoverflow.com/users/10107341/frieder"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1544480884, "post_id": 53707314, "comment_id": 94283773, "body": "The <code>RedemptionLoader.cpp</code> does not export symbols, so I will look into if I can export the necessary symbols myself using the documentation that I have. Tank you again for your helpful comments."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1544522789, "post_id": 53707314, "comment_id": 94296995, "body": "It looks like you for some reason do not want to call directly into that DLL using the <code>syscall</code> package (while I&#39;d say on Windows it&#39;s vastly better an approach than using <code>cgo</code>). If so, and the library is pure C++ w/o a C-compatible exported API, you maybe should turn to <a href=\"http://www.swig.org/Doc3.0/Go.html\" rel=\"nofollow noreferrer\">SWIG</a> which is a sort-of officially blessed way to interface C++ with Go."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1544522981, "post_id": 53707314, "comment_id": 94297120, "body": "Please note that should you succeed with either approach, do not forget that you <i>have to</i> call <code>CoInitialize[Ex]</code> in the thread in which you intend to instantiate and use any COM&#91;+&#93; objects. <code>go-ole</code> has it already available. Also note that since the Go runtime implements the so-called M&#215;N scheduling, any goroutine is free to run on any OS thread available to the scheduler at any given time. IOW it may switch threads at any time, and <code>CoInitialize[Ex]</code> initializes a thread, not a goroutine."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1544523088, "post_id": 53707314, "comment_id": 94297193, "body": "This, in turn, means that the most robust approach would be to first have a dedicated goroutine to work with those COM objects, and have it call <code>runtime.LockOSThread()</code> <i>before</i> is initializes its thread for being able to work with COM. That call makes sure the underlying thread will forever be assigned to that goroutine\u2014until it exits or calls <code>runtime.UnlockOSThread</code>."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1544523325, "post_id": 53707314, "comment_id": 94297336, "body": "Regarding &#171;Thank you for this information, I did not know cgo needs a .h file to digest a DLL library&#187;\u2014if you&#39;ll dump a DLL using any suitable tool (such as <code>objdump</code>) you&#39;ll notice that all it basically has &quot;exported&quot; is two lists of <i>names</i> of the functions: the one it provides and the one it needs to be linked in after loading. There is no information on types using to compile the library. That is basically an artefact of the distant past where &quot;a library&quot; meant a library of subroutines. See <a href=\"https://en.wikipedia.org/wiki/Name_mangling\" rel=\"nofollow noreferrer\">this</a> for more info."}, {"owner": {"reputation": 1, "user_id": 10107341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7fce44dd2600d3c8d3deb8080bb07c4?s=128&d=identicon&r=PG&f=1", "display_name": "frieder", "link": "https://stackoverflow.com/users/10107341/frieder"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1545050928, "post_id": 53707314, "comment_id": 94479312, "body": "I had the misconception, that directly calling into the DLL using the <code>syscall</code> package would only work for already registered DLLs, after trying code adapted from <a href=\"https://tips.efmsoft.com/creating-a-com-object-wo-registration/\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://stackoverflow.com/a/46234640/10107341\">here</a> I now see that I must have made a mistake earlier that lead me to the false conclusion. Unfortunately I don&#39;t know if the library is pure C++, since I only have the compiled DLL files, but if I encounter problems, directly calling into the DLL, I will definitively have a look at SWIG."}, {"owner": {"reputation": 1, "user_id": 10107341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7fce44dd2600d3c8d3deb8080bb07c4?s=128&d=identicon&r=PG&f=1", "display_name": "frieder", "link": "https://stackoverflow.com/users/10107341/frieder"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1545051977, "post_id": 53707314, "comment_id": 94479870, "body": "I was aware of the necessity of <code>CoInitialize[Ex]</code>, but I did not think about the instability that comes with thread switching. Your note is very good advice and I will apply it to all of my go programs that use COM objects."}], "owner": {"reputation": 1, "user_id": 10107341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7fce44dd2600d3c8d3deb8080bb07c4?s=128&d=identicon&r=PG&f=1", "display_name": "frieder", "link": "https://stackoverflow.com/users/10107341/frieder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 223, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1544450586, "creation_date": 1544450586, "question_id": 53707314, "link": "https://stackoverflow.com/questions/53707314/how-to-use-cgo-to-load-a-com-library-in-windows", "title": "How to use cgo to load a COM library in windows", "body": "<p>So I want to use the <a href=\"http://www.dimastr.com/redemption/home.htm\" rel=\"nofollow noreferrer\">redemption</a> COM library in go.<br>\nI could already successfully use it by registering it first and then using <a href=\"https://github.com/go-ole/go-ole\" rel=\"nofollow noreferrer\">Go-OLE</a> to call functions.</p>\n\n<p>But ideally I want to use it without having to register it first.<br>\nWhen I searched on linking a dll in go I have found <a href=\"https://stackoverflow.com/a/8231774/10107341\">many</a> <a href=\"https://stackoverflow.com/a/43963032/10107341\">answers</a> saying to use cgo, but I could not find a tutorial, describing on <em>how</em> to use cgo.</p>\n\n<p>After reading the <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">cgo documentation</a>, and <a href=\"https://stackoverflow.com/questions/36915134/go-golang-cross-compile-from-mac-to-windows-fatal-error-windows-h-file-not-f\">this answer</a> about cross compiling (I am cross compiling from Ubuntu linux amd64 to windows amd64) I figured that I could probably use the dll by setting my environment variables to</p>\n\n<pre><code>GOOS=windows;GOARCH=amd64;CGO_ENABLED=1;CXX=x86_64-w64-mingw32-g++;CC=x86_64-w64-mingw32-gcc\n</code></pre>\n\n<p>And writing a go file like this</p>\n\n<pre><code>package main\n\n//#cgo windows LDFLAGS: -L/go/src/tryingout/Redemption64.dll\nimport \"C\"\nimport \"fmt\"\n\nfunc main() {\n    session := C.Redemption.RDOSession\n    fmt.Println(session)\n}\n</code></pre>\n\n<p>Unfortunately this did not work, I received the <code>could not determine kind of name for C.Redemption</code> error at compilation. I have looked it up and it means that Redemption does not exist. But I do know that it should be called like this since 1)It should be according to the documentation of redemption and 2) It worked before with go-ole</p>\n\n<p>There is also a <a href=\"http://www.dimastr.com/redemption/security.htm#redemptionloader\" rel=\"nofollow noreferrer\">loader class</a> written in C#, C++ and other languages by the redemption developer but I could not use that either because it was somehow always interpreted as C instead of C++ and thus resulted in errors. I tried <a href=\"https://github.com/golang/go/issues/18460#issuecomment-269578623\" rel=\"nofollow noreferrer\">this</a> solution and added <code>-lstdc++</code> to my LDFLAGS, but it made no difference.</p>\n\n<p>So my question is how do I load and use this COM library or where can I find a tutorial/example code that explains it?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 6, "last_activity_date": 1544451375, "creation_date": 1544451375, "answer_id": 53707539, "question_id": 53706935, "link": "https://stackoverflow.com/questions/53706935/golang-testing-command-line-arguments/53707539#53707539", "title": "golang testing command line arguments", "body": "<p>Don't use the global <code>FlagSet</code> object in the <code>flags</code> package. Create your own <code>FlagSet</code> as a field of <code>Params</code>: <a href=\"https://golang.org/pkg/flag/#FlagSet\" rel=\"noreferrer\">https://golang.org/pkg/flag/#FlagSet</a></p>\n\n<p>All that <code>flag.String</code> et al do is pass through the function call to a global <code>FlagSet</code> object in the <code>flag</code> package (specifically <code>flag.CommandLine</code> is the variable). This is easy to use but not a generally good practice. Using your own flagset would avoid the issues you described as well as other potential side effects from using global variables.</p>\n"}], "owner": {"reputation": 133, "user_id": 1453428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5659982b3489a7eefa25724a6643598?s=128&d=identicon&r=PG", "display_name": "user1453428", "link": "https://stackoverflow.com/users/1453428/user1453428"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2733, "favorite_count": 2, "accepted_answer_id": 53707539, "answer_count": 1, "score": 5, "last_activity_date": 1544451375, "creation_date": 1544449298, "question_id": 53706935, "link": "https://stackoverflow.com/questions/53706935/golang-testing-command-line-arguments", "title": "golang testing command line arguments", "body": "<p>I want to test different (correct/incorrect) command line arguments passed to my CLI program, but I am not sure how to achieve this with go/testing package because I am getting <code>flag redefined</code> error. Looks like it happens because <code>flag.Parse()</code> can be called only once. What is the proper approach to test different command line arguments passed into the go program? Is there is any way to define something like <code>setup()/teardown()</code> or run every case in isolation (but in the same file)?</p>\n\n<p>Here is my code:</p>\n\n<p>Function to test:</p>\n\n<pre><code>func (p *Params) Parse() (*Params, error) {\n        param1Ptr := flag.String(\"param1\", \"default\", \"param1 desc\")\n        param2Ptr := flag.String(\"param2\", \"default\", \"param1 desc\")\n        ...\n        ... \n        flag.Parse()\n        ...\n\n}\n</code></pre>\n\n<p>Test file:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n        \"os\"\n        \"testing\"\n)\n\n\nfunc TestParam1(t *testing.T) {\n        os.Args = []string{\"cmd\", \"-param1\", \"incorrect\", \"-param2\", \"correct\"}\n        params := Params{}\n        _, err := params.Parse()\n        ...\n        ... \n}\n\nfunc TestParam2(t *testing.T) {\n        os.Args = []string{\"cmd\", \"-param1\", \"correct\", \"-param2\", \"incorrect\"}\n        params := Params{}\n        _, err := params.Parse()\n        ...\n        ... \n}\n</code></pre>\n"}, {"tags": ["security", "go", "oauth-2.0"], "comments": [{"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1544448935, "post_id": 53706669, "comment_id": 94268082, "body": "<code>it always says the problem of the authorization</code> - what exactly happens?"}, {"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1544449079, "post_id": 53706669, "comment_id": 94268169, "body": "make sure that you register <code>redirect url</code> in squareup. OpenID redirects only to whitelisted urls."}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1544449143, "post_id": 53706669, "comment_id": 94268212, "body": "Not that it is contributing to your error, but why are you adding your headers to the request <i>and the response</i>?"}, {"owner": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "reply_to_user": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1544449525, "post_id": 53706669, "comment_id": 94268447, "body": "@DmitryHarnitski when I hit <code>https:&#47;&#47;connect.squareup.com&#47;oauth2&#47;authorize?client_id=your&zwnj;&#8203;_client_id</code> this url then it will redirect me the redirect url Which I added in dashboard then it provide me some code string in query string of url then I use that code in my header. For that there is a valid user"}], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "edited": false, "score": 0, "creation_date": 1544506582, "post_id": 53707340, "comment_id": 94289691, "body": "can we add a customer in the square without using oauth?"}], "tags": [], "owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "is_accepted": false, "score": 1, "last_activity_date": 1544450677, "creation_date": 1544450677, "answer_id": 53707340, "question_id": 53706669, "link": "https://stackoverflow.com/questions/53706669/how-to-add-customer-in-the-squareup-payment-gateway-using-golang/53707340#53707340", "title": "How to add customer in the squareup payment gateway using golang?", "body": "<p>Check how oauth2 is implemented by squareup  <a href=\"https://docs.connect.squareup.com/authz/oauth/how-it-works\" rel=\"nofollow noreferrer\">https://docs.connect.squareup.com/authz/oauth/how-it-works</a></p>\n\n<p>Your GO code is BACKEND on that diagram.</p>\n\n<p><a href=\"https://connect.squareup.com/oauth2/authorize\" rel=\"nofollow noreferrer\">https://connect.squareup.com/oauth2/authorize</a> is expected to be called from CLIENT (Browser, Native or Mobile App) that will cause some HTTP redirects in browser to ask user for credentials and other challenges. These credentials are expected to be provided by human using Browser or Web View (chromeless version of browser). </p>\n\n<p>You are likely getting redirect response when you send your request from GO. That is redirect to HTML page where user can enter credentials. </p>\n\n<p>Do not try to implement CLIENT in GO, that should not be possible as whole <code>oauth2</code> flow assumes user input and should detect and reject backend code.</p>\n"}], "owner": {"reputation": 141, "user_id": 10748974, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8da57171f1d340b7e67580ea3a1e12fb?s=128&d=identicon&r=PG&f=1", "display_name": "catter", "link": "https://stackoverflow.com/users/10748974/catter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1544450812, "creation_date": 1544448401, "last_edit_date": 1544450812, "question_id": 53706669, "link": "https://stackoverflow.com/questions/53706669/how-to-add-customer-in-the-squareup-payment-gateway-using-golang", "title": "How to add customer in the squareup payment gateway using golang?", "body": "<p>I'm using golang to add customer in the squareup.com but it always says the probelm of the authorization Can anyone tell me that what is problem in my code:-</p>\n\n<pre><code>func Token(c *gin.Context) {\n code := c.Query(\"code\")\n splitCode := strings.Split(code, \"-\")\n scope := c.DefaultQuery(\"scope\", \"CUSTOMERS_WRITE\")\n customer := models.Customer{\n    GivenName:    \"Amelia\",\n    FamilyName:   \"Earhart\",\n    CompanyName:  \"fbgusbd\",\n    Nickname:     \"kdfbkgjkdf\",\n    EmailAddress: \"Amelia.Earhart@example.com\",\n    Address: models.Addresss{\n        AddressLine1:                 \"500 Electric Ave\",\n        AddressLine2:                 \"Suite 600\",\n        Locality:                     \"New York\",\n        AdministrativeDistrictLevel1: \"NY\",\n        PostalCode:                   \"10003\",\n        Country:                      \"US\",\n    },\n    PhoneNumber: \"1-212-555-4240\",\n    ReferenceId: \"12\",\n    Note:        \"a customer\",\n }\n fmt.Println(customer)\n bindData, err := json.Marshal(customer)\n if err != nil {\n    panic(err)\n }\n var jsonStr = []byte(string(bindData))\n url := config.APIBaseLive + \"v2/customers?code=\" + splitCode[1] + \"&amp;scope=\" + scope\n\n req, err := http.NewRequest(\"POST\", url, bytes.NewBuffer(jsonStr))\n req.Header.Add(\"Authorization\", \"Bearer \"+splitCode[1])\n req.Header.Add(\"Accept\", \"application/json\")\n fmt.Println(\"Request\", req)\n  client := &amp;http.Client{}\n  resp, err := client.Do(req)\n // fmt.Println(resp, err)\n if err != nil {\n    panic(err)\n }\n defer resp.Body.Close()\n resp.Header.Add(\"Authorization\", \"Bearer \"+splitCode[1])\n resp.Header.Add(\"Accept\", \"application/json\")\n fmt.Println(\"response Status:\", resp.Status)\n fmt.Println(\"response Headers:\", resp.Header)\n body, _ := ioutil.ReadAll(resp.Body)\n fmt.Println(\"response Body:\", string(body))\n}\n\ntype Customer struct {\n  GivenName    string   `json:\"given_name\" bson:\"given_name\"`\n  FamilyName   string   `json:\"family_name\" bson:\"family_name\"`\n  CompanyName  string   `json:\"company_name\" bson:\"company_name\"`\n  Nickname     string   `json:\"nickname\" bson:\"nickname\"`\n  EmailAddress string   `json:\"email_address\" bson:\"email_address\"`\n  Address      Addresss `json:\"address\" bson:\"address\"`\n  PhoneNumber  string   `json:\"phone_number\" bson:\"phone_number\"`\n  ReferenceId  string   `json:\"reference_id\" bson:\"reference_id\"`\n  Note         string   `json:\"note\" bson:\"note\"`\n}\n</code></pre>\n\n<p>Errors:-</p>\n\n<pre><code> {\n  \"errors\": [\n     {\n        \"category\": \"AUTHENTICATION_ERROR\",\n        \"code\": \"UNAUTHORIZED\",\n        \"detail\": \"This request could not be authorized.\"\n     }\n   ]\n}\n</code></pre>\n\n<p>While hitting <code>https://connect.squareup.com/oauth2/authorize?client_id=your_client_id</code> then it will direct you to a url redirect url you added with a query string code having a key authenticate key. You will add the redirect url in the dashboard and then by using this code you will called a authenticate user. Can anyone help me too solve this problem?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 483, "user_id": 10350764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f198c0e69cbca84b4a849cca0f37a60a?s=128&d=identicon&r=PG&f=1", "display_name": "fwhez", "link": "https://stackoverflow.com/users/10350764/fwhez"}, "edited": false, "score": 0, "creation_date": 1568866053, "post_id": 53705933, "comment_id": 102412190, "body": "picture cracks."}], "answers": [{"tags": [], "owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "is_accepted": true, "score": 3, "last_activity_date": 1544446442, "creation_date": 1544446442, "answer_id": 53706103, "question_id": 53705933, "link": "https://stackoverflow.com/questions/53705933/gin-framework-can-not-get-the-data-from-postman/53706103#53706103", "title": "Gin framework can not get the data from Postman", "body": "<p>Accordingly to your screen it looks like you're sending <code>x-www-form-urlencoded</code> request and it this case you have to have <code>form</code> tags in your <code>CreateRequest</code> struct:</p>\n\n<pre><code>type CreateRequest struct {\n    Username string `json:\"username\" form:\"username\"`\n    Phone    string `json:\"phone\" form:\"phone\"`\n    Password string `json:\"password\" form:\"password\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 3078, "user_id": 5305592, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/7e9b659dde6e528e0316572055db507f?s=128&d=identicon&r=PG&f=1", "display_name": "zwl1619", "link": "https://stackoverflow.com/users/5305592/zwl1619"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 632, "favorite_count": 0, "accepted_answer_id": 53706103, "answer_count": 1, "score": 2, "last_activity_date": 1597182141, "creation_date": 1544445882, "last_edit_date": 1597182141, "question_id": 53705933, "link": "https://stackoverflow.com/questions/53705933/gin-framework-can-not-get-the-data-from-postman", "title": "Gin framework can not get the data from Postman", "body": "<p>Gin framework can not get the data from Postman,below is a demo:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;github.com/gin-gonic/gin&quot;\n)\n\n\n\ntype CreateRequest struct {\n    Username string `json:&quot;username&quot;`\n    Phone    string `json:&quot;phone&quot;`\n    Password string `json:&quot;password&quot;`\n}\n\n\nfunc Signup(c *gin.Context) {\n    var r CreateRequest\n    if err := c.Bind(&amp;r); err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(&quot;this is debug info:start&quot;)\n    fmt.Println(r.Username)\n    fmt.Println(&quot;this is debug info:end&quot;)\n}\n\n\n\nfunc main() {\n    r := gin.Default()\n\n    r.POST(&quot;/signup&quot;, Signup)\n    \n    r.Run() // listen and serve on 0.0.0.0:8080\n}\n</code></pre>\n<p>Send a request from postman:</p>\n<p><a href=\"https://i.stack.imgur.com/v8IZ6.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/v8IZ6.png\" alt=\"Postman screenshot\" /></a></p>\n<p>Debug info:</p>\n<p><a href=\"https://i.stack.imgur.com/NegWX.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/NegWX.png\" alt=\"debugger screenshot\" /></a></p>\n<p>Where is the problem?<br />\nWhat should I do?</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1544443618, "post_id": 53705268, "comment_id": 94265216, "body": "I don&#39;t understand your question. You want to re-read the value you&#39;ve updated?  Or you just want to know <i>if</i> something was updated?"}, {"owner": {"reputation": 23, "user_id": 1399068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/778d78d3a045bf95125943130569ac11?s=128&d=identicon&r=PG", "display_name": "Mat Evans", "link": "https://stackoverflow.com/users/1399068/mat-evans"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1544452995, "post_id": 53705268, "comment_id": 94270402, "body": "Literally if any of the values in the data that&#39;s going into the Update/Save method have updated any values in the database.   My use case is taking data from an API and storing it for use in a database - so by checking if the data has been updated I can decide whether to fire off events."}], "owner": {"reputation": 23, "user_id": 1399068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/778d78d3a045bf95125943130569ac11?s=128&d=identicon&r=PG", "display_name": "Mat Evans", "link": "https://stackoverflow.com/users/1399068/mat-evans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 182, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1544457039, "creation_date": 1544443312, "last_edit_date": 1544457039, "question_id": 53705268, "link": "https://stackoverflow.com/questions/53705268/how-to-check-if-gorm-save-updated-any-values-in-mysql", "title": "How to check if gorm save() updated any values in mysql", "body": "<p>I'm trying to work out what the best way to check if the values that I'm saving have overwritten any that are in the database.</p>\n\n<p>Obviously, I can get a record, compare the data and then save if it's different, but I wondered if there was a way to know inherently when a Save is done? </p>\n\n<p>I can use update - and it will give back a row affected value > 1 but the problem with that is that update can't update a value in the db to a Go default type value (0 for example) therefore that won't work for this case.</p>\n\n<p>For example:</p>\n\n<pre><code>db.Table(\"object\").Where(\"id = ?\", obj).Save(obj)\nlog.Println(res.RowsAffected) // always equals 1\n</code></pre>\n\n<p>compared to</p>\n\n<pre><code>res := db.Table(\"object\").Where(\"id = ?\", obj).Update(obj)\nlog.Println(res.RowsAffected) // equals 1 if updated\n</code></pre>\n\n<p>Any ideas?</p>\n"}, {"tags": ["go", "heroku", "proxy", "compression"], "comments": [{"owner": {"reputation": 253893, "user_id": 9515207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34932d3e923ffad9a4a1423e30b1d9fc?s=128&d=identicon&r=PG&f=1", "display_name": "CertainPerformance", "link": "https://stackoverflow.com/users/9515207/certainperformance"}, "edited": false, "score": 0, "creation_date": 1544430639, "post_id": 53701836, "comment_id": 94258511, "body": "If you look at your Network tab when navigating, you&#39;ll probably already see <code>content-encoding: gzip</code> for both <code>.css</code> and <code>.js</code> files (I&#39;m not seeing it on images though, wonder what&#39;s going on with them)"}, {"owner": {"reputation": 149, "user_id": 10690958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72ba4694ee885c954926a8ba0d60ce8d?s=128&d=identicon&r=PG&f=1", "display_name": "grill05", "link": "https://stackoverflow.com/users/10690958/grill05"}, "reply_to_user": {"reputation": 253893, "user_id": 9515207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34932d3e923ffad9a4a1423e30b1d9fc?s=128&d=identicon&r=PG&f=1", "display_name": "CertainPerformance", "link": "https://stackoverflow.com/users/9515207/certainperformance"}, "edited": false, "score": 0, "creation_date": 1544430870, "post_id": 53701836, "comment_id": 94258600, "body": "hmm..interesting. There is still an advantage in using lzma(2) vs gzip though there is a speed penalty. Also, there is usually a high &quot;correlation&quot; between the files needed to display a page (say www.stackoverflow.com). Some text strings will be repeated in several .js/.css files. I am not certain, but I think compressing &#39;all&#39; files needed for a page should give a smaller output vs compression each files separately."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1606522844, "post_id": 53701836, "comment_id": 114994172, "body": "in simple words, your Q1 is &quot;how do i deploy a docker image on heroky ?&quot;, your Q2 is, how do i configure my browsers to use that proxy ?&quot;. Please consider as of now the question is unsuitable because it lacks focus and clarity. I am pretty sure both questions were answered if you where to google them."}], "owner": {"reputation": 149, "user_id": 10690958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72ba4694ee885c954926a8ba0d60ce8d?s=128&d=identicon&r=PG&f=1", "display_name": "grill05", "link": "https://stackoverflow.com/users/10690958/grill05"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 574, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1606522099, "creation_date": 1544430053, "last_edit_date": 1606522099, "question_id": 53701836, "link": "https://stackoverflow.com/questions/53701836/implementing-extreme-bandwidth-saving-for-web-browsing-with-a-compression-prox", "title": "Implementing &quot;extreme&quot; bandwidth saving for web browsing with a compression proxy", "body": "<p>I have a network connection where I pay per megabyte, so I'm interested in reducing my bandwidth usage as far as possible while still having a reasonably good browsing experience. I use this wonderful extension  (<a href=\"https://bandwidth-hero.com/\" rel=\"nofollow noreferrer\">https://bandwidth-hero.com/</a>). This extension runs a image-compression proxy on my heroku account that accepts images URLs, and returns a low-quality version of those images.This reduces bandwidth usage by 30-40% when images are loaded.</p>\n<p>To further reduce usage, I typically browse with both JavaScript and images disabled (there are various extensions for  doing this in firefox/firefox-esr/google-chrome). This has an added bonus of blocking most ads (since they usually need JavaScript to run).</p>\n<p>For daily browsing, the most efficient solution is using a text-mode browser in a virtual console such as  elinks/lynx/links2 running over ssh (with zlib compression) on a VPS server. But sometimes using JavaScript becomes necessary, as sites will not render without it .Elinks is the only text-mode browser that even tries to support JavaScript, and even that support is quite rudimentary. When I have to come back to using firefox/chrome, I find my bandwidth usage shooting up. I would like to avoid this.</p>\n<p>I find that bandwidth is used partially to get the 'raw' html files of the sites I'm browsing, but more often for the associated .js/.css files. These are typically highly compressible. On my local workstation, html+css+javascript files typically compress by a factor of more than 10x when using lzma(2) compression.</p>\n<p>It seems to me that one way to do drastically reduce bandwidth consumption would be to use the same template as the bandwidth-hero extension, i.e.  run a compression proxy either on a vps or on my heroku account but do so for text content (.html/.js/.css).</p>\n<p>Ideally, I would like to run a compression proxy on my local machine. When I open a site (say <a href=\"http://www.stackoverflow.com\">www.stackoverflow.com</a>), the browser should send a request to this local proxy. This local proxy then sends a request to a back-end running on  heroku/vps. The heroku/vps back-end actually fetches all the content, and compresses it (lzma/bzip/gzip). The compressed content is sent back to my local proxy. The local proxy decompresses the content and finally gives it to the browser.</p>\n<p>There is something like this mentioned in this answer (<a href=\"https://stackoverflow.com/a/42505732/10690958\">https://stackoverflow.com/a/42505732/10690958</a>) for node.js . I am thinking of the same for python.</p>\n<p>From what google searches show, HTTP can &quot;automatically&quot; ask for gzip versions of pages. But does this also apply for the associated files that are loaded by JavaScript, and for the css files? Perhaps, what I am thinking about is  already implemented by default ?</p>\n<p>Any pointers would be welcome. I was thinking of writing a local proxy in python,as I am reasonably fluent in it. But  I know little about heroku or the intricacies of HTTP.</p>\n<p>thanks.</p>\n<p>Update: I found a possible solution here <a href=\"https://github.com/barnacs/compy\" rel=\"nofollow noreferrer\">https://github.com/barnacs/compy</a>\nwhich does almost exactly what I need (minify+compress with brotli/gzip+transcode jpeg/gif/png). It uses go instead of python, but that does not really matter. It also has a docker image here <a href=\"https://hub.docker.com/r/andrewgaul/compy/\" rel=\"nofollow noreferrer\">https://hub.docker.com/r/andrewgaul/compy/</a> . Since I'm not very familiar with heroku, I cant figure out how to use this to run the compression proxy service  on my account. The heroku docs also weren't of much help to me. Any pointers would be welcome.</p>\n"}, {"tags": ["mongodb", "go", "bson", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 26615, "user_id": 1533609, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d9af7b096e3a90fcd94b9500f10e6c6d?s=128&d=identicon&r=PG&f=1", "display_name": "bugwheels94", "link": "https://stackoverflow.com/users/1533609/bugwheels94"}, "edited": false, "score": 0, "creation_date": 1585517757, "post_id": 53701933, "comment_id": 107781354, "body": "Why do I get with <code>bson.ObjectIdHex</code> error <code>undefined: bson.ObjectIdHex</code>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1544430578, "creation_date": 1544430578, "answer_id": 53701933, "question_id": 53701764, "link": "https://stackoverflow.com/questions/53701764/prevent-runtime-panic-in-bson-objectidhex/53701933#53701933", "title": "Prevent runtime panic in bson.ObjectIdHex", "body": "<p><a href=\"https://godoc.org/github.com/globalsign/mgo/bson#ObjectIdHex\" rel=\"nofollow noreferrer\"><code>bson.ObjectIdHex()</code></a> documents that it will panic if you pass an invalid object id:</p>\n\n<blockquote>\n  <p>ObjectIdHex returns an ObjectId from the provided hex representation. <strong>Calling this function with an invalid hex representation will cause a runtime panic.</strong> See the IsObjectIdHex function.</p>\n</blockquote>\n\n<p>If you want to avoid this, first check your input string using <a href=\"https://godoc.org/github.com/globalsign/mgo/bson#IsObjectIdHex\" rel=\"nofollow noreferrer\"><code>bson.IsObjectIdHex()</code></a>, and only proceed to call <code>bson.ObjectIdHex()</code> if your input is valid:</p>\n\n<pre><code>if bson.IsObjectIdHex(obid[0]) {\n    // It's valid, calling bson.ObjectIdHex() will not panic...\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 10756219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40d2ff74e2f9bfde737c824e31786694?s=128&d=identicon&r=PG&f=1", "display_name": "BErak Terus", "link": "https://stackoverflow.com/users/10756219/berak-terus"}, "edited": false, "score": 0, "creation_date": 1544432378, "post_id": 53702132, "comment_id": 94259293, "body": "this is right answer too, but more complex, thank you !"}], "tags": [], "owner": {"reputation": 1236, "user_id": 2729461, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/nq1S2.jpg?s=128&g=1", "display_name": "irmorteza", "link": "https://stackoverflow.com/users/2729461/irmorteza"}, "is_accepted": false, "score": 0, "last_activity_date": 1544431638, "creation_date": 1544431638, "answer_id": 53702132, "question_id": 53701764, "link": "https://stackoverflow.com/questions/53701764/prevent-runtime-panic-in-bson-objectidhex/53702132#53702132", "title": "Prevent runtime panic in bson.ObjectIdHex", "body": "<p>As @icza said in the last answer. you should check validity if ObjectId. \nAnd you can use <a href=\"https://blog.golang.org/defer-panic-and-recover\" rel=\"nofollow noreferrer\">panic recover defer</a>  to handle any kind of error in future</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"gopkg.in/mgo.v2/bson\"\n    \"path/filepath\"\n    \"runtime\"\n    \"strings\"\n)\n\nfunc main() {\n    r := Result{}\n    getData(&amp;r)\n}\n\nfunc IdentifyPanic() string {\n    var name, file string\n    var line int\n    var pc [16]uintptr\n\n    n := runtime.Callers(3, pc[:])\n    for _, pc := range pc[:n] {\n        fn := runtime.FuncForPC(pc)\n        if fn == nil {\n            continue\n        }\n        file, line = fn.FileLine(pc)\n        name = fn.Name()\n\n        if !strings.HasPrefix(name, \"runtime.\") {\n            break\n        }\n    }\n    file = filepath.Base(file)\n\n    switch {\n    case name != \"\":\n        return fmt.Sprintf(\"%v:%v\", file, line)\n    case file != \"\":\n        return fmt.Sprintf(\"%v:%v\", file, line)\n    }\n\n    return fmt.Sprintf(\"pc:%x\", pc)\n}\n\ntype Result struct {\n    success int\n    data string\n}\nfunc getData(result *Result){\n    defer func() {\n        if err := recover(); err != nil {\n            ip := IdentifyPanic()\n            errorMessage := fmt.Sprintf(\"%s Error: %s\", ip, err)\n            fmt.Println(errorMessage)\n            result.success = 0\n        }\n    }()\n    if bson.IsObjectIdHex(obid[0]) {                                 // this line copied from @icza answer\n        // It's valid, calling bson.ObjectIdHex() will not panic...  // this line copied from @icza answer\n        errCheck := d.C(\"col\").FindId(bson.ObjectIdHex(obid[0])).One(&amp;res)\n        result.success = 1\n        result.data = \"your result (res). this is just the exam\"\n    }else{\n        result.success = 0  \n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 10756219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40d2ff74e2f9bfde737c824e31786694?s=128&d=identicon&r=PG&f=1", "display_name": "BErak Terus", "link": "https://stackoverflow.com/users/10756219/berak-terus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 843, "favorite_count": 0, "accepted_answer_id": 53701933, "answer_count": 2, "score": 1, "last_activity_date": 1544431638, "creation_date": 1544429693, "last_edit_date": 1544430615, "question_id": 53701764, "link": "https://stackoverflow.com/questions/53701764/prevent-runtime-panic-in-bson-objectidhex", "title": "Prevent runtime panic in bson.ObjectIdHex", "body": "<p>i'm trying to convert string of objectid to bson ObjectId format with mgo,</p>\n\n<p><code>errCheck := d.C(\"col\").FindId(bson.ObjectIdHex(obid[0])).One(&amp;Result)\n</code></p>\n\n<p>idk why, but if i give a wrong / invalid input string, my application got runtime panic</p>\n\n<p>how i can prevent that ? thank you</p>\n"}, {"tags": ["java", "go", "tcp"], "answers": [{"comments": [{"owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "edited": false, "score": 0, "creation_date": 1544432080, "post_id": 53702139, "comment_id": 94259135, "body": "I believe when a Client connection gets terminated unexpectedly, the <code>catch (SocketException e)</code> line should be able to handle it. As for the Keep-alive and Timeout links, I&#39;ll be sure to try them out. Many thanks!"}, {"owner": {"reputation": 81087, "user_id": 104458, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/cc46b8a10ecb92e61aaeb1efe436a0c8?s=128&d=identicon&r=PG", "display_name": "selbie", "link": "https://stackoverflow.com/users/104458/selbie"}, "reply_to_user": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "edited": false, "score": 4, "creation_date": 1544432486, "post_id": 53702139, "comment_id": 94259344, "body": "Correct. But you won&#39;t get that socket exception fired unless TCP has detected the connection as failed.  That being said, TCP does not have a magic way of detecting when a remote client disappears (e.g. network cable unplugged) unless there was a timeout waiting for ACK on sent data."}, {"owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "edited": false, "score": 0, "creation_date": 1544433704, "post_id": 53702139, "comment_id": 94259938, "body": "Thanks for the best practice tip. Ended up going with the Timeout approach since it&#39;s more practical. Back to my original problem though, it seems that the issue is with Golang&#39;s <code>connection.Write()</code> function, because&#39;s it&#39;s not sending <code>TCP FIN</code> unless I close the connection first. This is quite a problem because one of the basic scenarios is 1) Client sends message and waits for the result 2) Server processes the message and returns the result. 3) Client does something with the message."}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "reply_to_user": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "edited": false, "score": 2, "creation_date": 1544456636, "post_id": 53702139, "comment_id": 94272473, "body": "@FloatingSunfish That&#39;s how the socket API works in all languages for TCP. You get EOF(read() returns -1)  at one end when the other end closes the connection. Keep in mind that TCP is stream based,  not message based. One Write() at one end doesn&#39;t neccesarily match up with exactly one Read() at the other end. For your particular scenario, you could perhaps have the client/server use the TCP concept of a half-closed connection. That is, have your client call CloseWrite() instead of Close()."}, {"owner": {"reputation": 165665, "user_id": 721269, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/346ca03edfbde2a468adc289867ab975?s=128&d=identicon&r=PG", "display_name": "David Schwartz", "link": "https://stackoverflow.com/users/721269/david-schwartz"}, "reply_to_user": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "edited": false, "score": 2, "creation_date": 1544463079, "post_id": 53702139, "comment_id": 94275992, "body": "@FloatingSunfish You have a bit of an impedance mismatch. You need a message protocol such that saying &quot;client sends message&quot; actually means something. But TCP is <i>not</i> a message protocol and you shouldn&#39;t expect it to act like one. It may be helpful to study the specifications of some protocols layered on top of TCP so you have a better understanding of what TCP does and what your code must do to use TCP properly. You can use the closing of the connection to mark a message boundary, but then only one message per connection is possible."}, {"owner": {"reputation": 81087, "user_id": 104458, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/cc46b8a10ecb92e61aaeb1efe436a0c8?s=128&d=identicon&r=PG", "display_name": "selbie", "link": "https://stackoverflow.com/users/104458/selbie"}, "edited": false, "score": 0, "creation_date": 1544471710, "post_id": 53702139, "comment_id": 94279848, "body": "Couldn&#39;t have said it better than David and nos."}, {"owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "edited": false, "score": 0, "creation_date": 1544493074, "post_id": 53702139, "comment_id": 94286659, "body": "Got it, I&#39;ll see how to get <code>CloseWrite()</code> to work in Golang. Yeah, I figured I was doing a communication mismatch because if it&#39;s Go x Go <code>connection.Write()</code> actually tells the Server that it&#39;s done. I&#39;m probably using the wrong Java code for this. Many thanks."}], "tags": [], "owner": {"reputation": 81087, "user_id": 104458, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/cc46b8a10ecb92e61aaeb1efe436a0c8?s=128&d=identicon&r=PG", "display_name": "selbie", "link": "https://stackoverflow.com/users/104458/selbie"}, "is_accepted": false, "score": 2, "last_activity_date": 1544431659, "creation_date": 1544431659, "answer_id": 53702139, "question_id": 53701654, "link": "https://stackoverflow.com/questions/53701654/golang-tcp-client-does-not-send-end-of-stream-to-java-tcp-server/53702139#53702139", "title": "Golang TCP Client Does Not Send `End of Stream` to Java TCP Server", "body": "<p>For starters, you probably want to make sure your client code reliably closes the socket. But that's not all you should do.</p>\n\n<p>The client process should trigger a TCP FIN as a result of closing the socket.  And the socket should get closed as a result of the client process cleanly exiting.  Not sure why this isn't the case for you.  Are you waiting long enough?</p>\n\n<p>However, so that your server is not indefinitely hung, you need to guard for this condition. Consider the case where there's an active TCP connection between a client and your server. And while the server is awaiting data from the client, the power goes out where the client is at.  Because there's no way for the client to send a FIN, the server connection isn't going to have any traffic.  That TCP connection will stay hung forever unless....</p>\n\n<p>You either set a keep-alive option or a timeout option on the server side.</p>\n\n<p>Keep-alive: <a href=\"https://docs.oracle.com/javase/7/docs/api/java/net/SocketOptions.html#SO_KEEPALIVE\" rel=\"nofollow noreferrer\">https://docs.oracle.com/javase/7/docs/api/java/net/SocketOptions.html#SO_KEEPALIVE</a></p>\n\n<p>Timeout: <a href=\"https://docs.oracle.com/javase/7/docs/api/java/net/SocketOptions.html#SO_TIMEOUT\" rel=\"nofollow noreferrer\">https://docs.oracle.com/javase/7/docs/api/java/net/SocketOptions.html#SO_TIMEOUT</a></p>\n"}, {"tags": [], "owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "is_accepted": true, "score": 0, "last_activity_date": 1544495065, "creation_date": 1544495065, "answer_id": 53716489, "question_id": 53701654, "link": "https://stackoverflow.com/questions/53701654/golang-tcp-client-does-not-send-end-of-stream-to-java-tcp-server/53716489#53716489", "title": "Golang TCP Client Does Not Send `End of Stream` to Java TCP Server", "body": "<p>I finally got it to work following @nos' advice to call <code>CloseWrite()</code> instead of <code>Close()</code>.</p>\n\n<p>Had to change my TCP Connection code a bit, but it works like a charm.</p>\n\n<p>This solution is perfect for my purposes because I only plan to do 1 Send from a Client connection and possibly 1 Read before I Close it.</p>\n\n<p>Many thanks to everyone who helped!</p>\n\n<p>Below is my updated Golang Client code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"encoding/json\"\n    \"fmt\"\n    \"net\"\n    \"os\"\n    \"strings\"\n)\n\n// Person struct.\ntype Person struct {\n    Name string\n    Age  int\n}\n\nfunc main() {\n    reader := bufio.NewReader(os.Stdin)\n\n    for {\n        func() {\n            // Dial the Java Server.\n            tcpAddr, err := net.ResolveTCPAddr(\"tcp\", \"localhost:9000\")\n            if err != nil {\n                fmt.Println(err)\n                return\n            }\n\n            conn, err := net.DialTCP(\"tcp\", nil, tcpAddr)\n            if err != nil {\n                fmt.Println(err)\n                return\n            }\n\n            defer conn.Close()\n\n            fmt.Print(\"Enter Name: \")\n            strName, err := reader.ReadString('\\n')\n            strName = strings.TrimSpace(strName)\n\n            var person Person\n            person.Name = strName\n            person.Age = 18\n\n            jsonBytes, err := json.Marshal(person)\n            if err != nil {\n                fmt.Println(err)\n                return\n            }\n\n            // Write our message to the connection.\n            _, err = conn.Write(jsonBytes)\n            if err != nil {\n                fmt.Println(err)\n                return\n            }\n\n            // Tell the server that we're done writing.\n            err = conn.CloseWrite()\n            if err != nil {\n                fmt.Println(err)\n                return\n            }\n\n            // Read Message From Server code goes here.\n\n            fmt.Println(\"Sent: \" + string(jsonBytes))\n        }()\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1370, "user_id": 7824245, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh5.googleusercontent.com/-0l2xVxKv9gc/AAAAAAAAAAI/AAAAAAAAABo/GSjROchHomI/photo.jpg?sz=128", "display_name": "Floating Sunfish", "link": "https://stackoverflow.com/users/7824245/floating-sunfish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 962, "favorite_count": 0, "accepted_answer_id": 53716489, "answer_count": 2, "score": 0, "last_activity_date": 1544495065, "creation_date": 1544429140, "last_edit_date": 1544456295, "question_id": 53701654, "link": "https://stackoverflow.com/questions/53701654/golang-tcp-client-does-not-send-end-of-stream-to-java-tcp-server", "title": "Golang TCP Client Does Not Send `End of Stream` to Java TCP Server", "body": "<p>I'm writing a simple Golang TCP Client that talks with a Java TCP Server.</p>\n\n<p>I have successfully gotten my Golang Client to send a message to my Java Server.</p>\n\n<p>However, my Java code is expecting an <code>End of Stream</code> (where <code>inputStream.read()</code> returns <code>-1</code>) to know that it's time to stop reading Client messages.</p>\n\n<p>It looks like Golang does not send an <code>End of Stream</code> message via <code>connection.Write()</code> unless I <code>Close()</code> the connection first.</p>\n\n<p>Below is my Java Server code:</p>\n\n<pre><code>package com.mycompany.app;\n\nimport com.google.gson.*;\nimport com.google.common.primitives.Bytes;\nimport java.io.*;\nimport java.net.Socket;\nimport java.util.ArrayList;\nimport java.util.List;\nimport java.net.ServerSocket;\nimport java.net.SocketException;\n\npublic class MyApp {\n    public static void main(String[] args) {\n        int port = 9000;\n\n        // Start listening for messages.\n        try (ServerSocket serverSocket = new ServerSocket(port)) {\n            System.out.println(\"Listening on port \" + port + \"...\");\n\n            // Never stop listening for messages.\n            while (true) {\n                try {\n                    // Accept a client connection.\n                    Socket socket = serverSocket.accept();\n\n                    // Read message from the client.\n                    DataInputStream inputStream = new DataInputStream(socket.getInputStream());\n\n                    List&lt;Byte&gt; list = new ArrayList&lt;Byte&gt;();\n                    int input = inputStream.read();\n\n                    while (input != -1) {\n                        list.add((byte) input);\n                        input = inputStream.read();\n                    }\n\n                    byte[] jsonBytes = Bytes.toArray(list);\n\n                    if (jsonBytes.length &gt; 0) {\n                        String jsonString = new String(jsonBytes);\n\n                        System.out.println(\"Received: \" + jsonString);\n\n                        // Unmarshal from JSON.\n                        Person person = new Gson().fromJson(jsonString, Person.class);\n\n                        System.out.println(\"Person: \" + person.Name + \" \" + person.Age);\n                    }\n                } catch (EOFException e) {\n                    // A client has disconnected. Do nothing.\n                } catch (SocketException e) {\n                    // A client connection has been terminated unexpectedly. Do nothing.\n                } catch (Exception e) {\n                    e.printStackTrace();\n                }\n            }\n        } catch (Exception e) {\n            e.printStackTrace();\n        }\n    }\n}\n\nclass Person {\n    String Name;\n    int Age;\n}\n</code></pre>\n\n<p>Below is my Golang Client code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"encoding/json\"\n    \"fmt\"\n    \"net\"\n    \"os\"\n    \"strings\"\n)\n\ntype Person struct {\n    Name string\n    Age  int\n}\n\nfunc main() {\n    reader := bufio.NewReader(os.Stdin)\n\n    for {\n        func() {\n            // Dial the Java Server.\n            conn, err := net.Dial(\"tcp\", \"localhost:9000\")\n            if err != nil {\n                fmt.Println(err)\n            }\n\n            defer conn.Close()\n\n            fmt.Print(\"Enter Name: \")\n            strName, err := reader.ReadString('\\n')\n            strName = strings.TrimSpace(strName)\n\n            var person Person\n            person.Name = strName\n            person.Age = 18\n\n            jsonBytes, err := json.Marshal(person)\n            if err != nil {\n                fmt.Println(err)\n                return\n            }\n\n            // Write our message to the connection.\n            _, err = conn.Write(jsonBytes)\n            if err != nil {\n                fmt.Println(err)\n                return\n            }\n\n            fmt.Println(\"Sent: \" + string(jsonBytes))\n        }()\n    }\n}\n</code></pre>\n\n<p>Any advice on how to tell Java that we're done writing messages from Golang? Or is there a better way to handle Java x Golang TCP Client-Server connections?</p>\n\n<p>This is quite a problem because one of the basic scenarios for TCP connections is Send-and-Receive:</p>\n\n<p>e.g.</p>\n\n<ol>\n<li><p>Client sends a message and waits for the result. </p></li>\n<li><p>Server processes the message and returns the result.</p></li>\n<li><p>Client does something with the result.</p></li>\n</ol>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "edited": false, "score": 0, "creation_date": 1544434842, "post_id": 53701458, "comment_id": 94260536, "body": "please take a look at <a href=\"https://play.golang.org/p/fvFvsONstaK\" rel=\"nofollow noreferrer\">play.golang.org/p/fvFvsONstaK</a> for the other case where I use value receiver and it does not show compile error"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1544435729, "post_id": 53701458, "comment_id": 94261052, "body": "You playground code shows a common missconception for value receivers (here on Pair): The method Pair.result is invoked on a <i>copy</i> of the underlying Pair. This copy is modified in lines 19 and 20. After the method is done the modified copy ceases to exist. This has _nothing to do with interfaces."}, {"owner": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1544438572, "post_id": 53701458, "comment_id": 94262553, "body": "The Question is being Misunderstood, I will be more clear in future questions. But now <b>If interface twoTimeable is implemented with (m *MyInt) , a variable of type twoTimeable can be assigned with a variable of type *MyInt. But if you change the implementation such that receiver become (m MyInt), a variable of type twoTimeable can hold MyInt as well as *MyInt. Why?</b>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1544440875, "post_id": 53701458, "comment_id": 94263794, "body": "No. No and again No. You are accessing this problem from the wrong angle. A a variable of type twoTimeable can hold <b>any</b> type with the right set of methods. All this pointer receiver, whatnot is <b>not relevant</b> here. There is literally nothing more to understand in the relation between a variable of type twoTimetable and the implementing type than: Has all methods of twoTimetable or has not. You must stop thinking about more than &quot;which methods does this thing have&quot; when you think of what a variable of type twoTimestable can hold."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1544441136, "post_id": 53701458, "comment_id": 94263941, "body": "The question about why and when a *MyInt or a MyInt has some method is a <b>different</b> question and is <b>unrelated</b> to the former. If you are interested what MyInt&#39;s method set is: That one is simple: Just those method defined like <code>func (m MyInt) ...</code> . If you want to know which methods are in the method set of *MyInt: Look for methods of the form <code>func (pm *MyInt) ...</code> <b>and</b> <code>func (m MyInt) ...</code>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1544441259, "post_id": 53701458, "comment_id": 94263997, "body": "If you are really interested: Come up with small example, with sensible and short names which shows <i>all</i> the behaviour in <i>one</i> example. This &quot;if you change the implementation&quot; just makes the discussion complicated."}, {"owner": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1544442273, "post_id": 53701458, "comment_id": 94264557, "body": "This question is not as clear as I wanted to be I will ask a better question. But I do not want to marked duplicate on that. So I have flagged my own question. If you can help it to be deleted to not confuse the community. Please do the needful. Please do not downvote me while you are at it. Sorry to be unclear"}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 1, "creation_date": 1544443930, "post_id": 53701458, "comment_id": 94265377, "body": "You might split your questions into 2 or 3 different questions, 1 questions seems to be why does <a href=\"https://play.golang.org/p/rIQnPjrhLPL\" rel=\"nofollow noreferrer\">play.golang.org/p/rIQnPjrhLPL</a> (simplified part of your code) result in an error. While 1 other question might be why changing the result() method to take a non-pointer <code>func (m MyInt) result() (int, int) {</code> does not change the value of the <code>MyInt</code>.  Another question is likely &quot;how to create only 1 result method, that works on both pointer and non-pointer versions when assigned to a <code>twoTimeable</code> interface.  Keep your questions short and distinct."}, {"owner": {"reputation": 11828, "user_id": 4420967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J6pYX.png?s=128&g=1", "display_name": "James Z", "link": "https://stackoverflow.com/users/4420967/james-z"}, "edited": false, "score": 0, "creation_date": 1544537211, "post_id": 53701458, "comment_id": 94305022, "body": "If you want the question to be removed, click the [delete] link."}, {"owner": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "reply_to_user": {"reputation": 11828, "user_id": 4420967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J6pYX.png?s=128&g=1", "display_name": "James Z", "link": "https://stackoverflow.com/users/4420967/james-z"}, "edited": false, "score": 0, "creation_date": 1544551703, "post_id": 53701458, "comment_id": 94313556, "body": "@JamesZ No delete link is visible"}, {"owner": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "edited": false, "score": 0, "creation_date": 1544607244, "post_id": 53701458, "comment_id": 94332507, "body": "Now Delete link is Visible but upon deleting it shows &quot;since others have invested time and effort in answering it, it can not be deleted&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "edited": false, "score": 0, "creation_date": 1544433063, "post_id": 53702023, "comment_id": 94259627, "body": "But tt twoTimeable can not hold non pointers , it is showing compilation error."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "edited": false, "score": 0, "creation_date": 1544433299, "post_id": 53702023, "comment_id": 94259751, "body": "No, this statement is wrong. twoTimetables <i>can</i> hold non pointers. The compilation error originates elsewhere. The fact is: twoTimetables can hold only types which implement <code>result() (int, int)</code>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "edited": false, "score": 0, "creation_date": 1544433379, "post_id": 53702023, "comment_id": 94259781, "body": "Yes. That is the problem. MyInt is <i>not</i> a twoTimetable. only *MyInt is."}, {"owner": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "edited": false, "score": 0, "creation_date": 1544433667, "post_id": 53702023, "comment_id": 94259920, "body": "If I make MyInt twoTimeable and no *MyInt , why does *MyInt becomes twoTimeable automatically"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "edited": false, "score": 0, "creation_date": 1544434204, "post_id": 53702023, "comment_id": 94260207, "body": "&quot;why does *MyInt becomes twoTimeable automatically&quot; It does not. It *MyInt has the right method. MyInt doesn&#39;t. These things do not &quot;become&quot; a twoTimetables. They either have or have not the right set of methods. If they do have the right methods: They can be assigned to a twoTimestable. And there are two ways of getting the right methods. See the linkes language spec for details. I <i>urge</i> you to read the linked part of the spec. (And better names like MyInt and twoTimestable would help too)."}, {"owner": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "edited": false, "score": 0, "creation_date": 1544434749, "post_id": 53702023, "comment_id": 94260489, "body": "Thank you for being patient but please take a look at  <a href=\"https://play.golang.org/p/fvFvsONstaK\" rel=\"nofollow noreferrer\">play.golang.org/p/fvFvsONstaK</a> it looks like it *MyInt became twoTimeable."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "edited": false, "score": 0, "creation_date": 1544436138, "post_id": 53702023, "comment_id": 94261267, "body": "No, one last time: You *MyInt has the right method to be assignable to a twoTimetables. It has the right method because *MyInt has all methods of MyInt and MyInt has the proper result method. You example code is <i>not</i> helpful: It crams to much different stuff into one example."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "edited": false, "score": 0, "creation_date": 1544436141, "post_id": 53702023, "comment_id": 94261269, "body": "You have to understand three different and separate concepts. 1. Methods on pointer types and on non-pointer types. Methods on non-pointer types <i>cannot</i> modify their receiver. 2. Method set: What methods does a type T or *T implement. 3. If a type has enough methods it can be assigned to an interface. 4. Sometimes Go takes addresses of variables automatically to go from T to *T."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 1, "last_activity_date": 1544431059, "creation_date": 1544431059, "answer_id": 53702023, "question_id": 53701458, "link": "https://stackoverflow.com/questions/53701458/pointer-receiver-and-value-receiver-on-interfaces-in-golang/53702023#53702023", "title": "Pointer Receiver and Value Receiver on Interfaces in Golang", "body": "<blockquote>\n  <p>Q1 : Why it is fine to use pointers on value receiver methods but not vice vers?</p>\n</blockquote>\n\n<p>Because the language spec say it it fine: <a href=\"https://golang.org/ref/spec#Method_sets\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Method_sets</a> :</p>\n\n<blockquote>\n  <p>The method set of the corresponding pointer type *T is the set of all methods declared with receiver *T or T (that is, it also contains the method set of T).</p>\n</blockquote>\n\n<p>(A possible reason why the spec is like this: Convenience.)</p>\n\n<p>For the rest of the question: I do not have the slightest idea what you are asking. The code of <code>do Something</code> is totally fine. You invoke <code>result</code> on <code>tt</code> which is any type implementing the <code>result() (int, int)</code> method. Whether this type is a pointer type or not is of no interest. You get two <code>int</code>s back from this method call and can do whatever you want with these ints. </p>\n\n<p>(Regarding the \"pointer to interface\" part: Yes. It is technically possible to do <code>ttp *twoTimetable</code>. But you <em>never</em> need this. Never. (Of course this is a lie but the case you need it is so rare and delicate that you really never need this as a beginner and once you do need it you will know how to use it.) There is one thing to remember here: You never do \"pointer to interface\".)</p>\n"}, {"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 0, "last_activity_date": 1544435512, "creation_date": 1544435512, "answer_id": 53703112, "question_id": 53701458, "link": "https://stackoverflow.com/questions/53701458/pointer-receiver-and-value-receiver-on-interfaces-in-golang/53703112#53703112", "title": "Pointer Receiver and Value Receiver on Interfaces in Golang", "body": "<blockquote>\n  <p>Is there a way that if function accept param (tt twoTimeable) i will be able to invoke tt.result() irrespective tt being a pointer to type or not, given result() is only definded with pointer receiver.</p>\n</blockquote>\n\n<p>This seems to be a major missconception here. If if <code>tt</code> is a variable of the interface type <code>twoTimetable</code> than is <em>has</em> a <code>result</code> method and this method can be called. Whytever the underlying type of the <code>tt</code> is <em>does</em> <em>not</em> <em>matter</em> at all. A interface type completely encapsulates the underlying type from being relevant. An interface type provides a set of methods and these can be called and no other method can be called.</p>\n\n<p>The question of <em>assignability</em> of a concrete type (e.g. you MyInt) to a variable of type twoInterfaces is a <em>different</em> <em>question</em>. If your concrete type (e.g. MyInt) happens to have all methods defined by the interface type (here twoTimetables) then it is assignable, if not, then not.</p>\n\n<p>The question \"what methods does my concrete type have\" is a third question. This one is the only question which is a bit complicated. Any method defined on receiver T is a method of T. For pointer types *T the methods on *T <em>and</em> the methods on T count.</p>\n"}, {"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": -1, "last_activity_date": 1544443860, "creation_date": 1544443860, "answer_id": 53705391, "question_id": 53701458, "link": "https://stackoverflow.com/questions/53701458/pointer-receiver-and-value-receiver-on-interfaces-in-golang/53705391#53705391", "title": "Pointer Receiver and Value Receiver on Interfaces in Golang", "body": "<blockquote>\n  <p>Shouldn't it for m2 and p2, because now there is no implementation of result using *MyInt and *Pair</p>\n</blockquote>\n\n<p>No. You are conflating different things and misinterpreting the results.</p>\n\n<p>Go lets you omit pointer dereferencing in most situations.</p>\n\n<pre><code>type Pair struct {\n    n1, n2 int\n}\nvar pp *Pair = ...\nfmt.Println(pp.n1)\n</code></pre>\n\n<p>See the last line? <code>pp</code> is a pointer to Pair but there is no need to write <code>(*pp).n1</code>.\nThis dereferencing is inserted automatically (it is the automatic variant of the <code>-&gt;</code> operator in C).</p>\n\n<p>Your m2 and p2 are just variables containing a pointer. If needed these pointers will be dereferenced. This has <strong>nothing</strong> to do with pointer/value-receivers or interfaces.</p>\n"}], "owner": {"reputation": 160, "user_id": 10562862, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e008e66b85602b28959d0b91339f8b2a?s=128&d=identicon&r=PG&f=1", "display_name": "topenion", "link": "https://stackoverflow.com/users/10562862/topenion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1276, "favorite_count": 0, "accepted_answer_id": 53702023, "answer_count": 3, "score": 1, "last_activity_date": 1544493122, "creation_date": 1544428246, "last_edit_date": 1544493122, "question_id": 53701458, "link": "https://stackoverflow.com/questions/53701458/pointer-receiver-and-value-receiver-on-interfaces-in-golang", "title": "Pointer Receiver and Value Receiver on Interfaces in Golang", "body": "<p><strong>This question is not as clear as I wanted to be I will ask a better question. But I do not want to marked duplicate on that. So I have flagged my own question. If you can help it to be deleted to not confuse the community. Please do the needful. Please do not downvote me while you are at it. Sorry to be unclear</strong></p>\n\n<p>I am new to golang and just getting the hang of it. </p>\n\n<p>I am learning by taking Tour of Go and then using it with my own understanding.\nI was at <a href=\"https://tour.golang.org/methods/9\" rel=\"nofollow noreferrer\">Interfaces</a> and started to implement with my own understanding.\nHere is <a href=\"https://play.golang.org/p/v_PkMKqM9Jw\" rel=\"nofollow noreferrer\">Go PlayGround Link</a></p>\n\n<p>Step 1 : I made 3 types an int, a struct and an interface</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype MyInt int\n\ntype Pair struct {\n    n1, n2 int\n}\n\ntype twoTimeable interface {\n    result() (int, int)\n}\n</code></pre>\n\n<p>Step 2 : Then I implemeted twoTimeable for pointer receivers because it changes underlying value.</p>\n\n<pre><code>func (p *Pair) result() (int, int) {\n    p.n1 = 2 * p.n1\n    p.n2 = 2 * p.n2\n    return p.n1, p.n2\n}\n\nfunc (m *MyInt) result() (int, int) {\n    *m = 2 * (*m)\n    return int(*m), 0\n}\n</code></pre>\n\n<p>Step 3 : Then I declared and assigned MyInt, Pair and their corresponding pointers in main function. I also declared twoTimeable interface</p>\n\n<pre><code>mtemp := MyInt(2)\nvar m1 MyInt\nvar m2 *MyInt\nvar p1 Pair\nvar p2 *Pair\nm1, m2, p1, p2 = MyInt(1), &amp;mtemp, Pair{3, 4}, &amp;Pair{5, 6}\nvar tt twoTimeable\n\nfmt.Println(\" Values  : \", m1, *m2, p1, *p2, tt)\n</code></pre>\n\n<p>Step 4 : The I assigned MyInt,Pair and their pointers , called the implemented method and printed. </p>\n\n<pre><code>tt = m1\nfmt.Println(tt.result())\nfmt.Printf(\"Value of m1 %v\\n\", m1)\n\ntt = m2\nfmt.Println(tt.result())\nfmt.Printf(\"Value of m2 %v\\n\", *m2)\n\ntt = p1\nfmt.Println(tt.result())\nfmt.Printf(\"Value of p1 %v\\n\", p1)\n\ntt = p2\nfmt.Println(tt.result())\nfmt.Printf(\"Value of p2 %v\\n\", *p2)\n</code></pre>\n\n<p>It shows error :</p>\n\n<pre><code>prog.go:41:5: cannot use m1 (type MyInt) as type twoTimeable in assignment:\n    MyInt does not implement twoTimeable (result method has pointer receiver)\nprog.go:49:5: cannot use p1 (type Pair) as type twoTimeable in assignment:\n    Pair does not implement twoTimeable (result method has pointer receiver)\n</code></pre>\n\n<p>I also read <a href=\"https://stackoverflow.com/questions/45652560/interfaces-and-pointer-receivers\">this question</a>, I got that m1 and p1 are not addressable, thats why it wont compile.\nBut method result() will just work fine if I use p1, or m1  <code>p1/m1.result()</code> (auto dereferencing FTW)</p>\n\n<p><strong>Now in Step 2 when I change the pointer receiver to value receiver, and change *m to m(I am aware of change in Output)</strong></p>\n\n<pre><code>func (p Pair) result() (int, int) {\n    p.n1 = 2 * p.n1\n    p.n2 = 2 * p.n2\n    return p.n1, p.n2\n}\n\nfunc (m MyInt) result() (int, int) {\n    m = 2 * (m)\n    return int(m), 0\n}\n</code></pre>\n\n<p>It suddenly does not show compile error. shouldn't it for m2 and p2, because now there is no implementation of result using *MyInt and *Pair</p>\n\n<p>That means if interface method implementation has value receiver tt can hold both pointer and value.\nBut when interface method implemenation has pointer reciever it cant hold non pointers.</p>\n\n<blockquote>\n  <p>Q1 : Why it is fine to use pointers  (tt = m2) on value receiver interface methods(p MyInt) result() ,  but not values (tt = m1) on pointer receiver interface method(p *MyInt) result().</p>\n</blockquote>\n\n<p>Now lets revert to pointer receivers. </p>\n\n<blockquote>\n  <p>Is there a way that if function accept param (tt twoTimeable) i will be able to invoke tt.result() irrespective tt being a pointer to type or not, given result() is only definded with pointer receiver.</p>\n</blockquote>\n\n<p>See the code below:</p>\n\n<pre><code>func doSomething(tt twoTimeable) {\n    temp1, temp2 := tt.result()\n    fmt.Print(\"doing something with \", temp1, temp2)\n} \n</code></pre>\n\n<p>Since tt can be any predefined type(pointer or not a pointer), accpting param (tt *twoTimeable, if I can even do that) does not seem like a solution or do I have rely on user of function to provide pointer. If i do not have to change underlying value i.e use value receiver its not a problem as tt can hold either value or pointer to that</p>\n\n<p>I always Accept answer.</p>\n"}, {"tags": ["go", "data-structures"], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 7061054, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71a240abc061fecaf25ff29be92195fb?s=128&d=identicon&r=PG&f=1", "display_name": "Shyam", "link": "https://stackoverflow.com/users/7061054/shyam"}, "edited": false, "score": 0, "creation_date": 1544426891, "post_id": 53700891, "comment_id": 94257097, "body": "The only file operation here is writing to the file. The lines to be written will be string generated by me. Not reading anything from file. Still bufio helps?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 71, "user_id": 7061054, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71a240abc061fecaf25ff29be92195fb?s=128&d=identicon&r=PG&f=1", "display_name": "Shyam", "link": "https://stackoverflow.com/users/7061054/shyam"}, "edited": false, "score": 0, "creation_date": 1544429862, "post_id": 53700891, "comment_id": 94258213, "body": "@Shyam: See my revised answer. I have added a Go benchmark."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1544430728, "last_edit_date": 1544430728, "creation_date": 1544425235, "answer_id": 53700891, "question_id": 53700730, "link": "https://stackoverflow.com/questions/53700730/how-to-efficiently-do-multiple-writes-to-a-file/53700891#53700891", "title": "How to efficiently do multiple writes to a file", "body": "<p>To amortize the cost of operating system file reads and writes, use the Go standard library <a href=\"https://golang.org/pkg/bufio/\" rel=\"nofollow noreferrer\"><code>bufio</code></a>package.</p>\n\n<hr>\n\n<p>Here's a Go benchmark to illustrate the point: <code>bufio</code> is much faster.</p>\n\n<pre><code>$ go test bufio_test.go -bench=.\ngoos: linux\ngoarch: amd64\nBenchmarkBufioWrite-4    50     20887474 ns/op    6774811 B/op    147938 allocs/op\nBenchmarkOSWrite-4        3    387543398 ns/op    6022413 B/op    104415 allocs/op\n$\n</code></pre>\n\n<p><code>bufio_test.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"io/ioutil\"\n    \"os\"\n    \"strings\"\n    \"testing\"\n)\n\nfunc BenchmarkBufioWrite(b *testing.B) {\n    b.ReportAllocs()\n    b.ResetTimer()\n    for N := 0; N &lt; b.N; N++ {\n        out, err := ioutil.TempFile(``, `StackOverflow`)\n        if err != nil {\n            b.Fatal(err)\n        }\n        outName := out.Name()\n        w := bufio.NewWriter(out)\n        for _, line := range benchLines {\n            _, err := w.Write([]byte(line))\n            if err != nil {\n                b.Fatal(err)\n            }\n        }\n        err = w.Flush()\n        if err != nil {\n            b.Fatal(err)\n        }\n        err = out.Close()\n        if err != nil {\n            b.Fatal(err)\n        }\n        os.Remove(outName)\n    }\n}\n\nfunc BenchmarkOSWrite(b *testing.B) {\n    b.ReportAllocs()\n    b.ResetTimer()\n    for N := 0; N &lt; b.N; N++ {\n        out, err := ioutil.TempFile(``, `StackOverflow`)\n        if err != nil {\n            b.Fatal(err)\n        }\n        outName := out.Name()\n        w := out\n        for _, line := range benchLines {\n            _, err := w.Write([]byte(line))\n            if err != nil {\n                b.Fatal(err)\n            }\n        }\n        err = out.Close()\n        if err != nil {\n            b.Fatal(err)\n        }\n        os.Remove(outName)\n    }\n}\n\nvar benchLines = func() []string {\n    // The Complete Works of William Shakespeare by William Shakespeare\n    // http://www.gutenberg.org/files/100/100-0.txt\n    data, err := ioutil.ReadFile(`/home/peter/shakespeare.100-0.txt`)\n    if err != nil {\n        panic(err)\n    }\n    return strings.Split(string(data), \"\\n\")\n}()\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 7061054, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/71a240abc061fecaf25ff29be92195fb?s=128&d=identicon&r=PG&f=1", "display_name": "Shyam", "link": "https://stackoverflow.com/users/7061054/shyam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1544430728, "creation_date": 1544424539, "last_edit_date": 1544424791, "question_id": 53700730, "link": "https://stackoverflow.com/questions/53700730/how-to-efficiently-do-multiple-writes-to-a-file", "title": "How to efficiently do multiple writes to a file", "body": "<p>I need to write multiple lines to a file in Go. Those lines will be generated by another method. So, to write into a file, I thought of doing as many writes to the file as the number of lines. But writing to a file is a costly operation. I am thinking of a very optimistic way of writing to the file. What could be the data structure I could use here?</p>\n"}, {"tags": ["amazon-web-services", "go", "nosql", "amazon-dynamodb"], "answers": [{"comments": [{"owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "edited": false, "score": 1, "creation_date": 1544424622, "post_id": 53699557, "comment_id": 94256249, "body": "OP should probably use <code>dynamodbav</code> instead of <code>json</code>, e.g: <code>dynamodbav:&quot;id&quot;</code>since they are working with dynamodb."}, {"owner": {"reputation": 1014, "user_id": 1483412, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/OO4KC.png?s=128&g=1", "display_name": "severin.julien", "link": "https://stackoverflow.com/users/1483412/severin-julien"}, "edited": false, "score": 0, "creation_date": 1546325384, "post_id": 53699557, "comment_id": 94824742, "body": "You saved my life"}], "tags": [], "owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "is_accepted": true, "score": 3, "last_activity_date": 1544416518, "creation_date": 1544416518, "answer_id": 53699557, "question_id": 53698997, "link": "https://stackoverflow.com/questions/53698997/golang-dynamodb-unmarshallistofmaps-returns-array-of-empty/53699557#53699557", "title": "Golang DynamoDB UnmarshalListOfMaps Returns Array of Empty", "body": "<p>Only public fields can be unmarshaled.</p>\n\n<p>Make your struct fields public using uppercase letter and use <code>json</code> attribute to map them to data values:  </p>\n\n<pre><code>type Product struct {\n    ID     int    `json:\"id\"`\n    Active bool   `json:\"active\"`\n    Name   string `json:\"name\"`\n    Price  int    `json:\"price\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 10768820, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-9lku7ADoBVI/AAAAAAAAAAI/AAAAAAAAAAA/UxvfCwVZNdo/photo.jpg?sz=128", "display_name": "david", "link": "https://stackoverflow.com/users/10768820/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 608, "favorite_count": 0, "accepted_answer_id": 53699557, "answer_count": 1, "score": 2, "last_activity_date": 1544416518, "creation_date": 1544411442, "question_id": 53698997, "link": "https://stackoverflow.com/questions/53698997/golang-dynamodb-unmarshallistofmaps-returns-array-of-empty", "title": "Golang DynamoDB UnmarshalListOfMaps Returns Array of Empty", "body": "<p>I have a DynamoDB table of products (id (int), active (bool), name (string), price (int)) and when I retrieve and attempt to unmarshal the list, it returns empty.</p>\n\n<pre><code>[{},{}]\n</code></pre>\n\n<p>Struct:</p>\n\n<pre><code>type Product struct {\nid     int\nactive bool\nname   string\nprice  int }\n</code></pre>\n\n<p>And the code to unmarshal is here:</p>\n\n<pre><code>    params := &amp;dynamodb.ScanInput{\n    TableName: aws.String(\"Products\"),\n}\nresult, err := service.Scan(params)\nif err != nil {\n    fmt.Errorf(\"failed to make Query API call, %v\", err)\n}\n\nvar products = []Product{}\n\nvar error = dynamodbattribute.UnmarshalListOfMaps(result.Items, &amp;products)\n</code></pre>\n\n<p>What am I doing wrong here? </p>\n"}, {"tags": ["string", "go", "slice"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1544407061, "post_id": 53698513, "comment_id": 94252356, "body": "FYI, the terminology you&#39;re looking for here is &quot;expansion&quot;."}, {"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1544407078, "post_id": 53698513, "comment_id": 94252361, "body": "You really want people here to do your homework?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1544421919, "post_id": 53698513, "comment_id": 94255346, "body": "I&#39;m voting to close this question as off-topic because homework."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1544424649, "post_id": 53698513, "comment_id": 94256258, "body": "@Volker: Read <a href=\"https://meta.stackoverflow.com/questions/334822/how-do-i-ask-and-answer-homework-questions\">How do I ask and answer homework questions?</a>."}, {"owner": {"reputation": 23, "user_id": 2882449, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c3a88d1728beaf06a2436a6eaf446b4?s=128&d=identicon&r=PG&f=1", "display_name": "user2882449", "link": "https://stackoverflow.com/users/2882449/user2882449"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1544433739, "post_id": 53698513, "comment_id": 94259959, "body": "@Volker I am not sure what do you mean by homework question. I was stuck with the logic here which was explained in answer by ssemilla below. I can see similar kind of questions upvoted several times in other programming languages.   P.S. I am not sure how many university courses are based on golang to give homeworks!"}], "answers": [{"tags": [], "owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "is_accepted": true, "score": 1, "last_activity_date": 1544420813, "creation_date": 1544420813, "answer_id": 53700111, "question_id": 53698513, "link": "https://stackoverflow.com/questions/53698513/expand-a-string-of-slice-by-delimiter/53700111#53700111", "title": "Expand a string of slice by delimiter", "body": "<p>Running time aside, you can achieve this with recursion.</p>\n\n<pre><code>func Perm(digits [][]string) (perm [][]string) {\n\n    if len(digits) == 0 || len(digits) == 1 {\n        return digits\n    }\n\n    nextDigits := Perm(digits[1:])\n    for _, digit := range digits[0] {\n        for _, next := range nextDigits {\n            cat := append([]string{digit}, next...)\n            perm = append(perm, cat)\n        }\n    }\n\n    return perm\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/uq-XuPSz171\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 23, "user_id": 2882449, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c3a88d1728beaf06a2436a6eaf446b4?s=128&d=identicon&r=PG&f=1", "display_name": "user2882449", "link": "https://stackoverflow.com/users/2882449/user2882449"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 121, "favorite_count": 0, "accepted_answer_id": 53700111, "answer_count": 1, "score": 0, "last_activity_date": 1544420813, "creation_date": 1544406380, "last_edit_date": 1544408591, "question_id": 53698513, "link": "https://stackoverflow.com/questions/53698513/expand-a-string-of-slice-by-delimiter", "title": "Expand a string of slice by delimiter", "body": "<p>I want to expand a string of slice by delimiter \"/\".</p>\n\n<p>For example, expanding the following slice</p>\n\n<pre><code>s := []string{\"5/3\",\"9\",\"5/4/1\",\"6\"}\n</code></pre>\n\n<p>Should produce individual slices :</p>\n\n<pre><code>[\"5\",\"9\",\"5\",\"6\"] [\"5\",\"9\",\"4\",\"6\"] [\"5\",\"9\",\"1\",\"6\"]\n[\"3\",\"9\",\"5\",\"6\"] [\"3\",\"9\",\"4\",\"6\"] [\"3\",\"9\",\"1\",\"6\"]\n</code></pre>\n\n<p>I am pretty much stuck here </p>\n\n<pre><code>var c [][]string{}\ns := []string{\"5/3\",\"9\",\"5/4/1\",\"6\"}\nfor _, v := range s {\n    combos := strings.Split(v, \"/\")\n    for _, combo := range combos {\n\n    }       \n}\n</code></pre>\n"}, {"tags": ["string", "go", "slice"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 5, "creation_date": 1544404334, "post_id": 53698275, "comment_id": 94251904, "body": "That&#39;s the shortest code using functions available in the standard library."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1544424921, "post_id": 53698275, "comment_id": 94256368, "body": "Go doesn&#39;t like &quot;quick one-liners&quot;. Go takes the approach to never hide complexity, so an explicit for loop is the correct approach in Go."}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1544457285, "post_id": 53698275, "comment_id": 94272833, "body": "you could wrap that code in a func and then call it as a one-liner.  Funcs are cheap in Go"}], "answers": [{"tags": [], "owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "is_accepted": false, "score": 0, "last_activity_date": 1544424878, "last_edit_date": 1544424878, "creation_date": 1544422843, "answer_id": 53700427, "question_id": 53698275, "link": "https://stackoverflow.com/questions/53698275/convert-int-to-string-in-golang-in-one-line/53700427#53700427", "title": "Convert []int to []string in golang in one line", "body": "<p>It seems that you are looking for a <code>map</code> function that operates on slices. That would require generics and as of Go 1.11, generics are not yet supported. The standard library also doesn't provide a built-in function for these types of operations (map, filter, reduce, etc).</p>\n\n<p>What you already have is quite enough for this simple use case. Wrap it in a function and that would fit your need. Until Go supports generics, you have to hand write operations on each type of slice.</p>\n\n<p>Some links for reading:</p>\n\n<p><a href=\"https://go.googlesource.com/proposal/+/master/design/go2draft-generics-overview.md\" rel=\"nofollow noreferrer\">Generics Proposal</a></p>\n\n<p><a href=\"https://github.com/robpike/filter\" rel=\"nofollow noreferrer\">Rob Pike's Filter Library</a></p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 0, "last_activity_date": 1544437940, "last_edit_date": 1544437940, "creation_date": 1544429608, "answer_id": 53701747, "question_id": 53698275, "link": "https://stackoverflow.com/questions/53698275/convert-int-to-string-in-golang-in-one-line/53701747#53701747", "title": "Convert []int to []string in golang in one line", "body": "<p>What you want <em>can</em> be done with a single line, but those solutions are inferior (in performance) to the simple loop you presented in the question. So here come some one-liners, but I would probably never use them to achieve what you want, so just use a <code>for</code> loop, and if you have to do this many times, create a helper function (that will use the loop), and just call the helper function.</p>\n\n<p>The following one-liners all build on the <a href=\"https://golang.org/pkg/fmt/#Sprint\" rel=\"nofollow noreferrer\"><code>fmt.Sprint()</code></a> function, which generates a string representation for <code>int</code> slices like this (without the quotes):</p>\n\n<pre><code>\"[e1 e2 e3...]\"\n</code></pre>\n\n<p>Where <code>e1</code>, <code>e2</code>... are the elements of the input slice.</p>\n\n<p>So for example:</p>\n\n<pre><code>nums := []int{1, 2, -3, 4}\ns := fmt.Sprint(nums)\nfmt.Printf(\"%q\", s)\n</code></pre>\n\n<p>Will output (try it on the <a href=\"https://play.golang.org/p/i_9JhLtFFmH\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>\"[1 2 -3 4]\"\n</code></pre>\n\n<p>We may \"transform\" this single <code>string</code> value to its elements using 2 steps:</p>\n\n<ol>\n<li>Get rid of the leading and trailing square brackets</li>\n<li>Split (break) the remaining text on spaces</li>\n</ol>\n\n<p>And we're done.</p>\n\n<p>For the first step, we have several options, e.g. <a href=\"https://golang.org/pkg/strings/#Replace\" rel=\"nofollow noreferrer\"><code>strings.Replace()</code></a>, <a href=\"https://golang.org/pkg/strings/#Replacer\" rel=\"nofollow noreferrer\"><code>strings.Replacer</code></a>, <a href=\"https://golang.org/pkg/strings/#Trim\" rel=\"nofollow noreferrer\"><code>strings.Trim()</code></a>. We may \"spice\" up the trimming by slicing the string, to cut its first character (e.g. <code>s[1:]</code>) so then it will be only needed to remove the trailing <code>']'</code>.</p>\n\n<p>For the second step, we have <a href=\"https://golang.org/pkg/strings/#Split\" rel=\"nofollow noreferrer\"><code>strings.Split()</code></a>.</p>\n\n<p>Without all the possible combinations, here are 3 one-liner examples to convert an <code>int</code> slice to a <code>string</code> slice:</p>\n\n<pre><code>nums := []int{1, 2, -3, 4}\n\nsNums := strings.Split(strings.Replace(fmt.Sprint(nums)[1:], \"]\", \"\", -1), \" \")\nfmt.Printf(\"%q\\n\", sNums)\n\nsNums2 := strings.Split(strings.Trim(fmt.Sprint(nums), \"[]\"), \" \")\nfmt.Printf(\"%q\\n\", sNums2)\n\nsNums3 := strings.Split(strings.TrimRight(fmt.Sprint(nums)[1:], \"]\"), \" \")\nfmt.Printf(\"%q\\n\", sNums3)\n</code></pre>\n\n<p>Output of the above (try it on the <a href=\"https://play.golang.org/p/4JDvuIU1uuh\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[\"1\" \"2\" \"-3\" \"4\"]\n[\"1\" \"2\" \"-3\" \"4\"]\n[\"1\" \"2\" \"-3\" \"4\"]\n</code></pre>\n\n<p>There is one edge case that none of the above solutions handle: if the input is an empty slice, the output will be a slice containing an empty string (when it should be an empty slice). The reason for this is because if the input does not contain the space separator (in this case it's the empty string), <code>strings.Split()</code> returns the input (which will be the empty string).</p>\n\n<p>To handle the empty-input-slice edge case, we may use the <a href=\"https://golang.org/pkg/strings/#SplitN\" rel=\"nofollow noreferrer\"><code>strings.SplitN()</code></a> function instead of <code>strings.Split()</code>, passing <code>len(nums)</code> as the max number of parts we want. So if the input slice is empty, the output slice will also be empty:</p>\n\n<pre><code>nums := []int{}\n\nsNums := strings.SplitN(strings.Replace(fmt.Sprint(nums)[1:], \"]\", \"\", -1), \" \", len(nums))\nfmt.Printf(\"%q\\n\", sNums)\n\nsNums2 := strings.SplitN(strings.Trim(fmt.Sprint(nums), \"[]\"), \" \", len(nums))\nfmt.Printf(\"%q\\n\", sNums2)\n\nsNums3 := strings.SplitN(strings.TrimRight(fmt.Sprint(nums)[1:], \"]\"), \" \", len(nums))\nfmt.Printf(\"%q\\n\", sNums3)\n</code></pre>\n\n<p>This will properly output (try it on the <a href=\"https://play.golang.org/p/acrK3HbjQju\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[]\n[]\n[]\n</code></pre>\n\n<p>One thing to note here: the presented solutions are kind of like generic, because the solutions work with other types of slices, e.g. <code>[]int8</code>, <code>[]int32</code>, <code>[]float32</code> etc., even with arrays, e.g. <code>[4]int</code>...</p>\n"}], "owner": {"reputation": 8476, "user_id": 1819254, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/27Gbn.png?s=128&g=1", "display_name": "Pranjal Mittal", "link": "https://stackoverflow.com/users/1819254/pranjal-mittal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1050, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1544437940, "creation_date": 1544403887, "last_edit_date": 1544429834, "question_id": 53698275, "link": "https://stackoverflow.com/questions/53698275/convert-int-to-string-in-golang-in-one-line", "title": "Convert []int to []string in golang in one line", "body": "<p>I'm a beginner with Go. Converting a slice of ints to a slice of strings seems simple with a few lines:</p>\n\n<pre><code>nums := []int{1, 2, 3, 4}\nsNums := make([]string, len(nums))\nfor i, x := range nums {\n    sNums[i] = strconv.Itoa(x)\n}\n</code></pre>\n\n<p>However, I am wondering if there is a way to do it using a quick one-liner using built-ins/standard library, similar to the following in Python:</p>\n\n<pre><code>sNums = map(str, nums)\n</code></pre>\n"}, {"tags": ["go", "redis"], "answers": [{"comments": [{"owner": {"reputation": 15599, "user_id": 73831, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4813b578ef6e0ca5ba25a77f57fdb5f1?s=128&d=identicon&r=PG", "display_name": "Sudhir Jonathan", "link": "https://stackoverflow.com/users/73831/sudhir-jonathan"}, "edited": false, "score": 0, "creation_date": 1544420959, "post_id": 53697645, "comment_id": 94255034, "body": "Consider <a href=\"https://msgpack.org/index.html\" rel=\"nofollow noreferrer\">MessagePack</a> as well. Gob is great in that it&#39;s super optimized and will work even with small changes in the struct, but you still need a destination struct in Go that&#39;s same/similar do your source. MessagePack works like JSON with overhead closer to Gob."}, {"owner": {"reputation": 1715, "user_id": 8712494, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-iWUnn1PqAuw/AAAAAAAAAAI/AAAAAAAAAGQ/2OslFo_DLk4/photo.jpg?sz=128", "display_name": "Amin Shojaei", "link": "https://stackoverflow.com/users/8712494/amin-shojaei"}, "edited": false, "score": 1, "creation_date": 1596287571, "post_id": 53697645, "comment_id": 111767202, "body": "Thanks. It&#39;s fine. But i wish there was a way to use <code>redis hash</code> and store values side-by-side"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 15, "last_activity_date": 1544397159, "creation_date": 1544397159, "answer_id": 53697645, "question_id": 53697507, "link": "https://stackoverflow.com/questions/53697507/save-generic-struct-to-redis/53697645#53697645", "title": "Save generic struct to redis", "body": "<p>Encode the struct value to a []byte using the <a href=\"https://godoc.org/encoding/gob\" rel=\"noreferrer\">gob</a>, <a href=\"https://godoc.org/encoding/json\" rel=\"noreferrer\">json</a> or similar encoding package.  Store the []byte in Redis.  Reverse the process when fetching the data.  </p>\n\n<p>Assuming a Redis client with methods for <a href=\"https://redis.io/commands/set\" rel=\"noreferrer\">Set</a> and <a href=\"https://redis.io/commands/get\" rel=\"noreferrer\">Get</a>, the code using the JSON package will look something like this:</p>\n\n<pre><code>func set(c *RedisClient, key string, value interface{}) error {\n    p, err := json.Marshal(value)\n    if err != nil {\n       return err\n    }\n    return c.Set(key, p)\n}\n\nfunc get(c *RedisClient, key string, dest interface{}) error {\n    p, err := c.Get(key)\n    if err != nil {\n       return err\n    }\n    return json.Unmarshal(p, dest)\n}\n</code></pre>\n\n<p>Use it like this to save a value:</p>\n\n<pre><code>var v someType\nif err := set(c, key, v); err != nil {\n     // handle error\n}\n</code></pre>\n\n<p>and like this to retrieve a value. Note that a pointer to the value is passed to <code>get</code>.</p>\n\n<pre><code>var v someType\nif err := get(c, key, &amp;v); err != nil {\n     // handle error\n}\n</code></pre>\n\n<p>The details will need to adjusted depending on the Redis client that you are using.</p>\n\n<p>This approach avoids repetition and is type safe as long as the application sets and gets values for a given key using the same type.</p>\n"}], "owner": {"reputation": 431, "user_id": 8885009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72ecedabc7ff9c8ed282ebe0d757c722?s=128&d=identicon&r=PG&f=1", "display_name": "Max", "link": "https://stackoverflow.com/users/8885009/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5670, "favorite_count": 0, "accepted_answer_id": 53697645, "answer_count": 1, "score": 5, "last_activity_date": 1544417039, "creation_date": 1544396096, "question_id": 53697507, "link": "https://stackoverflow.com/questions/53697507/save-generic-struct-to-redis", "title": "Save generic struct to redis", "body": "<p>while writing a golang webserver I had to use some sort of cache so i chose redis.\nI had the need for some sort of function that takes any structure and saves it as is to redis as a value.\nIs there any way to do this without using the <code>interface{}</code> as a receiving parameter or repeating myself too much and still staying type safe?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 667, "user_id": 595830, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/7b5e1513fb3adb18d731fb5f56cf0837?s=128&d=identicon&r=PG", "display_name": "Arpan Solanki", "link": "https://stackoverflow.com/users/595830/arpan-solanki"}, "edited": false, "score": 0, "creation_date": 1544389536, "post_id": 53696128, "comment_id": 94248722, "body": "I had tried that but i am getting a compilation error &quot;cannot convert nil to type dynamodb.StreamSpecification&quot; Here is the struct <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/dynamodb/#StreamSpecification\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/sdk-for-go/api/service/dynamodb/&hellip;</a>"}, {"owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "reply_to_user": {"reputation": 667, "user_id": 595830, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/7b5e1513fb3adb18d731fb5f56cf0837?s=128&d=identicon&r=PG", "display_name": "Arpan Solanki", "link": "https://stackoverflow.com/users/595830/arpan-solanki"}, "edited": false, "score": 0, "creation_date": 1544390187, "post_id": 53696128, "comment_id": 94248888, "body": "Can you just include a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> in your question - hard to diagnose if we can&#39;t see your actual code."}], "tags": [], "owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "is_accepted": false, "score": 0, "last_activity_date": 1544385437, "creation_date": 1544385437, "answer_id": 53696128, "question_id": 53695887, "link": "https://stackoverflow.com/questions/53695887/how-to-check-if-struct-value-exists-within-a-struct/53696128#53696128", "title": "How to check if struct value exists within a struct", "body": "<p>It sounds like you're trying to access <code>StreamEnabled</code> or <code>StreamViewType</code> when you haven't first confirmed if <code>StreamSpecification</code> was provided in the JSON object.</p>\n\n<p>Assuming you have the internal <code>StreamSpecification</code> as a reference to a struct, you need to ensure that <code>StreamSpecification</code> isn't <code>nil</code>:</p>\n\n<pre><code>if (instance.StreamSpecification == nil) {\n    // StreamSpecification was not passed in the JSON.\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "is_accepted": true, "score": 2, "last_activity_date": 1544415131, "last_edit_date": 1544415131, "creation_date": 1544394171, "answer_id": 53697284, "question_id": 53695887, "link": "https://stackoverflow.com/questions/53695887/how-to-check-if-struct-value-exists-within-a-struct/53697284#53697284", "title": "How to check if struct value exists within a struct", "body": "<p>If I understand the question correctly, I would convert the struct into a map, and then check if the field you are interested in is in the map.</p>\n\n<p>For example:</p>\n\n<pre><code>package main                                                                                                                       \n\nimport (                                                                                                                           \n    \"encoding/json\"                                                                                                                \n    \"fmt\"                                                                                                                          \n)                                                                                                                                  \n\ntype MyStruct struct {                                                                                                             \n    Name  string                                                                                                                   \n    Score int                                                                                                                      \n}                                                                                                                                  \n\nfunc main() {                                                                                                                      \n\n    ms := MyStruct{Name: \"Amy\", Score: 34}                                                                                         \n\n    var myMap map[string]interface{}                                                                                               \n    data, _ := json.Marshal(ms)                                                                                                    \n    fmt.Println(data)                                                                                                              \n\n    json.Unmarshal(data, &amp;myMap)                                                                                                   \n\n    fmt.Println(myMap)                                                                                                             \n\n    _, ok := myMap[\"Name\"]                                                                                                         \n    fmt.Printf(\"name is in myMap: %t\\n\", ok)                                                                                       \n\n    _, ok = myMap[\"Location\"]                                                                                                      \n    fmt.Printf(\"Location is in myMap: %t\\n\", ok)                                                                                   \n\n} \n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/jjByob2XP6-\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n"}], "owner": {"reputation": 667, "user_id": 595830, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/7b5e1513fb3adb18d731fb5f56cf0837?s=128&d=identicon&r=PG", "display_name": "Arpan Solanki", "link": "https://stackoverflow.com/users/595830/arpan-solanki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2406, "favorite_count": 0, "accepted_answer_id": 53697284, "answer_count": 2, "score": -1, "last_activity_date": 1544415131, "creation_date": 1544383694, "last_edit_date": 1544386025, "question_id": 53695887, "link": "https://stackoverflow.com/questions/53695887/how-to-check-if-struct-value-exists-within-a-struct", "title": "How to check if struct value exists within a struct", "body": "<p>I am retrieving data from an API.\nThe struct output is :</p>\n\n<pre><code> {\n    StreamSpecification: {\n      StreamEnabled: true,\n      StreamViewType: \"NEW_AND_OLD_IMAGES\"\n     },\n    TableStatus: \"ACTIVE\"\n  }\n</code></pre>\n\n<p>But if the API output does not have StreamSpecification in it, I am receiving the following error when trying to print the struct.</p>\n\n<p><strong>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=xxxxxxxx]</strong></p>\n\n<p>How to check if the struct StreamSpecification exists in the value? Or how to fix the issue in any other way?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 7404156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e01311006d6ba4d63773e2c1f1fd295?s=128&d=identicon&r=PG&f=1", "display_name": "Katie Daniels", "link": "https://stackoverflow.com/users/7404156/katie-daniels"}, "edited": false, "score": 0, "creation_date": 1544387368, "post_id": 53695707, "comment_id": 94248118, "body": "Really appreciate the help :) However, i&#39;ve tried the POST via &#39;Postman&#39; for chrome and it works absolutely fine but for some strange reason it doesn&#39;t want to work via golang. I also tried using the code provided by Postman, but it just keeps throwing &#39;Redirect 200&#39; and i&#39;m really stuck as to why"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 3, "user_id": 7404156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e01311006d6ba4d63773e2c1f1fd295?s=128&d=identicon&r=PG&f=1", "display_name": "Katie Daniels", "link": "https://stackoverflow.com/users/7404156/katie-daniels"}, "edited": false, "score": 0, "creation_date": 1544388205, "post_id": 53695707, "comment_id": 94248366, "body": "<i>&quot;...doesn&#39;t want to work ....&quot;</i> - this is not really sufficient information to debug a problem. Apart from that, this looks like a new question. I recommend to  compare what gets exactly send and received by the working and non-working version, for example with a packet capture."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1544440315, "post_id": 53695707, "comment_id": 94263514, "body": "I&#39;m not sure you&#39;re correct about that <code>ioutil.NopCloser</code> thing: please see what the manual for <code>net&#47;http.Request.Write</code> says. The correct way of getting rid of chunked encoding (if it&#39;s <i>really</i> needed, which, I admit, is questionable for an apparently novice programmer) is to simply set the <code>ContentType</code> field of the created <code>http.Request</code> value to the total length of the body to be sent. In the OP&#39;s case it should amount to merely calling <code>Len()</code> on the buffer created by <code>bytes.NewBufferString</code>."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1544442053, "post_id": 53695707, "comment_id": 94264422, "body": "@kostix: <code>go doc http.NewRequest</code> states that if the body is of type <code>bytes.Buffer</code> (and some more) it will automatically set the <code>Content-Length</code> and that with most other types of body it will instead set the length to -1. The last will result in the use of <code>Transfer-Encoding: chunked</code> as documented in <code>http.Request.Write</code>."}], "tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": true, "score": 1, "last_activity_date": 1544442075, "last_edit_date": 1544442075, "creation_date": 1544382419, "answer_id": 53695707, "question_id": 53695242, "link": "https://stackoverflow.com/questions/53695242/sending-a-post-request-with-a-request-body-just-as-a-string/53695707#53695707", "title": "Sending a POST request with a request body just as a string", "body": "<p>The body you expect is actually correctly sent but maybe not in the way you want:</p>\n\n<pre><code>POST /foo HTTP/1.1\n...\nTransfer-Encoding: chunked\n...\nContent-Type: application/x-www-form-urlencoded\n...\n\n17\ndemo_mail=&lt;foo@bar.com&gt;\n0\n</code></pre>\n\n<p>Since you've wrapped your string into a <code>io.NopCloser</code> it will assume that the length is not known up-front. It will therefore use chunked transfer encoding to send each chunk returned from the <code>io.Reader</code> prefixed by its length and once everything done the final chunk with length 0.</p>\n\n<p>If you don't want to have this behavior you need to provide a buffer where the length is known up-front. This can be done by simply removing the <code>ioutil.NopCloser</code> around the <code>bytes.NewBufferString</code>:</p>\n\n<pre><code>req, err := http.NewRequest(\"POST\", \"&lt;MY PAGE&gt;\", bytes.NewBufferString(\"demo_mail=\" + email))\n</code></pre>\n\n<p>With this the request will use <code>Content-length</code> instead of chunked transfer encoding and the body will only contain the string:</p>\n\n<pre><code>POST /foo HTTP/1.1\n...\nContent-Length: 23\n...\nContent-Type: application/x-www-form-urlencoded\n...\n\ndemo_mail=&lt;foo@bar.com&gt;\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 7404156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e01311006d6ba4d63773e2c1f1fd295?s=128&d=identicon&r=PG&f=1", "display_name": "Katie Daniels", "link": "https://stackoverflow.com/users/7404156/katie-daniels"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 756, "favorite_count": 0, "accepted_answer_id": 53695707, "answer_count": 1, "score": 0, "last_activity_date": 1544442075, "creation_date": 1544379078, "last_edit_date": 1544439985, "question_id": 53695242, "link": "https://stackoverflow.com/questions/53695242/sending-a-post-request-with-a-request-body-just-as-a-string", "title": "Sending a POST request with a request body just as a string", "body": "<p>I have a page setup on my webserver with an 'email address' box and a submit button. I have it so when it is submitted, it sends a post request to check if it exists in my database. I have been using Go to try and send this POST request. However, I need to send the request body as the following:</p>\n\n<pre><code>demo_mail=&lt;email&gt;\n</code></pre>\n\n<p>I haven't found anything remotely useful online, only posts asking how to send the data with JSON rather than a string. I currently have the following code which runs but fails to send the POST request with the post data above.</p>\n\n<pre><code>req, err := http.NewRequest(\"POST\", \"&lt;MY PAGE&gt;\", ioutil.NopCloser(bytes.NewBufferString(\"demo_mail=\" + email)))\n            req.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n            req.Header.Set(\"Accept\", \"text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8\")\n            req.Header.Set(\"User-Agent\", \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/71.0.3578.80 Safari/537.36\")\n\n\n\n            resp, err := client.Do(req)\n            if err != nil {\n                 color.Red(\"Error.\")\n            }\n            defer resp.Body.Close()\n\n            body, _ := ioutil.ReadAll(resp.Body)\n\n\n            if strings.Contains(string(body), \"Success\") {\n                fmt.Println(\"Email exists\")\n            } else {\n                fmt.Println(\"Fail\")\n            }\n</code></pre>\n\n<p>Any help is appreciated.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 2812, "user_id": 3738542, "user_type": "registered", "profile_image": "https://graph.facebook.com/100002024985258/picture?type=large", "display_name": "oren", "link": "https://stackoverflow.com/users/3738542/oren"}, "is_accepted": false, "score": 1, "last_activity_date": 1544382061, "last_edit_date": 1544382061, "creation_date": 1544377448, "answer_id": 53694977, "question_id": 53694748, "link": "https://stackoverflow.com/questions/53694748/execute-template-submit-issue-due-to-no-http-redirect/53694977#53694977", "title": "Execute Template submit issue due to no HTTP Redirect?", "body": "<p>As I see it, you don't redirect, you just execute the page2 template.</p>\n\n<p>For redirecting, try:</p>\n\n<pre><code>http.Redirect(w, r, \"http://127.0.0.1/page2\", 301)\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>myTemplate.ExecuteTemplate(w, \"page2.gohtml\", my_data) //go to next page\n</code></pre>\n\n<p><strong>edit:</strong></p>\n\n<p>I see now that I didn't fully answered your question, since I ignored <code>my_data</code> (which by the way, in golang the named are camelCase, so you should rename it with <code>myDate</code>... :).</p>\n\n<p>Anyway, for passing the data, since it's only strings, you can try to serialize it and add it to the request body (I don't know if it's the best practice, it's just the first thing that pop into my head that will probably work)</p>\n"}], "owner": {"reputation": 11, "user_id": 3334173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b64250a93e88ac573c30737cb39d2636?s=128&d=identicon&r=PG&f=1", "display_name": "user3334173", "link": "https://stackoverflow.com/users/3334173/user3334173"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1544382061, "creation_date": 1544375868, "last_edit_date": 1544380078, "question_id": 53694748, "link": "https://stackoverflow.com/questions/53694748/execute-template-submit-issue-due-to-no-http-redirect", "title": "Execute Template submit issue due to no HTTP Redirect?", "body": "<p>I am trying to pass data from one page to another utilizing go.\nHere is a simplified version of what I am doing:</p>\n\n<pre><code>//Attempting to go from page1.gohtml to page2.gohtml to page3.gohtml.\n\ntype myData stuct {\n    data1 string\n    data2 string\n}\n\nfunc page1(w http.ResposneWriter, r *http.Request) {\n    if r.Method != http.MethodPost {\n        myTemplate.ExecuteTemplate(w, \"page1.gohtml\", my_data) //do current page\n    }\n\n   //populated myData\n\n    myTemplate.ExecuteTemplate(w, \"page2.gohtml\", my_data) //go to next page\n}\n\n//My .gohtml forms are like so:\n&lt;form id=\"page1\" name=\"page1\" method=\"post\"&gt;\n    &lt;input type=\"submit\" class=\"click\"&gt;\n&lt;/form&gt;\n</code></pre>\n\n<p>Repeat general code for page 2 to page 3. </p>\n\n<p><strong>Problem Statement:</strong> When I do template execution from page 1 to page 2, my data struct remains populated, the page however, remains on <code>localhost:80/page1</code></p>\n\n<p>It does not move to page 2 despite displaying page 2. </p>\n\n<p>This isn't a problem until I go to execute the submit on page 2. \nThis brings me back to page 1 instead of taking me to page 3.</p>\n\n<p>I have tried setting my form with an action taking to take me to the next page.\nThis redirects me, but does not bring me the populated my data structure that I need.</p>\n\n<p>Setting the submit to return false stops my server code from executing.</p>\n\n<p>And doing an HTTP Redirect brings me to the next page but has the same issue as the form action.</p>\n\n<p>This is temporary data that I do not want to save to a Database.</p>\n\n<p><em>Could someone help direct me on my options?</em></p>\n"}, {"tags": ["go", "race-condition"], "answers": [{"tags": [], "owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "is_accepted": true, "score": 3, "last_activity_date": 1544365170, "last_edit_date": 1544365170, "creation_date": 1544364573, "answer_id": 53693164, "question_id": 53693110, "link": "https://stackoverflow.com/questions/53693110/race-condition-with-waitgroup-and-unbuffered-channel/53693164#53693164", "title": "Race condition with waitgroup and unbuffered channel", "body": "<p>You are trying to read from <code>histogram</code> in <code>fmt.Println(histogram)</code> which is not synchronized to the write of the goroutine mutating it <code>histogram[w]++</code>. You can add a lock to synchronize the writes and reads.</p>\n\n<p>e.g.</p>\n\n<pre><code>var lock sync.Mutex\n\ngo func() {\n    lock.Lock()\n    defer lock.Unlock()\n    for w := range words {\n        histogram[w]++\n    }\n}()\n\n//...\nlock.Lock()\nfmt.Println(histogram)\n</code></pre>\n\n<p>Note you can also use a <code>sync.RWMutex</code>.</p>\n\n<p>Another thing you could do is to wait for the goroutine mutating <code>histogram</code> to finish.</p>\n\n<pre><code>var histWG sync.WaitGroup\nhistWG.Add(1)\ngo func() {\n    for w := range words {\n        histogram[w]++\n    }\n    histWG.Done()\n}()\n\nwg.Wait()\nclose(words)\nhistWG.Wait()\n\nfmt.Println(histogram)\n</code></pre>\n\n<p>Or simply use a channel to wait.</p>\n\n<pre><code>done := make(chan bool)\ngo func() {\n    for w := range words {\n        histogram[w]++\n    }\n    done &lt;- true\n}()\n\nwg.Wait()\nclose(words)\n&lt;-done\n\nfmt.Println(histogram)\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 10765150, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-q3FvWdGCThI/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-h6zSdsHwQhWxUxVtsZyxc2I8JTSA/mo/photo.jpg?sz=128", "display_name": "Son Darian", "link": "https://stackoverflow.com/users/10765150/son-darian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 505, "favorite_count": 1, "accepted_answer_id": 53693164, "answer_count": 1, "score": 1, "last_activity_date": 1544365170, "creation_date": 1544364109, "question_id": 53693110, "link": "https://stackoverflow.com/questions/53693110/race-condition-with-waitgroup-and-unbuffered-channel", "title": "Race condition with waitgroup and unbuffered channel", "body": "<p>After getting (the right) solution to my initial problem in this post <a href=\"https://stackoverflow.com/questions/53687392/understanding-golang-channels-deadlock\">Understanding golang channels: deadlock</a>, I have come up with a slightly different solution (which in my opinion reads better:</p>\n\n<pre><code>// Binary histogram counts the occurences of each word.\npackage main\n\nimport (\n    \"fmt\"\n    \"strings\"\n    \"sync\"\n)\n\nvar data = []string{\n    \"The yellow fish swims slowly in the water\",\n    \"The brown dog barks loudly after a drink ...\",\n    \"The dark bird bird of prey lands on a small ...\",\n}\n\nfunc main() {\n    histogram := make(map[string]int)\n    words := make(chan string)\n    var wg sync.WaitGroup\n    for _, line := range data {\n        wg.Add(1)\n        go func(l string) {\n            for _, w := range strings.Split(l, \" \") {\n                words &lt;- w\n            }\n            wg.Done()\n        }(line)\n    }\n\n    go func() {\n        for w := range words {\n            histogram[w]++\n        }\n    }()\n    wg.Wait()\n    close(words)\n\n    fmt.Println(histogram)\n}\n</code></pre>\n\n<p>It does work, but unfortunately running it against race, it shows 2 race conditions:</p>\n\n<pre><code>==================\nWARNING: DATA RACE\nRead at 0x00c420082180 by main goroutine:\n...\nPrevious write at 0x00c420082180 by goroutine 9:\n...\nGoroutine 9 (running) created at:\n  main.main()\n</code></pre>\n\n<p>Can you help me understand where is the race condition?</p>\n"}, {"tags": ["arrays", "json", "go"], "comments": [{"owner": {"reputation": 926, "user_id": 2760325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0acf8a8895f6f9da5c0f202e8975a61d?s=128&d=identicon&r=PG", "display_name": "Ahmed Essam", "link": "https://stackoverflow.com/users/2760325/ahmed-essam"}, "edited": false, "score": 2, "creation_date": 1544362787, "post_id": 53692632, "comment_id": 94241248, "body": "Your json isn&#39;t valid, you are adding an extra &#39;,&#39; at the end of your objects. You can validate it using <a href=\"https://jsonlint.com/\" rel=\"nofollow noreferrer\">jsonlint.com</a>. Correct it and try again"}, {"owner": {"reputation": 5298, "user_id": 3405291, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f6499e84a22df10a3f4fec15a8bd0d06?s=128&d=identicon&r=PG&f=1", "display_name": "user3405291", "link": "https://stackoverflow.com/users/3405291/user3405291"}, "reply_to_user": {"reputation": 926, "user_id": 2760325, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0acf8a8895f6f9da5c0f202e8975a61d?s=128&d=identicon&r=PG", "display_name": "Ahmed Essam", "link": "https://stackoverflow.com/users/2760325/ahmed-essam"}, "edited": false, "score": 0, "creation_date": 1544362909, "post_id": 53692632, "comment_id": 94241287, "body": "@AhmedEssam Thanks, my JSONs are super lengthy. I just pasted two key/values here as samples and I forgot to remove the extra <code>,</code> I&#39;m going to fix my question now"}], "answers": [{"tags": [], "owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "is_accepted": true, "score": 2, "last_activity_date": 1544363718, "last_edit_date": 1544363718, "creation_date": 1544362568, "answer_id": 53692874, "question_id": 53692632, "link": "https://stackoverflow.com/questions/53692632/parsing-an-array-slice-sent-by-server/53692874#53692874", "title": "Parsing an array/slice sent by server", "body": "<p>You can unmarshal directly into an array</p>\n\n<pre><code>data := `[\n    {\n        \"ProfileID\": 1,\n        \"Title\": \"65micron\"\n    },\n    {\n        \"ProfileID\": 2,\n        \"Title\": \"80micron\"\n    }]`\n\ntype Profile struct {\n    ProfileID int\n    Title     string\n}\n\nvar profiles []Profile\n\njson.Unmarshal([]byte(data), &amp;profiles)\n</code></pre>\n\n<p>You can also read directly from the <code>Request.Body</code>.</p>\n\n<pre><code>func Handler(w http.ResponseWriter, r *http.Request) {\n\n    var profiles []Profile\n    json.NewDecoder(r.Body).Decode(&amp;profiles)\n    // use `profiles`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/tFZZbPW30Oz\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 1763, "user_id": 4010835, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MrAii.jpg?s=128&g=1", "display_name": "KibGzr", "link": "https://stackoverflow.com/users/4010835/kibgzr"}, "is_accepted": false, "score": 1, "last_activity_date": 1544363106, "last_edit_date": 1544363106, "creation_date": 1544362728, "answer_id": 53692904, "question_id": 53692632, "link": "https://stackoverflow.com/questions/53692632/parsing-an-array-slice-sent-by-server/53692904#53692904", "title": "Parsing an array/slice sent by server", "body": "<p>You should define a struct </p>\n\n<pre><code>type Profile struct {\n    ID int `json:\"ProfileID\"`\n    Title string `json:\"Title\"`\n}\n</code></pre>\n\n<p>After that decode response</p>\n\n<pre><code>var r []Profile\nerr := json.NewDecoder(res.Body).Decode(&amp;r)\n</code></pre>\n"}], "owner": {"reputation": 5298, "user_id": 3405291, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/f6499e84a22df10a3f4fec15a8bd0d06?s=128&d=identicon&r=PG&f=1", "display_name": "user3405291", "link": "https://stackoverflow.com/users/3405291/user3405291"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 53692874, "answer_count": 2, "score": 0, "last_activity_date": 1544363718, "creation_date": 1544361082, "last_edit_date": 1544362970, "question_id": 53692632, "link": "https://stackoverflow.com/questions/53692632/parsing-an-array-slice-sent-by-server", "title": "Parsing an array/slice sent by server", "body": "<p>A server is sending back such a response:</p>\n\n<pre><code>me@linux:~&gt; curl -X GET http://*.*.*.*:8080/profiles\n\n[\n        {\n                \"ProfileID\": 1,\n                \"Title\": \"65micron\"\n        },\n        {\n                \"ProfileID\": 2,\n                \"Title\": \"80micron\"\n        }\n]\n</code></pre>\n\n<p>I have tried <a href=\"https://stackoverflow.com/a/29326193/3405291\">this solution</a> to parse the response as JSON but it <strong>only</strong> works if the server response is like this:</p>\n\n<pre><code>{\n    \"array\": [\n        {\n                \"ProfileID\": 1,\n                \"Title\": \"65micron\"\n        },\n        {\n                \"ProfileID\": 2,\n                \"Title\": \"80micron\"\n        }\n    ]\n}\n</code></pre>\n\n<p>Does anybody know how I can parse the server response as JSON?</p>\n\n<hr>\n\n<p>One idea which occurred to me is to add <code>{ \"array\":</code> to the beginning of <code>http.Response.Body</code> buffer and also add <code>}</code> to the its end, then use <a href=\"https://stackoverflow.com/a/29326193/3405291\">the standard solution</a>. However, I'm not sure if that's the best idea.</p>\n"}, {"tags": ["url", "go", "relative-url"], "answers": [{"comments": [{"owner": {"reputation": 1380, "user_id": 86771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d3bd80bb884df0a7bb65c91488ec87f6?s=128&d=identicon&r=PG", "display_name": "Svetoslav Marinov", "link": "https://stackoverflow.com/users/86771/svetoslav-marinov"}, "edited": false, "score": 0, "creation_date": 1609016660, "post_id": 53692721, "comment_id": 115731743, "body": "Thank you @Not_a_Golfer. Great idea."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 8, "last_activity_date": 1544361668, "creation_date": 1544361668, "answer_id": 53692721, "question_id": 53692326, "link": "https://stackoverflow.com/questions/53692326/convert-relative-to-absolute-urls-in-go/53692721#53692721", "title": "Convert relative to absolute URLs in Go", "body": "<p>Yes, the standard library can do this with the <code>net/url</code> package. Example (from the standard library): </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/url\"\n)\n\nfunc main() {\n    u, err := url.Parse(\"../../..//search?q=dotnet\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    base, err := url.Parse(\"http://example.com/directory/\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(base.ResolveReference(u))\n}\n</code></pre>\n\n<p>Notice that you only need to parse the absolute URL once and then you can reuse it over and over. </p>\n"}, {"tags": [], "owner": {"reputation": 787, "user_id": 967386, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/K9peZ.jpg?s=128&g=1", "display_name": "KenanBek", "link": "https://stackoverflow.com/users/967386/kenanbek"}, "is_accepted": false, "score": 1, "last_activity_date": 1618178685, "creation_date": 1618178685, "answer_id": 67050605, "question_id": 53692326, "link": "https://stackoverflow.com/questions/53692326/convert-relative-to-absolute-urls-in-go/67050605#67050605", "title": "Convert relative to absolute URLs in Go", "body": "<p>On top of @Not_a_Golfer's solution.</p>\n<p>You can also use <code>base</code> URL's <code>Parse</code> method to provide a relative or absolute URL.</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;log&quot;\n    &quot;net/url&quot;\n)\n\nfunc main() {\n    // parse only base url\n    base, err := url.Parse(&quot;http://example.com/directory/&quot;)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // and then use it to parse relative URLs\n    u, err := base.Parse(&quot;../../..//search?q=dotnet&quot;)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(u.String())\n}\n</code></pre>\n<p>Try it on <a href=\"https://play.golang.org/p/nuZnRiOrRf6\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 399, "user_id": 4644468, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/9a52b2a168cce82a0f3997c132a7e107?s=128&d=identicon&r=PG&f=1", "display_name": "hiy", "link": "https://stackoverflow.com/users/4644468/hiy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1633, "favorite_count": 0, "accepted_answer_id": 53692721, "answer_count": 2, "score": 3, "last_activity_date": 1618178685, "creation_date": 1544358742, "last_edit_date": 1544373127, "question_id": 53692326, "link": "https://stackoverflow.com/questions/53692326/convert-relative-to-absolute-urls-in-go", "title": "Convert relative to absolute URLs in Go", "body": "<p>I'm writing a little web crawler, and a lot of the links on sites I'm crawling are relative (so they're <code>/robots.txt</code>, for example). How do I convert these relative URLs to absolute URLs (so <code>/robots.txt</code> => <code>http://google.com/robots.txt</code>)? Does Go have a built-in way to do this?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1544356571, "post_id": 53692057, "comment_id": 94239746, "body": "If you know enough about your JSON to parse it this way, you know enough to use predefined structs. This is almost always the preferred way."}, {"owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1544356915, "post_id": 53692057, "comment_id": 94239829, "body": "@Flimzy - <code>&quot;almost always the preferred way&quot;</code> =&gt; But why? If it&#39;s possible without, then why define it? Or is it not possible without defining it? Or are there big advantages to actually define it? And if so, what are they?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1544357006, "post_id": 53692057, "comment_id": 94239842, "body": "Because it&#39;s immensely easier to use a predefined struct, as you are discovering.  But then if you like <code>result[&quot;users&quot;].([]interface{})[0].(map[string]interface{}).&zwnj;&#8203;[&quot;age&quot;]</code>), far be it from me to dissuade you from overly verbose, difficult-to-read code. :)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1544357189, "post_id": 53692057, "comment_id": 94239888, "body": "What it really boils down to: Go is a strictly typed language. This means you <i>must</i> use strict types, even with JSON. You can do this one of two-ways: With compile-time types, as defined in custom structs, or with runtime reflection. Both require you to &quot;get to&quot; the static type. Doing it at compile time is much more efficient (thus faster), and far easier to read. So only use reflection when you must."}, {"owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1544358440, "post_id": 53692057, "comment_id": 94240192, "body": "@Flimzy - Thanks for explaining the why. I guess the way to go would be simply defining it then."}, {"owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1544362797, "post_id": 53692057, "comment_id": 94241251, "body": "@Flimzy - By the way, I tried your suggestion, and it gives me <code>.&#47;main.go:54:74: syntax error: unexpected [, expecting name or (</code>. That refers to the last usae of <code>[</code>, the one surrounding <code>&quot;age&quot;</code>. Any other ideas?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1544368343, "post_id": 53692057, "comment_id": 94242748, "body": "That was meant as an example, not a specific suggestion."}], "answers": [{"comments": [{"owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "edited": false, "score": 0, "creation_date": 1544362668, "post_id": 53692123, "comment_id": 94241213, "body": "The first one gives a <code>panic: interface conversion: interface {} is []interface {}, not map[string]interface {}</code> and the second one gives a <code>cannot use 0 (type int) as type string in map index</code>. Any other ideas?"}], "tags": [], "owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "is_accepted": false, "score": 1, "last_activity_date": 1544357044, "creation_date": 1544357044, "answer_id": 53692123, "question_id": 53692057, "link": "https://stackoverflow.com/questions/53692057/how-to-read-interfaces-map-of-json-without-defining-structure-in-golang/53692123#53692123", "title": "How to read &quot;interfaces&quot; map of json without defining structure in Golang?", "body": "<p>Probably you want</p>\n\n<pre><code>fmt.Println(result[\"users\"].(map[string]interface{})[\"age\"])\n</code></pre>\n\n<p>or</p>\n\n<pre><code>fmt.Println(result[0].(map[string]interface{})[\"age\"])\n</code></pre>\n\n<p>As the JSON is a map of maps the type of the leaf nodes is interface{} and so has to be converted to map[string]interface{} in order to lookup a key</p>\n\n<p>Defining a struct is much easier.  My top tip for doing this is to use a website that converts JSON to a Go struct definition, like <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">Json-To-Go</a></p>\n"}], "owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1544357044, "creation_date": 1544356518, "question_id": 53692057, "link": "https://stackoverflow.com/questions/53692057/how-to-read-interfaces-map-of-json-without-defining-structure-in-golang", "title": "How to read &quot;interfaces&quot; map of json without defining structure in Golang?", "body": "<p>Following <a href=\"https://tutorialedge.net/golang/parsing-json-with-golang/\" rel=\"nofollow noreferrer\">this tutorial</a> I'm trying to read a json file in Golang. It says there are two ways of doing that:</p>\n\n<ol>\n<li>unmarshal the JSON using a set of predefined structs</li>\n<li>or unmarshal the JSON using a map[string]interface{}</li>\n</ol>\n\n<p>Since I'll probably have a lot of different json formats I prefer to interpret it on the fly. So I now have the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"io/ioutil\"\n    \"encoding/json\"\n)\n\nfunc main() {\n    // Open our jsonFile\n    jsonFile, err := os.Open(\"users.json\")\n    // if we os.Open returns an error then handle it\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(\"Successfully Opened users.json\")\n    // defer the closing of our jsonFile so that we can parse it later on\n    defer jsonFile.Close()\n\n    byteValue, _ := ioutil.ReadAll(jsonFile)\n\n    var result map[string]interface{}\n    json.Unmarshal([]byte(byteValue), &amp;result)\n\n    fmt.Println(result[\"users\"])\n    fmt.Printf(\"%T\\n\", result[\"users\"])\n}\n</code></pre>\n\n<p>This prints out:</p>\n\n<pre><code>Successfully Opened users.json\n[map[type:Reader age:23 social:map[facebook:https://facebook.com twitter:https://twitter.com] name:Elliot] map[name:Fraser type:Author age:17 social:map[facebook:https://facebook.com twitter:https://twitter.com]]]\n[]interface {}\n</code></pre>\n\n<p>At this point I don't understand how I can read the age of the first user (23). I tried some variations:</p>\n\n<pre><code>fmt.Println(result[\"users\"][0])\nfmt.Println(result[\"users\"][0].age)\n</code></pre>\n\n<p>But apparently, <code>type interface {} does not support indexing</code>.</p>\n\n<p>Is there a way that I can access the items in the json without defining the structure?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1544356574, "post_id": 53691946, "comment_id": 94239747, "body": "not sure what you are asking exactly but the strings package has various funcs with &quot;Index&quot; in their name that can find things like newline.  If the data is in []byte form then the bytes package does some similar stuff"}, {"owner": {"reputation": 177, "user_id": 6063754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f6180e616f692ef645944c08fd4089e?s=128&d=identicon&r=PG&f=1", "display_name": "Elliot Smith", "link": "https://stackoverflow.com/users/6063754/elliot-smith"}, "reply_to_user": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1544390083, "post_id": 53691946, "comment_id": 94248864, "body": "I&#39;ll try and clarify it through an example. Let say that I have a file with contents &quot;ara/n;&gt;$g9s&quot;, my application will perform an action defined by that input character as it moves through the contents of the file. I.e. If &quot;a&quot; does action 1, &quot;r&quot; does action 2, &quot;/n&quot; does action 3 and so on then the input above will perform the following actions 1,2,1,3... in that order. However, if you turn the byte array to a string then I&#39;m unable to identify &quot;/n&quot; characters since they appear to be removed despite the string having the same formatting  as before if you print it out or concat it into a file."}], "answers": [{"comments": [{"owner": {"reputation": 177, "user_id": 6063754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f6180e616f692ef645944c08fd4089e?s=128&d=identicon&r=PG&f=1", "display_name": "Elliot Smith", "link": "https://stackoverflow.com/users/6063754/elliot-smith"}, "edited": false, "score": 0, "creation_date": 1544391519, "post_id": 53692227, "comment_id": 94249235, "body": "Apologies for not being clear before, hopefully my update makes its clearer. Is it possible to do the above without searching through the entire string for the new line characters?"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1544399974, "last_edit_date": 1544399974, "creation_date": 1544358040, "answer_id": 53692227, "question_id": 53691946, "link": "https://stackoverflow.com/questions/53691946/reading-from-a-file-and-check-for-file-endings/53692227#53692227", "title": "Reading from a file and check for file endings", "body": "<p>We can only guess. You haven't defined your problem clearly. Please clarify your specific problem or add additional details to highlight exactly what you need. Provide sample input and output.</p>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p>After a backslash, certain single-character escapes represent special\n  values:</p>\n\n<pre><code>\\n   U+000A line feed or newline\n</code></pre>\n</blockquote>\n\n<hr>\n\n<p>Here's a guess:</p>\n\n<p><code>lines.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"strings\"\n)\n\nfunc lines(data []byte) {\n    text := string(data)\n    for i, j := 0, 0; j &gt;= 0; i += j + 1 {\n        var line string\n        j = strings.IndexByte(text[i:], '\\n')\n        if j &lt; 0 {\n            line = text[i:]\n            if len(line) == 0 {\n                continue\n            }\n        } else {\n            line = text[i : i+j+1]\n        }\n        // process line\n        fmt.Printf(\"%d %q\\n\", len(line), line)\n    }\n}\n\nfunc main() {\n    filename := `test.file`\n    data, err := ioutil.ReadFile(filename)\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        return\n    }\n    fmt.Printf(\"%d %q\\n\", len(data), data)\n    lines(data)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ cat test.file\nline1\nline2\nline3\n$ go run lines.go\n18 \"line1\\nline2\\nline3\\n\"\n6 \"line1\\n\"\n6 \"line2\\n\"\n6 \"line3\\n\"\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p>Comment:</p>\n  \n  <p>I'll try and clarify it through an example. Let say that I have a file\n  with contents \"ara/n;>$g9s\", my application will perform an action\n  defined by that input character as it moves through the contents of\n  the file. I.e. If \"a\" does action 1, \"r\" does action 2, \"/n\" does\n  action 3 and so on then the input above will perform the following\n  actions 1,2,1,3... in that order. However, if you turn the byte array\n  to a string then I'm unable to identify \"/n\" characters since they\n  appear to be removed despite the string having the same formatting as\n  before if you print it out or concat it into a file. \u2013 Elliot Smith</p>\n</blockquote>\n\n<p>Why do you write <code>/n</code> for a newline character! The newline character U+000A, as I've already pointed out, is written as <code>\\n</code>.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc es(s string) {\n    for _, r := range s {\n        switch r {\n        case 'a':\n            fmt.Printf(\"action 1 for %q\\n\", r)\n        case 'r':\n            fmt.Printf(\"action 2 for %q\\n\", r)\n        case '\\n':\n            fmt.Printf(\"action 3 for %q\\n\", r)\n        default:\n            fmt.Printf(\"action ? for %q\\n\", r)\n        }\n    }\n}\n\nfunc main() {\n    b := []byte(\"ara\\n;&gt;$g9s\")\n    s := string(b)\n    es(s)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/3J0pxXh3Wkc\" rel=\"nofollow noreferrer\">https://play.golang.org/p/3J0pxXh3Wkc</a></p>\n\n<p>Output:</p>\n\n<pre><code>action 1 for 'a'\naction 2 for 'r'\naction 1 for 'a'\naction 3 for '\\n'\naction ? for ';'\naction ? for '&gt;'\naction ? for '$'\naction ? for 'g'\naction ? for '9'\naction ? for 's'\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p>Revised Question:</p>\n  \n  <p>Example: If the file contents is \"r/n3$/n;\" then I should able to\n  perform 6 predefined actions (one for for each character) as I move\n  from left to right over the files contents. Elliot Smith</p>\n</blockquote>\n\n<hr>\n\n<p>Why do you write <code>/n</code> for a newline character! The newline character U+000A, as I've already pointed out, is written as <code>\\n</code>.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc es(s string) {\n    for _, r := range s {\n        switch r {\n        case 'a':\n            fmt.Printf(\"action for %q\\n\", r)\n        case 'r':\n            fmt.Printf(\"action for %q\\n\", r)\n        case '\\n':\n            fmt.Printf(\"action for %q\\n\", r)\n        default:\n            fmt.Printf(\"action for %q\\n\", r)\n        }\n    }\n}\n\nfunc main() {\n    file := []byte(\"r\\n3$\\n;\")\n    s := string(file)\n    es(s)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/X1gtrPRmlqq\" rel=\"nofollow noreferrer\">https://play.golang.org/p/X1gtrPRmlqq</a></p>\n\n<p>Output:</p>\n\n<pre><code>action for 'r'\naction for '\\n'\naction for '3'\naction for '$'\naction for '\\n'\naction for ';'\n</code></pre>\n"}], "owner": {"reputation": 177, "user_id": 6063754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f6180e616f692ef645944c08fd4089e?s=128&d=identicon&r=PG&f=1", "display_name": "Elliot Smith", "link": "https://stackoverflow.com/users/6063754/elliot-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 228, "favorite_count": 1, "accepted_answer_id": 53692227, "answer_count": 1, "score": 2, "last_activity_date": 1544399974, "creation_date": 1544355566, "last_edit_date": 1544391112, "question_id": 53691946, "link": "https://stackoverflow.com/questions/53691946/reading-from-a-file-and-check-for-file-endings", "title": "Reading from a file and check for file endings", "body": "<p>I am trying to do the following tasks in Go;</p>\n\n<ol>\n<li>Read from a file</li>\n<li>Backup the file</li>\n<li>Overwrite and perform actions based on the files output on a character by character basis (which may include newLine characters or \"b\" for example)</li>\n</ol>\n\n<p>Unfortunately, I am stuck on step 3 and would like some assistance with \"new line\" characters (i.e. \"/n\"). I have tried using <code>filesText, err := ioutil.ReadFile(fileNameAndDirectory)</code> but unfortunately if I try and check for file endings after converting <code>filesText</code> to a string I am unable to detect new line characters (i.e. If files text is \"/nhello/n\" then the following code snippet will not print the string \"match\" </p>\n\n<pre><code>filesText, err := ioutil.ReadFile(fileNameAndDirectory) \nif (string(filesText)[:2]) == \"/n\") {\n    fmt.Println(\"match\")\n}\n</code></pre>\n\n<p>).</p>\n\n<p>Is there something that I can do to detect new lines without reading the file line by line manually?</p>\n\n<p>Example:\nIf the file contents is \"r/n3$/n;\" then I should able to perform 6 predefined actions (one for for each character) as I move from left to right over the files contents.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3542, "user_id": 5033611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47a91063fb01317639d57d5fc9c9d9c7?s=128&d=identicon&r=PG", "display_name": "ssemilla", "link": "https://stackoverflow.com/users/5033611/ssemilla"}, "edited": false, "score": 0, "creation_date": 1544347769, "post_id": 53690863, "comment_id": 94237953, "body": "Can you show us how you created the <code>dict</code>? I think it is possible that you are copying the <code>sync.Mutex</code>."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 5, "last_activity_date": 1544350155, "last_edit_date": 1544350155, "creation_date": 1544348360, "answer_id": 53691034, "question_id": 53690863, "link": "https://stackoverflow.com/questions/53690863/use-mutex-but-still-got-concurrent-map-writes/53691034#53691034", "title": "Use mutex but still got concurrent map writes", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/sync/\" rel=\"noreferrer\">Package sync</a></p>\n\n<pre><code>import \"sync\"\n</code></pre>\n  \n  <p><a href=\"https://golang.org/pkg/sync/#Mutex\" rel=\"noreferrer\">type Mutex</a></p>\n  \n  <p>A Mutex is a mutual exclusion lock. The zero value for a Mutex is an\n  unlocked mutex.</p>\n  \n  <p>A Mutex must not be copied after first use.</p>\n</blockquote>\n\n<hr>\n\n<p>Your code doesn't compile! </p>\n\n<p>Playground: <a href=\"https://play.golang.org/p/6AwS0vOZfeP\" rel=\"noreferrer\">https://play.golang.org/p/6AwS0vOZfeP</a></p>\n\n<pre><code>25:18: undefined: n\n30:24: undefined: n\n33:11: undefined: n\n</code></pre>\n\n<p>If I change <code>v int64</code> to <code>n int64</code>:</p>\n\n<blockquote>\n  <p>A Mutex must not be copied after first use.</p>\n</blockquote>\n\n<pre><code>$ go vet mutex.go\n./mutex.go:26:11: assignment copies lock value to shard: command-line-arguments.shard contains sync.Mutex\n$\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/jExE-m11ny5\" rel=\"noreferrer\">https://play.golang.org/p/jExE-m11ny5</a></p>\n\n<pre><code>package main\n\nimport (\n    \"sync\"\n)\n\nconst (\n    dictShardNum  = 16\n    dictShardSize = 1 &lt;&lt; 28\n)\n\ntype shard struct {\n    mu sync.Mutex\n    m  map[int64]uint32\n}\n\ntype dict struct {\n    shards []shard\n}\n\n/// a newDict function\n\nfunc (d *dict) insert(n int64) uint32 {\n    shardNum := int(n % dictShardNum)\n    shard := d.shards[shardNum]\n    shard.mu.Lock()\n    defer shard.mu.Unlock()\n\n    tempID, ok := shard.m[n]\n    if !ok {\n        tempID = uint32(len(shard.m) + shardNum*dictShardSize)\n        shard.m[n] = tempID // fatal error: concurrent map writes\n    }\n    return tempID\n}\n\nfunc main() {}\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p><a href=\"https://golang.org/cmd/vet/\" rel=\"noreferrer\">Command vet</a></p>\n  \n  <p>Vet examines Go source code and reports suspicious constructs</p>\n  \n  <p><a href=\"https://golang.org/cmd/vet/#hdr-Copying_locks\" rel=\"noreferrer\">Copying locks</a></p>\n  \n  <p>Flag: -copylocks</p>\n  \n  <p>Locks that are erroneously passed by value.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 933, "user_id": 439142, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/ad48f5f489d036f22f94a411a218c966?s=128&d=identicon&r=PG", "display_name": "Ray Wu", "link": "https://stackoverflow.com/users/439142/ray-wu"}, "is_accepted": false, "score": 0, "last_activity_date": 1544490159, "creation_date": 1544490159, "answer_id": 53715931, "question_id": 53690863, "link": "https://stackoverflow.com/questions/53690863/use-mutex-but-still-got-concurrent-map-writes/53715931#53715931", "title": "Use mutex but still got concurrent map writes", "body": "<p>I think the answer is related to copy mutex values.\nThe dict <code>should</code> be </p>\n\n<pre><code>type dict struct {\n    shards []*shard\n}\n</code></pre>\n\n<p>All <code>shard</code>s are accessed via pointer then it won't have any issue. </p>\n"}], "owner": {"reputation": 933, "user_id": 439142, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/ad48f5f489d036f22f94a411a218c966?s=128&d=identicon&r=PG", "display_name": "Ray Wu", "link": "https://stackoverflow.com/users/439142/ray-wu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 2, "answer_count": 2, "score": 0, "last_activity_date": 1544490159, "creation_date": 1544346916, "last_edit_date": 1544489931, "question_id": 53690863, "link": "https://stackoverflow.com/questions/53690863/use-mutex-but-still-got-concurrent-map-writes", "title": "Use mutex but still got concurrent map writes", "body": "<p>I have a map and want to manually further sharding, the simplified code is</p>\n\n<pre><code>const (\n    dictShardNum = 16\n    dictShardSize = 1 &lt;&lt; 28\n)\n\ntype shard struct {\n    mu sync.Mutex\n    m  map[int64]uint32\n}\n\ntype dict struct {\n    shards []shard\n}\n\nfunc newDict() *dict {\n   shards := make([]shard, 0, dictShardNum)\n   for i := 0; i &lt; dictShardNum; i++ {\n      shards = append(shards, shard{ m: make(map[int64]uint32) })\n   }\n   return &amp;dict{ shards }\n}\n\nfunc (d *dict) insert(n int64) uint32 {\n    shardNum := int(n % dictShardNum)\n    shard := d.shards[shardNum]\n    shard.mu.Lock()\n    defer shard.mu.Unlock()\n\n    tempID, ok := shard.m[n]\n    if !ok {\n        tempID = uint32(len(shard.m) + shardNum*dictShardSize)\n        shard.m[n] = tempID   // fatal error: concurrent map writes\n    }\n    return tempID\n}\n</code></pre>\n\n<p>When running I got <code>fatal error: concurrent map writes</code> at that line, but I did lock the mutex, not sure what's wrong with my code</p>\n"}, {"tags": ["go", "go-iris"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1544363459, "post_id": 53690841, "comment_id": 94241455, "body": "You should ask the author of iris. (But best would be: Do not use iris.)"}, {"owner": {"reputation": 2295, "user_id": 602059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1bd358846badc503b4358225e7edc231?s=128&d=identicon&r=PG", "display_name": "rdp", "link": "https://stackoverflow.com/users/602059/rdp"}, "edited": false, "score": 1, "creation_date": 1544366101, "post_id": 53690841, "comment_id": 94242145, "body": "View <a href=\"http://www.florinpatan.ro/2016/10/why-you-should-not-use-iris-for-your-go.html\" rel=\"nofollow noreferrer\">this post</a> to assist in forming an opinion of iris."}], "owner": {"reputation": 17, "user_id": 10766249, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4edb6a884591cdd16223a9321f739e4c?s=128&d=identicon&r=PG&f=1", "display_name": "sepetaana", "link": "https://stackoverflow.com/users/10766249/sepetaana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1544346765, "creation_date": 1544346765, "question_id": 53690841, "link": "https://stackoverflow.com/questions/53690841/go-iris-re-registering-a-service-in-an-mvc-application", "title": "go-iris Re-registering a service in an mvc application", "body": "<p>I am working on a heartbeat failure detector where on the front end I am using Iris and the front end is checking if the backend is alive. </p>\n\n<p>The front end is an Iris mvc application done the following way:</p>\n\n<pre><code>app := iris.New()\n\napp.StaticWeb(\"/\", \"./public\")\n\n// Configure the websocket server\nws := websocket.New(websocket.Config{})\n\njobAppsRouter := app.Party(\"/jobApplications\")\n\njobAppsRouter.Any(\"/iris-ws.js\", websocket.ClientHandler())\n\n// Create the MVC object\njobApplicationsApp := mvc.New(jobAppsRouter)\n</code></pre>\n\n<p>Then I create my connection and I do the following </p>\n\n<pre><code>/ Create the service that interacts with the repo\njobAppService := services.NewJobApplicationService(conn)\n\n// Dependencies\njobApplicationsApp.Register(\n    jobAppService,\n    ws.Upgrade,\n)\n// Controllers registration\njobApplicationsApp.Handle(new(controllers.JobAppController))\n// Start the web server at http://localhost:8080\napp.Run(iris.Addr(portStr))\n</code></pre>\n\n<p>This works and starts the app properly. The problem is that later on, I create a new connection to the same back end and I want to register a new service with it. Simply doing this again\n    jobAppService := services.NewJobApplicationService(conn)</p>\n\n<pre><code>// Dependencies\njobApplicationsApp.Register(\n    jobAppService,\n    ws.Upgrade,\n)\n</code></pre>\n\n<p>doesn't do what I need. What could I do?</p>\n"}, {"tags": ["elasticsearch", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1544354849, "post_id": 53690184, "comment_id": 94239337, "body": "You are not closing the connection gracefully. If you call <code>Close</code> in the connection returned by <code>Connect</code> the error should go away."}], "answers": [{"tags": [], "owner": {"reputation": 298, "user_id": 9456506, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "elham anari", "link": "https://stackoverflow.com/users/9456506/elham-anari"}, "is_accepted": true, "score": 1, "last_activity_date": 1544856281, "creation_date": 1544856281, "answer_id": 53790217, "question_id": 53690184, "link": "https://stackoverflow.com/questions/53690184/logstash-with-tcp-error-java-io-ioexception-connection-reset-by-peer/53790217#53790217", "title": "Logstash with tcp , error :java.io.IOException: Connection reset by peer", "body": "<p>I found the answer on this page :</p>\n\n<p><a href=\"https://github.com/logstash-plugins/logstash-input-tcp/issues/132\" rel=\"nofollow noreferrer\">https://github.com/logstash-plugins/logstash-input-tcp/issues/132</a></p>\n"}], "owner": {"reputation": 298, "user_id": 9456506, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "elham anari", "link": "https://stackoverflow.com/users/9456506/elham-anari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3393, "favorite_count": 0, "accepted_answer_id": 53790217, "answer_count": 1, "score": 2, "last_activity_date": 1544856281, "creation_date": 1544339426, "question_id": 53690184, "link": "https://stackoverflow.com/questions/53690184/logstash-with-tcp-error-java-io-ioexception-connection-reset-by-peer", "title": "Logstash with tcp , error :java.io.IOException: Connection reset by peer", "body": "<p>I want to use logstash in my golangApp.</p>\n\n<p>/etc/logstash/conf.d/first-pipeline.conf </p>\n\n<pre><code>input {\n  tcp {\n    port =&gt; 5959\n    codec =&gt; json\n  }\n}\n#filter {}\noutput {\n    elasticsearch {\n        hosts =&gt; [ \"localhost:9200\" ]\n    }\n}\n</code></pre>\n\n<p>and command for run logstash :</p>\n\n<p>/usr/share/logstash/bin/logstash -f /etc/logstash/conf.d/first-pipeline.conf --path.settings=/etc/logstash</p>\n\n<pre><code>    Sending Logstash logs to /var/log/logstash which is now configured via log4j2.properties\n    [2018-12-09T09:11:14,984][WARN ][logstash.config.source.multilocal] Ignoring the 'pipelines.yml' file because modules or command line options are specified\n    [2018-12-09T09:11:14,995][INFO ][logstash.runner          ] Starting Logstash {\"logstash.version\"=&gt;\"6.5.1\"}\n    [2018-12-09T09:11:16,968][INFO ][logstash.pipeline        ] Starting pipeline {:pipeline_id=&gt;\"main\", \"pipeline.workers\"=&gt;4, \"pipeline.batch.size\"=&gt;125, \"pipeline.batch.delay\"=&gt;50}\n    [2018-12-09T09:11:17,347][INFO ][logstash.outputs.elasticsearch] Elasticsearch pool URLs updated {:changes=&gt;{:removed=&gt;[], :added=&gt;[http://localhost:9200/]}}\n    [2018-12-09T09:11:17,356][INFO ][logstash.outputs.elasticsearch] Running health check to see if an Elasticsearch connection is working {:healthcheck_url=&gt;http://localhost:9200/, :path=&gt;\"/\"}\n    [2018-12-09T09:11:17,589][WARN ][logstash.outputs.elasticsearch] Restored connection to ES instance {:url=&gt;\"http://localhost:9200/\"}\n    [2018-12-09T09:11:17,655][INFO ][logstash.outputs.elasticsearch] ES Output version determined {:es_version=&gt;6}\n    [2018-12-09T09:11:17,660][WARN ][logstash.outputs.elasticsearch] Detected a 6.x and above cluster: the `type` event field won't be used to determine the document _type {:es_version=&gt;6}\n    [2018-12-09T09:11:17,692][INFO ][logstash.outputs.elasticsearch] New Elasticsearch output {:class=&gt;\"LogStash::Outputs::ElasticSearch\", :hosts=&gt;[\"//localhost:9200\"]}\n    [2018-12-09T09:11:17,730][INFO ][logstash.outputs.elasticsearch] Using mapping template from {:path=&gt;nil}\n    [2018-12-09T09:11:17,786][INFO ][logstash.outputs.elasticsearch] Attempting to install template {:manage_template=&gt;{\"template\"=&gt;\"logstash-*\", \"version\"=&gt;60001, \"settings\"=&gt;{\"index.refresh_interval\"=&gt;\"5s\"}, \"mappings\"=&gt;{\"_default_\"=&gt;{\"dynamic_templates\"=&gt;[{\"message_field\"=&gt;{\"path_match\"=&gt;\"message\", \"match_mapping_type\"=&gt;\"string\", \"mapping\"=&gt;{\"type\"=&gt;\"text\", \"norms\"=&gt;false}}}, {\"string_fields\"=&gt;{\"match\"=&gt;\"*\", \"match_mapping_type\"=&gt;\"string\", \"mapping\"=&gt;{\"type\"=&gt;\"text\", \"norms\"=&gt;false, \"fields\"=&gt;{\"keyword\"=&gt;{\"type\"=&gt;\"keyword\", \"ignore_above\"=&gt;256}}}}}], \"properties\"=&gt;{\"@timestamp\"=&gt;{\"type\"=&gt;\"date\"}, \"@version\"=&gt;{\"type\"=&gt;\"keyword\"}, \"geoip\"=&gt;{\"dynamic\"=&gt;true, \"properties\"=&gt;{\"ip\"=&gt;{\"type\"=&gt;\"ip\"}, \"location\"=&gt;{\"type\"=&gt;\"geo_point\"}, \"latitude\"=&gt;{\"type\"=&gt;\"half_float\"}, \"longitude\"=&gt;{\"type\"=&gt;\"half_float\"}}}}}}}}\n    [2018-12-09T09:11:17,809][INFO ][logstash.inputs.tcp      ] Automatically switching from json to json_lines codec {:plugin=&gt;\"tcp\"}\n    [2018-12-09T09:11:17,862][INFO ][logstash.inputs.tcp      ] Starting tcp input listener {:address=&gt;\"0.0.0.0:5959\", :ssl_enable=&gt;\"false\"}\n    [2018-12-09T09:11:18,097][INFO ][logstash.pipeline        ] Pipeline started successfully {:pipeline_id=&gt;\"main\", :thread=&gt;\"#&lt;Thread:0x42d68f8e run&gt;\"}\n    [2018-12-09T09:11:18,157][INFO ][logstash.agent           ] Pipelines running {:count=&gt;1, :running_pipelines=&gt;[:main], :non_running_pipelines=&gt;[]}\n    [2018-12-09T09:11:18,329][INFO ][logstash.agent           ] Successfully started Logstash API endpoint {:port=&gt;9600}\n</code></pre>\n\n<p>Code in golang:</p>\n\n<pre><code>import (\n    \"encoding/json\"\n    \"fmt\"\n    \"github.com/heatxsink/go-logstash\"\n    \"time\"\n)\nfunc main() {\n\nl := logstash.New(\"0.0.0.0\", 5959, 5)\n_, err := l.Connect()\nif err != nil {\n    fmt.Println(err)\n}\n\n\ndataMap := map[string]int{\"apple\": 5, \"lettuce\": 7}\njsonMap, _ := json.Marshal(dataMap)\n\nerr = l.Writeln(string(jsonMap))\nif err != nil {\n    fmt.Println(err)\n}\n}\n</code></pre>\n\n<p>when I try to request for logstash in app  .show this error end of terminal:</p>\n\n<blockquote>\n  <p>[2018-12-09T09:12:41,954][ERROR][logstash.inputs.tcp      ] Error in Netty pipeline: java.io.IOException: Connection reset by peer</p>\n</blockquote>\n\n<p>Every things are in my local system.\nCan help me , please !</p>\n"}, {"tags": ["go", "struct", "types", "keyword"], "answers": [{"comments": [{"owner": {"reputation": 55899, "user_id": 58961, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/5be12a5a883043ee47443e93217504b6?s=128&d=identicon&r=PG", "display_name": "John Leidegren", "link": "https://stackoverflow.com/users/58961/john-leidegren"}, "edited": false, "score": 2, "creation_date": 1555942337, "post_id": 53690276, "comment_id": 98260420, "body": "Additionally, if you have a type <code>A</code> with a method <code>B</code>. If you define another type <code>C</code> as <code>type C A</code> you won&#39;t be able to call method <code>B</code> on type <code>C</code>. That is <code>var c C; c.B()</code> won&#39;t compile. See <a href=\"https://play.golang.org/p/bocCzDqu3lh\" rel=\"nofollow noreferrer\">play.golang.org/p/bocCzDqu3lh</a>"}], "tags": [], "owner": {"reputation": 543, "user_id": 10256779, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UVf1v.png?s=128&g=1", "display_name": "hscasn", "link": "https://stackoverflow.com/users/10256779/hscasn"}, "is_accepted": true, "score": 23, "last_activity_date": 1544340781, "last_edit_date": 1544340781, "creation_date": 1544340399, "answer_id": 53690276, "question_id": 53689968, "link": "https://stackoverflow.com/questions/53689968/what-exactly-does-the-type-keyword-do-in-go/53690276#53690276", "title": "What (exactly) does the type keyword do in go?", "body": "<p>The <code>type</code> keyword is there to create a new type. This is called <a href=\"https://golang.org/ref/spec#Type_definitions\" rel=\"noreferrer\">type definition</a>. The new type (in your case, Vertex) will have the same structure as the underlying type (the struct with X and Y). That line is basically saying \"create a type called Vertex based on a struct of X int and Y int\".</p>\n\n<p>Don't confuse type definition with type aliasing. When you declare a new type, you are not just giving it a new name - it will be considered a distinct type. Take a look at <a href=\"https://golang.org/ref/spec#Type_identity\" rel=\"noreferrer\">type identity</a> for more information on the subject.</p>\n"}, {"tags": [], "owner": {"reputation": 16010, "user_id": 1568658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FPSGe.jpg?s=128&g=1", "display_name": "user218867", "link": "https://stackoverflow.com/users/1568658/user218867"}, "is_accepted": false, "score": 8, "last_activity_date": 1544344163, "last_edit_date": 1544344163, "creation_date": 1544341644, "answer_id": 53690392, "question_id": 53689968, "link": "https://stackoverflow.com/questions/53689968/what-exactly-does-the-type-keyword-do-in-go/53690392#53690392", "title": "What (exactly) does the type keyword do in go?", "body": "<p>It's used to define a new type.</p>\n\n<p>General format:<br>\n  <code>type &lt;new_type&gt; &lt;existing_type or type_definition&gt;</code></p>\n\n<p><strong>Common use cases:</strong></p>\n\n<ul>\n<li>Create a new type for an existing type.<br>\nFormat:<br>\n<code>type &lt;new_type&gt; &lt;existing_type&gt;</code><br>\ne.g<br>\n<code>type Seq []int</code></li>\n<li>Create a type while defining struct.<br>\nFormat:<br>\n<code>type &lt;new_type&gt; struct { /*...*/}</code><br>\ne.g<br>\n<a href=\"https://gobyexample.com/structs\" rel=\"noreferrer\">https://gobyexample.com/structs</a></li>\n<li>Define function type, <em>(aka. by assigning name to a function signature)</em>.<br>\nFormat:<br>\n<code>type &lt;FuncName&gt; func(&lt;param_type_list&gt;) &lt;return_type&gt;</code><br>\ne.g<br>\n<code>type AdderFunc func(int, int) int</code></li>\n</ul>\n\n<p><strong>In your case:</strong></p>\n\n<p>It define a type named <code>Vertex</code> for a new struct, so that later you can refer to the struct via <code>Vertex</code>.</p>\n"}], "owner": {"reputation": 3548, "user_id": 10415695, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ex5vb.jpg?s=128&g=1", "display_name": "LogicalBranch", "link": "https://stackoverflow.com/users/10415695/logicalbranch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7572, "favorite_count": 7, "accepted_answer_id": 53690276, "answer_count": 2, "score": 17, "last_activity_date": 1554296428, "creation_date": 1544337068, "last_edit_date": 1554296428, "question_id": 53689968, "link": "https://stackoverflow.com/questions/53689968/what-exactly-does-the-type-keyword-do-in-go", "title": "What (exactly) does the type keyword do in go?", "body": "<p>I've been reading <a href=\"https://tour.golang.org/list\" rel=\"noreferrer\">A Tour of Go</a> to learn <a href=\"https://golang.org\" rel=\"noreferrer\">Go-Lang</a> and so far it's going good.</p>\n\n<p>I'm currently on the <a href=\"https://tour.golang.org/moretypes/3\" rel=\"noreferrer\">Struct Fields</a> Lesson and here is the sample code from the right hand side:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Vertex struct {\n  X int\n  Y int\n}\n\nfunc main() {\n  v := Vertex{1, 2}\n  v.X = 4\n  fmt.Println(v.X)\n}\n</code></pre>\n\n<p>Take a look at line 3:</p>\n\n<pre><code>type Vertex struct {\n</code></pre>\n\n<p>What I don't understand this, what does the <code>type</code> keyword do and why is it there?</p>\n"}]