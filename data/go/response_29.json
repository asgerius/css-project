[{"tags": ["python", "api", "go"], "answers": [{"comments": [{"owner": {"reputation": 76, "user_id": 5171318, "user_type": "registered", "profile_image": "https://graph.facebook.com/1641592652753191/picture?type=large", "display_name": "Miguel P.", "link": "https://stackoverflow.com/users/5171318/miguel-p"}, "edited": false, "score": 0, "creation_date": 1438265132, "post_id": 31713458, "comment_id": 51388041, "body": "Im really sorry! first time posting on stackoverflow. edited the code and now is copy paste able and executes. I think i might be missing some kind of encode for the response when i pass it to the ComputeHmac512Hex method."}, {"owner": {"reputation": 76, "user_id": 5171318, "user_type": "registered", "profile_image": "https://graph.facebook.com/1641592652753191/picture?type=large", "display_name": "Miguel P.", "link": "https://stackoverflow.com/users/5171318/miguel-p"}, "edited": false, "score": 0, "creation_date": 1438267081, "post_id": 31713458, "comment_id": 51389529, "body": "I&#39;ll try in a sec! Yeah i only made it without params because i think the info url doesnt need anymore parameters, but the nonce. Still not sure on that, but yes the correct implementation would be with the full parameters. But i think the query data (parameters) is to be added to the header not to the rawurl, at least thats what i get from their description on the variables to send to them. <b>Update</b> just tryed and still doesnt work, i might be missing an encode on the result :x python code: queryStr = urllib.urlencode(query)"}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "reply_to_user": {"reputation": 76, "user_id": 5171318, "user_type": "registered", "profile_image": "https://graph.facebook.com/1641592652753191/picture?type=large", "display_name": "Miguel P.", "link": "https://stackoverflow.com/users/5171318/miguel-p"}, "edited": false, "score": 0, "creation_date": 1438267362, "post_id": 31713458, "comment_id": 51389739, "body": "Most likely you need to send the parameters as well: <a href=\"http://docs.python-requests.org/en/latest/user/quickstart/#passing-parameters-in-urls\" rel=\"nofollow noreferrer\">docs.python-requests.org/en/latest/user/quickstart/&hellip;</a>"}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "reply_to_user": {"reputation": 76, "user_id": 5171318, "user_type": "registered", "profile_image": "https://graph.facebook.com/1641592652753191/picture?type=large", "display_name": "Miguel P.", "link": "https://stackoverflow.com/users/5171318/miguel-p"}, "edited": false, "score": 0, "creation_date": 1438267404, "post_id": 31713458, "comment_id": 51389769, "body": "They are definitely added to the query string so please try with full URL."}, {"owner": {"reputation": 76, "user_id": 5171318, "user_type": "registered", "profile_image": "https://graph.facebook.com/1641592652753191/picture?type=large", "display_name": "Miguel P.", "link": "https://stackoverflow.com/users/5171318/miguel-p"}, "edited": false, "score": 0, "creation_date": 1438270634, "post_id": 31713458, "comment_id": 51392147, "body": "added this code: nonce := time.Now().UnixNano()         result :=  fmt.Sprintf(&quot;nonce=%d&quot;, nonce)         rawurl = fmt.Sprintf(&quot;%s%s/%s?%s&quot;, API_BASE_CRY ,API_VERSION_CRY , ressource, result ) ... like this? still cant do it"}, {"owner": {"reputation": 76, "user_id": 5171318, "user_type": "registered", "profile_image": "https://graph.facebook.com/1641592652753191/picture?type=large", "display_name": "Miguel P.", "link": "https://stackoverflow.com/users/5171318/miguel-p"}, "edited": false, "score": 0, "creation_date": 1438335323, "post_id": 31713458, "comment_id": 51419371, "body": "I updated the question :) but still cant seem to make this run properly"}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "reply_to_user": {"reputation": 76, "user_id": 5171318, "user_type": "registered", "profile_image": "https://graph.facebook.com/1641592652753191/picture?type=large", "display_name": "Miguel P.", "link": "https://stackoverflow.com/users/5171318/miguel-p"}, "edited": false, "score": 0, "creation_date": 1438336141, "post_id": 31713458, "comment_id": 51419875, "body": "I&#39;ve just tested the code with Cryptsy and it works well. <code>reponse {&quot;success&quot;:true,&quot;data&quot;:{&quot;id&quot;:&quot;336571&quot;,&quot;username&quot;:&quot;AlexAtNet&quot;&zwnj;&#8203;,&quot;accounttype&quot;:&quot;Pers&zwnj;&#8203;onal&quot;,&quot;email&quot;:...</code>. Make sure that your key/secret in the right order. The secret is longer. I mean that it literally works as it is now."}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "reply_to_user": {"reputation": 76, "user_id": 5171318, "user_type": "registered", "profile_image": "https://graph.facebook.com/1641592652753191/picture?type=large", "display_name": "Miguel P.", "link": "https://stackoverflow.com/users/5171318/miguel-p"}, "edited": false, "score": 0, "creation_date": 1438336234, "post_id": 31713458, "comment_id": 51419926, "body": "Make sure that you have got your keys from Cryptsy account page, API Keys section."}, {"owner": {"reputation": 76, "user_id": 5171318, "user_type": "registered", "profile_image": "https://graph.facebook.com/1641592652753191/picture?type=large", "display_name": "Miguel P.", "link": "https://stackoverflow.com/users/5171318/miguel-p"}, "edited": false, "score": 0, "creation_date": 1438353487, "post_id": 31713458, "comment_id": 51431416, "body": "reponse {&quot;success&quot;:true,&quot;data&quot;:{&quot;id&quot;:&quot;332744&quot;,&quot;username&quot;:&quot;MikePal&quot;,.&zwnj;&#8203;....   :D Thank you Alex :D"}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 1, "last_activity_date": 1438266169, "last_edit_date": 1438266169, "creation_date": 1438216804, "answer_id": 31713458, "question_id": 31713050, "link": "https://stackoverflow.com/questions/31713050/need-some-help-on-how-to-implement-an-restfull-api-app-based-on-golang/31713458#31713458", "title": "Need some help on how to implement an restfull api app based on golang", "body": "<p>I see the issue with <code>result :=  fmt.Sprintf(\"%d\", nonce)</code>. The code that corresponds to the Python code should be something like</p>\n\n<pre><code>result :=  fmt.Sprintf(\"nonce=%d\", nonce)\n</code></pre>\n\n<p>Could you please check it with this fix?</p>\n\n<p>I also can observe a major difference in how the request is sending. The Python version is (<a href=\"https://github.com/ScriptProdigy/CryptsyPythonV2/blob/master/Cryptsy.py\" rel=\"nofollow\">link</a>):</p>\n\n<pre><code>        ret = requests.get(link,\n                           params=query,\n                           headers=headers,\n                           verify=False)\n</code></pre>\n\n<p>but your code is does not send <code>params</code> with added nonce, etc. I think it should be something like</p>\n\n<pre><code>rawurl = fmt.Sprintf(\"%s%s/%s?%s\", API_BASE_CRY ,API_VERSION_CRY , ressource, queryStr)\n</code></pre>\n\n<p>where queryStr should contain nonce, etc.</p>\n"}], "owner": {"reputation": 76, "user_id": 5171318, "user_type": "registered", "profile_image": "https://graph.facebook.com/1641592652753191/picture?type=large", "display_name": "Miguel P.", "link": "https://stackoverflow.com/users/5171318/miguel-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "accepted_answer_id": 31713458, "answer_count": 1, "score": 0, "last_activity_date": 1438273117, "creation_date": 1438213752, "last_edit_date": 1438273117, "question_id": 31713050, "link": "https://stackoverflow.com/questions/31713050/need-some-help-on-how-to-implement-an-restfull-api-app-based-on-golang", "title": "Need some help on how to implement an restfull api app based on golang", "body": "<p>My coding skills are a bit low :)\nRecently i started learning golang and how to handle an Api communication app. Have been having a great time learning it by myself, golang is revealing itself as a challenging language with great rewards in the end (code sense ^^).</p>\n\n<p>Have been trying to create a cryptsy api lib for golang based on their API V2 (BETA) which is a restfull api. They have a python lib on their api website <a href=\"https://github.com/ScriptProdigy/CryptsyPythonV2/blob/master/Cryptsy.py\" rel=\"nofollow\">https://github.com/ScriptProdigy/CryptsyPythonV2/blob/master/Cryptsy.py</a>.</p>\n\n<p>So far have been able to get the public access working but am having a really hard time at the private access because of the authentication part.. I find that the info they give on their website on how to implement it is a bit confusing :(</p>\n\n<blockquote>\n  <p>Authorization is performed by sending the following variables into the request header Key</p>\n  \n  <ul>\n  <li>Public API key.</li>\n  <li>All query data (nonce=blahblah&amp;limit=blahblah) signed by a secret key according to HMAC-SHA512 method. Your secret key and public keys can be generated from your account settings page. Every request requires a unique nonce. (Suggested to use unix timestamp with microseconds)</li>\n  </ul>\n</blockquote>\n\n<p>For this authentication part the python code goes as:</p>\n\n<pre><code>def _query(self, method, id=None, action=None, query=[], get_method=\"GET\"):\n    query.append(('nonce', time.time()))\n    queryStr = urllib.urlencode(query)\n\n    link = 'https://' + self.domain + route\n\n    sign = hmac.new(self.PrivateKey.encode('utf-8'), queryStr, hashlib.sha512).hexdigest()\n\n    headers = {'Sign': sign, 'Key': self.PublicKey.encode('utf-8')}\n</code></pre>\n\n<p>Got this far in golang:</p>\n\n<pre><code>package main\n\nimport(\n\n    \"crypto/hmac\"\n    \"crypto/sha512\"\n    \"encoding/hex\"\n    \"encoding/json\"\n    \"errors\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n    \"strings\"\n    \"time\"\n\n)\n\nconst (\n\n    API_BASE_CRY    = \"https://api.cryptsy.com/api/\"\n    API_VERSION_CRY = \"v2\"\n    API_KEY_CRY     = \"xxxxx\"\n    API_SECRET_CRY  = \"xxxxxxxxxxxx\"\n    DEFAULT_HTTPCLIENT_TIMEOUT = 30 // HTTP client timeout\n)\n\ntype clientCry struct {\n    apiKey     string\n    apiSecret  string\n    httpClient *http.Client\n}\n\ntype Cryptsy struct {\n    clientCry *clientCry\n}\n\ntype CryptsyApiRsp struct {\n    Success bool            `json:\"success\"`\n    Data    json.RawMessage `json:\"data\"`\n}\n\nfunc NewCry(apiKey, apiSecret string) *Cryptsy {\n    clientCry := NewClientCry(apiKey, apiSecret)\n    return &amp;Cryptsy{clientCry}\n}\n\nfunc NewClientCry(apiKey, apiSecret string) (c *clientCry) {\n    return &amp;clientCry{apiKey, apiSecret, &amp;http.Client{}}\n}\n\nfunc ComputeHmac512Hex(secret, payload string) string {\n    h := hmac.New(sha512.New, []byte(secret))\n    h.Write([]byte(payload))\n    return hex.EncodeToString(h.Sum(nil))\n}\n\nfunc (c *clientCry) doTimeoutRequestCry(timer *time.Timer, req *http.Request) (*http.Response, error) {\n\n    type data struct {\n       resp *http.Response\n       err  error\n    }\n\n    done := make(chan data, 1)\n    go func() {\n       resp, err := c.httpClient.Do(req)\n       done &lt;- data{resp, err}\n    }()\n\n    select {\n       case r := &lt;-done:\n       return r.resp, r.err\n       case &lt;-timer.C:\n          return nil, errors.New(\"timeout on reading data from Bittrex API\")\n    }\n}\n\nfunc (c *clientCry) doCry(method string, ressource string, payload string, authNeeded bool) (response []byte, err error) {\n    connectTimer := time.NewTimer(DEFAULT_HTTPCLIENT_TIMEOUT * time.Second)\n\n    var rawurl string        \n\n    nonce := time.Now().UnixNano()\n    result :=  fmt.Sprintf(\"nonce=%d\", nonce)\n    rawurl = fmt.Sprintf(\"%s%s/%s?%s\", API_BASE_CRY ,API_VERSION_CRY , ressource, result )\n    req, err := http.NewRequest(method, rawurl, strings.NewReader(payload))\n\n    sig := ComputeHmac512Hex(API_SECRET_CRY, result)\n\n    req.Header.Add(\"Sign\", sig)\n    req.Header.Add(\"Key\", API_KEY_CRY )\n\n    resp, err := c.doTimeoutRequestCry(connectTimer, req)\n    defer resp.Body.Close()\n\n    response, err = ioutil.ReadAll(resp.Body)\n    fmt.Println(fmt.Sprintf(\"reponse %s\", response), err)\n    return response, err\n}\n\nfunc main() {\n\n    crypsy := NewCry(API_KEY_CRY, API_SECRET_CRY)\n    r, _ := crypsy.clientCry.doCry(\"GET\", \"info\", \"\", true) \n    fmt.Println(r)\n}\n</code></pre>\n\n<p>and my output is :</p>\n\n<p><code>response {\"success\":false,\"error\":[\"Must be authenticated\"]} &lt;nil&gt;</code></p>\n\n<p>not getting why :( im passing the public key and the signature in the header, the signature.. i think im doing it right in the hmac-sha512.\nI'm quering the user info url <a href=\"https://www.cryptsy.com/pages/apiv2/user\" rel=\"nofollow\">https://www.cryptsy.com/pages/apiv2/user</a>, which as stated in the api site  doesn't have any extra query variables so the nonce is the only one needed..</p>\n\n<p>Have googled about restfull api's but haven't been able to find any answer :( starting to not let me sleep at night since i think that what im doing is kinda right.. really cant spot the error.. </p>\n\n<p>Anyone out there that could try and help me with this? </p>\n\n<p>Thxs a lot :)</p>\n"}, {"tags": ["go", "systemd"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438211386, "post_id": 31712644, "comment_id": 51363198, "body": "I think you&#39;d need to include all of your applications code in order to get that... If you have goroutines your app will not reset gracefully unless you have code forcing all of them to return when the application wants to shut down."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438211491, "post_id": 31712644, "comment_id": 51363228, "body": "Sorry, that comment above is somewhat unclear. I don&#39;t know because none of your actual source is included here, however, in my experience, a Go application cannot shutdown/restart until all active goroutines return. I&#39;ve handled this by making all my async functions accept an abort channel and do all of their work from within a channel select where they listen for abort. If you have started goroutines and have no way to <i>make them return</i> when the restart command is issued then you will not be able to shut down gracefully."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438212228, "post_id": 31712644, "comment_id": 51363412, "body": "OK I would speculate that <code>endless</code>&#39; implementation of <code>ListenAndServe</code> is leaking goroutines but I&#39;ll take a look at their source."}, {"owner": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1438213571, "post_id": 31712644, "comment_id": 51363739, "body": "Can you clarify what you want to do, do you want systemctl restart to actually kill and start the process again, or do you want it to do a graceful restart ?"}, {"owner": {"reputation": 163, "user_id": 4234234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a48f86fd6861d7fc0bfc10a9d9f202e7?s=128&d=identicon&r=PG&f=1", "display_name": "uiwe83", "link": "https://stackoverflow.com/users/4234234/uiwe83"}, "reply_to_user": {"reputation": 206047, "user_id": 126769, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/zBsgn.png?s=128&g=1", "display_name": "nos", "link": "https://stackoverflow.com/users/126769/nos"}, "edited": false, "score": 0, "creation_date": 1438214606, "post_id": 31712644, "comment_id": 51363985, "body": "@nos I want it to do graceful restart."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438271813, "post_id": 31712644, "comment_id": 51392978, "body": "The fact that the command hangs until it&#39;s free from requests <i>is</i> a graceful restart. The point is to try and wait until there are no open connections, which is why &quot;endless&quot; has <code>DefaultHammerTime</code> to eventually kill the connection. I personally don&#39;t like or use this type of &quot;graceful&quot; restart on a busy server, since it adds a lot of complication, and you will always end up having to drop connections anyway."}], "owner": {"reputation": 163, "user_id": 4234234, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a48f86fd6861d7fc0bfc10a9d9f202e7?s=128&d=identicon&r=PG&f=1", "display_name": "uiwe83", "link": "https://stackoverflow.com/users/4234234/uiwe83"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1163, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1438213422, "creation_date": 1438211146, "last_edit_date": 1438211784, "question_id": 31712644, "link": "https://stackoverflow.com/questions/31712644/go-app-graceful-restart-with-systemd-and-endless", "title": "Go app graceful restart with systemd (and endless)", "body": "<p>I want to do real graceful restart for Go application, while still being able to control it with systemd. I'm using <a href=\"https://github.com/fvbock/endless\" rel=\"nofollow\">endless</a> in the app. The code is trivial (<code>endless.ListenAndServe(\":80\", nil)</code>), and for the systemd config file, so far I managed to make it like this (goapp.service):</p>\n\n<pre><code>[Unit]\nDescription=Go Application\nAfter=network.target\nAfter=syslog.target\n\n[Install]\nWantedBy=multi-user.target\n\n[Service]\nUser=root\nGroup=root\nWorkingDirectory=/root/go/src/myproject\nExecStart=/root/go/src/myproject/goapp\nKillSignal=SIGHUP\nRestart=on-failure\n</code></pre>\n\n<p>Then I just start the app with <code>systemctl start goapp</code>, everything's fine, but when I issue <code>systemctl restart goapp</code> while giving the application tons of requests at the same time, the restart command seems to hang my terminal (and not kill/fork the process) until it's free from requests. Of course, when there are no requests, the service restarts successfully.</p>\n\n<p>I'm testing with this simple code:</p>\n\n<pre><code>package main   \n\nimport \"net/http\"\nimport \"github.com/fvbock/endless\"\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Hello\"))\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", handler)\n    endless.ListenAndServe(\":80\", nil)\n}\n</code></pre>\n\n<p>Could anyone help with this? What am I doing wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438203967, "post_id": 31711068, "comment_id": 51360264, "body": "When you say &#39;binary&#39; are you talking about another Go package? Not to be confused with something like a dll produced by gcc."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438204164, "post_id": 31711068, "comment_id": 51360378, "body": "The current stable version of Go (1.4) doesn&#39;t have this; Go 1.5&#39;s beta has some stuff. I don&#39;t know enough for an answer (or have time right now to look it up), but <code>buildmode</code> is one of the switches involved; see <a href=\"http://stackoverflow.com/questions/30896892/using-go-1-5-buildmode-c-archive-with-net-http-server-linked-from-c\" title=\"using go 1 5 buildmode c archive with net http server linked from c\">stackoverflow.com/questions/30896892/&hellip;</a> for example"}, {"owner": {"reputation": 1579, "user_id": 1354514, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e83e6f559891e7489995dfa43e010fa3?s=128&d=identicon&r=PG", "display_name": "steve landiss", "link": "https://stackoverflow.com/users/1354514/steve-landiss"}, "edited": false, "score": 0, "creation_date": 1438204470, "post_id": 31711068, "comment_id": 51360540, "body": "When I say &#39;binary&#39; I just mean that when I do a go build or go run, it does not automatically include the file in the modules directory because no one in my main package is referencing it.  Therefore, the file in the modules directory never gets to call the function &quot;Register&quot;.  I want it to be able to call Register with out me having to reference that file from my main package."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1438204626, "post_id": 31711068, "comment_id": 51360631, "body": "While there will be some support for building shared libraries in go1.5, the framework for &quot;plugins&quot; isn&#39;t there yet. You might be able to work something together via <code>-buildmode=c-shared</code> and cgo wrappers, but I wouldn&#39;t recommend it."}], "answers": [{"tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 4, "last_activity_date": 1438205712, "creation_date": 1438205712, "answer_id": 31711578, "question_id": 31711068, "link": "https://stackoverflow.com/questions/31711068/how-do-i-force-golang-to-link-a-file-into-my-binary/31711578#31711578", "title": "How do I force golang to link a file into my binary?", "body": "<p>In short - you cannot. Go links everything statically and does some optimizations so the module you installing may not even be compiled if you do not reference it explicitly from main. Such limitation makes people suffer and they do <a href=\"https://www.packer.io/docs/extend/developing-plugins.html\" rel=\"nofollow\">this</a> - the plugins are just normal Go applications communicating with the main app via <a href=\"http://golang.org/pkg/net/rpc/\" rel=\"nofollow\">RPC</a>.</p>\n\n<p>It may sound weird (when one part of your app talks to another via TCP stack), but if you think about a bit more then it actually gives you quite strong confidence that plugin will do no harm to the application. For example, when the plugin crashes, the rest of the application, most likely, will survive.</p>\n"}], "owner": {"reputation": 1579, "user_id": 1354514, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e83e6f559891e7489995dfa43e010fa3?s=128&d=identicon&r=PG", "display_name": "steve landiss", "link": "https://stackoverflow.com/users/1354514/steve-landiss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 753, "favorite_count": 0, "accepted_answer_id": 31711578, "answer_count": 1, "score": 1, "last_activity_date": 1438205712, "creation_date": 1438203773, "question_id": 31711068, "link": "https://stackoverflow.com/questions/31711068/how-do-i-force-golang-to-link-a-file-into-my-binary", "title": "How do I force golang to link a file into my binary?", "body": "<p>I want to create a module library where a files can be added and will be part of my binary.  </p>\n\n<p>For example, in my <code>package main</code> I have:</p>\n\n<pre><code>type InitFunc func(params DriverParams) (Driver, error)\n\nfunc Register(name string, f InitFunc) {\n}\n</code></pre>\n\n<p>Then I would like someone to add a file in the modules directory that calls <code>Register()</code>.</p>\n\n<p>Subsequently my main package will call all the functions that have registered themselves.</p>\n\n<p>This way, my main package has no prior knowledge of the modules that will be added.</p>\n\n<p>How do I accomplish this in golang?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3410, "user_id": 1144120, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/263cde71709be665db6ce1d2c0d8e532?s=128&d=identicon&r=PG", "display_name": "Arel", "link": "https://stackoverflow.com/users/1144120/arel"}, "edited": false, "score": 1, "creation_date": 1438204058, "post_id": 31711077, "comment_id": 51360314, "body": "Ugh. Thanks!! I spent over an hour trying to figure out why I was getting that error, and checked over everything a bunch of times, and completely missed that."}, {"owner": {"reputation": 3410, "user_id": 1144120, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/263cde71709be665db6ce1d2c0d8e532?s=128&d=identicon&r=PG", "display_name": "Arel", "link": "https://stackoverflow.com/users/1144120/arel"}, "edited": false, "score": 0, "creation_date": 1438204189, "post_id": 31711077, "comment_id": 51360393, "body": "Thanks for the recommendation. I&#39;ll do that."}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 10, "last_activity_date": 1438203814, "creation_date": 1438203814, "answer_id": 31711077, "question_id": 31710692, "link": "https://stackoverflow.com/questions/31710692/sql-scan-error-on-column-index-38-destination-not-a-pointer/31711077#31711077", "title": "sql: Scan error on column index 38: destination not a pointer", "body": "<p>Your last parameter, longitude, is not being passed by address.</p>\n\n<p>change to &amp;longitude</p>\n\n<p>as a side note, using \"select *\" and assuming column position is predictable is a recipe for down the road errors.</p>\n\n<p>You probably should name all the columns you select, in case a future table change causes a column ordering issue.</p>\n"}], "owner": {"reputation": 3410, "user_id": 1144120, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/263cde71709be665db6ce1d2c0d8e532?s=128&d=identicon&r=PG", "display_name": "Arel", "link": "https://stackoverflow.com/users/1144120/arel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8092, "favorite_count": 0, "accepted_answer_id": 31711077, "answer_count": 1, "score": 6, "last_activity_date": 1438203814, "creation_date": 1438202524, "question_id": 31710692, "link": "https://stackoverflow.com/questions/31710692/sql-scan-error-on-column-index-38-destination-not-a-pointer", "title": "sql: Scan error on column index 38: destination not a pointer", "body": "<p>Using Golang and the built in <code>database/sql</code> library and the postgres <code>lib/pq</code> library, I'm trying to read from a database that has some null values in some of the records. the code compiles, but when I try to run it I get the following error. </p>\n\n<pre><code>sql: Scan error on column index 38: destination not a pointer\n</code></pre>\n\n<p>Here is my code:</p>\n\n<pre><code>  rows, err := db.Query(`SELECT * FROM observations WHERE profile_id=$1 AND year=$2 AND month=$3`, id, date.Year(), int(date.Month()))\n  if err != nil {\n    log.Fatal(err)\n  }\n  defer rows.Close()\n  for rows.Next() {\n    var id sql.NullInt64\n    var year sql.NullInt64\n    var month sql.NullInt64\n    var day_of_week sql.NullInt64 \n    var hour sql.NullInt64\n    var profile_id sql.NullInt64 \n    var created_at time.Time \n    var updated_at time.Time\n    var banking sql.NullFloat64\n    var hlt_pro sql.NullFloat64 \n    var sup_shp sql.NullFloat64 \n    var aff_con sql.NullFloat64 \n    var biz_trv sql.NullFloat64 \n    var investing sql.NullFloat64 \n    var day_com sql.NullFloat64 \n    var unique_emin sql.NullFloat64 \n    var no_group sql.NullFloat64 \n    var movie_goer sql.NullFloat64 \n    var luxury_shopper sql.NullFloat64 \n    var sports_fan sql.NullFloat64 \n    var aland sql.NullInt64\n    var awater sql.NullInt64\n    var tractce sql.NullString\n    var geoid sql.NullString\n    var median_income sql.NullInt64 \n    var total_population sql.NullInt64 \n    var white sql.NullInt64 \n    var black sql.NullInt64 \n    var native_american sql.NullInt64 \n    var asian sql.NullInt64 \n    var pacific_islander sql.NullInt64 \n    var other sql.NullInt64 \n    var two_plus sql.NullInt64 \n    var two_plus_question sql.NullInt64 \n    var confused sql.NullInt64 \n    var median_age sql.NullFloat64\n    var count sql.NullFloat64\n    var latitude sql.NullString\n    var longitude sql.NullString\n    if err := rows.Scan(&amp;id, &amp;year, &amp;month, &amp;day_of_week, &amp;hour, &amp;profile_id, &amp;created_at, &amp;updated_at, &amp;banking, &amp;hlt_pro, &amp;sup_shp, &amp;aff_con, &amp;biz_trv, &amp;investing, &amp;day_com, &amp;unique_emin, &amp;no_group, &amp;movie_goer, &amp;luxury_shopper, &amp;sports_fan, &amp;aland, &amp;awater, &amp;tractce, &amp;geoid, &amp;median_income, &amp;total_population, &amp;white, &amp;black, &amp;native_american, &amp;asian, &amp;pacific_islander, &amp;other, &amp;two_plus, &amp;two_plus_question, &amp;confused, &amp;median_age, &amp;count, &amp;latitude, longitude); err != nil {\n      log.Fatal(err)\n    }\n    fmt.Println(id, year, month, day_of_week, hour, profile_id, created_at, updated_at, banking, hlt_pro, sup_shp, aff_con, biz_trv, investing, day_com, unique_emin, no_group, movie_goer, luxury_shopper, sports_fan, aland, awater, tractce, geoid, median_income, total_population, white, black, native_american, asian, pacific_islander, other, two_plus, two_plus_question, confused, median_age, count, latitude, longitude)\n\n  }\n  if err := rows.Err(); err != nil {\n    log.Fatal(err)\n  }\n</code></pre>\n\n<p>I'm using <code>sql.NullType</code>, which is the same as doing <code>*type</code>. This is an effort handle the null situation, and it seems to be working for most columns, but I'm not sure why it's saying \"destination not a pointer\". Also, I have no idea which variable is the problem. Any ideas?</p>\n"}, {"tags": ["javascript", "angularjs", "go"], "comments": [{"owner": {"reputation": 5324, "user_id": 4601145, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Wz2Cw.jpg?s=128&g=1", "display_name": "schellingerht", "link": "https://stackoverflow.com/users/4601145/schellingerht"}, "edited": false, "score": 0, "creation_date": 1438198741, "post_id": 31709533, "comment_id": 51357295, "body": "Nothing wrong with your code, I suggest. You don&#39;t do a request, but only try to print an element from your array.  Your server crashes: see: <a href=\"https://github.com/coreos/flannel/issues/242\" rel=\"nofollow noreferrer\">github.com/coreos/flannel/issues/242</a>"}, {"owner": {"reputation": 127321, "user_id": 2435473, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/8hKGc.jpg?s=128&g=1", "display_name": "Pankaj Parkar", "link": "https://stackoverflow.com/users/2435473/pankaj-parkar"}, "edited": false, "score": 0, "creation_date": 1438198749, "post_id": 31709533, "comment_id": 51357304, "body": "Seems like only missing <code>ng-app=&quot;dashboard&quot;</code> here you can see <a href=\"http://plnkr.co/edit/oV4lRM0n9zOWfKCIy0vC?p=preview\" rel=\"nofollow noreferrer\">plnkr.co/edit/oV4lRM0n9zOWfKCIy0vC?p=preview</a>"}, {"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "edited": false, "score": 0, "creation_date": 1438225063, "post_id": 31709533, "comment_id": 51366474, "body": "So did you manage to resolve the problem?"}], "answers": [{"comments": [{"owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "edited": false, "score": 0, "creation_date": 1438198817, "post_id": 31709638, "comment_id": 51357340, "body": "is there another way around this? For example by not using go&#39;s templates to serve a static page?"}, {"owner": {"reputation": 5324, "user_id": 4601145, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Wz2Cw.jpg?s=128&g=1", "display_name": "schellingerht", "link": "https://stackoverflow.com/users/4601145/schellingerht"}, "edited": false, "score": 0, "creation_date": 1438198824, "post_id": 31709638, "comment_id": 51357344, "body": "I don&#39;t know &#39;Go&#39;, but this is a index.html file, so make it sense?"}, {"owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "edited": false, "score": 0, "creation_date": 1438198888, "post_id": 31709638, "comment_id": 51357375, "body": "so I did that, and now there are no errors, but the output on the DOM is simply //jobsCtrl.jobs[0]//"}, {"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "reply_to_user": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "edited": false, "score": 0, "creation_date": 1438198966, "post_id": 31709638, "comment_id": 51357422, "body": "@praks5432 if you just want to serve static pages you can just use Go&#39;s built in fileserver <a href=\"http://golang.org/pkg/net/http/#example_FileServer\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#example_FileServer</a>"}, {"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "reply_to_user": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "edited": false, "score": 0, "creation_date": 1438199061, "post_id": 31709638, "comment_id": 51357476, "body": "@praks5432 that&#39;s strange. Could you try using <code>[{</code> and <code>}]</code>? It&#39;s the only thing I&#39;ve used. The implementation with <code>&#47;&#47;</code> I posted was copied from the docs and might surprisingly be broken. Also you might be missing <code>ng-app</code> as Pankaj suggested."}, {"owner": {"reputation": 76, "user_id": 4881724, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KF1IG00XWCU/AAAAAAAAAAI/AAAAAAAAAnM/CS3nMpy668Y/photo.jpg?sz=128", "display_name": "KidVeno", "link": "https://stackoverflow.com/users/4881724/kidveno"}, "edited": false, "score": 0, "creation_date": 1438266358, "post_id": 31709638, "comment_id": 51388992, "body": "Why not use $scope.jobs =jobs and then just {{jobs}} in your html"}, {"owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "reply_to_user": {"reputation": 76, "user_id": 4881724, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KF1IG00XWCU/AAAAAAAAAAI/AAAAAAAAAnM/CS3nMpy668Y/photo.jpg?sz=128", "display_name": "KidVeno", "link": "https://stackoverflow.com/users/4881724/kidveno"}, "edited": false, "score": 0, "creation_date": 1438266570, "post_id": 31709638, "comment_id": 51389156, "body": "@KidVeno it doesn&#39;t relate to the problem he has, but the reason he&#39;s doing that is that when you start building more advanced applications with angular, you begin to nest scopes, which starts to become a mess. To avoid that you instead can use <code>controllerAs</code> syntax so that the expressions you want to put into your HTML can be namespaced. That way if two nested controllers have <code>name</code> defined you can just differentiate by doing <code>ctrl.name</code> and <code>ctrl2.name</code> instead of something like <code>$scope.$parent.name</code>"}], "tags": [], "owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "is_accepted": true, "score": 0, "last_activity_date": 1438199165, "last_edit_date": 1438199165, "creation_date": 1438198713, "answer_id": 31709638, "question_id": 31709533, "link": "https://stackoverflow.com/questions/31709533/angularjs-crashes-when-trying-to-access-data-in-directive/31709638#31709638", "title": "AngularJs crashes when trying to access data in directive", "body": "<p>You cannot use angular's default start <code>{{</code> and end <code>}}</code> brackets in a go template because the go server interprets your angular as <a href=\"http://golang.org/pkg/text/template/\" rel=\"nofollow\">go template arguments and pipelines</a>.</p>\n\n<blockquote>\n  <p>\"Arguments\" and \"pipelines\" are evaluations of data</p>\n</blockquote>\n\n<p>To solve this you can make use of angular's $interpolate in your config to change the delimiters that define angular code:</p>\n\n<pre><code>var app = angular.module('dashboard', []);\n\napp.config(function($interpolateProvider) {\n    $interpolateProvider.startSymbol('[{');\n    $interpolateProvider.endSymbol('}]');\n});\n</code></pre>\n\n<p>Alternatively if your pages are static you can just use Go's built in file server to not cause confusion with templates:</p>\n\n<p><a href=\"http://golang.org/pkg/net/http/#example_FileServer\" rel=\"nofollow\">http://golang.org/pkg/net/http/#example_FileServer</a></p>\n"}], "owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 31709638, "answer_count": 1, "score": 2, "last_activity_date": 1438199165, "creation_date": 1438198375, "question_id": 31709533, "link": "https://stackoverflow.com/questions/31709533/angularjs-crashes-when-trying-to-access-data-in-directive", "title": "AngularJs crashes when trying to access data in directive", "body": "<p>So I'm new to Angular and trying to do an app. My server is very basic and written in go. This is my angular code-</p>\n\n<pre><code>(function() {\n    var app = angular.module('dashboard', []);\n    app.controller(\"JobsController\", function() {\n        this.currentJob = 0;\n        this.jobs = jobs;\n        this.setCurrentJob = function(index) {\n            this.currentJob = index; \n        };      \n    });\n\n    var jobs = [\n        {\n            'id': 1,\n            'requester': 'Prakash Sanker',\n            'description': 'I want you to give me the entire world'\n        },\n        {\n            'id': 2,\n            'requester': 'MJ Watson',\n            'description': 'Please give me Spiderman, preferably upside down...but Im not fussy'\n        },\n        {   'id': 3,\n            'requester': 'Josh Lyman',\n            'description': 'Matthew Santos as president...or Jed Bartlet..but please not anyone Republican'\n        }, \n        {\n            'id': 4,\n            'requester': 'Barry Allen',\n            'description': 'A frictionless suit that wont burst into flames when I run at a zillion miles an hour...its for a friend'\n        },\n        {\n            'id': 5,\n            'requeter': 'A. Bambaata',\n            'description': 'Boombox, prime condition, from the 80s. Go back in time if you have to'\n        }\n    ];\n\n})();\n</code></pre>\n\n<p>This is my index.html - </p>\n\n<pre><code>&lt;script src=\"https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js\"&gt;&lt;/script&gt;\n&lt;script src=\"https://ajax.googleapis.com/ajax/libs/angularjs/1.3.14/angular.min.js\"&gt;&lt;/script&gt;\n&lt;script type=\"text/javascript\" src=\"/dashboard.js\"&gt;&lt;/script&gt;\n&lt;body&gt;\n    &lt;div class=\"dashboard\"&gt;\n        &lt;div ng-controller=\"JobsController as jobsCtrl\"&gt;\n            &lt;div class=\"jobs\"&gt;\n                {{jobsCtrl.jobs[0]}}\n            &lt;/div&gt;\n        &lt;/div&gt;\n    &lt;/div&gt;\n&lt;/body&gt;\n</code></pre>\n\n<p>This causes this error on my server </p>\n\n<pre><code>2015/07/29 12:18:02 http: panic serving [::1]:56857: runtime error: invalid memory address or nil pointer dereference\ngoroutine 18 [running]:\nnet/http.func\u00b7009()\n    /usr/local/go/src/pkg/net/http/server.go:1093 +0x9e\nruntime.panic(0x20ed40, 0x4efaed)\n    /usr/local/go/src/pkg/runtime/panic.c:248 +0xda\nhtml/template.(*Template).escape(0x0, 0x0, 0x0)\n    /usr/local/go/src/pkg/html/template/template.go:52 +0x30\n</code></pre>\n\n<p>Why is this happening? </p>\n"}, {"tags": ["pointers", "go", "interface", "implements"], "answers": [{"comments": [{"owner": {"reputation": 343, "user_id": 5019932, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa317ece3b13543559cbf2e2d0833e37?s=128&d=identicon&r=PG", "display_name": "Javier Zunzunegui", "link": "https://stackoverflow.com/users/5019932/javier-zunzunegui"}, "edited": false, "score": 1, "creation_date": 1438194358, "post_id": 31708052, "comment_id": 51354793, "body": "You are right, I just tested it and it runs OK. Thanks func main() { \ttype I interface{} \tf := func(p interface{}) { fmt.Println(&quot;runs&quot;) } \tvar i I = 1 \tf(&amp;i) }"}], "tags": [], "owner": {"reputation": 1667, "user_id": 359660, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a63c1f44ef127e609753975421ef7f?s=128&d=identicon&r=PG", "display_name": "LanceH", "link": "https://stackoverflow.com/users/359660/lanceh"}, "is_accepted": true, "score": 1, "last_activity_date": 1438193424, "creation_date": 1438193424, "answer_id": 31708052, "question_id": 31707969, "link": "https://stackoverflow.com/questions/31707969/golang-exception-to-rule-interface-pointer-cant-implement-interface/31708052#31708052", "title": "golang exception to rule &quot;interface pointer can&#39;t implement interface&quot;", "body": "<p>Just below it says:</p>\n\n<blockquote>\n  <p>The one exception is that any value, even a pointer to an interface,\n  can be assigned to a variable of empty interface type (interface{}).\n  Even so, it's almost certainly a mistake if the value is a pointer to\n  an interface; the result can be confusing.</p>\n</blockquote>\n"}], "owner": {"reputation": 343, "user_id": 5019932, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa317ece3b13543559cbf2e2d0833e37?s=128&d=identicon&r=PG", "display_name": "Javier Zunzunegui", "link": "https://stackoverflow.com/users/5019932/javier-zunzunegui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 31708052, "answer_count": 1, "score": 0, "last_activity_date": 1438193424, "creation_date": 1438193183, "question_id": 31707969, "link": "https://stackoverflow.com/questions/31707969/golang-exception-to-rule-interface-pointer-cant-implement-interface", "title": "golang exception to rule &quot;interface pointer can&#39;t implement interface&quot;", "body": "<p>In golang.org's official FAQ, <a href=\"https://golang.org/doc/faq#Pointers\" rel=\"nofollow\">under pointers</a> there is this quote:\n<em>\"The insight is that although a pointer to a concrete type can satisfy an interface, with one exception a pointer to an interface can never satisfy an interface\"</em></p>\n\n<p>Out of curiosity, what is that exception to the above rule?\ni.e when can an interface pointer implement an interface?</p>\n"}, {"tags": ["git", "go", "libgit2"], "comments": [{"owner": {"reputation": 984, "user_id": 1243295, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/79b8e8aa1e533779ea0d7b9c696d9572?s=128&d=identicon&r=PG", "display_name": "doxsi", "link": "https://stackoverflow.com/users/1243295/doxsi"}, "edited": false, "score": 0, "creation_date": 1474007270, "post_id": 31707337, "comment_id": 66365223, "body": "I am experimenting exacly the same. Have you resoved that (without give 777 permision to entire directory) ?"}], "answers": [{"comments": [{"owner": {"reputation": 2368, "user_id": 789655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b7fac771a6c8fccc82fe34f951b7b3fd?s=128&d=identicon&r=PG", "display_name": "Sthe", "link": "https://stackoverflow.com/users/789655/sthe"}, "edited": false, "score": 0, "creation_date": 1438254017, "post_id": 31712977, "comment_id": 51380280, "body": "thank you for the advice. Please see my updates on the question. Should I be giving write access to the user that&#39;s running Git or the <code>www-data</code> running Nginx? I&#39;m using the <code>git-http-backend</code>"}, {"owner": {"reputation": 2368, "user_id": 789655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b7fac771a6c8fccc82fe34f951b7b3fd?s=128&d=identicon&r=PG", "display_name": "Sthe", "link": "https://stackoverflow.com/users/789655/sthe"}, "edited": false, "score": 0, "creation_date": 1438254733, "post_id": 31712977, "comment_id": 51380736, "body": "Aah. It works now, but I had to change permissions on the folder <code>chmod -R 777 apps&#47; </code>. Before I close the thread, I don&#39;t feel that opening the directory up like that is a good thing. Any advice you can give in this regards?"}, {"owner": {"reputation": 5037, "user_id": 1370215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/023e1295851b018af03706f391b76931?s=128&d=identicon&r=PG", "display_name": "Carlos Mart&#237;n Nieto", "link": "https://stackoverflow.com/users/1370215/carlos-mart%c3%adn-nieto"}, "reply_to_user": {"reputation": 2368, "user_id": 789655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b7fac771a6c8fccc82fe34f951b7b3fd?s=128&d=identicon&r=PG", "display_name": "Sthe", "link": "https://stackoverflow.com/users/789655/sthe"}, "edited": false, "score": 0, "creation_date": 1438258704, "post_id": 31712977, "comment_id": 51383369, "body": "That depends a lot on your exact setup, but if you must have different users, you can add them to the same group and  init your repositories with <code>--shared=group</code>."}], "tags": [], "owner": {"reputation": 5037, "user_id": 1370215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/023e1295851b018af03706f391b76931?s=128&d=identicon&r=PG", "display_name": "Carlos Mart&#237;n Nieto", "link": "https://stackoverflow.com/users/1370215/carlos-mart%c3%adn-nieto"}, "is_accepted": true, "score": 1, "last_activity_date": 1438213259, "creation_date": 1438213259, "answer_id": 31712977, "question_id": 31707337, "link": "https://stackoverflow.com/questions/31707337/gig2go-unpacking-the-sent-packfile-failed-on-the-remote/31712977#31712977", "title": "Gig2go: unpacking the sent packfile failed on the remote", "body": "<p>This is an error, which happens on the server, so the place to look would be its logs. Have you tried doing the same operation with git itself? I don't remember off-hand, but there might be an extra error string which libgit2 is not returning at the moment.</p>\n\n<p>Errors to unpack on the server are often related to the permissions of the user which git is running on the remote.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 7164621, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cadb1e04bfa46d5344cfe0c4e44db9be?s=128&d=identicon&r=PG&f=1", "display_name": "Mike Chang", "link": "https://stackoverflow.com/users/7164621/mike-chang"}, "is_accepted": false, "score": 0, "last_activity_date": 1491848406, "creation_date": 1491848406, "answer_id": 43330247, "question_id": 31707337, "link": "https://stackoverflow.com/questions/31707337/gig2go-unpacking-the-sent-packfile-failed-on-the-remote/43330247#43330247", "title": "Gig2go: unpacking the sent packfile failed on the remote", "body": "<p>I had the same problem during VSTS Sync, and saw in VSTS output window with the same error message.</p>\n\n<p>My fix is to go to <a href=\"https://app.vssps.visualstudio.com/_signedin\" rel=\"nofollow noreferrer\">https://app.vssps.visualstudio.com/_signedin</a> and then most likely get my cred logged onto the remote server.</p>\n\n<p>Afterwards, come back to VSTS and Sync again, the error is gone.  HIH.</p>\n"}], "owner": {"reputation": 2368, "user_id": 789655, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b7fac771a6c8fccc82fe34f951b7b3fd?s=128&d=identicon&r=PG", "display_name": "Sthe", "link": "https://stackoverflow.com/users/789655/sthe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6024, "favorite_count": 0, "accepted_answer_id": 31712977, "answer_count": 2, "score": 0, "last_activity_date": 1491848406, "creation_date": 1438191200, "last_edit_date": 1438253760, "question_id": 31707337, "link": "https://stackoverflow.com/questions/31707337/gig2go-unpacking-the-sent-packfile-failed-on-the-remote", "title": "Gig2go: unpacking the sent packfile failed on the remote", "body": "<p>I've struggled so much with this. I'm trying to push changes to the repo using the code below:</p>\n\n<pre><code>// Get remote\nremote, err := repo.Remotes.Lookup(\"origin\")\nif err != nil {\n    remote, err = repo.Remotes.Create(\"origin\", repo.Path())\n    if err != nil {\n        return err\n    }\n}\n\n// Get the branch\nbranch, err := repo.Branch()\nif err != nil {\n    return err\n}\n\n// Get the name\nbranchName, err := branch.Name()\nif err != nil {\n    return err\n}\n\nif err := remote.Push([]string{\"refs/heads/\"+branchName}, &amp;git.PushOptions{}); err != nil {\n    return err\n}\n</code></pre>\n\n<p>Everything seems fine, but I keep getting this error:</p>\n\n<pre><code>unpacking the sent packfile failed on the remote\n</code></pre>\n\n<p>Upon reading a few git resources, I now understand what the error means, but I still have no idea what is causing it.</p>\n\n<hr>\n\n<p><strong>Edit</strong></p>\n\n<p>I have just tried using Git as per @Carlos' suggestion, and I'm am getting more information now:</p>\n\n<pre><code>git push --set-upstream origin master\nCounting objects: 3, done.\nDelta compression using up to 4 threads.\nCompressing objects: 100% (2/2), done.\nWriting objects: 100% (3/3), 241 bytes | 0 bytes/s, done.\nTotal 3 (delta 0), reused 0 (delta 0)\nremote: error: insufficient permission for adding an object to repository database ./objects\nremote: fatal: failed to write object\nerror: unpack failed: unpack-objects abnormal exit\nTo http://xxxxxxx/xxxxxx/app.git\n ! [remote rejected] master -&gt; master (unpacker error)\nerror: failed to push some refs to 'http://xxxxxxx/xxxxxxx/app.git'\n</code></pre>\n\n<p>I thought I got the permissions right though, here is how my Git directory looks like on the server:</p>\n\n<pre><code>root@CodeSpaces-001:/home/git# ll\ntotal 40\ndrwxr-xr-x 5 git  git  4096 Jul 29 19:22 ./\ndrwxr-xr-x 3 root root 4096 Jul 29 18:21 ../\ndrwxrwxr-x 3 git  git  4096 Jul 29 19:22 apps/ # My repos are in here\n</code></pre>\n\n<p>Should this not be sufficient?</p>\n"}, {"tags": ["go", "channel", "petri-net"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1438192477, "post_id": 31707158, "comment_id": 51353648, "body": "Nope. You can do a non-blocking receive (using a <code>select</code> with one receive case and a <code>default</code>) on a channel to not block if <code>b</code> is not ready (but then you&#39;ve already taken a value from <code>a</code>), and you can do <code>len()</code> on a buffered channel to speculatively check how many items are in the buffer (though that can change before your receive executes)."}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 5170386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/466c83e0b71e3c2d82c3551088c6506c?s=128&d=identicon&r=PG&f=1", "display_name": "Brian Candler", "link": "https://stackoverflow.com/users/5170386/brian-candler"}, "edited": false, "score": 0, "creation_date": 1438197180, "post_id": 31707645, "comment_id": 51356464, "body": "I guess my example wasn&#39;t particularly clear. If I was just reading from (a,b) and (c,d) then the simple solution is to have two separate goroutines. But suppose there are three channels (a,b,c), and one branch reads from (a,b) and the other branch reads from (a,c) ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 41, "user_id": 5170386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/466c83e0b71e3c2d82c3551088c6506c?s=128&d=identicon&r=PG&f=1", "display_name": "Brian Candler", "link": "https://stackoverflow.com/users/5170386/brian-candler"}, "edited": false, "score": 3, "creation_date": 1438198722, "post_id": 31707645, "comment_id": 51357278, "body": "@BrianCandler: I skipped over the comment about Petri nets. This isn&#39;t something you can do with channels alone, and I have a feeling that CSP isn&#39;t going to be useful in representing this (though the inverse is possible). In order to determine if multiple channels can succeed and then operate on them, you need to stop all other concurrent processes doing the same. Goroutines and channels don&#39;t seem to be a good fit for the problem space."}, {"owner": {"reputation": 41, "user_id": 5170386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/466c83e0b71e3c2d82c3551088c6506c?s=128&d=identicon&r=PG&f=1", "display_name": "Brian Candler", "link": "https://stackoverflow.com/users/5170386/brian-candler"}, "edited": false, "score": 1, "creation_date": 1438243244, "post_id": 31707645, "comment_id": 51373524, "body": "Thank you @JimB, that&#39;s the answer I was looking for."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 2, "last_activity_date": 1438192189, "creation_date": 1438192189, "answer_id": 31707645, "question_id": 31707158, "link": "https://stackoverflow.com/questions/31707158/checking-for-simultaneous-channels-ready-in-go/31707645#31707645", "title": "Checking for simultaneous channels ready in go", "body": "<p>You can't select on multiple channels simultaneously. What you can do is implement a fan-in pattern for coalescing your values from multiple channels.</p>\n\n<p>A rough example based on your code might look like:</p>\n\n<pre><code>func collect(ret chan []int, chans ...&lt;-chan int) {\n    ints := make([]int, len(chans))\n    for i, c := range chans {\n        ints[i] = &lt;-c\n    }\n    ret &lt;- ints\n}\n\nfunc mynet(a, b, c, d &lt;-chan int, res chan&lt;- int) {\n    set1 := make(chan []int)\n    set2 := make(chan []int)\n    go collect(set1, a, b)\n    go collect(set2, c, d)\n    for {\n        select {\n        case vs := &lt;-set1:\n            res &lt;- vs[0] + vs[1]\n        case vs := &lt;-set2:\n            res &lt;- vs[0] + vs[1]\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1667, "user_id": 359660, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a63c1f44ef127e609753975421ef7f?s=128&d=identicon&r=PG", "display_name": "LanceH", "link": "https://stackoverflow.com/users/359660/lanceh"}, "is_accepted": false, "score": 0, "last_activity_date": 1438192782, "creation_date": 1438192782, "answer_id": 31707837, "question_id": 31707158, "link": "https://stackoverflow.com/questions/31707158/checking-for-simultaneous-channels-ready-in-go/31707837#31707837", "title": "Checking for simultaneous channels ready in go", "body": "<p>Individual channels for the two different pairs that you are accumulating may work:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc mynetPlus(a, b &lt;-chan int, res chan&lt;- int) {\n    for {\n        select {\n        case v1 := &lt;-a:\n            v2 := &lt;-b\n            res &lt;- v1 + v2\n        case v2 := &lt;-b:\n            v1 := &lt;-a\n            res &lt;- v1 + v2\n        }\n    }\n}\n\nfunc mynetMinus(c, d &lt;-chan int, res chan&lt;- int) {\n    for {\n        select {\n        case v1 := &lt;-c:\n            v2 := &lt;-d\n            res &lt;- v1 + v2\n        case v2 := &lt;-d:\n            v1 := &lt;-c\n            res &lt;- v1 + v2\n        }\n    }\n}\n\nfunc main() {\n    a := make(chan int)\n    b := make(chan int)\n    c := make(chan int)\n    d := make(chan int)\n    res := make(chan int, 10)\n    go mynetPlus(a, b, res)\n    go mynetMinus(c, d, res)\n\n    a &lt;- 5\n    c &lt;- 5\n    d &lt;- 7\n    //a &lt;- 5\n    b &lt;- 7\n    fmt.Println(&lt;-res)\n    fmt.Println(&lt;-res)\n}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 5170386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/466c83e0b71e3c2d82c3551088c6506c?s=128&d=identicon&r=PG&f=1", "display_name": "Brian Candler", "link": "https://stackoverflow.com/users/5170386/brian-candler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1438192782, "creation_date": 1438190601, "question_id": 31707158, "link": "https://stackoverflow.com/questions/31707158/checking-for-simultaneous-channels-ready-in-go", "title": "Checking for simultaneous channels ready in go", "body": "<p>I would like to know if the go language allows checking for multiple channels being ready <strong>at the same time</strong>.</p>\n\n<p>Here is a somewhat contrived example of what I'm trying to do. (The actual reason is to see if I can implement petrinets natively in go)</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc mynet(a, b, c, d &lt;-chan int, res chan&lt;- int) {\n    for {\n        select {\n        case v1, v2 := &lt;-a, &lt;-b:\n            res &lt;- v1+v2\n        case v1, v2 := &lt;-c, &lt;-d:\n            res &lt;- v1-v2\n        }\n    }\n}\n\nfunc main() {\n        a := make(chan int)\n        b := make(chan int)\n        c := make(chan int)\n        d := make(chan int)\n        res := make(chan int, 10)\n        go mynet(a, b, c, d, res)\n\n        a &lt;- 5\n        c &lt;- 5\n        d &lt;- 7\n        b &lt;- 7\n        fmt.Println(&lt;-res)\n        fmt.Println(&lt;-res)\n}\n</code></pre>\n\n<p>This doesn't compile as shown. It can be made to compile by only checking one channel, but then it can trivially deadlock if that channel is ready but the other one is not.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc mynet(a, b, c, d &lt;-chan int, res chan&lt;- int) {\n    for {\n        select {\n        case v1 := &lt;-a:\n            v2 := &lt;-b\n            res &lt;- v1+v2\n        case v1 := &lt;-c:\n            v2 := &lt;-d\n            res &lt;- v1-v2\n        }\n    }\n}\n\nfunc main() {\n        a := make(chan int)\n        b := make(chan int)\n        c := make(chan int)\n        d := make(chan int)\n        res := make(chan int, 10)\n        go mynet(a, b, c, d, res)\n\n        a &lt;- 5\n        c &lt;- 5\n        d &lt;- 7\n        //a &lt;- 5\n        b &lt;- 7\n        fmt.Println(&lt;-res)\n        fmt.Println(&lt;-res)\n}\n</code></pre>\n\n<p>In the general case, I might have multiple cases waiting on the same channel, e.g.</p>\n\n<pre><code>case v1, v2 := &lt;-a, &lt;-b:\n...\ncase v1, v2 := &lt;-a, &lt;-c:\n...\n</code></pre>\n\n<p>so I can't commit to either branch when a value is ready on channel a: only when all values are ready.</p>\n"}, {"tags": ["performance", "dictionary", "go", "slice", "sparse-matrix"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 6, "creation_date": 1438190819, "post_id": 31707064, "comment_id": 51352733, "body": "Why <i>would&#39;t</i> iterating over a map being considerably slower? A slice is just contiguous memory, whereas a hashmap is a much more complex data structure."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438190821, "post_id": 31707064, "comment_id": 51352736, "body": "Well the obvious answer is that the underlying structures are an array and a hash table. In the one case you&#39;re iterating the keys and also (in the range abstraction) accessing the value for each. In the other you&#39;re walking over a continuous block of memory."}, {"owner": {"reputation": 140828, "user_id": 89771, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/be9e4cbcfa96b7e4ad4bc28c88cfdb2b?s=128&d=identicon&r=PG", "display_name": "Alix Axel", "link": "https://stackoverflow.com/users/89771/alix-axel"}, "edited": false, "score": 0, "creation_date": 1438782487, "post_id": 31707064, "comment_id": 51590684, "body": "Related discussion: <a href=\"https://code.google.com/p/go/issues/detail?id=3885\" rel=\"nofollow noreferrer\">code.google.com/p/go/issues/detail?id=3885</a>"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1438191882, "post_id": 31707228, "comment_id": 51353306, "body": "Hash tables are considered <code>O(1)</code>, but have a higher constant than an array. Time complexity for indexing an array is properly classified as <code>\u0398(1)</code> (big theta)."}, {"owner": {"reputation": 3493, "user_id": 4270992, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JZTDS.jpg?s=128&g=1", "display_name": "Nick", "link": "https://stackoverflow.com/users/4270992/nick"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438196389, "post_id": 31707228, "comment_id": 51355990, "body": "Thanks I&#39;ve edited that. It&#39;s been a while and I&#39;m quite fuzzy, but that&#39;s completely correct."}], "tags": [], "owner": {"reputation": 3493, "user_id": 4270992, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JZTDS.jpg?s=128&g=1", "display_name": "Nick", "link": "https://stackoverflow.com/users/4270992/nick"}, "is_accepted": true, "score": 18, "last_activity_date": 1438196421, "last_edit_date": 1438196421, "creation_date": 1438190833, "answer_id": 31707228, "question_id": 31707064, "link": "https://stackoverflow.com/questions/31707064/why-is-iterating-over-a-map-so-much-slower-than-iterating-over-a-slice-in-golang/31707228#31707228", "title": "Why is iterating over a map so much slower than iterating over a slice in Golang?", "body": "<p>This comes down to the representation in memory. How familiar are you with the representation of different data structures and the concept of algorithmic complexity? Iterating over an array or slice is simple. Values are contiguous in memory. However iterating over a map requires traversing the key space and doing lookups into the hash-table structure. </p>\n\n<p>The dynamic ability of maps to insert keys of any value without using up tons of space allocating a sparse array, and the fact that look-ups can be done efficiently over the key space despite being not as fast as an array, are why hash tables are sometimes preferred over an array, although arrays (and slices) have a faster \"constant\" <code>(O(1))</code> lookup time given an index.</p>\n\n<p>It all comes down to whether you need the features of this or that data structure and whether you're willing to deal with the side-effects or gotchas involved.</p>\n"}, {"comments": [{"owner": {"reputation": 3493, "user_id": 4270992, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JZTDS.jpg?s=128&g=1", "display_name": "Nick", "link": "https://stackoverflow.com/users/4270992/nick"}, "edited": false, "score": 1, "creation_date": 1438205866, "post_id": 31707310, "comment_id": 51361173, "body": "This is a great answer and deals more with the specific golang details."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 5, "last_activity_date": 1438191113, "creation_date": 1438191113, "answer_id": 31707310, "question_id": 31707064, "link": "https://stackoverflow.com/questions/31707064/why-is-iterating-over-a-map-so-much-slower-than-iterating-over-a-slice-in-golang/31707310#31707310", "title": "Why is iterating over a map so much slower than iterating over a slice in Golang?", "body": "<p>Seems reasonable to put my comment as an answer. The underlying structures who's iteration performance you're comparing are a hash table and an array (<a href=\"https://en.wikipedia.org/wiki/Hash_table\" rel=\"noreferrer\">https://en.wikipedia.org/wiki/Hash_table</a> vs <a href=\"https://en.wikipedia.org/wiki/Array_data_structure\" rel=\"noreferrer\">https://en.wikipedia.org/wiki/Array_data_structure</a>). The range abstraction is actually (speculation, can't find the code) iterating all the keys, accessing each value, and assigning the two to <code>k,v :=</code>. If you're not familiar with accessing in the array it is constant time because you just add sizeof(type)*i to the starting pointer to get the item. I don't know what the internals of map are in golang but I know enough to know that it's memory representation and therefor access is nothing close that efficient.</p>\n\n<p>The specs statement on the topic isn't much; <a href=\"http://golang.org/ref/spec#For_statements\" rel=\"noreferrer\">http://golang.org/ref/spec#For_statements</a></p>\n\n<p>If I find the time to look up the implementation of range for map and slice/array I will and put some more technical details.</p>\n"}], "owner": {"reputation": 140828, "user_id": 89771, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/be9e4cbcfa96b7e4ad4bc28c88cfdb2b?s=128&d=identicon&r=PG", "display_name": "Alix Axel", "link": "https://stackoverflow.com/users/89771/alix-axel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7415, "favorite_count": 5, "accepted_answer_id": 31707228, "answer_count": 2, "score": 11, "last_activity_date": 1438196421, "creation_date": 1438190282, "question_id": 31707064, "link": "https://stackoverflow.com/questions/31707064/why-is-iterating-over-a-map-so-much-slower-than-iterating-over-a-slice-in-golang", "title": "Why is iterating over a map so much slower than iterating over a slice in Golang?", "body": "<p>I was implementing a sparse matrix using a map in Golang and I noticed that my code started taking much longer to complete after this change, after dismissing other possible causes, seems that the culprit is the iteration on the map itself. <a href=\"http://play.golang.org/p/rMOnwLjMwU\" rel=\"noreferrer\">Go Playground link</a> (doesn't work for some reason).</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"math\"\n)\n\nfunc main() {\n    z := 50000000\n    a := make(map[int]int, z)\n    b := make([]int, z)\n\n    for i := 0; i &lt; z; i++ {\n        a[i] = i\n        b[i] = i\n    }\n\n    t0 := time.Now()\n    for key, value := range a {\n        if key != value { // never happens\n            fmt.Println(\"a\", key, value)\n        }\n    }\n    d0 := time.Now().Sub(t0)\n\n    t1 := time.Now()\n    for key, value := range b {\n        if key != value { // never happens\n            fmt.Println(\"b\", key, value)\n        }\n    }\n    d1 := time.Now().Sub(t1)\n\n    fmt.Println(\n        \"a:\", d0,\n        \"b:\", d1,\n        \"diff:\", math.Max(float64(d0), float64(d1)) / math.Min(float64(d0), float64(d1)),\n    )\n}\n</code></pre>\n\n<p>Iterating over 50M items returns the following timings:</p>\n\n<pre><code>alix@local:~/Go/src$ go version\ngo version go1.3.3 linux/amd64\nalix@local:~/Go/src$ go run b.go \na: 1.195424429s b: 68.588488ms diff: 17.777154632611037\n</code></pre>\n\n<p>I wonder, why is iterating over a map almost 20x as slow when compared to a slice?</p>\n"}, {"tags": ["logging", "go"], "answers": [{"comments": [{"owner": {"reputation": 1368, "user_id": 1599940, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/7KpaW.png?s=128&g=1", "display_name": "rootatdarkstar", "link": "https://stackoverflow.com/users/1599940/rootatdarkstar"}, "edited": false, "score": 0, "creation_date": 1438191814, "post_id": 31707044, "comment_id": 51353265, "body": "So fast. Thank you! :)"}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 32, "last_activity_date": 1438190207, "creation_date": 1438190207, "answer_id": 31707044, "question_id": 31706893, "link": "https://stackoverflow.com/questions/31706893/golang-microseconds-in-log-package/31707044#31707044", "title": "Golang microseconds in log package", "body": "<p>Change the log flags to add microseconds. Available flags are there: <a href=\"http://golang.org/pkg/log/#pkg-constants\" rel=\"noreferrer\">http://golang.org/pkg/log/#pkg-constants</a></p>\n\n<pre><code>log.SetFlags(log.LstdFlags | log.Lmicroseconds)\nlog.Print(\"Hello, playground\")\n// 2009/11/10 23:00:00.000000 Hello, playground\n</code></pre>\n"}], "owner": {"reputation": 1368, "user_id": 1599940, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/7KpaW.png?s=128&g=1", "display_name": "rootatdarkstar", "link": "https://stackoverflow.com/users/1599940/rootatdarkstar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5047, "favorite_count": 1, "accepted_answer_id": 31707044, "answer_count": 1, "score": 14, "last_activity_date": 1438190207, "creation_date": 1438189769, "question_id": 31706893, "link": "https://stackoverflow.com/questions/31706893/golang-microseconds-in-log-package", "title": "Golang microseconds in log package", "body": "<p>Golang have standard log package.\nIs there a way to put mircoseconds to its output?</p>\n\n<p>Standard code puts pretty useless timestamp with second precision:</p>\n\n<pre><code>log.Println(\"Starting app on\", APP_PORT)\n\n2015/07/29 19:28:32 Starting app on :9090\n</code></pre>\n"}, {"tags": ["macos", "go"], "answers": [{"comments": [{"owner": {"reputation": 5501, "user_id": 1491531, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/13409f124d810d9c0e92d30a9364105a?s=128&d=identicon&r=PG&f=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/1491531/anton"}, "edited": false, "score": 0, "creation_date": 1438204038, "post_id": 31709336, "comment_id": 51360302, "body": "Good idea. For some reason the framework flag doesn&#39;t seem to be recoginzed for me though..  &quot;/usr/local/Cellar/go/1.4/libexec/pkg/tool/darwin_amd64/6l: unknown flag -framework&quot;"}, {"owner": {"reputation": 3027, "user_id": 560382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1741fdf36945df8f3e26c4f1abd24cad?s=128&d=identicon&r=PG", "display_name": "Alvivi", "link": "https://stackoverflow.com/users/560382/alvivi"}, "reply_to_user": {"reputation": 5501, "user_id": 1491531, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/13409f124d810d9c0e92d30a9364105a?s=128&d=identicon&r=PG&f=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/1491531/anton"}, "edited": false, "score": 1, "creation_date": 1438204444, "post_id": 31709336, "comment_id": 51360525, "body": "There are problems with brew installation, read this <a href=\"http://stackoverflow.com/a/25095603/560382\">stackoverflow.com/a/25095603/560382</a> Try uninstall go, and re-install it from the oficial osx installer (or source code)"}, {"owner": {"reputation": 5501, "user_id": 1491531, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/13409f124d810d9c0e92d30a9364105a?s=128&d=identicon&r=PG&f=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/1491531/anton"}, "edited": false, "score": 0, "creation_date": 1438209538, "post_id": 31709336, "comment_id": 51362664, "body": "Actually, re-installing Go from the official package solved the issue for me. I didn&#39;t get the -framework flag to work, but I didn&#39;t need it. Goose builds fine now. Thanks a lot, mate!"}], "tags": [], "owner": {"reputation": 3027, "user_id": 560382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1741fdf36945df8f3e26c4f1abd24cad?s=128&d=identicon&r=PG", "display_name": "Alvivi", "link": "https://stackoverflow.com/users/560382/alvivi"}, "is_accepted": true, "score": 1, "last_activity_date": 1438197715, "creation_date": 1438197715, "answer_id": 31709336, "question_id": 31706329, "link": "https://stackoverflow.com/questions/31706329/go-how-to-explicitly-link-to-os-x-frameworks-when-building/31709336#31709336", "title": "Go: How to explicitly link to OS X frameworks when building?", "body": "<p>You can pass <code>go build</code> flags to <code>go get</code>. So:</p>\n\n<pre><code>go get -f -u -ldflags \"-framework Security\" bitbucket.org/liamstask/goose/cmd/goose\n</code></pre>\n\n<p>will force the download and link against Security framework.</p>\n"}], "owner": {"reputation": 5501, "user_id": 1491531, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/13409f124d810d9c0e92d30a9364105a?s=128&d=identicon&r=PG&f=1", "display_name": "Anton", "link": "https://stackoverflow.com/users/1491531/anton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 381, "favorite_count": 0, "accepted_answer_id": 31709336, "answer_count": 1, "score": 1, "last_activity_date": 1438197715, "creation_date": 1438187979, "question_id": 31706329, "link": "https://stackoverflow.com/questions/31706329/go-how-to-explicitly-link-to-os-x-frameworks-when-building", "title": "Go: How to explicitly link to OS X frameworks when building?", "body": "<p>When trying to get and build goose on OS X 10.10.3 using <code>go get bitbucket.org/liamstask/goose/cmd/goose</code> I get this error:</p>\n\n<pre><code>Undefined symbols for architecture x86_64:\n\"_SecKeychainItemExport\", referenced from:\n  _FetchPEMRoots in 000001.o\n\"_SecTrustCopyAnchorCertificates\", referenced from:\n  _FetchPEMRoots in 000001.o\nld: symbol(s) not found for architecture x86_64\n</code></pre>\n\n<p>I figure this error being due to the Security framework in OS X not being linked. Some possibly related info here: <a href=\"https://github.com/golang/go/issues/11258\" rel=\"nofollow\">https://github.com/golang/go/issues/11258</a></p>\n\n<p>So, how can I link to this library explicitly? Or is there something else I am missing?</p>\n\n<p>Thankful for help!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438187513, "post_id": 31706145, "comment_id": 51350709, "body": "Can you post your defered recover? That&#39;s certainly how you do it... My guess without seeing your code is that you return in your recover and removing the return statement will give you the expected results. Also, until you provide the information necessary to answer your question I&#39;d just recommend reading this; <a href=\"http://blog.golang.org/defer-panic-and-recover\" rel=\"nofollow noreferrer\">blog.golang.org/defer-panic-and-recover</a>"}, {"owner": {"reputation": 1689, "user_id": 3791027, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a240d8bb3d536a1ecc16adf28f7b1feb?s=128&d=identicon&r=PG&f=1", "display_name": "RockNinja", "link": "https://stackoverflow.com/users/3791027/rockninja"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438187734, "post_id": 31706145, "comment_id": 51350838, "body": "@evanmcdonnal have a look now, thx"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438188704, "post_id": 31706145, "comment_id": 51351416, "body": "Thank you, I&#39;ve tried to explain why your code isn&#39;t working as expected now :D"}], "answers": [{"tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 3, "last_activity_date": 1438188481, "creation_date": 1438188481, "answer_id": 31706485, "question_id": 31706145, "link": "https://stackoverflow.com/questions/31706145/testing-recover-from-panic/31706485#31706485", "title": "Testing recover from panic", "body": "<p>I would say that designing API for library that relies on panic/recover is not a right way. Go has error pattern so if the method New cannot test, it can return the status instead.</p>\n\n<pre><code>package testing\n\ntype test {\n  url string\n}\n\nfunc New(ops map[string]string) (*test, bool) {\n  if ops[\"url\"] == \"\" {\n    return nil, false\n  }\n  var t = new(test)\n  t.url = ops[\"url\"]\n  return t, true\n}\n</code></pre>\n\n<p>and then</p>\n\n<pre><code>for _, e := range testingTest {\n  url, ok := New(e)\n  if ok {\n    url.hasUrl(t, e[\"url\"])\n  }\n}\n</code></pre>\n\n<p>If you insist on using <code>panic</code>, then you can wrap the invocation into function and recover in it. But then you still would need to provide the status to the caller.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc test(e int) {\n    if e == 2 {\n        panic(\"panic!\")\n    }\n}\n\nfunc main() {\n    for _, e := range []int{1, 2, 3} {\n        func() {\n            defer func() { recover() }()\n            test(e)\n            fmt.Println(\"testing\", e)\n        }()\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1689, "user_id": 3791027, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a240d8bb3d536a1ecc16adf28f7b1feb?s=128&d=identicon&r=PG&f=1", "display_name": "RockNinja", "link": "https://stackoverflow.com/users/3791027/rockninja"}, "edited": false, "score": 0, "creation_date": 1438242705, "post_id": 31706515, "comment_id": 51373215, "body": "Having my recover into the methods, doesn&#39;t really work"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 1689, "user_id": 3791027, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a240d8bb3d536a1ecc16adf28f7b1feb?s=128&d=identicon&r=PG&f=1", "display_name": "RockNinja", "link": "https://stackoverflow.com/users/3791027/rockninja"}, "edited": false, "score": 0, "creation_date": 1438271272, "post_id": 31706515, "comment_id": 51392599, "body": "@alex but why doesn&#39;t it work? Are you saying your design doesn&#39;t allow for it? That is how panic/recover works..."}, {"owner": {"reputation": 1689, "user_id": 3791027, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a240d8bb3d536a1ecc16adf28f7b1feb?s=128&d=identicon&r=PG&f=1", "display_name": "RockNinja", "link": "https://stackoverflow.com/users/3791027/rockninja"}, "edited": false, "score": 0, "creation_date": 1438274133, "post_id": 31706515, "comment_id": 51394387, "body": "by having the recover in the methods only, I&#39;m not able to recover(I get the panic error and my tests stop). But by using @AlexAtNet solution works fine."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 1689, "user_id": 3791027, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a240d8bb3d536a1ecc16adf28f7b1feb?s=128&d=identicon&r=PG&f=1", "display_name": "RockNinja", "link": "https://stackoverflow.com/users/3791027/rockninja"}, "edited": false, "score": 0, "creation_date": 1438274615, "post_id": 31706515, "comment_id": 51394671, "body": "@alex oh yeah, sorry my example is kind of misleading because I put the recover in the other method (which is irrelevant here). Going by what I said above the recover would actually be in <code>New</code> however wrapping the internals of your loop in a closure as AlexAtNet has is probably more reasonable in your contrived example (doesn&#39;t make a whole lot of sense to recover in a method where you explicitly paniced). Putting recover in <code>hasUrl</code> does nothing in this case because the panic results from new and execution never reaches there. I&#39;ll edit with an example of what the body of new would be."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 2, "last_activity_date": 1438274851, "last_edit_date": 1438274851, "creation_date": 1438188567, "answer_id": 31706515, "question_id": 31706145, "link": "https://stackoverflow.com/questions/31706145/testing-recover-from-panic/31706515#31706515", "title": "Testing recover from panic", "body": "<p>There are a few small problems with your implementation. For one, you can't even be sure you <em>have recovered</em> because you're calling the method but ignoring the return value. So for starters lets convert this;</p>\n\n<pre><code>func NewTest(t *testing.T) {\n  defer func() {\n    recover()\n  }()\n\n  for _, e := range testingTest {\n    url := New(e)\n    url.hasUrl(t, e[\"url\"])\n  }\n}\n</code></pre>\n\n<p>to this;</p>\n\n<pre><code>func NewTest(t *testing.T) {\n  defer func() {\n    if r := recover(); r != nil {\n            fmt.Println(\"Recovered in NewTest\", r)\n        }\n  }()\n\n  for _, e := range testingTest {\n    url := New(e)\n    url.hasUrl(t, e[\"url\"])\n  }\n}\n</code></pre>\n\n<p>Now the other problem... You're using defer wrong. You defer at the top of <code>NewTest</code> meaning when it is called, you're about to exit new test. Instead you want it in the method that is panicing. It's too late to recover and continue iteration at the point you have it now. When you recover it's at the place where NewTest was called. So this should do it;</p>\n\n<pre><code>func (s *test) hasUrl(t *testing.T, u string) {\n  defer func() {\n        if r := recover(); r != nil {\n                fmt.Println(\"Recovered in NewTest\", r)\n            }\n      }()\n  if s.url != u {\n    t.Errorf(\"Expected %s to be equal with %s\", s.url, u)\n  }\n}\n</code></pre>\n\n<p>I made a quick sample problem to demonstrate this. Move the defer/recover into NewTest and you will find it only prints once, in the current form it prints 10 times because when I recover, I'm still inside the loop. <a href=\"https://play.golang.org/p/ZA1Ijvsimz\" rel=\"nofollow\">https://play.golang.org/p/ZA1Ijvsimz</a></p>\n\n<p>EDIT: Sorry my example was a bit misleading because I moved the panic/recover bits into <code>hasUrl</code> when I was copying bits of your code into the playground. In your case it would actually be this;</p>\n\n<pre><code>func New(ops map[string]string) *test {\n  defer func() {\n       if r := recover(); r != nil {\n             fmt.Println(\"Recovered while panicing in New\")\n       }\n  }\n  if ops[\"url\"] == \"\" {\n    panic(\"Url missing\")\n  }\n  var t = new(test)\n  t.url = ops[\"url\"]\n  return t\n}\n</code></pre>\n\n<p>Of course that example is pretty contrived and doesn't make a whole log of sense. If you're explicitly panicing, I'd say the calling scope should be the one using recover, if you're calling a library which panics, then you should be the one using recover.</p>\n"}, {"tags": [], "owner": {"reputation": 1287, "user_id": 106275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/43vfP.png?s=128&g=1", "display_name": "Stein", "link": "https://stackoverflow.com/users/106275/stein"}, "is_accepted": false, "score": 0, "last_activity_date": 1471613954, "creation_date": 1471613954, "answer_id": 39040511, "question_id": 31706145, "link": "https://stackoverflow.com/questions/31706145/testing-recover-from-panic/39040511#39040511", "title": "Testing recover from panic", "body": "<p>I'm confused by the words in the question, but I think it started with the same concern I had. You have defined a function to panic when a precondition is violated, rather than an alternative (returning an error, using defaults, doing nothing...); just like the reasonable choice made for arrays:</p>\n\n<pre><code>var a [1]int\na[1] = 0 // panic\n</code></pre>\n\n<p>Sometimes you want to write a test that proves a precondition violation causes a panic and is not swept under the rug. The previous answers aren't quite complete, so this is what I got to:</p>\n\n<pre><code>func GreatBigFunction(url string) {\n    if url == \"\" {\n        panic(\"panic!\")\n    }\n}\n\nfunc main() {\n    var tests = []struct {\n        url       string\n        completes bool\n    }{\n        {\"a\", true},\n        {\"\", false},\n        {\"b\", true},\n        {\"c\", false}, // wrong expectation\n        {\"\", true},   // wrong expectation\n    }\n    for _, test := range tests {\n        fmt.Printf(\"testing that \\\"%s\\\" %s\\n\", test.url, map[bool]string{false: \"panics\", true: \"completes\"}[test.completes])\n        func() {\n            if !test.completes {\n                defer func() {\n                    p := recover()\n                    if p == nil {\n                        fmt.Println(\"t.Fail: should have panicked\")\n                    }\n                }()\n            }\n            GreatBigFunction(test.url)\n        }()\n    }\n\n    fmt.Println(\"Bye\")\n}\n</code></pre>\n\n<p>The last test case checks that the normal panic handling prevails if the test case says the function isn't supposed to panic.</p>\n\n<p>Same code is <a href=\"https://play.golang.org/p/HaEMxbw425\" rel=\"nofollow\">on Playground</a>. It's also possible to <a href=\"https://play.golang.org/p/pbYBH_dnv0\" rel=\"nofollow\">ignore the return value of <code>recover</code></a> but still reliably report a missed <code>panic</code>.</p>\n"}], "owner": {"reputation": 1689, "user_id": 3791027, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a240d8bb3d536a1ecc16adf28f7b1feb?s=128&d=identicon&r=PG&f=1", "display_name": "RockNinja", "link": "https://stackoverflow.com/users/3791027/rockninja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2246, "favorite_count": 0, "accepted_answer_id": 31706485, "answer_count": 3, "score": 2, "last_activity_date": 1471613954, "creation_date": 1438187341, "last_edit_date": 1438187717, "question_id": 31706145, "link": "https://stackoverflow.com/questions/31706145/testing-recover-from-panic", "title": "Testing recover from panic", "body": "<p>I want to test a constructor, but in case some data is not provided I need to panic, how can I recover from that panic in testing?</p>\n\n<p>At the moment I've added in my TestNew func a defer with recover, but in case an element from my map has an empty URL the rest will not be checked.</p>\n\n<p>t.go</p>\n\n<pre><code>package testing\n\ntype test {\n  url string\n}\n\nfunc New(ops map[string]string) *test {\n  if ops[\"url\"] == \"\" {\n    panic(\"Url missing\")\n  }\n  var t = new(test)\n  t.url = ops[\"url\"]\n  return t\n}\n</code></pre>\n\n<p>t_test.go</p>\n\n<pre><code>package testing\n\ntype testTest map[string]string\nvar testingTest = []testTest {\n  testTest {\n    \"url\": \"test\",\n  },\n  testTest{\n    \"url\": \"\",\n  },\n}\n\nfunc NewTest(t *testing.T) {\n  defer func() {\n    recover()\n  }()\n\n  for _, e := range testingTest {\n    url := New(e)\n    url.hasUrl(t, e[\"url\"])\n  }\n}\n\nfunc (s *test) hasUrl(t *testing.T, u string) {\n  if s.url != u {\n    t.Errorf(\"Expected %s to be equal with %s\", s.url, u)\n  }\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 5170195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7ccf818065ab43c41c1b79e277fbc09?s=128&d=identicon&r=PG&f=1", "display_name": "AvidAppleEater", "link": "https://stackoverflow.com/users/5170195/avidappleeater"}, "edited": false, "score": 0, "creation_date": 1438194162, "post_id": 31706613, "comment_id": 51354693, "body": "That did the trick, thanks. I think it&#39;s confusing that mgo uses the terms &quot;safety mode&quot; and &quot;consistency mode&quot; to refer to write concern and read preference, respectively."}, {"owner": {"reputation": 18455, "user_id": 2657550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88d553accfca32636d96a8d5075e85d1?s=128&d=identicon&r=PG", "display_name": "Gustavo Niemeyer", "link": "https://stackoverflow.com/users/2657550/gustavo-niemeyer"}, "reply_to_user": {"reputation": 3, "user_id": 5170195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7ccf818065ab43c41c1b79e277fbc09?s=128&d=identicon&r=PG&f=1", "display_name": "AvidAppleEater", "link": "https://stackoverflow.com/users/5170195/avidappleeater"}, "edited": false, "score": 1, "creation_date": 1438232098, "post_id": 31706613, "comment_id": 51368282, "body": "It&#39;s the price of having these available years before these terms even existed."}], "tags": [], "owner": {"reputation": 18455, "user_id": 2657550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88d553accfca32636d96a8d5075e85d1?s=128&d=identicon&r=PG", "display_name": "Gustavo Niemeyer", "link": "https://stackoverflow.com/users/2657550/gustavo-niemeyer"}, "is_accepted": true, "score": 1, "last_activity_date": 1438188839, "creation_date": 1438188839, "answer_id": 31706613, "question_id": 31706017, "link": "https://stackoverflow.com/questions/31706017/set-mongodb-write-concern-through-mgo-driver/31706613#31706613", "title": "Set MongoDB write concern through mgo driver", "body": "<p>This is what you are looking for (<a href=\"http://gopkg.in/mgo.v2#Session.SetSafe\" rel=\"nofollow\">full documentation</a>):</p>\n\n<pre><code>session.SetSafe(&amp;mgo.Safe{WMode: \"majority\"})\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 5170195, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7ccf818065ab43c41c1b79e277fbc09?s=128&d=identicon&r=PG&f=1", "display_name": "AvidAppleEater", "link": "https://stackoverflow.com/users/5170195/avidappleeater"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1637, "favorite_count": 0, "accepted_answer_id": 31706613, "answer_count": 1, "score": 0, "last_activity_date": 1438191014, "creation_date": 1438186899, "last_edit_date": 1438191014, "question_id": 31706017, "link": "https://stackoverflow.com/questions/31706017/set-mongodb-write-concern-through-mgo-driver", "title": "Set MongoDB write concern through mgo driver", "body": "<p>I have a Go client that repeatedly inserts data into <strong>MongoDB</strong> for 1 minute. I don't want the writes to be acknowledged to the client until they are replicated to the secondary of my primary-secondary-arbiter replica set, so I specified <strong>majority</strong> write concern through the <strong>mongo</strong> shell.</p>\n\n<p>However, the client's execution completes far ahead of the writes being replicated to the secondary (I'm watching the doc count to be sure). If the primary were to crash before the replication is done, data would be rolled back that--from the client's perspective--had already been acknowledged.</p>\n\n<p>Doesn't this behavior contradict the majority write concern I set through the shell? Do I also need to set the write concern through the mgo driver? This article suggests I need to: </p>\n\n<p><strong><a href=\"http://blog.mongodb.org/post/80579086742/running-mongodb-queries-concurrently-with-go\" rel=\"nofollow\">Running MongoDB Queries Concurrently With Go</a></strong></p>\n\n<blockquote>\n  <p>We use the <code>mgo.DialWithInfo</code> method to create a <code>mgo.Session</code> object. Each session specifies a Strong or Monotonic mode, and other settings such as write concern and read preference.</p>\n</blockquote>\n\n<p>But I don't see anything in the <code>mgo</code> driver docs about setting write concern. What am I missing?</p>\n"}, {"tags": ["reflection", "struct", "go"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1438221800, "post_id": 31705784, "comment_id": 51365675, "body": "seems you need a ORM package."}, {"owner": {"reputation": 362, "user_id": 5036657, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/08b40ac61c1cdffefa72dab69466ea60?s=128&d=identicon&r=PG&f=1", "display_name": "SivanBH", "link": "https://stackoverflow.com/users/5036657/sivanbh"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1438240237, "post_id": 31705784, "comment_id": 51371722, "body": "I&#39;m not sure that&#39;s the solution. Everything is decoded as a string, which means I need to convert these strings to their corresponding columns&#39; data types before passing them to the query builder (I&#39;m using squirrel to create Cassandra queries - CQL)"}], "answers": [{"comments": [{"owner": {"reputation": 362, "user_id": 5036657, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/08b40ac61c1cdffefa72dab69466ea60?s=128&d=identicon&r=PG&f=1", "display_name": "SivanBH", "link": "https://stackoverflow.com/users/5036657/sivanbh"}, "edited": false, "score": 0, "creation_date": 1438197572, "post_id": 31705872, "comment_id": 51356660, "body": "I&#39;m sorry, I don&#39;t quite follow. Should the <code>dataType</code> field be a string or a <code>reflect.Type</code>? If it is a <code>reflect.Type</code>, then how do I enter an int type, for example? If it is a string, is there a function which converts using strings to represent the desired type?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 362, "user_id": 5036657, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/08b40ac61c1cdffefa72dab69466ea60?s=128&d=identicon&r=PG&f=1", "display_name": "SivanBH", "link": "https://stackoverflow.com/users/5036657/sivanbh"}, "edited": false, "score": 0, "creation_date": 1438203552, "post_id": 31705872, "comment_id": 51360036, "body": "@SivanBH <code>dataType</code> should be a <code>reflect.Type</code>. For any instance <code>i</code> (of any type) you can get it&#39;s type with <code>reflect.TypeOf</code>. I&#39;ll edit with a sample of a model that I think would be more reasonable. I&#39;m going to have all the fields exported, you can change that to suite your needs."}, {"owner": {"reputation": 362, "user_id": 5036657, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/08b40ac61c1cdffefa72dab69466ea60?s=128&d=identicon&r=PG&f=1", "display_name": "SivanBH", "link": "https://stackoverflow.com/users/5036657/sivanbh"}, "edited": false, "score": 0, "creation_date": 1438240857, "post_id": 31705872, "comment_id": 51372130, "body": "This is as far as I&#39;ve gotten as well, but it doesn&#39;t seem to work. If, for example, <code>DataType</code> should be int, I use <code>reflect.Int</code>, but that&#39;s not actually a <code>reflect.Type</code>, but a <code>reflect.Kind</code>. And either way, the conversion method provided by reflect only works as a method implemented by <code>reflect.Value</code>. What am I missing here?"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 4, "last_activity_date": 1438203799, "last_edit_date": 1438203799, "creation_date": 1438186482, "answer_id": 31705872, "question_id": 31705784, "link": "https://stackoverflow.com/questions/31705784/hold-a-type-in-a-golang-struct-field/31705872#31705872", "title": "Hold a type in a Golang struct field", "body": "<p>You're on the right track I suppose. In your <code>Column</code> struct you're looking for <code>reflect.Type</code>. Which you'll get with <code>import \"reflect\"</code>.</p>\n\n<p>If your column struct contains the type name and value (as a raw string) you should be able to write method that switches on type and produces a value of the correct type for each case. Brief reference for switches here; <a href=\"https://golang.org/doc/effective_go.html#switch\" rel=\"noreferrer\">https://golang.org/doc/effective_go.html#switch</a></p>\n\n<pre><code>type Column struct {\n    Name string\n    DataType reflect.Type\n    TypedValue interface{}\n    StringValue string\n}\n</code></pre>\n\n<p>Because you said \"but ints, floats and timestamps are identical in the JSON array\" I'm assuming all the values in your json are technically strings (meaning they're all quoted). You may not need all those fields but the idea is to have the type information coupled with the properties name and the original value. If you use the field of type <code>interface{}</code> you can assign anything to it so you could hold the original json data (name and value) as well as the type information and the value in a sensible Go type in an instance of this struct pretty easily.</p>\n"}, {"comments": [{"owner": {"reputation": 3971, "user_id": 2840714, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/s9vli.jpg?s=128&g=1", "display_name": "ChuckCottrill", "link": "https://stackoverflow.com/users/2840714/chuckcottrill"}, "edited": false, "score": 0, "creation_date": 1594239833, "post_id": 31769896, "comment_id": 111060789, "body": "This put me on the right track. I have a struct member of type reflect.Type, and assign it the value reflect.TypeOf(variable)."}], "tags": [], "owner": {"reputation": 362, "user_id": 5036657, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/08b40ac61c1cdffefa72dab69466ea60?s=128&d=identicon&r=PG&f=1", "display_name": "SivanBH", "link": "https://stackoverflow.com/users/5036657/sivanbh"}, "is_accepted": true, "score": 2, "last_activity_date": 1438503431, "creation_date": 1438503431, "answer_id": 31769896, "question_id": 31705784, "link": "https://stackoverflow.com/questions/31705784/hold-a-type-in-a-golang-struct-field/31769896#31769896", "title": "Hold a type in a Golang struct field", "body": "<p>I attempted to use the solution offered by @evanmcdonnal but I could not find a generic way of converting <code>float64</code> (which is the type <code>json.Unmarshal</code> gives to any number it unmarshals from the json array) to any data type found in the DB (<code>timestamp</code> proved to be a bit tricky, because <code>reflect.Value</code> does not export a conversion method to <code>time.Time</code>, which is the equivalent of Cassandra's <code>timestamp</code>).</p>\n\n<p>What did work was using a <code>typeConversion</code> field instead of a <code>dataType</code> field, that is, holding a function that converts to the distined column's type from the type <code>json.Unmarshal</code> sets the variable's type to.</p>\n\n<p>My struct, therefore, looks like this:</p>\n\n<pre><code>type Column struct {\n    name string\n    typeConversion func(reflect.Value) reflect.Value\n}\n</code></pre>\n\n<p>Some typeConversion functions I already have look like this:</p>\n\n<pre><code>func floatToTime(varFloat reflect.Value) reflect.Value {\n    timestamp := time.Unix(int64(varFloat.Float()), 0)\n    return reflect.ValueOf(timestamp)\n}\n\nfunc floatToInt(varFloat reflect.Value) reflect.Value {\n    return reflect.ValueOf(int(varFloat.Float()))\n}\n</code></pre>\n\n<p>This actually happens to be a very good solution, because it is extremely generic: the struct defines the way any conversion function should be built, which means I can wrap any form of conversion to fit this API, and because the return value is always <code>reflect.Value</code>, I can access the underlying value with the correct type by calling <code>Interface()</code>, like so:</p>\n\n<pre><code>// value is the data unmarshaled by json\n// I convert it to reflect.Value, then convert it again using my custom typeConversion\n// Then  I use Interface() to get the final value in the final (and column-appropriate) type\ncolumn.typeConversion(reflect.ValueOf(value)).Interface()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 362, "user_id": 5036657, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/08b40ac61c1cdffefa72dab69466ea60?s=128&d=identicon&r=PG&f=1", "display_name": "SivanBH", "link": "https://stackoverflow.com/users/5036657/sivanbh"}, "edited": false, "score": 0, "creation_date": 1438517849, "post_id": 31770726, "comment_id": 51474271, "body": "That&#39;s an interesting solution I haven&#39;t come across. It does not suit my needs though, because I am using maps to represent column-to-value&#39;s requested by the user."}], "tags": [], "owner": {"reputation": 436, "user_id": 478309, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0e42cd135cba45a460dbad590bf110a8?s=128&d=identicon&r=PG", "display_name": "Lei Cao", "link": "https://stackoverflow.com/users/478309/lei-cao"}, "is_accepted": false, "score": 0, "last_activity_date": 1438509648, "creation_date": 1438509648, "answer_id": 31770726, "question_id": 31705784, "link": "https://stackoverflow.com/questions/31705784/hold-a-type-in-a-golang-struct-field/31770726#31770726", "title": "Hold a type in a Golang struct field", "body": "<p>The <a href=\"http://golang.org/pkg/reflect/#StructTag\" rel=\"nofollow\">StructTag</a> should help: </p>\n\n<pre><code>type Table struct {\n    age int `sql:\"type:int;`\n    price float `sql:\"type:float;`\n}\n</code></pre>\n"}], "owner": {"reputation": 362, "user_id": 5036657, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/08b40ac61c1cdffefa72dab69466ea60?s=128&d=identicon&r=PG&f=1", "display_name": "SivanBH", "link": "https://stackoverflow.com/users/5036657/sivanbh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4284, "favorite_count": 0, "accepted_answer_id": 31769896, "answer_count": 3, "score": 3, "last_activity_date": 1474992360, "creation_date": 1438186246, "last_edit_date": 1474992360, "question_id": 31705784, "link": "https://stackoverflow.com/questions/31705784/hold-a-type-in-a-golang-struct-field", "title": "Hold a type in a Golang struct field", "body": "<p>I'm looking for a way to hold a type (maybe reflection.Type?) as a field in a custom struct. The reasoning behind this is that I'm decoding JSON arrays into structs from which I later build SQL queries, but ints, floats and timestamps are identical in the JSON array, though they are different when querying a database. This means I need to convert each value to its correct type before querying.</p>\n\n<p>I think the answer lies somewhere in the reflect package, but I haven't worked out exactly how to utilize it.</p>\n\n<p>What I'm hoping for is something like this:</p>\n\n<pre><code>type Column struct {\n    name string\n    dataType type\n}\nsomeColumn := Column {name: \"somecol\", dataType: int}\nconvertedVal := SomeConversionFunc(\"5\", someColumn.dataType)\n</code></pre>\n\n<p>Alternatively, this sort of thing could work as well:</p>\n\n<pre><code>type Column struct {\n    name string\n    dataType func()\n}\nsomeColumn := Column {name: \"somecol\", dataType: ConvertToInt}\nconvertedVal := someColumn.dataType(\"5\")\n</code></pre>\n\n<p>Any ideas?</p>\n"}, {"tags": ["php", "go", "gzip"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1438185708, "post_id": 31705449, "comment_id": 51349577, "body": "The marked question compares gzip results of <b>Java</b> and <b>Go</b> examples, but the reason is the same. Compression algorithms are not required to (and often they don&#39;t) generate the same result, even if the same app is run on the same input again. What matters is that when they are decompressed, it should give back the exact same result (the original input)."}, {"owner": {"reputation": 23833, "user_id": 2364629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4a0d66e90ed755f6dc96e201a784d5?s=128&d=identicon&r=PG", "display_name": "Orangepill", "link": "https://stackoverflow.com/users/2364629/orangepill"}, "edited": false, "score": 0, "creation_date": 1438185774, "post_id": 31705449, "comment_id": 51349619, "body": "Potentially the issue could be for different default values of the third parameter for gzcompress... try ZLIB_ENCODING_GZIP and ZLIB_ENCODING_RAW"}, {"owner": {"reputation": 86, "user_id": 2163393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Oefgh.jpg?s=128&g=1", "display_name": "ysqi", "link": "https://stackoverflow.com/users/2163393/ysqi"}, "edited": false, "score": 0, "creation_date": 1438215822, "post_id": 31705449, "comment_id": 51364295, "body": "thanks, i will check the app service , why cna&#39;t deccompressed"}, {"owner": {"reputation": 86, "user_id": 2163393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Oefgh.jpg?s=128&g=1", "display_name": "ysqi", "link": "https://stackoverflow.com/users/2163393/ysqi"}, "edited": false, "score": 0, "creation_date": 1438416149, "post_id": 31705449, "comment_id": 51452147, "body": "I have ask new question : <a href=\"http://stackoverflow.com/questions/31759354/php-cant-decompress-gzip-data-by-golang\">php can&#39;t decompress gzip data by golang</a>"}], "owner": {"reputation": 86, "user_id": 2163393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Oefgh.jpg?s=128&g=1", "display_name": "ysqi", "link": "https://stackoverflow.com/users/2163393/ysqi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 141, "favorite_count": 0, "closed_date": 1438185541, "answer_count": 0, "score": 0, "last_activity_date": 1438185371, "creation_date": 1438185371, "question_id": 31705449, "link": "https://stackoverflow.com/questions/31705449/why-golang-and-php-gzip-results-are-different", "closed_reason": "Duplicate", "title": "why golang and php gzip results are different", "body": "<p>I need gzip data in golang ,and post it to other API Service (wirte with php),but API Server can't ungzip ,why?</p>\n\n<p>why golang and php gzip results are different ?\n thanks in advance</p>\n\n<p><strong>gzip string \"1\" :</strong></p>\n\n<ol>\n<li><p>golang  result :[31 139 8 0 0 9 110 136 2 255 50 4 0 0 0 255 255]</p></li>\n<li><p>php   result :[31 139 8 0 0 0 0 0 2 3 51 4 0 183 239 220 131 1 0 0 0 ]</p></li>\n</ol>\n\n<p><strong>see demo</strong></p>\n\n<ol>\n<li><a href=\"http://play.golang.org/p/Cm_4ox24NA\" rel=\"nofollow\">golang code</a></li>\n<li><a href=\"http://sandbox.onlinephpfunctions.com/code/96e3b0c09121442ec7e08abdfd0c204b8030ba63\" rel=\"nofollow\">php code</a></li>\n</ol>\n"}, {"tags": ["foreach", "go"], "comments": [{"owner": {"reputation": 24278, "user_id": 6013, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/2c21bed614c58c9e1c48fe272e79efd2?s=128&d=identicon&r=PG", "display_name": "Joshua", "link": "https://stackoverflow.com/users/6013/joshua"}, "edited": false, "score": 0, "creation_date": 1438185161, "post_id": 31705213, "comment_id": 51349219, "body": "If you show the person object, I may be able to give a better answer."}], "answers": [{"tags": [], "owner": {"reputation": 24278, "user_id": 6013, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/2c21bed614c58c9e1c48fe272e79efd2?s=128&d=identicon&r=PG", "display_name": "Joshua", "link": "https://stackoverflow.com/users/6013/joshua"}, "is_accepted": false, "score": 0, "last_activity_date": 1438185028, "creation_date": 1438185028, "answer_id": 31705288, "question_id": 31705213, "link": "https://stackoverflow.com/questions/31705213/foreach-from-map-go/31705288#31705288", "title": "Foreach from map go", "body": "<p>If you are using a map, you can use key, value := range mymap. Example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n    \"io/ioutil\"\n)\n\nfunc main() {\n    configFile, _ := ioutil.ReadFile(\"config.json\")\n    json.Unmarshal(configFile, &amp;person)\n\n    for key, value := range person{}\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": false, "score": -1, "last_activity_date": 1438185704, "creation_date": 1438185704, "answer_id": 31705591, "question_id": 31705213, "link": "https://stackoverflow.com/questions/31705213/foreach-from-map-go/31705591#31705591", "title": "Foreach from map go", "body": "<p>Method #1: query <code>map[string]interface{}</code> (<a href=\"http://play.golang.org/p/fhO874T-f1\" rel=\"nofollow\">play</a>):</p>\n\n<pre><code>package main\n\nimport (\n  \"encoding/json\"\n  \"fmt\"\n)\n\nfunc main() {\n  person := make(map[string]interface{})\n  json.Unmarshal([]byte(`{\n    \"keywords\": \"keywords1\",\n    \"social\": [\n      {\"url\": \"test1\", \"title\": \"test1\"},\n      {\"url\": \"test2\", \"title\": \"test2\"}\n    ]\n  }`), &amp;person)\n\n  social, _ := person[\"social\"]\n  fmt.Println(social)\n}\n</code></pre>\n\n<p>Prints:</p>\n\n<pre><code>[map[url:test1 title:test1] map[url:test2 title:test2]]\n</code></pre>\n\n<p>Method #2: nice intermediate object (<a href=\"http://play.golang.org/p/IKvlezB4w1\" rel=\"nofollow\">play</a>):</p>\n\n<pre><code>package main\n\nimport (\n  \"encoding/json\"\n  \"fmt\"\n)\n\nfunc main() {\n  var person struct {\n    Keywords string `json:\"keywords\"`\n    Social   []struct {\n      Url   string `json:\"url\"`\n      Title string `json:\"title\"`\n    } `json:\"social\"`\n  }\n\n  json.Unmarshal([]byte(`{\n    \"keywords\": \"keywords1\",\n    \"social\": [\n      {\"url\": \"test1\", \"title\": \"test1\"},\n      {\"url\": \"test2\", \"title\": \"test2\"}\n    ]\n  }`), &amp;person)\n\n  for _, i := range person.Social {\n    fmt.Println(i.Url, i.Title)\n  }\n}\n</code></pre>\n\n<p>Prints:</p>\n\n<pre><code>test1 test1\ntest2 test2\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 5170123, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d2f5e55fce224cf6f6a6ec7b00c28687?s=128&d=identicon&r=PG&f=1", "display_name": "Gopher", "link": "https://stackoverflow.com/users/5170123/gopher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1438185704, "creation_date": 1438184792, "question_id": 31705213, "link": "https://stackoverflow.com/questions/31705213/foreach-from-map-go", "title": "Foreach from map go", "body": "<p>I have a little question for you all!</p>\n\n<p>How foreach each element in json file?</p>\n\n<p>json:</p>\n\n<pre><code>{\n  \"keywords\": \"keywords1\",\n  \"social\": [\n    {\"url\": \"test1\", \"title\": \"test1\"},\n    {\"url\": \"test2\", \"title\": \"test2\"}\n  ]\n}\n</code></pre>\n\n<p>and this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n    \"io/ioutil\"\n)\n\nfunc main() {\n    configFile, _ := ioutil.ReadFile(\"config.json\")\n    json.Unmarshal(configFile, &amp;person)\n\n    // foreach[\"social\"]\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 672844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30b80cc2eabf0d6dce3633972e84844a?s=128&d=identicon&r=PG", "display_name": "Bart M.", "link": "https://stackoverflow.com/users/672844/bart-m"}, "is_accepted": false, "score": 2, "last_activity_date": 1438182338, "creation_date": 1438182338, "answer_id": 31704286, "question_id": 31704083, "link": "https://stackoverflow.com/questions/31704083/is-there-a-way-to-append-remove-a-resource-to-a-binary-at-execution-time/31704286#31704286", "title": "Is there a way to append/remove a resource to a binary at execution time?", "body": "<p>Technically, this is possible, but this is a bad idea. Your application could be run by users not having write permissions to your binary.</p>\n\n<p>If you're talking about a portable app, your best option might be using a file in the same directory the binary is located, otherwise - use the user's home directory according to the conventions of the OS you're running on. You can use the <code>os/user</code> package to find the home directory.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1438185093, "creation_date": 1438185093, "answer_id": 31705320, "question_id": 31704083, "link": "https://stackoverflow.com/questions/31704083/is-there-a-way-to-append-remove-a-resource-to-a-binary-at-execution-time/31705320#31705320", "title": "Is there a way to append/remove a resource to a binary at execution time?", "body": "<p>Modifying the executable, this is generally a <em>very bad idea</em>.</p>\n\n<p>Several issues pop right into my head, such as:</p>\n\n<ol>\n<li>Does the current user have sufficient permissions?</li>\n<li>Is the file locked during execution?</li>\n<li>What about multiple running instances of the application?</li>\n</ol>\n\n<p>Even if you manage to do just that, think of what anti-virus and firewall applications will say to it: most when they detect the change will flag the executable and/or contain it, or deny running it, or some may even delete it. Rightfully, as this is what many viruses do: modify existing executables.</p>\n\n<p>Also virus scanner databases maintain reports where files (their contents) are identified based on the hash of their content. Modifying the executable will naturally change the file content hash, thus render the file unknown / suspicious to these databases.</p>\n\n<p>As mentioned, just write / cache data in separate file(s), preferably in user's home folder or in the application folder (next to the executable, optionally in sub-folders). Or make the cache file / folder a changeable option (command line flags).</p>\n"}], "owner": {"reputation": 281, "user_id": 1532406, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a1574907fc0174563bebdabc21c9817?s=128&d=identicon&r=PG", "display_name": "vjeantet", "link": "https://stackoverflow.com/users/1532406/vjeantet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 31705320, "answer_count": 2, "score": 4, "last_activity_date": 1438185093, "creation_date": 1438181772, "last_edit_date": 1438183189, "question_id": 31704083, "link": "https://stackoverflow.com/questions/31704083/is-there-a-way-to-append-remove-a-resource-to-a-binary-at-execution-time", "title": "Is there a way to append/remove a resource to a binary at execution time?", "body": "<p>Is it possible to append/remove a ressource file to a binary at execution time?</p>\n\n<p>I have an application written with go, which saves/searches data from a database file, and i would like this database file to be embedded to the binary, and updated by the application itself.</p>\n\n<p>This way the application would be self contained with its database. </p>\n"}, {"tags": ["c", "arrays", "struct", "go"], "comments": [{"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 4, "creation_date": 1438174643, "post_id": 31700897, "comment_id": 51341117, "body": "Please be more specific in your questions. Good question should include problem statement and demonstrate your effort in solving it."}, {"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1438174900, "post_id": 31700897, "comment_id": 51341254, "body": "What do you need exactly?"}, {"owner": {"reputation": 608, "user_id": 4050822, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/UiYwh.jpg?s=128&g=1", "display_name": "Shivendra Mishra", "link": "https://stackoverflow.com/users/4050822/shivendra-mishra"}, "edited": false, "score": 0, "creation_date": 1438342256, "post_id": 31700897, "comment_id": 51423582, "body": "@ I m trying to parse command line arguments using cli library. And need to pass list options and their help to App.name/usage in a loop. By the way, as part of my effort: var login = []struct {           long_opt  string           help_data string   }{           {&quot;username, u&quot;, &quot;Requires name of the user&quot;},           {&quot;password, p&quot;, &quot;Requires password&quot;},           {&quot;Server, s&quot;, &quot;Server Name&quot;},  } But it is difficult this way. So posted a question here. I don&#39;t find any example like this on the google though."}], "answers": [{"tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": false, "score": 1, "last_activity_date": 1438174493, "creation_date": 1438174493, "answer_id": 31701015, "question_id": 31700897, "link": "https://stackoverflow.com/questions/31700897/array-of-structure-equivalent-in-golang/31701015#31701015", "title": "Array of structure equivalent in golang", "body": "<pre><code>// define structure type\ntype my_struct struct {\n  a int\n  b rune\n}\n\n// declare slice of my_struct\nvar a []my_struct\n\n// declare and initialise struct with one element \nb := make([]my_struct, 1)\n\n// create structure and save it\nb[0] = my_struct{1, 'a'}\n\n// append a new one\nb = append(b, my_struct{2, 'b'})\n</code></pre>\n\n<p>You definitely have to read <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow\">https://golang.org/doc/effective_go.html</a>, especially about structs and slices if you want to know more about them.</p>\n"}, {"tags": [], "owner": {"reputation": 1667, "user_id": 359660, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a63c1f44ef127e609753975421ef7f?s=128&d=identicon&r=PG", "display_name": "LanceH", "link": "https://stackoverflow.com/users/359660/lanceh"}, "is_accepted": true, "score": 1, "last_activity_date": 1438174918, "creation_date": 1438174918, "answer_id": 31701197, "question_id": 31700897, "link": "https://stackoverflow.com/questions/31700897/array-of-structure-equivalent-in-golang/31701197#31701197", "title": "Array of structure equivalent in golang", "body": "<p>You can find some basic info on arrays: <a href=\"http://golang.org/doc/effective_go.html#arrays\" rel=\"nofollow\">http://golang.org/doc/effective_go.html#arrays</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nvar s [10]MyStruct //initializes to 0\n\nfunc main() {\n    for k, v := range s {\n        fmt.Println(k, v.a)\n    }\n}\n\ntype MyStruct struct {\n    a int64\n}\n</code></pre>\n"}], "owner": {"reputation": 608, "user_id": 4050822, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/UiYwh.jpg?s=128&g=1", "display_name": "Shivendra Mishra", "link": "https://stackoverflow.com/users/4050822/shivendra-mishra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 850, "favorite_count": 0, "accepted_answer_id": 31701197, "answer_count": 2, "score": -1, "last_activity_date": 1438174918, "creation_date": 1438174179, "last_edit_date": 1438174703, "question_id": 31700897, "link": "https://stackoverflow.com/questions/31700897/array-of-structure-equivalent-in-golang", "title": "Array of structure equivalent in golang", "body": "<p>I am looking for something equivalent to array of structures. Or something equivalent to the following code in golang:</p>\n\n<pre><code>struct my_struct {\n     int a;\n     char b;\n}ins[10],*p[10];\n</code></pre>\n\n<p>Any example, how can I feed/assign values to these in golang?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 1, "last_activity_date": 1438174651, "creation_date": 1438174651, "answer_id": 31701081, "question_id": 31700489, "link": "https://stackoverflow.com/questions/31700489/read-a-byte-from-first-crlf-till-the-end/31701081#31701081", "title": "read a []byte from first CRLF till the end", "body": "<p>This is can be done easily using the <a href=\"https://godoc.org/bytes#Index\" rel=\"nofollow\"><code>bytes.Index</code></a> function, which returns the index of a given sub-slice of bytes in another byte slice:</p>\n\n<pre><code>func afterCRLF(data []byte) []byte {\n    crlf := []byte(\"\\r\\n\")\n    index := bytes.Index(data, crlf)\n    if index == -1 {\n        return nil\n    }\n    return data[index+len(crlf):]\n}\n</code></pre>\n\n<p>Note: the above function does not include the first CRLF in the returned byte slice. Remove <code>+len(crlf)</code> if you need those two characters included.</p>\n\n<p>Example: <a href=\"https://play.golang.org/p/WdylrkPwU_\" rel=\"nofollow\">https://play.golang.org/p/WdylrkPwU_</a></p>\n"}], "owner": {"reputation": 1041, "user_id": 1070980, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/edac813115d540c99244cbb5a629fd95?s=128&d=identicon&r=PG", "display_name": "robert laing", "link": "https://stackoverflow.com/users/1070980/robert-laing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 425, "favorite_count": 0, "accepted_answer_id": 31701081, "answer_count": 1, "score": 0, "last_activity_date": 1438174651, "creation_date": 1438173135, "question_id": 31700489, "link": "https://stackoverflow.com/questions/31700489/read-a-byte-from-first-crlf-till-the-end", "title": "read a []byte from first CRLF till the end", "body": "<p>in golang, having a <code>[]byte</code> (resulting from <code>ioutil.ReadAll</code>), i should need to read from the first newline CRLF until the end of the block.</p>\n\n<p>could you point me some examples?</p>\n"}, {"tags": ["go", "filesystems", "sync"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 3, "last_activity_date": 1438263994, "last_edit_date": 1438263994, "creation_date": 1438173778, "answer_id": 31700727, "question_id": 31697163, "link": "https://stackoverflow.com/questions/31697163/synchronizing-a-file-system-syncfs-in-go/31700727#31700727", "title": "Synchronizing a file system (syncfs) in Go", "body": "<p><code>syncfs</code> is just a system call, which are easy to trigger in Go.</p>\n\n<p>However, since the <a href=\"https://godoc.org/syscall\" rel=\"nofollow\"><code>syscall</code> package</a> does not have the <code>syncfs</code> syscall constant, you can use <a href=\"https://godoc.org/golang.org/x/sys/unix\" rel=\"nofollow\"><code>golang.org/x/sys/unix</code></a> instead, which has it defined (not really necessity, since a syscall constant is just a number, but using that package doesn't hurt).</p>\n\n<pre><code>import \"golang.org/x/sys/unix\"\n\nfunc syncfs(fd int) error {\n    _, _, err := unix.Syscall(unix.SYS_SYNCFS, uintptr(fd), 0, 0)\n    if err != 0 {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>For completeness, here is the solution just using the <code>syscall</code> package:</p>\n\n<pre><code>import \"syscall\"\n\nfunc syncfs(fd int) error {\n    _, _, err := syscall.Syscall(306, uintptr(fd), 0, 0)\n    if err != 0 {\n        return err\n    }\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 60057, "user_id": 1333025, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/79ab43010f900324ac5e2de19a2916cb?s=128&d=identicon&r=PG", "display_name": "Petr", "link": "https://stackoverflow.com/users/1333025/petr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 867, "favorite_count": 0, "accepted_answer_id": 31700727, "answer_count": 1, "score": 3, "last_activity_date": 1438263994, "creation_date": 1438163936, "question_id": 31697163, "link": "https://stackoverflow.com/questions/31697163/synchronizing-a-file-system-syncfs-in-go", "title": "Synchronizing a file system (syncfs) in Go", "body": "<p>Is there a package that exports the <a href=\"http://man7.org/linux/man-pages/man2/sync.2.html\" rel=\"nofollow\"><code>syncfs</code></a> function in Go? I'd like to synchronize a particular file system.</p>\n\n<p>I found the <a href=\"https://golang.org/pkg/syscall/\" rel=\"nofollow\">syscall</a> package, but it only exports <code>FSync</code>, <code>Fdatasync</code> and <code>Sync</code>.</p>\n"}, {"tags": ["go", "interface", "type-conversion"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1438158157, "last_edit_date": 1438158157, "creation_date": 1438157331, "answer_id": 31694762, "question_id": 31694238, "link": "https://stackoverflow.com/questions/31694238/implicit-interface-conversion-in-golang/31694762#31694762", "title": "Implicit interface conversion in golang", "body": "<p>Your current <code>*C</code> type <strong>does not</strong> implement the interface <code>B</code>, therefore you can't assign a value of <code>*C</code> to a variable of type <code>B</code> nor can't you \"type assert\" a value of <code>B</code> from something holding a value of type <code>*C</code>.</p>\n\n<p>Here's what you can do. Since you're already using a struct literal (<code>&amp;C{}</code>), you may declare <code>c</code> to be of type <code>*C</code> of which you can call its <code>Get()</code> method, and you can convert the return value of <code>C.Get()</code> to <code>A</code> (because the return value does implement <code>A</code>):</p>\n\n<pre><code>var c *C = &amp;C{}\nvar a A = c.Get() // This is ok, implicit interface value creation (of type A)\nfmt.Println(a.AAA())\n// Or without the intermediate \"a\", you can simply call:\nfmt.Println(c.Get().AAA())\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>it's CA\nit's CA\n</code></pre>\n\n<p><strong>Or refactor:</strong></p>\n\n<p>The problem is that you have an interface (<code>B</code>) which you want to implement, which has a method which returns another interface (<code>A</code>). To implement this <code>B</code> interface, you have to have dependency to the package that defines <code>A</code>, you can't avoid this. And you have to declare <code>C.Get()</code> to return <code>A</code> (instead of a concrete struct type).</p>\n\n<p>You may move <code>A</code> to a 3rd package and then the package that defines <code>C</code> will only have to depend on this 3rd package, but will not depend on the package that defines <code>B</code> (but still will implicitly implement the interface type <code>B</code>).</p>\n"}], "owner": {"reputation": 208, "user_id": 3056562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc137a5994f4c680470b62df6a4a4ed9?s=128&d=identicon&r=PG", "display_name": "mission.liao", "link": "https://stackoverflow.com/users/3056562/mission-liao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1897, "favorite_count": 0, "accepted_answer_id": 31694762, "answer_count": 1, "score": 3, "last_activity_date": 1438158157, "creation_date": 1438155817, "last_edit_date": 1438158086, "question_id": 31694238, "link": "https://stackoverflow.com/questions/31694238/implicit-interface-conversion-in-golang", "title": "Implicit interface conversion in golang", "body": "<p>Here is an example of the idea I want to demonstrate.</p>\n\n<pre><code>package main\nimport \"fmt\"\n\n// interface declaration\n//\n\ntype A interface {\n    AAA() string\n}\n\ntype B interface{\n    Get() A\n}\n\n// implementation\n//\n\ntype CA struct {}\n\n// implementation of A.AAA\nfunc (ca *CA) AAA() string {\n    return \"it's CA\"\n}\n\ntype C struct {}\n\n// implementation of B.Get, except for returning a 'struct' instead of an 'interface'\nfunc (c *C) Get() *CA {\n    return &amp;CA{}\n}\n\nfunc main() {\n    var c interface{} = &amp;C{}\n    d := c.(B)\n    fmt.Println(d.Get().AAA())\n    fmt.Println(\"Hello, playground\")\n}\n</code></pre>\n\n<p>In this example</p>\n\n<ul>\n<li>interface <code>B</code> has a method <code>Get</code> to return an interface <code>A</code></li>\n<li>struct <code>C</code> has a member function <code>Get</code> to return a pointer to struct <code>CA</code>, which implements interface <code>A</code></li>\n</ul>\n\n<p>The result is Go can't deduce interface <code>B</code> from struct <code>C</code>, even their <code>Get</code> method is only different in returning type, which is convertible.</p>\n\n<p>The reason I raise this question is when <strong>interface A, B</strong> and <strong>struct C, CA</strong> are in different packages, I can only:</p>\n\n<ul>\n<li>refine the Get method of <code>C</code> to <strong>func Get() A</strong>, which introduce some dependency between packages.</li>\n<li>refine both <code>Get</code> method of interface <code>B</code> and struct <code>C</code> to <strong>func Get() interface{}</strong></li>\n</ul>\n\n<p>I want to avoid dependency between packages and try not to rely on <strong>interface{}</strong>, can anyone give me some hint? What's the best practice in Go?</p>\n"}, {"tags": ["http", "tcp", "go"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1438152396, "post_id": 31691756, "comment_id": 51326869, "body": "` 517 t.setReqCanceler(req, func() { close(cancelc) })` maybe the reqcanceler is invoked multi times. i think you can add some log(maybe print call stack) in the anonymous function before <code>close(cancelc)</code>,"}, {"owner": {"reputation": 221, "user_id": 2729715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/477dc0e93e54bedc7521bf85f9ebf7c5?s=128&d=identicon&r=PG&f=1", "display_name": "csabiftw", "link": "https://stackoverflow.com/users/2729715/csabiftw"}, "edited": false, "score": 2, "creation_date": 1438165992, "post_id": 31691756, "comment_id": 51335306, "body": "multiple calls to CancelRequest seem like the problem indeed. Is there a reason you are not using the standard timeout mechanism of http.Client? Check Timeout field here: <a href=\"http://golang.org/pkg/net/http/#Client\" rel=\"nofollow noreferrer\">http.Client doc</a>"}], "answers": [{"comments": [{"owner": {"reputation": 458, "user_id": 1427334, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/939765f59ddf52cb6d87b59a217cdcaf?s=128&d=identicon&r=PG", "display_name": "niraj.nijju", "link": "https://stackoverflow.com/users/1427334/niraj-nijju"}, "edited": false, "score": 0, "creation_date": 1438321046, "post_id": 31702682, "comment_id": 51411973, "body": "As @JimB pointed out, I was cancelling request twice.  Thanks"}, {"owner": {"reputation": 458, "user_id": 1427334, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/939765f59ddf52cb6d87b59a217cdcaf?s=128&d=identicon&r=PG", "display_name": "niraj.nijju", "link": "https://stackoverflow.com/users/1427334/niraj-nijju"}, "edited": false, "score": 0, "creation_date": 1438321440, "post_id": 31702682, "comment_id": 51412110, "body": "JimB, how can I make sure I am not  re-using the *http.Request"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 458, "user_id": 1427334, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/939765f59ddf52cb6d87b59a217cdcaf?s=128&d=identicon&r=PG", "display_name": "niraj.nijju", "link": "https://stackoverflow.com/users/1427334/niraj-nijju"}, "edited": false, "score": 0, "creation_date": 1438354470, "post_id": 31702682, "comment_id": 51432133, "body": "@niraj.nijju: I&#39;m not sure how to answer that other than, don&#39;t reuse them. If you need to rely on cancelation, you need to make sure you allocate a new <code>*http.Request</code> for each round trip."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 2, "last_activity_date": 1438178366, "creation_date": 1438178366, "answer_id": 31702682, "question_id": 31691756, "link": "https://stackoverflow.com/questions/31691756/panic-close-of-closed-channel-during-persistent-http-call-in-gogolang/31702682#31702682", "title": "panic: close of closed channel during persistent http call in GO(golang)", "body": "<p><code>transport.CancelRequest</code> is being called multiple times from your code somehow.</p>\n\n<p>You are likely doing one or both of the following:</p>\n\n<ul>\n<li><p>you are re-using the <code>*http.Request</code>, causing the lookup to possibly return the cancel function from the wrong round-trip.</p></li>\n<li><p>You have set <code>http.Client.Timeout</code>, which also uses the <code>Transport.CancelRequest</code> mechanism, causing a race to cancel the request</p></li>\n</ul>\n"}], "owner": {"reputation": 458, "user_id": 1427334, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/939765f59ddf52cb6d87b59a217cdcaf?s=128&d=identicon&r=PG", "display_name": "niraj.nijju", "link": "https://stackoverflow.com/users/1427334/niraj-nijju"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 898, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1438178366, "creation_date": 1438147284, "question_id": 31691756, "link": "https://stackoverflow.com/questions/31691756/panic-close-of-closed-channel-during-persistent-http-call-in-gogolang", "title": "panic: close of closed channel during persistent http call in GO(golang)", "body": "<p>We are using this function for HTTP call with maxIdleConnsPerHost=100, where we are getting upto 20000/min request to fetch result from a third party server.</p>\n\n<p>function :</p>\n\n<pre><code>func (hr *Client) Do(req *http.Request) (rsp *http.Response, err error) {\nrspCh := make(chan *http.Response)\nerrCh := make(chan error)\n\nvar timeoutCh &lt;-chan time.Time\nif hr.Timeout &gt; 0 {\n    timeoutCh = time.After(hr.Timeout)\n}\n\ngo func(req *http.Request) {\n    rsp, err := hr.Client.Do(req)\n    if err != nil {\n        errCh &lt;- err\n        rspCh &lt;- rsp\n        logger.SetLog(\" error in http_client_Do : \", logs.LevelError, err)\n        if nil!=rsp{\n            fmt.Println(rsp.Header)\n        }else{\n            fmt.Println(\"error with nil rsp\")\n        }       \n    } else {\n        rspCh &lt;- rsp\n        //errCh &lt;- nil\n    }\n}(req)\n\nvar now time.Time\n\nselect {\ncase err = &lt;-errCh:\n    rsp = &lt;-rspCh\ncase now = &lt;-timeoutCh:\n    go hr.Transport.CancelRequest(req)\n    err = fmt.Errorf(\"error requesting %s: read timed out at %s after waiting %s\",\n        req.URL, now.Format(time.RFC3339), hr.Timeout)\ncase rsp = &lt;-rspCh:\n    err = nil\n}\nreturn\n}\n</code></pre>\n\n<p>I am not getting why this is breaking in some case. (it was running smooth for a long time ). </p>\n\n<p>Error Message : </p>\n\n<pre><code>panic: close of closed channel\n\ngoroutine 3822098 [running]:\nnet/http.func\u00b7018()\n        /usr/local/go/src/net/http/transport.go:517 +0x2a\nnet/http.(*Transport).CancelRequest(0xc2080b02d0, 0xc20880de10)\n        /usr/local/go/src/net/http/transport.go:284 +0x97\ncreated by Mediation/pkg/services/restApi.(*Client).Do\n        /usr/local/gopath/src/ ***.go:179 +0x3d2\n\ngoroutine 1 [chan receive, 308 minutes]:\ngithub.com/astaxie/beego.(*App).Run(0xc20800a4b0)\n        /usr/local/gopath/src/github.com/astaxie/beego/app.go:171 +0x363\ngithub.com/astaxie/beego.Run(0x0, 0x0, 0x0)\n        /usr/local/gopath/src/github.com/astaxie/beego/beego.go:277 +0x17c\nmain.main()\n        /usr/local/gopath/src/ ***/main.go:33 +0x423\n\ngoroutine 5 [syscall, 308 minutes]:\nos/signal.loop()\n        /usr/local/go/src/os/signal/signal_unix.go:21 +0x1f\ncreated by os/signal.init\u00b71\n        /usr/local/go/src/os/signal/signal_unix.go:27 +0x35\n\ngoroutine 2163451 [select, 146 minutes]:\nnet/http.(*persistConn).readLoop(0xc208501ce0)\n        /usr/local/go/src/net/http/transport.go:928 +0x9ce\ncreated by net/http.(*Transport).dialConn\n        /usr/local/go/src/net/http/transport.go:660 +0xc9f\n\ngoroutine 17 [chan receive, 8 minutes]:\ngithub.com/Shopify/sarama.(*Broker).responseReceiver(0xc20810a230)\n        /usr/local/gopath/src/github.com/Shopify/sarama/broker.go:340 +0xe3\ngithub.com/Shopify/sarama.*Broker.(github.com/Shopify/sarama.responseReceiver)\u00b7fm()\n        /usr/local/gopath/src/github.com/Shopify/sarama/broker.go:93 +0x27\ngithub.com/Shopify/sarama.withRecover(0xc20800a6b0)\n        /usr/local/gopath/src/github.com/Shopify/sarama/utils.go:42 +0x3a\ncreated by github.com/Shopify/sarama.func\u00b7008\n        /usr/local/gopath/src/github.com/Shopify/sarama/broker.go:93 +0x610\n\ngoroutine 8 [select, 8 minutes]:\ngithub.com/Shopify/sarama.(*client).backgroundMetadataUpdater(0xc2080b6100)\n        /usr/local/gopath/src/github.com/Shopify/sarama/client.go:553 +0x2f3\ngithub.com/Shopify/sarama.*client.(github.com/Shopify/sarama.backgroundMetadataUpdater)\u00b7fm()\n        /usr/local/gopath/src/github.com/Shopify/sarama/client.go:142 +0x27\ngithub.com/Shopify/sarama.withRecover(0xc2080ba730)\n        /usr/local/gopath/src/github.com/Shopify/sarama/utils.go:42 +0x3a\ncreated by github.com/Shopify/sarama.NewClient\n        /usr/local/gopath/src/github.com/Shopify/sarama/client.go:142 +0x8ce\n</code></pre>\n"}, {"tags": ["go", "indexoutofrangeexception"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1438145215, "post_id": 31691351, "comment_id": 51323977, "body": "Is this the only goroutine that can be accessing <code>scenarios</code>, or any of it&#39;s items at the time of panic?"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1438145354, "post_id": 31691351, "comment_id": 51324007, "body": "Are you sure line 76 is marked with <code>&lt;--!</code>? I would expect an out of range on either the line before or after, but not the <code>for</code> line."}, {"owner": {"reputation": 61, "user_id": 5167652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af022fadd70da00c7890393756af2ddc?s=128&d=identicon&r=PG&f=1", "display_name": "jtgoen", "link": "https://stackoverflow.com/users/5167652/jtgoen"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1438212422, "post_id": 31691351, "comment_id": 51363460, "body": "@captncraig  Comment 1: I&#39;m pretty sure, since I&#39;m not attempting to spawn any goroutines. I&#39;m importing this code and calling that function from another source file (my main source), but my main function shouldn&#39;t be accessing any of its internal variables.  Comment 2: that&#39;s the line it&#39;s telling me about whenever I run it. I&#39;m as confused as you are on that front."}], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 5167652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af022fadd70da00c7890393756af2ddc?s=128&d=identicon&r=PG&f=1", "display_name": "jtgoen", "link": "https://stackoverflow.com/users/5167652/jtgoen"}, "edited": false, "score": 0, "creation_date": 1438213958, "post_id": 31691456, "comment_id": 51363817, "body": "Okay, so adding this flag lets it run without issues (like running it in the debugger) but I&#39;m still not sure where the source of the issue is... Sorry, I&#39;m new to Go, so I&#39;m still learning how to properly debug it. I&#39;ve looked into the -run docs and there&#39;s no warnings shown when I run with -race, it just seems to work."}], "tags": [], "owner": {"reputation": 24278, "user_id": 6013, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/2c21bed614c58c9e1c48fe272e79efd2?s=128&d=identicon&r=PG", "display_name": "Joshua", "link": "https://stackoverflow.com/users/6013/joshua"}, "is_accepted": false, "score": 6, "last_activity_date": 1438145610, "creation_date": 1438145610, "answer_id": 31691456, "question_id": 31691351, "link": "https://stackoverflow.com/questions/31691351/golang-panic-runtime-error-index-out-of-range-only-happens-when-run-outside-de/31691456#31691456", "title": "Golang panic: runtime error: index out of range only happens when run outside debugger", "body": "<p>It appears that you may have a data race somewhere. Try running it with the -race flag.</p>\n\n<blockquote>\n  <p>go run -race myfile.go</p>\n</blockquote>\n"}], "owner": {"reputation": 61, "user_id": 5167652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af022fadd70da00c7890393756af2ddc?s=128&d=identicon&r=PG&f=1", "display_name": "jtgoen", "link": "https://stackoverflow.com/users/5167652/jtgoen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3802, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1438213814, "creation_date": 1438144875, "last_edit_date": 1438213814, "question_id": 31691351, "link": "https://stackoverflow.com/questions/31691351/golang-panic-runtime-error-index-out-of-range-only-happens-when-run-outside-de", "title": "Golang panic: runtime error: index out of range only happens when run outside debugger", "body": "<p>I have the following code used to find two integers that sum to a given total in a given slice:</p>\n\n<pre><code>type Store_object struct {\n    C      int\n    I      int\n    Prices []int\n}\n//..other unrelated functions...\n\nfunc FindItemPairs(scenarios []Store_object) ([]string, error) {\n    var results []string\n    for scIndex := 0; scIndex &lt; len(scenarios); scIndex++ {\n        scenario := scenarios[scIndex]\n        for prIndex := 0; prIndex &lt; len(scenario.Prices); prIndex++ { //&lt;--!sc\n            firstItem := scenario.Prices[prIndex]\n            if firstItem &gt;= scenario.C {\n                continue\n            }\n            for cmpIndex := prIndex + 1; cmpIndex &lt; len(scenario.Prices); cmpIndex++ {\n                secondItem := scenario.Prices[cmpIndex]\n\n                switch {\n                case secondItem &gt;= scenario.C:\n                    continue\n                case firstItem+secondItem == scenario.C:\n                    result := \"Case #\" + strconv.Itoa(scIndex+1) +\n                        \" \" + strconv.Itoa(firstItem) + \" \" +\n                        strconv.Itoa(secondItem)\n                    results = append(results, result)\n                }\n            }\n        }\n   }\n   return results, nil\n}\n</code></pre>\n\n<p>however, when I attempt to run my code to find the item pairs, I get the following error:</p>\n\n<pre><code>panic: runtime error: index out of range\n\ngoroutine 1 [running]:\n   &lt;store_credit&gt;.FindItemPairs(0x208208000, 0x1e, 0x20, 0x0, 0x0, 0x0, 0x0, 0x0)\n&lt;store_credit_location&gt;.go:76 +0x4ac \nmain.main()\n    &lt;main_dir&gt;/test_sc.go:16 +0x24d\nexit status 2\n</code></pre>\n\n<p>(relevant line is noted with &lt;--!sc above  and &lt;--!main below)</p>\n\n<p>In order to try to debug, I used the following project <a href=\"https://github.com/mailgun/godebug\" rel=\"nofollow\">https://github.com/mailgun/godebug</a> to test, and found that my code executed without issue.</p>\n\n<p>I currently have no clue how I would be accessing a value that is out-of-range, but have no idea how I will debug this further...</p>\n\n<p>Any guidance on this would be greatly appreciated!</p>\n\n<p>For more context, here is the code jam I'm trying to implement: <a href=\"https://code.google.com/codejam/contest/351101/dashboard#s=p0\" rel=\"nofollow\">https://code.google.com/codejam/contest/351101/dashboard#s=p0</a> </p>\n\n<p>Edit: For even more context, here is the main file I am running that calls this function:</p>\n\n<pre><code>func main() {\n    cases, err := store_credit.ReadLines(\"A-small-practice.in\")\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Println(cases)\n\n    results, err := store_credit.FindItemPairs(cases) //&lt;--!main\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    for i := 0; i &lt; len(results); i++ {\n        fmt.Println(results[i])\n    }\n}\n</code></pre>\n\n<p>ReadLines works fine with no issues.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 1, "creation_date": 1438145199, "post_id": 31691333, "comment_id": 51323972, "body": "Thanks for the detailed answer. I will switch to interfaces as embedding is not an option based on the non-trivial layout of the common fields."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 5, "last_activity_date": 1438144748, "creation_date": 1438144748, "answer_id": 31691333, "question_id": 31691193, "link": "https://stackoverflow.com/questions/31691193/how-can-i-use-interface-as-a-wildcard-type/31691333#31691333", "title": "How can I use interface{} as a wildcard type?", "body": "<p>Even though A and B both have a status field they are not interchangeable to the type system. You must have separate cases for each of them.</p>\n\n<pre><code>case A:\n    t.Status = status\ncase B:\n    t.Status = status\n} \n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/cl6gYKt5cr\">playground link</a></p>\n\n<p>Alternatively, you could use an actual interface:</p>\n\n<pre><code>type HasStatus interface {\n  SetStatus(int)\n}\n\ntype A struct {\n   Status int\n}\n\nfunc (a *A) SetStatus(s int) { a.Status = s }\n\nfunc foo(v HasStatus, status int) {\n    v.SetStatus(status)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/QgPkB-KT-n\">full example</a></p>\n\n<p>If you have multiple types that all have a common set of fields you may want to use an embedded struct:</p>\n\n<pre><code>type HasStatus interface {\n    SetStatus(int)\n}\n\ntype StatusHolder struct {\n    Status int\n}\n\nfunc (sh *StatusHolder) SetStatus(s int) { sh.Status = s }\n\ntype A struct {\n    StatusHolder\n}\n\ntype B struct {\n    id string\n    StatusHolder\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/MOam_kY3TB\">full example</a></p>\n"}], "owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 426, "favorite_count": 1, "accepted_answer_id": 31691333, "answer_count": 1, "score": 1, "last_activity_date": 1438144748, "creation_date": 1438143857, "question_id": 31691193, "link": "https://stackoverflow.com/questions/31691193/how-can-i-use-interface-as-a-wildcard-type", "title": "How can I use interface{} as a wildcard type?", "body": "<p>The scenario is to pass similar structs with common fields and set those to values passed as params:</p>\n\n<pre><code>package main\n\ntype A struct {\n    Status int\n}\n\ntype B struct {\n    id     string\n    Status int\n}\n\n// It's okay to pass by value because content is only used inside this\nfunc foo(v interface{}, status int) {\n    switch t := v.(type) {\n    case A, B:\n        t.Status = status // ERROR :-(\n    }\n}\n\nfunc main() {\n    a := A{}\n    foo(a, 0)\n    b := B{}\n    b.id = \"x\"\n    foo(b, 1)\n}\n</code></pre>\n\n<p>To my dismay, I am getting this error:</p>\n\n<pre><code>\u279c  test  go run test.go\n# command-line-arguments\n./test.go:15: t.Status undefined (type interface {} has no field or method Status)\n</code></pre>\n\n<p>What am I doing wrong if the typecast converts interface{} to the underlying type?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 941, "user_id": 628561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f7a75c6f93a08da767fdb732789c476?s=128&d=identicon&r=PG", "display_name": "robbyphillips", "link": "https://stackoverflow.com/users/628561/robbyphillips"}, "edited": false, "score": 2, "creation_date": 1438139049, "post_id": 31690283, "comment_id": 51322506, "body": "How did you start the server?  Did you run the binary after a <code>go build</code>? Your code actually seems to work for me."}, {"owner": {"reputation": 13, "user_id": 5167372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Si4Lm.jpg?s=128&g=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/5167372/jeff"}, "reply_to_user": {"reputation": 941, "user_id": 628561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f7a75c6f93a08da767fdb732789c476?s=128&d=identicon&r=PG", "display_name": "robbyphillips", "link": "https://stackoverflow.com/users/628561/robbyphillips"}, "edited": false, "score": 0, "creation_date": 1438139603, "post_id": 31690283, "comment_id": 51322647, "body": "@oobivat I followed this command: go build and ./myApp"}, {"owner": {"reputation": 941, "user_id": 628561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f7a75c6f93a08da767fdb732789c476?s=128&d=identicon&r=PG", "display_name": "robbyphillips", "link": "https://stackoverflow.com/users/628561/robbyphillips"}, "edited": false, "score": 0, "creation_date": 1438139924, "post_id": 31690283, "comment_id": 51322710, "body": "I&#39;m sorry if this is really pedantic, but to clarify... While you were in the <code>myApp</code> folder you ran the command <code>go build</code>.  This command produces an executable binary (it isn&#39;t running yet).  Then you ran the binary (probably called <code>myApp</code>) by entering <code>.&#47;myApp</code> into the terminal.  I ask this only because your code works, unmodified, for me."}, {"owner": {"reputation": 13, "user_id": 5167372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Si4Lm.jpg?s=128&g=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/5167372/jeff"}, "reply_to_user": {"reputation": 941, "user_id": 628561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f7a75c6f93a08da767fdb732789c476?s=128&d=identicon&r=PG", "display_name": "robbyphillips", "link": "https://stackoverflow.com/users/628561/robbyphillips"}, "edited": false, "score": 0, "creation_date": 1438140258, "post_id": 31690283, "comment_id": 51322789, "body": "@oobivat first, thank you so much, after i ran these commands, it worked with this link : <a href=\"http://localhost:8080/public\" rel=\"nofollow noreferrer\">localhost:8080/public</a> but i want it works with <a href=\"http://localhost:8080\" rel=\"nofollow noreferrer\">localhost:8080</a>, please correct me if to have some thing went wrong."}, {"owner": {"reputation": 941, "user_id": 628561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f7a75c6f93a08da767fdb732789c476?s=128&d=identicon&r=PG", "display_name": "robbyphillips", "link": "https://stackoverflow.com/users/628561/robbyphillips"}, "edited": false, "score": 0, "creation_date": 1438141439, "post_id": 31690283, "comment_id": 51323049, "body": "Where&#39;s the <code>myApp</code> binary?  Is the <code>&quot;public&quot;</code> directory in the same place?"}, {"owner": {"reputation": 13, "user_id": 5167372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Si4Lm.jpg?s=128&g=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/5167372/jeff"}, "reply_to_user": {"reputation": 941, "user_id": 628561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f7a75c6f93a08da767fdb732789c476?s=128&d=identicon&r=PG", "display_name": "robbyphillips", "link": "https://stackoverflow.com/users/628561/robbyphillips"}, "edited": false, "score": 0, "creation_date": 1438141672, "post_id": 31690283, "comment_id": 51323114, "body": "@oobivat Yes, <code>myApp</code>  binary the same place with <code>main.go</code> and <code>public</code> folder. In <code>public</code> folder i have <code>index.html, css folder &amp; js folder</code>."}, {"owner": {"reputation": 941, "user_id": 628561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f7a75c6f93a08da767fdb732789c476?s=128&d=identicon&r=PG", "display_name": "robbyphillips", "link": "https://stackoverflow.com/users/628561/robbyphillips"}, "edited": false, "score": 0, "creation_date": 1438142924, "post_id": 31690283, "comment_id": 51323449, "body": "Then if <code>public&#47;index.html</code> already exists and contains valid html, that is what you should see. Assuming your setup is as you say, that&#39;s all I can do because, as I said, this already works for me."}, {"owner": {"reputation": 13, "user_id": 5167372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Si4Lm.jpg?s=128&g=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/5167372/jeff"}, "reply_to_user": {"reputation": 941, "user_id": 628561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f7a75c6f93a08da767fdb732789c476?s=128&d=identicon&r=PG", "display_name": "robbyphillips", "link": "https://stackoverflow.com/users/628561/robbyphillips"}, "edited": false, "score": 0, "creation_date": 1438144295, "post_id": 31690283, "comment_id": 51323739, "body": "@oobivat Many thanks, I&#39;ll try to fix it."}, {"owner": {"reputation": 13, "user_id": 5167372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Si4Lm.jpg?s=128&g=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/5167372/jeff"}, "reply_to_user": {"reputation": 941, "user_id": 628561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f7a75c6f93a08da767fdb732789c476?s=128&d=identicon&r=PG", "display_name": "robbyphillips", "link": "https://stackoverflow.com/users/628561/robbyphillips"}, "edited": false, "score": 0, "creation_date": 1438144835, "post_id": 31690283, "comment_id": 51323881, "body": "@oobivat You said, it work for you, here my picture ( <a href=\"http://postimg.org/image/s4wji2s9v/\" rel=\"nofollow noreferrer\">postimg.org/image/s4wji2s9v</a> ), is it the same structure with you?"}, {"owner": {"reputation": 941, "user_id": 628561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f7a75c6f93a08da767fdb732789c476?s=128&d=identicon&r=PG", "display_name": "robbyphillips", "link": "https://stackoverflow.com/users/628561/robbyphillips"}, "edited": false, "score": 0, "creation_date": 1438145444, "post_id": 31690283, "comment_id": 51324033, "body": "What do you see when you go to <code>localhost:8080</code>?"}, {"owner": {"reputation": 13, "user_id": 5167372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Si4Lm.jpg?s=128&g=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/5167372/jeff"}, "edited": false, "score": 0, "creation_date": 1438145646, "post_id": 31690283, "comment_id": 51324104, "body": "I saw list of folders <code>public&#47;</code>, <code>fileserver</code>, <code>main.go</code> , may be i have something went wrong with my config."}, {"owner": {"reputation": 941, "user_id": 628561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f7a75c6f93a08da767fdb732789c476?s=128&d=identicon&r=PG", "display_name": "robbyphillips", "link": "https://stackoverflow.com/users/628561/robbyphillips"}, "edited": false, "score": 0, "creation_date": 1438147332, "post_id": 31690283, "comment_id": 51324680, "body": "Then <code>http.FileServer(http.Dir(&quot;public&quot;))</code> isn&#39;t putting you in the right place for some reason. Try rebuilding the binary.  Keep playing and remember to alway recompile and execute the new binary after changes.  No offense, but I&#39;m done replying here."}, {"owner": {"reputation": 13, "user_id": 5167372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Si4Lm.jpg?s=128&g=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/5167372/jeff"}, "reply_to_user": {"reputation": 941, "user_id": 628561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f7a75c6f93a08da767fdb732789c476?s=128&d=identicon&r=PG", "display_name": "robbyphillips", "link": "https://stackoverflow.com/users/628561/robbyphillips"}, "edited": false, "score": 0, "creation_date": 1438151999, "post_id": 31690283, "comment_id": 51326607, "body": "You&#39;re right @oobivat. I got it, i deleted my binary file and rebuild again, it worked. You saved my life :) thanks."}], "answers": [{"tags": [], "owner": {"reputation": 941, "user_id": 628561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f7a75c6f93a08da767fdb732789c476?s=128&d=identicon&r=PG", "display_name": "robbyphillips", "link": "https://stackoverflow.com/users/628561/robbyphillips"}, "is_accepted": true, "score": 0, "last_activity_date": 1438158151, "creation_date": 1438158151, "answer_id": 31695043, "question_id": 31690283, "link": "https://stackoverflow.com/questions/31690283/first-go-program-doesnt-display-index-page/31695043#31695043", "title": "First go program doesn&#39;t display index page", "body": "<p>This was answered in the comments, so here is a summary for completeness or something.</p>\n\n<p>The code presented in the question produced the expected results after the actual build->run->test->repeat process was clarified for OP.  Points of clarification were as follows:</p>\n\n<ol>\n<li>After using <code>go build</code> to compile the binary, the program isn't running yet.  Be sure to actually execute the binary before trying to connect to the server.</li>\n<li>If it's necessary to make changes, stop the server, run <code>go build</code> again, then run the new binary.</li>\n</ol>\n\n<p>As a side note, <a href=\"https://github.com/codegangsta/gin\" rel=\"nofollow\">gin</a> is a tool that tries to automate this process by rebuilding and launching your program each time you save the file.</p>\n"}], "owner": {"reputation": 13, "user_id": 5167372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Si4Lm.jpg?s=128&g=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/5167372/jeff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 31695043, "answer_count": 1, "score": -1, "last_activity_date": 1438158151, "creation_date": 1438137041, "last_edit_date": 1438137311, "question_id": 31690283, "link": "https://stackoverflow.com/questions/31690283/first-go-program-doesnt-display-index-page", "title": "First go program doesn&#39;t display index page", "body": "<p>I followed creating a basic web app with go, I created the folder with name myApp. In myApp have main.go and public folder(in public have index.html), here is my content in main.go:</p>\n\n<pre><code>package main\nimport \"net/http\"\nimport \"github.com/russross/blackfriday\"\n\nfunc main() {\n  http.HandleFunc(\"/markdown\",  GenerateMarkdown)\n  http.Handle(\"/\",  http.FileServer(http.Dir(\"public\")))\n  http.ListenAndServe(\":8080\", nil)\n}  \n\nfunc GenerateMarkdown(rw http.ResponseWriter, r *http.Request) {\n  markdown := blackfriday.MarkdownCommon([]byte(r.FormValue(\"body\")))\n  rw.Write(markdown)\n}\n</code></pre>\n\n<p>I started server and go to <a href=\"http://localhost:8080/\" rel=\"nofollow\">http://localhost:8080/</a> but it doesn't link to index.html. Can anyone explain why it doesn't render index.html file. I'm a newbie in Golang.</p>\n"}, {"tags": ["pointers", "reflection", "go"], "answers": [{"comments": [{"owner": {"reputation": 18043, "user_id": 405013, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7ef3cd04888c6d17f34d43e29ec3d46f?s=128&d=identicon&r=PG", "display_name": "caarlos0", "link": "https://stackoverflow.com/users/405013/caarlos0"}, "edited": false, "score": 0, "creation_date": 1438140538, "post_id": 31690532, "comment_id": 51322855, "body": "Wow, I was doing some serious wrong stuff there... Many thanks Tim!"}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 4, "last_activity_date": 1438138731, "creation_date": 1438138731, "answer_id": 31690532, "question_id": 31690160, "link": "https://stackoverflow.com/questions/31690160/reflect-setting-a-field-of-a-pointer/31690532#31690532", "title": "Reflect: setting a field of a pointer", "body": "<p>Below is a \"saner\" way of doing what you want. You will notice that, instead of passing in two copies of the struct, we only need a pointer to the struct.</p>\n\n<pre><code>func ParseEnv(val interface{}) {\n    ptrRef := reflect.ValueOf(val)\n    if ptrRef.Kind() != reflect.Ptr {\n        panic(\"pointer to struct expected\")\n    }\n    ref := ptrRef.Elem()\n    if ref.Kind() != reflect.Struct {\n        panic(\"pointer to struct expected\")\n    }\n    refType := ref.Type()\n    for i := 0; i &lt; refType.NumField(); i++ {\n        field := refType.Field(i)\n        value := os.Getenv(field.Tag.Get(\"env\"))\n        if value == \"\" {\n            continue\n        }\n        ref.Field(i).SetString(value)\n    }\n}\n</code></pre>\n\n<p>The above function should be invoked in the following way:</p>\n\n<pre><code>ParseEnv(&amp;env)\n</code></pre>\n\n<p>Example: <a href=\"https://play.golang.org/p/_BwWz2oUql\" rel=\"nofollow\">https://play.golang.org/p/_BwWz2oUql</a></p>\n"}], "owner": {"reputation": 18043, "user_id": 405013, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7ef3cd04888c6d17f34d43e29ec3d46f?s=128&d=identicon&r=PG", "display_name": "caarlos0", "link": "https://stackoverflow.com/users/405013/caarlos0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 31690532, "answer_count": 1, "score": 1, "last_activity_date": 1438139043, "creation_date": 1438136192, "last_edit_date": 1438139043, "question_id": 31690160, "link": "https://stackoverflow.com/questions/31690160/reflect-setting-a-field-of-a-pointer", "title": "Reflect: setting a field of a pointer", "body": "<p>I'm trying to do something like this:</p>\n\n<p>Define structs with tags named <code>env</code>:</p>\n\n<pre><code>type Env struct {\n     Port string `env:\"PORT\"`\n}\n</code></pre>\n\n<p>Call some function which will get the environment variable names using <code>os.Getenv</code> and put set it in the struct.</p>\n\n<p>Right now, I have this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"reflect\"\n)\n\nfunc ParseEnv(t interface{}, v interface{}) {\n    it := reflect.TypeOf(t)\n    for i := 0; i &lt; it.NumField(); i++ {\n        field := it.Field(i)\n        value := os.Getenv(field.Tag.Get(\"env\"))\n        if value == \"\" {\n            continue\n        }\n        reflect.ValueOf(v).Elem().FieldByName(field.Name).SetString(value)\n    }\n}\n\ntype Env struct {\n    Port        string `env:\"PORT\"`\n    DatabaseURL string `env:\"DATABASE_URL\"`\n}\n\nfunc main() {\n    os.Setenv(\"PORT\", \"8080\")\n    os.Setenv(\"DATABASE_URL\", \"postgres://user:pass@host:5432/my-db\")\n    env := Env{}\n    ParseEnv(env, &amp;env)\n    fmt.Println(env)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/b8uPPVo4aV\" rel=\"nofollow\">http://play.golang.org/p/b8uPPVo4aV</a></p>\n\n<p>But, as you can see, I have to pass both the reference and the pointer to my function.</p>\n\n<p>While this works, it is very ugly (at least I think it is).</p>\n\n<p>If I try to pass the pointer only, I can't get the type right (because it will be an <code>*interface{}</code>) and, if I pass only the reference, I can't set the values using <code>reflect</code> (even if I could, it would not work).</p>\n\n<p>Is there a sane way of doing this? </p>\n"}, {"tags": ["vim", "go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 3, "creation_date": 1438134663, "post_id": 31689929, "comment_id": 51321471, "body": "By default, <code>vim-go</code> does not auto-build. You need to explicitly call <code>:GoBuild</code> (or a keybinding that maps to that) as per <a href=\"https://github.com/fatih/vim-go#mappings\" rel=\"nofollow noreferrer\">github.com/fatih/vim-go#mappings</a>  If your installation is automatically building executables, can you explain how you are saving files and/or whether you are running the latest version of vim-go?"}], "answers": [{"tags": [], "owner": {"reputation": 67, "user_id": 4393843, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SMD24CPNLkQ/AAAAAAAAAAI/AAAAAAAAABE/dFnWcyHOJcA/photo.jpg?sz=128", "display_name": "JieMin Xia", "link": "https://stackoverflow.com/users/4393843/jiemin-xia"}, "is_accepted": true, "score": 1, "last_activity_date": 1438224833, "creation_date": 1438224833, "answer_id": 31714459, "question_id": 31689929, "link": "https://stackoverflow.com/questions/31689929/how-to-forbidden-vim-go-auto-build-when-saving-a-go-file/31714459#31714459", "title": "How to forbidden vim-go auto build when saving a *.go file", "body": "<p>Not vim-go but syntastic do this, just config </p>\n\n<p>let g:syntastic_go_checkers = []</p>\n"}], "owner": {"reputation": 67, "user_id": 4393843, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SMD24CPNLkQ/AAAAAAAAAAI/AAAAAAAAABE/dFnWcyHOJcA/photo.jpg?sz=128", "display_name": "JieMin Xia", "link": "https://stackoverflow.com/users/4393843/jiemin-xia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 533, "favorite_count": 0, "accepted_answer_id": 31714459, "answer_count": 1, "score": 0, "last_activity_date": 1438224833, "creation_date": 1438134416, "question_id": 31689929, "link": "https://stackoverflow.com/questions/31689929/how-to-forbidden-vim-go-auto-build-when-saving-a-go-file", "title": "How to forbidden vim-go auto build when saving a *.go file", "body": "<p><a href=\"https://i.stack.imgur.com/l5tji.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/l5tji.png\" alt=\"enter image description here\"></a></p>\n\n<p>I use vim-go, but I don't like it auto build executable file when save a go source file. How to forbidden it?</p>\n"}, {"tags": ["go", "integration-testing"], "comments": [{"owner": {"reputation": 4472, "user_id": 88813, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/81b3151b91c9dfc3d0074cba1a0357c6?s=128&d=identicon&r=PG", "display_name": "Aaron Greenlee", "link": "https://stackoverflow.com/users/88813/aaron-greenlee"}, "edited": false, "score": 0, "creation_date": 1463316838, "post_id": 31685872, "comment_id": 62005918, "body": "Did you ever figure out a way to get the code coverage of these httptest integration tests?"}, {"owner": {"reputation": 18043, "user_id": 405013, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7ef3cd04888c6d17f34d43e29ec3d46f?s=128&d=identicon&r=PG", "display_name": "caarlos0", "link": "https://stackoverflow.com/users/405013/caarlos0"}, "reply_to_user": {"reputation": 4472, "user_id": 88813, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/81b3151b91c9dfc3d0074cba1a0357c6?s=128&d=identicon&r=PG", "display_name": "Aaron Greenlee", "link": "https://stackoverflow.com/users/88813/aaron-greenlee"}, "edited": false, "score": 0, "creation_date": 1463338131, "post_id": 31685872, "comment_id": 62013506, "body": "@AaronGreenlee unfortunately not."}], "answers": [{"comments": [{"owner": {"reputation": 18043, "user_id": 405013, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7ef3cd04888c6d17f34d43e29ec3d46f?s=128&d=identicon&r=PG", "display_name": "caarlos0", "link": "https://stackoverflow.com/users/405013/caarlos0"}, "edited": false, "score": 0, "creation_date": 1438114740, "post_id": 31686065, "comment_id": 51314293, "body": "understood... is there a way to integrate it with my already created handlers? I believe I wasn&#39;t clear... I want to test the same code which goes to production... the routes, middlewares... everything... I&#39;ll study this httptest.Server, but, seems like it will not work with my echo (<a href=\"https://github.com/labstack/echo\" rel=\"nofollow noreferrer\">github.com/labstack/echo</a>) code :/ Thanks, BTW!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 18043, "user_id": 405013, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7ef3cd04888c6d17f34d43e29ec3d46f?s=128&d=identicon&r=PG", "display_name": "caarlos0", "link": "https://stackoverflow.com/users/405013/caarlos0"}, "edited": false, "score": 1, "creation_date": 1438114952, "post_id": 31686065, "comment_id": 51314420, "body": "@caarlos0: the httptest.Server constructors take an http.Handler as their argument. You can plug in whatever handlers, muxers, etc you want, just like you would with the standard http.Server."}, {"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 1, "creation_date": 1499071599, "post_id": 31686065, "comment_id": 76740581, "body": "This is an unit testing example for <code>net&#47;http</code>. Integration tests might be requesting without involving handlers in tests, as if they&#39;re inside of an external remote api."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 8, "last_activity_date": 1438113928, "creation_date": 1438113928, "answer_id": 31686065, "question_id": 31685872, "link": "https://stackoverflow.com/questions/31685872/http-integration-tests/31686065#31686065", "title": "HTTP integration tests", "body": "<p>You can start the http server in your test, and make requests against it.</p>\n\n<p>For more convenience, you can use <a href=\"http://golang.org/pkg/net/http/httptest/#Server\" rel=\"noreferrer\"><code>httptest.Server</code></a> in the test, and give it your primary http.Handler. The <code>httptest.Server</code> has some methods to better control to start and stop the server, and provides a <code>URL</code> field to give you the local address of the server.</p>\n\n<pre><code>ts := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintln(w, \"Hello, client\")\n}))\ndefer ts.Close()\n\nres, err := http.Get(ts.URL)\nif err != nil {\n    log.Fatal(err)\n}\ngreeting, err := ioutil.ReadAll(res.Body)\nres.Body.Close()\nif err != nil {\n    log.Fatal(err)\n}\n\nfmt.Printf(\"%s\", greeting)\n</code></pre>\n"}], "owner": {"reputation": 18043, "user_id": 405013, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7ef3cd04888c6d17f34d43e29ec3d46f?s=128&d=identicon&r=PG", "display_name": "caarlos0", "link": "https://stackoverflow.com/users/405013/caarlos0"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3514, "favorite_count": 2, "accepted_answer_id": 31686065, "answer_count": 1, "score": 9, "last_activity_date": 1577371660, "creation_date": 1438113278, "last_edit_date": 1577371660, "question_id": 31685872, "link": "https://stackoverflow.com/questions/31685872/http-integration-tests", "title": "HTTP integration tests", "body": "<p>I have a small service written in Go. I'm already testing it with <code>httptest</code> et al, but, I'm mocking the database and etc...</p>\n\n<p>What I would like to do:</p>\n\n<ul>\n<li>Start up the very same server I use in production with an empty database</li>\n<li>Run tests against it using HTTP</li>\n<li>Get the coverage of those tests</li>\n</ul>\n\n<p>The empty database part is not a problem, since I made everything configurable via environment variables.</p>\n\n<p>Make requests to it is also not the problem, as it is just standard Go code...</p>\n\n<p>The problem is: I don't know how to start the server in a way that I could measure the coverage of it (and it's sub-packages). Also, the main server code is inside a <code>main</code> function... I don't even know if I can call it from somewhere else (I tried the standard way, but not with reflection and stuff like that).</p>\n\n<p>I'm kind of new using Go, so, this I might be talking nonsense.</p>\n"}, {"tags": ["arrays", "go", "slice"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1438112662, "post_id": 31685620, "comment_id": 51313025, "body": "I recommend spec: <a href=\"http://golang.org/ref/spec#Slice_types\" rel=\"nofollow noreferrer\">Slice types</a>, and <a href=\"http://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">Go Slices: usage and internals</a> and <a href=\"http://blog.golang.org/slices\" rel=\"nofollow noreferrer\">Arrays, slices (and strings): The mechanics of &#39;append&#39;</a>."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1438114644, "last_edit_date": 1592644375, "creation_date": 1438113179, "answer_id": 31685840, "question_id": 31685620, "link": "https://stackoverflow.com/questions/31685620/go-slice-length-is-capacity-1-why/31685840#31685840", "title": "Go slice length is capacity -1, why?", "body": "<p>This line:</p>\n<pre><code>fruits := [4]string{&quot;apple&quot;, &quot;orange&quot;, &quot;mango&quot;}\n</code></pre>\n<p>Creates an <em>array</em>, not a slice. It has 4 elements even though you only supplied 3. Output of <code>fmt.Printf(&quot;%q&quot;, fruits)</code>:</p>\n<pre><code>[&quot;apple&quot; &quot;orange&quot; &quot;mango&quot; &quot;&quot;]\n</code></pre>\n<p>Slicing it:</p>\n<pre><code>tasty_fruits := fruits[1:3]\n</code></pre>\n<p>Results in:</p>\n<pre><code>[&quot;orange&quot; &quot;mango&quot;]\n</code></pre>\n<p>Length: obviously 2. Capacity?</p>\n<blockquote>\n<p>The <em>capacity</em> is ... the sum of the length of the slice and the length of the [underlying] array beyond the slice.</p>\n</blockquote>\n<p>Since there is one element after <code>&quot;mango&quot;</code> in the underlying array, capacity is <code>2 + 1 = 3</code>.</p>\n<p>Indexing the slice (<code>tasty_fruits</code>): spec: <a href=\"http://golang.org/ref/spec#Index_expressions\" rel=\"noreferrer\">Index expressions</a>:</p>\n<blockquote>\n<p>For <code>a</code> of slice type <code>S</code>: <code>a[x]</code></p>\n<ul>\n<li>if <code>x</code> is out of range at run time, a run-time panic occurs</li>\n</ul>\n</blockquote>\n<p><code>x</code> is in range if <code>0 &lt;= x &lt; len(a)</code>, otherwise it is out of range. Since <code>len(tasty_fruits)</code> is <code>2</code>, the index <code>2</code> is out of range, and therefore runtime panic occurs.</p>\n<p>You can't index the slice beyond the length of the slice, even if capacity would allow it. You can only reach the elements beyond the length if you reslice the slice, e.g.:</p>\n<pre><code>tasty_fruits2 := tasty_fruits[:3]\ntasty_fruits2[2] = &quot;nectarine&quot; // This is ok, len(tasty_fruits2) = 3\nfmt.Printf(&quot;%q&quot;, tasty_fruits2)\n</code></pre>\n<p>Output:</p>\n<pre><code>[&quot;orange&quot; &quot;mango&quot; &quot;nectarine&quot;]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1438113735, "post_id": 31685913, "comment_id": 51313707, "body": "Slicing does <i>not</i> copy elements. And the source is an <i>array</i>, not a slice, and the array <i>does</i> have 4 elements. See my answer."}], "tags": [], "owner": {"reputation": 115, "user_id": 3289910, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e308c23a78bcf743326772f2e82598f?s=128&d=identicon&r=PG&f=1", "display_name": "Brasilikum", "link": "https://stackoverflow.com/users/3289910/brasilikum"}, "is_accepted": false, "score": -2, "last_activity_date": 1438113411, "creation_date": 1438113411, "answer_id": 31685913, "question_id": 31685620, "link": "https://stackoverflow.com/questions/31685620/go-slice-length-is-capacity-1-why/31685913#31685913", "title": "Go slice length is capacity -1, why?", "body": "<p>You are creating a slice with the capacity of 3 (because [1:3] could contain 3 elements: 1,2 and 3). But as the slice you are copying from does not contain an element on 3, only 1 and 2 are copied. </p>\n"}, {"tags": [], "owner": {"reputation": 2006, "user_id": 1567953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8e6e5b86384bc9031eec21f49d9ef5f?s=128&d=identicon&r=PG", "display_name": "lavin", "link": "https://stackoverflow.com/users/1567953/lavin"}, "is_accepted": false, "score": 0, "last_activity_date": 1438113522, "creation_date": 1438113522, "answer_id": 31685948, "question_id": 31685620, "link": "https://stackoverflow.com/questions/31685620/go-slice-length-is-capacity-1-why/31685948#31685948", "title": "Go slice length is capacity -1, why?", "body": "<p>The capacity of a slice depends on the size of the underlying array.\nSo if you change <code>fruits</code> to have a difference size, for example:</p>\n\n<pre><code>fruits := [5]string{\"apple\", \"orange\", \"mango\"}\n</code></pre>\n\n<p>cap(tasty_fruits) will return 4 instead of 3. </p>\n\n<p>So capacity means the maximum size of the slice can be extended to. \"A slice cannot be grown beyond its capacity. Attempting to do so will cause a runtime panic\".</p>\n\n<p>And slices are essentially <code>c</code> pointers with boundary check. The length of a slices, is the boundary it will check during run time. As a result, if you try to access anything beyond length, a runtime panic will also be caused.</p>\n\n<p>And yes length &lt;= capacity is always true.</p>\n\n<p>For more details please read <a href=\"http://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow\">Go Slices: usage and internals</a></p>\n"}, {"tags": [], "owner": {"reputation": 3976, "user_id": 97238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa3afb9c3589ea91c866030babaeee64?s=128&d=identicon&r=PG", "display_name": "ade", "link": "https://stackoverflow.com/users/97238/ade"}, "is_accepted": false, "score": -1, "last_activity_date": 1438114080, "creation_date": 1438114080, "answer_id": 31686096, "question_id": 31685620, "link": "https://stackoverflow.com/questions/31685620/go-slice-length-is-capacity-1-why/31686096#31686096", "title": "Go slice length is capacity -1, why?", "body": "<p>As documented here: <a href=\"http://blog.golang.org/slices\" rel=\"nofollow\">http://blog.golang.org/slices</a> \"The Capacity field records how much space the underlying array actually has; it is the maximum value the Length can reach. Trying to grow the slice beyond its capacity will step beyond the limits of the array and will trigger a panic.\"</p>\n"}], "owner": {"reputation": 842, "user_id": 875382, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/f836e92fb6391c7d33d6cc85f2bb0858?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/875382/thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 539, "favorite_count": 1, "accepted_answer_id": 31685840, "answer_count": 4, "score": 1, "last_activity_date": 1438114644, "creation_date": 1438112428, "question_id": 31685620, "link": "https://stackoverflow.com/questions/31685620/go-slice-length-is-capacity-1-why", "title": "Go slice length is capacity -1, why?", "body": "<p>Consider the go code below:</p>\n\n<pre><code>fruits := [4]string{\"apple\", \"orange\", \"mango\"}\ntasty_fruits := fruits[1:3]\nfmt.Println(len(tasty_fruits))\nfmt.Println(cap(tasty_fruits))\nfmt.Println(tasty_fruits)\n</code></pre>\n\n<p>Ouputs:</p>\n\n<pre><code>2\n3\n[orange mango]\n</code></pre>\n\n<p>What I don't understand is why is the capacity of tasty_fruits 3, intuitively I would expect it to be 2 since that is the length of the slice?  </p>\n\n<p>And if the capacity of tasty_fruits is 3 why does:</p>\n\n<pre><code>tasty_fruits[2] = \"nectarine\"\n</code></pre>\n\n<p>result in:</p>\n\n<pre><code>panic: runtime error: index out of range\n</code></pre>\n"}, {"tags": ["string", "go", "command-line-arguments"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1438111464, "post_id": 31684942, "comment_id": 51312346, "body": "Go never sees the `\\`, it&#39;s a special character interpreted by the shell."}, {"owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438111527, "post_id": 31684942, "comment_id": 51312379, "body": "@JimB So the only way to pass the argument as-is is to use quotes (-string=&quot;hello\\Bob&quot;)?"}, {"owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438111583, "post_id": 31684942, "comment_id": 51312415, "body": "(I wondered if that was the case, but wanted to confirm I wasn&#39;t missing something, as I&#39;ve tested a few variations of reading the flag input and it wasn&#39;t showing the backslash)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438111765, "post_id": 31684942, "comment_id": 51312516, "body": "yes; or double escape the backslash , or both depending on what you need."}, {"owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438111804, "post_id": 31684942, "comment_id": 51312537, "body": "@JimB If you add this as an answer, I&#39;ll accept it... Thanks for the confirmation!"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1438112128, "creation_date": 1438112128, "answer_id": 31685550, "question_id": 31684942, "link": "https://stackoverflow.com/questions/31684942/backslashes-are-removed-unless-quoted-in-command-line-flags/31685550#31685550", "title": "Backslashes are removed unless quoted in command line flags", "body": "<p>Characters that have special meaning in the shell need to be quoted or escaped. You can find complete list in the shell's man pages (under \"Quoting\" in <code>man 1 bash</code>). </p>\n\n<p>In this case, you can either quote or escape the baskslash</p>\n\n<pre><code>-string=hello\\\\Bob\n// or\n-string='hello\\Bob'\n</code></pre>\n"}], "owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "accepted_answer_id": 31685550, "answer_count": 1, "score": -1, "last_activity_date": 1438112128, "creation_date": 1438110019, "question_id": 31684942, "link": "https://stackoverflow.com/questions/31684942/backslashes-are-removed-unless-quoted-in-command-line-flags", "title": "Backslashes are removed unless quoted in command line flags", "body": "<p>I'm using the flag package to interpret flags entered at the command line.</p>\n\n<p>I created a variable using</p>\n\n<pre><code>ptrString := flag.String(\"string\", \"\", \"A test string\")\nflat.Parse()\n</code></pre>\n\n<p>Then when I want to print it,</p>\n\n<pre><code>fmt.Println(\"You entered \" + *ptrString)\n</code></pre>\n\n<p>If I enter something like -string=hello! as a command line argument, it prints \"hello!\"</p>\n\n<p>If I enter something like -string=hello\\Bob as a command line argument, it prints \"helloBob\"</p>\n\n<p>Is there a recommended way to convert or interpret the flag argument to a string that doesn't remove the backslash? (This is being tested on Linux and OS X, if the shell is interfering...)</p>\n"}, {"tags": ["go", "garbage-collection"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 3, "creation_date": 1438109840, "post_id": 31684862, "comment_id": 51311412, "body": "Interesting question, it might be a better fit for golang-nuts, though."}, {"owner": {"reputation": 339644, "user_id": 118068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/077db5466d3b58e7bbbd498dca173f04?s=128&d=identicon&r=PG", "display_name": "Marc B", "link": "https://stackoverflow.com/users/118068/marc-b"}, "edited": false, "score": 1, "creation_date": 1438109911, "post_id": 31684862, "comment_id": 51311443, "body": "ram size doesn&#39;t matter. ram USAGE matters. if you only ever use a few gigs of that ram, a GC cycle only has to deal with those few gigs. if you allocate the full TB as a single block, again that&#39;s trivial to deal with. &quot;is this pointer still in use?&quot;"}, {"owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "edited": false, "score": 0, "creation_date": 1438109936, "post_id": 31684862, "comment_id": 51311454, "body": "yes, i of course meant ram usage :)"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1438110113, "post_id": 31684862, "comment_id": 51311567, "body": "I would just guess the scaling is linear. At the end of the day you have to iterate the addressable memory checking every word. You could use some kind of quick sort esq optimization but why would one gc do this better than another?"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 2, "creation_date": 1438110548, "post_id": 31684862, "comment_id": 51311828, "body": "One of <a href=\"https://talks.golang.org/2015/go-gc.pdf\" rel=\"nofollow noreferrer\">the GC GopherCon talk&#39;s slides</a> shows a low latency (tiny fraction of a second) on roughly 18-19GB of data. At the same time, it&#39;s <i>not</i> showing tests on 200GB, so if you have a GC-benchmark-like application (fast allocation rate and lots of pointers) and a heap that size you may be in new territory."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438115843, "post_id": 31684862, "comment_id": 51314986, "body": "Wrote up what we do know and some general information about GC; hoping we find out more from go-nuts or such and I can update it with that."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1438118444, "post_id": 31684862, "comment_id": 51316368, "body": "Do note that as of go1.5, the heap size is limited to 512GB on non-windows 64bit machines (windows is limited to 32GB).  You need to modify the runtime to work with a larger arena, which is needless to say, not well tested."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438121527, "post_id": 31684862, "comment_id": 51317729, "body": "Heh, good point, revised answer below in light of a TB heap being impossible. :)"}, {"owner": {"reputation": 34798, "user_id": 1362755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97aa8c37ffa60c4262955aefae56e605?s=128&d=identicon&r=PG", "display_name": "the8472", "link": "https://stackoverflow.com/users/1362755/the8472"}, "edited": false, "score": 0, "creation_date": 1438165210, "post_id": 31684862, "comment_id": 51334782, "body": "<i>Java cannot use terabytes of RAM because the gc pause is way too long (minutes).</i> the Zing JVM supposedly is able to handle such large heaps. Plus that only concerns on-heap memory. you can allocate very large chunks of off-heap data without affecting the GCs."}, {"owner": {"reputation": 7208, "user_id": 1402453, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b901ed2c8433cd33ebbc1ad2085eea51?s=128&d=identicon&r=PG", "display_name": "Alexey Ragozin", "link": "https://stackoverflow.com/users/1402453/alexey-ragozin"}, "edited": false, "score": 0, "creation_date": 1438399204, "post_id": 31684862, "comment_id": 51449056, "body": "<i>Java cannot use terabytes of RAM because the gc pause is way too long (minutes)</i>. FYI I have JVM&#39;s with 400 GiB of heap in production and pauses are within 300ms. Not terabytes, of cause."}], "answers": [{"comments": [{"owner": {"reputation": 586, "user_id": 1932601, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9Rycr.png?s=128&g=1", "display_name": "itadapter DKh", "link": "https://stackoverflow.com/users/1932601/itadapter-dkh"}, "edited": false, "score": 0, "creation_date": 1438220042, "post_id": 31686469, "comment_id": 51365312, "body": "Not Java, but CLR, we can store hundreds of millions of objects in cache  allocating byte[]. The GC approach is slow no matter how you go about it. <a href=\"https://youtu.be/Dz_7hukyejQ\" rel=\"nofollow noreferrer\">youtu.be/Dz_7hukyejQ</a>"}, {"owner": {"reputation": 586, "user_id": 1932601, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9Rycr.png?s=128&g=1", "display_name": "itadapter DKh", "link": "https://stackoverflow.com/users/1932601/itadapter-dkh"}, "edited": false, "score": 0, "creation_date": 1438220182, "post_id": 31686469, "comment_id": 51365350, "body": "Whats interesting that efficient serialization yields faster performance than allocating &quot;real objects&quot; in a heap. Maybe in Java someone else did a similar approach? <a href=\"https://github.com/aumcode/nfx/blob/master/Source/NFX/ApplicationModel/Pile/IPile.cs\" rel=\"nofollow noreferrer\">github.com/aumcode/nfx/blob/master/Source/NFX/ApplicationMod&zwnj;&#8203;el/&hellip;</a>"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "reply_to_user": {"reputation": 586, "user_id": 1932601, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9Rycr.png?s=128&g=1", "display_name": "itadapter DKh", "link": "https://stackoverflow.com/users/1932601/itadapter-dkh"}, "edited": false, "score": 0, "creation_date": 1438227122, "post_id": 31686469, "comment_id": 51366989, "body": "Yeah, you&#39;re always OK if you just manage <code>[]byte</code>s, as a special case of those general observations about GC. I tried to lay out those wrinkles, but I think it&#39;s not a full answer to the question asked to just talk about that one approach."}], "tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": true, "score": 13, "last_activity_date": 1489358467, "last_edit_date": 1495535402, "creation_date": 1438115420, "answer_id": 31686469, "question_id": 31684862, "link": "https://stackoverflow.com/questions/31684862/how-fast-is-the-go-1-5-gc-with-terabytes-of-ram/31686469#31686469", "title": "How fast is the go 1.5 gc with terabytes of RAM?", "body": "<p><strong>tl;dr</strong>:</p>\n\n<ul>\n<li>You can't use TBs of RAM with a single Go process right now. Max is 512 GB on Linux, and most that I've seen tested is 240 GB.</li>\n<li>With the current background GC, GC <em>workload</em> tends to be more important than GC <em>pauses</em>.</li>\n<li>You can understand GC workload as <em>pointers</em> * <em>allocation rate</em> / <em>spare RAM</em>. Of apps using tons of RAM, only those with few pointers or little allocation will have a low GC workload. </li>\n</ul>\n\n<hr>\n\n<p>I agree with inf's comment that huge heaps are worth asking other folks about (or testing). JimB notes that Go heaps have a hard limit of 512 GB right now, and <s>18</s> 240 GB is the most I've seen tested.</p>\n\n<p>Some things we know about huge heaps, from <a href=\"https://docs.google.com/document/d/16Y4IsnNRCN43Mx0NZc5YXZLovrHvvLhK_h0KN8woTO4/edit\" rel=\"nofollow noreferrer\">the design document</a> and <a href=\"https://talks.golang.org/2015/go-gc.pdf\" rel=\"nofollow noreferrer\">the GopherCon 2015 slides</a>: </p>\n\n<ul>\n<li>The 1.5 collector doesn't aim to cut GC <em>work</em>, just cut <em>pauses</em> by working in the background.</li>\n<li>Your code is paused while the GC scans pointers on the stack and in globals.</li>\n<li><p>The 1.5 GC has a short pause on a GC benchmark with a roughly 18GB heap, as shown by the rightmost yellow dot along the bottom of <a href=\"https://talks.golang.org/2015/go-gc.pdf\" rel=\"nofollow noreferrer\">this graph from the GopherCon talk</a>:</p>\n\n<p><a href=\"https://i.stack.imgur.com/4TOux.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4TOux.png\" alt=\"GC Pauses vs. Heap Size showing well GCs of 18GB at multiple seconds under old versions and under 1 second for 1.5\"></a></p></li>\n</ul>\n\n<p>Folks running a couple production apps that initially had about 300ms pauses reported drops to <a href=\"https://twitter.com/mkevac/status/620872308446625792/photo/1\" rel=\"nofollow noreferrer\">~4ms</a> and <a href=\"https://twitter.com/brianhatfield/status/634166123605331968/photo/1\" rel=\"nofollow noreferrer\">~20ms</a>. Another app reported their 95th percentile GC time went from <a href=\"https://medium.com/@robin.verlangen/billions-of-request-per-day-meet-go-1-5-362bfefa0911\" rel=\"nofollow noreferrer\">279ms to ~10ms</a>.</p>\n\n<p>Go 1.6 <a href=\"https://docs.google.com/document/d/1kBx98ulj5V5M9Zdeamy7v6ofZXX3yPziAf0V27A64Mo/edit\" rel=\"nofollow noreferrer\">added polish and pushed some of the remaining work to the background</a>. As a result, tests with heaps up to a bit over 200GB still saw a max pause time of 20ms, as shown in <a href=\"http://talks.golang.org/2016/state-of-go.slide#38\" rel=\"nofollow noreferrer\">a slide</a> in an early 2016 <a href=\"http://talks.golang.org/2016/state-of-go.slide\" rel=\"nofollow noreferrer\">State of Go talk</a>:</p>\n\n<p><a href=\"https://i.stack.imgur.com/Qc9SI.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Qc9SI.png\" alt=\"Graph of 1.6 GC times, hitting 20ms around 180GB\"></a></p>\n\n<p>The same application that had 20ms pause times under 1.5 had <a href=\"https://twitter.com/brianhatfield/status/692778741567721473\" rel=\"nofollow noreferrer\">3-4ms pauses under 1.6, with about an 8GB heap and 150M allocations/minute</a>. </p>\n\n<p>Twitch, who use Go for their chat service, reported that <a href=\"https://blog.twitch.tv/gos-march-to-low-latency-gc-a6fa96f06eb7#.9lsrreb5u\" rel=\"nofollow noreferrer\">by Go 1.7 pause times had been reduced to 1ms with lots of running goroutines</a>. </p>\n\n<p>1.8 <a href=\"https://groups.google.com/d/msg/golang-dev/Ab1sFeoZg_8/_DaL0E8fAwAJ\" rel=\"nofollow noreferrer\">took stack scanning out of the stop-the-world phase</a>, bringing most pauses well under 1ms, even on large heaps. <a href=\"https://twitter.com/brianhatfield/status/804355831080751104\" rel=\"nofollow noreferrer\">Early numbers look good</a>.  Occasionally applications still have code patterns that make a goroutine hard to pause, effectively lengthening the pause for all other threads, but generally it's fair to say the GC's <em>background work</em> is now usually much more important than GC <em>pauses</em>.</p>\n\n<hr>\n\n<p>Some general observations on garbage collection, not specific to Go:</p>\n\n<ul>\n<li>The <em>frequency</em> of collections depends on how quickly you use up the RAM you're willing to give to the process.</li>\n<li>The <em>amount of work</em> each collection does depends in part on how many pointers are in use. \n(That includes <a href=\"https://stackoverflow.com/questions/23542989/pointers-vs-values-in-parameters-and-return-values/23551970#23551970\">the pointers within slices, interface values, strings, etc.</a>)</li>\n</ul>\n\n<p>Rephrased, an application accessing lots of memory might still not have a GC problem if it only has a few pointers (e.g., it handles relatively few large <code>[]byte</code> buffers), and collections happen less often if the allocation rate is low (e.g., because you applied <code>sync.Pool</code> to reuse memory wherever you were chewing through RAM most quickly).</p>\n\n<p>So if you're looking at something involving heaps of hundreds of GB that's not naturally GC-friendly, I'd suggest you consider any of </p>\n\n<ol>\n<li>writing in C or such</li>\n<li>moving the bulky data out of the object graph. For example, you could manage data in an embedded DB like <a href=\"https://github.com/boltdb/bolt\" rel=\"nofollow noreferrer\"><code>bolt</code></a>, put it in an outside DB service, or use something like <a href=\"https://github.com/golang/groupcache\" rel=\"nofollow noreferrer\"><code>groupcache</code></a> or memcache if you want more of a cache than a DB</li>\n<li>running a set of smaller-heap'd processes instead of one big one</li>\n<li>just carefully prototyping, testing, and optimizing to avoid memory issues.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 1902, "user_id": 396079, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/5d537347eb54566c1b9d975a30fc0147?s=128&d=identicon&r=PG", "display_name": "Henry Story", "link": "https://stackoverflow.com/users/396079/henry-story"}, "is_accepted": false, "score": 1, "last_activity_date": 1564127117, "creation_date": 1564127117, "answer_id": 57215399, "question_id": 31684862, "link": "https://stackoverflow.com/questions/31684862/how-fast-is-the-go-1-5-gc-with-terabytes-of-ram/57215399#57215399", "title": "How fast is the go 1.5 gc with terabytes of RAM?", "body": "<p>The new Java <a href=\"https://wiki.openjdk.java.net/display/zgc/Main\" rel=\"nofollow noreferrer\">ZGC</a> garbage collector can now use 16 Terrabytes of memory and garbage collect in under 10ms.</p>\n"}], "owner": {"reputation": 12289, "user_id": 596041, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/9eb6a78f4a48d143d59966fceec3c655?s=128&d=identicon&r=PG", "display_name": "Filip Haglund", "link": "https://stackoverflow.com/users/596041/filip-haglund"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3862, "favorite_count": 3, "accepted_answer_id": 31686469, "answer_count": 2, "score": 18, "last_activity_date": 1564127117, "creation_date": 1438109712, "last_edit_date": 1470154166, "question_id": 31684862, "link": "https://stackoverflow.com/questions/31684862/how-fast-is-the-go-1-5-gc-with-terabytes-of-ram", "title": "How fast is the go 1.5 gc with terabytes of RAM?", "body": "<p>Java cannot use terabytes of RAM because the GC pause is way too long (minutes). With the recent update to the Go GC, I'm wondering if its GC pauses are short enough for use with huge amounts of RAM, such as a couple of terabytes.</p>\n\n<p>Are there any benchmarks of this yet? Can we use a garbage-collected language with this much RAM now?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 1, "creation_date": 1438103078, "post_id": 31682707, "comment_id": 51307237, "body": "Are you parsing attributes? <a href=\"http://stackoverflow.com/questions/317053/regular-expression-for-extracting-tag-attributes\" title=\"regular expression for extracting tag attributes\">stackoverflow.com/questions/317053/&hellip;</a>"}, {"owner": {"reputation": 411, "user_id": 3011331, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1373ada708df2e3cecf0d3b5a6bb037b?s=128&d=identicon&r=PG&f=1", "display_name": "Gary", "link": "https://stackoverflow.com/users/3011331/gary"}, "reply_to_user": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438103869, "post_id": 31682707, "comment_id": 51307716, "body": "Yes kind of. I want to be able to have a pair or double quotes or no quotes at all. Perhaps this is more complicated?"}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438104274, "post_id": 31682707, "comment_id": 51307976, "body": "Sorry, it is still a bit unclear to me. Do you simply want to get the value without quotes? In this case just get everything after <code>=</code> and trim <code>&quot;</code>."}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438104299, "post_id": 31682707, "comment_id": 51307996, "body": "Actually, would be nice to have several use cases like <code>input-output</code>."}, {"owner": {"reputation": 411, "user_id": 3011331, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1373ada708df2e3cecf0d3b5a6bb037b?s=128&d=identicon&r=PG&f=1", "display_name": "Gary", "link": "https://stackoverflow.com/users/3011331/gary"}, "reply_to_user": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438105833, "post_id": 31682707, "comment_id": 51308996, "body": "Sorry for the ambiguity, I have added an input and expected matches section."}], "answers": [{"comments": [{"owner": {"reputation": 411, "user_id": 3011331, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1373ada708df2e3cecf0d3b5a6bb037b?s=128&d=identicon&r=PG&f=1", "display_name": "Gary", "link": "https://stackoverflow.com/users/3011331/gary"}, "edited": false, "score": 0, "creation_date": 1438104201, "post_id": 31683168, "comment_id": 51307920, "body": "The second match is:  <code>MATCHES [token=&quot;llll&quot; &quot;llll&quot;] 2</code>  Is it possible not to have the quotes in the match?"}, {"owner": {"reputation": 1555, "user_id": 4959722, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-AQWZF9OmEs4/AAAAAAAAAAI/AAAAAAAAAGE/wvp_7UFCeZs/photo.jpg?sz=128", "display_name": "James Buck", "link": "https://stackoverflow.com/users/4959722/james-buck"}, "reply_to_user": {"reputation": 411, "user_id": 3011331, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1373ada708df2e3cecf0d3b5a6bb037b?s=128&d=identicon&r=PG&f=1", "display_name": "Gary", "link": "https://stackoverflow.com/users/3011331/gary"}, "edited": false, "score": 0, "creation_date": 1438105509, "post_id": 31683168, "comment_id": 51308787, "body": "@Gary Unfortunately then, the best other way I can think of doing it is the way you initially said but having an empty group. This is because when <code>&quot;</code> are included, capturing group 3 will be empty, but when there are no quotes group 2 will by empty - either way you are left with 1 empty group. It would be easy to get rid of the quotes in my method if the Go regex engine supported lookbehinds or conditionals, but it does not."}], "tags": [], "owner": {"reputation": 1555, "user_id": 4959722, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-AQWZF9OmEs4/AAAAAAAAAAI/AAAAAAAAAGE/wvp_7UFCeZs/photo.jpg?sz=128", "display_name": "James Buck", "link": "https://stackoverflow.com/users/4959722/james-buck"}, "is_accepted": false, "score": 1, "last_activity_date": 1438104155, "creation_date": 1438104155, "answer_id": 31683168, "question_id": 31682707, "link": "https://stackoverflow.com/questions/31682707/golang-regexp-quote-submatch/31683168#31683168", "title": "Golang Regexp Quote submatch", "body": "<p>Try the following:</p>\n\n<p><code>authRegexp := regexp.MustCompile(\"^token=(.*?|\\\".*?\\\")$\")</code><br>\n<a href=\"http://play.golang.org/p/K4_Y5XYgW3\" rel=\"nofollow\">Demo here</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 1555, "user_id": 4959722, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-AQWZF9OmEs4/AAAAAAAAAAI/AAAAAAAAAGE/wvp_7UFCeZs/photo.jpg?sz=128", "display_name": "James Buck", "link": "https://stackoverflow.com/users/4959722/james-buck"}, "edited": false, "score": 0, "creation_date": 1438118695, "post_id": 31683937, "comment_id": 51316487, "body": "Although this allows for unbalanced quotes."}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "reply_to_user": {"reputation": 1555, "user_id": 4959722, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-AQWZF9OmEs4/AAAAAAAAAAI/AAAAAAAAAGE/wvp_7UFCeZs/photo.jpg?sz=128", "display_name": "James Buck", "link": "https://stackoverflow.com/users/4959722/james-buck"}, "edited": false, "score": 0, "creation_date": 1438119027, "post_id": 31683937, "comment_id": 51316662, "body": "Definitely. That&#39;s why I&#39;d asked for test cases."}, {"owner": {"reputation": 1555, "user_id": 4959722, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-AQWZF9OmEs4/AAAAAAAAAAI/AAAAAAAAAGE/wvp_7UFCeZs/photo.jpg?sz=128", "display_name": "James Buck", "link": "https://stackoverflow.com/users/4959722/james-buck"}, "edited": false, "score": 1, "creation_date": 1438119555, "post_id": 31683937, "comment_id": 51316889, "body": "&quot;I dont want to be able to have mismatched quotes or anything&quot; - I just assumed he didn&#39;t want to allow this kind of thing. Just wanted to raise his attention to it in case it produces some unexpected behaviour."}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 2, "last_activity_date": 1438106696, "creation_date": 1438106696, "answer_id": 31683937, "question_id": 31682707, "link": "https://stackoverflow.com/questions/31682707/golang-regexp-quote-submatch/31683937#31683937", "title": "Golang Regexp Quote submatch", "body": "<p>Ok, that's it: <a href=\"http://play.golang.org/p/h2w-9-XFAt\" rel=\"nofollow\">http://play.golang.org/p/h2w-9-XFAt</a></p>\n\n<p>Regex: <code>^token=\"?([^\"]*)\"?$</code></p>\n\n<pre><code>MATCHES [token=llll llll] 2\nMATCHES [token=\"llll\" llll] 2\n</code></pre>\n"}], "owner": {"reputation": 411, "user_id": 3011331, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1373ada708df2e3cecf0d3b5a6bb037b?s=128&d=identicon&r=PG&f=1", "display_name": "Gary", "link": "https://stackoverflow.com/users/3011331/gary"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2645, "favorite_count": 0, "accepted_answer_id": 31683937, "answer_count": 2, "score": 1, "last_activity_date": 1554206927, "creation_date": 1438102718, "last_edit_date": 1554206927, "question_id": 31682707, "link": "https://stackoverflow.com/questions/31682707/golang-regexp-quote-submatch", "title": "Golang Regexp Quote submatch", "body": "<p>I am trying to extract a submatch value from a regexp but to all for it to disregard a set of quotes if necessary. So far I have this:</p>\n\n<p>url: <a href=\"http://play.golang.org/p/lcKLKmi1El\" rel=\"nofollow noreferrer\">http://play.golang.org/p/lcKLKmi1El</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"regexp\"\n\nfunc main() {\n  authRegexp := regexp.MustCompile(\"^token=(?:\\\"(.*)\\\"|(.*))$\")\n\n  matches := authRegexp.FindStringSubmatch(\"token=llll\")\n  fmt.Println(\"MATCHES\", matches, len(matches))\n\n  matches = authRegexp.FindStringSubmatch(\"token=\\\"llll\\\"\")\n  fmt.Println(\"MATCHES\", matches, len(matches))\n}\n</code></pre>\n\n<p><code>Input</code>::<code>Expected Matches</code></p>\n\n<p><code>token=llll</code>::<code>[token=llll llll]</code></p>\n\n<p><code>token=\"llll\"</code>::<code>[token=\"llll\" llll]</code></p>\n\n<p>Also note that I want to test for either no quotes, or a single set of quotes. I don't want to be able to have mismatched quotes or anything.</p>\n\n<p>How do I get rid of the empty string that is returned? Is there a better regex to get rid of the quotes?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 1, "last_activity_date": 1438099724, "last_edit_date": 1438099724, "creation_date": 1438099086, "answer_id": 31681494, "question_id": 31681356, "link": "https://stackoverflow.com/questions/31681356/handle-array-of-ids-in-a-request-using-gorilla-mux/31681494#31681494", "title": "Handle array of ids in a request using gorilla/mux", "body": "<p>You do not need to specify the parameter for that as the query string parameters go into the corresponding collection of the HttpRequest.</p>\n\n<p>The following code shows how to handle them:</p>\n\n<pre><code>r.HandleFunc(\"/objects\", func(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hello! Parameters: %v\", r.URL.Query())\n})\n</code></pre>\n\n<p>See <a href=\"https://golang.org/pkg/net/url/#pkg-examples\" rel=\"nofollow\">https://golang.org/pkg/net/url/#pkg-examples</a> on how to deal with URL query string parameters.</p>\n"}], "owner": {"reputation": 4829, "user_id": 2754218, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/6e87368666dbd25ad4288859d10fda55?s=128&d=identicon&r=PG", "display_name": "Jean Lebrument", "link": "https://stackoverflow.com/users/2754218/jean-lebrument"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1729, "favorite_count": 1, "accepted_answer_id": 31681494, "answer_count": 1, "score": 4, "last_activity_date": 1438099724, "creation_date": 1438098728, "question_id": 31681356, "link": "https://stackoverflow.com/questions/31681356/handle-array-of-ids-in-a-request-using-gorilla-mux", "title": "Handle array of ids in a request using gorilla/mux", "body": "<p>I need to handle such a request using gorilla/mux: </p>\n\n<p><code>/objects?id=JDYsh939&amp;id=OYBpo726</code></p>\n\n<p>As I understood while reading the documentation, I can specify a pattern like this: <code>{name:pattern}</code> but I don't know if it's would work to specify that the url will contain several times the id parameter. </p>\n\n<p>Any ideas?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1438096679, "post_id": 31679929, "comment_id": 51302713, "body": "The go regexp package (and RE2) doesn&#39;t support backreferences."}, {"owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1438106626, "post_id": 31679929, "comment_id": 51309532, "body": "@DaveC yes, it will make <code>John&#39;s book</code> as <code>John&#39;S Book</code>, with regex, even at such limited support as in Go, you can avoid such behaviour, in this case just something like this will work <code>[^&#39;]\\b([a-z])</code>."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 2, "creation_date": 1438109790, "post_id": 31679929, "comment_id": 51311384, "body": "@MikeKlemin -- edited it to &quot;imprecise,&quot; which seems to be nearer the meaning you described -- hope that gets across what you were trying to say"}], "answers": [{"tags": [], "owner": {"reputation": 2939, "user_id": 2089182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uS6EF.png?s=128&g=1", "display_name": "Dzienny", "link": "https://stackoverflow.com/users/2089182/dzienny"}, "is_accepted": true, "score": 3, "last_activity_date": 1438095784, "creation_date": 1438095784, "answer_id": 31680154, "question_id": 31679929, "link": "https://stackoverflow.com/questions/31679929/golang-regexp-replaceallstrings-with-backreference-doesnt-quite-work/31680154#31680154", "title": "golang regexp ReplaceAllStrings with backreference doesn&#39;t quite work", "body": "<p>You should use <code>ReplaceAllStringFunc</code>, example:</p>\n\n<pre><code>re.ReplaceAllStringFunc(\"my test string\", func(s string) string {\n                                          return strings.ToUpper(s)})\n</code></pre>\n\n<p>See working <a href=\"https://play.golang.org/p/Oil1S9-diy\" rel=\"nofollow\">demo</a>.</p>\n\n<p>Your code doesn't work because:</p>\n\n<pre><code>re.ReplaceAllString(\"my test string\", strings.ToUpper(\"$1\"))\n</code></pre>\n\n<p>is the same as:</p>\n\n<pre><code>re.ReplaceAllString(\"my test string\", \"$1\")\n</code></pre>\n\n<p>since the upper case of <code>$1</code> is still <code>$1</code>.</p>\n"}], "owner": {"reputation": 717, "user_id": 1754290, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/WG1Wc.jpg?s=128&g=1", "display_name": "MikeKlemin", "link": "https://stackoverflow.com/users/1754290/mikeklemin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 746, "favorite_count": 0, "accepted_answer_id": 31680154, "answer_count": 1, "score": -1, "last_activity_date": 1438109740, "creation_date": 1438095210, "last_edit_date": 1438109740, "question_id": 31679929, "link": "https://stackoverflow.com/questions/31679929/golang-regexp-replaceallstrings-with-backreference-doesnt-quite-work", "title": "golang regexp ReplaceAllStrings with backreference doesn&#39;t quite work", "body": "<p>Trying to capitalize each letter at begin of the word. I know that there is <code>strings.Title</code>, but that is too imprecise for my needs. </p>\n\n<p>I am not sure why this does not work:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n    \"strings\"\n)\n\nfunc main() {\n    re := regexp.MustCompile(`\\b([a-z])`)\n    fmt.Println(re.ReplaceAllString(\"my test string\", strings.ToUpper(\"$1\")))\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/C-8QG1FrOi\" rel=\"nofollow\">https://play.golang.org/p/C-8QG1FrOi</a></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 21955, "user_id": 639295, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Qbykb.jpg?s=128&g=1", "display_name": "aychedee", "link": "https://stackoverflow.com/users/639295/aychedee"}, "edited": false, "score": 0, "creation_date": 1438101177, "post_id": 31679437, "comment_id": 51306028, "body": "Thanks Jim, after properly reading through the code for <code>c.serve</code> I realised that doing it at this level wouldn&#39;t be useful anyway, because the traffic is all coming from one endpoint (RTB Exchange) and the requests I really wanted to filter were arriving after this inside the go routines."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1438095727, "last_edit_date": 1438095727, "creation_date": 1438094110, "answer_id": 31679437, "question_id": 31679000, "link": "https://stackoverflow.com/questions/31679000/overriding-http-server-serve/31679437#31679437", "title": "Overriding http.Server.Serve", "body": "<p>Unfortunately, you're not going to be able to do that without reimplementing most of the Server code. Short of that, we usually intercept the call either just before at <code>conn.Accept</code>, or just after at <code>Handler.ServerHTTP</code>.</p>\n\n<p>The first method is to create a custom <code>net.Listener</code> that filters out connections before they are even handed off to the <code>http.Server</code>. While this can respond faster, and consume fewer resources, it however makes it less convenient to write http responses, and precludes you from limiting requests on already open connections.</p>\n\n<p>The second way to handle this, is to just wrap the handlers and intercept the request before any real work has been done. You most likely want to create a <code>http.Handler</code> to filter the requests, and pass them through to your main handler. This can also be more flexible, since you can filter based on the route, or other request information if you so choose.</p>\n"}], "owner": {"reputation": 21955, "user_id": 639295, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Qbykb.jpg?s=128&g=1", "display_name": "aychedee", "link": "https://stackoverflow.com/users/639295/aychedee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "accepted_answer_id": 31679437, "answer_count": 1, "score": 3, "last_activity_date": 1438095727, "creation_date": 1438093022, "last_edit_date": 1438093779, "question_id": 31679000, "link": "https://stackoverflow.com/questions/31679000/overriding-http-server-serve", "title": "Overriding http.Server.Serve", "body": "<p>I need to embed the default <code>http.Server</code> in my own server struct and customize the <code>Serve</code> method.</p>\n\n<p>The server needs to short circuit the <code>go c.serve()</code> call and only run that line if it has the computing resources available to respond within 50ms. Otherwise the server is just going to send a 204 and move on. </p>\n\n<p>This is <em>almost</em> straightforward.</p>\n\n<pre><code>type PragmaticServer struct {\n    http.Server\n    Addr    string\n    Handler http.Handler\n}\n\nfunc (srv *PragmaticServer) Serve(l net.Listener) error {\n    defer l.Close()\n    var tempDelay time.Duration // how long to sleep on accept failure\n    for {\n        // SNIP for clarity\n        c, err := srv.newConn(rw)\n        if err != nil {\n            continue\n        }\n        c.setState(c.rwc, StateNew) // before Serve can return\n        go c.serve()\n    }\n}\n</code></pre>\n\n<p>So, again. This almost works. Except that <code>srv.newConn</code> is an unexported method, as is <code>c.serve</code> and <code>c.setState</code>, which means that I end up having to copy and paste pretty much the entirety of <code>net/http</code> in order for this to compile. Which is basically a fork. Is there any better way to do this? </p>\n"}, {"tags": ["string", "parsing", "go"], "comments": [{"owner": {"reputation": 184244, "user_id": 14104, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/otetW.jpg?s=128&g=1", "display_name": "epascarello", "link": "https://stackoverflow.com/users/14104/epascarello"}, "edited": false, "score": 1, "creation_date": 1438092796, "post_id": 31678817, "comment_id": 51299407, "body": "Why don&#39;t you parse it to a number and check or use a regular expression?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 184244, "user_id": 14104, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/otetW.jpg?s=128&g=1", "display_name": "epascarello", "link": "https://stackoverflow.com/users/14104/epascarello"}, "edited": false, "score": 0, "creation_date": 1438105302, "post_id": 31678817, "comment_id": 51308641, "body": "@epascarello because that would be massive overkill if the OP really only needs to know about the first character. If they instead want to parse/check for an IP address then they should be using something from the <code>net</code> package."}], "answers": [{"tags": [], "owner": {"reputation": 25272, "user_id": 1695163, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/85ffb58dc3ed0067128804ef843245a6?s=128&d=identicon&r=PG", "display_name": "ddavison", "link": "https://stackoverflow.com/users/1695163/ddavison"}, "is_accepted": false, "score": -1, "last_activity_date": 1438092897, "creation_date": 1438092897, "answer_id": 31678943, "question_id": 31678817, "link": "https://stackoverflow.com/questions/31678817/check-if-a-string-starts-with-a-decimal-digit/31678943#31678943", "title": "Check if a string starts with a decimal digit?", "body": "<p>Since you are comparing by character and no characters are between 1 and 9, I think your solution is ok, but it does not account for the other numbers following.</p>\n\n<p>For example, if <code>thestr</code> was <code>\"192.something.invalid\"</code> it's no longer an IP.</p>\n\n<p>I'd recommend using a regular expression to check the IP.</p>\n\n<p>something like</p>\n\n<pre><code>\\b(?:\\d{1,3}\\.){3}\\d{1,3}\\b\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": false, "score": 0, "last_activity_date": 1438093251, "last_edit_date": 1492085955, "creation_date": 1438093251, "answer_id": 31679086, "question_id": 31678817, "link": "https://stackoverflow.com/questions/31678817/check-if-a-string-starts-with-a-decimal-digit/31679086#31679086", "title": "Check if a string starts with a decimal digit?", "body": "<p>Please do not use regexps for that simple task :)</p>\n\n<p>What I would change in this case:</p>\n\n<ul>\n<li>add check for empty string before checking for the first rune</li>\n<li>I would rephrase it as \"starts with a digit\" as the number semantic is too broad. <code>.5e-45</code> is a number, but probably it is not what you want. 0's semantic is also not simple: <a href=\"https://math.stackexchange.com/questions/238737/why-do-some-people-state-that-zero-is-not-a-number\">https://math.stackexchange.com/questions/238737/why-do-some-people-state-that-zero-is-not-a-number</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1475354575, "last_edit_date": 1475354575, "creation_date": 1438097579, "answer_id": 31680936, "question_id": 31678817, "link": "https://stackoverflow.com/questions/31678817/check-if-a-string-starts-with-a-decimal-digit/31680936#31680936", "title": "Check if a string starts with a decimal digit?", "body": "<p>Your solution is completely fine.</p>\n\n<p>But note that strings in Go are stored as a read-only byte slice where the bytes are the UTF-8 encoded byte sequence, and indexing a string indexes its <em>bytes</em>, not its runes (characters). But since a decimal digit (<code>'0'..'9'</code>) has exactly one byte, it is ok in this case to test the first <code>byte</code>, but first you should test if <code>len(s) &gt; 0</code> or <code>s != \"\"</code>.</p>\n\n<p>Here are some other alternatives, try all on the <a href=\"http://play.golang.org/p/TPnh9FmUsj\" rel=\"nofollow\">Go Playground</a>:</p>\n\n<h3>1) Testing the byte range:</h3>\n\n<p>This is your solution, probably the fastest one:</p>\n\n<pre><code>s := \"12asdf\"\nfmt.Println(s[0] &gt;= '0' &amp;&amp; s[0] &lt;= '9')\n</code></pre>\n\n<h3>2) Using <a href=\"http://golang.org/pkg/fmt/#Sscanf\" rel=\"nofollow\"><code>fmt.Sscanf()</code></a>:</h3>\n\n<p>Note: this also accepts if the <code>string</code> starts with a negative number, decide if it is a problem for you or not (e.g. accepts <code>\"-12asf\"</code>).</p>\n\n<pre><code>i := 0\nn, err := fmt.Sscanf(s, \"%d\", &amp;i)\nfmt.Println(n &gt; 0, err == nil) // Both n and err can be used to test\n</code></pre>\n\n<h3>3) Using <a href=\"http://golang.org/pkg/unicode/#IsDigit\" rel=\"nofollow\"><code>unicode.IsDigit()</code></a>:</h3>\n\n<pre><code>fmt.Println(unicode.IsDigit(rune(s[0])))\n</code></pre>\n\n<h3>4) Using <a href=\"http://golang.org/pkg/regexp/\" rel=\"nofollow\"><code>regexp</code></a>:</h3>\n\n<p>I would probably never use this as this is by far the slowest, but here it is:</p>\n\n<pre><code>r := regexp.MustCompile(`^\\d`)\nfmt.Println(r.FindString(s) != \"\")\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>r := regexp.MustCompile(`^\\d.*`)\nfmt.Println(r.MatchString(s))\n</code></pre>\n"}], "owner": {"reputation": 81, "user_id": 3266581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50a0054aad2175cda14d506a151bb2f0?s=128&d=identicon&r=PG&f=1", "display_name": "Tom Liu", "link": "https://stackoverflow.com/users/3266581/tom-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1475354575, "creation_date": 1438092592, "last_edit_date": 1438100247, "question_id": 31678817, "link": "https://stackoverflow.com/questions/31678817/check-if-a-string-starts-with-a-decimal-digit", "title": "Check if a string starts with a decimal digit?", "body": "<p>It looks the following works, is it a good approach?</p>\n\n<pre><code>var thestr = \"192.168.0.1\"\nif (thestr[0]&gt;= '0' &amp;&amp; thestr[0] &lt;= '9'){\n    //...\n}\n</code></pre>\n"}, {"tags": ["postgresql", "csv", "go"], "comments": [{"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 1, "creation_date": 1438087048, "post_id": 31676423, "comment_id": 51294933, "body": "Try to execute the same command in the psql command line client."}, {"owner": {"reputation": 6027, "user_id": 1187471, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/AtK2G.jpg?s=128&g=1", "display_name": "Fernando &#193;.", "link": "https://stackoverflow.com/users/1187471/fernando-%c3%81"}, "reply_to_user": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438087581, "post_id": 31676423, "comment_id": 51295337, "body": "It works as expected:  <code># COPY &lt;table&gt; FROM &#39;&#47;home&#47;path&#47;to&#47;file.csv&#39; CSV HEADER;</code> <code>COPY 1773</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1438091867, "post_id": 31676423, "comment_id": 51298641, "body": "The <code>COPY</code> function isn&#39;t fully supported by the <code>pq</code> driver: <a href=\"https://github.com/lib/pq/issues/213\" rel=\"nofollow noreferrer\">github.com/lib/pq/issues/213</a>. It looks like there are issues with using <code>COPY</code> while staying compatible with the database/sql API.  You could probably use another driver if you don&#39;t need to conform to database/sql."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1438104492, "post_id": 31676423, "comment_id": 51308130, "body": "Also note that the <code>COPY \u2026 FROM</code> and <code>COPY \u2026 TO</code> statements copy from/to files <i>on the server</i>. If you want to use files on a client you&#39;d need at minimum to use <code>COPY\u2026FROM STDIN</code> (or <code>COPY\u2026TO STDOUT</code>) and do file operations yourself (that&#39;s what <code>psql</code>&#39;s <code>\\copy</code> command does as well). As mentioned, that doesn&#39;t fit into the <code>database&#47;sql</code> API so if a driver were to support this I doubt very much it would be via <code>Prepare</code> or <code>Exec</code>."}, {"owner": {"reputation": 257364, "user_id": 398670, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/85f50c23bb5e9dfb061af5032bfe8e65?s=128&d=identicon&r=PG", "display_name": "Craig Ringer", "link": "https://stackoverflow.com/users/398670/craig-ringer"}, "edited": false, "score": 0, "creation_date": 1438126931, "post_id": 31676423, "comment_id": 51319594, "body": "It should work for server-side paths. If it doesn&#39;t then the driver&#39;s really very incomplete, because COPY with a server-side path is quite simple. Supporting <code>COPY ... FROM stdin</code> or <code>TO stdout</code> (for client-side files) is considerably more complex though."}], "answers": [{"tags": [], "owner": {"reputation": 29, "user_id": 4433451, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48906b222d746066e758d434e3028fce?s=128&d=identicon&r=PG&f=1", "display_name": "Tony", "link": "https://stackoverflow.com/users/4433451/tony"}, "is_accepted": false, "score": 0, "last_activity_date": 1593575833, "creation_date": 1593575833, "answer_id": 62669453, "question_id": 31676423, "link": "https://stackoverflow.com/questions/31676423/can-postgresqls-copy-table-from-file-statement-be-used-in-go/62669453#62669453", "title": "Can PostgreSQL&#39;s &quot;COPY table FROM file&quot; statement be used in Go?", "body": "<p>A rough template to execute COPY command can be found here - <a href=\"https://play.golang.org/p/6y5v3IW8kD\" rel=\"nofollow noreferrer\">https://play.golang.org/p/6y5v3IW8kD</a></p>\n<p>The code below should work for you.</p>\n<pre><code>   func copyTest() {\n\n    psqlInfo := fmt.Sprintf(&quot;host=%s port=%d user=%s password=%s dbname=%s sslmode=verify-full&quot;,host, port, user, password, dbname)\n    db, err := sql.Open(&quot;postgres&quot;, psqlInfo)\n    if err != nil {\n        panic(err)\n    }\n    defer db.Close()\n\n    err = db.Ping()\n    if err != nil {\n        panic(err)\n    }\n\n\n    tx, err := db.Begin()\n    if err != nil {\n        panic(err)\n    }\n\n    _, err = tx.Exec(&quot;copy metadata.charvalues_temp from 'C:\\\\yourlocation\\\\yourfile.csv' with csv&quot;)\n    if err != nil {\n        panic(err)\n    }\n    err = tx.Commit()\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 29, "user_id": 4433451, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48906b222d746066e758d434e3028fce?s=128&d=identicon&r=PG&f=1", "display_name": "Tony", "link": "https://stackoverflow.com/users/4433451/tony"}, "is_accepted": false, "score": 0, "last_activity_date": 1593740911, "creation_date": 1593740911, "answer_id": 62707328, "question_id": 31676423, "link": "https://stackoverflow.com/questions/31676423/can-postgresqls-copy-table-from-file-statement-be-used-in-go/62707328#62707328", "title": "Can PostgreSQL&#39;s &quot;COPY table FROM file&quot; statement be used in Go?", "body": "<p>The code below uses <a href=\"https://github.com/lib/pq\" rel=\"nofollow noreferrer\">https://github.com/lib/pq</a></p>\n<pre><code>    import (\n        &quot;database/sql&quot;\n        &quot;fmt&quot;\n        &quot;github.com/lib/pq&quot;\n    )\n\nfunc bulkCopyTest() {\n    psqlInfo := fmt.Sprintf(&quot;host=%s port=%d user=%s password=%s dbname=%s sslmode=verify-full&quot;,\n        host, port, user, password, dbname)\n    db, err := sql.Open(&quot;postgres&quot;, psqlInfo)\n    if err != nil {\n        panic(err)\n    }\n    defer db.Close()\n\n    tx, err := db.Begin()\n\n    if err != nil {\n        panic(err)\n    }\n\n    stmt, err := tx.Prepare(pq.CopyInSchema(&quot;schemaName&quot;, &quot;DBName&quot;, &quot;columnName&quot;, &quot;columnName&quot;))\n    if err != nil {\n        panic(err)\n    }\n\n    //loop through an array of struct filled with data, or read from a file\n    for _, row := range loadCsv {\n        stmt.Exec(row.value1, row.value2)\n        if err != nil {\n            panic(err)\n        }\n    }\n\n    _, err = stmt.Exec()\n    if err != nil {\n        panic(err)\n    }\n    err = stmt.Close()\n    if err != nil {\n        panic(err)\n    }\n    err = tx.Commit()\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 6027, "user_id": 1187471, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/AtK2G.jpg?s=128&g=1", "display_name": "Fernando &#193;.", "link": "https://stackoverflow.com/users/1187471/fernando-%c3%81"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1732, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1593740911, "creation_date": 1438086720, "last_edit_date": 1438104265, "question_id": 31676423, "link": "https://stackoverflow.com/questions/31676423/can-postgresqls-copy-table-from-file-statement-be-used-in-go", "title": "Can PostgreSQL&#39;s &quot;COPY table FROM file&quot; statement be used in Go?", "body": "<p>After reading <a href=\"http://godoc.org/github.com/lib/pq\" rel=\"nofollow\"><code>github.com/lib/pq</code></a> documentation, it is still not clear for me if it is possible to copy data from a CSV file using a simple <code>COPY &lt;table&gt; FROM &lt;file&gt; CSV HEADER</code> command.</p>\n\n<p>This is what I'm trying to do:</p>\n\n<pre><code>func CopyFromCSV(con Con, tableName, fileName string) error {\n    _, err := con.Exec(fmt.Sprintf(\"TRUNCATE %s\", tableName))\n    if err != nil {\n        return err\n    }\n\n    stm, err := con.Prepare(fmt.Sprintf(\"COPY %s FROM '%s' CSV HEADER\", tableName, fileName))\n    if err != nil {\n        return err\n    }\n    defer stm.Close()\n\n    _, err = stm.Exec()\n    return err\n}\n</code></pre>\n\n<p>Where <code>tableName</code> is an existing table, and <code>fileName</code> the absolute path to an existing csv file.</p>\n\n<p>I'm getting always the following error after the <code>con.Prepare</code> call: <code>pq: unknown response for copy query: 'C'</code></p>\n\n<p>Is it possible to do this in Go with a postgres database using the <code>github.com/lib/pq</code> driver?</p>\n"}, {"tags": ["mysql", "sql", "go"], "answers": [{"tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": false, "score": 3, "last_activity_date": 1438079797, "creation_date": 1438079797, "answer_id": 31673876, "question_id": 31673269, "link": "https://stackoverflow.com/questions/31673269/use-sql-connection-in-another-func/31673876#31673876", "title": "Use sql connection in another func", "body": "<p>Make it global:</p>\n\n<pre><code>var db *sql.DB\n\nfunc indexHandler(w http.ResponseWriter, r *http.Request) {\n    stmt, err := db.Prepare(...\n    ...\n}\n\nfunc main() {\n    var err error\n    db, err = sql.Open(\"mysql\", \"connection\")\n    ...\n</code></pre>\n\n<p>or create handler as closure:</p>\n\n<pre><code>func createIndexHandler(db *sql.DB) (func (http.ResponseWriter, *http.Request)) {\n    return func(w http.ResponseWriter, r *http.Request) {\n        stmt, err := db.Prepare(...\n        ...\n    }\n}\n\nfunc main() {\n    db, err := sql.Open(\"mysql\", \"connection\")\n    ...\n    http.HandleFunc(\"/\", createIndexHandler(db))\n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 4169698, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b0529e9e4bc51c51f120216c524358d?s=128&d=identicon&r=PG", "display_name": "Liamka", "link": "https://stackoverflow.com/users/4169698/liamka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1438083893, "creation_date": 1438078167, "last_edit_date": 1438083893, "question_id": 31673269, "link": "https://stackoverflow.com/questions/31673269/use-sql-connection-in-another-func", "title": "Use sql connection in another func", "body": "<p>How init mysql connection in main function and place it another function? Or init connection in another place and use it anywhere?</p>\n\n<p>Something like this below(this example wrong!) </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n    \"database/sql\"\n)\n\nfunc indexHandler(w http.ResponseWriter, r *http.Request) {\n      stmt, err := db.Prepare(\"INSERT userinfo SET username=?,departname=?,created=?\")\n      res, err := stmt.Exec(\"test\", \"test\", \"test\")\n}\n\nfunc main() {\n    db, err := sql.Open(\"mysql\", \"connection\")\n    if err != nil {\n        panic(err)\n    }\n    http.HandleFunc(\"/\", indexHandler)\n    http.ListenAndServe(\":3000\", nil)\n}\n</code></pre>\n\n<p>Thanks anyway!</p>\n"}, {"tags": ["go", "dependencies", "packages"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1438070573, "post_id": 31669326, "comment_id": 51284096, "body": "are you changing the config at runtime? i like solution 2 if it not change."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1438072755, "post_id": 31669326, "comment_id": 51285311, "body": "Also related: <a href=\"http://stackoverflow.com/questions/29538668/logging-globally-across-packages\">Logging globally (across packages)</a>"}, {"owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "reply_to_user": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1438076873, "post_id": 31669326, "comment_id": 51288025, "body": "@JiangYD yep, it can (rarely) change"}, {"owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1438077098, "post_id": 31669326, "comment_id": 51288174, "body": "@icza I don&#39;t think is really a duplicate of that answer. It is discussed only one way there (similar to my solution-proposal <code>1.</code>), but it is not take in consideration any other option. Furthermore, the <code>config</code> topic is not discussed at all."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1438088130, "post_id": 31669326, "comment_id": 51295763, "body": "Do the custom <code>log</code> and <code>config</code> packages require parameters produced by the main app? Can&#39;t they just initialize themselves?"}, {"owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1438093587, "post_id": 31669326, "comment_id": 51300096, "body": "yep @icza it can be &quot;custom&quot; flags provided (for example) from the cli while starting-up (e.g.: the log could have the <code>-debug=true|false</code>,  the config could have <code>-config_location=somewhere</code>). Then I think that they can&#39;t initialize themselves (because they could miss the main-app flags)."}, {"owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "edited": false, "score": 0, "creation_date": 1438093883, "post_id": 31669326, "comment_id": 51300358, "body": "A further issue, could be that the config can be updated - then in this case a package or the main-app could be not anymore in sync (have the same configs values) - ever in the case they initialise themselves. Using a reference solves this, but is the right way?"}], "owner": {"reputation": 5492, "user_id": 1720344, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/TYlxm.png?s=128&g=1", "display_name": "damoiser", "link": "https://stackoverflow.com/users/1720344/damoiser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 133, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1438149066, "creation_date": 1438066608, "last_edit_date": 1495542611, "question_id": 31669326, "link": "https://stackoverflow.com/questions/31669326/passing-log-or-config-reference-to-custom-go-package", "title": "Passing log or config reference to custom Go package", "body": "<p>I have a Go main-application that uses a custom <code>log</code> package and a custom <code>config</code> package. </p>\n\n<p>This application \"consumes\" other packages that they need more logging or config parameters. Perhaps, a useful example is a custom <code>api-package</code>:</p>\n\n<ul>\n<li>It should print some <code>debug|info|warning</code> logs (the errors are managed as usual by the caller, in this case, the main-application).</li>\n<li>It should have access to values stored in the config (e.g. a server url/port, the environment of the main-application (development, test or production),... ).</li>\n</ul>\n\n<p>I see three solutions to solve this problem: </p>\n\n<ol>\n<li>Passing a pointer (of <code>log</code> and <code>config</code>) from the main object to the sub-package when the package is \"initialised\", then it will use this pointer like the main-application.</li>\n<li>Initialise these dependencies (<code>log</code> or <code>config</code>) directly into the sub-package too, but this could raise concurrency issues between the main-application's instance vs. the package's instance.</li>\n<li>Pass to each method the required arguments (but I would like to avoid build methods with huge args list).</li>\n</ol>\n\n<p>At the moment I use method 1, am I doing it right?\nWhat is the Go conventions about this?\nAre there other ways to solve this?</p>\n\n<hr>\n\n<p>EDIT</p>\n\n<p>Just to explain, why it is not a duplicate of the proposed \"duplicated\" questions:</p>\n\n<ul>\n<li>The <a href=\"https://stackoverflow.com/questions/29538668/logging-globally-across-packages\">answer</a> proposed by icza: it takes care only for <code>logging</code> (writing \"somewhere\") and not for <code>config</code> (reading and writing). No other options are taken in consideration, for example which one follow at best the standards, which one is more performant,...</li>\n<li>The <a href=\"https://stackoverflow.com/questions/18361750/correct-approach-to-global-logging-in-golang\">other answer</a> proposed by icza: it takes only care about a single application, this is not the case at all, because I already know how use the <code>logging</code> and the <code>config</code> in one \"application\" (or in goroutines). </li>\n</ul>\n\n<p>If you mark as duplicate, please just explain why. So I can see if this is a really duplicate or if my question was misunderstand.  </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 0, "creation_date": 1495627025, "post_id": 31669266, "comment_id": 75331669, "body": "answers: <a href=\"https://gist.github.com/inancgumus/d25d045b4cec43dcbb111e04980d396b\" rel=\"nofollow noreferrer\">gist.github.com/inancgumus/d25d045b4cec43dcbb111e04980d396b</a>"}, {"owner": {"reputation": 877, "user_id": 2233051, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/11373ea204506f9d46b712c814ceb312?s=128&d=identicon&r=PG&f=1", "display_name": "erosebe", "link": "https://stackoverflow.com/users/2233051/erosebe"}, "edited": false, "score": 0, "creation_date": 1591055296, "post_id": 31669266, "comment_id": 109906045, "body": "Can someone explain why the first line of the Read function needs to assign somewhere? I use a for range to loop through the byte array, and then try to return len(b), nil but it gives me a timeout error. I&#39;m still doing r13.r.Read(b), just not assigning it anywhere. Confused what the difference is."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 19, "last_activity_date": 1471848150, "last_edit_date": 1471848150, "creation_date": 1438067266, "answer_id": 31669548, "question_id": 31669266, "link": "https://stackoverflow.com/questions/31669266/tour-of-go-exercise-rot13reader/31669548#31669548", "title": "Tour of Go exercise: rot13Reader", "body": "<p><strong>EDIT:</strong></p>\n\n<p>Basically your solution is good and works, you just mistyped 1 character:</p>\n\n<pre><code>case x &gt;= 110 &amp;&amp; x &gt;= 122:\n</code></pre>\n\n<p>Change it to:</p>\n\n<pre><code>case x &gt;= 110 &amp;&amp; x &lt;= 122:\n</code></pre>\n\n<hr>\n\n<p>Your input and output:</p>\n\n<pre><code>Lbh penpxrq gur pbqr!\nYou prnpxrq tur poqr!\n</code></pre>\n\n<p>There is change in every word. The problem is not that only the first word is read and decoded, the problem is in your decoding algorithm.</p>\n\n<p>In <a href=\"https://en.wikipedia.org/wiki/ROT13\" rel=\"noreferrer\">ROT13</a> if shifting goes outside of the letter range, you have to start from the beginning of the alphabet (or at the end). For example shifting <code>'N'</code> would be <code>'Z'</code> + 1, so it becomes <code>'A'</code>, the first letter. See this simple character mapping:</p>\n\n<pre><code>ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\nNOPQRSTUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm\n</code></pre>\n\n<p>So what you should do is after shifting by 13, if the letter goes outside of the alphabet, shift it by <code>-26</code> (number of letters in the English alphabet) which has the desired effect (that after the last letter you continued from the first).</p>\n\n<p>An example solution:</p>\n\n<pre><code>func rot13(x byte) byte {\n    capital := x &gt;= 'A' &amp;&amp; x &lt;= 'Z'\n    if !capital &amp;&amp; (x &lt; 'a' || x &gt; 'z') {\n        return x // Not a letter\n    }\n\n    x += 13\n    if capital &amp;&amp; x &gt; 'Z' || !capital &amp;&amp; x &gt; 'z' {\n        x -= 26\n    }\n    return x\n}\n</code></pre>\n\n<p>And its output:</p>\n\n<pre><code>You cracked the code!\n</code></pre>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/sb1vtLP1Dx\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 2, "last_activity_date": 1438067816, "creation_date": 1438067816, "answer_id": 31669728, "question_id": 31669266, "link": "https://stackoverflow.com/questions/31669266/tour-of-go-exercise-rot13reader/31669728#31669728", "title": "Tour of Go exercise: rot13Reader", "body": "<p>The problem is that your function does not work as you want. To verify this, just try to run your function on <code>\"Lbh penpxrq Lbh gur pbqr!\"</code>. As you see first word is decoded (as well as the third one). So this means that your function does not run only on the first word, but in fact runs on all the words (it just happened that nothing else is changed).</p>\n\n<pre><code>func (rot *rot13Reader) Read(p []byte) (n int, err error) {\n    n, err = rot.r.Read(p)\n    for i := 0; i &lt; len(p); i++ {\n        if (p[i] &gt;= 'A' &amp;&amp; p[i] &lt; 'N') || (p[i] &gt;='a' &amp;&amp; p[i] &lt; 'n') {\n            p[i] += 13\n        } else if (p[i] &gt; 'M' &amp;&amp; p[i] &lt;= 'Z') || (p[i] &gt; 'm' &amp;&amp; p[i] &lt;= 'z'){\n            p[i] -= 13\n        }\n    }\n    return\n}\n</code></pre>\n\n<p>And here is a <kbd><a href=\"http://play.golang.org/p/pNsZVvAsbU\" rel=\"nofollow\">Playground</a></kbd>. Code is taken from <a href=\"https://gist.github.com/zyxar/2317744\" rel=\"nofollow\">here</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 2691, "user_id": 173611, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/14a67bff999b4370178d3875e689200f?s=128&d=identicon&r=PG", "display_name": "Dan", "link": "https://stackoverflow.com/users/173611/dan"}, "is_accepted": false, "score": 2, "last_activity_date": 1461168887, "creation_date": 1461168887, "answer_id": 36749583, "question_id": 31669266, "link": "https://stackoverflow.com/questions/31669266/tour-of-go-exercise-rot13reader/36749583#36749583", "title": "Tour of Go exercise: rot13Reader", "body": "<p>My code also works, it's more simple!</p>\n\n<pre><code>func (rd *rot13Reader) Read(b []byte) (int, error) {\n    m := make(map[byte]byte)\n    input := \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\"\n    output := \"NOPQRSTUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm\"\n    for idx := range input {\n        m[input[idx]] = output[idx]\n    }\n\n    n, err := rd.r.Read(b)\n    for i := 0; i &lt; n; i++ {\n        if val, ok := m[b[i]]; ok {\n          b[i] = val\n        }\n    }\n    return n, err\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3409, "user_id": 4210615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05d2de2cfaffc5d6c3022f6c220f7299?s=128&d=identicon&r=PG", "display_name": "Artur Biesiadowski", "link": "https://stackoverflow.com/users/4210615/artur-biesiadowski"}, "edited": false, "score": 0, "creation_date": 1473594961, "post_id": 38192411, "comment_id": 66194130, "body": "I think it will mess up, as adding 13 to &#39;Z&#39; will result in &#39;g&#39; which will be still &#39;alphabetic&#39;, but not what you expect (which should be &#39;M&#39;)"}, {"owner": {"reputation": 277, "user_id": 871187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75d3b6ab7c9cfcf2ab01e830e100969c?s=128&d=identicon&r=PG", "display_name": "Cubis", "link": "https://stackoverflow.com/users/871187/cubis"}, "reply_to_user": {"reputation": 3409, "user_id": 4210615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/05d2de2cfaffc5d6c3022f6c220f7299?s=128&d=identicon&r=PG", "display_name": "Artur Biesiadowski", "link": "https://stackoverflow.com/users/4210615/artur-biesiadowski"}, "edited": false, "score": 0, "creation_date": 1502912627, "post_id": 38192411, "comment_id": 78401631, "body": "That&#39;s pretty funny - the test on the Golang page counted it as correct because it didn&#39;t test capital letters very much. I have updated it on the <a href=\"https://play.golang.org/p/Z8lLtKYkNz\" rel=\"nofollow noreferrer\">playground</a>"}], "tags": [], "owner": {"reputation": 277, "user_id": 871187, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75d3b6ab7c9cfcf2ab01e830e100969c?s=128&d=identicon&r=PG", "display_name": "Cubis", "link": "https://stackoverflow.com/users/871187/cubis"}, "is_accepted": false, "score": 0, "last_activity_date": 1502912863, "last_edit_date": 1502912863, "creation_date": 1467667536, "answer_id": 38192411, "question_id": 31669266, "link": "https://stackoverflow.com/questions/31669266/tour-of-go-exercise-rot13reader/38192411#38192411", "title": "Tour of Go exercise: rot13Reader", "body": "<p>As a follow up to the answer by @icza, rather than hard-coding the checks for whether the byte is alphabetic or not, create a small function to determine it instead. It makes for much cleaner code.</p>\n\n<pre><code>func alphabetic(x byte) bool {\n    return (x &gt;= 'A' &amp;&amp; x &lt;='Z') || (x &gt;= 'a' &amp;&amp; x &lt;= 'z')\n}\n\nfunc capital(x byte) bool {\n    return x &gt;= 'A' &amp;&amp; x &lt;= 'Z'\n}\n\nfunc rot13(x byte) byte {\n    // byte isn't a letter\n    if !alphabetic(x) {\n        return x\n    }\n\n    original_is_capital := capital(x)\n\n    // apply rot13  \n    x += 13\n\n    // the new letter should loop around\n    if !alphabetic(x) || original_is_capital {\n        x -= 26\n    }\n\n    return x\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 435, "user_id": 8213783, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e647bbbc2204a07ae97c4538d6617d1?s=128&d=identicon&r=PG&f=1", "display_name": "Evan", "link": "https://stackoverflow.com/users/8213783/evan"}, "edited": false, "score": 0, "creation_date": 1600309602, "post_id": 47221567, "comment_id": 113048956, "body": "This is cool, but should probably be implemented with a map due to the time complexity of seeking through the input list. It&#39;s still going to be more efficient to just calculate the value though, and efficiency matters if you are applying rot13 to huge byte streams."}], "tags": [], "owner": {"reputation": 159, "user_id": 6553482, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-967H9dORhIE/AAAAAAAAAAI/AAAAAAAAAZ0/r81YUILL8So/photo.jpg?sz=128", "display_name": "iDuran", "link": "https://stackoverflow.com/users/6553482/iduran"}, "is_accepted": false, "score": 5, "last_activity_date": 1510312590, "creation_date": 1510312590, "answer_id": 47221567, "question_id": 31669266, "link": "https://stackoverflow.com/questions/31669266/tour-of-go-exercise-rot13reader/47221567#47221567", "title": "Tour of Go exercise: rot13Reader", "body": "<p>You could also use instead:</p>\n\n<pre><code>func rot13(x byte) byte {\n    input := []byte(\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\")\n    output := []byte(\"NOPQRSTUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm\")\n    match := bytes.Index(input, []byte{x})\n    if match == -1 {\n        return x\n    }\n    return output[match]\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 59, "user_id": 5991025, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PHnOY.jpg?s=128&g=1", "display_name": "cdcl", "link": "https://stackoverflow.com/users/5991025/cdcl"}, "is_accepted": false, "score": 2, "last_activity_date": 1514501557, "creation_date": 1514501557, "answer_id": 48015373, "question_id": 31669266, "link": "https://stackoverflow.com/questions/31669266/tour-of-go-exercise-rot13reader/48015373#48015373", "title": "Tour of Go exercise: rot13Reader", "body": "<p>I prefer manipulate directly integers in rot13 function </p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"os\"\n    \"strings\"\n)\n\ntype rot13Reader struct {\n    r io.Reader\n}\n\nconst a int = int('a')\nconst z int = int('z')\n\nconst A int = int('A')\nconst Z int = int('Z')\n\nfunc rot13(b int) int {\n\n    isLower := b &gt;= a &amp;&amp; b &lt;= z\n    isUpper := b &gt;= A &amp;&amp; b &lt;= Z\n\n    if isLower {\n        return a + ((b - a + 13) % 26)\n    }\n\n    if isUpper {\n        return A + ((b - A + 13) % 26)\n    }\n\n    return b\n}\n\nfunc (rot *rot13Reader) Read(b []byte) (int, error) {\n    n, err := rot.r.Read(b)\n    if err == io.EOF {\n        return 0, err\n    }\n\n    for x := range b {\n        b[x] = byte(rot13(int(b[x])))\n    }\n    return n, err\n}\n\nfunc main() {\n    s := strings.NewReader(\"Lbh penpxrq gur pbqr!\")\n    r := rot13Reader{s}\n    io.Copy(os.Stdout, &amp;r)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 161, "user_id": 991802, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ee497c4da378967f76e73a06e5904eb?s=128&d=identicon&r=PG", "display_name": "user991802", "link": "https://stackoverflow.com/users/991802/user991802"}, "is_accepted": false, "score": 1, "last_activity_date": 1528422277, "last_edit_date": 1528422277, "creation_date": 1523547265, "answer_id": 49800589, "question_id": 31669266, "link": "https://stackoverflow.com/questions/31669266/tour-of-go-exercise-rot13reader/49800589#49800589", "title": "Tour of Go exercise: rot13Reader", "body": "<pre><code>func rot13(x byte) byte {\n    if (x &gt;=  'A' &amp;&amp; x &lt;= 'M') || (x &gt;=  'a' &amp;&amp; x &lt;= 'm') {\n        return x + 13\n    } else if (x &gt;=  'N' &amp;&amp; x &lt;= 'Z') || (x &gt;=  'n' &amp;&amp; x &lt;= 'z') {\n        return x - 13\n    } else {\n        return x\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user5564157"}, "edited": false, "score": 0, "creation_date": 1536175248, "post_id": 50541548, "comment_id": 91333892, "body": "I think this is the best one, unless anyone need to reuse rot13 logic."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565527041, "post_id": 50541548, "comment_id": 101375166, "body": "This fails for input between &gt;<code>Z</code> and &lt;<code>a</code> (e.g. for characters like &quot;_&quot;). (It also doesn&#39;t compile, presumably <code>b</code> should be <code>p</code>)."}, {"owner": {"reputation": 534, "user_id": 9512475, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152820241587113/picture?type=large", "display_name": "Y\u0131lmaz Durmaz", "link": "https://stackoverflow.com/users/9512475/y%c4%b1lmaz-durmaz"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565625107, "post_id": 50541548, "comment_id": 101402274, "body": "@DaveC, from the closing sentence of the post, you could yourself tell it does not work for the interval you mentioned. and for the compiling, yep, the last editor user did that mistake trying to implement and interval. now that you brought this to my attention, i can implement &quot;alphabet only&quot; condition, yet still it preserves it elegance"}], "tags": [], "owner": {"reputation": 534, "user_id": 9512475, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152820241587113/picture?type=large", "display_name": "Y\u0131lmaz Durmaz", "link": "https://stackoverflow.com/users/9512475/y%c4%b1lmaz-durmaz"}, "is_accepted": false, "score": -1, "last_activity_date": 1565625716, "last_edit_date": 1565625716, "creation_date": 1527328981, "answer_id": 50541548, "question_id": 31669266, "link": "https://stackoverflow.com/questions/31669266/tour-of-go-exercise-rot13reader/50541548#50541548", "title": "Tour of Go exercise: rot13Reader", "body": "<p>two years has already passed since the question asked, but I want to share my code which was very simple compared to.</p>\n\n<pre><code>func (rot rot13Reader) Read(p []byte) (n int, err error) {\n    n, err = rot.r.Read(p)  // read the string into byte array, n holds the length\n    for i := 0; i &lt; n; i++ {\n        upper := p[i] &gt;='A'||p[i]&lt;='Z' //new\n        lower := p[i]&gt;='a'||p[i]&lt;='z'  //new\n        if (upper||lower){ //new\n            p[i] += 13   // we are simply decoding here\n            if (upper &amp;&amp; p[i] &gt; 'Z') || (lower &amp;&amp; p[i] &gt; 'z') { //new\n                p[i] -= 26 // and semi-circle the table if it goes beyond\n            }\n        }\n    }\n    return\n}\n</code></pre>\n\n<p>the result? <code>You cracked the code.</code> Of course it would be better to implement all ascii scale, but it still does most of the job.</p>\n\n<hr>\n\n<p><strong>EDIT</strong>: After a year and a half, a bugged edit by someone else, and a critic about that bug led me to edit this post. The edit still keeps the simplicity of the code while providing few extra conditionals. Moreover, one can turn this code into a rot13 encoder easily. Previous output was <code>You-cracked-the-code.</code></p>\n"}, {"comments": [{"owner": {"reputation": 3017, "user_id": 2648551, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bWyXK.jpg?s=128&g=1", "display_name": "colidyre", "link": "https://stackoverflow.com/users/2648551/colidyre"}, "edited": false, "score": 1, "creation_date": 1536485383, "post_id": 52242861, "comment_id": 91434545, "body": "Simply providing code as an answer is not very helpful, please read this: <a href=\"https://stackoverflow.com/help/how-to-answer\">stackoverflow.com/help/how-to-answer</a>"}], "tags": [], "owner": {"reputation": 11, "user_id": 5222860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b99c9a002183e8694a80b2f8bc26fd5e?s=128&d=identicon&r=PG&f=1", "display_name": "Jacky", "link": "https://stackoverflow.com/users/5222860/jacky"}, "is_accepted": false, "score": 0, "last_activity_date": 1536483048, "creation_date": 1536483048, "answer_id": 52242861, "question_id": 31669266, "link": "https://stackoverflow.com/questions/31669266/tour-of-go-exercise-rot13reader/52242861#52242861", "title": "Tour of Go exercise: rot13Reader", "body": "<pre><code>func (reader rot13Reader) Read(bytes []byte) (int, error) {\n    n, err := reader.r.Read(bytes)\n    for i, val := range bytes[:n] {\n        if val &gt;= 'a' &amp;&amp; val &lt;= 'z' {\n            bytes[i] = (val-'a'+13)%26 + 'a'\n        } else if val &gt;= 'A' &amp;&amp; val &lt;= 'Z' {\n            bytes[i] = (val-'A'+13)%26 + 'A'\n        }\n    }\n    return n, err\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 61, "user_id": 8810911, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JbQfe53jpBo/AAAAAAAAAAI/AAAAAAAAIFE/1WB0LqgogZQ/photo.jpg?sz=128", "display_name": "Isaac Muthui", "link": "https://stackoverflow.com/users/8810911/isaac-muthui"}, "is_accepted": false, "score": -1, "last_activity_date": 1536594942, "creation_date": 1536594942, "answer_id": 52261502, "question_id": 31669266, "link": "https://stackoverflow.com/questions/31669266/tour-of-go-exercise-rot13reader/52261502#52261502", "title": "Tour of Go exercise: rot13Reader", "body": "<p>Here's how I solved it:</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"os\"\n    \"strings\"\n)\n\ntype rot13Reader struct {\n    r io.Reader\n}\n\nfunc rot13(r byte) byte {\n    sb := rune(r)\n    if sb &gt;= 'a' &amp;&amp; sb &lt;= 'm' || sb &gt;= 'A' &amp;&amp; sb &lt;= 'M' {\n        sb = sb + 13\n    }else if sb &gt;= 'n' &amp;&amp; sb &lt;= 'z' || sb &gt;= 'N' &amp;&amp; sb &lt;= 'Z' {\n        sb = sb - 13\n    }\n    return byte(sb)\n\n}\n\nfunc (r13 *rot13Reader) Read(b []byte) (i int, e error) {\n    n, err := r13.r.Read(b)\n    for i := 0; i &lt;= n; i++ {\n        b[i] = rot13(b[i])\n    }\n    return n, err\n}\n\nfunc main() {\n    s := strings.NewReader(\"Lbh penpxrq gur pbqr!\")\n    r := rot13Reader{s}\n    io.Copy(os.Stdout, &amp;r)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 102, "user_id": 11808158, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ca2fc2c286d91c819c93438b472b7e2?s=128&d=identicon&r=PG&f=1", "display_name": "jfwm", "link": "https://stackoverflow.com/users/11808158/jfwm"}, "is_accepted": false, "score": -1, "last_activity_date": 1563539083, "creation_date": 1563539083, "answer_id": 57112465, "question_id": 31669266, "link": "https://stackoverflow.com/questions/31669266/tour-of-go-exercise-rot13reader/57112465#57112465", "title": "Tour of Go exercise: rot13Reader", "body": "<p>Here are my two cents:</p>\n\n<p>(Note that 'Z' ASCII code is 90 and 'h' is 114)</p>\n\n<pre><code>func (r rot13Reader) Read(p []byte) (n int, err error) {\n    n, err = r.r.Read(p)\n    if err == nil {\n        for i := range p {\n            if c := p[i] + 13; c &gt; 'z' || (c &gt; 'Z' &amp;&amp; c &lt; 'h') {\n                p[i] = c - 26\n            } else {\n                p[i] = c\n            }\n        }\n    }\n    return n, err\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 26124, "user_id": 171950, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ccee38944752d481128936450ddb687e?s=128&d=identicon&r=PG", "display_name": "Muhammad Hewedy", "link": "https://stackoverflow.com/users/171950/muhammad-hewedy"}, "edited": false, "score": 0, "creation_date": 1565624686, "post_id": 57446621, "comment_id": 101402034, "body": "Why the negative feedback?"}], "tags": [], "owner": {"reputation": 26124, "user_id": 171950, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ccee38944752d481128936450ddb687e?s=128&d=identicon&r=PG", "display_name": "Muhammad Hewedy", "link": "https://stackoverflow.com/users/171950/muhammad-hewedy"}, "is_accepted": false, "score": -1, "last_activity_date": 1565484824, "creation_date": 1565484824, "answer_id": 57446621, "question_id": 31669266, "link": "https://stackoverflow.com/questions/31669266/tour-of-go-exercise-rot13reader/57446621#57446621", "title": "Tour of Go exercise: rot13Reader", "body": "<p>My Try:</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"os\"\n    \"strings\"\n)\n\ntype rot13Reader struct {\n    io.Reader\n}\n\nfunc (r rot13Reader) Read(p []byte) (n int, err error) {\n    n, _ = r.Reader.Read(p)\n    for i := 0; i &lt; n; i++ {\n        if p[i] != byte(' ') {\n            if p[i] &gt; byte('m') {\n                p[i] = p[i] - 13\n            } else {\n                p[i] = p[i] + 13\n            }\n        }\n    }\n    err = io.EOF\n    return\n}\n\nfunc main() {\n    s := strings.NewReader(\"Lbh penpxrq gur pbqr!\")\n    r := rot13Reader{s}\n    _, _ = io.Copy(os.Stdout, &amp;r)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 35, "user_id": 1647798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e305b77ae8c59dad93f484a22b0ee939?s=128&d=identicon&r=PG", "display_name": "user1647798", "link": "https://stackoverflow.com/users/1647798/user1647798"}, "is_accepted": false, "score": -1, "last_activity_date": 1566613792, "creation_date": 1566613792, "answer_id": 57634668, "question_id": 31669266, "link": "https://stackoverflow.com/questions/31669266/tour-of-go-exercise-rot13reader/57634668#57634668", "title": "Tour of Go exercise: rot13Reader", "body": "<p>My solution was this:</p>\n\n<pre><code>func rot13(b byte) byte {\n    in := []byte(\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz\")\n    out := []byte(\"NOPQRSTUVWXYZABCDEFGHIJKLMnopqrstuvwxyzabcdefghijklm\")\n\n    for i, v := range in {\n        if v == b {\n            return out[i]\n        }\n    }\n\n    return b\n}\n\ntype rot13Reader struct {\n    r io.Reader\n}\n\nfunc (rot *rot13Reader) Read(b []byte) (int, error) {\n    n, err := rot.r.Read(b)\n\n    for i := range b {\n        b[i] = rot13(b[i])\n    }\n\n    return n, err\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 327, "user_id": 3750414, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/eee73add7f5af7dca09de577b47b4460?s=128&d=identicon&r=PG&f=1", "display_name": "sr3", "link": "https://stackoverflow.com/users/3750414/sr3"}, "is_accepted": false, "score": 1, "last_activity_date": 1569627550, "creation_date": 1569627550, "answer_id": 58142267, "question_id": 31669266, "link": "https://stackoverflow.com/questions/31669266/tour-of-go-exercise-rot13reader/58142267#58142267", "title": "Tour of Go exercise: rot13Reader", "body": "<p>Yet another way to do it:</p>\n\n<pre><code>func (rr *rot13Reader) Read(b []byte) (int, error) {\n    n, err := rr.r.Read(b)\n    if err != nil {\n        return 0, err\n    }\n    for i := 0; i &lt; n; i++ {\n        if b[i] &gt;= 'A' &amp;&amp; b[i] &lt;= 'z' {\n            b[i] += 13\n            if b[i] &gt; 'z' {\n                b[i] -= 26\n            }\n        }\n    }\n    return n, nil\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 107, "user_id": 10428392, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KXrBf.png?s=128&g=1", "display_name": "counter2015", "link": "https://stackoverflow.com/users/10428392/counter2015"}, "is_accepted": false, "score": 2, "last_activity_date": 1595298724, "creation_date": 1595298724, "answer_id": 63006499, "question_id": 31669266, "link": "https://stackoverflow.com/questions/31669266/tour-of-go-exercise-rot13reader/63006499#63006499", "title": "Tour of Go exercise: rot13Reader", "body": "<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;io&quot;\n    &quot;os&quot;\n    &quot;strings&quot;\n)\n\ntype rot13Reader struct {\n    r io.Reader\n}\n\nfunc (rot *rot13Reader) Read(b []byte) (int, error) {\n    n, err := rot.r.Read(b)\n    if err == io.EOF {\n        return 0, err\n    }\n\n    for i := range b {\n        var base byte\n        if b[i] &gt;= 'a' &amp;&amp; b[i] &lt;= 'z' {\n            base = 'a'\n        } else if b[i] &gt;= 'A' &amp;&amp; b[i] &lt;= 'Z' {\n            base = 'A'\n        } else {\n            continue\n        }\n        b[i] = (((b[i] - base) + 13) % 26) + base\n    }\n    return n, err\n}\n\nfunc main() {\n    s := strings.NewReader(&quot;Lbh penpxrq gur pbqr!&quot;)\n    r := rot13Reader{s}\n    io.Copy(os.Stdout, &amp;r)\n}\n\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 510, "user_id": 7810354, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-HZU8BWdGGKM/AAAAAAAAAAI/AAAAAAAAEvI/IAS9C9GmTqQ/photo.jpg?sz=128", "display_name": "Raj Shah", "link": "https://stackoverflow.com/users/7810354/raj-shah"}, "is_accepted": false, "score": 0, "last_activity_date": 1596551439, "creation_date": 1596551439, "answer_id": 63249097, "question_id": 31669266, "link": "https://stackoverflow.com/questions/31669266/tour-of-go-exercise-rot13reader/63249097#63249097", "title": "Tour of Go exercise: rot13Reader", "body": "<p>A simple code snippet that changes alphabets and ignores other characters</p>\n<pre><code>func (rot *rot13Reader) Read(b [] byte) (int, error) {\n    size,e := rot.r.Read(b)\n    for i := 0; i &lt; size; i++ {\n        if b[i] &lt; byte('A') || b[i] &gt; byte('z') {\n            continue\n        }\n        if b[i] &gt; byte('a') {\n            b[i] = byte('a') + (b[i] - byte('a') + 13)%26\n        } else {\n            b[i] = byte('A') + (b[i] - byte('A') + 13)%26\n        }\n    }\n    return size, e\n}\n</code></pre>\n"}], "owner": {"reputation": 977, "user_id": 1419809, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0Plto.jpg?s=128&g=1", "display_name": "Pauli", "link": "https://stackoverflow.com/users/1419809/pauli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11668, "favorite_count": 1, "protected_date": 1565528604, "accepted_answer_id": 31669548, "answer_count": 16, "score": 10, "last_activity_date": 1596551439, "creation_date": 1438066390, "last_edit_date": 1565526613, "question_id": 31669266, "link": "https://stackoverflow.com/questions/31669266/tour-of-go-exercise-rot13reader", "title": "Tour of Go exercise: rot13Reader", "body": "<p>I'm trying to solve the Tour of Go exercise <a href=\"https://tour.golang.org/methods/23\" rel=\"noreferrer\">rot13Reader</a>:</p>\n\n<p>Here is my solution:</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"os\"\n    \"strings\"\n)\n\ntype rot13Reader struct {\n    r io.Reader\n}\n\nfunc rot13(x byte) byte {\n    switch {\n    case x &gt;= 65 &amp;&amp; x &lt;= 77:\n        fallthrough\n    case x &gt;= 97 &amp;&amp; x &lt;= 109:\n        x = x + 13\n    case x &gt;= 78 &amp;&amp; x &lt;= 90:\n        fallthrough\n    case x &gt;= 110 &amp;&amp; x &gt;= 122:\n        x = x - 13\n    }\n    return x\n}\n\nfunc (r13 *rot13Reader) Read(b []byte) (int, error) {\n    n, err := r13.r.Read(b)\n    for i := 0; i &lt;= n; i++ {\n        b[i] = rot13(b[i])\n    }\n    return n, err\n}\n\nfunc main() {\n    s := strings.NewReader(\"Lbh penpxrq gur pbqr!\")\n    r := rot13Reader{s}\n    io.Copy(os.Stdout, &amp;r)\n}\n</code></pre>\n\n<p>It returns <code>You prnpxrq tur poqr!</code>, that means only the first word of \"Lbh penpxrq gur pbqr!\" is cracked. How can I crack the whole sentence? </p>\n"}, {"tags": ["templates", "go", "string-comparison", "case-insensitive"], "answers": [{"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 3, "last_activity_date": 1438055110, "creation_date": 1438055110, "answer_id": 31667013, "question_id": 31666710, "link": "https://stackoverflow.com/questions/31666710/case-insensitive-string-compare-in-go-template/31667013#31667013", "title": "Case insensitive string compare in Go template", "body": "<p>You can simply create another <a href=\"http://golang.org/pkg/strings/#ToLower\" rel=\"nofollow\">lowercase</a> variable <code>s1 := strings.ToLower(s)</code> and to compare it with your template against a lowercase string.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1495066056, "last_edit_date": 1495066056, "creation_date": 1438063107, "answer_id": 31668407, "question_id": 31666710, "link": "https://stackoverflow.com/questions/31666710/case-insensitive-string-compare-in-go-template/31668407#31668407", "title": "Case insensitive string compare in Go template", "body": "<p>You can use <a href=\"https://golang.org/pkg/html/template/#Template.Funcs\" rel=\"nofollow noreferrer\"><code>template.Funcs()</code></a> to register custom functions that you want to use in your templates.</p>\n\n<p>There is a <a href=\"https://golang.org/pkg/strings/#EqualFold\" rel=\"nofollow noreferrer\"><code>strings.EqualFold()</code></a> function which performs case insensitive comparison of strings. So just register that function and you can call it from the template:</p>\n\n<pre><code>t := template.Must(template.New(\"\").Funcs(template.FuncMap{\n    \"MyEq\": strings.EqualFold,\n}).Parse(`\"{{.}}\" {{if MyEq . \"val\"}}matches{{else}}doesn't match{{end}} \"val\".`))\n\nt.Execute(os.Stdout, \"Val\")\nfmt.Println()\nt.Execute(os.Stdout, \"NotVal\")\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>\"Val\" matches \"val\".\n\"NotVal\" doesn't match \"val\".\n</code></pre>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/EoyCh5KFEV\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1618, "favorite_count": 1, "accepted_answer_id": 31668407, "answer_count": 2, "score": 2, "last_activity_date": 1495066056, "creation_date": 1438052910, "last_edit_date": 1438054818, "question_id": 31666710, "link": "https://stackoverflow.com/questions/31666710/case-insensitive-string-compare-in-go-template", "title": "Case insensitive string compare in Go template", "body": "<p>Go template provides an <code>eq</code> comparison operator, e.g., <code>{{if eq .Var \"val\" }}</code>. </p>\n\n<p>What's the best way to do a case insensitive string comparison in this case? So that the above would be true for Var to be \"val\", \"Val\", or \"VAL\".</p>\n"}, {"tags": ["sockets", "go", "interface", "gnutls"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1438049426, "post_id": 31666009, "comment_id": 51276716, "body": "You&#39;re ignoring errors, which is resulting in the panic. Make a valid tls listener example, <i>then</i> add cert verification."}, {"owner": {"reputation": 1668, "user_id": 311358, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0b2b51e4cceb4a0c1609b81815001b69?s=128&d=identicon&r=PG", "display_name": "xrl", "link": "https://stackoverflow.com/users/311358/xrl"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1439500618, "post_id": 31666009, "comment_id": 51900686, "body": "Good call. Thanks. My example was incomplete and that was part of the issue."}], "answers": [{"comments": [{"owner": {"reputation": 619, "user_id": 442952, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/adcdd4080503216e19cee81f413e6eb3?s=128&d=identicon&r=PG", "display_name": "George Antoniadis", "link": "https://stackoverflow.com/users/442952/george-antoniadis"}, "edited": false, "score": 0, "creation_date": 1493068847, "post_id": 31708934, "comment_id": 74246056, "body": "I&#39;m trying to get this to work as well, but I&#39;m having some issues. Even with the code in this comment in go 1.7 and 1.8 I get <code>got certs: &#39;[]&#39;</code>.  In similar tests the only way that I can get PeerCertificates not to be empty is after the server receiving data from the client. Am I missing something?"}, {"owner": {"reputation": 1668, "user_id": 311358, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0b2b51e4cceb4a0c1609b81815001b69?s=128&d=identicon&r=PG", "display_name": "xrl", "link": "https://stackoverflow.com/users/311358/xrl"}, "reply_to_user": {"reputation": 619, "user_id": 442952, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/adcdd4080503216e19cee81f413e6eb3?s=128&d=identicon&r=PG", "display_name": "George Antoniadis", "link": "https://stackoverflow.com/users/442952/george-antoniadis"}, "edited": false, "score": 0, "creation_date": 1493072267, "post_id": 31708934, "comment_id": 74247410, "body": "Can you post a code snippet of what you&#39;re doing? Maybe an example of the cert or key you&#39;re trying to use?"}, {"owner": {"reputation": 619, "user_id": 442952, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/adcdd4080503216e19cee81f413e6eb3?s=128&d=identicon&r=PG", "display_name": "George Antoniadis", "link": "https://stackoverflow.com/users/442952/george-antoniadis"}, "edited": false, "score": 0, "creation_date": 1493110016, "post_id": 31708934, "comment_id": 74260688, "body": "this is what I&#39;m trying out <a href=\"https://gist.github.com/geoah/31340b8155318a3661b1555c191470b5\" rel=\"nofollow noreferrer\">gist.github.com/geoah/31340b8155318a3661b1555c191470b5</a> -- it creates the certificates on the fly and prints them so you can see how they are being generated. Thank you very in advance! :)"}, {"owner": {"reputation": 619, "user_id": 442952, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/adcdd4080503216e19cee81f413e6eb3?s=128&d=identicon&r=PG", "display_name": "George Antoniadis", "link": "https://stackoverflow.com/users/442952/george-antoniadis"}, "edited": false, "score": 0, "creation_date": 1493110064, "post_id": 31708934, "comment_id": 74260726, "body": "But even with the above piece of code untouched I get an empty <code>PeerCertificates</code> array."}, {"owner": {"reputation": 619, "user_id": 442952, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/adcdd4080503216e19cee81f413e6eb3?s=128&d=identicon&r=PG", "display_name": "George Antoniadis", "link": "https://stackoverflow.com/users/442952/george-antoniadis"}, "edited": false, "score": 3, "creation_date": 1493112486, "post_id": 31708934, "comment_id": 74262531, "body": "ok figured it out with some help, the server gets the client certificate after the first i/o. You need to explicitly call <code>conn.Handshake()</code> on the server after accepting the connection to get the cert."}], "tags": [], "owner": {"reputation": 1668, "user_id": 311358, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0b2b51e4cceb4a0c1609b81815001b69?s=128&d=identicon&r=PG", "display_name": "xrl", "link": "https://stackoverflow.com/users/311358/xrl"}, "is_accepted": true, "score": 1, "last_activity_date": 1438196351, "creation_date": 1438196351, "answer_id": 31708934, "question_id": 31666009, "link": "https://stackoverflow.com/questions/31666009/how-to-verify-peer-certificates-in-tls-listener/31708934#31708934", "title": "How to verify peer certificates in TLS listener", "body": "<p>The issue was with loading the certificates. Here is a working example in case someone else stumbles upon this example. You can indeed check the certificates off an <code>Accept()</code> (but from what I'm learning, that's not a common case in TLS, you usually check the certificate from the client's side as the individual clients do not require certificates).</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"fmt\"\n    \"net\"\n    \"time\"\n)\n\ntype Service struct {\n    listener net.Listener\n}\n\nfunc (serv *Service)Listen(port int64) (err error) {\n    rsaCertPEM := `-----BEGIN CERTIFICATE-----\nMIIGKjCCBBKgAwIBAgIJAOaBs5/Gdk7RMA0GCSqGSIb3DQEBBQUAMGsxHzAdBgNV\nBAMTFlhhdmllcnMtTUJQIGhlbGxvd29ybGQxEjAQBgNVBAoTCVNDQU1QIEluYzEL\nMAkGA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExEjAQBgNVBAcTCVNhbiBE\naWVnbzAeFw0xNTA3MjcxNzMyNDNaFw0yNTA3MjQxNzMyNDNaMGsxHzAdBgNVBAMT\nFlhhdmllcnMtTUJQIGhlbGxvd29ybGQxEjAQBgNVBAoTCVNDQU1QIEluYzELMAkG\nA1UEBhMCVVMxEzARBgNVBAgTCkNhbGlmb3JuaWExEjAQBgNVBAcTCVNhbiBEaWVn\nbzCCAiIwDQYJKoZIhvcNAQEBBQADggIPADCCAgoCggIBAOMiK19vGbRH7Y40jC3E\nB+r2NNeEO9BIB8umzAs0uh1hRxEWYgdYwOvmEeuUQgimHbJ7Neh8IKjUiD529Ir0\nrxNwhmu3AxFJf5hBC9Ix5nO2oVjIPdCVX+1CL9BJvmYyRlV5cq5WukTeYuSLG/tB\nh9fARwIhcR9HrjYYb6LtMUX0oIlHQytDRn9pM27TfoR6ad3dwZdRpf9kQH4x467d\nrBiRvRnBx5JBCE/cpFg7fQtrsrurn6tmMR/WMpv8GU0dLGEMCs/Te1bwH3XHDwNZ\nmLVukfIhyWU/hXNzbggar0wk3ZqJrEeDm8zQJ73ywhs4D8AY+UX3V+1SBah45U+f\nS9fZi7yi8XoCuEHTZoYU3hVcSP3Yqx1aZS5D7rx2X+T5XrJxy8FHiRX1LEPWKzz+\n3x3+s9UcCIFz9xlAm0tM6ZjzeOcXhadSd+zTNngfQcwOPbPbyTM4Z9RD2VDPtfvV\neqJ82ZOGVWWkBFElZV6I5idRDph4/eEvO1Ij02C6oJJbyfbXzuMAgGVch8oMd65S\nmVLppAT2uiNYebWp2Q2TleShNiv7AhvnV0saEfuCtX6fsryzogOMsEXiK+EqAZ3c\nQUT+9hdIrwGWEOcx4Dpm2Tzh2QDIzmPVKIJ/PHPZgVq/zkc03ThuSRGYiNgz0YY4\nAWsPtAVVZafh3ZcnPjP8OocxAgMBAAGjgdAwgc0wHQYDVR0OBBYEFOePjJeN13Rm\nAzPVb/Tcp8x1gGh6MIGdBgNVHSMEgZUwgZKAFOePjJeN13RmAzPVb/Tcp8x1gGh6\noW+kbTBrMR8wHQYDVQQDExZYYXZpZXJzLU1CUCBoZWxsb3dvcmxkMRIwEAYDVQQK\nEwlTQ0FNUCBJbmMxCzAJBgNVBAYTAlVTMRMwEQYDVQQIEwpDYWxpZm9ybmlhMRIw\nEAYDVQQHEwlTYW4gRGllZ2+CCQDmgbOfxnZO0TAMBgNVHRMEBTADAQH/MA0GCSqG\nSIb3DQEBBQUAA4ICAQDTlOdkKl1VT+VleeORUU3vVfeNGmiWrd88v6JlUxdYBU2o\nYfQgVzPijxy9EGdgdaw/BPI0ypMn/DQ5hOcAHtHWCn7hHnRGTM4GMqZ6TOwexUyh\nW02QFdwnB5jKQ3HNokp43NnoxAxEFnd6m27O39unwbq49Tt16HfEeUXMbXQabV6I\nfZy7YsulamH0M5eZ2qtX25BkuYV1d4PpnahKWGRRvdg9jEszMfksI/tmv8CDmCi4\n3cOS2c6i86XF3Cx+SlNPhJ7YpQK8IVxE3xzRMCf2kiA2vdb7DhVz4N5ZBzZYX5qD\nHkYdjTdj4I6jtdeeNKqrEMV2Q3/X2Mdp0jp8dcK8WO7jXSIBvo4GO5797ok5mbQT\nom0xvBljFkkyTuWJLUJslg9N7IyXCYZXLXpUvm40J+fXMNnd6lGbygNSrKFyjdDX\nx5r9XCAKmtRteZSVpknN1eE5Gl5naY6iZrxXeeNlCG8x6a2XaQM6/0/XhSEZnGog\nXiiirE3s5xZnWVRqOwx7iihs9I4mdHNj9kFdsB3vPjlMfbiQl+GbLIaF16H+LFP2\nArBiqwKM5kOcA3kT0XMm1rvxHZrpEACGf2zRhuBlZRyP96KPp49A4FpVHjsYweI8\nDkIeTJpAsCXxgqDCw0P8xfhM5gP/ILmWgOIGj0+E/8OTgL3J85Jg8rmIo86mSg==\n-----END CERTIFICATE-----`\n\n var rsaKeyPEM = `-----BEGIN RSA PRIVATE KEY-----\nMIIJKQIBAAKCAgEA4yIrX28ZtEftjjSMLcQH6vY014Q70EgHy6bMCzS6HWFHERZi\nB1jA6+YR65RCCKYdsns16HwgqNSIPnb0ivSvE3CGa7cDEUl/mEEL0jHmc7ahWMg9\n0JVf7UIv0Em+ZjJGVXlyrla6RN5i5Isb+0GH18BHAiFxH0euNhhvou0xRfSgiUdD\nK0NGf2kzbtN+hHpp3d3Bl1Gl/2RAfjHjrt2sGJG9GcHHkkEIT9ykWDt9C2uyu6uf\nq2YxH9Yym/wZTR0sYQwKz9N7VvAfdccPA1mYtW6R8iHJZT+Fc3NuCBqvTCTdmoms\nR4ObzNAnvfLCGzgPwBj5RfdX7VIFqHjlT59L19mLvKLxegK4QdNmhhTeFVxI/dir\nHVplLkPuvHZf5PlesnHLwUeJFfUsQ9YrPP7fHf6z1RwIgXP3GUCbS0zpmPN45xeF\np1J37NM2eB9BzA49s9vJMzhn1EPZUM+1+9V6onzZk4ZVZaQEUSVlXojmJ1EOmHj9\n4S87UiPTYLqgklvJ9tfO4wCAZVyHygx3rlKZUumkBPa6I1h5tanZDZOV5KE2K/sC\nG+dXSxoR+4K1fp+yvLOiA4ywReIr4SoBndxBRP72F0ivAZYQ5zHgOmbZPOHZAMjO\nY9Uogn88c9mBWr/ORzTdOG5JEZiI2DPRhjgBaw+0BVVlp+Hdlyc+M/w6hzECAwEA\nAQKCAgEAvOnVo1m3yl+s8QM5uHL8luvSxZJBYZoXicYgng1r4zXesxKn1C54v3wr\nWYKFbcYkmyepjcV4MJQdAb9U5CJhX8zOsNaWIZG9I3iuiVRhtcqn5j0eVNd44tCT\nDi3XxA56u2r4/JI7+T3yiN4/FrrJbqSJKvd/rCGlf27Ro3Se7+1ofOWds2UQRLbO\nRZZ4+10JorRn6SDK7WGH1q5ODkpnckP9QWgQQs/+RtZghtZrycz46ujzM88aer1g\neKa0sJPcLpeignsGcifkMsSu8v1Za0Yc84QwixrLN1xBn1H6jV14R6nMdeq78h0L\ngQxhb9wwFXlwE0aHhmcbN6XeLFx06fCSskpu8AoBRC1acOEY1uiF3NVAdw3bILX+\njxUh0Qhsb3JoAAIPwqV3SDnqiQi40k8hv6MfCw3Xn6UhyYNHGQBn7cX7llSvo0wF\nDvQd0dJHmfBXXldVnhruH2275aqu1qVbPlNmoA6+2gChfOPgSUO9xNQXYc0dvgbl\n7UBX/MR8SJlawptb3pwfTv+fBioSodWwfhkbZ0TMVGwSFUHXDN/+VeHoZsafZIog\nknyKeE587y4aDcaYsHYYgz/WLjGMfROeUoplZQoBLfis+nTVBA6gCUGOFKynB5/b\nZpoqXxfkroYClVpiDrbJlCzwjnb1CBC49m+fTC4meX4EhqL7ZLECggEBAPvFxenW\nGRC6fe05fWJwNi47Qf49Ll2BXipeq9NZlL3Z1j4V/DTcB9xw9HvuilsY4Hy+jQZM\nmNOw8xPcPQLZxuG5HKAkuy/YOzWfgQCthAM+9ewQfcg8yEGv4qUx+iMxbR67SW0n\noOK5xGEOyIhnyywhcuicJecoK/8m4mZXryJTZced9oAiGXziEVcPVYqe+JLAea8G\n3fqvHQj5EF5IC7q9sohSqSvnILukFmhgdG5xDvNGcVwczw8EO/hzDGT7ZAT1EheA\nr29bnn6rxDYWsatOUeXx7qLjPJcH1ZEoQF8YdWvUu4v0wHwIZRB+Ul0soMS1KvP8\nRlT5VuspRkby8a0CggEBAObyfKlBWiZWMu4iLxySHoAvxuAVI/7UJI5SCwMLZOtZ\nFvNumPfVAS9YdJNnV44en368b8Lk+oBahlrgssTTIHN6eFlS/b7okHlkb6O2ED0v\nLingYZ8iELAxeBEhM0sLthjXV2GzshqGTLDSc/SbInKtIZKY9mwAEQn75WH1sGbX\nGPixZpS64f3fzV5lXZSb39gx/YAKn6LlrM6pxrOKA947ZIYpCCx+2vVeYS2tWl23\niJaKCdy5GMKb/BOhBA08zWMYVmejB+hRtaFz1wcloDQJvyu3SL2mMV/mU3ERDG2R\n+o6K9EEmMnB8xci40EOCMETDXxmeMGnsXQf5bEVeBBUCggEAHtw6CxR8FAnX35j5\nXnSEn5wR1bjoEvwFb8oU454KVk76LLgDJvOFXybVQM+XU90zvvaYUJpY7TG2Scvo\nCo5pC0fmU1bNPusRLtxzMoMSOFeiSyImWMHihfKqJDeBAolPZ8HrGR8PYFsG0CLA\nv7+BLtKWxB5HoxLQecDpZUQAKoPwaMxa54/GcgE/wN0XTht4OnyvLZ343X5TX8Mv\nl27bSTNxS7ZeGAyHfZh6Sqbv/o2LGJSc1n6Nfri1JRns/f+2XckwQ4M5fbvMLJif\nP0X+1xGNhlLmPj7+MUD7k4RMh5t24RW9O0VvxoQ85w2kyNjsh8/xCOD2OfoqBj8T\n5yRmLQKCAQBZA6Wg5xuEIz1GI87cyEURS1jwDbXuBn6AjIbKCZ5AR/pcoYg8HdFz\nGjj0h6RrlsoK4z6AdBlJV5rpdCnzSxz65X11kFNVPfZRk7Cj/QyNSJ4WbfGykEK2\nZprMn2tRxZXORVHcypIfPxxYGwWuhgzk/m4uPt7cCbqHipuDAluXh9iMInRTZySr\n4ZMaix9ipCHHBp2auH2HH9dXYIDBurR695FrVG1eGRbz9AiovmRSMudmfpYGiSFO\nASlLt4gEQic3xq2nDGOD29qR/EAo9Qumgws4IlDbKC9nszL+JYAQy28zecNjSQGv\n8aeaEgHTw14vYs5I5Xvrl7rT1AMzSWVxAoIBAQCaDhdF/OyysP5WuQYd3v0J1yBM\nbYc3y+RxdzCHtdxor5fQvTAN0gtp1KhrCmfoYdW4yUnOQZ6YoRzllERcQyoD2tGm\nnEWm5YXQU8WZBGvCNfcL2qAVKZ3g498NJ3NqFMW9u2O1OlCSTRzLYp5Hdsx/7kl/\nrzuo3vqtgYQqUkWDps6gjGkr55ztZHMoV6wGH9nf8tD0kqk+U6zIzaxiDj0U8+nr\nxtEY4RYeEg1LV1I+kKvhEXx2mlyw7EbHTBXsfr7NdW3i7jFGN+mYywEhAqTlxJds\n/IIDg+agTUeg+vYYbPA9nAwlTU1nzkhE3x3Aix/YRrtM70xFEF1v/sg4Oot/\n-----END RSA PRIVATE KEY-----`\n\n    cert, err := tls.X509KeyPair([]byte(rsaCertPEM), []byte(rsaKeyPEM))\n\n    config := &amp;tls.Config{\n        Certificates: []tls.Certificate{ cert },\n    }\n\n    serv.listener,err = tls.Listen(\"tcp\", \"127.0.0.1:30101\", config)\n    if err != nil {\n        return err\n    }\n\n    return\n}\n\nfunc (serv *Service)AcceptRequests() {\n    for {\n        netConn,_ := serv.listener.Accept()\n        var tlsConn (*tls.Conn) = netConn.(*tls.Conn)\n\n        certs := tlsConn.ConnectionState().PeerCertificates\n\n        fmt.Printf(\"got certs: `%s`\\n\", certs)\n    }\n}\n\nfunc main() {\n    serv := new(Service)\n    err := serv.Listen(30100)\n    if err != nil {\n        fmt.Printf(\"go err: `%s`\", err)\n        return\n    }\n    go serv.AcceptRequests()\n\n    time.Sleep(1)\n\n    tlsConn, _ := tls.Dial(\"tcp\",\"127.0.0.1:30101\", &amp;tls.Config{\n        InsecureSkipVerify: true,\n    })\n    tlsConn.Write([]byte(\"hey\"))\n}\n</code></pre>\n"}], "owner": {"reputation": 1668, "user_id": 311358, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0b2b51e4cceb4a0c1609b81815001b69?s=128&d=identicon&r=PG", "display_name": "xrl", "link": "https://stackoverflow.com/users/311358/xrl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1735, "favorite_count": 1, "accepted_answer_id": 31708934, "answer_count": 1, "score": 0, "last_activity_date": 1438196351, "creation_date": 1438047196, "question_id": 31666009, "link": "https://stackoverflow.com/questions/31666009/how-to-verify-peer-certificates-in-tls-listener", "title": "How to verify peer certificates in TLS listener", "body": "<p>I am writing a TLS listener and accepting new connections. The new connections must be verified against a list of SHA1s before continuing. The issue is that <code>tls.Listen()</code> returns a listener of the interface <code>net.Listener</code>. This means <code>Accept()</code> will yield plain-jane <code>net.Conn</code> and not the <code>tls.Conn</code> which provides a <code>ConnectionState().PeerCertificates</code>.</p>\n\n<p>The accepted <code>net.Conn</code> are too basic but when I cast to the more specific <code>*tls.Conn</code> type I receive a runtime exception.</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"fmt\"\n    \"net\"\n)\n\ntype Service struct {\n    listener net.Listener\n}\n\nfunc (serv *Service)Listen(port int64) (err error) {\n    cert, err := tls.LoadX509KeyPair( \"/etc/SCAMP/services/helloworld.crt\",\"/etc/SCAMP/services/helloworld.key\" )\n    if err != nil {\n        return\n    }\n\n    config := &amp;tls.Config{\n        Certificates: []tls.Certificate{ cert },\n    }\n\n    serv.listener,err = tls.Listen(\"tcp\", \"127.0.0.1:30101\", config)\n    if err != nil {\n        return err\n    }\n\n    return\n}\n\nfunc (serv *Service)AcceptRequests() {\n    for {\n        netConn,_ := serv.listener.Accept()\n        var tlsConn (*tls.Conn) = netConn.(*tls.Conn)\n\n        certs := tlsConn.ConnectionState().PeerCertificates\n\n        fmt.Printf(\"got certs: `%s`\\n\", certs)\n    }\n}\n\nfunc main() {\n    serv := new(Service)\n    serv.Listen(30100)\n\n    tlsConn, _ := tls.Dial(\"tcp\",\"127.0.0.1:30101\", &amp;tls.Config{\n        InsecureSkipVerify: true,\n    })\n    tlsConn.Write([]byte(\"hey\"))\n}\n</code></pre>\n\n<p>which errors as such:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xb code=0xffffffff addr=0x0 pc=0x78a77]\n\ngoroutine 1 [running]:\ncrypto/tls.(*Conn).Handshake(0x0, 0x1050a008, 0x0, 0x0)\n    /usr/src/go/src/crypto/tls/conn.go:967 +0x317\ncrypto/tls.(*Conn).Write(0x0, 0x10538120, 0x3, 0x8, 0x0, 0x0, 0x0, 0xfefd2220)\n    /usr/src/go/src/crypto/tls/conn.go:845 +0x80\nmain.main()\n    /tmp/sandbox290881341/main.go:49 +0x1c0\n\ngoroutine 2 [runnable]:\nruntime.forcegchelper()\n    /usr/src/go/src/runtime/proc.go:90\nruntime.goexit()\n    /usr/src/go/src/runtime/asm_amd64p32.s:1086 +0x1\n\ngoroutine 3 [runnable]:\nruntime.bgsweep()\n    /usr/src/go/src/runtime/mgc0.go:82\nruntime.goexit()\n    /usr/src/go/src/runtime/asm_amd64p32.s:1086 +0x1\n\ngoroutine 4 [runnable]:\nruntime.runfinq()\n    /usr/src/go/src/runtime/malloc.go:712\nruntime.goexit()\n    /usr/src/go/src/runtime/asm_amd64p32.s:1086 +0x1\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/gv7dy8XQ81\" rel=\"nofollow\">http://play.golang.org/p/gv7dy8XQ81</a></p>\n"}, {"tags": ["inheritance", "go", "variable-assignment", "member"], "answers": [{"comments": [{"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 0, "creation_date": 1438052654, "post_id": 31665917, "comment_id": 51277428, "body": "Oh, then I can do it with a cast. Anyway, found (from Roberto Zanotto) the simplest answer is <code>c = Car{Vehicle: v}</code>, to make <a href=\"http://play.golang.org/p/dcs9r7vPjZ\" rel=\"nofollow noreferrer\">play.golang.org/p/dcs9r7vPjZ</a> working. Thanks all the same."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 0, "creation_date": 1438092594, "post_id": 31665917, "comment_id": 51299246, "body": "@xpt: I&#39;m not sure what you mean by doing with a cast, since there is no direct &quot;casting&quot; in go."}, {"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 0, "creation_date": 1438103943, "post_id": 31665917, "comment_id": 51307759, "body": "I was talking about doing assignment from base class to inherit class in other OO languages like C++"}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 3, "last_activity_date": 1438047163, "last_edit_date": 1438047163, "creation_date": 1438046403, "answer_id": 31665917, "question_id": 31665810, "link": "https://stackoverflow.com/questions/31665810/assignment-from-base-class-to-inherit-class-in-go/31665917#31665917", "title": "Assignment from base class to inherit class in Go", "body": "<blockquote>\n  <p>I can assign a Vehicle object into a Car object</p>\n</blockquote>\n\n<p>Do you mean opposite? In OOP you cannot assign Vehicle to Car, but you can assign either Car or Van to Vehicle.</p>\n\n<p>If so, you can do this in Go, of course:</p>\n\n<pre><code>var v Vehicle\nc := Car{Vehicle:Vehicle{1}}\nv = c.Vehicle\nfmt.Println(v) // prints {1}\n</code></pre>\n\n<p>This example also demonstrates that you can initialise exactly the fields you want to. However, this type of object construction is quite limited so the construction method is what typically used to get constructor-like behaviour:</p>\n\n<pre><code>func CreateVehicle(wheels int) Vehicle {\n    return Vehicle{wheels}\n}\n\nfunc CreateCar(wheels int, maker string) Car {\n    return Car{CreateVehicle(wheels), maker}\n}\n\nfunc main() {\n    var v Vehicle\n    c := CreateCar(4, \"Ford\")\n    v = c.Vehicle\n    fmt.Println(v)\n}\n</code></pre>\n\n<p>BTW, the reference management can be tricky in Go if you normally work with reference types. The structs are always passed by value. To pass it by reference, use <code>&amp;</code> to get reference and <code>*</code> to specify the byref parameter.</p>\n\n<p>So, this will not work:</p>\n\n<pre><code>func (v Vehicle) SetNumberOfWeels(wheels int) {\n    v.wheelCount = wheels\n}\n\nfunc main() {\n    v := Vehicle{}\n    v.SetNumberOfWeels(5)\n    fmt.Println(v) // prints {0}\n}\n</code></pre>\n\n<p>But this will:</p>\n\n<pre><code>func (v *Vehicle) SetNumberOfWeels(wheels int) {\n    v.wheelCount = wheels\n}\n\nfunc main() {\n    v := Vehicle{}\n    v.SetNumberOfWeels(5)\n    fmt.Println(v) // prints {5}\n}\n</code></pre>\n"}], "owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 954, "favorite_count": 0, "accepted_answer_id": 31665917, "answer_count": 1, "score": -3, "last_activity_date": 1438047163, "creation_date": 1438045471, "question_id": 31665810, "link": "https://stackoverflow.com/questions/31665810/assignment-from-base-class-to-inherit-class-in-go", "title": "Assignment from base class to inherit class in Go", "body": "<p>I know Go doesn't have such OO concept, but let me borrow them just to make it easier to explain. </p>\n\n<p>OO inherits allows generalizing behavior to a more abstract type or class, using a class and a subclass of it, where the subclass inherits all the member fields and behaviors of the parent class. Go doesn't have such concept, but <a href=\"http://golangtutorials.blogspot.ca/2011/06/inheritance-and-subclassing-in-go-or.html\" rel=\"nofollow\">can achieve the same paradigm</a>, in which the article explains Inheritance and subclassing in Go.</p>\n\n<p>My question is more on the assignment. Suppose I have a \"base class\" Vehicle and a \"inherit class\" Car, like the following:</p>\n\n<pre><code>type Vehicle struct {\n    wheelCount int\n}\n\ntype Car struct {\n    Vehicle //anonymous field Vehicle\n    Maker   string\n}\n</code></pre>\n\n<p>In true OO, I can assign a Vehicle object into a Car object, but I haven't found a way to do that in Go. So my questions are,</p>\n\n<ul>\n<li>Is it possible to do that? </li>\n<li>Else, what's the Go way to write a \"Car\" constructor from a \"Vehicle\"? I know the canonical way is <code>c := Car{Vehicle{4}, \"Ford\"}</code>, but what if I have other member fields in Car, like Module etc, and I'd like only to initial the member fields from Vehicle, nothing else? </li>\n</ul>\n\n<p>I've prepared something for you to start with,\n<a href=\"http://play.golang.org/p/dcs9r7vPjZ\" rel=\"nofollow\">http://play.golang.org/p/dcs9r7vPjZ</a></p>\n\n<p>Thanks</p>\n"}, {"tags": ["regex", "go"], "answers": [{"comments": [{"owner": {"reputation": 411, "user_id": 3011331, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1373ada708df2e3cecf0d3b5a6bb037b?s=128&d=identicon&r=PG&f=1", "display_name": "Gary", "link": "https://stackoverflow.com/users/3011331/gary"}, "edited": false, "score": 0, "creation_date": 1438102846, "post_id": 31665711, "comment_id": 51307099, "body": "I think I have asked the wrong question so I made a new one. But I agree this is a good solution to this question.  <a href=\"http://stackoverflow.com/questions/31682707/golang-regexp-quote-submatch\" title=\"golang regexp quote submatch\">stackoverflow.com/questions/31682707/&hellip;</a>"}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 1, "last_activity_date": 1438044643, "creation_date": 1438044643, "answer_id": 31665711, "question_id": 31665634, "link": "https://stackoverflow.com/questions/31665634/golang-regexp-issue-with-findstringsubmatch/31665711#31665711", "title": "Golang regexp issue with FindStringSubmatch", "body": "<p>The last empty value corresponds to <code>(.+)</code> and just an indication that this capturing group was not 'hit' while matching. In other words, it is completely legitimate. In your case it will be safe to use non-capturing group instead: <code>(?:.+)</code> - <a href=\"http://play.golang.org/p/MEkkoGqxho\" rel=\"nofollow\">http://play.golang.org/p/MEkkoGqxho</a></p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 5163727, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/3766e5810c9d53f0bd0c80af10217d73?s=128&d=identicon&r=PG", "display_name": "walid", "link": "https://stackoverflow.com/users/5163727/walid"}, "is_accepted": false, "score": 0, "last_activity_date": 1438068225, "creation_date": 1438068225, "answer_id": 31669873, "question_id": 31665634, "link": "https://stackoverflow.com/questions/31665634/golang-regexp-issue-with-findstringsubmatch/31669873#31669873", "title": "Golang regexp issue with FindStringSubmatch", "body": "<p>why no just use:</p>\n\n<pre><code>^token=(llll)$\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/w7uV9q059w\" rel=\"nofollow\">demo</a></p>\n"}], "owner": {"reputation": 411, "user_id": 3011331, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/1373ada708df2e3cecf0d3b5a6bb037b?s=128&d=identicon&r=PG&f=1", "display_name": "Gary", "link": "https://stackoverflow.com/users/3011331/gary"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1062, "favorite_count": 0, "accepted_answer_id": 31665711, "answer_count": 2, "score": 0, "last_activity_date": 1438068225, "creation_date": 1438043983, "question_id": 31665634, "link": "https://stackoverflow.com/questions/31665634/golang-regexp-issue-with-findstringsubmatch", "title": "Golang regexp issue with FindStringSubmatch", "body": "<p>I was trying to use regexp to do some pattern matching with the or operator but I got some odd results. I have stripped out everything but the essentials to show the problem with my result.</p>\n\n<p>This is my code:</p>\n\n<p>package main</p>\n\n<pre><code>import \"fmt\"\nimport \"regexp\"\n\nfunc main() {\n  authRegexp := regexp.MustCompile(\"^token=(llll|(.+))$\")\n  matches := authRegexp.FindStringSubmatch(\"token=llll\")\n  fmt.Println(\"MATCHES\", matches, len(matches))\n        // MATCHES [token=llll llll ] 3\n}\n</code></pre>\n\n<p>Url: <a href=\"http://play.golang.org/p/nLtWQQgveY\" rel=\"nofollow\">http://play.golang.org/p/nLtWQQgveY</a></p>\n\n<p>The matches array has a length of 3, when I think it should have a length of 2. The last value is an empty string. I dont understand why it does this. Is this a golang bug? How do I submit golang bugs?</p>\n"}, {"tags": ["unit-testing", "testing", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1438049114, "post_id": 31664129, "comment_id": 51276653, "body": "What&#39;s the version of go on each?"}], "answers": [{"comments": [{"owner": {"reputation": 615, "user_id": 1184300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e96bc7318c32427e88071fc337b23070?s=128&d=identicon&r=PG", "display_name": "Christian Nuss", "link": "https://stackoverflow.com/users/1184300/christian-nuss"}, "edited": false, "score": 0, "creation_date": 1438116357, "post_id": 31672689, "comment_id": 51315253, "body": "That was it, thanks!  GOPATH was set incorrectly in the Linux environment."}], "tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": true, "score": 3, "last_activity_date": 1438076534, "creation_date": 1438076534, "answer_id": 31672689, "question_id": 31664129, "link": "https://stackoverflow.com/questions/31664129/executing-go-tests-underscore-in-place-of-correct-path/31672689#31672689", "title": "Executing Go Tests Underscore (_) in place of correct path", "body": "<p>You probably don't have <code>GOPATH</code> set in your Linux environment.</p>\n\n<p>If I create a file <code>src/foo/foo.go</code> in the current directory with the contents <code>package foo</code>, I can see the difference:</p>\n\n<pre><code>$ unset GOPATH\n$ go test ./src/foo\n?       _/home/james/.../src/foo    [no test files]\n$ export GOPATH=`pwd`\n$ go test ./src/foo\n?       foo [no test files]\n</code></pre>\n\n<p>Without <code>GOPATH</code> set (or with a package outside of <code>GOPATH</code>), it is acting as if this is a relative import.</p>\n"}], "owner": {"reputation": 615, "user_id": 1184300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e96bc7318c32427e88071fc337b23070?s=128&d=identicon&r=PG", "display_name": "Christian Nuss", "link": "https://stackoverflow.com/users/1184300/christian-nuss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 809, "favorite_count": 0, "accepted_answer_id": 31672689, "answer_count": 1, "score": 2, "last_activity_date": 1438076534, "creation_date": 1438034710, "question_id": 31664129, "link": "https://stackoverflow.com/questions/31664129/executing-go-tests-underscore-in-place-of-correct-path", "title": "Executing Go Tests Underscore (_) in place of correct path", "body": "<p>thanks in advance for the help.</p>\n\n<p>On my Mac, when I execute a <code>go test ./...</code> the correct \"path\" is outputted in the output:</p>\n\n<pre><code>ok      github.com/cnuss/server             0.008s\nok      github.com/cnuss/server/database    0.008s\n?       github.com/cnuss/server/handlers    [no test files]\nok      github.com/cnuss/server/stats       0.014s\n</code></pre>\n\n<p>However, when I build in an Ubuntu 14.04 Trusty container, the path has been replaced by an \"_\" (underscore):</p>\n\n<pre><code>ok      _/tmp/cnuss/server          0.003s\nok      _/tmp/cnuss/server/database 0.003s\n?       _/tmp/cnuss/server/handlers [no test files]\nok      _/tmp/cnuss/server/stats    0.008s\n</code></pre>\n\n<p>The change in the path is also reflected in the <code>-coverprofile</code> output file, which in turns affects some of the coverage tools I'm using.</p>\n\n<p>So question is, what affects the path that is resolved while executing <code>go test</code>?  The behavior on my Mac Book is the correct behavior.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12784, "user_id": 1401034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBXk9.png?s=128&g=1", "display_name": "Ewan", "link": "https://stackoverflow.com/users/1401034/ewan"}, "edited": false, "score": 0, "creation_date": 1438033210, "post_id": 31663745, "comment_id": 51272092, "body": "Where are you setting your <code>GOPATH</code> variable?"}, {"owner": {"reputation": 13759, "user_id": 299262, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iQZZ9.png?s=128&g=1", "display_name": "Ben Baron", "link": "https://stackoverflow.com/users/299262/ben-baron"}, "reply_to_user": {"reputation": 12784, "user_id": 1401034, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vBXk9.png?s=128&g=1", "display_name": "Ewan", "link": "https://stackoverflow.com/users/1401034/ewan"}, "edited": false, "score": 0, "creation_date": 1438033863, "post_id": 31663745, "comment_id": 51272358, "body": "In my .zshrc file and I can see it successfully if I use echo $GOPATH or go env"}], "answers": [{"tags": [], "owner": {"reputation": 13759, "user_id": 299262, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iQZZ9.png?s=128&g=1", "display_name": "Ben Baron", "link": "https://stackoverflow.com/users/299262/ben-baron"}, "is_accepted": true, "score": 0, "last_activity_date": 1438039335, "creation_date": 1438039335, "answer_id": 31664975, "question_id": 31663745, "link": "https://stackoverflow.com/questions/31663745/cant-compile-program-that-imports-net-http-on-os-x-with-homebrew-install/31664975#31664975", "title": "Can&#39;t compile program that imports net/http on OS X with homebrew install", "body": "<p>It turned out that my google app engine installation was clobbering these environment variables somehow. I deleted the folder google_appengine in my home directory and then uninstalled the Homebrew version of Go and reinstalled from the official OS X package and now it's working fine.</p>\n"}], "owner": {"reputation": 13759, "user_id": 299262, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/iQZZ9.png?s=128&g=1", "display_name": "Ben Baron", "link": "https://stackoverflow.com/users/299262/ben-baron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 31664975, "answer_count": 1, "score": 0, "last_activity_date": 1438039335, "creation_date": 1438033007, "last_edit_date": 1438036780, "question_id": 31663745, "link": "https://stackoverflow.com/questions/31663745/cant-compile-program-that-imports-net-http-on-os-x-with-homebrew-install", "title": "Can&#39;t compile program that imports net/http on OS X with homebrew install", "body": "<p>I've installed go using Homebrew on my OS X 10.10 machine. Every time I try to compile a sample app that imports net/http, I get the following error:</p>\n\n<p>load cmd/cgo: package cmd/cgo: no Go source files in /Users/bbaron/google_appengine/goroot/src/cmd/cgo</p>\n\n<p>I have my GOPATH variable set correctly ($HOME/go) and my directory structure appears to be correct:</p>\n\n<p>/Users/bbaron/go/src/github.com/einsteinx2/gamenotifier\n/Users/bbaron/go/src/github.com/einsteinx2/gamenotifier/server.go</p>\n\n<p>Why does cgo seem to thing the GOPATH is $HOME/google_appengine/goroot</p>\n\n<p>I previously (maybe a year ago) did some go development using App Engine, so there must be some left over garbage, but I can't figure out what I need to change to get this working.</p>\n\n<p>I do have the App Engine SDK installed to $HOME/google_appengine but I don't see why that's affecting anything when I'm not importing any App Engine stuff.</p>\n\n<p>Any ideas?</p>\n\n<p>EDIT: It looks like the problem is my GOROOT. The following are also in go env:</p>\n\n<p>GOROOT=\"/Users/bbaron/google_appengine/goroot\"\nGOTOOLDIR=\"/Users/bbaron/google_appengine/goroot/pkg/tool/darwin_amd64\"</p>\n\n<p>But even if I export a correct GOROOT and check with echo $GOROOT, go env does not see the correct GOROOT</p>\n"}, {"tags": ["regex", "go", "re2"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user557597"}, "edited": false, "score": 0, "creation_date": 1438033246, "post_id": 31663430, "comment_id": 51272111, "body": "<code>^a+(\\#a+)*(&#47;a+(\\#a+)*)*$</code> matches <code>aa#a#a&#47;a#a&#47;a</code>"}, {"owner": {"reputation": 1555, "user_id": 4959722, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-AQWZF9OmEs4/AAAAAAAAAAI/AAAAAAAAAGE/wvp_7UFCeZs/photo.jpg?sz=128", "display_name": "James Buck", "link": "https://stackoverflow.com/users/4959722/james-buck"}, "edited": false, "score": 0, "creation_date": 1438033414, "post_id": 31663430, "comment_id": 51272170, "body": "Yes, they all match. <a href=\"https://regex101.com/r/zA1sV0/1\" rel=\"nofollow noreferrer\">regex101.com/r/zA1sV0/1</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "reply_to_user": {"reputation": 1555, "user_id": 4959722, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-AQWZF9OmEs4/AAAAAAAAAAI/AAAAAAAAAGE/wvp_7UFCeZs/photo.jpg?sz=128", "display_name": "James Buck", "link": "https://stackoverflow.com/users/4959722/james-buck"}, "edited": false, "score": 1, "creation_date": 1438033508, "post_id": 31663430, "comment_id": 51272205, "body": "@JamesBuck, but <a href=\"https://play.golang.org/p/7ZBXlug-66\" rel=\"nofollow noreferrer\">play.golang.org/p/7ZBXlug-66</a>"}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "reply_to_user": {"reputation": 1555, "user_id": 4959722, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-AQWZF9OmEs4/AAAAAAAAAAI/AAAAAAAAAGE/wvp_7UFCeZs/photo.jpg?sz=128", "display_name": "James Buck", "link": "https://stackoverflow.com/users/4959722/james-buck"}, "edited": false, "score": 2, "creation_date": 1438033517, "post_id": 31663430, "comment_id": 51272208, "body": "@JamesBuck Not sure how that helps. The question is about Go, not PHP."}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438033635, "post_id": 31663430, "comment_id": 51272253, "body": "That&#39;s the really the nice one. Similarly, &quot;^1(2(_1+)*)*$&quot; does not match &quot;12_1&quot; but &quot;^1(2(_1+)*)+$&quot; does!"}, {"owner": {"reputation": 1555, "user_id": 4959722, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-AQWZF9OmEs4/AAAAAAAAAAI/AAAAAAAAAGE/wvp_7UFCeZs/photo.jpg?sz=128", "display_name": "James Buck", "link": "https://stackoverflow.com/users/4959722/james-buck"}, "edited": false, "score": 0, "creation_date": 1438033840, "post_id": 31663430, "comment_id": 51272351, "body": "@Atomic_alarm Yes that is weird, must be something strange with the Go regex engine. All of the other regex engines I tried match this pattern against the string."}, {"owner": {"reputation": 1555, "user_id": 4959722, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-AQWZF9OmEs4/AAAAAAAAAAI/AAAAAAAAAGE/wvp_7UFCeZs/photo.jpg?sz=128", "display_name": "James Buck", "link": "https://stackoverflow.com/users/4959722/james-buck"}, "edited": false, "score": 0, "creation_date": 1438034524, "post_id": 31663430, "comment_id": 51272647, "body": "The regex works when changing the last quantifier to 1 or more rather than 0 or more - <code>^a+(#a+)*(&#47;a+(#a+)*)+$</code>. Not sure why."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "reply_to_user": {"reputation": 1555, "user_id": 4959722, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-AQWZF9OmEs4/AAAAAAAAAAI/AAAAAAAAAGE/wvp_7UFCeZs/photo.jpg?sz=128", "display_name": "James Buck", "link": "https://stackoverflow.com/users/4959722/james-buck"}, "edited": false, "score": 0, "creation_date": 1438034744, "post_id": 31663430, "comment_id": 51272728, "body": "@JamesBuck , I agree, that really strange."}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438037276, "post_id": 31663430, "comment_id": 51273652, "body": "Maybe a bug in RE2? I&#39;ve <a href=\"https://twitter.com/alex_at_net/status/625793785096749056\" rel=\"nofollow noreferrer\">twitted</a> and added [re2] in tags. Maybe it makes sense to report this issue to RE2 issue tracker as well."}], "answers": [{"comments": [{"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438035632, "post_id": 31664014, "comment_id": 51273077, "body": "It works, but I cannot understand why the backtracking is important here. I assume that RE is just greedy, so in this case: ^1(2(_1+)*)*$&quot; does not match &quot;12_1&quot; - ^1 eats 1, 2_1 left. (2...) eats 2, _1 left. (_1+)* eats _1. Empty, not bq. But it does not work this way."}, {"owner": {"reputation": 78982, "user_id": 1848654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84180c0f3c9c04f8b8f0613fc0129dac?s=128&d=identicon&r=PG", "display_name": "melpomene", "link": "https://stackoverflow.com/users/1848654/melpomene"}, "edited": false, "score": 0, "creation_date": 1438035647, "post_id": 31664014, "comment_id": 51273087, "body": "This is not an answer."}, {"owner": {"user_type": "does_not_exist", "display_name": "user557597"}, "edited": false, "score": 0, "creation_date": 1438036041, "post_id": 31664014, "comment_id": 51273234, "body": "This little subtle difference is the problem <code>(\\#?a)*</code> and <code>(\\#?a+)*</code>"}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438036219, "post_id": 31664014, "comment_id": 51273286, "body": "@sln hold on, we are still trying, but it is not simple. Apparently, RE2 does not do any of the above and it even tries to find the match. It works for &quot;a&quot;, &quot;a/a&quot;, &quot;a#a/a&quot;, but not for &quot;a/a#a&quot;. I&#39;m reading through <a href=\"http://www.regular-expressions.info/catastrophic.html\" rel=\"nofollow noreferrer\">regular-expressions.info/catastrophic.html</a> and I cannot understand where backtracking happens in this case."}, {"owner": {"user_type": "does_not_exist", "display_name": "user557597"}, "reply_to_user": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438036591, "post_id": 31664014, "comment_id": 51273427, "body": "@AlexAtNet  - As you can see, the original regex was not correct, it matched <code>a</code> all by itself. A better one is probably needed."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "edited": false, "score": 0, "creation_date": 1438036638, "post_id": 31664014, "comment_id": 51273444, "body": "what is also interesting,if take the first part in brackets(<code>^(a+(#a+)*)(&#47;a+(#a+)*)*$</code>),the match will be correct. Why?"}, {"owner": {"reputation": 2900, "user_id": 2898400, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/8d5c75d8d2fe7f1cd7b57119f5c4852a?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Bukanov", "link": "https://stackoverflow.com/users/2898400/igor-bukanov"}, "edited": false, "score": 0, "creation_date": 1438060810, "post_id": 31664014, "comment_id": 51279400, "body": "So for practical purposes the answer is that it is a bug in the engine and as a rule of thumb I should not use triple quantifier nesting to avoid hitting complexity bugs like that? Also, the suggested simplification should be <code>^a+[#&#47;](a+[#&#47;]?)*a+$ </code>, not <code>^a+[#&#47;](a[#&#47;]?)*a+$ </code>, which use 2-level nesting, not one"}, {"owner": {"user_type": "does_not_exist", "display_name": "user557597"}, "reply_to_user": {"reputation": 2900, "user_id": 2898400, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/8d5c75d8d2fe7f1cd7b57119f5c4852a?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Bukanov", "link": "https://stackoverflow.com/users/2898400/igor-bukanov"}, "edited": false, "score": 0, "creation_date": 1438102100, "post_id": 31664014, "comment_id": 51306657, "body": "@IgorBukanov - Yeah, I think that when RE2 regex&#39;s end in <i>optional</i> <code>*</code> nested quantifiers, it considers the complexity too high. In reality, you can reduce the regex to its bare minimum with this <code>^(?:a+[#&#47;])+a+$</code> or <code>^a+(?:[#&#47;]a+)+$</code>"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user557597"}, "is_accepted": false, "score": 0, "last_activity_date": 1438102445, "last_edit_date": 1438102445, "creation_date": 1438034195, "answer_id": 31664014, "question_id": 31663430, "link": "https://stackoverflow.com/questions/31663430/issue-with-regexp-with-nested-groups-in-golang/31664014#31664014", "title": "issue with regexp with nested groups in golang", "body": "<p>You can try to alleviate atomic sub-nesting of quantifiers.<br>\nIf you didn't have the anchors, the expression would possibly blow up<br>\nin backtracking if using nested optional quantifiers like this,<br>\nwhen it can't find a direct solution.  </p>\n\n<p>Go might be balking at that, forcing it to fail outright instead<br>\nof massive backtracking, but not sure.  </p>\n\n<p>Try something like this, see if it works.  </p>\n\n<pre><code> # ^a+(#?a)*(/a+(#?a)*)*$\n\n ^ \n a+\n (                    # (1 start)\n      \\#?\n      a \n )*                   # (1 end)\n (                    # (2 start)\n      /\n      a+\n      (                    # (3 start)\n           \\#?\n           a \n      )*                   # (3 end)\n )*                   # (2 end)\n $\n</code></pre>\n\n<p><em>edit</em>: (Transposed from comment) If complexity is too high, some engines will not even compile it, some will silently fail at runtime, some will lock up in a backtracking loop.  </p>\n\n<p>This little subtle difference is the problem  </p>\n\n<p>bad:  too complex <code>(#?a+)*</code><br>\ngood: no nested, open ended quantifiers <code>(#?a)*</code>  </p>\n\n<p>If you ever have this problem, strip out the nesting, usually solves<br>\nthe backtracking issue.</p>\n\n<hr>\n\n<p><em>eit2</em>: If you require a separator and want to insure a separator is only in the middle and surrounded by <code>a</code>'s, you could try this  </p>\n\n<p><a href=\"https://play.golang.org/p/oM6B6H3Kdx\" rel=\"nofollow\">https://play.golang.org/p/oM6B6H3Kdx</a></p>\n\n<pre><code> #  ^a+[#/](a[#/]?)*a+$\n\n ^ \n a+\n [\\#/] \n (                             # (1 start)\n      a\n      [\\#/]? \n\n )*                            # (1 end)\n a+\n $ \n</code></pre>\n\n<p>or this</p>\n\n<p><a href=\"https://play.golang.org/p/WihqSjH_dI\" rel=\"nofollow\">https://play.golang.org/p/WihqSjH_dI</a></p>\n\n<pre><code> # ^a+(?:[#/]a+)+$\n\n ^ \n a+ \n (?:\n      [\\#/] \n      a+\n )+\n $\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2900, "user_id": 2898400, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/8d5c75d8d2fe7f1cd7b57119f5c4852a?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Bukanov", "link": "https://stackoverflow.com/users/2898400/igor-bukanov"}, "is_accepted": false, "score": 0, "last_activity_date": 1438069160, "creation_date": 1438069160, "answer_id": 31670180, "question_id": 31663430, "link": "https://stackoverflow.com/questions/31663430/issue-with-regexp-with-nested-groups-in-golang/31670180#31670180", "title": "issue with regexp with nested groups in golang", "body": "<p>This must be a bug in golang regexp engine. A simpler test case is that <code>^a(/a+(#a+)*)*$</code> fails to match <code>a/a#a</code> while <code>^(a)(/a+(#a+)*)*$</code> works, see <a href=\"http://play.golang.org/p/CDKxVeXW98\" rel=\"nofollow\">http://play.golang.org/p/CDKxVeXW98</a> .</p>\n\n<p>I filed <a href=\"https://github.com/golang/go/issues/11905\" rel=\"nofollow\">https://github.com/golang/go/issues/11905</a></p>\n"}], "owner": {"reputation": 2900, "user_id": 2898400, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/8d5c75d8d2fe7f1cd7b57119f5c4852a?s=128&d=identicon&r=PG&f=1", "display_name": "Igor Bukanov", "link": "https://stackoverflow.com/users/2898400/igor-bukanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1102, "favorite_count": 1, "answer_count": 2, "score": 6, "last_activity_date": 1438102445, "creation_date": 1438031627, "last_edit_date": 1438037063, "question_id": 31663430, "link": "https://stackoverflow.com/questions/31663430/issue-with-regexp-with-nested-groups-in-golang", "title": "issue with regexp with nested groups in golang", "body": "<p>Consider the following toy example. I want to match in Go a name with a regexp where the name is sequences of letters <code>a</code> separated by single <code>#</code>, so <code>a#a#aaa</code> is valid, but <code>a#</code> or <code>a##a</code> are not. I can code the regexp in the following two ways:</p>\n\n<pre><code>r1 := regexp.MustCompile(`^a+(#a+)*$`)\nr2 := regexp.MustCompile(`^(a+#)*a+$`)\n</code></pre>\n\n<p>Both of these work. Now consider more complex task of matching a sequence of names separated by single slash. As in above, I can code that in two ways:</p>\n\n<pre><code>^N+(/N+)*$\n^(N+/)*N+$\n</code></pre>\n\n<p>where N is a regexp for the name with ^ and $ stripped. As I have two cases for N, so now I can have 4 regexps:</p>\n\n<pre><code>    ^a+(#a+)*(/a+(#a+)*)*$\n    ^(a+#)*a+(/a+(#a+)*)*$\n    ^((a+#)*a+/)*a+(#a+)*$\n    ^((a+#)*a+/)*(a+#)*a+$\n</code></pre>\n\n<p>The question is why when matching against the string <code>\"aa#a#a/a#a/a\"</code> the first one fails while the rest 3 cases work as expected? I.e. what causes the first regexp to mismatch? The full <a href=\"http://play.golang.org/p/tJFwK-RUKq\">code</a> is:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    str := \"aa#a#a/a#a/a\"\n    regs := []string {\n        `^a+(#a+)*(/a+(#a+)*)*$`,\n        `^(a+#)*a+(/a+(#a+)*)*$`,\n        `^((a+#)*a+/)*a+(#a+)*$`,\n        `^((a+#)*a+/)*(a+#)*a+$`,\n    }    \n    for _, r := range(regs) {\n        fmt.Println(regexp.MustCompile(r).MatchString(str))\n    } \n}\n</code></pre>\n\n<p>Surprisingly it prints <code>false true true true</code> </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1209, "user_id": 83879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/5c4e03b2704fefb2529a2d63c744145f?s=128&d=identicon&r=PG", "display_name": "golliher", "link": "https://stackoverflow.com/users/83879/golliher"}, "edited": false, "score": 0, "creation_date": 1438031689, "post_id": 31663374, "comment_id": 51271397, "body": "Thank you.  This is helpful.  I was hoping there might be a feature of the testing package that would capture stdout (ala pytest).  It seems like a common thing to need.   If that&#39;s not possible, yours looks like it will let me move forward and I&#39;ll accept this as an answer."}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "reply_to_user": {"reputation": 1209, "user_id": 83879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/5c4e03b2704fefb2529a2d63c744145f?s=128&d=identicon&r=PG", "display_name": "golliher", "link": "https://stackoverflow.com/users/83879/golliher"}, "edited": false, "score": 0, "creation_date": 1438032195, "post_id": 31663374, "comment_id": 51271624, "body": "To be honest, I do not know about any. But you can consider to <a href=\"https://blog.golang.org/examples\" rel=\"nofollow noreferrer\">test examples</a>. However, I assume that it is what you exactly want to do."}, {"owner": {"reputation": 4379, "user_id": 184176, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/811251725188ac87f9125177073c28d0?s=128&d=identicon&r=PG", "display_name": "sepehr", "link": "https://stackoverflow.com/users/184176/sepehr"}, "edited": false, "score": 5, "creation_date": 1503633043, "post_id": 31663374, "comment_id": 78706845, "body": "if just want to discard it use this: <code>os.Stdout,_ = os.Open(os.DevNull)</code>"}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 9, "last_activity_date": 1438031409, "creation_date": 1438031409, "answer_id": 31663374, "question_id": 31663229, "link": "https://stackoverflow.com/questions/31663229/how-can-stdout-be-captured-or-suppressed-for-golang-testing/31663374#31663374", "title": "How can stdout be captured or suppressed for Go(lang) testing?", "body": "<p><code>os.Stdout</code> which is used by the <code>fmt.Printf</code> and others is just a variable. So you can overwrite it at any time and restore it back when necessary. <a href=\"https://golang.org/pkg/os/#pkg-variables\" rel=\"noreferrer\">https://golang.org/pkg/os/#pkg-variables</a></p>\n"}, {"comments": [{"owner": {"reputation": 1209, "user_id": 83879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/5c4e03b2704fefb2529a2d63c744145f?s=128&d=identicon&r=PG", "display_name": "golliher", "link": "https://stackoverflow.com/users/83879/golliher"}, "edited": false, "score": 0, "creation_date": 1438083871, "post_id": 31666780, "comment_id": 51292604, "body": "While you&#39;re right it wasn&#39;t what I was asking for, it is generally useful and I wasn&#39;t aware of those functions.    So.. Thank you!"}, {"owner": {"reputation": 1209, "user_id": 83879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/5c4e03b2704fefb2529a2d63c744145f?s=128&d=identicon&r=PG", "display_name": "golliher", "link": "https://stackoverflow.com/users/83879/golliher"}, "edited": false, "score": 0, "creation_date": 1438083991, "post_id": 31666780, "comment_id": 51292678, "body": "Also, your advice on converting to using log for myshow.LoadPath is well taken.   I&#39;m getting that recommendation from others too so I&#39;m going to look into doing as you suggest."}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 2, "last_activity_date": 1438053809, "last_edit_date": 1438053809, "creation_date": 1438053425, "answer_id": 31666780, "question_id": 31663229, "link": "https://stackoverflow.com/questions/31663229/how-can-stdout-be-captured-or-suppressed-for-golang-testing/31666780#31666780", "title": "How can stdout be captured or suppressed for Go(lang) testing?", "body": "<p>Not exactly what you are asking for but still might be helpful.</p>\n\n<p>You can use <code>t.Log</code> (<a href=\"http://golang.org/pkg/testing/#T.Log\" rel=\"nofollow\">http://golang.org/pkg/testing/#T.Log</a>) and <code>t.Logf</code> (<a href=\"http://golang.org/pkg/testing/#T.Logf\" rel=\"nofollow\">http://golang.org/pkg/testing/#T.Logf</a>) methods in the test method. The output will be printed only if the test fails or the <code>-test.v</code> flag is set.</p>\n\n<p>I also would suggest to use <code>log</code> package to print to the console in <code>myshow.LoadPath</code>. Then you can disable (or capture) the output in the test by setting custom writer using <code>log.SetOutput</code></p>\n"}, {"tags": [], "owner": {"reputation": 814, "user_id": 2962507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cd475510f51619445b5235fe1dbe754?s=128&d=identicon&r=PG", "display_name": "dinvlad", "link": "https://stackoverflow.com/users/2962507/dinvlad"}, "is_accepted": false, "score": 3, "last_activity_date": 1568406854, "creation_date": 1568406854, "answer_id": 57930037, "question_id": 31663229, "link": "https://stackoverflow.com/questions/31663229/how-can-stdout-be-captured-or-suppressed-for-golang-testing/57930037#57930037", "title": "How can stdout be captured or suppressed for Go(lang) testing?", "body": "<p>The output can be <a href=\"https://github.com/golang/go/issues/21461#issuecomment-348374826\" rel=\"nofollow noreferrer\"><em>suppressed</em></a>\nby running the tests with <code>go test .</code>:</p>\n\n<blockquote>\n  <p><code>$ go help test</code></p>\n  \n  <p>Go test runs in two different modes: local\n  directory mode when invoked with no package arguments (for example,\n  'go test'), and package list mode when invoked with package arguments\n  (for example 'go test math', 'go test ./...', and even 'go test .').</p>\n  \n  <p>In local directory mode, go test compiles and tests the package\n  sources found in the current directory and then runs the resulting\n  test binary. In this mode, caching (discussed below) is disabled.\n  After the package test finishes, go test prints a summary line showing\n  the test status ('ok' or 'FAIL'), package name, and elapsed time.</p>\n  \n  <p>In package list mode, go test compiles and tests each of the packages\n  listed on the command line. If a package test passes, go test prints\n  only the final 'ok' summary line. If a package test fails, go test\n  prints the full test output. If invoked with the -bench or -v flag, go\n  test prints the full output even for passing package tests, in order\n  to display the requested benchmark results or verbose logging.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 3, "last_activity_date": 1573117272, "last_edit_date": 1573117272, "creation_date": 1572991790, "answer_id": 58720235, "question_id": 31663229, "link": "https://stackoverflow.com/questions/31663229/how-can-stdout-be-captured-or-suppressed-for-golang-testing/58720235#58720235", "title": "How can stdout be captured or suppressed for Go(lang) testing?", "body": "<p>To suppress the output during the test I use the following code. I fixes output as well as logging. After test is done it resets the output streams.</p>\n\n<pre><code>func TestStartStowWrongCommand(t *testing.T) {\n defer quiet()()   \n ...                      \n}\n\nfunc quiet() func() {\n null, _ := os.Open(os.DevNull)\n sout := os.Stdout\n serr := os.Stderr\n os.Stdout = null\n os.Stderr = null\n log.SetOutput(null)\n return func() {\n  defer null.Close()\n  os.Stdout = sout\n  os.Stderr = serr\n  log.SetOutput(os.Stderr)\n }\n}\n</code></pre>\n"}], "owner": {"reputation": 1209, "user_id": 83879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/5c4e03b2704fefb2529a2d63c744145f?s=128&d=identicon&r=PG", "display_name": "golliher", "link": "https://stackoverflow.com/users/83879/golliher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7416, "favorite_count": 2, "accepted_answer_id": 31663374, "answer_count": 4, "score": 11, "last_activity_date": 1573117272, "creation_date": 1438030857, "question_id": 31663229, "link": "https://stackoverflow.com/questions/31663229/how-can-stdout-be-captured-or-suppressed-for-golang-testing", "title": "How can stdout be captured or suppressed for Go(lang) testing?", "body": "<p>How can stdout be captured or suppressed for Go testing?</p>\n\n<p>I am trying to teach myself go(lang) testing.  In the code below, myshow.LoadPath prints lots of information to stdout (which is a normal side effect).     It does however make for very noisy output when I run \"go test\"    Is there a way to suppress or capture stdout?   </p>\n\n<p>For comparison, I'm thinking about something like this from the python world. <a href=\"http://pytest.org/latest/capture.html#captures\" rel=\"noreferrer\">http://pytest.org/latest/capture.html#captures</a></p>\n\n<pre><code>package slideshow_test\n\nimport (\n    \"os\"\n    \"testing\"\n\n    \"github.com/golliher/go-hpf/slideshow\"\n)\n\nfunc setupTest() {\n    myshow := slideshow.Slideshow{Name: \"This is my show\"}\n    myshow.LoadPath(\"..\")\n\n}\n\nfunc TestStub(t *testing.T) {\n    if true == false {\n        t.Fail()\n    }\n}\n\nfunc TestMain(m *testing.M) {\n    setupTest()\n    os.Exit(m.Run())\n\n}\n</code></pre>\n"}, {"tags": ["sql", "go"], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 1, "last_activity_date": 1438024000, "creation_date": 1438024000, "answer_id": 31661286, "question_id": 31661207, "link": "https://stackoverflow.com/questions/31661207/write-a-function-that-returns-a-slice-of-interfaces-in-golang/31661286#31661286", "title": "Write a function that returns a slice of interfaces in Golang", "body": "<p>You can easily allocate inside the function with syntax like the following;</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n        objs := &amp;[]interface{}{} \n        objs2 := make([]interface{}, 10)\n        objs3 := []interface{}{}\n    fmt.Println(len(*objs))\n    fmt.Println(len(objs2))\n    fmt.Println(len(objs3))\n}\n</code></pre>\n\n<p>Since everything implements the empty interface you can add any type to those collections with <code>append</code>. The init syntax is a bit clunky and probably what's throwing you... The reason it looks like that is because I'm declaring the type <code>interface{}</code> there when typically you'd have the name of an <em>actual</em> interface like <code>[]io.Writer{}</code>. Instead you need those extract curlys.</p>\n"}], "owner": {"reputation": 48731, "user_id": 329700, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/41910a452554b187d044c00c576866b1?s=128&d=identicon&r=PG", "display_name": "Kevin Burke", "link": "https://stackoverflow.com/users/329700/kevin-burke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1438060729, "creation_date": 1438023727, "question_id": 31661207, "link": "https://stackoverflow.com/questions/31661207/write-a-function-that-returns-a-slice-of-interfaces-in-golang", "title": "Write a function that returns a slice of interfaces in Golang", "body": "<p>In Golang the <code>Scanner</code> interface takes a single <code>dest</code> argument, which is any number of <code>interface{}</code>s:</p>\n\n<pre><code>// Scan copies the columns in the current row into the values pointed at by dest.\nfunc (rs *Rows) Scan(dest ...interface{}) error\n</code></pre>\n\n<p>Is there an alternative function that can return a slice of interfaces as its result? Say I wanted to put the <code>dest</code> arguments in a function, so I didn't have to write them out every time.</p>\n\n<pre><code>func scanArgs() []interface{} {\n\n}\n\nfunc main() {\n    db.QueryRow(\"SELECT * FROM users\").Scan(scanArgs()...)\n}\n</code></pre>\n\n<p>I've tried this but I'm running into issues with the method signature; I can set a <code>[]interface</code> as the return value, but I can't easily create one inside the function. Is there a better way to do this?</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438022084, "post_id": 31660524, "comment_id": 51266029, "body": "You kick off a new 5-second timer each time through your loop. If you sort the second list, there are two adjacent durations (2500 and 8100) more than 5 seconds apart. Not so for the first list (the biggest gap is 2500 to 6000). If you created the <code>time.After</code> channel outside of the loop, you&#39;d see the timeout code run. Whether that&#39;s the right thing to do in real life depends on your application."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1438022185, "post_id": 31660524, "comment_id": 51266098, "body": "You should include the code in the question and not rely on external links to make your question understandable."}, {"owner": {"reputation": 53, "user_id": 291699, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9f6a01d279d9a3b5dbcec1143c5de69b?s=128&d=identicon&r=PG", "display_name": "cLee", "link": "https://stackoverflow.com/users/291699/clee"}, "edited": false, "score": 0, "creation_date": 1438023359, "post_id": 31660524, "comment_id": 51266830, "body": "It seems a lot of tutorials/blogs explain this timeout using time.After incorrectly.  I got the impression it was an overall timeout, as in any goroutine taking longing than 5 seconds would trigger that case in the select. I think I should research sync.WaitGroup to handle a fan out of goroutines."}, {"owner": {"reputation": 53, "user_id": 291699, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9f6a01d279d9a3b5dbcec1143c5de69b?s=128&d=identicon&r=PG", "display_name": "cLee", "link": "https://stackoverflow.com/users/291699/clee"}, "edited": false, "score": 0, "creation_date": 1438025639, "post_id": 31660524, "comment_id": 51268081, "body": "The reason behind trying to understand concurrency/timeouts in Go is to write a program that gathers social metrics for a given URL(s).  Where social metrics are counts from Google+, Facebook likes/shares, LinkedIn, Pinterest, StumbleUpon, and Tweets.  And to perform them in parallel (concurrently), but realizing that some api calls may take too long ... so they should be timed out. I&#39;ve done this before in Ruby/Python but never concurrently."}], "answers": [{"comments": [{"owner": {"reputation": 1667, "user_id": 359660, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a63c1f44ef127e609753975421ef7f?s=128&d=identicon&r=PG", "display_name": "LanceH", "link": "https://stackoverflow.com/users/359660/lanceh"}, "edited": false, "score": 0, "creation_date": 1438023961, "post_id": 31660698, "comment_id": 51267145, "body": "Try changing around the time.Duration(5) to 1 or 2.  (you don&#39;t need the time.Duration() part, just a plain int).  Change it to 1 and you&#39;ll see 2 timeouts, 2 seconds will have one timeout."}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": false, "score": 2, "last_activity_date": 1438022157, "creation_date": 1438022157, "answer_id": 31660698, "question_id": 31660524, "link": "https://stackoverflow.com/questions/31660524/concurrency-and-timeout-in-go/31660698#31660698", "title": "concurrency and timeout in Go", "body": "<p>The timeout is per-select invocation, if it keeps getting something from the channel once every 5 seconds (or less) it will keep going indefinitely.</p>\n\n<p>If you meant for the timeout to apply to all operations then do so like so:</p>\n\n<pre><code>    t := time.After(5 * time.Second)\n    for range sleep_durations {\n        select {\n        case msg := &lt;-c:\n            fmt.Println(\"received: \", msg)\n        case &lt;-t:\n            fmt.Println(\"*** TIMEOUT ***\")\n        }\n    }\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/r0_PyeE3bx\" rel=\"nofollow\">https://play.golang.org/p/r0_PyeE3bx</a></p>\n"}, {"tags": [], "owner": {"reputation": 53, "user_id": 291699, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9f6a01d279d9a3b5dbcec1143c5de69b?s=128&d=identicon&r=PG", "display_name": "cLee", "link": "https://stackoverflow.com/users/291699/clee"}, "is_accepted": true, "score": -1, "last_activity_date": 1438349544, "creation_date": 1438349544, "answer_id": 31747467, "question_id": 31660524, "link": "https://stackoverflow.com/questions/31660524/concurrency-and-timeout-in-go/31747467#31747467", "title": "concurrency and timeout in Go", "body": "<p>I found what I was looking for:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"sync\"\n  \"time\"\n)\n\nfunc main() {\n  var wg sync.WaitGroup\n  done := make(chan struct{})\n  wq := make(chan interface{})\n  worker_count := 2\n\n  for i := 0; i &lt; worker_count; i++ {\n    wg.Add(1)\n    go doit(i, wq, done, &amp;wg)\n  }\n\n  fmt.Printf(\"doing work\\n\")\n  for i := 0; i &lt; worker_count; i++ {\n    time.Sleep(time.Millisecond * time.Duration(100))\n    wq &lt;- fmt.Sprintf(\"worker: %d\", i)\n  }\n\n  fmt.Printf(\"closing 'done' channel\\n\")\n  close(done)\n  fmt.Printf(\"block/wait until all workers are done\\n\")\n  wg.Wait()\n  fmt.Println(\"all done!\")\n}\n\nfunc doit(worker_id int, wq &lt;-chan interface{}, done &lt;-chan struct{}, wg *sync.WaitGroup) {\n  fmt.Printf(\"[%v] is working\\n\", worker_id)\n  defer wg.Done()\n  max_time := time.Second * time.Duration(5)\n  for {\n    select {\n    case m := &lt;-wq:\n      fmt.Printf(\"[%v] m =&gt; %v\\n\", worker_id, m)\n    case &lt;-done:\n      fmt.Printf(\"[%v] is done\\n\", worker_id)\n      return\n    case &lt;-time.After(max_time):\n      fmt.Printf(\"timeout &gt; %s seconds!\\n\", max_time)\n    }\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 53, "user_id": 291699, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9f6a01d279d9a3b5dbcec1143c5de69b?s=128&d=identicon&r=PG", "display_name": "cLee", "link": "https://stackoverflow.com/users/291699/clee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 428, "favorite_count": 0, "accepted_answer_id": 31747467, "answer_count": 2, "score": 1, "last_activity_date": 1438349544, "creation_date": 1438021539, "last_edit_date": 1438026525, "question_id": 31660524, "link": "https://stackoverflow.com/questions/31660524/concurrency-and-timeout-in-go", "title": "concurrency and timeout in Go", "body": "<p>This Go program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    start := time.Now()\n\n    sleep_durations := []int{8100, 1000, 2500, 500, 6000}\n    // sleep_durations := []int{8100, 1000, 2500, 500}\n    c := make(chan string)\n    defer close(c) // close channel when main exits\n    for index, duration := range sleep_durations {\n        go sleepy(fmt.Sprintf(\"sleepy%d: \", index+1), duration, c)\n    }\n    fmt.Printf(\"starting %d sleepys\\n\", len(sleep_durations))\n\n    for range sleep_durations {\n        select {\n        case msg := &lt;-c:\n            fmt.Println(\"received: \", msg)\n        case &lt;-time.After(time.Second * time.Duration(5)):\n            fmt.Println(\"*** TIMEOUT ***\")\n        }\n    }\n\n    elapsed := time.Since(start)\n    fmt.Printf(\"... %d sleepys ran in: %e\\n\", len(sleep_durations), elapsed.Seconds())\n}\n\nfunc sleepy(msg string, sleep_ms int, yawn chan string) {\n    start := time.Now()\n    sleep := time.Duration(sleep_ms) * time.Millisecond\n    time.Sleep(sleep) // some sleepy work\n    yawn &lt;- fmt.Sprintf(\"%s slept for %s\", msg, sleep)\n    elapsed := time.Since(start)\n    fmt.Printf(\"\\t%s finished in: %s\\n\", msg, elapsed)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/0ioTuKv230\" rel=\"nofollow\">https://play.golang.org/p/0ioTuKv230</a></p>\n\n<p>has confusing results.  When line 11 is uncommented it does not work as expected, i.e. the <code>time.After</code> 5 seconds doesn't happen. But with line 11 commented and line 12 uncommented the timeout does work as expected. I'm new to Go, but what am I missing?</p>\n"}, {"tags": ["xml", "http", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1438018250, "post_id": 31659320, "comment_id": 51263738, "body": "Please chow an example of what you&#39;re doing. This looks like you&#39;re printing a <code>[]byte</code> from a portion of the response."}, {"owner": {"reputation": 13, "user_id": 3233829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YvW9h.jpg?s=128&g=1", "display_name": "ArulLivingston", "link": "https://stackoverflow.com/users/3233829/arullivingston"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438020196, "post_id": 31659320, "comment_id": 51264873, "body": "I am printing the response.body. Here is my code:                                     tr := &amp;http.Transport{ \tTLSClientConfig: &amp;tls.Config{InsecureSkipVerify: true}, } client := &amp;http.Client{Transport: tr} response, err := client.Get(&quot;<a href=\"https://domainc.local/FederationMetadata/2007-06/FederationMetadata.xml&quot;\" rel=\"nofollow noreferrer\">domainc.local/FederationMetadata/2007-06/&hellip;</a>) if err != nil { \tos.Exit(1) } else { \tdefer response.Body.Close() \tfmt.Println(response.Body) \tresponseXML, err := ioutil.ReadAll(response.Body) \tif err != nil { \t\tfmt.Printf(&quot;%s&quot;, err) \t\tos.Exit(1) \t} \tfmt.Println(responseXML) }"}, {"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 0, "creation_date": 1438020912, "post_id": 31659320, "comment_id": 51265291, "body": "Try to edit the question and add some code. In the current form it impossible for anyone to know exactly what your problem is."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438020916, "post_id": 31659320, "comment_id": 51265293, "body": "Please put your code into the question and format it properly. It&#39;s very hard to read in a comment (esp. since it can&#39;t be parsed properly)."}, {"owner": {"reputation": 13, "user_id": 3233829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YvW9h.jpg?s=128&g=1", "display_name": "ArulLivingston", "link": "https://stackoverflow.com/users/3233829/arullivingston"}, "reply_to_user": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 1, "creation_date": 1438023051, "post_id": 31659320, "comment_id": 51266613, "body": "Thank you @AlexatNet for editing it."}, {"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1438023098, "post_id": 31659320, "comment_id": 51266652, "body": "Just DIY next time :)"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 0, "last_activity_date": 1438021453, "creation_date": 1438021453, "answer_id": 31660499, "question_id": 31659320, "link": "https://stackoverflow.com/questions/31659320/reading-federationmetadata-xml-in-golang-using-http/31660499#31660499", "title": "Reading FederationMetadata.xml in golang using http", "body": "<p><code>responseXML</code> is slice of bytes (a <code>[]byte</code>). </p>\n\n<p>You must convert it to a string to print it, either with:</p>\n\n<pre><code>fmt.Println(string(responseXML))\n</code></pre>\n\n<p>or via <code>%s</code> in a Printf format string:</p>\n\n<pre><code>fmt.Printf(\"This is the response: \\n%s\\n\", responseXML)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": false, "score": 0, "last_activity_date": 1438021453, "creation_date": 1438021453, "answer_id": 31660500, "question_id": 31659320, "link": "https://stackoverflow.com/questions/31659320/reading-federationmetadata-xml-in-golang-using-http/31660500#31660500", "title": "Reading FederationMetadata.xml in golang using http", "body": "<p>Instead <code>fmt.Println(response.Body)</code> use <code>fmt.Println(string(response.Body))</code>, which should print:</p>\n\n<pre><code>... =\"urn:oasis:names:tc:SAML:2.0:assertion\"/&gt;&lt;Attribute Name=\"http://schemas.microsoft.com/2012/01/requestcontext/c ...\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 3233829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YvW9h.jpg?s=128&g=1", "display_name": "ArulLivingston", "link": "https://stackoverflow.com/users/3233829/arullivingston"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 31660499, "answer_count": 2, "score": -3, "last_activity_date": 1438021453, "creation_date": 1438017474, "last_edit_date": 1438021209, "question_id": 31659320, "link": "https://stackoverflow.com/questions/31659320/reading-federationmetadata-xml-in-golang-using-http", "title": "Reading FederationMetadata.xml in golang using http", "body": "<p>I am trying to get the  FederationMetadata.xml  using http in golan using the following way.</p>\n\n<pre><code>response, err := client.Get(\"https://domainc.local/FederationMetadata/2007-06/FederationMetadata.xml\"). \n</code></pre>\n\n<p>The response body comes back as all numeric values(see below) and not in XML format. But I am able to download this file  from chrome as an xml file.</p>\n\n<pre><code>61 34 117 114 110 58 111 97 115 105 115 58 110 97 109 101 115 58\n116 99 58 83 65 77 76 58 50 46 48 58 97 115 115 101 114 116 105 111\n110 34 47 62 60 65 116 116 114 105 98 117 116 101 32 78 97 109 101\n61 34 104 116 116 112 58 47 47 115 99 104 101 109 97 115 46 109\n105 99 114 111 115 111 102 116 46 99 111 109 47 50 48 49 50 47 48\n49 47 114 101 113 117 101 115 116 99 111 110 116 101 120 116 47 99 10\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>tr := &amp;http.Transport{TLSClientConfig: &amp;tls.Config{InsecureSkipVerify: true}}\nclient := &amp;http.Client{Transport: tr}\nresponse, err := client.Get(\"https://domainc.local/FederationMetadata/2007-06/FederationMetadata.xml\")\nif err != nil {\n    os.Exit(1)\n} else {\n    defer response.Body.Close()\n    fmt.Println(response.Body)\n    responseXML, err := ioutil.ReadAll(response.Body)\n    if err != nil {\n        fmt.Printf(\"%s\", err)\n        os.Exit(1)\n    }\n    fmt.Println(responseXML)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1984, "user_id": 290541, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/92EyJ.jpg?s=128&g=1", "display_name": "blockcipher", "link": "https://stackoverflow.com/users/290541/blockcipher"}, "edited": false, "score": 0, "creation_date": 1438012768, "post_id": 31657207, "comment_id": 51260460, "body": "The waitgroup was just an example, though I do appreciate the answer.  I&#39;m more interested in is pros/cons or best practices of using each."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1984, "user_id": 290541, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/92EyJ.jpg?s=128&g=1", "display_name": "blockcipher", "link": "https://stackoverflow.com/users/290541/blockcipher"}, "edited": false, "score": 0, "creation_date": 1438013512, "post_id": 31657207, "comment_id": 51260969, "body": "@blockcipher: added note about a use for Goexit."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1438018931, "post_id": 31657207, "comment_id": 51264159, "body": "There really aren&#39;t many uses for it--it seems like essentially a <code>panic()</code> that can&#39;t be <code>recover()</code>ed from. The most likely scenario I can see is when you&#39;ve exposed an API that means something like &quot;exit&quot;, as <code>FailNow()</code> does."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 8, "last_activity_date": 1438030154, "last_edit_date": 1438030154, "creation_date": 1438011113, "answer_id": 31657207, "question_id": 31657129, "link": "https://stackoverflow.com/questions/31657129/return-vs-goexit-for-goroutines/31657207#31657207", "title": "Return vs. Goexit for goroutines", "body": "<p>You should rarely ever need to use <code>runtime.Goexit</code>. It's used to terminate the current goroutine, when you <em>can't</em> return from the call site, e.g. when you are in a function call within the goroutine. In the std library, the testing package uses it in functions like <code>FailNow</code> and <code>SkipNow</code> to immediately end the current test. In general, you should return normally from your goroutines to keep the code clear, and prevent unexpected behavior. </p>\n\n<p>The problem in your example is that you need to call <code>wg.Add</code> <em>before</em> you start the goroutine, otherwise you could reach the <code>Wait</code> call before the <code>wg.Add</code> calls have been executed. </p>\n\n<pre><code>wg.Add(1)\ngo func() {\n    defer wg.Done()\n    // Function goes here...\n}()\n</code></pre>\n"}], "owner": {"reputation": 1984, "user_id": 290541, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/92EyJ.jpg?s=128&g=1", "display_name": "blockcipher", "link": "https://stackoverflow.com/users/290541/blockcipher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3517, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1438030154, "creation_date": 1438010883, "question_id": 31657129, "link": "https://stackoverflow.com/questions/31657129/return-vs-goexit-for-goroutines", "title": "Return vs. Goexit for goroutines", "body": "<p>I did some digging, but didn't really find anything satisfactory, so I'm asking: are their any best practices or pros/cons for using return vs. runtime.Goexit for exiting a goroutine?  So far, the only thing I came across in some testing is that if you're using waitgroups, it may not call the Done function.</p>\n\n<p>Specific to the waitgroups (if interested): in some quick testing in a codebase I have, I create an anonymous function that executes as a goroutine to test a method that's supposed to run within a goroutine.  I tried to use defer to have it call wg.Done() when the function called runtime.Goexit, but it didn't work.  Not sure if this is intended or a bug.</p>\n\n<p>Code example:</p>\n\n<pre><code>go func() {\n    wg.Add(1)\n    defer wg.Done()\n    // Function goes here...\n}()\n</code></pre>\n"}, {"tags": ["google-app-engine", "http", "go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1438001191, "post_id": 31653361, "comment_id": 51252052, "body": "did you try <code>c.Request()</code>?"}, {"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1438001452, "post_id": 31653361, "comment_id": 51252234, "body": "@Not_a_Golfer golang.org/x/net/context  doesn&#39;t contain   Request"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1438004082, "post_id": 31653361, "comment_id": 51254246, "body": "as @icza mentioned, <code>appengine.NewContext</code> is not a <code>golang.org&#47;x&#47;net&#47;context.Context</code> object, and it has a request member."}], "answers": [{"comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1438006432, "post_id": 31654118, "comment_id": 51256010, "body": "what will be best way to get the http.requst data besides passing  it?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 1, "creation_date": 1438006820, "post_id": 31654118, "comment_id": 51256284, "body": "@MIkCode Passing it <i>is</i> the best way, but you may create a wrapper to hold the 2 values. See edited answer."}, {"owner": {"reputation": 1976, "user_id": 1825795, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/ce7ea9ccd1d09d51d16aa31328f03db9?s=128&d=identicon&r=PG", "display_name": "Koushik Shetty", "link": "https://stackoverflow.com/users/1825795/koushik-shetty"}, "edited": false, "score": 0, "creation_date": 1474475347, "post_id": 31654118, "comment_id": 66549491, "body": "i think golang.org/x/net/context is used. <a href=\"https://github.com/golang/appengine/commit/1c3fdc51e1021e4822cf8475c97d3a14a2a6648e#diff-ab414e534b5e27fda475b60d17cbc565R14\" rel=\"nofollow noreferrer\">appengine.go</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1438006823, "last_edit_date": 1438006823, "creation_date": 1438002928, "answer_id": 31654118, "question_id": 31653361, "link": "https://stackoverflow.com/questions/31653361/getting-http-request-from-context-on-appengine/31654118#31654118", "title": "Getting *http.Request from Context on AppEngine", "body": "<p><a href=\"https://cloud.google.com/appengine/docs/go/reference#NewContext\" rel=\"nofollow\"><code>appengine.NewContext(r)</code></a> returns a value of type <a href=\"https://cloud.google.com/appengine/docs/go/reference#Context\" rel=\"nofollow\"><code>appengine.Context</code></a>. This is not the same as the <a href=\"http://godoc.org/golang.org/x/net/context#Context\" rel=\"nofollow\"><code>Context</code></a> type of the <a href=\"http://godoc.org/golang.org/x/net/context\" rel=\"nofollow\"><code>golang.org/x/net/context</code></a> package!</p>\n\n<p>Having a value of type <code>appengine.Context</code>, you can't get the <code>*http.Request</code> you used to create it. If you will need the <code>*http.Request</code>, you have to take care of passing that around yourself (you have it, since you use that to create the context).</p>\n\n<p>Note that <code>appengine.Context</code> (which is an interface type) has a method <code>Context.Request()</code>, but that is for internal use only, it is not exported for anyone to call it. And also it returns an <code>interface{}</code> and not a <code>*http.Request</code>. Even if it returns a value holding a <code>*http.Request</code>, you can't rely on it as this method may be changed or removed in future versions.</p>\n\n<p>Passing the <code>*http.Request</code> along with the <code>appengine.Context</code> <em>is</em> the best way. Trying to get it from the context is just \"wizardry\" and might break with a new SDK release. If you want to simplify it, you may create a wrapper struct and pass that wrapper instead of 2 values, for example:</p>\n\n<pre><code>type Wrapper struct {\n    C appengine.Context\n    R *http.Request\n}\n</code></pre>\n\n<p>And a helper func:</p>\n\n<pre><code>func CreateCtx(r *http.Request) Wrapper {\n    return Wrapper{appengine.NewContext(r), r}\n}\n</code></pre>\n"}], "owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 716, "favorite_count": 0, "accepted_answer_id": 31654118, "answer_count": 1, "score": 3, "last_activity_date": 1438007098, "creation_date": 1438000827, "last_edit_date": 1438007098, "question_id": 31653361, "link": "https://stackoverflow.com/questions/31653361/getting-http-request-from-context-on-appengine", "title": "Getting *http.Request from Context on AppEngine", "body": "<p>I'm using app engine, and creating <code>context.Context</code> (golang.org/x/net/context) variable from the <code>*http.Request</code>.</p>\n\n<pre><code>    c := appengine.NewContext(r)\n</code></pre>\n\n<p>I'm passing the context around and I'm trying to figure out a way to get the <code>*http.Request</code> from the <code>context.Context</code> in order to log the <code>http.Request</code>.</p>\n\n<p>I search all over the doc but I couldn't find any solution.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 699, "user_id": 4154266, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0964f7df27f9558bbe660eca1a7971ad?s=128&d=identicon&r=PG", "display_name": "Ikenna", "link": "https://stackoverflow.com/users/4154266/ikenna"}, "edited": false, "score": 0, "creation_date": 1438003505, "post_id": 31653033, "comment_id": 51253753, "body": "Sorry f.timezone was taken from the code.. I have updated it with the right time zone &quot;Atlantic/Cape_Verde&quot;"}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 1, "last_activity_date": 1437999880, "creation_date": 1437999880, "answer_id": 31653033, "question_id": 31652070, "link": "https://stackoverflow.com/questions/31652070/get-given-timezone-timestamp/31653033#31653033", "title": "Get given timezone timestamp", "body": "<p>Make sure you check your errors, I assume it's telling you there's an issue.</p>\n\n<p>Have you checked: <a href=\"http://golang.org/pkg/time/#LoadLocation\" rel=\"nofollow\">http://golang.org/pkg/time/#LoadLocation</a></p>\n\n<p>Is your timezone in: $GOROOT/lib/time/zoneinfo.zip?</p>\n\n<p>For me:</p>\n\n<pre><code>time.LoadLocation(\"CDT\") // my time zone\ntime.LoadLocation(\"CST\")\n</code></pre>\n\n<p>Both result in an error.</p>\n\n<p>To get my time zone, I must do:</p>\n\n<pre><code>time.LoadLocation(\"America/Chicago\")\n</code></pre>\n\n<p>Make sure f.Timezone is valid.</p>\n"}, {"tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 8, "last_activity_date": 1438004372, "creation_date": 1438004372, "answer_id": 31654679, "question_id": 31652070, "link": "https://stackoverflow.com/questions/31652070/get-given-timezone-timestamp/31654679#31654679", "title": "Get given timezone timestamp", "body": "<p>Unix time is absolute. There is no \"BST Unix time.\" There is no \"Atlantic/Cape_Verde\" Unix time.\" There is only Unix time. It is the number of seconds since a specific moment (<a href=\"https://en.wikipedia.org/wiki/Unix_time\">00:00:00 Coordinated Universal Time (UTC), Thursday, 1 January 1970, not counting leap seconds</a>).</p>\n\n<p>Time zones are related to the <em>representation</em> of time, not time itself. It is the same moment for you as it is for me, wherever we are in the world (leaving Einstein aside for the moment). We just happen to call that moment different things. Setting the location on a <code>*Time</code> just indicates how you would like to display the time. So if by \"timestamp\" you mean \"string representing the time,\" you can get the UTC timestamp with <code>time.Now().UTC().String()</code>.</p>\n"}], "owner": {"reputation": 699, "user_id": 4154266, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0964f7df27f9558bbe660eca1a7971ad?s=128&d=identicon&r=PG", "display_name": "Ikenna", "link": "https://stackoverflow.com/users/4154266/ikenna"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 804, "favorite_count": 0, "accepted_answer_id": 31654679, "answer_count": 2, "score": -1, "last_activity_date": 1438109551, "creation_date": 1437997062, "last_edit_date": 1438109551, "question_id": 31652070, "link": "https://stackoverflow.com/questions/31652070/get-given-timezone-timestamp", "title": "Get given timezone timestamp", "body": "<p>I am playing around with timezone and noticed something wierd.</p>\n\n<p>I am currently in the BST timezone which is an hour ahead of GMT.</p>\n\n<pre><code>        now := time.Now()\n        location, _ := time.LoadLocation(\"Atlantic/Cape_Verde\")\n        timeAtZone := now.In(location)\n        fmt.Println(timeAtZone)\n        timestamp = timeAtZone.Unix()\n        fmt.Println(timestamp)\n        fmt.Println(now.Add(-time.Hour).UTC().Unix())\n        fmt.Println(now.UTC().Unix())\n</code></pre>\n\n<p>You will notice that the timestamp is that of BST my current timezone.</p>\n\n<p>How do I get the timestamp of GMT???</p>\n\n<p><a href=\"http://play.golang.org/p/oq0IRYa0h7\" rel=\"nofollow\">http://play.golang.org/p/oq0IRYa0h7</a></p>\n"}, {"tags": ["encoding", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1438000772, "post_id": 31651410, "comment_id": 51251784, "body": "Why are you using the old packages? Try golang.org/x/text/encoding and friends."}], "answers": [{"tags": [], "owner": {"reputation": 351, "user_id": 148029, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b891900e3bfa963046d07ebdb23d92f7?s=128&d=identicon&r=PG", "display_name": "mat", "link": "https://stackoverflow.com/users/148029/mat"}, "is_accepted": false, "score": 5, "last_activity_date": 1438025591, "last_edit_date": 1438025591, "creation_date": 1438025103, "answer_id": 31661586, "question_id": 31651410, "link": "https://stackoverflow.com/questions/31651410/go-encoding-transform-issue/31661586#31661586", "title": "Go encoding transform issue", "body": "<p>Without the whole code along with an example URL it's hard to tell what exactly is going wrong here.</p>\n\n<p>That said, I can recommend the <a href=\"https://godoc.org/golang.org/x/net/html/charset\" rel=\"noreferrer\"><code>golang.org/x/net/html/charset</code></a> package for this as it supports both <em>char guessing</em> and converting to UTF 8.</p>\n\n<pre><code>func fetchUtf8Bytes(url string) ([]byte, error) {\n    res, err := http.Get(url)\n    if err != nil {\n        return nil, err\n    }\n\n    contentType := res.Header.Get(\"Content-Type\") // Optional, better guessing\n    utf8reader, err := charset.NewReader(res.Body, contentType)\n    if err != nil {\n        return nil, err\n    }\n\n    return ioutil.ReadAll(utf8reader)\n}\n</code></pre>\n\n<p>Complete example: <a href=\"http://play.golang.org/p/olcBM9ughv\" rel=\"noreferrer\">http://play.golang.org/p/olcBM9ughv</a></p>\n"}], "owner": {"reputation": 1799, "user_id": 889530, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/149043c936985d77b670e71061d12fec?s=128&d=identicon&r=PG", "display_name": "dmzkrsk", "link": "https://stackoverflow.com/users/889530/dmzkrsk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 736, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1438025591, "creation_date": 1437994980, "question_id": 31651410, "link": "https://stackoverflow.com/questions/31651410/go-encoding-transform-issue", "title": "Go encoding transform issue", "body": "<p>I have a following code in go:</p>\n\n<pre><code>import (\n    \"log\"\n    \"net/http\"\n    \"code.google.com/p/go.text/transform\"\n    \"code.google.com/p/go.text/encoding/charmap\"\n</code></pre>\n\n<p>)</p>\n\n<pre><code>...\n\nres, err := http.Get(url)\nif err != nil {\n    log.Println(\"Cannot read\", url);\n    log.Println(err);\n    continue\n}\ndefer res.Body.Close()\n</code></pre>\n\n<p>The page I load contain non UTF-8 symbols. So I try to use <code>transform</code></p>\n\n<pre><code>utfBody := transform.NewReader(res.Body, charmap.Windows1251.NewDecoder())\n</code></pre>\n\n<p>But the problem is, that it returns error even in this simple scenarion:</p>\n\n<pre><code>bytes, err := ioutil.ReadAll(utfBody)\nlog.Println(err)\nif err == nil {\n    log.Println(bytes)\n}\n</code></pre>\n\n<p><code>transform: short destination buffer</code></p>\n\n<p>It also actually sets <code>bytes</code> with some data, but in my real code I use <code>goquery</code>:</p>\n\n<pre><code>doc, err := goquery.NewDocumentFromReader(utfBody)\n</code></pre>\n\n<p>Which sees an error and fails with not data in return</p>\n\n<p>I tried to pass \"chunks\" of <code>res.Body</code> to <code>transform.NewReader</code> and figuried out, that as long as res.Body contains no non-UTF8 data it works well. And when it contains non-UTF8 byte it fails with an error above.</p>\n\n<p>I'm quite new to go and don't really understand what's going on and how to deal with this</p>\n"}, {"tags": ["go", "lexicographic"], "comments": [{"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 4, "creation_date": 1437994144, "post_id": 31650965, "comment_id": 51247406, "body": "I&#39;m voting to close this question as off-topic because it is too basic and not about the coding."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1437994831, "last_edit_date": 1437994831, "creation_date": 1437994022, "answer_id": 31651094, "question_id": 31650965, "link": "https://stackoverflow.com/questions/31650965/what-does-lexical-file-name-order-mean/31651094#31651094", "title": "What does lexical file name order mean?", "body": "<p>From <a href=\"https://en.wikipedia.org/wiki/Lexicographical_order\" rel=\"noreferrer\">Wikipedia</a>:</p>\n\n<blockquote>\n  <p>Lexical order is a generalization of the way the alphabetical order of words is based on the alphabetical order of their component letters.</p>\n</blockquote>\n\n<p>In practice this means files names are compared as strings, using the character codes to decide order. Order of character codes of the English alphabet follow the natural order of the letters, but the character code order is important if non-letters are also part of the file name (e.g. digits and other characters like <code>'-'</code>).</p>\n\n<p>This is just a convention to define an (arbitrary) order of source files if a package contains multiple source files, an order which remains the same if the package is recompiled (and of course files are not renamed).</p>\n\n<p>The purpose is so that source files are always processed in the same order, and therefore the package <code>init()</code> functions will also be executed in the same order, and you will observe the same behavior. Often the order of package <code>init()</code> functions does not matter, but there may be cases when it does. By following this lexical file name order convention, you can rely on the (fixed) execution order of the <code>init()</code> functions.</p>\n"}], "owner": {"reputation": 20459, "user_id": 1120221, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/0977d36f1cf30241c35121f1d741c8e9?s=128&d=identicon&r=PG&f=1", "display_name": "Salah Eddine Taouririt", "link": "https://stackoverflow.com/users/1120221/salah-eddine-taouririt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 878, "favorite_count": 3, "accepted_answer_id": 31651094, "answer_count": 1, "score": 5, "last_activity_date": 1438103068, "creation_date": 1437993658, "last_edit_date": 1438103068, "question_id": 31650965, "link": "https://stackoverflow.com/questions/31650965/what-does-lexical-file-name-order-mean", "title": "What does lexical file name order mean?", "body": "<p>In the <a href=\"https://golang.org/ref/spec#Package_initialization\" rel=\"nofollow\">package initialization</a> part of the Go specification, what does \"lexical file name order\" mean?</p>\n\n<blockquote>\n  <p>To ensure reproducible initialization behavior, build systems are\n  encouraged to present multiple files belonging to the same package in\n  lexical file name order to a compiler.</p>\n</blockquote>\n"}, {"tags": ["go", "terminology", "iota"], "comments": [{"owner": {"reputation": 1513, "user_id": 3316716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afbe3fa1baa8a749dd66449baeb9a837?s=128&d=identicon&r=PG", "display_name": "Sosdoc", "link": "https://stackoverflow.com/users/3316716/sosdoc"}, "edited": false, "score": 6, "creation_date": 1437991898, "post_id": 31650192, "comment_id": 51246052, "body": "What do you mean by full name? It&#39;s just written as <code>iota</code>."}, {"owner": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "edited": false, "score": 0, "creation_date": 1437992040, "post_id": 31650192, "comment_id": 51246146, "body": "I would say that the full name for &quot;iota&quot; is &quot;the predeclared identifier iota&quot; ;) (see here: <a href=\"https://golang.org/ref/spec#Iota\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Iota</a>), but I&#39;m not sure I understand the question correctly..."}, {"owner": {"reputation": 1513, "user_id": 3316716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afbe3fa1baa8a749dd66449baeb9a837?s=128&d=identicon&r=PG", "display_name": "Sosdoc", "link": "https://stackoverflow.com/users/3316716/sosdoc"}, "reply_to_user": {"reputation": 3818, "user_id": 1247113, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zRMFj.png?s=128&g=1", "display_name": "rob74", "link": "https://stackoverflow.com/users/1247113/rob74"}, "edited": false, "score": 0, "creation_date": 1437992214, "post_id": 31650192, "comment_id": 51246255, "body": "@rob74 I would personally call it &quot;auto-incrementing constant&quot;, but the official name is still iota."}, {"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 0, "creation_date": 1598254889, "post_id": 31650192, "comment_id": 112387071, "body": "possible duplicate: <a href=\"https://stackoverflow.com/q/9244879/995714\">What does iota of std::iota stand for?</a>, <a href=\"https://stackoverflow.com/q/28411850/995714\">Why is it Called iota? (duplicate)</a>"}, {"owner": {"reputation": 92307, "user_id": 167735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5deb8de031f80c23f19e9b6d389e5afe?s=128&d=identicon&r=PG", "display_name": "slebetman", "link": "https://stackoverflow.com/users/167735/slebetman"}, "edited": false, "score": 0, "creation_date": 1608909243, "post_id": 31650192, "comment_id": 115711299, "body": "&quot;iota&quot; is a word in the English language. I&#39;ve always thought that iota in golang means iota"}, {"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 1, "creation_date": 1618285675, "post_id": 31650192, "comment_id": 118549287, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/questions/9244879/what-does-iota-of-stdiota-stand-for\">What does iota of std::iota stand for?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1438015015, "post_id": 31650491, "comment_id": 51261823, "body": "Further, it&#39;s an <a href=\"https://en.wiktionary.org/wiki/iota#Noun\" rel=\"nofollow noreferrer\">English noun according to Wiktionary</a>: &quot;A jot; a very small, inconsiderable quantity.&quot;"}, {"owner": {"reputation": 1311, "user_id": 1244184, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0ZX2y.jpg?s=128&g=1", "display_name": "Jonathon Hibbard", "link": "https://stackoverflow.com/users/1244184/jonathon-hibbard"}, "edited": false, "score": 0, "creation_date": 1597669002, "post_id": 31650491, "comment_id": 112200052, "body": "I&#39;m only a few days new to golang.   while Alex&#39;s opinion is correct, the way that golang uses it makes a person think that it stands for &quot;index of the array&quot; since when you reference iota its showing the 0-based index value of when a constant was defined within a list - ergo, index of the array  Just my 2 cents =]"}, {"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 0, "creation_date": 1598254901, "post_id": 31650491, "comment_id": 112387078, "body": "<a href=\"https://stackoverflow.com/q/9244879/995714\">What does <code>iota</code> of <code>std::iota</code> stand for?</a>"}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": false, "score": 41, "last_activity_date": 1437992685, "last_edit_date": 1492086869, "creation_date": 1437992169, "answer_id": 31650491, "question_id": 31650192, "link": "https://stackoverflow.com/questions/31650192/whats-the-full-name-for-iota-in-golang/31650491#31650491", "title": "What&#39;s the full name for `iota` in golang?", "body": "<p>That's the full name by itself. \"iota\" is the letter of the Greek alphabet. It is typical for the math notations:</p>\n\n<ul>\n<li>as iterator in sums and algorithms</li>\n<li>as <a href=\"https://tex.stackexchange.com/questions/96092/making-subscripts-temporarily-deeper-for-clarity\">subscript index</a></li>\n<li>for <a href=\"https://en.wikipedia.org/wiki/Imaginary_unit#Alternative_notations\" rel=\"noreferrer\">imaginary part of complex numbers</a></li>\n</ul>\n\n<p>You can find it in other programming languages as well (see <a href=\"http://srfi.schemers.org/srfi-1/srfi-1.html#iota\" rel=\"noreferrer\">iota in Scheme</a>).</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 5258527, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b501807607721066febcd334ab6507ab?s=128&d=identicon&r=PG&f=1", "display_name": "Mingxiang Xue", "link": "https://stackoverflow.com/users/5258527/mingxiang-xue"}, "is_accepted": false, "score": 0, "last_activity_date": 1598252284, "last_edit_date": 1598252284, "creation_date": 1589886832, "answer_id": 61889669, "question_id": 31650192, "link": "https://stackoverflow.com/questions/31650192/whats-the-full-name-for-iota-in-golang/61889669#61889669", "title": "What&#39;s the full name for `iota` in golang?", "body": "<p>I think the key point is that <code>iota</code> means the smallest letter of the Greek alphabet, the same meaning as <code>0</code> being the smallest value of an enum type.</p>\n<p>Quoted from <a href=\"https://en.wiktionary.org/wiki/iota#Etymology\" rel=\"nofollow noreferrer\">Wiki</a>:</p>\n<blockquote>\n<h3>Etymology</h3>\n<p>From Ancient Greek \u1f30\u1ff6\u03c4\u03b1 (i\u00f4ta).</p>\n<p>(jot): In reference to a phrase in the New Testament: &quot;until heaven and earth pass away, not an iota, not a dot, will pass from the Law&quot; (Mt 5:18), iota being the smallest letter of the Greek alphabet.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 540, "user_id": 2683059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1accf9bd8cd0a79eefaf8592601f73b6?s=128&d=identicon&r=PG", "display_name": "tempcke", "link": "https://stackoverflow.com/users/2683059/tempcke"}, "is_accepted": false, "score": 0, "last_activity_date": 1608665749, "last_edit_date": 1608665749, "creation_date": 1608664774, "answer_id": 65414627, "question_id": 31650192, "link": "https://stackoverflow.com/questions/31650192/whats-the-full-name-for-iota-in-golang/65414627#65414627", "title": "What&#39;s the full name for `iota` in golang?", "body": "<p><strong>iota</strong> is not an <em>acronym</em> for something but <em>a word</em></p>\n<p>As others pointed out it is the 9th letter of the Greek alphabet however in english it is also a word with a definition reflective of the Greek letter.</p>\n<h2>Definition of the word &quot;iota&quot;</h2>\n<p>From <a href=\"https://www.vocabulary.com/dictionary/iota\" rel=\"nofollow noreferrer\">https://www.vocabulary.com/dictionary/iota</a></p>\n<blockquote>\n<p>If you don't care one iota about something, it means you don\u2019t care about it even one little bit. An iota is something very small.</p>\n</blockquote>\n<p>From <a href=\"https://www.merriam-webster.com/dictionary/iota\" rel=\"nofollow noreferrer\">https://www.merriam-webster.com/dictionary/iota</a></p>\n<blockquote>\n<p>an infinitesimal amount : JOT</p>\n<p>did not show an iota of interest</p>\n</blockquote>\n<p>If you think of how it is used in Go (golang) that definition fits perfectly, as you are assigning values to constants just to give each constant a unique value so it can be used as a constant.  Most often <strong>you do not really care</strong> what the value is so long as it is unique among that collection of constants</p>\n<h2>Usage in APL</h2>\n<p>From <a href=\"http://www.randomprogramming.com/2014/07/algorithms-in-action-iota-and-shuffle/\" rel=\"nofollow noreferrer\">http://www.randomprogramming.com/2014/07/algorithms-in-action-iota-and-shuffle/</a></p>\n<blockquote>\n<p>The Greek letter iota is used in the programming language APL to generate a sequence of consecutive integers.</p>\n</blockquote>\n<p>iota also exists in c++, So there are existing usages in other languages that are similar to Go.</p>\n"}], "owner": {"reputation": 2198, "user_id": 325224, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/8a0d717f7a131eb4c9ba588f99716aa0?s=128&d=identicon&r=PG", "display_name": "schemacs", "link": "https://stackoverflow.com/users/325224/schemacs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4884, "favorite_count": 3, "answer_count": 3, "score": 28, "last_activity_date": 1608665749, "creation_date": 1437991338, "last_edit_date": 1598314705, "question_id": 31650192, "link": "https://stackoverflow.com/questions/31650192/whats-the-full-name-for-iota-in-golang", "title": "What&#39;s the full name for `iota` in golang?", "body": "<p>As title, what's the full name for <code>iota</code> (not the usage) in golang:</p>\n<pre><code>const (  // iota is reset to 0\n    c0 = iota  // c0 == 0\n    c1 = iota  // c1 == 1\n    c2 = iota  // c2 == 2\n)\n</code></pre>\n"}, {"tags": ["file", "http", "post", "go"], "answers": [{"comments": [{"owner": {"reputation": 72, "user_id": 909678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e499316b44ad6a829c4e18e07b23f0d9?s=128&d=identicon&r=PG", "display_name": "marcel.corso", "link": "https://stackoverflow.com/users/909678/marcel-corso"}, "edited": false, "score": 0, "creation_date": 1437995611, "post_id": 31650364, "comment_id": 51248315, "body": "Cool. Thanks! So the problem is that for &quot;File&quot; the http library does not calculate the  ContentLength."}, {"owner": {"reputation": 72, "user_id": 909678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e499316b44ad6a829c4e18e07b23f0d9?s=128&d=identicon&r=PG", "display_name": "marcel.corso", "link": "https://stackoverflow.com/users/909678/marcel-corso"}, "edited": false, "score": 1, "creation_date": 1437996255, "post_id": 31650364, "comment_id": 51248716, "body": "Also.. If you want to get the right size of the file you can do: fs, _ := file.Stat(); req.ContentLength = fs.Size()"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 72, "user_id": 909678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e499316b44ad6a829c4e18e07b23f0d9?s=128&d=identicon&r=PG", "display_name": "marcel.corso", "link": "https://stackoverflow.com/users/909678/marcel-corso"}, "edited": false, "score": 2, "creation_date": 1438013094, "post_id": 31650364, "comment_id": 51260688, "body": "@marcel.corso: the http package doesn&#39;t calculate ContentLength because http/1.1 uses chunked encoding by default. It up to you to set it if it&#39;s required for some reason. The remote server is either incorrectly ignoring chunked transfer encoding, or the api specifically requires a ContentLength."}, {"owner": {"reputation": 72, "user_id": 909678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e499316b44ad6a829c4e18e07b23f0d9?s=128&d=identicon&r=PG", "display_name": "marcel.corso", "link": "https://stackoverflow.com/users/909678/marcel-corso"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1438032472, "post_id": 31650364, "comment_id": 51271755, "body": "@JimB in my search for an answer I stumbled on the thing that the library do calculate the Content-Length for some cases: <a href=\"https://github.com/golang/go/blob/0c72eeb121702cc0a820976138cc01dd1a475895/src/net/http/request.go#L568\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/&hellip;</a> . But I guess it would be a bad idea to add a another &quot;case&quot; there for file.Stat() since it can fail... be chunked.. etc. thanks!"}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 1, "last_activity_date": 1437991823, "creation_date": 1437991823, "answer_id": 31650364, "question_id": 31649989, "link": "https://stackoverflow.com/questions/31649989/why-cant-i-use-a-file-as-the-body-of-an-http-request/31650364#31650364", "title": "Why can&#39;t I use a &quot;file&quot; as the &quot;body&quot; of an http request?", "body": "<p>The site requestb.in seems to ignore POST data if the header <code>Content-Length</code> is not specified. This code works:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n)\n\nfunc main() {\n    file, err := os.Open(\"lala.txt\")\n    if err != nil {\n        fmt.Printf(\"file open errrrr %v \\n\", err)\n    }\n    defer file.Close()\n\n    req, _ := http.NewRequest(\"POST\", \"http://requestb.in/1fry3jy1\", file)\n    req.ContentLength = 5\n    resp, err := http.DefaultClient.Do(req)\n    if err != nil {\n        fmt.Printf(\"errrrr %v \\n\", err)\n    } else {\n        fmt.Printf(\"resp code %d \\n\", resp.StatusCode)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 72, "user_id": 909678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e499316b44ad6a829c4e18e07b23f0d9?s=128&d=identicon&r=PG", "display_name": "marcel.corso", "link": "https://stackoverflow.com/users/909678/marcel-corso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 31650364, "answer_count": 1, "score": 1, "last_activity_date": 1437991823, "creation_date": 1437990765, "question_id": 31649989, "link": "https://stackoverflow.com/questions/31649989/why-cant-i-use-a-file-as-the-body-of-an-http-request", "title": "Why can&#39;t I use a &quot;file&quot; as the &quot;body&quot; of an http request?", "body": "<p>\"http.Post\" expects a \"Reader\" as the body argument. \"File\" implements \"Reader\". \nBut if I pass file as the body argument I always receive 0 bytes at the other end. Why? </p>\n\n<p>Here is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n)\n\nfunc main() {\n    file, err := os.Open(\"lala.txt\")\n    if err != nil {\n        fmt.Printf(\"file open errrrr %v \\n\", err)\n    }\n    defer file.Close()\n\n    resp, err := http.Post(\"http://requestb.in/11fta851\", \"text/plain\", file)\n    if err != nil {\n        fmt.Printf(\"errrrr %v \\n\", err)\n    } else {\n        fmt.Printf(\"resp code %d \\n\", resp.StatusCode)\n    }\n}\n</code></pre>\n\n<p>I know that you could do \"file.ReadAll\" to a buffer and use that. But it feels like double work. </p>\n"}, {"tags": ["go", "arm", "cross-compiling", "revel"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1437992713, "post_id": 31648793, "comment_id": 51246550, "body": "That package uses cgo, do you have a C compiler for the target architecture?"}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1437994375, "post_id": 31648793, "comment_id": 51247559, "body": "Ahh ok, so I need a cross platform C compiler on my mac to be able to compile that library for ARM? Do you have a link to some tutorial? how do I check if I have a C compiler for that architecture? I&#39;ve not knowingly installed one. What are the steps once I do have one?"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1437994647, "post_id": 31648793, "comment_id": 51247723, "body": "I don&#39;t have an OS X machine, so I can&#39;t really help with that. Look for cross-compilers in the brew repos, and if there aren&#39;t any, look up the instructions to build them."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1437996437, "post_id": 31648793, "comment_id": 51248824, "body": "Try this: <a href=\"https://github.com/tpoechtrager/osxcross\" rel=\"nofollow noreferrer\">github.com/tpoechtrager/osxcross</a> (and then realize what a huge pain cross-compiling C across OS&#39; &amp; architectures is and just boot a small Ubuntu VM with build-essential &amp; the Go toolchain installed via <a href=\"https://github.com/travis-ci/gimme\" rel=\"nofollow noreferrer\">github.com/travis-ci/gimme</a>)"}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1437997467, "post_id": 31648793, "comment_id": 51249480, "body": "So I have had minor improvements...  I pulled the latest go (1.4.2 src code). I ran <code>bash all.bash</code> and that seemed successful. When I run <code>C=arm-linux-gnueabihf-gcc GOOS=linux GOARCH=arm revel package mitm</code> I get the error: &quot;go build runtime: linux/arm must be bootstrapped using make.bash&quot; I then run <code>GOOS=linux GOARCH=arm .&#47;make.bash --no-clean</code> which is successful, however that doesnt allow revel to build successfully"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1438007861, "post_id": 31648793, "comment_id": 51257050, "body": "You can try getting go1.5beta2 where cross-compiling is done <a href=\"https://medium.com/@rakyll/go-1-5-cross-compilation-488092ba44ec\" rel=\"nofollow noreferrer\">much easier</a>. Go 1.5 itself should be out next month."}, {"owner": {"reputation": 1209, "user_id": 83879, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/5c4e03b2704fefb2529a2d63c744145f?s=128&d=identicon&r=PG", "display_name": "golliher", "link": "https://stackoverflow.com/users/83879/golliher"}, "edited": false, "score": 0, "creation_date": 1439726351, "post_id": 31648793, "comment_id": 51970586, "body": "You may be interested in this post that address the problems of hidden Cgo in the standard library as well as a potential solution (gonative).   <a href=\"https://inconshreveable.com/04-30-2014/cross-compiling-golang-programs-with-native-libraries/\" rel=\"nofollow noreferrer\">inconshreveable.com/04-30-2014/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 8030351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7dd237e0b81f61fe926250bf171479b?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon S", "link": "https://stackoverflow.com/users/8030351/brandon-s"}, "is_accepted": false, "score": 0, "last_activity_date": 1495105108, "creation_date": 1495105108, "answer_id": 44045902, "question_id": 31648793, "link": "https://stackoverflow.com/questions/31648793/go-programming-cross-compile-for-revel-framework/44045902#44045902", "title": "Go programming cross compile for revel framework", "body": "<p>Try <a href=\"https://github.com/laher/goxc\" rel=\"nofollow noreferrer\">goxc</a>. It requires the go source and the go toolchain but works well.</p>\n"}], "owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 812, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1495105108, "creation_date": 1437987292, "last_edit_date": 1437987661, "question_id": 31648793, "link": "https://stackoverflow.com/questions/31648793/go-programming-cross-compile-for-revel-framework", "title": "Go programming cross compile for revel framework", "body": "<p>I am using the Revel framework to make a web application.\nI am cross compiling it for ARM with the command\n<code>GOOS=linux GOARCH=arm revel package mitm</code></p>\n\n<p>This works fine, however I have just included the library <code>github.com/google/gopacket</code></p>\n\n<p>and now the cross compiled build fails (it runs fine on OSX that I am developing on).</p>\n\n<p>I get:</p>\n\n<blockquote>\n  <p>ERROR 2015/07/27 09:01:30 build.go:101: # mitm/app/controllers\n  go/src/webserver/app/controllers/ArpScan.go:88: undefined:\n  pcap.OpenLive go/src/webserver/app/controllers/ArpScan.go:88:\n  undefined: pcap.BlockForever\n  go/src/webserver/app/controllers/ArpScan.go:114: undefined:\n  pcap.Handle go/src/webserver/app/controllers/ArpScan.go:145:\n  undefined: pcap.Handle</p>\n</blockquote>\n\n<p>pcap is a library imported from gopacket:</p>\n\n<p><code>import \"github.com/google/gopacket/pcap</code>\"</p>\n\n<p>My question is how do I get it to cross compile this library aswell?</p>\n\n<p>I ran Dave Cheney's <code>go-crosscompile-build-all</code> (<a href=\"http://dave.cheney.net/2012/09/08/an-introduction-to-cross-compilation-with-go\" rel=\"nofollow\">link</a>) but that just builds the standard library.</p>\n"}, {"tags": ["go", "godoc"], "comments": [{"owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "edited": false, "score": 0, "creation_date": 1437986913, "post_id": 31648354, "comment_id": 51242939, "body": "I usually just do <a href=\"https://www.google.co.uk/search?q=golang+url\" rel=\"nofollow noreferrer\">google.co.uk/search?q=golang+url</a>"}], "answers": [{"comments": [{"owner": {"reputation": 162, "user_id": 1202231, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed3b93f40ba20b330c4aacecb6706b7d?s=128&d=identicon&r=PG", "display_name": "wingedrhino", "link": "https://stackoverflow.com/users/1202231/wingedrhino"}, "edited": false, "score": 0, "creation_date": 1437991746, "post_id": 31648857, "comment_id": 51245953, "body": "Thanks. Wish it was a bit easier though.If godoc also listed the imports involved within the documentation things would be a lot nicer to read."}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": false, "score": 1, "last_activity_date": 1437987509, "creation_date": 1437987509, "answer_id": 31648857, "question_id": 31648354, "link": "https://stackoverflow.com/questions/31648354/how-can-i-jump-to-the-documentation-of-the-type-of-a-field-in-a-struct-or-a-meth/31648857#31648857", "title": "How can I jump to the documentation of the type of a field in a struct or a method I&#39;m browsing in godoc?", "body": "<p>You can run queries with <code>godoc</code>:</p>\n\n<pre><code>$ godoc -q URL | less\nQUERY\n        URL\n\nDID YOU MEAN\n\n        url\n\nTypes\n    net/url.URL\n    html/template.URL\n...\n...\n...\n</code></pre>\n\n<p>The net/url in Types is a good candidate to look at.</p>\n\n<pre><code>$ godoc net/url | less\nPACKAGE DOCUMENTATION\n\npackage url\n    import \"net/url\"\n\n    Package url parses URLs and implements query escaping. See RFC 3986.\n\nFUNCTIONS\n...\n...\n...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": false, "score": 2, "last_activity_date": 1438014155, "last_edit_date": 1592644375, "creation_date": 1438014155, "answer_id": 31658337, "question_id": 31648354, "link": "https://stackoverflow.com/questions/31648354/how-can-i-jump-to-the-documentation-of-the-type-of-a-field-in-a-struct-or-a-meth/31658337#31658337", "title": "How can I jump to the documentation of the type of a field in a struct or a method I&#39;m browsing in godoc?", "body": "<h2>Go 1.5</h2>\n<p>In Go\u00a01.5 you can use the new <a href=\"https://tip.golang.org/cmd/go/#hdr-Show_documentation_for_package_or_symbol\" rel=\"nofollow noreferrer\"><code>go doc</code></a> sub-command:</p>\n<blockquote>\n<h3>Show documentation for package or symbol</h3>\n<p>Usage:</p>\n<pre><code>go doc [-u] [-c] [package|[package.]symbol[.method]]\n</code></pre>\n<p>Doc prints the documentation comments associated with the item identified by its arguments (a package, const, func, type, var, or method) followed by a one-line summary of each of the first-level items &quot;under&quot; that item (package-level declarations for a package, methods for a type, etc.).</p>\n</blockquote>\n<p>[\u2026]</p>\n<blockquote>\n<p>When run with one argument, the argument is treated as a Go-syntax-like representation of the item to be documented. What the argument selects depends on what is installed in GOROOT and GOPATH, as well as the form of the argument, which is schematically one of these:</p>\n<pre><code>go doc &lt;pkg&gt;\ngo doc &lt;sym&gt;[.&lt;method&gt;]\ngo doc [&lt;pkg&gt;].&lt;sym&gt;[.&lt;method&gt;]\n</code></pre>\n<p>The first item in this list matched by the argument is the one whose documentation is printed. (See the examples below.) For packages, the order of scanning is determined lexically, but the GOROOT tree is always scanned before GOPATH.</p>\n</blockquote>\n<p>So for your example just <code>go doc url.URL</code> without you needing to know that the <code>url</code> package is imported as <code>net/url</code>.</p>\n<h2>Pre Go 1.5</h2>\n<p>Until Go 1.5 is released there is a very simalar command that you can install with:</p>\n<pre><code>go install robpike.io/cmd/doc\n</code></pre>\n<p>Once installed you'd do <code>doc url.URL</code>.</p>\n"}], "owner": {"reputation": 162, "user_id": 1202231, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed3b93f40ba20b330c4aacecb6706b7d?s=128&d=identicon&r=PG", "display_name": "wingedrhino", "link": "https://stackoverflow.com/users/1202231/wingedrhino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1438014155, "creation_date": 1437986014, "question_id": 31648354, "link": "https://stackoverflow.com/questions/31648354/how-can-i-jump-to-the-documentation-of-the-type-of-a-field-in-a-struct-or-a-meth", "title": "How can I jump to the documentation of the type of a field in a struct or a method I&#39;m browsing in godoc?", "body": "<p>I'm still struggling to word the question in a way that is quick to understand, so I'll instead document the steps I followed to encounter the issue I am facing.</p>\n\n<ol>\n<li>I am looking up documentation for the Request struct in net/http package. I do this via <code>godoc net/http Request</code></li>\n<li>Now browsing through the documentation, the first field Request struct has is URL which is of type <code>*url.URL</code> whose documentation I'd like to lookup.</li>\n<li>But godoc shares no details as to which import path it is a part of. I only know that the package name itself is \"url\" but its canonical import path would be something like \"some/path/url\" which I would like to know so that I can look it up and figure out the URL field.</li>\n</ol>\n\n<p>What steps do I follow to get to the specific <code>url</code> package being referenced in the above piece of documentation ?</p>\n"}, {"tags": ["security", "go", "escaping"], "comments": [{"owner": {"reputation": 417219, "user_id": 187606, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/zzxoB.jpg?s=128&g=1", "display_name": "Pekka", "link": "https://stackoverflow.com/users/187606/pekka"}, "edited": false, "score": 2, "creation_date": 1437982837, "post_id": 31647406, "comment_id": 51240780, "body": "The entire <i>query</i> is passed from the command line? Then I don&#39;t understand what exactly you want to escape in the first place?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1437983053, "post_id": 31647406, "comment_id": 51240886, "body": "mysql_real_escape_string won&#39;t help you if your entire query is passed from commadline. Try to refactor so it won&#39;t be so, and only parameters are passed to your app. If that&#39;s not possible, and you want to avoid malicious queries, your best option would be to use an SQL parser and do some static analysis on the input."}, {"owner": {"reputation": 417219, "user_id": 187606, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/zzxoB.jpg?s=128&g=1", "display_name": "Pekka", "link": "https://stackoverflow.com/users/187606/pekka"}, "edited": false, "score": 1, "creation_date": 1437983202, "post_id": 31647406, "comment_id": 51240952, "body": "Re your edit: what we said still applies I&#39;m afraid - you either have a single value that you&#39;re inserting - then you can use parametrized queries - or you have a full or partial query, then escaping it won&#39;t do you any good and you would have to break it down using a SQL parser and filter out anything malicious yourself."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1437983710, "post_id": 31647406, "comment_id": 51241222, "body": "You&#39;ve since edited your question (so I can&#39;t see the original) but ask about <i>what</i> you want to do, not <i>how</i>. There may be other ways besides escaping queries and crossing your fingers to achieve what you want. User provided, arbitrary queries sounds a lot like madness otherwise."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1437984617, "post_id": 31647406, "comment_id": 51241693, "body": "OP can you maybe give an example of how the input passed is used as part of the query and why it can&#39;t be parameterized?"}], "answers": [{"tags": [], "owner": {"reputation": 417219, "user_id": 187606, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/zzxoB.jpg?s=128&g=1", "display_name": "Pekka", "link": "https://stackoverflow.com/users/187606/pekka"}, "is_accepted": false, "score": 4, "last_activity_date": 1437982956, "creation_date": 1437982956, "answer_id": 31647497, "question_id": 31647406, "link": "https://stackoverflow.com/questions/31647406/mysql-real-escape-string-equivalent-for-golang/31647497#31647497", "title": "mysql_real_escape_string equivalent for Golang", "body": "<p>If the entire <em>query</em> - or any part of the query that goes beyond a single value - is passed from the command line, there is nothing for you to escape.</p>\n\n<p><code>mysql_real_escape_string</code> and its cousins are for sanitizing single values, to prevent anyone with access to the value before it is inserted into the query from \"breaking out\" and fiddling with the query itself. </p>\n\n<p>Given that you are giving access to the entire query to an outside, there is nothing an escape function could do to improve safety. </p>\n\n<p>Your only shot at security here is</p>\n\n<ul>\n<li>executing the query in a user context that can't do any damage (e.g. you can restrict commands on a per-user basis in mySQL)</li>\n<li>making sure that query errors are properly caught and dealt with </li>\n<li>as Not_a_Golfer suggests in the comments above, parsing the query for anything malicious</li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 234, "user_id": 6628349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e88d4443473648a6a488a8c91d494af?s=128&d=identicon&r=PG&f=1", "display_name": "vincent163", "link": "https://stackoverflow.com/users/6628349/vincent163"}, "edited": false, "score": 2, "creation_date": 1570773623, "post_id": 35257216, "comment_id": 103026961, "body": "Note that in Go, map is unordered, so the replaces may happen in any order, But the double backslash has to be applied before any other rule. You might want to use [][2]string for the rules instead."}], "tags": [], "owner": {"reputation": 4233, "user_id": 1063653, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/cfbfb15f60df712bdd013c4423a4774e?s=128&d=identicon&r=PG", "display_name": "Shadoweb", "link": "https://stackoverflow.com/users/1063653/shadoweb"}, "is_accepted": false, "score": 9, "last_activity_date": 1610626900, "last_edit_date": 1610626900, "creation_date": 1454869085, "answer_id": 35257216, "question_id": 31647406, "link": "https://stackoverflow.com/questions/31647406/mysql-real-escape-string-equivalent-for-golang/35257216#35257216", "title": "mysql_real_escape_string equivalent for Golang", "body": "<p>I came up with my own solution to create the function myself.<br />\nHope it would be useful to someone.</p>\n<pre><code>func MysqlRealEscapeString(value string) string {\n    replace := map[string]string{&quot;\\\\&quot;:&quot;\\\\\\\\&quot;, &quot;'&quot;:`\\'`, &quot;\\\\0&quot;:&quot;\\\\\\\\0&quot;, &quot;\\n&quot;:&quot;\\\\n&quot;, &quot;\\r&quot;:&quot;\\\\r&quot;, `&quot;`:`\\&quot;`, &quot;\\x1a&quot;:&quot;\\\\Z&quot;}\n\n    for b, a := range replace {\n        value = strings.Replace(value, b, a, -1)\n    }\n    \n    return value;\n}\n</code></pre>\n<p>1.MysqlRealEscapeString is not right, as below test case will fail</p>\n<pre><code>func TestEscape(t *testing.T) {\n    mysqlEscapeList := map[string]string{\n        &quot;\\\\&quot;: &quot;\\\\\\\\&quot;, &quot;'&quot;: `\\'`, &quot;\\\\0&quot;: &quot;\\\\\\\\0&quot;, &quot;\\n&quot;: &quot;\\\\n&quot;, &quot;\\r&quot;: &quot;\\\\r&quot;, `&quot;`: `\\&quot;`, &quot;\\x1a&quot;: &quot;\\\\Z&quot;}\n\n    for old, want := range mysqlEscapeList {\n        testEscape(t, old, want)\n    }\n    testEscape(t, `&lt;p&gt;123&lt;/p&gt;&lt;div&gt;&lt;img width=&quot;1080&quot; /&gt;`, `&lt;p&gt;123&lt;/p&gt;&lt;div&gt;&lt;img width=\\&quot;1080\\&quot; /&gt;`)\n}\nfunc testEscape(t *testing.T, origin, want string) {\n    escaped := MysqlRealEscapeString(origin)\n    assert.Equal(t, want, escaped)\n}\n</code></pre>\n<ol start=\"2\">\n<li>use this one instead</li>\n</ol>\n<pre><code>func Escape(sql string) string {\n    dest := make([]byte, 0, 2*len(sql))\n    var escape byte\n    for i := 0; i &lt; len(sql); i++ {\n        c := sql[i]\n\n        escape = 0\n\n        switch c {\n        case 0: /* Must be escaped for 'mysql' */\n            escape = '0'\n            break\n        case '\\n': /* Must be escaped for logs */\n            escape = 'n'\n            break\n        case '\\r':\n            escape = 'r'\n            break\n        case '\\\\':\n            escape = '\\\\'\n            break\n        case '\\'':\n            escape = '\\''\n            break\n        case '&quot;': /* Better safe than sorry */\n            escape = '&quot;'\n            break\n        case '\\032': //\u5341\u8fdb\u523626,\u516b\u8fdb\u523632,\u5341\u516d\u8fdb\u52361a, /* This gives problems on Win32 */\n            escape = 'Z'\n        }\n\n        if escape != 0 {\n            dest = append(dest, '\\\\', escape)\n        } else {\n            dest = append(dest, c)\n        }\n    }\n\n    return string(dest)\n}\n\n</code></pre>\n"}], "owner": {"reputation": 48731, "user_id": 329700, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/41910a452554b187d044c00c576866b1?s=128&d=identicon&r=PG", "display_name": "Kevin Burke", "link": "https://stackoverflow.com/users/329700/kevin-burke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4422, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1610626900, "creation_date": 1437982677, "last_edit_date": 1437983057, "question_id": 31647406, "link": "https://stackoverflow.com/questions/31647406/mysql-real-escape-string-equivalent-for-golang", "title": "mysql_real_escape_string equivalent for Golang", "body": "<p>I would like to escape a value that makes up part of a database query, but I can't use parameterized queries.</p>\n\n<p>Does Go have an equivalent of PHP's <code>mysql_real_escape_string</code> I can use to escape the query value?</p>\n"}, {"tags": ["github", "go", "aws-sdk", "circleci", "aws-sdk-go"], "answers": [{"comments": [{"owner": {"reputation": 349, "user_id": 1105455, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/bb3df7fbe32bd0cadfebe973722133f5?s=128&d=identicon&r=PG", "display_name": "Chris Kong", "link": "https://stackoverflow.com/users/1105455/chris-kong"}, "edited": false, "score": 0, "creation_date": 1437972132, "post_id": 31644637, "comment_id": 51236497, "body": "Thanks for the comment. I have tried to force git use <code>git@github.com</code> to checkout, and remove all the dependency overrides. The problem is still there. I think the problem here is that the go command <code>go get</code> only allow users to use https to get packages in go 1.4. Here is a <a href=\"https://github.com/golang/go/issues/8850\" rel=\"nofollow noreferrer\">reference</a>. This limit seems to be removed since 1.4.1 according to [<a href=\"https://github.com/gliderlabs/herokuish/pull/6]\" rel=\"nofollow noreferrer\">github.com/gliderlabs/herokuish/pull/6]</a>. And I used ssh to access to the circleci box and managed go-get via <code>go get -u -f</code>, so I think figuring out a way to use https on circleci is the way out."}], "tags": [], "owner": {"reputation": 5608, "user_id": 660828, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/2ab261718814b4842efac71a1b6cd1a5?s=128&d=identicon&r=PG", "display_name": "Tom Jowitt", "link": "https://stackoverflow.com/users/660828/tom-jowitt"}, "is_accepted": false, "score": 0, "last_activity_date": 1437968666, "creation_date": 1437968666, "answer_id": 31644637, "question_id": 31644370, "link": "https://stackoverflow.com/questions/31644370/circleci-golang-cant-import-aws-sdk/31644637#31644637", "title": "CircleCI &amp; Golang - Can&#39;t import AWS SDK", "body": "<p>Try adding the following to your circle.yml file. This should force an SSH checkout rather than a http one.</p>\n\n<pre><code>checkout:\n  post:\n    - git config --global url.ssh://git@github.com/.insteadOf https://github.com/\n</code></pre>\n\n<p>You should then be able to remove all of your dependency overrides.</p>\n\n<p>CircleCI also has a nice feature where you can rebuild with an SSH connection. Try running the commands manually inside the container if you have problems with debugging.</p>\n"}, {"tags": [], "owner": {"reputation": 349, "user_id": 1105455, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/bb3df7fbe32bd0cadfebe973722133f5?s=128&d=identicon&r=PG", "display_name": "Chris Kong", "link": "https://stackoverflow.com/users/1105455/chris-kong"}, "is_accepted": false, "score": 0, "last_activity_date": 1437972940, "creation_date": 1437972940, "answer_id": 31645218, "question_id": 31644370, "link": "https://stackoverflow.com/questions/31644370/circleci-golang-cant-import-aws-sdk/31645218#31645218", "title": "CircleCI &amp; Golang - Can&#39;t import AWS SDK", "body": "<p>Ok, I found a walk-around for this.</p>\n\n<p>It seems that CircleCI is using go 1.4, which did not allow people to use <code>git@github.com</code> to make <code>go get -u</code>, unless you use <code>go get -u -f</code>.\nSo I figured trying to use https to do the <code>go get -u</code> is the only way currently.</p>\n\n<p><a href=\"https://github.com/golang/go/issues/8850\" rel=\"nofollow\">ref: issue #8850</a></p>\n\n<p>And CircleCI has its own configuration on <code>git</code> in <code>~/.gitconfig</code> to force git to use <code>git@github.com</code> instead of https:</p>\n\n<pre><code>[url \"git@github.com:\"]\n        insteadOf = https://github.com/\n[url \"ssh://git@github.com/\"]\n        insteadOf = https://github.com/\n</code></pre>\n\n<p>If you access to the box of CircleCI via ssh, you can find this file.</p>\n\n<p><a href=\"https://github.com/gliderlabs/herokuish/pull/6\" rel=\"nofollow\">ref</a></p>\n\n<p>So, my way is:</p>\n\n<p>Rename this file in the phase of <strong>dependencies-pre</strong>, and let dependencies phase finish, Then rename it back if you still need those configurations.</p>\n\n<p>Now <code>go get -u</code> works fine no matter whether you add it in the <code>circle.yml</code> file or it is executed automatically by CircleCI.</p>\n"}], "owner": {"reputation": 349, "user_id": 1105455, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/bb3df7fbe32bd0cadfebe973722133f5?s=128&d=identicon&r=PG", "display_name": "Chris Kong", "link": "https://stackoverflow.com/users/1105455/chris-kong"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 750, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1489285921, "creation_date": 1437966301, "last_edit_date": 1489285921, "question_id": 31644370, "link": "https://stackoverflow.com/questions/31644370/circleci-golang-cant-import-aws-sdk", "title": "CircleCI &amp; Golang - Can&#39;t import AWS SDK", "body": "<p>I'm not sure whether this is the right place to post such question.</p>\n\n<p>I was trying to test my golang project on CircleCI. In the phase of <code>dependencies</code>, CI executed</p>\n\n<pre><code>go get -u github.com/aws/aws-sdk-go/...\n</code></pre>\n\n<p>And there occurred an error:</p>\n\n<pre><code>package github.com/aws/aws-sdk-go/...\n    imports github.com/aws/aws-sdk-go/aws\n    imports github.com/aws/aws-sdk-go/aws/awserr: /home/ubuntu/sprocket-analytics-data-pipeline-v2/src/go/src/github.com/aws/aws-sdk-go is from git@github.com:aws/aws-sdk-go, should be from https://github.com/aws/aws-sdk-go\n</code></pre>\n\n<p>The error was very long, and the code above is just a part of it.</p>\n\n<p>So, I updated my <code>circleci.yml</code> to override the dependencies phase. The <code>circleci.yml</code> is like:</p>\n\n<pre><code>machine:\n  timezone:\n    Asia/Tokyo\n  environment:\n    GOPATH: /home/ubuntu/my-project/src/go\ndependencies:\n  override:\n    - go get github.com/go-sql-driver/mysql\n    - go get github.com/google/google-api-go-client/bigquery/v2\n    - go get code.google.com/p/goauth2/oauth/jwt\n    - go get golang.org/x/tools/cmd/cover\n    - go get github.com/AlekSi/gocov-xml\n    - go get github.com/jstemmer/go-junit-report\n    - go get github.com/golang/mock/gomock\n    - go get github.com/onsi/gomega\n    - go get github.com/onsi/ginkgo/ginkgo\n    - go get github.com/aws/aws-sdk-go/...\n    - go get github.com/axw/gocov/...\ntest:\n  pre:\n    - go install path/to/the/package\n  override:\n    - go test /home/ubuntu/my-project/src/go/src/path/to/the/package\n</code></pre>\n\n<p>The <code>go get github.com/aws/aws-sdk-go/...</code> in my config worked fine.</p>\n\n<p>However, after all the commands in my <code>circleci.yml</code> had been executed, <code>go get -u github.com/aws/aws-sdk-go/...</code> was executed anyway by the CI. And it failed again with the same error.</p>\n\n<p>Here is the log from CircleCI:</p>\n\n<p><a href=\"https://i.stack.imgur.com/KEeB7.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/KEeB7.png\" alt=\"enter image description here\"></a></p>\n\n<p>Is there any walk-around for this? Or did I miss something, like configuring the address to get the go packages(according to the error messages)?</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["go", "io", "stream"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437959983, "post_id": 31643678, "comment_id": 51233941, "body": "exact duplicate of <a href=\"http://stackoverflow.com/questions/10781516/how-to-pipe-several-commands\">How to pipe several commands?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 48731, "user_id": 329700, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/41910a452554b187d044c00c576866b1?s=128&d=identicon&r=PG", "display_name": "Kevin Burke", "link": "https://stackoverflow.com/users/329700/kevin-burke"}, "is_accepted": false, "score": 2, "last_activity_date": 1530033044, "last_edit_date": 1530033044, "creation_date": 1437959616, "answer_id": 31643679, "question_id": 31643678, "link": "https://stackoverflow.com/questions/31643678/using-golangs-os-exec-how-can-i-copy-stdout-from-one-process-to-stdin-of-anoth/31643679#31643679", "title": "Using golang&#39;s os/exec, how can I copy stdout from one process to stdin of another?", "body": "<p><a href=\"https://groups.google.com/forum/#!topic/golang-nuts/OHuyTpotrLw\" rel=\"nofollow noreferrer\">Via Brad Fitzpatrick, here's one way to do it</a>. You can reassign the <code>Stdin</code> property of the second command to the <code>stdout</code> writer from the first command.</p>\n\n<pre><code>    ls := exec.Command(\"ls\")\n    wc := exec.Command(\"wc\")\n    lsOut, _ := ls.StdoutPipe()\n    ls.Start()\n    wc.Stdin = lsOut\n\n    o, _ := wc.Output()\n    fmt.Println(string(o))\n</code></pre>\n"}], "owner": {"reputation": 48731, "user_id": 329700, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/41910a452554b187d044c00c576866b1?s=128&d=identicon&r=PG", "display_name": "Kevin Burke", "link": "https://stackoverflow.com/users/329700/kevin-burke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 380, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1530033044, "creation_date": 1437959616, "question_id": 31643678, "link": "https://stackoverflow.com/questions/31643678/using-golangs-os-exec-how-can-i-copy-stdout-from-one-process-to-stdin-of-anoth", "title": "Using golang&#39;s os/exec, how can I copy stdout from one process to stdin of another?", "body": "<p>I want to emulate a bash pipe using go's <a href=\"https://golang.org/pkg/os/exec/\" rel=\"nofollow\">os/exec module</a>. Here's a dummy example in bash:</p>\n\n<pre><code>$ ls | wc \n      42      48     807\n</code></pre>\n\n<p>How can I emulate that in Go? Is there a way to do it with streams?</p>\n"}, {"tags": ["go", "timeout"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437956413, "post_id": 31643203, "comment_id": 51233212, "body": "You had asked about question formatting, check the link under &quot;edited &lt;date&gt;&quot; to see what was changed along edit comments."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1437956582, "post_id": 31643203, "comment_id": 51233241, "body": "By the way, in Go you probably should be using the <a href=\"https://golang.org/pkg/testing/#hdr-Benchmarks\" rel=\"nofollow noreferrer\"><code>testing</code></a> package for standardized benchmarks."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437956879, "post_id": 31643203, "comment_id": 51233293, "body": "BTW2: <code>sortingFunctions</code> should be defined as <code>map[string]func([]int)</code> so you don&#39;t have to do a type assertion."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1437957529, "post_id": 31643203, "comment_id": 51233421, "body": "When posting a question about code you should try and make a <a href=\"http://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable Example</a>, for Go it&#39;s often something that can be run on the Go playground. Not only does that make it a lot easier on those trying to help but it can also help you track down your problem yourself in the process. In this case the <a href=\"https://play.golang.org/p/6nK9onlmtN\" rel=\"nofollow noreferrer\">mcve</a> I tried to come up with appears to have the key elements of your code but does not show any issues and runs as expected. Since you left out a lot of code it&#39;s hard to know what&#39;s going on."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437957954, "post_id": 31643203, "comment_id": 51233521, "body": "I just noticed as well that your third line (15ms) should have been printed before the second (7599ms) if they were running in goroutines (unless <code>GOMAXPROCS</code> is 1 and the functions are such that they never yield the CPU) are you sure the code presented here is what you ran? It almost looks it was running without the <code>go</code> keyword in the loop. E.g. like <a href=\"https://play.golang.org/p/IqGE0EmWcK\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 115, "user_id": 2822270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e2040ab322eeaa1536e60e15ee9bc15?s=128&d=identicon&r=PG&f=1", "display_name": "Allan Pinkerton", "link": "https://stackoverflow.com/users/2822270/allan-pinkerton"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437958380, "post_id": 31643203, "comment_id": 51233620, "body": "I think you&#39;re right! I checked and GOMAXPROCS was set to 1. I must&#39;ve missed some setup, I suppose?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437959605, "post_id": 31643203, "comment_id": 51233859, "body": "It shouldn&#39;t have mattered for this since your sorting, even though CPU bound, should have allowed the Go scheduler to switch to other goroutines anyway. I seem to recall back around ~Go 1.2 they changed it to run the scheduler on some function calls so that tight CPU bound loops were less likely to starve out other goroutines."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1437959702, "post_id": 31643203, "comment_id": 51233876, "body": "Final(?) by the way comment: with respect to using the <code>testing</code> package, you should be able to drop something like <a href=\"https://play.golang.org/p/8moIHfiWGx.go\" rel=\"nofollow noreferrer\">this</a> into a <code>*_test.go</code> file in your package and use <code>go test -bench=.</code>."}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1438280085, "post_id": 31712734, "comment_id": 51397838, "body": "This doesn&#39;t explain the OP&#39;s initial problem since the times in question where 15ms, 7999ms, and 15ms. (I.e. more than the timeout elapses between a pair of send/receives on <code>mainChannel</code>)."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1438280159, "post_id": 31712734, "comment_id": 51397875, "body": "It&#39;s also not clear that perhaps the OP <i>did</i> intend for the timeout to apply to just a single iteration (e.g. perhaps they did want to timeout only if it&#39;s been awhile since any progress/results have been reported)."}, {"owner": {"reputation": 115, "user_id": 2822270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e2040ab322eeaa1536e60e15ee9bc15?s=128&d=identicon&r=PG&f=1", "display_name": "Allan Pinkerton", "link": "https://stackoverflow.com/users/2822270/allan-pinkerton"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1438369819, "post_id": 31712734, "comment_id": 51440621, "body": "@DaveC is correct. I intended to timeout the program if there hasn&#39;t been any output for n seconds."}, {"owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "reply_to_user": {"reputation": 115, "user_id": 2822270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e2040ab322eeaa1536e60e15ee9bc15?s=128&d=identicon&r=PG&f=1", "display_name": "Allan Pinkerton", "link": "https://stackoverflow.com/users/2822270/allan-pinkerton"}, "edited": false, "score": 0, "creation_date": 1438372918, "post_id": 31712734, "comment_id": 51442136, "body": "@AllanPinkerton, then running your existing code as &quot;GOMAXPROCS=4 go test.go&quot; does solve your problem (see my other answer)?  If you don&#39;t want to use environment variables, e.g. on Windows, you can add &quot;runtime.GOMAXPROCS(4)&quot; as the first line of <code>main</code> to get the same effect."}], "tags": [], "owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "is_accepted": false, "score": 1, "last_activity_date": 1438211754, "creation_date": 1438211754, "answer_id": 31712734, "question_id": 31643203, "link": "https://stackoverflow.com/questions/31643203/go-timeout-not-firing/31712734#31712734", "title": "Go timeout not firing", "body": "<p>Since you use <code>time.After(time.Second)</code> inside the final loop, you are reseting the timeout every time a result arrives.  Instead, try</p>\n\n<pre><code>timeoutChannel := time.After(time.Second)\nfor _ = range sortingFunctions {\n    select {\n    case result := &lt;-mainChannel:\n        fmt.Printf(result)\n    case &lt;-timeoutChannel:\n        fmt.Println(\"Timeout\")\n    }\n}\n</code></pre>\n\n<p>The above code now catches the timeout correctly.  It still does not work quite as intended, because the contents of the loop always are executed three times (since <code>sortingFunctions</code> has three elements), and any timeout counts towards these three iterations.  Using your code from the go playground I now get the following output:</p>\n\n<pre><code>Generated 90000 integers.\nQuickSortRandom      took     9.4268ms to sort 90000 elements\nTimeout\nQuickSortLastElement took     8.6096ms to sort 90000 elements\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "is_accepted": true, "score": 0, "last_activity_date": 1438357112, "creation_date": 1438357112, "answer_id": 31750078, "question_id": 31643203, "link": "https://stackoverflow.com/questions/31643203/go-timeout-not-firing/31750078#31750078", "title": "Go timeout not firing", "body": "<p>The code you posted on the Go playground gives the following output:</p>\n\n<pre><code>Generated 90000 integers.\nInsertionSort        took  4465.6230ms to sort 90000 elements\nQuickSortLastElement took    11.2758ms to sort 90000 elements\nQuickSortRandom      took    11.6547ms to sort 90000 elements\n</code></pre>\n\n<p>I suspect the fact that you are not seeing the timeout being called is due to the fact that <code>InsertionSort</code> does make any function calls, and thus <a href=\"https://golang.org/doc/go1.2#preemption\" rel=\"nofollow\">does not allow</a> the scheduler to switch between goroutines.  Since Go by default uses only a single thread, everything else has then to wait until <code>InsertionSort</code> has finished.</p>\n\n<p>To test this hypothesis, I tried calling the program with GOMAXPROCS=4 (allowing the Go scheduler to use 4 operating system threads): In this case I get the output</p>\n\n<pre><code>Generated 90000 integers.\nQuickSortRandom      took    21.1900ms to sort 90000 elements\nQuickSortLastElement took    11.4538ms to sort 90000 elements\nTimeout\n</code></pre>\n\n<p>as expected.  (Curiously, for GOMAXPROCS=2 the behaviour is not deterministic, sometimes the timeout triggers and sometimes it does not.  I did not try to find out why 2 threads are not always enough here.)</p>\n"}], "owner": {"reputation": 115, "user_id": 2822270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e2040ab322eeaa1536e60e15ee9bc15?s=128&d=identicon&r=PG&f=1", "display_name": "Allan Pinkerton", "link": "https://stackoverflow.com/users/2822270/allan-pinkerton"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 231, "favorite_count": 0, "accepted_answer_id": 31750078, "answer_count": 2, "score": 0, "last_activity_date": 1438357112, "creation_date": 1437955012, "last_edit_date": 1438041448, "question_id": 31643203, "link": "https://stackoverflow.com/questions/31643203/go-timeout-not-firing", "title": "Go timeout not firing", "body": "<p>I implemented a few sorting algorithms in Go for fun, and now I'd like to test their performance on random integers. So I wrote the following program. I followed a similar format to: <a href=\"https://gobyexample.com/timeouts\" rel=\"nofollow\">https://gobyexample.com/timeouts</a></p>\n\n<p>However, it seems like the timeout is not firing properly. Below is my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"allanpinkerton.com/algorithms/sorting\"\n    \"fmt\"\n    \"math/rand\"\n    \"os\"\n    \"strconv\"\n    \"time\"\n)\n\n// Prints out the time elapsed since start\nfunc timeExecution(startTime time.Time, functionName string, inputSize int) string {\n    executionTime := time.Since(startTime)\n    return fmt.Sprintf(\"%-20s took %10.4fms to sort %d elements\\n\", functionName, float64(executionTime.Nanoseconds())/1000000, inputSize)\n}\n\n// Generates file with n random ints named integerArray + n\nfunc generateRandomIntegers(n int, filename string) {\n    arr := make([]int, n)\n    for i := 0; i &lt; n; i++ {\n        arr[i] = rand.Int()\n    }\n    f, _ := os.Create(filename)\n    defer f.Close()\n    for _, num := range arr {\n        f.WriteString(strconv.Itoa(num) + \" \")\n    }\n    f.WriteString(\"\\n\")\n    f.Sync()\n    fmt.Printf(\"Generated \" + filename + \" with \" + strconv.Itoa(n) + \" elements.\\n\")\n}\n\n\nfunc checkError(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n\nfunc main() {\n\n    sortingFunctions := map[string]interface{}{\n        \"InsertionSort\":        sorting.InsertionSort,\n        \"QuickSortLastElement\": sorting.QuickSortLastElement,\n        \"QuickSortRandom\":      sorting.QuickSortRandom,\n    }\n    if len(os.Args) != 2 {\n        fmt.Printf(\"No size specified.\\n\")\n        return\n    }\n    size := os.Args[1]\n    sizeInt, err := strconv.Atoi(size)\n    checkError(err)\n\n    arr := make([]int, sizeInt)\n    for i := 0; i &lt; sizeInt; i++ {\n        arr[i] = rand.Int()\n    }\n    fmt.Println(\"Generated \" + size + \" integers.\")\n\n    mainChannel := make(chan string)\n    for k, v := range sortingFunctions {\n        newArr := make([]int, len(arr))\n        copy(newArr, arr)\n        go func(name string, v interface{}) {\n            start := time.Now()\n            v.(func([]int))(newArr)\n            result := timeExecution(start, name, len(newArr))\n            mainChannel &lt;- result\n        }(k, v)\n    }\n\n    for _ = range sortingFunctions {\n        select {\n        case result := &lt;-mainChannel:\n            fmt.Printf(result)\n        case &lt;-time.After(time.Second):\n            fmt.Println(\"Timeout\")\n        }\n    }\n\n    return\n}\n</code></pre>\n\n<p>The top is just a bunch of helpers, but the there's something funny going on with the main function. I ran <code>go install</code> and ran it against 150,000 elements, and got the response below:</p>\n\n<pre><code>Generated 150000 integers.\nQuickSortLastElement took    15.0037ms to sort 150000 elements\nInsertionSort        took  7599.5884ms to sort 150000 elements\nQuickSortRandom      took    15.1697ms to sort 150000 elements\n</code></pre>\n\n<p>Clearly insertion sort took over 7\u00a0seconds, but the timeout should fire after 1 second. Is there any reason for the timeout not to fire? </p>\n\n<p>So I tried switching out my custom sorting program out for the sort.Ints function from the sort package by changing sortingFuncs map into:</p>\n\n<pre><code>sortingFunctions := map[string]func([]int){\n    \"InsertionSort\":        sort.Ints,\n    \"QuickSortLastElement\": sort.Ints,\n    \"QuickSortRandom\":      sort.Ints,\n}\n</code></pre>\n\n<p>And the problem was solved. So it's my custom sorting functions that are preventing the timeout from being fired. Is there something that I have to add to those functions to make them run in parallel?</p>\n\n<p>Here is a concatenated version with all the code in the playground.\n<a href=\"https://play.golang.org/p/SBgDTGyUyp\" rel=\"nofollow\">https://play.golang.org/p/SBgDTGyUyp</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1437954454, "post_id": 31638447, "comment_id": 51232867, "body": "How confident are you that your Go program is running in the same location as your <code>downloads</code> folder? Are you using <code>go run &lt;file.go&gt;</code> at all? Running it otherwise?"}], "answers": [{"comments": [{"owner": {"reputation": 393, "user_id": 4798893, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-pYqLduzyUaU/AAAAAAAAAAI/AAAAAAAAAH0/gGDPPeZtY0I/photo.jpg?sz=128", "display_name": "Ousmane Traore", "link": "https://stackoverflow.com/users/4798893/ousmane-traore"}, "edited": false, "score": 0, "creation_date": 1437925057, "post_id": 31638680, "comment_id": 51224056, "body": "My folder structure is like this: downloads/file.zip how would I do that?"}, {"owner": {"reputation": 221, "user_id": 2729715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/477dc0e93e54bedc7521bf85f9ebf7c5?s=128&d=identicon&r=PG&f=1", "display_name": "csabiftw", "link": "https://stackoverflow.com/users/2729715/csabiftw"}, "reply_to_user": {"reputation": 393, "user_id": 4798893, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-pYqLduzyUaU/AAAAAAAAAAI/AAAAAAAAAH0/gGDPPeZtY0I/photo.jpg?sz=128", "display_name": "Ousmane Traore", "link": "https://stackoverflow.com/users/4798893/ousmane-traore"}, "edited": false, "score": 0, "creation_date": 1437925226, "post_id": 31638680, "comment_id": 51224113, "body": "In case your working directory is the one containing the downloads dir, you simply  use http.ServeFile(w, r, &quot;downloads/file.zip&quot;)"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 393, "user_id": 4798893, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-pYqLduzyUaU/AAAAAAAAAAI/AAAAAAAAAH0/gGDPPeZtY0I/photo.jpg?sz=128", "display_name": "Ousmane Traore", "link": "https://stackoverflow.com/users/4798893/ousmane-traore"}, "edited": false, "score": 3, "creation_date": 1437931553, "post_id": 31638680, "comment_id": 51226198, "body": "@JustDevInc do you understand the concept of <a href=\"https://en.wikipedia.org/wiki/Current_working_directory\" rel=\"nofollow noreferrer\">current working directory</a>?"}], "tags": [], "owner": {"reputation": 221, "user_id": 2729715, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/477dc0e93e54bedc7521bf85f9ebf7c5?s=128&d=identicon&r=PG&f=1", "display_name": "csabiftw", "link": "https://stackoverflow.com/users/2729715/csabiftw"}, "is_accepted": true, "score": 13, "last_activity_date": 1437924253, "creation_date": 1437924253, "answer_id": 31638680, "question_id": 31638447, "link": "https://stackoverflow.com/questions/31638447/how-to-server-a-file-from-a-handler-in-golang/31638680#31638680", "title": "How to server a file from a handler in golang", "body": "<p>Here is a complete working example using the standard http package. Please note, that the filename or path you use is relative to your current working directory.</p>\n\n<pre><code>func main() {\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request)     {\n        http.ServeFile(w, r, \"file\")\n    })\n\n    err := http.ListenAndServe(\":8080\", nil)\n    if err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 78237, "user_id": 2025923, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zYYVM.png?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/2025923/tushar"}, "edited": false, "score": 0, "creation_date": 1482809744, "post_id": 41328304, "comment_id": 69880081, "body": "Can you please add explanation, how to use the function with code here."}, {"owner": {"reputation": 1084, "user_id": 639016, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0cb486bfd9e31555f116285d2e715776?s=128&d=identicon&r=PG", "display_name": "Fedir Tsapana", "link": "https://stackoverflow.com/users/639016/fedir-tsapana"}, "reply_to_user": {"reputation": 78237, "user_id": 2025923, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/zYYVM.png?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/2025923/tushar"}, "edited": false, "score": 0, "creation_date": 1482822108, "post_id": 41328304, "comment_id": 69883309, "body": "Ok. Example added"}, {"owner": {"reputation": 526, "user_id": 1035977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/310abc9d873d41cede1258891d6bcaf3?s=128&d=identicon&r=PG", "display_name": "Gwyneth Llewelyn", "link": "https://stackoverflow.com/users/1035977/gwyneth-llewelyn"}, "edited": false, "score": 0, "creation_date": 1599587444, "post_id": 41328304, "comment_id": 112817365, "body": "What about the file size? Would that be a required header? Or does <code>ctx.File()</code> already emit that one?"}], "tags": [], "owner": {"reputation": 1084, "user_id": 639016, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0cb486bfd9e31555f116285d2e715776?s=128&d=identicon&r=PG", "display_name": "Fedir Tsapana", "link": "https://stackoverflow.com/users/639016/fedir-tsapana"}, "is_accepted": false, "score": 4, "last_activity_date": 1482822400, "last_edit_date": 1482822400, "creation_date": 1482739890, "answer_id": 41328304, "question_id": 31638447, "link": "https://stackoverflow.com/questions/31638447/how-to-server-a-file-from-a-handler-in-golang/41328304#41328304", "title": "How to server a file from a handler in golang", "body": "<p>Just use this function from gin.Context:\n<a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.File\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/gin-gonic/gin#Context.File</a></p>\n\n<p>Something like this:</p>\n\n<pre><code>const DOWNLOADS_PATH = \"downloads/\"\n\nginRouter.GET(\"/download-user-file/:filename\", func (ctx *gin.Context) {\n    fileName := ctx.Param(\"filename\")\n    targetPath := filepath.Join(DOWNLOADS_PATH, fileName)\n    //This ckeck is for example, I not sure is it can prevent all possible filename attacks - will be much better if real filename will not come from user side. I not even tryed this code\n    if !strings.HasPrefix(filepath.Clean(targetPath), DOWNLOADS_PATH) {\n        ctx.String(403, \"Look like you attacking me\")\n        return\n    }\n    //Seems this headers needed for some browsers (for example without this headers Chrome will download files as txt)\n    ctx.Header(\"Content-Description\", \"File Transfer\")\n    ctx.Header(\"Content-Transfer-Encoding\", \"binary\")\n    ctx.Header(\"Content-Disposition\", \"attachment; filename=\"+fileName )\n    ctx.Header(\"Content-Type\", \"application/octet-stream\")\n    ctx.File(targetPath)\n})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 36, "user_id": 13761929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1fee403cc19757d7321469b5a9fc5b5f?s=128&d=identicon&r=PG&f=1", "display_name": "Aman Agarwal", "link": "https://stackoverflow.com/users/13761929/aman-agarwal"}, "is_accepted": false, "score": 1, "last_activity_date": 1613840111, "last_edit_date": 1613840111, "creation_date": 1613838217, "answer_id": 66293850, "question_id": 31638447, "link": "https://stackoverflow.com/questions/31638447/how-to-server-a-file-from-a-handler-in-golang/66293850#66293850", "title": "How to server a file from a handler in golang", "body": "<p>For more use Use directly use c.FileAttachment for example:-</p>\n<pre><code>func DownloadHandler(c *gin.Context) {\n     c.FileAttachment(&quot;./downloads/file.zip&quot;,&quot;filename.zip&quot;)\n}\n</code></pre>\n"}], "owner": {"reputation": 393, "user_id": 4798893, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-pYqLduzyUaU/AAAAAAAAAAI/AAAAAAAAAH0/gGDPPeZtY0I/photo.jpg?sz=128", "display_name": "Ousmane Traore", "link": "https://stackoverflow.com/users/4798893/ousmane-traore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16602, "favorite_count": 4, "accepted_answer_id": 31638680, "answer_count": 3, "score": 6, "last_activity_date": 1613840111, "creation_date": 1437922724, "question_id": 31638447, "link": "https://stackoverflow.com/questions/31638447/how-to-server-a-file-from-a-handler-in-golang", "title": "How to server a file from a handler in golang", "body": "<p>I was wondering how to serve a file from a handler. I'm using <a href=\"http://golang.org\" rel=\"noreferrer\">go</a> and <a href=\"http://github.com/gin-gonic/gin\" rel=\"noreferrer\">gin</a> and I've tried to do.</p>\n\n<pre><code>func DownloadHandler(c *gin.Context) {\n   c.File(\"./downloads/file.zip\")\n}\n</code></pre>\n\n<p>and </p>\n\n<pre><code>func DownloadConfigs(c *gin.Context) {\n   http.ServeFile(c.Writer, c.Request, \"./downloads/file.zip\")\n}\n</code></pre>\n\n<p>and both of those solutions without the dot as well.</p>\n\n<p>I'm open to any solution and because gin is compatible with the standard http lib, I can use non-gin specific solutions as well</p>\n"}, {"tags": ["google-app-engine", "go", "profiling"], "comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1437922628, "post_id": 31638119, "comment_id": 51223195, "body": "I&#39;m using app engine logs , you can see the trace of the request- response action"}, {"owner": {"reputation": 3027, "user_id": 560382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1741fdf36945df8f3e26c4f1abd24cad?s=128&d=identicon&r=PG", "display_name": "Alvivi", "link": "https://stackoverflow.com/users/560382/alvivi"}, "edited": false, "score": 0, "creation_date": 1437943579, "post_id": 31638119, "comment_id": 51230132, "body": "There is one third-party package that works great, here it is: <a href=\"http://godoc.org/github.com/mjibson/appstats\" rel=\"nofollow noreferrer\">godoc.org/github.com/mjibson/appstats</a>"}, {"owner": {"reputation": 959, "user_id": 1840370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/87fAc.png?s=128&g=1", "display_name": "Atish", "link": "https://stackoverflow.com/users/1840370/atish"}, "edited": false, "score": 0, "creation_date": 1438022326, "post_id": 31638119, "comment_id": 51266188, "body": "Thank you for the response. It&#39;s kinda hard to visualize data as a glance from a log file. There is this appstats for golang by a developer, but it requires functions to adhear to it&#39;s structure func(context, r, w) unlike the real appstats for python and java. <a href=\"https://github.com/mjibson/appstats\" rel=\"nofollow noreferrer\">github.com/mjibson/appstats</a> Any other tools?"}], "owner": {"reputation": 959, "user_id": 1840370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/87fAc.png?s=128&g=1", "display_name": "Atish", "link": "https://stackoverflow.com/users/1840370/atish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 115, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1437920928, "creation_date": 1437920928, "question_id": 31638119, "link": "https://stackoverflow.com/questions/31638119/how-do-you-measure-performance-for-go-app-engine", "title": "How do you measure performance for go app engine?", "body": "<p>I'm just starting development on App Engine using Golang. I noticed Go doesn't have appstats. </p>\n\n<p>Could you please tell me your workflow for a Go App Engine project? Things from how you profiling to separating development environment from production.</p>\n\n<p>Also, any tips would be appreciated. Thank you!</p>\n"}, {"tags": ["angularjs", "go", "router", "gorilla"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1437918442, "post_id": 31636909, "comment_id": 51221761, "body": "I&#39;d consider using <code>httprouter</code>, it&#39;s more flexible. I&#39;m not totally sure what you&#39;re trying to achieve here and why the duplicate routes."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1467267"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1437927654, "post_id": 31636909, "comment_id": 51224870, "body": "You didn&#39;t read my question at all. Your comment is a typical demotivating response.. I&#39;ve explained exactly what I&#39;m trying to achieve.."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1437934670, "post_id": 31636909, "comment_id": 51227262, "body": "I tried reading your code and really couldn&#39;t figure out what&#39;s going on. Perhaps you can simplify it?"}], "answers": [{"tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 1, "last_activity_date": 1437932502, "creation_date": 1437932502, "answer_id": 31640022, "question_id": 31636909, "link": "https://stackoverflow.com/questions/31636909/more-fluent-cooperation-of-fileserve-and-routing/31640022#31640022", "title": "More fluent cooperation of FileServe and Routing", "body": "<p>It looks for me like you want to change the order of how the routes are evaluated in a way that <code>/users</code>, <code>/login</code>, and similar are matched before the <code>/</code>. And the <code>/</code> should be server by the FileServer.</p>\n\n<p>As far as I know, the routes will be matched in the order they are defined (added to the router). So you just have to move your API and other dynamic routes before <code>/</code>.</p>\n\n<p>The following code works similar:</p>\n\n<ul>\n<li>the <code>/test</code> match is evaluated before the file server and returns the string \"OK\"</li>\n<li>then the file server returns the file under the path</li>\n</ul>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gorilla/mux\"\n    \"net/http\"\n)\n\nfunc main() {\n    appFileHandler := http.FileServer(http.Dir(\"/Users/alex/Projects/tmp/so/app\"))\n    r := mux.NewRouter()\n    r.PathPrefix(\"/test\").HandlerFunc(func(w http.ResponseWriter, req *http.Request) {\n        w.Write([]byte(\"OK\"))\n    })\n    r.PathPrefix(\"/\").Handler(appFileHandler)\n    http.Handle(\"/\", r)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user1467267"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 31640022, "answer_count": 1, "score": 0, "last_activity_date": 1437932502, "creation_date": 1437913411, "question_id": 31636909, "link": "https://stackoverflow.com/questions/31636909/more-fluent-cooperation-of-fileserve-and-routing", "title": "More fluent cooperation of FileServe and Routing", "body": "<p>I have an issue where I want to serve my main AngularJS (Yeoman deployment) app folder on FileServe <code>/</code> but it will destroy all my router bindings. Is there any way I can reserve them and keep my routes in-tact?</p>\n\n<p>In the code below I still have to go to <code>/app</code> and re-bind the other folders, because I don't want to temper with the Grunt file too much (yet), so added some extra backup path-bindings for the folders.</p>\n\n<pre><code>func initializeRoutes() {\n    // Handle all requests by serving a file of the same name\n    fileHandler := http.FileServer(http.Dir(*clFlagStaticDirectory))\n    bowerFileHandler := http.FileServer(http.Dir(\"../bower_components\"))\n    imagesFileHandler := http.FileServer(http.Dir(\"../app/images\"))\n    scriptsFileHandler := http.FileServer(http.Dir(\"../app/scripts\"))\n    stylesFileHandler := http.FileServer(http.Dir(\"../app/styles\"))\n    viewsFileHandler := http.FileServer(http.Dir(\"../app/views\"))\n\n    // Setup routes\n    mainRoute := mux.NewRouter()\n    mainRoute.StrictSlash(true)\n    // mainRoute.Handle(\"/\", http.RedirectHandler(\"/static/\", 302))\n    mainRoute.PathPrefix(\"/app\").Handler(http.StripPrefix(\"/app\", fileHandler))\n    mainRoute.PathPrefix(\"/app/bower_components\").Handler(http.StripPrefix(\"/bower_components\", bowerFileHandler))\n    mainRoute.PathPrefix(\"/bower_components\").Handler(http.StripPrefix(\"/bower_components\", bowerFileHandler))\n    mainRoute.PathPrefix(\"/images\").Handler(http.StripPrefix(\"/images\", imagesFileHandler))\n    mainRoute.PathPrefix(\"/scripts\").Handler(http.StripPrefix(\"/scripts\", scriptsFileHandler))\n    mainRoute.PathPrefix(\"/styles\").Handler(http.StripPrefix(\"/styles\", stylesFileHandler))\n    mainRoute.PathPrefix(\"/views\").Handler(http.StripPrefix(\"/views\", viewsFileHandler))\n\n    // Basic routes\n    // User routes\n    userRoute := mainRoute.PathPrefix(\"/users\").Subrouter()\n    userRoute.Handle(\"/login\", handler(userDoLogin)).Methods(\"POST\")\n    userRoute.Handle(\"/logout\", handler(userDoLogout)).Methods(\"GET\")\n    userRoute.Handle(\"/forgot_password\", handler(forgotPassword)).Methods(\"POST\")\n\n    // Bind API Routes\n    apiRoute := mainRoute.PathPrefix(\"/api\").Subrouter()\n\n    apiProductModelRoute := apiRoute.PathPrefix(\"/productmodels\").Subrouter()\n    apiProductModelRoute.Handle(\"/\", handler(listProductModels)).Methods(\"GET\")\n    apiProductModelRoute.Handle(\"/{id}\", handler(getProductModel)).Methods(\"GET\")\n\n    // Bind generic route\n    http.Handle(\"/\", mainRoute)\n}\n</code></pre>\n\n<p>So my goal is the serve <code>/app</code> as my <code>/</code> main path, but reserve all my Mux Routes to win over the FileServe. So if I'll have a <code>/app/users/login</code> folder, it won't load, but instead it will let the Router win.</p>\n\n<p>Note: I'm serving purely over <code>HTTPS</code> and nothing over <code>HTTP</code>.</p>\n\n<p>Thanks so much in advance! This is breaking my brain and it's the last thing I need to figure out before I can fully start on my front-end code :).</p>\n"}, {"tags": ["dictionary", "go"], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 3806935, "user_type": "registered", "accept_rate": 20, "profile_image": "https://graph.facebook.com/1233304397/picture?type=large", "display_name": "Alfred", "link": "https://stackoverflow.com/users/3806935/alfred"}, "edited": false, "score": 0, "creation_date": 1437883483, "post_id": 31633475, "comment_id": 51213902, "body": "I am wondering why it&#39;s immutable. the map should be similar as dic in Python, which can be modified directly."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 71, "user_id": 3806935, "user_type": "registered", "accept_rate": 20, "profile_image": "https://graph.facebook.com/1233304397/picture?type=large", "display_name": "Alfred", "link": "https://stackoverflow.com/users/3806935/alfred"}, "edited": false, "score": 1, "creation_date": 1437884695, "post_id": 31633475, "comment_id": 51214085, "body": "It&#39;s not a good comparison  because Python does not have a type a type like Go&#39;s array type. If Python did have a type like Go&#39;s array type, I would think that the same rule applies. Map implementers what the freedom to move values around in memory.. The map value is mutable, it&#39;s just not addressable."}, {"owner": {"reputation": 71, "user_id": 3806935, "user_type": "registered", "accept_rate": 20, "profile_image": "https://graph.facebook.com/1233304397/picture?type=large", "display_name": "Alfred", "link": "https://stackoverflow.com/users/3806935/alfred"}, "edited": false, "score": 0, "creation_date": 1437886138, "post_id": 31633475, "comment_id": 51214302, "body": "Another way to achieve it is to define IPAddr as a slice: type IPAddr []byte"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 4, "last_activity_date": 1437883320, "last_edit_date": 1437883320, "creation_date": 1437882981, "answer_id": 31633475, "question_id": 31633453, "link": "https://stackoverflow.com/questions/31633453/how-to-modify-map-in-go/31633475#31633475", "title": "How to modify map in go", "body": "<p>Because map values are not addressable, you need to reassign the entire value:</p>\n\n<pre><code>addr := addrs[\"loopback\"]\naddr[0] = 2\naddrs[\"loopback\"] = addr\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/ibrX594PC5\" rel=\"nofollow\">playground example</a></p>\n\n<p>If you change the map value type to *IPAddr, then the assignment</p>\n\n<pre><code>addrs[\"loopback\"][0] = 2\n</code></pre>\n\n<p>works. In this case, the code is assigning to a value pointed to by the map. This value is addressable.</p>\n\n<p><a href=\"http://play.golang.org/p/RO0fL-5DQZ\" rel=\"nofollow\">playground example</a>  </p>\n"}], "owner": {"reputation": 71, "user_id": 3806935, "user_type": "registered", "accept_rate": 20, "profile_image": "https://graph.facebook.com/1233304397/picture?type=large", "display_name": "Alfred", "link": "https://stackoverflow.com/users/3806935/alfred"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2398, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1437883320, "creation_date": 1437882694, "question_id": 31633453, "link": "https://stackoverflow.com/questions/31633453/how-to-modify-map-in-go", "title": "How to modify map in go", "body": "<p>I am trying to modify the IPAddr for the \"loopback\", but it seems cannot access the element directly. </p>\n\n<pre><code>addrs[\"loopback\"][0] = byte(2) //cannot assign to addrs[\"loopback\"][0]\n</code></pre>\n\n<p>How can I do it within go?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype IPAddr [4]byte\n\nfunc main() {\n    addrs := map[string]IPAddr{\n        \"loopback\":  {127, 0, 0, 1},\n        \"googleDNS\": {8, 8, 8, 8},\n    }\n    addrs[\"loopback\"][0] = byte(2)\n    for n, a := range addrs {\n        fmt.Printf(\"%v: %v\\n\", n, a)\n    }\n}\n</code></pre>\n"}, {"tags": ["pointers", "go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "edited": false, "score": 0, "creation_date": 1437914331, "post_id": 31633496, "comment_id": 51220607, "body": "I should&#39;ve been more clear, I don&#39;t want to consider a case where we explicitly change the value where the pointer points to. But you say: &quot;As long as there is an active pointer to an underlying array for a slice, the underlying array is pinned, it will not be garbage collected.&quot; This seems to answer my question: <code>silly_ptr</code> will always point to value equal 3, unless we explicitly change that value, right? Do you know of any good resources on the topic?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "edited": false, "score": 0, "creation_date": 1437959126, "post_id": 31633496, "comment_id": 51233753, "body": "@Akavall: My answer showed that you can safely use the pointer to both read and write the element value. The text for the Go garbage collection project is: The Garbage Collection Handbook: The Art of Automatic Memory Management (Chapman &amp; Hall/CRC Applied Algorithms and Data Structures series) R. Jones, A. Hosking, E. Moss."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1437885329, "last_edit_date": 1437885329, "creation_date": 1437883293, "answer_id": 31633496, "question_id": 31633330, "link": "https://stackoverflow.com/questions/31633330/behavior-of-a-pointer-to-an-element-of-slice-after-the-slice-had-been-append/31633496#31633496", "title": "Behavior of a pointer to an element of `slice` after the `slice` had been appended to", "body": "<p>No, it will not always store 3.</p>\n\n<p>Go has memory management. As long as there is an active pointer to an underlying array for a slice, the underlying array is pinned, it will not be garbage collected. If you have a pointer to an element of an underlying array, you can change the value of the element. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc pin() *int {\n    s := []int{3}\n    fmt.Println(&amp;s[0])\n    a := &amp;s[0]\n    s = append(s, 7)\n    fmt.Println(&amp;s[0])\n    return a\n}\n\nfunc main() {\n    a := pin()\n    fmt.Println(a, *a)\n    *a = 42\n    fmt.Println(a, *a)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>0xc82000a340\n0xc82000a360\n0xc82000a340 3\n0xc82000a340 42\n</code></pre>\n\n<p>A slice descriptor contains a pointer to an underlying array so you can see something similar with a slice. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc pin() []int {\n    s := []int{3}\n    fmt.Println(&amp;s[0])\n    d := s\n    s = append(s, 7)\n    fmt.Println(&amp;s[0])\n    return d\n}\n\nfunc main() {\n    d := pin()\n    fmt.Println(&amp;d[0], d)\n    d[0] = 42\n    fmt.Println(&amp;d[0], d)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>0xc82000a340\n0xc82000a360\n0xc82000a340 [3]\n0xc82000a340 [42]\n</code></pre>\n"}], "owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1437913538, "creation_date": 1437881079, "last_edit_date": 1437913538, "question_id": 31633330, "link": "https://stackoverflow.com/questions/31633330/behavior-of-a-pointer-to-an-element-of-slice-after-the-slice-had-been-append", "title": "Behavior of a pointer to an element of `slice` after the `slice` had been appended to", "body": "<p>I am wondering what is the behavior of a pointer to an element of <code>slice</code> after the <code>slice</code> had been appended to, for example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    my_slice := []int {3}\n\n    silly_ptr := &amp;my_slice[0]\n    // Do we know that silly_ptr points to value equal 3\n    // all the time? (If we don't explicitly change it).\n\n    fmt.Printf(\"%p\\n\", silly_ptr)\n    fmt.Println(*silly_ptr)\n\n    for i := 0; i &lt; 10; i++ {\n        my_slice = append(my_slice, i)\n    }\n\n    silly_ptr_2 := &amp;my_slice[0]\n\n    fmt.Printf(\"%p\\n\", silly_ptr_2)\n    fmt.Println(*silly_ptr_2)\n}\n</code></pre>\n\n<p>Produces: (no surprises)</p>\n\n<pre><code>0xc20800a200\n3\n0xc20805a000\n3\n</code></pre>\n\n<p>I know that when appending to dynamic array, at certain points we have repopulate the entire array, and therefore memory address of the original array elements is not reliable. To the best of my knowledge similar code is valid in <code>c++</code>, but <code>silly_ptr</code> could be pointing to anything. <code>rust</code> does not allow mutating a <code>vector</code> if it is being borrowed, so the above logic would not compile.</p>\n\n<p>But what about <code>Go</code>? I know that by <code>escape analysis</code> it is valid to return a pointer to a local variable, the variable would be just created on the heap for you. My intuition tells me that the same logic applies in the above case. The memory location where <code>silly_ptr</code> is pointing to will not be repopulated, and hence will always store <code>3</code> (if we don't explictly change it). Is this right?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 7430, "user_id": 2105930, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e884c31250cf768e8b8261e31cd0821?s=128&d=identicon&r=PG", "display_name": "chowey", "link": "https://stackoverflow.com/users/2105930/chowey"}, "edited": false, "score": 0, "creation_date": 1437879068, "post_id": 31632997, "comment_id": 51213262, "body": "My preference is just a preference, I&#39;m aware it is not difficult to go the <code>srv.Listen()</code> route. I assume that because you avoid the problem, you also can&#39;t figure out a way to get the port number?"}, {"owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "reply_to_user": {"reputation": 7430, "user_id": 2105930, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e884c31250cf768e8b8261e31cd0821?s=128&d=identicon&r=PG", "display_name": "chowey", "link": "https://stackoverflow.com/users/2105930/chowey"}, "edited": false, "score": 2, "creation_date": 1437879199, "post_id": 31632997, "comment_id": 51213290, "body": "Correct, it is actually not possible to do that without things much much worse than creating your own listener. ListenAndServe is meant to be a convenience function. As with most such functions, the second you need something that special, you need to use a lower level function."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1437930869, "post_id": 31632997, "comment_id": 51225966, "body": "Note that this uses the unexported <code>tcpKeepAliveListener</code> so if you want TCP keep-alives you&#39;ll also need to <a href=\"https://golang.org/src/net/http/server.go?s=51082:51123#L1967\" rel=\"nofollow noreferrer\">copy that source</a> thankfully it&#39;s only a dozen lines of trivial code but it makes it a little more annoying to do this."}, {"owner": {"reputation": 2463, "user_id": 1052007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/272df854e268223a57c4aec2d7b65436?s=128&d=identicon&r=PG", "display_name": "Hugo", "link": "https://stackoverflow.com/users/1052007/hugo"}, "edited": false, "score": 0, "creation_date": 1487329813, "post_id": 31632997, "comment_id": 71747614, "body": "New URL for that ListenAndServe function: <a href=\"https://golang.org/src/net/http/server.go?s=51082:51123#L2576\" rel=\"nofollow noreferrer\">golang.org/src/net/http/server.go?s=51082:51123#L2576</a>"}], "tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": false, "score": 2, "last_activity_date": 1516108615, "last_edit_date": 1516108615, "creation_date": 1437876959, "answer_id": 31632997, "question_id": 31632506, "link": "https://stackoverflow.com/questions/31632506/how-to-get-address-for-http-listenandserve/31632997#31632997", "title": "How to get address for http.ListenAndServe", "body": "<blockquote>\n  <p>I would prefer not to create my own listener and use srv.Listen(ln), since srv.ListenAndServe() has a good default (but unexported) listener that I want to use.</p>\n</blockquote>\n\n<p>Why not? ListenAndServe() is extremely simple to implement yourself. You can <a href=\"https://golang.org/src/net/http/server.go?#L2622\" rel=\"nofollow noreferrer\">read the source code</a> for it yourself:</p>\n\n<pre><code>func (srv *Server) ListenAndServe() error {\n    addr := srv.Addr\n    if addr == \"\" {\n        addr = \":http\"\n    }\n    ln, err := net.Listen(\"tcp\", addr)\n    if err != nil {\n        return err\n    }\n    return srv.Serve(tcpKeepAliveListener{ln.(*net.TCPListener)})\n}\n</code></pre>\n\n<p>The answer is that you will need to use write your own ListenAndServe() that gives you the information you want. It is much easier than you believe however. The entire thing isn't more than 20 lines (assuming you want to set keep-alives with <a href=\"https://golang.org/src/net/http/server.go?#L3111\" rel=\"nofollow noreferrer\">tcpKeepAliveListener</a>).</p>\n"}, {"comments": [{"owner": {"reputation": 7430, "user_id": 2105930, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e884c31250cf768e8b8261e31cd0821?s=128&d=identicon&r=PG", "display_name": "chowey", "link": "https://stackoverflow.com/users/2105930/chowey"}, "edited": false, "score": 0, "creation_date": 1516140955, "post_id": 48283226, "comment_id": 83566450, "body": "What if the OS assigns that port to another process in the meanwhile?"}, {"owner": {"reputation": 2917, "user_id": 940939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f04fbc97c3735bb1e24b90e1aa336aae?s=128&d=identicon&r=PG", "display_name": "Massimo Zerbini", "link": "https://stackoverflow.com/users/940939/massimo-zerbini"}, "reply_to_user": {"reputation": 7430, "user_id": 2105930, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e884c31250cf768e8b8261e31cd0821?s=128&d=identicon&r=PG", "display_name": "chowey", "link": "https://stackoverflow.com/users/2105930/chowey"}, "edited": false, "score": 0, "creation_date": 1516176949, "post_id": 48283226, "comment_id": 83577288, "body": "In that case you get an error starting the server, so you need to test if the error happens and repeat the operation. Choose another port calling the method GetFreePort again and restart the server."}], "tags": [], "owner": {"reputation": 2917, "user_id": 940939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f04fbc97c3735bb1e24b90e1aa336aae?s=128&d=identicon&r=PG", "display_name": "Massimo Zerbini", "link": "https://stackoverflow.com/users/940939/massimo-zerbini"}, "is_accepted": false, "score": 0, "last_activity_date": 1516111948, "creation_date": 1516111948, "answer_id": 48283226, "question_id": 31632506, "link": "https://stackoverflow.com/questions/31632506/how-to-get-address-for-http-listenandserve/48283226#48283226", "title": "How to get address for http.ListenAndServe", "body": "<p>You can select a free port before configuring the server address. The simpler way to get a free port is to create a listener, so you can obtain the same result following Stephen suggestion.</p>\n\n<pre><code>func GetFreePort() (int, error) {\n    ln, err := net.Listen(\"tcp\", \":0\")\n    if err != nil {\n        return 0, err\n    }\n    err = ln.Close()\n    if err != nil {\n        return 0, err\n    }\n    return ln.Addr().(*net.TCPAddr).Port, nil\n}\n</code></pre>\n\n<p>Here a complete example <a href=\"https://play.golang.org/p/bG4OpmQbz9s\" rel=\"nofollow noreferrer\">https://play.golang.org/p/bG4OpmQbz9s</a></p>\n"}, {"tags": [], "owner": {"reputation": 7430, "user_id": 2105930, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e884c31250cf768e8b8261e31cd0821?s=128&d=identicon&r=PG", "display_name": "chowey", "link": "https://stackoverflow.com/users/2105930/chowey"}, "is_accepted": true, "score": 2, "last_activity_date": 1586365282, "creation_date": 1586365282, "answer_id": 61106046, "question_id": 31632506, "link": "https://stackoverflow.com/questions/31632506/how-to-get-address-for-http-listenandserve/61106046#61106046", "title": "How to get address for http.ListenAndServe", "body": "<p>As of Go 1.14.1, <code>net/http</code> no longer wraps the TCP listener!</p>\n\n<p>Looking at the <a href=\"https://github.com/golang/go/blob/1abf3aa55bb8b346bb1575ac8db5022f215df65a/src/net/http/server.go#L2783\" rel=\"nofollow noreferrer\">source code</a>, it is now:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (srv *Server) ListenAndServe() error {\n    if srv.shuttingDown() {\n        return ErrServerClosed\n    }\n    addr := srv.Addr\n    if addr == \"\" {\n        addr = \":http\"\n    }\n    ln, err := net.Listen(\"tcp\", addr)\n    if err != nil {\n        return err\n    }\n    return srv.Serve(ln)\n}\n</code></pre>\n\n<p>This is due to <a href=\"https://github.com/golang/go/commit/1abf3aa55bb8b346bb1575ac8db5022f215df65a\" rel=\"nofollow noreferrer\">this commit</a>, where the \"keepalive\" part of the listener was moved to the standard <code>net</code> package and is now turned on by default.</p>\n\n<p><strong>So, don't worry about it!</strong> Just create your own listener.</p>\n\n<hr>\n\n<h2>Example</h2>\n\n<pre class=\"lang-golang prettyprint-override\"><code>ln, err := net.Listen(\"tcp\", \"127.0.0.1:0\")\nif err != nil {\n    return err\n}\ngo srv.Serve(ln)\nlog.Printf(\"Listening on %s\", ln.Addr().String())\n</code></pre>\n"}], "owner": {"reputation": 7430, "user_id": 2105930, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6e884c31250cf768e8b8261e31cd0821?s=128&d=identicon&r=PG", "display_name": "chowey", "link": "https://stackoverflow.com/users/2105930/chowey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3563, "favorite_count": 1, "accepted_answer_id": 61106046, "answer_count": 3, "score": 7, "last_activity_date": 1586365282, "creation_date": 1437871487, "question_id": 31632506, "link": "https://stackoverflow.com/questions/31632506/how-to-get-address-for-http-listenandserve", "title": "How to get address for http.ListenAndServe", "body": "<p>Say I start a server like so:</p>\n\n<pre><code>srv := http.Server{\n    Addr:    \":0\",\n    Handler: http.FileServer(http.Dir(\".\")),\n}\ngo srv.ListenAndServe()\nlog.Printf(\"Listening on ???\")\n</code></pre>\n\n<p>How can I tell which port was picked? <code>:0</code> is designed to pick a random ephemeral port by the OS, but I need to know which one was picked.</p>\n\n<p><strong>NOTE:</strong> I would prefer <em>not</em> to create my own listener and use <code>srv.Listen(ln)</code>, since <code>srv.ListenAndServe()</code> has a good default (but unexported) listener that I want to use.</p>\n"}, {"tags": ["multithreading", "go", "pipeline", "goroutine"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1437867239, "post_id": 31631974, "comment_id": 51211413, "body": "Not sure the sample includes enough to reproduce the problem: <a href=\"http://play.golang.org/p/jG_rDP7wpb\" rel=\"nofollow noreferrer\">play.golang.org/p/jG_rDP7wpb</a>"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1437867386, "post_id": 31631974, "comment_id": 51211434, "body": "It does look like <code>if !ak || av &lt; bv</code> followed bg <code>if !bk || bv &gt; av</code> could be a logic error. It looks from the rest of these statements like they&#39;re supposed to mirror each other, but <code>av &lt; bv</code> and <code>bv &gt; av</code> are different ways to state the exact same condition, not mirror-image conditions."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1437867631, "post_id": 31631974, "comment_id": 51211476, "body": "(Like, if the goal were &quot;output whichever input is higher,&quot; the comparisn in that second <code>if</code> should be <code>bv &lt; av</code>.)"}, {"owner": {"reputation": 97, "user_id": 458207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7d200808f3368d33a2c14e6d03f40ce6?s=128&d=identicon&r=PG", "display_name": "mckn", "link": "https://stackoverflow.com/users/458207/mckn"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1437868797, "post_id": 31631974, "comment_id": 51211675, "body": "here is an fully working example...the bad thing is that it seems to work on the playground. <a href=\"http://play.golang.org/p/uhd3EWrwEo\" rel=\"nofollow noreferrer\">play.golang.org/p/uhd3EWrwEo</a>"}, {"owner": {"reputation": 97, "user_id": 458207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7d200808f3368d33a2c14e6d03f40ce6?s=128&d=identicon&r=PG", "display_name": "mckn", "link": "https://stackoverflow.com/users/458207/mckn"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1437869741, "post_id": 31631974, "comment_id": 51211820, "body": "but when i cange to string it starts to act wierd: <a href=\"http://play.golang.org/p/Dqq7-cPaFq\" rel=\"nofollow noreferrer\">play.golang.org/p/Dqq7-cPaFq</a>"}], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 458207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7d200808f3368d33a2c14e6d03f40ce6?s=128&d=identicon&r=PG", "display_name": "mckn", "link": "https://stackoverflow.com/users/458207/mckn"}, "edited": false, "score": 0, "creation_date": 1437915208, "post_id": 31636695, "comment_id": 51220865, "body": "Thanks! I really appreciate your help!"}], "tags": [], "owner": {"reputation": 11891, "user_id": 1930219, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/5ae618e4950c81bf0d83d17c2c2ddaab?s=128&d=identicon&r=PG", "display_name": "Alex Netkachov", "link": "https://stackoverflow.com/users/1930219/alex-netkachov"}, "is_accepted": true, "score": 2, "last_activity_date": 1437912461, "last_edit_date": 1437912461, "creation_date": 1437911835, "answer_id": 31636695, "question_id": 31631974, "link": "https://stackoverflow.com/questions/31631974/how-to-sync-goroutines-in-pipeline/31636695#31636695", "title": "How to sync goroutines in pipeline", "body": "<p>Regarding <a href=\"http://play.golang.org/p/uhd3EWrwEo\" rel=\"nofollow\">http://play.golang.org/p/uhd3EWrwEo</a> and <a href=\"http://play.golang.org/p/Dqq7-cPaFq\" rel=\"nofollow\">http://play.golang.org/p/Dqq7-cPaFq</a> -</p>\n\n<p>Actually, the code for ints will fail with the similar test case as well:</p>\n\n<pre><code>os := Source([]int{1, 2, 3})\nns := Source([]int{1, 3, 4})\n</code></pre>\n\n<p>puts the ints version to infinite loop.</p>\n\n<p>This happens because when <code>!aok || avalue &gt; bvalue</code> is checked, it does not take into account that if <code>aok</code> is true (some elements still are in <code>a</code>) and <code>bok</code> is false (no more elements in <code>b</code>), then <code>avalue &gt; \"\"</code> is always true. So it tries to take another item from <code>b</code> (which is empty) and goes to infinite loop. Fixed code: <a href=\"http://play.golang.org/p/vYhuOZxRMl\" rel=\"nofollow\">http://play.golang.org/p/vYhuOZxRMl</a></p>\n"}], "owner": {"reputation": 97, "user_id": 458207, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7d200808f3368d33a2c14e6d03f40ce6?s=128&d=identicon&r=PG", "display_name": "mckn", "link": "https://stackoverflow.com/users/458207/mckn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "accepted_answer_id": 31636695, "answer_count": 1, "score": 0, "last_activity_date": 1437912461, "creation_date": 1437865640, "question_id": 31631974, "link": "https://stackoverflow.com/questions/31631974/how-to-sync-goroutines-in-pipeline", "title": "How to sync goroutines in pipeline", "body": "<p>I would need help to understand why the following code does not work. I am building a pipeline and trying to have a step that synchronize values from two source channels. My source/producer code looks something like below (in my real code i read the text from a file). The sources are sorted but are values are not guaranteed to be in both sources.</p>\n\n<pre><code>func Source() &lt;-chan int{\n    out := make(chan int, 5)\n\n    go func() {\n        defer reader.Close()\n\n        out &lt;- 1\n        out &lt;- 2\n        out &lt;- 3\n        out &lt;- 4\n        out &lt;- 5\n        out &lt;- 7\n\n        close(out)\n    }()\n\n    return out\n}\n</code></pre>\n\n<p>and the synchronization code looks like this:</p>\n\n<pre><code>func Sync(a, b &lt;-chan int) &lt;-chan int {\n    out := make(chan int)\n\n    go func() {\n        av, ak:= &lt;-a\n        bv, bk:= &lt;-b\n\n        for ak || bk {\n\n            if !ak || av &lt; bv {\n                out &lt;- bv\n\n                bv, bk = &lt;-b\n                continue\n            }\n\n            if !bk|| bv &gt; av {\n                out &lt;- av\n\n                av, ak = &lt;-a\n                continue\n            }\n\n            out &lt;- av\n\n            av, ak = &lt;-a\n            bv, bk = &lt;-b\n        }\n\n        close(out)\n    }()\n\n    return out\n}\n</code></pre>\n\n<p>and my program looks something like this:</p>\n\n<pre><code>func main() {\n    os := Source()\n    ns := Source()\n\n    for val := range Sync(ns, os) {\n        fmt.Printf(\"[SYNCED] %v \\n\", val)\n    }\n}\n</code></pre>\n\n<p>The expected behaviour is that my both sources buffer values into the channel and my sync first reads value from the first source. Then from the second. Compare them and if they are equal continues to the next in the both channels. If the differ we will send out the value that is behind and replace it with a new one and make the same comparison again.</p>\n\n<p>What happends is that it looks like the sync code is run several times for the values and I will get things like [SYNCED] 1 several times. Why?</p>\n\n<p>Please help me get this fixed!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1437857410, "post_id": 31630896, "comment_id": 51209159, "body": "You have to login first to be able to download the file, try in a different browser and you will see."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1437857460, "post_id": 31630896, "comment_id": 51209176, "body": "It&#39;s probably seeing what I get when I go there: the login page. You could try getting your session cookie your browser&#39;s developer tools and using an <a href=\"http://golang.org/pkg/net/http/#Client\" rel=\"nofollow noreferrer\"><code>http.Client</code></a> and the <a href=\"http://golang.org/pkg/net/http/cookiejar/\" rel=\"nofollow noreferrer\"><code>net&#47;http&#47;cookiejar</code></a> package so the can use your existing session. The alternative is getting the program to log in to chess.com itself."}], "answers": [{"comments": [{"owner": {"reputation": 117, "user_id": 5156131, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b7105067308139dd916bd8d7cc5a9ce?s=128&d=identicon&r=PG&f=1", "display_name": "Austin Walela", "link": "https://stackoverflow.com/users/5156131/austin-walela"}, "edited": false, "score": 0, "creation_date": 1437859921, "post_id": 31631046, "comment_id": 51209868, "body": "That could be the thing.This is a port from python however where I had done urrlib2.urlopen(fileurl).read() and it just worked.Let me check your suggestions."}], "tags": [], "owner": {"reputation": 4737, "user_id": 36693, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/OWMEs.jpg?s=128&g=1", "display_name": "Nate", "link": "https://stackoverflow.com/users/36693/nate"}, "is_accepted": false, "score": 2, "last_activity_date": 1437857798, "creation_date": 1437857798, "answer_id": 31631046, "question_id": 31630896, "link": "https://stackoverflow.com/questions/31630896/golang-downloading-file-instead-of-html-page/31631046#31631046", "title": "golang downloading file instead of html page", "body": "<p>First guess is that you've failed to supply all of the normal auth, cookies, and headers a browser session normally would supply. As an experiment, open up Chrome in Incognito mode, then open your developer tools, now in that window hit the URL you GET above. When I do this I look at the first GET in the Network tab in Chrome. Notice the request and response details below. Pay attention to the response code of 302 which means it is found, but you are being redirected. Now take a look for the Location header. It reads '/login'. I suspect this is the very page your code is downloading since your Go program does not have the login session/cookies for this site like your browser does.</p>\n\n<p>There's a lot of work our browsers do to navigate a website. Coding that up from scratch can be a bit of work. You have to pay attention to cookies, authentication, headers, redirects, and more.</p>\n\n<pre>\nRemote Address:174.35.7.172:80\nRequest URL:http://www.chess.com/echess/download_pgn?lid=1222621131\nRequest Method:GET\nStatus Code:302 Found\nResponse Headers\nview parsed\nHTTP/1.1 302 Found\nDate: Sat, 25 Jul 2015 20:49:43 GMT\nServer: PWS/8.1.20.22\nX-Px: ms h0-s1027.p12-sjc ( origin)\nP3P: CP=\"ALL DSP COR LAW CURa ADMa DEVa TAIa OUR BUS IND ONL UNI COM NAV DEM CNT\"\nCache-Control: private\nPragma: no-cache\nExpires: Thu, 19 Nov 1981 08:52:00 GMT\nContent-Length: 0\nContent-Type: text/html; charset=utf-8\nLocation: /login\nConnection: keep-alive\nSet-Cookie: PHPSESSID=pach18her77q4asgsq2heohvj1; path=/; domain=.chess.com; HttpOnly\nRequest Headers\nview parsed\nGET /echess/download_pgn?lid=1222621131 HTTP/1.1\nHost: www.chess.com\nConnection: keep-alive\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/43.0.2357.134 Safari/537.36\nAccept-Encoding: gzip, deflate, sdch\nAccept-Language: en-US,en;q=0.8,es;q=0.6\nQuery String Parameters\nview source\nview URL encoded\nlid:1222621131\n</pre>\n"}], "owner": {"reputation": 117, "user_id": 5156131, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b7105067308139dd916bd8d7cc5a9ce?s=128&d=identicon&r=PG&f=1", "display_name": "Austin Walela", "link": "https://stackoverflow.com/users/5156131/austin-walela"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1541, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1437857851, "creation_date": 1437856730, "last_edit_date": 1437857851, "question_id": 31630896, "link": "https://stackoverflow.com/questions/31630896/golang-downloading-file-instead-of-html-page", "title": "golang downloading file instead of html page", "body": "<p>I would like to download a pgn text file from this URL: <a href=\"http://www.chess.com/echess/download_pgn?lid=1222621131\" rel=\"nofollow\">http://www.chess.com/echess/download_pgn?lid=1222621131</a>.\nI have the following (redacted) code which is supposed to do this, but it is downloading a html page instead.What could I be doing wrong?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n)\n\nfunc main() {\n    url := \"http://www.chess.com/echess/download_pgn?lid=1222621131\"\n    filename := \"game.pgn\"\n    resp, err := http.Get(url)\n    ...\n\n    file, err := os.Create(filename)\n    defer file.Close()\n\n    ...\n\n    size, err := io.Copy(file, resp.Body)   \n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1437850734, "post_id": 31629514, "comment_id": 51207350, "body": "A few lines of code to convert from one format to another does not seem like a hack to me."}, {"owner": {"reputation": 1499, "user_id": 5128105, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/NDMnr.png?s=128&g=1", "display_name": "Sundar", "link": "https://stackoverflow.com/users/5128105/sundar"}, "edited": false, "score": 0, "creation_date": 1438767642, "post_id": 31629514, "comment_id": 51580394, "body": "mgo aligns very closely to what we can do directly with mongocli. So what you have done seems a viable solution to me."}], "owner": {"reputation": 426, "user_id": 3103576, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/e35c62a67f35696dd6784d3202aa3208?s=128&d=identicon&r=PG&f=1", "display_name": "Taylor Stevens", "link": "https://stackoverflow.com/users/3103576/taylor-stevens"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 419, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1437847321, "creation_date": 1437847321, "question_id": 31629514, "link": "https://stackoverflow.com/questions/31629514/proper-method-for-partial-update-of-a-subdocument-in-mongo", "title": "Proper method for partial update of a subdocument in mongo", "body": "<p>I have a collection in monogoDB with the following document structure:</p>\n\n<pre><code>{_id:\"foo\",\ncontent: [\n    {_id: \"bar1\",\n    field1: \"value1\",\n    field2: \"value2\",\n    field3: \"value3\",\n    field4: \"value4\"},        \n    {_id: \"bar2\",\n    field1: \"value5\",\n    field2: \"value6\",\n    field3: \"value7\",\n    field4: \"value8\"}] \n}\n</code></pre>\n\n<p>I want to perform a partial update in a single embedded content document without having to specify which fields I am updating. From what I have read, my only option for doing this is:</p>\n\n<pre><code>Update({\"_id\": \"foo\", \"content._id\" : \"bar1\"}, \n       {\"$set\": {\"content.$.field1\" : \"value9\", \"content.$.field2\" : \"value10\"})\n</code></pre>\n\n<p>Assuming this is infact my best option, what is the best way to apply updates from a POST body? (I'm doing this in go). I don't think it makes sense to have the client prefix all of the field names with \"content.$.\", so right now I am creating a new map with the prefixed fields after receiving the POST body:</p>\n\n<pre><code>content := bson.M{}\njson.NewDecoder(r.Body).Decode(&amp;content)\n\nnewContent := bson.M{}\n\nfor key, val := range content{\n    newContent[\"content.$.\" + key] = val\n}\n\n//proceed with newContent\n</code></pre>\n\n<p>but this feels like a hack. Is there a better way to do this?</p>\n"}, {"tags": ["go", "abstract-syntax-tree"], "comments": [{"owner": {"reputation": 1125, "user_id": 4224724, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-XMleNi8A3cE/AAAAAAAAAAI/AAAAAAAACzU/_LZ3Rgct8Xk/photo.jpg?sz=128", "display_name": "Danver Braganza", "link": "https://stackoverflow.com/users/4224724/danver-braganza"}, "edited": false, "score": 1, "creation_date": 1439673605, "post_id": 31628613, "comment_id": 51960455, "body": "I suspect you need to update the <a href=\"http://golang.org/pkg/go/ast/#NewCommentMap\" rel=\"nofollow noreferrer\">Comment Map</a> for this to work correctly."}, {"owner": {"reputation": 4457, "user_id": 1685538, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ebbb7b5247615b8e0984e149bd86fc16?s=128&d=identicon&r=PG", "display_name": "HectorJ", "link": "https://stackoverflow.com/users/1685538/hectorj"}, "edited": false, "score": 2, "creation_date": 1440334344, "post_id": 31628613, "comment_id": 52220417, "body": "Here you can see some details of the actual and expected trees : <a href=\"https://play.golang.org/p/qv63Hu1xmP\" rel=\"nofollow noreferrer\">play.golang.org/p/qv63Hu1xmP</a> thanks to <a href=\"https://golang.org/pkg/go/ast/#Fprint\" rel=\"nofollow noreferrer\">golang.org/pkg/go/ast/#Fprint</a> .  The main differences I see are <code>Slash</code>, <code>NamePos</code>, and <code>Obj</code> not set. I tried to fiddle with the positions, but could not get it right..."}, {"owner": {"reputation": 4248, "user_id": 1832966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bbc5a2b0d0f59c23c20aafce9309773?s=128&d=identicon&r=PG", "display_name": "Kyle Lemons", "link": "https://stackoverflow.com/users/1832966/kyle-lemons"}, "edited": false, "score": 1, "creation_date": 1442456145, "post_id": 31628613, "comment_id": 53093347, "body": "This one has me stumped... It looks like there is some kind of other bookeeping that needs to be done, as I was able to get Slash and NamePos to match (offset by 100 notwithstanding) in this: <a href=\"http://play.golang.org/p/pQodZncMjA\" rel=\"nofollow noreferrer\">play.golang.org/p/pQodZncMjA</a> -- and even adding in AddLine and CommentMap doesn&#39;t seem to help: <a href=\"http://play.golang.org/p/GGj2eDwDF-\" rel=\"nofollow noreferrer\">play.golang.org/p/GGj2eDwDF-</a>"}, {"owner": {"reputation": 3457, "user_id": 3108853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db3d997e8c35cb14623d4dc4de494801?s=128&d=identicon&r=PG&f=1", "display_name": "lsowen", "link": "https://stackoverflow.com/users/3108853/lsowen"}, "edited": false, "score": 1, "creation_date": 1442874845, "post_id": 31628613, "comment_id": 53254611, "body": "I have made some progress on this: <a href=\"http://play.golang.org/p/rOqcPnovsx\" rel=\"nofollow noreferrer\">play.golang.org/p/rOqcPnovsx</a>  The tricks needed include: (1) Specifically setting the buffer locations including <code>Slash</code> and <code>NamePos</code>, (2) <code>token.File.AddLine</code> to add new lines at specific offsets, (3) Overallocating the source buffer so <code>token.File.Position</code> (used &quot;under the covers&quot;) and <code>token.File.AddLine</code> don&#39;t fail range checks against the source buffer.  But this introduces a bunch of serialization warnings/errors because of the mismatched size of the new tokens and the underlying buffer size."}], "answers": [{"comments": [{"owner": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "edited": false, "score": 0, "creation_date": 1442925461, "post_id": 32716372, "comment_id": 53276429, "body": "I think you&#39;ve cracked it! Well done. I&#39;m sure I&#39;ll have follow up questions as I add more functionality, but this is a great answer. Thanks!"}, {"owner": {"reputation": 674, "user_id": 1748843, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/778eb7874ab7a1400d0213a7abdaab4f?s=128&d=identicon&r=PG", "display_name": "execjosh", "link": "https://stackoverflow.com/users/1748843/execjosh"}, "edited": false, "score": 0, "creation_date": 1559404056, "post_id": 32716372, "comment_id": 99413459, "body": "This only works for this particular situation.  If there were more code with newlines after the <code>B</code> struct than the length of the newly added fields and comments, then the calls to <code>AddLine</code> would be ignored (<a href=\"https://github.com/golang/go/blame/go1.12.5/src/go/token/position.go#L137\" rel=\"nofollow noreferrer\">the impl.</a> has not changed for the last nine years).  See: <a href=\"https://play.golang.org/p/NsBL74Z5bb7\" rel=\"nofollow noreferrer\">play.golang.org/p/NsBL74Z5bb7</a>  Additionally, adding comments at the bottom of the &quot;file&quot; make things go haywire...  See: <a href=\"https://play.golang.org/p/g2vKIPm1OUx\" rel=\"nofollow noreferrer\">play.golang.org/p/g2vKIPm1OUx</a>"}], "tags": [], "owner": {"reputation": 3457, "user_id": 3108853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/db3d997e8c35cb14623d4dc4de494801?s=128&d=identicon&r=PG&f=1", "display_name": "lsowen", "link": "https://stackoverflow.com/users/3108853/lsowen"}, "is_accepted": false, "score": 6, "last_activity_date": 1442923280, "creation_date": 1442923280, "answer_id": 32716372, "question_id": 31628613, "link": "https://stackoverflow.com/questions/31628613/comments-out-of-order-after-adding-item-to-go-ast/32716372#32716372", "title": "Comments out of order after adding item to Go AST", "body": "<p>I believe I have gotten it to work.  As stated in my comment above, the main points required are:</p>\n\n<ol>\n<li>Specifically set the buffer locations including the <code>Slash</code> and <code>NamePos</code></li>\n<li>Use <code>token.File.AddLine</code> to add new lines at specific offsets (calculated using the positions from item 1)</li>\n<li>Overallocate the source buffer so <code>token.File.Position</code> (used by <code>printer.Printer</code> and <code>token.File.Addline</code> don't fail range checks on the source buffer</li>\n</ol>\n\n<p>Code:  </p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"go/ast\"\n    \"go/parser\"\n    \"go/printer\"\n    \"go/token\"\n    \"testing\"\n)\n\nfunc main() {\n    tests := []testing.InternalTest{{\"TestAst\", TestAst}}\n    matchAll := func(t string, pat string) (bool, error) { return true, nil }\n    testing.Main(matchAll, tests, nil, nil)\n}\n\nfunc TestAst(t *testing.T) {\n\n    source := `package a\n\n// B comment\ntype B struct {\n    // C comment\n    C string\n}`\n\n    buffer := make([]byte, 1024, 1024)\n    for idx,_ := range buffer {\n        buffer[idx] = 0x20\n    }\n    copy(buffer[:], source)\n    fset := token.NewFileSet()\n    file, err := parser.ParseFile(fset, \"\", buffer, parser.ParseComments)\n    if err != nil {\n        t.Error(err)\n    }\n\n    v := &amp;visitor{\n        file: file,\n        fset: fset,\n    }\n    ast.Walk(v, file)\n\n    var output []byte\n    buf := bytes.NewBuffer(output)\n    if err := printer.Fprint(buf, fset, file); err != nil {\n        t.Error(err)\n    }\n\n    expected := `package a\n\n// B comment\ntype B struct {\n    // C comment\n    C   string\n    // D comment\n    D   int\n    // E comment\n    E   float64\n}\n`\n    if buf.String() != expected {\n        t.Error(fmt.Sprintf(\"Test failed. Expected:\\n%s\\nGot:\\n%s\", expected, buf.String()))\n    }\n\n}\n\ntype visitor struct {\n    file *ast.File\n    fset *token.FileSet\n}\n\nfunc (v *visitor) Visit(node ast.Node) (w ast.Visitor) {\n\n    if node == nil {\n        return v\n    }\n\n    switch n := node.(type) {\n    case *ast.GenDecl:\n        if n.Tok != token.TYPE {\n            break\n        }\n        ts := n.Specs[0].(*ast.TypeSpec)\n        if ts.Name.Name == \"B\" {\n            fields := ts.Type.(*ast.StructType).Fields\n            addStructField(v.fset, fields, v.file, \"int\", \"D\", \"D comment\")\n            addStructField(v.fset, fields, v.file, \"float64\", \"E\", \"E comment\")\n        }\n    }\n\n    return v\n}\n\nfunc addStructField(fset *token.FileSet, fields *ast.FieldList, file *ast.File, typ string, name string, comment string) {\n    prevField := fields.List[fields.NumFields()-1] \n\n    c := &amp;ast.Comment{Text: fmt.Sprint(\"// \", comment), Slash: prevField.End() + 1}\n    cg := &amp;ast.CommentGroup{List: []*ast.Comment{c}}\n    o := ast.NewObj(ast.Var, name)\n    f := &amp;ast.Field{\n        Doc:   cg,\n        Names: []*ast.Ident{&amp;ast.Ident{Name: name, Obj: o, NamePos: cg.End() + 1}},\n    }\n    o.Decl = f\n    f.Type = &amp;ast.Ident{Name: typ, NamePos: f.Names[0].End() + 1}\n\n    fset.File(c.End()).AddLine(int(c.End()))\n    fset.File(f.End()).AddLine(int(f.End()))\n\n    fields.List = append(fields.List, f)\n    file.Comments = append(file.Comments, cg)\n}\n</code></pre>\n\n<p>Example: <a href=\"http://play.golang.org/p/_q1xh3giHm\" rel=\"noreferrer\">http://play.golang.org/p/_q1xh3giHm</a></p>\n\n<p>For <em>Item (3)</em>, it is also important to set all the overallocated bytes to spaces (<code>0x20</code>), so that the printer doesn't complain about null bytes when processing them.</p>\n"}, {"comments": [{"owner": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "edited": false, "score": 1, "creation_date": 1589579416, "post_id": 61825444, "comment_id": 109360637, "body": "Yes! I asked this question and eventually got so annoyed with there not being an easy solution I created the <code>dst</code> package. I&#39;ll accept this answer!"}, {"owner": {"reputation": 999, "user_id": 3018289, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0ccf487e8c5bcd5ff8969cff10963e81?s=128&d=identicon&r=PG", "display_name": "Arithran", "link": "https://stackoverflow.com/users/3018289/arithran"}, "reply_to_user": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "edited": false, "score": 0, "creation_date": 1589747509, "post_id": 61825444, "comment_id": 109410221, "body": "Haha, I should have realized that Dave was your GitHub handle."}], "tags": [], "owner": {"reputation": 999, "user_id": 3018289, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0ccf487e8c5bcd5ff8969cff10963e81?s=128&d=identicon&r=PG", "display_name": "Arithran", "link": "https://stackoverflow.com/users/3018289/arithran"}, "is_accepted": true, "score": 1, "last_activity_date": 1589565126, "creation_date": 1589565126, "answer_id": 61825444, "question_id": 31628613, "link": "https://stackoverflow.com/questions/31628613/comments-out-of-order-after-adding-item-to-go-ast/61825444#61825444", "title": "Comments out of order after adding item to Go AST", "body": "<p>I know that this answer might be a little late. But for the benefit of others, I found a reference to this library in the following GitHub issue</p>\n\n<p><a href=\"https://github.com/golang/go/issues/20744\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/20744</a></p>\n\n<p>The library is called <strong>dst</strong> and it can convert a go <strong>ast</strong> to <strong>dst</strong> and vice versa.</p>\n\n<p><a href=\"https://github.com/dave/dst\" rel=\"nofollow noreferrer\">https://github.com/dave/dst</a></p>\n\n<p>In <strong>ast</strong>, Comments are stored by their byte offset instead of attached to nodes. <strong>Dst</strong> solves this by attaching the comments to its respective nodes so that re-arranging nodes doesn't break the output/tree.</p>\n\n<p>The library works as advertized and I haven't found any issues so far.</p>\n\n<p>Note: There is also a subpackage called <strong>dst/dstutil</strong> which is compatible with <strong>golang.org/x/tools/go/ast/astutil</strong></p>\n"}], "owner": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1408, "favorite_count": 5, "accepted_answer_id": 61825444, "answer_count": 2, "score": 23, "last_activity_date": 1589565126, "creation_date": 1437841521, "question_id": 31628613, "link": "https://stackoverflow.com/questions/31628613/comments-out-of-order-after-adding-item-to-go-ast", "title": "Comments out of order after adding item to Go AST", "body": "<p>The following test attempts to use AST to add fields to a struct. The fields are added correctly, but the comments are added out of order. I gather the position may need to be specified manually, but I've so far drawn a blank finding an answer.</p>\n\n<p>Here's a failing test: <a href=\"http://play.golang.org/p/RID4N30FZK\">http://play.golang.org/p/RID4N30FZK</a></p>\n\n<p>Here's the code:</p>\n\n<pre><code>package generator\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"go/ast\"\n    \"go/parser\"\n    \"go/printer\"\n    \"go/token\"\n    \"testing\"\n)\n\nfunc TestAst(t *testing.T) {\n\n    source := `package a\n\n// B comment\ntype B struct {\n    // C comment\n    C string\n}`\n\n    fset := token.NewFileSet()\n    file, err := parser.ParseFile(fset, \"\", []byte(source), parser.ParseComments)\n    if err != nil {\n        t.Error(err)\n    }\n\n    v := &amp;visitor{\n        file: file,\n    }\n    ast.Walk(v, file)\n\n    var output []byte\n    buf := bytes.NewBuffer(output)\n    if err := printer.Fprint(buf, fset, file); err != nil {\n        t.Error(err)\n    }\n\n    expected := `package a\n\n// B comment\ntype B struct {\n    // C comment\n    C string\n    // D comment\n    D int\n    // E comment\n    E float64\n}\n`\n\n    if buf.String() != expected {\n        t.Error(fmt.Sprintf(\"Test failed. Expected:\\n%s\\nGot:\\n%s\", expected, buf.String()))\n    }\n\n    /*\n    actual output = `package a\n\n// B comment\ntype B struct {\n    // C comment\n    // D comment\n    // E comment\n    C   string\n    D   int\n    E   float64\n}\n`\n    */\n\n}\n\ntype visitor struct {\n    file *ast.File\n}\n\nfunc (v *visitor) Visit(node ast.Node) (w ast.Visitor) {\n\n    if node == nil {\n        return v\n    }\n\n    switch n := node.(type) {\n    case *ast.GenDecl:\n        if n.Tok != token.TYPE {\n            break\n        }\n        ts := n.Specs[0].(*ast.TypeSpec)\n        if ts.Name.Name == \"B\" {\n            fields := ts.Type.(*ast.StructType).Fields\n            addStructField(fields, v.file, \"int\", \"D\", \"D comment\")\n            addStructField(fields, v.file, \"float64\", \"E\", \"E comment\")\n        }\n    }\n\n    return v\n}\n\nfunc addStructField(fields *ast.FieldList, file *ast.File, typ string, name string, comment string) {\n    c := &amp;ast.Comment{Text: fmt.Sprint(\"// \", comment)}\n    cg := &amp;ast.CommentGroup{List: []*ast.Comment{c}}\n    f := &amp;ast.Field{\n        Doc:   cg,\n        Names: []*ast.Ident{ast.NewIdent(name)},\n        Type:  ast.NewIdent(typ),\n    }\n    fields.List = append(fields.List, f)\n    file.Comments = append(file.Comments, cg)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 1, "creation_date": 1437838345, "post_id": 31628099, "comment_id": 51203543, "body": "<code>a := b</code> ? What do you mean by deep copying a struct? Deep copy pointers in the struct?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1437838553, "post_id": 31628099, "comment_id": 51203608, "body": "The standard library does not contain deep copy functionality because there are many variations on how an application might to do it.  Also, it&#39;s not difficult for an application to implement a specific copy function.  What is it that you want t copy?"}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 1, "last_activity_date": 1438113198, "last_edit_date": 1438113198, "creation_date": 1437839445, "answer_id": 31628306, "question_id": 31628099, "link": "https://stackoverflow.com/questions/31628099/make-a-copy-of-a-struct/31628306#31628306", "title": "Make a copy of a struct", "body": "<p>A more recent version of the google deepcopy code can be found in <a href=\"https://github.com/margnus1/go-deepcopy\" rel=\"nofollow\"><code>margnus1/go-deepcopy</code></a>.</p>\n\n<p>It does illustrate why there is no deepcopy in the standard library.</p>\n\n<pre><code>// basic copy algorithm:\n// 1) recursively scan object, building up a list of all allocated\n// memory ranges pointed to by the object.\n// 2) recursively copy object, making sure that references\n// within the data structure point to the appropriate\n// places in the newly allocated data structure.\n</code></pre>\n\n<p>The all algo is quite convoluted and rely on reflection. And of course only access exported field.</p>\n\n<pre><code>// Copy makes a recursive deep copy of obj and returns the result.\n//\n// Pointer equality between items within obj is preserved,\n// as are the relationships between slices that point to the same underlying data,\n// although the data itself will be copied.\n// a := Copy(b) implies reflect.DeepEqual(a, b).\n// Map keys are not copied, as reflect.DeepEqual does not\n// recurse into map keys.\n// Due to restrictions in the reflect package, only\n// types with all public members may be copied.\n//\nfunc Copy(obj interface{}) (r interface{}) {\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p>I'm sure this is a scenario that people much require from time-to-time so I must be missing something</p>\n</blockquote>\n\n<p>As <a href=\"https://groups.google.com/forum/#!searchin/golang-nuts/deepcopy/golang-nuts/3nT8RrVA6a4/Ph18EWFa6lAJ\" rel=\"nofollow\">mentioned in this thread</a>:</p>\n\n<blockquote>\n  <p>Passing struct values as opposed to struct pointers, for example, is generally good enough. If the programmer is good enough to effectively design tree or graph structures, then they can probably anticipate problems with sharing such a structure.<br>\n  Many of us consider the absence of mandatory deep-copy behavior to a feature, since we want Go to provide tools to aid safety, not obstacles to efficiency. </p>\n</blockquote>\n\n<hr>\n\n<p>A more recent and polished version of deepcopy is <a href=\"https://github.com/ulule/deepcopier\" rel=\"nofollow\"><strong><code>ulule/deepcopier</code></strong></a></p>\n\n<pre><code>// Deep copy instance1 into instance2\nCopy(instance1).To(instance2)\n</code></pre>\n"}], "owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 833, "favorite_count": 1, "accepted_answer_id": 31628306, "answer_count": 1, "score": 1, "last_activity_date": 1438113198, "creation_date": 1437838210, "question_id": 31628099, "link": "https://stackoverflow.com/questions/31628099/make-a-copy-of-a-struct", "title": "Make a copy of a struct", "body": "<p>I am attempting to make a deep copy of a struct in go. Before going and building a solution myself, I attempted to find the idiomatic way to do so in go. I did find reference to <a href=\"https://godoc.org/code.google.com/p/rog-go/exp/deepcopy\" rel=\"nofollow\">this</a> implementation. However, it appears to be well out of date and not actively maintained. I'm sure this is a scenario that people much require from time-to-time so I must be missing something. Does anybody have any guidance?</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1437842941, "post_id": 31625512, "comment_id": 51204984, "body": "Anyone curious about &quot;adjust[ing] UnmarshalJSON to your needs&quot; may want to see the <a href=\"http://stackoverflow.com/a/31595318/55504\">answer comment</a> and <a href=\"https://play.golang.org/p/KNPxDL1yqL\" rel=\"nofollow noreferrer\">playground code</a> that (I think) inspired this Q&amp;A."}, {"owner": {"reputation": 4081, "user_id": 242684, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d73353bb2ecd4cd2a2bbeefe30116a7e?s=128&d=identicon&r=PG", "display_name": "Alec Mev", "link": "https://stackoverflow.com/users/242684/alec-mev"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1495362673, "post_id": 31625512, "comment_id": 75212395, "body": "@DaveC Credited you in the answer. Pardon me for not doing so initially, don&#39;t know what I was thinking."}], "tags": [], "owner": {"reputation": 4081, "user_id": 242684, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d73353bb2ecd4cd2a2bbeefe30116a7e?s=128&d=identicon&r=PG", "display_name": "Alec Mev", "link": "https://stackoverflow.com/users/242684/alec-mev"}, "is_accepted": true, "score": 6, "last_activity_date": 1495362389, "last_edit_date": 1495540510, "creation_date": 1437820246, "answer_id": 31625512, "question_id": 31625511, "link": "https://stackoverflow.com/questions/31625511/how-to-parse-both-plain-and-enquoted-json-numbers-in-go/31625512#31625512", "title": "How to parse both plain and enquoted JSON numbers in Go?", "body": "<p>The proper solution is to \"clone\" float64 and define custom <code>MarshalJSON</code> and <code>UnmarshalJSON</code> for it:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type jsonFloat64 float64\n\nfunc (f jsonFloat64) MarshalJSON() ([]byte, error) {\n  return json.Marshal(float64(f))\n}\n\nfunc (f *jsonFloat64) UnmarshalJSON(data []byte) error {\n  if len(data) &gt;= 2 &amp;&amp; data[0] == '\"' &amp;&amp; data[len(data)-1] == '\"' {\n    data = data[1 : len(data)-1]\n  }\n\n  var tmp float64\n  err := json.Unmarshal(data, &amp;tmp)\n  if err != nil {\n    return err\n  }\n\n  *f = jsonFloat64(tmp)\n  return nil\n}\n</code></pre>\n\n<p>Then you'd be able to do something like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func test(s string) {\n  err := json.Unmarshal([]byte(s), &amp;struct {\n    F jsonFloat64\n  }{})\n  if err != nil {\n    fmt.Println(err)\n    return\n  }\n\n  fmt.Println(\"success\")\n}\n\nfunc main() {\n  test(`{\"f\": 1.23}`)   // success\n  test(`{\"f\": \"1.23\"}`) // success\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/czaVZuQYM4\" rel=\"nofollow noreferrer\">The Go Playground</a></p>\n\n<p>Feel free to adjust <code>UnmarshalJSON</code> to your needs, mine is pretty strict about the spacing. Credit goes to <a href=\"https://stackoverflow.com/users/55504/dave-c\">Dave C</a>, this was heavily inspired by <a href=\"https://stackoverflow.com/questions/29213974/using-json-string-returning-invalid-use-of-string-struct-tag-trying-to-un/31595318#comment51144192_31595318\">his comment on another question</a> (which also features <a href=\"https://play.golang.org/p/KNPxDL1yqL\" rel=\"nofollow noreferrer\">more variations</a> on the solution above).</p>\n\n<p>Alternatively, you could pre-process the JSON data with a regular expression, but don't do this if the solution above is a viable option, it's much faster.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>re := regexp.MustCompile(`(\":\\s*)([\\d\\.]+)(\\s*[,}])`)\nrawJsonByteArray = re.ReplaceAll(rawJsonByteArray, []byte(`$1\"$2\"$3`))\n</code></pre>\n"}], "owner": {"reputation": 4081, "user_id": 242684, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/d73353bb2ecd4cd2a2bbeefe30116a7e?s=128&d=identicon&r=PG", "display_name": "Alec Mev", "link": "https://stackoverflow.com/users/242684/alec-mev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 522, "favorite_count": 0, "accepted_answer_id": 31625512, "answer_count": 1, "score": 2, "last_activity_date": 1495362389, "creation_date": 1437820246, "question_id": 31625511, "link": "https://stackoverflow.com/questions/31625511/how-to-parse-both-plain-and-enquoted-json-numbers-in-go", "title": "How to parse both plain and enquoted JSON numbers in Go?", "body": "<p>I'm dealing with a third-party JSON-based API. Usually it wraps all numbers in quotes, but sometimes it doesn't. Nothing I can do about it.</p>\n\n<p>I'm trying to come up with a solution, which parses the numbers regardless of whether they're enquoted or not. Standard library provides a <code>,string</code> field tag, which allows to map numeric fields to enquoted values, but, unfortunately, it then fails to process the value, if it's not in quotes.</p>\n\n<pre><code>func test(s string) {\n  err := json.Unmarshal([]byte(s), &amp;struct {\n    F1 float64\n    F2 float64 `json:\",string\"`\n  }{})\n  if err != nil {\n    fmt.Println(err)\n    return\n  }\n\n  fmt.Println(\"success\")\n}\n\nfunc main() {\n  test(`{\"f1\": 1.23}`)   // success\n  test(`{\"f1\": \"1.23\"}`) // cannot unmarshal string into Go value of type float64\n  test(`{\"f2\": 1.23}`)   // invalid use of ,string struct tag, trying to unmarshal unquoted value into ...\n  test(`{\"f2\": \"1.23\"}`) // success\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/B-hYud9vcW\" rel=\"nofollow\">The Go Playground</a></p>\n\n<p>Is there a way around this?</p>\n"}, {"tags": ["google-app-engine", "debugging", "go", "gdb", "liteide"], "owner": {"reputation": 156, "user_id": 3112976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d1c579cb827b14b78fd820d8bc512e4?s=128&d=identicon&r=PG&f=1", "display_name": "Orbittman", "link": "https://stackoverflow.com/users/3112976/orbittman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 233, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1437819589, "creation_date": 1437819589, "question_id": 31625439, "link": "https://stackoverflow.com/questions/31625439/debugging-golang-running-under-appengine-in-liteide", "title": "Debugging golang running under AppEngine in Liteide", "body": "<p>I'm writing a little API using go and Google AppEngine. All of this is in Liteide and TBH after a little pain setting up, is now working beautifully well. I've got to the point where I need to start debugging in GDB, this is all signed and Liteide is picking this up. There is however a problem that I can't overcome and that is getting GDB to load the symbols for the application. The following is an excerpt from the console:</p>\n\n<pre><code>&amp;\"Warning: /usr/local/go/src/pkg/runtime: No such file or directory.\\n\"\n10000008^done,source-path=\"/usr/local/go/src/pkg/runtime:$cdir:$cwd\"\n(gdb) \n&amp;\"set substitute-path /go/src/pkg/runtime /usr/local/go/src/pkg/runtime\\n\"\n10000009^done\n(gdb) \n10000010^error,msg=\"No symbol table is loaded.  Use the \\\"file\\\" command.\"\n(gdb) \n10000011^error,msg=\"No symbol table is loaded.  Use the \\\"file\\\" command.\"\n(gdb) \n10000012^error,msg=\"No symbol table is loaded.  Use the \\\"file\\\" command.\"\n(gdb) \n10000013^error,msg=\"No executable file specified.\\nUse the \\\"file\\\" or \\\"exec-      file\\\" command.\"\n(gdb) \n</code></pre>\n\n<p>It seems that GDB is looking in the wrong place for the runtime but then possibly substituting this for the correct path? I'm running AppEngine from</p>\n\n<pre><code>\"/Applications/go_appengine 2/dev_appserver.py\"\n</code></pre>\n\n<p>and I have a suspicion that I need to tell GDB to debug a particular process but I'm not sure what and where so configure that. Doe anyone have any experience of how to set this up or where I might be going wrong?</p>\n"}, {"tags": ["function", "struct", "go"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1437792242, "post_id": 31622282, "comment_id": 51193340, "body": "I wonder if that error is really coming from elsewhere in your code, not that snippet -- <code>release</code> sure looks like it should be a <a href=\"http://godoc.org/github.com/google/go-github/github#RepositoryTag\" rel=\"nofollow noreferrer\">RepositoryTag</a> there, not a string. (<a href=\"http://godoc.org/github.com/google/go-github/github\" rel=\"nofollow noreferrer\">This</a> is the library I&#39;m reasonably sure you&#39;re using.)"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 5, "creation_date": 1437792423, "post_id": 31622282, "comment_id": 51193368, "body": "re: &quot;I don&#39;t understand how returning works in this case (very new to Go),&quot; early on in your Go trek it may be worth some working through <a href=\"http://tour.golang.org/\" rel=\"nofollow noreferrer\">the Tour</a> or <a href=\"http://golang.org/ref/spec#Return_statements\" rel=\"nofollow noreferrer\">searching the spec for <code>return</code>-related stuff</a> or even poking through some code that interests you in the stdlib or on GitHub."}, {"owner": {"reputation": 2467, "user_id": 926190, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/098f89dd510cdc23243f3c19902a2af8?s=128&d=identicon&r=PG&f=1", "display_name": "jmreicha", "link": "https://stackoverflow.com/users/926190/jmreicha"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1437795572, "post_id": 31622282, "comment_id": 51193875, "body": "@twotwotwo the snippet posted is working, I get errors when I try returning.  Would it be helpful to post another snippet that produces the error?  Part of my confusion is that I don&#39;t understand how to return RepositoryTag, so I started out with string since I only want the Name value but am stuck."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1437798564, "post_id": 31622282, "comment_id": 51194303, "body": "if release.Name work, *realease.Name never cause &#39;release.Name undefined&#39;"}, {"owner": {"reputation": 2467, "user_id": 926190, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/098f89dd510cdc23243f3c19902a2af8?s=128&d=identicon&r=PG&f=1", "display_name": "jmreicha", "link": "https://stackoverflow.com/users/926190/jmreicha"}, "edited": false, "score": 0, "creation_date": 1437800107, "post_id": 31622282, "comment_id": 51194537, "body": "Post updated to include the github package along with the code that isn&#39;t working."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 4, "creation_date": 1437803374, "post_id": 31622282, "comment_id": 51195138, "body": "Hmm, the line <code>release := releases[0]</code> is actually just declaring a variable <i>inside that <code>else</code> block</i>. You&#39;re accessing something else called <code>releases</code> (a variable declared elsewhere in the function or a package global) in the <code>return</code> statement. <a href=\"http://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow noreferrer\">The spec says</a> (in item 5 in the numbered list, in spec-like language) that variable declarations are only in scope until the end of the block, which differs from, say, how Python does it."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1437803474, "post_id": 31622282, "comment_id": 51195153, "body": "Returning a <code>*RepositoryTag</code> is like returning a <code>string</code>; the only gotcha is you always prefix identifiers from other packages with the package name in Go, so you need to say <code>*github.RepositoryTag</code> not just <code>*RepositoryTag</code>."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1437817102, "post_id": 31622282, "comment_id": 51197997, "body": "@twotwotwo  so it seems nothing about golang, haha"}], "answers": [{"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1437824904, "post_id": 31624022, "comment_id": 51199839, "body": "An even more idiomatic approach is to move the call to ListTags to its own statement and the else block to the top-level of the function.  The if statement because <code>if err != nil { return &quot;&quot;, err }</code>.  <a href=\"https://github.com/golang/lint\" rel=\"nofollow noreferrer\">Golint</a> will complain about the code as written."}, {"owner": {"reputation": 2467, "user_id": 926190, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/098f89dd510cdc23243f3c19902a2af8?s=128&d=identicon&r=PG&f=1", "display_name": "jmreicha", "link": "https://stackoverflow.com/users/926190/jmreicha"}, "edited": false, "score": 0, "creation_date": 1437854462, "post_id": 31624022, "comment_id": 51208329, "body": "This works.  I am still not sure how to do determine <code>github.RepositoryTag</code> variable.     I&#39;m sure it is obvious to others but I don&#39;t have a lot of experience so it is a little confusing to me still."}, {"owner": {"reputation": 23064, "user_id": 3177124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/65014fdf3cfd04b1452620aeb54dcede?s=128&d=identicon&r=PG&f=1", "display_name": "abligh", "link": "https://stackoverflow.com/users/3177124/abligh"}, "edited": false, "score": 0, "creation_date": 1437860619, "post_id": 31624022, "comment_id": 51210069, "body": "What do you mean by <i>&#39;determine&#39;</i>? If you mean &#39;declare&#39;, you don&#39;t need to do so explicitly. The <code>:=</code> operator will give the variable the same type as the function returns."}, {"owner": {"reputation": 2467, "user_id": 926190, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/098f89dd510cdc23243f3c19902a2af8?s=128&d=identicon&r=PG&f=1", "display_name": "jmreicha", "link": "https://stackoverflow.com/users/926190/jmreicha"}, "edited": false, "score": 0, "creation_date": 1437925464, "post_id": 31624022, "comment_id": 51224191, "body": "@abligh Why is the release variable declared as <code>github.RepositoryTag</code> rather than a string?  If I don&#39;t know what type of variable to use, what is an easy way to find out?"}, {"owner": {"reputation": 23064, "user_id": 3177124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/65014fdf3cfd04b1452620aeb54dcede?s=128&d=identicon&r=PG&f=1", "display_name": "abligh", "link": "https://stackoverflow.com/users/3177124/abligh"}, "reply_to_user": {"reputation": 2467, "user_id": 926190, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/098f89dd510cdc23243f3c19902a2af8?s=128&d=identicon&r=PG&f=1", "display_name": "jmreicha", "link": "https://stackoverflow.com/users/926190/jmreicha"}, "edited": false, "score": 0, "creation_date": 1437928267, "post_id": 31624022, "comment_id": 51225096, "body": "@jmreicha because it contains more than just the name: <a href=\"https://gowalker.org/github.com/google/go-github/github#RepositoryTag\" rel=\"nofollow noreferrer\">gowalker.org/github.com/google/go-github/github#RepositoryTa&zwnj;&#8203;g</a>"}], "tags": [], "owner": {"reputation": 23064, "user_id": 3177124, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/65014fdf3cfd04b1452620aeb54dcede?s=128&d=identicon&r=PG&f=1", "display_name": "abligh", "link": "https://stackoverflow.com/users/3177124/abligh"}, "is_accepted": true, "score": 1, "last_activity_date": 1437809212, "last_edit_date": 1437809212, "creation_date": 1437808868, "answer_id": 31624022, "question_id": 31622282, "link": "https://stackoverflow.com/questions/31622282/access-values-of-go-struct-in-external-function/31624022#31624022", "title": "Access values of Go struct in external function", "body": "<p>One problem is here:</p>\n\n<pre><code>var release string\n...\nif err != nil {\n...\n} else {\n    release := releases[0]  // &lt;-- here\n}\n</code></pre>\n\n<p>At the line indicated you define a <em>new</em> variable called <code>release</code> equal to <code>releases[0]</code> which is scoped only to the <code>else</code> clause (use of <code>:=</code>). That then goes out of scope immediately. I'm surprised you don't get an unused variable warning. Looks like you also need to change the type of <code>release</code> to <code>github.RepositoryTag</code>. Try:</p>\n\n<pre><code>var release github.RepositoryTag\n...\nif err != nil {\n...\n} else {\n    release = releases[0]  // note equals sign\n}\n</code></pre>\n\n<p>However a more idiomatic way to do this would be something like (untested):</p>\n\n<pre><code>func LatestTag(user, project string) (string, error) {\n    client := github.NewClient(nil)\n    if releases, _, err := client.Repositories.ListTags(user, project, nil); err != nil {\n        return \"\", err\n    } else {\n        release := releases[0]\n        return *release.Name, nil\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 2467, "user_id": 926190, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/098f89dd510cdc23243f3c19902a2af8?s=128&d=identicon&r=PG&f=1", "display_name": "jmreicha", "link": "https://stackoverflow.com/users/926190/jmreicha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 31624022, "answer_count": 1, "score": 0, "last_activity_date": 1437809212, "creation_date": 1437791541, "last_edit_date": 1437800016, "question_id": 31622282, "link": "https://stackoverflow.com/questions/31622282/access-values-of-go-struct-in-external-function", "title": "Access values of Go struct in external function", "body": "<p>I have the following function declararion, which works and prints out correctly.</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"github.com/google/go-github/github\"\n)\n\nfunc LatestTag(user, project string) {\n\n    client := github.NewClient(nil)\n    releases, _, err := client.Repositories.ListTags(user, project, nil)\n\n    if err != nil {\n        fmt.Printf(\"error: %v\\n\", err)\n    } else {\n        release := releases[0]\n        fmt.Printf(\"Version: %+v\\n\", *release.Name)\n    }\n\n}\n</code></pre>\n\n<p><strong>EDIT</strong></p>\n\n<p>I have modified the function to return a string (I don't think this is right) but hopefully it can help shed some light on what I am trying to do.</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"github.com/google/go-github/github\"\n)\n\nfunc LatestTag(user, project string) string {\n\n    client := github.NewClient(nil)\n    releases, _, err := client.Repositories.ListTags(user, project, nil)\n    var release string\n\n    if err != nil {\n        fmt.Printf(\"error: %v\\n\", err)\n    } else {\n        release := releases[0]\n    }\n    return *release.Name\n}\n</code></pre>\n\n<p>I would like to return the value of <code>*release.Name</code> rather than just print it out so that I can access the value from another function but I don't understand how returning works in this case (very new to Go).</p>\n\n<p>I was thinking I could just return the struct as a string but get errors when I run it.</p>\n\n<pre><code>release.Name undefined (type string has no field or method Name)\n</code></pre>\n\n<p>Which makes me think that I'm not approaching this correctly.  Can somebody point me in the right direction?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1437791297, "post_id": 31622052, "comment_id": 51193198, "body": "<a href=\"https://github.com/unrolled/render\" rel=\"nofollow noreferrer\">github.com/unrolled/render</a> may also help."}], "answers": [{"comments": [{"owner": {"reputation": 334, "user_id": 1790331, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4abf8725c4031765d7aa46b5bf83dfca?s=128&d=identicon&r=PG", "display_name": "Jaybeecave", "link": "https://stackoverflow.com/users/1790331/jaybeecave"}, "edited": false, "score": 13, "creation_date": 1493513299, "post_id": 31622112, "comment_id": 74448598, "body": "While <code>w.Header().Set(&quot;Content-Type&quot;, &quot;application&#47;json&quot;)</code> is correct for setting the content type, it doesn&#39;t when using <code>json.NewEncoder</code> instead i get a txt/plain result. Is anyone else getting this. The answer from @poorva worked as expected"}, {"owner": {"reputation": 334, "user_id": 1790331, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4abf8725c4031765d7aa46b5bf83dfca?s=128&d=identicon&r=PG", "display_name": "Jaybeecave", "link": "https://stackoverflow.com/users/1790331/jaybeecave"}, "edited": false, "score": 2, "creation_date": 1493513401, "post_id": 31622112, "comment_id": 74448622, "body": "Scratch that. If i use <code>w.WriteHeader(http.StatusOk) </code> I get the above result."}, {"owner": {"reputation": 145, "user_id": 5580311, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-clkYgyz3f0U/AAAAAAAAAAI/AAAAAAAAAEc/BrJiRQ6I-1s/photo.jpg?sz=128", "display_name": "Ramon Rambo", "link": "https://stackoverflow.com/users/5580311/ramon-rambo"}, "edited": false, "score": 4, "creation_date": 1505510339, "post_id": 31622112, "comment_id": 79459429, "body": "If I use <code>w.WriteHeader(http.StatusOk)</code> then I get <code>text&#47;plain; charset=utf-8</code>, if I dont set the Status-Code explicitly I get <code>applicaton&#47;json</code> and the Response has still a Status-Code 200."}, {"owner": {"reputation": 26894, "user_id": 19020, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/VpVEj.jpg?s=128&g=1", "display_name": "Dan Esparza", "link": "https://stackoverflow.com/users/19020/dan-esparza"}, "edited": false, "score": 3, "creation_date": 1511034224, "post_id": 31622112, "comment_id": 81693111, "body": "Hmmm ... could it have to do with the docs <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow noreferrer\">here</a>?  <code>Changing the header map after a call to WriteHeader (or Write) has no effect unless the modified headers are trailers.</code>"}, {"owner": {"reputation": 325, "user_id": 4154982, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ylnD1Q83Noo/AAAAAAAAAAI/AAAAAAAACWk/lud3LVIG-oI/photo.jpg?sz=128", "display_name": "Ardi Nusawan", "link": "https://stackoverflow.com/users/4154982/ardi-nusawan"}, "edited": false, "score": 2, "creation_date": 1520501442, "post_id": 31622112, "comment_id": 85344444, "body": "Adding <code>w.Header().Set(&quot;Content-Type&quot;, &quot;application&#47;json&quot;)</code> above <code>json.NewEncoder(w).Encode(p)</code> work for me"}, {"owner": {"reputation": 225, "user_id": 4321151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H3dyj.jpg?s=128&g=1", "display_name": "Gokul Raj Kumar", "link": "https://stackoverflow.com/users/4321151/gokul-raj-kumar"}, "reply_to_user": {"reputation": 145, "user_id": 5580311, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-clkYgyz3f0U/AAAAAAAAAAI/AAAAAAAAAEc/BrJiRQ6I-1s/photo.jpg?sz=128", "display_name": "Ramon Rambo", "link": "https://stackoverflow.com/users/5580311/ramon-rambo"}, "edited": false, "score": 0, "creation_date": 1535640609, "post_id": 31622112, "comment_id": 91150461, "body": "@RamonRambo adding w.Header().Set(&quot;Content-Type&quot;, &quot;application/json&quot;) above w.WriteHeader(http.StatusOk) worked for me."}, {"owner": {"reputation": 1122, "user_id": 4970650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/496526a825adf2e6587a19d3a6d391f7?s=128&d=identicon&r=PG", "display_name": "Cirelli94", "link": "https://stackoverflow.com/users/4970650/cirelli94"}, "edited": false, "score": 1, "creation_date": 1606902839, "post_id": 31622112, "comment_id": 115101209, "body": "The problem with this answer is... What if the Encode fails? Sadly, it can happen, for example if a float64 value is NaN! It will return a 200 without body, and you&#39;ll find yourself yelling &quot;WHAT THE HELL&quot; to your code. We should check the response value, but in that case, we could not change the Header no more... a dog chasing its own tail... If you care about your sanity, please use @poorva response."}], "tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": true, "score": 141, "last_activity_date": 1590090958, "last_edit_date": 1590090958, "creation_date": 1437789763, "answer_id": 31622112, "question_id": 31622052, "link": "https://stackoverflow.com/questions/31622052/how-to-serve-up-a-json-response-using-go/31622112#31622112", "title": "How to serve up a JSON response using Go?", "body": "<p>You can set your content-type header so clients know to expect json</p>\n\n<pre><code>w.Header().Set(\"Content-Type\", \"application/json\")\n</code></pre>\n\n<p>Another way to marshal a struct to json is to build an encoder using the <code>http.ResponseWriter</code></p>\n\n<pre><code>// get a payload p := Payload{d}\njson.NewEncoder(w).Encode(p)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1896, "user_id": 620856, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dab9aef5a8e89410f98f310e31cfdc0e?s=128&d=identicon&r=PG", "display_name": "Jonno", "link": "https://stackoverflow.com/users/620856/jonno"}, "edited": false, "score": 2, "creation_date": 1488291566, "post_id": 37747602, "comment_id": 72159450, "body": "One important note about this version is that it uses a byte slice in <code>jData</code>, possibly unnecessarily. <code>Data</code> can be of arbitrary size, depending on the data being marshalled, so this could be a non-trivial memory waster.  After marshalling, we copy from memory to the <code>ResponseWriter</code> stream. The answer that uses json.NewEncoder() etc. would write the marshalled JSON straight into the <code>ResponseWriter</code> (into its stream ..)"}, {"owner": {"reputation": 356, "user_id": 3104032, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FCOUO.jpg?s=128&g=1", "display_name": "darkdefender27", "link": "https://stackoverflow.com/users/3104032/darkdefender27"}, "edited": false, "score": 1, "creation_date": 1506349519, "post_id": 37747602, "comment_id": 79772763, "body": "Worked for me! Faced the issue when &#39;w.WriteHeader(http.StatusCreated)&#39; was added before or after."}, {"owner": {"reputation": 648, "user_id": 3029614, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/0f600952e79c5c90e140e4cf7272b287?s=128&d=identicon&r=PG", "display_name": "andersfylling", "link": "https://stackoverflow.com/users/3029614/andersfylling"}, "edited": false, "score": 1, "creation_date": 1509493801, "post_id": 37747602, "comment_id": 81039616, "body": "No need to return after panic as this exits your program"}, {"owner": {"reputation": 6698, "user_id": 1758853, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cdbacfa38ad2771753630807afda86a8?s=128&d=identicon&r=PG", "display_name": "Jonathan Muller", "link": "https://stackoverflow.com/users/1758853/jonathan-muller"}, "edited": false, "score": 0, "creation_date": 1556502459, "post_id": 37747602, "comment_id": 98448405, "body": "At least this solution doesn&#39;t add the trailing \\n of the <code>Encoder.Encode()</code> function"}, {"owner": {"reputation": 1122, "user_id": 4970650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/496526a825adf2e6587a19d3a6d391f7?s=128&d=identicon&r=PG", "display_name": "Cirelli94", "link": "https://stackoverflow.com/users/4970650/cirelli94"}, "reply_to_user": {"reputation": 1896, "user_id": 620856, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dab9aef5a8e89410f98f310e31cfdc0e?s=128&d=identicon&r=PG", "display_name": "Jonno", "link": "https://stackoverflow.com/users/620856/jonno"}, "edited": false, "score": 0, "creation_date": 1606902330, "post_id": 37747602, "comment_id": 115100971, "body": "@Jonno you are right, but it&#39;s the only answer when you can check the encode goes well BEFORE writing the header, because once written it can be changed!"}, {"owner": {"reputation": 1122, "user_id": 4970650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/496526a825adf2e6587a19d3a6d391f7?s=128&d=identicon&r=PG", "display_name": "Cirelli94", "link": "https://stackoverflow.com/users/4970650/cirelli94"}, "edited": false, "score": 0, "creation_date": 1606902425, "post_id": 37747602, "comment_id": 115101018, "body": "This is the only safe answer!"}], "tags": [], "owner": {"reputation": 1425, "user_id": 2349141, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/jbWDl.jpg?s=128&g=1", "display_name": "poorva", "link": "https://stackoverflow.com/users/2349141/poorva"}, "is_accepted": false, "score": 35, "last_activity_date": 1535395105, "last_edit_date": 1535395105, "creation_date": 1465559528, "answer_id": 37747602, "question_id": 31622052, "link": "https://stackoverflow.com/questions/31622052/how-to-serve-up-a-json-response-using-go/37747602#37747602", "title": "How to serve up a JSON response using Go?", "body": "<p>You can do something like this in you <code>getJsonResponse</code> function -</p>\n\n<pre><code>jData, err := json.Marshal(Data)\nif err != nil {\n    // handle error\n}\nw.Header().Set(\"Content-Type\", \"application/json\")\nw.Write(jData)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 584, "user_id": 1615754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ac5897ab70b64550556beb6ea44af36?s=128&d=identicon&r=PG", "display_name": "Aleks Tkachenko", "link": "https://stackoverflow.com/users/1615754/aleks-tkachenko"}, "is_accepted": false, "score": 2, "last_activity_date": 1499291365, "creation_date": 1499291365, "answer_id": 44936549, "question_id": 31622052, "link": "https://stackoverflow.com/questions/31622052/how-to-serve-up-a-json-response-using-go/44936549#44936549", "title": "How to serve up a JSON response using Go?", "body": "<p>In gobuffalo.io framework I got it to work like this:</p>\n\n<pre><code>// say we are in some resource Show action\n// some code is omitted\nuser := &amp;models.User{}\nif c.Request().Header.Get(\"Content-type\") == \"application/json\" {\n    return c.Render(200, r.JSON(user))\n} else {\n    // Make user available inside the html template\n    c.Set(\"user\", user)\n    return c.Render(200, r.HTML(\"users/show.html\"))\n}\n</code></pre>\n\n<p>and then when I want to get JSON response for that resource I have to set \"Content-type\" to \"application/json\" and it works.</p>\n\n<p>I think Rails has more convenient way to handle multiple response types, I didn't see the same in gobuffalo so far.</p>\n"}, {"comments": [{"owner": {"reputation": 908, "user_id": 3649496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59c95010d46812ccabe7eea947a090ab?s=128&d=identicon&r=PG&f=1", "display_name": "infiniteLearner", "link": "https://stackoverflow.com/users/3649496/infinitelearner"}, "edited": false, "score": 0, "creation_date": 1589283298, "post_id": 46290179, "comment_id": 109225520, "body": "How to return response , if my program panics ? I tried using recover() , then returning from their but it didn&#39;t work out."}], "tags": [], "owner": {"reputation": 401, "user_id": 8629590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fce91692e8dd1eef5a0930b68d0519a1?s=128&d=identicon&r=PG&f=1", "display_name": "Daniel R.", "link": "https://stackoverflow.com/users/8629590/daniel-r"}, "is_accepted": false, "score": 40, "last_activity_date": 1527688160, "last_edit_date": 1527688160, "creation_date": 1505782535, "answer_id": 46290179, "question_id": 31622052, "link": "https://stackoverflow.com/questions/31622052/how-to-serve-up-a-json-response-using-go/46290179#46290179", "title": "How to serve up a JSON response using Go?", "body": "<p>Other users commenting that the <code>Content-Type</code> is <code>plain/text</code> when encoding. You have to set the <code>Content-Type</code> first <code>w.Header().Set</code>, then the HTTP response code <code>w.WriteHeader</code>.</p>\n\n<p>If you call <code>w.WriteHeader</code> first then call <code>w.Header().Set</code> after you will get <code>plain/text</code>.</p>\n\n<p>An example handler might look like this;</p>\n\n<pre><code>func SomeHandler(w http.ResponseWriter, r *http.Request) {\n    data := SomeStruct{}\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.WriteHeader(http.StatusCreated)\n    json.NewEncoder(w).Encode(data)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user3679289"}, "is_accepted": false, "score": 0, "last_activity_date": 1511024752, "creation_date": 1511024752, "answer_id": 47368713, "question_id": 31622052, "link": "https://stackoverflow.com/questions/31622052/how-to-serve-up-a-json-response-using-go/47368713#47368713", "title": "How to serve up a JSON response using Go?", "body": "<p>You may use this <a href=\"https://github.com/thedevsaddam/renderer\" rel=\"nofollow noreferrer\">package renderer</a>, I have written to solve this kind of problem, it's a wrapper to serve JSON, JSONP, XML, HTML etc.</p>\n"}], "owner": {"reputation": 15015, "user_id": 1191635, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/I8bEt.jpg?s=128&g=1", "display_name": "Armeen Harwood", "link": "https://stackoverflow.com/users/1191635/armeen-harwood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120233, "favorite_count": 18, "accepted_answer_id": 31622112, "answer_count": 5, "score": 110, "last_activity_date": 1590090958, "creation_date": 1437789131, "last_edit_date": 1494086362, "question_id": 31622052, "link": "https://stackoverflow.com/questions/31622052/how-to-serve-up-a-json-response-using-go", "title": "How to serve up a JSON response using Go?", "body": "<p><strong>Question:</strong> Currently I'm printing out my response in the <code>func Index</code>\nlike this <code>fmt.Fprintf(w, string(response))</code> <strong>however, how can I send JSON properly in the request so that it maybe consumed by a view?</strong> </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/julienschmidt/httprouter\"\n    \"net/http\"\n    \"log\"\n    \"encoding/json\"\n)\n\ntype Payload struct {\n    Stuff Data\n}\ntype Data struct {\n    Fruit Fruits\n    Veggies Vegetables\n}\ntype Fruits map[string]int\ntype Vegetables map[string]int\n\n\nfunc Index(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {\n    response, err := getJsonResponse();\n    if err != nil {\n        panic(err)\n    }\n    fmt.Fprintf(w, string(response))\n}\n\n\nfunc main() {\n    router := httprouter.New()\n    router.GET(\"/\", Index)\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n}\n\nfunc getJsonResponse()([]byte, error) {\n    fruits := make(map[string]int)\n    fruits[\"Apples\"] = 25\n    fruits[\"Oranges\"] = 10\n\n    vegetables := make(map[string]int)\n    vegetables[\"Carrats\"] = 10\n    vegetables[\"Beets\"] = 0\n\n    d := Data{fruits, vegetables}\n    p := Payload{d}\n\n    return json.MarshalIndent(p, \"\", \"  \")\n}\n</code></pre>\n"}, {"tags": ["go", "closures"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 1, "creation_date": 1437774001, "post_id": 31620132, "comment_id": 51189652, "body": "Just a note, <code>item</code> in your loop is not the actual item object but the index."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1437774009, "post_id": 31620132, "comment_id": 51189654, "body": "I doubt the last two differ -- I think the only difference is whether the function value goes into an unnamed temporary space or a variable named <code>mustGetSpeed</code>. I&#39;m not <i>entirely</i> sure whether manually hoisting the decl up out of the loop helps out the compiler, especially if the closure is capturing local variables from its context. That&#39;s at least worth testing."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 1, "creation_date": 1437776914, "post_id": 31620132, "comment_id": 51190495, "body": "I would guess they are all optimized into very similar code. The thing is, if there was overhead to using your closure in the loop then their usefulness would be greatly diminished. I&#39;d prove that theory but don&#39;t really have the time to write a test program."}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1437777663, "post_id": 31620132, "comment_id": 51190713, "body": "Just my unsound thought is that the first one should be the fastest. It creates the function only once, whereas the second that creates it in a loop would be the slowest"}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1437841888, "post_id": 31623812, "comment_id": 51204693, "body": "Interestingly (to me at least), if the call to <code>strconv.Atoi</code> (which takes 90+% of the time) is removed so that just the closure/function is called then I appear to consistently get Closure1 slower-than Closure2 slower-than Closure3 (with slice sizes from 64 to 64k). I haven&#39;t looked at the assembly output. The times are close enough that unless this was in a very time critical section of code it just doesn&#39;t matter."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1437807184, "last_edit_date": 1437807184, "creation_date": 1437806882, "answer_id": 31623812, "question_id": 31620132, "link": "https://stackoverflow.com/questions/31620132/declare-closure-into-a-loop-in-the-context-of-performance/31623812#31623812", "title": "Declare closure into a loop (in the context of performance)", "body": "<p>You are speculating about a performance question. Don't do that. Get some facts. Run some benchmarks. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"strconv\"\n    \"testing\"\n)\n\nconst sound = \"1236\" // speed of sound 1,236 kilometres per hour\n\nvar items = make([]int, 1024)\n\nfunc BenchmarkClosure1(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        mustGetSpeed := func() string {\n            speed := sound\n            // ...\n            return speed\n        }\n        for _, item := range items {\n            speed, err := strconv.Atoi(mustGetSpeed())\n            // ...\n            _, _, _ = item, speed, err\n        }\n    }\n}\n\nfunc BenchmarkClosure2(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        for _, item := range items {\n            mustGetSpeed := func() string {\n                speed := sound\n                // ...\n                return speed\n            }\n            speed, err := strconv.Atoi(mustGetSpeed())\n            // ...\n            _, _, _ = item, speed, err\n        }\n    }\n}\n\nfunc BenchmarkClosure3(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        for _, item := range items {\n            speed, err := strconv.Atoi(func() string {\n                speed := sound\n                // ...\n                return speed\n            }())\n            // ...\n            _, _, _ = item, speed, err\n        }\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>BenchmarkClosure1      10000        156031 ns/op\nBenchmarkClosure2      10000        156955 ns/op\nBenchmarkClosure3      10000        152546 ns/op\n</code></pre>\n"}], "owner": {"reputation": 883, "user_id": 1509255, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1bdbc7273bc265e4e92f2fcacbb6c419?s=128&d=identicon&r=PG", "display_name": "Aleksandr", "link": "https://stackoverflow.com/users/1509255/aleksandr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 288, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1437807184, "creation_date": 1437773570, "last_edit_date": 1437774160, "question_id": 31620132, "link": "https://stackoverflow.com/questions/31620132/declare-closure-into-a-loop-in-the-context-of-performance", "title": "Declare closure into a loop (in the context of performance)", "body": "<p>Is there a difference (in the context of performance) between the three implementations below?:</p>\n\n<hr>\n\n<pre><code>mustGetSpeed := func() string {\n    ...\n    return speed\n}\n\nfor _, item := range items {\n    speed, err := strconv.Atoi(mustGetSpeed())\n    ...\n}\n</code></pre>\n\n<hr>\n\n<pre><code>for _, item := range items {\n    mustGetSpeed := func() string {\n        ...\n        return speed\n    }\n    speed, err := strconv.Atoi(mustGetSpeed())\n    ...\n}\n</code></pre>\n\n<hr>\n\n<pre><code>for _, item := range items {\n    speed, err := strconv.Atoi(func() string {\n        ...\n        return speed\n    }())\n    ...\n}\n</code></pre>\n\n<p>Is it a mistake (in the context of performance) declares closure into a loop?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 2, "creation_date": 1437754355, "post_id": 31615005, "comment_id": 51179822, "body": "Regardless of how you structure it, MessageImpl needs the methods defined in Message to be used as one. That&#39;s no different from java."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 2, "creation_date": 1437755311, "post_id": 31615005, "comment_id": 51180409, "body": "It&#39;s best not done in Go. Embedding (the language feature you&#39;re using) is more equivalent to composition than inheritance."}], "answers": [{"comments": [{"owner": {"reputation": 9113, "user_id": 146003, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/272ed3d9a5c9813ed1fad7ab8f512576?s=128&d=identicon&r=PG", "display_name": "Atmocreations", "link": "https://stackoverflow.com/users/146003/atmocreations"}, "edited": false, "score": 0, "creation_date": 1437924189, "post_id": 31616104, "comment_id": 51223743, "body": "Thank you. As <code>Message</code> itself should be abstract, I&#39;m supposed to return an error for calls to <code>Message.FirstLine()</code> - this methods should always be implemented by <code>Request</code> and <code>Response</code> (and other types that may come)"}], "tags": [], "owner": {"reputation": 1541, "user_id": 395059, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ad82e88848bab09d379e402207405874?s=128&d=identicon&r=PG", "display_name": "Joey", "link": "https://stackoverflow.com/users/395059/joey"}, "is_accepted": true, "score": 2, "last_activity_date": 1437760113, "last_edit_date": 1437760113, "creation_date": 1437757580, "answer_id": 31616104, "question_id": 31615005, "link": "https://stackoverflow.com/questions/31615005/messageimpl-does-not-implement-message/31616104#31616104", "title": "MessageImpl does not implement Message", "body": "<p>An <strong>interface</strong> in go is a set of methods, but interfaces are also types. So the go convention is to suffix -er for any interface to indicate whether or not other types compose methods from it.</p>\n\n<p>You need to define an implementation for the type <code>Messege</code> to receive the <code>FirstLine()</code> method. It satisfies the <code>Messeger</code> interface as a result.</p>\n\n<p><strong>Edit:</strong>  I misunderstood what you were doing with <code>bytes.Buffer</code>, so the answer is actually a lot simpler.</p>\n\n<p><strong>Edit2:</strong> I had to think about this one a bit but it seems you want <code>RenderMessage()</code> to be a function instead of a method. <code>RenderMessage</code> has a parameter of type <code>Messeger</code> which can (so far) either be of type <code>Request</code>, <code>Response</code>, or <code>Message</code>. </p>\n\n<p>You can't define a method receiver for <code>RenderMessage</code> if the <code>Messager</code> you're passing can be of variable type, unless you want to have a type switch within <code>RenderMessage</code>, which somewhat defeats the purpose of using an interface to begin with.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n)\n\ntype Messager interface {\n    FirstLine() string\n    /* some other method declarations*/\n}\n\ntype Header struct {\n    Data string\n}\n\ntype Message struct {\n    headers []Header\n    /* some other fields */\n}\n\ntype Request struct {\n    /* some fields */\n    Message\n}\n\ntype Response struct {\n    /* some fields */\n    Message\n}\n\nfunc (r Request) FirstLine() string {\n    var requestLine bytes.Buffer\n    requestLine.WriteString(\"...\")\n    // Some more instructions\n    return requestLine.String()\n}\n\nfunc (r Response) FirstLine() string {\n    var requestLine bytes.Buffer\n    requestLine.WriteString(\"!!!\")\n    // Some more instructions\n    return requestLine.String()\n}\n\nfunc (m Message) FirstLine() string {\n    // whatever this would be\n    return \"???\"\n}\n\nfunc RenderMessage(m Messager) string {\n    var b bytes.Buffer\n    var msg Messager = m // &lt;=== This is the line the compiler moans about\n    b.Write([]byte(\"some text\"))\n    b.WriteString(msg.FirstLine())\n    // Some more instructions\n    return b.String()\n}\n\nfunc main() {\n    header := Request{}\n    fmt.Println(RenderMessage(header))\n\n    resp := Response{}\n    fmt.Println(RenderMessage(resp))\n\n    foo := Message{}\n    fmt.Println(RenderMessage(foo))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>some text...\nsome text!!!\nsome text???\n</code></pre>\n\n<p>I added this since it wasn't defined in your question:</p>\n\n<pre><code>type Header struct {\n    Data string\n}\n</code></pre>\n\n<p>I also added this line to illustrate the example:</p>\n\n<pre><code>    b.Write([]byte(\"some text\"))\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/n-DOQbXXl9\" rel=\"nofollow\">http://play.golang.org/p/n-DOQbXXl9</a></p>\n"}], "owner": {"reputation": 9113, "user_id": 146003, "user_type": "registered", "accept_rate": 99, "profile_image": "https://www.gravatar.com/avatar/272ed3d9a5c9813ed1fad7ab8f512576?s=128&d=identicon&r=PG", "display_name": "Atmocreations", "link": "https://stackoverflow.com/users/146003/atmocreations"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 31616104, "answer_count": 1, "score": 0, "last_activity_date": 1437760113, "creation_date": 1437753661, "question_id": 31615005, "link": "https://stackoverflow.com/questions/31615005/messageimpl-does-not-implement-message", "title": "MessageImpl does not implement Message", "body": "<p>In golang, I'm having the following compile error:</p>\n\n<pre><code>cannot use m (type MessageImpl) as type Message in assignment:\n    MessageImpl does not implement Message (missing FirstLine method)\n</code></pre>\n\n<p>Using the following code:</p>\n\n<pre><code>type Message interface {\n  FirstLine() string\n  /* some other method declarations*/\n}\n\ntype MessageImpl struct {\n  headers     []Header\n  /* some other fields */\n}\n\ntype Request struct {\n  MessageImpl\n  /* some other fields */\n}\n\ntype Response struct {\n  MessageImpl\n  /* some other fields */\n}\n\nfunc (r Request) FirstLine() string {\n  var requestLine bytes.Buffer\n  requestLine.WriteString(\"...\")\n  // Some more instructions\n  return requestLine.String()\n}\n\n\nfunc (m MessageImpl) RenderMessage() string {\n  var message bytes.Buffer\n  var msg Message = m                   // &lt;=== This is the line the compiler moans about\n  message.WriteString(msg.FirstLine())\n  // Some more instructions\n  return message.String()\n}\n</code></pre>\n\n<p>Coming from java language, I'll try to express my intention:\nHaving some interface <code>Message</code> defining some methods implemented by an abstract class <code>MessageImpl</code>. Two real classes <code>Request</code> and <code>Response</code> should inherit from <code>MessageImpl</code> (and implement the interface <code>Message</code>). Both of these define and implement some more internal methods.</p>\n\n<p>How is this done best?</p>\n"}, {"tags": ["git", "go", "libgit2"], "comments": [{"owner": {"reputation": 2353, "user_id": 1157272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43ac0e051c9fabf087a0aa4bc2caba50?s=128&d=identicon&r=PG", "display_name": "joran", "link": "https://stackoverflow.com/users/1157272/joran"}, "edited": false, "score": 0, "creation_date": 1437847217, "post_id": 31614884, "comment_id": 51206285, "body": "This may be duplicate of <a href=\"http://stackoverflow.com/questions/223678/which-commit-has-this-blob\" title=\"which commit has this blob\">stackoverflow.com/questions/223678/which-commit-has-this-blo&zwnj;&#8203;b</a>"}, {"owner": {"reputation": 1598, "user_id": 1104534, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad2bdd8c4d37364f52e6ab7aa92ef570?s=128&d=identicon&r=PG", "display_name": "Calin", "link": "https://stackoverflow.com/users/1104534/calin"}, "reply_to_user": {"reputation": 2353, "user_id": 1157272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43ac0e051c9fabf087a0aa4bc2caba50?s=128&d=identicon&r=PG", "display_name": "joran", "link": "https://stackoverflow.com/users/1157272/joran"}, "edited": false, "score": 1, "creation_date": 1437911338, "post_id": 31614884, "comment_id": 51219794, "body": "Pretty much yes but the solution uses git cli not libgit or git2go, and it&#39;s basically the same idea as written in this question."}], "answers": [{"tags": [], "owner": {"reputation": 5037, "user_id": 1370215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/023e1295851b018af03706f391b76931?s=128&d=identicon&r=PG", "display_name": "Carlos Mart&#237;n Nieto", "link": "https://stackoverflow.com/users/1370215/carlos-mart%c3%adn-nieto"}, "is_accepted": false, "score": 0, "last_activity_date": 1438259507, "creation_date": 1438259507, "answer_id": 31723871, "question_id": 31614884, "link": "https://stackoverflow.com/questions/31614884/find-commits-that-contain-a-specified-blob-object-in-git2go-libgit2/31723871#31723871", "title": "Find commits that contain a specified blob object in git2go (libgit2)", "body": "<p>If you want to check whether an object is contained in a particular commit, the only way to do that is to walk down the object graph and see if it's there.</p>\n\n<p>There is however one way you can re-use some of those searches. If you diff a pair of commits, and you know that the object in question is contained (or not) in one of them, you can look at the diff for the appearance/disappearance of that blob from the commit's tree, which would avoid walking down equal trees.</p>\n\n<p>git supports reachability bitmaps, which make this rather quick, but libgit2 does not support reading them.</p>\n"}], "owner": {"reputation": 1598, "user_id": 1104534, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/ad2bdd8c4d37364f52e6ab7aa92ef570?s=128&d=identicon&r=PG", "display_name": "Calin", "link": "https://stackoverflow.com/users/1104534/calin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 157, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1438259507, "creation_date": 1437753259, "last_edit_date": 1437800802, "question_id": 31614884, "link": "https://stackoverflow.com/questions/31614884/find-commits-that-contain-a-specified-blob-object-in-git2go-libgit2", "title": "Find commits that contain a specified blob object in git2go (libgit2)", "body": "<p>Given a blob object, how can you find the (first) commit that contains that object?</p>\n\n<p>One solution I think is to start a revwalk from the tip of a branch and walk your way down the graph, inspecting the tree for each commit and use something like <code>git_tree_entry_byid</code> to see if it contains your object. This would find commits accessible from a particular branch, but it is a solution in my case.</p>\n\n<p>Is there a better way of doing this?</p>\n"}, {"tags": ["xml", "go", "xml-parsing"], "answers": [{"tags": [], "owner": {"reputation": 806, "user_id": 719020, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/7dfa71310fe94858b6f042303b414873?s=128&d=identicon&r=PG", "display_name": "ChrisR", "link": "https://stackoverflow.com/users/719020/chrisr"}, "is_accepted": true, "score": 2, "last_activity_date": 1437753568, "creation_date": 1437753568, "answer_id": 31614979, "question_id": 31614844, "link": "https://stackoverflow.com/questions/31614844/simple-xml-unmarshalling-return-empty-values/31614979#31614979", "title": "Simple XML unmarshalling return empty values", "body": "<p>Just as trivially, the <code>Throttler</code> struct doesn't export its fields. Hence, changing the struct to have upper case variables makes them accessible.</p>\n\n<p><a href=\"http://play.golang.org/p/IzWsfRKZdI\" rel=\"nofollow\">Fixed example here</a></p>\n"}], "owner": {"reputation": 806, "user_id": 719020, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/7dfa71310fe94858b6f042303b414873?s=128&d=identicon&r=PG", "display_name": "ChrisR", "link": "https://stackoverflow.com/users/719020/chrisr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 236, "favorite_count": 0, "accepted_answer_id": 31614979, "answer_count": 1, "score": -1, "last_activity_date": 1437753568, "creation_date": 1437753127, "question_id": 31614844, "link": "https://stackoverflow.com/questions/31614844/simple-xml-unmarshalling-return-empty-values", "title": "Simple XML unmarshalling return empty values", "body": "<p>I'm trying a unmarshal some basic XML in Go. I've been able to unmarshal very large XML files in Go before, so the issue I have here really baffles me.</p>\n\n<p>Unmarshalling finds one item, as it should, but all values are to their null default: strings are empty and the float is zero.</p>\n\n<p>Any hint would help. Thanks.</p>\n\n<h3>XML</h3>\n\n<pre><code>&lt;config&gt;&lt;throttle delay=\"20\" unit=\"s\" host=\"feeds.feedburner.com\"/&gt;&lt;/config&gt;\n</code></pre>\n\n<h3>Output</h3>\n\n<p><code>host:\"\", unit:\"\", delay:0.000000</code></p>\n\n<h3>Code</h3>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n)\n\n// Config allows for unmarshling of the remote configuration file.\ntype Config struct {\n    XMLName    xml.Name     `xml:\"config\"`\n    Throttlers []*Throttler `xml:\"throttle\"`\n}\n\n// Throttler stores the throttle information read from the configuration file.\ntype Throttler struct {\n    host  string  `xml:\"host,attr\"`\n    unit  string  `xml:\"unit,attr\"`\n    delay float64 `xml:\"delay,attr\"`\n}\n\nfunc main() {\n\n    data := `\n        &lt;config&gt;&lt;throttle delay=\"20\" unit=\"s\" host=\"feeds.feedburner.com\"/&gt;&lt;/config&gt;\n    `\n    config := Config{}\n    err := xml.Unmarshal([]byte(data), &amp;config)\n    if err != nil {\n        fmt.Printf(\"error: %config\", err)\n        return\n    }\n    thr := config.Throttlers[0]\n    fmt.Println(fmt.Sprintf(\"host:%q, unit:%q, delay:%f\", thr.host, thr.unit, thr.delay))\n\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/Hcaw4geHxp\" rel=\"nofollow\">Go playground link here</a></p>\n"}, {"tags": ["go", "amazon-dynamodb", "aws-sdk", "query-parameters"], "answers": [{"comments": [{"owner": {"reputation": 349, "user_id": 4651753, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--ox9WCbtwLg/AAAAAAAAAAI/AAAAAAAAB-s/Z0GzoOhBwuI/photo.jpg?sz=128", "display_name": "sr_149", "link": "https://stackoverflow.com/users/4651753/sr-149"}, "edited": false, "score": 0, "creation_date": 1438007396, "post_id": 31620645, "comment_id": 51256708, "body": "Thanks JaredHatfield, that was perfect! Didn&#39;t exactly know the use of the Scan operation. Figured out using local secondary indexes would help, but once created they cannot be modified, and there&#39;s a limit on the number of local secondary indexes."}], "tags": [], "owner": {"reputation": 5553, "user_id": 788433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d61d8ed3faf498777c94ad1f443cda3b?s=128&d=identicon&r=PG", "display_name": "JaredHatfield", "link": "https://stackoverflow.com/users/788433/jaredhatfield"}, "is_accepted": true, "score": 6, "last_activity_date": 1503072333, "last_edit_date": 1503072333, "creation_date": 1437776371, "answer_id": 31620645, "question_id": 31613988, "link": "https://stackoverflow.com/questions/31613988/querying-a-parameter-that-s-not-an-index-on-dynamodb/31620645#31620645", "title": "Querying a parameter that\u2019s not an index on DynamoDb", "body": "<p>DynamoDB is a NoSQL based system so you will not be able to retrieve all of the records based on a condition on a non-indexed field without doing a <a href=\"https://docs.aws.amazon.com/amazondynamodb/latest/developerguide/QueryAndScan.html#QueryAndScan.Scan\" rel=\"nofollow noreferrer\">table scan</a>.</p>\n\n<p>A table scan will cause DynamoDB to go through every single record in the table, which for a big table will be very expensive in either time (it is slow) or money (provisioned read IOPS).</p>\n\n<p>Using a filter is the correct approach and will allow the operation to complete if you switch from a query to a scan.  A query must always specify the hash key.</p>\n\n<p><em>A word of warning though: if you plan on using a scan operation on a table of more than just a few (less than 100) items that is exposed in a front end you will be disappointed with the results.  If this is some type of cron job or backend reporting task where response time doesn't matter this is an acceptable approach, but be careful not to exhaust all of your IOPS and impact front end applications.</em></p>\n"}], "owner": {"reputation": 349, "user_id": 4651753, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--ox9WCbtwLg/AAAAAAAAAAI/AAAAAAAAB-s/Z0GzoOhBwuI/photo.jpg?sz=128", "display_name": "sr_149", "link": "https://stackoverflow.com/users/4651753/sr-149"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6177, "favorite_count": 0, "accepted_answer_id": 31620645, "answer_count": 1, "score": 4, "last_activity_date": 1503072333, "creation_date": 1437750469, "question_id": 31613988, "link": "https://stackoverflow.com/questions/31613988/querying-a-parameter-that-s-not-an-index-on-dynamodb", "title": "Querying a parameter that\u2019s not an index on DynamoDb", "body": "<p>TableName : people</p>\n\n<p>id  | name  | age       | location</p>\n\n<p>id_1    | A     | 23        | New Zealand</p>\n\n<p>id_2    | B     | 12        | India</p>\n\n<p>id_3    | C     | 26        | Singapore</p>\n\n<p>id_4    | D     | 30        | Turkey</p>\n\n<p>keys: id -> hash and age->range</p>\n\n<p><strong>Question 1</strong></p>\n\n<p>I\u2019m trying to execute a query: \u201cSelect * from people where age > 25\u201d\nI can get it to work queries like \u201cSelect age from people where id = id_1 and age > 25\u201d which is not what I need, just need to select all values. </p>\n\n<p>And if I don\u2019t need age to be a range index, how should i modify my query params to just return the list of records matching the criterion: age > 25?</p>\n\n<p><strong>Question 2</strong></p>\n\n<p>AWS throws an error when either Lines 23 or 24-41 are commented.\n: Query Error:  ValidationException: Either the KeyConditions or KeyConditionExpression parameter must be specified in the request.\n                status code: 400, request id: []</p>\n\n<p>Is the KeyConditions/KeyConditionsExpressions parameter required? Does it mean that I cannot query the table on a parameter that's not a part of the index? </p>\n\n<pre><code>  func queryDynamo() {\n        log.Println(\"Enter queryDynamo\")\n\n        svc := dynamodb.New(nil)\n\n        params := &amp;dynamodb.QueryInput{\n            TableName: aws.String(\"people\"), // Required\n            Limit:     aws.Long(3),\n            // IndexName: aws.String(\"localSecondaryIndex\"),\n            ExpressionAttributeValues: map[string]*dynamodb.AttributeValue{\n                \":v_age\": { // Required\n                    N: aws.String(\"25\"),\n                },\n                \":v_ID\": {\n                    S: aws.String(\"NULL\"),\n                },\n            },\n            FilterExpression: aws.String(\"age &gt;= :v_age\"),\n\n            // KeyConditionExpression: aws.String(\"id = :v_ID and age &gt;= :v_age\"),\n            KeyConditions: map[string]*dynamodb.Condition{\n                \"age\": { // Required\n                    ComparisonOperator: aws.String(\"GT\"), // Required\n                    AttributeValueList: []*dynamodb.AttributeValue{\n                        { // Required\n                            N: aws.String(\"25\"),\n                        },\n                        // More values...\n                    },\n                },\n                \"id\": { // Required\n                    ComparisonOperator: aws.String(\"EQ\"), // Required\n                    // AttributeValueList: []*dynamodb.AttributeValue{\n                    //  S: aws.String(\"NOT_NULL\"),\n                    // },\n                },\n                // More values...\n            },\n            Select:           aws.String(\"ALL_ATTRIBUTES\"),\n            ScanIndexForward: aws.Boolean(true),\n        }\n\n//Get the response and print it out.\n        resp, err := svc.Query(params) \n\n        if err != nil {\n            log.Println(\"Query Error: \", err.Error())\n        }\n\n        // Pretty-print the response data.\n        log.Println(awsutil.StringValue(resp))\n    }\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-storage"], "comments": [{"owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 1, "creation_date": 1437746266, "post_id": 31611616, "comment_id": 51174483, "body": "I see no reason you need to load it all into memory. Why do you need random access from the file? You just need to io.Copy from the src to the zip. I also don&#39;t see why you need to load the zip file into memory. You can just stream it out as it is being built."}, {"owner": {"reputation": 269, "user_id": 2147271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eZtqJ.jpg?s=128&g=1", "display_name": "tmoore", "link": "https://stackoverflow.com/users/2147271/tmoore"}, "reply_to_user": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 0, "creation_date": 1437775169, "post_id": 31611616, "comment_id": 51189981, "body": "I&#39;ll look into it again but I&#39;m pretty sure that was the first thing I tried..."}, {"owner": {"reputation": 269, "user_id": 2147271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eZtqJ.jpg?s=128&g=1", "display_name": "tmoore", "link": "https://stackoverflow.com/users/2147271/tmoore"}, "reply_to_user": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 0, "creation_date": 1438028450, "post_id": 31611616, "comment_id": 51269644, "body": "@StephenWeinberg The Zip Reader requires an io.ReaderAt interface which is why you have to load the entire thing into a buffer for random access (see: <a href=\"https://golang.org/src/archive/zip/reader.go\" rel=\"nofollow noreferrer\">golang.org/src/archive/zip/reader.go</a>) from the cloud because cloud storage only gives you a ReadCloser interface (see: <a href=\"https://godoc.org/google.golang.org/cloud/storage#example-NewReader\" rel=\"nofollow noreferrer\">godoc.org/google.golang.org/cloud/storage#example-NewReader</a>)  This is why the BlobStore was so much faster for me.  Am I missing something?"}, {"owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 0, "creation_date": 1438028524, "post_id": 31611616, "comment_id": 51269680, "body": "That is for reading. You are writing."}, {"owner": {"reputation": 269, "user_id": 2147271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eZtqJ.jpg?s=128&g=1", "display_name": "tmoore", "link": "https://stackoverflow.com/users/2147271/tmoore"}, "reply_to_user": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 0, "creation_date": 1438030028, "post_id": 31611616, "comment_id": 51270478, "body": "@StephenWeinberg Thanks!  That was clearly a mistake from copy/paste of my Unpack routine.  Also do not need to write to a buffer first and can write directly to the storage file.  So that&#39;s 2 big improvements there.  Cheers"}, {"owner": {"reputation": 269, "user_id": 2147271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eZtqJ.jpg?s=128&g=1", "display_name": "tmoore", "link": "https://stackoverflow.com/users/2147271/tmoore"}, "reply_to_user": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 0, "creation_date": 1438030547, "post_id": 31611616, "comment_id": 51270783, "body": "@StephenWeinberg Do you do any consulting?  I&#39;m in DC."}, {"owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 0, "creation_date": 1438030757, "post_id": 31611616, "comment_id": 51270910, "body": "Sometimes, but I am off the grid for the next week and a half. If you are interested I can talk more after Aug 4th. My email is stephen@q5comm.com. I am in NY."}], "answers": [{"comments": [{"owner": {"reputation": 206, "user_id": 370800, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1bf38a68dbf67cc7887fd0dd814bfeed?s=128&d=identicon&r=PG", "display_name": "matt", "link": "https://stackoverflow.com/users/370800/matt"}, "edited": false, "score": 0, "creation_date": 1530250714, "post_id": 31707852, "comment_id": 89177726, "body": "Wrote a version of this for use outside of google app engine, but still in go: <a href=\"https://gist.github.com/moorage/a7300dee720e694aa89fd152b2b2c69d\" rel=\"nofollow noreferrer\">gist.github.com/moorage/a7300dee720e694aa89fd152b2b2c69d</a>"}], "tags": [], "owner": {"reputation": 269, "user_id": 2147271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eZtqJ.jpg?s=128&g=1", "display_name": "tmoore", "link": "https://stackoverflow.com/users/2147271/tmoore"}, "is_accepted": true, "score": 3, "last_activity_date": 1438192828, "creation_date": 1438192828, "answer_id": 31707852, "question_id": 31611616, "link": "https://stackoverflow.com/questions/31611616/best-approach-to-zipping-up-a-folder-in-google-cloud-storage-using-go/31707852#31707852", "title": "Best Approach to Zipping up a Folder in Google Cloud Storage using Go?", "body": "<p>Thanks to Stephen who suggested not loading the file into memory buffers when writing to a zip.  Here is the fixed code for reference: </p>\n\n<pre><code>// Pack a folder into zip file\nfunc (cloud *Cloud) Pack(srcFolder string, fileName string, contentType string, metaData *map[string]string) bool {\n\n    log.Infof(cloud.c, \"Packing bucket %v folder %v to file %v\", cloud.bucket, srcFolder, fileName) \n\n    srcFolder = fmt.Sprintf(\"%v/\", srcFolder)\n    query := &amp;storage.Query{Prefix: srcFolder, Delimiter: \"/\"}\n\n    objs, err := storage.ListObjects(cloud.ctx, cloud.bucket, query)\n    if err != nil {\n        log.Errorf(cloud.c, \"Packing failed to list bucket %q: %v\", cloud.bucket, err)\n        return false\n    }\n\n    totalFiles := len(objs.Results)\n    if totalFiles == 0 {\n        log.Errorf(cloud.c, \"Packing failed to find objects found in folder %q: %v\", cloud.bucket, srcFolder)\n        return false\n    }\n\n    // create storage file for writing\n    log.Infof(cloud.c, \"Writing new zip file to %v/%v for %v files\", cloud.bucket, fileName, totalFiles)\n    storageWriter := storage.NewWriter(cloud.ctx, cloud.bucket, fileName)\n    defer storageWriter.Close()\n\n    // add optional content type and meta data  \n    if len(contentType) &gt; 0 { storageWriter.ContentType = contentType }\n    if metaData != nil { storageWriter.Metadata = *metaData }\n\n    // Create a new zip archive to memory buffer\n    zipWriter := zip.NewWriter(storageWriter)\n\n    // go through each file in the folder\n    for _, obj := range objs.Results {\n\n        log.Infof(cloud.c, \"Packing file %v of size %v to zip file\", obj.Name, obj.Size)\n        //d.dumpStats(obj)\n\n        // read file in our source folder from storage - io.ReadCloser returned from storage\n        storageReader, err := storage.NewReader(cloud.ctx, cloud.bucket, obj.Name)\n        if err != nil {\n            log.Errorf(cloud.c, \"Packing failed to read from bucket %q file %q: %v\", cloud.bucket, obj.Name, err)\n            return false\n        }\n        defer storageReader.Close()\n\n        // grab just the filename from directory listing (don't want to store paths in zip)\n        _, zipFileName := filepath.Split(obj.Name)\n        newFileName := strings.ToLower(zipFileName)\n\n        // add filename to zip\n        zipFile, err := zipWriter.Create(newFileName)\n        if err != nil {\n            log.Errorf(cloud.c, \"Packing failed to create zip file from bucket %q file %q: %v\", cloud.bucket, zipFileName, err)\n            return false\n        }\n\n        // copy from storage reader to zip writer   \n        _, err = io.Copy(zipFile, storageReader)\n        if err != nil {\n            log.Errorf(cloud.c, \"Failed to copy from storage reader to zip file: %v\", err)\n            return false\n        }   \n    }\n\n    // Make sure to check the error on Close.\n    log.Infof(cloud.c, \"Closing zip writer\")    \n    err = zipWriter.Close()\n    if err != nil {\n        log.Errorf(cloud.c, \"Packing failed to close zip file writer from bucket %q file %q : %v\", cloud.bucket, fileName, err)\n        return false\n    }\n\n    // success!\n    log.Infof(cloud.c, \"Packed files to new cloud storage file %v successful!\", fileName)   \n    return true\n}\n</code></pre>\n"}], "owner": {"reputation": 269, "user_id": 2147271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eZtqJ.jpg?s=128&g=1", "display_name": "tmoore", "link": "https://stackoverflow.com/users/2147271/tmoore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2481, "favorite_count": 2, "accepted_answer_id": 31707852, "answer_count": 1, "score": 3, "last_activity_date": 1576060337, "creation_date": 1437743970, "last_edit_date": 1576060337, "question_id": 31611616, "link": "https://stackoverflow.com/questions/31611616/best-approach-to-zipping-up-a-folder-in-google-cloud-storage-using-go", "title": "Best Approach to Zipping up a Folder in Google Cloud Storage using Go?", "body": "<p>My Google App Engine Go project creates a zip of multiple files in a \"folder\" that's in Google Cloud Storage.  It used to be pretty quick when it was implemented in the BlobStore using the now deprecated and removed Files API. I recently converted the code to use Google Cloud Storage and now the performance is really bad and sometimes will timeout. The files that are being zipped are between 1K and 2M in size.</p>\n\n<p>I'm looking for any advice to improve zipping up file contents. The code below is what I wrote for compressing multiple files in the cloud to a new zip file in the cloud. It can take a long time to execute and requires loading the entire contents (See PERFORMANCE ISSUE below) of each file into memory before writing it to the zip.  There has to be a better way.</p>\n\n<pre><code>// Pack a folder into zip file\nfunc (cloud *Cloud) Pack(srcFolder string, fileName string, contentType string, metaData *map[string]string) {\n\n    log.Infof(cloud.c, \"Packing bucket %v folder %v to file %v\", cloud.bucket, srcFolder, fileName) \n\n    srcFolder = fmt.Sprintf(\"%v/\", srcFolder)\n    query := &amp;storage.Query{Prefix: srcFolder, Delimiter: \"/\"}\n\n    objs, err := storage.ListObjects(cloud.ctx, cloud.bucket, query)\n    if err != nil {\n        log.Errorf(cloud.c, \"Packing failed to list bucket %q: %v\", cloud.bucket, err)\n        return\n    }\n\n    totalFiles := len(objs.Results)\n    if totalFiles == 0 {\n        log.Errorf(cloud.c, \"Packing failed to find objects found in folder %q: %v\", cloud.bucket, srcFolder)\n        return\n    }\n\n    // create storage file for writing\n    log.Infof(cloud.c, \"Writing new zip file to %v/%v for %v files\", cloud.bucket, fileName, totalFiles)\n    storageWriter := storage.NewWriter(cloud.ctx, cloud.bucket, fileName)\n\n    // add optional content type and meta data  \n    if len(contentType) &gt; 0 { storageWriter.ContentType = contentType }\n    if metaData != nil { storageWriter.Metadata = *metaData }\n\n    // Create a buffer to write our archive to.\n    buf := new(bytes.Buffer)\n\n    // Create a new zip archive to memory buffer\n    zipWriter := zip.NewWriter(buf)\n\n    // go through each file in the folder\n    for _, obj := range objs.Results {\n\n        log.Infof(cloud.c, \"Packing file %v of size %v to zip file\", obj.Name, obj.Size)\n        //d.dumpStats(obj)\n\n        // read file in our source folder from storage - io.ReadCloser returned from storage\n        storageReader, err := storage.NewReader(cloud.ctx, cloud.bucket, obj.Name)\n        if err != nil {\n            log.Errorf(cloud.c, \"Packing failed to read from bucket %q file %q: %v\", cloud.bucket, obj.Name, err)\n            return  \n        }\n        defer storageReader.Close()\n\n        // PERFORMANCE ISSUE: have to load the entire file into memory to get random access from the cloud\n        slurp, err := ioutil.ReadAll(storageReader)\n        if err != nil {\n            log.Errorf(cloud.c, \"Packing failed to read data from bucket %q file %q: %v\", cloud.bucket, obj.Name, err)\n            return\n        }\n\n        // grab just the filename from directory listing (don't want to store paths in zip)\n        _, zipFileName := filepath.Split(obj.Name)\n\n        newFileName := strings.ToLower(zipFileName)\n\n        // add filename to zip\n        zipFile, err := zipWriter.Create(newFileName)\n        if err != nil {\n            log.Errorf(cloud.c, \"Packing failed to create zip file from bucket %q file %q: %v\", cloud.bucket, zipFileName, err)\n            return\n        }\n\n        // write entire file into zip archive\n        _, err = zipFile.Write(slurp)\n        if err != nil {\n            log.Errorf(cloud.c, \"Packing failed to write zip file from bucket %q file %q: %v\", cloud.bucket, zipFileName, err)\n            return\n        }\n\n        // flush that to buffer so we can write it off now\n        //err = zipFile.Flush()\n        //if err != nil {\n        //  d.errorf(\"pack: unable to flush write of zip file from bucket %q, file %q: %v\", cloud.bucket, zipFileName, err)\n        //  //return\n        //}\n\n        // now drain all that buffered zip data to the cloud storage file   \n        log.Infof(cloud.c, \"Writing zip buffer of size %v to cloud storage file %v\", buf.Len(), fileName)   \n        _, err = buf.WriteTo(storageWriter)\n        if err != nil {\n            log.Errorf(cloud.c, \"Packing failed to write data to bucket %q file %q: %v\", cloud.bucket, fileName, err)   \n            return          \n        }\n    }\n\n    // Make sure to check the error on Close.\n    log.Infof(cloud.c, \"Closing zip writer\")    \n    err = zipWriter.Close()\n    if err != nil {\n        log.Errorf(cloud.c, \"Packing failed to close zip file writer from bucket %q file %q : %v\", cloud.bucket, fileName, err)\n    }\n\n    // write any leftover data\n    if buf.Len() &gt; 0 {\n        // now drain all that buffered zip data to the cloud storage file   \n        // log.Infof(cloud.c, \"Packing zip buffer of size %v to cloud storage file %v\", buf.Len(), fileName)    \n        _, err := buf.WriteTo(storageWriter)\n        if err != nil {\n            log.Errorf(cloud.c, \"Packing failed to write data to bucket %q file %q: %v\", cloud.bucket, fileName, err)               \n        }\n    }\n\n    // close up final write file\n    //log.Infof(cloud.c, \"Closing cloud storage file %v\", fileName) \n    if err := storageWriter.Close(); err != nil {\n        log.Errorf(cloud.c, \"Packing failed to close bucket %q file %q: %v\", cloud.bucket, fileName, err)\n        return\n    }\n\n    // success!\n    log.Infof(cloud.c, \"Packed files to new cloud storage file %v successful!\", fileName)   \n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mongodb-query", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 43776, "user_id": 5031275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h8FTg.png?s=128&g=1", "display_name": "Blakes Seven", "link": "https://stackoverflow.com/users/5031275/blakes-seven"}, "reply_to_user": {"reputation": 474, "user_id": 3249983, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b731b133349215fb4d53a6bde054d4a3?s=128&d=identicon&r=PG&f=1", "display_name": "GuillaumeP", "link": "https://stackoverflow.com/users/3249983/guillaumep"}, "edited": false, "score": 0, "creation_date": 1437734188, "post_id": 31608248, "comment_id": 51166439, "body": "@GuillaumeP Unlike the standard MongoDB <code>.find()</code> API implementation, &quot;projection&quot; is separated with mgo. It&#39;s an easy mistake to make. But the first hint should be &quot;map&quot; and not &quot;list&quot; as the reference API does."}], "tags": [], "owner": {"reputation": 43776, "user_id": 5031275, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/h8FTg.png?s=128&g=1", "display_name": "Blakes Seven", "link": "https://stackoverflow.com/users/5031275/blakes-seven"}, "is_accepted": true, "score": 2, "last_activity_date": 1437733914, "creation_date": 1437733914, "answer_id": 31608248, "question_id": 31607964, "link": "https://stackoverflow.com/questions/31607964/mgo-cant-canonicalize-query-badvalue-unknown-operator-meta/31608248#31608248", "title": "MGO : Can&#39;t canonicalize query: BadValue unknown operator: $meta", "body": "<p>The problem here is that you are using a BSON \"map\" as the argument with the \"projection\" as part of the \"query\". Instead use the <a href=\"http://godoc.org/labix.org/v2/mgo#Query.Select\" rel=\"nofollow\"><code>.Select()</code></a> method in chaining for projection:</p>\n\n<pre><code>collection.Find(\n    bson.M{ \"$text\": bson.M{ \"$search\": \"mysearch\" } }\n).Select( \n    bson.M{ \"score\": bson.M{ \"$meta\": \"textScore\" } }\n)\n</code></pre>\n\n<p>Just like in the standard API examples, the \"query\" and \"projection\" portions are \"separated\" from each other.</p>\n"}], "owner": {"reputation": 474, "user_id": 3249983, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b731b133349215fb4d53a6bde054d4a3?s=128&d=identicon&r=PG&f=1", "display_name": "GuillaumeP", "link": "https://stackoverflow.com/users/3249983/guillaumep"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1090, "favorite_count": 0, "accepted_answer_id": 31608248, "answer_count": 1, "score": 2, "last_activity_date": 1437734016, "creation_date": 1437733089, "last_edit_date": 1495542697, "question_id": 31607964, "link": "https://stackoverflow.com/questions/31607964/mgo-cant-canonicalize-query-badvalue-unknown-operator-meta", "title": "MGO : Can&#39;t canonicalize query: BadValue unknown operator: $meta", "body": "<p>I am using the MGO to communicate with mongodb.\nI want to search in a collection, and to sort the results by search score.</p>\n\n<pre><code>collection.Find(bson.M{\n    \"$text\": bson.M{\"$search\": \"mysearch\"},\n    \"score\": bson.M{\"$meta\": \"textScore\"},\n})\n</code></pre>\n\n<p>But I get this error :</p>\n\n<pre><code>Can't canonicalize query: BadValue unknown operator: $meta (status code : 500)\n</code></pre>\n\n<p>When I only try with $text, it works.</p>\n\n<p>I use the same bson structure than here :\n<a href=\"https://stackoverflow.com/questions/23639896/mongodb-cant-canonicalize-query-badvalue-unknown-operator-meta?rq=1\">MongoDB - Can&#39;t canonicalize query: BadValue unknown operator: $meta</a></p>\n\n<p>Thanks</p>\n"}, {"tags": ["regex", "string", "go", "substring"], "answers": [{"comments": [{"owner": {"reputation": 129, "user_id": 1230603, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b8046dd2036cfc53129aa182f981382f?s=128&d=identicon&r=PG", "display_name": "hiroru", "link": "https://stackoverflow.com/users/1230603/hiroru"}, "edited": false, "score": 0, "creation_date": 1437739181, "post_id": 31607709, "comment_id": 51169551, "body": "Thanks Andris, it really helps me! nice answer ;-)"}, {"owner": {"reputation": 65435, "user_id": 2206004, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HCB1e.png?s=128&g=1", "display_name": "hwnd", "link": "https://stackoverflow.com/users/2206004/hwnd"}, "reply_to_user": {"reputation": 129, "user_id": 1230603, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b8046dd2036cfc53129aa182f981382f?s=128&d=identicon&r=PG", "display_name": "hiroru", "link": "https://stackoverflow.com/users/1230603/hiroru"}, "edited": false, "score": 0, "creation_date": 1437739204, "post_id": 31607709, "comment_id": 51169569, "body": "@hiroru, here is another explanation. <a href=\"http://stackoverflow.com/questions/25754836/golang-use-regex-to-return-the-shortest-string-between-strings/25755502#25755502\" title=\"golang use regex to return the shortest string between strings\">stackoverflow.com/questions/25754836/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1160, "user_id": 4635642, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a51496675704d0fed476c58e1621068e?s=128&d=identicon&r=PG&f=1", "display_name": "Andris Leduskrasts", "link": "https://stackoverflow.com/users/4635642/andris-leduskrasts"}, "is_accepted": true, "score": 2, "last_activity_date": 1437735771, "last_edit_date": 1437735771, "creation_date": 1437732412, "answer_id": 31607709, "question_id": 31607652, "link": "https://stackoverflow.com/questions/31607652/go-lang-get-matching-substring-from-string/31607709#31607709", "title": "Go lang get matching substring from string", "body": "<p>You can just add a lazy quantifier <code>.*?</code>, <code>\".*?\"</code> being the regex, if you want to keep it simple. The reason you are getting <code>\"test\" and a \"demo\"</code> is because just <code>.*</code> is greedy and matches as much text as possible (therefore, it actually matches the <code>\"</code> before <code>test</code> and after <code>demo</code>, ignoring the fact that there are other quotes in between).</p>\n\n<p>Normally a better but in some ways slightly more complicated way to do this is using character classes <code>\"[^\"]*\"</code>, disabling matching quotes in between. This can also cause some other behaviors like including newlines (in which case you can also disable them <code>[^\"\\n]</code>, or perhaps you actually want such a case)</p>\n\n<p>Since you want to also not have the quotes some additional things need to be done. You can do that with either lookarounds: <code>(?&lt;=\")[^\"]*(?=\")</code>, or with capture groups: <code>\"(.*?)\"</code> and <code>\"([^\"]*)\"</code>. If you choose the capture group route, you have to use the capture group, not whole matches.</p>\n"}, {"comments": [{"owner": {"reputation": 129, "user_id": 1230603, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b8046dd2036cfc53129aa182f981382f?s=128&d=identicon&r=PG", "display_name": "hiroru", "link": "https://stackoverflow.com/users/1230603/hiroru"}, "edited": false, "score": 0, "creation_date": 1437739220, "post_id": 31608407, "comment_id": 51169578, "body": "Thanks Doro, this website it&#39;s awesome!"}], "tags": [], "owner": {"reputation": 687, "user_id": 2956006, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/0e6f166722b29876d722bff87f858b5b?s=128&d=identicon&r=PG", "display_name": "Doro", "link": "https://stackoverflow.com/users/2956006/doro"}, "is_accepted": false, "score": 2, "last_activity_date": 1437734396, "creation_date": 1437734396, "answer_id": 31608407, "question_id": 31607652, "link": "https://stackoverflow.com/questions/31607652/go-lang-get-matching-substring-from-string/31608407#31608407", "title": "Go lang get matching substring from string", "body": "<p>Regex:</p>\n\n<p><code>\"(.*?)\"</code></p>\n\n<p>Here is an online demo:\n<a href=\"https://regex101.com/r/sI4tA9/1\" rel=\"nofollow\">https://regex101.com/r/sI4tA9/1</a></p>\n\n<p>All you have to do now is to join matches. Unfortunately I'm not so into <code>go</code> that's why I can't help you in that case</p>\n"}], "owner": {"reputation": 129, "user_id": 1230603, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/b8046dd2036cfc53129aa182f981382f?s=128&d=identicon&r=PG", "display_name": "hiroru", "link": "https://stackoverflow.com/users/1230603/hiroru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2888, "favorite_count": 0, "accepted_answer_id": 31607709, "answer_count": 2, "score": 2, "last_activity_date": 1437735771, "creation_date": 1437732185, "last_edit_date": 1437733287, "question_id": 31607652, "link": "https://stackoverflow.com/questions/31607652/go-lang-get-matching-substring-from-string", "title": "Go lang get matching substring from string", "body": "<p>I'm trying to extract all words from a string which are between quotes.</p>\n\n<p>Here's my current code:</p>\n\n<pre><code>func StrExtract(word string) []string {\n  r, _ := regexp.Compile(`\".*\"`)\n  result := r.FindAllString(word, -1)\n  RemoveDuplicates(&amp;result)\n  return (result)\n}\n</code></pre>\n\n<p>Test the code <a href=\"https://play.golang.org/p/6-_szcjzzJ\" rel=\"nofollow\">here</a></p>\n\n<p>With an input like:</p>\n\n<pre><code>`Hi guys, this is a \"test\" and a \"demo\" ok?`\n</code></pre>\n\n<p>I get the output:</p>\n\n<pre><code>[\"test\" and a \"demo\"]\n</code></pre>\n\n<p>But I'd like to get:</p>\n\n<pre><code>[test demo]\n</code></pre>\n\n<p>Please help me fix this, or suggest better alternatives.</p>\n"}, {"tags": ["json", "struct", "go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 2, "creation_date": 1437731345, "post_id": 31607205, "comment_id": 51164710, "body": "Try <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">mholt.github.io/json-to-go</a> - which can generate a Go struct based on JSON input (provided the JSON is correctly formatted)."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1437732064, "post_id": 31607205, "comment_id": 51165168, "body": "@elithrar , thanks for the link, it seems it&#39;s a great service."}, {"owner": {"reputation": 521, "user_id": 5142896, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06a6bbe0b8d0b678f1fb3b95493d42e8?s=128&d=identicon&r=PG&f=1", "display_name": "Conor", "link": "https://stackoverflow.com/users/5142896/conor"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1437732216, "post_id": 31607205, "comment_id": 51165254, "body": "@elithrar this gives me a struct full of every single string I use in the struct. I thought it may be possible to just collect them all in a &#39;Colleges&#39; array of some sort, and then access all of them in a loop? Maybe this isn&#39;t possible and I have to make a large and very specific struct, I don&#39;t know."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1437733392, "post_id": 31607205, "comment_id": 51165977, "body": "Without seeing the whole file (or a minimal representation) it&#39;s hard to suggest a better format. Can you link to the schema? Or update your question with a (complete) sample. My suggestion otherwise would be to make separate structs for each array and then embed them into a &quot;top level&quot; struct that represents the whole schema."}, {"owner": {"reputation": 521, "user_id": 5142896, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06a6bbe0b8d0b678f1fb3b95493d42e8?s=128&d=identicon&r=PG&f=1", "display_name": "Conor", "link": "https://stackoverflow.com/users/5142896/conor"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1437734774, "post_id": 31607205, "comment_id": 51166804, "body": "@elithrar I just updated the example to something a bit larger. It will be that format. There will be about 5 colleges and then within these colleges will be numerous schools (ranging from 4 - 10 in different colleges), and each school will have a unique string key associated with it. Any ideas on a struct format for this?"}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 1, "last_activity_date": 1437733766, "creation_date": 1437733766, "answer_id": 31608194, "question_id": 31607205, "link": "https://stackoverflow.com/questions/31607205/parsing-json-file-into-struct-golang/31608194#31608194", "title": "Parsing JSON file into struct golang", "body": "<p>You have an object of objects of strings. This unmarshals most naturally into</p>\n\n<pre><code>map[string]map[string]string\n</code></pre>\n\n<p>Then just work with it as you would with any other map.</p>\n\n<p>Playground: <a href=\"http://play.golang.org/p/_IX8WUDn4b\" rel=\"nofollow\">http://play.golang.org/p/_IX8WUDn4b</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 2468, "user_id": 3380878, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/583c09a402b7ee90837fc0557dc5ba43?s=128&d=identicon&r=PG", "display_name": "Mojtabye", "link": "https://stackoverflow.com/users/3380878/mojtabye"}, "is_accepted": false, "score": 0, "last_activity_date": 1437765811, "creation_date": 1437765811, "answer_id": 31618277, "question_id": 31607205, "link": "https://stackoverflow.com/questions/31607205/parsing-json-file-into-struct-golang/31618277#31618277", "title": "Parsing JSON file into struct golang", "body": "<p>this is what i wrote to convert JSON string to struct or struct To JSON.\njust pass your struct ( like your JSON ) as <code>interface{}</code></p>\n\n<pre><code>/*\nJSONStringToStructure error\nconvert json string to given struct\n*/\nfunc JSONStringToStructure(jsonString string, structure interface{}) error {\n    jsonBytes := []byte(jsonString)\n    return json.Unmarshal(jsonBytes, structure)\n}\n\n/*\nStructureToJSON (string,error)\nconvert struct to json string\n*/\nfunc StructureToJSON(structure interface{}) (string, error) {\n    bin, err := json.Marshal(structure)\n    return string(bin), err\n}\n</code></pre>\n"}], "owner": {"reputation": 521, "user_id": 5142896, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/06a6bbe0b8d0b678f1fb3b95493d42e8?s=128&d=identicon&r=PG&f=1", "display_name": "Conor", "link": "https://stackoverflow.com/users/5142896/conor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7977, "favorite_count": 1, "accepted_answer_id": 31608194, "answer_count": 2, "score": 0, "last_activity_date": 1437765811, "creation_date": 1437730913, "last_edit_date": 1437734688, "question_id": 31607205, "link": "https://stackoverflow.com/questions/31607205/parsing-json-file-into-struct-golang", "title": "Parsing JSON file into struct golang", "body": "<p>I have this JSON file:</p>\n\n<pre><code>    {\n  \"AHSS\": {\n    \"Lifelong Learning\": \"1sVhClGzmD5N_S6wGiS9_xHj2IkVgSv_un0rktvH2Goo\",\n    \"TEST Learning\": \"1sdfVhClGzmD5N_S6wGiS9_xHj2ffgIkVgSv_un0rko56545o\",\n    \"TEST Learning2\": \"fg1ac_PiSaWzeL3bA3tjWYs23dh61sVhClHj2IkVgSv_un0rktvH2Goo\",\n    \"TEST Learning3\": \"13444sVhClGzmD5N_S6wGiS9_xHj2IkVgSv_un0rktyutvH2Goo\",\n    \"TEST Learning4\": \"6657681sVhClGzmD5N_S6wGiS9_xHj2IkVgSv_un0rktvH2Goo\"\n  },\n  \"ProfServices\": {\n    \"IT\": \"1fgac_PiSaWzeLxxdVuZs3bA3tjWY345d\",\n    \"SomethingElse\": \"1ac_Pi3bA3tjWY4563\",\n    \"Foo\": \"12ac_PiVuZs3bA3tjWYghfgj\",\n    \"Bar\": \"445341ac_PiSaWzeLxA3tjWY54\",\n    \"School1\": \"fg1ac_PiSaWzeL3bA3tjWYs23dh6\",\n    \"School2\": \"fg341ac_PiSaWzeLZs3bA3tjWYsd4\",\n    \"School3\": \"fgdf1ac_PiSaWzeLuZs3bA3tjWdgfY\"    \n  },\n  \"CollegeOfEngineering\": {\n    \"Maths\": \"asdasdasdas45\",\n    \"Physics\": \"pa6asa_Asddg\",\n    \"Astrophysics\": \"asdfdasdasda\",\n    \"School5\": \"mykeyyslaksdlkasmdlka\",\n    \"School6\": \"asdasdkeykeykeykey\"\n  },\n  \"AnotherCollege\": {\n    \"School7\": \"f111g1a2c_PiSaWzeL3bA3tjWYsdh6\",\n    \"School8\": \"f4434234g341ac_PiSafgdfgdfgWzeLZs3bA3tjWYsd4\",\n    \"School9\": \"fg23df1ac_PiSaWzeLuZs3bA3tjWdgfY\"\n  }\n}\n</code></pre>\n\n<p>This is just an example to test with, but my actual json file will have a lot more data. But the format will always be the same. I will have an array of 'Colleges' such as 'AHSS' and ProfServices'. Within these Colleges are 'Schools' such as 'IT' or ' Lifeling Learning'. Each school has its own unique key. I need to read this JSON file and convert it into a struct. </p>\n\n<p>I've tried looking around and using both json.Decode and json.Unmarshal and I'm really not sure how to get what I need. Everything I've tried prints out an empty struct. Maybe the layout of my struct in go is wrong? </p>\n\n<p>Here is the struct layout I am using (not 100% this is correct):</p>\n\n<pre><code>    // Sheets struct will import from sheets.json\n    Sheets struct {\n        Colleges []struct {\n            SheetKeys []string\n        }\n    }\n)\n</code></pre>\n\n<p>And here are two methods I tried using to achieve my goal of importing the json file into a struct.</p>\n\n<p>1)</p>\n\n<pre><code>sheetData, err := os.Open(\"sheets.json\")\nif err != nil {\n    log.Fatalln(err)\n}\n\njsonParser := json.NewDecoder(sheetData)\ns := Sheets{}\njsonParser.Decode(&amp;s)\nlog.Println(s)\n</code></pre>\n\n<p>2)</p>\n\n<pre><code>sheetData, err := ioutil.ReadFile(\"sheets.json\")\ns := Sheets{}\nerr = json.Unmarshal(sheetData, &amp;s)\nif err != nil {\n    log.Fatalln(err)\n}\n\nlog.Println(s)\n</code></pre>\n\n<p>Can anybody provide a method of importing this json file correctly? I'm not sure if its a problem with my method of doing it, or if its a problem with the struct layout. </p>\n\n<p>Thanks.</p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 1, "creation_date": 1437726296, "post_id": 31602980, "comment_id": 51161613, "body": "Can you elaborate more ? Can you post your code"}, {"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1437781161, "post_id": 31602980, "comment_id": 51191664, "body": "I updated the question with some code. I skipped the console entirely and went programmatically because it seems easier to describe that way. I&#39;d like to understand better the key hierarchy aspect of datastores. I find it still a bit confusing coming from RDBMS."}], "owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1437775761, "creation_date": 1437716440, "last_edit_date": 1437775761, "question_id": 31602980, "link": "https://stackoverflow.com/questions/31602980/how-do-i-set-up-2-entities-to-run-a-query-join-using-an-indexed-key", "title": "How do I set up 2 entities to run a query join using an indexed key", "body": "<p>I want to create two tables, er entities:</p>\n\n<pre><code>User { UserID: String, UserName: String }\nUserSession { SessionID: String, UserID: String, LoginTime: Date }\n</code></pre>\n\n<p>Using the console dashboard in gae, I can't seem to be able to define the UserSession's UserID (a sort of secondary key) to represent the key in the first entity such as <code>Key('User', 'UserID')</code>. The syntax fails.</p>\n\n<p>Extra issue: I can't define the LoginTime as a date because it wants a default value. Why can't the property be set as blank when creating the entity?</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Here is the code I am using. Can you please validate if this is the right way to get back user data by linking the entities with parenting?</p>\n\n<pre><code>package testapp\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"time\"\n\n    \"appengine\"\n    \"appengine/datastore\"\n)\n\ntype User struct {\n    Name       string\n    FullName   string `datastore:\",noindex\"`\n    Password   string `datastore:\",noindex\"`\n    IsDisabled bool   `datastore:\",noindex\"`\n}\n\ntype Session struct {\n    LoginTime time.Time `datastore:\",noindex\"`\n    LastSeen  time.Time `datastore:\",noindex\"`\n}\n\nfunc init() {\n    http.HandleFunc(\"/\", handler)\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    c := appengine.NewContext(r)\n\n    u := User{\n        Name:       \"john\",\n        FullName:   \"John Difool\",\n        Password:   \"secret\",\n        IsDisabled: false}\n\n    userId, err := datastore.Put(c, datastore.NewIncompleteKey(c, \"user\", nil), &amp;u)\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    s := Session{\n        LoginTime: time.Now(),\n        LastSeen:  time.Now()}\n\n    key, err := datastore.Put(c, datastore.NewIncompleteKey(c, \"session\", userId), &amp;s) // parent is user\n    if err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    // store key and later on get it back\n\n    t := new(Session)\n    if err := datastore.Get(c, key, t); err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    // let's get back user's data using parent key\n\n    e := new(User)\n    if err := datastore.Get(c, key.Parent(), e); err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n        return\n    }\n\n    w.Header().Set(\"Content-Type\", \"text/plain; charset=utf-8\")\n    fmt.Fprintf(w, \"name=%q\\npassword=%q\\n\", e.Name, e.Password)\n}\n</code></pre>\n"}, {"tags": ["linux", "go"], "answers": [{"comments": [{"owner": {"reputation": 1165, "user_id": 1097179, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/fac94cfbbcb5985e1b80ac0b6ce27ed3?s=128&d=identicon&r=PG", "display_name": "CCates", "link": "https://stackoverflow.com/users/1097179/ccates"}, "edited": false, "score": 0, "creation_date": 1437711848, "post_id": 31602142, "comment_id": 51155286, "body": "I don&#39;t quite understand the nohup shell command. What does &gt;/dev/null 2&gt;&amp;1 &amp; mean???"}, {"owner": {"reputation": 991, "user_id": 380588, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1c5876b20f66d1e1a6d6994bfbe144a5?s=128&d=identicon&r=PG", "display_name": "Felipe Arenales", "link": "https://stackoverflow.com/users/380588/felipe-arenales"}, "reply_to_user": {"reputation": 1165, "user_id": 1097179, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/fac94cfbbcb5985e1b80ac0b6ce27ed3?s=128&d=identicon&r=PG", "display_name": "CCates", "link": "https://stackoverflow.com/users/1097179/ccates"}, "edited": false, "score": 0, "creation_date": 1437711914, "post_id": 31602142, "comment_id": 51155303, "body": "&gt;/dev/null means &quot;redirect stdout to /dev/null (don&#39;t print anything from stdout on screen); 2&gt;&amp;1 means &quot;redirect stderr to stdout (which is /dev/null, so anything from both stdout and stderr will be print on screen); &amp; means &quot;run in background&quot;"}, {"owner": {"reputation": 1165, "user_id": 1097179, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/fac94cfbbcb5985e1b80ac0b6ce27ed3?s=128&d=identicon&r=PG", "display_name": "CCates", "link": "https://stackoverflow.com/users/1097179/ccates"}, "edited": false, "score": 0, "creation_date": 1437712022, "post_id": 31602142, "comment_id": 51155332, "body": "But what about 2&gt;&amp;1 &amp;???  Also does the .sh script run from the root directory are the base directory?"}, {"owner": {"reputation": 991, "user_id": 380588, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1c5876b20f66d1e1a6d6994bfbe144a5?s=128&d=identicon&r=PG", "display_name": "Felipe Arenales", "link": "https://stackoverflow.com/users/380588/felipe-arenales"}, "reply_to_user": {"reputation": 1165, "user_id": 1097179, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/fac94cfbbcb5985e1b80ac0b6ce27ed3?s=128&d=identicon&r=PG", "display_name": "CCates", "link": "https://stackoverflow.com/users/1097179/ccates"}, "edited": false, "score": 0, "creation_date": 1437712144, "post_id": 31602142, "comment_id": 51155362, "body": "You have to put the .sh script in the same location you have myapp.go (or modify the .sh script properly)"}, {"owner": {"reputation": 30697, "user_id": 31667, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/082b069c287878a1bd5731f44c8f10e7?s=128&d=identicon&r=PG", "display_name": "viraptor", "link": "https://stackoverflow.com/users/31667/viraptor"}, "edited": false, "score": 1, "creation_date": 1437721040, "post_id": 31602142, "comment_id": 51158675, "body": "Same as screen solution - this will not survive system reboot. Not sure if that qualifies as &quot;make sure that it is always running&quot;."}], "tags": [], "owner": {"reputation": 991, "user_id": 380588, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1c5876b20f66d1e1a6d6994bfbe144a5?s=128&d=identicon&r=PG", "display_name": "Felipe Arenales", "link": "https://stackoverflow.com/users/380588/felipe-arenales"}, "is_accepted": false, "score": 0, "last_activity_date": 1437711751, "creation_date": 1437711751, "answer_id": 31602142, "question_id": 31602094, "link": "https://stackoverflow.com/questions/31602094/how-to-run-a-go-app-continously-on-an-ubuntu-server/31602142#31602142", "title": "How to run a go app continously on an Ubuntu server", "body": "<p>You can put it in an inifiny loop, such as:</p>\n\n<pre><code>#! /bin/sh\nwhile true; do\n  go run myapp.go\n  sleep 2 # Just in case\ndone\n</code></pre>\n\n<p>Hence, once the app dies due some reason, it will be run again.</p>\n\n<p>You can put it in a script and run it in background using:</p>\n\n<pre><code>$ nohup ./my-script.sh &gt;/dev/null 2&gt;&amp;1 &amp;\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1165, "user_id": 1097179, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/fac94cfbbcb5985e1b80ac0b6ce27ed3?s=128&d=identicon&r=PG", "display_name": "CCates", "link": "https://stackoverflow.com/users/1097179/ccates"}, "edited": false, "score": 0, "creation_date": 1437712140, "post_id": 31602177, "comment_id": 51155360, "body": "This is much more useful! Thank you!"}, {"owner": {"reputation": 30697, "user_id": 31667, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/082b069c287878a1bd5731f44c8f10e7?s=128&d=identicon&r=PG", "display_name": "viraptor", "link": "https://stackoverflow.com/users/31667/viraptor"}, "edited": false, "score": 2, "creation_date": 1437720969, "post_id": 31602177, "comment_id": 51158636, "body": "This is correct only for some value of &quot;persist&quot;. It will survive terminal being closed, but it will not survive server reboot. That doesn&#39;t qualify as &quot;persist&quot; usually."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 2, "creation_date": 1437729464, "post_id": 31602177, "comment_id": 51163560, "body": "It also won&#39;t restart your app when it crashes, handle logs (capture or rotate them), etc. Running a server via screen is very fragile."}], "tags": [], "owner": {"reputation": 1800, "user_id": 2372663, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/D76OC.jpg?s=128&g=1", "display_name": "petomalina", "link": "https://stackoverflow.com/users/2372663/petomalina"}, "is_accepted": false, "score": 0, "last_activity_date": 1437711944, "creation_date": 1437711944, "answer_id": 31602177, "question_id": 31602094, "link": "https://stackoverflow.com/questions/31602094/how-to-run-a-go-app-continously-on-an-ubuntu-server/31602177#31602177", "title": "How to run a go app continously on an Ubuntu server", "body": "<p>You may want to go for virtual terminal utility like screen here. Example:</p>\n\n<pre><code>screen -S myapp # create screen with name myapp\ncd ... # to your app directory\ngo run myapp.go # or go install and then ./myappfrom go bin dir\nCtrl-a+d # to go out of screen\n</code></pre>\n\n<p>If you want to return to the screen:</p>\n\n<pre><code>screen -r myapp\n</code></pre>\n\n<p>EDIT: this solution will persist the process when you go out of terminal, but won't restart it when it'll crash.</p>\n"}, {"comments": [{"owner": {"reputation": 1800, "user_id": 2372663, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/D76OC.jpg?s=128&g=1", "display_name": "petomalina", "link": "https://stackoverflow.com/users/2372663/petomalina"}, "edited": false, "score": 1, "creation_date": 1437714148, "post_id": 31602363, "comment_id": 51155850, "body": "While using systemd, you can then use journalctl to obtain logs"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1437729539, "post_id": 31602363, "comment_id": 51163613, "body": "Great answer. There&#39;s also Supervisor, which I discussed in this answer: <a href=\"http://stackoverflow.com/a/30950683/556573\">stackoverflow.com/a/30950683/556573</a>"}], "tags": [], "owner": {"reputation": 30697, "user_id": 31667, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/082b069c287878a1bd5731f44c8f10e7?s=128&d=identicon&r=PG", "display_name": "viraptor", "link": "https://stackoverflow.com/users/31667/viraptor"}, "is_accepted": true, "score": 5, "last_activity_date": 1437713524, "last_edit_date": 1437713524, "creation_date": 1437713095, "answer_id": 31602363, "question_id": 31602094, "link": "https://stackoverflow.com/questions/31602094/how-to-run-a-go-app-continously-on-an-ubuntu-server/31602363#31602363", "title": "How to run a go app continously on an Ubuntu server", "body": "<p>Use the capabilities your init process provides. You're likely running system with either Systemd or Upstart. They've both got really easy descriptions of services and can ensure your app runs with the right privileges, is restarted when anything goes down, and that the output is are handled correctly.</p>\n\n<p>For quick <a href=\"http://upstart.ubuntu.com/getting-started.html\">Upstart description look here</a>, your service description is likely to be just:</p>\n\n<pre><code>start on runlevel [2345]\nstop on runlevel [!2345]\nsetuid the_username_your_app_runs_as\nexec /path/to/your/app --options\n</code></pre>\n\n<p>For quick <a href=\"http://www.freedesktop.org/software/systemd/man/systemd.service.html\">Systemd description look here</a>, your service is likely to be just:</p>\n\n<pre><code>[Unit]\nDescription=Your service\n\n[Service]\nUser=the_username_your_app_runs_as\nExecStart=/path/to/your/app --options\n\n[Install]\nWantedBy=multi-user.target\n</code></pre>\n"}], "owner": {"reputation": 1165, "user_id": 1097179, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/fac94cfbbcb5985e1b80ac0b6ce27ed3?s=128&d=identicon&r=PG", "display_name": "CCates", "link": "https://stackoverflow.com/users/1097179/ccates"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1032, "favorite_count": 0, "accepted_answer_id": 31602363, "answer_count": 3, "score": 1, "last_activity_date": 1437713524, "creation_date": 1437711388, "question_id": 31602094, "link": "https://stackoverflow.com/questions/31602094/how-to-run-a-go-app-continously-on-an-ubuntu-server", "title": "How to run a go app continously on an Ubuntu server", "body": "<p>Couldn't seem to find a direct answer around here.</p>\n\n<p>I'm not sure if I should run ./myBinary as a Cron process or if I should run \"go run myapp.go\"</p>\n\n<p>What's an effective way to make sure that it is always running?\nSorry I'm used to Apache and Nginx.</p>\n\n<p>Also what are best practices for deploying a Go app? I want everything (preferably) all served on the same server. Just like how my development environment is like.</p>\n\n<p>I read something else that used S3, but, I really don't want to use S3.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 0, "creation_date": 1437710251, "post_id": 31601805, "comment_id": 51154944, "body": "this method overwrites the existing field tags."}, {"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "reply_to_user": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 1, "creation_date": 1437712832, "post_id": 31601805, "comment_id": 51155527, "body": "Yes.  It replaces the default marshalling (including parsing of struct field tags).  But that&#39;s what you&#39;ll have to live with if you want what you asked for."}], "tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": false, "score": 5, "last_activity_date": 1437709228, "last_edit_date": 1592644375, "creation_date": 1437709228, "answer_id": 31601805, "question_id": 31601699, "link": "https://stackoverflow.com/questions/31601699/golang-variable-inside-json-field-tag/31601805#31601805", "title": "Golang variable inside json field tag", "body": "<p>You can customise how a type is marshaled by implementing the <a href=\"http://golang.org/pkg/encoding/json/#Marshaler\" rel=\"noreferrer\"><code>json.Marshaler</code> interface</a>.  This overrides the default behaviour of introspecting the fields of structs.</p>\n<p>For this particular example, you could do something like:</p>\n<pre><code>func (s MyStruct) MarshalJSON() ([]byte, error) {\n    data := map[string]interface{}{\n        key: s.field,\n    }\n    return json.Marshal(data)\n}\n</code></pre>\n<p>Here I'm constructing a <code>map[string]interface{}</code> value that represents what I want in the JSON output and passing it to <code>json.Marshal</code>.</p>\n<p>You can test out this example here: <a href=\"http://play.golang.org/p/oTmuNMz-0e\" rel=\"noreferrer\">http://play.golang.org/p/oTmuNMz-0e</a></p>\n"}], "owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2088, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1437709228, "creation_date": 1437708429, "question_id": 31601699, "link": "https://stackoverflow.com/questions/31601699/golang-variable-inside-json-field-tag", "title": "Golang variable inside json field tag", "body": "<p>Is there a way to change structs field tag dynamicly?</p>\n\n<pre><code>key := \"mykey\"\n\n// a struct definition like\nMyStruct struct {\n    field `json:key` //or field `json:$key` \n}\n\n// I want the following output\n{\n     \"mykey\": 5\n}\n</code></pre>\n\n<p>Couldn't find anything in the <a href=\"http://golang.org/pkg/encoding/json/#Marshal\" rel=\"noreferrer\">documentation</a>.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": true, "score": 2, "last_activity_date": 1437696265, "creation_date": 1437696265, "answer_id": 31600100, "question_id": 31599836, "link": "https://stackoverflow.com/questions/31599836/marshal-embedded-struct/31600100#31600100", "title": "Marshal Embedded Struct", "body": "<p>Your JSON dictionary is empty because none of the fields of the struct (or any of the structures embedded inside the struct) are <a href=\"http://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow\">exported</a>.</p>\n\n<p>If you change the field names to start with an upper case letter, then the <code>encoding/json</code> module will be able to see them.  Of course since you've also got methods called <code>Name</code> and <code>Value</code>, you'll need to call them something else to avoid a conflict.</p>\n"}], "owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 190, "favorite_count": 0, "accepted_answer_id": 31600100, "answer_count": 1, "score": 0, "last_activity_date": 1437696265, "creation_date": 1437694550, "question_id": 31599836, "link": "https://stackoverflow.com/questions/31599836/marshal-embedded-struct", "title": "Marshal Embedded Struct", "body": "<p>I was playing around to learn how embedding works. <a href=\"http://play.golang.org/p/oHOim4G1-l\" rel=\"nofollow\">http://play.golang.org/p/oHOim4G1-l</a> </p>\n\n<p>When I marshalled Child struct it marshals as <code>{}</code>. Why does it marshal like this?</p>\n"}, {"tags": ["swift", "go", "nsdate", "nsdateformatter"], "comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1437687863, "post_id": 31598499, "comment_id": 51148858, "body": "have you even tried to search for it like for example &quot;Z in timezone&quot;?"}, {"owner": {"reputation": 2718, "user_id": 4934077, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e5DyJ.png?s=128&g=1", "display_name": "Mario Zannone", "link": "https://stackoverflow.com/users/4934077/mario-zannone"}, "edited": false, "score": 0, "creation_date": 1437688447, "post_id": 31598499, "comment_id": 51149131, "body": "T is just used to separate Time from fate. Z is the timezone (Zulu)."}, {"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "reply_to_user": {"reputation": 2718, "user_id": 4934077, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e5DyJ.png?s=128&g=1", "display_name": "Mario Zannone", "link": "https://stackoverflow.com/users/4934077/mario-zannone"}, "edited": false, "score": 0, "creation_date": 1437688660, "post_id": 31598499, "comment_id": 51149215, "body": "@MarioZannone Is there a need for <code>T</code>? why not just space?"}, {"owner": {"reputation": 2718, "user_id": 4934077, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e5DyJ.png?s=128&g=1", "display_name": "Mario Zannone", "link": "https://stackoverflow.com/users/4934077/mario-zannone"}, "edited": false, "score": 3, "creation_date": 1437688826, "post_id": 31598499, "comment_id": 51149279, "body": "It&#39;s an ISO standard (ISO8601)"}, {"owner": {"reputation": 2718, "user_id": 4934077, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e5DyJ.png?s=128&g=1", "display_name": "Mario Zannone", "link": "https://stackoverflow.com/users/4934077/mario-zannone"}, "edited": false, "score": 0, "creation_date": 1437689062, "post_id": 31598499, "comment_id": 51149378, "body": "Anyway, in order to convert to an NSDate have a look at the NSDateFormatter documentation and <a href=\"http://stackoverflow.com/questions/28791771/swift-iso-8601-date-formatting-with-ios7\">here</a>"}, {"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "reply_to_user": {"reputation": 2718, "user_id": 4934077, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e5DyJ.png?s=128&g=1", "display_name": "Mario Zannone", "link": "https://stackoverflow.com/users/4934077/mario-zannone"}, "edited": false, "score": 0, "creation_date": 1437689738, "post_id": 31598499, "comment_id": 51149632, "body": "@MarioZannone I did try. The correct format looked like <code>yyyy-MM-dd&#39;T&#39;HH:mm:ssXX</code> but it doesn&#39;t work. <code>yyyy-MM-dd&#39;T&#39;HH:mm:ssZZZZ</code> didn&#39;t work either. The orijinal string I&#39;m working on is <code>2015-07-21T05:34:00.448575Z</code>"}, {"owner": {"reputation": 2718, "user_id": 4934077, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e5DyJ.png?s=128&g=1", "display_name": "Mario Zannone", "link": "https://stackoverflow.com/users/4934077/mario-zannone"}, "edited": false, "score": 1, "creation_date": 1437690420, "post_id": 31598499, "comment_id": 51149850, "body": "Look also <a href=\"http://stackoverflow.com/questions/30269378/swift-converting-json-date-to-swift-compatible-date\">here</a>"}, {"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "reply_to_user": {"reputation": 2718, "user_id": 4934077, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e5DyJ.png?s=128&g=1", "display_name": "Mario Zannone", "link": "https://stackoverflow.com/users/4934077/mario-zannone"}, "edited": false, "score": 0, "creation_date": 1437690640, "post_id": 31598499, "comment_id": 51149913, "body": "@MarioZannone Thank you this was it. You could post it as an answer :)"}], "answers": [{"comments": [{"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 0, "creation_date": 1437688836, "post_id": 31598759, "comment_id": 51149284, "body": "But why is the marshalled time and the printed time different?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 1, "creation_date": 1437690142, "post_id": 31598759, "comment_id": 51149772, "body": "@Thellimist because when marshal the json, the package uses reflection to iterate the types properties and format them for json. The a <code>time.Date</code> is formatted it&#39;s using the default format string. What I was trying to explain is that you can either avoid that by using a string in the struct you marshal, or you can implement that method so that when the <code>time.Date</code> is formatted it&#39;s using one of the ones you need."}, {"owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "edited": false, "score": 0, "creation_date": 1437690388, "post_id": 31598759, "comment_id": 51149838, "body": "I understood your answer. I was wondering why they were different also. Wish I had asked as a separate question :) While reflection why doesn&#39;t it converts as a default format string"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1437690225, "last_edit_date": 1437690225, "creation_date": 1437688584, "answer_id": 31598759, "question_id": 31598499, "link": "https://stackoverflow.com/questions/31598499/convert-json-marshall-time-to-nsdate/31598759#31598759", "title": "convert json marshall time to nsdate", "body": "<p>The meaning of those values is irrelevant, they're part of that format (ISO8601). There are a couple approaches to this. One is to define a custom <code>MarshalJSON()</code> method for time or your struct and use it to format the date, the other is to represent it as a string in your struct in the first place so that when the default implementation executes you get the result you're looking for.</p>\n\n<p>The method you'll ultimately need to use is; <code>time.Format(format string)</code>\nThe golang docs show this example for using it;</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    // layout shows by example how the reference time should be represented.\n    const layout = \"Jan 2, 2006 at 3:04pm (MST)\"\n    t := time.Date(2009, time.November, 10, 15, 0, 0, 0, time.Local)\n    fmt.Println(t.Format(layout))\n    fmt.Println(t.UTC().Format(layout))\n}\n</code></pre>\n\n<p>The medium date format in that link for example would use the string <code>\"Jan. 2, 2006\"</code></p>\n"}], "owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 175, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1437690225, "creation_date": 1437687532, "last_edit_date": 1437688612, "question_id": 31598499, "link": "https://stackoverflow.com/questions/31598499/convert-json-marshall-time-to-nsdate", "title": "convert json marshall time to nsdate", "body": "<p>When I marshall <code>time.Now()</code> to JSON object it gives result as <code>\"2009-11-10T23:00:00Z\"</code> but printing <code>time.Now</code> gives <code>2009-11-10 23:00:00 +0000 UTC</code>. Why are they different. What are <code>T</code> and <code>Z</code>. Also how can I convert it to swift NSDate object according to <a href=\"http://userguide.icu-project.org/formatparse/datetime\" rel=\"nofollow\">this</a> table?</p>\n"}, {"tags": ["go", "websocket"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1437711452, "post_id": 31598147, "comment_id": 51155194, "body": "Change the Gorilla hub field from `\tconnections map[*connection]bool` to <code>connections map[string]*connection</code> where the string key is the id. Add a <code>id string</code> field to connection. Assign id when connection is created and minor changes for map type. Done."}, {"owner": {"reputation": 406, "user_id": 1644647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qZyFl.jpg?s=128&g=1", "display_name": "jabgibson", "link": "https://stackoverflow.com/users/1644647/jabgibson"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1437775162, "post_id": 31598147, "comment_id": 51189978, "body": "I agree with @BravadaZadada. There are complex ways to accomplish this, but your need is basic. Just assign any new websocket.Connection a unique key in your map, and when you are ready to write to it call mapname[&quot;clientname&quot;].WriteMessage(1, []byte(msg))"}], "answers": [{"tags": [], "owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "is_accepted": false, "score": 0, "last_activity_date": 1437717850, "last_edit_date": 1437717850, "creation_date": 1437689077, "answer_id": 31598866, "question_id": 31598147, "link": "https://stackoverflow.com/questions/31598147/how-to-send-to-only-one-client-and-not-all-clients-using-go-and-gorilla-websocke/31598866#31598866", "title": "How to send to only one client and not all clients using Go and gorilla websocket", "body": "<blockquote>\n  <p>Is there a way for me to get the unique id of a connection which I can\n  save in a database like redis and link it to a user id in the same\n  database, and then use that websocket id to send back to a specific\n  client if that user id received a message or a notification?</p>\n</blockquote>\n\n<p>Sure! You can generate Id by yourself while user registering. Just add userId field in <code>connection</code> structure</p>\n\n<p>In chat example you have hub, which contains connections pool. That pool is using to broadcast messages to all users:</p>\n\n<pre><code>case m := &lt;-h.broadcast:\n    for c := range h.connections {\n        select {\n        case c.send &lt;- m:\n        default:\n            close(c.send)\n            delete(h.connections, c)\n        }\n    }\n}\n</code></pre>\n\n<p>So there you go. You should make method to send private message, depend on userId</p>\n"}], "owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2587, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1437717850, "creation_date": 1437686075, "question_id": 31598147, "link": "https://stackoverflow.com/questions/31598147/how-to-send-to-only-one-client-and-not-all-clients-using-go-and-gorilla-websocke", "title": "How to send to only one client and not all clients using Go and gorilla websocket", "body": "<p>I am trying to learn websockets with Go. I have been looking at examples with gorilla websocket.</p>\n\n<p>I have checked out these 2 examples that show how to use gorilla websocket:</p>\n\n<p><a href=\"https://github.com/gorilla/websocket/tree/master/examples\" rel=\"nofollow\">https://github.com/gorilla/websocket/tree/master/examples</a></p>\n\n<p><a href=\"https://www.youtube.com/watch?v=ysAZ_oqPOo0\" rel=\"nofollow\">https://www.youtube.com/watch?v=ysAZ_oqPOo0</a></p>\n\n<p>All of these examples show how to connect to a websocket server, send and receive texts. But what I don't understand is how you can send to only one client. Because in a real world application you will have users, and we don't want all users to receive the same message and same data. Is there a way for me to get the unique id of a connection which I can save in a database like redis and link it to a user id in the same database, and then use that websocket id to send back to a specific client if that user id received a message or a notification? Is this how one would go about and achieve something like this? If that is the case, how would I that?</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 321, "user_id": 3813329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff643e700da449870063dc9163c4c7dc?s=128&d=identicon&r=PG", "display_name": "esnible", "link": "https://stackoverflow.com/users/3813329/esnible"}, "edited": false, "score": 0, "creation_date": 1437694624, "post_id": 31598184, "comment_id": 51151169, "body": "Perfect!  I changed to      a := map[string]interface{} {&quot;foo&quot;: 1.0, &quot;bar&quot;: 2.0};     b := map[string]interface{} {&quot;bar&quot;: 2.0, &quot;foo&quot;: 1.0}  and it worked as expected."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 321, "user_id": 3813329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff643e700da449870063dc9163c4c7dc?s=128&d=identicon&r=PG", "display_name": "esnible", "link": "https://stackoverflow.com/users/3813329/esnible"}, "edited": false, "score": 0, "creation_date": 1437726216, "post_id": 31598184, "comment_id": 51161558, "body": "@esnible If this answers your question, you should accept it by <a href=\"http://stackoverflow.com/help/someone-answers\">clicking on the check mark</a>."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 3, "last_activity_date": 1437686278, "creation_date": 1437686278, "answer_id": 31598184, "question_id": 31597873, "link": "https://stackoverflow.com/questions/31597873/deepequal-why-does-an-unmarshalled-map-return-deepequal-results-differently-t/31598184#31598184", "title": "DeepEqual: Why does an unmarshalled map return DeepEqual() results differently than a seemingly identical literal", "body": "<p>This answers your question:</p>\n\n<pre><code>fmt.Printf(\"%T\\n\", b[\"foo\"]) // Prints \"float64\" after unmarshaling.\n</code></pre>\n\n<p>JSON numbers are 64-bit floating point numbers, while your original map values were integers. From the <a href=\"http://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow\">docs</a>:</p>\n\n<blockquote>\n  <p>To unmarshal JSON into an interface value, Unmarshal stores one of these in the interface value:</p>\n\n<pre><code>bool, for JSON booleans\nfloat64, for JSON numbers\nstring, for JSON strings\n[]interface{}, for JSON arrays\nmap[string]interface{}, for JSON objects\nnil for JSON null\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 321, "user_id": 3813329, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff643e700da449870063dc9163c4c7dc?s=128&d=identicon&r=PG", "display_name": "esnible", "link": "https://stackoverflow.com/users/3813329/esnible"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 196, "favorite_count": 0, "accepted_answer_id": 31598184, "answer_count": 1, "score": 1, "last_activity_date": 1437689241, "creation_date": 1437684945, "last_edit_date": 1437689241, "question_id": 31597873, "link": "https://stackoverflow.com/questions/31597873/deepequal-why-does-an-unmarshalled-map-return-deepequal-results-differently-t", "title": "DeepEqual: Why does an unmarshalled map return DeepEqual() results differently than a seemingly identical literal", "body": "<p>I don't understand how to compare unmarshalled JSON.  Example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"encoding/json\"\n)\n\nfunc main() {\n    a := map[string]interface{} {\"foo\": 1, \"bar\": 2}\n    b := map[string]interface{} {\"bar\": 2, \"foo\": 1}\n    fmt.Printf(\"Literal B is %v, DeepEqual is %v\\n\", b, reflect.DeepEqual(a, b))\n\n    err := json.Unmarshal([]byte(`{\"bar\": 2, \"foo\": 1}`), &amp;b)\n    if err != nil {\n        panic(\"Could not unmarshal\")\n    }\n    fmt.Printf(\"Umarshalled B is %v, DeepEqual is %v\\n\", b, reflect.DeepEqual(a, b))\n}\n</code></pre>\n\n<p>prints</p>\n\n<p><em>Literal B is map[bar:2 foo:1], DeepEqual is <strong>true</strong></em></p>\n\n<p><em>Umarshalled B is map[bar:2 foo:1], DeepEqual is <strong>false</strong></em></p>\n\n<p>What is different about the B initialized from a literal and B after JSON is unmarshalled upon it?</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 2861, "user_id": 929510, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z568f.png?s=128&g=1", "display_name": "Staven", "link": "https://stackoverflow.com/users/929510/staven"}, "edited": false, "score": 0, "creation_date": 1437689148, "post_id": 31597510, "comment_id": 51149400, "body": "This has absolutely nothing to do with JSON. You should just have asked how to iterate over a slice. Where you got the slice from doesn&#39;t make any difference."}], "answers": [{"tags": [], "owner": {"reputation": 31570, "user_id": 56837, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/t20K1.jpg?s=128&g=1", "display_name": "Stefan Arentz", "link": "https://stackoverflow.com/users/56837/stefan-arentz"}, "is_accepted": true, "score": 1, "last_activity_date": 1437683913, "creation_date": 1437683913, "answer_id": 31597592, "question_id": 31597510, "link": "https://stackoverflow.com/questions/31597510/iterate-over-json-array-in-go-to-extract-values/31597592#31597592", "title": "Iterate over json array in Go to extract values", "body": "<p>You mean something like this:</p>\n\n<pre><code>for _, repo := range configuration.Repos {\n    fmt.Println(repo)\n}\n</code></pre>\n\n<p>Note that the code in your example should not work with the JSON that you have given. There is no mapping between <code>value</code> and <code>Repos</code>. You either have posted incorrect JSON or omitted a tag on the <code>Configuration</code> struct to map it correctly.</p>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1437684912, "creation_date": 1437684912, "answer_id": 31597866, "question_id": 31597510, "link": "https://stackoverflow.com/questions/31597510/iterate-over-json-array-in-go-to-extract-values/31597866#31597866", "title": "Iterate over json array in Go to extract values", "body": "<p>Everything worked fine, it's just your printing that is not doing what you expect. Since Repos is an array you'll have to iterate it to print each value individually. Try something like this;</p>\n\n<pre><code>for _, repo := range configuration.Repos {\n    fmt.Println(repo)\n}\n</code></pre>\n"}], "owner": {"reputation": 2467, "user_id": 926190, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/098f89dd510cdc23243f3c19902a2af8?s=128&d=identicon&r=PG&f=1", "display_name": "jmreicha", "link": "https://stackoverflow.com/users/926190/jmreicha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1691, "favorite_count": 0, "accepted_answer_id": 31597592, "answer_count": 2, "score": 1, "last_activity_date": 1437685621, "creation_date": 1437683644, "last_edit_date": 1437685621, "question_id": 31597510, "link": "https://stackoverflow.com/questions/31597510/iterate-over-json-array-in-go-to-extract-values", "title": "Iterate over json array in Go to extract values", "body": "<p>I have the following in my json array (conf.json file).</p>\n\n<pre><code>{\n  \"Repos\": [\n      \"a\",\n      \"b\",\n      \"c\"\n  ]\n}\n</code></pre>\n\n<p>I am attempting to read this json and then iterate over it but get stuck.  I am very new to go (and to programming) so I am having a hard time understanding what is happening here.</p>\n\n<pre><code>import (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n)\n\ntype Configuration struct {\n    Repos []string\n}\n\nfunc read_config() {\n    file, _ := os.Open(\"conf.json\")\n    decoder := json.NewDecoder(file)\n    configuration := Configuration{}\n    err := decoder.Decode(&amp;configuration)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n\n    fmt.Println(configuration.Repos)\n}\n</code></pre>\n\n<p>So far this is as far as I have been able to get.  This will print out the values okay, <code>[a, b, c]</code>.</p>\n\n<p>What I would like to do is be able to iterate over the array and split out each value individually but have not had any luck at doing this.  Am I taking the wrong approach to this?  Is there a better way to do this?</p>\n"}, {"tags": ["linux", "macos", "go"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 6, "creation_date": 1437682353, "post_id": 31597096, "comment_id": 51146038, "body": "The main function finishes before the &quot;world&quot; goroutine can print for the fifth time. This is a race condition."}, {"owner": {"reputation": 39, "user_id": 2583706, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d6945c309a776aa68e0392759b317bb?s=128&d=identicon&r=PG", "display_name": "Matyunin", "link": "https://stackoverflow.com/users/2583706/matyunin"}, "reply_to_user": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1437684070, "post_id": 31597096, "comment_id": 51146976, "body": "@inf, yep, also i got good answer from one of go collaborators <a href=\"https://github.com/golang/go/issues/11848#issuecomment-124226261\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/11848#issuecomment-124226261</a>  Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": true, "score": 2, "last_activity_date": 1437697258, "creation_date": 1437697258, "answer_id": 31600237, "question_id": 31597096, "link": "https://stackoverflow.com/questions/31597096/different-behavior-in-go1-5beta2-on-macos-and-linux/31600237#31600237", "title": "Different behavior in go1.5beta2 on MacOS and Linux", "body": "<p>From <a href=\"http://golang.org/ref/spec#Program_execution\" rel=\"nofollow\">the specification</a>:</p>\n\n<blockquote>\n  <p>Program execution begins by initializing the main package and then invoking the function <code>main</code>. When that function invocation returns, the program exits. It does not wait for other (non-<code>main</code>) goroutines to complete.</p>\n</blockquote>\n\n<p>So there is no guarantee that the goroutine printing <code>\"world\"</code> will have time to complete before the program exits.</p>\n\n<p>I suspect that if you run the program enough times, you will see both the 9-line and 10-line outputs on both platforms.  Setting the <code>GOMAXPROCS</code> environment variable to 2 might also help in triggering the problem.</p>\n\n<p>You can fix it by making the main goroutine explicitly wait for completion of the other goroutine.  For instance, using a channel:</p>\n\n<pre><code>func say(s string, done chan&lt;- bool) {\n    for i := 0; i &lt; 5; i++ {\n        time.Sleep(1000 * time.Millisecond)\n        fmt.Println(s)\n    }\n    done &lt;- true\n}\n\nfunc main() {\n    c := make(chan bool, 2)\n    go say(\"world\", c)\n    say(\"hello\", c)\n    &lt;-c\n    &lt;-c\n}\n</code></pre>\n\n<p>I've added a buffer to the channel so that the <code>say</code> function can send a value without blocking (primarily so the <code>\"hello\"</code> invocation actually returns).  I then wait receive two values from the channel to make sure both invocations have completed.</p>\n\n<p>For more complex programs, the <a href=\"http://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow\"><code>sync.WaitGroup</code></a> type can provide a more convenient way to wait on multiple goroutines.</p>\n"}], "owner": {"reputation": 39, "user_id": 2583706, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d6945c309a776aa68e0392759b317bb?s=128&d=identicon&r=PG", "display_name": "Matyunin", "link": "https://stackoverflow.com/users/2583706/matyunin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 31600237, "answer_count": 1, "score": 1, "last_activity_date": 1437697258, "creation_date": 1437682062, "question_id": 31597096, "link": "https://stackoverflow.com/questions/31597096/different-behavior-in-go1-5beta2-on-macos-and-linux", "title": "Different behavior in go1.5beta2 on MacOS and Linux", "body": "<p>The example is taken from the \"A Tour of Go\": <a href=\"https://tour.golang.org/concurrency/1\" rel=\"nofollow\">https://tour.golang.org/concurrency/1</a></p>\n\n<p>Obviously, program output should have 10 rows: 5 for \"hello\" and 5 for \"world\".</p>\n\n<p>But we have on:</p>\n\n<ul>\n<li>Linux - 9 rows</li>\n<li>MacOS - 10 rows</li>\n</ul>\n\n<p>Linux output (9 rows):</p>\n\n<pre><code>$ go run 1.go \nhello\nworld\nhello\nworld\nhello\nworld\nworld\nhello\nhello\n</code></pre>\n\n<p>MacOS X output (10 rows):</p>\n\n<pre><code>$ go run 1.go \nhello\nworld\nworld\nhello\nhello\nworld\nhello\nworld\nhello\nworld\n</code></pre>\n\n<p>Can anyone explain - <strong>why</strong>?</p>\n\n<p>Linux <code>uname -a</code>:</p>\n\n<pre><code>Linux desktop 3.16.0-4-amd64 #1 SMP Debian 3.16.7-ckt11-1 (2015-05-24) x86_64 GNU/Linux\n</code></pre>\n\n<p>MacOS X <code>uname -a</code>:</p>\n\n<pre><code>Darwin 14.5.0 Darwin Kernel Version 14.5.0: Thu Jul  9 22:56:16 PDT 2015; root:xnu-2782.40.6~1/RELEASE_X86_64 x86_64\n</code></pre>\n\n<p>Source code from tour:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc say(s string) {\n    for i := 0; i &lt; 5; i++ {\n        time.Sleep(1000 * time.Millisecond)\n        fmt.Println(s)\n    }\n}\n\nfunc main() {\n    go say(\"world\")\n    say(\"hello\")\n}\n</code></pre>\n"}, {"tags": ["go", "casting", "int", "int64"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1437683667, "post_id": 31597007, "comment_id": 51146759, "body": "If you want 32 bits use <code>int32</code> (and <code>rand.Int31</code>); if you want 64 bits use <code>int64</code> (and <code>rand.Int63</code>); if you want to use either 32 or 64 bits as &quot;appropriate&quot; for your architecture then use <code>int</code> (and <code>rand.Int</code>). Although <code>int</code> is <i>like</i> either <code>int32</code> or <code>int64</code> it is always a distinct type from both. With that it should be obvious why <code>int64(rand.Int())</code> returns 32 (actually 31 bit) values on a arch where int is 32 bit."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1437683735, "post_id": 31597007, "comment_id": 51146797, "body": "\u2026 and also why your &quot;int64Random is&quot; output is a lie if you actually call <code>rand.Int</code> instead of <code>rand.Int63</code>."}], "answers": [{"tags": [], "owner": {"reputation": 4588, "user_id": 1895328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/75c88191a4c9de0f547e51c5f9e4bea8?s=128&d=identicon&r=PG", "display_name": "RoninDev", "link": "https://stackoverflow.com/users/1895328/ronindev"}, "is_accepted": true, "score": 1, "last_activity_date": 1437683650, "creation_date": 1437683650, "answer_id": 31597512, "question_id": 31597007, "link": "https://stackoverflow.com/questions/31597007/getting-different-output-when-casting-between-int-and-int64-in-go-is-it-due-to/31597512#31597512", "title": "Getting different output when casting between int and int64 in Go; is it due to processor architecture?", "body": "<p>According to <a href=\"https://golang.org/doc/go1.1\" rel=\"nofollow\">https://golang.org/doc/go1.1</a></p>\n\n<blockquote>\n  <p>The language allows the implementation to choose whether the int type\n  and uint types are 32 or 64 bits. Previous Go implementations made int\n  and uint 32 bits on all systems. Both the gc and gccgo implementations\n  now make int and uint 64 bits on 64-bit platforms such as AMD64/x86-64</p>\n</blockquote>\n\n<p>rand.Int() returns int. On amd64 it will be 64 bits, on ARM it will be 32 bits</p>\n"}], "owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 31597512, "answer_count": 1, "score": 0, "last_activity_date": 1437683650, "creation_date": 1437681769, "last_edit_date": 1437683450, "question_id": 31597007, "link": "https://stackoverflow.com/questions/31597007/getting-different-output-when-casting-between-int-and-int64-in-go-is-it-due-to", "title": "Getting different output when casting between int and int64 in Go; is it due to processor architecture?", "body": "<p>A small part of an application I'm using to test some expected behavior is giving different output, depending on what processor I run it on. Here's the relevant part of the code:</p>\n\n<pre><code>   for b := 0; b &lt; intCounter; b++ {\n\n            //int64Random = rand.Int63()\n            int64Random = int64(rand.Int())\n\n//CHECKING FOR SANITY\nfmt.Println(\"int64Random is \" + strconv.FormatInt(int64Random, 10))\n\n            slcTestNums = append(slcTestNums, int64Random)\n    }\n</code></pre>\n\n<p>When I run this on my Mac (amd64, darwin) I get output like:</p>\n\n<pre><code>int64Random is 2991558990735723489\nint64Random is 7893058381743103687\nint64Random is 7672635040537837613\nint64Random is 1557718564618710869\nint64Random is 2107352926413218802\n</code></pre>\n\n<p>When I run this on a Pi (arm, linux) I get output like:</p>\n\n<pre><code>int64Random is 1251459732\nint64Random is 1316852782\nint64Random is 971786136\nint64Random is 1359359453\nint64Random is 729066469\n</code></pre>\n\n<p>If on the Pi I change the int64Random to = rand.Int63() and recompile, I get output like:</p>\n\n<pre><code>int64Random is 7160249008355881289\nint64Random is 7184347289772016444\nint64Random is 9201664581141930074\nint64Random is 917219239600463359\nint64Random is 6015348270214295654\n</code></pre>\n\n<p>...which more closely matches what the Mac is getting. Is this because of something that is changed at runtime due to the processor architecture? Why is <code>int64(rand.Int())</code> generating int64-ranged numbers instead of keeping an int-ranged number, but changing the type for the variable it's being stored in? Am I missing the Go documentation that mentions this behavior?</p>\n"}, {"tags": ["testing", "go"], "answers": [{"tags": [], "owner": {"reputation": 2879, "user_id": 4335588, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/gNlDI.jpg?s=128&g=1", "display_name": "Thellimist", "link": "https://stackoverflow.com/users/4335588/thellimist"}, "is_accepted": false, "score": 0, "last_activity_date": 1437694985, "last_edit_date": 1437694985, "creation_date": 1437678351, "answer_id": 31596042, "question_id": 31595791, "link": "https://stackoverflow.com/questions/31595791/how-to-test-panics/31596042#31596042", "title": "How to test panics?", "body": "<p>You can test which function paniced by giving panic an input</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc explode() {\n    // Cause a panic.\n    panic(\"WRONG\")\n}\n\nfunc explode1() {\n    // Cause a panic.\n    panic(\"WRONG1\")\n}\n\nfunc main() {\n    // Handle errors in defer func with recover.\n    defer func() {\n        if r := recover(); r != nil {\n            var ok bool\n            err, ok := r.(error)\n            if !ok {\n                err = fmt.Errorf(\"pkg: %v\", r)\n                fmt.Println(err)\n            }\n        }\n\n    }()\n    // These causes an error. change between these\n    explode()\n    //explode1()\n\n    fmt.Println(\"Everything fine\")\n\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/ORWBqmPSVA\" rel=\"nofollow\">http://play.golang.org/p/ORWBqmPSVA</a></p>\n"}, {"comments": [{"owner": {"reputation": 2671, "user_id": 33991, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9770614c66b56331b6947c79b622a7af?s=128&d=identicon&r=PG", "display_name": "FGM", "link": "https://stackoverflow.com/users/33991/fgm"}, "reply_to_user": {"reputation": 884, "user_id": 380247, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7ba8cab2eb1a3727d54aaf5f3f40d144?s=128&d=identicon&r=PG", "display_name": "Igor Mikushkin", "link": "https://stackoverflow.com/users/380247/igor-mikushkin"}, "edited": false, "score": 0, "creation_date": 1543663129, "post_id": 31596110, "comment_id": 94005181, "body": "@IgorMikushkin in Go 1.11, using the first form described by Rob Napier actually works for coverage."}, {"owner": {"reputation": 58775, "user_id": 474189, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/jzXIJ.jpg?s=128&g=1", "display_name": "Duncan Jones", "link": "https://stackoverflow.com/users/474189/duncan-jones"}, "edited": false, "score": 1, "creation_date": 1545297507, "post_id": 31596110, "comment_id": 94578572, "body": "Is there any reason you use <code>r := recover(); r == nil</code> and not just <code>recover() == nil</code>?"}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "reply_to_user": {"reputation": 58775, "user_id": 474189, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/jzXIJ.jpg?s=128&g=1", "display_name": "Duncan Jones", "link": "https://stackoverflow.com/users/474189/duncan-jones"}, "edited": false, "score": 0, "creation_date": 1545311874, "post_id": 31596110, "comment_id": 94585807, "body": "@DuncanJones Not really in this case. It&#39;s a really typical Go pattern to make the error available in the block, so it was probably habit for the OP to write it that way (and I brought his code forward), but it&#39;s not actually used in this case."}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": false, "score": 114, "last_activity_date": 1437678548, "creation_date": 1437678548, "answer_id": 31596110, "question_id": 31595791, "link": "https://stackoverflow.com/questions/31595791/how-to-test-panics/31596110#31596110", "title": "How to test panics?", "body": "<p><code>testing</code> doesn't really have the concept of \"success,\" only failure. So your code above is about right. You might find this style slightly more clear, but it's basically the same thing.</p>\n\n<pre><code>func TestPanic(t *testing.T) {\n    defer func() {\n        if r := recover(); r == nil {\n            t.Errorf(\"The code did not panic\")\n        }\n    }()\n\n    // The following is the code under test\n    OtherFunctionThatPanics()\n}\n</code></pre>\n\n<p>I generally find <code>testing</code> to be fairly weak. You may be interested in more powerful testing engines like <a href=\"https://github.com/onsi/ginkgo\">Ginkgo</a>. Even if you don't want the full Ginkgo system, you can use just its matcher library, <a href=\"https://github.com/onsi/gomega\">Gomega</a>, which can be used along with <code>testing</code>. Gomega includes matchers like:</p>\n\n<pre><code>Expect(OtherFunctionThatPanics).To(Panic())\n</code></pre>\n\n<p>You can also wrap up panic-checking into a simple function:</p>\n\n<pre><code>func TestPanic(t *testing.T) {\n    assertPanic(t, OtherFunctionThatPanics)\n}\n\nfunc assertPanic(t *testing.T, f func()) {\n    defer func() {\n        if r := recover(); r == nil {\n            t.Errorf(\"The code did not panic\")\n        }\n    }()\n    f()\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 646, "user_id": 712014, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/4InEp.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/712014/michael"}, "edited": false, "score": 1, "creation_date": 1533815505, "post_id": 42678754, "comment_id": 90491044, "body": "It\u2019s more robust to type-assert on a specific error type (e.g. os.SyscallError) than to compare error messages, which can change (e.g.) from one Go release to the next."}, {"owner": {"reputation": 4687, "user_id": 2176740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09c0ea83bcb343688502045304a0474?s=128&d=identicon&r=PG", "display_name": "joonas.fi", "link": "https://stackoverflow.com/users/2176740/joonas-fi"}, "reply_to_user": {"reputation": 646, "user_id": 712014, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/4InEp.png?s=128&g=1", "display_name": "Michael", "link": "https://stackoverflow.com/users/712014/michael"}, "edited": false, "score": 0, "creation_date": 1534109109, "post_id": 42678754, "comment_id": 90580804, "body": "+Michael Aug, that&#39;s probably the better approach, for when there&#39;s a specific type available."}], "tags": [], "owner": {"reputation": 4687, "user_id": 2176740, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c09c0ea83bcb343688502045304a0474?s=128&d=identicon&r=PG", "display_name": "joonas.fi", "link": "https://stackoverflow.com/users/2176740/joonas-fi"}, "is_accepted": false, "score": 4, "last_activity_date": 1488996528, "creation_date": 1488996528, "answer_id": 42678754, "question_id": 31595791, "link": "https://stackoverflow.com/questions/31595791/how-to-test-panics/42678754#42678754", "title": "How to test panics?", "body": "<p>When you need to check the content of the panic, you can typecast the recovered value:</p>\n\n<pre><code>func TestIsAheadComparedToPanicsWithDifferingStreams(t *testing.T) {\n    defer func() {\n        err := recover().(error)\n\n        if err.Error() != \"Cursor: cannot compare cursors from different streams\" {\n            t.Fatalf(\"Wrong panic message: %s\", err.Error())\n        }\n    }()\n\n    c1 := CursorFromserializedMust(\"/foo:0:0\")\n    c2 := CursorFromserializedMust(\"/bar:0:0\")\n\n    // must panic\n    c1.IsAheadComparedTo(c2)\n}\n</code></pre>\n\n<p>If the code you're testing does not panic OR panic with an error OR panic with the error message you expect it to, the test will fail (which is what you'd want).</p>\n"}, {"tags": [], "owner": {"reputation": 24556, "user_id": 110358, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/13c7ad63eb27047a7ff869d27e40c1ad?s=128&d=identicon&r=PG", "display_name": "Jacob Marble", "link": "https://stackoverflow.com/users/110358/jacob-marble"}, "is_accepted": false, "score": 50, "last_activity_date": 1539388276, "last_edit_date": 1539388276, "creation_date": 1491691500, "answer_id": 43301109, "question_id": 31595791, "link": "https://stackoverflow.com/questions/31595791/how-to-test-panics/43301109#43301109", "title": "How to test panics?", "body": "<p>If you use <a href=\"https://godoc.org/github.com/stretchr/testify/assert\" rel=\"noreferrer\">testify/assert</a>, then it's a one-liner:</p>\n\n<pre><code>func TestOtherFunctionThatPanics(t *testing.T) {\n  assert.Panics(t, OtherFunctionThatPanics, \"The code did not panic\")\n}\n</code></pre>\n\n<p>Or, if your <code>OtherFunctionThatPanics</code> has a signature other than <code>func()</code>:</p>\n\n<pre><code>func TestOtherFunctionThatPanics(t *testing.T) {\n  assert.Panics(t, func() { OtherFunctionThatPanics(arg) }, \"The code did not panic\")\n}\n</code></pre>\n\n<p>If you haven't tried testify yet, then also check out <a href=\"https://godoc.org/github.com/stretchr/testify/mock\" rel=\"noreferrer\">testify/mock</a>. Super simple assertions and mocks.</p>\n"}, {"tags": [], "owner": {"reputation": 648, "user_id": 3055059, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d777724667c9458bababa83a3b58a5a4?s=128&d=identicon&r=PG&f=1", "display_name": "Aleh", "link": "https://stackoverflow.com/users/3055059/aleh"}, "is_accepted": false, "score": 7, "last_activity_date": 1518852072, "creation_date": 1518852072, "answer_id": 48838983, "question_id": 31595791, "link": "https://stackoverflow.com/questions/31595791/how-to-test-panics/48838983#48838983", "title": "How to test panics?", "body": "<p>When looping over multiple test cases I would go for something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"reflect\"\n    \"testing\"\n)\n\n\nfunc TestYourFunc(t *testing.T) {\n    type args struct {\n        arg1 int\n        arg2 int\n        arg3 int\n    }\n    tests := []struct {\n        name      string\n        args      args\n        want      []int\n        wantErr   bool\n        wantPanic bool\n    }{\n        //TODO: write test cases\n    }\n    for _, tt := range tests {\n        t.Run(tt.name, func(t *testing.T) {\n            defer func() {\n                r := recover()\n                if (r != nil) != tt.wantPanic {\n                    t.Errorf(\"SequenceInt() recover = %v, wantPanic = %v\", r, tt.wantPanic)\n                }\n            }()\n            got, err := YourFunc(tt.args.arg1, tt.args.arg2, tt.args.arg3)\n            if (err != nil) != tt.wantErr {\n                t.Errorf(\"YourFunc() error = %v, wantErr %v\", err, tt.wantErr)\n                return\n            }\n            if !reflect.DeepEqual(got, tt.want) {\n                t.Errorf(\"YourFunc() = %v, want %v\", got, tt.want)\n            }\n        })\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Aw9VGv9qgqU\" rel=\"noreferrer\">Go playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 59, "user_id": 2662180, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1smkG.png?s=128&g=1", "display_name": "David B", "link": "https://stackoverflow.com/users/2662180/david-b"}, "is_accepted": false, "score": 3, "last_activity_date": 1580920117, "last_edit_date": 1580920117, "creation_date": 1580909093, "answer_id": 60076852, "question_id": 31595791, "link": "https://stackoverflow.com/questions/31595791/how-to-test-panics/60076852#60076852", "title": "How to test panics?", "body": "<p>In your case you can do:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func f(t *testing.T) {\n    recovered := func() (r bool) {\n        defer func() {\n            if r := recover(); r != nil {\n                r = true\n            }\n        }()\n        OtherFunctionThatPanics()\n        // NOT BE EXECUTED IF PANICS\n        // ....\n    }\n    if ! recovered() {\n        t.Errorf(\"The code did not panic\")\n\n        // EXECUTED IF PANICS\n        // ....\n    }\n}\n</code></pre>\n\n<p>As a generic <em>panic router function</em> this will also work: </p>\n\n<p><a href=\"https://github.com/7d4b9/recover\" rel=\"nofollow noreferrer\">https://github.com/7d4b9/recover</a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package recover\n\nfunc Recovered(IfPanic, Else func(), Then func(recover interface{})) (recoverElse interface{}) {\n    defer func() {\n        if r := recover(); r != nil {\n            {\n                // EXECUTED IF PANICS\n                if Then != nil {\n                    Then(r)\n                }\n            }\n        }\n    }()\n\n    IfPanic()\n\n    {\n        // NOT BE EXECUTED IF PANICS\n        if Else != nil {\n            defer func() {\n                recoverElse = recover()\n            }()\n            Else()\n        }\n    }\n    return\n}\n\nvar testError = errors.New(\"expected error\")\n\nfunc TestRecover(t *testing.T) {\n    Recovered(\n        func() {\n            panic(testError)\n        },\n        func() {\n            t.Errorf(\"The code did not panic\")\n        },\n        func(r interface{}) {\n            if err := r.(error); err != nil {\n                assert.Error(t, testError, err)\n                return\n            }\n            t.Errorf(\"The code did an unexpected panic\")\n        },\n    )\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "is_accepted": false, "score": 10, "last_activity_date": 1616963015, "last_edit_date": 1616963015, "creation_date": 1590517223, "answer_id": 62028796, "question_id": 31595791, "link": "https://stackoverflow.com/questions/31595791/how-to-test-panics/62028796#62028796", "title": "How to test panics?", "body": "<h1>Idiomatic Standard Library Solution</h1>\n<p>To me, the solution below is easy to read and shows a maintainer the natural code flow under test. Also, it doesn't require a third-party package.</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func TestPanic(t *testing.T) {\n    // No need to check whether `recover()` is nil. Just turn off the panic.\n    defer func() { recover() }()\n\n    OtherFunctionThatPanics()\n\n    // Never reaches here if `OtherFunctionThatPanics` panics.\n    t.Errorf(&quot;did not panic&quot;)\n}\n</code></pre>\n<hr />\n<p>For a more general solution, you can also do it like this:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func TestPanic(t *testing.T) {\n    shouldPanic(t, OtherFunctionThatPanics)\n}\n\nfunc shouldPanic(t *testing.T, f func()) {\n    defer func() { recover() }()\n    f()\n    t.Errorf(&quot;should have panicked&quot;)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 39, "user_id": 3897623, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a26e94f14ba0bf11fe10ff117d64b367?s=128&d=identicon&r=PG&f=1", "display_name": "Nick L", "link": "https://stackoverflow.com/users/3897623/nick-l"}, "is_accepted": false, "score": 1, "last_activity_date": 1615831741, "last_edit_date": 1615831741, "creation_date": 1615830421, "answer_id": 66642989, "question_id": 31595791, "link": "https://stackoverflow.com/questions/31595791/how-to-test-panics/66642989#66642989", "title": "How to test panics?", "body": "<p>Below is my panic expected</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func TestPanic(t *testing.T) {\n\n    panicF := func() {\n        //panic call here\n    }\n    require.Panics(t, panicF)\n}\n</code></pre>\n"}], "owner": {"reputation": 7245, "user_id": 953732, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/f8115344be80362b14eb47e29c44c61e?s=128&d=identicon&r=PG", "display_name": "ThePiachu", "link": "https://stackoverflow.com/users/953732/thepiachu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35482, "favorite_count": 17, "answer_count": 8, "score": 96, "last_activity_date": 1616963015, "creation_date": 1437677497, "last_edit_date": 1447236683, "question_id": 31595791, "link": "https://stackoverflow.com/questions/31595791/how-to-test-panics", "title": "How to test panics?", "body": "<p>I'm currently pondering how to write tests that check if a given piece of code panicked? I know that Go uses <a href=\"https://golang.org/doc/effective_go.html#recover\" rel=\"noreferrer\"><code>recover</code></a> to catch panics, but unlike say, Java code, you can't really specify what code should be skipped in case of a panic or what have you. So if I have a function:</p>\n\n<pre><code>func f(t *testing.T) {\n    defer func() {\n        if r := recover(); r != nil {\n            fmt.Println(\"Recovered in f\", r)\n        }\n    }()\n    OtherFunctionThatPanics()\n    t.Errorf(\"The code did not panic\")\n}\n</code></pre>\n\n<p>I can't really tell whether <code>OtherFunctionThatPanics</code> panicked and we recovered, or if the function did not panic at all. How do I specify which code to skip over if there is no panic and which code to execute if there is a panic? How can I check whether there was some panic we recovered from?</p>\n"}, {"tags": ["function", "syntax", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1437679478, "post_id": 31595672, "comment_id": 51144395, "body": "Instead of asking such questions I&#39;d suggest skimming the short  and easy to find <a href=\"https://golang.org/ref/spec#Method_declarations\" rel=\"nofollow noreferrer\">Go Language Specification</a>. IMO, questions and answers that do nothing more than just regurgitate parts of a readily available and more authoritative source aren&#39;t useful."}, {"owner": {"reputation": 1671, "user_id": 325358, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/eb58709dc08423fc567de3a3225b23c9?s=128&d=identicon&r=PG", "display_name": "Ivan", "link": "https://stackoverflow.com/users/325358/ivan"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1437679996, "post_id": 31595672, "comment_id": 51144732, "body": "1) I wouldn&#39;t say that document is short at all. 2) I already looked at that document, but I was looking at function declarations, not method declarations, because I know nothing about Go: <a href=\"https://golang.org/ref/spec#Function_declarations\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Function_declarations</a> 3) Actually everything can be found in more authoritative sources.  I think this question may be of use to future people learning Go, and perfectly fits on Stack Overflow."}, {"owner": {"reputation": 3127, "user_id": 842860, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/oOCwG.png?s=128&g=1", "display_name": "stackoverflower", "link": "https://stackoverflow.com/users/842860/stackoverflower"}, "edited": false, "score": 0, "creation_date": 1487788442, "post_id": 31595672, "comment_id": 71946230, "body": "@Ivan, agreed, I was looking at Function_declarations too!  And the doc isn&#39;t short."}], "answers": [{"tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": true, "score": 14, "last_activity_date": 1437677417, "creation_date": 1437677417, "answer_id": 31595768, "question_id": 31595672, "link": "https://stackoverflow.com/questions/31595672/function-declaration-syntax-in-go/31595768#31595768", "title": "Function declaration syntax in Go", "body": "<p><code>(c App)</code> gives the name and type of the <em>receiver</em>, Go's equivalent of C++ or JavaScript's <code>this</code> or Python's <code>self</code>. <code>c</code> is the receiver's name here, since <a href=\"https://code.google.com/p/go-wiki/wiki/CodeReviewComments#Receiver_Names\">in Go it's conventional to use a short, context-sensitive name instead of something generic like <code>this</code></a>. See <a href=\"http://golang.org/ref/spec#Method_declarations\">http://golang.org/ref/spec#Method_declarations</a> --</p>\n\n<blockquote>\n  <p>A method is a function with a receiver. The receiver is specified via an extra parameter section preceeding the method name.</p>\n</blockquote>\n\n<p>and its example:</p>\n\n<pre><code>func (p *Point) Length() float64 {\n    return math.Sqrt(p.x * p.x + p.y * p.y)\n}\n</code></pre>\n"}], "owner": {"reputation": 1671, "user_id": 325358, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/eb58709dc08423fc567de3a3225b23c9?s=128&d=identicon&r=PG", "display_name": "Ivan", "link": "https://stackoverflow.com/users/325358/ivan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2796, "favorite_count": 0, "accepted_answer_id": 31595768, "answer_count": 1, "score": 7, "last_activity_date": 1437677417, "creation_date": 1437677170, "question_id": 31595672, "link": "https://stackoverflow.com/questions/31595672/function-declaration-syntax-in-go", "title": "Function declaration syntax in Go", "body": "<p>What is (c App) in the following function declaration?</p>\n\n<pre><code>func (c App) SaveSettings(setting string) revel.Result {\n--------------------------------------------------------------------------------------\nfunc                                                      Keyword to define a function\n     (c App)                                              ????\n             SaveSettings                                 Function name\n                         (setting string)                 Function arguments\n                                          revel.Result    Return type\n</code></pre>\n"}]