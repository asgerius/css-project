[{"tags": ["multithreading", "api", "go", "goroutine"], "comments": [{"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 2, "creation_date": 1508367394, "post_id": 46820427, "comment_id": 80588385, "body": "Go&#39;s http package starts a go routine for each incoming connection. Unless you are talking about background job processing, this seems like wasted effort."}, {"owner": {"reputation": 398, "user_id": 2936329, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/31Ke7.jpg?s=128&g=1", "display_name": "Rien", "link": "https://stackoverflow.com/users/2936329/rien"}, "reply_to_user": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1508367474, "post_id": 46820427, "comment_id": 80588407, "body": "Yes correct this is for background processing. Some that might take quit a while to finish and I rather not let a uncontrolled amount of goroutines loose"}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1508425238, "post_id": 46820427, "comment_id": 80613408, "body": "What&#39;s the problem with goroutines? They are basically the build-in implementation of jobqueues with async support."}, {"owner": {"reputation": 398, "user_id": 2936329, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/31Ke7.jpg?s=128&g=1", "display_name": "Rien", "link": "https://stackoverflow.com/users/2936329/rien"}, "edited": false, "score": 0, "creation_date": 1508428923, "post_id": 46820427, "comment_id": 80615917, "body": "Because I wish to control the amount of goroutines. I rather not get a spike of request and fire up uncontrolled amount of goroutines, especially related to HTTP requests which with too many it just starts spewing errors of too many concurrent http connections."}, {"owner": {"reputation": 2796, "user_id": 181714, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/e73c2782932ae2233c19b18b3db24576?s=128&d=identicon&r=PG", "display_name": "Audrius", "link": "https://stackoverflow.com/users/181714/audrius"}, "edited": false, "score": 1, "creation_date": 1508431118, "post_id": 46820427, "comment_id": 80617201, "body": "It&#39;s actually up to you. If you need to have a fair(er) worker pool it makes sense to have one per specific work scenario (endpoint). Imagine what would happen if you have 2 endpoints and one of them producing 100x more work items than the second endpoint... <a href=\"https://stackoverflow.com/posts/46820427/edit\">Edit</a> If you do want to stick to a single worker pool, you can implement it so that it acts as a scheduler that has a queue per endpoint and that sequentially checks each queue for work (or uses some clever load balancing)."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1508444699, "post_id": 46820427, "comment_id": 80624343, "body": "Why do you need a worker pool? This sounds like lots of extra work (and overhead) for no gain."}, {"owner": {"reputation": 398, "user_id": 2936329, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/31Ke7.jpg?s=128&g=1", "display_name": "Rien", "link": "https://stackoverflow.com/users/2936329/rien"}, "edited": false, "score": 0, "creation_date": 1508450540, "post_id": 46820427, "comment_id": 80626931, "body": "I&#39;m a student trying to understand the concept of worker pools related to different kind of jobs and also I&#39;m learning Go. It&#39;s for learning purposes I want to do this."}], "answers": [{"comments": [{"owner": {"reputation": 13897, "user_id": 1713660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5aa62fae5a22b542d2a188b95384aee?s=128&d=identicon&r=PG", "display_name": "vladkras", "link": "https://stackoverflow.com/users/1713660/vladkras"}, "edited": false, "score": 0, "creation_date": 1543701684, "post_id": 46825660, "comment_id": 94015127, "body": "fasthttp is fast to the detriment of http standards"}], "tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": false, "score": 0, "last_activity_date": 1508425146, "last_edit_date": 1508425146, "creation_date": 1508401740, "answer_id": 46825660, "question_id": 46820427, "link": "https://stackoverflow.com/questions/46820427/golang-http-request-worker-pool/46825660#46825660", "title": "Golang HTTP request worker pool", "body": "<p>It's not clear why you need worker pool at all? Would not be goroutines be enough?</p>\n\n<p>If you are limited by resources you can consider implementing <a href=\"https://github.com/golang/go/wiki/RateLimiting\" rel=\"nofollow noreferrer\">rates limiting</a>. If not why simply not to span go routines as needed? </p>\n\n<p>The best way to learn is to study how others do good stuff.</p>\n\n<p>Have a look at <a href=\"https://github.com/valyala/fasthttp\" rel=\"nofollow noreferrer\">https://github.com/valyala/fasthttp</a></p>\n\n<blockquote>\n  <p>Fast HTTP package for Go. Tuned for high performance. Zero memory allocations in hot paths. Up to 10x faster than <code>net/http</code>.</p>\n</blockquote>\n\n<p>They are claiming:</p>\n\n<blockquote>\n  <p>serving up to 200K rps from more than 1.5M concurrent keep-alive connections per physical server</p>\n</blockquote>\n\n<p>That is quite impressive and I doubt you can do any better with <code>pool / jobqueue</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 8, "last_activity_date": 1508489522, "creation_date": 1508489522, "answer_id": 46845567, "question_id": 46820427, "link": "https://stackoverflow.com/questions/46820427/golang-http-request-worker-pool/46845567#46845567", "title": "Golang HTTP request worker pool", "body": "<p>One thing up front: If you are running an HTTP server (Go's standard server anyway), you cannot control the number of goroutines without stopping and restarting the server. Each request starts at least one goroutine, and there's nothing you can do about that. The good news is that this is usually not a problem, since goroutines are so lightweight. However, it is perfectly reasonable that you want to keep the number of goroutines that are doing hard work under control.</p>\n\n<p>You can put any value into a channel, including functions. So if the goal is to only having to write code in http handlers, let the jobs be closures -- the workers don't know (or care) what they are working on.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\nvar largePool chan func()\nvar smallPool chan func()\n\nfunc main() {\n    // Start two different sized worker pools (e.g., for different workloads).\n    // Cancelation and graceful shutdown omited for brevity.\n\n    largePool = make(chan func(), 100)\n    smallPool = make(chan func(), 10)\n\n    for i := 0; i &lt; 100; i++ {\n            go func() {\n                    for f := range largePool {\n                            f()\n                    }\n            }()\n    }\n\n    for i := 0; i &lt; 10; i++ {\n            go func() {\n                    for f := range smallPool {\n                            f()\n                    }\n            }()\n    }\n\n    http.HandleFunc(\"/endpoint-1\", handler1)\n    http.HandleFunc(\"/endpoint-2\", handler2) // naming things is hard, okay?\n\n    http.ListenAndServe(\":8080\", nil)\n}\n\nfunc handler1(w http.ResponseWriter, r *http.Request) {\n    // Imagine a JSON body containing a URL that we are expected to fetch.\n    // Light work that doesn't consume many of *our* resources and can be done\n    // in bulk, so we put in in the large pool.\n    var job struct{ URL string }\n\n    if err := json.NewDecoder(r.Body).Decode(&amp;job); err != nil {\n            http.Error(w, err.Error(), http.StatusBadRequest)\n            return\n    }\n\n    go func() {\n            largePool &lt;- func() {\n                    http.Get(job.URL)\n                    // Do something with the response\n            }\n    }()\n\n    w.WriteHeader(http.StatusAccepted)\n}\n\nfunc handler2(w http.ResponseWriter, r *http.Request) {\n    // The request body is an image that we want to do some fancy processing\n    // on. That's hard work; we don't want to do too many of them at once, so\n    // so we put those jobs in the small pool.\n\n    b, err := ioutil.ReadAll(r.Body)\n    if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n            return\n    }\n\n    go func() {\n            smallPool &lt;- func() {\n                    processImage(b)\n            }\n    }()\n    w.WriteHeader(http.StatusAccepted)\n}\n\nfunc processImage(b []byte) {}\n</code></pre>\n\n<p>This is a very simple example to get the point across. It doesn't matter much how you setup your worker pools. You just need a clever job definition. In the example above it is a closure, but you could also define a Job interface, for instance.</p>\n\n<pre><code>type Job interface {\n    Do()\n}\n\nvar largePool chan Job\nvar smallPool chan Job\n</code></pre>\n\n<hr>\n\n<p>Now, I wouldn't call the whole worker pool approach \"simple\". You said your goal is to limit the number of goroutines (that are doing work). That doesn't require workers at all; it only needs a limiter. Here is the same example as above, but using channels as semaphores to limit concurrency.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"io/ioutil\"\n    \"net/http\"\n)\n\nvar largePool chan struct{}\nvar smallPool chan struct{}\n\nfunc main() {\n    largePool = make(chan struct{}, 100)\n    smallPool = make(chan struct{}, 10)\n\n    http.HandleFunc(\"/endpoint-1\", handler1)\n    http.HandleFunc(\"/endpoint-2\", handler2)\n\n    http.ListenAndServe(\":8080\", nil)\n}\n\nfunc handler1(w http.ResponseWriter, r *http.Request) {\n    var job struct{ URL string }\n\n    if err := json.NewDecoder(r.Body).Decode(&amp;job); err != nil {\n            http.Error(w, err.Error(), http.StatusBadRequest)\n            return\n    }\n\n    go func() {\n            // Block until there are fewer than cap(largePool) light-work\n            // goroutines running.\n            largePool &lt;- struct{}{}\n            defer func() { &lt;-largePool }() // Let everyone that we are done\n\n            http.Get(job.URL)\n    }()\n\n    w.WriteHeader(http.StatusAccepted)\n}\n\nfunc handler2(w http.ResponseWriter, r *http.Request) {\n    b, err := ioutil.ReadAll(r.Body)\n    if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n            return\n    }\n\n    go func() {\n            // Block until there are fewer than cap(smallPool) hard-work\n            // goroutines running.\n            smallPool &lt;- struct{}{}\n            defer func() { &lt;-smallPool }() // Let everyone that we are done\n\n            processImage(b)\n    }()\n\n    w.WriteHeader(http.StatusAccepted)\n}\n\nfunc processImage(b []byte) {}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6522, "user_id": 931511, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/eNqBf.jpg?s=128&g=1", "display_name": "guilhebl", "link": "https://stackoverflow.com/users/931511/guilhebl"}, "is_accepted": false, "score": 0, "last_activity_date": 1514101545, "creation_date": 1514101545, "answer_id": 47958943, "question_id": 46820427, "link": "https://stackoverflow.com/questions/46820427/golang-http-request-worker-pool/47958943#47958943", "title": "Golang HTTP request worker pool", "body": "<p>As answered before in your server each request handler will run in at least one goroutine.</p>\n\n<p>But you still can use a worker-pool for back-end parallel tasks if necessary. For example let's suppose some of your Http Handler functions triggers calls to other external apis and \"aggregates\" their results together, so the order of calls does not matter in this case, this is one scenario where you can leverage a worker pool and distribute your work in order to have them run in parallel dispatching each task to a worker goroutine:</p>\n\n<p>Sample code snippet:</p>\n\n<pre><code>    // build empty response\n    capacity := config.GetIntProperty(\"defaultListCapacity\")\n    list := model.NewResponseList(make([]model.Response, 0, capacity), 1, 1, 0)\n\n    // search providers\n    providers := getProvidersByCountry(country)\n\n    // create a slice of jobResult outputs\n    jobOutputs := make([]&lt;-chan job.JobResult, 0)\n\n    // distribute work\n    for i := 0; i &lt; len(providers); i++ {\n        job := search(providers[i], m)\n        if job != nil {\n            jobOutputs = append(jobOutputs, job.ReturnChannel)\n            // Push each job onto the queue.\n            GetInstance().JobQueue &lt;- *job\n        }\n    }\n\n    // Consume the merged output from all jobs\n    out := job.Merge(jobOutputs...)\n    for r := range out {\n        if r.Error == nil {\n            mergeSearchResponse(list, r.Value.(*model.ResponseList))\n        }\n    }\n    return list\n</code></pre>\n\n<p>. complete example of worker pool running \"generic\" tasks asynchronously: <a href=\"https://github.com/guilhebl/go-offer/blob/master/offer/repo.go\" rel=\"nofollow noreferrer\">https://github.com/guilhebl/go-offer/blob/master/offer/repo.go</a></p>\n\n<p>. worker pool lib used: <a href=\"https://github.com/guilhebl/go-worker-pool\" rel=\"nofollow noreferrer\">https://github.com/guilhebl/go-worker-pool</a></p>\n"}], "owner": {"reputation": 398, "user_id": 2936329, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/31Ke7.jpg?s=128&g=1", "display_name": "Rien", "link": "https://stackoverflow.com/users/2936329/rien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10177, "favorite_count": 1, "accepted_answer_id": 46845567, "answer_count": 3, "score": 3, "last_activity_date": 1514101545, "creation_date": 1508367198, "question_id": 46820427, "link": "https://stackoverflow.com/questions/46820427/golang-http-request-worker-pool", "title": "Golang HTTP request worker pool", "body": "<p>I'm trying to build a system, worker pool / jobqueue, to handle as many <code>http requests</code> as possible on each API endpoint. I looked into this <a href=\"http://marcio.io/2015/07/handling-1-million-requests-per-minute-with-golang/\" rel=\"nofollow noreferrer\">example</a> and got it working just fine except that I stumbled upon the problem that I don't understand how to expand the <code>pool / jobqueue</code> to different endpoints.</p>\n\n<p>For scenario sake let's sketch an Golang http server that has a million request / min across different endpoints and request types <code>GET</code> &amp; <code>POST</code> ETC.</p>\n\n<p>How can I expand on this concept? Should I create different worker pools and jobs for each endpoint. Or can I create different jobs and enter them in the same queue and have the same pool handle these? </p>\n\n<p>I want to maintain simplicity where if I create a new API endpoint I don't have to create new worker pools, so I can focus just on the api. But performance is also very much in mind.</p>\n\n<p>The code I'm trying to build on is taken from the example linked earlier, <a href=\"https://github.com/beyazc/job-worker\" rel=\"nofollow noreferrer\">here</a> is a github 'gist' of somebody else with this code.</p>\n"}, {"tags": ["elasticsearch", "go", "elasticsearch-plugin", "elasticsearch-query"], "owner": {"reputation": 1811, "user_id": 3004041, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/e9c675dd9408721a8e8e1106774a9d11?s=128&d=identicon&r=PG&f=1", "display_name": "covfefe", "link": "https://stackoverflow.com/users/3004041/covfefe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 206, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1508363448, "creation_date": 1508363448, "question_id": 46819817, "link": "https://stackoverflow.com/questions/46819817/elasticsearch-get-all-fields-of-type-date", "title": "Elasticsearch get all fields of type date", "body": "<p>I'm using olivere's elastic v.5 Go library (<a href=\"https://godoc.org/gopkg.in/olivere/elastic.v5\" rel=\"nofollow noreferrer\">https://godoc.org/gopkg.in/olivere/elastic.v5</a>) for my Elastic queries. If I have an elastic mapping like this:</p>\n\n<pre><code>\"mappings\": {\n        \"boxes\": {\n            \"properties\": {\n                \"field1\": {\n                    \"type\": \"string\"\n                },\n                \"field2\": {\n                    \"type\": \"string\"\n                },\n                \"field3\": {\n                    \"type\": \"date\"\n                },\n                \"field4\": {\n                    \"type\": \"date\"\n                }\n            }\n        }\n</code></pre>\n\n<p>And I want to get a list of all fields that have type 'date'.</p>\n\n<p>I've looked into <a href=\"https://godoc.org/gopkg.in/olivere/elastic.v5#Client.GetFieldMapping\" rel=\"nofollow noreferrer\">GetFieldMapping</a> but that doesn't seem to have an option to filter the fields based on type.</p>\n\n<p>I tried this:</p>\n\n<pre><code>elasticclient.GetFieldMapping().Index(\"someindex\").Type(\"boxes\").Field().Type(\"date\").Pretty(true).Do(ctx)\n</code></pre>\n\n<p>That just gives me all the fields and their types. Is there a different syntax to do this? Thanks!</p>\n"}, {"tags": ["bash", "go"], "comments": [{"owner": {"reputation": 4993, "user_id": 176873, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/gwCrk.png?s=128&g=1", "display_name": "JCasso", "link": "https://stackoverflow.com/users/176873/jcasso"}, "edited": false, "score": 0, "creation_date": 1508366361, "post_id": 46818861, "comment_id": 80588082, "body": "@MiloChristiansen is this a possible duplicate or an exact duplicate? I think the question is not about checking a file like &quot;/home/user/abc.txt&quot;, it is more likely to check if &quot;telnet&quot; works (in $PATH). (I do not know golang)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508377171, "post_id": 46818861, "comment_id": 80590711, "body": "I can&#39;t tell, do you want the equivalent of <code>test -x</code>, or do want some other behavior?"}, {"owner": {"reputation": 88, "user_id": 7842706, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/34fee7b848d57276c1dd0192894e0171?s=128&d=identicon&r=PG&f=1", "display_name": "jaibhavaya", "link": "https://stackoverflow.com/users/7842706/jaibhavaya"}, "edited": false, "score": 0, "creation_date": 1508439292, "post_id": 46818861, "comment_id": 80621412, "body": "yea it was mostly checking to see if something like telnet works in the PATH.  Checking for a file wasn&#39;t working as I would need to do extra work to find the full path to the executable.  I was trying to see if there was something like -x in unix"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1508447561, "post_id": 46818861, "comment_id": 80625674, "body": "@jaibhavaya: that&#39;s 2 different issues. There&#39;s <a href=\"https://golang.org/pkg/os/exec/#LookPath\" rel=\"nofollow noreferrer\"><code>exec.LookPath</code></a>, which looks for the file in your PATH, and that should be an executable so you don&#39;t need to test it, you just try to execute it. What <code>test -x</code> does is check if the file mode has any executable bits set (but that doesn&#39;t necessarily mean <i>you</i> can execute it.). You have the mode bits via the <a href=\"https://golang.org/pkg/os/#FileInfo\" rel=\"nofollow noreferrer\"><code>FileInfo.Mode</code></a> method."}, {"owner": {"reputation": 27292, "user_id": 100208, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/e2fda105627061de42901c671680638b?s=128&d=identicon&r=PG&f=1", "display_name": "atp", "link": "https://stackoverflow.com/users/100208/atp"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1523542381, "post_id": 46818861, "comment_id": 86612212, "body": "I think @JimB&#39;s solution should be the answer (and this question shouldn&#39;t be a duplicate since the asker specifically states an executable, not just any file, for which Go has a specific solution)"}], "answers": [{"comments": [{"owner": {"reputation": 795, "user_id": 3479043, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xGd30.png?s=128&g=1", "display_name": "xh3b4sd", "link": "https://stackoverflow.com/users/3479043/xh3b4sd"}, "edited": false, "score": 1, "creation_date": 1605459807, "post_id": 46819578, "comment_id": 114650551, "body": "Meanwhile the official way is <a href=\"https://golang.org/pkg/os/exec/#LookPath\" rel=\"nofollow noreferrer\">golang.org/pkg/os/exec/#LookPath</a>."}], "tags": [], "owner": {"reputation": 25668, "user_id": 997660, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Scxjl.png?s=128&g=1", "display_name": "Nick Krasnov", "link": "https://stackoverflow.com/users/997660/nick-krasnov"}, "is_accepted": false, "score": 3, "last_activity_date": 1508362999, "last_edit_date": 1508362999, "creation_date": 1508362249, "answer_id": 46819578, "question_id": 46818861, "link": "https://stackoverflow.com/questions/46818861/check-for-binary-existence-in-golang/46819578#46819578", "title": "Check for Binary Existence in Golang", "body": "<p>Here is one way to simply check if a file exists.</p>\n\n<pre><code>if _, err := os.Stat(\"/dir/file\"); os.IsNotExist(err) {\n    fmt.Printf(\"File doesn't exist\")\n} else {\n    fmt.Printf(\"Exists\")\n}\n</code></pre>\n\n<p>Find out more: <a href=\"https://golang.org/pkg/os/#File.Stat\" rel=\"nofollow noreferrer\">os.Stat()</a>, <a href=\"https://golang.org/pkg/os/#IsNotExist\" rel=\"nofollow noreferrer\">os.IsNotExist()</a></p>\n"}], "owner": {"reputation": 88, "user_id": 7842706, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/34fee7b848d57276c1dd0192894e0171?s=128&d=identicon&r=PG&f=1", "display_name": "jaibhavaya", "link": "https://stackoverflow.com/users/7842706/jaibhavaya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2953, "favorite_count": 0, "closed_date": 1508366115, "answer_count": 1, "score": 2, "last_activity_date": 1508362999, "creation_date": 1508359141, "question_id": 46818861, "link": "https://stackoverflow.com/questions/46818861/check-for-binary-existence-in-golang", "closed_reason": "Duplicate", "title": "Check for Binary Existence in Golang", "body": "<p>I'm trying to check to see if a shell binary exists on the machine via Go.</p>\n\n<p>I have tried some simpler shell based commands:</p>\n\n<pre><code>    args := []string{\"-x\", \"fly\"}\n    o, err := exec.Command(\"test\", args...).Output()\n    fmt.Println(err)\n    fmt.Println(o)\n</code></pre>\n\n<p>But this has an exit of 1 no matter what and outputs nothing.</p>\n\n<p>I'm wondering if there is something in Go itself that would have this functionality as obviously I'd rather do the heavy lifting with go itself.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "concurrency", "parallel-processing"], "comments": [{"owner": {"reputation": 466, "user_id": 8307258, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L8i2o.jpg?s=128&g=1", "display_name": "Rados\u0142aw Za\u0142uska", "link": "https://stackoverflow.com/users/8307258/rados%c5%82aw-za%c5%82uska"}, "edited": false, "score": 0, "creation_date": 1508360830, "post_id": 46818661, "comment_id": 80585839, "body": "You are facing a problem related to the limit of opened files per user that is controlled by operating system. If you are using Linux/Unix you can probably increase limit using ulimit -n 4096 command. This command has a threshold and it can&#39;t set whichever the number of opened files you want. So if you want to push it further then you need to modify /etc/security/limits.conf file and set hard and a soft limit."}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 2, "creation_date": 1508361281, "post_id": 46818661, "comment_id": 80586060, "body": "Also, you are starting a goroutine for each link you enconuter and if there;s to many of them at certain point defeats the purpose of goroutines and actually takes longer to do the task. You should try  having a fixed number of goroutines to do the processing and read from a channel instead of starting a new one for each link. Take a look at <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">blog.golang.org/pipelines</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1508362243, "post_id": 46818661, "comment_id": 80586583, "body": "Or maybe a pattern like: <a href=\"https://gobyexample.com/worker-pools\" rel=\"nofollow noreferrer\">gobyexample.com/worker-pools</a>? (BTW, your <code>WaitGroup</code> usage is quite odd. Add 1 for each goroutine, and defer <code>Done</code> from within each goroutine. Anything else is asking for bugs)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1508445002, "post_id": 46818661, "comment_id": 80624465, "body": "The best way to handle it depends on what you want to do. This is a design decision, not a technical problem."}], "answers": [{"tags": [], "owner": {"reputation": 240, "user_id": 8800369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4f69be8fda374dc3075128df3a05f37?s=128&d=identicon&r=PG", "display_name": "Hein Oldewage", "link": "https://stackoverflow.com/users/8800369/hein-oldewage"}, "is_accepted": false, "score": 2, "last_activity_date": 1508494884, "creation_date": 1508494884, "answer_id": 46847092, "question_id": 46818661, "link": "https://stackoverflow.com/questions/46818661/whats-the-best-way-to-handle-too-many-open-files/46847092#46847092", "title": "What&#39;s the best way to handle &quot;too many open files&quot;?", "body": "<p>The files being referred to in the error <code>socket: too many open files</code> includes Threads and sockets (the http requests to load the web pages being scraped). \nSee this <a href=\"https://stackoverflow.com/questions/32325343/go-tcp-too-many-open-files-debug\">question</a>.</p>\n\n<p>The DNS query also most likely fails due being unable to create a file, however the error that is reported is <code>no such host</code>.</p>\n\n<p>The problem can be fixed in two ways:</p>\n\n<pre><code>1) Increase the maximum number of open file handles\n2) Limit the maximum number of concurrent `crawl` calls\n</code></pre>\n\n<p>1) Is the simplest solution, but might not be ideal as it only postpones the problem until you find a website that has more links that the new limit . For linux use can set this limit with <code>ulimit -n</code>.</p>\n\n<p>2) Is more a problem of design. We need to limit the number of http requests that can be made concurrently. I have modified the code a little. The most important change is maxGoRoutines. With every scraping call that starts a value is inserted into the channel. Once the channel is full the next call will block until a value is removed from the channel. A value is removed from the channel every time a scraping call finishes. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    link := \"https://example.com\"\n\n    wg := new(sync.WaitGroup)\n    wg.Add(1)\n\n    q := make(chan string)\n    go deduplicate(q, wg)\n    q &lt;- link\n    fmt.Println(\"waiting\")\n    wg.Wait()\n}\n\n//This is the maximum number of concurrent scraping calls running\nvar MaxCount = 100\nvar maxGoRoutines = make(chan struct{}, MaxCount)\n\nfunc deduplicate(ch chan string, wg *sync.WaitGroup) {\n    seen := make(map[string]bool)\n    for link := range ch {\n        // seen is a global variable that holds all seen URLs\n        if seen[link] {\n            wg.Done()\n            continue\n        }\n        seen[link] = true\n        wg.Add(1)\n        go crawl(link, ch, wg)\n    }\n}\n\nfunc crawl(link string, q chan string, wg *sync.WaitGroup) {\n    //This allows us to know when all the requests are done, so that we can quit\n    defer wg.Done()\n\n    links := doCrawl(link)\n\n    for _, l := range links {\n        q &lt;- l\n    }\n}\n\nfunc doCrawl(link string) []string {\n    //This limits the maximum number of concurrent scraping requests\n    maxGoRoutines &lt;- struct{}{}\n    defer func() { &lt;-maxGoRoutines }()\n\n    // handle the link and create a variable \"links\" containing the links found inside the page\n    time.Sleep(time.Second)\n    return []string{link + \"a\", link + \"b\"}\n}\n</code></pre>\n"}], "owner": {"reputation": 9, "user_id": 8797859, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/daacf21659aa3886bdd3acf7a5edcc9b?s=128&d=identicon&r=PG&f=1", "display_name": "D. Anderson", "link": "https://stackoverflow.com/users/8797859/d-anderson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4647, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1508494884, "creation_date": 1508358354, "last_edit_date": 1508450080, "question_id": 46818661, "link": "https://stackoverflow.com/questions/46818661/whats-the-best-way-to-handle-too-many-open-files", "title": "What&#39;s the best way to handle &quot;too many open files&quot;?", "body": "<p>I'm building a crawler that takes a URL, extracts links from it, and visits each one of them to a certain depth; making a tree of paths on a specific site.</p>\n\n<p>The way I implemented parallelism for this crawler is that I visit each new found URL as soon as it's found like this:</p>\n\n<pre><code>func main() {\n    link := \"https://example.com\"\n\n    wg := new(sync.WaitGroup)\n    wg.Add(1)\n\n    q := make(chan string)\n    go deduplicate(q, wg)\n    q &lt;- link\n    wg.Wait()\n}\n\nfunc deduplicate(ch chan string, wg *sync.WaitGroup) {\n    for link := range ch {\n        // seen is a global variable that holds all seen URLs\n        if seen[link] {\n            wg.Done()\n            continue\n        }\n        seen[link] = true\n        go crawl(link, ch, wg)\n    }\n}\n\nfunc crawl(link string, q chan string, wg *sync.WaitGroup) {\n    // handle the link and create a variable \"links\" containing the links found inside the page\n    wg.Add(len(links))\n    for _, l := range links {\n        q &lt;- l}\n    }\n}\n</code></pre>\n\n<p>This works fine for relatively small sites, but when I run it on a large one with a lot of link everywhere, I start getting one of these two errors on some requests: <code>socket: too many open files</code> and <code>no such host</code> (the host is indeed there).</p>\n\n<p>What's the best way to handle this? Should I check for these errors and pause execution when I get them for some time until the other requests are finished? Or specify a maximum number of possible requests at a certain time? (which makes more sense to me but not sure how to code up exactly)</p>\n"}, {"tags": ["http", "go", "get"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 2, "creation_date": 1508357714, "post_id": 46818484, "comment_id": 80584305, "body": "That is the url. <code>http.Get(&quot;http:&#47;&#47;example.com&#47;hello?name=username&quot;)</code>"}, {"owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1508357807, "post_id": 46818484, "comment_id": 80584345, "body": "yes but is there any way to do this passing the payload like in python requests lib?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1508357900, "post_id": 46818484, "comment_id": 80584398, "body": "You can use <a href=\"https://golang.org/pkg/net/url/#Values\" rel=\"nofollow noreferrer\"><code>url.Values</code></a> to encode the parameters if you need."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 1, "creation_date": 1508357914, "post_id": 46818484, "comment_id": 80584406, "body": "what do you mean by payload? The query parameter? That&#39;s part of the url. You can build a url with the <a href=\"https://golang.org/pkg/net/url/\" rel=\"nofollow noreferrer\">url package</a>, or <a href=\"https://golang.org/pkg/fmt/#Sprintf\" rel=\"nofollow noreferrer\">fmt.Sprintf</a>. Usually &quot;payload&quot; refers to a request body, which GET doesn&#39;t really use."}], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 2, "last_activity_date": 1508371164, "creation_date": 1508371164, "answer_id": 46820973, "question_id": 46818484, "link": "https://stackoverflow.com/questions/46818484/do-a-get-request-with-query-parameters/46820973#46820973", "title": "Do a GET request with query parameters", "body": "<p>The simplest way it to simply add it to the URL:</p>\n\n<pre><code>  http.Get(\"http://example.com/hello?name=username\")\n</code></pre>\n\n<p>The way I prefer to do it is to use <code>url.Values</code> to build the query string:</p>\n\n<pre><code>v := url.Values{}\nv.Set(\"name\", \"username\")\nurl := fmt.Sprintf(\"http://example.com/hello?%s\", v.Encode())\nhttp.Get(url)\n</code></pre>\n"}], "owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 46820973, "answer_count": 1, "score": -5, "last_activity_date": 1508450192, "creation_date": 1508357675, "last_edit_date": 1508450192, "question_id": 46818484, "link": "https://stackoverflow.com/questions/46818484/do-a-get-request-with-query-parameters", "title": "Do a GET request with query parameters", "body": "<p>I'm trying to do a request like this:</p>\n\n<pre><code>http://example.com/hello?name=username\n</code></pre>\n\n<p>But in the Docs I can't find a way to pass the payload parameter. (http.Get() only receives the url)</p>\n\n<p>How can I do this request?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 72748, "user_id": 3185459, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PBjxg.jpg?s=128&g=1", "display_name": "RomanPerekhrest", "link": "https://stackoverflow.com/users/3185459/romanperekhrest"}, "edited": false, "score": 1, "creation_date": 1508352154, "post_id": 46817073, "comment_id": 80581420, "body": "it&#39;s easy with programming language"}, {"owner": {"reputation": 19159, "user_id": 3600709, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/731c8c4c0029d3414563333de16b8977?s=128&d=identicon&r=PG&f=1", "display_name": "ctwheels", "link": "https://stackoverflow.com/users/3600709/ctwheels"}, "edited": false, "score": 0, "creation_date": 1508352393, "post_id": 46817073, "comment_id": 80581562, "body": "<a href=\"https://regex101.com/r/HNW0Gf/2\" rel=\"nofollow noreferrer\"><code>(?:\\(|\\G *, *)\\K(\\d+)(?=[ ,\\d]*\\))</code></a>?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user557597"}, "edited": false, "score": 0, "creation_date": 1508352676, "post_id": 46817073, "comment_id": 80581699, "body": "So, how many groups of numbers do you want to get, 2 ? (<code>1234</code> , <code>5678</code> , 012)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user557597"}, "edited": false, "score": 0, "creation_date": 1508353000, "post_id": 46817073, "comment_id": 80581874, "body": "Try <a href=\"https://regex101.com/r/aZQrIr/1\" rel=\"nofollow noreferrer\">regex101.com/r/aZQrIr/1</a>"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1508355960, "post_id": 46817073, "comment_id": 80583428, "body": "<a href=\"https://regex101.com/r/lTYnc0/2\" rel=\"nofollow noreferrer\">First</a> and <a href=\"https://regex101.com/r/lTYnc0/3\" rel=\"nofollow noreferrer\">second</a>"}, {"owner": {"reputation": 472, "user_id": 2744994, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c9303582697002d5cf67b846653f8cc8?s=128&d=identicon&r=PG&f=1", "display_name": "rullzing", "link": "https://stackoverflow.com/users/2744994/rullzing"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1508356937, "post_id": 46817073, "comment_id": 80583939, "body": "Thanks @WiktorStribi\u017cew. If u added this as an answer, I&#39;ll choose it as the correct one!"}], "answers": [{"tags": [], "owner": {"reputation": 767, "user_id": 4691348, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/molyf.jpg?s=128&g=1", "display_name": "Alfredo Becerra Bauzulli", "link": "https://stackoverflow.com/users/4691348/alfredo-becerra-bauzulli"}, "is_accepted": false, "score": 0, "last_activity_date": 1508353282, "last_edit_date": 1508353282, "creation_date": 1508352949, "answer_id": 46817280, "question_id": 46817073, "link": "https://stackoverflow.com/questions/46817073/regular-expression-for-getting-numbers-in-between/46817280#46817280", "title": "regular expression for getting numbers in between", "body": "<p>You can get all that you want with a single regexp and named groups:</p>\n\n<p>for example with python <code>re</code> module:</p>\n\n<pre><code>import re\n\nCUSTOM_REGEXP = r\".+\\.\\s{0,}\\((?P&lt;first&gt;\\d+)\\s{0,},\\s{0,}(?P&lt;second&gt;\\d+)\\s{0,},\\s{0,}(?P&lt;third&gt;\\d+)\\)\"\nmatch = re.match(CUSTOM_REGEXP, \"bla bla bla.(1234 , 5678 , 012)\"\nm.group(\"first\")  # 1234\nm.group(\"second\") # 5678\nm.group(\"third\")  # 012\n</code></pre>\n\n<p>by parts:</p>\n\n<p><code>.+</code> any character at least one repetition</p>\n\n<p><code>\\.</code> literal dot</p>\n\n<p><code>\\s{0,}</code> optional space</p>\n\n<p><code>\\(</code> literal parenthesis</p>\n\n<p><code>(?P&lt;first&gt;\\d+)</code> named group of at least one integer</p>\n\n<p><code>,</code> literal comma</p>\n"}, {"comments": [{"owner": {"reputation": 472, "user_id": 2744994, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c9303582697002d5cf67b846653f8cc8?s=128&d=identicon&r=PG&f=1", "display_name": "rullzing", "link": "https://stackoverflow.com/users/2744994/rullzing"}, "edited": false, "score": 0, "creation_date": 1508354703, "post_id": 46817380, "comment_id": 80582795, "body": "(\\s*(\\d+)\\s*,.*) this is the only thing that worked.  and it retrieved the 1st group correctly. Why does the language matter?"}], "tags": [], "owner": {"reputation": 176, "user_id": 7416863, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GMK0A.png?s=128&g=1", "display_name": "jjspace", "link": "https://stackoverflow.com/users/7416863/jjspace"}, "is_accepted": false, "score": 0, "last_activity_date": 1508353314, "creation_date": 1508353314, "answer_id": 46817380, "question_id": 46817073, "link": "https://stackoverflow.com/questions/46817073/regular-expression-for-getting-numbers-in-between/46817380#46817380", "title": "regular expression for getting numbers in between", "body": "<p>Since you did not specify a programming language or how you want your output it's hard to give a specific answer but here are some regular expressions that I think could be what you're after.</p>\n\n<ul>\n<li><p>Get all the numbers in one expression using groups: <a href=\"https://regex101.com/r/bQ7hH0/1\" rel=\"nofollow noreferrer\">(\\s?(\\d+)\\s?,\\s?(\\d+)\\s?,\\s?(\\d+)\\s?)</a></p></li>\n<li><p>Pull out first number (in group 1): <a href=\"https://regex101.com/r/lL0ETY/1\" rel=\"nofollow noreferrer\">(\\s*(\\d+)\\s*,.*)</a></p></li>\n<li><p>Pull out second number (in group 1): <a href=\"https://regex101.com/r/IAJhgn/1\" rel=\"nofollow noreferrer\">(.*?,\\s*(\\d+)\\s*,.*)</a></p></li>\n<li><p>Pull out third number (in group 1): <a href=\"https://regex101.com/r/EBM57p/1\" rel=\"nofollow noreferrer\">(.*,.*,\\s*(\\d+)\\s*)</a></p></li>\n</ul>\n\n<p>If any of these are what you were looking for it's up to you to implement them without knowing your desired language.</p>\n"}, {"comments": [{"owner": {"reputation": 472, "user_id": 2744994, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c9303582697002d5cf67b846653f8cc8?s=128&d=identicon&r=PG&f=1", "display_name": "rullzing", "link": "https://stackoverflow.com/users/2744994/rullzing"}, "edited": false, "score": 0, "creation_date": 1508374071, "post_id": 46818406, "comment_id": 80590027, "body": "Sure. You got it :)"}], "tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 1, "last_activity_date": 1508357549, "last_edit_date": 1508357549, "creation_date": 1508357317, "answer_id": 46818406, "question_id": 46817073, "link": "https://stackoverflow.com/questions/46817073/regular-expression-for-getting-numbers-in-between/46818406#46818406", "title": "regular expression for getting numbers in between", "body": "<p>The <a href=\"https://regex101.com/r/lTYnc0/2\" rel=\"nofollow noreferrer\">first regex</a> is</p>\n\n<pre><code>\\(\\s*(\\d+)\n</code></pre>\n\n<p><strong>Details</strong></p>\n\n<ul>\n<li><code>\\(</code> - a <code>(</code></li>\n<li><code>\\s*</code> - 0+ whitespaces</li>\n<li><code>(\\d+)</code> - Group 1: one or more digits</li>\n</ul>\n\n<p>And the <a href=\"https://regex101.com/r/lTYnc0/3\" rel=\"nofollow noreferrer\">second one</a> is</p>\n\n<pre><code>\\(\\s*\\d+\\s*,\\s*(\\d+)\n</code></pre>\n\n<p>Same as above (with the removed capturing group around the first digit matching pattern), but <code>\\s*,\\s*(\\d+)</code> is added:</p>\n\n<ul>\n<li><code>\\s*,\\s*</code> - a <code>,</code> enclosed with 0+ whitespaces</li>\n<li><code>(\\d+)</code> - Group 1: one or more digits</li>\n</ul>\n\n<p><a href=\"https://play.golang.org/p/KMWjI4sFw6\" rel=\"nofollow noreferrer\">Go playground demo</a>:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"regexp\"\n    \"fmt\"\n)\n\nfunc main() {\n    var str = `bla bla bla . (1234 , 5678 , 012)`\n    var re = regexp.MustCompile(`\\(\\s*(\\d+)`)\n\n    match := re.FindStringSubmatch(str)\n    fmt.Println(match[1])\n\n    var re2 = regexp.MustCompile(`\\(\\s*\\d+\\s*,\\s*(\\d+)`)\n    match2 := re2.FindStringSubmatch(str)\n    fmt.Println(match2[1])\n}\n</code></pre>\n\n<p>Results: </p>\n\n<pre><code>1234\n5678\n</code></pre>\n"}], "owner": {"reputation": 472, "user_id": 2744994, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c9303582697002d5cf67b846653f8cc8?s=128&d=identicon&r=PG&f=1", "display_name": "rullzing", "link": "https://stackoverflow.com/users/2744994/rullzing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 0, "accepted_answer_id": 46818406, "answer_count": 3, "score": 1, "last_activity_date": 1508357549, "creation_date": 1508352021, "last_edit_date": 1508354910, "question_id": 46817073, "link": "https://stackoverflow.com/questions/46817073/regular-expression-for-getting-numbers-in-between", "title": "regular expression for getting numbers in between", "body": "<p>So I have something like this:</p>\n\n<p>string . (numbers1 ,numbers2 ,numbers3)\nso something like this:</p>\n\n<p>bla bla bla . (1234 , 5678 , 012)</p>\n\n<p>I would like to get the first numbers, i.e. the numbers between ( and , &amp; disregarding the space before the comma at the same time in one regex, then get the second number in another regex without getting the first so between the first ' and the second '</p>\n\n<p>I've tried to do the following to get the first one but that didn't work even with the space:</p>\n\n<pre><code>^\\(\\d*,$\n</code></pre>\n\n<p>I even tried this: </p>\n\n<pre><code>^.*?\\([^\\d]*(\\d+)[^\\d]*\\).*$\n</code></pre>\n\n<p>And this:</p>\n\n<pre><code>\\[\\((\\d+)\\).*?\\]\n</code></pre>\n\n<p>I'm testing it in here: <a href=\"https://regex101.com/\" rel=\"nofollow noreferrer\">https://regex101.com/</a> and I keep getting no match for some reason</p>\n\n<p>I'm trying to implement it using the Go language</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1508341345, "post_id": 46814109, "comment_id": 80575451, "body": "The direct comparison would be a slice of maps, but without an actual problem we can&#39;t say which is better."}], "answers": [{"tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": false, "score": 3, "last_activity_date": 1508343353, "last_edit_date": 1508343353, "creation_date": 1508342615, "answer_id": 46814522, "question_id": 46814109, "link": "https://stackoverflow.com/questions/46814109/golang-equivalent-to-list-of-dicts-to-store-data/46814522#46814522", "title": "golang equivalent to list of dicts to store data", "body": "<p>Many use cases where you use a dict in python, you want a struct for in Go, to get static typing. In your case this looks like a slice of structs to me:</p>\n\n<pre><code>type Friend struct{\n  Name string `json:\"name\"`\n  Age  int    `json:\"age\"`\n}\n</code></pre>\n\n<p>and then you can serialize/deserialize to <code>[]*Person</code></p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 2, "last_activity_date": 1508350160, "last_edit_date": 1508350160, "creation_date": 1508345867, "answer_id": 46815450, "question_id": 46814109, "link": "https://stackoverflow.com/questions/46814109/golang-equivalent-to-list-of-dicts-to-store-data/46815450#46815450", "title": "golang equivalent to list of dicts to store data", "body": "<p>Puuhon\u2019s equivalent of <code>list</code> is a <code>slice</code>, both has same semantics and use cases. </p>\n\n<p>But what to put into a slice? It depends of your dicts. If they are the same fields I recommend using <code>struct</code>s. Give it fields like above. Sometimes you have to store different keys and different string values for example. Define it as a map string to string:</p>\n\n<pre><code>map[string]string\n</code></pre>\n\n<p>As a last resort there\u2019s a possibility to make dynamically typed map. But it\u2019s not to overuse it because you lose all the benefits of static typing. Program becomes more error-prone and slower. </p>\n"}, {"tags": [], "owner": {"reputation": 2354, "user_id": 606885, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/78308bfba597911237a97e8c2fa6cee1?s=128&d=identicon&r=PG", "display_name": "Esteban", "link": "https://stackoverflow.com/users/606885/esteban"}, "is_accepted": false, "score": 1, "last_activity_date": 1508354795, "creation_date": 1508354795, "answer_id": 46817764, "question_id": 46814109, "link": "https://stackoverflow.com/questions/46814109/golang-equivalent-to-list-of-dicts-to-store-data/46817764#46817764", "title": "golang equivalent to list of dicts to store data", "body": "<p>Given that your sample data seems to be homogeneous (friends share their properties), you can use a <code>slice</code> of <code>struct</code>s, as so:</p>\n\n<pre><code>type Friend struct {\n    Name string\n    Age  int\n}\n\nvar friends []Friend = make([]Friend, 0)\n</code></pre>\n\n<p>now let's say you already added friends to that slice, you can filter those with <code>Age</code> greater than some number:</p>\n\n<pre><code>func filterFriendsAboveAge(allFriends []Friend, minAge int) []Friend {\n    results := make([]Friend, 0) \n    for _, friend := range allFriends {\n        if friend.Age &gt; minAge {\n            results = append(results, friend)\n        }\n    }\n    return results\n}\n</code></pre>\n\n<p>Please note that by calling this function, the Friend values in the returned slice will be copies of the original. If you need to preserve identity, use pointers instead.</p>\n"}, {"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 2, "last_activity_date": 1508398432, "creation_date": 1508398432, "answer_id": 46824767, "question_id": 46814109, "link": "https://stackoverflow.com/questions/46814109/golang-equivalent-to-list-of-dicts-to-store-data/46824767#46824767", "title": "golang equivalent to list of dicts to store data", "body": "<p>Here is a little sample program that does what you want:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\ntype friend struct {\n    name string\n    age  int\n}\n\nfunc main() {\n    friends := []friend{\n        {\"James\", 44},\n        {\"Jane\", 47},\n        {\"Bob\", 30},\n        {\"Cesar\", 90},\n        {\"John\", 45},\n    }\n\n    over45 := filterFriends(friends, func(f friend) bool {\n        return f.age &gt; 45\n    })\n    fmt.Println(\"over 45:\", over45)\n\n    // note that sort.Sort will change the contents of the slice; if you want\n    // to keep the original order as well, you would first have to copy that\n    // slice and sort the copy\n    sort.Sort(byAge(friends))\n    fmt.Println(\"sorted by age:\", friends)\n}\n\n// filterFriends takes your slice and a predicate to filter by, then returns a\n// newly allocated list of friends that made it through the filter.\nfunc filterFriends(friends []friend, pred func(friend) bool) []friend {\n    var fit []friend\n    for _, f := range friends {\n        if pred(f) {\n            fit = append(fit, f)\n        }\n    }\n    return fit\n}\n\n// byAge implements the sort.Interface so we can pass it to sort.Sort.\ntype byAge []friend\n\nfunc (f byAge) Len() int           { return len(f) }\nfunc (f byAge) Less(i, j int) bool { return f[i].age &lt; f[j].age }\nfunc (f byAge) Swap(i, j int)      { f[i], f[j] = f[j], f[i] }\n</code></pre>\n\n<p>the output of the program is:</p>\n\n<pre><code>over 45: [{Jane 47} {Cesar 90}]\nsorted by age: [{Bob 30} {James 44} {John 45} {Jane 47} {Cesar 90}]\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 3170328, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/QkYHN.jpg?s=128&g=1", "display_name": "futureprogress", "link": "https://stackoverflow.com/users/3170328/futureprogress"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1080, "favorite_count": 0, "answer_count": 4, "score": 4, "last_activity_date": 1508398432, "creation_date": 1508341202, "last_edit_date": 1508362130, "question_id": 46814109, "link": "https://stackoverflow.com/questions/46814109/golang-equivalent-to-list-of-dicts-to-store-data", "title": "golang equivalent to list of dicts to store data", "body": "<p>I'm learning golang. I am trying to store a little bit of data, which I will then send to file.</p>\n\n<p>What would be the golang equivalent of this python block? (a list of dicts)</p>\n\n<pre><code>friends = [\n  {\n    \"name\":\"James\",\n    \"age\":44,\n  },\n  {\n    \"name\":\"Jane\",\n    \"age\":47,\n  },\n]\n</code></pre>\n\n<p>Would it be better to use a slice of maps or a struct? </p>\n\n<p>I want to be able to filter the data (for example all friends over 45) and sort the data (lets imagine I've got 12+ records). then print it to the screen.</p>\n"}, {"tags": ["go", "jpegoptim"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1508339271, "post_id": 46813087, "comment_id": 80573954, "body": "You need to encode the image into some format. If you want a jpeg, then look at the jpeg package: <a href=\"https://golang.org/pkg/image/jpeg/#Encode\" rel=\"nofollow noreferrer\">golang.org/pkg/image/jpeg/#Encode</a>"}, {"owner": {"reputation": 245, "user_id": 1496317, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8aaed7a968f12467148e2a8a8c4ac2c0?s=128&d=identicon&r=PG", "display_name": "tsdtsdtsd", "link": "https://stackoverflow.com/users/1496317/tsdtsdtsd"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508340620, "post_id": 46813087, "comment_id": 80574911, "body": "Thanks @JimB So, for example, I encode to a bytes.Buffer and can use that directly as it also implements the io.Reader, right?"}], "answers": [{"tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 3, "last_activity_date": 1508454382, "last_edit_date": 1508454382, "creation_date": 1508419906, "answer_id": 46831124, "question_id": 46813087, "link": "https://stackoverflow.com/questions/46813087/implement-io-reader-from-image-rgba/46831124#46831124", "title": "Implement io.Reader from image.RGBA", "body": "<p>In this case, you don't need to implement your own <code>io.Reader</code>. Use <a href=\"https://golang.org/pkg/io/#Pipe\" rel=\"nofollow noreferrer\"><code>io.Pipe</code></a> and <a href=\"https://golang.org/pkg/image/jpeg/#Encode\" rel=\"nofollow noreferrer\"><code>jpeg.Encode</code></a>, e.g.</p>\n\n<pre><code>func main() {\n    //Prepare image ...\n    img := ...\n\n    //Prepare output (file etc.) ...\n    outFile := ...\n\n    //Use pipe to connect JPEG encoder output to cmd's STDIN\n    pr, pw := io.Pipe()\n\n    //Exec jpegoptim in goroutine\n    done := make(chan bool, 1)\n    go func() {\n        //execute command\n        cmdErr := bytes.Buffer{}\n        cmd := exec.Command(\"jpegoptim\", \"--stdin\", \"--verbose\")\n        cmd.Stdin = pr       //image input from PIPE\n        cmd.Stderr = &amp;cmdErr //message\n        cmd.Stdout = outFile //optimize image output\n\n        if err := cmd.Run(); err != nil {\n            // handle error\n        }\n        fmt.Printf(\"Result: %s\\n\", cmdErr.String())\n        close(done)\n    }()\n\n    //ENCODE image to JPEG then write to PIPE\n    o := jpeg.Options{Quality: 90}\n    jpeg.Encode(pw, img, &amp;o)\n\n    //When done, close the PIPE\n    if err := pw.Close(); err != nil {\n        // handle error\n    }\n\n    //Wait for jpegoptim\n    &lt;-done\n}\n</code></pre>\n"}], "owner": {"reputation": 245, "user_id": 1496317, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/8aaed7a968f12467148e2a8a8c4ac2c0?s=128&d=identicon&r=PG", "display_name": "tsdtsdtsd", "link": "https://stackoverflow.com/users/1496317/tsdtsdtsd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1338, "favorite_count": 0, "accepted_answer_id": 46831124, "answer_count": 1, "score": 0, "last_activity_date": 1508454382, "creation_date": 1508338198, "question_id": 46813087, "link": "https://stackoverflow.com/questions/46813087/implement-io-reader-from-image-rgba", "title": "Implement io.Reader from image.RGBA", "body": "<p>I need a little hint. I'm creating thumbnails of images in Go and would like to pass them to jpegoptim for crushing.</p>\n\n<p>jpegoptim has the --stdin and --stdout flags, which I would like to use. Now, I don't want to save the generated image to disk first, but convert my *image.RGBA to something that implements io.Reader, so I can pass it to exec.Cmd.Stdin </p>\n\n<p>I'm a little lost on how I could achieve this, would be great if someone can point me in the right direction.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["pointers", "go", "reference"], "answers": [{"tags": [], "owner": {"reputation": 113, "user_id": 5594325, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GWcLp.jpg?s=128&g=1", "display_name": "skovtunenko", "link": "https://stackoverflow.com/users/5594325/skovtunenko"}, "is_accepted": false, "score": 1, "last_activity_date": 1508338895, "creation_date": 1508338895, "answer_id": 46813333, "question_id": 46813084, "link": "https://stackoverflow.com/questions/46813084/passing-variable-of-type-alias-into-function-that-requires-pointer-to-underlying/46813333#46813333", "title": "Passing variable of type alias into function that requires pointer to underlying type", "body": "<p>The <code>region</code> variable should be casted to the <code>pointer to string</code> type.\nBut due to <code>*</code> operator precedence, this should be done this way:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype AwsRegion string\n\n\nfunc main() {\n    var region AwsRegion = \"us-west-2\"\n    f((*string)(&amp;region)) // parentheses required!\n}\n\nfunc f(s *string) {\n    fmt.Println(*s)\n}\n</code></pre>\n\n<p>Link to <a href=\"https://play.golang.org/p/vFdt_JQghm\" rel=\"nofollow noreferrer\">playground</a></p>\n"}, {"comments": [{"owner": {"reputation": 113, "user_id": 5594325, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GWcLp.jpg?s=128&g=1", "display_name": "skovtunenko", "link": "https://stackoverflow.com/users/5594325/skovtunenko"}, "edited": false, "score": 0, "creation_date": 1508341574, "post_id": 46813345, "comment_id": 80575613, "body": "That <code>f()</code> function is out of my control. It&#39;s basically, simplified signature of  <code>flag.StringVar(p *string,.....)</code> function. So, need to satisfy contract. And i have variable of type <code>AwsRegion</code> (with my methods attached) that I want to pass into that <code>flag.StringVar()</code> function.  Actually, I solved this issue by implementing for my <code>AwsRegion</code> type all methods from <code>flag.Value</code> interface -- but that&#39;s a different story."}], "tags": [], "owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "is_accepted": true, "score": 0, "last_activity_date": 1508342424, "last_edit_date": 1508342424, "creation_date": 1508338920, "answer_id": 46813345, "question_id": 46813084, "link": "https://stackoverflow.com/questions/46813084/passing-variable-of-type-alias-into-function-that-requires-pointer-to-underlying/46813345#46813345", "title": "Passing variable of type alias into function that requires pointer to underlying type", "body": "<p>I do not understand why you need to define an <code>AwsRegion</code> type if your input takes a <code>string</code> as an input.</p>\n\n<p>Use <code>f(s *AwsRegion)</code></p>\n\n<p><strong>EDIT</strong> - as per your comments</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n)\n\ntype AwsRegion string\n\nvar region AwsRegion\n\nfunc main() {\n    flag.StringVar((*string)(&amp;region), \"region\", \"us-west-1\", \"AWS region to use\")\n    flag.Parse()\n}\n\nfunc f(s *string) {\n    fmt.Println(*s) // just an example\n}\n</code></pre>\n"}], "owner": {"reputation": 113, "user_id": 5594325, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GWcLp.jpg?s=128&g=1", "display_name": "skovtunenko", "link": "https://stackoverflow.com/users/5594325/skovtunenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 353, "favorite_count": 1, "accepted_answer_id": 46813345, "answer_count": 2, "score": 0, "last_activity_date": 1508763665, "creation_date": 1508338191, "last_edit_date": 1508763665, "question_id": 46813084, "link": "https://stackoverflow.com/questions/46813084/passing-variable-of-type-alias-into-function-that-requires-pointer-to-underlying", "title": "Passing variable of type alias into function that requires pointer to underlying type", "body": "<p>I have my custom type alias (<em>with methods</em>) defined as:</p>\n\n<pre><code>type AwsRegion string\n</code></pre>\n\n<p>Then I want to pass variable of this type to another legacy (<em>not under my control</em>) function, that accepts pointer to string (<em>pointer to underlying type</em>):</p>\n\n<pre><code>func main() {\n    var region AwsRegion = \"us-west-2\"\n    f(&amp;region) // How to properly cast AwsRegion type here?\n}\n\nfunc f(s *string) {\n    fmt.Println(*s) // just an example\n}\n</code></pre>\n\n<p>And of course I can't do that, error message states:</p>\n\n<pre><code>cannot use &amp;region (type *AwsRegion) as type *string in argument to f\n</code></pre>\n\n<p>How to properly cast <code>region</code> variable?</p>\n"}, {"tags": ["json", "go", "struct"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1508334340, "post_id": 46811660, "comment_id": 80570489, "body": "Go is a statically typed and compiled language. You could generate the code and compile it after. Maps and slices are probably a much better fit for dynamic data."}], "answers": [{"tags": [], "owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "is_accepted": false, "score": 1, "last_activity_date": 1508334656, "creation_date": 1508334656, "answer_id": 46811808, "question_id": 46811660, "link": "https://stackoverflow.com/questions/46811660/how-to-dynamically-define-struct-content-in-go-from-reading-a-json-file/46811808#46811808", "title": "How to dynamically define struct content in GO from reading a json file", "body": "<p>You can use JSON schema to define your types and generate Go code with your types using this package: <a href=\"https://github.com/idubinskiy/schematyper\" rel=\"nofollow noreferrer\">https://github.com/idubinskiy/schematyper</a></p>\n"}], "owner": {"reputation": 43, "user_id": 8350141, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47ab86268652619ef9dc9fea0fe7433e?s=128&d=identicon&r=PG&f=1", "display_name": "Rey Wijojo", "link": "https://stackoverflow.com/users/8350141/rey-wijojo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1508334656, "creation_date": 1508334215, "question_id": 46811660, "link": "https://stackoverflow.com/questions/46811660/how-to-dynamically-define-struct-content-in-go-from-reading-a-json-file", "title": "How to dynamically define struct content in GO from reading a json file", "body": "<p>I'm trying to create a go struct for my project. I want the struct content to be defined in a separate JSON file, as example below :</p>\n\n<pre><code>{\n    \"structA\":{\n          \"column_name\" :[\"id\",\"name\",\"occupation\",\"age\"],\n          \"column_type\" :[\"int\",\"string\",\"string\",\"int\"]\n}\n</code></pre>\n\n<p>And when we compile go, the struct will be somehow like </p>\n\n<pre><code>type structA struct {\n    id int\n    name string\n    occupation string\n    age int\n}\n</code></pre>\n\n<p>I want the structA definition to be written in a way like looping though the json and generate it afterwards. Is it possible to do so in Go?</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": true, "score": 1, "last_activity_date": 1508333426, "last_edit_date": 1508333426, "creation_date": 1508333161, "answer_id": 46811313, "question_id": 46811235, "link": "https://stackoverflow.com/questions/46811235/unmarshall-json-with-a-intstring-map-contained-in-an-array/46811313#46811313", "title": "Unmarshall JSON with a [int]string map contained in an array", "body": "<p>The data you showed should be unmarshaled to:</p>\n\n<pre><code>type Response struct {\n            Metric struct {\n                Name string `json:\"name,omitempty\"`\n                Appname string `json:\"appname,omitempty\"`\n            } `json:\"metric,omitempty\"`\n            Values [][]interface{} `json:\"values,omitempty\"`\n}\n</code></pre>\n\n<p>If you want to to transfer it to map implement <code>json.Unmarshaller</code> interface - <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/json/#Unmarshaler</a></p>\n\n<p>You can have something like:</p>\n\n<pre><code>type Item struct {\n    Key int\n    Val string\n}\nfunc(item *Item) UnmarshalJSON([]byte) error {\n    // TODO: implement \n}\n\ntype Response struct {\n            Metric struct {\n                Name string `json:\"name,omitempty\"`\n                Appname string `json:\"appname,omitempty\"`\n            } `json:\"metric,omitempty\"`\n            Values []Item  `json:\"values,omitempty\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 245, "user_id": 7360695, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/5ba260c91ea10f26485623058a28e4fc?s=128&d=identicon&r=PG&f=1", "display_name": "Battalgazi", "link": "https://stackoverflow.com/users/7360695/battalgazi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 46811313, "answer_count": 1, "score": 0, "last_activity_date": 1508334430, "creation_date": 1508332949, "last_edit_date": 1508334430, "question_id": 46811235, "link": "https://stackoverflow.com/questions/46811235/unmarshall-json-with-a-intstring-map-contained-in-an-array", "title": "Unmarshall JSON with a [int]string map contained in an array", "body": "<p>Im trying to unmarshall the following JSON into a struct, but there I am unable to translate the contents of the values field with the <code>[[int,string]]</code>\nThis is what I have so far: </p>\n\n<pre><code>type Response struct {\n            Metric struct {\n                Name string `json:\"name,omitempty\"`\n                Appname string `json:\"appname,omitempty\"`\n            } `json:\"metric,omitempty\"`\n            Values []map[int]string `json:\"values,omitempty\"`\n}\n</code></pre>\n\n<p>The JSON file:</p>\n\n<pre><code>{\n   \"metric\":{\n      \"name\":\"x444\",\n      \"appname\":\"cc-14-471s6\"\n   },\n   \"values\":[\n      [\n         1508315264,\n         \"0.0012116165566900816\"\n      ],\n      [\n         1508315274,\n         \"0.0011871631158857396\"\n      ]\n   ]\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 11213, "user_id": 103999, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/231742e13810156987b1e462314f8eb9?s=128&d=identicon&r=PG", "display_name": "Lee Armstrong", "link": "https://stackoverflow.com/users/103999/lee-armstrong"}, "edited": false, "score": 2, "creation_date": 1508327837, "post_id": 46809598, "comment_id": 80566275, "body": "For a start I would use the latest version of Go.  1.6 is quite old now"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1508327961, "post_id": 46809598, "comment_id": 80566366, "body": "Uninstall your totally outdated Go 1.6 and install the latest version from golang.org following their install instructions."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1508380399, "post_id": 46809598, "comment_id": 80591452, "body": "remove completely your folder /usr/share/go-1.6 and follow this instructions <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">golang.org/doc/install</a>"}], "owner": {"reputation": 21, "user_id": 8789687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/11ba10c11cdb03609f5fa40c0972d16c?s=128&d=identicon&r=PG&f=1", "display_name": "zrocks", "link": "https://stackoverflow.com/users/8789687/zrocks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1107, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1508327734, "creation_date": 1508327734, "question_id": 46809598, "link": "https://stackoverflow.com/questions/46809598/go-get-error-go-tool-no-such-tool-compile", "title": "go get error: go tool: no such tool &quot;compile&quot;", "body": "<p>I want to build go program from source. And it need some package from github as below.</p>\n\n<pre><code>\u279c  MEOW git:(master) \u2717 go build\nlog.go:13:2: cannot find package \"github.com/cyfdecyf/color\" in any of:\n    /usr/share/go-1.6/src/github.com/cyfdecyf/color (from $GOROOT)\n    /home/user/gopath/src/github.com/cyfdecyf/color (from $GOPATH)\n../../gopath/src/github.com/shadowsocks/shadowsocks-go/shadowsocks/encrypt.go:16:2: cannot find package \"golang.org/x/crypto/blowfish\" in any of:\n    /usr/share/go-1.6/src/golang.org/x/crypto/blowfish (from $GOROOT)\n    /home/user/gopath/src/golang.org/x/crypto/blowfish (from $GOPATH)\n../../gopath/src/github.com/shadowsocks/shadowsocks-go/shadowsocks/encrypt.go:17:2: cannot find package \"golang.org/x/crypto/cast5\" in any of:\n    /usr/share/go-1.6/src/golang.org/x/crypto/cast5 (from $GOROOT)\n    /home/user/gopath/src/golang.org/x/crypto/cast5 (from $GOPATH)\n../../gopath/src/github.com/shadowsocks/shadowsocks-go/shadowsocks/encrypt.go:18:2: cannot find package \"golang.org/x/crypto/salsa20/salsa\" in any of:\n    /usr/share/go-1.6/src/golang.org/x/crypto/salsa20/salsa (from $GOROOT)\n    /home/user/gopath/src/golang.org/x/crypto/salsa20/salsa (from $GOPATH)\n</code></pre>\n\n<p>I run <code>go get</code>. But get <code>no such tool \"compile\"</code> error.</p>\n\n<pre><code>\u279c  MEOW git:(master) \u2717 go get github.com/cyfdecyf/color\ngo tool: no such tool \"compile\"\n</code></pre>\n\n<p>My system  is ubuntu 16. And I install golang from package.</p>\n\n<pre><code>\u279c  MEOW git:(master) \u2717 go env\nGOARCH=\"amd64\"\nGOBIN=\"/usr/share/go-1.6/bin\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/user/gopath\"\nGORACE=\"\"\nGOROOT=\"/usr/share/go-1.6\"\nGOTOOLDIR=\"/usr/share/go-1.6/pkg/tool/linux_amd64\"\nGO15VENDOREXPERIMENT=\"1\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\n</code></pre>\n\n<p>What should I do to get go package?</p>\n"}, {"tags": ["go", "arguments"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1508328100, "post_id": 46809554, "comment_id": 80566452, "body": "1. Don&#39;t ignore the error. Really. Don&#39;t. 2. Debug what really is in imgPath. 3. <code>&quot;-l spa+eng&quot;</code> probably should be <b>two</b> arguments."}, {"owner": {"reputation": 204, "user_id": 6532897, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/435502d7612ac27de3fcdf788f0813b2?s=128&d=identicon&r=PG&f=1", "display_name": "jufracaqui", "link": "https://stackoverflow.com/users/6532897/jufracaqui"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1508328310, "post_id": 46809554, "comment_id": 80566578, "body": "Thank you for commenting. As I say in the question if I write args := []string{&quot;asdf.png&quot;, &quot;stdout&quot;, &quot;-l spa+eng&quot;} it works as it is supposed to."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1508331305, "post_id": 46809554, "comment_id": 80568462, "body": "Then concentrate on points 1 and 2."}], "answers": [{"tags": [], "owner": {"reputation": 204, "user_id": 6532897, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/435502d7612ac27de3fcdf788f0813b2?s=128&d=identicon&r=PG&f=1", "display_name": "jufracaqui", "link": "https://stackoverflow.com/users/6532897/jufracaqui"}, "is_accepted": true, "score": 1, "last_activity_date": 1508391274, "creation_date": 1508391274, "answer_id": 46823376, "question_id": 46809554, "link": "https://stackoverflow.com/questions/46809554/passing-variable-as-argument-for-exec-command/46823376#46823376", "title": "Passing variable as argument for exec.Command()", "body": "<p>The following code returns a line <strong>with the delimiter</strong> (I work on Windows and its EOL is '\\r\\n'), something that wasn't shown when I printed it on the console.</p>\n\n<pre><code>reader := bufio.NewReader(os.Stdin)\nimgPath, _ := reader.ReadString('\\n')\n</code></pre>\n\n<p>In my case it ended up working after I trimmed  '\\r\\n' from the input:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"os/exec\"\n)\n\nfunc main() {\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"Enter img path: \")\n    imgPath, _ := reader.ReadString('\\n')\n    imgPath= strings.TrimRight(line, \"\\r\\n\")\n\n    args := []string{imgPath, \"stdout\", \"-l spa+eng\"}\n    out, err := exec.Command(\"tesseract\", args...).Output()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(string(out))\n}\n</code></pre>\n"}], "owner": {"reputation": 204, "user_id": 6532897, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/435502d7612ac27de3fcdf788f0813b2?s=128&d=identicon&r=PG&f=1", "display_name": "jufracaqui", "link": "https://stackoverflow.com/users/6532897/jufracaqui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1351, "favorite_count": 0, "accepted_answer_id": 46823376, "answer_count": 1, "score": -2, "last_activity_date": 1508391274, "creation_date": 1508327627, "question_id": 46809554, "link": "https://stackoverflow.com/questions/46809554/passing-variable-as-argument-for-exec-command", "title": "Passing variable as argument for exec.Command()", "body": "<p>I want to read user input and use it as an argument for a command. I got this code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"os/exec\"\n)\n\nfunc main() {\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"Enter img path: \")\n    imgPath, _ := reader.ReadString('\\n')\n\n    args := []string{imgPath, \"stdout\", \"-l spa+eng\"}\n    out, err := exec.Command(\"tesseract\", args...).Output()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(string(out))\n}\n</code></pre>\n\n<p>But when I execute it it outputs an error saying <strong>exit status 1</strong>.</p>\n\n<p>If instead of using the variable <strong>imgPath</strong> as an argument I write some text directly into the array it works like a charm.</p>\n"}, {"tags": ["arrays", "image-processing", "go", "computer-vision"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1508328011, "last_edit_date": 1508328011, "creation_date": 1508327691, "answer_id": 46809576, "question_id": 46809499, "link": "https://stackoverflow.com/questions/46809499/why-cant-you-put-a-variable-as-a-multidimensional-array-size-in-go/46809576#46809576", "title": "Why can&#39;t you put a variable as a multidimensional array size in Go?", "body": "<p>Because Go is a statically typed language, which means types of variables need to be known at compile-time.</p>\n\n<p><a href=\"https://golang.org/ref/spec#Array_types\" rel=\"noreferrer\">Arrays</a> in Go are fixed sizes: once you create an array in Go, you can't change its size later on. This is so to an extent that the length of an array is part of the array type (this means the types <code>[2]int</code> and <code>[3]int</code> are 2 distinct types).</p>\n\n<p>The value of a variable is generally not known at compile-time, so using that as the array length, the type would not be known at compile time, hence it is not allowed.</p>\n\n<p>Read related questions: <a href=\"https://stackoverflow.com/questions/35937828/how-do-i-find-the-size-of-the-array-in-go/35939008#35939008\">How do I find the size of the array in go</a></p>\n\n<p>If you don't know the size at compile time, use <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"noreferrer\">slices</a> instead of arrays (there are other reasons to use slices too).</p>\n\n<p>For example this code:</p>\n\n<pre><code>func addImage(path string, image string, Height int, Width int){\n    var Size int\n    Size = Width * Height\n    var Pix [Size][3]int\n    // use Pix\n}\n</code></pre>\n\n<p>Can be transformed to create and use a slice like this:</p>\n\n<pre><code>func addImage(path string, image string, Height int, Width int){\n    var Size int\n    Size = Width * Height\n    var Pix = make([][3]int, Size)\n    // use Pix\n}\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 8795327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0643a53eb2143f817a40871c4d58217?s=128&d=identicon&r=PG&f=1", "display_name": "Arturo Contreras", "link": "https://stackoverflow.com/users/8795327/arturo-contreras"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 609, "favorite_count": 1, "accepted_answer_id": 46809576, "answer_count": 1, "score": 0, "last_activity_date": 1508329249, "creation_date": 1508327449, "last_edit_date": 1508329249, "question_id": 46809499, "link": "https://stackoverflow.com/questions/46809499/why-cant-you-put-a-variable-as-a-multidimensional-array-size-in-go", "title": "Why can&#39;t you put a variable as a multidimensional array size in Go?", "body": "<p>Recently, I've been interested in machine learning more specifically, machine learning with images, but to do that, I need to be able to process images. I want to have a more thorough understanding of how image processing libraries work along the way, so I have decided to make my own library for reading images that I can understand. However, I seem to have an issue when it comes to reading the <strong>SIZE</strong> of an image, as this error pops up when I try to compile:</p>\n\n<pre><code> ./imageProcessing.go:33:11: non-constant array bound Size\n</code></pre>\n\n<p>This is my code: </p>\n\n<pre><code>package main\n\nimport (\n // \"fmt\"\n // \"os\"\n)\n\n// This function reads a dimension of an image you would use it like readImageDimension(\"IMAGENAME.PNG\", \"HEIGHT\")\n\n func readImageDimension(path string, which string) int{\n\nvar dimensionyes int\n\nif(which == \"\" || which == \" \"){\n    panic (\"You have not entered which dimension you want to have.\")\n} else if (which == \"Height\" || which == \"HEIGHT\" || which == \"height\" || which == \"h\" || which ==\"H\"){\n    //TODO: Insert code for reading the Height of the image\n\n    return dimensionyes\n\n} else if (which == \"Width\" || which == \"WIDTH\" || which == \"width\" || which == \"w\" || which ==\"W\"){\n    //TODO: Insert code for reading the Width of the image\n\n    return dimensionyes\n\n} else {\n    panic(\"Dimension type not recognized.\")\n    }\n }\n\n func addImage(path string, image string, Height int, Width int){\n    var Size int\n    Size = Width * Height\n    var Pix [Size][3]int\n }\n\nfunc main() {\n\n\n}\n</code></pre>\n\n<p>I'm just beginning programming with Go, so I'm sorry if this question sounds nooby</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 5381, "user_id": 3958148, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/1d13082f7803e52dd98b2808509976c2?s=128&d=identicon&r=PG", "display_name": "Sung Cho", "link": "https://stackoverflow.com/users/3958148/sung-cho"}, "edited": false, "score": 4, "creation_date": 1508323980, "post_id": 46808332, "comment_id": 80563935, "body": "<code>QueryExpr</code> returns <code>*expr</code>. Any suggestions on how to plug that value in <code>FROM</code>? Also, the link does not work because there is no &#39;subquery&#39; section in the doc."}, {"owner": {"reputation": 3351, "user_id": 6633434, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/Z3AKA.png?s=128&g=1", "display_name": "Sumit Agarwal", "link": "https://stackoverflow.com/users/6633434/sumit-agarwal"}, "edited": false, "score": 0, "creation_date": 1526109336, "post_id": 46808332, "comment_id": 87623927, "body": "is <code>DB</code> equivalent to <code>gorm.DB</code>. I am not able to find <code>QueryExpr()</code> func in my library"}, {"owner": {"reputation": 145, "user_id": 210071, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/bf07e034fe718dd344368fc65100a79e?s=128&d=identicon&r=PG", "display_name": "Ben Burleson", "link": "https://stackoverflow.com/users/210071/ben-burleson"}, "reply_to_user": {"reputation": 3351, "user_id": 6633434, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/Z3AKA.png?s=128&g=1", "display_name": "Sumit Agarwal", "link": "https://stackoverflow.com/users/6633434/sumit-agarwal"}, "edited": false, "score": 0, "creation_date": 1528391105, "post_id": 46808332, "comment_id": 88500929, "body": "@SumitAgarwal I have the same question. Using <code>gorm.DB</code> there won&#39;t work because the receiver isn&#39;t a pointer. And declaring a <code>var DB *gorm.DB</code> doesn&#39;t work either because then it&#39;s trying to call <code>Table</code> on a nil pointer. Definitely not obvious what the solution is, but I&#39;m still looking.."}, {"owner": {"reputation": 145, "user_id": 210071, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/bf07e034fe718dd344368fc65100a79e?s=128&d=identicon&r=PG", "display_name": "Ben Burleson", "link": "https://stackoverflow.com/users/210071/ben-burleson"}, "edited": false, "score": 0, "creation_date": 1528391452, "post_id": 46808332, "comment_id": 88501091, "body": "It looks like you can just use <code>db</code>, or whatever variable is your top-level <code>*gorm.DB</code>. I think the uppercase <code>DB</code> is a typo."}], "tags": [], "owner": {"reputation": 415, "user_id": 2851543, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14ccf22c2997ad9d6512b4a0a5527e6a?s=128&d=identicon&r=PG&f=1", "display_name": "Jinzhu", "link": "https://stackoverflow.com/users/2851543/jinzhu"}, "is_accepted": true, "score": 2, "last_activity_date": 1508327586, "last_edit_date": 1508327586, "creation_date": 1508323428, "answer_id": 46808332, "question_id": 46807891, "link": "https://stackoverflow.com/questions/46807891/using-a-subquery-in-from-in-gorm/46808332#46808332", "title": "Using a subquery in &#39;FROM&#39; in gorm", "body": "<p>You could use <code>QueryExpr</code>, refer</p>\n\n<p><a href=\"http://jinzhu.me/gorm/crud.html#subquery\" rel=\"nofollow noreferrer\">http://jinzhu.me/gorm/crud.html#subquery</a></p>\n\n<blockquote>\n  <p>db.Where(\"amount > ?\",\n  DB.Table(\"orders\").Select(\"AVG(amount)\").Where(\"state = ?\",\n  \"paid\").QueryExpr()).Find(&amp;orders)</p>\n</blockquote>\n\n<p>Which generate SQL</p>\n\n<blockquote>\n  <p>SELECT * FROM \"orders\"  WHERE \"orders\".\"deleted_at\" IS NULL AND\n  (amount > (SELECT AVG(amount) FROM \"orders\"  WHERE (state = 'paid')));</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 59, "user_id": 6434017, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf189f237e17f4533eb4c86ba6346b9a?s=128&d=identicon&r=PG", "display_name": "Mykyta Nikitenko", "link": "https://stackoverflow.com/users/6434017/mykyta-nikitenko"}, "is_accepted": false, "score": 4, "last_activity_date": 1533307618, "creation_date": 1533307618, "answer_id": 51675158, "question_id": 46807891, "link": "https://stackoverflow.com/questions/46807891/using-a-subquery-in-from-in-gorm/51675158#51675158", "title": "Using a subquery in &#39;FROM&#39; in gorm", "body": "<p>Also you can do it with join on a subquery</p>\n\n<pre><code>subQuery := db.\n    Select(\"foo.*\").\n    Table(\"foo\").\n    Where(\"bar = ?\", \"baz\").\n    SubQuery()\n\ndb.\n    Select(\"t1.*\").\n    Join(\"INNER JOIN ? AS t1 ON t1.id = foo.id\", subQuery).\n    Where(\"t1.id = ?\", 1)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 147, "user_id": 7696326, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4324de88ad3e0a7229a3021268d2422b?s=128&d=identicon&r=PG&f=1", "display_name": "randy", "link": "https://stackoverflow.com/users/7696326/randy"}, "is_accepted": false, "score": 0, "last_activity_date": 1556844979, "creation_date": 1556844979, "answer_id": 55962004, "question_id": 46807891, "link": "https://stackoverflow.com/questions/46807891/using-a-subquery-in-from-in-gorm/55962004#55962004", "title": "Using a subquery in &#39;FROM&#39; in gorm", "body": "<p>FYI \u2013 Jinzhu's method doesn't work </p>\n\n<p>I have subqueries working using this method...</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var somevalue = 1\nrow := db.Select(\"something\").Table(\"first_table\").Where(\"exists(?)\", db.Select(\"a_relationship_to_something\").Model(&amp;SecondTable{}).Where(\"id = ?\", somevalue).QueryExpr()).Row()\nvar result string\nrow.Scan(&amp;result)\n</code></pre>\n\n<p>I've tested this with <code>row()</code>, <code>rows()</code>, <code>first()</code>, and <code>find()</code>. You can also use both <code>.Table()</code> and <code>.Model()</code> interchangeably as shown in the example. </p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6482208, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qN2Mr.jpg?s=128&g=1", "display_name": "Zhangliu", "link": "https://stackoverflow.com/users/6482208/zhangliu"}, "is_accepted": false, "score": 0, "last_activity_date": 1559098721, "creation_date": 1559098721, "answer_id": 56352497, "question_id": 46807891, "link": "https://stackoverflow.com/questions/46807891/using-a-subquery-in-from-in-gorm/56352497#56352497", "title": "Using a subquery in &#39;FROM&#39; in gorm", "body": "<p>also could be used in join </p>\n\n<pre><code>subQuery:=db.Find(&amp;subTable).QueryExpr()\n\ndb.\nTable(\"table\").\nSelect(\"*\").\nJoin(\"join (?) as t1 on t1.id==table.id\", //&lt;---round brackets for multiple rows\nsubQuery).\nFind(&amp;Rows)\n\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 301, "user_id": 2561048, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4cd097e1eaf4b82dc8be836dc666711?s=128&d=identicon&r=PG", "display_name": "ryanking", "link": "https://stackoverflow.com/users/2561048/ryanking"}, "is_accepted": false, "score": 2, "last_activity_date": 1567045484, "creation_date": 1567045484, "answer_id": 57702168, "question_id": 46807891, "link": "https://stackoverflow.com/questions/46807891/using-a-subquery-in-from-in-gorm/57702168#57702168", "title": "Using a subquery in &#39;FROM&#39; in gorm", "body": "<p>Author didn't use any \"JOIN\" in his SQL. </p>\n\n<p>I didn't find any ORM way, but <code>db.Raw</code> works.</p>\n\n<pre><code>subQuery := db.\n    Select(\"foo.*\").\n    Table(\"foo\").\n    Where(\"bar = ?\", \"baz\").\n    SubQuery()\n\ndb.Raw(\"SELECT * FROM ? as t1 WHERE t1.id=?\", subQuery, 1).Find(&amp;rows)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 10401687, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PNPzb.jpg?s=128&g=1", "display_name": "Lucas L&#246;ffel", "link": "https://stackoverflow.com/users/10401687/lucas-l%c3%b6ffel"}, "is_accepted": false, "score": 0, "last_activity_date": 1582053701, "creation_date": 1582053701, "answer_id": 60288048, "question_id": 46807891, "link": "https://stackoverflow.com/questions/46807891/using-a-subquery-in-from-in-gorm/60288048#60288048", "title": "Using a subquery in &#39;FROM&#39; in gorm", "body": "<p>Solved this issue by creating a package for more flexibility: <a href=\"https://github.com/loeffel-io/sql\" rel=\"nofollow noreferrer\">https://github.com/loeffel-io/sql</a></p>\n\n<pre><code>subquery := sql.Create().\n    Select(true, \"purchases.*\").\n    Select(true, \"...\").\n    From(true, \"purchases\").\n    Join(true, \"transactions ON transactions.purchase_id=purchases.id\")\n\nquery := sql.Create().Select(true, \"*\").\n    From(true, \"(?) purchases\", gorm.Expr(subquery.GetSQL(), subquery.GetValues()...)).\n    Join(true, \"transactions ON transactions.id=purchases.last_transaction_id\")\n\ndb.\n    Raw(query.GetSQL(), query.GetValues()...).\n    Offset(...).\n    Limit(...).\n    Order(...).\n    Unscoped().\n    Find(&amp;purchases).\n    Error\n</code></pre>\n"}], "owner": {"reputation": 5381, "user_id": 3958148, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/1d13082f7803e52dd98b2808509976c2?s=128&d=identicon&r=PG", "display_name": "Sung Cho", "link": "https://stackoverflow.com/users/3958148/sung-cho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10062, "favorite_count": 4, "accepted_answer_id": 46808332, "answer_count": 6, "score": 5, "last_activity_date": 1582053701, "creation_date": 1508322002, "last_edit_date": 1510554393, "question_id": 46807891, "link": "https://stackoverflow.com/questions/46807891/using-a-subquery-in-from-in-gorm", "title": "Using a subquery in &#39;FROM&#39; in gorm", "body": "<p>I would like to know how I can use a subquery in FROM clause using gorm. It would look like the following:</p>\n\n<pre><code>SELECT * FROM \n(\n  SELECT foo.*\n  FROM foo\n  WHERE bar = \"baz\"\n) AS t1\nWHERE t1.id = 1;\n</code></pre>\n\n<p>I have built the subquery using golang:</p>\n\n<pre><code>db.Model(Foo{}).Where(\"bar = ?\", \"baz\")\n</code></pre>\n\n<p>But how can I use this as a subquery in <code>FROM</code>?</p>\n\n<p>If there is a method that turns a gorm query into a SQL string, then I can simply plug that string into a raw SQL. But there does not seem to be such method. Any suggestions?</p>\n"}, {"tags": ["windows", "go", "godeps"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1508317274, "post_id": 46805758, "comment_id": 80559763, "body": "Whoever told you to set GOROOT is wrong: Don&#39;t. Are you sure you have gjson installed? If yes: Where? Are you sure <code>go run some&#47;deep&#47;path.go</code> is a good idea. You should provide <i>much</i> more information."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508331223, "post_id": 46805758, "comment_id": 80568411, "body": "If that is the extent of your PATH, you&#39;re going to have trouble finding anything other than the <code>go</code> tools. You also need <code>GOPATH&#47;bin</code>, and probably whatever else was in your PATH before."}], "owner": {"reputation": 49, "user_id": 5957816, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/7552337c29947cb84122f95803a48de6?s=128&d=identicon&r=PG&f=1", "display_name": "ss22ever", "link": "https://stackoverflow.com/users/5957816/ss22ever"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 142, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1508315072, "creation_date": 1508315072, "question_id": 46805758, "link": "https://stackoverflow.com/questions/46805758/cannot-find-vendor-package-in-windows", "title": "cannot find vendor package in windows", "body": "<p>I have my GOPATH and GOROOT set, currently trying to use a package located in the vendor folder, while doing go run in my windows I get </p>\n\n<pre><code>C:\\resume&gt;go run docs/generator.go\ndocs\\generator.go:13:2: cannot find package \"github.com/tidwall/gjson\" in any \nof:\n    C:\\Go\\src\\github.com\\tidwall\\gjson (from $GOROOT)\n    C:\\resume\\src\\github.com\\tidwall\\gjson (from $GOPATH)\n</code></pre>\n\n<p>My GOROOT=C:\\Go, GOPATH=C:\\resume and PATH=C:\\Go\\bin</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1508315275, "post_id": 46805579, "comment_id": 80558620, "body": "The latest form (using slice) should work. What was the error message returned by <a href=\"https://golang.org/pkg/net/smtp/#SendMail\" rel=\"nofollow noreferrer\"><code>smtp.SendMail</code></a>?"}, {"owner": {"reputation": 1342, "user_id": 3990158, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c657e26d1552cbe4705fd965d53d2e25?s=128&d=identicon&r=PG&f=1", "display_name": "PHA", "link": "https://stackoverflow.com/users/3990158/pha"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1508315845, "post_id": 46805579, "comment_id": 80558912, "body": "line 15: invalid operation: (&quot;From: &quot; + from + string(&quot;\\nTo: &quot;)) + to (mismatched types string and []string)  and for line 17: cannot use to (type []string) as type string in array or slice literal"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1508316373, "post_id": 46805579, "comment_id": 80559210, "body": "You can&#39;t concat <code>string</code> with <code>[]string</code> simply by <code>+</code> operator. Quick solution will be replacing <code>... + to</code> with <code>strings.Join(to, &quot;,&quot;)</code>. Don&#39;t forget to import <code>strings</code> package."}], "answers": [{"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 8, "last_activity_date": 1508317751, "last_edit_date": 1508317751, "creation_date": 1508316830, "answer_id": 46806253, "question_id": 46805579, "link": "https://stackoverflow.com/questions/46805579/send-smtp-email-to-multiple-receivers/46806253#46806253", "title": "send smtp email to multiple receivers", "body": "<p>From the <code>net/smtp</code> docs:</p>\n\n<blockquote>\n  <p>The msg parameter should be an RFC 822-style email with headers first,\n  a blank line, and then the message body. The lines of msg should be\n  CRLF terminated. The msg headers should usually include fields such as\n  \"From\", \"To\", \"Subject\", and \"Cc\".</p>\n</blockquote>\n\n<p><a href=\"http://www.faqs.org/rfcs/rfc2822.html\" rel=\"noreferrer\">RFC 822</a> requires <code>To:</code> header value to be a comma separated list. So while the <code>to</code> variable should remain a <code>[]string</code> and be passed to <code>smtp.SendMail</code> as its <code>to</code> parameter, the mail header (in the message) should have it as a comma separated list. Try below to see if it works:</p>\n\n<pre><code>func send(body string) {\n    // ...\n    to := []string{\"foo@mailinator.com\", \"bar@mailinator.com\"}\n    toHeader := strings.Join(to, \",\")\n\n    msg := \"From: \" + from + \"\\n\" +\n        \"To: \" + toHeader + \"\\n\" + // use toHeader\n        \"Subject: Hello there\\n\\n\" +\n        body\n\n    err := smtp.SendMail(\"smtp.gmail.com:587\",\n        smtp.PlainAuth(\"\", from, pass, \"smtp.gmail.com\"),\n        from, to, []byte(msg))\n\n    // ...\n}\n</code></pre>\n"}], "owner": {"reputation": 1342, "user_id": 3990158, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/c657e26d1552cbe4705fd965d53d2e25?s=128&d=identicon&r=PG&f=1", "display_name": "PHA", "link": "https://stackoverflow.com/users/3990158/pha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2596, "favorite_count": 1, "accepted_answer_id": 46806253, "answer_count": 1, "score": 6, "last_activity_date": 1508856063, "creation_date": 1508314425, "last_edit_date": 1508856063, "question_id": 46805579, "link": "https://stackoverflow.com/questions/46805579/send-smtp-email-to-multiple-receivers", "title": "send smtp email to multiple receivers", "body": "<p>I am using <a href=\"https://gist.githubusercontent.com/jpillora/cb46d183eca0710d909a/raw/19c524ccaa1f4003feb0a63bc77477486601eb43/smtp-gmail-send.go\" rel=\"nofollow noreferrer\">this</a> to send <code>smtp</code>. It works for one receiver but I'd like to have multiple receivers. I have tried the following:  </p>\n\n<pre><code>func sendemail(body string) {  \n    from := \"smtpemail\" \n    pass := \"pass\"\n    to := \"a@gmail.com,b@gmail.com\"\n    ....\n}\n</code></pre>\n\n<p>I have also tried: </p>\n\n<pre><code>to := \"\\\"a@gmail.com\\\",\\\"b@gmail.com\\\"\"\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>to := []string{\"a@gmail.com\",\"b@gmail.com\"}\n</code></pre>\n\n<p>None of them work. Sorry it is so simple, I just begin to work with <code>golang</code>.</p>\n"}, {"tags": ["python", "c", "go", "cgo"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1508315782, "post_id": 46805263, "comment_id": 80558885, "body": "In <code>myPyTest.c</code>, try to change the second arg of <code>PyArg_ParseTuple</code> from <code>&quot;S&quot;</code> to <code>&quot;sss&quot;</code>."}, {"owner": {"reputation": 53, "user_id": 7298459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25200941c14bd4d9d1191700787a6c77?s=128&d=identicon&r=PG&f=1", "display_name": "at S", "link": "https://stackoverflow.com/users/7298459/at-s"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1508325074, "post_id": 46805263, "comment_id": 80564538, "body": "@putu Yes it worked. Thanks."}], "owner": {"reputation": 53, "user_id": 7298459, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/25200941c14bd4d9d1191700787a6c77?s=128&d=identicon&r=PG&f=1", "display_name": "at S", "link": "https://stackoverflow.com/users/7298459/at-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 696, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1508313203, "creation_date": 1508313203, "question_id": 46805263, "link": "https://stackoverflow.com/questions/46805263/calling-golang-function-from-python-using-c", "title": "Calling golang function from python using C", "body": "<p>I have following code in my myPyTest.c file</p>\n\n<pre><code>#include&lt;python/Python.h&gt;\n#include \"libtest.h\"\n\nstatic PyObject * callThatFunc(PyObject *self, PyObject *args) {\n    const char *a, *b, *c;\n    if (!PyArg_ParseTuple(args, \"S\", &amp;a, &amp;b, &amp;c))\n        return NULL;\n    printf(\"%s\", returnThis(a));\n    return PyString_FromString(b);\n}\n\nstatic PyMethodDef BarMethods[] = {\n    {\"call_bar\",  callThatFunc, METH_VARARGS,\n        \"Execute a shell command.\"},\n   {NULL, NULL, 0, NULL}\n};\n\nPyMODINIT_FUNC\ninitbar(void)\n{\n    (void) Py_InitModule(\"bar\", BarMethods);\n}\n\nint main() {\n    printf(\"Hello\");\n    return 0;\n}\n</code></pre>\n\n<p>check <a href=\"https://docs.python.org/2/extending/extending.html\" rel=\"nofollow noreferrer\">this</a> for above code</p>\n\n<p>Now I have following golang code in my_go_call.go file.</p>\n\n<pre><code>package main\n\nimport \"C\"\n\n//export returnThis\nfunc returnThis(myString *C.char) *C.char {\n    var result *C.char\n    myStringGo := C.GoString(myString)\n   result = C.CString(\"Hello, \" + myStringGo)\n   return result\n}\n\nfunc main() {\n}\n</code></pre>\n\n<p>I have created shared library using command (MAC)\n    <code>go build -ldflags -s -buildmode=c-shared -o libtest.so my_go_call.go</code></p>\n\n<p>Then I have setup.py file to build c extension for python. Code of setup.py as follows</p>\n\n<pre><code>from distutils.core import setup, Extension\n\nmodule1 = Extension('bar',\n                libraries = ['test'],\n                library_dirs = ['/path/to/lib'],\n                sources = ['myPyTest.c'])\nsetup (name = 'PackageName',version = '1.0',description = 'This is a demo package',ext_modules = [module1])\n</code></pre>\n\n<p>Now i am building and installing my extension using following commands</p>\n\n<pre><code>python setup.py build\npython setup.py install\n</code></pre>\n\n<p>whenever I call my function in python interpreter i get following error.</p>\n\n<pre><code>&gt;&gt;&gt; import bar\n&gt;&gt;&gt; dir(bar)\n['__doc__', '__file__', '__name__', '__package__', 'call_bar']\n&gt;&gt;&gt; bar.call_bar('a','b','c')\nTraceback (most recent call last):\n  File \"&lt;stdin&gt;\", line 1, in &lt;module&gt;\nTypeError: function takes exactly 1 argument (3 given)\n</code></pre>\n"}, {"tags": ["python", "go", "md5"], "comments": [{"owner": {"reputation": 792, "user_id": 8106859, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/SF7s2.png?s=128&g=1", "display_name": "Polymer", "link": "https://stackoverflow.com/users/8106859/polymer"}, "edited": false, "score": 3, "creation_date": 1508309030, "post_id": 46804178, "comment_id": 80555169, "body": "See <a href=\"https://stackoverflow.com/questions/5297448/how-to-get-md5-sum-of-a-string\" title=\"how to get md5 sum of a string\">stackoverflow.com/questions/5297448/&hellip;</a>"}, {"owner": {"reputation": 11, "user_id": 3342796, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f07bb469816447506983a1f9d538b185?s=128&d=identicon&r=PG&f=1", "display_name": "user3342796", "link": "https://stackoverflow.com/users/3342796/user3342796"}, "reply_to_user": {"reputation": 792, "user_id": 8106859, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/SF7s2.png?s=128&g=1", "display_name": "Polymer", "link": "https://stackoverflow.com/users/8106859/polymer"}, "edited": false, "score": 0, "creation_date": 1508309272, "post_id": 46804178, "comment_id": 80555283, "body": "thx, I have seen that, it couldn&#39;t do md5.sum for data"}, {"owner": {"reputation": 49793, "user_id": 4014959, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GdqQJ.jpg?s=128&g=1", "display_name": "PM 2Ring", "link": "https://stackoverflow.com/users/4014959/pm-2ring"}, "edited": false, "score": 1, "creation_date": 1508309466, "post_id": 46804178, "comment_id": 80555388, "body": "Here&#39;s a one-liner: <code>from hashlib import md5;print(md5(b&#39;12345&#39;).hexdigest())</code>. Output: <code>827ccb0eea8a706c4c34a16891f84e7b</code>. If you do <code>echo -n &#39;12345&#39; | md5sum</code> in Bash you get the same output."}, {"owner": {"reputation": 11, "user_id": 3342796, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f07bb469816447506983a1f9d538b185?s=128&d=identicon&r=PG&f=1", "display_name": "user3342796", "link": "https://stackoverflow.com/users/3342796/user3342796"}, "edited": false, "score": 0, "creation_date": 1508309707, "post_id": 46804178, "comment_id": 80555509, "body": "thanks, please check my output part:  the output for Go is a list other than a string ,so simply call python API not work"}, {"owner": {"reputation": 49793, "user_id": 4014959, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GdqQJ.jpg?s=128&g=1", "display_name": "PM 2Ring", "link": "https://stackoverflow.com/users/4014959/pm-2ring"}, "edited": false, "score": 1, "creation_date": 1508310157, "post_id": 46804178, "comment_id": 80555743, "body": "MD5 outputs 16 bytes. Your Go code is outputting those 16 bytes as numbers in the range 0..255. And it&#39;s easy to get Python to create a list of numbers like that from the MD5 sum.  But I don&#39;t see why your Go code prints those numbers from &quot;12345&quot; . Can you show how the original <code>data</code> prints?"}, {"owner": {"reputation": 49793, "user_id": 4014959, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GdqQJ.jpg?s=128&g=1", "display_name": "PM 2Ring", "link": "https://stackoverflow.com/users/4014959/pm-2ring"}, "edited": false, "score": 0, "creation_date": 1508310800, "post_id": 46804178, "comment_id": 80556081, "body": "I just tested my code with <code>b&quot;These pretzels are making me thirsty.&quot;</code>, the same data as in the example in the Go docs you linked, and I get the same output as what&#39;s printed there, <code>b0804ec967f48520697662a204f5fe72</code>, or in numeric form <code>[176, 128, 78, 201, 103, 244, 133, 32, 105, 118, 98, 162, 4, 245, 254, 114]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 49793, "user_id": 4014959, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GdqQJ.jpg?s=128&g=1", "display_name": "PM 2Ring", "link": "https://stackoverflow.com/users/4014959/pm-2ring"}, "edited": false, "score": 1, "creation_date": 1508320661, "post_id": 46805519, "comment_id": 80561942, "body": "There&#39;s a <i>much</i> easier way to do that conversion! Just convert the <code>bytes</code> returned by <code>md5</code> into a list, like this: <code>list(md5(b&#39;12345&#39;).digest())</code>, or in Python 2 <code>list(bytearray(md5(b&#39;12345&#39;).digest()))</code>. FWIW, I didn&#39;t post a full answer because I&#39;m <i>still</i> waiting for the OP to clarify why they get <code>[32 44 185 98 172 89 7 91 150 75 7 21 45 35 75 112]</code> instead of the list that you got."}], "tags": [], "owner": {"reputation": 2158, "user_id": 5909655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jLXDi.png?s=128&g=1", "display_name": "Jayson Chacko", "link": "https://stackoverflow.com/users/5909655/jayson-chacko"}, "is_accepted": false, "score": 0, "last_activity_date": 1508314256, "creation_date": 1508314256, "answer_id": 46805519, "question_id": 46804178, "link": "https://stackoverflow.com/questions/46804178/how-to-calculate-md5-of-string-in-python-similar-as-crypto-md5-in-go/46805519#46805519", "title": "How to calculate md5 of string in Python similar as &quot;crypto/md5&quot; in Go", "body": "<p>Based on PM 2Ring's solution, here is a working program,</p>\n\n<pre><code>from hashlib import md5\n\nhexv = md5(b'12345').hexdigest()\nl = [str(int(i+j,16)) for i, j in zip(hexv[::2], hexv[1::2])]\nprint(\"sum [\" + \", \".join(l)+\"]\")\n</code></pre>\n\n<p>This prints,</p>\n\n<pre><code>sum [130, 124, 203, 14, 234, 138, 112, 108, 76, 52, 161, 104, 145, 248, 78, 123]\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 3342796, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f07bb469816447506983a1f9d538b185?s=128&d=identicon&r=PG&f=1", "display_name": "user3342796", "link": "https://stackoverflow.com/users/3342796/user3342796"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 445, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1508314256, "creation_date": 1508308887, "last_edit_date": 1508310284, "question_id": 46804178, "link": "https://stackoverflow.com/questions/46804178/how-to-calculate-md5-of-string-in-python-similar-as-crypto-md5-in-go", "title": "How to calculate md5 of string in Python similar as &quot;crypto/md5&quot; in Go", "body": "<p>I know there is <a href=\"https://docs.python.org/2/library/hashlib.html\" rel=\"nofollow noreferrer\">hashlib</a> in Python, but I want to achieve the same result as in Go below:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/md5\"\n    \"fmt\"\n)\n\nfunc main() {\n    data := []byte(\"12345\")\n    fmt.Println(\"sum \", md5.Sum(data))\n}\n</code></pre>\n\n<p>As <a href=\"https://golang.org/pkg/crypto/md5/\" rel=\"nofollow noreferrer\">func md5.Sum</a> described, it calculates \"MD5 checksum of the data\". \nHowever, I don't find any similar function in Python.</p>\n\n<p>Is there any way to achieve <code>md5.Sum</code> in Python as in Go?</p>\n\n<p>The output of program above is <strong>a slice other than a string</strong>:</p>\n\n<pre><code>sum  [32 44 185 98 172 89 7 91 150 75 7 21 45 35 75 112]\n</code></pre>\n"}, {"tags": ["go", "godeps"], "comments": [{"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 3, "creation_date": 1508299169, "post_id": 46802512, "comment_id": 80551862, "body": "Your <code>GOPATH</code> should not include the <code>src</code> directory as part of the path, <code>src</code> should be inside the directory <code>GOPATH</code> describes."}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 2, "last_activity_date": 1508299866, "creation_date": 1508299866, "answer_id": 46802678, "question_id": 46802512, "link": "https://stackoverflow.com/questions/46802512/golang-dependency-management-on-windows-does-not-work-gopath-error/46802678#46802678", "title": "Golang dependency management on windows does not work (GOPATH error)", "body": "<p>Try to set</p>\n\n<pre><code>GOPATH=D:\\Work\\Golang\n</code></pre>\n\n<p>Then create folders like  <code>src\\github.com\\user\\repo</code> and keep you in them. </p>\n"}], "owner": {"reputation": 1643, "user_id": 186861, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/db6e4a7197a43740fa9d2ac248baee67?s=128&d=identicon&r=PG", "display_name": "SeeSharp", "link": "https://stackoverflow.com/users/186861/seesharp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 764, "favorite_count": 0, "accepted_answer_id": 46802678, "answer_count": 1, "score": 0, "last_activity_date": 1508318174, "creation_date": 1508298710, "last_edit_date": 1508318174, "question_id": 46802512, "link": "https://stackoverflow.com/questions/46802512/golang-dependency-management-on-windows-does-not-work-gopath-error", "title": "Golang dependency management on windows does not work (GOPATH error)", "body": "<p>I try to use to different dependency management tools: <a href=\"https://github.com/tools/godep\" rel=\"nofollow noreferrer\">godep</a> and <a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\">dep</a>.\nAnd both fail with similar error. How should i set enviroument and where should I put sources?</p>\n\n<p><strong>dep</strong></p>\n\n<pre><code>PS D:\\Work\\Golang\\src\\ChrBack&gt; dep init\nroot project import: D:\\Work\\Golang\\src\\ChrBack is not within any GOPATH/src\n</code></pre>\n\n<p><strong>godep</strong></p>\n\n<pre><code>PS D:\\Work\\Golang\\src\\ChrBack&gt; godep save\ngodep: [WARNING]: godep should only be used inside a valid go package directory and\ngodep: [WARNING]: may not function correctly. You are probably outside of your $GOPATH.\ngodep: [WARNING]:       Current Directory: D:\\Work\\Golang\\src\\ChrBack\ngodep: [WARNING]:       $GOPATH: D:\\Work\\Golang\\src\ngodep: Unable to find SrcRoot for package .\n</code></pre>\n\n<p><strong>Go env</strong></p>\n\n<pre><code>$ D:\\Work\\Golang\\Go\\bin\\go.exe version\ngo version go1.9.1 windows/amd64\n\n$ D:\\Work\\Golang\\Go\\bin\\go.exe env\nset GOARCH=amd64\nset GOBIN=D:\\Work\\Golang\\src\\bin\nset GOEXE=.exe\nset GOHOSTARCH=amd64\nset GOHOSTOS=windows\nset GOOS=windows\nset GOPATH=D:\\Work\\Golang\\src\nset GORACE=\nset GOROOT=D:\\Work\\Golang\\Go\nset GOTOOLDIR=D:\\Work\\Golang\\Go\\pkg\\tool\\windows_amd64\nset GCCGO=gccgo\nset CC=gcc\nset GOGCCFLAGS=-m64 -mthreads -fmessage-length=0\nset CXX=g++\nset CGO_ENABLED=1\nset CGO_CFLAGS=-g -O2\nset CGO_CPPFLAGS=\nset CGO_CXXFLAGS=-g -O2\nset CGO_FFLAGS=-g -O2\nset CGO_LDFLAGS=-g -O2\nset PKG_CONFIG=pkg-config\n</code></pre>\n"}, {"tags": ["function", "go", "slice"], "comments": [{"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 5, "creation_date": 1508298796, "post_id": 46802489, "comment_id": 80551759, "body": "A slice is <b>not</b> a reference type, not really."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 1, "creation_date": 1508298964, "post_id": 46802489, "comment_id": 80551815, "body": "Also, possible duplicate of: <a href=\"https://stackoverflow.com/questions/20195296/golang-append-an-item-to-a-slice\">Golang append an item to a slice</a>."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1508301729, "post_id": 46802489, "comment_id": 80552492, "body": "A slice is not a reference type, though <a href=\"https://play.golang.org/p/8CBxmyBJjl\" rel=\"nofollow noreferrer\">it does use a pointer (or something functionally equivalent) to avoid wasting memory</a>. This means that the memory is shared between the two slices, but the lengths and even the caps may differ. They&#39;re essentially two different items. You can read more about slices in the Go blog entry &quot;Go Slices: usage and internals&quot;, particularly <a href=\"https://blog.golang.org/go-slices-usage-and-internals#TOC_4.\" rel=\"nofollow noreferrer\">this section</a>."}], "answers": [{"tags": [], "owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "is_accepted": false, "score": 5, "last_activity_date": 1508299896, "creation_date": 1508299896, "answer_id": 46802681, "question_id": 46802489, "link": "https://stackoverflow.com/questions/46802489/why-it-is-unable-to-modify-a-slices-length-or-capacity-through-a-function-call/46802681#46802681", "title": "why it is unable to modify a slice&#39;s length or capacity through a function call?", "body": "<p>Slice holds three values: </p>\n\n<p>1) pointer to underlying array</p>\n\n<p>2) length</p>\n\n<p>3) capacity</p>\n\n<p>When you pass slice to a function, you are passing a copy of all three of those values. Therefore, you cannot change length and capacity, but since you have the pointer to the underlying array you can change values inside the array.</p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 2, "last_activity_date": 1508300175, "creation_date": 1508300175, "answer_id": 46802721, "question_id": 46802489, "link": "https://stackoverflow.com/questions/46802489/why-it-is-unable-to-modify-a-slices-length-or-capacity-through-a-function-call/46802721#46802721", "title": "why it is unable to modify a slice&#39;s length or capacity through a function call?", "body": "<p>Slice is not a pointer type. Under the hood slice consists of 3 values: length, capacity and pointer to the array. When you pass it by value, you get copies of length and capacity - you can change them for you. Changes to array will be visible outside of the function. </p>\n\n<p>And if produces such results   </p>\n"}], "owner": {"reputation": 11, "user_id": 8793082, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0bab74903b73e48b10ccb1ba48813bae?s=128&d=identicon&r=PG&f=1", "display_name": "pirlo.san", "link": "https://stackoverflow.com/users/8793082/pirlo-san"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1508300175, "creation_date": 1508298541, "question_id": 46802489, "link": "https://stackoverflow.com/questions/46802489/why-it-is-unable-to-modify-a-slices-length-or-capacity-through-a-function-call", "title": "why it is unable to modify a slice&#39;s length or capacity through a function call?", "body": "<p>My purpose is to remove one element from specific slice, and the code is something like:</p>\n\n<pre><code>func main() {\n    s := []int{0, 1, 2, 3, 4}\n    remove(s, 3)\n    fmt.Println(s, len(s), cap(s))\n}\n\nfunc remove(s []int, idx int) {\n    if idx &lt; 0 || idx &gt;= len(s) {\n        return\n    }\n    copy(s[idx:], s[idx+1:])\n    s = s[:len(s)-1]\n    fmt.Println(s, len(s), cap(s))\n}\n</code></pre>\n\n<p>but the output showed:</p>\n\n<p><code>[0 1 2 4] 4 5\n[0 1 2 4 4] 5 5</code></p>\n\n<p>As I know, slice will be passed to a function call as reference type, why it is not able to modify it?</p>\n"}, {"tags": ["go", "lua", "swig"], "comments": [{"owner": {"reputation": 81653, "user_id": 168175, "user_type": "moderator", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qxeUf.jpg?s=128&g=1", "display_name": "Flexo", "link": "https://stackoverflow.com/users/168175/flexo"}, "edited": false, "score": 0, "creation_date": 1508397047, "post_id": 46800324, "comment_id": 80596216, "body": "Whilst that is technically possible it&#39;s probably quite a substantial undertaking to make it actually work. I suspect you&#39;d be better off revisiting some design assumptions insteda."}, {"owner": {"reputation": 656, "user_id": 1709144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd602829efb2e4eb1b5d4d6fd40db5e4?s=128&d=identicon&r=PG", "display_name": "jpfx1342", "link": "https://stackoverflow.com/users/1709144/jpfx1342"}, "reply_to_user": {"reputation": 81653, "user_id": 168175, "user_type": "moderator", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qxeUf.jpg?s=128&g=1", "display_name": "Flexo", "link": "https://stackoverflow.com/users/168175/flexo"}, "edited": false, "score": 0, "creation_date": 1508401945, "post_id": 46800324, "comment_id": 80598906, "body": "My plan is to do most of the Core and UI work in Go, and use Lua to make the whole program more modifiable. I should be able to do without the wxWidgets Lua bindings, but it will make end user modifications more difficult. For now, I&#39;m just moving on without the wxWidgets Lua bindings for the sake of the project, but if an easy solution comes up, I&#39;d love to add them later."}, {"owner": {"reputation": 81653, "user_id": 168175, "user_type": "moderator", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qxeUf.jpg?s=128&g=1", "display_name": "Flexo", "link": "https://stackoverflow.com/users/168175/flexo"}, "edited": false, "score": 0, "creation_date": 1508428039, "post_id": 46800324, "comment_id": 80615355, "body": "I didn&#39;t say it&#39;s hard. It&#39;s easy enough, just a substantial amount of effort to actually do it, because for each and every type that matters in wxWidgets you&#39;ll have to write some combination of SWIG, Go, C++ and Lua to glue it across the boundary. ."}], "owner": {"reputation": 656, "user_id": 1709144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd602829efb2e4eb1b5d4d6fd40db5e4?s=128&d=identicon&r=PG", "display_name": "jpfx1342", "link": "https://stackoverflow.com/users/1709144/jpfx1342"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1508280323, "creation_date": 1508280323, "question_id": 46800324, "link": "https://stackoverflow.com/questions/46800324/binding-library-to-go-and-lua-with-swig", "title": "Binding library to Go and Lua with SWIG?", "body": "<p>I've recently started a project using Go, and have pulled some libraries in. I'm using <a href=\"https://github.com/dontpanic92/wxGo\" rel=\"nofollow noreferrer\" title=\"wxGo\">wxGo</a> to bind wxWidgets to Go, and <a href=\"https://github.com/yuin/gopher-lua\" rel=\"nofollow noreferrer\" title=\"GopherLua\">GopherLua</a> to bind Lua to Go. This is all working well, and was pretty easy to set up. (Go is pretty cool like that.)</p>\n\n<p>However, I've come to point where I'd like bind wxWidgets to Lua as well, but I'm new to SWIG, and I'm not sure what the best way to approach this is. I have some ideas involving generating the wxWidgets C++ wrapper library for Lua, then somehow loading that into Go, but I'm not that will even work.</p>\n\n<p>How can I bind wxWidgets to both Go and Lua in my program?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 4, "creation_date": 1508269837, "post_id": 46798068, "comment_id": 80542975, "body": "Implement an additional function that would filter out the elements you don&#39;t want to be there. Effectively it would be a loop that iterates over string and checks their length is greater than 0. Due to lack of generics - Go cannot have a library function that does exactly that for you, so have fun re-implementing it over and over again :-)"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1508270229, "post_id": 46798068, "comment_id": 80543235, "body": "Actually, if you need to do this a lot with different slice types take a look at how the <code>sort</code> package works, no generics needed. However, for just string slices writing a generic solution is way overkill."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1508270334, "post_id": 46798068, "comment_id": 80543298, "body": "@MiloChristiansen <code>func Sort(data Interface)</code> --- that&#39;s how it works, using interfaces. So you must implement the interface for every data type, over and over again."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1508270417, "post_id": 46798068, "comment_id": 80543345, "body": "Exactly. <code>sort.Slice</code> is closer to this problem though, and IIRC it uses reflection."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1508270456, "post_id": 46798068, "comment_id": 80543365, "body": "&quot;IIRC it uses reflection&quot; --- yikes :-D"}], "answers": [{"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1508270430, "post_id": 46798238, "comment_id": 80543354, "body": "One may also pre-allocate the <code>r</code> since you know the max potential size from the <code>s</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1508270807, "post_id": 46798238, "comment_id": 80543536, "body": "If you pre-allocate it to the length of <code>s</code>, you will over-allocate in cases where there are empty fields to skip."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1508271043, "post_id": 46798238, "comment_id": 80543653, "body": "@Adrian one must assess whether few N-M ~bytes~ runes &quot;lost&quot; is better than extra M allocations."}, {"owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "edited": false, "score": 0, "creation_date": 1508271252, "post_id": 46798238, "comment_id": 80543766, "body": "I&#39;m concerned about the efficiency of this as I would be calling the code a lot. Thank you for your response."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "edited": false, "score": 2, "creation_date": 1508271329, "post_id": 46798238, "comment_id": 80543797, "body": "@Niko when concerned - measure."}, {"owner": {"reputation": 204677, "user_id": 75525, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/IYU63.png?s=128&g=1", "display_name": "Fenton", "link": "https://stackoverflow.com/users/75525/fenton"}, "edited": false, "score": 2, "creation_date": 1508271503, "post_id": 46798238, "comment_id": 80543884, "body": "I&#39;m not claiming to have the most graceful answer. Choose the one that you believe is <i>most readable</i>. If you find there is a performance problem with whichever code is most readable, it will be easier to optimise. &quot;We should forget about small efficiencies, say about 97% of the time: premature optimization is the root of all evil. Yet we should not pass up our opportunities in that critical 3%.&quot; - Knuth"}, {"owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "edited": false, "score": 1, "creation_date": 1508345731, "post_id": 46798238, "comment_id": 80578124, "body": "@Fenton Interesting. Turns out that using your algorithm was about 30% more performant than the <code>strings.SplitFunc</code>."}], "tags": [], "owner": {"reputation": 204677, "user_id": 75525, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/IYU63.png?s=128&g=1", "display_name": "Fenton", "link": "https://stackoverflow.com/users/75525/fenton"}, "is_accepted": false, "score": 2, "last_activity_date": 1508270317, "creation_date": 1508270317, "answer_id": 46798238, "question_id": 46798068, "link": "https://stackoverflow.com/questions/46798068/can-strings-split-ignore-empty-tokens/46798238#46798238", "title": "Can `strings.split` ignore empty tokens?", "body": "<p>You can filter out empty elements from an array, so you could do this as a second step.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc delete_empty (s []string) []string {\n    var r []string\n    for _, str := range s {\n        if str != \"\" {\n            r = append(r, str)\n        }\n    }\n    return r\n}\n\nfunc main() {\n    var arr = strings.Split(\"a,,b,c\", \",\");\n    fmt.Printf(\"%q\\n\", delete_empty(arr));\n}\n</code></pre>\n\n<p>Updated <a href=\"https://play.golang.org/p/E3zMXK9wNY\" rel=\"nofollow noreferrer\">Golang Playground</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 647, "user_id": 857156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66412a85a83783c2061838e1b44a9bbb?s=128&d=identicon&r=PG", "display_name": "Dave Gray", "link": "https://stackoverflow.com/users/857156/dave-gray"}, "is_accepted": false, "score": 2, "last_activity_date": 1508270532, "creation_date": 1508270532, "answer_id": 46798281, "question_id": 46798068, "link": "https://stackoverflow.com/questions/46798068/can-strings-split-ignore-empty-tokens/46798281#46798281", "title": "Can `strings.split` ignore empty tokens?", "body": "<p>If using <code>regexp</code> is acceptable, you could split on 1+ separators:</p>\n\n<pre><code>package main\nimport (\n  \"fmt\"\n  \"regexp\"\n)\n\nfunc main() {\n  fmt.Printf(\"%q\\n\", regexp.MustCompile(\",+\").Split(\"a,,b,c\", -1))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/fs04oJkQ_6\" rel=\"nofollow noreferrer\">Playground link</a></p>\n"}, {"comments": [{"owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "edited": false, "score": 1, "creation_date": 1508271744, "post_id": 46798310, "comment_id": 80544008, "body": "Thanks @T.Claverie, I feel like this is definitely the idiomatic go way to do this."}, {"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "reply_to_user": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "edited": false, "score": 2, "creation_date": 1508271853, "post_id": 46798310, "comment_id": 80544068, "body": "Honestly, it would be easier to find this function if it was named <code>strings.SplitFunc</code>. Glad it helped you :)"}, {"owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "edited": false, "score": 1, "creation_date": 1508345634, "post_id": 46798310, "comment_id": 80578070, "body": "Interesting. Turns out that using <code>strings.Split</code> and then iterating over the array and deleting empty tokens is about 30% more performant."}, {"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "reply_to_user": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "edited": false, "score": 0, "creation_date": 1508345786, "post_id": 46798310, "comment_id": 80578152, "body": "@Niko Interesting, I didn&#39;t know as I never benchmarked it. Thanks for the update !"}, {"owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "edited": false, "score": 0, "creation_date": 1508347814, "post_id": 46798310, "comment_id": 80579113, "body": "I reviewed the source for both <code>strings.Split</code> and <code>strings.FieldsFunc</code> and found that <code>FieldsFunc</code> was doing an extra iteration and so I tested both. <code>FieldsFunc</code>&#39;s advantage remains though in that a more complex function can be used for splitting."}], "tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 33, "last_activity_date": 1508276485, "last_edit_date": 1508276485, "creation_date": 1508270647, "answer_id": 46798310, "question_id": 46798068, "link": "https://stackoverflow.com/questions/46798068/can-strings-split-ignore-empty-tokens/46798310#46798310", "title": "Can `strings.split` ignore empty tokens?", "body": "<p>Short answer: <code>strings.Split</code> can't do that.</p>\n\n<p>However, there are more functions to split strings in Go. Notably, you can do what you want with <a href=\"https://godoc.org/strings#FieldsFunc\" rel=\"noreferrer\"><code>strings.FieldsFunc</code></a>. The example here:</p>\n\n<pre><code>splitFn := func(c rune) bool {\n        return c == ','\n}\nfmt.Printf(\"Fields are: %q\\n\", strings.FieldsFunc(\"a,,b,c\", splitFn))\n</code></pre>\n\n<p>In the playground: <a href=\"https://play.golang.org/p/Lp1LsoIxAK\" rel=\"noreferrer\">https://play.golang.org/p/Lp1LsoIxAK</a></p>\n"}], "owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7533, "favorite_count": 5, "accepted_answer_id": 46798310, "answer_count": 3, "score": 16, "last_activity_date": 1537480830, "creation_date": 1508269693, "last_edit_date": 1537480830, "question_id": 46798068, "link": "https://stackoverflow.com/questions/46798068/can-strings-split-ignore-empty-tokens", "title": "Can `strings.split` ignore empty tokens?", "body": "<p>Can you please demonstrate an efficient way to use <code>strings.split</code> such that empty tokens are not included in the returned slice?</p>\n\n<p>Specifically, the following code returns <code>[\"a\" \"\" \"b\" \"c\"]</code> where I want to have it return <code>[\"a\" \"b\" \"c\"]</code>:</p>\n\n<pre><code>fmt.Printf(\"%q\\n\", strings.Split(\"a,,b,c\", \",\"))\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/keaSjjSxgn\" rel=\"noreferrer\">https://play.golang.org/p/keaSjjSxgn</a></p>\n"}, {"tags": ["arrays", "go", "struct", "slice"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1508269165, "post_id": 46797776, "comment_id": 80542604, "body": "Please try the &quot;Tour of Go&quot;, for example: <a href=\"https://tour.golang.org/methods/4\" rel=\"nofollow noreferrer\">tour.golang.org/methods/4</a>"}, {"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 2, "creation_date": 1508270076, "post_id": 46797776, "comment_id": 80543156, "body": "Also, note that the same problem will arise with conf.Groups: if you want to mutate them, it should be <code>[]*Group</code> instead of <code>[]Group</code> (Playground to demonstrate the problem: <a href=\"https://play.golang.org/p/mTniuVKJwy\" rel=\"nofollow noreferrer\">play.golang.org/p/mTniuVKJwy</a> )"}, {"owner": {"reputation": 545, "user_id": 576138, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9fd87ec778a973d194c0fabd92c67830?s=128&d=identicon&r=PG", "display_name": "okelet", "link": "https://stackoverflow.com/users/576138/okelet"}, "edited": false, "score": 0, "creation_date": 1508270282, "post_id": 46797776, "comment_id": 80543264, "body": "From now on I think I will always use pointers..."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1508270688, "post_id": 46797776, "comment_id": 80543475, "body": "Always using pointers isn&#39;t a good solution. You should use pointers when pointers are appropriate. Always using pointers increases pressure on the garbage collector."}, {"owner": {"reputation": 545, "user_id": 576138, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9fd87ec778a973d194c0fabd92c67830?s=128&d=identicon&r=PG", "display_name": "okelet", "link": "https://stackoverflow.com/users/576138/okelet"}, "edited": false, "score": 0, "creation_date": 1508271387, "post_id": 46797776, "comment_id": 80543819, "body": "So, passing a copy of the object instead of by reference is better? Shouldn&#39;t a copy of the object take more memory space than the reference? Or is it better anyway than make the garbage collector work?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508272526, "post_id": 46797776, "comment_id": 80544405, "body": "@okelet: function argument values are on the stack, so size isn&#39;t really a concern. Pointers aren&#39;t a <i>horrible</i> default, but you don&#39;t always need them. Maybe read <a href=\"https://stackoverflow.com/questions/23542989/pointers-vs-values-in-parameters-and-return-values\" title=\"pointers vs values in parameters and return values\">stackoverflow.com/questions/23542989/&hellip;</a>"}, {"owner": {"reputation": 545, "user_id": 576138, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9fd87ec778a973d194c0fabd92c67830?s=128&d=identicon&r=PG", "display_name": "okelet", "link": "https://stackoverflow.com/users/576138/okelet"}, "edited": false, "score": 0, "creation_date": 1508275697, "post_id": 46797776, "comment_id": 80545912, "body": "Great post, thanks all for your help"}], "answers": [{"comments": [{"owner": {"reputation": 545, "user_id": 576138, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9fd87ec778a973d194c0fabd92c67830?s=128&d=identicon&r=PG", "display_name": "okelet", "link": "https://stackoverflow.com/users/576138/okelet"}, "edited": false, "score": 0, "creation_date": 1508269403, "post_id": 46797885, "comment_id": 80542726, "body": "Thanks, things are different from Java. So, to avoid problems (and work like Java), all struct functions should be pointers and the caller object?"}, {"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "reply_to_user": {"reputation": 545, "user_id": 576138, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9fd87ec778a973d194c0fabd92c67830?s=128&d=identicon&r=PG", "display_name": "okelet", "link": "https://stackoverflow.com/users/576138/okelet"}, "edited": false, "score": 1, "creation_date": 1508269638, "post_id": 46797885, "comment_id": 80542866, "body": "Yup @okelet. All (almost) methods should take pointers to structs. There is no syntax difference when using a plain struct or a pointer, so you won&#39;t feel it."}], "tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 4, "last_activity_date": 1508268915, "creation_date": 1508268915, "answer_id": 46797885, "question_id": 46797776, "link": "https://stackoverflow.com/questions/46797776/golang-array-is-empty-after-call-a-method-that-adds-items-to-the-array/46797885#46797885", "title": "Golang: array is empty after call a method that adds items to the array", "body": "<p>You are modifying a copy of the Configuration, not the Configuration itself.</p>\n\n<p>The method <code>LoadGroups</code> should take a pointer to a Configuration instead:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Group struct {\n    Name string\n}\n\ntype Configuration struct {\n    Groups []Group\n}\n\nfunc NewConfiguration() (error, *Configuration) {\n    conf := &amp;Configuration{}\n    conf.LoadGroups()\n    fmt.Print(\"Final number of groups: \", len(conf.Groups))\n    return nil, conf\n}\n\nfunc (conf *Configuration) LoadGroups() {\n    for i := 0; i &lt; 5; i++ {\n        conf.Groups = append(conf.Groups, Group{Name: \"Group \" + string(i)})\n        fmt.Println(\"Current number of groups: \", len(conf.Groups))\n    }\n}\n\nfunc main() {\n    NewConfiguration()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 354, "user_id": 5537785, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qk26D.png?s=128&g=1", "display_name": "lamg", "link": "https://stackoverflow.com/users/5537785/lamg"}, "is_accepted": false, "score": 1, "last_activity_date": 1508269246, "creation_date": 1508269246, "answer_id": 46797949, "question_id": 46797776, "link": "https://stackoverflow.com/questions/46797776/golang-array-is-empty-after-call-a-method-that-adds-items-to-the-array/46797949#46797949", "title": "Golang: array is empty after call a method that adds items to the array", "body": "<p>The <code>LoadGroups</code> method must be a receiver of <code>*Configuration</code>, instead of <code>Configuration</code>. Right now the method <code>LoadGroup</code> is being executed on a fresh copy of <code>Configuration</code> each time is called, therefore its changes are not reflected in the original caller. By making it of type <code>*Configuration</code>, all calls to the method <code>LoadGroups</code> sharing the same pointer change the same <code>Configuration</code> instance.</p>\n"}], "owner": {"reputation": 545, "user_id": 576138, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/9fd87ec778a973d194c0fabd92c67830?s=128&d=identicon&r=PG", "display_name": "okelet", "link": "https://stackoverflow.com/users/576138/okelet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "closed_date": 1508270935, "accepted_answer_id": 46797885, "answer_count": 2, "score": -2, "last_activity_date": 1508272011, "creation_date": 1508268473, "question_id": 46797776, "link": "https://stackoverflow.com/questions/46797776/golang-array-is-empty-after-call-a-method-that-adds-items-to-the-array", "closed_reason": "Duplicate", "title": "Golang: array is empty after call a method that adds items to the array", "body": "<p>I am new to Golang. I have this simple code, that I can't get to work; the problem is that after call the method <code>LoadGroups</code>, the \"main\" function doesn't see the changes:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Group struct {\n    Name string\n}\n\ntype Configuration struct {\n    Groups []Group\n}\n\nfunc NewConfiguration() (error, *Configuration) {\n    conf := Configuration{}\n    conf.LoadGroups()\n    fmt.Print(\"Final number of groups: \", len(conf.Groups))\n    return nil, &amp;conf\n}\n\nfunc (conf Configuration) LoadGroups() {\n    for i := 0; i &lt; 5; i++ {\n        conf.Groups = append(conf.Groups, Group{Name: \"Group \" + string(i)})\n        fmt.Println(\"Current number of groups: \", len(conf.Groups))\n    }\n}\n\nfunc main() {\n    NewConfiguration()\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/VyneKpjdA-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VyneKpjdA-</a></p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3", "aws-sdk-go"], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508264809, "post_id": 46796374, "comment_id": 80540331, "body": "Have you filed an issue for a panic in the sdk? Have you tried the current api with <code>ListObjectsV2</code>?"}, {"owner": {"reputation": 111, "user_id": 8658245, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209079498923576/picture?type=large", "display_name": "SKRelan", "link": "https://stackoverflow.com/users/8658245/skrelan"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508265383, "post_id": 46796374, "comment_id": 80540669, "body": "No, I have not filed an issue for the panic as of yet. I plan on doing it this weekend. Yes, this issue arises using the current API."}], "tags": [], "owner": {"reputation": 111, "user_id": 8658245, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209079498923576/picture?type=large", "display_name": "SKRelan", "link": "https://stackoverflow.com/users/8658245/skrelan"}, "is_accepted": true, "score": 3, "last_activity_date": 1508355260, "last_edit_date": 1508355260, "creation_date": 1508263216, "answer_id": 46796374, "question_id": 46795963, "link": "https://stackoverflow.com/questions/46795963/how-to-empty-a-s3-bucket-using-the-aws-sdk-for-golang/46796374#46796374", "title": "How to empty a S3 bucket using the AWS SDK for GOlang?", "body": "<p><strong><em>NOTE:</strong> These are code snippets that might require YOU to make changes on YOUR SIDE to make it run.</em></p>\n\n<p>You will need to implement the below method:</p>\n\n<pre><code>  //EmptyBucket empties the Amazon S3 bucket\n    func (s awsS3) EmptyBucket(bucket string) error {\n        log.Info(\"removing objects from S3 bucket : \", bucket)\n        params := &amp;s3.ListObjectsInput{\n            Bucket: aws.String(bucket),\n        }\n        for {\n            //Requesting for batch of objects from s3 bucket\n            objects, err := s.Client.ListObjects(params)\n            if err != nil {\n                return err\n            }\n            //Checks if the bucket is already empty\n            if len((*objects).Contents) == 0 {\n                log.Info(\"Bucket is already empty\")\n                return nil\n             }\n            log.Info(\"First object in batch | \", *(objects.Contents[0].Key))\n\n            //creating an array of pointers of ObjectIdentifier\n            objectsToDelete := make([]*s3.ObjectIdentifier, 0, 1000)\n            for _, object := range (*objects).Contents {\n                obj := s3.ObjectIdentifier{\n                    Key: object.Key,\n                }\n                objectsToDelete = append(objectsToDelete, &amp;obj)\n            }\n            //Creating JSON payload for bulk delete\n            deleteArray := s3.Delete{Objects: objectsToDelete}\n            deleteParams := &amp;s3.DeleteObjectsInput{\n                Bucket: aws.String(bucket),\n                Delete: &amp;deleteArray,\n            }\n            //Running the Bulk delete job (limit 1000)\n            _, err = s.Client.DeleteObjects(deleteParams)\n            if err != nil {\n                return err\n            }\n            if *(*objects).IsTruncated { //if there are more objects in the bucket, IsTruncated = true\n                params.Marker = (*deleteParams).Delete.Objects[len((*deleteParams).Delete.Objects)-1].Key\n                log.Info(\"Requesting next batch | \", *(params.Marker))\n            } else { //if all objects in the bucket have been cleaned up.\n                break\n            }\n        }\n        log.Info(\"Emptied S3 bucket : \", bucket)\n        return nil\n    } \n</code></pre>\n\n<p>UPDATE : The latest version of AWS SDK for GO has resolved the prior issue I had.</p>\n"}, {"tags": [], "owner": {"reputation": 318, "user_id": 1579459, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/pnV0I.jpg?s=128&g=1", "display_name": "Xibz", "link": "https://stackoverflow.com/users/1579459/xibz"}, "is_accepted": false, "score": 0, "last_activity_date": 1509072259, "creation_date": 1509072259, "answer_id": 46966723, "question_id": 46795963, "link": "https://stackoverflow.com/questions/46795963/how-to-empty-a-s3-bucket-using-the-aws-sdk-for-golang/46966723#46966723", "title": "How to empty a S3 bucket using the AWS SDK for GOlang?", "body": "<p>The AWS SDK for Go has a Amazon S3 batching abstraction. Take a look <a href=\"https://github.com/aws/aws-sdk-go/blob/master/service/s3/s3manager/batch.go#L103\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 81, "user_id": 6082795, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--MhlhZaMhl4/AAAAAAAAAAI/AAAAAAAAADE/yDDV_aMNNe4/photo.jpg?sz=128", "display_name": "Doug Schwartz", "link": "https://stackoverflow.com/users/6082795/doug-schwartz"}, "is_accepted": false, "score": 1, "last_activity_date": 1512149480, "creation_date": 1512149480, "answer_id": 47598558, "question_id": 46795963, "link": "https://stackoverflow.com/questions/46795963/how-to-empty-a-s3-bucket-using-the-aws-sdk-for-golang/47598558#47598558", "title": "How to empty a S3 bucket using the AWS SDK for GOlang?", "body": "<p>Don't forget that by default ListObjects only returns up to 1000 bucket items. If you might have more than 1000, check the IsTruncated property on the return value. If true, use the NextMarker property from the return value to get the next 1000 items.</p>\n\n<p>See my example in the Go dev guide: <a href=\"http://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/s3-example-basic-bucket-operations.html#s3-examples-bucket-ops-delete-all-bucket-items\" rel=\"nofollow noreferrer\">http://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/s3-example-basic-bucket-operations.html#s3-examples-bucket-ops-delete-all-bucket-items</a></p>\n"}, {"comments": [{"owner": {"reputation": 500, "user_id": 7101880, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209175470396691/picture?type=large", "display_name": "Adrien Parrochia", "link": "https://stackoverflow.com/users/7101880/adrien-parrochia"}, "edited": false, "score": 0, "creation_date": 1605695921, "post_id": 55682144, "comment_id": 114728258, "body": "Hello, do you know how to delete files in a specific folder only ?"}, {"owner": {"reputation": 500, "user_id": 7101880, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209175470396691/picture?type=large", "display_name": "Adrien Parrochia", "link": "https://stackoverflow.com/users/7101880/adrien-parrochia"}, "edited": false, "score": 1, "creation_date": 1605696028, "post_id": 55682144, "comment_id": 114728310, "body": "it&#39;s all good, i found :       iter := s3manager.NewDeleteListIterator(svc, &amp;s3.ListObjectsInput{         Bucket: aws.String(bucket),         Prefix: aws.String(&quot;root/subfolder&quot;)     })"}], "tags": [], "owner": {"reputation": 10667, "user_id": 4259761, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yDRx2.png?s=128&g=1", "display_name": "openwonk", "link": "https://stackoverflow.com/users/4259761/openwonk"}, "is_accepted": false, "score": 3, "last_activity_date": 1555297941, "creation_date": 1555297941, "answer_id": 55682144, "question_id": 46795963, "link": "https://stackoverflow.com/questions/46795963/how-to-empty-a-s3-bucket-using-the-aws-sdk-for-golang/55682144#55682144", "title": "How to empty a S3 bucket using the AWS SDK for GOlang?", "body": "<p>AWS SDK now has <code>BatchDeleteIterator</code> that can do the job. Example provided via <a href=\"https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/s3-example-basic-bucket-operations.html#s3-examples-bucket-ops-delete-all-bucket-items\" rel=\"nofollow noreferrer\">Amazon docs</a>.</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/service/s3\"\n    \"github.com/aws/aws-sdk-go/service/s3/s3manager\"\n\n    \"fmt\"\n    \"os\"\n)\n\n//    go run s3_delete_objects BUCKET\n\nfunc main() {\n    if len(os.Args) != 2 {\n        exitErrorf(\"Bucket name required\\nUsage: %s BUCKET\", os.Args[0])\n    }\n\n    bucket := os.Args[1]\n\n    // Initialize a session in us-west-2 that the SDK will use to load\n    // credentials from the shared credentials file ~/.aws/credentials.\n    sess, _ := session.NewSession(&amp;aws.Config{\n        Region: aws.String(\"us-west-2\")},\n    )\n\n    // Create S3 service client\n    svc := s3.New(sess)\n\n    // Setup BatchDeleteIterator to iterate through a list of objects.\n    iter := s3manager.NewDeleteListIterator(svc, &amp;s3.ListObjectsInput{\n        Bucket: aws.String(bucket),\n    })\n\n    // Traverse iterator deleting each object\n    if err := s3manager.NewBatchDeleteWithClient(svc).Delete(aws.BackgroundContext(), iter); err != nil {\n        exitErrorf(\"Unable to delete objects from bucket %q, %v\", bucket, err)\n    }\n\n    fmt.Printf(\"Deleted object(s) from bucket: %s\", bucket)\n}\n\nfunc exitErrorf(msg string, args ...interface{}) {\n    fmt.Fprintf(os.Stderr, msg+\"\\n\", args...)\n    os.Exit(1)\n}\n</code></pre>\n"}], "owner": {"reputation": 111, "user_id": 8658245, "user_type": "registered", "profile_image": "https://graph.facebook.com/10209079498923576/picture?type=large", "display_name": "SKRelan", "link": "https://stackoverflow.com/users/8658245/skrelan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2457, "favorite_count": 2, "accepted_answer_id": 46796374, "answer_count": 4, "score": 3, "last_activity_date": 1555297941, "creation_date": 1508261706, "last_edit_date": 1508355367, "question_id": 46795963, "link": "https://stackoverflow.com/questions/46795963/how-to-empty-a-s3-bucket-using-the-aws-sdk-for-golang", "title": "How to empty a S3 bucket using the AWS SDK for GOlang?", "body": "<p><strong>Goal:</strong> To empty an existing S3 bucket using the AWS SDK for GOlang.</p>\n"}, {"tags": ["mongodb", "go", "mgo", "capped-collections"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1508311008, "last_edit_date": 1592644375, "creation_date": 1508271595, "answer_id": 46798542, "question_id": 46794192, "link": "https://stackoverflow.com/questions/46794192/convert-collection-to-capped-with-mgo/46798542#46798542", "title": "Convert Collection to Capped with mgo", "body": "<h2>1. Get Collection Stats</h2>\n<p>This is not part of the <code>mgo</code> package, but it is available as a runnable MongoDB command: <a href=\"https://docs.mongodb.com/manual/reference/command/collStats/#dbcmd.collStats\" rel=\"nofollow noreferrer\"><code>collStats</code></a>.</p>\n<p>Running <code>collStats</code> with <code>mgo</code>:</p>\n<pre><code>var doc bson.M\nerr := mgr.sess.DB(&quot;&quot;).Run(bson.D{\n    {Name: &quot;collStats&quot;, Value: &quot;my_collection&quot;},\n}, &amp;doc)\nif err != nil {\n    fmt.Println(&quot;Error:&quot;, err)\n    return\n}\n\nfmt.Println(&quot;Result:&quot;, doc)\nfmt.Println(&quot;Capped:&quot;, doc[&quot;capped&quot;])\n// Acquire capped info as a bool value:\ncapped, ok := doc[&quot;capped&quot;].(bool)\nif ok {\n    fmt.Println(&quot;Capped bool value:&quot;, capped)\n}\n</code></pre>\n<p>Example output (<em>veeeeeeery</em> long so chunked):</p>\n<pre><code>Result: map[ok:1 size:36 storageSize:4096 totalIndexSize:4096  ...chunked...]\nCapped: true\nCapped bool value: true\n</code></pre>\n<h2>2. Converting to Capped</h2>\n<p>The simple problem with your attempt is that the value of the <code>&quot;size&quot;</code> parameter must be a number and not a <code>string</code>. Quoting from the <a href=\"https://docs.mongodb.com/manual/reference/command/convertToCapped/#dbcmd.convertToCapped\" rel=\"nofollow noreferrer\"><code>convertToCapped</code></a> doc:</p>\n<blockquote>\n<p>The command has the following syntax:</p>\n<pre><code>  { convertToCapped: &lt;collection&gt;, size: &lt;capped size&gt; }\n</code></pre>\n<p><code>convertToCapped</code> takes an existing collection (<code>&lt;collection&gt;</code>) and transforms it into a capped collection with a maximum size in bytes, specified by the <code>size</code> argument (<code>&lt;capped size&gt;</code>).</p>\n</blockquote>\n<p>Correct version:</p>\n<pre><code>var doc bson.M\nerr := mgr.sess.DB(&quot;&quot;).Run(bson.D{\n    {Name: &quot;convertToCapped&quot;, Value: &quot;my_collection&quot;},\n    {Name: &quot;size&quot;, Value: 1&lt;&lt;20}, // 1 MB\n}, &amp;doc)\nif err != nil {\n    fmt.Println(&quot;Error:&quot;, err)\n    return\n}\n\nfmt.Println(&quot;Result:&quot;, doc)\n</code></pre>\n<p>Example output:</p>\n<pre><code>Result: map[ok:1]\n</code></pre>\n"}], "owner": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 628, "favorite_count": 1, "accepted_answer_id": 46798542, "answer_count": 1, "score": 2, "last_activity_date": 1508311008, "creation_date": 1508255358, "last_edit_date": 1508256510, "question_id": 46794192, "link": "https://stackoverflow.com/questions/46794192/convert-collection-to-capped-with-mgo", "title": "Convert Collection to Capped with mgo", "body": "<p>I would like to convert a mongo collection to capped using <code>gopkg.in/mgo.v2</code>.</p>\n\n<p>I am able to create a capped collection from scratch - as follows:</p>\n\n<pre><code># Create a Capped Collection\nsess.DB(\"\").C(\"my_collection\").Create(&amp;mgo.CollectionInfo{Capped: true, MaxBytes: tenMB, MaxDocs: 10})\n</code></pre>\n\n<p>I can't work out how to get the stats for an existing collection or how to run <code>convertToCapped</code> command.</p>\n\n<p>Step 1 - Get Collection Stats:</p>\n\n<pre><code># Mongo\ndb.getCollection('my_collection').stats();\n\n# mgo // I need to find out how to do this.\n</code></pre>\n\n<p>Step 2 - Convert to Capped</p>\n\n<pre><code># Mongo\ndb.runCommand({\"convertToCapped\": \"my_collection\", size: 1000000});\n\n# mgo // I need to find out how to do this.\nif err := sess.DB(\"\").Run(bson.D{{\"convertToCapped\", \"my_collection\"}, {\"size\", \"1000\"}}, nil); err != nil {\n        println(err.Error()) // invalid command spec\n        os.Exit(1)\n}\n</code></pre>\n"}, {"tags": ["bash", "go", "terminal", "pty"], "comments": [{"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1508254585, "post_id": 46792677, "comment_id": 80534534, "body": "There&#39;s no way to get window content via the tty interface."}, {"owner": {"reputation": 647, "user_id": 857156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66412a85a83783c2061838e1b44a9bbb?s=128&d=identicon&r=PG", "display_name": "Dave Gray", "link": "https://stackoverflow.com/users/857156/dave-gray"}, "edited": false, "score": 1, "creation_date": 1508270684, "post_id": 46792677, "comment_id": 80543472, "body": "If you run commands from w/in tmux, there&#39;s probably a way to do what you want."}], "owner": {"reputation": 31, "user_id": 3838971, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b78d35862fac0cf5cb3f0f2b8fea0106?s=128&d=identicon&r=PG&f=1", "display_name": "user3838971", "link": "https://stackoverflow.com/users/3838971/user3838971"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 117, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1508250704, "creation_date": 1508250704, "question_id": 46792677, "link": "https://stackoverflow.com/questions/46792677/how-can-i-get-all-current-lines-on-pty-terminal", "title": "How can I get all current lines on pty terminal", "body": "<p>I am running bash commands with pty.</p>\n\n<pre><code>cmd := exec.Command(\"/bin/bash\", []string{}...)\nptyIo, err := pty.Start(cmd)\n</code></pre>\n\n<p>I can resize pty window, write bytes, read bytes with a loop (It gives changes on terminal).</p>\n\n<p>I am using \"github.com/kr/pty\" pty library.</p>\n\n<p>How can I get all current lines on the terminal screen whenever I want?</p>\n"}, {"tags": ["loops", "go", "goto"], "comments": [{"owner": {"reputation": 354, "user_id": 5537785, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qk26D.png?s=128&g=1", "display_name": "lamg", "link": "https://stackoverflow.com/users/5537785/lamg"}, "edited": false, "score": 0, "creation_date": 1508271570, "post_id": 46792159, "comment_id": 80543917, "body": "By the way, you don&#39;t need those. All code you can write with <code>goto</code> <code>break</code> or <code>continue</code> can be written without them, with the advantage that is easier to follow and more explicit."}], "answers": [{"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 3, "creation_date": 1508250270, "post_id": 46792380, "comment_id": 80531530, "body": "One very important use for those labels is if you have a switch statement inside a loop, because <code>break</code> will apply to the switch instead of the loop surrounding it."}], "tags": [], "owner": {"reputation": 6841, "user_id": 3960399, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/c5OVT.jpg?s=128&g=1", "display_name": "Frank Bryce", "link": "https://stackoverflow.com/users/3960399/frank-bryce"}, "is_accepted": true, "score": 25, "last_activity_date": 1508250453, "last_edit_date": 1592644375, "creation_date": 1508249861, "answer_id": 46792380, "question_id": 46792159, "link": "https://stackoverflow.com/questions/46792159/labels-break-vs-continue-vs-goto/46792380#46792380", "title": "Labels - break vs continue vs goto", "body": "<p>For <code>break</code> and <code>continue</code>, the additional label lets you specify which loop you would like to refer to.  For example, you may want to <code>break</code>/<code>continue</code> the outer loop instead of the one that you nested in.</p>\n<p>Here is an example from the <a href=\"https://golang.org/ref/spec#Continue_statements\" rel=\"noreferrer\">Go Documentation</a>:</p>\n<pre><code>RowLoop:\n    for y, row := range rows {\n        for x, data := range row {\n            if data == endOfRow {\n                continue RowLoop\n            }\n            row[x] = data + bias(x, y)\n        }\n    }\n</code></pre>\n<p>This lets you go the the next &quot;row&quot; even when your currently iterating over the columns (data) in the row.  This works because the label <code>RowLoop</code> is &quot;labeling&quot; the outer loop by being directly before it.</p>\n<p><code>break</code> can be used in the same way with the same mechanics.  Here is an example from the <a href=\"https://golang.org/ref/spec#Break_statements\" rel=\"noreferrer\">Go Documentation</a> for when a <code>break</code> statement is useful for breaking out of a loop when inside of a switch statement.  Without the label, go would think you were breaking out of the switch statement, instead of the loop (which is what you want, here).</p>\n<pre><code>OuterLoop:\n    for i = 0; i &lt; n; i++ {\n        for j = 0; j &lt; m; j++ {\n            switch a[i][j] {\n            case nil:\n                state = Error\n                break OuterLoop\n            case item:\n                state = Found\n                break OuterLoop\n            }\n        }\n    }\n</code></pre>\n<p>For <code>goto</code>, this is more traditional.  It makes the program execute the command at the Label, next.  In your example, this leads to an infinite loop since you go to the beginning of the loop, repeatedly.</p>\n<h1>Documentation Time</h1>\n<p>For <a href=\"https://golang.org/ref/spec#Break_statements\" rel=\"noreferrer\"><code>break</code></a>:</p>\n<blockquote>\n<p>If there is a label, it must be that of an enclosing &quot;for&quot;, &quot;switch&quot;, or &quot;select&quot; statement, and that is the one whose execution terminates.</p>\n</blockquote>\n<p>For <a href=\"https://golang.org/ref/spec#Continue_statements\" rel=\"noreferrer\"><code>continue</code></a>:</p>\n<blockquote>\n<p>If there is a label, it must be that of an enclosing &quot;for&quot; statement, and that is the one whose execution advances.</p>\n</blockquote>\n"}], "owner": {"reputation": 643, "user_id": 7552759, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/ldvQc.jpg?s=128&g=1", "display_name": "Anurope", "link": "https://stackoverflow.com/users/7552759/anurope"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8587, "favorite_count": 4, "accepted_answer_id": 46792380, "answer_count": 1, "score": 13, "last_activity_date": 1508277091, "creation_date": 1508249183, "last_edit_date": 1508277091, "question_id": 46792159, "link": "https://stackoverflow.com/questions/46792159/labels-break-vs-continue-vs-goto", "title": "Labels - break vs continue vs goto", "body": "<p>I understand that:</p>\n\n<p><code>break</code> - stops further execution of a loop construct.</p>\n\n<p><code>continue</code> - skips the rest of the loop body and starts the next iteration.</p>\n\n<p>But how do these statements differ when used in combination with labels?</p>\n\n<p>In other words what is the difference between these three loops:</p>\n\n<pre><code>Loop:\n    for i := 0; i &lt; 10; i++ {\n        if i == 5 {\n             break Loop\n        }\n        fmt.Println(i)\n    }\n</code></pre>\n\n<hr>\n\n<p>Output:</p>\n\n<p>0 1 2 3 4</p>\n\n<hr>\n\n<pre><code>Loop:\n    for i := 0; i &lt; 10; i++ {\n        if i == 5 {\n             continue Loop\n        }\n        fmt.Println(i)\n    }\n</code></pre>\n\n<hr>\n\n<p>Output:</p>\n\n<p>0 1 2 3 4 6 7 8 9</p>\n\n<hr>\n\n<pre><code>Loop:\n    for i := 0; i &lt; 10; i++ {\n        if i == 5 {\n             goto Loop\n        }\n        fmt.Println(i)\n    }\n</code></pre>\n\n<hr>\n\n<p>Output:</p>\n\n<p>0 1 2 3 4 0 1 2 3 4 ... (infinite)</p>\n\n<hr>\n"}, {"tags": ["http", "go", "zip"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1508246397, "post_id": 46791169, "comment_id": 80528734, "body": "You&#39;re copying the zip writer before you close it."}, {"owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508249572, "post_id": 46791169, "comment_id": 80531022, "body": "@JimB what is preferred?, to <code>io.Copy(w, buf)</code> or to <code>w.Write(buf.Bytes())</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "edited": false, "score": 1, "creation_date": 1508249872, "post_id": 46791169, "comment_id": 80531221, "body": "@nbari: Since we know that <code>buf</code> is a <code>bytes.Buffer</code> so the entire file is already in a slice, I&#39;d prefer the second since we technically don&#39;t need the Copy call. In practice either is fine."}, {"owner": {"reputation": 109, "user_id": 8807669, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b6a0c06065758f0a6808250af10bc323?s=128&d=identicon&r=PG&f=1", "display_name": "Bharath Kuppala", "link": "https://stackoverflow.com/users/8807669/bharath-kuppala"}, "edited": false, "score": 0, "creation_date": 1602779245, "post_id": 46791169, "comment_id": 113834762, "body": "@Steven Smithson did you manage to get solution for this?"}], "answers": [{"tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": false, "score": 14, "last_activity_date": 1508249381, "last_edit_date": 1508249381, "creation_date": 1508247891, "answer_id": 46791714, "question_id": 46791169, "link": "https://stackoverflow.com/questions/46791169/create-serve-over-http-a-zip-file-without-writing-to-disk/46791714#46791714", "title": "Create + Serve (over HTTP) a .ZIP file, without writing to disk?", "body": "<p>I found interesting this and just for testing came up with this:</p>\n\n<p><a href=\"http://play.golang.org/p/JKAde2jbR3\" rel=\"noreferrer\">http://play.golang.org/p/JKAde2jbR3</a></p>\n\n<pre><code>package main\n\nimport (\n    \"archive/zip\"\n    \"bytes\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc zipHandler(w http.ResponseWriter, r *http.Request) {\n    filename := \"randomfile.jpg\"\n    buf := new(bytes.Buffer)\n    writer := zip.NewWriter(buf)\n    data, err := ioutil.ReadFile(filename)\n    if err != nil {\n        log.Fatal(err)\n    }\n    f, err := writer.Create(filename)\n    if err != nil {\n        log.Fatal(err)\n    }\n    _, err = f.Write([]byte(data))\n    if err != nil {\n        log.Fatal(err)\n    }\n    err = writer.Close()\n    if err != nil {\n        log.Fatal(err)\n    }\n    w.Header().Set(\"Content-Type\", \"application/zip\")\n    w.Header().Set(\"Content-Disposition\", fmt.Sprintf(\"attachment; filename=\\\"%s.zip\\\"\", filename))\n    //io.Copy(w, buf)\n    w.Write(buf.Bytes())\n}\n\nfunc main() {\n    http.HandleFunc(\"/zip\", zipHandler)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>I just add some headers like the <code>Content-Type</code>  and <code>Content-Disposition</code>.</p>\n\n<p>Also instead of using <code>io.Copy(w, buf)</code> I am writing directly <code>w.Write(buf.Bytes())</code> wondering if this is better? probably a more experienced user could clarify this.</p>\n"}, {"tags": [], "owner": {"reputation": 1360, "user_id": 923275, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/bdff2cc237e0f423706563be675e6648?s=128&d=identicon&r=PG", "display_name": "17xande", "link": "https://stackoverflow.com/users/923275/17xande"}, "is_accepted": false, "score": 4, "last_activity_date": 1508257598, "last_edit_date": 1508257598, "creation_date": 1508257249, "answer_id": 46794797, "question_id": 46791169, "link": "https://stackoverflow.com/questions/46791169/create-serve-over-http-a-zip-file-without-writing-to-disk/46794797#46794797", "title": "Create + Serve (over HTTP) a .ZIP file, without writing to disk?", "body": "<p>Here's a slightly simpler method using <a href=\"https://golang.org/pkg/io/#Copy\" rel=\"nofollow noreferrer\">io.Copy</a>. It's probably not as performant as using a buffers for larger file sizes, but it works for me:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func handleZip(w http.ResponseWriter, r *http.Request) {\n    f, err := os.Open(\"main.go\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer func() {\n        if err := f.Close(); err != nil {\n            log.Fatal(err)\n        }\n    }()\n\n    // write straight to the http.ResponseWriter\n    zw := zip.NewWriter(w)\n    cf, err := zw.Create(f.Name())\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    w.Header().Set(\"Content-Type\", \"application/zip\")\n    w.Header().Set(\"Content-Disposition\", fmt.Sprintf(\"attachment; filename=\\\"%s.zip\\\"\", f.Name()))\n\n\n    // copy the file contents to the zip Writer\n    _, err = io.Copy(cf, f)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // close the zip Writer to flush the contents to the ResponseWriter\n    err = zw.Close()\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 8790082, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2c0e8d32442f657cb0729aaf8af2eed?s=128&d=identicon&r=PG&f=1", "display_name": "Steven Smithson", "link": "https://stackoverflow.com/users/8790082/steven-smithson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3752, "favorite_count": 1, "answer_count": 2, "score": 12, "last_activity_date": 1508257598, "creation_date": 1508246240, "question_id": 46791169, "link": "https://stackoverflow.com/questions/46791169/create-serve-over-http-a-zip-file-without-writing-to-disk", "title": "Create + Serve (over HTTP) a .ZIP file, without writing to disk?", "body": "<p>I am wanting to serve a .ZIP file that is created on the fly, without having to write it to disk (I/O will slow down performance) and serve it to the client over HTTP. </p>\n\n<p>Here is how I first attempted this:</p>\n\n<pre><code>func ZipServe(W http.ResponseWriter, R *http.Request) {\n\nbuf := new(bytes.Buffer)\nwriter := zip.NewWriter(buf)\n\n// for the sake of this demonstration, this is the data I will zip\ndata := ioutil.ReadFile(\"randomfile.jpg\")\n\nf, err := writer.Create(\"randomfile.jpg\")\nif err != nil { \n    fmt.Println(err)\n}\n\n_, err = f.Write(data)\nif err != nil {\n    fmt.Println(err)\n}\n\nio.Copy(W, buf)\n\nerr := writer.Close()\nif err != nil {\n    fmt.Println(err)\n}\n\n}\n</code></pre>\n\n<p>This is no good, as the .ZIP ends up being corrupt after downloading. I suppose the issue has to do with io.Copy; shall I be using a different method?</p>\n"}, {"tags": ["go", "stack", "lua-table", "lua-api"], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 9814050, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/615aaf4e9b30af3539f5b73f0231ece8?s=128&d=identicon&r=PG&f=1", "display_name": "johnnyO", "link": "https://stackoverflow.com/users/9814050/johnnyo"}, "is_accepted": false, "score": 0, "last_activity_date": 1526777705, "creation_date": 1526777705, "answer_id": 50430790, "question_id": 46790700, "link": "https://stackoverflow.com/questions/46790700/how-to-dump-contents-of-a-table-on-the-stack-without-modifying-the-stack/50430790#50430790", "title": "How to dump contents of a table on the stack without modifying the stack?", "body": "<p>The usual method for getting the value at a table key is to use the Lua stack operation <strong>lua_getfield()</strong>. The table should be already on the stack. <strong>lua_getfield()</strong> will obtain the value of a particular key and push that on the stack. So that value you could pop off since you don't want to change the stack any. It doesn't change the table that was already on the stack.</p>\n\n<p>If you really are going to modify the tables you might just have to use the lua stack to do it, that's kind of how it works.</p>\n"}], "owner": {"reputation": 378, "user_id": 1111580, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8d85573698b9b2bc3f3e0c33f54cef73?s=128&d=identicon&r=PG", "display_name": "pythonator", "link": "https://stackoverflow.com/users/1111580/pythonator"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 229, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1526777705, "creation_date": 1508244962, "last_edit_date": 1592644375, "question_id": 46790700, "link": "https://stackoverflow.com/questions/46790700/how-to-dump-contents-of-a-table-on-the-stack-without-modifying-the-stack", "title": "How to dump contents of a table on the stack without modifying the stack?", "body": "<p>First off I'm very much a n00b at Lua. Literally started yesterday evening.\nBtw, I'm using <a href=\"https://github.com/aarzilli/golua\" rel=\"nofollow noreferrer\">golua</a> which as I understand it mirrors the usual C API quite closely. So any suggestions in C will likely apply to my case as well.</p>\n<p>Anyway, to the issue. I'm (naturally) quite early in my experiments in integrating Lua in a Go application and as such is testing various methods and way to do things.</p>\n<p>One of the first things I'm looking to do is call a Lua function with a table (based on a JSON object), do some operations on the table there and then return it. The table may contain nested tables. The scripting part isn't an issue here, I think I got that bit covered.\nHowever, I want to peek inside the stack to verify what I'm passing to the function is correct. Likewise also peek at the value returned from Lua.</p>\n<p>But how?</p>\n<p>This bit is taken <a href=\"https://www.lua.org/pil/24.2.3.html\" rel=\"nofollow noreferrer\">from the reference manual</a>:</p>\n<pre><code>static void stackDump (lua_State *L) {\n  int i;\n  int top = lua_gettop(L);\n  for (i = 1; i &lt;= top; i++) {  /* repeat for each level */\n    int t = lua_type(L, i);\n    switch (t) {\n\n      case LUA_TSTRING:  /* strings */\n        printf(&quot;`%s'&quot;, lua_tostring(L, i));\n        break;\n\n      case LUA_TBOOLEAN:  /* booleans */\n        printf(lua_toboolean(L, i) ? &quot;true&quot; : &quot;false&quot;);\n        break;\n\n      case LUA_TNUMBER:  /* numbers */\n        printf(&quot;%g&quot;, lua_tonumber(L, i));\n        break;\n\n      default:  /* other values */\n        printf(&quot;%s&quot;, lua_typename(L, t));\n        break;\n\n    }\n    printf(&quot;  &quot;);  /* put a separator */\n  }\n  printf(&quot;\\n&quot;);  /* end the listing */\n}\n</code></pre>\n<p>However, when the stack contains a table this will only print &quot;table&quot;, which of course isn't terribly useful if the content of the table is the thing we're actually interested in.</p>\n<p>I know how to &quot;pop&quot; a table from the stack (using <code>lua_next()</code> etc), but that of course modifies the stack, so I can't use that just before I call the lua function...</p>\n<p>I've searched high and low, but everything I've found is akin to the above snippet.</p>\n<p>edit: this is to find out why this lua code doesn't print anything:</p>\n<pre><code>for k, v in ipairs(arg) do\n    print(k .. ' = ' .. v)\nend\n</code></pre>\n<p>Where <code>arg</code> is the argument to the function (the table).</p>\n<p>edit 2: ahem, turns out the above should be using <code>pairs(arg)</code>. However, the usefulness of the question still stands, in general.</p>\n<p>edit 3: found ref.manual source</p>\n"}, {"tags": ["json", "go", "encoding", "deep-copy", "gob"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1508244855, "post_id": 46790190, "comment_id": 80527590, "body": "You are recreating your gob en/decoder each time. Also: Both ways of deep-copying are awful. And: Use standard testing benchmarks. Last: Your struct doesn&#39;t need and fancy deep copy mechanism."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1508244890, "post_id": 46790190, "comment_id": 80527613, "body": "If you&#39;re going to benchmark code, start by using a proper benchmark. That will give you more accurate times, and will also provide memory allocation stats, which will highlight your problems here."}, {"owner": {"reputation": 1347, "user_id": 4622470, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/6015804f9937b6231b4b0022d70b5ddb?s=128&d=identicon&r=PG&f=1", "display_name": "Rohanil", "link": "https://stackoverflow.com/users/4622470/rohanil"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1508245235, "post_id": 46790190, "comment_id": 80527881, "body": "@Volker - Which way do you suggest then? The struct in question is just a test code but my actual struct is complex and nested."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1508245882, "post_id": 46790190, "comment_id": 80528336, "body": "@Rohanil: If all your fields are public, you can live with any of the type restrictions they may impose, and you don&#39;t mind paying the price for reflection, then gob or json will work fine. You can always do better with a custom DeepCopy method which doesn&#39;t use reflection at all."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1508247037, "post_id": 46790190, "comment_id": 80529197, "body": "&quot;Complex and nested&quot; struct does not mean a simple <code>a := b</code> won&#39;t produce a deep copy. If your actual code contains pointers, slices, maps, functions or channels things become more complicated and you should test this. If you struct contains e.g. closures over functions you will have a hard time making a deep copy. If your struct contains loops you are out of luck with JSON.  If your struct contains just some slices and maps then the simplest might be an initial flat copy and manually copying the few slices/maps. If it&#39;s []map[string][][]map[int][]string: redesign."}, {"owner": {"reputation": 1347, "user_id": 4622470, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/6015804f9937b6231b4b0022d70b5ddb?s=128&d=identicon&r=PG&f=1", "display_name": "Rohanil", "link": "https://stackoverflow.com/users/4622470/rohanil"}, "edited": false, "score": 0, "creation_date": 1508248167, "post_id": 46790190, "comment_id": 80530054, "body": "My struct contains pointers, slices, maps. It also contains fields with custom structs. Those sub structs also have pointers, maps, slices."}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 8112003, "user_type": "registered", "profile_image": "https://graph.facebook.com/1351572098263642/picture?type=large", "display_name": "Nikolai Ehrhardt", "link": "https://stackoverflow.com/users/8112003/nikolai-ehrhardt"}, "edited": false, "score": 0, "creation_date": 1616518174, "post_id": 46793007, "comment_id": 118025219, "body": "Chapter: &quot;Caveats of these cloning&quot; is not completely correct, after marshalling and unmarshalling, no matter if json or gob, pointers of interface{} will point to nil."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 15, "last_activity_date": 1600845512, "last_edit_date": 1600845512, "creation_date": 1508251715, "answer_id": 46793007, "question_id": 46790190, "link": "https://stackoverflow.com/questions/46790190/quicker-way-to-deepcopy-objects-in-golang-json-vs-gob/46793007#46793007", "title": "Quicker way to deepcopy objects in golang, JSON vs gob", "body": "<h2>JSON vs <code>gob</code> difference</h2>\n<p>The <a href=\"https://golang.org/pkg/encoding/gob/\" rel=\"nofollow noreferrer\"><code>encoding/gob</code></a> package needs to transmit type definitions:</p>\n<blockquote>\n<p>The implementation compiles a custom codec for each data type in the stream and is most efficient when a single Encoder is used to transmit a stream of values, amortizing the cost of compilation.</p>\n</blockquote>\n<p>When you &quot;first&quot; serialize a value of a type, the <em>definition</em> of the type also has to be included / transmitted, so the decoder can properly interpret and decode the stream:</p>\n<blockquote>\n<p>A stream of gobs is self-describing. Each data item in the stream is preceded by a specification of its type, expressed in terms of a small set of predefined types.</p>\n</blockquote>\n<p>This is explained in great details here: <a href=\"https://stackoverflow.com/questions/37618399/efficient-go-serialization-of-struct-to-disk/37620399#37620399\">Efficient Go serialization of struct to disk</a></p>\n<p>So while in your case it's necessary to create a new gob encoder and decoder each time, it is still the &quot;bottleneck&quot;, the part that makes it slow. Encoding to / decoding from JSON format, type description is not included in the representation.</p>\n<p>To prove it, make this simple change:</p>\n<pre><code>type Test struct {\n    Prop1 [1000]int\n    Prop2 [1000]string\n}\n</code></pre>\n<p>What we did here is made the types of fields arrays, &quot;multiplying&quot; the values a thousand times, while the type information is effectively remained the same (all elements in the arrays have the same type). Creating values of them like this:</p>\n<pre><code>r := Test{Prop1: [1000]int{}, Prop2: [1000]string{}}\n</code></pre>\n<p>Now running your test program, the output on my machine:</p>\n<p>Original:</p>\n<blockquote>\n<p>2017/10/17 14:55:53 Total items 3000, Clone avg. <strong>33.63\u00b5s</strong>, DeepCopy avg. <strong>2.326\u00b5s</strong>, Total Difference 93.910918ms</p>\n</blockquote>\n<p>Modified version:</p>\n<blockquote>\n<p>2017/10/17 14:56:38 Total items 3000, Clone avg. <strong>119.899\u00b5s</strong>, DeepCopy avg. <strong>462.608\u00b5s</strong>, Total Difference -1.02812648s</p>\n</blockquote>\n<p>As you can see, in the original version JSON is faster, but in the modified version <code>gob</code> became faster, as the cost of transmitting type info amortized.</p>\n<h2>Testing / benching method</h2>\n<p>Now on to your testing method. This way of measuring performance is bad and can yield quite inaccurate results. Instead you should use Go's built-in testing and benchmark tools. For details, read <a href=\"https://stackoverflow.com/questions/41608578/order-of-the-code-and-performance/41608707#41608707\">Order of the code and performance</a>.</p>\n<h2>Caveats of these cloning</h2>\n<p>These methods work with reflection and thus can only &quot;clone&quot; fields that are accessible via reflection, that is: exported. Also they often don't manage pointer equality. By this I mean if you have 2 pointer fields in a struct, both pointing to the same object (pointers being equal), after marshaling and unmarshaling, you'll get 2 different pointers pointing to 2 different values. This may even cause problems in certain situations. They also don't handle self-referencing structures, which at best returns an error, or in wrose case causes an infinite loop or goroutine stack exceeding.</p>\n<h2>The &quot;proper&quot; way of cloning</h2>\n<p>Considering the caveats mentioned above, often the proper way of cloning needs help from the &quot;inside&quot;. That is, cloning a specific type is often only possible if that type (or the package of that type) provides this functionality.</p>\n<p>Yes, providing a &quot;manual&quot; cloning functionality is not convenient, but on the other side it will outperform the above methods (maybe even by orders of magnitude), and will require the least amount of &quot;working&quot; memory required for the cloning process.</p>\n"}], "owner": {"reputation": 1347, "user_id": 4622470, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/6015804f9937b6231b4b0022d70b5ddb?s=128&d=identicon&r=PG&f=1", "display_name": "Rohanil", "link": "https://stackoverflow.com/users/4622470/rohanil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 27808, "favorite_count": 4, "accepted_answer_id": 46793007, "answer_count": 1, "score": 14, "last_activity_date": 1609345000, "creation_date": 1508243462, "last_edit_date": 1609345000, "question_id": 46790190, "link": "https://stackoverflow.com/questions/46790190/quicker-way-to-deepcopy-objects-in-golang-json-vs-gob", "title": "Quicker way to deepcopy objects in golang, JSON vs gob", "body": "<p>I am using <code>go 1.9</code>. And I want to deepcopy value of object into another object. I try to do it with encoding/gob and encoding/json. But it takes more time for gob encoding than json encoding. I see some other questions like <a href=\"https://stackoverflow.com/questions/41179453/difference-between-encoding-gob-and-encoding-json-in-golang\">this</a> and they suggest that gob encoding should be quicker. But I see exact opposite behaviour. Can someone tell me if I am doing something wrong? Or any better and quicker way to deepcopy than these two? My object's struct is complex and nested.</p>\n\n<p>The test code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/gob\"\n    \"encoding/json\"\n    \"log\"\n    \"time\"\n\n    \"strconv\"\n)\n\n// Test ...\ntype Test struct {\n    Prop1 int\n    Prop2 string\n}\n\n// Clone deep-copies a to b\nfunc Clone(a, b interface{}) {\n\n    buff := new(bytes.Buffer)\n    enc := gob.NewEncoder(buff)\n    dec := gob.NewDecoder(buff)\n    enc.Encode(a)\n    dec.Decode(b)\n}\n\n// DeepCopy deepcopies a to b using json marshaling\nfunc DeepCopy(a, b interface{}) {\n    byt, _ := json.Marshal(a)\n    json.Unmarshal(byt, b)\n}\n\nfunc main() {\n    i := 0\n    tClone := time.Duration(0)\n    tCopy := time.Duration(0)\n    end := 3000\n    for {\n        if i == end {\n            break\n        }\n\n        r := Test{Prop1: i, Prop2: strconv.Itoa(i)}\n        var rNew Test\n        t0 := time.Now()\n        Clone(r, &amp;rNew)\n        t2 := time.Now().Sub(t0)\n        tClone += t2\n\n        r2 := Test{Prop1: i, Prop2: strconv.Itoa(i)}\n        var rNew2 Test\n        t0 = time.Now()\n        DeepCopy(&amp;r2, &amp;rNew2)\n        t2 = time.Now().Sub(t0)\n        tCopy += t2\n\n        i++\n    }\n    log.Printf(\"Total items %+v, Clone avg. %+v, DeepCopy avg. %+v, Total Difference %+v\\n\", i, tClone/3000, tCopy/3000, (tClone - tCopy))\n}\n</code></pre>\n\n<p>I get following output:</p>\n\n<pre><code>Total items 3000, Clone avg. 30.883\u00b5s, DeepCopy avg. 6.747\u00b5s, Total Difference 72.409084ms\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 3, "creation_date": 1508242352, "post_id": 46789816, "comment_id": 80525927, "body": "For example: <a href=\"https://dave.cheney.net/2014/10/04/that-trailing-comma\" rel=\"nofollow noreferrer\">dave.cheney.net/2014/10/04/that-trailing-comma</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1508242464, "post_id": 46789816, "comment_id": 80525999, "body": "See related questions: <a href=\"https://stackoverflow.com/questions/34846848/how-to-break-a-long-line-of-code-in-golang/34848928#34848928\">How to break a long line of code in Golang?</a>; and <a href=\"https://stackoverflow.com/questions/42554759/mongodb-in-go-with-mgo-operators-with-bson-m-bson-d-always-got-syntax-error/42554846#42554846\">MongoDB in Go with mgo, operators with bson.M / bson.D always got syntax error</a>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1508242706, "post_id": 46789816, "comment_id": 80526156, "body": "That&#39;s mandated by the language spec."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1508243043, "post_id": 46789816, "comment_id": 80526399, "body": "@icza: It has nothing to do with the semicolon rules. It predates them. As already noted (<a href=\"https://dave.cheney.net/2014/10/04/that-trailing-comma\" rel=\"nofollow noreferrer\">That trailing comma</a>) it helps with maintaining and generating lists of elements. It is by design."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1508243509, "post_id": 46789816, "comment_id": 80526722, "body": "@peterSO But quoting from that blog you linked too, even Dave Cheney thinks <a href=\"https://dave.cheney.net/2014/10/04/that-trailing-comma\" rel=\"nofollow noreferrer\"><i>&quot;it is the result of the semicolon rule&quot;</i></a>. Reading forward: <i>&quot;Although possibly an <a href=\"http://golang.org/doc/faq#semicolons\" rel=\"nofollow noreferrer\">unintended consequence</a>, this means that when proposing a one line change, it really is a one line change.&quot;</i>"}, {"owner": {"reputation": 4733, "user_id": 922445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a469120d35647d9aa50646cb4d778c71?s=128&d=identicon&r=PG&f=1", "display_name": "Nulik", "link": "https://stackoverflow.com/users/922445/nulik"}, "edited": false, "score": 0, "creation_date": 1508265150, "post_id": 46789816, "comment_id": 80540526, "body": "I am surprised how many people downvoted this question. My surprise is valid, this comma only shows laziness of Go develperers who designed the grammar."}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 1, "last_activity_date": 1508264141, "creation_date": 1508264141, "answer_id": 46796636, "question_id": 46789816, "link": "https://stackoverflow.com/questions/46789816/what-does-mean-a-comma-in-array-definition/46796636#46796636", "title": "what does mean a comma in array definition?", "body": "<p>Comma is an element splitter. Elements could be.written as in a row so in a column:</p>\n\n<pre><code>{1, 2, 3}\n\n\n{\n 1,\n 2,\n 3,\n }\n</code></pre>\n\n<p>It\u2019s evident comma is unnecessary after the last element. Some languages require their absense like C, some - presence like Go, some allow both variants like Python. Sometimes it causes bugs like with JavaScript in old Internet Explorer. </p>\n\n<p>Why do gophers decide to keep this comma? One of key principles of Go is visual simplicity and readability. This way all the strings look the same way. It\u2019s easier to read them by eyes. Also suppose you add one more line - you have to edit previous one. And this creates visual noise  in diff. </p>\n\n<p>Thinking the same you get to the idea comma should not be in one liners. Because spoils readability as extra symbol. </p>\n"}], "owner": {"reputation": 4733, "user_id": 922445, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a469120d35647d9aa50646cb4d778c71?s=128&d=identicon&r=PG&f=1", "display_name": "Nulik", "link": "https://stackoverflow.com/users/922445/nulik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 46796636, "answer_count": 1, "score": -4, "last_activity_date": 1508264141, "creation_date": 1508242210, "question_id": 46789816, "link": "https://stackoverflow.com/questions/46789816/what-does-mean-a-comma-in-array-definition", "title": "what does mean a comma in array definition?", "body": "<p>why is there a comma in this variable declaration:</p>\n\n<pre><code>// RinkebyBootnodes are the enode URLs of the P2P bootstrap nodes running on the\n// Rinkeby test network.\nvar RinkebyBootnodes = []string{\n    \"enode://a24ac7c5484ef4ed0c5eb2d36620ba4e4aa13b8c84684e1b4aab0cebea2ae45cb4d375b77eab56516d34bfbd3c1a833fc51296ff084b770b94fb9028c4d25ccf@52.169.42.101:30303\", // IE\n    \"enode://343149e4feefa15d882d9fe4ac7d88f885bd05ebb735e547f12e12080a9fa07c8014ca6fd7f373123488102fe5e34111f8509cf0b7de3f5b44339c9f25e87cb8@52.3.158.184:30303\",  // INFURA\n}\n</code></pre>\n\n<p>I am talking about comma that goes here:</p>\n\n<pre><code>30303\",  // INFURA\n</code></pre>\n\n<p>it is the last character of the string array, and it has to go there, otherwise I get a compile error.</p>\n\n<p>In C language you can't have commas at the end of  curly braces {} , but in go you have to. Why ? And what does this comma mean?</p>\n"}, {"tags": ["docker", "go", "docker-machine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1508243709, "post_id": 46789780, "comment_id": 80526852, "body": "Please post the full error message and resulting stack, and the code that triggered it."}], "answers": [{"tags": [], "owner": {"reputation": 647, "user_id": 857156, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66412a85a83783c2061838e1b44a9bbb?s=128&d=identicon&r=PG", "display_name": "Dave Gray", "link": "https://stackoverflow.com/users/857156/dave-gray"}, "is_accepted": false, "score": 1, "last_activity_date": 1508271980, "creation_date": 1508271980, "answer_id": 46798640, "question_id": 46789780, "link": "https://stackoverflow.com/questions/46789780/tls-config-fails-in-binary-using-go-docker-sdk/46798640#46798640", "title": "TLS config fails in binary using Go docker SDK", "body": "<p>I can't tell why from what you've posted, but the stack trace from the following program looks suspiciously similar to what you're seeing. The solution is most likely making sure that your <code>*x509.CertPool</code> can't be <code>nil</code></p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"crypto/x509\"\n)\n\nfunc main() {\n  var cp *x509.CertPool\n  cert := &amp;x509.Certificate{}\n  cp.AddCert(cert)\n  fmt.Println(\"AddCert succeeded\")\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/1N8xX_c8PY\" rel=\"nofollow noreferrer\">Playground link</a></p>\n"}], "owner": {"reputation": 399, "user_id": 8264607, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-WQKpnhD7pmQ/AAAAAAAAAAI/AAAAAAAAABM/vjTCAvnmiD0/photo.jpg?sz=128", "display_name": "scriptonist", "link": "https://stackoverflow.com/users/8264607/scriptonist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1508320037, "creation_date": 1508242105, "last_edit_date": 1508320037, "question_id": 46789780, "link": "https://stackoverflow.com/questions/46789780/tls-config-fails-in-binary-using-go-docker-sdk", "title": "TLS config fails in binary using Go docker SDK", "body": "<p>I've a golang binary, which communicates with a remote docker daemon using TLS.The binary successfully runs on a local machine.But when running this binary in a docker ubuntu container the tls config fails. It is panicing with the following error </p>\n\n<pre><code>    /usr/local/go/src/crypto/x509/cert_pool.go:96 +0x6b\ncrypto/x509.(*CertPool).AppendCertsFromPEM(0x0, 0xc4202bd4c8, 0x0, 0x200, 0xac8)\n    /usr/local/go/src/crypto/x509/cert_pool.go:128 +0x161\ngithub.com/docker/go-connections/tlsconfig.certPool(0xc420240de0, 0x18, 0xc42018bc00, 0x51bbca, 0xc420240e20, 0x19)\n    /media/atom/lighthouse/gowork/src/github.com/docker/go-connections/tlsconfig/config.go:105 +0x283\ngithub.com/docker/go-connections/tlsconfig.Client(0xc420240de0, 0x18, 0xc420240e00, 0x1a, 0xc420240e20, 0x19, 0x0, 0x0, 0x0, 0x0, ...)\n    /media/atom/lighthouse/gowork/src/github.com/docker/go-connections/tlsconfig/config.go:199 +0x25a\n</code></pre>\n\n<p>)</p>\n\n<p>the binary uses the <code>github.com/docker/docker/client</code>,the official docker golang SDK.</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 2, "creation_date": 1508247776, "post_id": 46789554, "comment_id": 80529753, "body": "You could replace <code>io.Copy</code> with something you wrote yourself, that sets a timeout for each individual <code>Read</code> call and even notifies you about the amount of copied data so far, by writing something to a channel or so."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1508249029, "post_id": 46789554, "comment_id": 80530638, "body": "That&#39;s not a bad solution, feels cleaner than what i had planned - thanks for the suggestion"}, {"owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1508249580, "post_id": 46789554, "comment_id": 80531026, "body": "Be warned, it is much more complicated to replace <code>io.Copy</code> then one thinks, there even was competition to do it, while getting most nice properties: <a href=\"https://groups.google.com/d/msg/golang-nuts/434c3YInH_M/3Qd7C0uDUqQJ\" rel=\"nofollow noreferrer\">might be relevant</a>"}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "reply_to_user": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "edited": false, "score": 0, "creation_date": 1508267143, "post_id": 46789554, "comment_id": 80541579, "body": "Interesting discussion in the link (and link off that to next issue). Having looked at this a bit more, replacing io.Copy is certainly not trivial. It&#39;s looking a lot easier to refactor some of my code around the stat monitoring to handle this. I am surprised this doesn&#39;t appear to be implemented as part of the std lib. Probably good technical reasons for not doing so but I may submit as a feature request to see what the feedback says, will link in question if I do."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508333525, "post_id": 46789554, "comment_id": 80569877, "body": "You can also do this at a lower level, and have a Dialer that returns a net.Conn which implements an idle timeout. This however has the drawback of timing out idle keepalive connections too."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1508465001, "post_id": 46789554, "comment_id": 80630592, "body": "Note on your approach: that assumes you&#39;re fsync&#39;ing the file on every write, which you may be doing, but it&#39;s not very efficient. If you&#39;re not syncing the file, then the data in the file may not change at all until it&#39;s closed."}, {"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1508495700, "post_id": 46789554, "comment_id": 80641917, "body": "Ah, that might explain why my progress monitoring always moves in short bursts regardless of report frequency. Right now I&#39;m trying to get a product out the door and it seems to do the job but I would like to revisit this when I have the time. I&#39;m think the copy function you provided could be used for progress reporting too with a little refactoring around it."}], "answers": [{"comments": [{"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1508370173, "post_id": 46811304, "comment_id": 80589087, "body": "Thanks for the example @JimB, I&#39;m going to have a play with a few ideas and report back. No doubt this would do the job and I may well implement something like this but I&#39;m thinking it would be cleaner in the context of my current code if I just use my existing file stat loop to detect inactivity and kill the copy by closing the response body but I&#39;ll have to see how that behaves. Thanks again for the suggestion. up-voted for now, I will probably accept and update the question with my final solution."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1508421469, "last_edit_date": 1508421469, "creation_date": 1508333140, "answer_id": 46811304, "question_id": 46789554, "link": "https://stackoverflow.com/questions/46789554/how-can-i-implement-an-inactivity-timeout-on-an-http-download/46811304#46811304", "title": "How can I implement an inactivity timeout on an http download", "body": "<p>Doing the copy manually is not particularly difficult. If you're unsure how to properly implement it, it's only a couple dozen lines from the io package to copy and modify to suit your needs (I only removed the <code>ErrShortWrite</code> clause, because we can assume that the std library io.Writer implementations are correct)</p>\n\n<p>Here is a copy work-alike function, that also takes a cancelation context and an idle timeout parameter. Every time there is a successful read, it signals to the cancelation goroutine to continue and start a new timer. </p>\n\n<pre><code>func idleTimeoutCopy(dst io.Writer, src io.Reader, timeout time.Duration,\n    ctx context.Context, cancel context.CancelFunc) (written int64, err error) { \n    read := make(chan int)\n    go func() {\n        for {\n            select {\n            case &lt;-ctx.Done():\n                return\n            case &lt;-time.After(timeout):\n                cancel()\n            case &lt;-read:\n            }\n        }\n    }()\n\n    buf := make([]byte, 32*1024)\n    for {\n        nr, er := src.Read(buf)\n        if nr &gt; 0 {\n            read &lt;- nr\n            nw, ew := dst.Write(buf[0:nr])\n            written += int64(nw)\n            if ew != nil {\n                err = ew\n                break\n            }\n        }\n        if er != nil {\n            if er != io.EOF {\n                err = er\n            }\n            break\n        }\n    }\n    return written, err\n}\n</code></pre>\n\n<p>While I used <code>time.After</code> for brevity, it's more efficient to reuse the <code>Timer</code>. This means taking care to use the correct reset pattern, as the return value of the <code>Reset</code> function is broken:</p>\n\n<pre><code>    t := time.NewTimer(timeout)\n    for {\n        select {\n        case &lt;-ctx.Done():\n            return\n        case &lt;-t.C:\n            cancel()\n        case &lt;-read:\n            if !t.Stop() {\n                &lt;-t.C\n            }\n            t.Reset(timeout)\n        }\n    }\n</code></pre>\n\n<p>You could skip calling <code>Stop</code> altogether here, since in my opinion if the timer fires while calling Reset, it was close enough to cancel anyway, but it's often good to have the code be idiomatic in case this code is extended in the future.</p>\n"}], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 452, "favorite_count": 0, "accepted_answer_id": 46811304, "answer_count": 1, "score": 4, "last_activity_date": 1508421469, "creation_date": 1508241366, "last_edit_date": 1508420278, "question_id": 46789554, "link": "https://stackoverflow.com/questions/46789554/how-can-i-implement-an-inactivity-timeout-on-an-http-download", "title": "How can I implement an inactivity timeout on an http download", "body": "<p>I've been reading up on the various timeouts that are available on an http request and they all seem to act as hard deadlines on the total time of a request.</p>\n\n<p>I am running an http download, I don't want to implement a hard timeout past the initial handshake as I don't know anything about my users connection and don't want to timeout on slow connections. What I would ideally like is to timeout after a period of inactivity (when nothing has been downloaded for x seconds). Is there any way to do this as a built in or do I have to interrupt based on stating the file?</p>\n\n<p>The working code is a little hard to isolate but I think these are the relevant parts, there is another loop that stats the file to provide progress but I will need to refactor a bit to use this to interrupt the download:</p>\n\n<pre><code>// httspClientOnNetInterface returns an http client using the named network interface, (via proxy if passed)\nfunc HttpsClientOnNetInterface(interfaceIP []byte, httpsProxy *Proxy) (*http.Client, error) {\n\n    log.Printf(\"Got IP addr : %s\\n\", string(interfaceIP))\n    // create address for the dialer\n    tcpAddr := &amp;net.TCPAddr{\n        IP: interfaceIP,\n    }\n\n    // create the dialer &amp; transport\n    netDialer := net.Dialer{\n        LocalAddr: tcpAddr,\n    }\n\n    var proxyURL *url.URL\n    var err error\n\n    if httpsProxy != nil {\n        proxyURL, err = url.Parse(httpsProxy.String())\n        if err != nil {\n            return nil, fmt.Errorf(\"Error parsing proxy connection string: %s\", err)\n        }\n    }\n\n    httpTransport := &amp;http.Transport{\n        Dial:  netDialer.Dial,\n        Proxy: http.ProxyURL(proxyURL),\n    }\n\n    httpClient := &amp;http.Client{\n        Transport: httpTransport,\n    }\n\n    return httpClient, nil\n}\n\n/*\nStartDownloadWithProgress will initiate a download from a remote url to a local file,\nproviding download progress information\n*/\nfunc StartDownloadWithProgress(interfaceIP []byte, httpsProxy *Proxy, srcURL, dstFilepath string) (*Download, error) {\n\n    // start an http client on the selected net interface\n    httpClient, err := HttpsClientOnNetInterface(interfaceIP, httpsProxy)\n    if err != nil {\n        return nil, err\n    }\n\n    // grab the header\n    headResp, err := httpClient.Head(srcURL)\n    if err != nil {\n        log.Printf(\"error on head request (download size): %s\", err)\n        return nil, err\n    }\n\n    // pull out total size\n    size, err := strconv.Atoi(headResp.Header.Get(\"Content-Length\"))\n    if err != nil {\n        headResp.Body.Close()\n        return nil, err\n    }\n    headResp.Body.Close()\n\n    errChan := make(chan error)\n    doneChan := make(chan struct{})\n\n    // spawn the download process\n    go func(httpClient *http.Client, srcURL, dstFilepath string, errChan chan error, doneChan chan struct{}) {\n        resp, err := httpClient.Get(srcURL)\n        if err != nil {\n            errChan &lt;- err\n            return\n        }\n        defer resp.Body.Close()\n\n        // create the file\n        outFile, err := os.Create(dstFilepath)\n        if err != nil {\n            errChan &lt;- err\n            return\n        }\n        defer outFile.Close()\n\n        log.Println(\"starting copy\")\n        // copy to file as the response arrives\n        _, err = io.Copy(outFile, resp.Body)\n\n        // return err\n        if err != nil {\n            log.Printf(\"\\n Download Copy Error: %s \\n\", err.Error())\n            errChan &lt;- err\n            return\n        }\n\n        doneChan &lt;- struct{}{}\n\n        return\n    }(httpClient, srcURL, dstFilepath, errChan, doneChan)\n\n    // return Download\n    return (&amp;Download{\n        updateFrequency: time.Microsecond * 500,\n        total:           size,\n        errRecieve:      errChan,\n        doneRecieve:     doneChan,\n        filepath:        dstFilepath,\n    }).Start(), nil\n}\n</code></pre>\n\n<p><strong>Update</strong>\nThanks to everyone who had input into this.</p>\n\n<p>I've accepted JimB's answer as it seems like a perfectly viable approach that is more generalised than the solution I chose (and probably more useful to anyone who finds their way here). </p>\n\n<p>In my case I already had a loop monitoring the file size so I threw a named error when this did not change for x seconds. It was much easier for me to pick up on the named error through my existing error handling and retry the download from there. </p>\n\n<p>I probably crash at least one goroutine in the background with my approach (I may fix this later with some signalling) but as this is a short running application (its an installer) so this is acceptable (at least tolerable)</p>\n"}, {"tags": ["string", "go"], "answers": [{"tags": [], "owner": {"reputation": 52, "user_id": 7190578, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-buN9tT-1Gk0/AAAAAAAAAAI/AAAAAAAADMI/Ak-c8euXTQQ/photo.jpg?sz=128", "display_name": "Juxhin Metaj", "link": "https://stackoverflow.com/users/7190578/juxhin-metaj"}, "is_accepted": false, "score": 0, "last_activity_date": 1508240824, "creation_date": 1508240824, "answer_id": 46789397, "question_id": 46789288, "link": "https://stackoverflow.com/questions/46789288/string-parse-to-int-in-go-language/46789397#46789397", "title": "String parse to int in go language", "body": "<p>Try it like this:</p>\n\n<pre><code>package main\nimport \"strconv\"\nimport \"fmt\"\n\nfunc main() {\ni, _ := strconv.ParseInt(#YOURSTRING#, 0, 64)\nfmt.Println(i)\n}\n</code></pre>\n\n<p>It should then parse it into an int</p>\n"}, {"tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 1, "last_activity_date": 1508243038, "creation_date": 1508243038, "answer_id": 46790079, "question_id": 46789288, "link": "https://stackoverflow.com/questions/46789288/string-parse-to-int-in-go-language/46790079#46790079", "title": "String parse to int in go language", "body": "<p>You may use:</p>\n\n<pre><code>i := strings.Index(st, \"=\")\n</code></pre>\n\n<p>then </p>\n\n<pre><code>n, err := fmt.Sscan(st[i+1:], &amp;d)\n</code></pre>\n\n<p>try <a href=\"https://play.golang.org/p/XVqNtKXLcG\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"strings\"\n)\n\nfunc main() {\n    st := \"en=10 , ab=15\"\n    i := strings.Index(st, \"=\")\n    if i != -1 {\n        var d int\n        n, err := fmt.Sscan(st[i+1:], &amp;d)\n        if err != nil || n != 1 {\n            log.Fatal(err)\n        }\n        fmt.Println(d)\n    }\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>10\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 230, "user_id": 551046, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SpLtY.jpg?s=128&g=1", "display_name": "ksinkar", "link": "https://stackoverflow.com/users/551046/ksinkar"}, "is_accepted": false, "score": 0, "last_activity_date": 1508247992, "creation_date": 1508247992, "answer_id": 46791752, "question_id": 46789288, "link": "https://stackoverflow.com/questions/46789288/string-parse-to-int-in-go-language/46791752#46791752", "title": "String parse to int in go language", "body": "<p>You should split the string and then convert it the individual components to int.</p>\n\n<pre><code>var splits = strings.Replace(\"en=10 , ab=15\", \",\", \"=\")\nsplits =  strings.split(splits, \"=\")\nfor var i := 0; i &lt; splits.Len(); i++ {\n  splits[i].toInt()\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 8433868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0adfe199f20a74cdf9ac130e03adb682?s=128&d=identicon&r=PG&f=1", "display_name": "Duygu G&#252;ndo\u011fdu", "link": "https://stackoverflow.com/users/8433868/duygu-g%c3%bcndo%c4%9fdu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "answer_count": 3, "score": -3, "last_activity_date": 1508247992, "creation_date": 1508240456, "question_id": 46789288, "link": "https://stackoverflow.com/questions/46789288/string-parse-to-int-in-go-language", "title": "String parse to int in go language", "body": "<p>I have a string like \"en=10 , ab=15\". I want to get 10 as an int from this. I cant cast the types it always returns ASCII codes. Should I convert it to map?</p>\n"}, {"tags": ["performance", "go", "hashmap", "switch-statement"], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1508240996, "post_id": 46789287, "comment_id": 80525097, "body": "@felix, \u2026but you could look at <a href=\"https://blog.golang.org/generate\" rel=\"nofollow noreferrer\">code generation</a> to generate swaths of <code>switch</code> branches automatically -- given certain data."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1508240456, "creation_date": 1508240456, "answer_id": 46789287, "question_id": 46789259, "link": "https://stackoverflow.com/questions/46789259/map-vs-switch-performance-in-go/46789287#46789287", "title": "map vs switch performance in go", "body": "<blockquote>\n  <p>Is there a way to get similar performance as switch x {} with dynamically generated map ?</p>\n</blockquote>\n\n<p>No. I'm sorry.</p>\n"}, {"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1508241070, "post_id": 46789443, "comment_id": 80525143, "body": "I&#39;d also mention <code>sort.Search</code> which is a generalized tool to search in sorted slices using binary search algorythm."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1508241409, "post_id": 46789443, "comment_id": 80525328, "body": "@kostix Yes, but using binary search on a sorted slice will most likely perform worse than a map lookup."}, {"owner": {"reputation": 7779, "user_id": 6858274, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/323d5de87d97a689b73a663375e079eb?s=128&d=identicon&r=PG&f=1", "display_name": "felix", "link": "https://stackoverflow.com/users/6858274/felix"}, "edited": false, "score": 0, "creation_date": 1508245321, "post_id": 46789443, "comment_id": 80527938, "body": "Just implemented it in my function and got a nice 30% speedup, thanks a lot !"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 12, "last_activity_date": 1508257761, "last_edit_date": 1508257761, "creation_date": 1508240975, "answer_id": 46789443, "question_id": 46789259, "link": "https://stackoverflow.com/questions/46789259/map-vs-switch-performance-in-go/46789443#46789443", "title": "map vs switch performance in go", "body": "<p>Not with a map, since <a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"noreferrer\">indexing</a> maps are evaluated at runtime, and getting an element from a map involves more operations than just a single (slice-)indexing. Certain <code>switch</code>es (with <code>case</code> branches having constant expressions) can / may be optimized even at compile-time.</p>\n\n<p>But map is not the only \"dynamic\" structure. For another one, there's <a href=\"https://golang.org/ref/spec#Slice_types\" rel=\"noreferrer\">slices</a>. Slices can be indexed, just like maps.</p>\n\n<p>Yes, a slice is a descriptor for a <em>contiguous segment</em> of an underlying array. Which means if you have an index like <code>1000</code>, the slice needs to have at least <code>1000+1 = 1001</code> elements.</p>\n\n<p>So if you're willing to sacrifice some memory for the sake of performance and use a slice instead of a map, <em>you can even make your solution faster than the one using the <code>switch</code> statement</em>:</p>\n\n<pre><code>var sliceCode = []int32{\n    0:    1,\n    10:   2,\n    100:  3,\n    1000: 4,\n}\n\nfunc BenchmarkSlice(b *testing.B) {\n    success := int32(0)\n    fail := int32(0)\n    for n := 0; n &lt; b.N; n++ {\n        // for each value in code array, do a specific action\n        for _, v := range code {\n            c := sliceCode[v]\n            if c == 0 {\n                fail++\n            } else {\n                success += c\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>And the benchmark results:</p>\n\n<pre><code>BenchmarkMap-4          10000000               148 ns/op\nBenchmarkSlice-4        100000000               17.6 ns/op\nBenchmarkSwitch-4       50000000                31.0 ns/op\n</code></pre>\n\n<p>The slice solution in this concrete example <strong>outperforms the <code>switch</code> solution by being twice as fast!</strong></p>\n\n<p><strong>Notes:</strong></p>\n\n<p>I mentioned above that if you have an index like <code>1000</code>, you need at least <code>1001</code> elements. This is partly true. For example if you'd have indices like <code>990..1000</code>, you could have a simple index transformation logic like <code>index - 990</code>, and then a slice with just 11 elements would be perfectly enough.</p>\n\n<p>Also note that while indexing a map using the comma-ok idiom we were able to tell if the element was in the map. With slices we don't have that option. So we have to designate a value from the valid set of the element type, and use that as the \"missing\" signal. In the above example, <code>0</code> was perfect for us as that wasn't used (and all elements not explicitly listed are set to <code>0</code> by default). If in your example all valid <code>int32</code> values could be used, another option would be to use a wrapper or pointer type as the element type of the slice which could have a <code>nil</code> value, indicating that the element for the index is missing.</p>\n"}], "owner": {"reputation": 7779, "user_id": 6858274, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/323d5de87d97a689b73a663375e079eb?s=128&d=identicon&r=PG&f=1", "display_name": "felix", "link": "https://stackoverflow.com/users/6858274/felix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3666, "favorite_count": 1, "accepted_answer_id": 46789443, "answer_count": 2, "score": 5, "last_activity_date": 1508257761, "creation_date": 1508240358, "question_id": 46789259, "link": "https://stackoverflow.com/questions/46789259/map-vs-switch-performance-in-go", "title": "map vs switch performance in go", "body": "<p>Consider this benchmark, where we compare map access vs switch </p>\n\n<pre><code>var code = []int32{0, 10, 100, 100, 0, 10, 0, 10, 100, 14, 1000, 100, 1000, 0, 0, 10, 100, 1000, 10, 0, 1000, 12}\nvar mapCode = map[int32]int32{\n    0:    1,\n    10:   2,\n    100:  3,\n    1000: 4,\n}\n\nfunc BenchmarkMap(b *testing.B) {\n    success := int32(0)\n    fail := int32(0)\n    for n := 0; n &lt; b.N; n++ {\n        // for each value in code array, do a specific action\n        for _, v := range code {\n            c, ok := mapCode[v]\n            if !ok {\n                fail++\n            } else {\n                success += c\n            }\n        }\n    }\n}\n\nfunc BenchmarkSwitch(b *testing.B) {\n    success := int32(0)\n    fail := int32(0)\n    for n := 0; n &lt; b.N; n++ {\n        // for each value in code array, do a specific action\n        for _, v := range code {\n            switch v {\n            case 0:\n                success++\n            case 10:\n                success += 2\n            case 100:\n                success += 3\n            case 1000:\n                success += 4\n            default:\n                fail++\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>Here is the results: </p>\n\n<pre><code>BenchmarkMap-2           5000000           277 ns/op           0 B/op          0 allocs/op\nBenchmarkSwitch-2       30000000            48.2 ns/op         0 B/op          0 allocs/op\n</code></pre>\n\n<p>So using map seems to be way slower than switch. </p>\n\n<p>I'm currently trying to optimize a function using a code similar to <code>BenchmarkMap()</code>, where the map access \nis the bottleneck, but I can't use switch as the map is dynamically generated when the program start (ie it\nmay change according to input arguments)</p>\n\n<p>Is there a way to get similar performance as <code>switch x {}</code> with dynamically generated map ? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1508236212, "post_id": 46787923, "comment_id": 80522121, "body": "This &quot;Transfer-Encoding: chunked&quot; is the reason. Chunked responses actually <i>do</i> (in fact must) have these &quot;1f43&quot; lengths. So: do not make chunked responses e.g. by setting the Content-Length (see <a href=\"https://golang.org/pkg/net/http/#Request.Write\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#Request.Write</a>)."}, {"owner": {"reputation": 4302, "user_id": 151007, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/72ee7b478a235f646c3495f03ebbe676?s=128&d=identicon&r=PG", "display_name": "Andy Stewart", "link": "https://stackoverflow.com/users/151007/andy-stewart"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1508236790, "post_id": 46787923, "comment_id": 80522438, "body": "Aha, ok.  With that info, I found where this happens: in the <code>Write()</code> function of <code>net&#47;http&#47;internal&#47;chunked</code> <a href=\"https://golang.org/src/net/http/internal/chunked.go\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 4302, "user_id": 151007, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/72ee7b478a235f646c3495f03ebbe676?s=128&d=identicon&r=PG", "display_name": "Andy Stewart", "link": "https://stackoverflow.com/users/151007/andy-stewart"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1508237076, "post_id": 46787923, "comment_id": 80522602, "body": "I&#39;m not generating the responses; I&#39;m sending requests and trying to print the dechunked response I get back."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1508238678, "post_id": 46787923, "comment_id": 80523581, "body": "Well, then keep it chunked because that <i>is</i> the response. Or read the whole body, replace Transfer-Encoding with Content-Length and resupply the body before DumpRespons&#39;ing."}, {"owner": {"reputation": 4302, "user_id": 151007, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/72ee7b478a235f646c3495f03ebbe676?s=128&d=identicon&r=PG", "display_name": "Andy Stewart", "link": "https://stackoverflow.com/users/151007/andy-stewart"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1508244600, "post_id": 46787923, "comment_id": 80527421, "body": "Makes sense, thank you.  If you want to make that an answer I&#39;ll happily accept it."}], "answers": [{"comments": [{"owner": {"reputation": 4302, "user_id": 151007, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/72ee7b478a235f646c3495f03ebbe676?s=128&d=identicon&r=PG", "display_name": "Andy Stewart", "link": "https://stackoverflow.com/users/151007/andy-stewart"}, "edited": false, "score": 0, "creation_date": 1508401880, "post_id": 46818039, "comment_id": 80598873, "body": "Thank you.  I just realised I never actually stated that I wanted the response&#39;s headers too (which was why I was using <code>dumpResponse()</code>) \u2013 but your answer answers the question I asked."}, {"owner": {"reputation": 4302, "user_id": 151007, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/72ee7b478a235f646c3495f03ebbe676?s=128&d=identicon&r=PG", "display_name": "Andy Stewart", "link": "https://stackoverflow.com/users/151007/andy-stewart"}, "edited": false, "score": 1, "creation_date": 1508401955, "post_id": 46818039, "comment_id": 80598910, "body": "I couldn&#39;t see a built-in method to write the headers so I write them out myself, e.g. <code>fmt.Print(resp.Proto + &quot; &quot; + resp.Status + &quot;\\r\\n&quot;)</code>."}], "tags": [], "owner": {"reputation": 68, "user_id": 2523445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/777feee25b093edf7a0b381151ceac44?s=128&d=identicon&r=PG", "display_name": "gritt", "link": "https://stackoverflow.com/users/2523445/gritt"}, "is_accepted": true, "score": 2, "last_activity_date": 1508355902, "creation_date": 1508355902, "answer_id": 46818039, "question_id": 46787923, "link": "https://stackoverflow.com/questions/46787923/how-to-write-an-http-response-to-stdout/46818039#46818039", "title": "How to write an HTTP response to stdout?", "body": "<p>You can use interfaces for that,</p>\n\n<p>The http.Get call returns a pointer to a Response type, which contains a Body, if you check Body interfaces, you can see that the Body implements the io.ReadCloser, which, implements both the Reader and Closer interfaces;</p>\n\n<p>By understanding these interfaces you  can make use of eg: io.Copy</p>\n\n<pre><code>func Copy(dst Writer, src Reader) (written int64, err error) {...}\n</code></pre>\n\n<p>As second argument, you could pass the Response Body, which implements the Reader.</p>\n\n<p>As first argument, Writer, you could both implement your own custom type, and create a func to implement the Writer interface, or, you can also use the built in os.Stdout, which already implements it.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"net/http\"\n    \"os\"\n)\n\nfunc main() {\n\n    resp, err := http.Get(\"http://google.com\")\n\n    if err != nil {\n        fmt.Println(\"Error:\", err)\n        os.Exit(1)\n    }\n\n    io.Copy(os.Stdout, resp.Body)\n}\n</code></pre>\n"}], "owner": {"reputation": 4302, "user_id": 151007, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/72ee7b478a235f646c3495f03ebbe676?s=128&d=identicon&r=PG", "display_name": "Andy Stewart", "link": "https://stackoverflow.com/users/151007/andy-stewart"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1655, "favorite_count": 0, "accepted_answer_id": 46818039, "answer_count": 1, "score": 0, "last_activity_date": 1508399738, "creation_date": 1508235892, "last_edit_date": 1508399738, "question_id": 46787923, "link": "https://stackoverflow.com/questions/46787923/how-to-write-an-http-response-to-stdout", "title": "How to write an HTTP response to stdout?", "body": "<p>I am trying to write to stdout the raw HTTP response received from a GET request.  I thought <code>httputil.DumpResponse</code> would do what I want but it seems to include mysterious byte counts on \"bigger\" responses.</p>\n\n<p>For example:</p>\n\n<pre><code>HTTP/1.1 200 OK\nTransfer-Encoding: chunked\nContent-Type: text/plain; charset=utf-8\nDate: Mon, 16 Oct 2017 15:07:53 GMT\n\n1f43\nTHE ACTUAL BODY CONTENT WHICH IS 8003 BYTES\n0\n</code></pre>\n\n<p>The <code>1f43</code> seems to be the length of the response body.  Go's <code>http.response</code> talks about trailers, so maybe the <code>0</code> is the size of the trailer.</p>\n\n<p>My code is:</p>\n\n<pre><code>    var resp *http.Response\n    var err error\n\n    if *isPost {\n        resp, err = http.Post(url, \"application/x-www-form-urlencoded\", strings.NewReader(*data))\n    } else {\n        resp, err = http.Get(url)\n    }\n\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer resp.Body.Close()\n\n    dump, err := httputil.DumpResponse(resp, true)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Printf(\"%s\", dump)\n</code></pre>\n\n<p>I have read the code for <code>DumpResponse</code> and <code>TransferWriter</code> but I can't figure out where the <code>1f43</code> and <code>0</code> come from.</p>\n\n<p>If I make the same request with curl, I don't get the <code>1f43</code> and <code>0</code> in the response.</p>\n\n<p>Is this the best way to write the raw HTTP response?  If so, how can I fix it to avoid these byte counts?</p>\n"}, {"tags": ["linux", "go", "path", "mocking"], "comments": [{"owner": {"reputation": 1455, "user_id": 465147, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/e824e3adb5aa777566fa8e53f89bebbe?s=128&d=identicon&r=PG", "display_name": "sprabhakaran", "link": "https://stackoverflow.com/users/465147/sprabhakaran"}, "edited": false, "score": 3, "creation_date": 1508234353, "post_id": 46787354, "comment_id": 80521032, "body": "set your path like this - export PATH=$PATH:/home/[...]/go/bin. do verify that the moq execute file exists in /go/bin directory. If not exist, go to the src/github.com/matryer/moq and compile the src."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1455, "user_id": 465147, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/e824e3adb5aa777566fa8e53f89bebbe?s=128&d=identicon&r=PG", "display_name": "sprabhakaran", "link": "https://stackoverflow.com/users/465147/sprabhakaran"}, "edited": false, "score": 1, "creation_date": 1508237583, "post_id": 46787354, "comment_id": 80522893, "body": "What @sprabhakaran said. But make sure you&#39;ve used <code>go install</code>, not <code>go build</code>. That is, do <code>go install github.com&#47;matryer&#47;moq</code>"}, {"owner": {"reputation": 135, "user_id": 5419282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4VjE8.jpg?s=128&g=1", "display_name": "Racater", "link": "https://stackoverflow.com/users/5419282/racater"}, "edited": false, "score": 0, "creation_date": 1508251859, "post_id": 46787354, "comment_id": 80532676, "body": "I also needed to add <code>export GOPATH=$HOME&#47;go</code> to make the script work. Source : <a href=\"https://github.com/matryer/moq/issues/29\" rel=\"nofollow noreferrer\">github.com/matryer/moq/issues/29</a>"}, {"owner": {"reputation": 135, "user_id": 5419282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4VjE8.jpg?s=128&g=1", "display_name": "Racater", "link": "https://stackoverflow.com/users/5419282/racater"}, "reply_to_user": {"reputation": 1455, "user_id": 465147, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/e824e3adb5aa777566fa8e53f89bebbe?s=128&d=identicon&r=PG", "display_name": "sprabhakaran", "link": "https://stackoverflow.com/users/465147/sprabhakaran"}, "edited": false, "score": 0, "creation_date": 1508252035, "post_id": 46787354, "comment_id": 80532836, "body": "@sprabhakaran, Could you please post your comment as an answer so I can accept it? :)"}], "answers": [{"comments": [{"owner": {"reputation": 3596, "user_id": 2443687, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/1da01ca60576663e27ab608fc4dbbbb2?s=128&d=identicon&r=PG", "display_name": "Carlos Martinez", "link": "https://stackoverflow.com/users/2443687/carlos-martinez"}, "edited": false, "score": 0, "creation_date": 1559601947, "post_id": 46838941, "comment_id": 99465020, "body": "What if you&#39;re using go modules?"}], "tags": [], "owner": {"reputation": 135, "user_id": 5419282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4VjE8.jpg?s=128&g=1", "display_name": "Racater", "link": "https://stackoverflow.com/users/5419282/racater"}, "is_accepted": true, "score": 0, "last_activity_date": 1508447394, "creation_date": 1508447394, "answer_id": 46838941, "question_id": 46787354, "link": "https://stackoverflow.com/questions/46787354/go-moq-running-moq-exec-moq-executable-file-not-found-in-path/46838941#46838941", "title": "Go moq : running &quot;moq&quot;: exec: &quot;moq&quot;: executable file not found in $PATH", "body": "<p>@sprabhakaran got the right answer. I only needed to add the go binary folder to the PATH global variable:</p>\n\n<blockquote>\n  <p>export PATH=$PATH:/home/[...]/go/bin</p>\n</blockquote>\n\n<p>and if it doesn't work, check that moq was correctly installed.</p>\n"}], "owner": {"reputation": 135, "user_id": 5419282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4VjE8.jpg?s=128&g=1", "display_name": "Racater", "link": "https://stackoverflow.com/users/5419282/racater"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 636, "favorite_count": 0, "accepted_answer_id": 46838941, "answer_count": 1, "score": 0, "last_activity_date": 1508447394, "creation_date": 1508234024, "last_edit_date": 1508237490, "question_id": 46787354, "link": "https://stackoverflow.com/questions/46787354/go-moq-running-moq-exec-moq-executable-file-not-found-in-path", "title": "Go moq : running &quot;moq&quot;: exec: &quot;moq&quot;: executable file not found in $PATH", "body": "<p>when trying the example of the moq framework, I get the following exception when I enter \"go generate\":</p>\n\n<blockquote>\n  <p>example.go:5: running \"moq\": exec: \"moq\": executable file not found in $PATH</p>\n</blockquote>\n\n<p>What should I do? I'm using Kubuntu 16.04</p>\n\n<p>PS: I tried</p>\n\n<blockquote>\n  <p>export PATH=$PATH:/home/[...]/go/src/github.com/matryer/moq</p>\n</blockquote>\n\n<p>without success</p>\n"}, {"tags": ["go", "locking"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1508234018, "post_id": 46786900, "comment_id": 80520843, "body": "rw.readerCount &lt;= rwmutexMaxReaders, so rw.readerCount-rwmutexMaxReaders makes readerCount 0 or negativ (the signal). Adding back rwmutxMaxReaders makes r equal the real number of readerWait."}], "answers": [{"tags": [], "owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "is_accepted": false, "score": 0, "last_activity_date": 1508234175, "creation_date": 1508234175, "answer_id": 46787402, "question_id": 46786900, "link": "https://stackoverflow.com/questions/46786900/the-implementions-of-rwmutex-lock-in-golang/46787402#46787402", "title": "The implementions of RWMutex.Lock() in golang", "body": "<p>Do you like magic? This is that ;o) No .. I'm just kidding.</p>\n\n<p>We could start with</p>\n\n<pre><code>atomic.AddInt32(&amp;rw.readerCount, -rwmutexMaxReaders)\n</code></pre>\n\n<p>This atomically substract rwmutexMaxReaders from rw.readerCount. New value is stored into rw.readerCount and also returned by function. And when you will add rwmutexMaxReaders you just compute old value rw.readerCount before AddInt32.</p>\n"}, {"tags": [], "owner": {"reputation": 240, "user_id": 8800369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4f69be8fda374dc3075128df3a05f37?s=128&d=identicon&r=PG", "display_name": "Hein Oldewage", "link": "https://stackoverflow.com/users/8800369/hein-oldewage"}, "is_accepted": false, "score": 0, "last_activity_date": 1508499845, "creation_date": 1508499845, "answer_id": 46848391, "question_id": 46786900, "link": "https://stackoverflow.com/questions/46786900/the-implementions-of-rwmutex-lock-in-golang/46848391#46848391", "title": "The implementions of RWMutex.Lock() in golang", "body": "<p>On a RWMutex a writer calling Lock prevents more readers from acquiring the RLock. This is done to prevent <a href=\"https://en.wikipedia.org/wiki/Starvation_(computer_science)\" rel=\"nofollow noreferrer\">starvation</a> of writers. </p>\n\n<p>Suppose the following scenario: </p>\n\n<ol>\n<li><p>Suppose a reader has acquired the read lock, then <code>rw.readerCount</code> will be 1. </p></li>\n<li><p>A writer then tries to acquire the write lock. After acquiring the write lock (<a href=\"https://golang.org/src/sync/rwmutex.go#L93\" rel=\"nofollow noreferrer\">line 93</a>) it now has to signal all the readers that a writer is waiting (so they can't continue) and wait for all the readers to finish. The signal is set by setting <code>rw.readerCount</code> to a negative value (<code>atomic.AddInt32(&amp;rw.readerCount, -rwmutexMaxReaders)</code>). The value of <code>rw.readerCount</code> is now <code>1-rwmutexMaxReaders</code>. Note that <code>r</code> is not 0, so the writer knows there is a reader still reading. </p></li>\n<li><p>A new Reader now wants to acquire the read lock, it adds 1 to <code>rw.readerCount</code> (line 48) and checks if it is negative. If it is negative a writer has set it as such, and we should wait for the writer to finish before continuing.</p></li>\n</ol>\n\n<p>The signaling happens around the sign of <code>rw.readerCount</code>.</p>\n"}], "owner": {"reputation": 1786, "user_id": 2349712, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f015778f8286b4c72c11fa7be5c974a?s=128&d=identicon&r=PG", "display_name": "fibonacci", "link": "https://stackoverflow.com/users/2349712/fibonacci"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 511, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1508499845, "creation_date": 1508232551, "last_edit_date": 1508233012, "question_id": 46786900, "link": "https://stackoverflow.com/questions/46786900/the-implementions-of-rwmutex-lock-in-golang", "title": "The implementions of RWMutex.Lock() in golang", "body": "<p>in <a href=\"https://golang.org/src/sync/rwmutex.go\" rel=\"nofollow noreferrer\">src/sync/rwmutex.go</a> file, we can see the definition of \"Lock\" as follows:</p>\n\n<pre><code>func (rw *RWMutex) Lock() {\n    if race.Enabled {\n        _ = rw.w.state\n        race.Disable()\n    }\n    // First, resolve competition with other writers.\n    rw.w.Lock()\n    // Announce to readers there is a pending writer.\n    r := atomic.AddInt32(&amp;rw.readerCount, -rwmutexMaxReaders) + rwmutexMaxReaders\n    // Wait for active readers.\n    if r != 0 &amp;&amp; atomic.AddInt32(&amp;rw.readerWait, r) != 0 {\n        runtime_Semacquire(&amp;rw.writerSem)\n    }\n    if race.Enabled {\n        race.Enable()\n        race.Acquire(unsafe.Pointer(&amp;rw.readerSem))\n        race.Acquire(unsafe.Pointer(&amp;rw.writerSem))\n    }\n}\n</code></pre>\n\n<p>So I really wonder what</p>\n\n<pre><code>atomic.AddInt32(&amp;rw.readerCount, -rwmutexMaxReaders) + rwmutexMaxReaders\n</code></pre>\n\n<p>this sentence means. And as it says, how to <strong>announce to readers</strong>? How to understand it?</p>\n"}, {"tags": ["jquery", "mongodb", "file", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "edited": false, "score": 0, "creation_date": 1508263710, "post_id": 46785439, "comment_id": 80539722, "body": "Hello @icza, it worked! One more question: Now I get byte data in struct object, next step is to convert this data in to pdf file and allow user to download it via web browser. Can you help with that?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "edited": false, "score": 0, "creation_date": 1508265379, "post_id": 46785439, "comment_id": 80540663, "body": "@NikhilJoshi For start check out this question: <a href=\"https://stackoverflow.com/questions/41238407/pdf-download-is-not-working-from-serverside-in-golang\">PDF download is not working from serverside in golang</a>."}, {"owner": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "edited": false, "score": 0, "creation_date": 1508312065, "post_id": 46785439, "comment_id": 80556766, "body": "Hello @icza, I tried but it doesn&#39;t work completely. Please see UPDATE in the original post."}, {"owner": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "edited": false, "score": 0, "creation_date": 1508501459, "post_id": 46785439, "comment_id": 80644877, "body": "There was typo, it is Pdfdata only, please see edited update portion. Am I missing anything?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "edited": false, "score": 0, "creation_date": 1508504483, "post_id": 46785439, "comment_id": 80646527, "body": "@NikhilJoshi Please read my answer carefully. MongoDB will use a field named <code>&quot;pdfdata&quot;</code>, with <b>lowercase letter</b>, yet you project with <code>&quot;Pdfdata&quot;</code> with uppercase."}, {"owner": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "edited": false, "score": 0, "creation_date": 1508504905, "post_id": 46785439, "comment_id": 80646779, "body": "Typo again, a debug shows that I am getting pdf data in bytes."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "edited": false, "score": 0, "creation_date": 1508505058, "post_id": 46785439, "comment_id": 80646866, "body": "@NikhilJoshi Now you project the <code>&quot;pdf&quot;</code> field again. I wrote in my answer that without <code>bson</code> tag value on <code>dbSchool.Pdfdata</code>, the default field nam will be <code>&quot;pdfdata&quot;</code>. The <code>json</code> tag value is unrelated to <code>mgo</code>. Please, please read my answer."}, {"owner": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "edited": false, "score": 0, "creation_date": 1508532716, "post_id": 46785439, "comment_id": 80661918, "body": "I edited my earlier update, used &quot;Pdf&quot; instead of &quot;Pdfdata&quot; everywhere. I also read that AJAX can&#39;t convert bytes to PDF file, hence I just tried opening a new window. Everything is working as expected now!! Thanks a ton!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1508420634, "last_edit_date": 1508420634, "creation_date": 1508227818, "answer_id": 46785439, "question_id": 46784873, "link": "https://stackoverflow.com/questions/46784873/saving-pdf-in-mongodb-using-golang-mgo/46785439#46785439", "title": "Saving pdf in MongoDb using GoLang mgo", "body": "<p>The <code>file</code> returned by <a href=\"https://golang.org/pkg/net/http/#Request.FormFile\" rel=\"nofollow noreferrer\"><code>Request.FormFile()</code></a> is of type <a href=\"https://golang.org/pkg/mime/multipart/#File\" rel=\"nofollow noreferrer\"><code>multipart.File</code></a> which is:</p>\n\n<pre><code>type File interface {\n    io.Reader\n    io.ReaderAt\n    io.Seeker\n    io.Closer\n}\n</code></pre>\n\n<p>It implements <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\"><code>io.Reader</code></a>, so you can simply read its content e.g. with <a href=\"https://golang.org/pkg/io/ioutil/#ReadAll\" rel=\"nofollow noreferrer\"><code>ioutil.ReadAll()</code></a>:</p>\n\n<pre><code>data, err := io.ReadAll(file)\n// Handle error\n</code></pre>\n\n<p>Then:</p>\n\n<pre><code>dbSchoolPojo.Pdfdata = data\n</code></pre>\n\n<p>But storing big files as part of documents is not optimal / efficient. Instead take a look at the <a href=\"https://docs.mongodb.com/manual/core/gridfs/\" rel=\"nofollow noreferrer\">MongoDB GridFS</a> that is also supported by <code>mgo</code>: <a href=\"https://godoc.org/gopkg.in/mgo.v2#Database.GridFS\" rel=\"nofollow noreferrer\"><code>Database.GridFS()</code></a>.</p>\n\n<p>Here's how you can store a file in MongoDB GridFS (example taken from <a href=\"https://godoc.org/gopkg.in/mgo.v2#GridFS.Create\" rel=\"nofollow noreferrer\"><code>GridFS.Create()</code></a>):</p>\n\n<pre><code>func check(err error) {\n    if err != nil {\n        panic(err.String())\n    }\n}\nfile, err := db.GridFS(\"fs\").Create(\"myfile.txt\")\ncheck(err)\nn, err := file.Write([]byte(\"Hello world!\"))\ncheck(err)\nerr = file.Close()\ncheck(err)\nfmt.Printf(\"%d bytes written\\n\", n)\n</code></pre>\n\n<p>Using <code>GridFS</code>, you can also save the file without having to read all its content into memory first, if you \"stream\" the file content into the <a href=\"https://godoc.org/gopkg.in/mgo.v2#GridFile\" rel=\"nofollow noreferrer\"><code>mgo.GridFile</code></a>, as it implements <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"nofollow noreferrer\"><code>io.Writer</code></a>. Call <a href=\"https://golang.org/pkg/io/#Copy\" rel=\"nofollow noreferrer\"><code>io.Copy()</code></a>:</p>\n\n<pre><code>// ...\nfile, handler, err := r.FormFile(\"pdfFile\")\n\n// ...\nmongoFile, err := db.GridFS(\"fs\").Create(\"somepdf.pdf\")\ncheck(err)\n\n// Now stream from HTTP request into the mongo file:\nwritten, err := io.Copy(mongoFile, file)\n// Handle err\n\nerr = mongoFile.Close()\ncheck(err)\n</code></pre>\n\n<p><strong>Edit: update answering your update</strong></p>\n\n<p>When you serve the PDF, you query the document in a wrong way:</p>\n\n<pre><code>err := coll.Find(bson.M{\"_id\": bson.ObjectIdHex(incomingId)}).\n    Select(bson.M{\"pdf\": 1}).One(&amp;school)\n</code></pre>\n\n<p>You select the <code>pdf</code> field to retrieve, but your documents in MongoDB have no such field:</p>\n\n<pre><code>type dbSchool struct {\n    ID  bson.ObjectId  `json:\"id\" bson:\"_id,omitempty\"`\n    ...\n    Pdfdata  []byte  `json:\"pdf\"`\n    ...\n}\n</code></pre>\n\n<p>This type definition will result having a <code>pdfdata</code> field, but not <code>pdf</code>. Add the proper <code>mgo</code> struct tag:</p>\n\n<pre><code>type dbSchool struct {\n    ID  bson.ObjectId  `json:\"id\" bson:\"_id,omitempty\"`\n    ...\n    Pdfdata  []byte  `json:\"pdf\" bson:\"pdf\"`\n    ...\n}\n</code></pre>\n\n<p>Or change the selected field from <code>pdf</code> to <code>pdfdata</code>.</p>\n"}], "owner": {"reputation": 801, "user_id": 1954034, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/5VjQT.png?s=128&g=1", "display_name": "Nikhil Joshi", "link": "https://stackoverflow.com/users/1954034/nikhil-joshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1346, "favorite_count": 0, "accepted_answer_id": 46785439, "answer_count": 1, "score": 1, "last_activity_date": 1508520331, "creation_date": 1508225792, "last_edit_date": 1508520331, "question_id": 46784873, "link": "https://stackoverflow.com/questions/46784873/saving-pdf-in-mongodb-using-golang-mgo", "title": "Saving pdf in MongoDb using GoLang mgo", "body": "<p>I read multiple blogs about saving the file using mgo, but unable to find a solution for below specific need, help shoutout!</p>\n\n<p>Below inserts object in MongoDb:</p>\n\n<pre><code>var dbSchoolPojo dbSchool\ni := bson.NewObjectId()\ndbSchoolPojo.ID = i\ncoll := db.C(\"school\")\ncoll.Insert(&amp;dbSchoolPojo)\n</code></pre>\n\n<p>Below able to get hold of file:</p>\n\n<pre><code>file, handler, err := r.FormFile(\"pdf\") //Able to get file from r *http.Request\n</code></pre>\n\n<p>Now, before inserting object, I need to set above file like:</p>\n\n<pre><code>dbSchoolPojo.pdf = file.Bytes(); //Of course Bytes() is invalid method\n</code></pre>\n\n<p>My structs object:</p>\n\n<pre><code>type dbSchool struct {\n    ID  bson.ObjectId  `json:\"id\" bson:\"_id,omitempty\"`\n    ...\n    Pdf  []byte  `json:\"pdf\" bson:\"pdf\"`\n    ...\n}\n</code></pre>\n\n<p>In layman's term, the question is: How do I insert file (received from HTML form) in mongoDb via GoLang struct using mgo driver?</p>\n\n<p>Thanks for reading! :)</p>\n\n<hr>\n\n<blockquote>\n  <p>Update:</p>\n</blockquote>\n\n<p>PDF is stored in MongoDB like below:</p>\n\n<pre><code>Binary('EWHKDSH876KJHlkjdswsddsfsd3232432njnjkn2dljDSFSDFIJSFD333...')\n</code></pre>\n\n<p>Below code works without error, but doesn't serve PDF file:</p>\n\n<pre><code>func DownloadPdf(w http.ResponseWriter, r *http.Request, db mongoDB) {\n    var school dbSchool\n    coll := db.C(\"schools\")\n\n    incomingId = \"59e6404e2f68182a74610f19\"; //This mongo DB _id is received from GET URL request\n\n    err := coll.Find(bson.M{\"_id\": bson.ObjectIdHex(incomingId)}).\n        Select(bson.M{\"pdf\": 1}).One(&amp;school)\n    if err != nil {\n        serve404(w, r, db)\n        return\n    }\n\n    buffer := school.Pdf\n    w.Header().Set(\"Content-Disposition\", \"attachment; filename=abc.pdf\")\n    w.Header().Set(\"Content-Type\", \"application/pdf\")\n    w.Header().Set(\"Content-Length\", strconv.Itoa(len(buffer)))\n\n    if _, err := w.Write(buffer); err != nil {\n        log.Println(\"unable to serve image.\") //This line is not executed\n    }\n}\n</code></pre>\n\n<p>JQuery code to request content:</p>\n\n<pre><code>      $(\".downloadPdfFile\").click(function() {\n            var domain = document.location.origin;\n            window.open(domain+'/brochure/59e6404e2f68182a74610f19', '_blank');\n         });\n</code></pre>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1508227451, "post_id": 46784857, "comment_id": 80516892, "body": "&quot;Does this make sense to do this?&quot; Yes. &quot;Is that considered a bad practice?&quot; No,why should it?"}, {"owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "edited": false, "score": 1, "creation_date": 1508234571, "post_id": 46784857, "comment_id": 80521169, "body": "It perfectly make sense. When myType implements an interface, I don&#39;t want to publish internal representation, but want to publish, that it has member Name."}], "answers": [{"comments": [{"owner": {"reputation": 10642, "user_id": 1251684, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/iX2Jq.png?s=128&g=1", "display_name": "BentCoder", "link": "https://stackoverflow.com/users/1251684/bentcoder"}, "edited": false, "score": 0, "creation_date": 1566117757, "post_id": 46786355, "comment_id": 101549397, "body": "Regarding to your comment starting by <code>...or if you don&#39;t want to do that, then create an exported interface and the exported function should ...</code> there are suggestions &#39;<a href=\"https://medium.com/@cep21/preemptive-interface-anti-pattern-in-go-54c18ac0668a\" rel=\"nofollow noreferrer\">1</a> and <a href=\"https://github.com/spy16/droplets/blob/master/docs/interfaces.md\" rel=\"nofollow noreferrer\">2</a>&#39; that it is considered as &quot;bad&quot; practise. What is your input on that? I actually like them but since I am a learner I cannot judge either way with limited knowledge."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 10642, "user_id": 1251684, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/iX2Jq.png?s=128&g=1", "display_name": "BentCoder", "link": "https://stackoverflow.com/users/1251684/bentcoder"}, "edited": false, "score": 0, "creation_date": 1566375021, "post_id": 46786355, "comment_id": 101631920, "body": "@BentCoder I agree with those. Better to return an exported struct, the interface was if you can&#39;t or don&#39;t want to export the struct."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 12, "last_activity_date": 1566375039, "last_edit_date": 1566375039, "creation_date": 1508230930, "answer_id": 46786355, "question_id": 46784857, "link": "https://stackoverflow.com/questions/46784857/exported-field-in-unexported-struct/46786355#46786355", "title": "exported field in unexported struct", "body": "<p>It is perfectly valid to have unexported structs with exported fields. If the type is declared in another package, the declaration <code>var MyArray []myType</code> would be a compile-time error.</p>\n\n<p>While it is perfectly valid to have an exported function with an unexported return type, it is usually annoying to use. The golint tool also gives a warning for such cases:</p>\n\n<blockquote>\n  <p>exported func XXX returns unexported type pname.tname, which can be annoying to use</p>\n</blockquote>\n\n<p>In such cases it's better to also export the type; or if you can't or don't want to do that, then create an exported interface and the exported function should have a return type of that interface, and so the implementing type may remain unexported. Since interfaces cannot have fields (only methods), this may require you to add some getter methods.</p>\n\n<p>Also note that in some cases this is exactly what you want: unexported struct with exported fields. Sometimes you want to pass the struct value to some other package for processing, and in order for the other package to be able to access the fields, they must be exported (but not the struct type itself).</p>\n\n<p>Good example is when you want to generate a JSON response. You may create an unexported struct, and to be able to use the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\"><code>encoding/json</code></a> package, the fields must be exported. For example:</p>\n\n<pre><code>type response struct {\n    Success bool   `json:\"success\"`\n    Message string `json:\"message\"`\n    Data    string `json:\"data\"`\n}\n\nfunc myHandler(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json;charset=UTF-8\")\n    resp := &amp;response{\n        Success: true,\n        Message: \"OK\",\n        Data:    \"some data\",\n    }\n    if err := json.NewEncoder(w).Encode(resp); err != nil {\n        // Handle err\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1354, "user_id": 6412942, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/c8302ba86cf28126f773c6f40573c175?s=128&d=identicon&r=PG&f=1", "display_name": "leopoodle", "link": "https://stackoverflow.com/users/6412942/leopoodle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6542, "favorite_count": 0, "accepted_answer_id": 46786355, "answer_count": 1, "score": 6, "last_activity_date": 1566375039, "creation_date": 1508225757, "last_edit_date": 1558990748, "question_id": 46784857, "link": "https://stackoverflow.com/questions/46784857/exported-field-in-unexported-struct", "title": "exported field in unexported struct", "body": "<p>Example:</p>\n\n<pre><code>type myType struct {\n    foo    []float64\n    Name   string\n}\n</code></pre>\n\n<p><code>myType</code> is not exported, but <code>Name</code> field in it is exported.</p>\n\n<p>Does this make sense to do this? Is that considered a bad practice?</p>\n\n<p>I have something like this, and it compiles fine.\nI can access the <code>Name</code> field if I create an exported array of <code>myType</code>:</p>\n\n<pre><code>var MyArray []myType = {... some initialization }\n\nfmt.Println(MyArray[0].Name) // Name is visible and it compiles\n</code></pre>\n"}, {"tags": ["go", "type-conversion"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 23, "last_activity_date": 1508224450, "last_edit_date": 1508224450, "creation_date": 1508220020, "answer_id": 46783431, "question_id": 46783352, "link": "https://stackoverflow.com/questions/46783352/string-to-big-int-in-go/46783431#46783431", "title": "string to big Int in Go?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/math/big/\" rel=\"noreferrer\">Package big</a></p>\n  \n  <p><code>import \"math/big\"</code></p>\n  \n  <p><a href=\"https://golang.org/pkg/math/big/#Int.SetString\" rel=\"noreferrer\">func (*Int) SetString</a></p>\n  \n  <p><code>func (z *Int) SetString(s string, base int) (*Int, bool)</code></p>\n  \n  <p>SetString sets z to the value of s, interpreted in the given base, and\n  returns z and a boolean indicating success. The entire string (not\n  just a prefix) must be valid for success. If SetString fails, the\n  value of z is undefined but the returned value is nil.</p>\n  \n  <p>The base argument must be 0 or a value between 2 and MaxBase. If the\n  base is 0, the string prefix determines the actual conversion base. A\n  prefix of \u201c0x\u201d or \u201c0X\u201d selects base 16; the \u201c0\u201d prefix selects base 8,\n  and a \u201c0b\u201d or \u201c0B\u201d prefix selects base 2. Otherwise the selected base\n  is 10.</p>\n</blockquote>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc main() {\n    n := new(big.Int)\n    n, ok := n.SetString(\"314159265358979323846264338327950288419716939937510582097494459\", 10)\n    if !ok {\n        fmt.Println(\"SetString: error\")\n        return\n    }\n    fmt.Println(n)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/ZaSOQoqZB_\" rel=\"noreferrer\">https://play.golang.org/p/ZaSOQoqZB_</a></p>\n\n<p>Output:</p>\n\n<pre><code>314159265358979323846264338327950288419716939937510582097494459\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 493, "user_id": 6111465, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/72fJG.png?s=128&g=1", "display_name": "gammazero", "link": "https://stackoverflow.com/users/6111465/gammazero"}, "is_accepted": false, "score": 1, "last_activity_date": 1508220473, "creation_date": 1508220473, "answer_id": 46783529, "question_id": 46783352, "link": "https://stackoverflow.com/questions/46783352/string-to-big-int-in-go/46783529#46783529", "title": "string to big Int in Go?", "body": "<p>See <a href=\"https://golang.org/pkg/math/big/#Int.Scan\" rel=\"nofollow noreferrer\">Example</a> for string to big int conversion. </p>\n\n<pre><code>package main\n\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"math/big\"\n)\n\nfunc main() {\n    i := new(big.Int)\n    _, err := fmt.Sscan(\"18446744073709551617\", i)\n    if err != nil {\n        log.Println(\"error scanning value:\", err)\n    } else {\n        fmt.Println(i)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>18446744073709551617\n</code></pre>\n"}], "owner": {"reputation": 472, "user_id": 2744994, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c9303582697002d5cf67b846653f8cc8?s=128&d=identicon&r=PG&f=1", "display_name": "rullzing", "link": "https://stackoverflow.com/users/2744994/rullzing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10332, "favorite_count": 4, "accepted_answer_id": 46783431, "answer_count": 2, "score": 8, "last_activity_date": 1508224450, "creation_date": 1508219728, "question_id": 46783352, "link": "https://stackoverflow.com/questions/46783352/string-to-big-int-in-go", "title": "string to big Int in Go?", "body": "<p>Is there a way to convert a string (which is essentially a huge number) from string to Big int in Go?</p>\n\n<p>I tried to first convert it into bytes array </p>\n\n<p><code>array := []byte(string)</code></p>\n\n<p>Then converting the array into BigInt.</p>\n\n<p>I thought that worked, however, the output was different than the original input. So I'm guessing the conversion didn't do the right thing for some reason.</p>\n\n<p>The numbers I'm dealing with are more than 300 digits long, so I don't think I can use regular int.</p>\n\n<p>Any suggestions of what is the best approach for this?</p>\n"}, {"tags": ["docker", "go", "kubernetes"], "answers": [{"tags": [], "owner": {"reputation": 768, "user_id": 240942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f3c56304d6e3adb7658889af56cd171?s=128&d=identicon&r=PG", "display_name": "3h4x", "link": "https://stackoverflow.com/users/240942/3h4x"}, "is_accepted": true, "score": 1, "last_activity_date": 1508225926, "creation_date": 1508225926, "answer_id": 46784921, "question_id": 46783194, "link": "https://stackoverflow.com/questions/46783194/what-cluster-can-i-user-in-my-case/46784921#46784921", "title": "What cluster can I user in my case?", "body": "<p>For short introduction I think this blog post is really good. It will tell you basics and what you should know at start <a href=\"https://www.digitalocean.com/community/tutorials/an-introduction-to-kubernetes\" rel=\"nofollow noreferrer\">https://www.digitalocean.com/community/tutorials/an-introduction-to-kubernetes</a></p>\n\n<p>But if you want to get deeper, start reading:\n<a href=\"https://kubernetes.io/\" rel=\"nofollow noreferrer\">https://kubernetes.io/</a></p>\n\n<p>For a start, use minkube, which allow you to run kubernetes locally <a href=\"https://github.com/kubernetes/minikube\" rel=\"nofollow noreferrer\">https://github.com/kubernetes/minikube</a></p>\n"}], "owner": {"reputation": 137, "user_id": 4412626, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2abd6052249d23b37122aef8bc311b31?s=128&d=identicon&r=PG&f=1", "display_name": "\u042e\u0440\u0438\u0439 \u0428\u0438\u043f\u043e\u0432\u0430\u043b\u043e\u0432", "link": "https://stackoverflow.com/users/4412626/%d0%ae%d1%80%d0%b8%d0%b9-%d0%a8%d0%b8%d0%bf%d0%be%d0%b2%d0%b0%d0%bb%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "accepted_answer_id": 46784921, "answer_count": 1, "score": -3, "last_activity_date": 1508225926, "creation_date": 1508218903, "question_id": 46783194, "link": "https://stackoverflow.com/questions/46783194/what-cluster-can-i-user-in-my-case", "title": "What cluster can I user in my case?", "body": "<p>I am going to run my golang app on oracle linux 7 server, I am going to use kubernetes using docker containers. What kind of kubernetes cluster can I use? Can you introduce me some short tutorial for deploying my app. Thank you!</p>\n"}, {"tags": ["mongodb", "go", "mongodb-oplog"], "answers": [{"tags": [], "owner": {"reputation": 1285, "user_id": 6677127, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ccJmN.jpg?s=128&g=1", "display_name": "JJussi", "link": "https://stackoverflow.com/users/6677127/jjussi"}, "is_accepted": false, "score": 0, "last_activity_date": 1508391081, "creation_date": 1508391081, "answer_id": 46823347, "question_id": 46782364, "link": "https://stackoverflow.com/questions/46782364/replaying-oplog-in-another-mongodb-instance-from-already-running-clusters-prima/46823347#46823347", "title": "Replaying oplog in another mongodb instance from already running cluster&#39;s primary instance using golang", "body": "<p>How about using <a href=\"https://github.com/mongodb-labs/mongo-connector\" rel=\"nofollow noreferrer\">mongo-connector</a> to make that? With connector, you can replicate the one opLog to another mongodb primary.</p>\n"}], "owner": {"reputation": 1679, "user_id": 1642219, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/g2aYT.jpg?s=128&g=1", "display_name": "Udit Bhardwaj", "link": "https://stackoverflow.com/users/1642219/udit-bhardwaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 329, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1508391081, "creation_date": 1508213631, "question_id": 46782364, "link": "https://stackoverflow.com/questions/46782364/replaying-oplog-in-another-mongodb-instance-from-already-running-clusters-prima", "title": "Replaying oplog in another mongodb instance from already running cluster&#39;s primary instance using golang", "body": "<p>I am storing oplogs in json format from primary mongodb instance running</p>\n\n<pre><code>[{\"Timestamp\":6477723955623886852,\"HistoryID\":166676398345289971,\"MongoVersion\":2,\"Operation\":\"i\",\"NameSpace\":\"test.tests\",\"Object\":{\"__v\":0,\"_id\":\"59e57f9e8489535b1848d32d\",\"num\":9795},\"QueryObject\":null},{\"Timestamp\":6477723955623886853,\"HistoryID\":334415645635509829,\"MongoVersion\":2,\"Operation\":\"i\",\"NameSpace\":\"test.tests\",\"Object\":{\"__v\":0,\"_id\":\"59e57f9e8489535b1848d32e\",\"num\":6183},\"QueryObject\":null},{\"Timestamp\":6477723959918854145,\"HistoryID\":-8753067027179338671,\"MongoVersion\":2,\"Operation\":\"i\",\"NameSpace\":\"test.tests\",\"Object\":{\"__v\":0,\"_id\":\"59e57f9f8489535b1848d32f\",\"num\":6439},\"QueryObject\":null},{\"Timestamp\":6477723959918854146,\"HistoryID\":4170487939316826112,\"MongoVersion\":2,\"Operation\":\"i\",\"NameSpace\":\"test.tests\",\"Object\":{\"__v\":0,\"_id\":\"59e57f9f8489535b1848d330\",\"num\":5699},\"QueryObject\":null},{\"Timestamp\":6477723959918854147,\"HistoryID\":-869729083312840671,\"MongoVersion\":2,\"Operation\":\"i\",\"NameSpace\":\"test.tests\",\"Object\":{\"__v\":0,\"_id\":\"59e57f9f8489535b1848d331\",\"num\":8779},\"QueryObject\":null}]\n</code></pre>\n\n<p>however I am not able to find any way to push these oplogs in another primary instance of mongodb and replay them so that both databases can be synced</p>\n\n<p>here is the code I have written to replay the oplogs</p>\n\n<pre><code>package operations\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"os\"\n    \"reflect\"\n    \"time\"\n\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\ntype OlogQuery struct {\n    Session *mgo.Session\n    Query   bson.M\n    Timeout time.Duration\n}\n\ntype Olog struct {\n    ts bson.MongoTimestamp `bson:\"ts\"`\n    h  float64             `bson:\"h\"`\n    v  int                 `bson:\"v\"`\n    op string              `bson:\"op\"`\n    ns string              `bson:\"ns\"`\n    o  bson.M              `bson:\"o\"`\n    o2 bson.M              `bson:\"o2\"`\n}\n\ntype Obj struct {\n    data map[string]Olog\n}\n\nfunc exists(path string) (bool, error) {\n    _, err := os.Stat(path)\n    if err == nil {\n    return true, nil\n}\nif os.IsNotExist(err) {\n    return false, nil\n}\nreturn true, err\n}\n\nvar Written = make(chan bool, 1)\n\nfunc ReplayOpLogs(dest *mgo.Session) bool {\n\ndirExists, _ := exists(\"oplogs\")\nif !dirExists {\n     fmt.Println(\"There are no oplogs to replay\")\n     return false\n    }\n    files, err := ioutil.ReadDir(\"./oplogs\")\n     if err != nil {\n     log.Fatal(err)\n    }\n\nfor _, f := range files {\n    raw, err := ioutil.ReadFile(\"./oplogs/\" + f.Name())\n    if err != nil {\n        fmt.Println(err.Error())\n        os.Exit(1)\n    }\n    var ol []map[string]interface{}\n    //var ol interface{}\n    if err := json.Unmarshal([]byte(raw), &amp;ol); err != nil {\n        panic(err)\n    }\n    for x := 0; x &lt; len(ol); x++ {\n        v := reflect.ValueOf(ol[x])\n        if v.Kind() == reflect.Map {\n\n            for key := range ol[x] {\n                var temp Olog\n\n                switch key {\n                case \"Timestamp\":\n                    temp.ts, _ = ol[x][key].(bson.MongoTimestamp)\n                case \"HistoryID\":\n                    temp.h, _ = ol[x][key].(float64)\n                case \"MongoVersion\":\n                    temp.v, _ = ol[x][key].(int)\n                case \"Operation\":\n                    temp.op, _ = ol[x][key].(string)\n                case \"NameSpace\":\n                    temp.ns, _ = ol[x][key].(string)\n                case \"Object\":\n                    temp.o, _ = ol[x][key].(bson.M)\n                case \"QueryObject\":\n                    temp.o2, _ = ol[x][key].(bson.M)\n                }\n\n                var olq OlogQuery\n                olq.Session = dest        //Destination Session\n                olq.Query = bson.M{\"ts\": bson.M{\"$gt\": LastTime(dest)}}\n                olq.Timeout = 1 * time.Second\n                db := olq.Session.DB(\"local\")\n                collection := db.C(\"oplog.rs\")\n                b, err := bson.Marshal(temp)\n                if err != nil {\n                    panic(err)\n                }\n                collection.Insert(b)\n                collection.Find(olq.Query).LogReplay()\n            }\n\n        }\n\n    }\n\n}\n\nreturn true\n\n }\n</code></pre>\n"}, {"tags": ["go", "types"], "comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508217681, "post_id": 46781337, "comment_id": 80512221, "body": "@JimB: &quot;<code>Two slice types are identical if they have identical element types</code>.&quot; Not true for defined types: <a href=\"https://golang.org/ref/spec#Type_identity\" rel=\"nofollow noreferrer\">Type identity</a>. <code>A defined type is always different from any other type.</code>"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1508218610, "post_id": 46781337, "comment_id": 80512561, "body": "@shx: The current version of The Go Programming Language Specification is at <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">golang.org/ref/spec</a>. Where are you getting your quotes from?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1508238247, "post_id": 46781337, "comment_id": 80523349, "body": "@peterSO, yes, didn\u2019t mean it asan answer, just trying to figure out where that quote came from in the first place and why this is a question at all."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1508214770, "creation_date": 1508214770, "answer_id": 46782514, "question_id": 46781337, "link": "https://stackoverflow.com/questions/46781337/why-they-are-different/46782514#46782514", "title": "why they are different", "body": "<p>Given:</p>\n\n<pre><code>type (\n    T0 []string\n    T1 []string\n)\n</code></pre>\n\n<blockquote>\n  <p>The Go Programming Language Specification</p>\n  \n  <p>Version of June 28, 2017</p>\n  \n  <p>A type definition creates a new, distinct type with the same\n  underlying type and operations as the given type, and binds an\n  identifier to it. </p>\n\n<pre><code>TypeDef = identifier Type .\n</code></pre>\n  \n  <p>The new type is called a defined type. It is different from any other\n  type, including the type it is created from.</p>\n  \n  <p>A defined type is always different from any other type. Otherwise, two\n  types are identical if their underlying type literals are structurally\n  equivalent; that is, they have the same literal structure and\n  corresponding components have identical types.</p>\n</blockquote>\n\n<p>T0 and T1 are defined types and are, therefore, different.</p>\n\n<hr>\n\n<p><strong>References:</strong></p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language\n  Specification</a></p>\n  \n  <p>Version of June 28, 2017</p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Types\" rel=\"nofollow noreferrer\">Types</a></p>\n  \n  <p>A type determines a set of values together with operations and methods\n  specific to those values. A type may be denoted by a type name, if it\n  has one, or specified using a type literal, which composes a type from\n  existing types.</p>\n  \n  <p>Named instances of the boolean, numeric, and string types are\n  predeclared. Other named types are introduced with type declarations. </p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Type_declarations\" rel=\"nofollow noreferrer\">Type declarations</a></p>\n  \n  <p>A type declaration binds an identifier, the type name, to a type. Type\n  declarations come in two forms: alias declarations and type\n  definitions.</p>\n\n<pre><code>TypeDecl = \"type\" ( TypeSpec | \"(\" { TypeSpec \";\" } \")\" ) .\nTypeSpec = AliasDecl | TypeDef .\n</code></pre>\n  \n  <p>Alias declarations</p>\n  \n  <p>An alias declaration binds an identifier to the given type.</p>\n\n<pre><code>AliasDecl = identifier \"=\" Type .\n</code></pre>\n  \n  <p>Within the scope of the identifier, it serves as an alias for the\n  type.</p>\n  \n  <p>Type definitions</p>\n  \n  <p>A type definition creates a new, distinct type with the same\n  underlying type and operations as the given type, and binds an\n  identifier to it.</p>\n\n<pre><code>TypeDef = identifier Type .\n</code></pre>\n  \n  <p>The new type is called a defined type. It is different from any other\n  type, including the type it is created from.</p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Type_identity\" rel=\"nofollow noreferrer\">Type identity</a></p>\n  \n  <p>Two types are either identical or different.</p>\n  \n  <p>A defined type is always different from any other type. Otherwise, two\n  types are identical if their underlying type literals are structurally\n  equivalent; that is, they have the same literal structure and\n  corresponding components have identical types.</p>\n</blockquote>\n"}], "owner": {"reputation": 45, "user_id": 6384391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c5209f557798e03f6acb69a1ec7a86a?s=128&d=identicon&r=PG&f=1", "display_name": "shx", "link": "https://stackoverflow.com/users/6384391/shx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 1, "answer_count": 1, "score": -4, "last_activity_date": 1508216837, "creation_date": 1508204998, "last_edit_date": 1508216837, "question_id": 46781337, "link": "https://stackoverflow.com/questions/46781337/why-they-are-different", "title": "why they are different", "body": "<p>In Golang spec:</p>\n\n<pre><code>type (\n    T0 []string\n    T1 []string\n)\n</code></pre>\n\n<p>it says T0 and T1 are different because they are named types with distinct declarations.but there is a rule:\n<strong>Two named types are identical if their type names originate in the same TypeSpec.</strong>\nso why T0 and T1 are different?</p>\n\n<hr>\n\n<p>EDIT:</p>\n\n<p>in spec it also says:</p>\n\n<blockquote>\n  <p>A type declaration binds an identifier, the type name, to a new type\n  that has the same underlying type as an existing type, and operations\n  defined for the existing type are also defined for the new type. <strong>The\n  new type is different from the existing type.</strong></p>\n</blockquote>\n"}, {"tags": ["http", "go", "file-watcher"], "comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1508186769, "post_id": 46778600, "comment_id": 80503415, "body": "Perhaps explain what exactly initWatch() wants to do with routes? There&#39;s no code there to access localhost:8080. You can set up the router separately from the server, see docs for ListenAndServe. What error/problem do you see if putting before?"}], "answers": [{"tags": [], "owner": {"reputation": 354, "user_id": 5537785, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qk26D.png?s=128&g=1", "display_name": "lamg", "link": "https://stackoverflow.com/users/5537785/lamg"}, "is_accepted": false, "score": 3, "last_activity_date": 1508263803, "last_edit_date": 1508263803, "creation_date": 1508187101, "answer_id": 46778909, "question_id": 46778600, "link": "https://stackoverflow.com/questions/46778600/golang-execute-function-after-http-listenandserve/46778909#46778909", "title": "golang execute function after http.ListenAndServe", "body": "<p>Both calls, <code>initWatch()</code> and <code>http.ListenAndServe(\"127.0.0.1:8080\", nil)</code> keep the main goroutine waiting forever. <code>initWatch()</code> is waiting for a value in the <code>&lt;-done</code> statement, and never gets one. You should run <code>initWatch</code> or <code>http.ListenAndServe</code> in another goroutine, like <code>go initWatch()</code> for example. Or maybe send a value to the <code>done</code> channel from another goroutine.</p>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 2, "last_activity_date": 1508217985, "last_edit_date": 1508217985, "creation_date": 1508215565, "answer_id": 46782645, "question_id": 46778600, "link": "https://stackoverflow.com/questions/46778600/golang-execute-function-after-http-listenandserve/46782645#46782645", "title": "golang execute function after http.ListenAndServe", "body": "<p>You may start watcher in separate goroutine. After the server ends - you send signal to exit to the watcher.   like:</p>\n\n<pre><code>done := initWatch()\nserverErr := http.ListenAndServe(\"127.0.0.1:8080\", nil)\ndone &lt;- true\n</code></pre>\n\n<p>Next slightly modify watcher - return channel where to notify to stop working. Also working goroutine listens for exit signal. </p>\n\n<pre><code>func initWatch() chan bool {\n    watcher, err := fsnotify.NewWatcher()\n    if err != nil {\n        fmt.Println(err)\n    }\n    defer watcher.Close()\n\n    done := make(chan bool)\n    go func() {\n        for {\n            select {\n                case event := &lt;-watcher.Events:\n                    if ( event.Op&amp;fsnotify.Remove == fsnotify.Remove || event.Op&amp;fsnotify.Rename == fsnotify.Rename ) {\n                        fmt.Println(\"file removed - \", event.Name)\n                    }\n\n                case err := &lt;-watcher.Errors:\n                    fmt.Println(\"error:\", err)\n\n                // listen exit signal\n                case &lt;- done:\n                     break\n            }\n        }\n    }()\n\n\n\n\n    err = watcher.Add(\"sampledata.txt\")\n    if err != nil {\n        fmt.Println(err)\n    }\n    return done\n}\n</code></pre>\n"}], "owner": {"reputation": 6750, "user_id": 2098614, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/cslmi.jpg?s=128&g=1", "display_name": "Ajey", "link": "https://stackoverflow.com/users/2098614/ajey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3019, "favorite_count": 0, "accepted_answer_id": 46782645, "answer_count": 2, "score": 2, "last_activity_date": 1508263803, "creation_date": 1508185751, "question_id": 46778600, "link": "https://stackoverflow.com/questions/46778600/golang-execute-function-after-http-listenandserve", "title": "golang execute function after http.ListenAndServe", "body": "<p>I am beginning to learn golang by creating a simple http server</p>\n\n<pre><code>func main() {\n    f, err := os.OpenFile(\"testlogfile\", os.O_RDWR | os.O_CREATE | os.O_APPEND, 0666)\n    if err != nil {\n        fmt.Println(\"error opening file: %v\", err)\n    }\n    defer f.Close()\n\n    log.SetOutput(f)\n\n    http.HandleFunc(\"/\", defaultHandler)\n    http.HandleFunc(\"/check\", checkHandler)\n\n    serverErr := http.ListenAndServe(\"127.0.0.1:8080\", nil) // set listen port\n\n    if serverErr != nil {\n        log.Println(\"Error starting server\")\n\n    } else {\n        fmt.Println(\"Started server on - 127.0.0.1:8080\" )\n    }\n}\n</code></pre>\n\n<p>The above code will start a local server on 8080 and I am able to hit the routes via browser. It's all good!</p>\n\n<p>However, now I want to run a separate go routine, that watches a file - </p>\n\n<pre><code>func initWatch() string{\n    watcher, err := fsnotify.NewWatcher()\n    if err != nil {\n        fmt.Println(err)\n    }\n    defer watcher.Close()\n\n    done := make(chan bool)\n    go func() {\n        for {\n            select {\n                case event := &lt;-watcher.Events:\n                    if ( event.Op&amp;fsnotify.Remove == fsnotify.Remove || event.Op&amp;fsnotify.Rename == fsnotify.Rename ) {\n                        fmt.Println(\"file removed - \", event.Name)\n                    }\n\n                case err := &lt;-watcher.Errors:\n                    fmt.Println(\"error:\", err)\n                }\n        }\n    }()\n\n    err = watcher.Add(\"sampledata.txt\")\n    if err != nil {\n        fmt.Println(err)\n    }\n\n\n    &lt;-done\n}\n</code></pre>\n\n<p>And now, if I call the function <code>initWatch()</code> <strong>BEFORE</strong> <code>http.ListenAndServe(\"127.0.0.1:8080\", nil)</code> then I am not able to access the server routes via browser(ex - localhost:8080) because the sever has not spawned.\nEx - </p>\n\n<pre><code>initWatch()\nserverErr := http.ListenAndServe(\"127.0.0.1:8080\", nil) // set listen port\n</code></pre>\n\n<p>And if I call the function  <code>initWatch()</code> <strong>AFTER</strong> <code>http.ListenAndServe(\"127.0.0.1:8080\", nil)</code> then the file watcher function is not working.\nEx - </p>\n\n<pre><code>serverErr := http.ListenAndServe(\"127.0.0.1:8080\", nil) // set listen port\ninitWatch()\n</code></pre>\n\n<p>How do I make both the <code>initWatch()</code>(file watcher) and the http server run?</p>\n\n<p>Appreciate your help.</p>\n"}, {"tags": ["elasticsearch", "go", "aggregation"], "answers": [{"comments": [{"owner": {"reputation": 21174, "user_id": 636625, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/EuUH4.jpg?s=128&g=1", "display_name": "Shang Wang", "link": "https://stackoverflow.com/users/636625/shang-wang"}, "edited": false, "score": 0, "creation_date": 1508185879, "post_id": 46778502, "comment_id": 80503040, "body": "I don&#39;t think that would work. The reason that I use <code>scroll</code> in the first place is because ES is not recommended using <code>query</code> to query for large dataset. Even if the limit can be changed via the yaml files, I&#39;d rather seek other options before using plain query as my last resolution."}], "tags": [], "owner": {"reputation": 151, "user_id": 8767565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a3bd519e56a1b94866538f2210910f0?s=128&d=identicon&r=PG", "display_name": "greggers", "link": "https://stackoverflow.com/users/8767565/greggers"}, "is_accepted": false, "score": 0, "last_activity_date": 1508185385, "creation_date": 1508185385, "answer_id": 46778502, "question_id": 46778214, "link": "https://stackoverflow.com/questions/46778214/how-to-efficiently-get-only-one-field-of-the-documents-for-elastic-search/46778502#46778502", "title": "How to efficiently get only one field of the documents for elastic search", "body": "<p>If I understand your question correctly you are trying to retrieve a specific field from your document called 'key' and I assume you have other fields in your documents that are being returned that you don't care about?</p>\n\n<p>If so, try this:</p>\n\n<pre><code>GET /_search\n{\n    \"_source\": {\n        \"includes\": [\"key\"]\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2401, "user_id": 4256727, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/4495f03709d19bd29b1191087d541332?s=128&d=identicon&r=PG&f=1", "display_name": "jgr", "link": "https://stackoverflow.com/users/4256727/jgr"}, "is_accepted": false, "score": 0, "last_activity_date": 1531858565, "last_edit_date": 1531858565, "creation_date": 1508245047, "answer_id": 46790738, "question_id": 46778214, "link": "https://stackoverflow.com/questions/46778214/how-to-efficiently-get-only-one-field-of-the-documents-for-elastic-search/46790738#46790738", "title": "How to efficiently get only one field of the documents for elastic search", "body": "<p>I am not exactly sure what you are trying to achieve but retrieve one field from your document usually required store parameter as true, so this fields doesn't need to be parsed from _source field.</p>\n\n<p>Check doc: <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/number.html#number-params\" rel=\"nofollow noreferrer\">https://www.elastic.co/guide/en/elasticsearch/reference/current/number.html#number-params</a></p>\n"}], "owner": {"reputation": 21174, "user_id": 636625, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/EuUH4.jpg?s=128&g=1", "display_name": "Shang Wang", "link": "https://stackoverflow.com/users/636625/shang-wang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 434, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1531858565, "creation_date": 1508184187, "last_edit_date": 1508245781, "question_id": 46778214, "link": "https://stackoverflow.com/questions/46778214/how-to-efficiently-get-only-one-field-of-the-documents-for-elastic-search", "title": "How to efficiently get only one field of the documents for elastic search", "body": "<p>I'm new to elasticsearch and I have some technical difficulties. Currently I have docs that are stored in hourly indexes and they are time series data. What I'm trying to figure out is how to efficiently extracting only the <code>key</code> field values, which is defined as <code>\"key\": { \"type\": \"long\" }</code>. I tried initially the naive method, which is scrolling through all indices and extract the field, but apparently that doesn't finish very quickly, each hourly index has about 10M docs and scrolling 3 indexes already takes forever.</p>\n\n<p>Then I came to <a href=\"https://www.elastic.co/guide/en/elasticsearch/reference/current/search-aggregations-bucket-terms-aggregation.html\" rel=\"nofollow noreferrer\">terms aggregations</a>, tried to make <code>key</code> field as the aggregation term:</p>\n\n<pre><code>  \"aggregations\": {\n    \"test_group\": {\n      \"terms\": {\n        \"field\": \"key\",\n        \"size\": 100000\n      }\n    }\n  }\n</code></pre>\n\n<p>That gives me better performance but still not sufficient as a real-time system as users try to search for the history, because <code>key</code> is a high cardinality field. Some rough benchmarks told me that:</p>\n\n<pre><code>size = 50k,  indices = 4, time range = 3hrs: 7.1s\nsize = 100k, indices = 4, time range = 3hrs: 7.669s\nsize = 1m,   indices = 4, time range = 2hrs: 12.669s\nsize = 1m,   indices = 4, time range = 3hrs: 14.669s\n</code></pre>\n\n<p>This is not the end of it, because I'm using <a href=\"https://github.com/olivere/elastic\" rel=\"nofollow noreferrer\">elastic search go library</a> to parse the output and do some processing, which adds non-trivial time to the overall response. </p>\n\n<p>My question is: is this already the best ES can do? Is there any other ways that I'm missing? I'm currently on ES 5.6 and 3 nodes for the cluster, all using <a href=\"http://www.ec2instances.info/?selected=i3.4xlarge\" rel=\"nofollow noreferrer\">Amazon i3-4xl</a> instances. Thanks.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1367, "user_id": 1759069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/NiuIi.jpg?s=128&g=1", "display_name": "mallix", "link": "https://stackoverflow.com/users/1759069/mallix"}, "edited": false, "score": 0, "creation_date": 1508183721, "post_id": 46777925, "comment_id": 80501972, "body": "I used to second approach. Thank you"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 2, "last_activity_date": 1508182959, "creation_date": 1508182959, "answer_id": 46777925, "question_id": 46777663, "link": "https://stackoverflow.com/questions/46777663/decode-2nd-level-response-body-to-struct/46777925#46777925", "title": "Decode 2nd level response body to struct", "body": "<p>To get your data there are at least two options:</p>\n\n<p>Decode into map[string]interface{}</p>\n\n<pre><code>m := create(map[string]interface{})\nerr = json.NewDecoder(response.Body).Decode(&amp;m)\n</code></pre>\n\n<p>Then use the m[\"results\"] key to get at your users. </p>\n\n<p>Or you could Decode into a container struct then assign list.Users = container.Results.</p>\n\n<pre><code>type Container struct {\n    Results []User `json:\"Results\"`\n    SomeOtherStuff string `json:\"SomeOtherStuff\"`\n}\n</code></pre>\n\n<p>To get an idea of structs for arbitrary json look at <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">json2go</a>. </p>\n"}], "owner": {"reputation": 1367, "user_id": 1759069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/NiuIi.jpg?s=128&g=1", "display_name": "mallix", "link": "https://stackoverflow.com/users/1759069/mallix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 46777925, "answer_count": 1, "score": 2, "last_activity_date": 1508182959, "creation_date": 1508181823, "question_id": 46777663, "link": "https://stackoverflow.com/questions/46777663/decode-2nd-level-response-body-to-struct", "title": "Decode 2nd level response body to struct", "body": "<p>I have 2 structs:</p>\n\n<pre><code>type List struct {\n    ListID string `json:\"listid\"`\n    Name string `json:\"name\"`\n    Users []User `json:\"users\"`\n}\n\ntype User struct {\n    Email string `json:\"email\"`\n    Name string `json:\"name\"`\n}\n</code></pre>\n\n<p>I am calling an endpoint and successfully getting a response which has the structure below:</p>\n\n<pre><code>{\n \"Results\":[\n  {\"Email\": \"user1@domain.com\", \"Name\": \"test1\" \"State\": \"Active\",\u2026},\n  {\"Email\": \"user2@domain.com\", \"Name\": \"test2\" \"State\": \"Active\",\u2026},\n  {\"Email\": \"user3@domain.com\", \"Name\": \"test3\", \"State\": \"Active\",\u2026}\n ],\n \"SomeOtherStuff\": \"email\"\n}\n</code></pre>\n\n<p>I am trying to decode the JSON response to my struct like this:</p>\n\n<pre><code>err = json.NewDecoder(response.Body).Decode(&amp;list.Users)\n</code></pre>\n\n<p>But there is no \"Results\" attribute in my struct to map to. How can I map only the Results key of the response to my array of User structs ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1508175611, "post_id": 46776014, "comment_id": 80497610, "body": "When you use <code>exec.Command</code>, you&#39;re forking out to a new background process. It won&#39;t affect the TTY the user is using to interact with your application."}, {"owner": {"reputation": 2777, "user_id": 4852094, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/10102767534136292/picture?type=large", "display_name": "Rob", "link": "https://stackoverflow.com/users/4852094/rob"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1508175940, "post_id": 46776014, "comment_id": 80497784, "body": "that&#39;s what I was thinking, is there a way around this so I can disable to keyboard temporarily in the current process?"}, {"owner": {"reputation": 2777, "user_id": 4852094, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/10102767534136292/picture?type=large", "display_name": "Rob", "link": "https://stackoverflow.com/users/4852094/rob"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1508176028, "post_id": 46776014, "comment_id": 80497836, "body": "also, why the downvote?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1508176406, "post_id": 46776014, "comment_id": 80498026, "body": "Note that <code>stty -echo</code> doesn&#39;t &quot;disable the keyboard&quot;, rather it disables echoing the input from the keyboard. Keyboard input is still processed (or not) normally."}], "answers": [{"comments": [{"owner": {"reputation": 2777, "user_id": 4852094, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/10102767534136292/picture?type=large", "display_name": "Rob", "link": "https://stackoverflow.com/users/4852094/rob"}, "edited": false, "score": 0, "creation_date": 1508187546, "post_id": 46777473, "comment_id": 80503820, "body": "that&#39;s good enough though, I think you captured my intent perfectly"}], "tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": true, "score": 4, "last_activity_date": 1508181011, "creation_date": 1508181011, "answer_id": 46777473, "question_id": 46776014, "link": "https://stackoverflow.com/questions/46776014/how-to-disable-keyboard-during-printing-in-terminal-in-golang/46777473#46777473", "title": "how to disable keyboard during printing in terminal in golang", "body": "<p>The <a href=\"https://github.com/golang/crypto/blob/master/ssh/terminal/util.go#L104\" rel=\"nofollow noreferrer\">crypto/ssh/terminal package</a> (which isn't standard lib for some reason) has code that does what you need, though it uses pretty low-level syscalls to make it happen.  You can probably adapt it to what you're trying to do (by using <code>syscall.Stdin</code> as the file descriptor).  As Flimzy pointed out, though, this still doesn't disable keyboard input, it simply suppresses it from echoing to terminal, so you may still have to flush the input if you depend on it later.</p>\n"}], "owner": {"reputation": 2777, "user_id": 4852094, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/10102767534136292/picture?type=large", "display_name": "Rob", "link": "https://stackoverflow.com/users/4852094/rob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 333, "favorite_count": 0, "accepted_answer_id": 46777473, "answer_count": 1, "score": 2, "last_activity_date": 1508181011, "creation_date": 1508175457, "last_edit_date": 1508176926, "question_id": 46776014, "link": "https://stackoverflow.com/questions/46776014/how-to-disable-keyboard-during-printing-in-terminal-in-golang", "title": "how to disable keyboard during printing in terminal in golang", "body": "<p>I'm writing a text interface in golang, and if you type while it's printing, it will interfere with the text being presented.  I know \"stty -echo\" will stop echoing the keyboard's output and \"stty echo\" reenables it, but when I write functions like:</p>\n\n<pre><code>func disableKeyboard() {\n  c := exec.Command(\"stty -echo\")\n  c.Stdout = os.Stdout\n  c.Run()\n}\n\nfunc enableKeyboard() {\n  c := exec.Command(\"stty echo\")\n  c.Stdout = os.Stdout\n  c.Run()\n}\n</code></pre>\n\n<p>these have no impact on my programs output.  Is there something wrong with the way I'm sending these commands?</p>\n\n<p>Something like:</p>\n\n<pre><code>disableKeyboard()\ntime.Sleep(time.Second)\nenableKeyboard()\n</code></pre>\n\n<p>doesn't work.  I'm using a mac currently.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user820304"}, "edited": false, "score": 1, "creation_date": 1508171319, "post_id": 46774897, "comment_id": 80495445, "body": "Sounds like a great opportunity for a regular expression..."}, {"owner": {"reputation": 6636, "user_id": 76237, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/E0QaY.jpg?s=128&g=1", "display_name": "diginoise", "link": "https://stackoverflow.com/users/76237/diginoise"}, "edited": false, "score": 0, "creation_date": 1508171393, "post_id": 46774897, "comment_id": 80495477, "body": "does <b>B</b> stand for <b>billion</b> ?"}, {"owner": {"reputation": 2349, "user_id": 653331, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8a4bf914078e4f4732891156dd917d69?s=128&d=identicon&r=PG&f=1", "display_name": "p_mcp", "link": "https://stackoverflow.com/users/653331/p-mcp"}, "edited": false, "score": 0, "creation_date": 1508171461, "post_id": 46774897, "comment_id": 80495515, "body": "Ye, B = billion - I&#39;m thinking regular expressions are the only way to go. Would be a bit of a pain to implement though... was hoping there was a package I could call"}, {"owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 2, "creation_date": 1508172809, "post_id": 46774897, "comment_id": 80496119, "body": "As a hack, you can just string replace the letters with the exponent. So for B, you would do <code>strings.Replace(&quot;2.93B&quot;, &quot;B&quot;, &quot;e9&quot;)</code>. For &quot;k&quot; you could replace with e3, etc."}, {"owner": {"reputation": 6636, "user_id": 76237, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/E0QaY.jpg?s=128&g=1", "display_name": "diginoise", "link": "https://stackoverflow.com/users/76237/diginoise"}, "edited": false, "score": 3, "creation_date": 1508172858, "post_id": 46774897, "comment_id": 80496145, "body": "It&#39;s a tricky task since <b>k</b> stands for <b>thousand</b>, as in proper SI unit prefix, while <b>B</b> stands for <b>billion</b> which is much less well defined English name for SI prefix of <b>G</b> and is subject to localisation etc.  It will all depend on how well defined and limited your specific case is."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1508175207, "post_id": 46774897, "comment_id": 80497395, "body": "@Thebluefish: There are no great opportunities for regular expressions. :P"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1508175231, "post_id": 46774897, "comment_id": 80497400, "body": "We&#39;re not here to write your code for you. What have you tried? What approaches have you considered? What problems did you encounter?"}, {"owner": {"reputation": 2349, "user_id": 653331, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8a4bf914078e4f4732891156dd917d69?s=128&d=identicon&r=PG&f=1", "display_name": "p_mcp", "link": "https://stackoverflow.com/users/653331/p-mcp"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1508175390, "post_id": 46774897, "comment_id": 80497496, "body": "@Flimzy I think if you check the question, I have tried. I&#39;m a self confessed regexp novice so I was asking StackO incase I was missing something from golang."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1508176198, "post_id": 46774897, "comment_id": 80497916, "body": "@p_mcp: That&#39;s an asset. A regexp is a bad solution here."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1508189740, "last_edit_date": 1508189740, "creation_date": 1508176742, "answer_id": 46776367, "question_id": 46774897, "link": "https://stackoverflow.com/questions/46774897/converting-a-string-into-float-from-a-strange-format/46776367#46776367", "title": "Converting a string into float from a strange format", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n    \"unicode/utf8\"\n)\n\nvar siFactors = map[string]float64{\n    \"\":  1e0,\n    \"k\": 1e3,\n    \"M\": 1e6, // Sometimes, M (Roman numeral) for thousands and MM for millions\n    \"G\": 1e9,\n    \"T\": 1e12,\n    \"P\": 1e15,\n    \"E\": 1e18,\n    \"Z\": 1e21,\n    \"Y\": 1e24,\n    \"K\": 1e3, // colloquial synonym for \"k\"\n    \"B\": 1e9, // colloquial synonym for \"G\"\n}\n\nfunc parseNumber(s string) (float64, error) {\n    f, err := strconv.ParseFloat(s, 64)\n    if err == nil {\n        return f, nil\n    }\n    r, size := utf8.DecodeLastRuneInString(s)\n    if r == utf8.RuneError {\n        return 0, err\n    }\n    symbol := s[len(s)-size : len(s)]\n    factor, ok := siFactors[symbol]\n    if !ok {\n        return 0, err\n    }\n    f, e := strconv.ParseFloat(s[:len(s)-len(symbol)], 64)\n    if e != nil {\n        return 0, err\n    }\n    return f * factor, nil\n}\n\nfunc main() {\n    for _, s := range []string{\"2.93\", \"2.93k\", \"2.93M\", \"2.93G\", \"2.93B\", \"2930000000\", \"2.93X\", \"G\"} {\n        n, err := parseNumber(s)\n        fmt.Printf(\"%q\\t %g %v\\n\", s, n, err)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/DYEe5gQ8pl\" rel=\"nofollow noreferrer\">https://play.golang.org/p/DYEe5gQ8pl</a></p>\n\n<p>Output:</p>\n\n<pre><code>\"2.93\"   2.93 &lt;nil&gt;\n\"2.93k\"  2930 &lt;nil&gt;\n\"2.93M\"  2.93e+06 &lt;nil&gt;\n\"2.93G\"  2.93e+09 &lt;nil&gt;\n\"2.93B\"  2.93e+09 &lt;nil&gt;\n\"2930000000\"     2.93e+09 &lt;nil&gt;\n\"2.93X\"  0 strconv.ParseFloat: parsing \"2.93X\": invalid syntax\n\"B\"  0 strconv.ParseFloat: parsing \"B\": invalid syntax\n</code></pre>\n"}], "owner": {"reputation": 2349, "user_id": 653331, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8a4bf914078e4f4732891156dd917d69?s=128&d=identicon&r=PG&f=1", "display_name": "p_mcp", "link": "https://stackoverflow.com/users/653331/p-mcp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 585, "favorite_count": 1, "accepted_answer_id": 46776367, "answer_count": 1, "score": 0, "last_activity_date": 1508189740, "creation_date": 1508171170, "question_id": 46774897, "link": "https://stackoverflow.com/questions/46774897/converting-a-string-into-float-from-a-strange-format", "title": "Converting a string into float from a strange format", "body": "<p>How do I convert a string into a float from an unusual format (e.g. 2.93B, 201k)? Using the normal approach doesn't work i.e:</p>\n\n<pre><code>i, err := strconv.ParseFloat(\"2.93B\", 64) // Returns an 'invalid syntax' error\n</code></pre>\n"}, {"tags": ["mongodb", "go", "types", "aggregation-framework", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1511801478, "last_edit_date": 1511801478, "creation_date": 1508169552, "answer_id": 46774425, "question_id": 46774424, "link": "https://stackoverflow.com/questions/46774424/mgo-aggregation-how-to-reuse-model-types-to-query-and-unmarshal-mixed-results/46774425#46774425", "title": "Mgo aggregation: how to reuse model types to query and unmarshal &quot;mixed&quot; results?", "body": "<p>The query above returns documents that \"almost\" match <code>User</code> documents, but they also have the posts of each users. So basically the result is a series of <code>User</code> documents with a <code>Post</code> array or slice <em>embedded</em>.</p>\n\n<p>One way would be to add a <code>Posts []*Post</code> field to the <code>User</code> itself, and we would be done:</p>\n\n<pre><code>type User struct {\n    ID         string    `bson:\"_id\"`\n    Name       string    `bson:\"name\"`\n    Registered time.Time `bson:\"registered\"`\n    Posts      []*Post   `bson:\"posts,omitempty\"`\n}\n</code></pre>\n\n<p>While this works, it seems \"overkill\" to extend <code>User</code> with <code>Posts</code> just for the sake of a single query. If we'd continue down this road, our <code>User</code> type would get bloated with lots of \"extra\" fields for different queries. Not to mention if we fill the <code>Posts</code> field and save the user, those posts would end up saved inside the <code>User</code> document. Not what we want.</p>\n\n<p>Another way would be to create a <code>UserWithPosts</code> type copying <code>User</code>, and adding a <code>Posts []*Post</code> field. Needless to say this is ugly and inflexible (any changes made to <code>User</code> would have to be reflected to <code>UserWithPosts</code> manually).</p>\n\n<h2>With Struct Embedding</h2>\n\n<p>Instead of modifying the original <code>User</code>, and instead of creating a new <code>UserWithPosts</code> type from \"scratch\", we can utilize <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow noreferrer\">struct embedding</a> (reusing the existing <code>User</code> and <code>Post</code> types) with a little trick:</p>\n\n<pre><code>type UserWithPosts struct {\n    User  `bson:\",inline\"`\n    Posts []*Post `bson:\"posts\"`\n}\n</code></pre>\n\n<p>Note the bson <a href=\"https://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go/30889373#30889373\">tag value</a> <code>\",inline\"</code>. This is documented at <a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#Marshal\" rel=\"nofollow noreferrer\"><code>bson.Marshal()</code></a> and <a href=\"https://godoc.org/gopkg.in/mgo.v2/bson#Unmarshal\" rel=\"nofollow noreferrer\"><code>bson.Unmarshal()</code></a> (we'll use it for unmarshaling):</p>\n\n<blockquote>\n<pre><code>inline     Inline the field, which must be a struct or a map.\n           Inlined structs are handled as if its fields were part\n           of the outer struct. An inlined map causes keys that do\n           not match any other struct field to be inserted in the\n           map rather than being discarded as usual.\n</code></pre>\n</blockquote>\n\n<p>By using embedding and the <code>\",inline\"</code> tag value, the <code>UserWithPosts</code> type itself will be a valid target for unmarshaling <code>User</code> documents, and its <code>Post []*Post</code> field will be a perfect choice for the looked up <code>\"posts\"</code>.</p>\n\n<p>Using it:</p>\n\n<pre><code>var uwp *UserWithPosts\nit := pipe.Iter()\nfor it.Next(&amp;uwp) {\n    // Use uwp:\n    fmt.Println(uwp)\n}\n// Handle it.Err()\n</code></pre>\n\n<p>Or getting all results in one step:</p>\n\n<pre><code>var uwps []*UserWithPosts\nerr := pipe.All(&amp;uwps)\n// Handle error\n</code></pre>\n\n<p>The type declaration of <code>UserWithPosts</code> may or may not be a local declaration. If you don't need it elsewhere, it can be a local declaration in the function where you execute and process the aggregation query, so it will not bloat your existing types and declarations. If you want to reuse it, you can declare it at package level (exported or unexported), and use it wherever you need it.</p>\n\n<h2>Modifying the aggregation</h2>\n\n<p>Another option is to use MongoDB's <a href=\"https://docs.mongodb.com/manual/reference/operator/aggregation/replaceRoot/\" rel=\"nofollow noreferrer\"><code>$replaceRoot</code></a> to \"rearrange\" the result documents, so a \"simple\" struct will perfectly cover the documents:</p>\n\n<pre><code>// Query users with their posts:\npipe := collUsers.Pipe([]bson.M{\n    {\n        \"$lookup\": bson.M{\n            \"from\":         \"posts\",\n            \"localField\":   \"_id\",\n            \"foreignField\": \"userID\",\n            \"as\":           \"posts\",\n        },\n    },\n    {\n        \"$replaceRoot\": bson.M{\n            \"newRoot\": bson.M{\n                \"user\":  \"$$ROOT\",\n                \"posts\": \"$posts\",\n            },\n        },\n    },\n})\n</code></pre>\n\n<p>With this remapping, the result documents can be modeled like this:</p>\n\n<pre><code>type UserWithPosts struct {\n    User  *User   `bson:\"user\"`\n    Posts []*Post `bson:\"posts\"`\n}\n</code></pre>\n\n<p>Note that while this works, the <code>posts</code> field of all documents will be fetched from the server twice: once as the <code>posts</code> field of the returned documents, and once as the field of <code>user</code>; we don't map / use it but it is present in the result documents. So if this solution is chosen, the <code>user.posts</code> field should be removed e.g. with a <code>$project</code> stage:</p>\n\n<pre><code>pipe := collUsers.Pipe([]bson.M{\n    {\n        \"$lookup\": bson.M{\n            \"from\":         \"posts\",\n            \"localField\":   \"_id\",\n            \"foreignField\": \"userID\",\n            \"as\":           \"posts\",\n        },\n    },\n    {\n        \"$replaceRoot\": bson.M{\n            \"newRoot\": bson.M{\n                \"user\":  \"$$ROOT\",\n                \"posts\": \"$posts\",\n            },\n        },\n    },\n    {\"$project\": bson.M{\"user.posts\": 0}},\n})\n</code></pre>\n"}], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 273, "favorite_count": 0, "accepted_answer_id": 46774425, "answer_count": 1, "score": 1, "last_activity_date": 1511801478, "creation_date": 1508169552, "last_edit_date": 1508171077, "question_id": 46774424, "link": "https://stackoverflow.com/questions/46774424/mgo-aggregation-how-to-reuse-model-types-to-query-and-unmarshal-mixed-results", "title": "Mgo aggregation: how to reuse model types to query and unmarshal &quot;mixed&quot; results?", "body": "<p>Let's say we have 2 collections: <code>\"users\"</code> and <code>\"posts\"</code>, modeled by the following types:</p>\n\n<pre><code>type User struct {\n    ID         string    `bson:\"_id\"`\n    Name       string    `bson:\"name\"`\n    Registered time.Time `bson:\"registered\"`\n}\n\ntype Post struct {\n    ID      string    `bson:\"_id\"`\n    UserID  string    `bson:\"userID\"`\n    Content string    `bson:\"content\"`\n    Date    time.Time `bson:\"date\"`\n}\n</code></pre>\n\n<p>These can be used when storing / retrieving individual or even collection of documents, e.g.:</p>\n\n<pre><code>usersColl := sess.DB(\"\").C(\"users\")\npostsColl := sess.DB(\"\").C(\"posts\")\n\n// Insert new user:\nu := &amp;User{\n    ID:         \"1\",\n    Name:       \"Bob\",\n    Registered: time.Now(),\n},\nerr := usersColl.Insert(u)\n// Handle err\n\n// Get Posts in the last 10 mintes:\nvar posts []*Post\nerr := postsColl.Find(\n    bson.M{\"date\": bson.M{\"$gt\": time.Now().Add(-10 * time.Minute)}},\n).Limit(20).All(&amp;posts)\n// Handle err\n</code></pre>\n\n<p>What if we use <a href=\"https://docs.mongodb.com/manual/aggregation/\" rel=\"nofollow noreferrer\">aggregation</a> to fetch a mixture of these documents? For example <a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.Pipe\" rel=\"nofollow noreferrer\"><code>Collection.Pipe()</code></a>:</p>\n\n<pre><code>// Query users with their posts:\npipe := collUsers.Pipe([]bson.M{\n    {\n        \"$lookup\": bson.M{\n            \"from\":         \"posts\",\n            \"localField\":   \"_id\",\n            \"foreignField\": \"userID\",\n            \"as\":           \"posts\",\n        },\n    },\n})\n\nvar doc bson.M\nit := pipe.Iter()\nfor it.Next(&amp;doc) {\n    fmt.Println(doc)\n}\n// Handle it.Err()\n</code></pre>\n\n<p>We query users with their posts in a single query. The result is a mixture of users and posts. How can we reuse our <code>User</code> and <code>Post</code> model types to not have to deal with the result as \"raw\" documents (of type <code>bson.M</code>)?</p>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1508169595, "post_id": 46774410, "comment_id": 80494503, "body": "From the documentation: <code>Stop does not close the channel</code>"}], "answers": [{"comments": [{"owner": {"reputation": 899, "user_id": 8481532, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/91806192f478f41d284c0edff368480a?s=128&d=identicon&r=PG&f=1", "display_name": "lucky yang", "link": "https://stackoverflow.com/users/8481532/lucky-yang"}, "edited": false, "score": 0, "creation_date": 1508170687, "post_id": 46774585, "comment_id": 80495091, "body": "Sorry but I don&#39;t quite understand the reason why stop does not close the channel. I know you have explained it -- &quot;to prevent a read from the channel succeeding incorrectly&quot; , but it still confuse me."}, {"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "reply_to_user": {"reputation": 899, "user_id": 8481532, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/91806192f478f41d284c0edff368480a?s=128&d=identicon&r=PG&f=1", "display_name": "lucky yang", "link": "https://stackoverflow.com/users/8481532/lucky-yang"}, "edited": false, "score": 0, "creation_date": 1508172579, "post_id": 46774585, "comment_id": 80496021, "body": "@luckyyang This API design quirk has been brought up in the past, It looks to be an implementation problem. See <a href=\"https://codereview.appspot.com/5491059\" rel=\"nofollow noreferrer\">codereview.appspot.com/5491059</a> for for more details."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1508174969, "post_id": 46774585, "comment_id": 80497280, "body": "So, let&#39;s say you have something somewhere that&#39;s just doing a <code>&lt;-ticker.C</code> instead of doing it within a <code>for range</code> loop.  In such a case, closing the channel will trigger that receive just like an actual value being sent would (since receives from a closed channel instantly succeed).  So it doesn&#39;t close the channel so receivers can&#39;t get a close thinking it&#39;s a tick."}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1508179667, "post_id": 46774585, "comment_id": 80499814, "body": "Very strange thing as I see. Ticking is a cyclic process so it would be logical to use <code>for I := range ticket.C</code> but not <code>t = &lt;- ticker.C</code> and closing would be a good signal to break the loop."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1508180291, "post_id": 46774585, "comment_id": 80500168, "body": "I concur, but the latter use <i>is</i> sometimes used (arguably improperly), and the existing package was coded with that expectation.  Unfortunately, due to the <a href=\"https://golang.org/doc/go1compat\" rel=\"nofollow noreferrer\">compatibility guarantee</a>, that behavior is almost definitely not going to change, at least until Go 2.0."}], "tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": false, "score": 1, "last_activity_date": 1508170085, "creation_date": 1508170085, "answer_id": 46774585, "question_id": 46774410, "link": "https://stackoverflow.com/questions/46774410/does-a-ticker-tell-a-goroutine-it-is-stopped-through-its-ticker-c/46774585#46774585", "title": "Does a ticker tell a goroutine it is stopped through its ticker.C?", "body": "<p>As JimB pointed out, the documentation for the time.Ticker specifies that Stop() does not close the channel, <code>to prevent a read from the channel succeeding incorrectly.</code>  Your best bet is probably a quit channel.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"time\"\n\nfunc main() {\n    ticker := time.NewTicker(time.Millisecond * 500)\n    quit := make(chan struct{})\n    go func() {\n        for {\n            select {\n            case t := &lt;-ticker.C:\n                fmt.Println(\"Tick at\", t)\n            case &lt;-quit:\n                fmt.Println(\"ticker stopped\")\n                return\n            }\n        }\n    }()\n    time.Sleep(time.Second * 5)\n    ticker.Stop()\n    close(quit)\n    time.Sleep(time.Second * 5)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/xTKNkMtdIf\" rel=\"nofollow noreferrer\">https://play.golang.org/p/xTKNkMtdIf</a></p>\n"}], "owner": {"reputation": 899, "user_id": 8481532, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/91806192f478f41d284c0edff368480a?s=128&d=identicon&r=PG&f=1", "display_name": "lucky yang", "link": "https://stackoverflow.com/users/8481532/lucky-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1791, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1508170085, "creation_date": 1508169503, "question_id": 46774410, "link": "https://stackoverflow.com/questions/46774410/does-a-ticker-tell-a-goroutine-it-is-stopped-through-its-ticker-c", "title": "Does a ticker tell a goroutine it is stopped through its ticker.C?", "body": "<pre><code>package main\nimport \"fmt\"\nimport \"time\"\n\nfunc main() {\n    ticker := time.NewTicker(time.Millisecond * 500)\n    go func() {\n        for t := range ticker.C {\n            fmt.Println(\"Tick at\", t)\n        }\n        fmt.Println(\"ticker stopped\")\n    }()\n    time.Sleep(time.Second * 5)\n    ticker.Stop()\n    time.Sleep(time.Second * 5)\n}\n</code></pre>\n\n<p>I thought when I call ticker.Stop(), ticker.C should tell the goroutine that it is over, so the for loop should end, but it doesn't look like that, the string \"ticker stopped\" is never printed.</p>\n"}, {"tags": ["go", "twitter"], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 7346862, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/084ca301ad69f6ec806973b0a2f5d803?s=128&d=identicon&r=PG&f=1", "display_name": "apaillarse", "link": "https://stackoverflow.com/users/7346862/apaillarse"}, "edited": false, "score": 0, "creation_date": 1508334691, "post_id": 46778052, "comment_id": 80570724, "body": "Thanks for your answer ! Thought it would be working but I didn&#39;t. I edited my first post above to describe my problem. The following link is useful but didn&#39;t solve my problem : <a href=\"https://github.com/ChimeraCoder/anaconda/pull/200\" rel=\"nofollow noreferrer\">github.com/ChimeraCoder/anaconda/pull/200</a>"}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 1, "last_activity_date": 1508183499, "creation_date": 1508183499, "answer_id": 46778052, "question_id": 46773325, "link": "https://stackoverflow.com/questions/46773325/unlocking-tweet-size-with-anaconda/46778052#46778052", "title": "Unlocking tweet size with Anaconda", "body": "<p>I assume you mean 280 char tweets? <a href=\"https://github.com/ChimeraCoder/anaconda/blob/master/tweet.go#L16\" rel=\"nofollow noreferrer\">This</a> might be what you need if so:</p>\n\n<pre><code>fmt.Print(t.ExtendedTweet)\n</code></pre>\n\n<p>If not perhaps give an example tweet with the problem, and check the api results yourself too with curl. </p>\n"}], "owner": {"reputation": 75, "user_id": 7346862, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/084ca301ad69f6ec806973b0a2f5d803?s=128&d=identicon&r=PG&f=1", "display_name": "apaillarse", "link": "https://stackoverflow.com/users/7346862/apaillarse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 46778052, "answer_count": 1, "score": 1, "last_activity_date": 1508334614, "creation_date": 1508166030, "last_edit_date": 1508334614, "question_id": 46773325, "link": "https://stackoverflow.com/questions/46773325/unlocking-tweet-size-with-anaconda", "title": "Unlocking tweet size with Anaconda", "body": "<p>I have trouble unlocking the length of tweets I receive using the anaconda librairy (<a href=\"https://github.com/ChimeraCoder/anaconda\" rel=\"nofollow noreferrer\">https://github.com/ChimeraCoder/anaconda</a>).\nIf tweets are too long, they're truncated and end with \"...\".\nI would like to receive the full message.\nBelow is the code I'm using :</p>\n\n<pre><code>        trackingArray := []string{\"trump\", \"obama\"}\n\n        anaconda.SetConsumerKey(consumerKey)\n        anaconda.SetConsumerSecret(consumerSecret)\n\n        api := anaconda.NewTwitterApi(accessToken, accessTokenSecret)\n\n        stream := api.PublicStreamFilter(url.Values{\n            \"track\":    trackingArray,\n        })\n\n        for v := range stream.C {\n            t, ok := v.(anaconda.Tweet)\n            if !ok {\n               logrus.Warningf(\"received unexpected value of type %T\", v)\n               continue\n           }\n       fmt.Print(t.Text)\n       fmt.Print(t.FullText)\n       }\n</code></pre>\n\n<p>Thanks to the answer below I tried t.FullText but both printing methods print exactly the same tweet (the full tweet if its length is low and a truncated tweet if its length is over 140 characters).\nThanks in advance for your time !</p>\n"}, {"tags": ["mysql", "database", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1508163368, "post_id": 46772320, "comment_id": 80490529, "body": "There&#39;s a ton of different things you can do, from DB optimization, to code optimization, to increased hardware... this is impossibly broad. You should absolutely being using prepared queries (really never build queries with strings as you have in the code quoted), but that probably won&#39;t make a big performance difference. How big are the data sets? What&#39;s CPU/RAM usage look like? Do you have indexes on these tables? How long do the queries take individually? How many are you running? Have you tried it with joins and compared performance?"}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 3, "creation_date": 1508163397, "post_id": 46772320, "comment_id": 80490549, "body": "One thing off the bat, <i>never ever</i> concatenate strings into your query.  That&#39;s how you get SQL injection.  For example, what if your <code>manuf</code> variable ended up having the value <code>&#39;&#39;; DROP TABLE manuf_ids CASCADE; --</code>  Running your query now drops your entire table, and anything else that references it.  Always use parameterized queries instead."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 2, "creation_date": 1508163478, "post_id": 46772320, "comment_id": 80490605, "body": "Also, do you have those tables indexed on the columns you&#39;re filtering on?  Indexing makes a <i>huge</i> different in query time."}, {"owner": {"reputation": 101, "user_id": 2667103, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/491daf5a6d84893e9d4d1bc618ab2999?s=128&d=identicon&r=PG", "display_name": "JDSlimz", "link": "https://stackoverflow.com/users/2667103/jdslimz"}, "edited": false, "score": 0, "creation_date": 1508291241, "post_id": 46772320, "comment_id": 80549974, "body": "I indexed the columns as recommended, and it helped marginally. I moved the program and database to my more powerful VPS and it seems to have solved the issue of speed. I also have those strings going through a test to only allow 4 hex characters and nothing else. That should prevent injections?"}], "owner": {"reputation": 101, "user_id": 2667103, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/491daf5a6d84893e9d4d1bc618ab2999?s=128&d=identicon&r=PG", "display_name": "JDSlimz", "link": "https://stackoverflow.com/users/2667103/jdslimz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 59, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1508162859, "creation_date": 1508162859, "question_id": 46772320, "link": "https://stackoverflow.com/questions/46772320/how-can-i-make-my-mysql-queries-more-efficient-in-go", "title": "How can I make my MySQL queries more efficient in Go?", "body": "<p>I am writing an API in Go (my first hands on with the language) and I have some MySQL queries in loops. When it runs on a larger query it can take more than 7-10 seconds to reply and often times out. Is there a way to make these queries a little more efficient? Is it simply a matter of DB structure, or even more simply server spec?</p>\n\n<p>Server spec is a cheap single core VPS with 512mb RAM.</p>\n\n<p>Go Code for query:</p>\n\n<pre><code>//Vendor search\nreply, err: = db.Query(\"SELECT * FROM manuf_ids WHERE id='\" + manuf + \"';\")\nif err != nil {\n    panic(err.Error())\n}\n\nfor reply.Next() {\n    var manufacturer Manufacturer\n    err = reply.Scan( &amp; manufacturer.ID, &amp; manufacturer.Desc)\n    if err != nil {\n        panic(err.Error())\n    }\n\n    replytwo, err: = db.Query(\"SELECT id,descrip FROM dev_ids WHERE manuf='\" + manuf + \"';\")\n    if err != nil {\n        panic(err.Error())\n    }\n\n    for replytwo.Next() {\n        var devices Device\n        err = replytwo.Scan( &amp; devices.ID, &amp; devices.Desc)\n        if err != nil {\n            panic(err.Error())\n        }\n\n        //Get sub-devices\n        replythree, err: = db.Query(\"SELECT id,descrip FROM sub_dev_ids WHERE parent='\" + devices.ID + \"';\")\n        if err != nil {\n            panic(err.Error())\n        }\n\n        for replythree.Next() {\n            var sub_devices Sub\n            err = replythree.Scan( &amp; sub_devices.ID, &amp; sub_devices.Desc)\n            if err != nil {\n                panic(err.Error())\n            }\n            devices.Subs = append(devices.Subs, sub_devices)\n        }\n        replythree.Close()\n        manufacturer.Devs = append(manufacturer.Devs, devices)\n    }\n    replytwo.Close()\n    results = append(results, manufacturer)\n}\nreply.Close()\n</code></pre>\n\n<p>I have read a little about preparing queries, and I use that in another function for writing to the DB, but I am not sure if that will help here. I did remove my defers from the loops and that helped, but marginally.</p>\n"}, {"tags": ["docker", "go", "gitlab-ci", "gitlab-ci-runner"], "comments": [{"owner": {"reputation": 2230, "user_id": 1503683, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/VWIKJ.jpg?s=128&g=1", "display_name": "PierreF", "link": "https://stackoverflow.com/users/1503683/pierref"}, "edited": false, "score": 0, "creation_date": 1508185358, "post_id": 46771954, "comment_id": 80502813, "body": "Are the filesystem rights the same between <code>~&#47;go</code> and <code>&#47;go</code>? Does the user running the runner process have enough rights to read <code>&#47;go</code>?"}, {"owner": {"reputation": 1865, "user_id": 2670926, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/525181988/picture?type=large", "display_name": "Helge Talvik S&#246;derstr&#246;m", "link": "https://stackoverflow.com/users/2670926/helge-talvik-s%c3%b6derstr%c3%b6m"}, "reply_to_user": {"reputation": 2230, "user_id": 1503683, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/VWIKJ.jpg?s=128&g=1", "display_name": "PierreF", "link": "https://stackoverflow.com/users/1503683/pierref"}, "edited": false, "score": 0, "creation_date": 1508775829, "post_id": 46771954, "comment_id": 80735284, "body": "Hi @jeanMarcAssin, sorry, I missed your comment! I think the runner is running as my own user, not a dedicated one, and the entire path to my code (<code>&#47;go&#47;src&#47;...&#47;myproj</code>) has <code>drwxr-xr-x</code>, so those permissions shouldn&#39;t be a problem?"}], "owner": {"reputation": 1865, "user_id": 2670926, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/525181988/picture?type=large", "display_name": "Helge Talvik S&#246;derstr&#246;m", "link": "https://stackoverflow.com/users/2670926/helge-talvik-s%c3%b6derstr%c3%b6m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 161, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1508161750, "creation_date": 1508161750, "question_id": 46771954, "link": "https://stackoverflow.com/questions/46771954/docker-gitlab-ci-local-runner-mounts-denied", "title": "Docker (GitLab CI local runner): &quot;Mounts denied&quot;", "body": "<p>I'm using GitLab CI, and the excellent <a href=\"https://gitlab.com/gitlab-org/gitlab-runner/issues/312\" rel=\"nofollow noreferrer\">local GitLab CI runner</a> for testing stages before pushing them using the <code>docker exec</code> method.</p>\n\n<p>I use Golang as my language of choice and recently moved my <code>$GOPATH</code> from <code>~/go</code> to <code>/go</code>, as per the official recommendations.</p>\n\n<p>However, now when I try to test my builds, I get this error message:</p>\n\n<pre><code>ERROR: Job failed (system failure): Error response from daemon: Mounts denied:\nThe path /go/src/[redacted] is not shared from Docker -&gt; Preferences... -&gt; File Sharing.\n</code></pre>\n\n<p>Moving the code back to a folder under my home directory, it works again. Attempting the fix in the message gives another error:</p>\n\n<pre><code>rm: cannot remove \u2018rm: cannot remove '/go/src/[redacted]': Read-only file system\n</code></pre>\n\n<p>It's trying to remove the current, local working directory (which is my actual repository, so I obviously do not want that).</p>\n\n<p>What is the proper way to configure Docker (or the runner) to be able to work inside my <code>$GOPATH</code>?</p>\n\n<p>Thanks for your time.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 1, "creation_date": 1508158452, "post_id": 46770744, "comment_id": 80487015, "body": "Please check the help section. A good question shows us what you&#39;ve tried yourself. ATM, this question might as well be a request for others to write your solution for you. In which case, check the source of projects like <a href=\"https://github.com/gorilla/mux#examples\" rel=\"nofollow noreferrer\">gorilla mux</a> and the like, they already implement something very similar to what you&#39;re looking for"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1508158562, "post_id": 46770744, "comment_id": 80487086, "body": "What do you mean by &quot;does not work&quot;? What do you expect to happen? There&#39;s nothing there that would handle any sort of token like <code>#{id}</code>."}, {"owner": {"reputation": 13, "user_id": 8387232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f74643b73412f3a8464db5aee42f1ca?s=128&d=identicon&r=PG&f=1", "display_name": "tien318", "link": "https://stackoverflow.com/users/8387232/tien318"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508224582, "post_id": 46770744, "comment_id": 80515240, "body": "@JimB sorry I mean I dont know how to do it the #{id}"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 8387232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f74643b73412f3a8464db5aee42f1ca?s=128&d=identicon&r=PG&f=1", "display_name": "tien318", "link": "https://stackoverflow.com/users/8387232/tien318"}, "edited": false, "score": 0, "creation_date": 1508224866, "post_id": 46778197, "comment_id": 80515393, "body": "I tried this way at first but it would not accounted for numerous query the url might have. For example if the url like <a href=\"https://123.myshopify.com/admin/orders/count.json?product_id=345&amp;collection_id=567&amp;access_token=123\" rel=\"nofollow noreferrer\">123.myshopify.com/admin/orders/&hellip;</a> then the fmt.Sprintf would not work"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 13, "user_id": 8387232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f74643b73412f3a8464db5aee42f1ca?s=128&d=identicon&r=PG&f=1", "display_name": "tien318", "link": "https://stackoverflow.com/users/8387232/tien318"}, "edited": false, "score": 0, "creation_date": 1508229586, "post_id": 46778197, "comment_id": 80518092, "body": "I&#39;ve given you an example above. Sprintf would of course work, you just need to put the params in. You could put this in a separate function if you prefer. I&#39;d work with strings at this point, not bytes, this is not data. You do not need to parse urls in order to print them, just output a string, which is what http.Client expects for the url."}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 4, "last_activity_date": 1508230229, "last_edit_date": 1508230229, "creation_date": 1508184135, "answer_id": 46778197, "question_id": 46770744, "link": "https://stackoverflow.com/questions/46770744/how-to-parse-create-a-dynamic-url-in-golang/46778197#46778197", "title": "How to parse/create a dynamic url in golang", "body": "<p>Why not just build a url with something simpler at the point where you use it? </p>\n\n<pre><code>url := fmt.Sprintf(\"%s/admin/orders/count.json?access_token=%s&amp;custom=%s\",sd.Domain,sd.Token,customparam)\n</code></pre>\n\n<p>Then use it. This has the virtue of being completely clear as to intent and the url used in each case while sharing the important stuff (shopify domain etc). Then for your question about ids it becomes easier:</p>\n\n<pre><code>url := fmt.Sprintf(\"%s/admin/orders/%d.json?access_token=%s\",sd.Domain,orderID,sd.Token)\n</code></pre>\n\n<p>and </p>\n\n<pre><code>url := fmt.Sprintf(\"%s/admin/products/%d/images/%d.json?access_token=%s\",sd.Domain,productID,imageID,sd.Token)\n</code></pre>\n\n<p>if you feel your params are super complex (for me this would have to be at least 5), just put them in an url.Values (including the token):</p>\n\n<pre><code>params := url.Values{\"myparam\":{\"123\"}, \"token\": {sd.Token}}\nurl := fmt.Sprintf(\"%s/admin/orders/count.json?%s\", sd.Domain, \nparams.Encode())\n</code></pre>\n\n<p>but this is only worthwhile if you have a significant number of params. </p>\n\n<p>If you want to add functions to ShopifyDownloader, why force the caller to define the url structure? Try to make it simpler for them. You don't need to parse urls or write to a bytes buffer, http.Get expects a string, so work with strings. If you want to build functions, consider instead having separate functions which know about the url formats, to abstract this away from the caller, so :</p>\n\n<pre><code> func (sd *ShopifyDownloader) OrderURL(orderID int, params url.Values) string {\n        params[\"token\"] = []string{sd.AccessToken}\n        return fmt.Sprintf(\"%s/admin/orders/%d.json?%s\",sd.Domain,orderID,params)\n    }\n</code></pre>\n\n<p>The caller should not know about the specific format of Shopify urls, which may change (just as the endpoint may change). </p>\n"}], "owner": {"reputation": 13, "user_id": 8387232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f74643b73412f3a8464db5aee42f1ca?s=128&d=identicon&r=PG&f=1", "display_name": "tien318", "link": "https://stackoverflow.com/users/8387232/tien318"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5908, "favorite_count": 3, "accepted_answer_id": 46778197, "answer_count": 1, "score": -3, "last_activity_date": 1508230229, "creation_date": 1508158142, "last_edit_date": 1508162465, "question_id": 46770744, "link": "https://stackoverflow.com/questions/46770744/how-to-parse-create-a-dynamic-url-in-golang", "title": "How to parse/create a dynamic url in golang", "body": "<p>I am trying to create a buildURL function that can generate an url. However I have run into a problem when facing a dynamic url.</p>\n\n<pre><code>type ShopifyDownloader struct {\n    Domain      string\n    AccessToken string\n}\n\nfunc (sd *ShopifyDownloader) BuildURL(Path string, Query map[string]string) (string, error) {\n    u, err := url.Parse(\"https://123.myshopify.com/admin/orders/count.json?access_token=123\")\n    if err != nil {\n        fmt.Println(\"Cannot parse\", err)\n        return \"\", err\n    }\n    u.Host = sd.Domain\n    u.Path = Path\n    params := url.Values{}\n    for key, value := range Query {\n        params.Add(key, value)\n    }\n    u.RawQuery = params.Encode()\n    nu := u.String()\n    var buffer bytes.Buffer\n    buffer.WriteString(nu)\n    buffer.WriteString(\"?access_token=\")\n    buffer.WriteString(sd.AccessToken)\n    bu := buffer.String()\n    return bu, err\n}\n</code></pre>\n\n<p>It takes domain, token, path and queries and generate an url in string. However it does not work with a dynamic path (with id) like \nthis /admin/orders/#{id}.json or this /admin/products/#{id}/images/#{id}.json\nDoes anybody have any suggestion?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1508149455, "post_id": 46767548, "comment_id": 80481314, "body": "if i understand the Api correctly   the IsCreated method  notify for the creation of a file only.  you need to Mack sure that the file inst locked before open it"}, {"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508150043, "post_id": 46767548, "comment_id": 80481729, "body": "I guess the file is still being written while you open it using exclusive r/w, that&#39;s why."}, {"owner": {"reputation": 89, "user_id": 1829307, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/46435d154f416ba5678fe98a75faef61?s=128&d=identicon&r=PG", "display_name": "izac", "link": "https://stackoverflow.com/users/1829307/izac"}, "reply_to_user": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508150581, "post_id": 46767548, "comment_id": 80482045, "body": "@AlessandroSantini how can i catch moment if file i free ?"}, {"owner": {"reputation": 89, "user_id": 1829307, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/46435d154f416ba5678fe98a75faef61?s=128&d=identicon&r=PG", "display_name": "izac", "link": "https://stackoverflow.com/users/1829307/izac"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1508150687, "post_id": 46767548, "comment_id": 80482102, "body": "@MIkCode how can i do this ? can u provide some example pls ?"}, {"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1508151421, "post_id": 46767548, "comment_id": 80482496, "body": "@which OS  need to run  this code ?"}, {"owner": {"reputation": 89, "user_id": 1829307, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/46435d154f416ba5678fe98a75faef61?s=128&d=identicon&r=PG", "display_name": "izac", "link": "https://stackoverflow.com/users/1829307/izac"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1508151455, "post_id": 46767548, "comment_id": 80482514, "body": "@MIkCode UNIX/Win"}, {"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508151612, "post_id": 46767548, "comment_id": 80482595, "body": "@izac I do not believe that this is the right approach. You may check if the file is not used, try to open it, and then figure out that it has been opened for exclusive write again - I guess it is part of the nature of concurrent systems. My question is instead, why do you need to tamper with that file? What is the objective you are trying to accomplish? That would help focusing the answer."}, {"owner": {"reputation": 89, "user_id": 1829307, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/46435d154f416ba5678fe98a75faef61?s=128&d=identicon&r=PG", "display_name": "izac", "link": "https://stackoverflow.com/users/1829307/izac"}, "reply_to_user": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508152318, "post_id": 46767548, "comment_id": 80483018, "body": "@AlessandroSantini It will be webm files , and to find out that there is no such file in the db I need to reset the last Void element in its structure as because of this element may be a different hash with the same content , it is obvious that 1 time with this file will only work for my demon."}, {"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 1, "creation_date": 1508152546, "post_id": 46767548, "comment_id": 80483153, "body": "Can you just edit your question and expand a bit more? Unfortunately English is not my first language and I could not understand what you mean."}, {"owner": {"reputation": 89, "user_id": 1829307, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/46435d154f416ba5678fe98a75faef61?s=128&d=identicon&r=PG", "display_name": "izac", "link": "https://stackoverflow.com/users/1829307/izac"}, "reply_to_user": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508162768, "post_id": 46767548, "comment_id": 80490124, "body": "@AlessandroSantini Upd the question"}, {"owner": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "edited": false, "score": 0, "creation_date": 1508178292, "post_id": 46767548, "comment_id": 80499084, "body": "If you have the control on the part that create the webm file, it could create it under a different folder first and move it afterward. The move (or rename) is instant and the file will not be locked when you will get the notification."}, {"owner": {"reputation": 89, "user_id": 1829307, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/46435d154f416ba5678fe98a75faef61?s=128&d=identicon&r=PG", "display_name": "izac", "link": "https://stackoverflow.com/users/1829307/izac"}, "reply_to_user": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "edited": false, "score": 0, "creation_date": 1508188265, "post_id": 46767548, "comment_id": 80504128, "body": "@mgagnon i create file in another folder and then insert in  watch folder and lib give me create  notification ."}, {"owner": {"reputation": 89, "user_id": 1829307, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/46435d154f416ba5678fe98a75faef61?s=128&d=identicon&r=PG", "display_name": "izac", "link": "https://stackoverflow.com/users/1829307/izac"}, "reply_to_user": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "edited": false, "score": 0, "creation_date": 1508231491, "post_id": 46767548, "comment_id": 80519322, "body": "@mgagnon also i try IsModify function and have same error"}, {"owner": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "edited": false, "score": 0, "creation_date": 1508234576, "post_id": 46767548, "comment_id": 80521174, "body": "@izac have you tried with IsRename?"}, {"owner": {"reputation": 89, "user_id": 1829307, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/46435d154f416ba5678fe98a75faef61?s=128&d=identicon&r=PG", "display_name": "izac", "link": "https://stackoverflow.com/users/1829307/izac"}, "reply_to_user": {"reputation": 159, "user_id": 3573024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d560ff0aeb4ce52219a166547fdb09?s=128&d=identicon&r=PG&f=1", "display_name": "mgagnon", "link": "https://stackoverflow.com/users/3573024/mgagnon"}, "edited": false, "score": 0, "creation_date": 1508498067, "post_id": 46767548, "comment_id": 80643155, "body": "@mgagnon if i use CTRL + C file and CTRL + V in folder then event CREATE and x2 MODIFY and file is not lock , if i use drug&amp;drop file in folder event CREATE and lock."}], "owner": {"reputation": 89, "user_id": 1829307, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/46435d154f416ba5678fe98a75faef61?s=128&d=identicon&r=PG", "display_name": "izac", "link": "https://stackoverflow.com/users/1829307/izac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 911, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1508163508, "creation_date": 1508147823, "last_edit_date": 1508163508, "question_id": 46767548, "link": "https://stackoverflow.com/questions/46767548/wait-file-busy-another-process", "title": "Wait file busy another process", "body": "<p>I try to create some deamon which look the folde and if we insert new file open this file and do some magic, i use this (<a href=\"https://github.com/howeyc/fsnotify\" rel=\"nofollow noreferrer\">https://github.com/howeyc/fsnotify</a>) FS notificator , but if i open file i have error \"The process cannot access the file because it is being used by another process.\" i find a dirty solution whith time sleep 100 ms , but i think this is not clear way </p>\n\n<pre><code>func main(){\nwatcher, err := fsnotify.NewWatcher()\nif err != nil {\n    log.Fatal(err)\n}\n\ndone := make(chan bool)\n\n// Process events\ngo func() {\n    for {\n        select {\n        case ev := &lt;-watcher.Event:\n            if ev.IsCreate() == true {\n                time.Sleep(100 * time.Millisecond)\n                 file,err := os.OpenFile(path+ev.Name,os.O_RDWR|os.O_EXCL,0755)\n                 if err !=nil{\n                   panic(err)\n                 }\n                 //some code\n                 file.Close()\n            }\n        case err := &lt;-watcher.Error:\n            log.Println(\"error:\", err)\n        }\n    }\n}()\n\nerr = watcher.Watch(\"test\")\nif err != nil {\n    log.Fatal(err)\n}\n\n&lt;-done\n\nwatcher.Close()\n}\n</code></pre>\n\n<p>UPD: Why do I have to do this ? \nI have a task to make the database Webm files , in order to determine if I have already such a file in the database I should get the hash of a file , but in the specification of this format (<a href=\"https://matroska.org/technical/specs/index.html\" rel=\"nofollow noreferrer\">https://matroska.org/technical/specs/index.html</a>) is the global bit Void block which stores some information , due to the fact that this unit can store different information from the same file will have different hash values , for this I use my function to find this bit block and reset it.</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 1, "creation_date": 1508145813, "post_id": 46766791, "comment_id": 80479070, "body": "And how it now looks like?"}, {"owner": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 0, "creation_date": 1508147804, "post_id": 46766791, "comment_id": 80480307, "body": "You can use <code>row_number() over (order by id)</code> to generate that number"}, {"owner": {"reputation": 15, "user_id": 4669707, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yv4Bo5P_2eo/AAAAAAAAAAI/AAAAAAAAARo/QvyIy9qoLCY/photo.jpg?sz=128", "display_name": "Prapto Herlambang", "link": "https://stackoverflow.com/users/4669707/prapto-herlambang"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1508148072, "post_id": 46766791, "comment_id": 80480470, "body": "@EugeneLisitsky the question was update."}, {"owner": {"reputation": 15, "user_id": 4669707, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yv4Bo5P_2eo/AAAAAAAAAAI/AAAAAAAAARo/QvyIy9qoLCY/photo.jpg?sz=128", "display_name": "Prapto Herlambang", "link": "https://stackoverflow.com/users/4669707/prapto-herlambang"}, "reply_to_user": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 0, "creation_date": 1508148540, "post_id": 46766791, "comment_id": 80480743, "body": "@a_horse_with_no_name can you explain the code sir.."}], "answers": [{"tags": [], "owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "is_accepted": true, "score": 0, "last_activity_date": 1508147559, "creation_date": 1508147559, "answer_id": 46767462, "question_id": 46766791, "link": "https://stackoverflow.com/questions/46766791/go-lang-increment-number/46767462#46767462", "title": "Go lang increment number", "body": "<p>I do not see the property Nomor populated anywhere.</p>\n\n<p>You should keep a counter and do something like</p>\n\n<pre><code>...\ncurrentBook := models.Book{Nomor: count, ID: id, Name: name, Author: author, Pages: pages}\ncount = count + 1\n...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 679, "user_id": 2888403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9ffa065886a8362661b8f85b2a7156a?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/2888403/david"}, "is_accepted": false, "score": 0, "last_activity_date": 1508179508, "creation_date": 1508179508, "answer_id": 46777097, "question_id": 46766791, "link": "https://stackoverflow.com/questions/46766791/go-lang-increment-number/46777097#46777097", "title": "Go lang increment number", "body": "<p>You could try assinging the values of slice index to a variable and try printing it, something like</p>\n\n<pre><code>{{range $index, _ := .books}}\n</code></pre>\n\n<p>and use the index instead of Nomor</p>\n"}], "owner": {"reputation": 15, "user_id": 4669707, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yv4Bo5P_2eo/AAAAAAAAAAI/AAAAAAAAARo/QvyIy9qoLCY/photo.jpg?sz=128", "display_name": "Prapto Herlambang", "link": "https://stackoverflow.com/users/4669707/prapto-herlambang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4304, "favorite_count": 0, "accepted_answer_id": 46767462, "answer_count": 2, "score": -1, "last_activity_date": 1508179508, "creation_date": 1508145383, "last_edit_date": 1508147213, "question_id": 46766791, "link": "https://stackoverflow.com/questions/46766791/go-lang-increment-number", "title": "Go lang increment number", "body": "<p>I can't make increment number of rows on my table..<br>\nI used revel framework, and try make simple crud.  </p>\n\n<p>The question is: \"How to show increment number with Golang.?\".</p>\n\n<p>This my code of controller <strong>book.go</strong><br>\nThis controller to show data from postgresql database.  </p>\n\n<pre><code>func allBooks() ([]models.Book, error) {\n    //Retrieve\n    books := []models.Book{}\n\n    rows, err := db.Query(\"SELECT id, name, author, pages, publication_date FROM books order by id\")\n    defer rows.Close()\n    if err == nil {\n        for rows.Next() {\n            var id int\n            var name string\n            var author string\n            var pages int\n            var publicationDate pq.NullTime\n\n            err = rows.Scan(&amp;id, &amp;name, &amp;author, &amp;pages, &amp;publicationDate)\n            if err == nil {\n                currentBook := models.Book{ID: id, Name: name, Author: author, Pages: pages}\n                if publicationDate.Valid {\n                    currentBook.PublicationDate = publicationDate.Time\n                }\n\n                books = append(books, currentBook)\n            } else {\n                return books, err\n            }\n\n        }\n    } else {\n        return books, err\n    }\n    return books, err\n}  \n</code></pre>\n\n<p>And this html on my views  <strong>index.html</strong>:  </p>\n\n<pre><code>&lt;table class=\"table table-striped\"&gt;\n  &lt;thead&gt;\n    &lt;tr&gt;\n      &lt;th&gt;No&lt;/th&gt;\n      &lt;th&gt;ID&lt;/th&gt;\n      &lt;th&gt;Name&lt;/th&gt;\n      &lt;th&gt;Author&lt;/th&gt;\n      &lt;th&gt;Pages&lt;/th&gt;\n      &lt;th&gt;Publication Date&lt;/th&gt;\n      &lt;th&gt;Action&lt;/th&gt;\n    &lt;/tr&gt;\n  &lt;/thead&gt;\n  &lt;tbody&gt;\n\n    {{range .books}}\n    &lt;tr&gt;\n      &lt;td&gt;{{.Nomor}}&lt;/td&gt;\n      &lt;td&gt;{{.ID}}&lt;/td&gt;\n      &lt;td&gt;{{.Name}}&lt;/td&gt;\n      &lt;td&gt;{{.Author}}&lt;/td&gt;\n      &lt;td&gt;{{.Pages}}&lt;/td&gt;\n      &lt;td&gt;{{.PublicationDateStr}}&lt;/td&gt;\n    &lt;/tr&gt;\n    {{end}}\n    &lt;tr&gt;\n      &lt;td&gt;&lt;/td&gt;\n      &lt;td&gt;&lt;/td&gt;\n      &lt;td&gt;&lt;/td&gt;\n      &lt;td&gt;&lt;/td&gt;\n      &lt;td&gt;&lt;/td&gt;\n      &lt;td&gt;&lt;a href=\"book.html\" class=\"btn btn-primary\"&gt;New book&lt;/a&gt;&lt;/td&gt;\n    &lt;/tr&gt;\n  &lt;/tbody&gt;\n&lt;/table&gt;  \n</code></pre>\n\n<p>hope result like this  </p>\n\n<pre>\n|No.|ID |Name |Author | Pages | Publication Date  |\n|1  |2  |Jack |Holly  | 255   | 2017-10-15        |\n|2  |4  |hans |Holly  | 255   | 2017-10-15        |\n|3  |6  |Juri |Holly  | 255   | 2017-10-15        |\n|4  |7  |Hank |Holly  | 255   | 2017-10-15        |\n</pre>\n\n<p>but what I get is</p>\n\n<pre>\n|No.|ID |Name |Author | Pages | Publication Date | \n|0  |2  |Jack |Holly  | 255   | 2017-10-15       | \n|0  |4  |hans |Holly  | 255   | 2017-10-15       | \n|0  |6  |Juri |Holly  | 255   | 2017-10-15       | \n|0  |7  |Hank |Holly  | 255   | 2017-10-15       |\n</pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1508140642, "post_id": 46765343, "comment_id": 80476130, "body": "Are you sure you really want to buffer the output in such a situation? Why? Redesign."}, {"owner": {"reputation": 2777, "user_id": 4852094, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/10102767534136292/picture?type=large", "display_name": "Rob", "link": "https://stackoverflow.com/users/4852094/rob"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1508140758, "post_id": 46765343, "comment_id": 80476191, "body": "creating a text based GUI.  Is there a better way?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1508141348, "post_id": 46765343, "comment_id": 80476511, "body": "Text based GUI and buffering the output doesn&#39;t mix well. Just use unbuffered output. At least for the interactive parts."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1508141775, "post_id": 46765343, "comment_id": 80476756, "body": "For text based UI use <a href=\"https://github.com/nsf/termbox-go\" rel=\"nofollow noreferrer\">termbox-go</a>."}, {"owner": {"reputation": 2777, "user_id": 4852094, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/10102767534136292/picture?type=large", "display_name": "Rob", "link": "https://stackoverflow.com/users/4852094/rob"}, "edited": false, "score": 1, "creation_date": 1508141849, "post_id": 46765343, "comment_id": 80476805, "body": "I&#39;m trying to implement from scratch, but I&#39;ve been reviewing their repo"}, {"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 1, "creation_date": 1508143611, "post_id": 46765343, "comment_id": 80477778, "body": "Implementing from scratch without a really compelling motivation is called wasted time."}, {"owner": {"reputation": 2777, "user_id": 4852094, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/10102767534136292/picture?type=large", "display_name": "Rob", "link": "https://stackoverflow.com/users/4852094/rob"}, "edited": false, "score": 2, "creation_date": 1508144602, "post_id": 46765343, "comment_id": 80478339, "body": "I personally disagree, I think implementing from scratch is a great way to get a better grasp of a language...  No need for the negativity."}], "owner": {"reputation": 2777, "user_id": 4852094, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/10102767534136292/picture?type=large", "display_name": "Rob", "link": "https://stackoverflow.com/users/4852094/rob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 161, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1508142503, "creation_date": 1508140145, "last_edit_date": 1508142503, "question_id": 46765343, "link": "https://stackoverflow.com/questions/46765343/using-bufio-in-golang-to-blank-a-line-of-all-text", "title": "Using bufio in Golang to blank a line of all text", "body": "<p>I am using bufio and I want to erase a line.  The issue I'm running into now is I need to overwrite it with blanks and feels programmatically unsafe.  If there an idiomatic way to clear out a line in Stdout?</p>\n\n<pre><code>var Output *bufio.Writer = bufio.NewWriter(os.Stdout)\n\nfunc MoveCursor(x int, y int) {\n    fmt.Fprintf(Output, \"\\033[%d;%dH\", y, x)\n}\n\nfunc Print(a ...interface{}) (n int, err error) {\n    return fmt.Fprint(Output, a...)\n}\n\nOutput.Flush()\nscanner := bufio.NewScanner(os.Stdin)\nconst BLANK = \"                                                      \"\n\nfor {\n    MoveCursor(1, 1)\n    Print(BLANK)\n    MoveCursor(1, 1)\n    Print(\"Hello \", scanner.Text())\n    MoveCursor(1, 4)\n    Print(BLANK)\n    MoveCursor(1, 4)\n    Print(\"&gt; \")\n    Output.Flush()\n    scanner.Scan()\n}\n</code></pre>\n\n<p>One thing that is especially surprising is that Output.Flush() doesn't clear the entire content of the screen.</p>\n"}, {"tags": ["go", "oauth-2.0", "google-cloud-endpoints"], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 1184088, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cda0043e86122e2256ac2afe5d05279a?s=128&d=identicon&r=PG", "display_name": "user1184088", "link": "https://stackoverflow.com/users/1184088/user1184088"}, "edited": false, "score": 0, "creation_date": 1508196139, "post_id": 46777374, "comment_id": 80506732, "body": "Per endpoints documentation, the URL of the app engine service (<code>basePath</code> in this case) is the correct value for scopes.  Edit for premature replay: will find relevant documentation"}, {"owner": {"reputation": 2535, "user_id": 2117651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec864545b6a1a66df65cccec044bec5f?s=128&d=identicon&r=PG", "display_name": "saiyr", "link": "https://stackoverflow.com/users/2117651/saiyr"}, "reply_to_user": {"reputation": 51, "user_id": 1184088, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cda0043e86122e2256ac2afe5d05279a?s=128&d=identicon&r=PG", "display_name": "user1184088", "link": "https://stackoverflow.com/users/1184088/user1184088"}, "edited": false, "score": 0, "creation_date": 1508209794, "post_id": 46777374, "comment_id": 80510082, "body": "I&#39;m fairly certain that&#39;s not the case. For service account auth, the service name can be used as the audience, but the base path should be in neither, and audience is distinct from scope."}], "tags": [], "owner": {"reputation": 2535, "user_id": 2117651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec864545b6a1a66df65cccec044bec5f?s=128&d=identicon&r=PG", "display_name": "saiyr", "link": "https://stackoverflow.com/users/2117651/saiyr"}, "is_accepted": false, "score": 1, "last_activity_date": 1508180626, "creation_date": 1508180626, "answer_id": 46777374, "question_id": 46765300, "link": "https://stackoverflow.com/questions/46765300/endpoints-google-id-jwt-and-golang-oauth2-have-id-token-need-access-token/46777374#46777374", "title": "Endpoints Google ID JWT, and Golang oauth2: have id_token, need access_token?", "body": "<p>It would be expected for the oauth client to return <code>id_token</code> instead of <code>access_token</code>. You're using <code>JWTConfigFromJSON</code>, not <code>ConfigFromJSON</code>, which is correct. I think the second argument to <code>JWTConfigFromJSON</code> is incorrect, and you should be specifying scopes instead. In this case, try <code>\"email\"</code> instead of <code>basePath</code>.</p>\n"}], "owner": {"reputation": 51, "user_id": 1184088, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cda0043e86122e2256ac2afe5d05279a?s=128&d=identicon&r=PG", "display_name": "user1184088", "link": "https://stackoverflow.com/users/1184088/user1184088"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 974, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1508180626, "creation_date": 1508139983, "question_id": 46765300, "link": "https://stackoverflow.com/questions/46765300/endpoints-google-id-jwt-and-golang-oauth2-have-id-token-need-access-token", "title": "Endpoints Google ID JWT, and Golang oauth2: have id_token, need access_token?", "body": "<p>I have an app engine app behind endpoints and I'm having trouble following the documentation around adding authentication. My preference is to allow service accounts within the project through, then perform more granular app-side authorization.</p>\n\n<p>In my case, most clients will be outside GCP and will be automated programs not people, so I'm using JSON key files thinking that is the way to go (correct me if I'm wrong please). I also don't want to have to redeploy the app to change user configs, so I follow the \"GOOGLE ID JWT\" information in the documentation from here:</p>\n\n<p><a href=\"https://cloud.google.com/endpoints/docs/openapi/service-to-service-auth\" rel=\"nofollow noreferrer\">https://cloud.google.com/endpoints/docs/openapi/service-to-service-auth</a></p>\n\n<p>This is the security sections of my swagger JSON:</p>\n\n<pre><code>  \"securityDefinitions\": {\n    \"api_key\": {\n      \"type\": \"apiKey\",\n      \"name\": \"key\",\n      \"in\": \"query\"\n    },\n    \"google_id_token\": {\n      \"authorizationUrl\": \"\",\n      \"flow\": \"implicit\",\n      \"type\": \"oauth2\",\n      \"x-google-issuer\": \"https://accounts.google.com\"\n    }\n  },\n  \"security\": [\n    {\n      \"api_key\": [],\n      \"google_id_token\": []\n    }\n  ]\n</code></pre>\n\n<p>This deploys OK, but I am stumped on what to do from the client side to make use of the service account JSON.</p>\n\n<p>In Go, I use the following, based on my understanding of the oauth2/google documentation:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"os\"\n\n    \"golang.org/x/oauth2/google\"\n)\n\nfunc main() {\n    ctx := context.Background()\n    apiKey := os.Getenv(\"API_KEY\")\n    basePath := \"https://SERVICE_NAME-dot-PROJECT_NAME.appspot.com\" // changed for privacy\n\n    creds, _ := google.FindDefaultCredentials(ctx)\n    jwt, _ := google.JWTConfigFromJSON(creds.JSON, basePath)\n\n    client := jwt.Client(ctx)\n    res, _ := client.Get(fmt.Sprintf(\"%s/REQUEST_PATH?key=%s\", basePath, apiKey)) // changed for privacy\n\n    body, _ := ioutil.ReadAll(res.Body)\n    log.Printf(\"### http status: %d %s\", res.StatusCode, res.Status)\n    log.Printf(\"### http body: %s\", body)\n}\n</code></pre>\n\n<p>I've removed error-checking for this code paste for brevity, there are no errors when I run this. The result of this being:</p>\n\n<pre><code>2017/10/16 07:32:38 ### http status: 401 401 Unauthorized\n2017/10/16 07:32:38 ### http body: {\n \"code\": 16,\n \"message\": \"JWT validation failed: Missing or invalid credentials\",\n \"details\": [\n  {\n   \"@type\": \"type.googleapis.com/google.rpc.DebugInfo\",\n   \"stackEntries\": [],\n   \"detail\": \"auth\"\n  }\n ]\n}\n</code></pre>\n\n<p>Upon inspection of the internals of what's happening, such as calling <code>jwt.TokenSource(ctx).Token()</code>, I see that Google is returning an <code>id_token</code>, but no <code>access_token</code> (spotted by adding some debug logs to the jwt package):</p>\n\n<pre><code>2017/10/16 07:38:47 ### oauth2/jwt -&gt; tokenURL: https://accounts.google.com/o/oauth2/token, form: url.Values{\"grant_type\":[]string{\"urn:ietf:params:oauth:grant-type:jwt-bearer\"}, \"assertion\":[]string{\"...cut...\"}}\n2017/10/16 07:38:47 ### oauth2/jwt &lt;- response: {\n  \"id_token\" : \"...cut...\"\n}\n2017/10/16 07:38:47 ### oauth2/jwt &lt;- token: &amp;oauth2.Token{AccessToken:\"\", TokenType:\"\", RefreshToken:\"\", Expiry:time.Time{wall:0x0, ext:63643740079, loc:(*time.Location)(0x1424160)}, raw:map[string]interface {}{\"id_token\":\"...cut...\"}}\n</code></pre>\n\n<p>So when the oauth2 HTTP transport tries to add the auth header -- which is tied to the AccessToken field above -- it results in a string like <code>Authorization: Bearer</code>, thus the result fails.</p>\n\n<p>I feel like I'm missing a step here which isn't obvious to me in the documentation.</p>\n\n<p>Thanks for your time.</p>\n"}, {"tags": ["json", "string", "go", "serialization", "format"], "answers": [{"comments": [{"owner": {"reputation": 1239, "user_id": 5421426, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/96a1eeb26ff88da78645596f42df3735?s=128&d=identicon&r=PG", "display_name": "Dr.Nemo", "link": "https://stackoverflow.com/users/5421426/dr-nemo"}, "edited": false, "score": 0, "creation_date": 1508139912, "post_id": 46765168, "comment_id": 80475727, "body": "Wonderful solution. Thank you."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1508162550, "post_id": 46765168, "comment_id": 80489964, "body": "Incidentally, you can just use <code>%q</code> instead of <code>%s</code> and it&#39;ll quote the string for you.  <a href=\"https://play.golang.org/p/RYhaMM5kpd\" rel=\"nofollow noreferrer\">play.golang.org/p/RYhaMM5kpd</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1508162972, "post_id": 46765168, "comment_id": 80490255, "body": "@Kaedys You made me realize I forgot about potential quotes in the input. I updated the question to suggest use of the <code>json</code> package itself to take care of those."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1508163128, "post_id": 46765168, "comment_id": 80490358, "body": "Good call, though the <code>%q</code> token to <code>fmt.Sprintf()</code> will automatically escape any quotes in the input string as well."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1508163177, "post_id": 46765168, "comment_id": 80490395, "body": "@Kaedys Yes, in this case both would work. But in general it&#39;s best to leave escaping to the <code>json</code> package which will handle all cases."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1508170911, "last_edit_date": 1508170911, "creation_date": 1508139425, "answer_id": 46765168, "question_id": 46764908, "link": "https://stackoverflow.com/questions/46764908/how-to-correctly-serialize-embedded-struct-with-string-method-to-json-string/46765168#46765168", "title": "How to correctly serialize embedded struct with String() method to JSON string?", "body": "<p>To generate the JSON representation of a Go value, the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\"><code>encoding/json</code></a> package checks if the value implements the <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"nofollow noreferrer\"><code>json.Marshaler</code></a> or the <a href=\"https://golang.org/pkg/encoding/#TextMarshaler\" rel=\"nofollow noreferrer\"><code>encoding.TextMarshaler</code></a> interfaces, and if so, they are used / called (in this order). This is documented at <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\"><code>json.Marshal()</code></a>:</p>\n\n<blockquote>\n  <p>Marshal traverses the value v recursively. If an encountered value implements the Marshaler interface and is not a nil pointer, Marshal calls its MarshalJSON method to produce JSON. If no MarshalJSON method is present but the value implements encoding.TextMarshaler instead, Marshal calls its MarshalText method and encodes the result as a JSON string.</p>\n</blockquote>\n\n<p>The <code>json/encoding</code> package doesn't care about the <code>String()</code> method. So if you want to control the JSON representation / output of your value (the <code>Ticket</code> struct), implement <code>json.Marshaler</code> on it (in which you may call <code>String()</code> to your liking):</p>\n\n<pre><code>func (t Ticket) MarshalJSON() ([]byte, error) {\n    return []byte(`\"` + t.String() + `\"`), nil\n}\n</code></pre>\n\n<p>Then the output will be as you desire:</p>\n\n<pre><code>{\"Name\":\"John\",\"Ticket\":\"New York - Washington\"}\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/b09uEAqOH_\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p><strong>One thing to look out for:</strong> if the <code>string</code> produced by <code>Ticket.String()</code> would contain a quotation mark <code>\"</code>, the output would become invalid JSON, or more likely <code>json.Marshal()</code> would return an error.</p>\n\n<p><strong>To take care of such escaping, best / easiest is to use the <code>json</code> package itself: tell it to JSON-encode the <code>string</code> result of <code>Ticket.String()</code>:</strong></p>\n\n<pre><code>func (t Ticket) MarshalJSON() ([]byte, error) {\n    return json.Marshal(t.String())\n}\n</code></pre>\n\n<p>Now if we test it like this:</p>\n\n<pre><code>p.Name = \"John\"\np.Tkt.From = \"New\\\" York\" // CONTAINS QUOTE\np.Tkt.To = \"Washington\"\n\nbuf, err := json.Marshal(p)\nfmt.Println(string(buf), err)\n</code></pre>\n\n<p>The output will still be a valid JSON (try it on the <a href=\"https://play.golang.org/p/nROMV6dyri\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{\"Name\":\"John\",\"Ticket\":\"New\\\" York - Washington\"} &lt;nil&gt;\n</code></pre>\n"}], "owner": {"reputation": 1239, "user_id": 5421426, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/96a1eeb26ff88da78645596f42df3735?s=128&d=identicon&r=PG", "display_name": "Dr.Nemo", "link": "https://stackoverflow.com/users/5421426/dr-nemo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 601, "favorite_count": 1, "accepted_answer_id": 46765168, "answer_count": 1, "score": 3, "last_activity_date": 1508170911, "creation_date": 1508138488, "last_edit_date": 1508141694, "question_id": 46764908, "link": "https://stackoverflow.com/questions/46764908/how-to-correctly-serialize-embedded-struct-with-string-method-to-json-string", "title": "How to correctly serialize embedded struct with String() method to JSON string?", "body": "<pre><code> package main\n\n import (\n    \"fmt\"\n    \"encoding/json\"\n )\n\n type Ticket struct {\n    From string\n    To   string\n}\n\nfunc (t Ticket) String() string {\n    return fmt.Sprintf(\"%s - %s\", t.From, t.To)\n}\n\ntype Passenger struct {\n    Name string `json:\"Name\"`\n    Tkt  Ticket `json:\"Ticket\"`\n}\n\nfunc main() {\n    p := Passenger{}\n    p.Name = \"John\"\n    p.Tkt.From = \"New York\"\n    p.Tkt.To = \"Washington\"\n\n    buf, _ := json.Marshal(p)\n    fmt.Println(string(buf))\n}\n</code></pre>\n\n<p>This code outputs:</p>\n\n<pre><code> {\"Name\":\"John\",\"Ticket\":{\"From\":\"New York\",\"To\":\"Washington\"}}\n</code></pre>\n\n<p>But, using <code>json.Marshal()</code> method (it's easy and friendly for complex struct), how to make it output like this:</p>\n\n<pre><code> {\"Name\":\"John\",\"Ticket\":\"New York - Washington\"}\n</code></pre>\n"}, {"tags": ["file", "go", "io"], "comments": [{"owner": {"reputation": 5986, "user_id": 161222, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/212ca1d74ff55e4ba7c1363f7c0fb55f?s=128&d=identicon&r=PG", "display_name": "Radi", "link": "https://stackoverflow.com/users/161222/radi"}, "edited": false, "score": 0, "creation_date": 1508139679, "post_id": 46764241, "comment_id": 80475618, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/3183582/what-is-the-fastest-substring-search-algorithm\">What is the fastest substring search algorithm?</a>"}, {"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508143927, "post_id": 46764241, "comment_id": 80477930, "body": "Is it the first occurrence or any occurrence? Scanning from the bottom suggests the former, but just to double check."}, {"owner": {"reputation": 122, "user_id": 2728010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf368fa3f6bd958386a88440864b6330?s=128&d=identicon&r=PG&f=1", "display_name": "sks", "link": "https://stackoverflow.com/users/2728010/sks"}, "reply_to_user": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508145397, "post_id": 46764241, "comment_id": 80478792, "body": "@AlessandroSantini It should find out the first occurrence."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1508328702, "last_edit_date": 1508328702, "creation_date": 1508146381, "answer_id": 46767098, "question_id": 46764241, "link": "https://stackoverflow.com/questions/46764241/read-log-file-from-the-end-and-get-the-offset-of-a-particular-string/46767098#46767098", "title": "Read log file from the end and get the offset of a particular string", "body": "<p><strong>Note:</strong> I optimized and improved the below solution, and released it as a library here: <a href=\"https://github.com/icza/backscanner\" rel=\"noreferrer\"><code>github.com/icza/backscanner</code></a></p>\n\n<hr>\n\n<p><a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"noreferrer\"><code>bufio.Scanner</code></a> uses an <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"noreferrer\"><code>io.Reader</code></a> as its source, which does not support seeking and / or reading from arbitrary positions, so it is not capable of scanning lines from the end. <code>bufio.Scanner</code> can only read any part of the input once all data preceeding it has already been read (that is, it can only read the end of the file if it reads all the file's content first).</p>\n\n<p>So we need a custom solution to implement such functionality. Fortunately <a href=\"https://golang.org/pkg/os/#File\" rel=\"noreferrer\"><code>os.File</code></a> does support reading from arbitrary positions as it implements both <a href=\"https://golang.org/pkg/io/#Seeker\" rel=\"noreferrer\"><code>io.Seeker</code></a> and <a href=\"https://golang.org/pkg/io/#ReaderAt\" rel=\"noreferrer\"><code>io.ReaderAt</code></a> (any of them would be sufficient to do what we need).</p>\n\n<h2>Scanner that returns lines going backward, starting at the end</h2>\n\n<p>Let's construct a <code>Scanner</code> which scans lines <em>backward</em>, starting with the last line. For this, we'll utilize an <code>io.ReaderAt</code>. The following implementation uses an internal buffer into which data is read by chunks, starting from the end of the input. The size of the input must also be passed (which is basically the position where we want to start reading from, which must not necessarily be the end position).</p>\n\n<pre><code>type Scanner struct {\n    r   io.ReaderAt\n    pos int\n    err error\n    buf []byte\n}\n\nfunc NewScanner(r io.ReaderAt, pos int) *Scanner {\n    return &amp;Scanner{r: r, pos: pos}\n}\n\nfunc (s *Scanner) readMore() {\n    if s.pos == 0 {\n        s.err = io.EOF\n        return\n    }\n    size := 1024\n    if size &gt; s.pos {\n        size = s.pos\n    }\n    s.pos -= size\n    buf2 := make([]byte, size, size+len(s.buf))\n\n    // ReadAt attempts to read full buff!\n    _, s.err = s.r.ReadAt(buf2, int64(s.pos))\n    if s.err == nil {\n        s.buf = append(buf2, s.buf...)\n    }\n}\n\nfunc (s *Scanner) Line() (line string, start int, err error) {\n    if s.err != nil {\n        return \"\", 0, s.err\n    }\n    for {\n        lineStart := bytes.LastIndexByte(s.buf, '\\n')\n        if lineStart &gt;= 0 {\n            // We have a complete line:\n            var line string\n            line, s.buf = string(dropCR(s.buf[lineStart+1:])), s.buf[:lineStart]\n            return line, s.pos + lineStart + 1, nil\n        }\n        // Need more data:\n        s.readMore()\n        if s.err != nil {\n            if s.err == io.EOF {\n                if len(s.buf) &gt; 0 {\n                    return string(dropCR(s.buf)), 0, nil\n                }\n            }\n            return \"\", 0, s.err\n        }\n    }\n}\n\n// dropCR drops a terminal \\r from the data.\nfunc dropCR(data []byte) []byte {\n    if len(data) &gt; 0 &amp;&amp; data[len(data)-1] == '\\r' {\n        return data[0 : len(data)-1]\n    }\n    return data\n}\n</code></pre>\n\n<p>Example using it:</p>\n\n<pre><code>func main() {\n    scanner := NewScanner(strings.NewReader(src), len(src))\n    for {\n        line, pos, err := scanner.Line()\n        if err != nil {\n            fmt.Println(\"Error:\", err)\n            break\n        }\n        fmt.Printf(\"Line start: %2d, line: %s\\n\", pos, line)\n    }\n}\n\nconst src = `Start\nLine1\nLine2\nLine3\nEnd`\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/Wujr0QcL3P\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Line start: 24, line: End\nLine start: 18, line: Line3\nLine start: 12, line: Line2\nLine start:  6, line: Line1\nLine start:  0, line: Start\nError: EOF\n</code></pre>\n\n<p><strong>Notes:</strong></p>\n\n<ul>\n<li>The above <code>Scanner</code> does not limit max length of lines, it handles all.</li>\n<li>The above <code>Scanner</code> handles both <code>\\n</code> and <code>\\r\\n</code> line endings (ensured by the <code>dropCR()</code> function).</li>\n<li>You may pass any starter position not just the size / length, and listing lines will be performed from there (continuation).</li>\n<li>The above <code>Scanner</code> does not reuse buffers, always creates new ones when needed. It would be enough to (pre)allocate 2 buffers, and use those wisely. Implementation would become more complex, and it would introduce a max line length limit.</li>\n</ul>\n\n<h2>Using it with a file</h2>\n\n<p>To use this <code>Scanner</code> with a file, you may use <code>os.Open()</code> to open a file. Note that <code>*File</code> implements <code>io.ReaderAt()</code>. Then you may use <a href=\"https://golang.org/pkg/os/#File.Stat\" rel=\"noreferrer\"><code>File.Stat()</code></a> to obtain info about the file (<a href=\"https://golang.org/pkg/os/#FileInfo\" rel=\"noreferrer\"><code>os.FileInfo</code></a>), including its size (length):</p>\n\n<pre><code>f, err := os.Open(\"a.txt\")\nif err != nil {\n    panic(err)\n}\nfi, err := f.Stat()\nif err != nil {\n    panic(err)\n}\ndefer f.Close()\n\nscanner := NewScanner(f, int(fi.Size()))\n</code></pre>\n\n<h2>Looking for a substring in a line</h2>\n\n<p>If you're looking for a substring in a line, then simply use the above <code>Scanner</code> which returns the starting pos of each line, reading lines from the end.</p>\n\n<p>You may check the substring in each line using <a href=\"https://golang.org/pkg/strings/#Index\" rel=\"noreferrer\"><code>strings.Index()</code></a>, which returns the substring position inside the line, and if found, add the line start position to this.</p>\n\n<p>Let's say we're looking for the <code>\"ine2\"</code> substring (which is part of the <code>\"Line2\"</code> line). Here's how you can do that:</p>\n\n<pre><code>scanner := NewScanner(strings.NewReader(src), len(src))\nwhat := \"ine2\"\nfor {\n    line, pos, err := scanner.Line()\n    if err != nil {\n        fmt.Println(\"Error:\", err)\n        break\n    }\n    fmt.Printf(\"Line start: %2d, line: %s\\n\", pos, line)\n\n    if i := strings.Index(line, what); i &gt;= 0 {\n        fmt.Printf(\"Found %q at line position: %d, global position: %d\\n\",\n            what, i, pos+i)\n        break\n    }\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/ixMatyaSMA\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Line start: 24, line: End\nLine start: 18, line: Line3\nLine start: 12, line: Line2\nFound \"ine2\" at line position: 1, global position: 13\n</code></pre>\n"}], "owner": {"reputation": 122, "user_id": 2728010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bf368fa3f6bd958386a88440864b6330?s=128&d=identicon&r=PG&f=1", "display_name": "sks", "link": "https://stackoverflow.com/users/2728010/sks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1106, "favorite_count": 0, "accepted_answer_id": 46767098, "answer_count": 1, "score": 4, "last_activity_date": 1508328702, "creation_date": 1508135800, "last_edit_date": 1508148212, "question_id": 46764241, "link": "https://stackoverflow.com/questions/46764241/read-log-file-from-the-end-and-get-the-offset-of-a-particular-string", "title": "Read log file from the end and get the offset of a particular string", "body": "<p>.e.g. \n1. <em>logfile</em></p>\n\n<ul>\n<li>Start</li>\n<li>Line1</li>\n<li>Line2</li>\n<li>Line3</li>\n<li>End</li>\n</ul>\n\n<p>I am able to get the seek position of Line1 when I read the file from beginning.</p>\n\n<pre><code>func getSeekLocation() int64 {\n    start := int64(0)\n    input, err := os.Open(logFile)\n    if err != nil {\n        fmt.Println(err)\n    }\n    if _, err := input.Seek(start, io.SeekStart); err != nil {\n        fmt.Println(err)\n    }\n    scanner := bufio.NewScanner(input)\n\n    pos := start\n    scanLines := func(data []byte, atEOF bool) (advance int, token []byte, \n    err error) {\n        advance, token, err = bufio.ScanLines(data, atEOF)\n        pos += int64(advance)\n        return\n    }\n    scanner.Split(scanLines)\n    for scanner.Scan() {\n       if strings.Contains(scanner.Text(), \"Line1\") {\n        break\n       }\n    }\n    size, err := getFileSize()\n    if err != nil {\n        fmt.Println(err)\n    }\n    return size - pos\n}\n</code></pre>\n\n<p>But this is not an efficient way to solve the problem because as the file size increases the time to get the location will also increase. \nI would like to get the location of the line from the EOF location which I think would be more efficient. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 4, "creation_date": 1508129446, "post_id": 46763057, "comment_id": 80471429, "body": "<a href=\"https://stackoverflow.com/help/mcve\">create a Minimal, Complete, and Verifiable example</a>, and more specifically, show the definition of Stack."}, {"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "edited": false, "score": 0, "creation_date": 1508129460, "post_id": 46763057, "comment_id": 80471435, "body": "please show the whole code."}, {"owner": {"reputation": 101, "user_id": 3898856, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/4ba41455a288f3a09a706c4797615b76?s=128&d=identicon&r=PG&f=1", "display_name": "Ani", "link": "https://stackoverflow.com/users/3898856/ani"}, "edited": false, "score": 0, "creation_date": 1508129720, "post_id": 46763057, "comment_id": 80471507, "body": "That&#39;s all there to it. I&#39;m learning go and just trying an exercise from chapter 6 of Way to Go."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1508129903, "post_id": 46763057, "comment_id": 80471553, "body": "OK, the first issue is that you need to define the <code>Stack</code> type.  If Way to Go is on the web, then please share a link."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 3, "creation_date": 1508130169, "post_id": 46763057, "comment_id": 80471630, "body": "<a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">tour.golang.org/welcome/1</a>"}, {"owner": {"reputation": 101, "user_id": 3898856, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/4ba41455a288f3a09a706c4797615b76?s=128&d=identicon&r=PG&f=1", "display_name": "Ani", "link": "https://stackoverflow.com/users/3898856/ani"}, "edited": false, "score": 0, "creation_date": 1508130528, "post_id": 46763057, "comment_id": 80471749, "body": "I&#39;m sorry but it isn&#39;t available online. I think I got the issue. Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1508131127, "creation_date": 1508131127, "answer_id": 46763379, "question_id": 46763057, "link": "https://stackoverflow.com/questions/46763057/syntactical-golang-error-with-func/46763379#46763379", "title": "Syntactical Golang error with func", "body": "<ol>\n<li><p>define <code>Stack</code> type</p></li>\n<li><p>in <code>main</code> create a variable of it</p></li>\n<li><p>call <code>Pop</code> on it</p></li>\n</ol>\n\n<p>code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Stack []int\n\nfunc (st Stack) Pop() int {\n    v := 0\n    for ix := len(st) - 1; ix &gt;= 0; ix-- {\n        if v = st[ix]; v != 0 {\n            st[ix] = 0\n            return v\n        }\n    }\n    return 0\n}\n\nfunc main() {\n    s := Stack{1, 2, 3, 4}\n    i := s.Pop()\n    fmt.Println(i)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/PSac-C0xJM\" rel=\"nofollow noreferrer\">https://play.golang.org/p/PSac-C0xJM</a></p>\n"}], "owner": {"reputation": 101, "user_id": 3898856, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/4ba41455a288f3a09a706c4797615b76?s=128&d=identicon&r=PG&f=1", "display_name": "Ani", "link": "https://stackoverflow.com/users/3898856/ani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "answer_count": 1, "score": -8, "last_activity_date": 1508131127, "creation_date": 1508128816, "question_id": 46763057, "link": "https://stackoverflow.com/questions/46763057/syntactical-golang-error-with-func", "title": "Syntactical Golang error with func", "body": "<p>Why does the code below throw unexpected func error ? I see error ./func_correct.go:4: syntax error: unexpected func, expecting name</p>\n\n<pre><code>package main\n\nfunc (st  *Stack)  Pop() int {\n        v := 0\n        for ix := len (st) - 1; ix &gt;= 0; ix-- {\n                if v = st[ix]; v != 0 {\n                    st[ix] = 0\n                    return v\n                }\n        }\n        return 0\n}\n\nfunc main() {\n   Pop()    \n}\n</code></pre>\n"}, {"tags": ["go", "mgo"], "comments": [{"owner": {"reputation": 2953, "user_id": 5133088, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d0efad94ced5dcd194c0a482cafd4f7b?s=128&d=identicon&r=PG&f=1", "display_name": "Jeroen Heier", "link": "https://stackoverflow.com/users/5133088/jeroen-heier"}, "edited": false, "score": 0, "creation_date": 1508125956, "post_id": 46762446, "comment_id": 80470611, "body": "Are you looking for something like <a href=\"https://github.com/mongodb/mongo-tools/blob/master/common/bsonutil/converter.go\" rel=\"nofollow noreferrer\">this</a>?"}, {"owner": {"reputation": 41, "user_id": 8782014, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213930206590382/picture?type=large", "display_name": "Thomas Evans", "link": "https://stackoverflow.com/users/8782014/thomas-evans"}, "reply_to_user": {"reputation": 2953, "user_id": 5133088, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d0efad94ced5dcd194c0a482cafd4f7b?s=128&d=identicon&r=PG&f=1", "display_name": "Jeroen Heier", "link": "https://stackoverflow.com/users/5133088/jeroen-heier"}, "edited": false, "score": 0, "creation_date": 1508127193, "post_id": 46762446, "comment_id": 80470887, "body": "Not quite, I&#39;d like to take it to a go struct first as to do any processing necessary."}], "answers": [{"tags": [], "owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "is_accepted": false, "score": 1, "last_activity_date": 1508144113, "last_edit_date": 1508144113, "creation_date": 1508142590, "answer_id": 46765988, "question_id": 46762446, "link": "https://stackoverflow.com/questions/46762446/how-do-i-unmarshal-the-bson-from-mongo-of-a-nested-interface-with-mgo/46765988#46765988", "title": "How do I Unmarshal the bson from mongo of a nested interface with mgo?", "body": "<p>I think it is evident that an interface cannot be instantiated, therefore the <code>bson</code> runtime does not know which <code>struct</code> has to be used to <code>Unmarshal</code> that object. Additionally, your <code>customInterface</code> type should be exported (i.e. with capital \"C\") otherwise it won't be accessible from the <code>bson</code> runtime.</p>\n\n<p>I suspect that using an interface implies that the NestedDocuments array may contain different types, all implementing <code>customInterface</code>.</p>\n\n<p>If that's the case, I am afraid that you will have to do some changes:</p>\n\n<p>Firstly, <code>NestedDocument</code> need to be a struct holding your document plus some information to help the decoder understand what's the underpinning type. Something like:</p>\n\n<pre><code>type Document struct {\n  Props here....\n  Nested []NestedDocument\n}\n\ntype NestedDocument struct {\n  Kind string\n  Payload bson.Raw\n}\n\n// Document provides \nfunc (d NestedDocument) Document() (CustomInterface, error) {\n   switch d.Kind {\n     case \"TypeA\":\n       // Here I am safely assuming that TypeA implements CustomInterface\n       result := &amp;TypeA{}\n       err := d.Payload.Unmarshal(result)\n       if err != nil {\n          return nil, err\n       }\n       return result, nil\n       // ... other cases and default\n   }\n}\n</code></pre>\n\n<p>In this way, the <code>bson</code> runtime will decode the whole <code>Document</code> but leave the payload as a <code>[]byte</code>.</p>\n\n<p>Once you have decoded the main <code>Document</code>, you can use the <code>NestedDocument.Document()</code> function to get a concrete representation of your <code>struct</code>.</p>\n\n<p>One last thing; when you persist your <code>Document</code>, make sure that <code>Payload.Kind</code> is set to <strong>3</strong>, which represents an embedded document. See the BSON specifications for more details on this.</p>\n\n<p>Hope it is all clear and good luck with your project.</p>\n"}], "owner": {"reputation": 41, "user_id": 8782014, "user_type": "registered", "profile_image": "https://graph.facebook.com/10213930206590382/picture?type=large", "display_name": "Thomas Evans", "link": "https://stackoverflow.com/users/8782014/thomas-evans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 954, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1508144113, "creation_date": 1508123774, "question_id": 46762446, "link": "https://stackoverflow.com/questions/46762446/how-do-i-unmarshal-the-bson-from-mongo-of-a-nested-interface-with-mgo", "title": "How do I Unmarshal the bson from mongo of a nested interface with mgo?", "body": "<p>I have a collection of documents that contain an array of a custom interface type that I have. Example below. What do I need to do to Unmarshal the bson from mongo so I can eventually return a JSON response?</p>\n\n<pre><code>type Document struct {\n  Props here....\n  NestedDocuments customInterface\n}\n</code></pre>\n\n<p>What do I need to do to map the nested interfaces to the right structs?</p>\n"}, {"tags": ["session", "go", "cookies", "gorilla"], "comments": [{"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 0, "creation_date": 1508118274, "post_id": 46761750, "comment_id": 80468998, "body": "Just a comment - please dont downvote my post. I&#39;ll answer any questions you have (if I can). Also, yes I know, gorilla sessions works across multiple functions. But not this implementation somehow (or the browser cookies are FUBAR). -thanks."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1508120675, "post_id": 46761750, "comment_id": 80469482, "body": "Print w.Header()[&quot;Set-Cookie&quot;] at the end of the handler and check that the cookies make sense."}, {"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1508121826, "post_id": 46761750, "comment_id": 80469715, "body": "@ Cerise Lim&#243;n this is what I get.  Looks pretty ok to me [cookies4dndyo=MTUwODEyMTczNHxEdi1CQkFFQ180SUFBUkFCRUFBQVd2L&zwnj;&#8203;UNBQUlHYzNSeWFXNW5EQ&zwnj;&#8203;WtBQjNSbGMzUnBibWNHY&zwnj;&#8203;zNSeWFXNW5EQklBRUdob&zwnj;&#8203;GJHeHZkR2hsY21WellXb&zwnj;&#8203;HNiM0lHYzNSeWFXNW5EQ&zwnj;&#8203;ThBRFhSbGMzUnBibWRoY&zwnj;&#8203;0hCbGJtUUdjM1J5YVc1b&zwnj;&#8203;kRBZ0FCbWh2YUc5b2J3P&zwnj;&#8203;T18VP64W1TMaCK403POC&zwnj;&#8203;pyIfHmlwBaajiiMcWogG&zwnj;&#8203;KTnEGQ=; Path=/; Expires=Mon, 23 Oct 2017 02:42:14 GMT; Max-Age=604800; HttpOnly]"}, {"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1508141414, "post_id": 46761750, "comment_id": 80476548, "body": "may be will help you ? <a href=\"https://stackoverflow.com/questions/31448642/golang-gorilla-sessions-dont-work-for-cors\" title=\"golang gorilla sessions dont work for cors\">stackoverflow.com/questions/31448642/&hellip;</a>"}, {"owner": {"reputation": 464, "user_id": 1730179, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/4I3VG.gif?s=128&g=1", "display_name": "Kwestion", "link": "https://stackoverflow.com/users/1730179/kwestion"}, "edited": false, "score": 0, "creation_date": 1508169536, "post_id": 46761750, "comment_id": 80494471, "body": "I don&#39;t understand what you are trying to accomplish here. Are you trying to use gorilla to save cookies to a browser like Chrome / Firefox / Safari?"}], "owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1610, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1508117079, "creation_date": 1508117079, "question_id": 46761750, "link": "https://stackoverflow.com/questions/46761750/golang-gorilla-sessions-not-saving-cookies-to-browser", "title": "Golang Gorilla/Sessions Not Saving Cookies to Browser", "body": "<p>I'm having trouble getting Golang Gorilla sessions to work correctly. </p>\n\n<p>I have gotten this as simple as I can to try and reproduce the error. </p>\n\n<p>Main (note that I am using some stuff to take care of CORS with <em>might</em> be an issue)</p>\n\n<pre><code> main(){\n    &lt;OTHER CODE&gt;\n    log.Print(\"Instatiate Cookiestore\")\n    config.Configure_Sessions()\n    log.Print(\"Instantiated\")\n    &lt;MORE CODE&gt;\n\n    router := NewRouter()\n    os.Setenv(\"ORIGIN_ALLOWED\", \"*\")\n    headersOk := handlers.AllowedHeaders([]string{\"X-Requested-With\", \"Content-Type\"})\n    originsOk := handlers.AllowedOrigins([]string{os.Getenv(\"ORIGIN_ALLOWED\")})\n    methodsOk := handlers.AllowedMethods([]string{\"GET\", \"HEAD\", \"POST\", \"PUT\", \"OPTIONS\"})\n\n    // start server listen\n    // with error handling\n    log.Fatal(http.ListenAndServe(\":8080\", handlers.CORS(originsOk, headersOk, methodsOk)(router)))\n}\n</code></pre>\n\n<p>Sessions</p>\n\n<pre><code>package config\n\nimport (\n    \"net/http\"\n\n    \"github.com/gorilla/sessions\"\n)\n\nvar (\n    // Store is the cookie store\n    Store *sessions.CookieStore\n    // Name is the session name\n    Name string\n)\n\n// Session stores session level information\ntype Session struct {\n    Options   sessions.Options `json:\"Options\"`   // Pulled from: http://www.gorillatoolkit.org/pkg/sessions#Options\n    Name      string           `json:\"Name\"`      // Name for: http://www.gorillatoolkit.org/pkg/sessions#CookieStore.Get\n    SecretKey string           `json:\"SecretKey\"` // Key for: http://www.gorillatoolkit.org/pkg/sessions#CookieStore.New\n}\n\n// Configure the session cookie store\nfunc Configure_Sessions() {\n    Store = sessions.NewCookieStore([]byte(\"adsads;fja;i4gna;nbeq09bjse\"))\n    // Store.Options = &amp;s.Options\n    // Name = s.Name\n}\n\nfunc Instance(r *http.Request) (*sessions.Session, error) {\n    session, err := Store.Get(r, \"cookies4dndyo\")\n    return session, err\n}\n\n// Empty deletes all the current session values\nfunc Empty(sess *sessions.Session) {\n    // Clear out all stored values in the cookie\n    for k := range sess.Values {\n        delete(sess.Values, k)\n    }\n}\n</code></pre>\n\n<p>In order to ensure that this functionality would work I copied most of the code from here <a href=\"https://github.com/josephspurrier/gowebapp/blob/master/vendor/app/shared/session/session.go\" rel=\"nofollow noreferrer\">https://github.com/josephspurrier/gowebapp/blob/master/vendor/app/shared/session/session.go</a>. </p>\n\n<p>Here is the place that I call login. This is where I am putting a bunch of tests to try and see what is going wrong. What I do to test is I hit log in twice. You can see that I can write to the test variable, but when I want to append to a persisting variable it is constantly nil. </p>\n\n<pre><code>func (incomingjson *User) Login(w http.ResponseWriter, r *http.Request) {\n    log.Print(\"Inside Login Function\")\n    session, err := config.Instance(r)\n    log.Print(\"After session assignment in login function\")\n    log.Print(\"What is the value of session, err?\")\n    log.Print(\"Session: \", session)\n    log.Print(\"Err: \", err)\n    log.Print(\"Set Value and Test\")\n    session.Values[\"testing\"] = \"hellotheresailor\"\n    log.Print(\"session.Values[testing]: \", session.Values[\"testing\"])\n    log.Print(\"Test with previous values: \")\n    if session.Values[\"testingappend\"] == nil {\n        log.Print(\"inside testingappen nil if statement\")\n        session.Values[\"testingappend\"] = \"hohoho\"\n        log.Print(session.Values[\"testingappend\"])\n    } else {\n        log.Print(\"inside testingappend not nil else statement\")\n        session.Values[\"testingappend\"] = session.Values[\"testingappend\"].(string) + session.Values[\"testing\"].(string)\n        log.Print(\"Value of session.Values[testingappend]: \", session.Values[\"testingappend\"])\n    }\n    session.Save(r, w)\n    &lt;CODE CONTINUES - END OF EXAMPLE&gt;\n</code></pre>\n\n<p>Terminal Output from this: </p>\n\n<pre><code>patientplatypus:~/Documents/golang/src/github.com/patientplatypus/gorest:20:00:18$gorest\nSuccessfully connected~!\n2017/10/15 20:00:19 Instatiate Cookiestore\n2017/10/15 20:00:19 Instantiated\n2017/10/15 20:00:36 username: patientplatypus\n2017/10/15 20:00:36 password: Fvnjty0b\n2017/10/15 20:00:36 Inside Login Function\n2017/10/15 20:00:36 After session assignment in login function\n2017/10/15 20:00:36 What is the value of session, err?\n2017/10/15 20:00:36 Session: &amp;{ map[] 0xc42015e330 true 0xc4200e1040 cookies4dndyo}\n2017/10/15 20:00:36 Err: &lt;nil&gt;\n2017/10/15 20:00:36 Set Value and Test\n2017/10/15 20:00:36 session.Values[testing]: hellotheresailor\n2017/10/15 20:00:36 Test with previous values: \n2017/10/15 20:00:36 inside testingappen nil if statement\n2017/10/15 20:00:36 hohoho\n2017/10/15 20:00:36 loginjson: &amp;{patientplatypus Fvnjty0b 0}\n2017/10/15 20:00:36 err: &lt;nil&gt;\n2017/10/15 20:00:36 Found username\n2017/10/15 20:00:36 username and password match!\n2017/10/15 20:00:36 Value of session.Values[authenticated], session.values[username]: true patientplatypus\n2017/10/15 20:00:59 username: theGreatDM\n2017/10/15 20:00:59 password: theGreatDM\n2017/10/15 20:00:59 Inside Login Function\n2017/10/15 20:00:59 After session assignment in login function\n2017/10/15 20:00:59 What is the value of session, err?\n2017/10/15 20:00:59 Session: &amp;{ map[] 0xc4201ba2a0 true 0xc4200e1040 cookies4dndyo}\n2017/10/15 20:00:59 Err: &lt;nil&gt;\n2017/10/15 20:00:59 Set Value and Test\n2017/10/15 20:00:59 session.Values[testing]: hellotheresailor\n2017/10/15 20:00:59 Test with previous values: \n2017/10/15 20:00:59 inside testingappen nil if statement\n2017/10/15 20:00:59 hohoho\n2017/10/15 20:00:59 loginjson: &amp;{theGreatDM theGreatDM 0}\n2017/10/15 20:00:59 err: &lt;nil&gt;\n2017/10/15 20:00:59 Found username\n2017/10/15 20:00:59 username and password match!\n2017/10/15 20:00:59 Value of session.Values[authenticated], session.values[username]: true theGreatDM\n</code></pre>\n\n<p>Testingappend should output <code>hohoho</code> once and <code>hellotheresailorhohoho</code> once. Instead it outputs <code>hohoho</code> twice as the second call it does not recognize a persisting sessions and exits.</p>\n\n<p>I've also noticed this : </p>\n\n<p><a href=\"https://i.stack.imgur.com/HQSLW.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/HQSLW.png\" alt=\"Cookies Not Accepted!\"></a>\nIt appears that the cookies that are supposed to be saved to the browser are not getting entered in. I've tested this on localhost and 127.0.0.1 and both with port numbers as well.</p>\n\n<p>I am very confused. </p>\n\n<p>This is not the simplest example of this package, but it is close. The only major difference is that I'm putting all the sessions handling in its own global file so that the connection can be accessed anywhere. I've been very lost on this for a while. Any help would be appreciated.</p>\n"}, {"tags": ["json", "go", "struct", "io", "printf"], "comments": [{"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 1, "creation_date": 1508108489, "post_id": 46760795, "comment_id": 80467025, "body": "<code>fmt.Fprintf(w, &quot;%+v&quot;, record)</code> should fix you right up."}, {"owner": {"reputation": 51, "user_id": 8781429, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d6851e367d69203c134dda37d492868?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/8781429/thomas"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1508108601, "post_id": 46760795, "comment_id": 80467042, "body": "@MiloChristiansen spent hours trying to figure this out and you sorted it in less that 5! Thanks a lot"}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 8781429, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d6851e367d69203c134dda37d492868?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/8781429/thomas"}, "is_accepted": true, "score": 4, "last_activity_date": 1508108723, "creation_date": 1508108723, "answer_id": 46760877, "question_id": 46760795, "link": "https://stackoverflow.com/questions/46760795/printing-decoded-json-in-golang/46760877#46760877", "title": "Printing decoded JSON in Golang", "body": "<p>Thanks to @MiloChrisstiansen</p>\n\n<pre><code>fmt.Fprintf(w, \"%+v\", record)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 679, "user_id": 2888403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9ffa065886a8362661b8f85b2a7156a?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/2888403/david"}, "is_accepted": false, "score": 1, "last_activity_date": 1508180133, "creation_date": 1508180133, "answer_id": 46777246, "question_id": 46760795, "link": "https://stackoverflow.com/questions/46760795/printing-decoded-json-in-golang/46777246#46777246", "title": "Printing decoded JSON in Golang", "body": "<p>You could also use</p>\n\n<pre><code>w.Write([]byte(record))\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 8781429, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d6851e367d69203c134dda37d492868?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas", "link": "https://stackoverflow.com/users/8781429/thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1227, "favorite_count": 0, "accepted_answer_id": 46760877, "answer_count": 2, "score": 1, "last_activity_date": 1508180133, "creation_date": 1508107896, "last_edit_date": 1508137939, "question_id": 46760795, "link": "https://stackoverflow.com/questions/46760795/printing-decoded-json-in-golang", "title": "Printing decoded JSON in Golang", "body": "<p>I am very new to Go / programming in general - having just picked it up whilst messing about creating my own crypto currency portfolio web site.</p>\n\n<p>I am struggling printing to the web server output. If I used Printf - it prints to console but as soon as I use Fprintf to print to the web app, I get a number of errors which I can't seem to solve.</p>\n\n<p>Could someone walk me through it?</p>\n\n<pre><code>package main\n\nimport (\n        \"encoding/json\"\n        \"fmt\"\n        \"log\"\n        \"net/http\"\n)\n\ntype Obsidian []struct {\n    PriceUsd         string `json:\"price_usd\"`\n    PriceBtc         string `json:\"price_btc\"`\n}\n\nfunc webserver(w http.ResponseWriter, r *http.Request) {\n    url := \"https://api.coinmarketcap.com/v1/ticker/obsidian/\"\n\n    req, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n            log.Fatal(\"NewRequest: \", err)\n            return\n    }\n\n    client := &amp;http.Client{}\n\n    resp, err := client.Do(req)\n    if err != nil {\n            log.Fatal(\"Do: \", err)\n            return\n    }\n    defer resp.Body.Close()\n\n    var record Obsidian\n    if err := json.NewDecoder(resp.Body).Decode(&amp;record); err != nil {\n            log.Println(err)\n    }\n\n    fmt.Printf(\"%+v\", record)\n}\n\nfunc main() {\n    http.HandleFunc(\"/test\", webserver)\n    http.ListenAndServe(\":8001\", nil)\n}\n</code></pre>\n\n<p>I have tried to replace:</p>\n\n<pre><code>fmt.Printf(\"%+v\", record)\n</code></pre>\n\n<p>with:</p>\n\n<pre><code>fmt.Fprintf(\"%+v\", record)\n</code></pre>\n\n<p>and receive the following errors:</p>\n\n<pre><code>./test.go:54:21: cannot use \"%+v\" (type string) as type io.Writer in argument to fmt.Fprintf:\n    string does not implement io.Writer (missing Write method)\n./test.go:54:21: cannot use record (type Obsidian) as type string in argument to fmt.Fprintf\n</code></pre>\n"}, {"tags": ["python", "go", "encoding"], "comments": [{"owner": {"reputation": 51, "user_id": 8781418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc61f7a102b28cf2ae45521390b167d?s=128&d=identicon&r=PG&f=1", "display_name": "Mugs9117", "link": "https://stackoverflow.com/users/8781418/mugs9117"}, "reply_to_user": {"reputation": 39519, "user_id": 2063361, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/jB77z.jpg?s=128&g=1", "display_name": "Anonymous", "link": "https://stackoverflow.com/users/2063361/anonymous"}, "edited": false, "score": 0, "creation_date": 1508108139, "post_id": 46760712, "comment_id": 80466949, "body": "@MoinuddinQuadri - sorry. That was a bad example. I updated here to actually include something that runs. This example is in Python 2.7; I think Python 3.x changed this."}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 8781418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc61f7a102b28cf2ae45521390b167d?s=128&d=identicon&r=PG&f=1", "display_name": "Mugs9117", "link": "https://stackoverflow.com/users/8781418/mugs9117"}, "edited": false, "score": 0, "creation_date": 1508113011, "post_id": 46760934, "comment_id": 80467906, "body": "Thanks! I think that&#39;s what I was looking for."}], "tags": [], "owner": {"reputation": 1989, "user_id": 878906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fe27d918fc8b4704b57e79db6bd75e2e?s=128&d=identicon&r=PG", "display_name": "Doug Coburn", "link": "https://stackoverflow.com/users/878906/doug-coburn"}, "is_accepted": true, "score": 1, "last_activity_date": 1508114058, "last_edit_date": 1508114058, "creation_date": 1508109148, "answer_id": 46760934, "question_id": 46760712, "link": "https://stackoverflow.com/questions/46760712/go-equivalent-of-decodehex-in-python/46760934#46760934", "title": "Go equivalent of decode(&#39;hex&#39;) in Python", "body": "<p>Does this work for you?</p>\n\n<pre><code>package main\n\nimport (\n  \"encoding/hex\"\n  \"fmt\"\n  \"log\"\n)\n\nfunc main() {\n  const s = \"ec033aa702\"\n  decoded, err := hex.DecodeString(s)\n  if err != nil {\n    log.Fatal(err)\n  }\n\n  fmt.Printf(\"%s\\n\", decoded)\n}\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/encoding/hex/#DecodeString\" rel=\"nofollow noreferrer\">DecodeString</a></p>\n\n<p><a href=\"https://play.golang.org/p/Po4sQVPRDc\" rel=\"nofollow noreferrer\">Try it online!</a></p>\n"}], "owner": {"reputation": 51, "user_id": 8781418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9bc61f7a102b28cf2ae45521390b167d?s=128&d=identicon&r=PG&f=1", "display_name": "Mugs9117", "link": "https://stackoverflow.com/users/8781418/mugs9117"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 46760934, "answer_count": 1, "score": 2, "last_activity_date": 1508114058, "creation_date": 1508107263, "last_edit_date": 1508107808, "question_id": 46760712, "link": "https://stackoverflow.com/questions/46760712/go-equivalent-of-decodehex-in-python", "title": "Go equivalent of decode(&#39;hex&#39;) in Python", "body": "<p>I'm working on converting an existing Python library to Go and am getting hung up on a piece.</p>\n\n<p>Is there a go equivalent to the following Python code? </p>\n\n<pre><code>test = \"ec033aa702\"\ntest.decode('hex')\n</code></pre>\n\n<p>I've been doing some reading but can't seem to find what I'm looking for.</p>\n"}, {"tags": ["http", "go", "network-programming"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508156612, "post_id": 46760676, "comment_id": 80485776, "body": "How would you make concurrent requests if there were only 1 connection possible?"}, {"owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508160370, "post_id": 46760676, "comment_id": 80488351, "body": "I agree that it should be allowed but I don\u2019t see the code path that allows it."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508160623, "post_id": 46760676, "comment_id": 80488525, "body": "If you make multiple concurrent requests to the same host, multiple connections need to be opened, and <code>MaxIdleConnsPerHost</code> is the max number kept open after they complete. It&#39;s the same general code path for any request, what exactly are you looking for?"}], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 222, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1508123476, "creation_date": 1508106874, "question_id": 46760676, "link": "https://stackoverflow.com/questions/46760676/golang-more-than-one-idle-connection-per-host", "title": "Golang more than one idle connection per host", "body": "<p><a href=\"https://golang.org/pkg/net/http/#Transport.MaxIdleConnsPerHost\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Transport.MaxIdleConnsPerHost</a> controls the number of keep alive connections per host. The problem I\u2019m having is that I don\u2019t see how the number of keep alive connections per host can exceed 1.</p>\n\n<p>If one is already cached, <code>getConn</code> will return the cached connection. If there\u2019s no cached connection it will create a new one. </p>\n\n<p>How could there be more than one per host?</p>\n"}, {"tags": ["go", "sudoku", "recursive-backtracking"], "comments": [{"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 1, "creation_date": 1508106191, "post_id": 46760556, "comment_id": 80466521, "body": "Apologies for the seemingly brisk comment, but have you tried debugging? You don&#39;t expect us to do it on your behalf, right? :)"}, {"owner": {"reputation": 69, "user_id": 7628900, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ad162cf7f1e4787b1966e786fb965cd9?s=128&d=identicon&r=PG&f=1", "display_name": "Sam Caneau", "link": "https://stackoverflow.com/users/7628900/sam-caneau"}, "reply_to_user": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508106891, "post_id": 46760556, "comment_id": 80466712, "body": "Never expecting anyone to do things on my behalf, juste some ideas, no code is very okay :D"}], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 7628900, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ad162cf7f1e4787b1966e786fb965cd9?s=128&d=identicon&r=PG&f=1", "display_name": "Sam Caneau", "link": "https://stackoverflow.com/users/7628900/sam-caneau"}, "edited": false, "score": 0, "creation_date": 1508148381, "post_id": 46760635, "comment_id": 80480637, "body": "Thx For you answer actually it works I just didn&#39;t call the Display function in the isValid function to display once it&#39;s the grid is completed, but now it works"}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1508540999, "post_id": 46760635, "comment_id": 80664516, "body": "Please note that the posted program works algorithmicly, it was just a programming error due to not knowing how arrays and pointers work in Go, see my answer."}], "tags": [], "owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "is_accepted": false, "score": 1, "last_activity_date": 1508106877, "last_edit_date": 1508106877, "creation_date": 1508106438, "answer_id": 46760635, "question_id": 46760556, "link": "https://stackoverflow.com/questions/46760556/golang-sudoku-algorithm-not-working/46760635#46760635", "title": "Golang sudoku algorithm not working", "body": "<p>I don't know Golang, but I have written a sudoku solving algorithm using backtracking.</p>\n\n<p><strong>Your code only iterates the board once.</strong> You start with <code>position=0</code>, your code than iterates over the board ,if a position has the value zero you try values 1-9 and if that doesn't work you go to the next position. When <code>position=81</code>, your code stops. </p>\n\n<p>You added new values to the board with your <code>Isvalid</code> function, but you are not iterating over the new board again to see if those new values help your <code>AbsentOn...</code> function to return a new value that is different than the previous iteration. You have to iterate your board again and again until you are sure that there are no <code>0</code> valued cells.</p>\n\n<p>That is the reason you have to many <code>0</code> on the board at the end of your program. Your program iterated only once, at It is can not solve your example sudoku on it's first try. It has to add new values to the board and make the sudoku board easier with every iteration.</p>\n\n<hr>\n\n<p>Another problem is your code does not give a feedback. For example it gives <code>1</code> to an empty cell. That seems okey at first, but It doesn't mean that the final value of that cell has to be <code>1</code>. It may change because in your next iterations you realize that there is another cell that can only take the value <code>1</code>, so now you have to change back to your initial cell and find a new value other than <code>1</code>. Your code also fails to do that. That's why humans put some possible values near a cell when they are not sure. </p>\n\n<hr>\n\n<p>It looks like your problem is with the algorithm. You have to understand the backtracking algorithm. You can try it in another language that you know well first and then migrate it to golang(I wrote mine in C++). Other than that your golang code is easy to read and I don't see any golang related problems. </p>\n"}, {"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": true, "score": 0, "last_activity_date": 1508540703, "creation_date": 1508540703, "answer_id": 46858444, "question_id": 46760556, "link": "https://stackoverflow.com/questions/46760556/golang-sudoku-algorithm-not-working/46858444#46858444", "title": "Golang sudoku algorithm not working", "body": "<p>Your <code>IsValid</code> function changes the contents of the sudoku. The problem is, it actually, in your code as is, changes only a <strong>copy</strong> of the sudoku. You need to pass it as a pointer if it should change the actual variable.</p>\n\n<p>Here are the changes that you need in your code, it is only five characters:</p>\n\n<pre><code>func main() {\n    IsValid(&amp;sudoku, 0)\n    Display(sudoku)\n}\n\n// ...\n\nfunc IsValid(sudoku *[9][9]int, position int) bool {\n\n// ...\n\nif AbsentOnLine(k, *sudoku, x) &amp;&amp; AbsentOnRow(k, *sudoku, y) &amp;&amp; AbsentOnBloc(k, *sudoku, x, y) {\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 7628900, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ad162cf7f1e4787b1966e786fb965cd9?s=128&d=identicon&r=PG&f=1", "display_name": "Sam Caneau", "link": "https://stackoverflow.com/users/7628900/sam-caneau"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 0, "accepted_answer_id": 46858444, "answer_count": 2, "score": 1, "last_activity_date": 1508540703, "creation_date": 1508105581, "question_id": 46760556, "link": "https://stackoverflow.com/questions/46760556/golang-sudoku-algorithm-not-working", "title": "Golang sudoku algorithm not working", "body": "<p>I'm very new to Golang, I'm trying to do a sudoku with backtracking algorithm.\nBut when I run my program, there are no errors but it only displays the grid not complete, with empty cases here is my code :</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nvar sudoku = [9][9]int{\n    {9, 0, 0, 1, 0, 0, 0, 0, 5},\n    {0, 0, 5, 0, 9, 0, 2, 0, 1},\n    {8, 0, 0, 0, 4, 0, 0, 0, 0},\n    {0, 0, 0, 0, 8, 0, 0, 0, 0},\n    {0, 0, 0, 7, 0, 0, 0, 0, 0},\n    {0, 0, 0, 0, 2, 6, 0, 0, 9},\n    {2, 0, 0, 3, 0, 0, 0, 0, 6},\n    {0, 0, 0, 2, 0, 0, 9, 0, 0},\n    {0, 0, 1, 9, 0, 4, 5, 7, 0},\n  }\n\nfunc main(){\n  IsValid(sudoku, 0)\n  Display(sudoku)\n}\n\nfunc Display(sudoku[9][9] int){\n  var x, y int\n\n  for x = 0; x &lt; 9; x++ {\n        fmt.Println(\"\")\n        if(x == 3 || x == 6){\n          fmt.Println(\" \")\n        }\n      for y = 0; y &lt; 9; y++ {\n        if(y == 3 || y == 6){\n          fmt.Print(\"|\")\n        }\n         fmt.Print(sudoku[x][y])\n      }\n\n   }\n\n}\n\nfunc AbsentOnLine(k int, sudoku [9][9]int, x int) bool {\n  var y int\n    for y=0; y &lt; 9; y++ {\n        if (sudoku[x][y] == k){\n            return false\n          }\n        }\n    return true\n}\n\nfunc AbsentOnRow(k int, sudoku [9][9]int, y int) bool {\n  var x int\n  for x=0; x &lt; 9; x++{\n       if (sudoku[x][y] == k){\n           return false;\n         }\n       }\n   return true;\n}\n\nfunc AbsentOnBloc(k int, sudoku [9][9]int, x int, y int) bool {\n  var firstX, firstY int;\n  firstX =  x-(x%3)\n  firstY =  y-(y%3)\n  for x = firstX; x &lt; firstX+3; x++ {\n        for y = firstY; y &lt; firstY+3; y++ {\n            if (sudoku[x][y] == k){\n                return false;\n              }\n        }\n      }\n    return true;\n\n}\n\nfunc IsValid(sudoku [9][9]int, position int) bool {\n\n  if (position == 9*9){\n        return true;\n      }\n\n      var x, y, k int\n\n    x = position/9\n    y = position%9\n\n    if (sudoku[x][y] != 0){\n        return IsValid(sudoku, position+1);\n      }\n\n    for k=1; k &lt;= 9; k++ {\n        if (AbsentOnLine(k,sudoku,x) &amp;&amp; AbsentOnRow(k,sudoku,y) &amp;&amp; AbsentOnBloc(k,sudoku,x,y)){\n            sudoku[x][y] = k;\n\n            if (IsValid(sudoku, position+1)){\n                return true;\n              }\n        }\n    }\n    sudoku[x][y] = 0;\n    return false;\n\n}\n</code></pre>\n\n<p>I'm getting this in the console : </p>\n\n<pre><code>900|100|005\n005|090|201\n800|040|000\n\n000|080|000\n000|700|000\n000|026|009\n\n200|300|006\n000|200|900\n001|904|570\n</code></pre>\n\n<p>I don't understand why it's not completing the grid, has anyone any ideas ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 2, "creation_date": 1508103553, "post_id": 46760209, "comment_id": 80465859, "body": "Usually the rule is if you need any advance configuration you instantiate the object and it will have functions and properties for configuration, and use the package functions to use the functionality without an instance when the defaults are good enough for your use case."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1508135789, "post_id": 46760209, "comment_id": 80473653, "body": "Take the Tour of Go. Regarding your question: All variants have their use and none is idiomatic or not."}], "answers": [{"tags": [], "owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "is_accepted": false, "score": 1, "last_activity_date": 1508105946, "creation_date": 1508105946, "answer_id": 46760587, "question_id": 46760209, "link": "https://stackoverflow.com/questions/46760209/when-to-instantiate-a-struct-explicitly/46760587#46760587", "title": "When to instantiate a struct explicitly?", "body": "<p>I do not know if there is a hard-and-fast rule to answer your question. I normally use a factory method when one of these conditions holds:</p>\n\n<ul>\n<li>I need to do some sanity check on the value of the properties prior to the instance being used;</li>\n<li>I want to use unexpected properties, in which case the only way to address them is from within the same package.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 16, "user_id": 8781986, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M24Ih.jpg?s=128&g=1", "display_name": "Corey Brooks", "link": "https://stackoverflow.com/users/8781986/corey-brooks"}, "is_accepted": true, "score": 0, "last_activity_date": 1508124777, "creation_date": 1508124777, "answer_id": 46762552, "question_id": 46760209, "link": "https://stackoverflow.com/questions/46760209/when-to-instantiate-a-struct-explicitly/46762552#46762552", "title": "When to instantiate a struct explicitly?", "body": "<p>I'd really suggest reading the <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">Godoc</a> for <code>net/http</code>. The package is very feature-rich and lets you do what you want.</p>\n\n<p>The behaviour of <code>http.ListenAndServe</code> is to implicitly use a serve multiplexer known as <code>DefaultServeMux</code>, on which you can register handlers with <code>http.Handle</code>. So you can't deal with the server or multiplexer explicitly like this.</p>\n\n<p>It sounds like what you want (a more Java-like solution) is to instantiate a server</p>\n\n<pre><code>s := &amp;http.Server{\n    Addr:           \":8080\",\n    Handler:        myHandler,        // takes a path and a http.HandlerFunc\n    ReadTimeout:    10 * time.Second, // optional config\n    WriteTimeout:   10 * time.Second, // ...\n    MaxHeaderBytes: 1 &lt;&lt; 20,\n}\n</code></pre>\n\n<p>and call <code>ListenAndServe</code> on that:</p>\n\n<pre><code>log.Fatal(s.ListenAndServe())\n</code></pre>\n\n<p>Both ways are totally idiomatic, I've seen them used quite frequently.</p>\n\n<p>But seriously, don't take my word for it. Go look at the docs, they have lots of examples :)</p>\n"}], "owner": {"reputation": 11, "user_id": 8755095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/114449fe119b862a1af275b648746847?s=128&d=identicon&r=PG&f=1", "display_name": "BacaBej", "link": "https://stackoverflow.com/users/8755095/bacabej"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 46762552, "answer_count": 2, "score": -1, "last_activity_date": 1508124777, "creation_date": 1508103057, "question_id": 46760209, "link": "https://stackoverflow.com/questions/46760209/when-to-instantiate-a-struct-explicitly", "title": "When to instantiate a struct explicitly?", "body": "<p>i'm coming from Java, and there you always do something like:</p>\n\n<pre><code>Http http = new Http(...);\n\nhttp.ListenAndServe();\n</code></pre>\n\n<p>So all information are stored in the local variable \"http\".</p>\n\n<p>It's different in go. There most of the information is stored directly \"in another package\".</p>\n\n<p>You do:</p>\n\n<pre><code>import \"net/http\"\n...    \nhttp.ListenAndServe(...)\n</code></pre>\n\n<p>So you dont have to explicitly (well you could) instantiate a server struct. Just call a function from the package and all the structs will be created from there. (So compared to Java, it acts like static functions with static member variables to store all information ?)</p>\n\n<p>So this is how you do it (everytime) in go ?\nComing from Java, this is a little bit hard to understand.\nEspecially when to use this method, when to use a factory pattern (like: <code>NewHttpServer(...)</code> ) and when to explicitly create a struct from another package ( like: <code>var http http.Server = http.Server{...}</code> )</p>\n\n<p>Everything might be possible, but what is the idiomatic golang code ?</p>\n\n<p>Is there any good document/tutorial which explains it ?</p>\n"}, {"tags": ["session", "go", "gorilla"], "comments": [{"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 5, "creation_date": 1508099618, "post_id": 46759540, "comment_id": 80464805, "body": "Be careful: you are ignoring the error returned by CookieStore::Get - Get always returns a non-nil session, but also the error might be not null (like in the case of a newly created session)."}, {"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "reply_to_user": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508100899, "post_id": 46759540, "comment_id": 80465150, "body": "So I just checked that. err there is nil, but I really think the problem is that sessions arent mapped correctly (see my EDIT). I don&#39;t know how to fix this if thats the issue."}, {"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508102082, "post_id": 46759540, "comment_id": 80465469, "body": "I reviewed the sample code that Gorilla provides (I don&#39;t use sessions as I think that they are a fundamentally bad idea, and JWT provides a stateless mechanism for user authentication), however the code seems very different from yours. Would you mind giving a go to the documentation? He seems to use completely different methods...  <a href=\"https://godoc.org/github.com/gorilla/sessions\" rel=\"nofollow noreferrer\">godoc.org/github.com/gorilla/sessions</a>"}, {"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "reply_to_user": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508102277, "post_id": 46759540, "comment_id": 80465527, "body": "I&#39;ve looked at the code. I don&#39;t see how it is different than what I am using currently. Can you point out any differences that you see that may break my code in a full comment @AlessandroSantini?"}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1508102800, "post_id": 46759540, "comment_id": 80465667, "body": "@PeterWeyand As a note, you shouldn&#39;t use 2 queries to authenticate the user in the DB, you can select the username and password on the same query and avoid an unnecessary query, or even better <code>select user where user = $1 and password = $2</code> and then the DB makes the check for you at the same time it looks for your row."}, {"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508102954, "post_id": 46759540, "comment_id": 80465715, "body": "Writing a few lines of code to test if the session works correctly. BRB."}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1508103222, "post_id": 46759540, "comment_id": 80465780, "body": "@PeterWeyand I&#39;m pretty sure the issue is on how the cookies are being saved. Can you post the values for the cookies shown in the browser when the cookie just got set, and on the page where the request is failing? Also FWI I downvoted the question because you are ignoring errors in 2 places in your example, and I want to help and everything but I can&#39;t be sure you are not just ignoring a stupid error and making as all loose our time. NEVER ignore the errors."}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1508103863, "post_id": 46759540, "comment_id": 80465940, "body": "@PeterWeyand Could you show us the information about the cookies? Because I have used gorila sessions in my code and they work and I think the issue has something to do with how they are being saved on the browser."}, {"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "reply_to_user": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1508103933, "post_id": 46759540, "comment_id": 80465957, "body": "... @Topo..... I already have it&#39;s written in the question ..."}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1508104105, "post_id": 46759540, "comment_id": 80466009, "body": "@PeterWeyand Sorry about that. That&#39;s the issue there, when working on localhost the domain on the cookie should be &quot;&quot; instead of localhost. ;)"}, {"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "reply_to_user": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1508104282, "post_id": 46759540, "comment_id": 80466045, "body": "@Topo - no that is not the problem. It did not fix the issue, I get the same error."}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1508104706, "post_id": 46759540, "comment_id": 80466150, "body": "@PeterWeyand Try without setting the domain parameter at all, or with the domain set to 127.0.0.1 Also, which browser are you using? I think setting the cookie domain to 127.0.0.1 only works on firefox."}, {"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "reply_to_user": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1508104914, "post_id": 46759540, "comment_id": 80466205, "body": "@Topo I have tried setting Domain: &quot;localhost:&lt;PORTNUMBER&gt;&quot; and commenting out Domain in the options. Neither option works. I am skeptical that this is the source of the issue."}, {"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "reply_to_user": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 0, "creation_date": 1508105085, "post_id": 46759540, "comment_id": 80466241, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/156786/discussion-between-topo-and-peter-weyand\">continue this discussion in chat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 0, "creation_date": 1508105478, "post_id": 46760528, "comment_id": 80466344, "body": "This is tested working but, as you can see, my API calls to the sessions API are completely different from yours."}, {"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 0, "creation_date": 1508105929, "post_id": 46760528, "comment_id": 80466448, "body": "This looks very much like what I have. the only difference seems to be that I put things in different files and make cookies a global variable. See my EDIT EDIT above."}, {"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "reply_to_user": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 0, "creation_date": 1508106079, "post_id": 46760528, "comment_id": 80466490, "body": "Yes, I did miss the EDIT EDIT as I was in Atom :) the number of files is not really the issue, though. Gorilla Sessions works, there must be something wrong in the flow of your application. It&#39;s hard to replicate your environment locally."}, {"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 0, "creation_date": 1508108550, "post_id": 46760528, "comment_id": 80467033, "body": "I think it IS an issue. It means that there are problems holding Sessions cookies as a global variable. And if I don&#39;t do that that means that all my functions must be in a single file (which is impossible as I poll cookies throughout the project). This is not a solution that generalizes!!!"}, {"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "reply_to_user": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 0, "creation_date": 1508108900, "post_id": 46760528, "comment_id": 80467105, "body": "Peter, I am sorry but several files get compiled into a single binary that runs in a single process. No, what you just said is downright incorrect."}, {"owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 0, "creation_date": 1508109681, "post_id": 46760528, "comment_id": 80467241, "body": "I cannot generalize your answer to how sessions should be handled globally across more than one file. I don&#39;t see how I can take what you&#39;ve done and generalize to multiple files. That is a correct statement."}, {"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "reply_to_user": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "edited": false, "score": 2, "creation_date": 1508141230, "post_id": 46760528, "comment_id": 80476451, "body": "Peter, I tried to break the system into three different files and it works flawlessly. <a href=\"https://file.io/O6Szms\" rel=\"nofollow noreferrer\">file.io/O6Szms</a> <a href=\"https://file.io/OUUgLu\" rel=\"nofollow noreferrer\">file.io/OUUgLu</a> <a href=\"https://file.io/5Arl86\" rel=\"nofollow noreferrer\">file.io/5Arl86</a> . I suggest you try a little harder. Not working on this question anymore."}], "tags": [], "owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "is_accepted": false, "score": 1, "last_activity_date": 1508105408, "creation_date": 1508105408, "answer_id": 46760528, "question_id": 46759540, "link": "https://stackoverflow.com/questions/46759540/gorilla-sessions-does-not-persist-in-golang/46760528#46760528", "title": "Gorilla Sessions Does Not Persist in Golang", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n\n    \"github.com/gorilla/mux\"\n    \"github.com/gorilla/sessions\"\n)\n\nconst appCookie = \"myappcookies\"\n\nvar cookies *sessions.CookieStore\n\nfunc Login(w http.ResponseWriter, r *http.Request) {\n    //\n    // For the sake of simplicity, I am using a global here. \n    // You should be using a context.Context instead!\n    session, err := cookies.Get(r, appCookie)\n    if err != nil {\n        w.WriteHeader(http.StatusInternalServerError)\n        log.Println(err)\n        return\n    }\n    session.Values[\"userName\"] = \"StackOverflow\"\n    session.Save(r, w)\n}\n\nfunc Session(w http.ResponseWriter, r *http.Request) {\n    session, err := cookies.Get(r, appCookie)\n    if err != nil {\n        w.WriteHeader(http.StatusInternalServerError)\n        log.Println(err)\n        return\n    }\n    w.Write([]byte(fmt.Sprintf(\"Objects in session: %d\\n\", len(session.Values))))\n    for k, v := range session.Values {\n        w.Write([]byte(fmt.Sprintf(\"Key=%v, Value=%v\\n\", k, v)))\n    }\n}\n\nfunc main() {\n    cookies = sessions.NewCookieStore([]byte(\"mysuperdupersecret\"))\n    router := mux.NewRouter()\n    router.Path(\"/login\").Methods(http.MethodPost).HandlerFunc(Login)\n    router.Path(\"/session\").Methods(http.MethodGet).HandlerFunc(Session)\n    server := &amp;http.Server{\n        Handler: router,\n        Addr:    \":8000\",\n        // Good practice: enforce timeouts for servers you create!\n        WriteTimeout: 15 * time.Second,\n        ReadTimeout:  15 * time.Second,\n    }\n    log.Fatal(server.ListenAndServe())\n}\n</code></pre>\n"}], "owner": {"reputation": 1569, "user_id": 7268968, "user_type": "registered", "accept_rate": 27, "profile_image": "https://graph.facebook.com/10107185465206940/picture?type=large", "display_name": "Peter Weyand", "link": "https://stackoverflow.com/users/7268968/peter-weyand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2549, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1508105408, "creation_date": 1508098435, "last_edit_date": 1508103480, "question_id": 46759540, "link": "https://stackoverflow.com/questions/46759540/gorilla-sessions-does-not-persist-in-golang", "title": "Gorilla Sessions Does Not Persist in Golang", "body": "<p>I'm having trouble with persisting the sessions in Golang using the Gorilla session handler. Similar issues (unresolved!) have been brought up in other stack overflow questions (here: <a href=\"https://stackoverflow.com/questions/21865681/sessions-variables-in-golang-not-saved-while-using-gorilla-sessions\">Sessions variables in golang not saved while using gorilla sessions</a> and here: <a href=\"https://stackoverflow.com/questions/28237806/cannot-get-gorilla-session-value-by-key\">cannot get gorilla session value by key</a>). This is very scary, as it seems that 1) it is not just me 2) there does not seem to be a solution that currently exists 3) the Gorilla Sessions package may be fundamentally broken.</p>\n\n<p>Here is the problem in more detail:</p>\n\n<p>I can set sessions no problem when logging in. However, after I am logged in and I make another request to the backend the sessions values are not persisted, meaning that I cannot pull sessions.Value['username'] for example (even though that is the point of sessions). </p>\n\n<p>So: </p>\n\n<p>A) Log in, write sessions, retrieve session.Value['usernames'] and it works fine.</p>\n\n<p>B) Navigate to another page on the front end and make another request to the backend (make a new character).</p>\n\n<p>C) Attempt to retrieve session.Value['username']. It's nil!!!!</p>\n\n<p>Here is the flow the user navigates on the backend to log in -</p>\n\n<p>First here is the session handler:</p>\n\n<pre><code>package config\n\nimport (\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/sessions\"\n)\n\ntype Options struct {\n    Path     string\n    Domain   string\n    MaxAge   int\n    Secure   bool\n    HttpOnly bool\n}\n\ntype Session struct {\n    ID      string\n    Values  map[interface{}]interface{}\n    Options *Options\n    IsNew   bool\n}\n\ntype Store interface {\n    Get(r *http.Request, name string) (*sessions.Session, error)\n    New(r *http.Request, name string) (*sessions.Session, error)\n    Save(r *http.Request, w http.ResponseWriter, s *sessions.Session) error\n}\n\nvar SessionsStore = sessions.NewCookieStore([]byte(\"secret\"))\n\nfunc init() {\n    SessionsStore.Options = &amp;sessions.Options{\n        Domain:   \"localhost\",\n        Path:     \"/\",\n        MaxAge:   3600 * 8, // 8 hours\n        HttpOnly: true,\n    }\n}\n\nfunc KeyStore() (store Store) {\n\n    log.Print(\"inside KeyStore\")\n    store = SessionsStore\n    log.Print(\"Value of store is : \", store)\n    return store\n}\n</code></pre>\n\n<p>Next, here is how I get from main to the routing to each of my components:</p>\n\n<p>Main</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n\n    _ \"github.com/lib/pq\"\n    \"github.com/patientplatypus/gorest/config\"\n\n    \"github.com/gorilla/handlers\"\n)\n\nconst (\n    host     = \"localhost\"\n    port     = 5432\n    user     = \"patientplatypus\"\n    password = \"superdupersecretyo\"\n    dbname   = \"dungeon_world\"\n)\n\nfunc main() {\n\n    psqlInfo := fmt.Sprintf(\"host=%s port=%d user=%s \"+\n        \"password=%s dbname=%s sslmode=disable\",\n        \"localhost\", 5432, \"patientplatypus\", \"supersecret\", \"dungeon_world\")\n    var err error\n    config.DB, err = sql.Open(\"postgres\", psqlInfo)\n    if err != nil {\n        panic(err)\n    }\n\n    err = config.DB.Ping()\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(\"Successfully connected~!\")\n\n    router := NewRouter()\n    os.Setenv(\"ORIGIN_ALLOWED\", \"*\")\n    headersOk := handlers.AllowedHeaders([]string{\"X-Requested-With\", \"Content-Type\"})\n    originsOk := handlers.AllowedOrigins([]string{os.Getenv(\"ORIGIN_ALLOWED\")})\n    methodsOk := handlers.AllowedMethods([]string{\"GET\", \"HEAD\", \"POST\", \"PUT\", \"OPTIONS\"})\n\n    log.Fatal(http.ListenAndServe(\":8080\", handlers.CORS(originsOk, headersOk, methodsOk)(router)))\n\n}\n</code></pre>\n\n<p>Here is the routing package that routes to each handler:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n\n    \"github.com/patientplatypus/gorest/users\"\n\n    \"github.com/patientplatypus/gorest/dungeon_db\"\n\n    \"github.com/patientplatypus/gorest/character\"\n\n    \"github.com/patientplatypus/gorest/createcharacter\"\n\n    \"github.com/gorilla/mux\"\n)\n\ntype Route struct {\n    Name        string\n    Method      string\n    Pattern     string\n    HandlerFunc http.HandlerFunc\n}\n\ntype Routes []Route\n\nfunc NewRouter() *mux.Router {\n\n    router := mux.NewRouter().StrictSlash(true)\n    for _, route := range routes {\n        router.\n            Methods(route.Method).\n            Path(route.Pattern).\n            Name(route.Name).\n            Handler(route.HandlerFunc)\n    }\n\n    return router\n}\n\nvar routes = Routes{\n    Route{\n        \"ClassType\",\n        \"POST\",\n        \"/character/class\",\n        character.ClassType,\n    },\n    &lt;MORE ROUTES FOLLOWING SAME PATTERN&gt;\n}\n</code></pre>\n\n<p>Now here is the login function. This is where I wrote the original session and printed out session.Values['username'] to show that it works:</p>\n\n<pre><code>package users\n\nimport (\n    \"encoding/json\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/patientplatypus/gorest/config\"\n)\n\ntype LoginResponse struct {\n    Status string\n}\n\ntype User struct {\n    Username string\n    Password string\n    Id       int\n}\n\nfunc UserLogin(w http.ResponseWriter, r *http.Request) {\n\n    decoder := json.NewDecoder(r.Body)\n\n    var incomingjson User\n    err := decoder.Decode(&amp;incomingjson)\n\n    if err != nil {\n        panic(err)\n    }\n\n    username := incomingjson.Username\n    password := incomingjson.Password\n\n    log.Print(\"username: \", username)\n    log.Print(\"password: \", password)\n    if username != \"\" &amp;&amp; password != \"\" {\n        incomingjson.Login(w, r)\n    } else {\n        fmt.Fprintln(w, \"error username or password is blank!\")\n    }\n}\n\nfunc (incomingjson *User) Login(w http.ResponseWriter, r *http.Request) {\n    session, _ := config.KeyStore().Get(r, \"cookie-name\")\n    log.Print(\"loginjson: \", incomingjson)\n    var tempvar string\n\n    err := config.DB.QueryRow(\"SELECT username FROM users WHERE username=$1;\", incomingjson.Username).Scan(&amp;tempvar)\n    log.Print(\"err: \", err)\n    if err == nil {\n        // 1 row\n        log.Print(\"Found username\")\n        var passwordindatabase string\n        config.DB.QueryRow(\"SELECT password FROM users WHERE username=$1;\", &amp;incomingjson.Username).Scan(&amp;passwordindatabase)\n        if passwordindatabase == incomingjson.Password {\n            log.Print(\"username and password match!\")\n            session.Values[\"authenticated\"] = true\n            session.Values[\"username\"] = incomingjson.Username\n            config.KeyStore().Save(r, w, session)\n            response := LoginResponse{Status: \"Success, user logged in\"}\n            json.NewEncoder(w).Encode(response)\n        } else {\n            log.Print(\"username and password don't match!\")\n            session.Values[\"authenticated\"] = false\n            session.Values[\"username\"] = \"\"\n            config.KeyStore().Save(r, w, session)\n            response := LoginResponse{Status: \"Failure, username and password don't match\"}\n            json.NewEncoder(w).Encode(response)\n        }\n    } else {\n        //empty result or error\n        log.Print(\"Username not found or there was an error: \", err)\n        response := LoginResponse{Status: \"User not found!\"}\n        json.NewEncoder(w).Encode(response)\n    }\n}\n</code></pre>\n\n<p>Now here is the problem component. It's job is to make a new character after checking that the user exists (sessioncheck is ok)...</p>\n\n<p>So here I have: </p>\n\n<pre><code>package createcharacter\n\nimport (\n    \"encoding/json\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/patientplatypus/gorest/config\"\n)\n\nvar Username string\nvar Checkok bool\n\n\nfunc SessionsCheck(w http.ResponseWriter, r *http.Request) (username string, checkok bool) {\n    store := config.KeyStore()\n    session, _ := store.Get(r, \"cookie-name\")\n    log.Print(\"inside sessionscheck...what is the value of stuff....\")\n    log.Print(\"session: \", session)\n    log.Print(\"session.Values: \", session.Values)\n    log.Print(\"username: \", session.Values[\"username\"])\n    log.Print(\"authenticated: \", session.Values[\"authenticated\"])\n    if session.Values[\"username\"] == nil {\n        if session.Values[\"authenticated\"] == false {\n            log.Print(\"Verboten!\")\n            http.Error(w, \"Forbidden\", http.StatusForbidden)\n            return \"nil\", false\n        }\n    }\n    return session.Values[\"username\"].(string), true\n}\n\nfunc NewCharacter(w http.ResponseWriter, r *http.Request) {\n    Username, Checkok = SessionsCheck(w, r)\n    &lt;FUNCTION CONTINUES&gt;\n</code></pre>\n\n<p>This is where I am getting the error...but I don't know how to fix.</p>\n\n<p>The terminal output is : </p>\n\n<pre><code>2017/10/15 15:08:56 inside KeyStore\n2017/10/15 15:08:56 Value of store is : &amp;{[0xc42010c000] 0xc42007d5f0}\n2017/10/15 15:08:56 inside sessionscheck...what is the value of stuff....\n2017/10/15 15:08:56 session: &amp;{ map[] 0xc4201316b0 true 0xc4200e0a80 cookie-name}\n2017/10/15 15:08:56 session.Values: map[]\n2017/10/15 15:08:56 username: &lt;nil&gt;\n2017/10/15 15:08:56 authenticated: &lt;nil&gt;\n2017/10/15 15:08:56 http: panic serving [::1]:53668: interface conversion: interface {} is nil, not string\ngoroutine 13 [running]:\nnet/http.(*conn).serve.func1(0xc42015c5a0)\n    /usr/local/opt/go/libexec/src/net/http/server.go:1697 +0xd0\npanic(0x133bcc0, 0xc420061f00)\n    /usr/local/opt/go/libexec/src/runtime/panic.go:491 +0x283\ngithub.com/patientplatypus/gorest/createcharacter.SessionsCheck(0x1540d00, 0xc42010a540, 0xc42014ea00, 0xc42011ab00, 0x3, 0xc420001680)\n    /Users/patientplatypus/Documents/golang/src/github.com/patientplatypus/gorest/createcharacter/charactercontroller.go:31 +0x5c9\ngithub.com/patientplatypus/gorest/createcharacter.NewCharacter(0x1540d00, 0xc42010a540, 0xc42014ea00)\n    /Users/patientplatypus/Documents/golang/src/github.com/patientplatypus/gorest/createcharacter/charactercontroller.go:35 +0x5a\nnet/http.HandlerFunc.ServeHTTP(0x13b8690, 0x1540d00, 0xc42010a540, 0xc42014ea00)\n    /usr/local/opt/go/libexec/src/net/http/server.go:1918 +0x44\ngithub.com/gorilla/mux.(*Router).ServeHTTP(0xc420066360, 0x1540d00, 0xc42010a540, 0xc42014ea00)\n    /Users/patientplatypus/Documents/golang/src/github.com/gorilla/mux/mux.go:133 +0xed\ngithub.com/gorilla/handlers.(*cors).ServeHTTP(0xc42010c7e0, 0x1540d00, 0xc42010a540, 0xc42014e800)\n    /Users/patientplatypus/Documents/golang/src/github.com/gorilla/handlers/cors.go:118 +0x5c8\nnet/http.serverHandler.ServeHTTP(0xc42014a000, 0x1540d00, 0xc42010a540, 0xc42014e800)\n    /usr/local/opt/go/libexec/src/net/http/server.go:2619 +0xb4\nnet/http.(*conn).serve(0xc42015c5a0, 0x1541240, 0xc420061dc0)\n    /usr/local/opt/go/libexec/src/net/http/server.go:1801 +0x71d\ncreated by net/http.(*Server).Serve\n    /usr/local/opt/go/libexec/src/net/http/server.go:2720 +0x288\n</code></pre>\n\n<p>I am sorry for the verbosity, but I think this is the most minimal example I can reproduce from my code base. If anyone has any suggestions please let me know.</p>\n\n<p>EDIT: </p>\n\n<p>One thing that I have noticed is the following: </p>\n\n<pre><code>2017/10/15 15:08:56 session: &amp;{ map[] 0xc4201316b0 true 0xc4200e0a80 cookie-name}\n2017/10/15 15:08:56 session.Values: map[]\n</code></pre>\n\n<p>Seems to indicate that the username and authenticated (true 0xc4200e0a80) are being stored <em>outside</em> of the session.Values []map function. Why is that?</p>\n\n<p>EDIT EDIT: </p>\n\n<p>So...I thought that the way that I wrote config.KeyStore() may have been an issue so I rewrote it to the following and the persisted it throughout the project:</p>\n\n<pre><code>package config\n\nimport (\n    \"github.com/gorilla/sessions\"\n)\n\nvar SessionsStore = sessions.NewCookieStore([]byte(\"secret\"))\n\nfunc init() {\n    SessionsStore.Options = &amp;sessions.Options{\n        Domain:   \"localhost\",\n        Path:     \"/\",\n        MaxAge:   3600 * 8, // 8 hours\n        HttpOnly: true,\n    }\n}\n</code></pre>\n\n<p>So now wherever I need SessionsStore I just call conf.SessionsStore. That's seemingly as canonical a way to do it as I think is possible. I still have the same issue.</p>\n"}, {"tags": ["networking", "go", "tcp", "network-programming", "timeout"], "comments": [{"owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508099453, "post_id": 46759513, "comment_id": 80464766, "body": "Not sure what you mean? The Write call is blocking on the send, yet it does not timeout with an error as I understand it&#39;s supposed to? I don&#39;t care about ACK or anything. If the call takes longer than 1 second for ANY reason I want to return."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1508100220, "post_id": 46759513, "comment_id": 80464961, "body": "Are you certain that it\u2019s actually blocked on the write? I would check with a stack trace. If not try to make a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, since this should not block."}, {"owner": {"reputation": 4989, "user_id": 3745413, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jQsNL.png?s=128&g=1", "display_name": "Ron Maupin", "link": "https://stackoverflow.com/users/3745413/ron-maupin"}, "edited": false, "score": 0, "creation_date": 1508103412, "post_id": 46759513, "comment_id": 80465824, "body": "&quot;<i>I&#39;m writing a TCP client...</i>&quot; TCP doesn&#39;t have clients or servers, that is an application concept. TCP creates peer connections."}, {"owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "edited": false, "score": 0, "creation_date": 1508103471, "post_id": 46759513, "comment_id": 80465837, "body": "Hmmm I was running the client wrapped in a function that will reconnect. When I removed it from that the timeout now works. However, no defer is run when returning from the function on error."}, {"owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "reply_to_user": {"reputation": 4989, "user_id": 3745413, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jQsNL.png?s=128&g=1", "display_name": "Ron Maupin", "link": "https://stackoverflow.com/users/3745413/ron-maupin"}, "edited": false, "score": 0, "creation_date": 1508103539, "post_id": 46759513, "comment_id": 80465854, "body": "@RonMaupin it&#39;s a client in the context of the protocol in question (Open Pixel Control), but sure."}, {"owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1508104425, "post_id": 46759513, "comment_id": 80466080, "body": "@JimB the minimal viable example helped me find the issue, which turned out to be a deadlock. Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "is_accepted": false, "score": 0, "last_activity_date": 1508104378, "creation_date": 1508104378, "answer_id": 46760373, "question_id": 46759513, "link": "https://stackoverflow.com/questions/46759513/tcpconn-setwritedeadline-not-working/46760373#46760373", "title": "TCPConn SetWriteDeadline not working", "body": "<p>This turned out to be a deadlock issue.</p>\n\n<p>My program was using a lock each time it was sending on the <code>messages</code> channel using the Fanout pattern.</p>\n\n<p>The problem was that when I was returning the <code>err</code> on the Write timeout there was a <code>defer</code> call that attempted to lock that same <code>Mutex</code>. Since I did not get the output I was expecting I thought the timeout never triggered.</p>\n\n<pre><code>defer func() {\n    thing.ThatCreatedDeadlock()\n    log.Println(\"Expected to see this\")\n}\n</code></pre>\n\n<p>So simply logging on the <code>Write</code> error directly would have made this obvious:</p>\n\n<pre><code>    n, err := conn.Write(msg.ByteArray())\n    if err != nil {\n        log.Println(err)\n        return err\n    }\n</code></pre>\n"}], "owner": {"reputation": 9650, "user_id": 16432, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/bbbab6ce78c8eefe949983ecb09063c5?s=128&d=identicon&r=PG", "display_name": "Joakim", "link": "https://stackoverflow.com/users/16432/joakim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 358, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1508104378, "creation_date": 1508098263, "last_edit_date": 1508100090, "question_id": 46759513, "link": "https://stackoverflow.com/questions/46759513/tcpconn-setwritedeadline-not-working", "title": "TCPConn SetWriteDeadline not working", "body": "<p>I'm writing a TCP client in <strong>Golang</strong>. The server will never send any replies, or any data.</p>\n\n<p>As soon as I fail to write after a given timeout I want the client to close the connection.</p>\n\n<p>So from reading the documentation for <code>SetWriteDeadline</code> in <code>Conn</code>:\n<a href=\"https://golang.org/pkg/net/#Conn\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/#Conn</a></p>\n\n<pre><code>    // SetWriteDeadline sets the deadline for future Write calls\n    // and any currently-blocked Write call.\n    // Even if write times out, it may return n &gt; 0, indicating that\n    // some of the data was successfully written.\n    // A zero value for t means Write will not time out.\n    SetWriteDeadline(t time.Time) error\n</code></pre>\n\n<p>From the above description I use it like this:</p>\n\n<pre><code>...\nfor {\n    select {\n    case msg := &lt;-messages:\n        conn.SetWriteDeadline(time.Now().Add(1 * time.Second))\n\n        // When server goes away this just blocks forever. No timeout!\n        n, err := conn.Write(msg.ByteArray())\n        if err != nil {\n            return err\n        }\n        log.Printf(\"Sent %v bytes\\n\", n)\n    }\n}\n...\n</code></pre>\n\n<p>But the timeout is never triggered if the server goes away, instead the <code>Write</code> call will just block forever.</p>\n\n<ul>\n<li>What am I doing wrong with <code>SetWriteDeadline</code>?</li>\n<li>I want to kill the connection if the Write does not finish within the given timeout no matter what, if <code>SetWriteDeadline</code> is not the proper way to do that, how do I do it?</li>\n</ul>\n"}, {"tags": ["json", "go", "struct", "config", "decoding"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 3, "creation_date": 1508097622, "post_id": 46759119, "comment_id": 80464204, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/8270816/converting-go-struct-to-json\">Converting Go struct to JSON</a>"}, {"owner": {"reputation": 1878, "user_id": 1176867, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6eb5b6ce0fb206463e1fbf6729737c1?s=128&d=identicon&r=PG", "display_name": "Alessandro Santini", "link": "https://stackoverflow.com/users/1176867/alessandro-santini"}, "edited": false, "score": 1, "creation_date": 1508097859, "post_id": 46759119, "comment_id": 80464292, "body": "Duplicate, this comes up very often."}], "answers": [{"comments": [{"owner": {"reputation": 24536, "user_id": 111124, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8215e290861f1c44a457d26c4f24af70?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/111124/andrew"}, "edited": false, "score": 2, "creation_date": 1508104506, "post_id": 46759155, "comment_id": 80466100, "body": "If what that means is not obvious, dataSourceName needs to start with a capital, DataSourceName"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5682282"}, "edited": false, "score": 0, "creation_date": 1508131905, "post_id": 46759155, "comment_id": 80472179, "body": "Ok, now I get it. As someone from the Java world I thought it would not be a problem if the field isn&#39;t exported (as most libraries use the Reflection API anyway)."}], "tags": [], "owner": {"reputation": 164, "user_id": 1941323, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1e72eabd0b4b12697e74a46c0d63804d?s=128&d=identicon&r=PG", "display_name": "markos.aivazoglou", "link": "https://stackoverflow.com/users/1941323/markos-aivazoglou"}, "is_accepted": true, "score": 3, "last_activity_date": 1508096063, "creation_date": 1508096063, "answer_id": 46759155, "question_id": 46759119, "link": "https://stackoverflow.com/questions/46759119/json-decoder-ignores-struct-field-tags/46759155#46759155", "title": "JSON Decoder ignores struct field tags?", "body": "<p>You need to export your <code>dataSourceName</code> field as <code>encoding/json</code> package requires them to be so</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5682282"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 46759155, "answer_count": 1, "score": -2, "last_activity_date": 1508101903, "creation_date": 1508095819, "last_edit_date": 1508101903, "question_id": 46759119, "link": "https://stackoverflow.com/questions/46759119/json-decoder-ignores-struct-field-tags", "title": "JSON Decoder ignores struct field tags?", "body": "<p>I'm using the <code>Decoder</code> from package <code>encoding/json</code> to decode a JSON configuration file into a struct. The field names have a different case (lowercase first character in struct because of visibility concerns) in the file and struct so I'm using struct field tags as described in the <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">documentation</a>. The <strong>Problem</strong> is that <code>Decoder</code> seems to ignore these tags and the struct fields are empty. Any ideas what's wrong with my code?</p>\n\n<h2>config.json</h2>\n\n<pre><code>{\n    \"DataSourceName\": \"simple-blog.db\"\n}\n</code></pre>\n\n<h2>Config struct</h2>\n\n<pre><code>type Config struct {\n     dataSourceName string `json:\"DataSourceName\"`\n}\n</code></pre>\n\n<h2>Loading config</h2>\n\n<pre><code>func loadConfig(fileName string) {\n    file, err := os.Open(fileName)\n    if err != nil {\n        log.Fatalf(\"Opening config file failed: %s\", err)\n    }\n    defer file.Close()\n\n    decoder := json.NewDecoder(file)\n    config = &amp;Config{} // Variable config is defined outside\n    err = decoder.Decode(config)\n    if err != nil {\n        log.Fatalf(\"Decoding config file failed: %s\", err)\n    }\n\n    log.Print(\"Configuration successfully loaded\")\n}\n</code></pre>\n\n<h2>Usage</h2>\n\n<pre><code>loadConfig(\"config.json\")\nlog.Printf(\"DataSourceName: %s\", config.dataSourceName)\n</code></pre>\n\n<h2>Output</h2>\n\n<pre><code>2017/10/15 21:04:11 DB Name: \n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1508095169, "post_id": 46758978, "comment_id": 80463433, "body": "what&#39;s the error ??"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 1, "creation_date": 1508095327, "post_id": 46758978, "comment_id": 80463475, "body": "Ironically, stack overflow."}], "answers": [{"comments": [{"owner": {"reputation": 129, "user_id": 6620600, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/p5nMR.png?s=128&g=1", "display_name": "Pisti", "link": "https://stackoverflow.com/users/6620600/pisti"}, "edited": false, "score": 0, "creation_date": 1508095894, "post_id": 46759077, "comment_id": 80463628, "body": "Can you explain why did not run the code? Why didn&#39;t sprintf eat the interface type?"}, {"owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 1, "creation_date": 1508095976, "post_id": 46759077, "comment_id": 80463645, "body": "or you may just use fmt.Sprintf(&quot;%d&quot;, i) in String method"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 1, "creation_date": 1508096383, "post_id": 46759077, "comment_id": 80463790, "body": "<code>I</code> is not <code>int</code>. It may be an <code>int</code> under the covers, but <code>fmt</code> does not know that. It could find out if it wanted to, but if it did that then it would never call your <code>String</code> method at all. <code>String</code> recieves a value of type <code>I</code>, and so calling <code>fmt.Sprintf</code> in your <code>String</code> method is <i>exactly</i> like calling <code>fmt.Println</code> in <code>main</code>."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1508096488, "post_id": 46759077, "comment_id": 80463827, "body": "Yup, <code>%d</code> would work too. The thing is to get away from <code>fmt.Sprintf</code> from seeing calling <code>(I).String</code> as an option."}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": true, "score": 4, "last_activity_date": 1508095523, "creation_date": 1508095523, "answer_id": 46759077, "question_id": 46758978, "link": "https://stackoverflow.com/questions/46758978/stringer-interface-with-int-type/46759077#46759077", "title": "Stringer interface with int type", "body": "<p>Your problem is simple. You pass a value of type <code>I</code> to <code>fmt.Println</code>, wich calls <code>I</code>s <code>String</code> method, which calls <code>fmt.Sprintf</code> with a value of type <code>I</code>, which calls <code>I</code>s <code>String</code> method...</p>\n\n<p>Just change the body of <code>I</code>s <code>String</code> method to: <code>return fmt.Sprintf(\"%v\", int(i))</code> and you should be good to go.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 10903895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8d2c2adefc4952b41b4d62cdbd268f5?s=128&d=identicon&r=PG&f=1", "display_name": "art of go", "link": "https://stackoverflow.com/users/10903895/art-of-go"}, "is_accepted": false, "score": -1, "last_activity_date": 1564020335, "creation_date": 1564020335, "answer_id": 57193319, "question_id": 46758978, "link": "https://stackoverflow.com/questions/46758978/stringer-interface-with-int-type/57193319#57193319", "title": "Stringer interface with int type", "body": "<pre><code>fmt.Sprintf(\"%v\", i)\n</code></pre>\n\n<p>In Sprintf method, it will call i's string(), and i's string call this fmt.Sprintf(),so stack overflow. </p>\n"}], "owner": {"reputation": 129, "user_id": 6620600, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/p5nMR.png?s=128&g=1", "display_name": "Pisti", "link": "https://stackoverflow.com/users/6620600/pisti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 595, "favorite_count": 0, "accepted_answer_id": 46759077, "answer_count": 2, "score": 1, "last_activity_date": 1564020335, "creation_date": 1508094836, "last_edit_date": 1508095321, "question_id": 46758978, "link": "https://stackoverflow.com/questions/46758978/stringer-interface-with-int-type", "title": "Stringer interface with int type", "body": "<p>I'm just learning the golang language via Tour of Go and I reached the Stringer part. (<a href=\"https://tour.golang.org/methods/17\" rel=\"nofollow noreferrer\">https://tour.golang.org/methods/17</a>)</p>\n\n<p>I try to understand how it works so I tried it int tpye. It did not work.</p>\n\n<p>The code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype I int\n\nfunc (i I) String() string {\n    return fmt.Sprintf(\"%v\", i)\n}\n\nfunc main() {   \n    i := I(10)\n    fmt.Println(i)\n}\n</code></pre>\n\n<p>When I run the example I got an error and I do not quite understand what is the probem.</p>\n\n<p>My theory is this with String() method:\nWhen I run an printer code, the program looks for stringer method and if It is exists runs it.\nIt works like this?</p>\n\n<p>Can anyone explain this to me how does this exactly work?</p>\n\n<p>ERROR (in the Tour of Go):</p>\n\n<pre><code>runtime: goroutine stack exceeds 250000000-byte limit\nfatal error: stack overflow\n\nruntime stack:\nruntime.throw(0xff4a2, 0xe)\n    /usr/local/go/src/runtime/panic.go:605 +0x100\nruntime.newstack(0x0, 0x0)\n    /usr/local/go/src/runtime/stack.go:1050 +0x960\nruntime.morestack()\n    /usr/local/go/src/runtime/asm_amd64p32.s:378 +0xa0\n\ngoroutine 1 [running]:\nruntime.mallocgc(0x4, 0xef280, 0x18500300, 0x0, 0x0, 0x0)\n    /usr/local/go/src/runtime/malloc.go:581 +0xb60 fp=0x18500360 sp=0x18500358 pc=0x31440\nruntime.convT2E32(0xef280, 0x185003a4, 0x83cc0, 0x10)\n    /usr/local/go/src/runtime/iface.go:247 +0x80 fp=0x18500380 sp=0x18500360 pc=0x2e000\nmain.I.String(0xa, 0x185003d0, 0x185003d4, 0x0)\n    /tmp/sandbox580986616/main.go:10 +0x40 fp=0x185003b8 sp=0x18500380 pc=0xd4f60\nmain.(*I).String(0x1391de68, 0x11d050, 0x13972a80, 0xef280)\n    &lt;autogenerated&gt;:1 +0x40 fp=0x185003d0 sp=0x185003b8 pc=0xd51c0\nfmt.(*pp).handleMethods(0x13972a80, 0x76, 0x1, 0x0)\n    /usr/local/go/src/fmt/print.go:596 +0x3a0 fp=0x18500420 sp=0x185003d0 pc=0xcdf60\nfmt.(*pp).printArg(0x13972a80, 0xef280, 0x1391de68, 0x76)\n    /usr/local/go/src/fmt/print.go:679 +0x1a0 fp=0x18500468 sp=0x18500420 pc=0xce540\nfmt.(*pp).doPrintf(0x13972a80, 0xfe0ce, 0x2, 0x18500560, 0x1, 0x1)\n    /usr/local/go/src/fmt/print.go:996 +0x180 fp=0x18500508 sp=0x18500468 pc=0xd32c0\nfmt.Sprintf(0xfe0ce, 0x2, 0x18500560, 0x1, 0x1, 0x0, 0x0, 0x0)\n    /usr/local/go/src/fmt/print.go:196 +0x60 fp=0x18500538 sp=0x18500508 pc=0xca160\nmain.I.String(0xa, 0x18500588, 0x1850058c, 0x0).......\n</code></pre>\n"}, {"tags": ["go", "primes"], "comments": [{"owner": {"reputation": 35578, "user_id": 3000206, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/BK1fo.jpg?s=128&g=1", "display_name": "Carcigenicate", "link": "https://stackoverflow.com/users/3000206/carcigenicate"}, "edited": false, "score": 4, "creation_date": 1508091008, "post_id": 46758339, "comment_id": 80461952, "body": "Are you sure it doesn&#39;t take a string representation?"}], "answers": [{"tags": [], "owner": {"reputation": 2155, "user_id": 1931929, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/0hF7Y.png?s=128&g=1", "display_name": "augustzf", "link": "https://stackoverflow.com/users/1931929/augustzf"}, "is_accepted": false, "score": 2, "last_activity_date": 1508091202, "creation_date": 1508091202, "answer_id": 46758390, "question_id": 46758339, "link": "https://stackoverflow.com/questions/46758339/go-big-int-literal-overflows-int64/46758390#46758390", "title": "Go big int literal overflows int64", "body": "<p>Ah, duh.</p>\n\n<pre><code>a.SetString(\"20988936657440586486151264256610222593863921\", 10)\n</code></pre>\n"}], "owner": {"reputation": 2155, "user_id": 1931929, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/0hF7Y.png?s=128&g=1", "display_name": "augustzf", "link": "https://stackoverflow.com/users/1931929/augustzf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 272, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1508091202, "creation_date": 1508090895, "question_id": 46758339, "link": "https://stackoverflow.com/questions/46758339/go-big-int-literal-overflows-int64", "title": "Go big int literal overflows int64", "body": "<p>Is there a way to assign a humongous integer literal to a big Int in Go? </p>\n\n<pre><code>// error: constant overflows int64\nvar a = big.NewInt(20988936657440586486151264256610222593863921)\n</code></pre>\n"}, {"tags": ["go", "base64"], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 9424265, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-a-rf1HI0cV4/AAAAAAAAAAI/AAAAAAAAAwg/i9bq3u-Tju4/photo.jpg?sz=128", "display_name": "Masud Morshed", "link": "https://stackoverflow.com/users/9424265/masud-morshed"}, "edited": false, "score": 0, "creation_date": 1606633866, "post_id": 46758224, "comment_id": 115016106, "body": "how can I save the image file? please help."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 11, "last_activity_date": 1508090275, "creation_date": 1508090275, "answer_id": 46758224, "question_id": 46758126, "link": "https://stackoverflow.com/questions/46758126/golang-convert-base64-data-into-image-on-the-fly-and-send-response/46758224#46758224", "title": "Golang convert base64 data into image on the fly and send response", "body": "<p>The code in the question is close.  Try this:</p>\n\n<pre><code>data := \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX/TQBcNTh/AAAACklEQVR4nGNiAAAABgADNjd8qAAAAABJRU5ErkJggg==\"\n// The actual image starts after the \",\"\ni := strings.Index(data, \",\")\nif i &lt; 0 {\n    log.Fatal(\"no comma\")\n}\n// pass reader to NewDecoder\ndec := base64.NewDecoder(base64.StdEncoding, strings.NewReader(data[i+1:]))\n</code></pre>\n"}], "owner": {"reputation": 6750, "user_id": 2098614, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/cslmi.jpg?s=128&g=1", "display_name": "Ajey", "link": "https://stackoverflow.com/users/2098614/ajey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4520, "favorite_count": 3, "accepted_answer_id": 46758224, "answer_count": 1, "score": 6, "last_activity_date": 1574268777, "creation_date": 1508089636, "last_edit_date": 1574268777, "question_id": 46758126, "link": "https://stackoverflow.com/questions/46758126/golang-convert-base64-data-into-image-on-the-fly-and-send-response", "title": "Golang convert base64 data into image on the fly and send response", "body": "<p>I have a sample base64 data, that can be used in <code>img</code> html tags like this:</p>\n\n<pre><code>&lt;img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX/TQBcNTh/AAAACklEQVR4nGNiAAAABgADNjd8qAAAAABJRU5ErkJggg==\n\"/&gt;\n</code></pre>\n\n<p><a href=\"http://jsbin.com/suvuxigiwo/edit?html,output\" rel=\"nofollow noreferrer\">Demo </a></p>\n\n<p>And I am fiddling around with a small golang program.\nIn golang, how do I convert this static base64 encoded data into an image on the fly and then send it as an image in response.</p>\n\n<p>Example:</p>\n\n<pre><code>http.HandleFunc(\"/getImage\", imageHandler)\n\nfunc image(res http.ResponseWriter, req *http.Request) {\n    data := \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX/TQBcNTh/AAAACklEQVR4nGNiAAAABgADNjd8qAAAAABJRU5ErkJggg==\"\n    // Data is the base64 encoded image\n    dec := b64.NewDecoder(b64.StdEncoding, data)\n    res.Header().Set(\"Content-Type\", \"image/png\")\n    io.Copy(res, dec)\n}\n</code></pre>\n"}, {"tags": ["amazon-web-services", "redirect", "go", "https"], "comments": [{"owner": {"reputation": 1208, "user_id": 4753991, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5aceabb7606a3797004455b13ceb4f90?s=128&d=identicon&r=PG&f=1", "display_name": "Atul Agrawal", "link": "https://stackoverflow.com/users/4753991/atul-agrawal"}, "edited": false, "score": 0, "creation_date": 1508088328, "post_id": 46757870, "comment_id": 80460961, "body": "are you using any web server(nginx or apache) for your application"}, {"owner": {"reputation": 1, "user_id": 8666039, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ObVt.png?s=128&g=1", "display_name": "manifest", "link": "https://stackoverflow.com/users/8666039/manifest"}, "reply_to_user": {"reputation": 1208, "user_id": 4753991, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/5aceabb7606a3797004455b13ceb4f90?s=128&d=identicon&r=PG&f=1", "display_name": "Atul Agrawal", "link": "https://stackoverflow.com/users/4753991/atul-agrawal"}, "edited": false, "score": 0, "creation_date": 1508088587, "post_id": 46757870, "comment_id": 80461038, "body": "No webserver, just the net/http package."}, {"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1508095023, "post_id": 46757870, "comment_id": 80463387, "body": "<i>&quot;8080 just wont redirect the connection&quot;</i>  So, if it doesn&#39;t do the HTTP redirect, then what <b>does</b> it do?  Handle the request as normal?  Time out?  Connection refused?"}, {"owner": {"reputation": 1, "user_id": 8666039, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ObVt.png?s=128&g=1", "display_name": "manifest", "link": "https://stackoverflow.com/users/8666039/manifest"}, "edited": false, "score": 0, "creation_date": 1508095383, "post_id": 46757870, "comment_id": 80463484, "body": "Using curl for a normal HTTP-connection says that the connection is refused, yes."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 8666039, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ObVt.png?s=128&g=1", "display_name": "manifest", "link": "https://stackoverflow.com/users/8666039/manifest"}, "edited": false, "score": 0, "creation_date": 1508094344, "post_id": 46758805, "comment_id": 80463152, "body": "Tried this fix, still even Postman can&#39;t get any response. Shouldn&#39;t the port be inserted after the host, not the entire path anyhow?"}, {"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1508094927, "post_id": 46758805, "comment_id": 80463357, "body": "Read the edited question.  The setup is using iptables to map 80 &gt; 8080 and 443 &gt; 8081.  There&#39;s no need to specify any ports in the redirect."}], "tags": [], "owner": {"reputation": 10420, "user_id": 299462, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/1239668b80debd03fef129775ff3f065?s=128&d=identicon&r=PG", "display_name": "Kannaiyan", "link": "https://stackoverflow.com/users/299462/kannaiyan"}, "is_accepted": false, "score": 0, "last_activity_date": 1508093707, "creation_date": 1508093707, "answer_id": 46758805, "question_id": 46757870, "link": "https://stackoverflow.com/questions/46757870/golang-redirecting-to-https-in-aws/46758805#46758805", "title": "Golang redirecting to HTTPS in AWS", "body": "<p>You are missing <code>port</code> in the redirect</p>\n\n<blockquote>\n  <p>http.Redirect(w, r, \"https://\" + reqhost + r.URL.Path + \":\" + port,\n  http.StatusMovedPermanently)</p>\n</blockquote>\n\n<p>You need to add port in there.\nAlso you can use postman in the request to see what is the location URL that is sent.</p>\n\n<p>Hope it helps.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 8666039, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ObVt.png?s=128&g=1", "display_name": "manifest", "link": "https://stackoverflow.com/users/8666039/manifest"}, "is_accepted": false, "score": 0, "last_activity_date": 1508103789, "creation_date": 1508103789, "answer_id": 46760289, "question_id": 46757870, "link": "https://stackoverflow.com/questions/46757870/golang-redirecting-to-https-in-aws/46760289#46760289", "title": "Golang redirecting to HTTPS in AWS", "body": "<p>I checked what was listening on my ports with </p>\n\n<pre><code>netstat -tulpn | grep LISTEN\n</code></pre>\n\n<p>..and there was apache listening on port 80. Either shutting it down or removing it works just fine.</p>\n"}], "owner": {"reputation": 1, "user_id": 8666039, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7ObVt.png?s=128&g=1", "display_name": "manifest", "link": "https://stackoverflow.com/users/8666039/manifest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 679, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1508103789, "creation_date": 1508088269, "last_edit_date": 1508100716, "question_id": 46757870, "link": "https://stackoverflow.com/questions/46757870/golang-redirecting-to-https-in-aws", "title": "Golang redirecting to HTTPS in AWS", "body": "<p>I'm having problems redirecting HTTP-traffic into HTTPS in my EC2 instance on a Golang-service. The connection works fine when going straight to <a href=\"https://sub.domain.com\" rel=\"nofollow noreferrer\">https://sub.domain.com</a>, but the redirect from HTTP doesn't seem to be working.</p>\n\n<p>There is no load balancer and it's using only the net/http package as the web server.</p>\n\n<p>I'm also using iptables that should be redirecting HTTP/HTTPS requests to ports 8080/8081 respectively.</p>\n\n<p>Just to narrow down the possibilities, the security group applied to the instance has connections to ports 80 and 443 allowed from any IPv4 or IPv6 address.</p>\n\n<p>Here is the server-code that serves HTTPS and is supposed to redirect HTTP requests;</p>\n\n<pre><code>    // LetsEncrypt setup\n    certManager := autocert.Manager{\n            Prompt:     autocert.AcceptTOS,\n            HostPolicy: autocert.HostWhitelist(\"sub.domain.com\"), // your domain here\n            Cache:      autocert.DirCache(\"certs\"),          // folder for storing certificates\n    }\n    server := &amp;http.Server{\n            Addr:      \":8081\",\n            Handler:   context.ClearHandler(http.DefaultServeMux),\n            TLSConfig: &amp;tls.Config{GetCertificate: certManager.GetCertificate},\n    }\n    // open https server\n    err = server.ListenAndServeTLS(\"\", \"\")\n    if err != nil {\n            fmt.Printf(\"ListenAndServe: %s\\n\", err)\n    }\n    // redirect everything to https\n    go http.ListenAndServe(\":8080\", http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            reqhost := strings.Split(r.Host, \":\")[0]\n            http.Redirect(w, r, \"https://\" + reqhost + r.URL.Path, http.StatusMovedPermanently)\n    }))\n</code></pre>\n\n<p>Here are my PREROUTING rules from iptables, other chains are empty;</p>\n\n<pre><code>    Chain PREROUTING (policy ACCEPT 0 packets, 0 bytes)\n pkts bytes target     prot opt in     out     source               destination\n    7   420 REDIRECT   tcp  --  eth0   any     anywhere             anywhere             tcp dpt:https redir ports 8081\n   45  2508 REDIRECT   tcp  --  eth0   any     anywhere             anywhere             tcp dpt:http redir ports 8080\n</code></pre>\n\n<p>Both redirects are getting packets on requests, but the 8080 just wont redirect the connection to the HTTPS side.</p>\n"}, {"tags": ["bash", "mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 1, "creation_date": 1508089976, "post_id": 46757753, "comment_id": 80461551, "body": "try checking the error returned from mgo.ParseURL, this example is ignoring any error that may be returned.   Also, try to <code>telnet IP:PORT</code> to make sure you can connect to the target host/port"}, {"owner": {"reputation": 346, "user_id": 5735210, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b84bfb2c8eb3cebfdf62f514bee0b864?s=128&d=identicon&r=PG&f=1", "display_name": "Cit5", "link": "https://stackoverflow.com/users/5735210/cit5"}, "reply_to_user": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1508287174, "post_id": 46757753, "comment_id": 80549100, "body": "updated the code and same error is returned. telnet just stalls. My AWS settings have the port open, not sure what is going on."}], "answers": [{"comments": [{"owner": {"reputation": 346, "user_id": 5735210, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b84bfb2c8eb3cebfdf62f514bee0b864?s=128&d=identicon&r=PG&f=1", "display_name": "Cit5", "link": "https://stackoverflow.com/users/5735210/cit5"}, "edited": false, "score": 0, "creation_date": 1509945624, "post_id": 47127355, "comment_id": 81210178, "body": "I fixed this a while ago but that must have been the issue: having a bad mgo URI format. thanks for answering!"}], "tags": [], "owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "is_accepted": true, "score": 3, "last_activity_date": 1509921161, "creation_date": 1509921161, "answer_id": 47127355, "question_id": 46757753, "link": "https://stackoverflow.com/questions/46757753/go-and-mongodb-connection-wont-work-with-panic-log-no-reachable-server/47127355#47127355", "title": "Go and MongoDB connection won&#39;t work with panic log &quot;no reachable server&quot;", "body": "<p>First, the URI should follow the <a href=\"https://godoc.org/gopkg.in/mgo.v2\" rel=\"nofollow noreferrer\">mgo</a> URI format </p>\n\n<pre><code>[mongodb://][user:pass@]host1[:port1][,host2[:port2],...][/database][?options]\n</code></pre>\n\n<p>See <a href=\"https://godoc.org/gopkg.in/mgo.v2#Dial\" rel=\"nofollow noreferrer\">mgo.v2 Dial func</a> for more information. </p>\n\n<p>If you're connecting to MongoDB Atlas (or your servers require SSL) see also <a href=\"https://stackoverflow.com/questions/41173720\">Connecting to MongoDB Atlas using mgo</a></p>\n\n<p>Second, make sure you can reach the MongoDB server(s) from your application server. You can utilise <a href=\"https://docs.mongodb.com/manual/mongo/\" rel=\"nofollow noreferrer\">mongo shell</a> to test the connection (eliminating your code issue for now). </p>\n"}], "owner": {"reputation": 346, "user_id": 5735210, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/b84bfb2c8eb3cebfdf62f514bee0b864?s=128&d=identicon&r=PG&f=1", "display_name": "Cit5", "link": "https://stackoverflow.com/users/5735210/cit5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1667, "favorite_count": 0, "accepted_answer_id": 47127355, "answer_count": 1, "score": 1, "last_activity_date": 1509921161, "creation_date": 1508087633, "last_edit_date": 1508208632, "question_id": 46757753, "link": "https://stackoverflow.com/questions/46757753/go-and-mongodb-connection-wont-work-with-panic-log-no-reachable-server", "title": "Go and MongoDB connection won&#39;t work with panic log &quot;no reachable server&quot;", "body": "<p>I am using mGo as a driver for my Go Web App to another MongoDB system. So I am not running Mongo on the same system. (URL is not localhost).</p>\n\n<p>However, I get \"panic: no reachable servers\" error.</p>\n\n<p>Here is the test function that runs right when the Go server starts:</p>\n\n<pre><code>dialInfo, err0 := mgo.ParseURL(\"mongodb://1234MY456IP:27017,27018\")\nif err0 != nil {\n    panic(err0)\n}\ndialInfo.Direct = true\ndialInfo.FailFast = true\nsession, err := mgo.DialWithInfo(dialInfo)\nif err != nil {\n    panic(err)\n}\ndefer session.Close()\n</code></pre>\n\n<p>One of the answers in a similar question was to make sure MongoDB is running on <code>netstat</code> or <code>ps</code>.</p>\n\n<p>I don't see any processes running on ps except ps and bash. And I don't see it on netstat either.</p>\n\n<p>That being I've ran sudo service mongod start/stop/restart and tested with the mongo shell. What am I doing wrong?</p>\n\n<p>Err0 and err print the same error message.</p>\n"}, {"tags": ["string", "url", "go", "byte"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 1, "creation_date": 1508076169, "post_id": 46755492, "comment_id": 80457070, "body": "Are you certain the <code>data</code> URL parameter contains only decimal values, and they&#39;re always 2 digits (i.e. <code>00 .. 99</code>)? If so, you can simply loop through the string in 2-byte increments, using <code>strconv.ParseUint</code> to decode each of the 2-byte strings as byte-sized integers. Alternatively, parse it as 2 <code>uint64</code> values in decimal form and convert the bytes using bit shifting. Btw, why 12 bytes if the <code>data</code> you provided is only 11? I&#39;d understand if you were using cgo with a C API to do the decoding, but it doesn&#39;t look like you are."}, {"owner": {"reputation": 213, "user_id": 5046520, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1e2b960e50c074118062eb9e953d7f3d?s=128&d=identicon&r=PG&f=1", "display_name": "AugustoQ", "link": "https://stackoverflow.com/users/5046520/augustoq"}, "edited": false, "score": 0, "creation_date": 1508078439, "post_id": 46755492, "comment_id": 80457750, "body": "Actually, this is something I should have put on the post (I&#39;ll edit it in now), but the <code>data</code> parameter contains 12 bytes in hex, not decimal, so <code>00..ff</code>. The data I put there was a test url I used, where I miscounted the number of bytes I was sending, you reckon that might have caused the json decoder to fail? As for the parsing you suggested, I had thought of it, (in fact, I had to do something similar in another project on Arduino), I just wanted to make sure that there wasn&#39;t a readymade solution, like the <code>strconv</code> package."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1508080472, "post_id": 46755492, "comment_id": 80458384, "body": "Do <a href=\"https://golang.org/pkg/net/http/httputil/#DumpRequest\" rel=\"nofollow noreferrer\">DumpRequest</a> before you do the json decode, does the body actually have some data? Is it complete and valid json?"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1508082246, "last_edit_date": 1508082246, "creation_date": 1508081405, "answer_id": 46756724, "question_id": 46755492, "link": "https://stackoverflow.com/questions/46755492/getting-a-byte-array-as-a-string-in-url-params/46756724#46756724", "title": "Getting a byte array as a string in url params", "body": "<p>Use the <a href=\"https://godoc.org/encoding/hex\" rel=\"nofollow noreferrer\">encoding/hex</a> package.</p>\n\n<pre><code>r.ParseForm()\nvar message SigFoxMessage\nn, err := hex.Decode(message.Data[:], []byte(r.FormValue(\"data\")))\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Printf(\"decoded %d bytes: %q\\n\", n, message.Data[:])\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/kfW1t2ADsR\" rel=\"nofollow noreferrer\">https://play.golang.org/p/kfW1t2ADsR</a></p>\n"}], "owner": {"reputation": 213, "user_id": 5046520, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1e2b960e50c074118062eb9e953d7f3d?s=128&d=identicon&r=PG&f=1", "display_name": "AugustoQ", "link": "https://stackoverflow.com/users/5046520/augustoq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1460, "favorite_count": 0, "accepted_answer_id": 46756724, "answer_count": 1, "score": 0, "last_activity_date": 1508082246, "creation_date": 1508073824, "last_edit_date": 1508078791, "question_id": 46755492, "link": "https://stackoverflow.com/questions/46755492/getting-a-byte-array-as-a-string-in-url-params", "title": "Getting a byte array as a string in url params", "body": "<p>Basically, here's my problem: I have a device connected to SigFox which sends 12 bytes of data, which is then rerouted to my golang server using a callback. I tried going the usual route, and decoding the information sent by the callback as a json with <code>json.NewDecoder(r.Body).Decode(&amp;m)</code>, where <code>m</code> is a struct that contains the information sent by the SigFox api on the callback, aka:</p>\n\n<pre><code>type SigFoxMessage struct {\n    Time int64 `json:\"time\"` // I'm getting an epoch timestamp, which I then convert to time.Time\n    Data [12]byte `json:\"data\"`\n    Lat int `json:\"lat\"`\n    Lng int `json:\"lng\"`\n}\n</code></pre>\n\n<p>However, this was always giving me an EOF error, and so I decided to go with <code>r.ParseForm()</code>, and <code>r.Form[\"key\"]</code>. The only problem with this new approach is that it returns the values of the parameters as strings, which isn't a big deal when dealing with the <code>int</code>s and the <code>int64</code>, as I can just use the <code>strconv</code> package. The problem is the 12 bytes of data.</p>\n\n<p>Since they are received as a string, that means I get something like <code>\"3132333435363738393130\"</code> (the 12 bytes in hex, so 2 characters per byte is a certainty), which I want to convert to <code>[12]byte{31, 32, 33, 34, 35, 36, 37, 38, 39, 31, 30}</code>. But I can't find anyway to do this besides actually implementing a function to parse it. I tried searching for string to byte array conversion, but all I can find are ways to turn byte arrays into strings (which would be turing my <code>[12]byte{'1', '2', '3', '4', '5', '6', '7', '8', '9', '1', '0'}</code> into <code>\"12345678910\"</code>, and which doesn't interest me), or how to turn strings into array of characters (<code>\"3132333435363738393130\" -&gt; []byte{'3', '1', '3', ... }</code>), which also doesn't interest me.</p>\n\n<p>Anyways, is there an actual way to do it without having to write the code to parse it?</p>\n\n<p>Also, any ideas why the json decoder might not have worked?</p>\n\n<p><strong>Edit:</strong> I should have put this right away, this is what the params of the request look like:</p>\n\n<p><code>?time=1507834946&amp;data=3132333435363738393130&amp;lat=-8.0&amp;lng=-35.0</code></p>\n\n<p><strong>Edit 2:</strong> The data parameter has the bytes in hex, so every two characters correspond to one byte, ranging from <code>00</code> to <code>ff</code>. The example case I provided was a counting error when trying to send the message with SigFox, and has only 11 bytes. From what I've seen of Go, that shouldn't be a problem, as I believe it would then complete the missing byte, so I don't think that was the reason json decoder failed, but I'll try it with the correct number of bytes now.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 5986, "user_id": 161222, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/212ca1d74ff55e4ba7c1363f7c0fb55f?s=128&d=identicon&r=PG", "display_name": "Radi", "link": "https://stackoverflow.com/users/161222/radi"}, "edited": false, "score": 1, "creation_date": 1508064695, "post_id": 46753749, "comment_id": 80454085, "body": "Try use this library <a href=\"https://github.com/tidwall/gjson\" rel=\"nofollow noreferrer\">github.com/tidwall/gjson</a>"}], "answers": [{"tags": [], "owner": {"reputation": 5986, "user_id": 161222, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/212ca1d74ff55e4ba7c1363f7c0fb55f?s=128&d=identicon&r=PG", "display_name": "Radi", "link": "https://stackoverflow.com/users/161222/radi"}, "is_accepted": false, "score": 0, "last_activity_date": 1508090053, "last_edit_date": 1508090053, "creation_date": 1508066545, "answer_id": 46754494, "question_id": 46753749, "link": "https://stackoverflow.com/questions/46753749/unmarshal-json-that-could-be-a-string-or-an-object/46754494#46754494", "title": "Unmarshal JSON that could be a string or an object", "body": "<p>You can use <a href=\"https://github.com/tidwall/gjson#unmarshal-to-a-map\" rel=\"nofollow noreferrer\">GJson</a> library to unmarshal your JSON to map, then iterate on this map and do the conversion that you need using your structs and based on fields type (map or string).</p>\n\n<p>Update: Example using this method with similar case \n<a href=\"http://blog.serverbooter.com/post/parsing-nested-json-in-go/\" rel=\"nofollow noreferrer\">http://blog.serverbooter.com/post/parsing-nested-json-in-go/</a></p>\n"}, {"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 4, "last_activity_date": 1535016358, "last_edit_date": 1535016358, "creation_date": 1508077067, "answer_id": 46756027, "question_id": 46753749, "link": "https://stackoverflow.com/questions/46753749/unmarshal-json-that-could-be-a-string-or-an-object/46756027#46756027", "title": "Unmarshal JSON that could be a string or an object", "body": "<p>Your structure is a little bit off from the json's. <code>Fields</code> in <code>EntryVersion</code> is an object not an array so making it a slice is not what you want. I would recommend you change it to this:</p>\n\n<pre><code>type EntryVersion struct {\n    Slug   string                       `json:\"slug\"`\n    Fields map[string]EntryVersionBlock `json:\"fields\"`\n}\n</code></pre>\n\n<p>The <code>EntryVersionBlock</code> does not have a <code>\"type\"</code> field in the corresponding json, it has entries with field names <code>\"new1\"</code>, <code>\"new2\"</code>, etc. So I would recommend you add a 3rd type <code>Entry</code> into which you unmarshal those fields.</p>\n\n<pre><code>type Entry struct {\n    Type   string            `json:\"type\"`\n    Fields map[string]string `json:\"fields\"`\n}\n</code></pre>\n\n<p>And you would update your <code>EntryVersionBlock</code> to look something like this:</p>\n\n<pre><code>type EntryVersionBlock struct {\n    Value  string           `json:\"-\"`\n    Fields map[string]Entry `json:\"fields\"`\n}\n</code></pre>\n\n<p>And to deal with your original problem you can have the <code>EntryVersionBlock</code> type implement the <code>json.Unmarshaler</code> interface, check the first byte in the data passed to the <code>UnmarshalJSON</code> method and if it's a double quote it's a string and if it's a curly opening brace it's an object. Something like this:</p>\n\n<pre><code>func (evb *EntryVersionBlock) UnmarshalJSON(data []byte) error {\n    switch data[0] {\n    case '\"':\n        if err := json.Unmarshal(data, &amp;evb.Value); err != nil {\n            return err\n        }\n    case '{':\n        evb.Fields = make(map[string]Entry)\n        if err := json.Unmarshal(data, &amp;evb.Fields); err != nil {\n            return err\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/IsTXI5202m\" rel=\"nofollow noreferrer\">https://play.golang.org/p/IsTXI5202m</a></p>\n"}], "owner": {"reputation": 314, "user_id": 932548, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/468113fcbe6530f2436617d71af8ee65?s=128&d=identicon&r=PG", "display_name": "JimBlizz", "link": "https://stackoverflow.com/users/932548/jimblizz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1535016358, "creation_date": 1508061165, "question_id": 46753749, "link": "https://stackoverflow.com/questions/46753749/unmarshal-json-that-could-be-a-string-or-an-object", "title": "Unmarshal JSON that could be a string or an object", "body": "<p>I have a third party service that is returning JSON where one field contains a collection of data. Here is an example of the structure it returns.</p>\n\n<pre><code>{\n  \"title\": \"Afghanistan\",\n  \"slug\": \"afghanistan\",\n  \"fields\": {\n    \"fieldOne\": \"\",\n    \"fieldTwo\": {\n      \"new1\": {\n        \"type\": \"contentBlock\",,\n        \"fields\": {\n          \"richTextBlick\": \"&lt;p&gt;This is the travel advice.&lt;\\/p&gt;\"\n        }\n      }\n    },\n    \"fieldThree\": {\n      \"new1\": {\n        \"type\": \"introBlock\",\n        \"fields\": {\n          \"text\": \"This is a title\"\n          \"richText\": \"&lt;p&gt;This is the current travel summary for Afganistan.&lt;\\/p&gt;\"\n        }\n      },\n      \"new2\": {\n        \"type\": \"contentBlock\",\n        \"fields\": {\n          \"richText\": \"&lt;p&gt;It has a second block of content!&lt;\\/p&gt;\"\n        }\n      }\n    },\n    \"fieldfour\": \"country\"\n  }\n}\n</code></pre>\n\n<p>Each of the \"field\" entries could be either a string or another object. I'd like to decode these into something like the structs below.</p>\n\n<pre><code>type EntryVersion struct {\n    Slug string `json:\"slug\"`\n    Fields map[string][]EntryVersionBlock `json:\"fields\"`\n}\n\ntype EntryVersionBlock struct {\n    Type string `json:\"type\"`\n    Fields map[string]string `json:\"fields\"`\n}\n</code></pre>\n\n<p>If the field value is simply a string, I would wrap it in an EntryVersionBlock with the type of \"Text\" and a single entry in the Fields map.</p>\n\n<p>Any ideas how can I do this in an efficient manner? I may have to do it several hundred times in an extreme edge-case.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": false, "score": 1, "last_activity_date": 1508063969, "creation_date": 1508063969, "answer_id": 46754130, "question_id": 46753736, "link": "https://stackoverflow.com/questions/46753736/extract-digits-at-a-certain-position-in-a-number/46754130#46754130", "title": "Extract digits at a certain position in a number", "body": "<p>you cant turn int into slice of digits in golang</p>\n\n<p>the trick is u have to turn it into string, do the composition, then fallback to int seperatly</p>\n\n<p><a href=\"https://play.golang.org/p/eZn1onG7T6\" rel=\"nofollow noreferrer\">https://play.golang.org/p/eZn1onG7T6</a></p>\n"}, {"comments": [{"owner": {"reputation": 4612, "user_id": 1979650, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/51efcdac18fa0a3be4f2ff5e1bfec382?s=128&d=identicon&r=PG", "display_name": "Sergey Onishchenko", "link": "https://stackoverflow.com/users/1979650/sergey-onishchenko"}, "edited": false, "score": 1, "creation_date": 1508075095, "post_id": 46754159, "comment_id": 80456712, "body": "Thanks for the help. You made me a clue how to do it:  \tstr := strconv.Itoa(111555)     \tstr[len(str)-2:] //trailing 2 digits     \tstr[:3] //first 3 digits"}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 4, "last_activity_date": 1508083919, "last_edit_date": 1508083919, "creation_date": 1508064233, "answer_id": 46754159, "question_id": 46753736, "link": "https://stackoverflow.com/questions/46753736/extract-digits-at-a-certain-position-in-a-number/46754159#46754159", "title": "Extract digits at a certain position in a number", "body": "<p>Try <a href=\"https://play.golang.org/p/nYz7yIFgqR\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>number := 111555\nslice := strconv.Itoa(number)    \nfmt.Println(slice[:3]) // first 3 digits (111)    \nfmt.Println(slice[len(slice)-2:]) // and the last 2 digits (55)\n</code></pre>\n\n<hr>\n\n<p>The first 3 digits (111):</p>\n\n<pre><code>strconv.Itoa(number)[:3]\n</code></pre>\n\n<p>and the last 2 digits (55):</p>\n\n<pre><code>number % 100\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>slice := strconv.Itoa(number)\nslice[len(slice)-2:]\n</code></pre>\n\n<hr>\n\n<p>try <a href=\"https://play.golang.org/p/nGT-MZlRd-\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    number := 111555\n    // and the last 2 digits (55)\n    l2d := number % 100\n    fmt.Println(l2d)\n\n    // first 3 digits (111)\n    f3d := strconv.Itoa(number)[:3]\n    // i, e := strconv.Atoi(f3d)\n    fmt.Println(f3d)\n}\n</code></pre>\n\n<hr>\n\n<p>another way:</p>\n\n<p>Two right(last) digits:</p>\n\n<pre><code>l2d := number % 100\n</code></pre>\n\n<p>First(left) 3 digits (111):</p>\n\n<pre><code>n := numberOfDigits(number)\nremainingDigits := n - 3\nf3d := number / power10(remainingDigits)\n</code></pre>\n\n<p>try <a href=\"https://play.golang.org/p/BhTcSud8vh\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    number := 111555\n    // and the last 2 digits (55)\n    l2d := number % 100\n    fmt.Println(l2d)\n\n    // first 3 digits (111)\n    n := numberOfDigits(number)\n    remainingDigits := n - 3\n    f3d := number / power10(remainingDigits)\n    fmt.Println(f3d)\n}\nfunc numberOfDigits(number int) int {\n    i := 0\n    for number != 0 {\n        i++\n        number /= 10\n    }\n    return i\n}\nfunc power10(n int) int {\n    f := 1\n    for ; n &gt; 0; n-- {\n        f *= 10\n    }\n    return f\n}\n</code></pre>\n\n<hr>\n\n<p><a href=\"https://play.golang.org/p/7EMC3s0kHF\" rel=\"nofollow noreferrer\">another way</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    number := 111555\n    // and the last 2 digits (55)\n    l2d := number % 100\n    fmt.Println(l2d)\n    // first 3 digits (111)\n    fmt.Println(leftDigits(number, 3))\n\n}\n\nfunc leftDigits(number, n int) int {\n    digits := make([]byte, 20)\n    i := -1\n    for number != 0 {\n        i++\n        digits[i] = byte(number % 10)\n        number /= 10\n    }\n    r := 0\n    for ; n != 0; n-- {\n        r = r * 10\n        r += int(digits[i])\n        i--\n    }\n    return r\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>55\n111\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 59, "user_id": 5429860, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-uJgVQdMge1s/AAAAAAAAAAI/AAAAAAAAABI/7KMbbfYvUrQ/photo.jpg?sz=128", "display_name": "\u591c\u9611\u542c\u98ce", "link": "https://stackoverflow.com/users/5429860/%e5%a4%9c%e9%98%91%e5%90%ac%e9%a3%8e"}, "is_accepted": false, "score": 1, "last_activity_date": 1508068070, "creation_date": 1508068070, "answer_id": 46754670, "question_id": 46753736, "link": "https://stackoverflow.com/questions/46753736/extract-digits-at-a-certain-position-in-a-number/46754670#46754670", "title": "Extract digits at a certain position in a number", "body": "<p>If the number is not too large, there is a simple way.</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"log\"\n    \"strconv\"\n)\nfunc main() {\n    num := 111555\n    s := strconv.Itoa(num)\n    pos := 3 // first 3 digits, others\n    part1 := s[:pos]\n    part2 := s[pos:]\n    num1, err := strconv.Atoi(part1)\n    if err != nil {\n        log.Fatal(err)\n    }\n    num2, err := strconv.Atoi(part2)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(num1, num2)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4612, "user_id": 1979650, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/51efcdac18fa0a3be4f2ff5e1bfec382?s=128&d=identicon&r=PG", "display_name": "Sergey Onishchenko", "link": "https://stackoverflow.com/users/1979650/sergey-onishchenko"}, "edited": false, "score": 1, "creation_date": 1508076442, "post_id": 46755013, "comment_id": 80457158, "body": "Getting the first 3 digits is ok only for this particular case (when the number of digits is 6). For different number of digits you need to use another power of 10."}, {"owner": {"reputation": 2155, "user_id": 1931929, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/0hF7Y.png?s=128&g=1", "display_name": "augustzf", "link": "https://stackoverflow.com/users/1931929/augustzf"}, "reply_to_user": {"reputation": 4612, "user_id": 1979650, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/51efcdac18fa0a3be4f2ff5e1bfec382?s=128&d=identicon&r=PG", "display_name": "Sergey Onishchenko", "link": "https://stackoverflow.com/users/1979650/sergey-onishchenko"}, "edited": false, "score": 0, "creation_date": 1508089242, "post_id": 46755013, "comment_id": 80461281, "body": "Yes, the answer is specific for the case of a 6-digit unsigned integer."}], "tags": [], "owner": {"reputation": 2155, "user_id": 1931929, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/0hF7Y.png?s=128&g=1", "display_name": "augustzf", "link": "https://stackoverflow.com/users/1931929/augustzf"}, "is_accepted": false, "score": 6, "last_activity_date": 1508070324, "creation_date": 1508070324, "answer_id": 46755013, "question_id": 46753736, "link": "https://stackoverflow.com/questions/46753736/extract-digits-at-a-certain-position-in-a-number/46755013#46755013", "title": "Extract digits at a certain position in a number", "body": "<p>By using simple arithmetic:</p>\n\n<pre><code>func d(num int) (firstThree int, lastTwo int) {\n    firstThree = num / 1000\n    lastTwo = num % 100\n    return\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4612, "user_id": 1979650, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/51efcdac18fa0a3be4f2ff5e1bfec382?s=128&d=identicon&r=PG", "display_name": "Sergey Onishchenko", "link": "https://stackoverflow.com/users/1979650/sergey-onishchenko"}, "is_accepted": false, "score": 1, "last_activity_date": 1508075257, "creation_date": 1508075257, "answer_id": 46755727, "question_id": 46753736, "link": "https://stackoverflow.com/questions/46753736/extract-digits-at-a-certain-position-in-a-number/46755727#46755727", "title": "Extract digits at a certain position in a number", "body": "<pre><code>str := strconv.Itoa(111555)\nfmt.Println(str[len(str)-2:]) //trailing 2 digits \nfmt.Println(str[:3]) //first 3 digits\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 563, "user_id": 4093473, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh3.googleusercontent.com/-bsbaM7Sy2tU/AAAAAAAAAAI/AAAAAAAAABU/QkjCVrm0kg0/photo.jpg?sz=128", "display_name": "swade", "link": "https://stackoverflow.com/users/4093473/swade"}, "edited": false, "score": 0, "creation_date": 1561587791, "post_id": 46756052, "comment_id": 100118146, "body": "This has no way of returning the last two or the first three like the question asked."}], "tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 4, "last_activity_date": 1508077160, "creation_date": 1508077160, "answer_id": 46756052, "question_id": 46753736, "link": "https://stackoverflow.com/questions/46753736/extract-digits-at-a-certain-position-in-a-number/46756052#46756052", "title": "Extract digits at a certain position in a number", "body": "<p>This function gives the digit at a specific place:</p>\n\n<pre><code>func digit(num, place int) int {\n    r := num % int(math.Pow(10, float64(place)))\n    return r / int(math.Pow(10, float64(place-1)))\n}\n</code></pre>\n\n<p>For example <code>digit(1234567890, 2)</code> gives <code>9</code> and <code>digit(1234567890, 6)</code> gives <code>5</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1508083380, "last_edit_date": 1508083380, "creation_date": 1508081933, "answer_id": 46756819, "question_id": 46753736, "link": "https://stackoverflow.com/questions/46753736/extract-digits-at-a-certain-position-in-a-number/46756819#46756819", "title": "Extract digits at a certain position in a number", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc strDigits(n, digits int) (string, int) {\n    s := strconv.Itoa(n)\n    if s[0] == '-' {\n        s = s[1:]\n    }\n    if digits &gt; len(s) {\n        digits = len(s)\n    }\n    if digits &lt; 0 {\n        digits = 0\n    }\n    return s, digits\n}\n\nfunc firstDigits(n, digits int) string {\n    s, d := strDigits(n, digits)\n    return s[:d]\n}\n\nfunc lastDigits(n, digits int) string {\n    s, d := strDigits(n, digits)\n    return s[len(s)-d:]\n}\n\nfunc main() {\n    number := 111555\n    fmt.Println(firstDigits(number, 3))\n    fmt.Println(lastDigits(number, 2))\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/oYwZ5HFndt\" rel=\"nofollow noreferrer\">https://play.golang.org/p/oYwZ5HFndt</a></p>\n\n<p>Output:</p>\n\n<pre><code>111\n55\n</code></pre>\n"}], "owner": {"reputation": 4612, "user_id": 1979650, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/51efcdac18fa0a3be4f2ff5e1bfec382?s=128&d=identicon&r=PG", "display_name": "Sergey Onishchenko", "link": "https://stackoverflow.com/users/1979650/sergey-onishchenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8136, "favorite_count": 1, "answer_count": 7, "score": 4, "last_activity_date": 1508083919, "creation_date": 1508061056, "question_id": 46753736, "link": "https://stackoverflow.com/questions/46753736/extract-digits-at-a-certain-position-in-a-number", "title": "Extract digits at a certain position in a number", "body": "<pre><code>number := 111555\n</code></pre>\n\n<p>How do I get, for instance the first 3 digits (111) and the last 2 digits (55)?</p>\n"}, {"tags": ["go", "visual-studio-code", "vscode-settings"], "answers": [{"tags": [], "owner": {"reputation": 4897, "user_id": 4573839, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-wLBU0P4GoTk/AAAAAAAAAAI/AAAAAAAAAPM/8Xy7C9d-XoU/photo.jpg?sz=128", "display_name": "yu yang Jian", "link": "https://stackoverflow.com/users/4573839/yu-yang-jian"}, "is_accepted": true, "score": 2, "last_activity_date": 1508048914, "last_edit_date": 1508048914, "creation_date": 1508048260, "answer_id": 46752276, "question_id": 46752275, "link": "https://stackoverflow.com/questions/46752275/go-not-in-vscode-workspace-settings-user-settings/46752276#46752276", "title": "go not in vscode workspace settings user settings", "body": "<p>In my case, by setting the <code>Go Extension</code> to <code>Enable (Always)</code>, then <code>Go Settings (Go configuration)</code> will show in the user settings.</p>\n\n<p>Step:</p>\n\n<ol>\n<li>Open the Extension Tab (keyboard shortcut: <kbd>Ctrl+Shift+X</kbd>) in VS Code, and Search \"Go\".</li>\n<li>Click the gear and set <code>Enable (Always)</code></li>\n<li>Click Reload, and <code>Go configuration</code> will appear in user settings.</li>\n</ol>\n\n<hr>\n\n<p>Screenshot:</p>\n\n<p><a href=\"https://i.stack.imgur.com/ErApz.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ErApz.png\" alt=\"enter image description here\"></a> </p>\n\n<p><a href=\"https://i.stack.imgur.com/vmnzZ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/vmnzZ.png\" alt=\"enter image description here\"></a></p>\n\n<p><a href=\"https://i.stack.imgur.com/nav8I.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/nav8I.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 4897, "user_id": 4573839, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-wLBU0P4GoTk/AAAAAAAAAAI/AAAAAAAAAPM/8Xy7C9d-XoU/photo.jpg?sz=128", "display_name": "yu yang Jian", "link": "https://stackoverflow.com/users/4573839/yu-yang-jian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 297, "favorite_count": 0, "accepted_answer_id": 46752276, "answer_count": 1, "score": 1, "last_activity_date": 1508048914, "creation_date": 1508048260, "last_edit_date": 1508048601, "question_id": 46752275, "link": "https://stackoverflow.com/questions/46752275/go-not-in-vscode-workspace-settings-user-settings", "title": "go not in vscode workspace settings user settings", "body": "<p>I have installed <code>Go</code> Extension in VSCode, and in <code>How to use this extension?</code> section on <a href=\"https://marketplace.visualstudio.com/items?itemName=lukehoban.Go\" rel=\"nofollow noreferrer\">Extension Web Page</a>, it mentions many go settings like <code>go.toolsGopath</code>, <code>go.gocodeAutoBuild</code>, <code>go.formatOnSave</code>,</p>\n\n<p>But when I use <kbd>Ctrl + ,</kbd> to <a href=\"https://code.visualstudio.com/docs/getstarted/settings#_creating-user-and-workspace-settings\" rel=\"nofollow noreferrer\">Open the User Settings</a>, I <strong>didn't</strong> see any <code>Go</code> settings, there's no <code>Go</code> Settings block in User Settings:</p>\n\n<p><a href=\"https://i.stack.imgur.com/C7BCI.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/C7BCI.png\" alt=\"enter image description here\"></a></p>\n\n<p>How do I make <code>Go</code> Settings show in User Settings?</p>\n"}, {"tags": ["go", "bigint"], "answers": [{"tags": [], "owner": {"reputation": 323, "user_id": 1691128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa54e7b8d30fabd4e3cb019dbaecfdb8?s=128&d=identicon&r=PG&f=1", "display_name": "audionuma", "link": "https://stackoverflow.com/users/1691128/audionuma"}, "is_accepted": false, "score": 0, "last_activity_date": 1508047711, "creation_date": 1508047711, "answer_id": 46752218, "question_id": 46752171, "link": "https://stackoverflow.com/questions/46752171/big-int-giving-me-wrong-results-in-equality/46752218#46752218", "title": "big int giving me wrong results in equality", "body": "<p>Have a look at the (*int)Cmp function.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc main() {\n    a := big.NewInt(5)\n    b := big.NewInt(5)\n    fmt.Println(a == b)\n    fmt.Println(a.Cmp(b))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 6, "last_activity_date": 1508050842, "last_edit_date": 1508050842, "creation_date": 1508048869, "answer_id": 46752331, "question_id": 46752171, "link": "https://stackoverflow.com/questions/46752171/big-int-giving-me-wrong-results-in-equality/46752331#46752331", "title": "big int giving me wrong results in equality", "body": "<blockquote>\n  <p><a href=\"https://golang.org/pkg/math/big/\" rel=\"noreferrer\">Package big</a></p>\n\n<pre><code>import \"math/big\"\n</code></pre>\n  \n  <p><a href=\"https://golang.org/pkg/math/big/#NewInt\" rel=\"noreferrer\">func NewInt</a></p>\n\n<pre><code>func NewInt(x int64) *Int\n</code></pre>\n  \n  <p>NewInt allocates and returns a new Int set to x.</p>\n  \n  <p><a href=\"https://golang.org/pkg/math/big/#Int.Cmp\" rel=\"noreferrer\">func (*Int) Cmp</a></p>\n\n<pre><code>func (x *Int) Cmp(y *Int) (r int)\n</code></pre>\n  \n  <p>Cmp compares x and y and returns:</p>\n\n<pre><code>-1 if x &lt;  y\n 0 if x == y\n+1 if x &gt;  y\n</code></pre>\n</blockquote>\n\n<p>The variables <code>a</code> and <code>b</code> are pointers: <code>*big.Int</code>. Use the <code>Cmp</code> method to compare values. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc main() {\n    a := big.NewInt(42)\n    fmt.Printf(\"a: %[1]T %[1]p %[1]v\\n\", a)\n    b := big.NewInt(42)\n    fmt.Printf(\"b: %[1]T %[1]p %[1]v\\n\", b)\n    fmt.Println(\"pointers:\", a == b)        // compare pointers\n    fmt.Println(\"values:  \", a.Cmp(b) == 0) // compare values\n\n    fmt.Println()\n    test := new(big.Int)\n    fmt.Println((test.Mod(big.NewInt(2015), big.NewInt(2))).Cmp(big.NewInt(1)) == 0)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/TH6UzceZ4y\" rel=\"noreferrer\">https://play.golang.org/p/TH6UzceZ4y</a></p>\n\n<p>Output:</p>\n\n<pre><code>a: *big.Int 0x1040a0c0 42\nb: *big.Int 0x1040a0d0 42\npointers: false\nvalues:   true\n\ntrue\n</code></pre>\n"}], "owner": {"reputation": 472, "user_id": 2744994, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/c9303582697002d5cf67b846653f8cc8?s=128&d=identicon&r=PG&f=1", "display_name": "rullzing", "link": "https://stackoverflow.com/users/2744994/rullzing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1520, "favorite_count": 1, "accepted_answer_id": 46752331, "answer_count": 2, "score": 3, "last_activity_date": 1508050842, "creation_date": 1508047075, "last_edit_date": 1508047279, "question_id": 46752171, "link": "https://stackoverflow.com/questions/46752171/big-int-giving-me-wrong-results-in-equality", "title": "big int giving me wrong results in equality", "body": "<p>For some reason I'm getting the wrong result from big int when I test the equality even though the mod result is actually correct!\nFor example, I would like to calculate 2015%2 which results in 1.</p>\n\n<p>When I use big int, I get false when I do this:</p>\n\n<pre><code>fmt.Println((test.Mod(big.NewInt(2015),big.NewInt(2)))==big.NewInt(1))\n</code></pre>\n\n<p>However, when I use regular int, I get true (which is the correct thing anyway):</p>\n\n<pre><code>fmt.Println(2015%2==1)\n</code></pre>\n\n<p>Am I supposed to do the equality differently when using big int?</p>\n"}, {"tags": ["python", "go", "raspberry-pi", "spi"], "comments": [{"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1508069656, "post_id": 46751154, "comment_id": 80455231, "body": "<code>print(spi.mode, spi.bits_per_word, </code> <b>spi.lsbfirst</b> <code>)</code> vs. <code>spiDev.SetBitOrder(</code> <b>spi.MSBFirst</b> <code>)</code> Could this be it?"}, {"owner": {"reputation": 11467, "user_id": 741404, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/28832e0d64ab5e5b21c9a78c02d8aefc?s=128&d=identicon&r=PG", "display_name": "jdevelop", "link": "https://stackoverflow.com/users/741404/jdevelop"}, "reply_to_user": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1508083689, "post_id": 46751154, "comment_id": 80459463, "body": "It&#39;s just a debug to see what is the MSB flag/bits per word value is. <code>lsbfirst</code> returned from Python is <code>false</code>"}], "answers": [{"tags": [], "owner": {"reputation": 11467, "user_id": 741404, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/28832e0d64ab5e5b21c9a78c02d8aefc?s=128&d=identicon&r=PG", "display_name": "jdevelop", "link": "https://stackoverflow.com/users/741404/jdevelop"}, "is_accepted": true, "score": 3, "last_activity_date": 1508126782, "creation_date": 1508126782, "answer_id": 46762795, "question_id": 46751154, "link": "https://stackoverflow.com/questions/46751154/golang-and-spi-trying-to-init-rf522-drive/46762795#46762795", "title": "Golang and SPI - trying to init RF522 drive", "body": "<p>It looks like the SPI module from Go distribution doesn't work as expected. I did some research using some logic analyzer and realized that the SPI command layer from exp/io/spi does not generate the appropriate commands.</p>\n\n<p>The source code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"golang.org/x/exp/io/spi\"\n    \"log\"\n)\n\nfunc main() {\n\n    spiDev, err := spi.Open(&amp;spi.Devfs{\n        Dev:      \"/dev/spidev0.0\",\n        MaxSpeed: int64(1000000),\n    })\n\n    spiDev.SetMode(spi.Mode0)\n    spiDev.SetBitOrder(spi.MSBFirst)\n    spiDev.SetBitsPerWord(8)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    writeSpiData := func(dataIn []byte) (out []byte, err error) {\n        out = make([]byte, len(dataIn))\n        err = spiDev.Tx(dataIn, out)\n        return\n    }\n\n    devWrite := func(address int, data byte) (err error) {\n        newData := [2]byte{(byte(address) &lt;&lt; 1) &amp; 0x7E, data}\n        readBuf, err := writeSpiData(newData[0:])\n        fmt.Println(\"&gt;&gt;\", newData, readBuf)\n        return\n    }\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    devWrite(0x01, 0x0F)\n\n    fmt.Println(\"Done\")\n\n}\n</code></pre>\n\n<p>The resulting data log:</p>\n\n<p><a href=\"https://i.stack.imgur.com/WgX6X.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/WgX6X.png\" alt=\"enter image description here\"></a></p>\n\n<p>Now with another driver, <a href=\"https://github.com/ecc1/spi\" rel=\"nofollow noreferrer\">https://github.com/ecc1/spi</a> the code looks like:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"github.com/ecc1/spi\"\n)\n\nfunc main() {\n\n    spiDev, err := spi.Open(\"/dev/spidev0.0\", 1000000, 0)\n\n    spiDev.SetMode(0)\n    spiDev.SetBitsPerWord(8)\n    spiDev.SetLSBFirst(false)\n    spiDev.SetMaxSpeed(1000000)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    writeSpiData := func(dataIn []byte) (err error) {\n        err = spiDev.Transfer(dataIn)\n        return\n    }\n\n    devWrite := func(address int, data byte) (err error) {\n        newData := [2]byte{(byte(address) &lt;&lt; 1) &amp; 0x7E, data}\n        fmt.Print(\"&lt;&lt; \", newData, \" \")\n        err = writeSpiData(newData[0:])\n        fmt.Println(\"&gt;&gt;\", newData)\n        return\n    }\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    devWrite(0x01, 0x0F)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n}\n</code></pre>\n\n<p>And the resulting protocol dump is correct:</p>\n\n<p><a href=\"https://i.stack.imgur.com/EbAxm.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/EbAxm.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 11467, "user_id": 741404, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/28832e0d64ab5e5b21c9a78c02d8aefc?s=128&d=identicon&r=PG", "display_name": "jdevelop", "link": "https://stackoverflow.com/users/741404/jdevelop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 814, "favorite_count": 1, "accepted_answer_id": 46762795, "answer_count": 1, "score": 3, "last_activity_date": 1508126782, "creation_date": 1508034851, "question_id": 46751154, "link": "https://stackoverflow.com/questions/46751154/golang-and-spi-trying-to-init-rf522-drive", "title": "Golang and SPI - trying to init RF522 drive", "body": "<p>I have a simple Python code that does initalize <a href=\"https://www.nxp.com/docs/en/data-sheet/MFRC522.pdf\" rel=\"nofollow noreferrer\">MFRC522</a> device properly:</p>\n\n<pre><code>    import spidev\n\n    mode_reset = 0x0F\n\n    def spi_transfer(data):\n        r = spi.xfer2(data)\n        return r\n\n    def dev_write(address, value):\n        r = spi_transfer([(address &lt;&lt; 1) &amp; 0x7E, value])\n        print(\"&gt;&gt;\",[(address &lt;&lt; 1) &amp; 0x7E, value], r)\n        return r\n\n    def reset():\n        dev_write(0x01, mode_reset)\n\n    spi = spidev.SpiDev()\n    spi.open(0, 0)\n    spi.max_speed_hz = 1000000\n    print(spi.mode, spi.bits_per_word, spi.lsbfirst)\n    reset()\n</code></pre>\n\n<p>that works perfectly fine - it returns the command code back <code>15</code>, but the same initialization routine implemented in Go doesn't really work:</p>\n\n<pre><code>    package main\n\n    import (\n        \"fmt\"\n        \"golang.org/x/exp/io/spi\"\n        \"log\"\n    )\n\n    func main() {\n\n        spiDev, err := spi.Open(&amp;spi.Devfs{\n            Dev:      \"/dev/spidev0.0\",\n            Mode:     spi.Mode(spi.Mode0),\n            MaxSpeed: int64(1000000),\n        })\n\n        spiDev.SetMode(spi.Mode0)\n        spiDev.SetBitOrder(spi.MSBFirst)\n        spiDev.SetBitsPerWord(8)\n\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        writeSpiData := func(dataIn []byte) (out []byte, err error) {\n            out = make([]byte, len(dataIn))\n            err = spiDev.Tx(dataIn, out)\n            return\n        }\n\n        devWrite := func(address int, data byte) (err error) {\n            newData := [2]byte{(byte(address) &lt;&lt; 1) &amp; 0x7E, data}\n            readBuf, err := writeSpiData(newData[0:])\n            fmt.Println(\"&gt;&gt;\", newData, readBuf)\n            return\n        }\n\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        devWrite(0x01, 0x0F)\n\n        fmt.Println(\"Done\")\n\n    }\n</code></pre>\n\n<p>This one returns <code>[0 0]</code> which is wrong. Does anyone know what might be wrong there?</p>\n"}, {"tags": ["list", "go", "nested-lists"], "comments": [{"owner": {"reputation": 3219, "user_id": 1521049, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/60b5a4c5b9ef83aeb0d83f5d3b4afdd0?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/1521049/thomas"}, "edited": false, "score": 0, "creation_date": 1512928234, "post_id": 46750943, "comment_id": 82443430, "body": "Those who down vote please comment why."}], "answers": [{"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1508033449, "post_id": 46751015, "comment_id": 80447995, "body": "Btw, <code>a := [][]int{{1, 2}, {3}, {5, 6, 7}}</code> &lt;- this syntax also works"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1508033523, "post_id": 46751015, "comment_id": 80448006, "body": "Depends on what version of go you are using. Better safe than sorry."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1508033608, "post_id": 46751015, "comment_id": 80448018, "body": "Hmm. 1.0 certainly wouldn&#39;t, but I don&#39;t remember when that change was added."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1508033643, "post_id": 46751015, "comment_id": 80448027, "body": "Right. I seriously wouldn&#39;t expect somebody to claim the go v1.0 support."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1508033966, "post_id": 46751015, "comment_id": 80448068, "body": "No, wait. I was wrong. Go 1.0 added that for pointer types in slices, 1.5 added support for maps. In any case it has been supported for a long time, I just haven&#39;t bothered to change :P"}, {"owner": {"reputation": 11, "user_id": 3853812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1e5ac411f0fbbb648c4fdbe94e1b46e?s=128&d=identicon&r=PG&f=1", "display_name": "supb", "link": "https://stackoverflow.com/users/3853812/supb"}, "edited": false, "score": 0, "creation_date": 1508191781, "post_id": 46751015, "comment_id": 80505608, "body": "Thanks @Milo. I was looking for the second option, where you use an interface.The function that receives it as an argument does not know the slice size and if it contains another slice inside it. So, the second option is what it will have to use."}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 4, "last_activity_date": 1508032939, "creation_date": 1508032939, "answer_id": 46751015, "question_id": 46750943, "link": "https://stackoverflow.com/questions/46750943/how-to-represent-a-variable-nested-list-in-go/46751015#46751015", "title": "How to represent a variable nested list in Go", "body": "<p>You have two basic choices:</p>\n\n<p>First, you can make a slice of slices:</p>\n\n<pre><code>a := [][]int{\n    []int{1,2},\n    []int{3},\n    []int{5, 6, 7},\n    []int{8},\n    []int{9},\n}\n</code></pre>\n\n<p>This isn't quite what you wanted, but it is close. In this case single items are represented as a slice with one item. Simple.</p>\n\n<p>Second, you can make a slice of <code>interface{}</code> and use type switches to identify and unpack each index:</p>\n\n<pre><code>b := []interface{}{\n    []int{1,2},\n    3,\n    []int{5, 6, 7},\n    8,\n    9,\n}\n</code></pre>\n\n<p>This is much more complicate to work with, but is also much closer to what you want.</p>\n\n<p>Example of reading items from slice <code>b</code>:</p>\n\n<pre><code>// Note that things can get a lot more complicated if you have\n// more types and/or you nest deeper than one level.\nfor _, iv := range b {\n    switch v := iv.(type) {\n    case []int:\n        // v is an int slice\n    case int:\n        // v is an int\n    default:\n        // This will probably be an error case.\n    }\n}\n</code></pre>\n\n<p>I recomend you stick with the first method unless you have a really good reason not to.</p>\n"}], "owner": {"reputation": 11, "user_id": 3853812, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1e5ac411f0fbbb648c4fdbe94e1b46e?s=128&d=identicon&r=PG&f=1", "display_name": "supb", "link": "https://stackoverflow.com/users/3853812/supb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 461, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1508032939, "creation_date": 1508031927, "question_id": 46750943, "link": "https://stackoverflow.com/questions/46750943/how-to-represent-a-variable-nested-list-in-go", "title": "How to represent a variable nested list in Go", "body": "<p>How is a list such as: </p>\n\n<pre><code>{{1,2}, 3, {5, 6, 7}, 8, 9} \n</code></pre>\n\n<p>represented in Go? I need to be able to pass a nested variable size list to a function in Go from the main function. This list will then be processed inside the function by accessing the individual elements/sublists of the list.\nNote that the size of the list and the sizes of sublists are variable.</p>\n"}, {"tags": ["dataframe", "go", "interface", "gota"], "comments": [{"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 1, "creation_date": 1508033380, "post_id": 46750900, "comment_id": 80447984, "body": "It looks like you cannot short of modifying the library directly. Worse, the function called by <code>String</code> is not exported, so you cannot call it yourself. A cursory search for another way to print a <code>DataFrame</code> value did no reveal anything. Maybe file a bug on github?"}, {"owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1508051584, "post_id": 46750900, "comment_id": 80450960, "body": "Nice, any chance you can either write this as an answer I can accept (&quot;It&#39;s not possible&quot;) or better, show me what lines would need to be modified in the source I linked and we can improve the lib as the answer? :)"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1508052039, "post_id": 46750900, "comment_id": 80451075, "body": "Sure. It&#39;ll but up in a few seconds."}], "answers": [{"tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": true, "score": 1, "last_activity_date": 1508170514, "last_edit_date": 1592644375, "creation_date": 1508052910, "answer_id": 46752770, "question_id": 46750900, "link": "https://stackoverflow.com/questions/46750900/modify-a-default-value-in-the-stringer-interface-in-go/46752770#46752770", "title": "Modify a default value in the Stringer interface in go", "body": "<p>Without modifying the library there is nothing you can do.</p>\n<p>If modifying the library is an option you have a few possibilities:</p>\n<ol>\n<li><p>Change the name of the internal formatting function so it is exported and call that. This is a bit more work, since you need to explicitly call a function every time you want to print a <code>DataFrame</code>, but it is a reasonable option if you want to make minimal changes to the way the library works.</p>\n<p>Basically change <code>print</code> to <code>Print</code> on lines 101 and 104 (I think those are the only occurrences of that function; if not the compiler will be happy to point out the others :P)</p>\n</li>\n<li><p>Change the arguments to <code>df.print</code> in the definition of <code>df.String</code>. This is positively trivial, but it has the effect of changing the default behaviour, which may or may not be a good thing.</p>\n<p>For this option just change line 101 to return <code>df.print(true, false, true, true, 10, 70, &quot;DataFrame&quot;)</code> or whatever combination fits your needs.</p>\n</li>\n<li><p>Add a new method for each printing format you want, and explicitly call these new methods. This is more work than #1 or #2, but some people may prefer it.</p>\n</li>\n</ol>\n<p>Personally, I would go with #1, but your question makes #2 sound more like what you want.</p>\n"}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 46752770, "answer_count": 1, "score": 0, "last_activity_date": 1508170514, "creation_date": 1508031284, "question_id": 46750900, "link": "https://stackoverflow.com/questions/46750900/modify-a-default-value-in-the-stringer-interface-in-go", "title": "Modify a default value in the Stringer interface in go", "body": "<p>I'm looking at the print interface in the gota dataframe here:\n<a href=\"https://github.com/kniren/gota/blob/master/dataframe/dataframe.go#L99\" rel=\"nofollow noreferrer\">https://github.com/kniren/gota/blob/master/dataframe/dataframe.go#L99</a></p>\n\n<p>I see the default value is shortCols = true, given <a href=\"https://github.com/kniren/gota/blob/master/dataframe/dataframe.go#L101\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<p>When I call the print data frame, how can I override this value to print with shortCols = false when I println?</p>\n\n<pre><code>fmt.Println(fil)\n</code></pre>\n\n<p>eg, I'd like to print all columns, rather than just the first 5 as the above produces the below:</p>\n\n<pre><code>[31x16] DataFrame\n\n    valA   valB    valC    valD    valE        ...\n 0:  578   8.30     491    7959    1.040000    ...\n 1:  577   8.30     291    7975    2.050000    ...\n 2:  466   16.7     179    6470    3.210000    ...\n 3:  592   9.03     194    8212    4.040000    ...\n</code></pre>\n"}, {"tags": ["google-app-engine", "firebase", "go", "google-cloud-platform"], "comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1508050113, "post_id": 46750546, "comment_id": 80450641, "body": "HI , which lib are  you  using  to interact with firebase? why you are trying to encode the the result to interface and not to struct ?"}, {"owner": {"reputation": 873, "user_id": 4509355, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/31648f80ef66006febaecde7c76b7319?s=128&d=identicon&r=PG&f=1", "display_name": "Nishant Roy", "link": "https://stackoverflow.com/users/4509355/nishant-roy"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1508096243, "post_id": 46750546, "comment_id": 80463735, "body": "I&#39;m using <a href=\"https://github.com/zabawaba99/firego\" rel=\"nofollow noreferrer\">firego</a>. I&#39;ll use a struct eventually, right now we haven&#39;t defined exactly what our data will look like, so I was just unmarshalling to an interface for now."}, {"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1508135503, "post_id": 46750546, "comment_id": 80473498, "body": "Its look like you need to pass pointer of map  var v map[string]interface{} in order to get value <a href=\"https://github.com/zabawaba99/firego#querying\" rel=\"nofollow noreferrer\">github.com/zabawaba99/firego#querying</a>"}], "owner": {"reputation": 873, "user_id": 4509355, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/31648f80ef66006febaecde7c76b7319?s=128&d=identicon&r=PG&f=1", "display_name": "Nishant Roy", "link": "https://stackoverflow.com/users/4509355/nishant-roy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 113, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1508026835, "creation_date": 1508026835, "question_id": 46750546, "link": "https://stackoverflow.com/questions/46750546/firebase-through-golang-on-appengine", "title": "Firebase through Golang on AppEngine", "body": "<p>I have a Firebase database that looks like this:</p>\n\n<pre><code>{\n  \"users\" : [ null, {\n    \"name\" : \"John\",\n    \"recipes\" : {\n      \"34\" : {\n        \"name\" : \"Chicken Parmesan\"\n      }\n    }\n  } ]\n}\n</code></pre>\n\n<p>I'm trying to access the data through a Golang API. When I'm running the API locally, it works. However, when I try to use the API on AppEngine, Firebase returns null.</p>\n\n<p>This is how I'm calling it:</p>\n\n<pre><code>userID := req.URL.Query().Get(\"user_id\")\n\n// Make call to API or to Database here, and then write out results\nvar user interface{}\n\n\nf.Auth(&lt;FIREBASE_SECRET&gt;)\n\n\nif err := f.Child(\"users/\" + userID).Value(&amp;user); err != nil {\n    fmt.Print(w, err)\n}\n\njson.NewEncoder(w).Encode(user)\n</code></pre>\n\n<p>Any ideas on why this may not be working?</p>\n"}, {"tags": ["go", "gota"], "comments": [{"owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "edited": false, "score": 0, "creation_date": 1614656066, "post_id": 46750187, "comment_id": 117445314, "body": "I think you meant to add <code>Capply</code> instsead of  <code>CBind</code>."}], "owner": {"reputation": 15339, "user_id": 1052117, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/e087c44c53d1214db5fb37e4c345f533?s=128&d=identicon&r=PG", "display_name": "Mittenchops", "link": "https://stackoverflow.com/users/1052117/mittenchops"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 451, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1508032264, "creation_date": 1508022433, "last_edit_date": 1508032264, "question_id": 46750187, "link": "https://stackoverflow.com/questions/46750187/gota-sum-values-in-a-dataframe", "title": "Gota sum values in a dataframe", "body": "<p>I'm looking to get a column sum for a dataframe using <a href=\"https://godoc.org/github.com/kniren/gota\" rel=\"nofollow noreferrer\">Gota's cool dataframe in go</a>.</p>\n\n<p>I see from <a href=\"https://github.com/kniren/gota#function-application\" rel=\"nofollow noreferrer\">here</a> that there's a way to apply functions to series which seems fine, that is doing:</p>\n\n<pre><code>mean := func(s series.Series) series.Series {\n    floats := s.Float()\n    sum := 0.0\n    for _, f := range floats {\n        sum += f\n    }\n    return series.Floats(sum / float64(len(floats)))\n}\ndf.Cbind(mean)\ndf.Rbind(mean)\n</code></pre>\n\n<p>eg, just remove the division to get the sum function rather than the mean.  That said, if I'm only looking to sum 1 column, am I stuck writing my own easy sum function, or is there something more idiomatic and built-in like R's</p>\n\n<pre><code>sum(df[,c(\"mycol\")])\n</code></pre>\n\n<p>?</p>\n\n<p>I'm currently working with:</p>\n\n<pre><code>    sum := func(s series.Series) series.Series {\n    floats := s.Float()\n    sum := 0.0\n    for _, f := range floats {\n        sum += f\n    }\n    return series.Floats(sum)\n    }\n\ndf.Select([]string{\"mycol\"})).CBind(sum)\n</code></pre>\n\n<p>where df after I subset to only the column of interest becomes:</p>\n\n<pre><code>[31x1] DataFrame\n\n    mycol\n 0: 8.300000            \n 1: 8.300000            \n 2: 16.750000           \n 3: 9.030000            \n    ...                 \n    &lt;float&gt;             \n</code></pre>\n\n<p>And I get something like:</p>\n\n<pre><code>cannot use sum (type func(series.Series) series.Series) as type dataframe.DataFrame in argument to df.Select([]string literal).CBind\n</code></pre>\n\n<h1>UPDATE</h1>\n\n<p>Ah, partial solution in that the documentation uses Cbind/Rbind where I think Capply/Rapply was meant, as these are documented <a href=\"https://godoc.org/github.com/kniren/gota/dataframe#DataFrame.Rapply\" rel=\"nofollow noreferrer\">here</a>.  That said, the idiom question stands in that it would be great if there are built-ins I'm missing.  </p>\n"}, {"tags": ["go", "concurrency", "deadlock"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1508022251, "post_id": 46750114, "comment_id": 80446294, "body": "Nothing writes to <code>c</code>, so all 3 threads are locked reading from it."}, {"owner": {"reputation": 107, "user_id": 7126440, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10155188738039540/picture?type=large", "display_name": "Kadir Susuz", "link": "https://stackoverflow.com/users/7126440/kadir-susuz"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1508061352, "post_id": 46750114, "comment_id": 80453212, "body": "i&#39;ve just added &quot;c &lt;- 0&quot; before println,it works but when i add that before first go func i got same deadlock error.wth happenings?"}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1508070036, "post_id": 46750114, "comment_id": 80455349, "body": "@KadirSusuz When you add the write operation before spawning the first goroutine, you are trying to write to an unbuffered channel. This operation blocks until the value is read from the channel, but you haven&#39;t started the goroutines to read from it. The solution would be to start the goroutines first or create a buffered channel."}], "answers": [{"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1508022360, "post_id": 46750175, "comment_id": 80446315, "body": "&quot;with 0 being by far the most likely result.&quot; --- that&#39;s what I thought as well, but it&#39;s 2 on play.golang. On a single cpu machine 2 is more likely."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1508026171, "post_id": 46750175, "comment_id": 80446919, "body": "Where exactly you put the first send, and where you sleep would be the main influences on a single core machine, but who runs single core machines nowadays? :P If you sleep right after the first send things become pretty unpredictable on multiple cores."}, {"owner": {"reputation": 107, "user_id": 7126440, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10155188738039540/picture?type=large", "display_name": "Kadir Susuz", "link": "https://stackoverflow.com/users/7126440/kadir-susuz"}, "edited": false, "score": 0, "creation_date": 1508061368, "post_id": 46750175, "comment_id": 80453217, "body": "i&#39;ve just added &quot;c &lt;- 0&quot; before println,it works but when i add that before first go func i got same deadlock error.wth happenings?"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1508086529, "post_id": 46750175, "comment_id": 80460408, "body": "Oh, yeah... That is obvious once I think about it, and I should have thought to mention it in the answer. In that case you have a (blocking) send with no possible reads. You can either make the channel buffered, or make sure at least one of the goroutines has started before the first send."}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 1, "last_activity_date": 1508086673, "last_edit_date": 1508086673, "creation_date": 1508022310, "answer_id": 46750175, "question_id": 46750114, "link": "https://stackoverflow.com/questions/46750114/deadlock-at-beginner-level-code/46750175#46750175", "title": "deadlock at beginner level code", "body": "<p>You are reading from the channel before writing to it, so everything deadlocks waiting for a read that can never happen.</p>\n\n<p>You could break the deadlock by putting <code>c &lt;- 0</code> before your call to <code>Printf</code>, but the program could then print 0, 1, or 2. Note that if you put the initial send before you start the first goroutine  you get the same problem from the other direcion, a send with no possible reads.</p>\n\n<p>If you said what you were trying to do it would be far easier to help, as it is I can't really provide any specific pointers.</p>\n"}, {"comments": [{"owner": {"reputation": 107, "user_id": 7126440, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10155188738039540/picture?type=large", "display_name": "Kadir Susuz", "link": "https://stackoverflow.com/users/7126440/kadir-susuz"}, "edited": false, "score": 0, "creation_date": 1508061357, "post_id": 46752323, "comment_id": 80453215, "body": "i&#39;ve just added &quot;c &lt;- 0&quot; before println,it works but when i add that before first go func i got same deadlock error.wth happenings?"}, {"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "reply_to_user": {"reputation": 107, "user_id": 7126440, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10155188738039540/picture?type=large", "display_name": "Kadir Susuz", "link": "https://stackoverflow.com/users/7126440/kadir-susuz"}, "edited": false, "score": 0, "creation_date": 1508062237, "post_id": 46752323, "comment_id": 80453421, "body": "Quite right - because at that moment there&#39;s no goroutine which can read from the channel. So writing to channel is blocked until someone starts to read from the channel. Try to place writing between starting readers. Another way: you may make you channel buffered - that means it can store several elements inside. The rule is the same: you can write to channel if there&#39;s a room for new elements, if there&#39;s no room writer gets blocked. If there&#39;s a reader, it will read elements and thus free space for new ones. How to create a buffered channel? <code>make(chan int, 10)</code> - here 10 buf len"}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 0, "last_activity_date": 1508062312, "last_edit_date": 1508062312, "creation_date": 1508048814, "answer_id": 46752323, "question_id": 46750114, "link": "https://stackoverflow.com/questions/46750114/deadlock-at-beginner-level-code/46752323#46752323", "title": "deadlock at beginner level code", "body": "<p>Add before the last line:</p>\n\n<pre><code>c &lt;- 0\n</code></pre>\n\n<p>This way you give start value which could be read by goroutines to start working. Also you can add to both goroutines before the last line (sending to channel) add printing goroutine number and value:</p>\n\n<pre><code>fmt.Println(\"goroutine 1 value\", i)\n</code></pre>\n\n<p>This you can see how values are passed in situation of 3 possible consumers of the same item in channel. Most likely the main goroutine will read the channel and you get <code>0</code>. Add <code>Sleep</code> to give others a chance. Play with sleep time toget different results. </p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 7528868, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210726891762748/picture?type=large", "display_name": "Amine Arbi", "link": "https://stackoverflow.com/users/7528868/amine-arbi"}, "is_accepted": false, "score": 0, "last_activity_date": 1508111038, "creation_date": 1508111038, "answer_id": 46761149, "question_id": 46750114, "link": "https://stackoverflow.com/questions/46750114/deadlock-at-beginner-level-code/46761149#46761149", "title": "deadlock at beginner level code", "body": "<p>You Got an Unbuffered channels which means your working \"synch\" i mean when using an unbuffered channel you need a writer and a reader to achieve something try buffered channels as you can try a select to wait for messages.\n2 - you are reading before writing from an unbuffered channel which will block till a write operation happens. so you got 2 readers from a blocked channel ( because there's no writer).</p>\n"}], "owner": {"reputation": 107, "user_id": 7126440, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/10155188738039540/picture?type=large", "display_name": "Kadir Susuz", "link": "https://stackoverflow.com/users/7126440/kadir-susuz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 46752323, "answer_count": 3, "score": 0, "last_activity_date": 1508111038, "creation_date": 1508021736, "question_id": 46750114, "link": "https://stackoverflow.com/questions/46750114/deadlock-at-beginner-level-code", "title": "deadlock at beginner level code", "body": "<p>here is my main function's body;</p>\n\n<pre><code>c := make(chan int)\n\ngo func() {\n\n    i := &lt;-c\n    i++\n    time.Sleep(100 * time.Millisecond)\n\n    c &lt;-i\n\n\n}()\n\ntime.Sleep(1 * time.Second)\ngo func() {\n    i := &lt;-c\n    i++\n    time.Sleep(100 * time.Millisecond)\n    c &lt;-i\n\n}()\n\ntime.Sleep(1 * time.Second)\nfmt.Println(&lt;-c)\n</code></pre>\n\n<p>i am getting deadlock error.even i've tried with waitgroups.hella ripped my hair.</p>\n\n<p>explaining answer would be great for me.</p>\n"}, {"tags": ["go", "synchronization", "web-crawler", "mutex"], "comments": [{"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1508017117, "post_id": 46749498, "comment_id": 80445223, "body": "Could you show the whole file? May be on play.google.com or github? Now it&#39;s not obvious where&#39;re that lines with race panic."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1508019167, "post_id": 46749498, "comment_id": 80445680, "body": "It is <i>probably</i> the use of <code>nestedUrl</code> in the child goroutine <code>Printf</code> call."}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1508028892, "post_id": 46749498, "comment_id": 80447328, "body": "if you don&#39;t share the whole file we cannot know what line is failing"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1508047730, "post_id": 46749498, "comment_id": 80450227, "body": "Do give line nos in future or all code on playground as it makes it much easier."}, {"owner": {"reputation": 87, "user_id": 4895609, "user_type": "registered", "profile_image": "https://graph.facebook.com/1507380262920770/picture?type=large", "display_name": "Aneela Saleem Ramzan", "link": "https://stackoverflow.com/users/4895609/aneela-saleem-ramzan"}, "edited": false, "score": 0, "creation_date": 1508059269, "post_id": 46749498, "comment_id": 80452697, "body": "Hi, Thanks for the response here is the code file <a href=\"https://github.com/aneelaSaleem/Go/blob/master/task2.go\" rel=\"nofollow noreferrer\">github.com/aneelaSaleem/Go/blob/master/task2.go</a>"}, {"owner": {"reputation": 87, "user_id": 4895609, "user_type": "registered", "profile_image": "https://graph.facebook.com/1507380262920770/picture?type=large", "display_name": "Aneela Saleem Ramzan", "link": "https://stackoverflow.com/users/4895609/aneela-saleem-ramzan"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1508059746, "post_id": 46749498, "comment_id": 80452826, "body": "Yes @MiloChristiansen You were right. I changed the nestedUrl in the child goroutine Printf call to url. And it looks fine now. Race detector didn&#39;t detected any race condition now"}], "answers": [{"comments": [{"owner": {"reputation": 87, "user_id": 4895609, "user_type": "registered", "profile_image": "https://graph.facebook.com/1507380262920770/picture?type=large", "display_name": "Aneela Saleem Ramzan", "link": "https://stackoverflow.com/users/4895609/aneela-saleem-ramzan"}, "edited": false, "score": 0, "creation_date": 1508059424, "post_id": 46752216, "comment_id": 80452735, "body": "Thanks for the response Kenny.  &quot;Prefer a synchronous api&quot; What does that mean? I mean i&#39;m already trying to do it synchronously   &quot;Put the visited struct in charge of locking (no public lock)&quot; Can you please show me an example?  &quot;Use a wait group or channels in main to wait for completion&quot; Already using a channel to wait for completion of all go routines"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 87, "user_id": 4895609, "user_type": "registered", "profile_image": "https://graph.facebook.com/1507380262920770/picture?type=large", "display_name": "Aneela Saleem Ramzan", "link": "https://stackoverflow.com/users/4895609/aneela-saleem-ramzan"}, "edited": false, "score": 0, "creation_date": 1508129977, "post_id": 46752216, "comment_id": 80471576, "body": "Even if you intend to use the go keyword, start by writing a non async version. This is a special case, but normally the caller decides whether to call async or not. You can convert sync to async with the go keyword, but never async to sync. Then the callee decides when to lock their data, if you need to lock, don&#39;t use the map outside the function or expose the Lock functions."}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1508130110, "last_edit_date": 1508130110, "creation_date": 1508047678, "answer_id": 46752216, "question_id": 46749498, "link": "https://stackoverflow.com/questions/46749498/golang-web-crawler-solution-2-data-races-exit-status-66/46752216#46752216", "title": "Golang Web Crawler solution, 2 data races, exit status 66", "body": "<p>You\u2019re calling Crawl, which fires off a go routine to recurse, then you\u2019re accessing the protected map visited without a mutex in main which is executed before some crawls finish. A few points on style:</p>\n\n<ul>\n<li>Prefer a synchronous api</li>\n<li>Put the visited struct in charge of locking (no public lock)</li>\n<li>Use a wait group or channels in main to wait for completion</li>\n</ul>\n\n<p>So start synchronous, then figure out how best to change to async. You can then make it a sync just by putting go in front of your synchronous crawl function. Looking at the original tour, it doesn't much resemble this solution, so I'm not sure this is a great model to follow. The caller should not have to lock or worry about races, so you need to redesign. I'd start again from the <a href=\"https://tour.golang.org/concurrency/10\" rel=\"nofollow noreferrer\">original tour exercise</a>.</p>\n\n<p>For the lock, I'd use </p>\n\n<pre><code>type T struct {\ndata map[string]bool\nmu sync.Mutex // not just sync.Mutex\n}\n</code></pre>\n\n<p>and the T decides when locking is required and has functions to adjust the state of data or search it. This makes it simpler to think about using the Lock and less likely you make a mistake.</p>\n"}], "owner": {"reputation": 87, "user_id": 4895609, "user_type": "registered", "profile_image": "https://graph.facebook.com/1507380262920770/picture?type=large", "display_name": "Aneela Saleem Ramzan", "link": "https://stackoverflow.com/users/4895609/aneela-saleem-ramzan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 157, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1508130110, "creation_date": 1508016405, "question_id": 46749498, "link": "https://stackoverflow.com/questions/46749498/golang-web-crawler-solution-2-data-races-exit-status-66", "title": "Golang Web Crawler solution, 2 data races, exit status 66", "body": "<p>I have been following this <a href=\"https://github.com/fgrehm/go-tour/blob/master/73-web-crawler-golang-team-solution.go\" rel=\"nofollow noreferrer\">solution</a>. There is no race condition detected when i run race detecter. But when i run race detecter with my code it gives the following error:</p>\n\n<blockquote>\n  <p>================== WARNING: DATA RACE Read at 0x00c42006c1e0 by goroutine 6:   main.Crawl.func1()\n        /task2.go:50 +0x53</p>\n  \n  <p>Previous write at 0x00c42006c1e0 by main goroutine:   main.Crawl()\n        /task2.go:48 +0x692   main.main()\n        /task2.go:66 +0x8c</p>\n  \n  <p>Goroutine 6 (running) created at:   main.Crawl()\n        /task2.go:49 +0x61e   main.main()\n        /task2.go:66 +0x8c\n  ================== . . .\n  ================== WARNING: DATA RACE Read at 0x00c420094070 by goroutine 8:   main.Crawl.func1()\n        /task2.go:50 +0x53</p>\n  \n  <p>Previous write at 0x00c420094070 by goroutine 6:   main.Crawl()\n        /task2.go:48 +0x692   main.Crawl.func1()\n        /task2.go:51 +0x240</p>\n  \n  <p>Goroutine 8 (running) created at:   main.Crawl()\n        /task2.go:49 +0x61e   main.Crawl.func1()\n        /task2.go:51 +0x240</p>\n  \n  <p>Goroutine 6 (running) created at:   main.Crawl()\n        /task2.go:49 +0x61e   main.main()</p>\n  \n  <h1>     /task2.go:66 +0x8c</h1>\n  \n  <p>Found 2 data race(s) exit status 66</p>\n</blockquote>\n\n<p>Following is my code, can anyone please tell me where i'm going wrong. I have been trying to figure it out for so long but could not identify.</p>\n\n<pre><code>        var visited = struct {\n        urls map[string]bool\n        sync.Mutex\n    }{urls: make(map[string]bool)}\n\n    func Crawl(url string, depth int, fetcher Fetcher) {\n\n        if depth &lt;= 0 {\n            return\n        }\n\n        visited.Lock()\n        if visited.urls[url] &amp;&amp; visited.urls[url] == true {\n            fmt.Println(\"already fetched: \", url)\n\n            visited.Unlock()\n            return\n        }\n        visited.urls[url] = true\n        visited.Unlock()\n\n        body, urls, err := fetcher.Fetch(url)\n\n        if err != nil {\n            fmt.Println(err)\n            return\n        }\n        done := make(chan bool)\n\n        for _, nestedUrl := range urls {\n            go func(url string, d int) {\n                fmt.Printf(\"-&gt; Crawling child %v of %v with depth %v \\n\", nestedUrl, url, depth)\n                Crawl(url, d, fetcher)\n                done &lt;- true\n\n            }(nestedUrl, depth-1)\n        }\n        for i := range urls {\n            fmt.Printf(\"&lt;- [%v] %v/%v Waiting for child %v.\\n\", url, i, len(urls))\n            &lt;-done\n        }\n        fmt.Printf(\"&lt;- Done with %v\\n\", url)\n    }\n\n    func main() {\n        Crawl(\"http://golang.org/\", 4, fetcher)\n\n        fmt.Println(\"Fetching stats\\n--------------\")\n\n        for url, err := range visited.urls {\n            if err != true {\n                fmt.Printf(\"%v failed: %v\\n\", url, err)\n            } else {\n                fmt.Printf(\"%v was fetched\\n\", url)\n            }\n        }\n  }\n</code></pre>\n"}, {"tags": ["go", "yaml", "unmarshalling"], "comments": [{"owner": {"reputation": 50175, "user_id": 1307905, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a38a4f5f180194ac457cdc057f1be6e3?s=128&d=identicon&r=PG", "display_name": "Anthon", "link": "https://stackoverflow.com/users/1307905/anthon"}, "edited": false, "score": 0, "creation_date": 1508049649, "post_id": 46749302, "comment_id": 80450544, "body": "What is &quot;dynamic YAML&quot;? There is no mention of &quot;dynamic&quot; in the <a href=\"http://www.yaml.org/spec/1.2/spec.html\" rel=\"nofollow noreferrer\">YAML specification</a>. What &quot;top level&quot; are you referring to? I would assume the mapping at the root of the data structure that YAML represents, but that mapping has no properties, as it doesn&#39;t have an anchor, nor a tag. Please <b>edit</b> your post to make clear what you refer to."}], "answers": [{"comments": [{"owner": {"reputation": 2701, "user_id": 231582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b82066b95508c6d6a9b2e70c99064db8?s=128&d=identicon&r=PG", "display_name": "tirithen", "link": "https://stackoverflow.com/users/231582/tirithen"}, "edited": false, "score": 0, "creation_date": 1508055423, "post_id": 46750122, "comment_id": 80451831, "body": "Thanks the missing square brackets was the problem it seem. :) Now it parses, I guess I thought the [string] part was enough."}], "tags": [], "owner": {"reputation": 3126, "user_id": 85010, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/5a1b964e34cc2b1d3e233fa387b791b0?s=128&d=identicon&r=PG", "display_name": "fiskeben", "link": "https://stackoverflow.com/users/85010/fiskeben"}, "is_accepted": true, "score": 4, "last_activity_date": 1508021787, "creation_date": 1508021787, "answer_id": 46750122, "question_id": 46749302, "link": "https://stackoverflow.com/questions/46749302/unmarshal-dynamic-yaml-to-map-of-structs/46750122#46750122", "title": "Unmarshal dynamic YAML to map of structs", "body": "<p>The problem is that the contents of your <code>m</code> and <code>l</code> aren't <code>conversionGroup</code>s but lists of <code>conversionGroup</code>s.</p>\n\n<p>Try this:</p>\n\n<pre><code>conversionGroups := make(map[string][]conversionGroup)\n</code></pre>\n\n<p>and it should parse. Note the <code>[]</code> before <code>conversionGroup</code>.</p>\n\n<p>Then the question is whether that's the structure you really want :)</p>\n"}], "owner": {"reputation": 2701, "user_id": 231582, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b82066b95508c6d6a9b2e70c99064db8?s=128&d=identicon&r=PG", "display_name": "tirithen", "link": "https://stackoverflow.com/users/231582/tirithen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2024, "favorite_count": 0, "accepted_answer_id": 46750122, "answer_count": 1, "score": 1, "last_activity_date": 1508055317, "creation_date": 1508014975, "last_edit_date": 1508055317, "question_id": 46749302, "link": "https://stackoverflow.com/questions/46749302/unmarshal-dynamic-yaml-to-map-of-structs", "title": "Unmarshal dynamic YAML to map of structs", "body": "<p>I'm trying to unmarshal the following YAML (using gopkg.in/yaml.v2):</p>\n\n<pre><code>m:\n  - unit: km\n    formula: magnitude / 1000\n    testFixtures:\n      - input: 1000\n        expected: 1\nl:\n  - unit: ml\n    formula: magnitude * 1000\n    testFixtures:\n      - input: 1\n        expected: 1000\n</code></pre>\n\n<p>With the following code:</p>\n\n<pre><code>type ConversionTestFixture struct {\n    Input    float64 `yaml:\"input\"`\n    Expected float64 `yaml:\"expected\"`\n}\n\ntype conversionGroup struct {\n    Unit         string                  `yaml:\"unit\"`\n    Formula      string                  `yaml:\"formula\"`\n    TestFixtures []ConversionTestFixture `yaml:\"testFixtures\"`\n}\nconversionGroups := make(map[string]conversionGroup)\n\nerr = yaml.Unmarshal([]byte(raw), &amp;conversionGroups)\nif err != nil {\n    return\n}\n\nfmt.Println(\"conversionGroups\", conversionGroups)\n</code></pre>\n\n<p>But it gives me the following error:</p>\n\n<pre><code>Error: Received unexpected error:\n\nyaml: unmarshal errors:\n\n  line 1: cannot unmarshal !!map into []map[string]main.conversionGroup\n</code></pre>\n\n<p>The top level properties are dynamic so I need to parse them as string, every other key in the structure will always be the same, hence the structs for those parts. How can I parse this?</p>\n\n<p>(full code are at <a href=\"https://github.com/tirithen/unit-conversion/blob/master/convert.go#L84\" rel=\"nofollow noreferrer\">https://github.com/tirithen/unit-conversion/blob/master/convert.go#L84</a>)</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 2734, "user_id": 2642250, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba7027677ae3831af9f0d0f5bf66f0d5?s=128&d=identicon&r=PG", "display_name": "sheplu", "link": "https://stackoverflow.com/users/2642250/sheplu"}, "is_accepted": false, "score": 1, "last_activity_date": 1508010488, "creation_date": 1508010488, "answer_id": 46748676, "question_id": 46748636, "link": "https://stackoverflow.com/questions/46748636/how-to-create-new-file-using-go-script/46748676#46748676", "title": "How to create new file using go script", "body": "<p>you just need to check the API documentation. This is one way to do it, there is others (with <code>os</code> or <code>bufio</code>)</p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n)\n\nfunc main() {\n    // read the whole file at once\n    b, err := ioutil.ReadFile(\"input.txt\")\n    if err != nil {\n        panic(err)\n    }\n\n    // write the whole body at once\n    err = ioutil.WriteFile(\"output.txt\", b, 0644)\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2620, "user_id": 6489829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a56125658a5592143ade081194b89d6f?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Gore", "link": "https://stackoverflow.com/users/6489829/jack-gore"}, "is_accepted": true, "score": 15, "last_activity_date": 1508013499, "creation_date": 1508013499, "answer_id": 46749116, "question_id": 46748636, "link": "https://stackoverflow.com/questions/46748636/how-to-create-new-file-using-go-script/46749116#46749116", "title": "How to create new file using go script", "body": "<p>If you are trying to print some text to a file one way to do it is like below, however if the file already exists its contents will be lost:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n)\n\nfunc main() {\n    err := ioutil.WriteFile(\"filename.txt\", []byte(\"Hello\"), 0755)\n    if err != nil {\n        fmt.Printf(\"Unable to write file: %v\", err)\n    }\n}\n</code></pre>\n\n<p>The following way will allow you to append to an existing file if it already exists, or creates a new file if it doesn't exist:</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"log\"\n)\n\n\nfunc main() {\n    // If the file doesn't exist, create it, or append to the file\n    f, err := os.OpenFile(\"access.log\", os.O_APPEND|os.O_CREATE|os.O_WRONLY, 0644)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    _, err = f.Write([]byte(\"Hello\"))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    f.Close()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1619232516, "creation_date": 1619232516, "answer_id": 67238885, "question_id": 46748636, "link": "https://stackoverflow.com/questions/46748636/how-to-create-new-file-using-go-script/67238885#67238885", "title": "How to create new file using go script", "body": "<p><code>Fprintln</code> is pretty close to what you were trying to do:</p>\n<pre><code>package main\n\nimport (\n   &quot;fmt&quot;\n   &quot;os&quot;\n)\n\nfunc main() {\n   f, e := os.Create(&quot;filename.txt&quot;)\n   if e != nil {\n      panic(e)\n   }\n   defer f.Close()\n   fmt.Fprintln(f, &quot;Hello&quot;)\n}\n</code></pre>\n<p><a href=\"https://golang.org/pkg/fmt#Fprintln\" rel=\"nofollow noreferrer\">https://golang.org/pkg/fmt#Fprintln</a></p>\n"}], "owner": {"reputation": 2546, "user_id": 1424206, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/2bfb68c5ad4bc21681ebb5c931a99541?s=128&d=identicon&r=PG", "display_name": "yarlg", "link": "https://stackoverflow.com/users/1424206/yarlg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11665, "favorite_count": 0, "accepted_answer_id": 46749116, "answer_count": 3, "score": 7, "last_activity_date": 1619232516, "creation_date": 1508010143, "question_id": 46748636, "link": "https://stackoverflow.com/questions/46748636/how-to-create-new-file-using-go-script", "title": "How to create new file using go script", "body": "<p>I am new to go lang. I am able to create a new file from the terminal using go script. like this</p>\n\n<pre><code>go run ../myscript.go &gt; ../filename.txt\n</code></pre>\n\n<p>but I want to create the file from the script.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"Hello\") &gt; filename.txt\n}\n</code></pre>\n"}, {"tags": ["go", "amazon-dynamodb", "aws-sdk"], "answers": [{"tags": [], "owner": {"reputation": 10420, "user_id": 299462, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/1239668b80debd03fef129775ff3f065?s=128&d=identicon&r=PG", "display_name": "Kannaiyan", "link": "https://stackoverflow.com/users/299462/kannaiyan"}, "is_accepted": false, "score": 2, "last_activity_date": 1508015431, "creation_date": 1508015431, "answer_id": 46749378, "question_id": 46748367, "link": "https://stackoverflow.com/questions/46748367/parsing-dynamodb-getitemoutput-type-in-golang/46749378#46749378", "title": "Parsing dynamodb.GetItemOutput type in Golang", "body": "<p>I would recommend to use ODM (Object Document Mapper) for Go</p>\n\n<p>We have used the following and would recommend it.</p>\n\n<p><a href=\"https://github.com/guregu/dynamo\" rel=\"nofollow noreferrer\">https://github.com/guregu/dynamo</a></p>\n\n<p>You can use with regular json objects and ODM will convert it to dynamodb form and manage mapping automatically.</p>\n\n<pre><code>    db := dynamo.New(session.New(), &amp;aws.Config{Region: aws.String(\"us-west-2\")})\n    table := db.Table(\"Widgets\")\n\n    // put item\n    w := widget{UserID: 613, Time: time.Now(), Msg: \"hello\"}\n    err := table.Put(w).Run() \n\n    // get the same item \n    var result widget\n    err = table.Get(\"UserID\", w.UserID).\n        Range(\"Time\", dynamo.Equal, w.Time).\n        Filter(\"'Count' = ? AND $ = ?\", w.Count, \"Message\", w.Msg). // placeholders in expressions\n        One(&amp;result)\n\n    // get all items\n    var results []widget\n    err = table.Scan().All(&amp;results)\n</code></pre>\n\n<p>In the above example the code just deals only with javascript objects, mapping to dynamodb is automatically taken care.</p>\n\n<p>Hope it helps.</p>\n"}], "owner": {"reputation": 67, "user_id": 3645058, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/399ca028110c350ae81e6649c09e9163?s=128&d=identicon&r=PG&f=1", "display_name": "Rochan Avlur", "link": "https://stackoverflow.com/users/3645058/rochan-avlur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 811, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1508015431, "creation_date": 1508008346, "question_id": 46748367, "link": "https://stackoverflow.com/questions/46748367/parsing-dynamodb-getitemoutput-type-in-golang", "title": "Parsing dynamodb.GetItemOutput type in Golang", "body": "<p>So basically I an kinda new to golang and need to parse the output of dynamodb.GetItemOutput type. Here is a sample:</p>\n\n<pre><code>{\n    Item: {\n      share: {\n        L: [{\n        S: \"Hello\"\n          },{\n        S: \"Brave\"\n          }]\n      },\n      userid: {\n        S: \"43\"\n      },\n      amount: {\n        S: \"1000\"\n      },\n      library: {\n        L: [{\n        S: \"Demons\"\n          },{\n        S: \"HUMBLE\"\n          }]\n      }\n    }\n}\n</code></pre>\n\n<p>Any help would be wonderful.\nThanks a lot.</p>\n"}, {"tags": ["networking", "go"], "answers": [{"tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": true, "score": 0, "last_activity_date": 1508008001, "creation_date": 1508008001, "answer_id": 46748308, "question_id": 46747779, "link": "https://stackoverflow.com/questions/46747779/how-to-get-properties-of-inherited-structs-in-go/46748308#46748308", "title": "How to get properties of inherited structs in Go?", "body": "<p>It is possible to pass the value as an <code>interface{}</code>, then use a type switch to detect which type was passed. Alternatively you can create an interface that exposes the common functionality you need and simply use that.</p>\n\n<p>Interface and type switch:</p>\n\n<pre><code>func Example(v interface{}){\n    switch v2 := v.(type) {\n    case PacketType1:\n        // Do stuff with v1 (which has type PacketType1 here)\n    case PacketType2:\n        // Do stuff with v1 (which has type PacketType2 here)\n    }\n}\n</code></pre>\n\n<p>Common interface:</p>\n\n<pre><code>type Packet interface{\n    GetExample() string\n    // More methods as needed\n}\n\n// Not shown: Implementations of GetValue() for all types used\n// with the following function\n\nfunc Example(v Packet) {\n    // Call interface methods\n}\n</code></pre>\n\n<p>Which method is best for you depends on exactly what you are doing. If most of your types are similar with small differences one or more common interfaces are probably best, if they are quite different then a type switch may be better. Whichever one produces the shortest, clearest code.</p>\n\n<p>Sometimes it is even best to use a mix of the two methods...</p>\n"}], "owner": {"reputation": 805, "user_id": 3618509, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/2ebf555307f721af722397544de00285?s=128&d=identicon&r=PG&f=1", "display_name": "JavaProphet", "link": "https://stackoverflow.com/users/3618509/javaprophet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 46748308, "answer_count": 1, "score": 0, "last_activity_date": 1508008001, "creation_date": 1508004468, "question_id": 46747779, "link": "https://stackoverflow.com/questions/46747779/how-to-get-properties-of-inherited-structs-in-go", "title": "How to get properties of inherited structs in Go?", "body": "<p>In Go,</p>\n\n<pre><code>type PacketType1 struct {\n    myValue string\n}\ntype PacketType2 struct {\n    myValue2 string\n}\n</code></pre>\n\n<p>Can I pass these generically and then check the type somehow? I looked into interfaces, however those seem to be for inheriting functions. Based on the names, this is for a packet system, how could I pass any of these packets to a function as an argument, check the type, and get properties of structs, etc. If this isn't possible, then how would I best implement a packet system in Go?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1508073172, "post_id": 46747265, "comment_id": 80456208, "body": "It\u2019s not just hidden in the source, it\u2019s in the documentation <a href=\"https://golang.org/pkg/regexp/#Regexp\" rel=\"nofollow noreferrer\">golang.org/pkg/regexp/#Regexp</a>"}], "tags": [], "owner": {"reputation": 14788, "user_id": 290339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65572a7a674b480d45f048cdce08e841?s=128&d=identicon&r=PG", "display_name": "akond", "link": "https://stackoverflow.com/users/290339/akond"}, "is_accepted": true, "score": 5, "last_activity_date": 1508001306, "creation_date": 1508001306, "answer_id": 46747265, "question_id": 46746988, "link": "https://stackoverflow.com/questions/46746988/is-regexp-matchstring-thread-safe/46747265#46747265", "title": "Is RegExp.MatchString thread-safe?", "body": "<p>From the source file of <a href=\"https://golang.org/src/regexp/regexp.go\" rel=\"noreferrer\">regexp.go</a></p>\n\n<blockquote>\n  <p>A Regexp is safe for concurrent use by multiple goroutines, \n  except for configuration methods, such as Longest.</p>\n</blockquote>\n\n<p>So, yeah, they are thread-safe.</p>\n"}], "owner": {"reputation": 254, "user_id": 6834400, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/755a8bd56eb19e5474875be5552d01eb?s=128&d=identicon&r=PG&f=1", "display_name": "User2910293", "link": "https://stackoverflow.com/users/6834400/user2910293"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1325, "favorite_count": 0, "accepted_answer_id": 46747265, "answer_count": 1, "score": -1, "last_activity_date": 1508001306, "creation_date": 1507999681, "last_edit_date": 1508000162, "question_id": 46746988, "link": "https://stackoverflow.com/questions/46746988/is-regexp-matchstring-thread-safe", "title": "Is RegExp.MatchString thread-safe?", "body": "<p>Is <a href=\"https://golang.org/pkg/regexp/#Regexp.MatchString\" rel=\"nofollow noreferrer\">https://golang.org/pkg/regexp/#Regexp.MatchString</a> thread-safe if I run <code>regexp.MustCompile(\"\")</code> on it in http-request goutines? I'm not modifying the compile on the instance after the first compile.</p>\n\n<p>I'm just wondering if it's compatible on read-time too or if I should apply some form of mutex locking.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14788, "user_id": 290339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65572a7a674b480d45f048cdce08e841?s=128&d=identicon&r=PG", "display_name": "akond", "link": "https://stackoverflow.com/users/290339/akond"}, "edited": false, "score": 0, "creation_date": 1508002243, "post_id": 46746862, "comment_id": 80440768, "body": "What file system do you use?"}, {"owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "reply_to_user": {"reputation": 14788, "user_id": 290339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65572a7a674b480d45f048cdce08e841?s=128&d=identicon&r=PG", "display_name": "akond", "link": "https://stackoverflow.com/users/290339/akond"}, "edited": false, "score": 0, "creation_date": 1508004737, "post_id": 46746862, "comment_id": 80441642, "body": "Ext4 on Fedora Linux"}], "answers": [{"comments": [{"owner": {"reputation": 677, "user_id": 3453596, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ed989ee9fac33a1cd77d2188e8ae25eb?s=128&d=identicon&r=PG&f=1", "display_name": "Zhigalin - Reinstate CMs", "link": "https://stackoverflow.com/users/3453596/zhigalin-reinstate-cms"}, "edited": false, "score": 0, "creation_date": 1517664469, "post_id": 46747323, "comment_id": 84192257, "body": "The OP uses EXT4 so you&#39;re wrong <a href=\"https://dzone.com/articles/ext4-crtime-creation-time\" rel=\"nofollow noreferrer\">dzone.com/articles/ext4-crtime-creation-time</a>"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "reply_to_user": {"reputation": 677, "user_id": 3453596, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ed989ee9fac33a1cd77d2188e8ae25eb?s=128&d=identicon&r=PG&f=1", "display_name": "Zhigalin - Reinstate CMs", "link": "https://stackoverflow.com/users/3453596/zhigalin-reinstate-cms"}, "edited": false, "score": 2, "creation_date": 1517678222, "post_id": 46747323, "comment_id": 84196403, "body": "True, but note two things: The comment specifying the OP&#39;s file system is newer than this answer, and the <i>Go standard library</i> does not support this, so you would still need to hack something together."}, {"owner": {"reputation": 13866, "user_id": 54200, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6261c8ab215b8069e8290516c80445d8?s=128&d=identicon&r=PG", "display_name": "KevinDTimm", "link": "https://stackoverflow.com/users/54200/kevindtimm"}, "edited": false, "score": 0, "creation_date": 1548175198, "post_id": 46747323, "comment_id": 95445544, "body": "This code no longer compiles (go 1.11) with the error &quot;operator &lt; not defined on time.Time&quot;.  Note that the solution by Alexandr (with .Unix()) will compile"}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1548265423, "post_id": 46747323, "comment_id": 95483345, "body": "Thank you for letting me know, I have updated it. Remember, you can always edit answers yourself!"}], "tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": true, "score": 8, "last_activity_date": 1562975518, "last_edit_date": 1562975518, "creation_date": 1508001737, "answer_id": 46747323, "question_id": 46746862, "link": "https://stackoverflow.com/questions/46746862/list-files-in-a-directory-sorted-by-creation-time/46747323#46747323", "title": "List Files in a Directory Sorted by Creation Time", "body": "<p>On Linux you cannot, and Go has nothing to do with it (creation time is simply not stored in most Linux file systems). On Windows you can, but not with the go standard library. Well, it may be possible with the value returned by <code>(os.FileInfo).Sys()</code>, but you would be better served to look for a library.</p>\n\n<p>Sorting by the <em>last modified</em> time is fairly easy:</p>\n\n<pre><code>files, err := ioutil.ReadDir(path)\n// TODO: handle the error!\nsort.Slice(files, func(i,j int) bool{\n    return files[i].ModTime().Before(files[j].ModTime())\n})\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1390, "user_id": 8951109, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1c6ce25a6621f6b6c3889babd4e8c6a?s=128&d=identicon&r=PG&f=1", "display_name": "Sebastian Hofmann", "link": "https://stackoverflow.com/users/8951109/sebastian-hofmann"}, "edited": false, "score": 2, "creation_date": 1530471350, "post_id": 51125901, "comment_id": 89237159, "body": "While this code may answer the question, providing additional context regarding why and/or how this code answers the question improves its long-term value."}, {"owner": {"reputation": 3290, "user_id": 296559, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/1b20928b0e2fede5489d564878ce7bb8?s=128&d=identicon&r=PG", "display_name": "RoboTamer", "link": "https://stackoverflow.com/users/296559/robotamer"}, "edited": false, "score": 0, "creation_date": 1533508284, "post_id": 51125901, "comment_id": 90358930, "body": "Same as Milo Christiansen just sorts it by unix time"}], "tags": [], "owner": {"reputation": 39, "user_id": 3974769, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a190020f0acd8640373f90600af4bb6d?s=128&d=identicon&r=PG&f=1", "display_name": "Alexandr Vlasov", "link": "https://stackoverflow.com/users/3974769/alexandr-vlasov"}, "is_accepted": false, "score": 3, "last_activity_date": 1530469558, "creation_date": 1530469558, "answer_id": 51125901, "question_id": 46746862, "link": "https://stackoverflow.com/questions/46746862/list-files-in-a-directory-sorted-by-creation-time/51125901#51125901", "title": "List Files in a Directory Sorted by Creation Time", "body": "<pre><code>files, err := ioutil.ReadDir(path)\n//TODO\nsort.Slice(files, func(i,j int) bool{\n    return files[i].ModTime().Unix() &lt; files[j].ModTime().Unix()\n})\n</code></pre>\n"}], "owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5169, "favorite_count": 0, "accepted_answer_id": 46747323, "answer_count": 2, "score": 3, "last_activity_date": 1562975518, "creation_date": 1507998910, "question_id": 46746862, "link": "https://stackoverflow.com/questions/46746862/list-files-in-a-directory-sorted-by-creation-time", "title": "List Files in a Directory Sorted by Creation Time", "body": "<p>I know how to list the files in a directory using <code>ioutil.ReadDir()</code>... but how do I sort them by creation time (from oldest to newest)? I'm using <code>go 8.3</code>.</p>\n"}, {"tags": ["git", "github", "go", "project-structure"], "comments": [{"owner": {"reputation": 381813, "user_id": 1863229, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/4sh1l.png?s=128&g=1", "display_name": "Tim Biegeleisen", "link": "https://stackoverflow.com/users/1863229/tim-biegeleisen"}, "edited": false, "score": 1, "creation_date": 1507997276, "post_id": 46746529, "comment_id": 80439198, "body": "Assuming you can easily build and deploy with this structure, I don&#39;t see any reason not to use a single repo and branch."}, {"owner": {"reputation": 8307, "user_id": 133645, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3rqzq.jpg?s=128&g=1", "display_name": "reto", "link": "https://stackoverflow.com/users/133645/reto"}, "edited": false, "score": 0, "creation_date": 1507997277, "post_id": 46746529, "comment_id": 80439200, "body": "Using a separate repo for the API and the Android client will make your live easier. Think about versioning and releasing. If the API is backed by the DB, I&#39;d put that in the API repo."}], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 2, "last_activity_date": 1507997313, "creation_date": 1507997313, "answer_id": 46746584, "question_id": 46746529, "link": "https://stackoverflow.com/questions/46746529/github-project-structure/46746584#46746584", "title": "Github project structure", "body": "<p>There is no particular layout imposed on Go projects on github, save that it would be nice to make it go gettable by having a main package with some go files at the top level. See the instructions here, but bear in mind it starts by talking about workspaces, not apps if you scroll up. </p>\n\n<p><a href=\"https://golang.org/doc/code.html#Command\" rel=\"nofollow noreferrer\">https://golang.org/doc/code.html#Command</a></p>\n\n<blockquote>\n  <p>To compile and run a simple program, first choose a package path\n  (we'll use github.com/user/hello) and create a corresponding package\n  directory inside your workspace:</p>\n  \n  <p>$ mkdir $GOPATH/src/github.com/user/hello Next, create a file named\n  hello.go inside that directory, containing the following Go code.</p>\n</blockquote>\n\n<p>So that's the only bit I'd change - put at least one go file at the top level, you can then have your other packages below that in whatever structure you wish (it's fine to use a src dir if you wish for most packages). </p>\n\n<p>Use a separate repo for the Android project, because it's unlikely to use the same code (presumably it'll use the API over the network, and will not use mongodb for example directly). </p>\n\n<p>That leaves your api project and mongodb. As the db data and any scripts are likely related to the api server anyway and will evolve with it, I'd put them as a subdirectory of your project as you have shown. </p>\n"}], "owner": {"reputation": 588, "user_id": 6107031, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1d3E0.png?s=128&g=1", "display_name": "Armatorix", "link": "https://stackoverflow.com/users/6107031/armatorix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1157, "favorite_count": 0, "accepted_answer_id": 46746584, "answer_count": 1, "score": 1, "last_activity_date": 1507997580, "creation_date": 1507996947, "last_edit_date": 1507997580, "question_id": 46746529, "link": "https://stackoverflow.com/questions/46746529/github-project-structure", "title": "Github project structure", "body": "<p>I'm just writing some project that is separated into 3 parts: API written in Golang, mongoDB and android client. And as above I thought it would be good to create directives. But when it's not good practice for golang github projects: for structure like this:</p>\n\n<pre><code>MyProject\n\u251c\u2500\u2500 API\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 scripts\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 src\n\u2502\u00a0\u00a0  \u00a0\u00a0 \u2514\u2500\u2500 some_go_file.go\n\u251c\u2500\u2500 DB\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 db_scripts\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 data\n\u2514\u2500\u2500 AndroidDirectory\n</code></pre>\n\n<p>Any idea how this structure should look like? Should I use separate repos or maybe should I leave each component on separate branch ?</p>\n"}, {"tags": ["go", "beego"], "answers": [{"tags": [], "owner": {"reputation": 12623, "user_id": 5985853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/49VtI.jpg?s=128&g=1", "display_name": "Alexey Soshin", "link": "https://stackoverflow.com/users/5985853/alexey-soshin"}, "is_accepted": false, "score": 0, "last_activity_date": 1512846652, "creation_date": 1512846652, "answer_id": 47732147, "question_id": 46746091, "link": "https://stackoverflow.com/questions/46746091/beego-orm-orderby-rand/47732147#47732147", "title": "Beego orm orderby rand()", "body": "<p>BeeGo ORM doesn't support ordering by methods, only by mapped fields:</p>\n\n<p><a href=\"https://github.com/astaxie/beego/blob/master/orm/db_tables.go#L434\" rel=\"nofollow noreferrer\">https://github.com/astaxie/beego/blob/master/orm/db_tables.go#L434</a></p>\n"}], "owner": {"reputation": 166, "user_id": 5648957, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ui9613wl8uQ/AAAAAAAAAAI/AAAAAAAACIw/vmwNXYEkC4g/photo.jpg?sz=128", "display_name": "Rowel de Guzman", "link": "https://stackoverflow.com/users/5648957/rowel-de-guzman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 273, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1512846652, "creation_date": 1507994300, "question_id": 46746091, "link": "https://stackoverflow.com/questions/46746091/beego-orm-orderby-rand", "title": "Beego orm orderby rand()", "body": "<p>I just ran into some problem in beego orm.\nhow to make a query with random order?</p>\n\n<p>something like: </p>\n\n<p><code>orm.NewOrm().QueryTable(\"tbl\").OrderBy(\"rand()\").Limit(1).All(&amp;table)</code></p>\n\n<p>but it gives panic result</p>\n\n<p>I look at the documentation, but can't find that work for random result. any help is much appreciated. </p>\n\n<p>Thank you in advance!</p>\n"}, {"tags": ["go", "blowfish"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1507988466, "post_id": 46745119, "comment_id": 80436355, "body": "Please show us your broken code, not your working code."}, {"owner": {"reputation": 922, "user_id": 2970627, "user_type": "registered", "accept_rate": 35, "profile_image": "https://graph.facebook.com/1443936946/picture?type=large", "display_name": "Alex Bondar", "link": "https://stackoverflow.com/users/2970627/alex-bondar"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1507989115, "post_id": 46745119, "comment_id": 80436556, "body": "here is the broken version"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1507989959, "post_id": 46745119, "comment_id": 80436826, "body": "What is the <i>exact</i> error you get? There&#39;s no reason your <code>src :=</code> line should be failing. See <a href=\"https://play.golang.org/p/N4h7onxGq7\" rel=\"nofollow noreferrer\">playground</a>."}, {"owner": {"reputation": 922, "user_id": 2970627, "user_type": "registered", "accept_rate": 35, "profile_image": "https://graph.facebook.com/1443936946/picture?type=large", "display_name": "Alex Bondar", "link": "https://stackoverflow.com/users/2970627/alex-bondar"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1507990018, "post_id": 46745119, "comment_id": 80436836, "body": "I get index out of range on cipher.Encrypt(enc[0:],src)"}, {"owner": {"reputation": 922, "user_id": 2970627, "user_type": "registered", "accept_rate": 35, "profile_image": "https://graph.facebook.com/1443936946/picture?type=large", "display_name": "Alex Bondar", "link": "https://stackoverflow.com/users/2970627/alex-bondar"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1507990184, "post_id": 46745119, "comment_id": 80436889, "body": "I tried to make enc of size 2048 and 4096, it doesn&#39;t help"}, {"owner": {"reputation": 922, "user_id": 2970627, "user_type": "registered", "accept_rate": 35, "profile_image": "https://graph.facebook.com/1443936946/picture?type=large", "display_name": "Alex Bondar", "link": "https://stackoverflow.com/users/2970627/alex-bondar"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1507990275, "post_id": 46745119, "comment_id": 80436910, "body": "It&#39;s weird that when I replace in src str with the string I input e.g(&quot;my str&quot;+&quot;\\n\\n\\n&quot;) it works"}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1508023852, "post_id": 46745119, "comment_id": 80446555, "body": "It is best not to use Blowfish, even its creator now uses AES."}], "answers": [{"tags": [], "owner": {"reputation": 922, "user_id": 2970627, "user_type": "registered", "accept_rate": 35, "profile_image": "https://graph.facebook.com/1443936946/picture?type=large", "display_name": "Alex Bondar", "link": "https://stackoverflow.com/users/2970627/alex-bondar"}, "is_accepted": false, "score": 0, "last_activity_date": 1507991534, "creation_date": 1507991534, "answer_id": 46745675, "question_id": 46745119, "link": "https://stackoverflow.com/questions/46745119/go-blowfish-weird-stuff/46745675#46745675", "title": "Go Blowfish weird stuff", "body": "<p>Looks like I found what's wrong. cypher.Encrypt accepts byte array of length 8. But the length of byte array []byte(str+\"\\n\\n\\n\") is 4. That's why I get an index out of range. If I have an array []byte(\"My str to encode\"+\"\\n\\n\\n\"). It's len is len of 2 strings. The solution for now is to add more \\n chars to have the length of array str+\"\\n....\\n\" >=than 8</p>\n"}, {"comments": [{"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1508023989, "post_id": 46747195, "comment_id": 80446577, "body": "It is best not to use null padding, it is not compatible with binary data. Instead use {PKCS#7 padding](<a href=\"https://en.wikipedia.org/wiki/Padding_(cryptography)#PKCS7\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Padding_(cryptography)#PKCS7</a>)&zwnj;&#8203;."}, {"owner": {"reputation": 4095, "user_id": 3957200, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/25mzd.jpg?s=128&g=1", "display_name": "Cinder Biscuits", "link": "https://stackoverflow.com/users/3957200/cinder-biscuits"}, "reply_to_user": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 2, "creation_date": 1508027841, "post_id": 46747195, "comment_id": 80447202, "body": "In the context of the question, it&#39;s fine as he is encoding a string, not binary data, and the null character can be stripped off as whitespace."}, {"owner": {"reputation": 4095, "user_id": 3957200, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/25mzd.jpg?s=128&g=1", "display_name": "Cinder Biscuits", "link": "https://stackoverflow.com/users/3957200/cinder-biscuits"}, "reply_to_user": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 1, "creation_date": 1508034982, "post_id": 46747195, "comment_id": 80448212, "body": "Downvoting because I disagree that strings need PKCS7 padding, especially in the context of example code which should be kept simple, just makes you look petty. :|"}, {"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1508067585, "post_id": 46747195, "comment_id": 80454747, "body": "Null padding presents interoperability problems because most encryption implementations do not support null padding. This has been a major issue with PHP mcrypt interoperability. PKCS#7 implementation cn be as simple: <code>pt = append(pt, padlen)</code>. Using PKCS#7 padding can help avoid future interoperability. Further one should consider future readers, who will not have the same context as this question."}], "tags": [], "owner": {"reputation": 4095, "user_id": 3957200, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/25mzd.jpg?s=128&g=1", "display_name": "Cinder Biscuits", "link": "https://stackoverflow.com/users/3957200/cinder-biscuits"}, "is_accepted": false, "score": 3, "last_activity_date": 1508000948, "creation_date": 1508000948, "answer_id": 46747195, "question_id": 46745119, "link": "https://stackoverflow.com/questions/46745119/go-blowfish-weird-stuff/46747195#46747195", "title": "Go Blowfish weird stuff", "body": "<p>While this may result in an error using Go Blowfish, it is correct. <a href=\"https://www.schneier.com/academic/blowfish/\" rel=\"nofollow noreferrer\">Blowfish</a> is a 64-bit (read 8-byte) block cipher. As you've discovered, not only does your string have to be 8 bytes with padding, but any data you wish to encrypt must be padded so that all blocks are equal to eight bytes.</p>\n\n<p>To do so, you should be checking the modulus of your data, and padding the remainder so that the length of the data is a multiple of 8, like so.</p>\n\n<pre><code>func blowfishChecksizeAndPad(pt []byte) []byte {\n    // calculate modulus of plaintext to blowfish's cipher block size\n    // if result is not 0, then we need to pad\n    modulus := len(pt) % blowfish.BlockSize\n    if modulus != 0 {\n        // how many bytes do we need to pad to make pt to be a multiple of \n        //blowfish's block size?\n        padlen := blowfish.BlockSize - modulus\n        // let's add the required padding\n        for i := 0; i &lt; padlen; i++ {\n            // add the pad, one at a time\n            pt = append(pt, 0)\n        }\n    }\n    // return the whole-multiple-of-blowfish.BlockSize-sized plaintext\n    // to the calling function\n    return pt\n}\n</code></pre>\n"}], "owner": {"reputation": 922, "user_id": 2970627, "user_type": "registered", "accept_rate": 35, "profile_image": "https://graph.facebook.com/1443936946/picture?type=large", "display_name": "Alex Bondar", "link": "https://stackoverflow.com/users/2970627/alex-bondar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 461, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1508000948, "creation_date": 1507987788, "last_edit_date": 1507990052, "question_id": 46745119, "link": "https://stackoverflow.com/questions/46745119/go-blowfish-weird-stuff", "title": "Go Blowfish weird stuff", "body": "<p>I have the following function which encodes the string using Blowfish.If I put just a string to byte array it works. The problem is with line\n    cipher.Encrypt(enc[0:],src) </p>\n\n<pre><code>func BlowFish(str string){\n    key := []byte(\"super secret key\")\n\n    cipher,err := blowfish.NewCipher(key)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n\n    //very weird that I get index out of range if I insert a var\n    src :=[]byte(str+\"\\n\\n\\n\")\n\n    var enc [512]byte\n    cipher.Encrypt(enc[0:],src)\n\n    fmt.Println(\"Encoded\",enc)\n\n    var decrypt[8] byte\n    cipher.Decrypt(decrypt[0:],enc[0:])\n\n    result:=bytes.NewBuffer(nil)\n    result.Write(decrypt[0:8])\n\n    fmt.Println(string(result.Bytes()))\n}\n</code></pre>\n\n<p>I don't understand the problem</p>\n"}, {"tags": ["for-loop", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1507990470, "post_id": 46745043, "comment_id": 80436979, "body": "The answer to &quot;which is better for performance&quot; is <i>always</i>: Run a benchmark and see. Results often vary between applications, runtime versions, and in some cases the OS or hardware you&#39;re using."}], "answers": [{"comments": [{"owner": {"reputation": 1190, "user_id": 830979, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3ffeR.jpg?s=128&g=1", "display_name": "Alexander I.Grafov", "link": "https://stackoverflow.com/users/830979/alexander-i-grafov"}, "edited": false, "score": 0, "creation_date": 1611733411, "post_id": 46745090, "comment_id": 116542372, "body": "It is not so obvious. The second case checks the array boundaries each time. It takes some time too. The first case do it only once."}], "tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": true, "score": 3, "last_activity_date": 1507987656, "creation_date": 1507987656, "answer_id": 46745090, "question_id": 46745043, "link": "https://stackoverflow.com/questions/46745043/performance-of-for-range-in-go/46745090#46745090", "title": "performance of for range in go", "body": "<p>the second one is faster but the difference is too low which you can ignore</p>\n\n<p>the main difference is when you have a big size loop. in that case first loop takes more memory than the second one</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 15318674, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-3GhX1q2W3Bg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf-zmvxTVVP-no5fnqV6e0_zc0QVw/mo/photo.jpg?sz=128", "display_name": "Christopher", "link": "https://stackoverflow.com/users/15318674/christopher"}, "is_accepted": false, "score": 2, "last_activity_date": 1614734936, "creation_date": 1614734936, "answer_id": 66449450, "question_id": 46745043, "link": "https://stackoverflow.com/questions/46745043/performance-of-for-range-in-go/66449450#66449450", "title": "performance of for range in go", "body": "<p>We can test this using Go's benchmarking tool (read more at <a href=\"https://dave.cheney.net/2013/06/30/how-to-write-benchmarks-in-go\" rel=\"nofollow noreferrer\">https://dave.cheney.net/2013/06/30/how-to-write-benchmarks-in-go</a>).</p>\n<p>sum_test.go</p>\n<pre><code>package sum\n\nimport &quot;testing&quot;\n\nfunc BenchmarkSumIterator(b *testing.B) {\n    var ints = [5]int{1, 2, 3, 4, 5}\n\n    sum := 0\n    for i := 0; i &lt; b.N; i++ {\n        for j := range ints {\n            sum += ints[j]\n        }\n    }\n}\n\nfunc BenchmarkSumRange(b *testing.B) {\n    var ints = [5]int{1, 2, 3, 4, 5}\n\n    sum := 0\n    for i := 0; i &lt; b.N; i++ {\n        for _, value := range ints {\n            sum += value\n        }\n    }\n\n}\n</code></pre>\n<p>Run it with:</p>\n<pre><code>$ go test -bench=. sum_test.go \ngoos: linux\ngoarch: amd64\nBenchmarkSumIterator-4      412796047            2.97 ns/op\nBenchmarkSumRange-4         413581974            2.89 ns/op\nPASS\nok      command-line-arguments  3.010s\n</code></pre>\n<p>Range appears be to slightly more efficient. Running this benchmark a few more times also confirms this.  It's worth noting that this may only be true for this specific case where you have a small fixed size array.  You should try to make decisions like these based on what you'd encounter in production and also try to reconcile that with code readability.</p>\n"}], "owner": {"reputation": 73, "user_id": 4147855, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uFJUS.jpg?s=128&g=1", "display_name": "wjz2047", "link": "https://stackoverflow.com/users/4147855/wjz2047"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3029, "favorite_count": 2, "accepted_answer_id": 46745090, "answer_count": 2, "score": 2, "last_activity_date": 1614734936, "creation_date": 1507987301, "last_edit_date": 1520592214, "question_id": 46745043, "link": "https://stackoverflow.com/questions/46745043/performance-of-for-range-in-go", "title": "performance of for range in go", "body": "<p>When ranging over an array, two values are returned for each iteration. The first is the index, and the second is a <strong>copy</strong> of the element at that index.</p>\n\n<p>Here's my code:</p>\n\n<pre><code>var myArray = [5]int {1,2,3,4,5}\nsum := 0\n// first with copy\nfor _, value := range myArray {\n    sum += value\n}\n// second without copy\nfor i := range myArray {\n    sum += myArray[i]\n}\n</code></pre>\n\n<p>Which one should i use for better performance?</p>\n\n<p>Is there any difference for built-in types in these two pieces of code?</p>\n"}]