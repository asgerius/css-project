[{"tags": ["go", "docker"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478121464, "post_id": 40389137, "comment_id": 68031634, "body": "From the io.MultiReader docs: <code>MultiReader returns a Reader that&#39;s the logical concatenation of the provided input readers. They&#39;re read sequentially.</code>. You&#39;re trying to read each log to EOF before moving on to the next."}], "answers": [{"comments": [{"owner": {"reputation": 96, "user_id": 5540148, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9be2f92db057ffdbdc26ef5dc97dbcae?s=128&d=identicon&r=PG", "display_name": "drlogout", "link": "https://stackoverflow.com/users/5540148/drlogout"}, "edited": false, "score": 0, "creation_date": 1478167558, "post_id": 40392962, "comment_id": 68047345, "body": "Thank you for your detailed answer!"}], "tags": [], "owner": {"reputation": 136, "user_id": 7102681, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b6cc241c531ff5ad849b2f718ba7513?s=128&d=identicon&r=PG&f=1", "display_name": "Kale B", "link": "https://stackoverflow.com/users/7102681/kale-b"}, "is_accepted": true, "score": 1, "last_activity_date": 1478141691, "last_edit_date": 1478141691, "creation_date": 1478140560, "answer_id": 40392962, "question_id": 40389137, "link": "https://stackoverflow.com/questions/40389137/multiple-docker-container-logs/40392962#40392962", "title": "Multiple docker container logs", "body": "<p>As JimB commented, that method won't work due to the operation of <code>io.MultiReader</code>. What you need to do is read from each from each response individually and combine the output. Since you're dealing with logs, it would make sense to break up the reads on newlines. <code>bufio.Scanner</code> does this for a single <code>io.Reader</code>. So one option would be to create a new type that scans multiple readers concurrently.</p>\n\n<p>You could use it like this:</p>\n\n<pre><code>scanner := NewConcurrentScanner(readers...)\nfor scanner.Scan() {\n    fmt.Println(scanner.Text())\n}\nif err := scanner.Err(); err != nil {\n    log.Fatalln(err)\n}\n</code></pre>\n\n<p>Example implementation of a concurrent scanner:</p>\n\n<pre><code>// ConcurrentScanner works like io.Scanner, but with multiple io.Readers\ntype ConcurrentScanner struct {\n    scans  chan []byte   // Scanned data from readers\n    errors chan error    // Errors from readers\n    done   chan struct{} // Signal that all readers have completed\n    cancel func()        // Cancel all readers (stop on first error)\n\n    data []byte // Last scanned value\n    err  error\n}\n\n// NewConcurrentScanner starts scanning each reader in a separate goroutine\n// and returns a *ConcurrentScanner.\nfunc NewConcurrentScanner(readers ...io.Reader) *ConcurrentScanner {\n    ctx, cancel := context.WithCancel(context.Background())\n    s := &amp;ConcurrentScanner{\n        scans:  make(chan []byte),\n        errors: make(chan error),\n        done:   make(chan struct{}),\n        cancel: cancel,\n    }\n\n    var wg sync.WaitGroup\n    wg.Add(len(readers))\n\n    for _, reader := range readers {\n        // Start a scanner for each reader in it's own goroutine.\n        go func(reader io.Reader) {\n            defer wg.Done()\n            scanner := bufio.NewScanner(reader)\n\n            for scanner.Scan() {\n                select {\n                case s.scans &lt;- scanner.Bytes():\n                    // While there is data, send it to s.scans,\n                    // this will block until Scan() is called.\n                case &lt;-ctx.Done():\n                    // This fires when context is cancelled,\n                    // indicating that we should exit now.\n                    return\n                }\n            }\n            if err := scanner.Err(); err != nil {\n                select {\n                case s.errors &lt;- err:\n                    // Reprort we got an error\n                case &lt;-ctx.Done():\n                    // Exit now if context was cancelled, otherwise sending\n                    // the error and this goroutine will never exit.\n                    return\n                }\n            }\n        }(reader)\n    }\n\n    go func() {\n        // Signal that all scanners have completed\n        wg.Wait()\n        close(s.done)\n    }()\n\n    return s\n}\n\nfunc (s *ConcurrentScanner) Scan() bool {\n    select {\n    case s.data = &lt;-s.scans:\n        // Got data from a scanner\n        return true\n    case &lt;-s.done:\n        // All scanners are done, nothing to do.\n    case s.err = &lt;-s.errors:\n        // One of the scanners error'd, were done.\n    }\n    s.cancel() // Cancel context regardless of how we exited.\n    return false\n}\n\nfunc (s *ConcurrentScanner) Bytes() []byte {\n    return s.data\n}\n\nfunc (s *ConcurrentScanner) Text() string {\n    return string(s.data)\n}\n\nfunc (s *ConcurrentScanner) Err() error {\n    return s.err\n}\n</code></pre>\n\n<p>Here's an example of it working in the Go Playground: <a href=\"https://play.golang.org/p/EUB0K2V7iT\" rel=\"nofollow noreferrer\">https://play.golang.org/p/EUB0K2V7iT</a></p>\n\n<p>You can see that the concurrent scanner output is interleaved. Rather than reading all of one reader, then moving on to the next, as is seen with <code>io.MultiReader</code>.</p>\n"}], "owner": {"reputation": 96, "user_id": 5540148, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9be2f92db057ffdbdc26ef5dc97dbcae?s=128&d=identicon&r=PG", "display_name": "drlogout", "link": "https://stackoverflow.com/users/5540148/drlogout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 798, "favorite_count": 1, "accepted_answer_id": 40392962, "answer_count": 1, "score": 2, "last_activity_date": 1478141691, "creation_date": 1478118277, "question_id": 40389137, "link": "https://stackoverflow.com/questions/40389137/multiple-docker-container-logs", "title": "Multiple docker container logs", "body": "<p>I'm trying to get the logs from multiple docker containers at once (order doesn't matter). This works as expected if <code>types.ContainerLogsOption.Follow</code> is set to false. </p>\n\n<p>If <code>types.ContainerLogsOption.Follow</code> is set to true sometimes the log output get stuck after a few logs and no follow up logs are printed to stdout. </p>\n\n<p>If the output doesn't get stuck it works as expected.</p>\n\n<p>Additionally if I restart one or all of the containers the command doesn't exit like <code>docker logs -f containerName</code> does.</p>\n\n<pre><code>func (w *Whatever) Logs(options LogOptions) {\n    readers := []io.Reader{}\n\n    for _, container := range options.Containers {\n        responseBody, err := w.Docker.Client.ContainerLogs(context.Background(), container, types.ContainerLogsOptions{\n            ShowStdout: true,\n            ShowStderr: true,\n            Follow:     options.Follow,\n        })\n        defer responseBody.Close()\n\n        if err != nil {\n            log.Fatal(err)\n        }\n        readers = append(readers, responseBody)\n    }\n\n    // concatenate all readers to one\n    multiReader := io.MultiReader(readers...)\n\n    _, err := stdcopy.StdCopy(os.Stdout, os.Stderr, multiReader)\n    if err != nil &amp;&amp; err != io.EOF {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>Basically there is no great difference in my implementation from that of <code>docker logs</code> <a href=\"https://github.com/docker/docker/blob/master/cli/command/container/logs.go\" rel=\"nofollow noreferrer\">https://github.com/docker/docker/blob/master/cli/command/container/logs.go</a>, hence I'm wondering what causes this issues.</p>\n"}, {"tags": ["linux", "go", "https", "rate-limiting", "trafficshaping"], "comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1478119157, "post_id": 40388872, "comment_id": 68030417, "body": "Maybe look into <a href=\"https://linux.die.net/man/1/ionice\" rel=\"nofollow noreferrer\">ionice</a>"}, {"owner": {"reputation": 503, "user_id": 7106084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2f169a8f4cb706ce899562e82a817b6?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Waldon", "link": "https://stackoverflow.com/users/7106084/christopher-waldon"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1478121238, "post_id": 40388872, "comment_id": 68031517, "body": "ionice would work if the machine that I&#39;m running on were the only machine on the network. As it is, I don&#39;t want to flood the network with traffic. I know that there are network balancing solutions that could handle that end, but those aren&#39;t an option for me. I need to constrain my usage, rather than my io priority. That being said, ionice would be a great fit under different constraints."}, {"owner": {"reputation": 1870, "user_id": 326722, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/man2G.jpg?s=128&g=1", "display_name": "danmux", "link": "https://stackoverflow.com/users/326722/danmux"}, "edited": false, "score": 0, "creation_date": 1478136382, "post_id": 40388872, "comment_id": 68036263, "body": "perhaps try <code>import &quot;C&quot;</code> to trigger dynamic linking? This <a href=\"http://blog.hashbangbash.com/2014/04/linking-golang-statically/\" rel=\"nofollow noreferrer\">blog.hashbangbash.com/2014/04/linking-golang-statically</a> shows an example and how libc is then linked in - perhaps trickle would work then."}, {"owner": {"reputation": 503, "user_id": 7106084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2f169a8f4cb706ce899562e82a817b6?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Waldon", "link": "https://stackoverflow.com/users/7106084/christopher-waldon"}, "reply_to_user": {"reputation": 1870, "user_id": 326722, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/man2G.jpg?s=128&g=1", "display_name": "danmux", "link": "https://stackoverflow.com/users/326722/danmux"}, "edited": false, "score": 0, "creation_date": 1478138919, "post_id": 40388872, "comment_id": 68036874, "body": "@danmux It&#39;d be nice if that worked, but <a href=\"http://stackoverflow.com/a/40387514/7106084\">this answer</a> explains why it doesn&#39;t. Thanks for the suggestion though."}, {"owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "edited": false, "score": 0, "creation_date": 1478156688, "post_id": 40388872, "comment_id": 68041709, "body": "What about reverse proxy?"}, {"owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "edited": false, "score": 1, "creation_date": 1478171267, "post_id": 40388872, "comment_id": 68049795, "body": "Check out this answer: <a href=\"http://stackoverflow.com/questions/27187617/how-would-i-limit-upload-and-download-speed-from-the-server-in-golang\" title=\"how would i limit upload and download speed from the server in golang\">stackoverflow.com/questions/27187617/&hellip;</a>"}, {"owner": {"reputation": 503, "user_id": 7106084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2f169a8f4cb706ce899562e82a817b6?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Waldon", "link": "https://stackoverflow.com/users/7106084/christopher-waldon"}, "reply_to_user": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "edited": false, "score": 0, "creation_date": 1478174389, "post_id": 40388872, "comment_id": 68051736, "body": "@Tinwor Reverse proxy is possible, but my application isn&#39;t a webserver. It&#39;s a CLI utility. I&#39;d need to remap every domain that my util needs to talk to through the proxy (or that&#39;s how I think it would work). That feels like a fragile solution, and it also requires a lot of system configuration. That being said, I&#39;ll probably try it later today. Thanks!"}, {"owner": {"reputation": 503, "user_id": 7106084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2f169a8f4cb706ce899562e82a817b6?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Waldon", "link": "https://stackoverflow.com/users/7106084/christopher-waldon"}, "reply_to_user": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "edited": false, "score": 1, "creation_date": 1478180971, "post_id": 40388872, "comment_id": 68056479, "body": "@Nebril I used the flowrate package to achieve the same thing, but it didn&#39;t help because I&#39;m too abstracted from the upload. I&#39;m using the <code>github.com&#47;ncw&#47;swift</code> library for the upload, which isn&#39;t exposing the actual HTTP requests. It gives me an <code>io.WriteCloser</code> that I can write the data into, but I think it waits for me to call <code>Close()</code> for it to perform the upload. Since it waits, rate-limiting writing into that interface doesn&#39;t help, which is why I&#39;m looking for a solution external to my code."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478192258, "post_id": 40388872, "comment_id": 68064593, "body": "@ChristopherWaldon: the swift <a href=\"https://godoc.org/github.com/ncw/swift#Connection\" rel=\"nofollow noreferrer\"><code>Connection</code></a> uses and http.RoundTripper as the Transport, which means that you have full access to wrap the underlying network connection as needed."}], "answers": [{"comments": [{"owner": {"reputation": 503, "user_id": 7106084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2f169a8f4cb706ce899562e82a817b6?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Waldon", "link": "https://stackoverflow.com/users/7106084/christopher-waldon"}, "edited": false, "score": 2, "creation_date": 1478199643, "post_id": 40405914, "comment_id": 68068697, "body": "I&#39;ve tried trickle and it isn&#39;t compatible with golang executables. See <a href=\"http://stackoverflow.com/a/40387514/7106084\">this answer</a> for details. Thanks for the suggestion though."}, {"owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "reply_to_user": {"reputation": 503, "user_id": 7106084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2f169a8f4cb706ce899562e82a817b6?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Waldon", "link": "https://stackoverflow.com/users/7106084/christopher-waldon"}, "edited": false, "score": 0, "creation_date": 1478200721, "post_id": 40405914, "comment_id": 68069241, "body": "Sorry to hear that! I would probably try to create an iptables rule to tag packets sent by your process and then use tc to shape traffic tagged by this rule, but I am unable to provide you with an exact solution at this time."}], "tags": [], "owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "is_accepted": false, "score": 1, "last_activity_date": 1478188169, "creation_date": 1478188169, "answer_id": 40405914, "question_id": 40388872, "link": "https://stackoverflow.com/questions/40388872/how-can-i-externally-rate-limit-a-golang-http-upload/40405914#40405914", "title": "How can I externally rate-limit a golang http upload?", "body": "<p>If you can control how you actually run the utility, you can use trickle</p>\n\n<pre><code>sudo apt-get install trickle #since you're on Ubuntu\ntrickle -u (upload limit in KB/s) -d (download limit in KB/s) executable\n</code></pre>\n\n<p>Here is some additional documentation about it <a href=\"https://wiki.archlinux.org/index.php/Trickle\" rel=\"nofollow noreferrer\">https://wiki.archlinux.org/index.php/Trickle</a></p>\n"}, {"tags": [], "owner": {"reputation": 503, "user_id": 7106084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2f169a8f4cb706ce899562e82a817b6?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Waldon", "link": "https://stackoverflow.com/users/7106084/christopher-waldon"}, "is_accepted": true, "score": 2, "last_activity_date": 1478283106, "last_edit_date": 1495535272, "creation_date": 1478283106, "answer_id": 40429295, "question_id": 40388872, "link": "https://stackoverflow.com/questions/40388872/how-can-i-externally-rate-limit-a-golang-http-upload/40429295#40429295", "title": "How can I externally rate-limit a golang http upload?", "body": "<p>It turns out that you can wrap the Golang process in a Docker container and then rate-limit the Docker container's network interface (from inside of the container) with the <code>tc</code> utility. See <a href=\"https://stackoverflow.com/a/40429099/7106084\">this answer</a> for an example Dockerfile to do just that.</p>\n"}], "owner": {"reputation": 503, "user_id": 7106084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2f169a8f4cb706ce899562e82a817b6?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Waldon", "link": "https://stackoverflow.com/users/7106084/christopher-waldon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 770, "favorite_count": 1, "accepted_answer_id": 40429295, "answer_count": 2, "score": 4, "last_activity_date": 1478283106, "creation_date": 1478117330, "last_edit_date": 1495541800, "question_id": 40388872, "link": "https://stackoverflow.com/questions/40388872/how-can-i-externally-rate-limit-a-golang-http-upload", "title": "How can I externally rate-limit a golang http upload?", "body": "<p>I have a golang utility that uploads a lot of data via https to OpenStack Object Storage. I'm running it on Ubuntu Linux, and I would like to ensure that its maximum upload bandwidth does not exceed 2,500KB/s, preferably without affecting other users on the same system (i.e. slowing down the ethernet interface). </p>\n\n<p>How can I do this, preferably without altering my source code? I've tried a few approaches so far:</p>\n\n<ol>\n<li><strong>Traffic Shaping:</strong> I've been unable to figure out the appropriate network shaping techniques to affect a single process, though I know that should be possible with <code>iptables</code> and <code>tc</code>. Any guidance on how to do this would be appreciated. My networking background isn't very extensive.</li>\n<li><strong>Flowrate Limiting:</strong> I tried using the <a href=\"https://github.com/mxk/go-flowrate\" rel=\"nofollow noreferrer\"><code>flowrate</code></a> package in go to rate-limit my writes to the upload. This didn't have any discernable effect. I think this doesn't work because the <a href=\"https://godoc.org/github.com/ncw/swift#ObjectCreateFile\" rel=\"nofollow noreferrer\"><code>github.com/ncw/swift.ObjectCreateFile.Write()</code></a> method doesn't upload the data as it is recieved, but rather when it is closed. I could be mistaken about this though.</li>\n<li><strong>trickle:</strong> I tried the <code>trickle</code> command, but it isn't compatible with golang executables (see <a href=\"https://stackoverflow.com/questions/40386936/why-doesnt-the-trickle-utility-affect-my-dynamically-linked-golang-program\">this question</a>)</li>\n</ol>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1478115275, "post_id": 40388246, "comment_id": 68028283, "body": "Was <code>err</code> nil? Gotta start by checking if <code>err == nil</code> and if false, what the contents of <code>err</code> are."}, {"owner": {"reputation": 1536, "user_id": 1793374, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qK8kV.png?s=128&g=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/1793374/mike"}, "edited": false, "score": 0, "creation_date": 1478115364, "post_id": 40388246, "comment_id": 68028348, "body": "err is parsing time &quot;2016-11-02 19:35:35.173585795 +0000 UTC&quot;: month out of range"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1478115695, "post_id": 40388246, "comment_id": 68028538, "body": "See: <a href=\"https://stackoverflow.com/questions/16536216/time-parse-behaviour\" title=\"time parse behaviour\">stackoverflow.com/questions/16536216/time-parse-behaviour</a>, and <a href=\"https://stackoverflow.com/questions/31070301/time-parse-with-custom-layout\" title=\"time parse with custom layout\">stackoverflow.com/questions/31070301/&hellip;</a>, and <a href=\"https://stackoverflow.com/questions/18927725/strange-behavior-in-time-parse-function-in-go\" title=\"strange behavior in time parse function in go\">stackoverflow.com/questions/18927725/&hellip;</a>, and <a href=\"https://stackoverflow.com/questions/25845172/parsing-date-string-in-golang/25845327\" title=\"parsing date string in golang\">stackoverflow.com/questions/25845172/&hellip;</a>, etc..."}, {"owner": {"reputation": 1536, "user_id": 1793374, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qK8kV.png?s=128&g=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/1793374/mike"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478116018, "post_id": 40388246, "comment_id": 68028712, "body": "I&#39;ve read those @JimB ... evans explanation below helped a lot to clarify how the layout string is constructed"}], "answers": [{"comments": [{"owner": {"reputation": 1536, "user_id": 1793374, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qK8kV.png?s=128&g=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/1793374/mike"}, "edited": false, "score": 0, "creation_date": 1478115523, "post_id": 40388350, "comment_id": 68028437, "body": "This is what I was trying to understand regarding the format string. Let me give this a try and I will come back shortly"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 1536, "user_id": 1793374, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qK8kV.png?s=128&g=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/1793374/mike"}, "edited": false, "score": 0, "creation_date": 1478115602, "post_id": 40388350, "comment_id": 68028485, "body": "@Mike sounds good. That aspect of the time package is a little weird thought it&#39;s pretty easy to work with once you get used to it. I believe your offset would be <code>-7</code> btw."}, {"owner": {"reputation": 1536, "user_id": 1793374, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qK8kV.png?s=128&g=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/1793374/mike"}, "edited": false, "score": 0, "creation_date": 1478115789, "post_id": 40388350, "comment_id": 68028588, "body": "I&#39;m still getting an error, I&#39;ve uploaded the code here: <a href=\"https://play.golang.org/p/SPIMTX2jL4\" rel=\"nofollow noreferrer\">play.golang.org/p/SPIMTX2jL4</a>"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 1536, "user_id": 1793374, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qK8kV.png?s=128&g=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/1793374/mike"}, "edited": false, "score": 0, "creation_date": 1478115971, "post_id": 40388350, "comment_id": 68028685, "body": "@Mike that&#39;s because your <code>layout</code> argument still had the 2016 date when it&#39;s supposed to be based on that epoch of Jan 2nd 2006. Here&#39;s a modified example that works; <a href=\"https://play.golang.org/p/QRrel6YSkC\" rel=\"nofollow noreferrer\">play.golang.org/p/QRrel6YSkC</a>"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 1536, "user_id": 1793374, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qK8kV.png?s=128&g=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/1793374/mike"}, "edited": false, "score": 2, "creation_date": 1478116035, "post_id": 40388350, "comment_id": 68028724, "body": "@Mike for that, your goal is to look at the format of your input time, then take that epoch (1/2/2006), and represent it in the format your input time is in."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 2, "last_activity_date": 1478115979, "last_edit_date": 1478115979, "creation_date": 1478115463, "answer_id": 40388350, "question_id": 40388246, "link": "https://stackoverflow.com/questions/40388246/convert-string-to-time-and-parse-in-golang/40388350#40388350", "title": "convert string to time and parse in golang", "body": "<p>You're not correctly providing the <code>layout</code> argument to <code>Parse</code>. You're supposed to be using <code>Mon Jan 2 15:04:05 MST 2006</code> (this is magic value, you put create a string in the format you want but with that date) in the given format so in your case, it would be <code>2006-01-02 15:04:05.000000000 +0000 UTC</code> plus the offset which I don't know off the top of my head for MST.</p>\n"}], "owner": {"reputation": 1536, "user_id": 1793374, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/qK8kV.png?s=128&g=1", "display_name": "Mike", "link": "https://stackoverflow.com/users/1793374/mike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7579, "favorite_count": 0, "accepted_answer_id": 40388350, "answer_count": 1, "score": 2, "last_activity_date": 1562915603, "creation_date": 1478115083, "last_edit_date": 1478116637, "question_id": 40388246, "link": "https://stackoverflow.com/questions/40388246/convert-string-to-time-and-parse-in-golang", "title": "convert string to time and parse in golang", "body": "<p>I'm reading a timestamp from a file, and I assign the value to <code>t</code>:</p>\n\n<p><code>t := \"2016-11-02 19:23:05.503705739 +0000 UTC\"</code></p>\n\n<p>When I attempt to parse the string:</p>\n\n<p><code>time, err := time.Parse(\"2016-11-02 19:18:57.149197306 +0000 UTC\", t)</code></p>\n\n<p>The result is:</p>\n\n<p><code>0001-01-01 00:00:00 +0000 UTC</code></p>\n\n<p>But I expected result to be:</p>\n\n<p><code>\"2016-11-02 19:18:57.149197306 +0000 UTC\"</code> ?</p>\n\n<p>Please advise.</p>\n"}, {"tags": ["go", "amazon-dynamodb"], "comments": [{"owner": {"reputation": 29341, "user_id": 6337748, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/7Si7m.jpg?s=128&g=1", "display_name": "notionquest", "link": "https://stackoverflow.com/users/6337748/notionquest"}, "edited": false, "score": 0, "creation_date": 1478168525, "post_id": 40387845, "comment_id": 68048028, "body": "The code works fine for me. I get the other attributes present in the table in printing result."}, {"owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "reply_to_user": {"reputation": 29341, "user_id": 6337748, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/7Si7m.jpg?s=128&g=1", "display_name": "notionquest", "link": "https://stackoverflow.com/users/6337748/notionquest"}, "edited": false, "score": 0, "creation_date": 1478196724, "post_id": 40387845, "comment_id": 68066990, "body": "@notionquest, Thank You. I am certainly not getting the other attributes. I wonder what I am doing differently from you..."}, {"owner": {"reputation": 29341, "user_id": 6337748, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/7Si7m.jpg?s=128&g=1", "display_name": "notionquest", "link": "https://stackoverflow.com/users/6337748/notionquest"}, "edited": false, "score": 0, "creation_date": 1478198545, "post_id": 40387845, "comment_id": 68068079, "body": "could you please share your GO and goamz version?"}, {"owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "reply_to_user": {"reputation": 29341, "user_id": 6337748, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/7Si7m.jpg?s=128&g=1", "display_name": "notionquest", "link": "https://stackoverflow.com/users/6337748/notionquest"}, "edited": false, "score": 0, "creation_date": 1478200160, "post_id": 40387845, "comment_id": 68068962, "body": "@notionquest, I updated my answer, I was not  able to find <code>goamz</code> version, but am I very sure that I am on the tip of master."}], "answers": [{"comments": [{"owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "edited": false, "score": 0, "creation_date": 1478366885, "post_id": 40419752, "comment_id": 68129071, "body": "Yes, that&#39;s is true; I get that result. Thank you very much."}], "tags": [], "owner": {"reputation": 29341, "user_id": 6337748, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/7Si7m.jpg?s=128&g=1", "display_name": "notionquest", "link": "https://stackoverflow.com/users/6337748/notionquest"}, "is_accepted": true, "score": 1, "last_activity_date": 1478253547, "creation_date": 1478253547, "answer_id": 40419752, "question_id": 40387845, "link": "https://stackoverflow.com/questions/40387845/cant-get-getitem-to-work-properly-with-goamz-dynamodb/40419752#40419752", "title": "Cant get GetItem to work properly with goamz dynamodb", "body": "<p>I believe it could be a bug in the <strong><code>goamz</code></strong> library. The function <code>parseAttribute</code> has logic to parse the different data types. However, it looks like it doesn't seems to be working for data types MAP, LIST, BOOL etc.</p>\n\n<p>Per my observation, String, Number and SS data types are working fine. If you can add a <strong>non-key string attribute</strong> and execute the program. You should get the attribute in the result.</p>\n\n<p><a href=\"https://github.com/AdRoll/goamz/blob/34e96a017307e0442cd8e5f0c15e199c9934563f/dynamodb/item.go\" rel=\"nofollow noreferrer\">goamz item go source code for reference</a></p>\n"}, {"tags": [], "owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "is_accepted": false, "score": 1, "last_activity_date": 1499655969, "creation_date": 1499655969, "answer_id": 45003249, "question_id": 40387845, "link": "https://stackoverflow.com/questions/40387845/cant-get-getitem-to-work-properly-with-goamz-dynamodb/45003249#45003249", "title": "Cant get GetItem to work properly with goamz dynamodb", "body": "<p>I (the OP) ended up using .. <a href=\"https://github.com/aws/aws-sdk-go/tree/master/service/dynamodb\" rel=\"nofollow noreferrer\">aws-sdk-go</a></p>\n\n<p>And it works fine, the code I used:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/aws/aws-sdk-go/aws\"\n    \"github.com/aws/aws-sdk-go/aws/endpoints\"\n    \"github.com/aws/aws-sdk-go/aws/session\"\n    \"github.com/aws/aws-sdk-go/service/dynamodb\"\n)\n\nfunc main() {\n\n    sess := session.Must(session.NewSession(&amp;aws.Config{\n        Region: aws.String(endpoints.UsWest2RegionID),\n    }))\n\n    svc := dynamodb.New(sess)\n\n    input := &amp;dynamodb.GetItemInput{\n        Key: map[string]*dynamodb.AttributeValue{\n            \"year\": {\n                N: aws.String(\"1999\"),\n            },\n            \"title\": {\n                S: aws.String(\"MyMovie\"),\n            },\n        },\n        TableName: aws.String(\"Movies\"),\n    }\n\n    result, err := svc.GetItem(input)\n\n    fmt.Println(result)\n    fmt.Println(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 67160, "user_id": 1078084, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/wApmM.jpg?s=128&g=1", "display_name": "Akavall", "link": "https://stackoverflow.com/users/1078084/akavall"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 362, "favorite_count": 0, "accepted_answer_id": 40419752, "answer_count": 2, "score": 2, "last_activity_date": 1499655969, "creation_date": 1478113449, "last_edit_date": 1478199996, "question_id": 40387845, "link": "https://stackoverflow.com/questions/40387845/cant-get-getitem-to-work-properly-with-goamz-dynamodb", "title": "Cant get GetItem to work properly with goamz dynamodb", "body": "<p>I was following <a href=\"http://docs.aws.amazon.com/amazondynamodb/latest/gettingstartedguide/GettingStarted.Python.01.html\" rel=\"nofollow noreferrer\">this</a> tutorial, and set up the table using Python, and I can get item with Python but not with golang. What am I doing wrong?</p>\n\n<p>I made my table like this (almost copy and paste from the tutorial):</p>\n\n<pre><code>from __future__ import print_function # Python 2/3 compatibility\nimport boto3\n\ndynamodb = boto3.resource('dynamodb', region_name='us-west-2')\n\ntable = dynamodb.create_table(\n    TableName='Movies',\n    KeySchema=[\n        {\n            'AttributeName': 'year',\n            'KeyType': 'HASH'  #Partition key\n        },\n        {\n            'AttributeName': 'title',\n            'KeyType': 'RANGE'  #Sort key\n        }\n    ],\n    AttributeDefinitions=[\n        {\n            'AttributeName': 'year',\n            'AttributeType': 'N'\n        },\n        {\n            'AttributeName': 'title',\n            'AttributeType': 'S'\n        },\n\n    ],\n    ProvisionedThroughput={\n        'ReadCapacityUnits': 10,\n        'WriteCapacityUnits': 10\n    }\n)\n</code></pre>\n\n<p>I loaded the data like this (in Python):</p>\n\n<pre><code>my_item = {\"year\": 1999, \"title\": \"MyMovie\", \"info\": {\"Plot\": \"DynamoDB\"}}\ntable.put_item(Item=my_item)\n</code></pre>\n\n<p>And when I read data (in Python):</p>\n\n<pre><code>response = table.get_item(Key={\"year\":1999,\n                        \"title\":\"MyMovie\",\n                    }\n    )\nprint response\n</code></pre>\n\n<p>My output is:</p>\n\n<pre><code>{u'Item': {u'info': {u'Plot': u'DynamoDB'}, u'year': Decimal('1999'), u'title': u'MyMovie'}, 'ResponseMetadata': {'RetryAttempts': 0, 'HTTPStatusCode': 200, 'RequestId': 'C8I2Q46K06T030INBCFN35RELVVV4KQNSO5AEMVJF66Q9ASUAAJG', 'HTTPHeaders': {'x-amzn-requestid': 'C8I2Q46K06T030INBCFN35RELVVV4KQNSO5AEMVJF66Q9ASUAAJG', 'content-length': '93', 'server': 'Server', 'connection': 'keep-alive', 'x-amz-crc32': '4025342458', 'date': 'Wed, 02 Nov 2016 18:20:14 GMT', 'content-type': 'application/x-amz-json-1.0'}}}\n</code></pre>\n\n<p>My golang code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/goamz/goamz/aws\"\n    \"github.com/goamz/goamz/dynamodb\"\n)\n\n\nfunc main() {\n\n    access_key := \"MyAccessKey\"\n    secret_key := \"MySecretKey\"\n\n    auth := aws.Auth{AccessKey: access_key, SecretKey: secret_key}\n\n    server := &amp;dynamodb.Server{Auth: auth, Region: aws.USWest2}\n\n    desc_ptr, err := server.DescribeTable(\"Movies\")\n\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    primary_key, err := desc_ptr.BuildPrimaryKey()\n\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    table := server.NewTable(\"Movies\", primary_key)\n\n    my_key := dynamodb.Key{HashKey: \"1999\", RangeKey: \"MyMovie\"}\n\n    result, err := table.GetItem(&amp;my_key)\n\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Println(\"Printing Result\")\n\n    for k, v := range(result) {\n        fmt.Println(k, *v)\n    }\n}\n</code></pre>\n\n<p>Results in:</p>\n\n<pre><code>Printing Result\ntitle {S title MyMovie [] }\nyear {N year 1999 [] }\n</code></pre>\n\n<p>This is missing everything besides <code>title</code> and <code>year</code> that I provide. What am I missing?</p>\n\n<p>Edit:</p>\n\n<p>My <code>go</code> version:</p>\n\n<pre><code>go version go1.7.3 linux/amd64\n</code></pre>\n\n<p>I don't know what <code>goamz</code> version I have, but I am very sure that I am on the tip of master.</p>\n"}, {"tags": ["java", "android", "go", "tcpsocket"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478113249, "post_id": 40387671, "comment_id": 68027217, "body": "Your Go code is relying on the connection closing to signal the end of the message. The sender either needs to close the connection, or you need some other protocol to delimit messages."}, {"owner": {"reputation": 13, "user_id": 7106251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd6e47a5ece95af4115baf2cf1a40a8f?s=128&d=identicon&r=PG&f=1", "display_name": "Zhijie Li", "link": "https://stackoverflow.com/users/7106251/zhijie-li"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478120033, "post_id": 40387671, "comment_id": 68030851, "body": "so I need to establish another connection to send to message back to Java?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478120967, "post_id": 40387671, "comment_id": 68031369, "body": "No, you just need a protocol for sending messages: fixed length, length prefixed, newline delimited, http, etc. A TCP connection is a stream, it doesn&#39;t send individual messages."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 7106251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd6e47a5ece95af4115baf2cf1a40a8f?s=128&d=identicon&r=PG&f=1", "display_name": "Zhijie Li", "link": "https://stackoverflow.com/users/7106251/zhijie-li"}, "edited": false, "score": 1, "creation_date": 1478204074, "post_id": 40395692, "comment_id": 68071021, "body": "I used socket.shutdownOutput() and it works for me. for anyone who have the similar question don&#39;t use outputstream.close(); it will shut the entire socket down."}, {"owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "reply_to_user": {"reputation": 13, "user_id": 7106251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd6e47a5ece95af4115baf2cf1a40a8f?s=128&d=identicon&r=PG&f=1", "display_name": "Zhijie Li", "link": "https://stackoverflow.com/users/7106251/zhijie-li"}, "edited": false, "score": 0, "creation_date": 1478204731, "post_id": 40395692, "comment_id": 68071396, "body": "Thanks @ZhijieLi for that important detail!"}], "tags": [], "owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "is_accepted": true, "score": 0, "last_activity_date": 1478204714, "last_edit_date": 1478204714, "creation_date": 1478156999, "answer_id": 40395692, "question_id": 40387671, "link": "https://stackoverflow.com/questions/40387671/golang-server-sending-byte-array-to-android/40395692#40395692", "title": "golang server sending byte array to Android", "body": "<p><code>io.Copy(&amp;buf, nc)</code> on Go side will continue to read from the connection's input stream until it's closed. On Java side, you try to read from the connection's input stream, but Go side is still waiting for further input, since Java is still keeping its output steam (Go's input stream) open.</p>\n\n<p>Solution: on Java side, close the output stream using the socket's <a href=\"https://docs.oracle.com/javase/7/docs/api/java/net/Socket.html#shutdownOutput()\" rel=\"nofollow noreferrer\"><code>shutdownOutput()</code></a> method after you are done writing to it.</p>\n"}], "owner": {"reputation": 13, "user_id": 7106251, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd6e47a5ece95af4115baf2cf1a40a8f?s=128&d=identicon&r=PG&f=1", "display_name": "Zhijie Li", "link": "https://stackoverflow.com/users/7106251/zhijie-li"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 808, "favorite_count": 1, "accepted_answer_id": 40395692, "answer_count": 1, "score": 1, "last_activity_date": 1478338584, "creation_date": 1478112833, "last_edit_date": 1478338584, "question_id": 40387671, "link": "https://stackoverflow.com/questions/40387671/golang-server-sending-byte-array-to-android", "title": "golang server sending byte array to Android", "body": "<p>I have met some issue with Java socket and golang. I am trying to develop a golang server that sends/receives byte array to an android client. now the android client can send byte array to go server but cannot receive anything from go server. I have attached the code below.</p>\n\n<p>The code got stuck when reach in.read(); I tried <code>in.available()</code> to see how many bytes are in the inputstream. it always shows 0:</p>\n\n<pre><code>protected void onCreate(Bundle savedInstanceState) {\n    super.onCreate(savedInstanceState);\n    setContentView(R.layout.activity_main);\n    Button regButton = (Button) findViewById(R.id.regbut);\n    msg = (TextView) findViewById(R.id.msg);\n\n    regButton.setOnClickListener(new View.OnClickListener(){\n        @Override\n        public void onClick(View view){\n            new Thread(new Runnable() {\n                @Override\n                public void run() {\n                    byte[] array;\n                    BigInteger mykey = mykey(publicKey);\n                    System.out.println(mykey);\n                    BigInteger rawkey = generater.modPow(mykey,publicKey);\n                    BigInteger serverRawKey;\n                    System.out.println(rawkey);\n                    array = rawkey.toByteArray();\n                    System.out.println(rawkey.bitCount());\n                    try{\n                        Socket con = new Socket(\"149.166.134.55\",9999);\n                        OutputStream out = con.getOutputStream();\n                        InputStream in = con.getInputStream();\n                        DataOutputStream dOut = new DataOutputStream(out);\n                        //DataInputStream din = new DataInputStream(in);\n                        byte[] data = new byte[10];\n                        dOut.write(array);\n                        TimeUnit.SECONDS.sleep(10);\n                        System.out.println(in.available());\n                        in.read(data);\n                        con.close();\n                        }catch (Exception e){\n                        System.out.println(e);\n                       }\n                   }\n               }).start();\n           }\n        });\n         }\n</code></pre>\n\n<p>here is the go code. if i remove in.read(); in java everything works just fine. but it pauses when I add in.read();</p>\n\n<pre><code>var publickey *big.Int\n\nfunc ClientListen(port string) {\n    ln, err := net.Listen(\"tcp\", port)\n    if err != nil {\n        fmt.Println(\"error\\n\")\n        fmt.Println(err)\n        return\n    }\n    for {\n        nc, err := ln.Accept()\n        if err != nil {\n            fmt.Println(err)\n            continue\n        }\n        go recivemsg(nc)\n    }\n}\n\nfunc recivemsg(nc net.Conn) {\n    publickey = big.NewInt(15485863)\n    var msg []byte\n    var buf bytes.Buffer\n    rawkey := big.NewInt(0)\n    io.Copy(&amp;buf, nc)\n    fmt.Println(\"total size:\", buf.Len())\n    msg = buf.Bytes()\n    rawkey = rawkey.SetBytes(msg)\n    fmt.Println(msg, \"    \", rawkey)\n    r := rand.New(rand.NewSource(99))\n    myraw := big.NewInt(0)\n    myraw = myraw.Rand(r, publickey)\n    fmt.Println(myraw)\n    newmsg := myraw.Bytes()\n    nc.Write(newmsg)\n    nc.Close()\n    fmt.Println(nc.RemoteAddr())\n\n}\n\nfunc main() {\n    ClientListen(\":9999\")\n}\n</code></pre>\n\n<p>thanks guys for taking your time to read my question </p>\n"}, {"tags": ["linux", "http", "go", "trickle"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478111204, "post_id": 40386936, "comment_id": 68026125, "body": "Go is making its syscalls directly; it doesn&#39;t go through libc."}, {"owner": {"reputation": 503, "user_id": 7106084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2f169a8f4cb706ce899562e82a817b6?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Waldon", "link": "https://stackoverflow.com/users/7106084/christopher-waldon"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478111551, "post_id": 40386936, "comment_id": 68026313, "body": "@JimB Are you saying that <code>trickle</code> relies on the wrapped program using libc?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478111805, "post_id": 40386936, "comment_id": 68026456, "body": "Yes. The only way it could work (and the reason it doesn&#39;t work on static executables) is that it uses preload objects (via LD_PRELOAD) to replace the standard libc socket calls with its own."}, {"owner": {"reputation": 503, "user_id": 7106084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2f169a8f4cb706ce899562e82a817b6?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Waldon", "link": "https://stackoverflow.com/users/7106084/christopher-waldon"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478111975, "post_id": 40386936, "comment_id": 68026545, "body": "Thank you! I&#39;m sad that this won&#39;t work, but I appreciate the quick response.  If you&#39;d like to make your comments into a full answer, I&#39;d be happy to mark it as accepted."}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 6, "last_activity_date": 1478112767, "last_edit_date": 1478112767, "creation_date": 1478112271, "answer_id": 40387514, "question_id": 40386936, "link": "https://stackoverflow.com/questions/40386936/why-doesnt-the-trickle-utility-affect-my-dynamically-linked-golang-program/40387514#40387514", "title": "Why doesn&#39;t the trickle utility affect my dynamically-linked golang program?", "body": "<p>Trickle relies on using LD_PRELOAD to replace all network related calls through libc with its own implementation. This is why trickle doesn't work with static binaries.</p>\n\n<p>Go makes all its own syscalls directly and does not use the libc interface, so the inter-positioned functions provided by trickle are not used. </p>\n"}], "owner": {"reputation": 503, "user_id": 7106084, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2f169a8f4cb706ce899562e82a817b6?s=128&d=identicon&r=PG&f=1", "display_name": "Christopher Waldon", "link": "https://stackoverflow.com/users/7106084/christopher-waldon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 274, "favorite_count": 0, "accepted_answer_id": 40387514, "answer_count": 1, "score": 2, "last_activity_date": 1478112767, "creation_date": 1478110328, "last_edit_date": 1478110665, "question_id": 40386936, "link": "https://stackoverflow.com/questions/40386936/why-doesnt-the-trickle-utility-affect-my-dynamically-linked-golang-program", "title": "Why doesn&#39;t the trickle utility affect my dynamically-linked golang program?", "body": "<p>I have a golang program that uploads a ton of data to OpenStack Object Storage over https. It relies on the golang standard library <code>\"net/http\"</code> to do the work. I would like to use <a href=\"https://linux.die.net/man/1/trickle\" rel=\"nofollow noreferrer\"><code>trickle</code></a> to rate-limit the upload of the data, but running my code using trickle does not seem to have any effect (as though I'm not using trickle at all).</p>\n\n<p>Why does this happen? Is there some limitation to trickle or golang that prevents them from working together? Is there some gotcha that I haven't considered?</p>\n\n<p>This is my setup:</p>\n\n<p>I know that <code>trickle</code> only works on dynamically-linked executables (see first paragraph of trickle documentation), so I've compiled my code with <code>go build -compiler gccgo mycode.go</code> and the output of <code>ldd myexecutable</code> is:</p>\n\n<pre><code>linux-vdso.so.1 =&gt;  (0x00007ffee27b8000)\nlibgo.so.9 =&gt; /usr/lib/x86_64-linux-gnu/libgo.so.9 (0x00007f46062bf000)\nlibgcc_s.so.1 =&gt; /lib/x86_64-linux-gnu/libgcc_s.so.1 (0x00007f46060a9000)\nlibc.so.6 =&gt; /lib/x86_64-linux-gnu/libc.so.6 (0x00007f4605cdf000)\n/lib64/ld-linux-x86-64.so.2 (0x000055aa4d0a4000)\nlibpthread.so.0 =&gt; /lib/x86_64-linux-gnu/libpthread.so.0 (0x00007f4605ac2000)\nlibm.so.6 =&gt; /lib/x86_64-linux-gnu/libm.so.6 (0x00007f46057b9000)\n</code></pre>\n\n<p>I'm running this on Ubuntu Linux 16.04. I use <a href=\"https://github.com/mattthias/slurm\" rel=\"nofollow noreferrer\"><code>slurm</code></a> to view the network traffic as my command runs. The machine isn't running any other network-intensive jobs, so I'm confident that I'm seeing the traffic generated by my code.</p>\n\n<p>When I run</p>\n\n<pre><code>trickle -s -v -u2500 myexecutable ...args\n</code></pre>\n\n<p>I see my TX network traffic spike to about 12000KB/s (the maximum that the network can handle) instead of respecting my limit of 2500KB/s.</p>\n\n<p>Can anyone think of why this might happen or what I could try to fix it?</p>\n"}, {"tags": ["go", "apache-kafka", "regional"], "comments": [{"owner": {"reputation": 1737, "user_id": 5252122, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fcJtb.png?s=128&g=1", "display_name": "JDP10101", "link": "https://stackoverflow.com/users/5252122/jdp10101"}, "edited": false, "score": 0, "creation_date": 1478811091, "post_id": 40386597, "comment_id": 68313056, "body": "Bit of a clarification, are you looking for something that you can run on your edge node(s) in order to publish messages back to a central Kafka cluster? or are you looking for something to act in a more central manner that could reach out to each edge node, ask for an update and then publish those updates to the Kafka cluster?"}], "answers": [{"tags": [], "owner": {"reputation": 2022, "user_id": 1014850, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f5725ef429da7859ca1d98fe586ce70b?s=128&d=identicon&r=PG", "display_name": "edlerd", "link": "https://stackoverflow.com/users/1014850/edlerd"}, "is_accepted": false, "score": 0, "last_activity_date": 1478854552, "creation_date": 1478854552, "answer_id": 40544328, "question_id": 40386597, "link": "https://stackoverflow.com/questions/40386597/whats-the-best-way-to-push-kafka-messages-from-my-edge-nodes/40544328#40544328", "title": "What&#39;s the best way to push kafka messages from my edge nodes?", "body": "<p>Write the messages to a local logfile on disk. Write a small daemon which reads the logfile and pushes the events to the main kafka daemon.</p>\n\n<p>To increase througput and limit the effect of latency you could also rotate the logfile every minute. Then rsync the logfile with a cronjob to your main kafka region minutely. Let the import daemon run there.</p>\n"}, {"tags": [], "owner": {"reputation": 938, "user_id": 3747110, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/B6yKR.png?s=128&g=1", "display_name": "quickinsights", "link": "https://stackoverflow.com/users/3747110/quickinsights"}, "is_accepted": true, "score": 1, "last_activity_date": 1479098421, "creation_date": 1479098421, "answer_id": 40581977, "question_id": 40386597, "link": "https://stackoverflow.com/questions/40386597/whats-the-best-way-to-push-kafka-messages-from-my-edge-nodes/40581977#40581977", "title": "What&#39;s the best way to push kafka messages from my edge nodes?", "body": "<p>As far as I know, here are your options:</p>\n\n<ol>\n<li>Setup a local Kafka cluster in each region and have your edge nodes \nwrite to the their local Kafka cluster for low latency writes. From \nthere, you would setup a mirror maker that pulls data from your local Kafka to your remote Kafka for aggregation. </li>\n<li>If you're concerned with interrupting your applications request path with high latent blocking requests, then you may want to configure your producers to write asynchronously (non-blocking) to your remote Kafka cluster. Depending on your programming language choice, this could be simple or complex exercise. </li>\n<li>Run a per host relay (or data buffer) service that could be as simple as a log file and daemon that pushes to your remote Kafka cluster (as mentioned above). Alternatively, run a single instance Kafka / Zookeeper container (there are docker images that bundle both together) that buffers the data for downstream pulling.  </li>\n</ol>\n\n<p>Option 1. is definitely the most standard solution to this problem, albeit a bit heavy handed. I suspect there will be more tooling coming out Confluent / Kafka folks to support option 3. in the future. </p>\n"}], "owner": {"reputation": 405, "user_id": 515538, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/4161f2e560fc7eb8af4096c12ebe11ce?s=128&d=identicon&r=PG", "display_name": "Styles", "link": "https://stackoverflow.com/users/515538/styles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1122, "favorite_count": 1, "accepted_answer_id": 40581977, "answer_count": 2, "score": 4, "last_activity_date": 1479098421, "creation_date": 1478109190, "question_id": 40386597, "link": "https://stackoverflow.com/questions/40386597/whats-the-best-way-to-push-kafka-messages-from-my-edge-nodes", "title": "What&#39;s the best way to push kafka messages from my edge nodes?", "body": "<p>I have a worker in the primary region (US-East) that computes data on traffic at our edge locations. I want to push the data from an edge region to our primary kafka region. </p>\n\n<p>An example is Poland, Australia, US-West. I want to push all these stats to US-East. I don't want to encurr additional latency during the writes from the edge regions to the primary. </p>\n\n<p>Another option is to create another kafka cluster and worker that acts as a relay. That would require us to maintain individual clusters in each region and would add a lot more complexity to our deployments.</p>\n\n<p>I've seen Mirror Maker, but I don't really want to Mirror anything, I guess I'm looking more for a relay system. If this isn't the designed way to do this, how can I aggregate all of our application metrics to the primary region to be computed and sorted?</p>\n\n<p>Thank you for your time.</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1478104143, "post_id": 40384879, "comment_id": 68021864, "body": "Using <a href=\"https://golang.org/ref/spec#Type_switches\" rel=\"nofollow noreferrer\">type switch</a> or <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a>. See this possible duplicate question+answer: <a href=\"http://stackoverflow.com/questions/40343471/how-to-check-if-interface-is-a-slice\">How to check if interface{} is a slice</a>"}, {"owner": {"reputation": 315, "user_id": 6559250, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f4ed53de34f736f2196ac1a26c36dc8d?s=128&d=identicon&r=PG", "display_name": "ahmdrz", "link": "https://stackoverflow.com/users/6559250/ahmdrz"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1478508358, "post_id": 40384879, "comment_id": 68166907, "body": "sure. So I know its a map ! how to check its map[string]string or map[string]int and etc..."}], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 22, "last_activity_date": 1478104201, "creation_date": 1478104201, "answer_id": 40385023, "question_id": 40384879, "link": "https://stackoverflow.com/questions/40384879/how-to-check-interface-is-a-mapstringstring-in-golang/40385023#40385023", "title": "How to check interface is a map[string]string in golang", "body": "<p>You don't have to use reflect at all for this. A simple type assert will suffice;</p>\n\n<pre><code>unboxed, ok := output.(*map[string]string)\nif !ok {\n    return fmt.Errorf(\"Output should be a pointer of a map\")\n}\nif unboxed == nil {\n    return fmt.Errorf(\"Output in NIL\")\n}\n// if I get here unboxed is a *map[string]string and is not nil\n</code></pre>\n"}], "owner": {"reputation": 315, "user_id": 6559250, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f4ed53de34f736f2196ac1a26c36dc8d?s=128&d=identicon&r=PG", "display_name": "ahmdrz", "link": "https://stackoverflow.com/users/6559250/ahmdrz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5550, "favorite_count": 1, "accepted_answer_id": 40385023, "answer_count": 1, "score": 7, "last_activity_date": 1478104201, "creation_date": 1478103747, "question_id": 40384879, "link": "https://stackoverflow.com/questions/40384879/how-to-check-interface-is-a-mapstringstring-in-golang", "title": "How to check interface is a map[string]string in golang", "body": "<p>I want to check the output variable is map[string]string or not.\nthe output should be a map[string]string and it should be a ptr.</p>\n\n<p>I checked ptr value. But I don't know how to check the key of map if is string or not.</p>\n\n<blockquote>\n  <p>sorry for my bad english</p>\n</blockquote>\n\n<pre><code>import (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc Decode(filename string, output interface{}) error {\n    rv := reflect.ValueOf(output)\n    if rv.Kind() != reflect.Ptr {\n        return fmt.Errorf(\"Output should be a pointer of a map\")\n    }\n    if rv.IsNil() {\n        return fmt.Errorf(\"Output in NIL\")\n    }\n    fmt.Println(reflect.TypeOf(output).Kind())\n    return nil\n}\n</code></pre>\n"}, {"tags": ["c#", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1478101701, "post_id": 40383431, "comment_id": 68020251, "body": "Go strings are utf8 encoded. You only need to re-encode if you need another encoding. (this is also not encryption, nor is the fact you&#39;re hashing bytes relevant to string encoding)"}, {"owner": {"reputation": 1039, "user_id": 5252955, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh6.googleusercontent.com/-a_QM0l16-xk/AAAAAAAAAAI/AAAAAAAAARc/RFsNPxQgnfs/photo.jpg?sz=128", "display_name": "Nick Rucci", "link": "https://stackoverflow.com/users/5252955/nick-rucci"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478102051, "post_id": 40383431, "comment_id": 68020525, "body": "@JimB Thank you"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1478110141, "post_id": 40383431, "comment_id": 68025488, "body": "@JimB, that&#39;s not correct: strings in Go are opaque collections of bytes. String <i>literals</i> indeed provide UTF-8-encoded strings because the Go source files are defined to be encoded in UTF-8. The other case where Go strings are <i>interpreted</i> as being encoded in UTF-8 is iterating over Unicode code points <i>(runes)</i> in them using the <code>range</code> statement. Full details are in the must read <a href=\"http://blog.golang.org/strings\" rel=\"nofollow noreferrer\">Go blog entry on strings</a>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1478111071, "post_id": 40383431, "comment_id": 68026050, "body": "@kostix: yes, maybe I should have said &quot;interpreted&quot; or assumed to be utf8 when converting to runes, as the string representation is obviously just a series of bytes."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478111257, "post_id": 40383431, "comment_id": 68026158, "body": "@JimB, I know your skill level is high; just did the usual nitpicking. I think we should strive not to create a wrong mental model in the mind of a newfangled gopher, so felt the need to chime in ;-)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1478111556, "post_id": 40383431, "comment_id": 68026317, "body": "@kostix: no problem if it ends up helping someone :)"}], "answers": [{"tags": [], "owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "is_accepted": true, "score": 4, "last_activity_date": 1478246707, "last_edit_date": 1478246707, "creation_date": 1478102370, "answer_id": 40384408, "question_id": 40383431, "link": "https://stackoverflow.com/questions/40383431/encoding-utf-8-with-go/40384408#40384408", "title": "Encoding UTF-8 with Go", "body": "<p>According to the documentation:  </p>\n\n<blockquote>\n  <p>A string literal, absent byte-level escapes, always holds valid UTF-8\n  sequences.</p>\n</blockquote>\n\n<p>So you don't need to encode into utf8 the string if is inside the Golang source code. However, if the string comes from an input, the <a href=\"https://golang.org/pkg/unicode/utf8/\" rel=\"nofollow noreferrer\">utf8</a> package is your friend.</p>\n"}], "owner": {"reputation": 1039, "user_id": 5252955, "user_type": "registered", "accept_rate": 78, "profile_image": "https://lh6.googleusercontent.com/-a_QM0l16-xk/AAAAAAAAAAI/AAAAAAAAARc/RFsNPxQgnfs/photo.jpg?sz=128", "display_name": "Nick Rucci", "link": "https://stackoverflow.com/users/5252955/nick-rucci"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1709, "favorite_count": 0, "accepted_answer_id": 40384408, "answer_count": 1, "score": 1, "last_activity_date": 1478246707, "creation_date": 1478099524, "last_edit_date": 1478102541, "question_id": 40383431, "link": "https://stackoverflow.com/questions/40383431/encoding-utf-8-with-go", "title": "Encoding UTF-8 with Go", "body": "<p>I am trying to find the equivalent of the following C# code in Go.</p>\n\n<pre><code>pwd = \"abc123\";\nencoding = Encoding.UTF8;\nSHA1 sha1 = SHA1.Create();\nbyte[] hash = sha1.ComputeHash(encoding.GetBytes(text));\n</code></pre>\n\n<p>I know that there is a <a href=\"https://golang.org/pkg/crypto/sha1/\" rel=\"nofollow noreferrer\">crypto/sha1</a> package within Go. I know I can run:</p>\n\n<pre><code>pwd := \"abc123\"\nhasher := sha1.New() // SHA1.Create();\nhasher.Write([]byte(pwd)) // sha1.ComputeHash but without encoding in UTF8 ?\n</code></pre>\n\n<p>I am not sure how I can get the correct encoding when hashing. I was wondering if I could get some help converting this</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 9384, "user_id": 761132, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/fa462ba2bc6318a8b2e7662bb8e91aa1?s=128&d=identicon&r=PG", "display_name": "Rizwan M.Tuman", "link": "https://stackoverflow.com/users/761132/rizwan-m-tuman"}, "edited": false, "score": 0, "creation_date": 1478090568, "post_id": 40380149, "comment_id": 68012221, "body": "updated the answer a bit, you can try now!"}], "answers": [{"tags": [], "owner": {"reputation": 9384, "user_id": 761132, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/fa462ba2bc6318a8b2e7662bb8e91aa1?s=128&d=identicon&r=PG", "display_name": "Rizwan M.Tuman", "link": "https://stackoverflow.com/users/761132/rizwan-m-tuman"}, "is_accepted": true, "score": 3, "last_activity_date": 1478090672, "last_edit_date": 1478090672, "creation_date": 1478090357, "answer_id": 40380183, "question_id": 40380149, "link": "https://stackoverflow.com/questions/40380149/go-regex-string-validation/40380183#40380183", "title": "Go regex string validation", "body": "<p>Try this:</p>\n\n<pre><code>^[0-9]{2}$\n</code></pre>\n\n<p><a href=\"https://regex101.com/r/9Qa071/6\" rel=\"nofollow noreferrer\">Explanation</a></p>\n\n<p>GO CODE:</p>\n\n<pre><code>package main\n\nimport (\n    \"regexp\"\n    \"fmt\"\n)\n\nfunc main() {\n    var re = regexp.MustCompile(`(?m)^[0-9]{2}$`)\n    var str = `213`\n\n    for i, match := range re.FindAllString(str, -1) {\n        fmt.Println(match, \"found at index\", i)\n    }\n}\n</code></pre>\n\n<p><a href=\"http://ideone.com/HuD8Ne\" rel=\"nofollow noreferrer\">Run the code here</a></p>\n"}], "owner": {"reputation": 332, "user_id": 6546677, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/de651bfc703df6b36099a32d569d8737?s=128&d=identicon&r=PG&f=1", "display_name": "George H", "link": "https://stackoverflow.com/users/6546677/george-h"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4738, "favorite_count": 0, "closed_date": 1478094307, "accepted_answer_id": 40380183, "answer_count": 1, "score": 2, "last_activity_date": 1478090672, "creation_date": 1478090251, "question_id": 40380149, "link": "https://stackoverflow.com/questions/40380149/go-regex-string-validation", "closed_reason": "Duplicate", "title": "Go regex string validation", "body": "<p>In go there is the function MatchString which can be used to match a string with a regex, however, the function returns true if a substring that matches the regex is found.</p>\n\n<p>Is there a way/similar function that returns true only when the whole of the string is matched (e.g. if I have [0-9]{2} and my string is 213, the return value should be false). ? or should this be done from the regex string itself ?</p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 327, "user_id": 2334415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de3b8d69e2739d4d45ecf4e366d50358?s=128&d=identicon&r=PG", "display_name": "Ruluk", "link": "https://stackoverflow.com/users/2334415/ruluk"}, "edited": false, "score": 0, "creation_date": 1564081224, "post_id": 40380147, "comment_id": 100923665, "body": "What about using <a href=\"https://golang.org/pkg/sync/#Map\" rel=\"nofollow noreferrer\"><code>sync.Map</code></a>? I guess it would get the best of everything."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 327, "user_id": 2334415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de3b8d69e2739d4d45ecf4e366d50358?s=128&d=identicon&r=PG", "display_name": "Ruluk", "link": "https://stackoverflow.com/users/2334415/ruluk"}, "edited": false, "score": 0, "creation_date": 1564218427, "post_id": 40380147, "comment_id": 100964696, "body": "@Ruluk Yes, you could also use <code>sync.Map</code> if you need to mutate values in the map."}, {"owner": {"reputation": 158, "user_id": 8451478, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49358a2db456a97db528bc6a459c8049?s=128&d=identicon&r=PG&f=1", "display_name": "ideoutrea", "link": "https://stackoverflow.com/users/8451478/ideoutrea"}, "edited": false, "score": 1, "creation_date": 1595307570, "post_id": 40380147, "comment_id": 111421153, "body": "as the Go context doc says, &quot;The provided key must be comparable and should not be of type string or any other built-in type to avoid collisions between packages using context. Users of WithValue should define their own  types for keys&quot;"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 49, "last_activity_date": 1509456754, "last_edit_date": 1509456754, "creation_date": 1478090247, "answer_id": 40380147, "question_id": 40379960, "link": "https://stackoverflow.com/questions/40379960/golang-context-withvalue-how-to-add-several-key-value-pairs/40380147#40380147", "title": "Golang context.WithValue: how to add several key-value pairs", "body": "<p>You pretty much listed your options. The answer you're seeking for depends on how you want to use the values stored in the context.</p>\n\n<p><a href=\"https://golang.org/pkg/context/#Context\" rel=\"noreferrer\"><code>context.Context</code></a> is an immutable object, \"extending\" it with a key-value pair is only possible by making a copy of it and adding the new key-value to the copy (which is done under the hood, by the <a href=\"https://golang.org/pkg/context/\" rel=\"noreferrer\"><code>context</code></a> package).</p>\n\n<p>Do you want further handlers to be able to access all the values by key in a transparent way? Then add all in a loop, using always the context of the last operation.</p>\n\n<p>One thing to note here is that the <code>context.Context</code> does not use a <code>map</code> under the hood to store the key-value pairs, which might sound surprising at first, but not if you think about it must be immutable and safe for concurrent use.</p>\n\n<p><strong>Using a <code>map</code></strong></p>\n\n<p>So for example if you have a lot of key-value pairs and need to lookup values by keys <em>fast</em>, adding each separately will result in a <code>Context</code> whose <code>Value()</code> method will be slow. In this case it's better if you add all your key-value pairs as a single <code>map</code> value, which can be accessed via <code>Context.Value()</code>, and each value in it can be queried by the associated key in <code>O(1)</code> time. Know that this will not be safe for concurrent use though, as a map may be modified from concurrent goroutines.</p>\n\n<p><strong>Using a <code>struct</code></strong></p>\n\n<p>If you'd use a big <code>struct</code> value having fields for all the key-value pairs you want to add, that may also be a viable option. Accessing this struct with <code>Context.Value()</code> would return you a copy of the struct, so it'd be safe for concurrent use (each goroutine could only get a different copy), but if you have many key-value pairs, this would result in unnecessary copy of a big struct each time someone needs a single field from it.</p>\n\n<p><strong>Using a <em>hybrid</em> solution</strong></p>\n\n<p>A <em>hybrid</em> solution could be to put all your key-value pairs in a <code>map</code>, and create a wrapper struct for this map, hiding the <code>map</code> (unexported field), and provide only a getter for the values stored in the map. Adding only this wrapper to the context, you keep the <em>safe concurrent access</em> for multiple goroutines (<code>map</code> is unexported), yet <em>no big data needs to be copied</em> (<code>map</code> values are small descriptors without the key-value data), and still it will be <em>fast</em> (as ultimately you'll index a map).</p>\n\n<p>This is how it could look like:</p>\n\n<pre><code>type Values struct {\n    m map[string]string\n}\n\nfunc (v Values) Get(key string) string {\n    return v.m[key]\n}\n</code></pre>\n\n<p>Using it:</p>\n\n<pre><code>v := Values{map[string]string{\n    \"1\": \"one\",\n    \"2\": \"two\",\n}}\n\nc := context.Background()\nc2 := context.WithValue(c, \"myvalues\", v)\n\nfmt.Println(c2.Value(\"myvalues\").(Values).Get(\"2\"))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/JtDAj7aVIH\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>two\n</code></pre>\n\n<p>If performance is not critical (or you have relatively few key-value pairs), I'd go with adding each separately.</p>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1478100293, "post_id": 40382440, "comment_id": 68019224, "body": "<i>&quot;If you were to use a map or some other structure to store your keys, it would rather break the point of contexts.&quot;</i> \u2013 While this is true, the asker has no intention to e.g. cancel the subtree starting from the last 3 of the pairs he wishes to add. The asker wants to add all his key-value pairs, and he doesn&#39;t even exposes the &quot;middle way&quot; contexts (and they are not accessible via the <code>Context</code> interface). So in my opinion in this case it comes with no disadvantage adding all key-value pairs to a single node."}, {"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1478101571, "post_id": 40382440, "comment_id": 68020152, "body": "Yah, that&#39;s fair, it really does depend on the situation. Generally I&#39;d say &quot;if they&#39;re separate, unrelated values it doesn&#39;t make sense to group them&quot; though. Eg. if you wouldn&#39;t store them together in a struct or map normally, don&#39;t do it in a context. This is, of course, just my personal preference and what I consider best practice."}, {"owner": {"reputation": 1790, "user_id": 1370397, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4cd00d196b2f9bef669ce212eec963b1?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1370397/alex"}, "edited": false, "score": 1, "creation_date": 1478115272, "post_id": 40382440, "comment_id": 68028280, "body": "@SamWhited +1 for the deeper insight!"}], "tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": false, "score": 18, "last_activity_date": 1601002491, "last_edit_date": 1601002491, "creation_date": 1478096861, "answer_id": 40382440, "question_id": 40379960, "link": "https://stackoverflow.com/questions/40379960/golang-context-withvalue-how-to-add-several-key-value-pairs/40382440#40382440", "title": "Golang context.WithValue: how to add several key-value pairs", "body": "<p>Yes, you're correct, you'll need to call <code>WithValue()</code> passing in the results each time. To understand why it works this way, it's worth thinking a bit about the theory behind context's.</p>\n<p>A context is actually a node in a tree of contexts (hence the various context constructors taking a &quot;parent&quot; context). When you request a value from a context, you're actually requesting the first value found that matches your key when searching up the tree, starting from the context in question. This means that if your tree has multiple branches, or you start from a higher point in a branch, you could find a different value. This is part of the power of contexts. Cancellation signals, on the other hand, propagate down the tree to all child elements of the one that's canceled, so you can cancel a single branch, or cancel the entire tree.</p>\n<p>For an example, here's a context tree that contains various things you might store in contexts:</p>\n<p><a href=\"https://i.stack.imgur.com/MDIzB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/MDIzB.png\" alt=\"Tree representation of context\" /></a></p>\n<p>The black edges represent data lookups, and the grey edges represent cancelation signals. Note that they propogate in opposite directions.</p>\n<p>If you were to use a map or some other structure to store your keys, it would rather break the point of contexts. You would no longer be able to cancel only a part of a request, or eg. change where things were logged depending on what part of the request you were in, etc.</p>\n<p><em>TL;DR \u2014 Yes, call WithValue several times.</em></p>\n"}, {"comments": [{"owner": {"reputation": 730, "user_id": 170638, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8ba83e9e6c4eb6476a0bcd2860936c0?s=128&d=identicon&r=PG", "display_name": "Igor A. Melekhine", "link": "https://stackoverflow.com/users/170638/igor-a-melekhine"}, "edited": false, "score": 1, "creation_date": 1607465587, "post_id": 54796256, "comment_id": 115280650, "body": "The provided key must be comparable and should not be of type string or any other built-in type to avoid collisions between packages using context. <a href=\"https://golang.org/pkg/context/#WithValue\" rel=\"nofollow noreferrer\">golang.org/pkg/context/#WithValue</a>"}], "tags": [], "owner": {"reputation": 1288, "user_id": 7225929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa26a9a36b086d9872cbe4c70355dfd3?s=128&d=identicon&r=PG&f=1", "display_name": "omotto", "link": "https://stackoverflow.com/users/7225929/omotto"}, "is_accepted": false, "score": 4, "last_activity_date": 1550702332, "last_edit_date": 1550702332, "creation_date": 1550701782, "answer_id": 54796256, "question_id": 40379960, "link": "https://stackoverflow.com/questions/40379960/golang-context-withvalue-how-to-add-several-key-value-pairs/54796256#54796256", "title": "Golang context.WithValue: how to add several key-value pairs", "body": "<p>As \"icza\" said you can group the values in one struct:</p>\n\n<pre><code>type vars struct {\n    lock    sync.Mutex\n    db      *sql.DB\n}\n</code></pre>\n\n<p>Then you can add this struct in context:</p>\n\n<pre><code>ctx := context.WithValue(context.Background(), \"values\", vars{lock: mylock, db: mydb})\n</code></pre>\n\n<p>And you can retrieve it:</p>\n\n<pre><code>ctxVars, ok := r.Context().Value(\"values\").(vars)\nif !ok {\n    log.Println(err)\n    return err\n}\ndb := ctxVars.db\nlock := ctxVars.lock\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2096, "user_id": 2361055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/98af7026fa805e684c5a154c51b277e9?s=128&d=identicon&r=PG", "display_name": "Nayeem Zen", "link": "https://stackoverflow.com/users/2361055/nayeem-zen"}, "is_accepted": false, "score": -1, "last_activity_date": 1574221313, "creation_date": 1574221313, "answer_id": 58946314, "question_id": 40379960, "link": "https://stackoverflow.com/questions/40379960/golang-context-withvalue-how-to-add-several-key-value-pairs/58946314#58946314", "title": "Golang context.WithValue: how to add several key-value pairs", "body": "<p>One (functional) way to do it is using currying and closures</p>\n\n<pre><code>r.WithContext(BuildContext(\n   r.Context(),\n   SchemaId(mySchemaId),\n   RequestId(myRequestId),\n   Logger(myLogger)\n))\n\nfunc RequestId(id string) partialContextFn {\n   return func(ctx context.Context) context.Context {\n      return context.WithValue(ctx, requestIdCtxKey, requestId)\n   }\n}\n\nfunc BuildContext(ctx context.Context, ctxFns ...partialContextFn) context.Context {\n   for f := range ctxFns {\n      ctx = f(ctx)\n   }\n\n   return ctx\n} \n\ntype partialContextFn func(context.Context) context.Context\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1160, "user_id": 7899563, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/lKehv.jpg?s=128&g=1", "display_name": "martinomburajr", "link": "https://stackoverflow.com/users/7899563/martinomburajr"}, "edited": false, "score": 0, "creation_date": 1617272272, "post_id": 64473238, "comment_id": 118260793, "body": "This was simple, concise and worked perfectly!"}], "tags": [], "owner": {"reputation": 95, "user_id": 816349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adc31271426060a78bd4e8e5b1df68c7?s=128&d=identicon&r=PG", "display_name": "Munir Hossain", "link": "https://stackoverflow.com/users/816349/munir-hossain"}, "is_accepted": false, "score": 2, "last_activity_date": 1603323931, "creation_date": 1603323931, "answer_id": 64473238, "question_id": 40379960, "link": "https://stackoverflow.com/questions/40379960/golang-context-withvalue-how-to-add-several-key-value-pairs/64473238#64473238", "title": "Golang context.WithValue: how to add several key-value pairs", "body": "<p>To create a golang <code>context</code> with multiple key-values you can call <code>WithValue</code> method multiple times. <code>context.WithValue(basecontext, key, value)</code></p>\n<pre><code>    ctx := context.WithValue(context.Background(), &quot;1&quot;, &quot;one&quot;) // base context\n    ctx = context.WithValue(ctx, &quot;2&quot;, &quot;two&quot;) //derived context\n\n    fmt.Println(ctx.Value(&quot;1&quot;))\n    fmt.Println(ctx.Value(&quot;2&quot;))\n</code></pre>\n<p>See it in action on the <a href=\"https://play.golang.org/p/gXQznfiGYlz\" rel=\"nofollow noreferrer\">playground</a></p>\n"}], "owner": {"reputation": 1790, "user_id": 1370397, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/4cd00d196b2f9bef669ce212eec963b1?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1370397/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35656, "favorite_count": 10, "accepted_answer_id": 40380147, "answer_count": 5, "score": 45, "last_activity_date": 1603323931, "creation_date": 1478089681, "last_edit_date": 1549658660, "question_id": 40379960, "link": "https://stackoverflow.com/questions/40379960/golang-context-withvalue-how-to-add-several-key-value-pairs", "title": "Golang context.WithValue: how to add several key-value pairs", "body": "<p>With Go's <code>context</code> package it is possible to pass request-specific data to the stack of request handling functions using</p>\n\n<pre><code>func WithValue(parent Context, key, val interface{}) Context\n</code></pre>\n\n<p>This creates a new <code>Context</code> which is a copy of parent and contains the value val which can be accessed with key.</p>\n\n<p>How do I proceed if I want to store several key-value pairs in a <code>Context</code>? Shall I call <code>WithValue()</code> several times, each time passing the <code>Context</code> received from my last call to <code>WithValue()</code>? This appears cumbersome.<br>\nOr shall I use a struct and put all my data there, s.t. I need to pass only one value (which is the struct), from which all others can be accessed?</p>\n\n<p>Or is there a way of passing several key-value pairs to <code>WithValue()</code>?</p>\n"}, {"tags": ["postgresql", "go", "sqlx"], "comments": [{"owner": {"reputation": 1410, "user_id": 1662069, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/076911833bf08bdd287142c5e26b833c?s=128&d=identicon&r=PG", "display_name": "Zangetsu", "link": "https://stackoverflow.com/users/1662069/zangetsu"}, "edited": false, "score": 0, "creation_date": 1507570919, "post_id": 40379276, "comment_id": 80253169, "body": "Getting <code>pq: syntax error at or near &quot;STDIN&quot;</code> for <code>tx.Preparex(pq.CopyIn(...))</code>"}, {"owner": {"reputation": 1958, "user_id": 830641, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/a70b7.jpg?s=128&g=1", "display_name": "James Hurford", "link": "https://stackoverflow.com/users/830641/james-hurford"}, "reply_to_user": {"reputation": 1410, "user_id": 1662069, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/076911833bf08bdd287142c5e26b833c?s=128&d=identicon&r=PG", "display_name": "Zangetsu", "link": "https://stackoverflow.com/users/1662069/zangetsu"}, "edited": false, "score": 0, "creation_date": 1507833555, "post_id": 40379276, "comment_id": 80379707, "body": "That doesn&#39;t mean that much to me. Maybe there&#39;s a copy error in the copied code. It&#39;s been almost a year since I asked this."}], "answers": [{"tags": [], "owner": {"reputation": 396, "user_id": 4641689, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5d41b3f3cc75d119e8b0b5cbd79da65?s=128&d=identicon&r=PG&f=1", "display_name": "Tranvu Xuannhat", "link": "https://stackoverflow.com/users/4641689/tranvu-xuannhat"}, "is_accepted": true, "score": 2, "last_activity_date": 1478108957, "creation_date": 1478108957, "answer_id": 40386521, "question_id": 40379276, "link": "https://stackoverflow.com/questions/40379276/why-is-this-copyin-statement-for-sqlx-hanging/40386521#40386521", "title": "Why is this copyin statement for sqlx hanging?", "body": "<p>From Bulk imports part in <a href=\"https://godoc.org/github.com/lib/pq\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/lib/pq</a>, it should be</p>\n\n<pre><code>stmt.Exec(contact.First_name, contact.Last_name, contact.Email)\n</code></pre>\n"}], "owner": {"reputation": 1958, "user_id": 830641, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/a70b7.jpg?s=128&g=1", "display_name": "James Hurford", "link": "https://stackoverflow.com/users/830641/james-hurford"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1428, "favorite_count": 0, "accepted_answer_id": 40386521, "answer_count": 1, "score": 2, "last_activity_date": 1478111760, "creation_date": 1478087459, "last_edit_date": 1478111760, "question_id": 40379276, "link": "https://stackoverflow.com/questions/40379276/why-is-this-copyin-statement-for-sqlx-hanging", "title": "Why is this copyin statement for sqlx hanging?", "body": "<p>I've written a toy app to experiment with using Postgresql through sqlx.  I got a mass insert working using</p>\n\n<pre><code>pq.CopyIn\n</code></pre>\n\n<p>as content of a prepared statement</p>\n\n<pre><code>stmt, _ := tx.Preparex(pq.CopyIn(tablename, column, column, ...)\n</code></pre>\n\n<p>I would then proceed to add rows to the mass insert I'm creating.</p>\n\n<pre><code>tx.Exec(..., ..., ...)\n</code></pre>\n\n<p>then finally execute the prepared statement</p>\n\n<pre><code>stmt.Exec()\n</code></pre>\n\n<p>This worked perfectly before, but now I've come back to it and try and execute this code, it hangs on the</p>\n\n<pre><code>stmt.Exec\n</code></pre>\n\n<p>Am I missing something in my code or is this all to do with the Database Engine, being unresponsive.</p>\n\n<p>Here's my full code for this.</p>\n\n<pre><code>package main\n\nimport (\n    _ \"database/sql\"\n    \"fmt\"\n    \"log\"\n    \"encoding/json\"\n    \"io/ioutil\"\n    \"os\"\n\n    \"github.com/jmoiron/sqlx\"\n    \"github.com/lib/pq\"\n)\n\nvar schema = `\n    CREATE TABLE IF NOT EXISTS contact (\n        id Serial,\n        first_name text,\n        last_name text,\n        email text\n);`\n\ntype Contact struct {\n    Id int            `json:\"-\"`\n    First_name string `json:\"first_name\"`\n    Last_name string  `json:\"last_name\"`\n    Email string      `json:\"email\"`\n}\n\ntype Contacts struct {\n    Contacts []Contact `json:\"contacts\"`\n}\n\nfunc (c *Contacts) createFromJSON(json_str []byte) error {\n    b := []byte(json_str)\n    err := json.Unmarshal(b, &amp;c)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    return err\n}\n\nfunc (c *Contacts) save(db *sqlx.DB) error {\n    tx := db.MustBegin()\n\n    stmt, _ := tx.Preparex(pq.CopyIn(\"contact\", \"first_name\", \"last_name\", \"email\"))\n\n    for _, contact := range c.Contacts {\n        tx.Exec(contact.First_name, contact.Last_name, contact.Email)\n\n    }\n\n    _, err := stmt.Exec()\n\n    if err != nil {\n        log.Fatal(err)\n        return err\n    }\n    err = stmt.Close()\n    if err != nil {\n        log.Fatal(err)\n        return err\n    }\n\n    tx.Commit()\n\n    return nil\n}\n\nfunc connect() (*sqlx.DB, error) {\n    db, err := sqlx.Connect(\"postgres\", \"user=pqgotest dbname=pqgotest sslmode=disable\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    return db, err\n}\n\n\nfunc createTables(db *sqlx.DB) {\n    db.MustExec(schema)\n}\n\n\nfunc main() {\n    db, err := connect()\n    if err != nil {\n        os.Exit(1)\n    }\n\n    createTables(db)\n    contactsJson, e := ioutil.ReadFile(\"./contacts.json\")\n    if e != nil {\n        fmt.Printf(\"File error: %v\\n\", e)\n        os.Exit(1)\n    }\n\n    tx := db.MustBegin()\n    tx.MustExec(\"DELETE FROM contact\")\n    tx.Commit()\n\n    contacts := new(Contacts)\n\n    contacts.createFromJSON(contactsJson)\n\n    contacts.save(db)\n\n    people := new(Contacts)\n    db.Select(people.Contacts, \"SELECT * FROM contact ORDER BY email,id ASC\")\n\n    for _, contact := range people.Contacts {\n        contact_json, err := json.Marshal(contact)\n        if err != nil {\n            log.Fatal(err)\n            os.Exit(1)\n        }\n        fmt.Printf(\"%s\\n\", contact_json)\n    }\n\n\n}\n</code></pre>\n\n<p>I could include the contents of the contacts.json file as well, if that will help.</p>\n\n<p>UPDATE</p>\n\n<p>Yes it was obvious in the end.  I was creating a statement from tx,</p>\n\n<pre><code>stmt, _ := tx.Preparex(pq.CopyIn(tablename, column, column, ...)\n</code></pre>\n\n<p>and further additions to this should be to stmt</p>\n\n<pre><code>stmt.Exec(..., ..., ...)\n</code></pre>\n\n<p>Also another error not directly related to the question is where I insert an array of contacts into the Contacts field of the struct Contacts</p>\n\n<pre><code>people := new(Contacts)\ndb.Select(people.Contacts, \"SELECT * FROM contact ORDER BY email,id ASC\")\n</code></pre>\n\n<p>should be passing a pointer to the Select method of db of the Contacts array field of Contacts, like so</p>\n\n<pre><code>db.Select(&amp;people.Contacts, \"SELECT * FROM contact ORDER BY email,id ASC\")\n</code></pre>\n\n<p>In case people try and run this code later and wonder why it's not printing the results to the console.</p>\n"}, {"tags": ["database", "unit-testing", "go", "mocking"], "answers": [{"tags": [], "owner": {"reputation": 909, "user_id": 982292, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b32f2c666484b123b12a6b8197f7369a?s=128&d=identicon&r=PG", "display_name": "luistm", "link": "https://stackoverflow.com/users/982292/luistm"}, "is_accepted": true, "score": 2, "last_activity_date": 1478181598, "last_edit_date": 1478181598, "creation_date": 1478089662, "answer_id": 40379958, "question_id": 40379147, "link": "https://stackoverflow.com/questions/40379147/golang-test-call-to-database-prepare-should-fail-but-it-does-not/40379958#40379958", "title": "Golang test, call to database Prepare should fail, but it does not", "body": "<p>Answering my own question,</p>\n\n<p>Calling ExpectPrepare() returns a ExpectPrepare struct. In order to assert that Prepare() is being called with the right query, on must use ExpectQuery on the struct. \nSee the example bellow. </p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n)\n\nfunc testFunction(db *sql.DB) {\n    stmt, err := db.Prepare(\"SELECT\")\n    if err != nil {\n        fmt.Println(err)\n}\n\n    stmt.Query()\n\n}\n\nfunc main() {}\n\npackage main\n\nimport (\n    \"testing\"\n\n    \"github.com/stretchr/testify/assert\"\n    sqlmock \"gopkg.in/DATA-DOG/go-sqlmock.v1\"\n)\n\nfunc TestPrepare(t *testing.T) {\n    db, mock, mErr := sqlmock.New()\n    assert.NoError(t, mErr)\n    defer db.Close()\n\n    mock.ExpectPrepare(\"^SELECT$\").ExpectQuery()\n\n   testFunction(db)\n\n    if err := mock.ExpectationsWereMet(); err != nil {\n        t.Errorf(\"there were unfulfilled expections: %s\", err)\n    }\n\n}\n</code></pre>\n\n<p>EDIT:</p>\n\n<p>After reporting an issue, it turns out this was actually a BUG in the go-sqlmock package. It's fixed. We should now be able to use ExpectPrepare().\n<a href=\"https://github.com/DATA-DOG/go-sqlmock/issues/50\" rel=\"nofollow noreferrer\">go-sqlmock issue #50</a> </p>\n\n<p>Thanks</p>\n"}], "owner": {"reputation": 909, "user_id": 982292, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/b32f2c666484b123b12a6b8197f7369a?s=128&d=identicon&r=PG", "display_name": "luistm", "link": "https://stackoverflow.com/users/982292/luistm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1310, "favorite_count": 0, "accepted_answer_id": 40379958, "answer_count": 1, "score": 0, "last_activity_date": 1478181598, "creation_date": 1478087051, "last_edit_date": 1478087407, "question_id": 40379147, "link": "https://stackoverflow.com/questions/40379147/golang-test-call-to-database-prepare-should-fail-but-it-does-not", "title": "Golang test, call to database Prepare should fail, but it does not", "body": "<p>I'm writing some test code with the help of go sqlmock.</p>\n\n<p>The following code does not validates if the prepared statement has the correct query.</p>\n\n<p>The main code is this:</p>\n\n<pre><code>// main.go\npackage main\n\nimport \"database/sql\"\n\nfunc testFunction(db *sql.DB) {\n    db.Prepare(\"SELECT\")\n}\n\nfunc main() {}\n</code></pre>\n\n<p>And the test code:</p>\n\n<pre><code>// main_test.go\npackage main\n\nimport (\n    \"testing\"\n\n    \"github.com/stretchr/testify/assert\"\n    sqlmock \"gopkg.in/DATA-DOG/go-sqlmock.v1\"\n)\n\nfunc TestPrepare(t *testing.T) {\n    db, mock, mErr := sqlmock.New()\n    assert.NoError(t, mErr)\n    defer db.Close()\n\n    mock.ExpectPrepare(\"^BADSELECT$\")\n\n    testFunction(db)\n\n    if err := mock.ExpectationsWereMet(); err != nil {\n        t.Errorf(\"there were unfulfilled expections: %s\", err)\n    }\n\n}\n</code></pre>\n\n<p>As far as i know, the test <strong>should fail,</strong> but it does't. What i'm i doing wrong? \nI'm using GO 1.7/macOS 10.12.1. </p>\n\n<p>Thanks </p>\n"}, {"tags": ["go", "cmd", "windows-7", "influxdb", "nosql"], "comments": [{"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 0, "creation_date": 1478086344, "post_id": 40377378, "comment_id": 68009638, "body": "Have you installed <code>gdm</code>. What happens if you execute <code>gdm restore</code>?"}, {"owner": {"reputation": 21, "user_id": 7103749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tBzIJ.jpg?s=128&g=1", "display_name": "Rico227", "link": "https://stackoverflow.com/users/7103749/rico227"}, "reply_to_user": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 0, "creation_date": 1478088279, "post_id": 40377378, "comment_id": 68010852, "body": "I think not. Because it says the <code>gdm</code> command is unknown. But i do not know another way to install it then the using <code>go get</code> and <code>go install</code>. @TheHippo"}, {"owner": {"reputation": 54647, "user_id": 45786, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a7207f83a52e35e43e886c49f6a893a2?s=128&d=identicon&r=PG", "display_name": "TheHippo", "link": "https://stackoverflow.com/users/45786/thehippo"}, "edited": false, "score": 0, "creation_date": 1478088507, "post_id": 40377378, "comment_id": 68010996, "body": "You probably need to add <code>$GOPATH&#47;bin</code> to your <code>$PATH</code> (or whatever this is called on Windows.)"}, {"owner": {"reputation": 4044, "user_id": 2322488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/924e749f5c463f19625e51dad78a6b78?s=128&d=identicon&r=PG", "display_name": "Michael Desa", "link": "https://stackoverflow.com/users/2322488/michael-desa"}, "edited": false, "score": 0, "creation_date": 1478541253, "post_id": 40377378, "comment_id": 68187352, "body": "@Rico227 have you tried steps in the <a href=\"https://github.com/influxdata/influxdb/blob/master/CONTRIBUTING.md\" rel=\"nofollow noreferrer\">InfluxDB contributing guide</a>? Also is there any reason that you need to build from source?"}, {"owner": {"reputation": 21, "user_id": 7103749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tBzIJ.jpg?s=128&g=1", "display_name": "Rico227", "link": "https://stackoverflow.com/users/7103749/rico227"}, "reply_to_user": {"reputation": 4044, "user_id": 2322488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/924e749f5c463f19625e51dad78a6b78?s=128&d=identicon&r=PG", "display_name": "Michael Desa", "link": "https://stackoverflow.com/users/2322488/michael-desa"}, "edited": false, "score": 0, "creation_date": 1478595443, "post_id": 40377378, "comment_id": 68209164, "body": "@MichaelDesa no i didn&#39;t try these steps. I will try them if i have time this week. I&#39;m currently using the already compiled version wich works fine for me."}], "owner": {"reputation": 21, "user_id": 7103749, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tBzIJ.jpg?s=128&g=1", "display_name": "Rico227", "link": "https://stackoverflow.com/users/7103749/rico227"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 105, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1502334504, "creation_date": 1478081809, "last_edit_date": 1506103282, "question_id": 40377378, "link": "https://stackoverflow.com/questions/40377378/compiling-influxdb-on-windows-go-error-62-not-enough-arguments-in-call-to-c", "title": "Compiling InfluxDB on Windows // Go Error :62: not enough arguments in call to conn.write", "body": "<p>I'm trying to install the <strong>V1.0.2</strong> of <strong>InfluxDB</strong> on Windows. </p>\n\n<p>I'm using the following tutorial: <a href=\"https://www.youtube.com/watch?v=34oOp1OLOUk\" rel=\"nofollow noreferrer\">https://www.youtube.com/watch?v=34oOp1OLOUk</a></p>\n\n<p>If i want to use <code>go get -u -f ./...</code> i get the error:</p>\n\n<blockquote>\n  <p>github.com/influxdata/influxdb/services/collectd/test_client\n  services\\collectd\\test_client\\client.go:62: not enough arguments in call to conn.Write</p>\n</blockquote>\n\n<p>I have found this answer to the problem: <a href=\"https://github.com/influxdata/influxdb/issues/7251\" rel=\"nofollow noreferrer\">https://github.com/influxdata/influxdb/issues/7251</a> and tried to install the 'gdm', but i get error :62: at the <code>go get ./...</code> command again.</p>\n\n<p>I'm working with a <strong>VM</strong> using <strong>Win 7 Professional SP1</strong> and <strong>Go 1.7.3</strong></p>\n"}, {"tags": ["heroku", "go"], "answers": [{"comments": [{"owner": {"reputation": 905, "user_id": 2323245, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/692ba01c39a0306d91a706c1273ca840?s=128&d=identicon&r=PG", "display_name": "sbouaked", "link": "https://stackoverflow.com/users/2323245/sbouaked"}, "edited": false, "score": 0, "creation_date": 1478251700, "post_id": 40413641, "comment_id": 68087111, "body": "Yep, I realise that, I didn&#39;t know glide at this moment so I switch to govendor, but I will take a look."}], "tags": [], "owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "is_accepted": true, "score": 2, "last_activity_date": 1478221023, "last_edit_date": 1478221023, "creation_date": 1478220591, "answer_id": 40413641, "question_id": 40376830, "link": "https://stackoverflow.com/questions/40376830/unable-to-deploy-go-app-with-godeps-dependencies-on-heroku/40413641#40413641", "title": "Unable to deploy go app with Godeps dependencies on Heroku", "body": "<p>If you look at the heroku buildpack for Go (<a href=\"https://github.com/heroku/heroku-buildpack-go/blob/master/bin/compile\" rel=\"nofollow noreferrer\">https://github.com/heroku/heroku-buildpack-go/blob/master/bin/compile</a>), it does not currently support GoDeps, as traditional GoDeps style dependency management has been deprecated as Go v1.6.  You can convert your GoDeps dependencies to a vendored dependency and that should fix that.</p>\n\n<p>I personally recommend using glide: <a href=\"https://github.com/Masterminds/glide\" rel=\"nofollow noreferrer\">https://github.com/Masterminds/glide</a></p>\n\n<p>But you can also use:</p>\n\n<p><a href=\"https://github.com/kardianos/govendor\" rel=\"nofollow noreferrer\">https://github.com/kardianos/govendor</a></p>\n\n<p>or</p>\n\n<p><a href=\"https://github.com/constabulary/gb\" rel=\"nofollow noreferrer\">https://github.com/constabulary/gb</a></p>\n\n<p>As those are supported in the compile script for the buildpack.</p>\n\n<p>Each of those support an automated conversion of GoDeps to their formats.</p>\n\n<p>If you have <code>./vendor/vendor.json</code> Heroku will automatically use govendor, unless you configure Heroku to use something otherwise.</p>\n\n<p>This page may help as well <a href=\"https://elements.heroku.com/buildpacks/heroku/heroku-buildpack-go\" rel=\"nofollow noreferrer\">https://elements.heroku.com/buildpacks/heroku/heroku-buildpack-go</a></p>\n\n<p>It does support Godep, technically, but it would seem you have to either use an older version of Go or move GoDeps to vendor.</p>\n"}], "owner": {"reputation": 905, "user_id": 2323245, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/692ba01c39a0306d91a706c1273ca840?s=128&d=identicon&r=PG", "display_name": "sbouaked", "link": "https://stackoverflow.com/users/2323245/sbouaked"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 563, "favorite_count": 0, "accepted_answer_id": 40413641, "answer_count": 1, "score": 2, "last_activity_date": 1478221023, "creation_date": 1478080174, "last_edit_date": 1495541210, "question_id": 40376830, "link": "https://stackoverflow.com/questions/40376830/unable-to-deploy-go-app-with-godeps-dependencies-on-heroku", "title": "Unable to deploy go app with Godeps dependencies on Heroku", "body": "<p>I have the following error when i'm trying to push my project on heroku</p>\n\n<pre><code>git push heroku master\nCounting objects: 88, done.\nDelta compression using up to 4 threads.\nCompressing objects: 100% (86/86), done.\nWriting objects: 100% (88/88), 18.85 MiB | 686.00 KiB/s, done.\nTotal 88 (delta 13), reused 0 (delta 0)\nremote: Compressing source files... done.\nremote: Building source:\nremote:\nremote: -----&gt; Go app detected\nremote: -----&gt; Checking Godeps/Godeps.json file.\nremote: -----&gt; Using go1.7.3\nremote: -----&gt; Running: go install -v -tags heroku ./...\nremote: main.go:8:2: cannot find package \"github.com/Sirupsen/logrus\" in any of:\nremote:         /app/tmp/cache/go1.7.3/go/src/github.com/Sirupsen/logrus (from $GOROOT)\nremote:         /tmp/tmp.Ffkjp5c5US/.go/src/github.com/Sirupsen/logrus (from $GOPATH)\nremote: main.go:6:2: cannot find package \"github.com/gin-gonic/gin\" in any of:\nremote:         /app/tmp/cache/go1.7.3/go/src/github.com/gin-gonic/gin (from $GOROOT)\nremote:         /tmp/tmp.Ffkjp5c5US/.go/src/github.com/gin-gonic/gin (from $GOPATH)\nremote:  !     Push rejected, failed to compile Go app.\nremote:\nremote:  !     Push failed\nremote: Verifying deploy...\nremote:\nremote: !       Push rejected to eerie-wizard-18479.\nremote:\nTo https://git.heroku.com/eerie-wizard-18479.git\n ! [remote rejected] master -&gt; master (pre-receive hook declined)\nerror: failed to push some refs to 'https://git.heroku.com/eerie-wizard-18479.git'\n</code></pre>\n\n<p>I carefully made a godep save ./... before commiting and pushing on heroku, this is my Godeps.json file: (logrus and gin are present in this file)</p>\n\n<pre><code>{\n    \"ImportPath\": \"github.com/sbouaked/neo-fundations\",\n    \"GoVersion\": \"go1.7\",\n    \"GodepVersion\": \"v74\",\n    \"Packages\": [\n        \"./...\"\n    ],\n    \"Deps\": [\n        {\n            \"ImportPath\": \"github.com/Sirupsen/logrus\",\n            \"Comment\": \"v0.10.0-38-g3ec0642\",\n            \"Rev\": \"3ec0642a7fb6488f65b06f9040adc67e3990296a\"\n        },\n        {\n            \"ImportPath\": \"github.com/gin-gonic/gin\",\n            \"Comment\": \"v1.0-2-g3900df0\",\n            \"Rev\": \"3900df04d2a88e22beaf6a2970c63648b9e1b0e1\"\n        },\n        {\n            \"ImportPath\": \"github.com/gin-gonic/gin/binding\",\n            \"Comment\": \"v1.0-2-g3900df0\",\n            \"Rev\": \"3900df04d2a88e22beaf6a2970c63648b9e1b0e1\"\n        },\n        {\n            \"ImportPath\": \"github.com/gin-gonic/gin/render\",\n            \"Comment\": \"v1.0-2-g3900df0\",\n            \"Rev\": \"3900df04d2a88e22beaf6a2970c63648b9e1b0e1\"\n        },\n        {\n            \"ImportPath\": \"github.com/golang/protobuf/proto\",\n            \"Rev\": \"98fa357170587e470c5f27d3c3ea0947b71eb455\"\n        },\n        {\n            \"ImportPath\": \"github.com/manucorporat/sse\",\n            \"Rev\": \"ee05b128a739a0fb76c7ebd3ae4810c1de808d6d\"\n        },\n        {\n            \"ImportPath\": \"golang.org/x/net/context\",\n            \"Rev\": \"4bb47a1098b37d69980d96237e2ae4ff56bb5a95\"\n        },\n        {\n            \"ImportPath\": \"golang.org/x/sys/unix\",\n            \"Rev\": \"c200b10b5d5e122be351b67af224adc6128af5bf\"\n        },\n        {\n            \"ImportPath\": \"gopkg.in/go-playground/validator.v8\",\n            \"Comment\": \"v8.18.1\",\n            \"Rev\": \"5f57d2222ad794d0dffb07e664ea05e2ee07d60c\"\n        },\n        {\n            \"ImportPath\": \"gopkg.in/yaml.v2\",\n            \"Rev\": \"a5b47d31c556af34a302ce5d659e6fea44d90de0\"\n        }\n    ]\n}\n</code></pre>\n\n<p>I saw on <a href=\"https://stackoverflow.com/questions/38933957/dependencies-for-go-app-arent-installed-through-godep-on-heroku\">this post</a> that I have to commit <code>vendor/</code>, but I didn't want to. There is really any solutions for this now ? </p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-dynamodb", "aws-sdk", "aws-sdk-go"], "answers": [{"tags": [], "owner": {"reputation": 29341, "user_id": 6337748, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/7Si7m.jpg?s=128&g=1", "display_name": "notionquest", "link": "https://stackoverflow.com/users/6337748/notionquest"}, "is_accepted": true, "score": 4, "last_activity_date": 1478094344, "creation_date": 1478094344, "answer_id": 40381537, "question_id": 40376242, "link": "https://stackoverflow.com/questions/40376242/how-to-use-between-in-aws-sdk-go-dynamodb-queryinput/40381537#40381537", "title": "How to use &quot;BETWEEN&quot; in aws-sdk-go Dynamodb QueryInput?", "body": "<p>The <code>time</code> value should be given as mentioned below:-</p>\n\n<pre><code>\"time\": {\n            ComparisonOperator: aws.String(\"BETWEEN\"),\n            AttributeValueList: []*dynamodb.AttributeValue{\n                {\n                    N: aws.String(\"10\"),                        \n                },\n                {\n                    N: aws.String(\"20\"),                        \n                },\n            },\n        },\n</code></pre>\n"}], "owner": {"reputation": 1570, "user_id": 5850449, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/7bVFD.jpg?s=128&g=1", "display_name": "Arjun Ajith", "link": "https://stackoverflow.com/users/5850449/arjun-ajith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 841, "favorite_count": 0, "accepted_answer_id": 40381537, "answer_count": 1, "score": 2, "last_activity_date": 1489201180, "creation_date": 1478078341, "last_edit_date": 1489201180, "question_id": 40376242, "link": "https://stackoverflow.com/questions/40376242/how-to-use-between-in-aws-sdk-go-dynamodb-queryinput", "title": "How to use &quot;BETWEEN&quot; in aws-sdk-go Dynamodb QueryInput?", "body": "<p>I am using aws-sdk-go for dynamodb. I need to collect some items from my DB. The filtering conditions are <strong>deviceid: xyz, time >= 10</strong> and <strong>time &lt;= 20.</strong></p>\n\n<p><strong>time</strong> is the sort key for my db and <strong>deviceid</strong> is the primary key. I understand I have to use <strong>BETWEEN</strong> for achieving  my goal. My Implementations are not successful and as follows:</p>\n\n<pre><code>var queryInput = &amp;dynamodb.QueryInput{\n    TableName: aws.String(dbName),\n    KeyConditions: map[string]*dynamodb.Condition{\n        \"deviceid\": {\n            ComparisonOperator: aws.String(\"EQ\"),\n            AttributeValueList: []*dynamodb.AttributeValue{\n                {\n                    S: aws.String(\"xyz\"),\n                },\n            },\n        },\n        \"time\": {\n            ComparisonOperator: aws.String(\"BETWEEN\"),\n            AttributeValueList: []*dynamodb.AttributeValue{\n                {\n                    N: aws.String(\"10\"),\n                    N: aws.String(\"20\"),\n                },\n            },\n\n        },\n    },\n}\n</code></pre>\n\n<p>What are the mistakes I made here?</p>\n"}, {"tags": ["go", "path", "sudo"], "comments": [{"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 2, "creation_date": 1478073145, "post_id": 40374434, "comment_id": 68002307, "body": "Your issue is not connected with go lang"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 8, "last_activity_date": 1478073812, "creation_date": 1478073812, "answer_id": 40374998, "question_id": 40374434, "link": "https://stackoverflow.com/questions/40374434/about-sudo-go-run-main-go/40374998#40374998", "title": "About &quot;sudo go run main.go&quot;", "body": "<p>Your environment variables are not set for your root user. Don't try to run <code>sudo go run ...</code>, instead build the binary without sudo, e.g. <code>go build</code> or <code>go install</code>, and then execute the binary with <code>sudo</code>.</p>\n\n<p>Let's say you're in the folder of <code>main.go</code>, assumed it's called <code>mycapt</code>:</p>\n\n<pre><code>go build\nsudo ./mycapt\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>go install\nsudo $GOPATH/bin/mycapt\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1249, "user_id": 4385714, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/TMykz.jpg?s=128&g=1", "display_name": "qtopierw", "link": "https://stackoverflow.com/users/4385714/qtopierw"}, "is_accepted": false, "score": 5, "last_activity_date": 1543827295, "last_edit_date": 1543827295, "creation_date": 1478349451, "answer_id": 40438345, "question_id": 40374434, "link": "https://stackoverflow.com/questions/40374434/about-sudo-go-run-main-go/40438345#40438345", "title": "About &quot;sudo go run main.go&quot;", "body": "<p><code>sudo -E go run main.go</code> may work for you.</p>\n\n<p>Here is what you can get about <code>-E</code> option from <code>man sudo</code></p>\n\n<pre><code>-E, --preserve-env\n   Indicates to the security policy that the user wishes to preserve\n   their existing environment variables. The security policy may return\n   an error if the user does not have permission to preserve the environment.\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 2746703, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94e4505cbe12db8d884a4d5955b85131?s=128&d=identicon&r=PG&f=1", "display_name": "Mr.ChenZ", "link": "https://stackoverflow.com/users/2746703/mr-chenz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6846, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1543827295, "creation_date": 1478071497, "last_edit_date": 1478078519, "question_id": 40374434, "link": "https://stackoverflow.com/questions/40374434/about-sudo-go-run-main-go", "title": "About &quot;sudo go run main.go&quot;", "body": "<p>I use Go in my Ubuntu 16.04, and I set <code>GOPATH</code>, <code>GOROOT</code> and run simple code successfully.</p>\n\n<p>Now I want to capture network packet by \"gopacket\", but it needs sudo /root permission. I excute command: <code>sudo go run main.go</code>, it echo error:</p>\n\n<blockquote>\n  <p>\"exec: go: excutable file not found in $PATH\"</p>\n</blockquote>\n\n<p>I googled it and I edit file <code>/etc/sudoders</code> and change line <code>\"Defaults env_reset\"</code> to <code>\"Defaults !env_reset\"</code>, but it not work...</p>\n\n<p>Can you help me?</p>\n"}, {"tags": ["go", "docker"], "comments": [{"owner": {"reputation": 17055, "user_id": 164966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c72f100bc09518cd468b9fe146f1f22?s=128&d=identicon&r=PG", "display_name": "R0MANARMY", "link": "https://stackoverflow.com/users/164966/r0manarmy"}, "edited": false, "score": 0, "creation_date": 1478069395, "post_id": 40372453, "comment_id": 68000758, "body": "Looks like you are adding the Makefile but not the <code>customer-server</code> directory to the image. Does that come from somewhere else?"}, {"owner": {"reputation": 3847, "user_id": 251840, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e3bf4bcc6dfbe7c13231f914334db925?s=128&d=identicon&r=PG", "display_name": "jwesonga", "link": "https://stackoverflow.com/users/251840/jwesonga"}, "reply_to_user": {"reputation": 17055, "user_id": 164966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c72f100bc09518cd468b9fe146f1f22?s=128&d=identicon&r=PG", "display_name": "R0MANARMY", "link": "https://stackoverflow.com/users/164966/r0manarmy"}, "edited": false, "score": 0, "creation_date": 1478074567, "post_id": 40372453, "comment_id": 68002899, "body": "customer-server is a directory containing my go code"}, {"owner": {"reputation": 17055, "user_id": 164966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5c72f100bc09518cd468b9fe146f1f22?s=128&d=identicon&r=PG", "display_name": "R0MANARMY", "link": "https://stackoverflow.com/users/164966/r0manarmy"}, "edited": false, "score": 0, "creation_date": 1478093653, "post_id": 40372453, "comment_id": 68014348, "body": "I understand that, what I&#39;m saying is it doesn&#39;t look like you&#39;re copying it into the container or mounting it as a volume. Your code is never in the same place as the Makefile. That&#39;s what the error message is saying, there&#39;s nothing to compile inside the container."}, {"owner": {"reputation": 680, "user_id": 3677188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d17944f3cb838dc1b4430a584a904d17?s=128&d=identicon&r=PG&f=1", "display_name": "tobiash", "link": "https://stackoverflow.com/users/3677188/tobiash"}, "edited": false, "score": 0, "creation_date": 1478169580, "post_id": 40372453, "comment_id": 68048684, "body": "Add a <code>find &#47; -print</code> to your buildgo step to see what&#39;s available in the container. R0MANARMY is correct."}], "owner": {"reputation": 3847, "user_id": 251840, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e3bf4bcc6dfbe7c13231f914334db925?s=128&d=identicon&r=PG", "display_name": "jwesonga", "link": "https://stackoverflow.com/users/251840/jwesonga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 767, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1478074687, "creation_date": 1478060574, "last_edit_date": 1478074687, "question_id": 40372453, "link": "https://stackoverflow.com/questions/40372453/golang-go-build-failing-when-called-as-part-of-makefile", "title": "Golang: go build failing when called as part of makefile", "body": "<p>I have the following make file:</p>\n\n<pre><code>default: builddocker\n\nsetup:\n     go get github.com/golang/protobuf/proto\n     go get github.com/golang/protobuf/protoc-gen-go\n     go get golang.org/x/net/context\n     go get google.golang.org/grpc\n\nbuildgo:\n    CGO_ENABLED=0 GOOS=linux go build -ldflags \"-s\" -a -installsuffix cgo -o main ./customer-server/\n\nbuilddocker:\n                    docker build -t johnwesonga/grpc/customer-server -f ./Dockerfile.build .\n                    docker run -t johnwesonga/grpc/customer-server /bin/true\n                    docker cp `docker ps -q -n=1`:/main .\n                    chmod 755 ./main\n                    docker build --rm=true --tag=johnwesonga/grpc/customer-server -f Dockerfile.static .\n</code></pre>\n\n<p>My Dockerfile.build has:</p>\n\n<pre><code>FROM golang\n\nADD Makefile /\nWORKDIR /\nRUN make setup\n\nRUN make buildgo\nCMD [\"/bin/bash\"]\n</code></pre>\n\n<p>But every time I run \"make builddocker\" I get the following error:</p>\n\n<pre><code>CGO_ENABLED=0 GOOS=linux go build -ldflags \"-s\" -a -installsuffix cgo -o main ./customer-server/\ncan't load package: package ./customer-server: open /customer-server: no such file or directory\nmake: *** [buildgo] Error 1\nMakefile:10: recipe for target 'buildgo' failed\nThe command '/bin/sh -c make buildgo' returned a non-zero code: 2\nmake: *** [builddocker] Error 2\n</code></pre>\n\n<p>But if I run \"Make buildgo\" it works just fine, any idea why this is failing?</p>\n\n<p>FYI my source tree as follows:</p>\n\n<pre><code>/go/src/github.com/johnwesonga/grpc/MakeFile\n/go/src/github.com/johnwesonga/grpc/customer-server\n/go/src/github.com/johnwesonga/grpc/customer-server/main.go\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 1274864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f145822a9a2b409caa844f6848f098dd?s=128&d=identicon&r=PG", "display_name": "Len Smith", "link": "https://stackoverflow.com/users/1274864/len-smith"}, "edited": false, "score": 0, "creation_date": 1478095227, "post_id": 40372260, "comment_id": 68015516, "body": "I update the question. The files in go-icinga2-api do live down one path underneath the dir /iapi"}, {"owner": {"reputation": 43, "user_id": 1274864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f145822a9a2b409caa844f6848f098dd?s=128&d=identicon&r=PG", "display_name": "Len Smith", "link": "https://stackoverflow.com/users/1274864/len-smith"}, "edited": false, "score": 0, "creation_date": 1478117308, "post_id": 40372260, "comment_id": 68029408, "body": "Thank you very much, that was the issue. I created a new function New and called that and it works as I expected it to."}], "tags": [], "owner": {"reputation": 136, "user_id": 7102681, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b6cc241c531ff5ad849b2f718ba7513?s=128&d=identicon&r=PG&f=1", "display_name": "Kale B", "link": "https://stackoverflow.com/users/7102681/kale-b"}, "is_accepted": true, "score": 2, "last_activity_date": 1478116469, "last_edit_date": 1478116469, "creation_date": 1478059045, "answer_id": 40372260, "question_id": 40372146, "link": "https://stackoverflow.com/questions/40372146/golang-custom-package-and-undefined/40372260#40372260", "title": "golang : Custom package and &#39;undefined&#39;", "body": "<p><strong>Updated Answer</strong></p>\n\n<p>In <code>client.go</code>, it looks like you're trying to use <code>Config</code> as a constructor for <code>Server</code> structs. Since <code>Config</code> is defined with a receiver (<code>func (server *Server)</code>), it's a method of <code>Server</code> and can't be called directly. You're code should work if you remove <code>(server *Server)</code>.</p>\n\n<p>It's idiomatic to name constructors <code>New[type being returned]</code>, or <code>New</code> if the type is the same name as the package. </p>\n\n<p>From the 3rd paragraph of the <a href=\"https://golang.org/doc/effective_go.html#package-names\" rel=\"nofollow noreferrer\">Package Names section of Idiomatic Go</a>:</p>\n\n<blockquote>\n  <p>the function to make new instances of ring.Ring\u2014which is the definition of a constructor in Go\u2014would normally be called NewRing, but since Ring is the only type exported by the package, and since the package is called ring, it's called just New, which clients of the package see as ring.New</p>\n</blockquote>\n\n<p><strong>Original Answer</strong></p>\n\n<p>The import path should reference a directory. In your code, you then reference that package by whatever name is used in the <code>package [name]</code> in the .go files in that directory.</p>\n\n<p>For example, if <code>github.com/lrsmith/go-icinga2-api</code> contains a file called <code>api.go</code> with the line <code>package iapi</code>, your importing package should look like this:</p>\n\n<pre><code>package main\nimport (\n   \"github.com/lrsmith/go-icinga2-api\"\n)\nfunc main () {\n   t := iapi.Config(\"zaphod\",\"beeblebrox\",\"http://localhost\",true)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 43, "user_id": 1274864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f145822a9a2b409caa844f6848f098dd?s=128&d=identicon&r=PG", "display_name": "Len Smith", "link": "https://stackoverflow.com/users/1274864/len-smith"}, "edited": false, "score": 0, "creation_date": 1478094887, "post_id": 40375045, "comment_id": 68015259, "body": "I modified zaphod.go to declare the variable first but I get the same error <code>package main import (    &quot;github.com&#47;lrsmith&#47;go-icinga2-api&#47;iapi&quot; ) func main () {   var server iapi.Server   server, _ = iapi.Config(&quot;zaphod&quot;,&quot;beeblebrox&quot;,&quot;http:&#47;&#47;localhost&quot;,true) } </code> <code>$ go build # github.com&#47;lrsmith&#47;zaphod .&#47;zaphod.go:7: undefined: iapi.Config</code>"}, {"owner": {"reputation": 43, "user_id": 1274864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f145822a9a2b409caa844f6848f098dd?s=128&d=identicon&r=PG", "display_name": "Len Smith", "link": "https://stackoverflow.com/users/1274864/len-smith"}, "edited": false, "score": 0, "creation_date": 1478138977, "post_id": 40375045, "comment_id": 68036895, "body": "I&#39;m not sure why declaring it first did not work. instead adjust the config to not be a method of the struct seemed to do the work. But I would have expected declaring it then calling the method to have worked."}], "tags": [], "owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "is_accepted": false, "score": 1, "last_activity_date": 1478073985, "creation_date": 1478073985, "answer_id": 40375045, "question_id": 40372146, "link": "https://stackoverflow.com/questions/40372146/golang-custom-package-and-undefined/40375045#40375045", "title": "golang : Custom package and &#39;undefined&#39;", "body": "<p>Note the declaration of the Config() function:</p>\n\n<pre><code>func (server *Server) Config(username, password, url string, allowUnverifiedSSL bool) (*Server, error)\n</code></pre>\n\n<p>It's a \"method\" that should be applied to a Server object:</p>\n\n<pre><code>server.Config(...)\n</code></pre>\n\n<p>Thus you need to first create a Server object (or you could try with nil):</p>\n\n<pre><code>var server iapi.Server\nserver, err := server.Config(...)\n</code></pre>\n\n<p>You're trying to run it as if it had the following declaration:</p>\n\n<pre><code>func Config(username, password, url string, allowUnverifiedSSL bool) (*Server, error)\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 1274864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f145822a9a2b409caa844f6848f098dd?s=128&d=identicon&r=PG", "display_name": "Len Smith", "link": "https://stackoverflow.com/users/1274864/len-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1560, "favorite_count": 0, "accepted_answer_id": 40372260, "answer_count": 2, "score": 1, "last_activity_date": 1478116469, "creation_date": 1478058262, "last_edit_date": 1478059865, "question_id": 40372146, "link": "https://stackoverflow.com/questions/40372146/golang-custom-package-and-undefined", "title": "golang : Custom package and &#39;undefined&#39;", "body": "<p>I've read the doc on creating custom packages, etc but I can't seem to pin down what the problem is.</p>\n\n<pre><code>GOPATH=/Users/lrsmith/GoWorkSpace\n|-&gt;bin\n|-&gt;pkg\n|-&gt;src\n    |-&gt;github.com\n       |-&gt;lrsmith\n          |-&gt; zaphod\n              |-&gt; zaphod.go\n</code></pre>\n\n<p>I've done a 'go get github.com/lrsmith/go-icinga2-api/iapi' and it\ndropped it into the same dir as 'zaphod' and created and .a file under pkg.</p>\n\n<pre><code>GOPATH=/Users/lrsmith/GoWorkSpace\n|-&gt;bin/\n|-&gt;pkg/\n  |-&gt;..../iapi.a\n|-&gt;src/\n    |-&gt;github.com/\n       |-&gt;lrsmith/\n          |-&gt; zaphod/\n              |-&gt; zaphod.go\n          |-&gt; go-icinga2-api/\n</code></pre>\n\n<p>zaphod.go is very simple right now</p>\n\n<pre><code>package main\nimport (\n    \"github.com/lrsmith/go-icinga2-api/iapi\"\n)\nfunc main () {\n  t := iapi.Config(\"zaphod\",\"beeblebrox\",\"http://localhost\",true)\n}\n</code></pre>\n\n<p>When I do a go build in the zaphod directory I get \n     ./zaphod.go:11: undefined: iapi.Config</p>\n\n<p>I've read through the docs, checked cases and tried different structures but I can't seem to get it to load the package and let me call iapi.Config. The iapi code works and if I build something in the go-icinga2-api directory it works fine and the test all pass.</p>\n\n<p>I want to create a separate project/code base that imports the go-icinga2-api and uses it, but can't seem to get it work. </p>\n\n<p>Thanks\nLen</p>\n\n<h1>Added info. The structure for go-icinga2-api is</h1>\n\n<pre><code>go-icinga2-api\n|-&gt; iapi\n     |-&gt; client.go\n     |-&gt; client_test.go\n     |-&gt; host.go\n      .......\n</code></pre>\n\n<p>client.go is</p>\n\n<pre><code>// Package iapi provides a client for interacting with an Icinga2        Server\npackage iapi\n\nimport (\n    \"bytes\"\n    \"crypto/tls\"\n    \"encoding/json\"\n    \"fmt\"\n    \"net/http\"\n)\n\n// Server ... Use to be ClientConfig\ntype Server struct {\n    Username           string\n    Password           string\n    BaseURL                string\n    AllowUnverifiedSSL bool\n    httpClient         *http.Client\n}\n\n// func Config ...\nfunc (server *Server) Config(username, password, url string, allowUnverifiedSSL bool) (*Server, error) {\n\n    // TODO : Add code to verify parameters\n    return &amp;Server{username, password, url, allowUnverifiedSSL, nil}, nil\n\n}\n</code></pre>\n\n<p>I've tried with the .go files up one level, i.e. not nested underneath iapi/ to for the same results.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "edited": false, "score": 2, "creation_date": 1478043518, "post_id": 40370206, "comment_id": 67994098, "body": "As an aside contexts are a thing in Go, <a href=\"https://golang.org/pkg/context/\" rel=\"nofollow noreferrer\">golang.org/pkg/context</a>, so that appContext name may get confusing."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1478064212, "post_id": 40370206, "comment_id": 67998944, "body": "Frankly: reading the docs and <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">taking the tour</a>. You should at least be able to read method signatures before you take any further steps. Furthermore, I&#39;d refrain from setting up an &quot;uber&quot;-context identical for all requests."}], "answers": [{"tags": [], "owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "is_accepted": false, "score": 0, "last_activity_date": 1478043925, "creation_date": 1478043925, "answer_id": 40370341, "question_id": 40370206, "link": "https://stackoverflow.com/questions/40370206/dealing-with-middleware-that-requires-access-to-the-database-in-go/40370341#40370341", "title": "Dealing with middleware that requires access to the database in Go", "body": "<p>The error you're getting is due to not providing the second argument, <code>next http.Handler</code>.</p>\n\n<p>In the case of how to go about the middleware, I recommend taking a look at the implementation of the <code>http.ServeMux</code> <a href=\"https://golang.org/src/net/http/server.go?s=57308:57433#L1890\" rel=\"nofollow noreferrer\">https://golang.org/src/net/http/server.go?s=57308:57433#L1890</a> it essentially does what you're trying to do (and then some) for routing though.  So using a http.Handler struct might be more easy here than using a Handler function, this way the Handler(s) you'd have as the <code>next http.Handler</code> argument in your function are just a field within the struct that the parent handler can call from within its <code>ServeHTTP()</code>.</p>\n\n<p>So to wrap up my point, you might want to use a struct that implements the <code>http.Handler</code> interface.  That way it can have child handlers and the DB access.  That way you don't have to keep passing this <code>AppContext</code> either.</p>\n"}, {"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": -1, "last_activity_date": 1478066464, "creation_date": 1478066464, "answer_id": 40373387, "question_id": 40370206, "link": "https://stackoverflow.com/questions/40370206/dealing-with-middleware-that-requires-access-to-the-database-in-go/40373387#40373387", "title": "Dealing with middleware that requires access to the database in Go", "body": "<p>I'd not do a premature setup of the context. It is specifically there to be request scoped.</p>\n\n<p>I'd rather create a small and dedicated middleware for passing a database session out of the pool <em>into</em> the context and retrieve said session created for the request in the main handler.</p>\n\n<pre><code>func DBSession(sess *mgo.Session, next http.Handler) http.Handler {\n    return http.HandlerFunc(\n        func(w http.ResponseWriter, r *http.Request) {\n            // Create a new session for the scope of the request\n            s := sess.Copy()\n            // Make it close when exiting scope\n            defer s.Close()\n\n            // Add the new session (actually a pointer to it)\n            // acessible via the name \"_sess\"\n            ctx = context.WithValue(r.Context(), \"_sess\", s)\n\n            // execute the next handler\n            next(w, r.WithContext(ctx))\n        })\n}\n</code></pre>\n\n<p>Now you can use this middleware in you main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n\n    \"gopkg.in/mgo.v2\"\n)\n\nfunc sayHello(w http.ResponseWriter, r *http.Request) http.Handler{\n\n  return http.HandlerFunc(\n    func (w http.ResponseWriter, r *http.Request) {\n      s := r.Context().Value(\"_sess\").(*mgo.Session)\n      // Do something with your database here.\n    }\n  )\n\n}\n\nfunc main() {\n\n    // Ignoring err for brevity\n    sess, _ := mgo.Dial(\"localhost:27017\")\n\n    // Magic happens here: the sayHello Handler is wrapped in the\n    // DBSession middleware, which makes the session available\n    // as context param _sess and closes the session after sayHello\n    // executed. No clutter in your controller for setting up and tearing down\n    // the session, no way you can forget to close it.\n    http.Handle(\"/\", middleware.DBSession(sess, sayHello))\n}\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 6067931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3eb67cbcb6603a741bcb61d4d181352d?s=128&d=identicon&r=PG&f=1", "display_name": "dtrinh50", "link": "https://stackoverflow.com/users/6067931/dtrinh50"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 533, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1478066464, "creation_date": 1478042988, "last_edit_date": 1478043930, "question_id": 40370206, "link": "https://stackoverflow.com/questions/40370206/dealing-with-middleware-that-requires-access-to-the-database-in-go", "title": "Dealing with middleware that requires access to the database in Go", "body": "<p>I am having an issue with creating a middleware that will be chained to other routes and requires access to the database and am not sure how to approach this problem. </p>\n\n<p>I store all of my app context, including the database in a struct called <code>AppContext</code>. I want to create a function handler that looks something like this:</p>\n\n<pre><code>    func SomeHandler(appC *AppContext, next http.Handler) http.Handler {\n        fn := func(w http.ResponseWriter, r *http.Request) {\n           // Access the database using appC.db\n           // Logic that requires access to the database.\n\n        next.ServeHTTP(w, r)\n    }\n       return http.HandlerFunc(fn)\n    }\n\n}\n</code></pre>\n\n<p>In <code>main.go</code>, I have tried:</p>\n\n<pre><code>someHandler := middleware.SomeHandler(&amp;appC)\n</code></pre>\n\n<p>However, I get the error <code>not enough arguments in call to middleware.SomeHandler</code>. What would be the best way to approach this problem?</p>\n"}, {"tags": ["google-app-engine", "go", "urlfetch"], "answers": [{"comments": [{"owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "edited": false, "score": 0, "creation_date": 1478045438, "post_id": 40370234, "comment_id": 67994593, "body": "I didn&#39;t get that they&#39;re the same client type while configured differently."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1478043199, "creation_date": 1478043199, "answer_id": 40370234, "question_id": 40370164, "link": "https://stackoverflow.com/questions/40370164/appengine-go-urlfetch-vs-http-get-etc/40370234#40370234", "title": "AppEngine/Go: urlfetch vs http.Get, etc", "body": "<p>The application should pass an http.Client to your generic client. It can either be a parameter to the function or passed through a <a href=\"https://godoc.org/context#Context\" rel=\"nofollow noreferrer\">context</a> as done in the <a href=\"https://godoc.org/golang.org/x/oauth2#HTTPClient\" rel=\"nofollow noreferrer\">oauth2 package</a>.</p>\n\n<p>If the application does not provide a http.Client through one of these mechanisms (nil arg or no value in context), then use the <a href=\"https://godoc.org/net/http#DefaultClient\" rel=\"nofollow noreferrer\">default client</a>. </p>\n"}], "owner": {"reputation": 8363, "user_id": 706421, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/bb7e85832e0110214043a8726ad70a76?s=128&d=identicon&r=PG", "display_name": "Dustin Oprea", "link": "https://stackoverflow.com/users/706421/dustin-oprea"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 201, "favorite_count": 0, "accepted_answer_id": 40370234, "answer_count": 1, "score": 1, "last_activity_date": 1478043199, "creation_date": 1478042776, "question_id": 40370164, "link": "https://stackoverflow.com/questions/40370164/appengine-go-urlfetch-vs-http-get-etc", "title": "AppEngine/Go: urlfetch vs http.Get, etc", "body": "<p>Is it necessary to use <code>urlfetch</code> under AppEngine? I'd like to write a generic client to use with one of my services, but, if <code>urlfetch</code> is required from AppEngine, how can I write a generic client for use both from outside AppEngine (for the public) and inside AppEngine (for my other services) without having to write two different versions or passing some kind of factory that produces the right implementation?</p>\n"}, {"tags": ["go", "struct", "syntax"], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1478088516, "post_id": 40370060, "comment_id": 68011003, "body": "A nitpick: values in Go are not &quot;inizialized with 0&#39;d values&quot; as <code>calloc()</code> does; they are initialized with the so-called &quot;zero values&quot; for their particular types. These zero values may be different from &quot;all bytes in the underlying memory chunk is 0&quot;."}, {"owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1478094459, "post_id": 40370060, "comment_id": 68014910, "body": "@kostix yes, we&#39;re saying the same thing, just differently."}], "tags": [], "owner": {"reputation": 2324, "user_id": 2272652, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/vKcw7.jpg?s=128&g=1", "display_name": "Christian Grabowski", "link": "https://stackoverflow.com/users/2272652/christian-grabowski"}, "is_accepted": false, "score": 11, "last_activity_date": 1478042849, "last_edit_date": 1478042849, "creation_date": 1478042095, "answer_id": 40370060, "question_id": 40370006, "link": "https://stackoverflow.com/questions/40370006/what-are-the-second-pair-of-braces-in-this-golang-struct/40370060#40370060", "title": "What are the second pair of braces in this Golang struct?", "body": "<p>The example you have is equivalent to:</p>\n\n<pre><code>type Cache struct {\n    sync.Mutex\n    mapping map[string]string\n}\n\ncache := Cache{\n    mapping: make(map[string]string),\n}\n</code></pre>\n\n<p>Except in your example you do not declare a type of <code>Cache</code> and instead have an anonymous struct.  In your example, as oppose to my <code>Cache</code> type, the type is the entire</p>\n\n<pre><code>struct {\n    sync.Mutex\n    mapping map[string]string\n}\n</code></pre>\n\n<p>So think of the second pair of braces as the</p>\n\n<pre><code>cache := Cache{\n    mapping: make(map[string]string),\n}\n</code></pre>\n\n<p>part.</p>\n\n<p><code>make</code> is a built in function that works similarly to C's <code>calloc()</code> which both initialize a data structure filled with 0'd values, in Go's case, certain data structures need to be initialized this way, other's (for the most part structs) are initialized with 0'd values automatically.  The field there is needed so that the compiler now's <code>cache.mapping</code> is a empty <code>map[string]string</code>.</p>\n\n<p>The comma there is part of Go's formatting, you can do <code>Cache{mapping: make(map[string]string)}</code> all on one line, but the moment the field's assignment is on a different line than the opening and closing braces, it requires a comma.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user7038223"}, "edited": false, "score": 1, "creation_date": 1478098302, "post_id": 40382754, "comment_id": 68017704, "body": "This is the same exact thing the first answer says, why did you need to post this?"}, {"owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "edited": false, "score": 0, "creation_date": 1478098701, "post_id": 40382754, "comment_id": 68017991, "body": "Because I thought explaining it in a different way (by comparing it to a simple type like an int that people intuitively understand easeir) might help some people. There&#39;s nothing wrong with having multiple similar answers on StackExchange sites, in fact, it&#39;s encouraged."}], "tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": false, "score": 0, "last_activity_date": 1478097701, "creation_date": 1478097701, "answer_id": 40382754, "question_id": 40370006, "link": "https://stackoverflow.com/questions/40370006/what-are-the-second-pair-of-braces-in-this-golang-struct/40382754#40382754", "title": "What are the second pair of braces in this Golang struct?", "body": "<p>This is called a \"struct literal\" or an \"anonymous struct\" and is, in fact, how you always create structs in Go, it just may not be immediately obvious since you might be used to creating new types for struct types to make declaring them a bit less verbose.</p>\n\n<p>An entire struct definition is actually a type in Go, just like <code>int</code> or <code>[]byte</code> or <code>string</code>. Just as you can do:</p>\n\n<pre><code>type NewType int\nvar a NewType = 5 // a is a NewType (which is based on an int)\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>a := 5 // a is an int\n</code></pre>\n\n<p>and both are distinct types that look like ints, you can also do the same thing with structs:</p>\n\n<pre><code>// a is type NewType (which is a struct{}).\ntype NewType struct{\n  A string\n}\na := NewType{\n  A: \"test string\",\n}\n\n// a is type struct{A string}\na := struct{\n  A string\n}{\n  A: \"test string\",\n}\n</code></pre>\n\n<p>the type name (<code>NewType</code>) has just been replaced with the type of the struct itself, <code>struct{A string}</code>. Note that they are not the same type (an alias) for the purpose of comparison or assignment, but they do share the same semantics.</p>\n"}], "owner": {"reputation": 109, "user_id": 7102027, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1f6f63ea84cafdca36ac2f5a8721d3e2?s=128&d=identicon&r=PG&f=1", "display_name": "kayak", "link": "https://stackoverflow.com/users/7102027/kayak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1532, "favorite_count": 1, "answer_count": 2, "score": 10, "last_activity_date": 1478097701, "creation_date": 1478041679, "last_edit_date": 1478050472, "question_id": 40370006, "link": "https://stackoverflow.com/questions/40370006/what-are-the-second-pair-of-braces-in-this-golang-struct", "title": "What are the second pair of braces in this Golang struct?", "body": "<pre><code>var cache = struct    {\n    sync.Mutex\n    mapping map[string]string\n} {\n    mapping: make(map[string]string),\n}\n</code></pre>\n\n<p>This looks like a struct with an embedded field sync.Mutex but I can't get my head around the second set of braces. It compiles and executes but what's up? Why does the label on the make instruction matter (it does) and the comma? Thanks...</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1478039606, "creation_date": 1478039606, "answer_id": 40369648, "question_id": 40369607, "link": "https://stackoverflow.com/questions/40369607/delete-first-item-in-slice-if-length-100/40369648#40369648", "title": "Delete first item in slice if length &gt; 100", "body": "<p>To achieve this you probably want to use subslicing. Say you want to remove <code>x</code> items from <code>feed</code>, you can simply do <code>feed = feed[x:]</code> which will yield all items after index <code>x-1</code> and assign it back to the <code>feed</code> slice. If in your actual code you just want to remove the first item then it would be <code>feed = feed[1:]</code></p>\n"}, {"comments": [{"owner": {"reputation": 583, "user_id": 2362525, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ee17973702491f1e574c33b908e8ee38?s=128&d=identicon&r=PG", "display_name": "Bento", "link": "https://stackoverflow.com/users/2362525/bento"}, "edited": false, "score": 0, "creation_date": 1478096988, "post_id": 40369830, "comment_id": 68016747, "body": "The for loop is for other stuff not implemented yet. That&#39;s why i&#39;m online printing it to the screen right now."}], "tags": [], "owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "is_accepted": false, "score": 1, "last_activity_date": 1478040681, "creation_date": 1478040681, "answer_id": 40369830, "question_id": 40369607, "link": "https://stackoverflow.com/questions/40369607/delete-first-item-in-slice-if-length-100/40369830#40369830", "title": "Delete first item in slice if length &gt; 100", "body": "<p>If the number of items in the feed grows over the limit, slice it:</p>\n\n<pre><code>length := len(feed.Items)\nif length &gt; limit {\n    feed.Items = feed.Items[length - limit:]\n}\n</code></pre>\n\n<p>When the length is over the limit, the new length will be exactly limit.</p>\n\n<p>You don't need a for loop there.</p>\n"}], "owner": {"reputation": 583, "user_id": 2362525, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ee17973702491f1e574c33b908e8ee38?s=128&d=identicon&r=PG", "display_name": "Bento", "link": "https://stackoverflow.com/users/2362525/bento"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1478040681, "creation_date": 1478039350, "last_edit_date": 1478039377, "question_id": 40369607, "link": "https://stackoverflow.com/questions/40369607/delete-first-item-in-slice-if-length-100", "title": "Delete first item in slice if length &gt; 100", "body": "<p>When the RSS feeds updates (it doesn't right now, just dummy data) the new items are appended to the \"feed\" slice. Over time this could mean that it contains millions of items, I don't want that.</p>\n\n<p>So when there are more than 100 items in the slice it should delete items starting from the top (item 0). In this example I'm using an RSS file with ust 100 items so the sample code below should delete from the top after 50 items:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/SlyMarbo/rss\"\n    \"time\"\n)\n\nvar feed *rss.Feed\nvar directory = \"./dump\"\n\nfunc main() {\n    for {\n        checkRSS()\n        // Check every minute if feed.Refresh has passed so it run's update()\n        time.Sleep(1 * time.Minute)\n    }\n}\n\nfunc checkRSS() (*rss.Feed, error) {\n    var err error\n    // If feed is still empty fetch it first so we can run update()\n    if feed == nil {\n        feed, err = rss.Fetch(\"http://cloud.dgier.nl/api.xml\")\n    } else {\n        err = feed.Update()\n    }\n    length := len(feed.Items)\n    for key, value := range feed.Items {\n        fmt.Println(key, value.Title, value.Read)\n        if key &gt;= 50 {\n            fmt.Println(\"Item key is &gt; 50\")\n\n        }\n    }\n    fmt.Printf(\"Current length: %d\\n\", length)\n    fmt.Printf(\"Refreshing at %s\\n\", feed.Refresh)\n    return feed, err\n}\n</code></pre>\n"}, {"tags": ["performance", "go", "garbage-collection"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1478029048, "post_id": 40367383, "comment_id": 67987977, "body": "Not really; there are fewer knobs than Java or such--answering at greater length."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1478029283, "post_id": 40367383, "comment_id": 67988101, "body": "Currently, the gc implementation has <code>GOGC=</code> and <code>GODBEUG=gcstoptheworld=</code> These are implementation and version specific. See the <a href=\"https://golang.org/pkg/runtime/\" rel=\"nofollow noreferrer\">runtime package documentation</a> for details."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1478029286, "post_id": 40367383, "comment_id": 67988105, "body": "Please be more specific. What do you want to do?"}], "answers": [{"tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": false, "score": 1, "last_activity_date": 1478029721, "creation_date": 1478029721, "answer_id": 40367563, "question_id": 40367383, "link": "https://stackoverflow.com/questions/40367383/is-it-possible-to-use-different-garbage-collection-policies-for-go/40367563#40367563", "title": "Is it possible to use different garbage collection policies for Go?", "body": "<p>Not in the sense that you can use entirely different collectors like in Java or so on. This is on purpose; they want to get something that works decently well everywhere and avoid GC parameter tuning becoming a specialty for Go programmers.</p>\n\n<p>The most often used option is <code>GOGC</code>. The default value of 100 essentially lets your program grow to twice the amount of live data it had after the last GC before another collection is triggered. 200 would let the program grow to 3x the live data after last GC, 50 would let it grow to only 1.5x. The exact timing and pacing of the collection is a little more complicated under the hood since 1.5 made GC concurrent, but the idea is still to target peak memory use of ~2x the amount of live data.</p>\n\n<p>Practically speaking, the main use of <code>GOGC</code> I've seen is people increasing it to reduce a program's garbage collection workload when they know they have memory to spare. People have run the Go compiler with <code>GOGC=400</code> or such for a little speedup, for instance. But note it's far more disastrous to bog down your servers by eating a lot of RAM than to spend a few percent more CPU time GC'ing, so don't go overboard with this.</p>\n\n<p>The other knobs that exist are documented in <a href=\"https://golang.org/pkg/runtime/\" rel=\"nofollow noreferrer\">package <code>runtime</code></a>. With the current implementation you can force GC's to be stop-the-world again or explicitly trigger potentially-stop-the-world collections with <code>runtime.GC()</code>. Separate from GC knobs, <code>runtime</code> also lets you <a href=\"https://golang.org/pkg/runtime/#ReadMemStats\" rel=\"nofollow noreferrer\"><code>ReadMemStats</code></a> and get profiles, which <em>are</em> often useful.</p>\n\n<p>You generally don't want to focus much on the little GC tuning possible; defaults work pretty well and your time is usually better spent thinking about your application.</p>\n"}], "owner": {"reputation": 15, "user_id": 7101398, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86225c95b41985eba5ad79f05f662e73?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/7101398/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 1, "closed_date": 1478044527, "answer_count": 1, "score": -3, "last_activity_date": 1478029721, "creation_date": 1478028929, "question_id": 40367383, "link": "https://stackoverflow.com/questions/40367383/is-it-possible-to-use-different-garbage-collection-policies-for-go", "closed_reason": "Needs more focus", "title": "Is it possible to use different garbage collection policies for Go?", "body": "<p>As the title says, I wonder if it is possible to change the GC policy used by the Go?</p>\n"}, {"tags": ["performance", "file", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1478026364, "post_id": 40366652, "comment_id": 67986691, "body": "It&#39;s much easier (and often safer and more efficient) to write a new file then replace the old one, rather than try to insert data and shift the entire rest of the file."}, {"owner": {"reputation": 141, "user_id": 5021306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2780bf241f48e3906937ceeb35e63f64?s=128&d=identicon&r=PG&f=1", "display_name": "Erwan Aaron", "link": "https://stackoverflow.com/users/5021306/erwan-aaron"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478026523, "post_id": 40366652, "comment_id": 67986764, "body": "I am a little worried about frequently creating new files every time a user desires to insert a new (key, value) or update an existing one because I think it would increase the latency of those operations too much. Though I am not expert, I understand that I/O on disk are best kept to a minimum?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478026825, "post_id": 40366652, "comment_id": 67986915, "body": "The problem is the concept of &quot;inserting&quot; values into a file -- there is no insert operation for a regular file. Any &quot;insert&quot; you do will have rewrite  50% of the file on average, and you will lose data if you error out during that rewrite. If you need to frequently insert things at random points in your storage, you&#39;re likely looking for some sort of database."}, {"owner": {"reputation": 141, "user_id": 5021306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2780bf241f48e3906937ceeb35e63f64?s=128&d=identicon&r=PG&f=1", "display_name": "Erwan Aaron", "link": "https://stackoverflow.com/users/5021306/erwan-aaron"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478027095, "post_id": 40366652, "comment_id": 67987043, "body": "@JimB Thank you - that&#39;s exactly what I am trying to do (build a database). That&#39;s just for fun, though it is not supposed to ever become production ready; it is just to learn."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478027438, "post_id": 40366652, "comment_id": 67987225, "body": "Then you need to start with some data structures that are used for database storage. Btrees, index files, etc."}, {"owner": {"reputation": 141, "user_id": 5021306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2780bf241f48e3906937ceeb35e63f64?s=128&d=identicon&r=PG&f=1", "display_name": "Erwan Aaron", "link": "https://stackoverflow.com/users/5021306/erwan-aaron"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478027550, "post_id": 40366652, "comment_id": 67987279, "body": "@JimB I have dived into the internals of LevelDB a bit and that&#39;s the strategy I plan to follow later on (implement my own LSM-Tree) but I would like to get a first decent version working before I move onto implementing more complex DS. Thank you for your input! (:"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1478029039, "post_id": 40366652, "comment_id": 67987971, "body": "Look into mmap and family. That&#39;s the usual way to project memory into files and what many KV stores and databases use."}, {"owner": {"reputation": 141, "user_id": 5021306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2780bf241f48e3906937ceeb35e63f64?s=128&d=identicon&r=PG&f=1", "display_name": "Erwan Aaron", "link": "https://stackoverflow.com/users/5021306/erwan-aaron"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1478049534, "post_id": 40366652, "comment_id": 67995594, "body": "@thwd Thank you I will look into that"}], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 5021306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2780bf241f48e3906937ceeb35e63f64?s=128&d=identicon&r=PG&f=1", "display_name": "Erwan Aaron", "link": "https://stackoverflow.com/users/5021306/erwan-aaron"}, "edited": false, "score": 0, "creation_date": 1478027325, "post_id": 40366834, "comment_id": 67987172, "body": "Thank you Roland, I will look into that. And I will set your answer in a couple - leaving it open now so people can still post their suggestions. Right now what I am thinking is to have an index file as follow: [index: 4 bytes][offset: 2 bytes] where <code>offset</code> is the position of the entry in another file. It is much better than having to deal with the values as well. What do you think?"}, {"owner": {"reputation": 141, "user_id": 5021306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2780bf241f48e3906937ceeb35e63f64?s=128&d=identicon&r=PG&f=1", "display_name": "Erwan Aaron", "link": "https://stackoverflow.com/users/5021306/erwan-aaron"}, "edited": false, "score": 0, "creation_date": 1478027808, "post_id": 40366834, "comment_id": 67987413, "body": "Forgot this bit: I want to later allow users to provide a comparator function according to which they can order their <code>key:value</code>. For now <code>index</code> will just be a <code>uint32</code> that I compute based on the binary representation of the corresponding value."}, {"owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "reply_to_user": {"reputation": 141, "user_id": 5021306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2780bf241f48e3906937ceeb35e63f64?s=128&d=identicon&r=PG&f=1", "display_name": "Erwan Aaron", "link": "https://stackoverflow.com/users/5021306/erwan-aaron"}, "edited": false, "score": 0, "creation_date": 1478033469, "post_id": 40366834, "comment_id": 67990264, "body": "Your data structures depend on how large the keys and values can be. For the values, I would generally reserve 32 bits, and for the offsets 64 bits. But then, the overall size of such an index entry should be a power of two, so I would choose <code>{offset uint64; size uint32; reserved uint32}</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 141, "user_id": 5021306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2780bf241f48e3906937ceeb35e63f64?s=128&d=identicon&r=PG&f=1", "display_name": "Erwan Aaron", "link": "https://stackoverflow.com/users/5021306/erwan-aaron"}, "edited": false, "score": 0, "creation_date": 1478036836, "post_id": 40366834, "comment_id": 67991858, "body": "@ErwanAaron: there are countless publications and courses that cover these things. It might be good to do some research before making random attempts at creating a database format, as this is a very broad subject."}, {"owner": {"reputation": 141, "user_id": 5021306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2780bf241f48e3906937ceeb35e63f64?s=128&d=identicon&r=PG&f=1", "display_name": "Erwan Aaron", "link": "https://stackoverflow.com/users/5021306/erwan-aaron"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478037471, "post_id": 40366834, "comment_id": 67992118, "body": "@JimB I can&#39;t ask questions about design or good practices to an academic paper. If you don&#39;t want to answer that&#39;s fine but as you said, this is such a broad topic... I don&#39;t see what harm is done by asking for advice to far more experienced and knowledgable people. The goal isn&#39;t to build the next MySQL. Just for me to learn and get more experience working with low-level I/O."}, {"owner": {"reputation": 141, "user_id": 5021306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2780bf241f48e3906937ceeb35e63f64?s=128&d=identicon&r=PG&f=1", "display_name": "Erwan Aaron", "link": "https://stackoverflow.com/users/5021306/erwan-aaron"}, "edited": false, "score": 0, "creation_date": 1478040468, "post_id": 40366834, "comment_id": 67993212, "body": "@RolandIllig Would it be &quot;bad design&quot; to allow for an unlimited size for the keys? I could just add a field size that would tell me that the next size bytes are those of the key. Thank you Roland!"}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "reply_to_user": {"reputation": 141, "user_id": 5021306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2780bf241f48e3906937ceeb35e63f64?s=128&d=identicon&r=PG&f=1", "display_name": "Erwan Aaron", "link": "https://stackoverflow.com/users/5021306/erwan-aaron"}, "edited": false, "score": 0, "creation_date": 1478051893, "post_id": 40366834, "comment_id": 67996141, "body": "@ErwanAaron In the case of something like SQL-based databases, you usually have a way to specify the order like MySQL&#39;s <code>ORDER BY</code> condition to specify which field to sort data along with a sort direction, but the comparison function is predefined (for performance reasons). Later you might add your comparison functionality, but I&#39;d keep it as simple as you can for right now."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1478052512, "post_id": 40366834, "comment_id": 67996259, "body": "As for the size of the keys, that depends on the data type of the key. Naturally types with fixed sizes such as uint64 would perform better in the general case, but nothing stops you from using, for example, a variable-length string as a primary key or a component in a composite key. There&#39;s also the question of what you mean by &quot;key&quot; since <a href=\"http://www.databasedev.co.uk/what_is_a_key.html\" rel=\"nofollow noreferrer\">more than one field can be a key technically</a>."}], "tags": [], "owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "is_accepted": true, "score": 1, "last_activity_date": 1478041424, "last_edit_date": 1478041424, "creation_date": 1478026821, "answer_id": 40366834, "question_id": 40366652, "link": "https://stackoverflow.com/questions/40366652/how-to-efficiently-insert-a-byte-slice-in-a-file/40366834#40366834", "title": "How to efficiently insert a byte slice in a file?", "body": "<p>Instead of inventing your own file format, you could copy the pack file format from Git.</p>\n\n<p>The basic idea is to have an <em>index</em> file and a <em>data</em> file. When you want to insert a slice you just append it to the data file. Then you update the index file, which is usually smaller. Note that the pack file is not designed for real-time updates, but accompanied by individual object files.</p>\n\n<p>Or have a look at the Berkeley DB file format.</p>\n"}], "owner": {"reputation": 141, "user_id": 5021306, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2780bf241f48e3906937ceeb35e63f64?s=128&d=identicon&r=PG&f=1", "display_name": "Erwan Aaron", "link": "https://stackoverflow.com/users/5021306/erwan-aaron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 2, "accepted_answer_id": 40366834, "answer_count": 1, "score": 3, "last_activity_date": 1478041424, "creation_date": 1478026153, "question_id": 40366652, "link": "https://stackoverflow.com/questions/40366652/how-to-efficiently-insert-a-byte-slice-in-a-file", "title": "How to efficiently insert a byte slice in a file?", "body": "<p>I am building a simple key-value store for fun. Right now, I am looking for an efficient way to insert a slice in a file.</p>\n\n<p>My current approach:</p>\n\n<ul>\n<li><p>find the desired offset</p></li>\n<li><p>store in a buffer the blocks that precede the desired insert point</p></li>\n<li><p>append the byte slice to that buffer</p></li>\n<li><p>append the rest of the file</p></li>\n<li><p>Write to disk</p></li>\n</ul>\n\n<p>Problem is:</p>\n\n<ul>\n<li><p>It is not a given that the whole file can fit in memory</p></li>\n<li><p>It is inefficient</p></li>\n</ul>\n\n<p>I have looked into available libraries and sadly the best match I have found <code>os.WriteAt</code> overwrites the following blocks. Example:</p>\n\n<pre><code>import \"os\"\n\nfunc main() {\n    pathToFile := \"./tmp\"\n    bufferToWrite := []byte{255, 255, 255, 255, 255}\n\n    f, _ := os.OpenFile(pathToFile, os.O_CREATE|os.O_RDWR, os.PermMode)\n    defer f.Close()\n    f.Write(bufferToWrite)\n</code></pre>\n\n<p>So, at this point the content of <code>tmp</code> will be (after <code>$: xxd -g 1 -b tmp</code>):</p>\n\n<blockquote>\n  <p>11111111 11111111 11111111 (x) 11111111 11111111</p>\n</blockquote>\n\n<p>Let's try to insert something with offset = 3 (x):</p>\n\n<pre><code>    bufferToInsert := []byte{0, 0}\n    f.WriteAt(bufferToInsert, 3)\n}\n</code></pre>\n\n<p>Output will be:</p>\n\n<blockquote>\n  <p>11111111 11111111 11111111 00000000 00000000</p>\n</blockquote>\n\n<p>And I want it to be:</p>\n\n<blockquote>\n  <p>11111111 11111111 11111111 00000000 00000000 11111111 11111111</p>\n</blockquote>\n\n<p>Any ideas?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1277, "user_id": 1737811, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/ab510b7d0d145c538fcc7638395ee703?s=128&d=identicon&r=PG", "display_name": "mutantkeyboard", "link": "https://stackoverflow.com/users/1737811/mutantkeyboard"}, "edited": false, "score": 0, "creation_date": 1478023353, "post_id": 40365684, "comment_id": 67985074, "body": "You need to say <code>var struct_values *Output</code> instead of reference to a struct, and then you can pass a reference in your cli.StringFlag function"}], "answers": [{"tags": [], "owner": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "is_accepted": false, "score": 0, "last_activity_date": 1478026289, "creation_date": 1478026289, "answer_id": 40366705, "question_id": 40365684, "link": "https://stackoverflow.com/questions/40365684/assigning-struct-variable-with-cli-package/40366705#40366705", "title": "Assigning struct variable with cli package", "body": "<p>I was making this way harder than it needed to be :)</p>\n\n<p>I went with:</p>\n\n<pre><code>struct_values := &amp;Output { Name: c.string(\"name\") }\n</code></pre>\n\n<p>Which got the job done just as easily</p>\n"}], "owner": {"reputation": 9348, "user_id": 645002, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/b89ca9c20cfefbd831a5d5756b3bc3ed?s=128&d=identicon&r=PG", "display_name": "jaxxstorm", "link": "https://stackoverflow.com/users/645002/jaxxstorm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 162, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1478026289, "creation_date": 1478022505, "question_id": 40365684, "link": "https://stackoverflow.com/questions/40365684/assigning-struct-variable-with-cli-package", "title": "Assigning struct variable with cli package", "body": "<p>I'm writing my first golang app, so go easy on me!</p>\n\n<p>I have a very simple struct:</p>\n\n<pre><code>type Output struct {\n  Name     string   `json:\"name\"`\n}\n</code></pre>\n\n<p>and I'm also using this golang package to <a href=\"https://github.com/urfave/cli\" rel=\"nofollow noreferrer\">build a CLI app</a>:</p>\n\n<p>I want to assign the value of a cli <code>StringFlag</code> to the value of the initialized struct. So a boolean flag, I do this:</p>\n\n<pre><code>var testing bool\napp.Flags = []cli.Flag{\n    cli.BoolFlag{Name: \"test, T\", Usage: \"Output to stdout or not\", Destination: &amp;testing},\n}\n</code></pre>\n\n<p>This works fine.</p>\n\n<p>However, when I try to initialize the struct, and then assign the value in a similar way, it doesn't work:</p>\n\n<pre><code>struct_values := &amp;Output { }\napp.Flags = []cli.Flag{\n    cli.StringFlag{Name: \"name, N\", Usage: \"The name of the thing\", Destination: &amp;struct_values.Name},\n}\n</code></pre>\n\n<p>What am I missing here? I feel like this is relatively straightforward, but my understanding is lacking :(</p>\n"}, {"tags": ["go", "abstract-syntax-tree", "pretty-print"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1478023139, "post_id": 40365301, "comment_id": 67984946, "body": "Most Go code generators produce text directly and <a href=\"https://godoc.org/go/format#Source\" rel=\"nofollow noreferrer\">format</a> the text when done.  Generating text is much easier than doing anything with the AST."}, {"owner": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1478024398, "post_id": 40365301, "comment_id": 67985643, "body": "That&#39;s... unfortunate."}, {"owner": {"reputation": 88411, "user_id": 120163, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/OPDmg.jpg?s=128&g=1", "display_name": "Ira Baxter", "link": "https://stackoverflow.com/users/120163/ira-baxter"}, "edited": false, "score": 0, "creation_date": 1478030368, "post_id": 40365301, "comment_id": 67988666, "body": "See my SO answer on how to build AST prettyprinters: <a href=\"http://stackoverflow.com/a/5834775/120163\">stackoverflow.com/a/5834775/120163</a>"}, {"owner": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "reply_to_user": {"reputation": 88411, "user_id": 120163, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/OPDmg.jpg?s=128&g=1", "display_name": "Ira Baxter", "link": "https://stackoverflow.com/users/120163/ira-baxter"}, "edited": false, "score": 0, "creation_date": 1478030679, "post_id": 40365301, "comment_id": 67988835, "body": "@IraBaxter That tells me how to build a pretty-printer. My goal is to use someone else&#39;s PrettyPrinter, like the one that GoLang has, but which doesn&#39;t seem to support constructing ASTs from scratch."}, {"owner": {"reputation": 88411, "user_id": 120163, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/OPDmg.jpg?s=128&g=1", "display_name": "Ira Baxter", "link": "https://stackoverflow.com/users/120163/ira-baxter"}, "edited": false, "score": 0, "creation_date": 1478030916, "post_id": 40365301, "comment_id": 67988959, "body": "@jmite: True, most of its focus is on how to build a a prettyprinter, and/or a fidelity printer (that preserves the original layout of the text).   It refers to (my company&#39;s) tool that implements such prettyprinters quite naturally and easily, and that will build ASTs from scratch given a grammar.    It has been tested on many, many grammars; not yet on Go although I don&#39;t see why Go would be special."}, {"owner": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "edited": false, "score": 1, "creation_date": 1478031080, "post_id": 40365301, "comment_id": 67989038, "body": "Even so, the whole point of the question is that I want to avoid having to model all of Go by hand just to generate some Go code, when there&#39;s already AST and PrettyPrint modules in Go. Your tool, if I understand right, would still require me to make a grammar or at least some rules for Go. What&#39;s more, I don&#39;t need the printing to be too &quot;pretty,&quot; just syntactically correct, since I can feed it all through gofmt."}, {"owner": {"reputation": 88411, "user_id": 120163, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/OPDmg.jpg?s=128&g=1", "display_name": "Ira Baxter", "link": "https://stackoverflow.com/users/120163/ira-baxter"}, "edited": false, "score": 0, "creation_date": 1478032185, "post_id": 40365301, "comment_id": 67989599, "body": "If you insist on using the Go AST and PrettyPrint modules, then my reference doesn&#39;t help you, agreed.  You asked if there was a better tool :-}  You can&#39;t avoid building the part of the AST that is needed; it isn&#39;t long before you decide you complete (Go) programs and therefore the complete AST, in my experience.  So, yes, you&#39;d have to give DMS what amounts to a complete Go grammar (and lexer)."}], "answers": [{"tags": [], "owner": {"reputation": 6761, "user_id": 664345, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/34de936228acd10be7665e5c73c53d92?s=128&d=identicon&r=PG", "display_name": "Liyan Chang", "link": "https://stackoverflow.com/users/664345/liyan-chang"}, "is_accepted": true, "score": 2, "last_activity_date": 1593708288, "creation_date": 1593708288, "answer_id": 62701223, "question_id": 40365301, "link": "https://stackoverflow.com/questions/40365301/golang-ast-generating-and-printing-a-tree-without-position-information/62701223#62701223", "title": "GoLang ast: generating and printing a tree without position information", "body": "<p>Consider <a href=\"https://github.com/lu4p/astextract\" rel=\"nofollow noreferrer\">https://github.com/lu4p/astextract</a> which has a nicer AST to work with that can be printed into go code.</p>\n<p>I know you've thought about this, but using <code>text/template</code> and <code>goimports</code> on the resulting string is actually quite reasonable. It's way easier to write and it translates much better to writing normal go code. As you note, it's not type-safe (which is fine because running <code>goimports</code> on it later enforces that). The biggest con is actually that it's hard to test (we ended up writing a set of generated tests and manual written tests).</p>\n<p>(EDIT: just realized how old of a question this is - going to leave my answer up for others as I'm sure you've found some way to solve this for yourself by now)</p>\n"}], "owner": {"reputation": 7230, "user_id": 788337, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wiVpx.png?s=128&g=1", "display_name": "jmite", "link": "https://stackoverflow.com/users/788337/jmite"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 998, "favorite_count": 1, "accepted_answer_id": 62701223, "answer_count": 1, "score": 5, "last_activity_date": 1593708288, "creation_date": 1478021066, "question_id": 40365301, "link": "https://stackoverflow.com/questions/40365301/golang-ast-generating-and-printing-a-tree-without-position-information", "title": "GoLang ast: generating and printing a tree without position information", "body": "<p>I'm looking to make a tool which generates method stubs from some given input. I've seen  <a href=\"https://golang.org/pkg/go/ast/\" rel=\"noreferrer\">the <code>ast</code> package</a>, but it seems to represent an already parsed AST, which has information about where in the source file everything is. Importantly, you need to provide source information</p>\n\n<p>I'm looking at generating a source file programatically, so I have no idea where in the final file my AST nodes will end up.</p>\n\n<p>I'm wondering:</p>\n\n<ul>\n<li>Is there a better AST tool which lets you generate code without giving source file position information?</li>\n<li>If I give dummy information for positions in the <code>ast</code> package, will it pretty-print properly (i.e. ignore the position information)?</li>\n</ul>\n\n<p>I realize I <em>could</em> do this all with text generation, but that seems type-unsafe and harder to deal with.</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1478018085, "post_id": 40364270, "comment_id": 67981897, "body": "<code>time.Ticker</code> sends notifications at regular intervals (on a channel). You could have a goroutine for each of those invocations that uses a ticker to run the command at the desired interval."}, {"owner": {"reputation": 2502, "user_id": 3589054, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2af7ed5cc40b1b8479cd082ca3e0c4af?s=128&d=identicon&r=PG&f=1", "display_name": "NinjaGaiden", "link": "https://stackoverflow.com/users/3589054/ninjagaiden"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 1, "creation_date": 1478019405, "post_id": 40364270, "comment_id": 67982728, "body": "Not sure why I got a negative vote, is it such a obvious question?"}, {"owner": {"reputation": 493, "user_id": 4563831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65ff019604e25751693cfd7cabbdd5d8?s=128&d=identicon&r=PG&f=1", "display_name": "ttacon", "link": "https://stackoverflow.com/users/4563831/ttacon"}, "edited": false, "score": 0, "creation_date": 1478019757, "post_id": 40364270, "comment_id": 67982946, "body": "You also might be interested in the cron package: <a href=\"https://github.com/robfig/cron\" rel=\"nofollow noreferrer\">github.com/robfig/cron</a>"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 25, "last_activity_date": 1478022736, "last_edit_date": 1478022736, "creation_date": 1478019838, "answer_id": 40364927, "question_id": 40364270, "link": "https://stackoverflow.com/questions/40364270/running-a-function-periodically-in-go/40364927#40364927", "title": "running a function periodically in go", "body": "<p>Use a <a href=\"https://golang.org/pkg/time/#Ticker\" rel=\"noreferrer\"><code>time.Ticker</code></a>. There's many ways to structure the program, but you can start with a simple for loop:</p>\n\n<pre><code>uptimeTicker := time.NewTicker(5 * time.Second)\ndateTicker := time.NewTicker(10 * time.Second)\n\nfor {\n    select {\n    case &lt;-uptimeTicker.C:\n        run(\"uptime\")\n    case &lt;-dateTicker.C:\n        run(\"date\")\n    }\n}\n</code></pre>\n\n<p>You may then want to run the commands in a goroutine if there's a chance they could take longer than your shortest interval to avoid a backlog in the for loop. Alternatively, each goroutine could have its own for loop with a single Ticker. </p>\n"}, {"tags": [], "owner": {"reputation": 5, "user_id": 13841994, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ecb106e543a196a27f507d7db6a2ea8d?s=128&d=identicon&r=PG&f=1", "display_name": "RITESH ", "link": "https://stackoverflow.com/users/13841994/ritesh"}, "is_accepted": false, "score": 1, "last_activity_date": 1609656044, "last_edit_date": 1609656044, "creation_date": 1609655574, "answer_id": 65547250, "question_id": 40364270, "link": "https://stackoverflow.com/questions/40364270/running-a-function-periodically-in-go/65547250#65547250", "title": "running a function periodically in go", "body": "<pre><code>func main() {\n    for range time.Tick(time.Second * 10) {\n        function_name()\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 129, "user_id": 1883208, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a4219710e89e48774230e123726f372b?s=128&d=identicon&r=PG", "display_name": "Kristaps Jarem\u010duks", "link": "https://stackoverflow.com/users/1883208/kristaps-jarem%c4%8duks"}, "is_accepted": false, "score": 0, "last_activity_date": 1610245730, "creation_date": 1610245730, "answer_id": 65649646, "question_id": 40364270, "link": "https://stackoverflow.com/questions/40364270/running-a-function-periodically-in-go/65649646#65649646", "title": "running a function periodically in go", "body": "<p>I suggest to checkout this package.\n<a href=\"https://godoc.org/github.com/robfig/cron\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/robfig/cron</a></p>\n<p>You can even use seconds.</p>\n<pre><code>c := cron.New(cron.WithSeconds())\nc.AddFunc(&quot;*/5 * * * * *&quot;, func() { fmt.Println(&quot;Testing every 5 seconds.&quot;) })\nc.Start()\n</code></pre>\n"}], "owner": {"reputation": 2502, "user_id": 3589054, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2af7ed5cc40b1b8479cd082ca3e0c4af?s=128&d=identicon&r=PG&f=1", "display_name": "NinjaGaiden", "link": "https://stackoverflow.com/users/3589054/ninjagaiden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7859, "favorite_count": 3, "accepted_answer_id": 40364927, "answer_count": 3, "score": 17, "last_activity_date": 1610245730, "creation_date": 1478017584, "last_edit_date": 1478053789, "question_id": 40364270, "link": "https://stackoverflow.com/questions/40364270/running-a-function-periodically-in-go", "title": "running a function periodically in go", "body": "<p>I have a function like this:</p>\n\n<pre><code>func run (cmd string) [] byte {\n    out,err = exec.Command(cmd).Output()\n    if error!=nil { \n        log.Fatal (err) \n    }\n    return out\n}\n</code></pre>\n\n<p>I would like to run this command this way</p>\n\n<pre><code>run (\"uptime\") // run every 5 secs\nrun (\"date\") // run every 10 secs\n</code></pre>\n\n<p>I would like to run these commands and collect its output and do something with it. How would I do this in go?</p>\n"}, {"tags": ["go", "graphql"], "answers": [{"comments": [{"owner": {"reputation": 260, "user_id": 3137420, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iPL8o.jpg?s=128&g=1", "display_name": "Fontinalis", "link": "https://stackoverflow.com/users/3137420/fontinalis"}, "edited": false, "score": 0, "creation_date": 1518469926, "post_id": 41230015, "comment_id": 84512132, "body": "Thanks, you saved a little time for me! +1"}, {"owner": {"reputation": 1405, "user_id": 2090926, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/5QsAi.jpg?s=128&g=1", "display_name": "Touch", "link": "https://stackoverflow.com/users/2090926/touch"}, "edited": false, "score": 8, "creation_date": 1529539671, "post_id": 41230015, "comment_id": 88914585, "body": "You deserve a medal for this. That project really needs documentation. Like the other implementation of it."}], "tags": [], "owner": {"reputation": 7537, "user_id": 4263818, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/AzSa2.jpg?s=128&g=1", "display_name": "R Menke", "link": "https://stackoverflow.com/users/4263818/r-menke"}, "is_accepted": true, "score": 34, "last_activity_date": 1482177115, "creation_date": 1482177115, "answer_id": 41230015, "question_id": 40360936, "link": "https://stackoverflow.com/questions/40360936/graphql-go-use-an-object-as-input-argument-to-a-query/41230015#41230015", "title": "graphql-go : Use an Object as Input Argument to a Query", "body": "<p>Had the same issue. Here is what I found from going through the graphql-go source. </p>\n\n<p>The <code>Fields</code> of an <code>InputObject</code> have to be of type <code>InputObjectConfigFieldMap</code> or <code>InputObjectConfigFieldMapThunk</code> for the pkg to work.</p>\n\n<p>So an <code>InputObject</code> would look like this :</p>\n\n<pre><code>var inputType = graphql.NewInputObject(\n    graphql.InputObjectConfig{\n        Name: \"MyInputType\",\n        Fields: graphql.InputObjectConfigFieldMap{\n            \"key\": &amp;graphql.InputObjectFieldConfig{\n                Type: graphql.String,\n            },\n        },\n    },\n) \n</code></pre>\n\n<hr>\n\n<p>Modified the Hello World example to take an <code>Input Object</code> :</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n\n    \"github.com/graphql-go/graphql\"\n)\n\nfunc main() {\n    // Schema\n\n    var inputType = graphql.NewInputObject(\n        graphql.InputObjectConfig{\n            Name: \"MyInputType\",\n            Fields: graphql.InputObjectConfigFieldMap{\n                \"key\": &amp;graphql.InputObjectFieldConfig{\n                    Type: graphql.String,\n                },\n            },\n        },\n    )\n\n    args := graphql.FieldConfigArgument{\n        \"foo\": &amp;graphql.ArgumentConfig{\n            Type: inputType,\n        },\n    }\n\n    fields := graphql.Fields{\n        \"hello\": &amp;graphql.Field{\n            Type: graphql.String,\n            Args: args,\n            Resolve: func(p graphql.ResolveParams) (interface{}, error) {\n                fmt.Println(p.Args)\n                return \"world\", nil\n            },\n        },\n    }\n    rootQuery := graphql.ObjectConfig{\n        Name:   \"RootQuery\",\n        Fields: fields,\n    }\n\n    schemaConfig := graphql.SchemaConfig{Query: graphql.NewObject(rootQuery)}\n    schema, err := graphql.NewSchema(schemaConfig)\n    if err != nil {\n        log.Fatalf(\"failed to create new schema, error: %v\", err)\n    }\n\n    // Query\n    query := `\n        {\n            hello(foo:{key:\"blah\"})\n        }\n    `\n    params := graphql.Params{Schema: schema, RequestString: query}\n    r := graphql.Do(params)\n    if len(r.Errors) &gt; 0 {\n        log.Fatalf(\"failed to execute graphql operation, errors: %+v\", r.Errors)\n    }\n    rJSON, _ := json.Marshal(r)\n    fmt.Printf(\"%s \\n\", rJSON) // {\u201cdata\u201d:{\u201chello\u201d:\u201dworld\u201d}}\n}\n</code></pre>\n"}], "owner": {"reputation": 800, "user_id": 2851943, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/7356c8ed45eb90f9ecc92912ceccbef5?s=128&d=identicon&r=PG&f=1", "display_name": "user2851943", "link": "https://stackoverflow.com/users/2851943/user2851943"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4523, "favorite_count": 11, "accepted_answer_id": 41230015, "answer_count": 1, "score": 14, "last_activity_date": 1482177115, "creation_date": 1478006471, "last_edit_date": 1482173875, "question_id": 40360936, "link": "https://stackoverflow.com/questions/40360936/graphql-go-use-an-object-as-input-argument-to-a-query", "title": "graphql-go : Use an Object as Input Argument to a Query", "body": "<p>I'm attempting to pass an object as an argument to a query (rather than a scalar). From the docs it seems that this should be possible, but I can't figure out how to make it work.</p>\n\n<p>I'm using graphql-go, here is the test schema:</p>\n\n<pre><code>var fileDocumentType = graphql.NewObject(graphql.ObjectConfig{\nName: \"FileDocument\",\nFields: graphql.Fields{\n    \"id\": &amp;graphql.Field{\n        Type: graphql.String,\n        Resolve: func(p graphql.ResolveParams) (interface{}, error) {\n            if fileDoc, ok := p.Source.(data_format.FileDocument); ok {\n                return fileDoc.Id, nil\n            }\n            return \"\", nil\n        },\n    },\n    \"tags\": &amp;graphql.Field{\n        Type: graphql.NewList(tagsDataType),\n        Args: graphql.FieldConfigArgument{\n            \"tags\": &amp;graphql.ArgumentConfig{\n                Type: tagsInputType,\n            },\n        },\n        Resolve: func(p graphql.ResolveParams) (interface{}, error) {\n            fmt.Println(p.Source)\n            fmt.Println(p.Args)\n            if fileDoc, ok := p.Source.(data_format.FileDocument); ok {\n                return fileDoc.Tags, nil\n            }\n            return nil, nil\n        },\n    },\n\n},\n})\n</code></pre>\n\n<p>And the inputtype I'm attempting to use (I've tried both an InputObject and a standard Object)</p>\n\n<pre><code>var tagsInputType = graphql.NewInputObject(graphql.InputObjectConfig{\nName: \"tagsInput\",\nFields: graphql.Fields{\n    \"keyt\": &amp;graphql.Field{\n        Type: graphql.String,\n    },\n    \"valuet\": &amp;graphql.Field{\n        Type: graphql.String,\n    },\n},\n})\n</code></pre>\n\n<p>And here is the graphql query I'm using to test:</p>\n\n<pre><code>{\n        list(location:\"blah\",rule:\"blah\")\n        {\n            id,tags(tags:{keyt:\"test\",valuet:\"test\"})\n            {\n                key,\n                value\n            },\n            {\n                datacentre,\n                handlerData\n                {\n                    key,\n                    value\n                }\n            }\n        }\n    }\n</code></pre>\n\n<p>I'm getting the following error:</p>\n\n<pre><code>wrong result, unexpected errors: [Argument \"tags\" has invalid value {keyt: \"test\", valuet: \"test\"}.\nIn field \"keyt\": Unknown field.\nIn field \"valuet\": Unknown field.]\n</code></pre>\n\n<p>The thing is, when I change the type to a string, it works fine. How do I use an object as an input arg?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "circleci"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478093536, "post_id": 40359505, "comment_id": 68014270, "body": "<a href=\"https://golang.org/cmd/go/#hdr-GOPATH_environment_variable\" rel=\"nofollow noreferrer\">GOPATH</a>: <code>The GOPATH environment variable lists places to look for Go code. On Unix, the value is a colon-separated string.</code>"}], "answers": [{"tags": [], "owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "is_accepted": false, "score": 3, "last_activity_date": 1478002103, "creation_date": 1478002103, "answer_id": 40359767, "question_id": 40359505, "link": "https://stackoverflow.com/questions/40359505/circleci-ubuntu-14-04-build-image-has-multiple-gopath-values/40359767#40359767", "title": "Circleci Ubuntu 14.04 build image has multiple gopath values", "body": "<p><code>GOROOT</code> is the enviroment variable that specify where the go binary distribution is installed, if is installed in the default folder you are not required to declare this enviroment variable.<br>\nAnd, according to <a href=\"https://circleci.com/docs/language-go/\" rel=\"nofollow noreferrer\">CIRCLE CI docs</a> Go is installed in the default folder so you shouldn't have any problem.</p>\n"}], "owner": {"reputation": 11533, "user_id": 1022177, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/BDTjr.jpg?s=128&g=1", "display_name": "Myles McDonnell", "link": "https://stackoverflow.com/users/1022177/myles-mcdonnell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1478002103, "creation_date": 1478001140, "question_id": 40359505, "link": "https://stackoverflow.com/questions/40359505/circleci-ubuntu-14-04-build-image-has-multiple-gopath-values", "title": "Circleci Ubuntu 14.04 build image has multiple gopath values", "body": "<p>The CircleCI Ubuntu 14.04 build image has the following value for the GOPATH env var:</p>\n\n<pre><code>/home/ubuntu/.go_workspace:/usr/local/go_workspace\n</code></pre>\n\n<p>and no GOROOT env var.  Is this an error? </p>\n"}, {"tags": ["parsing", "go", "package", "abstract-syntax-tree"], "answers": [{"tags": [], "owner": {"reputation": 893, "user_id": 5016201, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/axdqP.jpg?s=128&g=1", "display_name": "aurelienC", "link": "https://stackoverflow.com/users/5016201/aurelienc"}, "is_accepted": true, "score": 1, "last_activity_date": 1478002147, "creation_date": 1478002147, "answer_id": 40359783, "question_id": 40359350, "link": "https://stackoverflow.com/questions/40359350/go-package-ast-find-package-in-file/40359783#40359783", "title": "Go - package ast : find package in file", "body": "<p>So basically, it seems like you have to look for a <code>File</code> instead of a package:</p>\n\n<pre><code>func find_package(node ast.Node) bool {\n    switch x := node.(type) {\n    case *ast.File:\n        fmt.Print(x.Name)\n    }\n    return true\n}\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/go/ast/#File\" rel=\"nofollow noreferrer\">https://golang.org/pkg/go/ast/#File</a></p>\n"}], "owner": {"reputation": 893, "user_id": 5016201, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/axdqP.jpg?s=128&g=1", "display_name": "aurelienC", "link": "https://stackoverflow.com/users/5016201/aurelienc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 486, "favorite_count": 1, "accepted_answer_id": 40359783, "answer_count": 1, "score": 2, "last_activity_date": 1478002147, "creation_date": 1478000481, "question_id": 40359350, "link": "https://stackoverflow.com/questions/40359350/go-package-ast-find-package-in-file", "title": "Go - package ast : find package in file", "body": "<p>I am parsing files with the <strong>ast package</strong>.<br>\nI have been looking at the documentation for a bit and I can't find a way to <strong>determine if a token is a package declaration</strong>, <em>e.g</em>: <code>package main</code> at the beggining of the file.</p>\n\n<pre><code>func find_package(node ast.Node) bool {\n    switch x := node.(type) {\n    // This works with *ast.Ident or *ast.FuncDecl ... but not\n    // with *ast.Package\n    case *ast.Package:\n        fmt.Print(x.Name)\n    }\n    return true\n}\n</code></pre>\n\n<p>I am looking for a clean way to do this with the <strong>ast package</strong>, I am almost sure I am just missing something in the documentation.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4222, "user_id": 2072269, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/xNPjb.png?s=128&g=1", "display_name": "muru", "link": "https://stackoverflow.com/users/2072269/muru"}, "edited": false, "score": 1, "creation_date": 1477980754, "post_id": 40354831, "comment_id": 67963566, "body": "Have you read <a href=\"https://gobyexample.com/panic\" rel=\"nofollow noreferrer\">gobyexample.com/panic</a>?"}, {"owner": {"reputation": 4197, "user_id": 1632346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c043a71ec4903a9a9e6a4de90c787fa1?s=128&d=identicon&r=PG", "display_name": "slomek", "link": "https://stackoverflow.com/users/1632346/slomek"}, "edited": false, "score": 1, "creation_date": 1477991161, "post_id": 40354831, "comment_id": 67967142, "body": "I&#39;m not sure why anybody would downvote a question like that. If you know something, you should answer, not criticise."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1478006566, "post_id": 40354831, "comment_id": 67974996, "body": "Also see <a href=\"https://golang.org/doc/effective_go.html#errors\" rel=\"nofollow noreferrer\">Effective Go: Errors</a>"}], "answers": [{"comments": [{"owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "edited": false, "score": 0, "creation_date": 1477997221, "post_id": 40354917, "comment_id": 67970241, "body": "I totally disagree with that error and exception are not comparable. In Go an error is a value, you can do whatever you want with it. An exception is only &quot;catchable&quot;."}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1478027826, "post_id": 40354917, "comment_id": 67987422, "body": "exceptions are values in most languages, it&#39;s just not idiomatic to return them in other languages.  I don&#39;t think it&#39;s a crazy comparison (maybe not an awesome one, but not crazy)"}], "tags": [], "owner": {"reputation": 1385, "user_id": 1261232, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e25f53bf53e2fc0b8976846d15c9256?s=128&d=identicon&r=PG", "display_name": "Alex Kapustin", "link": "https://stackoverflow.com/users/1261232/alex-kapustin"}, "is_accepted": false, "score": -2, "last_activity_date": 1477980364, "creation_date": 1477980364, "answer_id": 40354917, "question_id": 40354831, "link": "https://stackoverflow.com/questions/40354831/can-anyone-explain-the-exact-difference-between-panic-and-error-and-when-to-use/40354917#40354917", "title": "Can anyone explain the exact difference between panic and error and when to use each in go, with examples?", "body": "<p>you can compare them with <code>Exception</code>, <code>Error</code> it's just <code>Exception</code> object, but <code>panic(err)</code> it's <code>throw exceptionObject</code></p>\n"}, {"tags": [], "owner": {"reputation": 1189, "user_id": 3931609, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/4n2cW.jpg?s=128&g=1", "display_name": "Kul", "link": "https://stackoverflow.com/users/3931609/kul"}, "is_accepted": false, "score": 0, "last_activity_date": 1477980929, "creation_date": 1477980929, "answer_id": 40355003, "question_id": 40354831, "link": "https://stackoverflow.com/questions/40354831/can-anyone-explain-the-exact-difference-between-panic-and-error-and-when-to-use/40355003#40355003", "title": "Can anyone explain the exact difference between panic and error and when to use each in go, with examples?", "body": "<p>Think of it like this:</p>\n\n<p><code>panic()</code> (a verb) is an action</p>\n\n<p><code>error</code> (a noun) is an entity</p>\n\n<p>Once you have an <code>error</code>, you can do something with it (<code>panic()</code>ing is just one of many options here, others being ignoring the error, returning the error to the caller or taking some other error specific action)</p>\n\n<p>Note that you don't necessarily need an <code>error</code> to <code>panic()</code>.</p>\n"}], "owner": {"reputation": 399, "user_id": 6926514, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/0c42d56e0e17ee20ffaa03a0c89c0d17?s=128&d=identicon&r=PG&f=1", "display_name": "shagul", "link": "https://stackoverflow.com/users/6926514/shagul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 164, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1477981683, "creation_date": 1477979827, "last_edit_date": 1477980081, "question_id": 40354831, "link": "https://stackoverflow.com/questions/40354831/can-anyone-explain-the-exact-difference-between-panic-and-error-and-when-to-use", "title": "Can anyone explain the exact difference between panic and error and when to use each in go, with examples?", "body": "<p>I am researching the difference between panic and error for a long time but unfortunately I haven't found the exact answer. Can anyone help?</p>\n"}, {"tags": ["encryption", "go", "public-key-encryption"], "comments": [{"owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "edited": false, "score": 0, "creation_date": 1477966747, "post_id": 40353070, "comment_id": 67960800, "body": "If this is a serious project with substantial users you really need to get a cryptographic domain expert involved, security is very hard to get correct."}], "answers": [{"comments": [{"owner": {"reputation": 4581, "user_id": 1067688, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/56354de938252007e5bde9021ec5818c?s=128&d=identicon&r=PG", "display_name": "Anastasios Andronidis", "link": "https://stackoverflow.com/users/1067688/anastasios-andronidis"}, "edited": false, "score": 0, "creation_date": 1477982170, "post_id": 40353210, "comment_id": 67963925, "body": "Hi! Do you thing something like PGP would do the job for me? I see that golang supports a PGP implementation in its core library: <a href=\"https://godoc.org/golang.org/x/crypto/openpgp\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/crypto/openpgp</a>"}], "tags": [], "owner": {"reputation": 107760, "user_id": 451475, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a632afa4c11779c0cabd7df04eb26ba6?s=128&d=identicon&r=PG", "display_name": "zaph", "link": "https://stackoverflow.com/users/451475/zaph"}, "is_accepted": false, "score": 0, "last_activity_date": 1477966599, "last_edit_date": 1477966599, "creation_date": 1477966251, "answer_id": 40353210, "question_id": 40353070, "link": "https://stackoverflow.com/questions/40353070/proper-asymmetric-file-encryption-in-go/40353210#40353210", "title": "Proper asymmetric file encryption in Go", "body": "<p>If you need public key asymmetric encryption for data larger than the key size you need to use hybrid encryption. Essentially this is how HTTPS works.</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Hybrid_cryptosystem\" rel=\"nofollow\">Hybrid encryption</a> is where the data is encrypted with symmetric key encryption such as AES and that key is encrypted with asymmetric key encryption such as RSA or EC (<a href=\"https://en.wikipedia.org/wiki/Elliptic_curve_cryptography\" rel=\"nofollow\">Elliptic Curve</a>) Cryptography.</p>\n\n<p><strong>Do not</strong> break the file into multiple chunks and encrypt them. </p>\n"}, {"tags": [], "owner": {"reputation": 4581, "user_id": 1067688, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/56354de938252007e5bde9021ec5818c?s=128&d=identicon&r=PG", "display_name": "Anastasios Andronidis", "link": "https://stackoverflow.com/users/1067688/anastasios-andronidis"}, "is_accepted": true, "score": 0, "last_activity_date": 1502449293, "creation_date": 1502449293, "answer_id": 45633604, "question_id": 40353070, "link": "https://stackoverflow.com/questions/40353070/proper-asymmetric-file-encryption-in-go/45633604#45633604", "title": "Proper asymmetric file encryption in Go", "body": "<p>So I ended up using GPG and my service has one unique private key and I share the public one with my users.</p>\n"}], "owner": {"reputation": 4581, "user_id": 1067688, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/56354de938252007e5bde9021ec5818c?s=128&d=identicon&r=PG", "display_name": "Anastasios Andronidis", "link": "https://stackoverflow.com/users/1067688/anastasios-andronidis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1170, "favorite_count": 0, "accepted_answer_id": 45633604, "answer_count": 2, "score": 2, "last_activity_date": 1502449293, "creation_date": 1477964960, "last_edit_date": 1495540837, "question_id": 40353070, "link": "https://stackoverflow.com/questions/40353070/proper-asymmetric-file-encryption-in-go", "title": "Proper asymmetric file encryption in Go", "body": "<p>I need a way to allow multiple people encrypting various files but only one party been able to read them all. I wrote a program in Go by following various online examples but at some point I got the following error:</p>\n\n<p><code>Error from encryption: crypto/rsa: message too long for RSA public key size</code></p>\n\n<p>Is RSA the wrong way to go? Is it ok if I break the file into multiple chunks and encrypt them? Is there an asymmetric block cipher that I can easily use?</p>\n\n<p>I read the discussion <a href=\"https://stackoverflow.com/questions/14404757/how-to-encrypt-and-decrypt-plain-text-with-a-rsa-keys-in-go\">here</a> and it is said that RSA is not the proper way to go.</p>\n\n<p>Can you also provide with an example?</p>\n"}, {"tags": ["design-patterns", "go", "syntax"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1477951521, "post_id": 40350118, "comment_id": 67957092, "body": "see also <a href=\"http://stackoverflow.com/questions/40333799/abstracting-away-the-persistence-layer-in-go\" title=\"abstracting away the persistence layer in go\">stackoverflow.com/questions/40333799/&hellip;</a>. Short answer something like 2, so you can pass in a Tx rather than a DB, but see the previous link. also recommend <a href=\"http://go-database-sql.org/index.html\" rel=\"nofollow noreferrer\">go-database-sql.org/index.html</a>"}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 3955969, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xIY1I.png?s=128&g=1", "display_name": "fitzy101", "link": "https://stackoverflow.com/users/3955969/fitzy101"}, "is_accepted": false, "score": 0, "last_activity_date": 1477955442, "creation_date": 1477955442, "answer_id": 40351906, "question_id": 40350118, "link": "https://stackoverflow.com/questions/40350118/golang-live-connections-in-function/40351906#40351906", "title": "GoLang live connections in function", "body": "<p>A good practice is to pass a persistent DB around connection that is created on the start of your application. This connection will satisfy an interface for the subsequent DB calls that you make within your function. The reason you use an interface is to allow for interchanging the underlying DB and flexibility for testing within the application. </p>\n\n<p>For this example I'm using the <a href=\"https://github.com/jmoiron/sqlx\" rel=\"nofollow\">jmoiron/sqlx</a> package.</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n    \"github.com/jmoiron\"\n)\n\nfunc main() {\n    // Connect to the DB to create the persistent connection.\n    db := connDB()\n\n    // The sqlx.DB connection returned will satisfy the DB interface.\n    name, err := getRows(db)\n}\n\n// DB is required for functions interfacing with the database.\ntype DB interface {\n    Get(dest interface{}, q string, args ...interface{}) error\n    Select(dest interface{}, q string, args ...interface{}) error\n    Exec(q string, args ...interface{}) (sql.Result, error)\n}\n\n// connDB connects to the database and returns an active connection.\nfunc connDB() *sqlx.DB {\n    // Connect to the database and ping, confirming connection was made.\n    // Panic if the connection was not successful.\n    db, err := sqlx.Connect(\"mysql\", \"root:password@tcp(localhost)/default\")\n    if err != nil {\n        panic(err)\n    }\n    db.SetMaxIdleConns(10)\n    db.SetMaxOpenConns(60)\n    return db\n}\n\n// getRow will now be able to make DB calls.\nfunc getRow(database DB) (string, error) {\n    var name string\n    q := `SELECT name FROM user WHERE id=?;`\n    if err := database.Get(&amp;name, q, \"user123\"); err != nil {\n        return name, err\n    }\n\n    return name, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 3871958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb0d344cc413c461251b77236884561a?s=128&d=identicon&r=PG&f=1", "display_name": "lfirek", "link": "https://stackoverflow.com/users/3871958/lfirek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 743, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1477955442, "creation_date": 1477945864, "question_id": 40350118, "link": "https://stackoverflow.com/questions/40350118/golang-live-connections-in-function", "title": "GoLang live connections in function", "body": "<p>I had question about  better code usage in golang.</p>\n\n<p>What is the best case of usage live connection like database in few packages.</p>\n\n<p>It is better to add database connection like</p>\n\n<p>1.</p>\n\n<pre><code>func (database DB) getRows(){\n\n}\n</code></pre>\n\n<p>or \n2.</p>\n\n<pre><code>func getRows(database *DB){\n\n}\n</code></pre>\n\n<p>or\n3.</p>\n\n<pre><code>func getRows(){\n  init database connection...\n}\n</code></pre>\n\n<p>For 1 usage we need create local struct for DB</p>\n\n<pre><code>type DB struct{\nconnection\n}\n</code></pre>\n\n<p>in different package I need move DB connection with creating local struct in each package or when some package did not use database connection but imported package use? How to send one configuration and create only one connection? Singleton is good idea?</p>\n\n<p>Are you have any tips and trick for this case usage?</p>\n"}, {"tags": ["sql", "postgresql", "go", "pg"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 2, "creation_date": 1477950363, "post_id": 40349170, "comment_id": 67956689, "body": "&quot;In a reasonable language&quot; - your code snippet is ignoring good security practices regardless of language. Go not allowing it is a good thing."}, {"owner": {"reputation": 332, "user_id": 6546677, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/de651bfc703df6b36099a32d569d8737?s=128&d=identicon&r=PG&f=1", "display_name": "George H", "link": "https://stackoverflow.com/users/6546677/george-h"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1477953820, "post_id": 40349170, "comment_id": 67957790, "body": "Wait, why ? Those values aren&#39;t entered directly from the user&#39;s input, they pass a validity check (and some formatting beforehand). Should you guard against the SQL injection &quot;inside&quot; the queries ?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1477954874, "post_id": 40349170, "comment_id": 67958107, "body": "Perhaps your upstream formatting/validation is sufficient for making this safe, I can&#39;t really say based on what&#39;s here. That code smells though. I&#39;m sure there are some better ways of doing this, even if they&#39;re a bit more work. I would recommend against this dynamic query assembly for the sake of complexity alone. Wait til you have a defect and you&#39;re looking through the db&#39;s logs to see what queries were executed then trying to reproduce them in your app with specific inputs that cause it to form that query. You&#39;re better off with 10 sprocs than one 100 line function to generate queries imo"}], "answers": [{"comments": [{"owner": {"reputation": 332, "user_id": 6546677, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/de651bfc703df6b36099a32d569d8737?s=128&d=identicon&r=PG&f=1", "display_name": "George H", "link": "https://stackoverflow.com/users/6546677/george-h"}, "edited": false, "score": 0, "creation_date": 1477953869, "post_id": 40349377, "comment_id": 67957807, "body": "Thanks, answer I was looking for, Silly me forgot those were actually a thing. I guess that&#39;s what happens to my brain after using too many scripting languages..."}], "tags": [], "owner": {"reputation": 11, "user_id": 7053511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66cd35981be74eaf68a90f1802bb39a0?s=128&d=identicon&r=PG&f=1", "display_name": "Proton14", "link": "https://stackoverflow.com/users/7053511/proton14"}, "is_accepted": false, "score": 0, "last_activity_date": 1477942863, "creation_date": 1477942863, "answer_id": 40349377, "question_id": 40349170, "link": "https://stackoverflow.com/questions/40349170/go-and-multiline-argument-hell/40349377#40349377", "title": "Go and multiline argument hell", "body": "<p>Create a template:</p>\n\n<pre><code>`UPDATE %s_tags SET keys = keys || %d WHERE tag = %d; INSERT INTO %s ...;`\n</code></pre>\n\n<p>Then pass in the parameters.</p>\n\n<p>P.S. This can be vulnerable to ingestion attack, verify the values before plugging them in.</p>\n"}], "owner": {"reputation": 332, "user_id": 6546677, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/de651bfc703df6b36099a32d569d8737?s=128&d=identicon&r=PG&f=1", "display_name": "George H", "link": "https://stackoverflow.com/users/6546677/george-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1477942863, "creation_date": 1477941896, "question_id": 40349170, "link": "https://stackoverflow.com/questions/40349170/go-and-multiline-argument-hell", "title": "Go and multiline argument hell", "body": "<p>I was writting a wraper/validator over pg in go when I came upon a rather annoying thing... passing very long strings as argument.\nBasically I have this string:</p>\n\n<pre><code>\"UPDATE \" + m[\"table\"] + \"_tags SET keys = keys || ,\" + strconv.Itoa(key) + \" WHERE tag = \" + t + \";\" + \"INSERT INTO \"  m[\"table\"] + \"_tags (tag,keys) SELECT '\" + t + \"', '\" + strconv.Itoa(key) + \") WHERE NOT EXISTS(SELECT 1 FROM \" + m[\"table\"]\"_tags WHERE tag = \" + t + \");\"\n</code></pre>\n\n<p>Ok, big, unweildy, full of ' and  \"... hell on earth.\nBut that's how SQL queries look an quite frankly I can't think of a better way of dynamically composing them.</p>\n\n<p>So In a reasonable language like C++ this would simply work.\nIn JavaScript I'd add \"\\\" at the end of each... etc</p>\n\n<p>Is there such a mechanic in go ?\nI previously heard that adding \",\" at the end of each line is the equivalent of \\ in javascript but the documentation for this seems to be rather poorly written and most examples online cite things like:</p>\n\n<p>\"Change your SQL query\" (doable, but not exactly the solutiuon I want from a low-level language).\n\"Use ' at the beginning and end\"... but since there's no way to escape ' inside of ' that would be kind of hard (adding an additional 6* + operators) and I'm quite unsure if wrapping with ' works when I have + concatenations inside.\nSuggestions ?</p>\n\n<p>(Best I can come up with is construct the string outside the argument but once again that seems hack-ish)</p>\n"}, {"tags": ["database", "postgresql", "go", "database-connection", "sqlx"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1477944142, "post_id": 40348929, "comment_id": 67953839, "body": "can this help ? <a href=\"http://go-database-sql.org/surprises.html\" rel=\"nofollow noreferrer\">go-database-sql.org/surprises.html</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1287, "user_id": 837173, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/11e601e42c1f51c5f2626d7124323a3f?s=128&d=identicon&r=PG", "display_name": "Sean Lindo", "link": "https://stackoverflow.com/users/837173/sean-lindo"}, "is_accepted": false, "score": 0, "last_activity_date": 1478012518, "creation_date": 1478012518, "answer_id": 40362742, "question_id": 40348929, "link": "https://stackoverflow.com/questions/40348929/occasionally-retrieving-connection-timed-out-errors-when-querying-postgresql/40362742#40362742", "title": "Occasionally retrieving &quot;connection timed out&quot; errors when querying Postgresql", "body": "<p>With the help of some rough calculations, I've set the maximum lifetime of these connections to 10 minutes. I inserted this code into the init function in the question above to limit the number of open connections, idle connections, and to limit to the life of the connection to 30s. </p>\n\n<pre><code>db.SetConnMaxLifetime(time.Duration(30) * time.Second)\ndb.SetMaxOpenConns(20)\ndb.SetMaxIdleConns(20)\n</code></pre>\n\n<p>Hopefully this helps someone else. </p>\n\n<p><code>SELECT * FROM pg_stat_activity;</code> is great for nailing down connections as well.</p>\n"}], "owner": {"reputation": 1287, "user_id": 837173, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/11e601e42c1f51c5f2626d7124323a3f?s=128&d=identicon&r=PG", "display_name": "Sean Lindo", "link": "https://stackoverflow.com/users/837173/sean-lindo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1213, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1478012518, "creation_date": 1477940981, "last_edit_date": 1477944685, "question_id": 40348929, "link": "https://stackoverflow.com/questions/40348929/occasionally-retrieving-connection-timed-out-errors-when-querying-postgresql", "title": "Occasionally retrieving &quot;connection timed out&quot; errors when querying Postgresql", "body": "<p>I get this error every so often when utilizing sqlx with pgx, and I believe it's a configuration error on my end and a db concept I'm not grasping:</p>\n\n<p><code>error: 'write tcp [redacted-ip]:[redacted-port]-&gt;[redacted-ip]:[redacted-port]: write: connection timed out</code></p>\n\n<p>This occurs when attempting to read from the database. I init sqlx in the startup phase:</p>\n\n<pre><code>package main\n\nimport (\n    _ \"github.com/jackc/pgx/stdlib\"\n    \"github.com/jmoiron/sqlx\"\n)\n\n//NewDB attempts to connect to the DB\nfunc NewDB(connectionString string) (*sqlx.DB, error) {\n    db, err := sqlx.Connect(\"pgx\", connectionString)\n\n    if err != nil {\n        return nil, err\n    }\n\n    return db, nil\n}\n</code></pre>\n\n<p>Any structs responsible for interacting with the database have access to this pointer. The majority of them utilize <code>Select</code> or <code>Get</code>, and I understand those return connections to the pool on their own. There are two functions that use <code>Exec</code>, and they only return the result and error at the end of the function. </p>\n\n<h2>Other Notes</h2>\n\n<ul>\n<li>My Postgres db supports 100 <code>max_connections</code></li>\n<li>I only showed a few active connections at the time of this error</li>\n<li>I am not using <code>SetMaxIdleConnections</code> or <code>SetMaxOpenConnections</code></li>\n<li>Refreshing the page and triggering the request again always works</li>\n</ul>\n\n<p>Any tips on what might be happening here?</p>\n\n<p>EDIT: I did not mention this server is on compose.io, which in turn is hosted on AWS. Is it possible AWS turns these connections into zombies because they've been open for so long and the timeout occurs after unsuccessfully trying them one by one?</p>\n"}, {"tags": ["go", "middleware", "go-gin"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 1, "creation_date": 1477940805, "post_id": 40348661, "comment_id": 67952258, "body": "Pass in a factory rather than a model variable. <code>type ViewFactory func() interface{}</code>"}, {"owner": {"reputation": 182, "user_id": 1645774, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d7504e8755667e4c7b7b9fec6bd25892?s=128&d=identicon&r=PG", "display_name": "Nithin Mohan", "link": "https://stackoverflow.com/users/1645774/nithin-mohan"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1477941282, "post_id": 40348661, "comment_id": 67952477, "body": "I am sorry I didn&#39;t understand. Can please you explain more or give a link to read?"}], "answers": [{"comments": [{"owner": {"reputation": 182, "user_id": 1645774, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d7504e8755667e4c7b7b9fec6bd25892?s=128&d=identicon&r=PG", "display_name": "Nithin Mohan", "link": "https://stackoverflow.com/users/1645774/nithin-mohan"}, "edited": false, "score": 1, "creation_date": 1477945727, "post_id": 40349342, "comment_id": 67954662, "body": "This works perfectly. I found one more way though, Changing  a := reflect.New(reflect.TypeOf(v))         err:=c.Bind(&amp;a)  to a := reflect.New(reflect.TypeOf(v)).Interface()         err:=c.Bind(a)"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 182, "user_id": 1645774, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d7504e8755667e4c7b7b9fec6bd25892?s=128&d=identicon&r=PG", "display_name": "Nithin Mohan", "link": "https://stackoverflow.com/users/1645774/nithin-mohan"}, "edited": false, "score": 0, "creation_date": 1477946094, "post_id": 40349342, "comment_id": 67954843, "body": "I m afraid this works only for simple case like you presented earlier. I strongly suspect things will get way more complex if you encounter slices, maps, chans, or struct pointers."}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 0, "last_activity_date": 1477942649, "creation_date": 1477942649, "answer_id": 40349342, "question_id": 40348661, "link": "https://stackoverflow.com/questions/40348661/creating-a-variable-of-type-from-interface-in-golang/40349342#40349342", "title": "Creating a variable of type from interface in golang", "body": "<p>Clarify my comment,</p>\n\n<p>Instead of having the signature <code>func Validator(v interface{}) gin.HandlerFunc</code> for the MW, use <code>func Validator(f Viewfactory) gin.HandlerFunc</code></p>\n\n<p>Where <code>ViewFactory</code> if a function type such as <code>type ViewFactory func() interface{}</code></p>\n\n<p>the MW can be changed so</p>\n\n<pre><code>type ViewFactory func() interface{}\n\nfunc Validator(f ViewFactory) gin.HandlerFunc{\n    return func(c *gin.Context){\n        a := f()\n        err:=c.Bind(a) // I don t think you need to send by ref here, to check by yourself\n        if(err!=nil){\n            respondWithError(401, \"Login Error\", c)\n            return\n        }\n        c.Set(\"LoginForm\",a)\n        c.Next()\n    }\n}\n</code></pre>\n\n<p>You can write the router like this</p>\n\n<pre><code>type LoginForm struct{\n    Email string `json:\"email\" form:\"email\" binding:\"email,required\"`\n    Password string `json:\"password\" form:\"password\" binding:\"required\"`\n}\nfunc NewLoginForm() interface{} {\n   return &amp;LoginForm{}\n}\nrouter.POST(\"/login\",middlewares.Validator(NewLoginForm) ,controllers.Login)\n</code></pre>\n\n<p>Going further, i think you may have to find out about this later, once you have an <code>interface{}</code> value, you can make it back a <code>LoginForm</code> like this <code>v := some.(*LoginForm)</code>.</p>\n\n<p>Or like this for more security</p>\n\n<pre><code>if v, ok := some.(*LoginForm); ok {\n // v is a *LoginForm\n}\n</code></pre>\n\n<p>See golang type assertions for more in depth information.</p>\n"}], "owner": {"reputation": 182, "user_id": 1645774, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d7504e8755667e4c7b7b9fec6bd25892?s=128&d=identicon&r=PG", "display_name": "Nithin Mohan", "link": "https://stackoverflow.com/users/1645774/nithin-mohan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2575, "favorite_count": 0, "accepted_answer_id": 40349342, "answer_count": 1, "score": 2, "last_activity_date": 1477942649, "creation_date": 1477939875, "question_id": 40348661, "link": "https://stackoverflow.com/questions/40348661/creating-a-variable-of-type-from-interface-in-golang", "title": "Creating a variable of type from interface in golang", "body": "<p>I am trying to create validator/binder middleware in go using gin framework.</p>\n\n<p>This is the model</p>\n\n<pre><code>type LoginForm struct{\n    Email string `json:\"email\" form:\"email\" binding:\"email,required\"`\n    Password string `json:\"password\" form:\"password\" binding:\"required\"`\n}\n</code></pre>\n\n<p>Router</p>\n\n<pre><code>router.POST(\"/login\",middlewares.Validator(LoginForm{}) ,controllers.Login)\n</code></pre>\n\n<p>Middleware </p>\n\n<pre><code>func Validator(v interface{}) gin.HandlerFunc{\n    return func(c *gin.Context){\n        a := reflect.New(reflect.TypeOf(v))\n        err:=c.Bind(&amp;a)\n        if(err!=nil){\n            respondWithError(401, \"Login Error\", c)\n            return\n        }\n        c.Set(\"LoginForm\",a)\n        c.Next()\n    }\n}\n</code></pre>\n\n<p>I am very new to golang. I understand the problem is with the binding to the wrong variable.\nIs there any other way of solving this?</p>\n"}, {"tags": ["linux", "unix", "go", "pipe", "socketpair"], "owner": {"reputation": 218, "user_id": 3019120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5308caf334d5a410706905f99364377?s=128&d=identicon&r=PG&f=1", "display_name": "JQian", "link": "https://stackoverflow.com/users/3019120/jqian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 223, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1477937785, "creation_date": 1477936562, "last_edit_date": 1477937785, "question_id": 40347770, "link": "https://stackoverflow.com/questions/40347770/delay-in-read-write-pipe-when-many-requests-for-unix-pipe-sockerpair-communica", "title": "Delay in read/write pipe when many requests for unix pipe (sockerpair) communication in Golang", "body": "<p>I have a performance problem with sockerpair in Golang (also known as unix pipe inter-process communication).</p>\n\n<p>The delay would be very long, if there are many requests issued to pipe. One process sends out about 10K requests; and then the reader process of the pipe (sockerpair reader) would be stalled for long time. Right now, I am using <code>syscall.read()</code> and <code>syscall.write()</code>.</p>\n\n<p>Any suggestions that I can improve the read latency in the pipe? I have tried using <code>syscall.Recvmsg</code> and <code>syscall.Sendmsg</code>, but they are not help here as I am not familiar how to set the flag correctly.</p>\n\n<p>Following are stace logs, <em>For each line, first element is PID, second one is how much time spent on this instruction, third one is handler to the process, forth one is the operations</em>:</p>\n\n<p>Normal ones:</p>\n\n<pre><code>**13151** 0.000020 [00000000004f23c4] read(8, \n13496 0.000023 [000000000046bc07] select(0, NULL, NULL, NULL, {0, 3} \n13149 0.000020 [000000000046bc07] &lt;... select resumed&gt; ) = 0 (Timeout) &lt;0.000104&gt;\n13149 0.000026 [000000000046bc07] select(0, NULL, NULL, NULL, {0, 20} \n13496 0.000044 [000000000046bc07] &lt;... select resumed&gt; ) = 0 (Timeout) &lt;0.000077&gt;\n13496 0.000022 [000000000046c023] futex(0xc4204ae110, FUTEX_WAKE, 1) = 1 &lt;0.000018&gt;\n13495 0.000047 [000000000046c023] &lt;... futex resumed&gt; ) = 0 &lt;0.021090&gt;\n13149 0.000012 [000000000046bc07] &lt;... select resumed&gt; ) = 0 (Timeout) &lt;0.000117&gt;\n13495 0.000063 [000000000046c023] futex(0xc4204ae110, FUTEX_WAIT, 0, NULL \n13496 0.000033 [00000000004f23c4] write(2, \"2016/10/21 17:31:35 [/0-0] flush\"..., 55 \n13149 0.000023 [000000000046bc07] select(0, NULL, NULL, NULL, {0, 20} \n13496 0.000039 [00000000004f23c4] &lt;... write resumed&gt; ) = 55 &lt;0.000044&gt;\n13496 0.000030 [00000000004f23c4] write(8, \"\\20\\0\\0\\0\\0\\0\\0\\0a\\0\\0\\0\\0\\0\\0\\0\", 16) = 16 &lt;0.000023&gt;\n13149 0.000042 [000000000046bc07] &lt;... select resumed&gt; ) = 0 (Timeout) &lt;0.000100&gt;\n13496 0.000022 [000000000046c023] futex(0xc4204b8110, FUTEX_WAIT, 0, NULL \n**13151** 0.000016 [00000000004f23c4] &lt;... read resumed&gt; \"@\\0\\0\\0\\22\\0\\0\\0b\\0\\0\\0\\0\\0\\0\\0\\2\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\"..., 135168) = 64 &lt;0.000456&gt;\n</code></pre>\n\n<p>Abnormal (or long delay) ones:</p>\n\n<pre><code>13151 0.000005 [00000000004f23c4] read(8, \n13153 0.000008 [000000000046bc07] select(0, NULL, NULL, NULL, {0, 3} \n13149 0.000010 [000000000046bc07] select(0, NULL, NULL, NULL, {0, 20} \n13153 0.000061 [000000000046bc07] &lt;... select resumed&gt; ) = 0 (Timeout) &lt;0.000064&gt;\n13153 0.000012 [000000000046c023] futex(0xc42007a910, FUTEX_WAKE, 1) = 1 &lt;0.000010&gt;\n13158 0.000020 [000000000046c023] &lt;... futex resumed&gt; ) = 0 &lt;0.031368&gt;\n13149 0.000008 [000000000046bc07] &lt;... select resumed&gt; ) = 0 (Timeout) &lt;0.000095&gt;\n13158 0.000013 [000000000046c023] futex(0xc42007a910, FUTEX_WAIT, 0, NULL \n13153 0.000006 [00000000004f23c4] write(8, \"\\20\\0\\0\\0\\332\\377\\377\\377\\n\\0\\0\\0\\0\\0\\0\\0\", 16 \n13149 0.000008 [000000000046bc07] select(0, NULL, NULL, NULL, {0, 20} \n13153 0.000020 [00000000004f23c4] &lt;... write resumed&gt; ) = 16 &lt;0.000022&gt;\n13153 0.000028 [000000000046c023] futex(0xc4200e0110, FUTEX_WAIT, 0, NULL \n13149 0.000054 [000000000046bc07] &lt;... select resumed&gt; ) = 0 (Timeout) &lt;0.000085&gt;\n13149 0.000013 [000000000046bc07] select(0, NULL, NULL, NULL, {0, 20}) = 0 (Timeout) &lt;0.000084&gt;\n13149 0.000100 [000000000046bc07] select(0, NULL, NULL, NULL, {0, 20}) = 0 (Timeout) &lt;0.000083&gt;\n13149 0.000098 [000000000046bc07] select(0, NULL, NULL, NULL, {0, 20}) = 0 (Timeout) &lt;0.000083&gt;\n13149 0.000099 [000000000046bc07] select(0, NULL, NULL, NULL, {0, 20}) = 0 (Timeout) &lt;0.000083&gt;\n...... A lot more same record happens here.\n13149 0.000721 [000000000046bc07] select(0, NULL, NULL, NULL, {0, 1280}) = 0 (Timeout) &lt;0.001344&gt;\n13149 0.000098 [000000000046c023] futex(0x745b78, FUTEX_WAIT, 0, {60, 0} \n13151 30.186205 [00000000004f23c4] &lt;... read resumed&gt; \"P\\0\\2\\0\\20\\0\\0\\0\\v\\0\\0\\0\\0\\0\\0\\0\\2\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\"..., 135168) = 131152 &lt;30.201482&gt;\n</code></pre>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 2, "creation_date": 1477927963, "post_id": 40344965, "comment_id": 67945045, "body": "Among other things, you can try <code>go build -x</code> to see the exact command that produces this error."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1477928293, "post_id": 40344965, "comment_id": 67945244, "body": "It&#39;s the cgo invocation.   I&#39;m trying to write a modified cgo now that emits a more verbose error..."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1477929443, "post_id": 40344965, "comment_id": 67946016, "body": "If you look at main.cgo in the cgo source, it&#39;s failing on a line that <code>reflect.DeepEquals()</code> the two &quot;conflicting&quot; <code>Name</code> entries for <code>C.CString</code>.  I&#39;ve now printed out all of the human-readable (string, int, etc) fields of those two and their children/fields, and they all match exactly.   It&#39;s derping somewhere down in the bowels of an <code>ast.Expr</code> or possibly an <code>ast.FuncDecl</code>.   I&#39;m out of ideas.  =/"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1477930157, "post_id": 40344965, "comment_id": 67946481, "body": "Try looking through the C library source code looking for <code>CString</code> type? Maybe try <code>objdump -tT</code> on C .so/.a files? If you somehow managed to make a reproducing script, you could open an issue in the Go bug tracker."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1477930311, "post_id": 40344965, "comment_id": 67946575, "body": "Yeah, I&#39;m pretty sure it&#39;s a bug in cgo at this point but I don&#39;t want to source-dump 8k+ lines into the bug tracker.  Frustratingly Heisenbuggy!  (also:  I don&#39;t think the strings in the Name struct would match if it was a real redefinition... will check as you suggest tho!)"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1478023089, "post_id": 40344965, "comment_id": 67984922, "body": "I&#39;ve created <a href=\"https://github.com/golang/go/issues/17723\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/17723</a> with a verification (if not minimal) example uploaded to a git repo.   I will be adding bounty to this ASAP since it&#39;s a showstopper for me."}], "owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 289, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1477927007, "creation_date": 1477926482, "last_edit_date": 1477927007, "question_id": 40344965, "link": "https://stackoverflow.com/questions/40344965/debugging-inconsistent-definitions-error-in-go", "title": "Debugging &quot;inconsistent definitions&quot; error in Go", "body": "<p>I'm wrapping a large, complex library with a Go language binding.   At some point, I started getting the following strange error when I ran <code>go build</code>:</p>\n\n<pre><code> inconsistent definitions for C.CString\n</code></pre>\n\n<p>I do not, and the library does not define/redefine CString in any way.  </p>\n\n<p>I find I'm unable to make a MCVE demonstrating the problem (the code is thousands of lines), but I do have it down to happening/not-happening depending on the presence of a single line:</p>\n\n<pre><code> d := C.FunctionDefinedInLibHeader\n</code></pre>\n\n<p>Of course, if I try to reference this in a minimal example, it works fine.</p>\n\n<p>My question is:   <em>How can I attempt to debug this error?</em>  I tried using</p>\n\n<pre><code> go tool cgo\n</code></pre>\n\n<p>to generate the C sources, and nothing looked out of the ordinary (in particular <code>CString</code> is only ever called, not defined), and the sources compiled fine.   I just don't understand where that error message is coming from (it's not the C compiler, in particular), or what it even means. But when the C function is referenced in the code, it appears, and when it is not, the problem disappears.</p>\n\n<p>I know there is an <a href=\"https://github.com/golang/go/issues/8133\" rel=\"nofollow\">old Go bug</a> which produces a similar error, but in that case the duplicated definition is a library-defined symbol, not a basic cgo internal function.</p>\n"}, {"tags": ["arrays", "go", "slice", "portaudio"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1477923728, "post_id": 40343987, "comment_id": 67942303, "body": "<code>append</code> never re-writes existing data in the same array. <code>append</code> may need to allocate a new array when the slice doesn&#39;t have sufficient capacity, which of course requires <i>copying</i> the data to the new backing array. Is this what you&#39;re referring to?"}, {"owner": {"reputation": 1211, "user_id": 2292376, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/eKZJS.jpg?s=128&g=1", "display_name": "dh1tw", "link": "https://stackoverflow.com/users/2292376/dh1tw"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1477924059, "post_id": 40343987, "comment_id": 67942518, "body": "No, the data gets clearly overwritten. It is also my understand that append does not re-write data, but I&#39;m still facing the problem that after calling append in the callback, the existing data in the array is overwritten :-("}, {"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 0, "creation_date": 1477924831, "post_id": 40343987, "comment_id": 67943016, "body": "Maybe you could have some concurrent go routine that do this mess."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1477925024, "post_id": 40343987, "comment_id": 67943156, "body": "Please show an example of what you expect to see, and what you are seeing. You&#39;re appending <code>in</code> to the slice, then writing the error message if <code>in</code> is in the slice, which seems expected."}, {"owner": {"reputation": 1211, "user_id": 2292376, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/eKZJS.jpg?s=128&g=1", "display_name": "dh1tw", "link": "https://stackoverflow.com/users/2292376/dh1tw"}, "edited": false, "score": 0, "creation_date": 1477925897, "post_id": 40343987, "comment_id": 67943718, "body": "I couldn&#39;t find any usage of concurrent go coroutines in the portaudio library. I&#39;m also not using any go coroutines within the application itself"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1477927008, "post_id": 40343987, "comment_id": 67944429, "body": "Your output just looks like <code>in</code> contains the same values each time, not that the previous values are overwritten. <code>refpect.DeepEqual</code> isn&#39;t only checking for some sort of slice identity, it&#39;s iterating over each individual value."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1477927049, "post_id": 40343987, "comment_id": 67944458, "body": "I wonder if <code>portaudio</code> might be passing you the same slice every time (with different contents). Since you&#39;re putting the slice itself into <code>re.data</code>, every element might be a reference to the same slice. Try copying the data your callback receives instead."}, {"owner": {"reputation": 1211, "user_id": 2292376, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/eKZJS.jpg?s=128&g=1", "display_name": "dh1tw", "link": "https://stackoverflow.com/users/2292376/dh1tw"}, "edited": false, "score": 0, "creation_date": 1477933789, "post_id": 40343987, "comment_id": 67948575, "body": "Doesn&#39;t go copy everything by default?"}, {"owner": {"reputation": 1211, "user_id": 2292376, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/eKZJS.jpg?s=128&g=1", "display_name": "dh1tw", "link": "https://stackoverflow.com/users/2292376/dh1tw"}, "edited": false, "score": 0, "creation_date": 1477933944, "post_id": 40343987, "comment_id": 67948643, "body": "I updated the example code and the output to show that on each execution of the callback, the variable <code>in</code> contains different data. You can see clearly that for strange reasons, that original data in the <code>Redata.data</code> array gets overwritten."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1477935307, "post_id": 40343987, "comment_id": 67949368, "body": "@DH1TW: the portaudio package is reusing the slice that is being provided to the callback. You need to copy the data into your own slice."}], "answers": [{"comments": [{"owner": {"reputation": 1211, "user_id": 2292376, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/eKZJS.jpg?s=128&g=1", "display_name": "dh1tw", "link": "https://stackoverflow.com/users/2292376/dh1tw"}, "edited": false, "score": 0, "creation_date": 1477937411, "post_id": 40347721, "comment_id": 67950431, "body": "got it! Thanks for the code snippet @JimB ! I confirm, now the data gets properly appended to <code>RecData.data</code>! Thanks again for your help!"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1477939329, "post_id": 40347721, "comment_id": 67951519, "body": "Instead of appending to <code>buf</code> every time, I would make <code>buf</code> the appropriate size in the first place. That way, only one allocation will happen for <code>buf</code>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1477940261, "post_id": 40347721, "comment_id": 67952015, "body": "Actually I will change it to <code>make</code> in this example, but not quite for that reason (I usually just recommend people don&#39;t worry about it and use <code>append</code>, since it amortizes well and leaves cleaner code). Given the example data, the number allocations would be the same, except that we would be over-allocating memory, since the default <code>append</code> from 0 allocates a capacity of 2."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1477940879, "last_edit_date": 1477940879, "creation_date": 1477936365, "answer_id": 40347721, "question_id": 40343987, "link": "https://stackoverflow.com/questions/40343987/append-function-overwrites-existing-data-in-slice/40347721#40347721", "title": "Append function overwrites existing data in slice", "body": "<p>The buffer passed into the callback is reused by the portaudio package, so you are appending the same slice structure to your <code>data</code> slice. Each time the buffer allocated by portaudio overwrites the data, you see the results in every element of your <code>data</code> slice. </p>\n\n<p>You will need to allocate new slices and make a copy of the data:</p>\n\n<pre><code>func (re *RecData) record(in [][]float32) {\n    buf := make([][]float32, len(in))\n    for i, v := range in {\n        buf[i] = append([]float32(nil), v...)\n    }\n    re.data = append(re.data, buf)\n</code></pre>\n\n<p>Example: \n<a href=\"https://play.golang.org/p/cF57lQIZFU\" rel=\"nofollow\">https://play.golang.org/p/cF57lQIZFU</a></p>\n"}], "owner": {"reputation": 1211, "user_id": 2292376, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/eKZJS.jpg?s=128&g=1", "display_name": "dh1tw", "link": "https://stackoverflow.com/users/2292376/dh1tw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1833, "favorite_count": 1, "accepted_answer_id": 40347721, "answer_count": 1, "score": 3, "last_activity_date": 1477940879, "creation_date": 1477923303, "last_edit_date": 1477933735, "question_id": 40343987, "link": "https://stackoverflow.com/questions/40343987/append-function-overwrites-existing-data-in-slice", "title": "Append function overwrites existing data in slice", "body": "<p>I wrote a small application which records data from a sound card and stores the data in an array for later processing.</p>\n\n<p>Whenever new data is available, portaudio executes the callback <code>record</code>. Within the callback I append the data to the array <code>RecData.data</code>.</p>\n\n<p>The golang builtin function <code>append</code> adds as expected another element to the slice, <strong>but for whatever reason also overwrites all existing elements within the array with exactly the same data</strong>.</p>\n\n<p>I have been trying to isolate the problem for more than two days, without success.</p>\n\n<p>Here is a stripped down version of the code, which works and shows the problem: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n//    \"reflect\"\n\n    \"github.com/gordonklaus/portaudio\"\n)\n\ntype RecData struct{\n    data [][][]float32\n}\n\nfunc main() {\n\n    var inputChs int = 1\n    var outputChs int = 0\n    var samplingRate float64 = 48000\n    var framesPerBuffer int = 3 //for test purpose that low. Would normally be 1024 or 2048\n\n    rec := RecData{make([][][]float32, 0, 1000)}\n\n    portaudio.Initialize()\n\n    stream, err := portaudio.OpenDefaultStream(inputChs, outputChs, samplingRate, framesPerBuffer, rec.record)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    defer stream.Close()\n    stream.Start()\n    for {\n        time.Sleep(time.Millisecond * 10)\n    }\n}\n\n// callback which gets called when new data is in the buffer\nfunc (re *RecData)record(in [][]float32) {\n    fmt.Println(\"Received sound sample: \")\n    fmt.Println(in)\n    re.data = append(re.data, in)\n    fmt.Println(\"Content of RecData.data after adding received sound sample:\")\n    fmt.Println(re.data, \"\\n\")\n    time.Sleep(time.Millisecond * 500) //limit temporarily the amount of data read\n    // iterate over all recorded data and compare them\n    /*\n    for i, d := range re.data{\n        if reflect.DeepEqual(d, in){\n                fmt.Printf(\"Data at index %d is the same as the recorded one, but should not be!\\n\", i )\n        }\n    }*/\n}\n</code></pre>\n\n<p><strong>2. Update</strong></p>\n\n<p>This is the application output:</p>\n\n<pre><code>Received sound sample:\n[[0.71575254 1.0734825 0.7444282]]\nContent of RecData.data after adding received sound sample:\n[[[0.71575254 1.0734825 0.7444282]]]\n\nReceived sound sample:\n[[0.7555193 0.768355 0.6575008]]\nContent of RecData.data after adding received sound sample:\n[[[0.7555193 0.768355 0.6575008]] [[0.7555193 0.768355 0.6575008]]]\n\nReceived sound sample:\n[[0.7247052 0.68471473 0.6843796]]\nContent of RecData.data after adding received sound sample:\n[[[0.7247052 0.68471473 0.6843796]] [[0.7247052 0.68471473 0.6843796]] [[0.7247052 0.68471473 0.6843796]]]\n\nReceived sound sample:\n[[0.6996536 0.66283375 0.67252487]]\nContent of RecData.data after adding received sound sample:\n[[[0.6996536 0.66283375 0.67252487]] [[0.6996536 0.66283375 0.67252487]] [[0.6996536 0.66283375 0.67252487]] [[0.6996536 0.66283375 0.67252487]]]\n\n\n.... etc ....\n</code></pre>\n\n<p>As we one can see, over time, the size of the slice is growing, but instead of just appending the data, the data in the array gets also overwritten. </p>\n\n<p>This should not happen. <code>portaudio</code> provides in the callback a <code>[][]float32</code> with the audio sample recorded from the sound card. As you can see they are always different. </p>\n\n<p>As mentioned, the code above is a stripped down version of my application. Usually I would record lets say 5 seconds, and then perform a Fast Fourier Transformation (FFT) over the samples to calculate the spectrum. I left this part away since it has no impact on this particular problem.</p>\n\n<p>I would very much appreciate any help. Maybe somebody can point me out what I'm doing wrong.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "edited": false, "score": 0, "creation_date": 1477924309, "post_id": 40343515, "comment_id": 67942654, "body": "What&#39;s the panic log? Your code doesn&#39;t seem wrong, so we need more details on the panic."}, {"owner": {"reputation": 87, "user_id": 6579857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/049eb17d3d4bf8bffc2e188b41acf9c6?s=128&d=identicon&r=PG", "display_name": "Zender Fufikoff", "link": "https://stackoverflow.com/users/6579857/zender-fufikoff"}, "reply_to_user": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "edited": false, "score": 0, "creation_date": 1477924510, "post_id": 40343515, "comment_id": 67942776, "body": "&lt;pre&gt; [GIN-debug] GET    /example/log --&gt; main.logAllHandler (3 handlers) [GIN-debug] GET    /example/:id/log --&gt; main.logHandler (3 handlers) panic: wildcard route &#39;:id&#39; conflicts with existing children in path &#39;/example/:id/log&#39; &lt;code&gt;"}, {"owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "edited": false, "score": 0, "creation_date": 1477925695, "post_id": 40343515, "comment_id": 67943576, "body": "So /:id/log conflicts with /log, so I suggest to use /log/:id instead. I don&#39;t really know why it&#39;s a conflict."}, {"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "edited": false, "score": 1, "creation_date": 1477926942, "post_id": 40343515, "comment_id": 67944390, "body": "If you check <a href=\"https://github.com/julienschmidt/httprouter/issues/12\" rel=\"nofollow noreferrer\">this issue</a> on Github you will find you are not alone. I think it would better to change a gorilla product maybe <a href=\"http://www.gorillatoolkit.org/pkg/pat\" rel=\"nofollow noreferrer\">pat</a>."}], "answers": [{"comments": [{"owner": {"reputation": 121, "user_id": 990115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F0Bzk.jpg?s=128&g=1", "display_name": "sigit_prayoga", "link": "https://stackoverflow.com/users/990115/sigit-prayoga"}, "edited": false, "score": 0, "creation_date": 1477983900, "post_id": 40348077, "comment_id": 67964427, "body": "Nice explanation. However, you might want to consider <a href=\"https://goji.io/\" rel=\"nofollow noreferrer\">goji</a> I found this pretty useful."}], "tags": [], "owner": {"reputation": 16685, "user_id": 1229624, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/33221e57892f65c519a16ff5cd30f874?s=128&d=identicon&r=PG", "display_name": "Aminadav Glickshtein", "link": "https://stackoverflow.com/users/1229624/aminadav-glickshtein"}, "is_accepted": true, "score": 8, "last_activity_date": 1477937868, "last_edit_date": 1477937868, "creation_date": 1477937739, "answer_id": 40348077, "question_id": 40343515, "link": "https://stackoverflow.com/questions/40343515/how-to-handle-these-routes-example-log-and-example-id-log/40348077#40348077", "title": "How to handle these routes: /example/log and /example/:id/log?", "body": "<p>I have success to do it. Hope that it will help you:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/julienschmidt/httprouter\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc logAll(w http.ResponseWriter, r *http.Request, ps httprouter.Params) {\n    if ps.ByName(\"id\") == \"log\" {\n        fmt.Fprintf(w, \"Log All\")\n    }\n}\n\nfunc logSpecific(w http.ResponseWriter, r *http.Request, ps httprouter.Params) {\n    fmt.Fprintf(w, \"Log Specific, %s!\\n\", ps.ByName(\"id\"))\n}\n\nfunc main() {\n    router := httprouter.New()\n    router.GET(\"/example/:id\", logAll)\n    router.GET(\"/example/:id/log\", logSpecific)\n\n    log.Fatal(http.ListenAndServe(\":8081\", router))\n}\n</code></pre>\n\n<hr>\n\n<p>Example of running</p>\n\n<pre><code>$ curl http://127.0.0.1:8081/example/log\nLog All\n$ curl http://127.0.0.1:8081/example/abc/log\nLog Specific, abc!\n</code></pre>\n"}], "owner": {"reputation": 87, "user_id": 6579857, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/049eb17d3d4bf8bffc2e188b41acf9c6?s=128&d=identicon&r=PG", "display_name": "Zender Fufikoff", "link": "https://stackoverflow.com/users/6579857/zender-fufikoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2535, "favorite_count": 1, "accepted_answer_id": 40348077, "answer_count": 1, "score": 6, "last_activity_date": 1477937868, "creation_date": 1477921725, "last_edit_date": 1477936777, "question_id": 40343515, "link": "https://stackoverflow.com/questions/40343515/how-to-handle-these-routes-example-log-and-example-id-log", "title": "How to handle these routes: /example/log and /example/:id/log?", "body": "<p>I tried something like this:</p>\n\n<pre><code>router.GET(\"/example/log\", logAllHandler)\nrouter.GET(\"/example/:id/log\", logHandler)\n</code></pre>\n\n<p>But Gin does not allow this and panics upon start.</p>\n\n<p>An idea is write a middleware to handle this case, but ...</p>\n"}, {"tags": ["go", "interface", "type-conversion", "slice"], "comments": [{"owner": {"reputation": 371, "user_id": 3705827, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/2d9c312be4e26e1fadc5b7a10d161776?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3705827/alexander"}, "edited": false, "score": 0, "creation_date": 1477935027, "post_id": 40343471, "comment_id": 67949221, "body": "Actually my problem is that v is slice of pointers. After some investigate I think it&#39;s better iterate over collection in first place, at least implementation I&#39;ve seen used such approach. Some copy/paste boilerplate code, but I think it won&#39;t be a problem for now"}, {"owner": {"reputation": 13903, "user_id": 86388, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/cPl84.jpg?s=128&g=1", "display_name": "Tarion", "link": "https://stackoverflow.com/users/86388/tarion"}, "edited": false, "score": 1, "creation_date": 1545051574, "post_id": 40343471, "comment_id": 94479648, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/14025833/range-over-interface-which-stores-a-slice\">range over interface{} which stores a slice</a>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 10, "last_activity_date": 1477922314, "last_edit_date": 1477922314, "creation_date": 1477922004, "answer_id": 40343605, "question_id": 40343471, "link": "https://stackoverflow.com/questions/40343471/how-to-check-if-interface-is-a-slice/40343605#40343605", "title": "How to check if interface{} is a slice", "body": "<p>In your case the <a href=\"https://golang.org/ref/spec#Type_switches\" rel=\"noreferrer\">type switch</a> is the simplest and most convenient solution:</p>\n\n<pre><code>func name(v interface{}) {\n    switch x := v.(type) {\n    case []MyInterface:\n        fmt.Println(\"[]MyInterface, len:\", len(x))\n        for _, i := range x {\n            fmt.Println(i)\n        }\n    case MyInterface:\n        fmt.Println(\"MyInterface:\", x)\n    default:\n        fmt.Printf(\"Unsupported type: %T\\n\", x)\n    }\n}\n</code></pre>\n\n<p>The <code>case</code> branches enumerate the possible types, and inside them the <code>x</code> variable will already be of that type, so you can use it so.</p>\n\n<p>Testing it:</p>\n\n<pre><code>type MyInterface interface {\n    io.Writer\n}\n\nvar i MyInterface = os.Stdout\nname(i)\nvar s = []MyInterface{i, i}\nname(s)\nname(\"something else\")\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/ejuMh1ByhV\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>MyInterface: &amp;{0x1040e110}\n[]MyInterface, len: 2\n&amp;{0x1040e110}\n&amp;{0x1040e110}\nUnsupported type: string\n</code></pre>\n\n<p>For a single type check you may also use <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"noreferrer\">type assertion</a>:</p>\n\n<pre><code>if x, ok := v.([]MyInterface); ok {\n    // x is of type []MyInterface\n    for _, i := range x {\n        fmt.Println(i)\n    }\n} else {\n    // x is not of type []MyInterface or it is nil\n}\n</code></pre>\n\n<p>There are also other ways, using package <a href=\"https://golang.org/pkg/reflect/\" rel=\"noreferrer\"><code>reflect</code></a> you can write a more general (and slower) solution, but if you're just starting Go, you shouldn't dig into reflection yet.</p>\n"}, {"comments": [{"owner": {"reputation": 371, "user_id": 3705827, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/2d9c312be4e26e1fadc5b7a10d161776?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3705827/alexander"}, "edited": false, "score": 3, "creation_date": 1477934669, "post_id": 40344019, "comment_id": 67949026, "body": "Wondering why creators of fmt package didn&#39;t create print function for every   type?"}, {"owner": {"reputation": 371, "user_id": 3705827, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/2d9c312be4e26e1fadc5b7a10d161776?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3705827/alexander"}, "edited": false, "score": 0, "creation_date": 1477935388, "post_id": 40344019, "comment_id": 67949411, "body": "Thanks for interesting link."}, {"owner": {"reputation": 34006, "user_id": 20601, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z9vyi.png?s=128&g=1", "display_name": "Lucas Gabriel S&#225;nchez", "link": "https://stackoverflow.com/users/20601/lucas-gabriel-s%c3%a1nchez"}, "reply_to_user": {"reputation": 371, "user_id": 3705827, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/2d9c312be4e26e1fadc5b7a10d161776?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3705827/alexander"}, "edited": false, "score": 0, "creation_date": 1477937823, "post_id": 40344019, "comment_id": 67950657, "body": "@Alexander you have a somewhat &quot;print for every type&quot; implemented as the Print verbs: %s for strings,%p for pointers, %d for integers of base 10, etc, and you can use %s and implement your own String() string function to print your own type"}, {"owner": {"reputation": 465, "user_id": 10633734, "user_type": "registered", "profile_image": "https://graph.facebook.com/2240338519333236/picture?type=large", "display_name": "Daniel Titkov", "link": "https://stackoverflow.com/users/10633734/daniel-titkov"}, "edited": false, "score": 0, "creation_date": 1580227500, "post_id": 40344019, "comment_id": 106024657, "body": "Please mind that in this case you won&#39;t be able to directly pass into your function a slice of values, because slice of interfaces is not an interface: <a href=\"https://github.com/golang/go/wiki/InterfaceSlice\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/InterfaceSlice</a>"}], "tags": [], "owner": {"reputation": 34006, "user_id": 20601, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z9vyi.png?s=128&g=1", "display_name": "Lucas Gabriel S&#225;nchez", "link": "https://stackoverflow.com/users/20601/lucas-gabriel-s%c3%a1nchez"}, "is_accepted": false, "score": 2, "last_activity_date": 1477923427, "last_edit_date": 1495541956, "creation_date": 1477923427, "answer_id": 40344019, "question_id": 40343471, "link": "https://stackoverflow.com/questions/40343471/how-to-check-if-interface-is-a-slice/40344019#40344019", "title": "How to check if interface{} is a slice", "body": "<p><a href=\"https://stackoverflow.com/a/40343605/20601\">icza's answer</a> is correct, but is not recommended by <a href=\"https://youtu.be/PAAkCSZUG1c?t=7m35s\" rel=\"nofollow noreferrer\">go creators</a>:</p>\n\n<blockquote>\n  <p>interface{} says nothing</p>\n</blockquote>\n\n<p>A better approach may be to define a function for each type you have:</p>\n\n<pre><code>func name(v MyInterface) {\n    // do something\n}\n\nfunc names(vs []MyInterface) {\n    for _, v := range(vs) {\n        name(v)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 314, "user_id": 5785894, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-yoYgE_FaThU/AAAAAAAAAAI/AAAAAAAAA4Y/IfSS0h0M-8A/photo.jpg?sz=128", "display_name": "Cal", "link": "https://stackoverflow.com/users/5785894/cal"}, "is_accepted": false, "score": 0, "last_activity_date": 1604449634, "creation_date": 1604449634, "answer_id": 64672673, "question_id": 40343471, "link": "https://stackoverflow.com/questions/40343471/how-to-check-if-interface-is-a-slice/64672673#64672673", "title": "How to check if interface{} is a slice", "body": "<p>From <a href=\"https://blog.golang.org/json\" rel=\"nofollow noreferrer\">https://blog.golang.org/json</a></p>\n<p>Decoding arbitrary data</p>\n<p>Consider this JSON data, stored in the variable b:</p>\n<pre><code>b := []byte(`{&quot;Name&quot;:&quot;Wednesday&quot;,&quot;Age&quot;:6,&quot;Parents&quot;:[&quot;Gomez&quot;,&quot;Morticia&quot;]}`)\n</code></pre>\n<p>Without knowing this data's structure, we can decode it into an interface{} value with Unmarshal:</p>\n<p>var f interface{}\nerr := json.Unmarshal(b, &amp;f)\nAt this point the Go value in f would be a map whose keys are strings and whose values are themselves stored as empty interface values:</p>\n<pre><code>f = map[string]interface{}{\n    &quot;Name&quot;: &quot;Wednesday&quot;,\n    &quot;Age&quot;:  6,\n    &quot;Parents&quot;: []interface{}{\n        &quot;Gomez&quot;,\n        &quot;Morticia&quot;,\n    },\n}\n</code></pre>\n<p>To access this data we can use a type assertion to access f's underlying map[string]interface{}:</p>\n<pre><code>m := f.(map[string]interface{})\n</code></pre>\n<p>We can then iterate through the map with a range statement and use a type switch to access its values as their concrete types:</p>\n<pre><code>for k, v := range m {\n    switch vv := v.(type) {\n    case string:\n        fmt.Println(k, &quot;is string&quot;, vv)\n    case float64:\n        fmt.Println(k, &quot;is float64&quot;, vv)\n    case []interface{}:\n        fmt.Println(k, &quot;is an array:&quot;)\n        for i, u := range vv {\n            fmt.Println(i, u)\n        }\n    default:\n        fmt.Println(k, &quot;is of a type I don't know how to handle&quot;)\n    }\n}\n</code></pre>\n<p>In this way you can work with unknown JSON data while still enjoying the benefits of type safety.</p>\n"}, {"tags": [], "owner": {"reputation": 1466, "user_id": 2341189, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/7bef4a547645bcede5f171c52a831cc8?s=128&d=identicon&r=PG", "display_name": "pratpor", "link": "https://stackoverflow.com/users/2341189/pratpor"}, "is_accepted": false, "score": 0, "last_activity_date": 1612343759, "creation_date": 1612343759, "answer_id": 66024433, "question_id": 40343471, "link": "https://stackoverflow.com/questions/40343471/how-to-check-if-interface-is-a-slice/66024433#66024433", "title": "How to check if interface{} is a slice", "body": "<p>The <code>is_slice</code> method can be something like this:</p>\n<pre><code>func IsSlice(v interface{}) bool {\n    return reflect.TypeOf(v).Kind() == reflect.Slice\n}\n</code></pre>\n<p>Can also put additional condition of <code>reflect.TypeOf(v).Kind() == reflect.Array</code> if required.</p>\n"}], "owner": {"reputation": 371, "user_id": 3705827, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/2d9c312be4e26e1fadc5b7a10d161776?s=128&d=identicon&r=PG&f=1", "display_name": "Alexander", "link": "https://stackoverflow.com/users/3705827/alexander"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12068, "favorite_count": 1, "answer_count": 4, "score": 8, "last_activity_date": 1612343759, "creation_date": 1477921542, "last_edit_date": 1477922446, "question_id": 40343471, "link": "https://stackoverflow.com/questions/40343471/how-to-check-if-interface-is-a-slice", "title": "How to check if interface{} is a slice", "body": "<p>I'm noob in Go :) so my question may be stupid, but can't find answer, so.</p>\n\n<p>I need a function:</p>\n\n<pre><code>func name (v interface{}) {\n    if is_slice() {\n        for _, i := range v {\n            my_var := i.(MyInterface)\n            ... do smth\n        }\n    } else {\n        my_var := v.(MyInterface)\n        ... do smth\n    }\n}\n</code></pre>\n\n<p>How can I do <code>is_slice</code> in Go? Appreciate any help.</p>\n"}, {"tags": ["date", "go", "time"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1477919493, "creation_date": 1477919493, "answer_id": 40342900, "question_id": 40342780, "link": "https://stackoverflow.com/questions/40342780/parsing-time-string-in-go/40342900#40342900", "title": "Parsing time string in Go", "body": "<p>You're trying to parse that time as <code>time.RFC3339Nano</code>, which it is not. </p>\n\n<p>Use the format <code>\"2006-01-02T15:04:05.999MST\"</code></p>\n\n<p><a href=\"https://play.golang.org/p/TYHnvclxEn\" rel=\"nofollow\">https://play.golang.org/p/TYHnvclxEn</a></p>\n"}], "owner": {"reputation": 3, "user_id": 3204144, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PRb4P.jpg?s=128&g=1", "display_name": "bearproof", "link": "https://stackoverflow.com/users/3204144/bearproof"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 678, "favorite_count": 0, "accepted_answer_id": 40342900, "answer_count": 1, "score": -1, "last_activity_date": 1477919493, "creation_date": 1477919104, "question_id": 40342780, "link": "https://stackoverflow.com/questions/40342780/parsing-time-string-in-go", "title": "Parsing time string in Go", "body": "<p>The Spark Rest API returns time in this format: <code>2016-10-28T16:56:50.497GMT</code>. </p>\n\n<p>I'm trying to parse that in Go, without any luck. \nI keep getting <code>0001-01-01 00:00:00 +0000 UTC</code>, but the <code>time.Parse</code> function doesn't throw any errors:</p>\n\n<p>My function looks like this:</p>\n\n<pre><code>func getTime(timeStamp string) (t time.Time, e error) {\n    t, e = time.Parse(\n        time.RFC3339Nano,\n        timeStamp)\n    if e != nil {\n        fmt.Errorf(\"Error parsing timestring\", e)\n    }\n    return t, e\n}\n</code></pre>\n\n<p>I've tried going through the documentation and created my custom layout, but I can't figure out how I should treat that <code>GMT</code> part of the string </p>\n"}, {"tags": ["performance", "go", "cpu-usage"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 3921154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bd2060b2215bb8b8ebf8c9622cb9644?s=128&d=identicon&r=PG&f=1", "display_name": "freezingfire", "link": "https://stackoverflow.com/users/3921154/freezingfire"}, "edited": false, "score": 0, "creation_date": 1477919315, "post_id": 40342492, "comment_id": 67939705, "body": "Thanks for the reply, so I tried your suggestion -&gt; convert string to byte slice, this does improve performance but doesn&#39;t seem to decrease cpu usage"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 23, "user_id": 3921154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bd2060b2215bb8b8ebf8c9622cb9644?s=128&d=identicon&r=PG&f=1", "display_name": "freezingfire", "link": "https://stackoverflow.com/users/3921154/freezingfire"}, "edited": false, "score": 0, "creation_date": 1477921086, "post_id": 40342492, "comment_id": 67940736, "body": "@freezingfire See edited answer for addressing additional performance issues."}, {"owner": {"reputation": 23, "user_id": 3921154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bd2060b2215bb8b8ebf8c9622cb9644?s=128&d=identicon&r=PG&f=1", "display_name": "freezingfire", "link": "https://stackoverflow.com/users/3921154/freezingfire"}, "edited": false, "score": 0, "creation_date": 1478020480, "post_id": 40342492, "comment_id": 67983354, "body": "The RandStringBytes() just fills up a byteslice with random data and I have no other handlers in this program, nor a firewall or antivirus. In the end I ended up creating a 100Mb random file and using http.ServeContent to deliver it. Now the maximum CPU I get is 60% which is a drastic improvement from 150%."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 6, "last_activity_date": 1477941423, "last_edit_date": 1477941423, "creation_date": 1477918052, "answer_id": 40342492, "question_id": 40342340, "link": "https://stackoverflow.com/questions/40342340/golang-high-cpu-usage-on-simple-webserver-unable-to-understand-why/40342492#40342492", "title": "Golang high cpu usage on simple webserver unable to understand why?", "body": "<p>The problem is that <a href=\"https://golang.org/pkg/fmt/#Fprintf\" rel=\"nofollow\"><code>fmt.Fprintf()</code></a> expects a <em>format string</em>:</p>\n\n<pre><code>func Fprintf(w io.Writer, format string, a ...interface{}) (n int, err error)\n</code></pre>\n\n<p>And you pass it a big, 8 KB format string. The <code>fmt</code> package has to analyze the format string, it is not something that gets to the output as is. Most definately this is what is eating your CPU.</p>\n\n<p>If the random string contains the special <code>%</code> sign, that even makes your case worse, as then <code>fmt.Fprintf()</code> might expect further arguments which you don't \"deliver\", so the <code>fmt</code> package also has to (will) include error messages in the output, such as:</p>\n\n<pre><code>fmt.Fprintf(os.Stdout, \"aaa%bbb%d\")\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>aaa%!b(MISSING)bb%!d(MISSING)\n</code></pre>\n\n<p>Use <a href=\"https://golang.org/pkg/fmt/#Fprint\" rel=\"nofollow\"><code>fmt.Fprint()</code></a> instead which does not expect a format string:</p>\n\n<pre><code>fmt.Fprint(w, str)\n</code></pre>\n\n<p>Or even better, convert your random string to a byte slice once, and just keep writing that:</p>\n\n<pre><code>data := []byte(str)\nfor i := 0; i &lt; iter; i++ {\n    if _, err := w.Write(data); err != nil {\n        // Handle error, e.g. return\n    }\n}\n</code></pre>\n\n<p>Delivering large amount of data \u2013 you won't get a faster solution than writing a prepared byte slice in a loop (maybe slightly if you vary the size of the slice). If your solution is still \"slow\", that might be due to your <code>RandStringBytes()</code> function which we don't know anything about, or your output might be compressed (gzipped) if you use other handlers or some framework (which does use relatively high CPU). Also if the client that receives the response is also on your computer (e.g. a browser), it \u2013or a firewall / antivirus software\u2013 may check / analyze the response for malicious code (which may also be resource intensive).</p>\n"}], "owner": {"reputation": 23, "user_id": 3921154, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7bd2060b2215bb8b8ebf8c9622cb9644?s=128&d=identicon&r=PG&f=1", "display_name": "freezingfire", "link": "https://stackoverflow.com/users/3921154/freezingfire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 944, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1477941423, "creation_date": 1477917443, "last_edit_date": 1477917754, "question_id": 40342340, "link": "https://stackoverflow.com/questions/40342340/golang-high-cpu-usage-on-simple-webserver-unable-to-understand-why", "title": "Golang high cpu usage on simple webserver unable to understand why?", "body": "<p>So I have a simple net/http webserver. All it does is is deliver 100MB of random bytes, which I intend to use for network speed testing. My handler for the 100mb endpoint is really simple (pasted below). The code works fine and I get my random byte file, the problem is when I run this and someone downloads these 100megabytes, the CPU for this program shoots up to 150% and stays there until this handler finishes running. Am I doing something very wrong here? What could I do to improve this handler's performance?       </p>\n\n<pre><code>func downloadHandler(w http.ResponseWriter, r *http.Request) {\n    str := RandStringBytes(8192); //generates 8192 bytes of randomness\n    sz := 1000*1000*100; //100Megabytes\n    iter := sz/len(str)+1;\n    w.Header().Set(\"Content-Type\", \"application/octet-stream\")\n    w.Header().Set(\"Content-Length\", strconv.Itoa( sz ))\n    for i := 0; i &lt; iter ; i++ {\n        fmt.Fprintf(w, str )\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "gdb", "codenvy"], "comments": [{"owner": {"reputation": 1277, "user_id": 1737811, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/ab510b7d0d145c538fcc7638395ee703?s=128&d=identicon&r=PG", "display_name": "mutantkeyboard", "link": "https://stackoverflow.com/users/1737811/mutantkeyboard"}, "edited": false, "score": 0, "creation_date": 1478023882, "post_id": 40341487, "comment_id": 67985369, "body": "Is there a code sample you try to debug? On their website it states like       &gt; GDB does not understand Go programs well. Link <a href=\"https://golang.org/doc/gdb\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "reply_to_user": {"reputation": 1277, "user_id": 1737811, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/ab510b7d0d145c538fcc7638395ee703?s=128&d=identicon&r=PG", "display_name": "mutantkeyboard", "link": "https://stackoverflow.com/users/1737811/mutantkeyboard"}, "edited": false, "score": 0, "creation_date": 1478026203, "post_id": 40341487, "comment_id": 67986583, "body": "Yes, it is the template for go. It is called &quot;web-go-simple&quot; and it runs fine - but no debugging. The strange thing is that I have emailed with a CEO from Codenvy and he tells me that it works - but he don&#39;t have time to write down the steps? Hmm"}], "owner": {"reputation": 18037, "user_id": 699215, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/dac451eeb6941e002e455f5a4e48bf9b?s=128&d=identicon&r=PG", "display_name": "Chris G.", "link": "https://stackoverflow.com/users/699215/chris-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1477915862, "creation_date": 1477914134, "last_edit_date": 1477915862, "question_id": 40341487, "link": "https://stackoverflow.com/questions/40341487/codenvy-gdb-debugger-for-go", "title": "codenvy gdb debugger for go", "body": "<p>I got at reply from Codenvy that gdb debugging go(lang)is working, but no documentations on how to - and I can not find any documentations on this. I got this <a href=\"https://eclipse-che.readme.io/docs/debug#gdb\" rel=\"nofollow\">link</a> from Codenvy.</p>\n\n<p>The Codenvy docs do not describe how, just that it can.</p>\n\n<p>Can you, and if so please provide the steps - just for the web-go-simple app?</p>\n\n<p>I just want to verify myself that it works with the sample app template \"web-go-simple\" before moving.</p>\n\n<p>Notes: Compiling with: <code>go build -ldflags \"-w\"</code> and not -g for Java as the doc says.</p>\n\n<p>Also the GOPATH is <code>/go</code> and the run command is <code>cd /projects/web-go-simple &amp;&amp; go get -d &amp;&amp; go run -g main.go</code>. I might be that they have set it up without <code>go install</code> or <code>\"go build\"</code>.</p>\n"}, {"tags": ["go", "docker"], "answers": [{"comments": [{"owner": {"reputation": 905, "user_id": 2323245, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/692ba01c39a0306d91a706c1273ca840?s=128&d=identicon&r=PG", "display_name": "sbouaked", "link": "https://stackoverflow.com/users/2323245/sbouaked"}, "edited": false, "score": 0, "creation_date": 1477919313, "post_id": 40341660, "comment_id": 67939702, "body": "Thx for the response, I tried to use your Dockerfile, but when i run the docker run command, it&#39;s look like the GOPATH is not set. <code>Error response from daemon: oci runtime error: exec: &quot;$GOPATH&#47;src&#47;app&#47;myapp&quot;: stat $GOPATH&#47;src&#47;app&#47;myapp: no such file or directory.</code>"}, {"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "reply_to_user": {"reputation": 905, "user_id": 2323245, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/692ba01c39a0306d91a706c1273ca840?s=128&d=identicon&r=PG", "display_name": "sbouaked", "link": "https://stackoverflow.com/users/2323245/sbouaked"}, "edited": false, "score": 0, "creation_date": 1477921472, "post_id": 40341660, "comment_id": 67940953, "body": "fixed the Dockerfile ($GOPATH isn&#39;t available to CMD).  also added a complete working example (now that I am at work with a laptop)."}], "tags": [], "owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "is_accepted": true, "score": 4, "last_activity_date": 1477927519, "last_edit_date": 1495541816, "creation_date": 1477914891, "answer_id": 40341660, "question_id": 40340860, "link": "https://stackoverflow.com/questions/40340860/godep-vendor-with-docker/40341660#40341660", "title": "godep vendor with docker", "body": "<p>The error is correct.  It is telling you everything an aspiring Gopher needs.</p>\n\n<p>I am going to assume that you have copied Gorilla Mux to your app's /vendor directory in your local machine, like so:</p>\n\n<pre><code>./main.go # this is your myapp code you are coping\n./vendor/github.com/gorilla/mux # for vendoring, this must exist\n</code></pre>\n\n<p>If you want to learn more about vendoring, see my popular answer here:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/37237036/how-should-i-use-vendor-in-go-1-6/37238226#37238226\">How should I use vendor in Go 1.6?</a></p>\n\n<p>Now, to fix that error assuming you have done the above...  </p>\n\n<p>A Gopher needs to set a valid <code>$GOPATH</code> before you can build.  This is missing from your Dockerfile.</p>\n\n<pre><code>FROM golang:1.7-alpine \nEXPOSE 8080\n\n# setup GOPATH and friends\n#\n# TECHNICALLY, you don't have to do these three cmds as the \n# golang:alpine image actually uses this same directory structure and\n# already has $GOPATH set to this same structure.  You could just\n# remove these two lines and everything below should continue to work.\n#\n# But, I like to do it anyways to ensure my proper build\n# path in case I experiment with different Docker build images or in\n# case the #latest image changes structure (you should really use\n# a tag to lock down what version of Go you are using - note that I\n# locked you to the docker image golang:1.7-alpine above, since that is\n# the current latest you were using, with bug fixes).\n#\nRUN  mkdir -p /go/src \\\n  &amp;&amp; mkdir -p /go/bin \\\n  &amp;&amp; mkdir -p /go/pkg\nENV GOPATH=/go\nENV PATH=$GOPATH/bin:$PATH   \n\n# now copy your app to the proper build path\nRUN mkdir -p $GOPATH/src/app \nADD . $GOPATH/src/app\n\n# should be able to build now\nWORKDIR $GOPATH/src/app \nRUN go build -o myapp . \nCMD [\"/go/src/app/myapp\"]\n</code></pre>\n\n<p>Here it is working...</p>\n\n<pre><code>$ tree\n.\n\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 main.go\n\u2514\u2500\u2500 vendor\n    \u2514\u2500\u2500 mydep\n        \u2514\u2500\u2500 runme.go\n</code></pre>\n\n<p>The source file of my app:</p>\n\n<pre><code>$ cat main.go\npackage main\n\nimport (\n        \"fmt\"\n\n        \"mydep\"\n)\n\nfunc main() {\n        fmt.Println(mydep.RunMe())\n}\n</code></pre>\n\n<p>My dependency in my <code>vendor/</code> folder:</p>\n\n<pre><code>$ cat vendor/mydep/runme.go\npackage mydep\n\n// RunMe returns a string that it worked!\nfunc RunMe() string {\n        return \"Dependency Worked!\"\n}\n</code></pre>\n\n<p>Now, build and run the image:</p>\n\n<pre><code>$ docker build --rm -t test . &amp;&amp; docker run --rm -it test\n(snip)\nStep 8 : WORKDIR $GOPATH/src/app\n ---&gt; Using cache\n ---&gt; 954ed8e87ae0\nStep 9 : RUN go build -o myapp .\n ---&gt; Using cache\n ---&gt; b4b613f0a939\nStep 10 : CMD /go/src/app/myapp\n ---&gt; Using cache\n ---&gt; 3524025080df\nSuccessfully built 3524025080df\nDependency Worked!\n</code></pre>\n\n<p>Note the last line that prints the output from console, <code>Dependency Worked!</code>.  </p>\n\n<p>It works because:</p>\n\n<ol>\n<li>you stated you are using Vendoring, which means you have a local directory called <code>./vendor</code> in the root of your application code.</li>\n<li>when you <code>ADD . /go/src/app</code>, you are also copying the <code>./vendor</code> local to your application code.</li>\n<li>you have copied your files into the proper <code>$GOPATH</code> setup structure required by the Go build tools to find packages (and in this case, the <code>./vendor</code> directory within your source code's root folder).</li>\n</ol>\n"}], "owner": {"reputation": 905, "user_id": 2323245, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/692ba01c39a0306d91a706c1273ca840?s=128&d=identicon&r=PG", "display_name": "sbouaked", "link": "https://stackoverflow.com/users/2323245/sbouaked"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5246, "favorite_count": 2, "accepted_answer_id": 40341660, "answer_count": 1, "score": 6, "last_activity_date": 1477927519, "creation_date": 1477911735, "question_id": 40340860, "link": "https://stackoverflow.com/questions/40340860/godep-vendor-with-docker", "title": "godep vendor with docker", "body": "<p>I'm trying to run a docker container with vendor.\nThis is my Dockerfile </p>\n\n<pre><code>FROM golang:alpine \nEXPOSE 8080\n\nRUN mkdir /app \nADD . /app/ \nWORKDIR /app \nRUN go build -o myapp . \nCMD [\"/app/myapp\"]\n</code></pre>\n\n<p>and my main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\nfunc main() {\n\n    r := mux.NewRouter()\n    r.HandleFunc(\"/\", Hello)\n\n    http.Handle(\"/\", r)\n    fmt.Println(\"Starting up on 8080\")\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n\nfunc Hello(w http.ResponseWriter, req *http.Request) {\n    fmt.Fprintln(w, \"Hello world!\")\n}\n</code></pre>\n\n<p>I'm using godep for vendoring libs, it's working in my local machine, but when i'm trying to run it with docker with :</p>\n\n<pre><code>docker build -t myapp-img .\ndocker run -p 8080:8080 --name myapp-cnt myapp-img\n</code></pre>\n\n<p>I have the following error :</p>\n\n<pre><code>main.go:8:2: cannot find package \"github.com/gorilla/mux\" in any of:\n        /usr/local/go/src/github.com/gorilla/mux (from $GOROOT)\n        /go/src/github.com/gorilla/mux (from $GOPATH)\n</code></pre>\n\n<p>I don't understand what is missing. </p>\n"}, {"tags": ["testing", "go", "interface", "mocking"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1477903840, "post_id": 40338890, "comment_id": 67932251, "body": "No need to mock something that has exported fields: Just make yourself a github.Client."}, {"owner": {"reputation": 1829, "user_id": 271789, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/6932023eeb2a104850f74c77854e22fb?s=128&d=identicon&r=PG", "display_name": "zefciu", "link": "https://stackoverflow.com/users/271789/zefciu"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1477904551, "post_id": 40338890, "comment_id": 67932548, "body": "But I don&#39;t want a real github.Client that connects to the API. I want something that returns static data."}, {"owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "edited": false, "score": 1, "creation_date": 1477904996, "post_id": 40338890, "comment_id": 67932763, "body": "One way to achieve this would be to declare your own interface. Then just implement it with two different structs, the first one simply recall the github API, and the other one is your fake one."}, {"owner": {"reputation": 1829, "user_id": 271789, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/6932023eeb2a104850f74c77854e22fb?s=128&d=identicon&r=PG", "display_name": "zefciu", "link": "https://stackoverflow.com/users/271789/zefciu"}, "edited": false, "score": 0, "creation_date": 1477905170, "post_id": 40338890, "comment_id": 67932839, "body": "Yes, that&#39;s what I want to do. But can I declare a field in the interface? IIUC only methods can be declared in interfaces."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1477905488, "post_id": 40338890, "comment_id": 67932997, "body": "so wrap it in an interface that can be mocked, or use a client that lends itself better to mocking and doesn&#39;t do this."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1477937576, "post_id": 40338890, "comment_id": 67950518, "body": "This reads a bit like an X-Y problem. If you need to mock the logic of your dependencies, to unit test your own code, you may just need to rethink your basic design. If you want to test how your code handles static data, you should separate out the data-processing logic in a way that makes it testable, in a way that you can feed it static mock data. Not by passing an instance of a dependency, used to retrieve that data. Just get the data from the client, and pass it to your code. In your test, pass diferent data to the same code and make sure it behaves as expected"}, {"owner": {"reputation": 1829, "user_id": 271789, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/6932023eeb2a104850f74c77854e22fb?s=128&d=identicon&r=PG", "display_name": "zefciu", "link": "https://stackoverflow.com/users/271789/zefciu"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1478081465, "post_id": 40338890, "comment_id": 68006636, "body": "@EliasVanOotegem I thought about it. But the lack of separation of of data retrieval and handling allows me to only call the API requests that I need. Which is good due to limits. Thanks however."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 1, "creation_date": 1478084561, "post_id": 40338890, "comment_id": 68008592, "body": "@zefciu: Wouldn&#39;t wrapping the operations into custom functions be an option? ie <code>var callDependency = func (client *github.Client) (*wrappedGithubResponse, error) {}</code>, and just override those functions in your test?"}, {"owner": {"reputation": 1829, "user_id": 271789, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/6932023eeb2a104850f74c77854e22fb?s=128&d=identicon&r=PG", "display_name": "zefciu", "link": "https://stackoverflow.com/users/271789/zefciu"}, "edited": false, "score": 0, "creation_date": 1478090884, "post_id": 40338890, "comment_id": 68012427, "body": "Yes it would. That&#39;s the idea I accepted below"}], "answers": [{"tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 3, "last_activity_date": 1477935335, "creation_date": 1477935335, "answer_id": 40347450, "question_id": 40338890, "link": "https://stackoverflow.com/questions/40338890/how-to-mock-a-struct-if-you-directly-access-its-fields/40347450#40347450", "title": "How to mock a struct if you directly access its fields", "body": "<p>It may not be practical in your case, especially if you're using a lot of functionality from <code>github.Client</code> but you can use embedding to create a new structure that implements an interface you define.</p>\n\n<pre><code>type mockableClient struct {\n    github.Client\n}\n\nfunc (mc *mockableClient) ListPRs(\nowner string, repo string, opt *github.PullRequestListOptions) (\n[]*github.PullRequest, *github.Response, error) {\n\nreturn mc.Client.PullRequests.List(owner, repo, opt)\n}\n\n\ntype clientMocker interface {\n    Do(req *http.Request, v interface{}) (*github.Response, error)\n\n    ListPRs(string,string,*github.PullRequestListOptions) (\n[]*github.PullRequest, *github.Response, error)\n}\n</code></pre>\n"}], "owner": {"reputation": 1829, "user_id": 271789, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/6932023eeb2a104850f74c77854e22fb?s=128&d=identicon&r=PG", "display_name": "zefciu", "link": "https://stackoverflow.com/users/271789/zefciu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 921, "favorite_count": 0, "accepted_answer_id": 40347450, "answer_count": 1, "score": 4, "last_activity_date": 1477935335, "creation_date": 1477903534, "question_id": 40338890, "link": "https://stackoverflow.com/questions/40338890/how-to-mock-a-struct-if-you-directly-access-its-fields", "title": "How to mock a struct if you directly access its fields", "body": "<p>I am writing a program that acts as a client of Github API. I use <a href=\"https://github.com/google/go-github\" rel=\"nofollow\">https://github.com/google/go-github</a> to access the API. I have a function that accepts a <code>github.Client</code> as one of the argumenta and uses it to retrieve commits from a pull request. I want to test this function with some fake data.</p>\n\n<p>In the article here: <a href=\"https://nathanleclaire.com/blog/2015/10/10/interfaces-and-composition-for-effective-unit-testing-in-golang/\" rel=\"nofollow\">https://nathanleclaire.com/blog/2015/10/10/interfaces-and-composition-for-effective-unit-testing-in-golang/</a> I read, that I should create an interface that would be implemented by github client, and then in my tests, create a mock that would also implement it. My problem is, that <code>go-github</code> uses the following semantics to retrieve pull request:</p>\n\n<p><code>prs, resp, err := client.PullRequests.List(\"user\", \"repo\", opt)</code></p>\n\n<p>The interfaces however allow you to specify <em>methods</em> that should be implemented, but not <em>fields</em>. So how can I mock the github.Client object so it can be used in the above semantics?</p>\n"}, {"tags": ["go", "oauth2"], "comments": [{"owner": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 0, "creation_date": 1477903578, "post_id": 40338711, "comment_id": 67932135, "body": "Have you tried to <code>Set()</code> the header instead of <code>Add()</code>ing it? <a href=\"https://golang.org/pkg/net/http/#Header.Add\" rel=\"nofollow noreferrer\"><code>Add()</code></a> appends values to the existing header, whereas <a href=\"https://golang.org/pkg/net/http/#Header.Set\" rel=\"nofollow noreferrer\"><code>Set()</code></a> will overwrite existing headers. Also according to the RFCs headers fields are case-insensitive, but some languages (i.e. PHP) don&#39;t know about that and will be looking for <code>Authorization</code>..."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 0, "creation_date": 1477920119, "post_id": 40338711, "comment_id": 67940215, "body": "@Havelock: the go textproto package canonicalizes all headers when you set them."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1477920160, "post_id": 40338711, "comment_id": 67940239, "body": "@TahirRauf: have you looked at the headers to see how they are being sent?"}], "answers": [{"tags": [], "owner": {"reputation": 149, "user_id": 1271077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb34d0113942345da081ce9e9c7c77da?s=128&d=identicon&r=PG", "display_name": "Tahir Rauf", "link": "https://stackoverflow.com/users/1271077/tahir-rauf"}, "is_accepted": true, "score": 11, "last_activity_date": 1480830835, "creation_date": 1480830835, "answer_id": 40955857, "question_id": 40338711, "link": "https://stackoverflow.com/questions/40338711/not-able-to-pass-bearer-token-in-headers-of-a-get-request-in-golang/40955857#40955857", "title": "Not able to pass Bearer token in headers of a GET request in Golang", "body": "<p>I was able to solve the problem. Actually the problem was two way.</p>\n\n<p>1) The API end point was doing a redirect (302), which was causing a 302 response and then the other API was being called.</p>\n\n<p>2) GO by default does not forward the headers, thus my bearer token was being lost in the middle.</p>\n\n<p>FIX: </p>\n\n<p>I had to override the client's CheckRedirect function and manually pass the headers to the new request.</p>\n\n<pre><code>client.CheckRedirect = checkRedirectFunc\n</code></pre>\n\n<p>Here is how I forwarded the headers manually.</p>\n\n<pre><code>func checkRedirectFunc(req *http.Request, via []*http.Request) error {\n    req.Header.Add(\"Authorization\", via[0].Header.Get(\"Authorization\"))\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 149, "user_id": 1271077, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb34d0113942345da081ce9e9c7c77da?s=128&d=identicon&r=PG", "display_name": "Tahir Rauf", "link": "https://stackoverflow.com/users/1271077/tahir-rauf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8319, "favorite_count": 0, "accepted_answer_id": 40955857, "answer_count": 1, "score": 2, "last_activity_date": 1480830835, "creation_date": 1477902548, "question_id": 40338711, "link": "https://stackoverflow.com/questions/40338711/not-able-to-pass-bearer-token-in-headers-of-a-get-request-in-golang", "title": "Not able to pass Bearer token in headers of a GET request in Golang", "body": "<p>I am using oauth2 to access a third party API. I can get the access token alright, but when I try to call the API by passing the bearer token in the request headers it gives me 401 (Unauthorized) error.  Although it works well when I try to do it via POSTMAN by passing headers as  (Authorization: Bearer ). But it does not work using go.</p>\n\n<p>Here is the code sample.</p>\n\n<pre><code>url := \"http://api.kounta.com/v1/companies/me.json\"\n\nvar bearer = \"Bearer \" + &lt;ACCESS TOKEN HERE&gt;\nreq, err := http.NewRequest(\"GET\", url, nil)\nreq.Header.Add(\"authorization\", bearer)\n\nclient := urlfetch.Client(context)\n\nresp, err := client.Do(req)\nif err != nil {\npanic(err)\n}\ndefer resp.Body.Close()\n\nbody, _ := ioutil.ReadAll(resp.Body)\nwriter.Write([]byte(body)) // Gives 401 Unauthorized error, though same works using POSTMAN\n</code></pre>\n"}, {"tags": ["go", "rtmp"], "comments": [{"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 1, "creation_date": 1477935716, "post_id": 40336038, "comment_id": 67949595, "body": "I&#39;m guessing you need to tunnel <a href=\"https://en.wikipedia.org/wiki/Real-Time_Messaging_Protocol#HTTP_tunneling\" rel=\"nofollow noreferrer\">RTMP over HTTP</a>"}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1478298758, "post_id": 40336038, "comment_id": 68113736, "body": "Aside from tunnelling protocols within other protocols, it&#39;s unusual to serve more than one protocol per port. I imagine that some solution would involve peeking at the first few bytes received until you can decide which handler to employ. I&#39;ve never seen this attempted."}], "answers": [{"tags": [], "owner": {"reputation": 5427, "user_id": 721386, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/990a96e6875ad1319af43b61b8d090b7?s=128&d=identicon&r=PG", "display_name": "Dustin", "link": "https://stackoverflow.com/users/721386/dustin"}, "is_accepted": true, "score": 0, "last_activity_date": 1478465014, "creation_date": 1478465014, "answer_id": 40454318, "question_id": 40336038, "link": "https://stackoverflow.com/questions/40336038/go-webserver-listening-for-multiple-protocols-http-and-rtmp-on-the-same-port/40454318#40454318", "title": "Go - Webserver listening for multiple protocols (HTTP and RTMP) on the same port", "body": "<p>While wanting to avoid having to convert RTMPT to RTMP, and without having to fork other modules, this was my solution in the end by reading the first byte. Full implementation can be found <a href=\"https://github.com/dustinblackman/streamroller/blob/master/main.go\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<pre><code>func createLocalConnection(port string) *net.TCPConn {\n    addr, err := net.ResolveTCPAddr(\"tcp\", \"127.0.0.1:\"+port)\n    if err != nil {\n        panic(err)\n    }\n    conn, err := net.DialTCP(\"tcp\", nil, addr)\n    if err != nil {\n        panic(err)\n    }\n    return conn\n}\n\nfunc proxyConnection(conn *net.TCPConn) {\n  defer conn.Close()\n  data := make([]byte, 1)\n  n, err := conn.Read(data)\n  if err != nil {\n    fmt.Println(err)\n    return\n  }\n\n  var proxyConn *net.TCPConn\n  if data[0] == 0x03 { // RTMP first byte.\n    proxyConn = createLocalConnection(RTMPPort)\n  } else {\n    proxyConn = createLocalConnection(HTTPPort)\n  }\n  proxyConn.Write(data[:n])\n  defer proxyConn.Close()\n\n  // Request loop\n  go func() {\n    for {\n      data := make([]byte, 1024*1024)\n      n, err := conn.Read(data)\n      if err != nil {\n        break\n      }\n      proxyConn.Write(data[:n])\n    }\n  }()\n\n  // Response loop\n  for {\n    data := make([]byte, 1024*1024)\n    n, err := proxyConn.Read(data)\n    if err != nil {\n      break\n    }\n    conn.Write(data[:n])\n  }\n}\n\nfunc main() {\n  listener, err := net.ListenTCP(\"tcp\", addr)\n    if err != nil {\n        panic(err)\n    }\n\n  for {\n    conn, err := listener.AcceptTCP()\n    if err != nil {\n      fmt.Println(err)\n      continue\n    }\n\n    go server.ProxyConnection(conn)\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 5427, "user_id": 721386, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/990a96e6875ad1319af43b61b8d090b7?s=128&d=identicon&r=PG", "display_name": "Dustin", "link": "https://stackoverflow.com/users/721386/dustin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 305, "favorite_count": 0, "accepted_answer_id": 40454318, "answer_count": 1, "score": 0, "last_activity_date": 1478465014, "creation_date": 1477883088, "question_id": 40336038, "link": "https://stackoverflow.com/questions/40336038/go-webserver-listening-for-multiple-protocols-http-and-rtmp-on-the-same-port", "title": "Go - Webserver listening for multiple protocols (HTTP and RTMP) on the same port", "body": "<p>I'm trying to implement the RTMP protocol to along side my web application in Go, however I can't seem to figure out solution to handle both HTTP and and RTMP on the same port.</p>\n\n<p>The idea would be something such as this.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"net/http\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        io.WriteString(w, \"Hello!\")\n    })\n\n    http.HandleFunc(\"/rtmp\", func(w http.ResponseWriter, r *http.Request) {\n        // RTMP handling here\n    })\n\n    fmt.Println(\"Starting web server\")\n    http.ListenAndServe(\":8000\", nil)\n}\n</code></pre>\n\n<p><a href=\"https://github.com/zhangpeihao/gortmp\" rel=\"nofollow\">zhangpeihao/gortmp</a> has a great RMTP module with <a href=\"https://github.com/zhangpeihao/gortmp/blob/master/demo/proxy/proxy.go#L37-L45\" rel=\"nofollow\">an example that shows</a> handling RTMP by listening on a TCP socket. However how can handle it on a specific endpoint rather then a second port?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1477878825, "post_id": 40335536, "comment_id": 67926449, "body": "Running goroutines are multiplexed across a maximum of GOMAXPROCS OS threads. There is only ever one process."}, {"owner": {"reputation": 279, "user_id": 1310618, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6c3b061959da80f4656935e95dd99c12?s=128&d=identicon&r=PG", "display_name": "TestingInProd", "link": "https://stackoverflow.com/users/1310618/testinginprod"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1477879266, "post_id": 40335536, "comment_id": 67926539, "body": "Thanks @JimB but Is there a way to check the difference in GOMAXPROCS(1) and GOMAXPROCS(2) like a running id or something?"}, {"owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "edited": false, "score": 0, "creation_date": 1477893728, "post_id": 40335536, "comment_id": 67929330, "body": "Go is designed for concurency not parallelism. Thus, Go runtime decides how routines are executed, and that&#39;s the power of Go. That means you have no reason to decide it yourself (not in Go). If you google &quot;Concurrency is not parallelism&quot; you&#39;ll find some talk about Go concurrency design."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1477919022, "post_id": 40335536, "comment_id": 67939540, "body": "@TheLion: The difference between <code>GOMAXPROCS(1)</code> and <code>GOMAXPROCS(2)</code> is 1 os thread for running user goroutines vs 2. That is all. What is it you want to check? Goroutines aren&#39;t pinned to a particular thread unless you call <code>runtime.LockOSThread()</code>, but there&#39;s really very few reasons to do that."}], "answers": [{"tags": [], "owner": {"reputation": 491, "user_id": 4699030, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PtpXlAvuawc/AAAAAAAAAAI/AAAAAAAABgA/eeoUql28GSs/photo.jpg?sz=128", "display_name": "Juan Carlos Garcia", "link": "https://stackoverflow.com/users/4699030/juan-carlos-garcia"}, "is_accepted": false, "score": -1, "last_activity_date": 1477880069, "creation_date": 1477880069, "answer_id": 40335746, "question_id": 40335536, "link": "https://stackoverflow.com/questions/40335536/go-lang-running-routine-on-different-process/40335746#40335746", "title": "Go lang : running routine on different process", "body": "<p>If you want only one goroutine running on each process, you can use <a href=\"https://golang.org/pkg/runtime/#LockOSThread\" rel=\"nofollow\">runtime.LockOSThread()</a> to make a 1:1 relation between process and goroutines running on that process. In your case, you should invoke runtime.LockOSThread every time you launch a new goroutine.</p>\n\n<pre><code>for i:=0 ;i&lt;3; i++{\n    go func(){\n        runtime.LockOSThread()\n        printAndSleep(i)\n    }()\n}\n</code></pre>\n"}], "owner": {"reputation": 279, "user_id": 1310618, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6c3b061959da80f4656935e95dd99c12?s=128&d=identicon&r=PG", "display_name": "TestingInProd", "link": "https://stackoverflow.com/users/1310618/testinginprod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 890, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1477880069, "creation_date": 1477878146, "question_id": 40335536, "link": "https://stackoverflow.com/questions/40335536/go-lang-running-routine-on-different-process", "title": "Go lang : running routine on different process", "body": "<p>I want to run a 3 go routine on different process. Upon research I found that I need to use runtime.GOMAXPROCS(). But even after using runtime.GOMAXPROCS(), all routine runs on same process. How can I make it run on different process. Below is the code and output. Here is the link to <a href=\"https://play.golang.org/p/h-wDcha200\" rel=\"nofollow\">goplayground</a></p>\n\n<pre><code>func main() {\n\n    runtime.GOMAXPROCS(4)\n\n    fmt.Printf(\"Number of CPU %d \\n\",runtime.NumCPU())\n\n    fmt.Printf(\"Process id of main %d \\n\\n\",os.Getpid())\n\n\n    for i:=0 ;i&lt;3; i++{\n        go printAndSleep(i)\n    }\n\n    time.Sleep(time.Second * 100)\n\n}\n\nfunc printAndSleep(i int){\n    for {\n        fmt.Printf(\"Process id of %d go routine %d \\n\",i,os.Getpid())\n        time.Sleep(time.Second * 2)\n    }   \n}\n</code></pre>\n\n<p>Output :</p>\n\n<pre><code>Number of CPU 8 \nProcess id of main 16874 \n\nProcess id of 0 go routine 16874 \nProcess id of 2 go routine 16874 \nProcess id of 1 go routine 16874 \nProcess id of 0 go routine 16874 \nProcess id of 1 go routine 16874 \nProcess id of 2 go routine 16874 \nProcess id of 0 go routine 16874 \nProcess id of 1 go routine 16874 \nProcess id of 2 go routine 16874 \nProcess id of 2 go routine 16874 \nProcess id of 0 go routine 16874 \nProcess id of 1 go routine 16874 \n</code></pre>\n\n<p>Here you can see all the routine runs on same process even though I have used GOMAXPROCS . Why is that? Am I using it wrong</p>\n"}, {"tags": ["go", "mangodb"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1477869122, "post_id": 40334628, "comment_id": 67924534, "body": "Store it in a package level variable.  That&#39;s easiest for a beginner."}, {"owner": {"reputation": 121, "user_id": 3943467, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wL7xf.jpg?s=128&g=1", "display_name": "RT Bathula", "link": "https://stackoverflow.com/users/3943467/rt-bathula"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1477869296, "post_id": 40334628, "comment_id": 67924567, "body": "Could you @MellowMarmot  explain in detail?, because i am totally new to goLang. Could you tell me the flow"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1477869665, "post_id": 40334628, "comment_id": 67924647, "body": "Create the session in main() or some other function before starting the HTTP server. Assign the value to a package level variable. Use it as needed."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1477869702, "post_id": 40334628, "comment_id": 67924657, "body": "@RaviTejaBathula If a global variable needs explanation, you shouldn&#39;t be using MongoDB as of yet. You need to go through the language basics, e.g. <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">A tour of Go</a> and the <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">Language spec</a>."}, {"owner": {"reputation": 121, "user_id": 3943467, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wL7xf.jpg?s=128&g=1", "display_name": "RT Bathula", "link": "https://stackoverflow.com/users/3943467/rt-bathula"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1477871892, "post_id": 40334628, "comment_id": 67925123, "body": "@icza Yes I do, Just i thought making a project is a best way to learn. I am making a project and learning as well. Anyhow  thank you."}], "answers": [{"comments": [{"owner": {"reputation": 121, "user_id": 3943467, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wL7xf.jpg?s=128&g=1", "display_name": "RT Bathula", "link": "https://stackoverflow.com/users/3943467/rt-bathula"}, "edited": false, "score": 0, "creation_date": 1477923249, "post_id": 40337089, "comment_id": 67941993, "body": "Thank you @nosequeldeebee , instead of simply down voting, you took patience to write this. I got it"}], "tags": [], "owner": {"reputation": 735, "user_id": 6697038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eqwd8.jpg?s=128&g=1", "display_name": "nosequeldeebee", "link": "https://stackoverflow.com/users/6697038/nosequeldeebee"}, "is_accepted": true, "score": 2, "last_activity_date": 1477892122, "creation_date": 1477892122, "answer_id": 40337089, "question_id": 40334628, "link": "https://stackoverflow.com/questions/40334628/how-to-maintain-mongodb-session-throughout-out-application-in-golang-as-global-v/40337089#40337089", "title": "How to maintain mongoDB session throughout out application in goLang as global variable", "body": "<p>I'm assuming you've already got the <code>mgo</code> driver:</p>\n\n<p><code>go get gopkg.in/mgo.v2</code></p>\n\n<p>In your code you can set a global variable outside your <code>main</code> function like:</p>\n\n<p><code>var mgoSession *mgo.Session</code></p>\n\n<p>Then either in an <code>init</code> function or right in your <code>main</code> function you start up your session:</p>\n\n<pre><code>session, err := mgo.Dial(\"mongodb://localhost\")\nif err != nil {\n    panic(err)\n}\nsession.SetMode(mgo.Monotonic, true)\nmgoSession = session\n</code></pre>\n\n<p>Then you can clone the session as needed in the different functions in your program:</p>\n\n<pre><code>session := mgoSession.Clone()\ndefer session.Close()\nc := session.DB(\"databasename\").C(\"collectionname\")\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 3943467, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wL7xf.jpg?s=128&g=1", "display_name": "RT Bathula", "link": "https://stackoverflow.com/users/3943467/rt-bathula"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 741, "favorite_count": 0, "accepted_answer_id": 40337089, "answer_count": 1, "score": -3, "last_activity_date": 1477892122, "creation_date": 1477868836, "question_id": 40334628, "link": "https://stackoverflow.com/questions/40334628/how-to-maintain-mongodb-session-throughout-out-application-in-golang-as-global-v", "title": "How to maintain mongoDB session throughout out application in goLang as global variable", "body": "<p>I am a beginner in GoLang. I want to maintain a MongoDB session throughout the application. I already have seen answers like binding DB session in martini framework or assigning it to a goLang structs. But i want a straight forward method. </p>\n"}, {"tags": ["go", "architecture", "domain-driven-design", "microservices"], "answers": [{"comments": [{"owner": {"reputation": 39014, "user_id": 1211528, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/88f7b504ba3fffac19860abd3aa7cf91?s=128&d=identicon&r=PG", "display_name": "plalx", "link": "https://stackoverflow.com/users/1211528/plalx"}, "edited": false, "score": 0, "creation_date": 1477865833, "post_id": 40334073, "comment_id": 67923582, "body": "Isin&#39;t that the same as the repository pattern?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 39014, "user_id": 1211528, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/88f7b504ba3fffac19860abd3aa7cf91?s=128&d=identicon&r=PG", "display_name": "plalx", "link": "https://stackoverflow.com/users/1211528/plalx"}, "edited": false, "score": 0, "creation_date": 1477865955, "post_id": 40334073, "comment_id": 67923624, "body": "@plalx Yes, but nobody said it can&#39;t be applied or that it wouldn&#39;t be proper to use in Go."}, {"owner": {"reputation": 39014, "user_id": 1211528, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/88f7b504ba3fffac19860abd3aa7cf91?s=128&d=identicon&r=PG", "display_name": "plalx", "link": "https://stackoverflow.com/users/1211528/plalx"}, "edited": false, "score": 1, "creation_date": 1477931827, "post_id": 40334073, "comment_id": 67947527, "body": "&quot;My concern is that I&#39;ve been overly &quot;conditioned&quot; into thinking about these problems from the perspective of Object Oriented design and would like to explore other programming paradigms&quot;. In other words, the OP knows the repository pattern already, but he&#39;s looking to find other good alternatives to abstract away persistence concerns in Go."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 0, "last_activity_date": 1477875804, "last_edit_date": 1477875804, "creation_date": 1477864674, "answer_id": 40334073, "question_id": 40333799, "link": "https://stackoverflow.com/questions/40333799/abstracting-away-the-persistence-layer-in-go/40334073#40334073", "title": "Abstracting away the persistence layer in GO", "body": "<p>I don't think there's one good answer to this question, multiple approaches may be good, one better from a specific point of view, and another being better from another point of view.</p>\n\n<p>Just try to create an interface (not in the meaning of Go interface type) that hides DB specific behavior and types, which will leave you the option to easily switch to a new db implementation later on, given that all other parts of your code strictly access the persistent layer via this DB interface.</p>\n\n<p>The DB interface should define Go model types (modeling data stored in the persistent layer), and operations on these types, e.g. load, find, save.</p>\n\n<p>As an example, modeling a user:</p>\n\n<pre><code>package db\n\ntype ID int64\n\ntype User struct {\n    ID   ID\n    Name string\n}\n\n// Manager contains the operations that involve the persistence layer.\ntype Manager interface {\n    LoadUser(id ID) (*User, error)\n    SaveUser(u *User) error\n    FindUsersByName(name string) ([]*User, error)\n    Close() error\n}\n</code></pre>\n\n<p>And you may create an implementation (or multiple ones) of the <code>Manager</code> interface. An implementation using MongoDB:</p>\n\n<pre><code>package mongo\n\nimport (\n    \"db\"\n    \"gopkg.in/mgo.v2\"\n)\n\n// manager is a db.Manager implementation that uses MongoDB\ntype manager struct {\n    // unexported fields, e.g. MongoDB session:\n    sess *mgo.Sess\n}\n\nfunc (m *manager) LoadUser(id db.ID) (*db.User, error) { ... }\n\nfunc (m *manager) SaveUser(u *db.User) error { ... }\n\nfunc (m *manager) FindUsersByName(name string) ([]*db.User, error) { ... }\n\nfunc (m *manager) Close() error {\n    m.sess.Close()\n    return nil\n}\n\nfunc New(mongoURL string) (db.Manager, error) {\n    // Create, initialize your manager, and return it:\n    sess, err := mgo.Dial(url)\n    if err != nil {\n        return nil, err\n    }\n    return &amp;manager{sess: sess}, nil\n}\n</code></pre>\n\n<p>A <code>db.Manager</code> instance (since it involves building a connection to a (Mongo)DB server) should be kept for as long as possible (e.g. global instance). Depending on the usage, <code>Manager.Copy()</code> and <code>Manager.Clone()</code> operations should be supported to acquire a copy or clone for short lived usage (e.g. serving an HTTP request).</p>\n\n<p>Using this example: Someone somewhere has to call <code>mongo.New()</code> to acquire a value of the <code>db.Manager</code>, but from there we only have to interact with the persistence layer via the <code>Manager</code>, leaving any db specific detail to the implementation.</p>\n\n<p>For example:</p>\n\n<pre><code>var mgr db.Manager\nvar err error\n\nmgr, err = mongo.New(\"&lt;mongodburl&gt;\")\nif err != nil {\n    log.Printf(\"Could not connect to db:\", err)\n    return\n}\ndefer mgr.Close()\n\nid := 123456\nu, err := mgr.LoadUser(id)\nif err != nil {\n    log.Printf(\"Failed to load user [id: %v]: %v\\n\", id, err)\n    return\n}\nfmt.Printf(\"Loaded User: %+v\\n\", u)\n</code></pre>\n"}], "owner": {"reputation": 129, "user_id": 4749577, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e26c46cf659668fddc06a2c75b2f5b3?s=128&d=identicon&r=PG&f=1", "display_name": "user2308097", "link": "https://stackoverflow.com/users/4749577/user2308097"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 948, "favorite_count": 1, "closed_date": 1484949546, "answer_count": 1, "score": 2, "last_activity_date": 1477875804, "creation_date": 1477862879, "question_id": 40333799, "link": "https://stackoverflow.com/questions/40333799/abstracting-away-the-persistence-layer-in-go", "closed_reason": "Needs details or clarity", "title": "Abstracting away the persistence layer in GO", "body": "<p>So, I'm relatively new to the world of Go programming and was wondering what the community considers to be \"best practice\" when attempting to abstract away the persistence layer.  </p>\n\n<p>In DDD this is often handled through the introduction of Repositories which exposes a set of Agreggates to an Application layer.  </p>\n\n<p>My concern is that I've been overly \"conditioned\" into thinking about these problems from the perspective of Object Oriented design and would like to explore other programming paradigms.</p>\n\n<p>This will also be my first attempt at developing micro-services; which is part of the reason why I'd like to keep my design as simple as possible.</p>\n"}, {"tags": ["arrays", "json", "http", "go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1477863784, "last_edit_date": 1477863784, "creation_date": 1477862618, "answer_id": 40333763, "question_id": 40333562, "link": "https://stackoverflow.com/questions/40333562/parsing-explicit-arrays/40333763#40333763", "title": "Parsing explicit arrays", "body": "<p>Your input is a <a href=\"http://www.json.org/\" rel=\"noreferrer\">JSON</a> string. In Go, you can use the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"noreferrer\"><code>encoding/json</code></a> package to decode it.</p>\n\n<p>Usually, when the structure of the JSON string is known prior, a Go <code>struct</code> type can be constructed which models it, and then you can unmarshal into a value of that <code>struct</code> type.</p>\n\n<p>If the structure is unknown or is varying, you may unmarshal into a value of type <code>interface{}</code> which can be the target of any JSON data:</p>\n\n<pre><code>s := `[[1,\"a\",\"b\",2,\"000000\",[[1,2,3],[1,2,3]],\"x\",\"y\",\"z\",[[1,2,3],[1,2,3]]]]`\n\nvar v interface{}\nif err := json.Unmarshal([]byte(s), &amp;v); err != nil {\n    fmt.Println(err)\n    return\n}\nfmt.Println(v)\nfmt.Printf(\"%#v\\n\", v)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/Q5w0_qabwz\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[[1 a b 2 000000 [[1 2 3] [1 2 3]] x y z [[1 2 3] [1 2 3]]]]\n[]interface {}{[]interface {}{1, \"a\", \"b\", 2, \"000000\", []interface {}{[]interface {}{1, 2, 3}, []interface {}{1, 2, 3}}, \"x\", \"y\", \"z\", []interface {}{[]interface {}{1, 2, 3}, []interface {}{1, 2, 3}}}}\n</code></pre>\n\n<p>As you can see, the result is a slice of slices, with elements of varying types (JSON numbers, strings and even more slices).</p>\n\n<p>Here's the same output adding indentation to get a better feeling of it (using Go's <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"noreferrer\">composite literal</a> syntax):</p>\n\n<pre><code>[]interface{}{\n    []interface{}{\n        1, \"a\", \"b\", 2, \"000000\",\n        []interface{}{\n            []interface{}{1, 2, 3},\n            []interface{}{1, 2, 3}},\n        \"x\", \"y\", \"z\",\n        []interface{}{\n            []interface{}{1, 2, 3},\n            []interface{}{1, 2, 3},\n        },\n    },\n}\n</code></pre>\n\n<p>Of course this is not very convenient, as you have to use <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"noreferrer\">type assertion</a> to \"extract\" values from this \"generic\" value of type <code>interface{}</code>, for example to extract the first 2 non-arrays values (also printing their types for verification):</p>\n\n<pre><code>fmt.Printf(\"%T %[1]v\\n\", v.([]interface{})[0].([]interface{})[0])\nfmt.Printf(\"%T %[1]v\\n\", v.([]interface{})[0].([]interface{})[1])\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>float64 1\nstring a\n</code></pre>\n\n<p>Worth noting that JSON numbers in Go are unmarshaled to a value of type <code>float64</code> even though they could be integers (unless another type is explicitly specified).</p>\n"}], "owner": {"reputation": 218, "user_id": 1116856, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/de68f666ad4ecf47e1c0bf43a12c74d9?s=128&d=identicon&r=PG", "display_name": "norwat", "link": "https://stackoverflow.com/users/1116856/norwat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 478, "favorite_count": 0, "accepted_answer_id": 40333763, "answer_count": 1, "score": 2, "last_activity_date": 1477863784, "creation_date": 1477861172, "last_edit_date": 1477863325, "question_id": 40333562, "link": "https://stackoverflow.com/questions/40333562/parsing-explicit-arrays", "title": "Parsing explicit arrays", "body": "<p>I'm trying to parse this type of response from a server:</p>\n\n<pre><code>[[1,\"a\",\"b\",2,\"000000\",[[1,2,3],[1,2,3]],\"x\",\"y\",\"z\",[[1,2,3],[1,2,3]]]]\n</code></pre>\n\n<p>Besides writing my own hack'ish parser for this type of messages is there a standard way to interpret this that I'm not aware of?</p>\n"}, {"tags": ["logging", "go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1477860436, "last_edit_date": 1477860436, "creation_date": 1477859876, "answer_id": 40333389, "question_id": 40333323, "link": "https://stackoverflow.com/questions/40333323/implement-a-minimal-logger-in-golang/40333389#40333389", "title": "Implement a minimal logger in Golang", "body": "<p><a href=\"https://godoc.org/log#Println\" rel=\"nofollow\">Println</a> is passed a single parameter, a slice of interface{}, and prints it using slice notation.  To fix this, pass the variadic parameters to your functions as variadic arguments to the called functions. </p>\n\n<pre><code>func Debug(a ...interface{}) {\n     dlog.Println(a...) // &lt;-- note ... here\n}\n</code></pre>\n\n<p><a href=\"https://golang.org/ref/spec#Passing_arguments_to_..._parameters\" rel=\"nofollow\">Here's the doc on variadic args</a>.</p>\n\n<p>Call <a href=\"https://godoc.org/log#Logger.Output\" rel=\"nofollow\">Output</a> to workaround the file name issue. </p>\n\n<pre><code>func Debug(a ...interface{}) {\n     dlog.Output(2, fmt.Sprintln(a...))\n}\n</code></pre>\n"}], "owner": {"reputation": 385, "user_id": 2880205, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/zDjCY.jpg?s=128&g=1", "display_name": "dragfire", "link": "https://stackoverflow.com/users/2880205/dragfire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 434, "favorite_count": 0, "accepted_answer_id": 40333389, "answer_count": 1, "score": 0, "last_activity_date": 1477860436, "creation_date": 1477859463, "question_id": 40333323, "link": "https://stackoverflow.com/questions/40333323/implement-a-minimal-logger-in-golang", "title": "Implement a minimal logger in Golang", "body": "<p>I've created a minimal logger in Golang. \nI tried to keep it as simple as possible but two problems arise:</p>\n\n<ul>\n<li>Message string is shown as array wrapped in brackets []</li>\n<li>filename using <code>log.Lshortfile</code> flag is always shown as <code>logger.go</code></li>\n</ul>\n\n<p><a href=\"https://i.stack.imgur.com/cZl39.png\" rel=\"nofollow\"><img src=\"https://i.stack.imgur.com/cZl39.png\" alt=\"CMD\"></a></p>\n\n<p>Here's my code:</p>\n\n<pre><code>package logger\n\nimport (\n    \"log\"\n    \"os\"\n)\n\nvar (\n    dlog = log.New(os.Stdout, \"\\x1B[36mDEBUG: \\x1B[0m\", log.Ldate|log.Ltime|log.Lshortfile)\n    wlog = log.New(os.Stdout, \"\\x1B[35mWARN: \\x1B[0m\", log.Ldate|log.Ltime|log.Lshortfile)\n    ilog = log.New(os.Stdout, \"\\x1B[32mINFO: \\x1B[0m\", log.Ldate|log.Ltime|log.Lshortfile)\n    elog = log.New(os.Stderr, \"\\x1B[31mERROR: \\x1B[0m\", log.Ldate|log.Ltime|log.Lshortfile)\n)\n\n// Debug Log\nfunc Debug(a ...interface{}) {\n     dlog.Println(a)\n}\n\n// Warn log\nfunc Warn(a ...interface{}) {\n    wlog.Println(a)\n}\n\n// Info Log\nfunc Info(a ...interface{}) {\n    ilog.Println(a)\n}\n\n// Error Log\nfunc Error(a ...interface{}) {\n    elog.Println(a)\n}\n</code></pre>\n\n<p>I use them  like this: <code>logger.Debug(\"Hello\") or logger.Info(\"There\")</code></p>\n\n<p>How do I implement this correctly? Thank you.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1477854063, "post_id": 40332011, "comment_id": 67919949, "body": "Describe the handler interface used in this scenario. Is it http.Handler or something else?"}, {"owner": {"reputation": 101, "user_id": 5173765, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/fae46355682a461a162f8d30ab3300ed?s=128&d=identicon&r=PG&f=1", "display_name": "George", "link": "https://stackoverflow.com/users/5173765/george"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1477854698, "post_id": 40332011, "comment_id": 67920127, "body": "It isn&#39;t http handler so there isnt a nice generic interface for the handler. Basically I want the middleware library to support a generic interface I or J, where I has a set of methods and J has another set of methods."}], "answers": [{"comments": [{"owner": {"reputation": 101, "user_id": 5173765, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/fae46355682a461a162f8d30ab3300ed?s=128&d=identicon&r=PG&f=1", "display_name": "George", "link": "https://stackoverflow.com/users/5173765/george"}, "edited": false, "score": 0, "creation_date": 1477853330, "post_id": 40332311, "comment_id": 67919709, "body": "I&#39;m trying to do it a little more generically because it&#39;s meant to be a middleware library. Is it possible if I don&#39;t hard code Y implementing Fn?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 101, "user_id": 5173765, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/fae46355682a461a162f8d30ab3300ed?s=128&d=identicon&r=PG&f=1", "display_name": "George", "link": "https://stackoverflow.com/users/5173765/george"}, "edited": false, "score": 0, "creation_date": 1477854004, "post_id": 40332311, "comment_id": 67919928, "body": "Y is coded to call an arbitrary function in its implementation of I.  Replace I with http.Handler or whatever interface your framework uses."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1477857632, "last_edit_date": 1477857632, "creation_date": 1477852734, "answer_id": 40332311, "question_id": 40332011, "link": "https://stackoverflow.com/questions/40332011/generating-go-method-set-with-reflection/40332311#40332311", "title": "Generating Go method set with reflection", "body": "<p>Here's how to handle this for interfaces I and J.</p>\n\n<pre><code>type I interface { Fn1(a int) int }\ntype J interface { Fn2(a int) int }\n\ntype Y struct {       // Y implements I by calling fn\n   fn func(a int) int\n}\n\nfunc (y Y) Fn1(a int) int { return y.fn(a) }\n\ntype Z struct {       // Z implements J by calling fn\n   fn func(a int) int\n}\n\nfunc (z Z) Fn2(a int) int { return y.fn(a) }\n\nvar y I = Y{fn: x.Fn}\nvar z J = Z{fn: x.Fn}\n</code></pre>\n\n<p>There's no need to use reflection.</p>\n\n<p><a href=\"https://play.golang.org/p/OzGrBHj-p5\" rel=\"nofollow\">playground example</a></p>\n"}], "owner": {"reputation": 101, "user_id": 5173765, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/fae46355682a461a162f8d30ab3300ed?s=128&d=identicon&r=PG&f=1", "display_name": "George", "link": "https://stackoverflow.com/users/5173765/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1477857632, "creation_date": 1477850754, "last_edit_date": 1477853674, "question_id": 40332011, "link": "https://stackoverflow.com/questions/40332011/generating-go-method-set-with-reflection", "title": "Generating Go method set with reflection", "body": "<p>Is it possible to generate an interface or method set of a struct at runtime with reflection?</p>\n\n<p>For example:</p>\n\n<pre><code>type S struct {\n    a int\n}\n\nfunc (s *S) Fn(b int) int {\n    return s.a + b\n}\n\ntype I interface {\n    Fn(a int) int\n}\n\nfunc main() {\n    var x I = &amp;S{a: 5}\n    fmt.Printf(\"%#v\\n\", x.Fn)\n    fmt.Printf(\"%#v\\n\", reflect.TypeOf(x).Method(0))\n\n    var y I\n    y.Fn = x.Fn // This fails, but I want to set y.Fn at runtime.\n    fmt.Printf(\"%#v\\n\", reflect.TypeOf(y).Method(0))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/agH2fQ4tZ_\" rel=\"nofollow\">https://play.golang.org/p/agH2fQ4tZ_</a></p>\n\n<p>To clarify, I'm trying to build a middleware library so interface I contains the http handlers and I want to wrap each hander with some sort of req/response logging so I need to return a new interface I where each function in new Interface I wraps the original + some logging.</p>\n"}, {"tags": ["go", "ssh"], "comments": [{"owner": {"reputation": 20508, "user_id": 2196426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8e8759ad9a50739704dca2e84fa9b50?s=128&d=identicon&r=PG", "display_name": "Jakuje", "link": "https://stackoverflow.com/users/2196426/jakuje"}, "edited": false, "score": 0, "creation_date": 1477859922, "post_id": 40331761, "comment_id": 67921753, "body": "try to flush the stderr and stdout after writing. It might be cached somewhere."}, {"owner": {"reputation": 662, "user_id": 2325694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e557f0b61a4c84567abca5ca66e3c3f3?s=128&d=identicon&r=PG", "display_name": "Joe Linoff", "link": "https://stackoverflow.com/users/2325694/joe-linoff"}, "reply_to_user": {"reputation": 20508, "user_id": 2196426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8e8759ad9a50739704dca2e84fa9b50?s=128&d=identicon&r=PG", "display_name": "Jakuje", "link": "https://stackoverflow.com/users/2196426/jakuje"}, "edited": false, "score": 0, "creation_date": 1477872160, "post_id": 40331761, "comment_id": 67925179, "body": "Thank you, that sounds like a good idea but how do I flush stderr and stdout from the ssh session? I don&#39;t have a writer, only the pipes that are handled by the multi-reader in the scanner. Can you provide a code fragment?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1477941629, "post_id": 40331761, "comment_id": 67952634, "body": "@JoeLinoff: from the <a href=\"https://golang.org/pkg/io/#MultiReader\" rel=\"nofollow noreferrer\"><code>io.MultiReader</code> docs</a>: &quot;They&#39;re read sequentially&quot;. Does <a href=\"https://godoc.org/golang.org/x/crypto/ssh#Session.CombinedOutput\" rel=\"nofollow noreferrer\"><code>Session.CombinedOutput</code></a> not do what you want?"}, {"owner": {"reputation": 662, "user_id": 2325694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e557f0b61a4c84567abca5ca66e3c3f3?s=128&d=identicon&r=PG", "display_name": "Joe Linoff", "link": "https://stackoverflow.com/users/2325694/joe-linoff"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1477958247, "post_id": 40331761, "comment_id": 67958999, "body": "Thank you @JimB, I missed that completely. It certainly explains what I am seeing so the behavior is correct. Session.CombinedOutput might do the trick. I will try that."}, {"owner": {"reputation": 662, "user_id": 2325694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e557f0b61a4c84567abca5ca66e3c3f3?s=128&d=identicon&r=PG", "display_name": "Joe Linoff", "link": "https://stackoverflow.com/users/2325694/joe-linoff"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1477959068, "post_id": 40331761, "comment_id": 67959169, "body": "@JimB, I tried your suggestion (see update #1 above). Unfortunately Session.CombinedOutput also did not interleave the stdout/stderr data. Do you have any other ideas that i could try?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1477961083, "post_id": 40331761, "comment_id": 67959616, "body": "The only way to really get the exact same behavior as <code>2&gt;&amp;1</code>, is to have a shell execute your command with that redirection, or have your command write to one FD on its own. Even without ssh in the mix, there&#39;s never going to be synchronization between stdout and stderr. The output is going to 2 separate FDs (where stderr may have different buffering or latency), and sent over 2 separate channels."}, {"owner": {"reputation": 662, "user_id": 2325694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e557f0b61a4c84567abca5ca66e3c3f3?s=128&d=identicon&r=PG", "display_name": "Joe Linoff", "link": "https://stackoverflow.com/users/2325694/joe-linoff"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1478061734, "post_id": 40331761, "comment_id": 67998293, "body": "Thanks @JimB. I appreciate the insight.  I have been perusing the SSH source code and came to the same conclusion. I was just hoping that I was missing something that would make it possible.   I even tried an experiment where I created two separate channels (stderr and stdout), with separate go routines to populate them. They still did not interleave because, as you said, they were separate FDs. The only workaround I could think of was to insert a time field that could be used for ordering them."}], "answers": [{"tags": [], "owner": {"reputation": 662, "user_id": 2325694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e557f0b61a4c84567abca5ca66e3c3f3?s=128&d=identicon&r=PG", "display_name": "Joe Linoff", "link": "https://stackoverflow.com/users/2325694/joe-linoff"}, "is_accepted": true, "score": 1, "last_activity_date": 1478062470, "creation_date": 1478062470, "answer_id": 40372726, "question_id": 40331761, "link": "https://stackoverflow.com/questions/40331761/how-do-i-capture-interleaved-stdout-and-stderr-in-a-goloang-ssh-session/40372726#40372726", "title": "How do i capture interleaved stdout and stderr in a goloang ssh session?", "body": "<p>Based on @JimB's feedback and my experiment in update #2, you must specify <code>&amp;&gt;</code> or <code>2&gt;&amp;1</code> in the shell command to interleave stderr and stdout.</p>\n"}], "owner": {"reputation": 662, "user_id": 2325694, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e557f0b61a4c84567abca5ca66e3c3f3?s=128&d=identicon&r=PG", "display_name": "Joe Linoff", "link": "https://stackoverflow.com/users/2325694/joe-linoff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1183, "favorite_count": 1, "accepted_answer_id": 40372726, "answer_count": 1, "score": 2, "last_activity_date": 1478063517, "creation_date": 1477849040, "last_edit_date": 1478063517, "question_id": 40331761, "link": "https://stackoverflow.com/questions/40331761/how-do-i-capture-interleaved-stdout-and-stderr-in-a-goloang-ssh-session", "title": "How do i capture interleaved stdout and stderr in a goloang ssh session?", "body": "<p>How can i capture interleaved stderr/stdout output from an ssh.Session in go to model shell redirection of the form <code>2>&amp;1</code>?</p>\n\n<p>I tried to it do by combining the output of the stdout and stderr pipes from the session into a multi-reader and then used a scanner to capture the data from the multi-reader asynchronously in a go routine. </p>\n\n<p>That worked, sort of. All of the data was caught but the stderr data was not interleaved. It appeared at the end. </p>\n\n<p>I was able to cause the stderr output to appear at the beginning by reversing the order of the arguments to io.MultiReader() but it was still not interleaved.</p>\n\n<p>Here is the output I expected. </p>\n\n<pre><code>$ ./gentestdata -i 5 -d -l -n 12 -w 32 -a 'Lorem ipsum dolor sit amet'\n     1 Lorem ipsum dolor sit am\n     2 Lorem ipsum dolor sit am\n     3 Lorem ipsum dolor sit am\n     4 Lorem ipsum dolor sit am\n     5 Lorem ipsum dolor sit am\n     6 Lorem ipsum dolor sit am\n     7 Lorem ipsum dolor sit am\n     8 Lorem ipsum dolor sit am\n     9 Lorem ipsum dolor sit am\n    10 Lorem ipsum dolor sit am\n    11 Lorem ipsum dolor sit am\n    12 Lorem ipsum dolor sit am\n\n$ # note that two of the lines were output to stderr\n$ ./gentestdata -i 5 -d -l -n 12 -w 32 -a 'Lorem ipsum dolor sit amet' 1&gt;/dev/null\n     5 Lorem ipsum dolor sit am\n    10 Lorem ipsum dolor sit am\n</code></pre>\n\n<blockquote>\n  <p>The gentestdata program is something I developed to allow me to do this sort of test. The source can be found here: <a href=\"https://github.com/jlinoff/gentestdata\" rel=\"nofollow noreferrer\">https://github.com/jlinoff/gentestdata</a>.</p>\n</blockquote>\n\n<p>Here is the output I saw:</p>\n\n<pre><code>$ ./sshx $(pwd)/gentestdata -i 5 -d -l -n 12 -w 32 -a 'Lorem ipsum dolor sit amet'\n     1 Lorem ipsum dolor sit am\n     2 Lorem ipsum dolor sit am\n     3 Lorem ipsum dolor sit am\n     4 Lorem ipsum dolor sit am\n     6 Lorem ipsum dolor sit am\n     7 Lorem ipsum dolor sit am\n     8 Lorem ipsum dolor sit am\n     9 Lorem ipsum dolor sit am\n    11 Lorem ipsum dolor sit am\n    12 Lorem ipsum dolor sit am\n     5 Lorem ipsum dolor sit am\n    10 Lorem ipsum dolor sit am\n</code></pre>\n\n<p>Note that the last two lines from stderr are out of order.</p>\n\n<p>Here is the complete source code. Note the exec() function.</p>\n\n<pre><code>// Simple demonstration of how I thought that I could capture interleaved\n// stdout and stderr output generated during go ssh.Session to model the\n// bash 2&gt;&amp;1 redirection behavior.\npackage main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os\"\n    \"os/signal\"\n    \"runtime\"\n    \"strings\"\n    \"syscall\"\n\n    \"golang.org/x/crypto/ssh\"\n    \"golang.org/x/crypto/ssh/terminal\"\n)\n\nfunc main() {\n    user := strings.TrimSpace(os.Getenv(\"LOGNAME\"))\n    auth := getPassword(fmt.Sprintf(\"%v's password: \", user))\n    addr := \"localhost:22\"\n    if len(os.Args) &gt; 1 {\n        cmd := getCmd(os.Args[1:])\n        config := &amp;ssh.ClientConfig{\n            User: user,\n            Auth: []ssh.AuthMethod{\n                ssh.Password(auth),\n            },\n        }\n        exec(cmd, addr, config)\n    }\n}\n\n// Execute the command.\nfunc exec(cmd string, addr string, config *ssh.ClientConfig) {\n    // Create the connection.\n    conn, err := ssh.Dial(\"tcp\", addr, config)\n    check(err)\n    session, err := conn.NewSession()\n    check(err)\n    defer session.Close()\n\n    // Collect the output from stdout and stderr.\n    // The idea is to duplicate the shell IO redirection\n    // 2&gt;&amp;1 where both streams are interleaved.\n    stdoutPipe, err := session.StdoutPipe()\n    check(err)\n    stderrPipe, err := session.StderrPipe()\n    check(err)\n    outputReader := io.MultiReader(stdoutPipe, stderrPipe)\n    outputScanner := bufio.NewScanner(outputReader)\n\n    // Start the session.\n    err = session.Start(cmd)\n    check(err)\n\n    // Capture the output asynchronously.\n    outputLine := make(chan string)\n    outputDone := make(chan bool)\n    go func(scan *bufio.Scanner, line chan string, done chan bool) {\n        defer close(line)\n        defer close(done)\n        for scan.Scan() {\n            line &lt;- scan.Text()\n        }\n        done &lt;- true\n    }(outputScanner, outputLine, outputDone)\n\n    // Use a custom wait.\n    outputBuf := \"\"\n    running := true\n    for running {\n        select {\n        case &lt;-outputDone:\n            running = false\n        case line := &lt;-outputLine:\n            outputBuf += line + \"\\n\"\n        }\n    }\n    session.Close()\n\n    // Output the data.\n    fmt.Print(outputBuf)\n}\n\nfunc check(e error) {\n    if e != nil {\n        _, _, lineno, _ := runtime.Caller(1)\n        log.Fatalf(\"ERROR:%v %v\", lineno, e)\n    }\n}\n\n// Convert a slice of tokens to a command string.\n// It inserts quotes where necessary.\nfunc getCmd(args []string) (cmd string) {\n    cmd = \"\"\n    for i, token := range args {\n        if i &gt; 0 {\n            cmd += \" \"\n        }\n        cmd += quote(token)\n    }\n    return\n}\n\n// Quote an individual token.\n// Very simple, not suitable for production.\nfunc quote(token string) string {\n    q := false\n    r := \"\"\n    for _, c := range token {\n        switch c {\n        case '\"':\n            q = true\n            r += \"\\\"\"\n        case ' ', '\\t':\n            q = true\n        }\n        r += string(c)\n    }\n    if q {\n        r = \"\\\"\" + r + \"\\\"\"\n    }\n    return r\n}\n\nfunc getPassword(prompt string) string {\n    // Get the initial state of the terminal.\n    initialTermState, e1 := terminal.GetState(syscall.Stdin)\n    if e1 != nil {\n        panic(e1)\n    }\n\n    // Restore it in the event of an interrupt.\n    // CITATION: Konstantin Shaposhnikov - https://groups.google.com/forum/#!topic/golang-nuts/kTVAbtee9UA\n    c := make(chan os.Signal)\n    signal.Notify(c, os.Interrupt, os.Kill)\n    go func() {\n        &lt;-c\n        _ = terminal.Restore(syscall.Stdin, initialTermState)\n        os.Exit(1)\n    }()\n\n    // Now get the password.\n    fmt.Print(prompt)\n    p, err := terminal.ReadPassword(syscall.Stdin)\n    fmt.Println(\"\")\n    if err != nil {\n        panic(err)\n    }\n\n    // Stop looking for ^C on the channel.\n    signal.Stop(c)\n\n    // Return the password as a string.\n    return string(p)\n}\n</code></pre>\n\n<p>Any insights would be greatly appreciated.</p>\n\n<h2>Update #1: Tried suggestion from JimB</h2>\n\n<p>Modified the exec function as follows:</p>\n\n<pre><code>// Execute the command.\nfunc exec(cmd string, addr string, config *ssh.ClientConfig) {\n    // Create the connection.\n    conn, err := ssh.Dial(\"tcp\", addr, config)\n    check(err)\n    session, err := conn.NewSession()\n    check(err)\n    defer session.Close()\n\n    // Run the command.\n    b, err := session.CombinedOutput(cmd)\n    check(err)\n\n    // Output the data.\n    outputBuf := string(b)\n    fmt.Print(outputBuf)\n}\n</code></pre>\n\n<p>It changed things but the output was still not interleaved. This is the output\nfrom the test run.</p>\n\n<pre><code>     5 9FqBZonjaaWDcXMm8biABker\n    10 zMd1JTT3ZGR5mEuJOaJCo9AZ\n     1 bPlNFGdSC2wd8f2QnFhk5A84\n     2 H9H2FHFuvUs9Jz8UvBHv3Vc5\n     3 wsp2nChCIwVQztA2n95rXrtz\n     4 eDZ0tHBxFq6Pysq3N267L1vq\n     6 DF2EsjYyTQWCfIuilZxV2FCn\n     7 fGOILa0u1wXnEw1GDGuvdSew\n     8 fj84Qyu6uRn8CTECWzT5s4ZJ\n     9 KykqOn91fMwNqsk2Wrc5uhk2\n    11 0p7opMMsnA87D6TSTAXY5NAC\n    12 HYixe6pj0dHuKlxQyyNenUNQ\n</code></pre>\n\n<p>Now the stderr data shows up at the beginning.</p>\n\n<h2>Update #2: Showed the SSH also separated the FDs</h2>\n\n<p>After JimB's last comment I decided to run experiment using SSH on both a Mac and on a Linux host using gentest. Note that SSH also separates the output so this issue is resolved.</p>\n\n<h3>Terminal</h3>\n\n<pre><code>$ # Interleaved on the terminal.\n$ /user/jlinoff/bin/gentestdata -l -i 5 -w 32 -n 12\n     1 bPlNFGdSC2wd8f2QnFhk5A84\n     2 H9H2FHFuvUs9Jz8UvBHv3Vc5\n     3 wsp2nChCIwVQztA2n95rXrtz\n     4 eDZ0tHBxFq6Pysq3N267L1vq\n     5 9FqBZonjaaWDcXMm8biABker\n     6 DF2EsjYyTQWCfIuilZxV2FCn\n     7 fGOILa0u1wXnEw1GDGuvdSew\n     8 fj84Qyu6uRn8CTECWzT5s4ZJ\n     9 KykqOn91fMwNqsk2Wrc5uhk2\n    10 zMd1JTT3ZGR5mEuJOaJCo9AZ\n    11 0p7opMMsnA87D6TSTAXY5NAC\n    12 HYixe6pj0dHuKlxQyyNenUNQ\n</code></pre>\n\n<h3>SSH</h3>\n\n<pre><code>$ ssh hqxsv-cmdev3-jlinoff /user/jlinoff/bin/gentestdata -l -i 5 -w 32 -n 12\n     1 bPlNFGdSC2wd8f2QnFhk5A84\n     2 H9H2FHFuvUs9Jz8UvBHv3Vc5\n     3 wsp2nChCIwVQztA2n95rXrtz\n     4 eDZ0tHBxFq6Pysq3N267L1vq\n     6 DF2EsjYyTQWCfIuilZxV2FCn\n     7 fGOILa0u1wXnEw1GDGuvdSew\n     8 fj84Qyu6uRn8CTECWzT5s4ZJ\n     9 KykqOn91fMwNqsk2Wrc5uhk2\n    11 0p7opMMsnA87D6TSTAXY5NAC\n    12 HYixe6pj0dHuKlxQyyNenUNQ\n     5 9FqBZonjaaWDcXMm8biABker\n    10 zMd1JTT3ZGR5mEuJOaJCo9AZ\n</code></pre>\n\n<p>Note that the last two lines (stderr) are not interleaved.</p>\n"}, {"tags": ["go", "package", "tor"], "comments": [{"owner": {"reputation": 64787, "user_id": 892493, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UxAIF.png?s=128&g=1", "display_name": "drew010", "link": "https://stackoverflow.com/users/892493/drew010"}, "edited": false, "score": 0, "creation_date": 1478027671, "post_id": 40329462, "comment_id": 67987346, "body": "Easy on Windows, harder on Linux due to different distros, architectures and dependencies on openssl and the like.  Aside from that, yes it&#39;s easy to have your program launch it&#39;s own Tor daemon (preferably on a port other than 9050 or 9150) and use it.  This is what the Tor Browser Bundle does.  For Linux you might just be able to rip the Tor binaries right out of the bundle and distribute those."}, {"owner": {"reputation": 708, "user_id": 3302584, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/19cai.jpg?s=128&g=1", "display_name": "Awn", "link": "https://stackoverflow.com/users/3302584/awn"}, "reply_to_user": {"reputation": 64787, "user_id": 892493, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UxAIF.png?s=128&g=1", "display_name": "drew010", "link": "https://stackoverflow.com/users/892493/drew010"}, "edited": false, "score": 0, "creation_date": 1478071148, "post_id": 40329462, "comment_id": 68001446, "body": "@drew010 Are there any resources or guides that I should know about?"}, {"owner": {"reputation": 64787, "user_id": 892493, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/UxAIF.png?s=128&g=1", "display_name": "drew010", "link": "https://stackoverflow.com/users/892493/drew010"}, "edited": false, "score": 1, "creation_date": 1478100377, "post_id": 40329462, "comment_id": 68019275, "body": "None I am aware of personally for this type of specific goal.  The documentation on how to launch the Tor daemon and what configuration options you&#39;ll want to include in your configuration is most helpful.  There&#39;s probably a lot that can be learned from the Tor Browser Bundle because you can consider Tor Browser to be the project that re-packages Tor just like you want to do.  When you launch Tor Browser, it runs its own Tor daemon and configures the browser to use the SOCKS proxy."}, {"owner": {"reputation": 1191, "user_id": 547546, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4bb62fbc38c7277e51e440a3529c2336?s=128&d=identicon&r=PG", "display_name": "Chad Retz", "link": "https://stackoverflow.com/users/547546/chad-retz"}, "edited": false, "score": 1, "creation_date": 1538749114, "post_id": 40329462, "comment_id": 92265095, "body": "I have written a lib that sets up Tor and lets you link it statically: <a href=\"https://github.com/cretz/bine\" rel=\"nofollow noreferrer\">github.com/cretz/bine</a>"}], "answers": [{"comments": [{"owner": {"reputation": 708, "user_id": 3302584, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/19cai.jpg?s=128&g=1", "display_name": "Awn", "link": "https://stackoverflow.com/users/3302584/awn"}, "edited": false, "score": 0, "creation_date": 1478198908, "post_id": 40406622, "comment_id": 68068273, "body": "Yeah I&#39;ve considered this but I&#39;d really like some way of just launching a tor daemon automatically"}], "tags": [], "owner": {"reputation": 157, "user_id": 5081979, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/87a1d.jpg?s=128&g=1", "display_name": "MNZT", "link": "https://stackoverflow.com/users/5081979/mnzt"}, "is_accepted": false, "score": 1, "last_activity_date": 1478190290, "creation_date": 1478190290, "answer_id": 40406622, "question_id": 40329462, "link": "https://stackoverflow.com/questions/40329462/packaging-tor-in-a-go-project/40406622#40406622", "title": "Packaging tor in a go project", "body": "<p>On Linux I recommend you specify Tor as a dependency when distributing your package. An example of this can be seen with Arch Linux's <code>pkgbuild</code> <a href=\"https://wiki.archlinux.org/index.php/PKGBUILD#Dependencies\" rel=\"nofollow noreferrer\">dependencies</a>. </p>\n\n<p>If people want manually check out your code and build on it, you will just have to tell them to install Tor. (Via a README, and a hard error upon execution of your program, where Tor is not installed.)</p>\n"}], "owner": {"reputation": 708, "user_id": 3302584, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/19cai.jpg?s=128&g=1", "display_name": "Awn", "link": "https://stackoverflow.com/users/3302584/awn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1478190290, "creation_date": 1477832885, "last_edit_date": 1477833772, "question_id": 40329462, "link": "https://stackoverflow.com/questions/40329462/packaging-tor-in-a-go-project", "title": "Packaging tor in a go project", "body": "<p>I was researching ways of doing various things over Tor (in go), and the only way so far that I've seen is by connecting to <code>127.0.0.1:9050</code> as a SOCKS5 proxy and talking over that.</p>\n\n<p>However, in a program that end-users would receive, this would require them setting up tor on their own. </p>\n\n<p>Is there some way of packaging it with the project so that when run, it automatically sets up tor - temporarily - on its own?</p>\n"}, {"tags": ["optimization", "go", "reflection"], "comments": [{"owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "edited": false, "score": 0, "creation_date": 1477838667, "post_id": 40329257, "comment_id": 67915450, "body": "I don&#39;t think this question can really be answered without defining how the resulting <code>*byte</code> is used. Without a clear notion of that, who&#39;s to say what are valid types for the conversion? You can probably work around some of the repetitive boilerplate with <a href=\"https://golang.org/pkg/reflect/#Value.Pointer\" rel=\"nofollow noreferrer\"><code>reflect.Value.Pointer</code></a>"}, {"owner": {"reputation": 51, "user_id": 2045547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe8fe50c5d07b47ba92eb4b25dc516dd?s=128&d=identicon&r=PG", "display_name": "Neo", "link": "https://stackoverflow.com/users/2045547/neo"}, "reply_to_user": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "edited": false, "score": 0, "creation_date": 1477842805, "post_id": 40329257, "comment_id": 67916604, "body": "@nothingmuch Think of it like this. I want to be able to get the starting memory address to any structure I can create in Go. You can compare that to getting a pointer to any data type or structure in C.  My real usage is for calling the method DeviceIoControl(Handle, uint32, *byte, uint32, *byte, uint32, *uint32, *Overlapped).   This method needs pre-initialized memory buffers passed to it as arguments, but as *byte. The buffers sometimes consist of string, uint32, []byte, etc. So my intention is to create a util function which gives me the byte pointer to any underlying memory block."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1477843530, "post_id": 40329257, "comment_id": 67916792, "body": "Use reflection (see e.g. reflect.SliceHeader)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1477845055, "post_id": 40329257, "comment_id": 67917221, "body": "@Neo, you&#39;re not taking the starting address of the slice structure, you&#39;re taking the address of the backing array, which is an arbitrary field in the structure. You can make various exceptions if you like, but the backing array for a <code>string</code> isn&#39;t technically addressable."}], "answers": [{"tags": [], "owner": {"reputation": 193, "user_id": 3758378, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c20533042419e61d33cfe3b037143a0b?s=128&d=identicon&r=PG&f=1", "display_name": "0x10203040", "link": "https://stackoverflow.com/users/3758378/0x10203040"}, "is_accepted": false, "score": 0, "last_activity_date": 1477838472, "creation_date": 1477838472, "answer_id": 40330217, "question_id": 40329257, "link": "https://stackoverflow.com/questions/40329257/how-to-get-a-byte-pointer-to-a-value-of-any-data-type-in-golang/40330217#40330217", "title": "How to get a byte pointer to a value of any data type in Golang?", "body": "<p>Golang does not have generics, so I guess you need to catch every single type.</p>\n\n<p>Also, in your example, you got the first byte of the first element in the slice, not the first byte of the value passed to the function.</p>\n"}, {"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1477920574, "post_id": 40332079, "comment_id": 67940442, "body": "You&#39;re going to need to know the type at some point, so why hide the type in an interface and use reflect when you could just convert the pointer directly? (and what&#39;s the point of having the <code>string</code> become a pointer to the string struct, while a <code>[]byte</code> becomes a pointer to the backing array?)"}], "tags": [], "owner": {"reputation": 51, "user_id": 2045547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe8fe50c5d07b47ba92eb4b25dc516dd?s=128&d=identicon&r=PG", "display_name": "Neo", "link": "https://stackoverflow.com/users/2045547/neo"}, "is_accepted": false, "score": 1, "last_activity_date": 1477851193, "creation_date": 1477851193, "answer_id": 40332079, "question_id": 40329257, "link": "https://stackoverflow.com/questions/40329257/how-to-get-a-byte-pointer-to-a-value-of-any-data-type-in-golang/40332079#40332079", "title": "How to get a byte pointer to a value of any data type in Golang?", "body": "<p>Thanks for the suggestions, I believe I've found what I was looking for. It can be done, just needed to dig a little bit into the reflection package of Go. I'll answer my own question just so that somebody else might find this helpful.</p>\n\n<p>The elegant one liner to get the starting memory address of any allocated block of memory as a byte pointer in Go would be:</p>\n\n<pre><code>(*byte)(unsafe.Pointer(reflect.ValueOf(anyAllocatedDataGoesHere).Pointer()))\n</code></pre>\n\n<p>If anybody needs to check how it will behave for any data type, i.e []uint32, []byte, string, int, struct, have a look at this sample PlayGround I prepared.</p>\n\n<p><a href=\"https://play.golang.org/p/G5fUOCfNCS\" rel=\"nofollow\">https://play.golang.org/p/G5fUOCfNCS</a></p>\n"}, {"tags": [], "owner": {"reputation": 566, "user_id": 4934782, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ae4c1c1fd0fa82205af63dc62eeb347f?s=128&d=identicon&r=PG", "display_name": "Aaron", "link": "https://stackoverflow.com/users/4934782/aaron"}, "is_accepted": false, "score": 0, "last_activity_date": 1480785974, "creation_date": 1480785974, "answer_id": 40950495, "question_id": 40329257, "link": "https://stackoverflow.com/questions/40329257/how-to-get-a-byte-pointer-to-a-value-of-any-data-type-in-golang/40950495#40950495", "title": "How to get a byte pointer to a value of any data type in Golang?", "body": "<p>Depending on what your application is, you might consider Gob encoding or protobuf (as used in Brad Fitz's <a href=\"https://github.com/golang/groupcache/blob/master/sinks.go\" rel=\"nofollow noreferrer\" title=\"groupcache\">groupcache</a>). You'd be making a copy of your data, and I'm pretty sure there's still reflection going on under the hood, but at least you're getting well-optimized copying &amp; byte encoding, which may be a plus since I suspect the next step in your application once you have these bytes is a copy of some sort.</p>\n"}], "owner": {"reputation": 51, "user_id": 2045547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe8fe50c5d07b47ba92eb4b25dc516dd?s=128&d=identicon&r=PG", "display_name": "Neo", "link": "https://stackoverflow.com/users/2045547/neo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1781, "favorite_count": 0, "answer_count": 3, "score": -3, "last_activity_date": 1480785974, "creation_date": 1477831655, "question_id": 40329257, "link": "https://stackoverflow.com/questions/40329257/how-to-get-a-byte-pointer-to-a-value-of-any-data-type-in-golang", "title": "How to get a byte pointer to a value of any data type in Golang?", "body": "<p>I've managed to get the following function working in Go. But I want to optimize/generalize the code such that this function would return me a pointer to the first byte of any value I pass into the function. Currently it will only work for []uint32, but I want to use it to get the starting memory address as a *byte for many other types (i.e. byte[], int[], string, etc).</p>\n\n<p>Is there a more generic way to do this rather than catching every single type I need to address as case statements?</p>\n\n<p>Go Playground Link for below code: <a href=\"https://play.golang.org/p/KtNTbERQGa\" rel=\"nofollow\">https://play.golang.org/p/KtNTbERQGa</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"unsafe\"\n)\n\nfunc ToBytePointer(data interface{}) *byte {\n    fmt.Println(\"Received type is\", reflect.TypeOf(data))\n\n    switch data.(type) {\n    case []uint32:\n        typedData := data.([]uint32)\n        return (*byte)(unsafe.Pointer(&amp;typedData[0]))\n    default:\n        return nil\n    }\n}\n\nfunc main() {\n    var data = []uint32{1, 2, 3}\n    var dataBytePointer = (*byte)(unsafe.Pointer(&amp;data[0]))\n\n    fmt.Println(dataBytePointer, ToBytePointer(data))\n}\n</code></pre>\n"}, {"tags": ["json", "api", "facebook-graph-api", "go"], "answers": [{"tags": [], "owner": {"reputation": 867, "user_id": 997571, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/9Tdwb.jpg?s=128&g=1", "display_name": "Chali", "link": "https://stackoverflow.com/users/997571/chali"}, "is_accepted": true, "score": 0, "last_activity_date": 1477832227, "creation_date": 1477832227, "answer_id": 40329357, "question_id": 40329025, "link": "https://stackoverflow.com/questions/40329025/golang-facebook-api-huandu-facebook-post-description-issue/40329357#40329357", "title": "Golang facebook api huandu/facebook Post Description issue", "body": "<p>I found the problem , it is just because of i am linking to the jpeg file, when place a proper link it works perfect..</p>\n"}], "owner": {"reputation": 867, "user_id": 997571, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/9Tdwb.jpg?s=128&g=1", "display_name": "Chali", "link": "https://stackoverflow.com/users/997571/chali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 641, "favorite_count": 0, "accepted_answer_id": 40329357, "answer_count": 1, "score": 2, "last_activity_date": 1477832227, "creation_date": 1477830258, "last_edit_date": 1477830335, "question_id": 40329025, "link": "https://stackoverflow.com/questions/40329025/golang-facebook-api-huandu-facebook-post-description-issue", "title": "Golang facebook api huandu/facebook Post Description issue", "body": "<p>Hi I am using golang huandu/facebook as Oath client to post articles, But the description and name fields does not get posted, only the status message and the image , link get published.. Please help</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    fb \"github.com/huandu/facebook\"\n)\n\nfunc main() {\n    res, e := fb.Post(\"/97876588/feed\", fb.Params{\n        \"type\": \"link\",\n        \"name\": \"test news is here\",\n        \"caption\": \"The caption of a link in the post \",\n        \"picture\": \"http://img.tvguide.dk/tvnyheder/39ecaf74dbfa71c79225705c0d36bb09.jpg\",\n        \"link\":\"http://img.tvguide.dk/tvnyheder/39ecaf74dbfa71c79225705c0d36bb09.jpg\",\n        \"description\":\"hendes lille datter foregik nemlig under helt andre omst\u00e6ndigheder,er Tina Lund.\",\n        \"access_token\": \"access-token\",\n    })\n    fmt.Println(e)\n    fmt.Println(res)\n}\n</code></pre>\n"}, {"tags": ["pointers", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1477831814, "last_edit_date": 1477831814, "creation_date": 1477830085, "answer_id": 40328997, "question_id": 40328658, "link": "https://stackoverflow.com/questions/40328658/pointer-receiver-not-faster-than-value-receiver-when-benchmarking/40328997#40328997", "title": "Pointer receiver not faster than value receiver when benchmarking", "body": "<p>Your benchmark functions measure whatever is inside the <code>for</code> loops, e.g.:</p>\n\n<pre><code>    big := &amp;BigStruct{name: \"greg\", data: []byte(strings.Repeat(\"test1234\", 1024))}\n    big.addDataPointer()\n</code></pre>\n\n<p>And:</p>\n\n<pre><code>    big := BigStruct{name: \"greg\", data: []byte(strings.Repeat(\"test1234\", 1024))}\n    addData(big)\n</code></pre>\n\n<p>So you also benchmark <code>strings.Repeat()</code>, which gives you a long <code>string</code> value, and you also convert it to <code>[]byte</code>, which makes a copy of this lengthy <code>string</code>.</p>\n\n<p>The execution times of these are much bigger than the execution times of your <code>addDataPointer()</code> method and <code>addData()</code> function.</p>\n\n<p>Move the conversion and <code>strings.Repeat()</code> call outside of the <code>for</code> loops, something like this:</p>\n\n<pre><code>func BenchmarkBigLenPointer(b *testing.B) {\n    s := []byte(strings.Repeat(\"test1234\", 1024))\n    for i := 0; i &lt; b.N; i++ {\n        big := &amp;BigStruct{name: \"greg\", data: s}\n        big.addDataPointer()\n    }\n}\n\nfunc BenchmarkBigLen(b *testing.B) {\n    s := []byte(strings.Repeat(\"test1234\", 1024))\n    for i := 0; i &lt; b.N; i++ {\n        big := BigStruct{name: \"greg\", data: s}\n        addData(big)\n    }\n}\n</code></pre>\n\n<p>Now this is more accurate to measure the time of your method and function. But even when you benchmark this, you will get benchmark results that show that execution times of both <code>addData()</code> and <code>addDataPointer()</code> are very close.</p>\n\n<p>The explanation for this is that in case of the function you pass a struct value containing a byte slice. Slices in Go are small descriptors (struct like headers), which do not contain the elements of the slices but only a pointer to a backing array. So the size of a slice value is the same, regardless of its length (number of elements). To see what's inside a slice header, check out the <a href=\"https://golang.org/pkg/reflect/#SliceHeader\" rel=\"nofollow\"><code>reflect.SliceHeader</code></a> type.</p>\n\n<p>So the overhead of the function is little, which might give a little to its execution time, but the pointer method on the other hand needs to dereference the pointer, which adds a little to its execution time. In the end, they are very close. In this case there is not much difference.</p>\n"}], "owner": {"reputation": 1057, "user_id": 974990, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/c5a813df5e1175a873c40b2bf07db802?s=128&d=identicon&r=PG", "display_name": "Gregorio Di Stefano", "link": "https://stackoverflow.com/users/974990/gregorio-di-stefano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 40328997, "answer_count": 1, "score": -1, "last_activity_date": 1477831814, "creation_date": 1477827610, "question_id": 40328658, "link": "https://stackoverflow.com/questions/40328658/pointer-receiver-not-faster-than-value-receiver-when-benchmarking", "title": "Pointer receiver not faster than value receiver when benchmarking", "body": "<p>Here is the code I'm testing, I was expecting to see that when bench marking, the pointer based addDataPointer would perform faster than the addData value based function. Why is there no significant changes in performance between the two?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype BigStruct struct {\n    name string\n    data []byte\n}\n\nfunc addData(s BigStruct) BigStruct {\n    s.data = append([]byte{0x00, 0x01, 0x02, 0x03, 0x04, 0x05}, s.data...)\n    return BigStruct{name: s.name, data: s.data}\n}\n\nfunc (s *BigStruct) addDataPointer() {\n    s.data = append([]byte{0x00, 0x01, 0x02, 0x03, 0x04, 0x05}, s.data...)\n}\n\nfunc main() {\n    a := BigStruct{name: \"greg\", data: []byte(\"abc\")}\n    b := &amp;BigStruct{name: \"greg\", data: []byte(\"abc\")}\n    fmt.Println(addData(a))\n    b.addDataPointer()\n    fmt.Println(*b)\n}\n\nfunc BenchmarkBigLenPointer(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        big := &amp;BigStruct{name: \"greg\", data: []byte(strings.Repeat(\"test1234\", 1024))}\n        big.addDataPointer()\n    }\n}\n\nfunc BenchmarkBigLen(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        big := BigStruct{name: \"greg\", data: []byte(strings.Repeat(\"test1234\", 1024))}\n        addData(big)\n    }\n</code></pre>\n"}, {"tags": ["go", "tcp", "tor"], "comments": [{"owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "edited": false, "score": 2, "creation_date": 1477823880, "post_id": 40328025, "comment_id": 67911373, "body": "Use the tor proxy"}, {"owner": {"reputation": 1191, "user_id": 547546, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4bb62fbc38c7277e51e440a3529c2336?s=128&d=identicon&r=PG", "display_name": "Chad Retz", "link": "https://stackoverflow.com/users/547546/chad-retz"}, "edited": false, "score": 2, "creation_date": 1538749061, "post_id": 40328025, "comment_id": 92265066, "body": "I wrote a lib that helps with this: <a href=\"https://github.com/cretz/bine\" rel=\"nofollow noreferrer\">github.com/cretz/bine</a>"}], "answers": [{"comments": [{"owner": {"reputation": 708, "user_id": 3302584, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/19cai.jpg?s=128&g=1", "display_name": "Awn", "link": "https://stackoverflow.com/users/3302584/awn"}, "edited": false, "score": 0, "creation_date": 1479253367, "post_id": 40621513, "comment_id": 68477424, "body": "Thanks, that&#39;s really helpful. Didn&#39;t think I was going to get an answer."}], "tags": [], "owner": {"reputation": 4456, "user_id": 4127569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8b728c7d6c1dce81f5a82249b7617756?s=128&d=identicon&r=PG&f=1", "display_name": "jch", "link": "https://stackoverflow.com/users/4127569/jch"}, "is_accepted": true, "score": 21, "last_activity_date": 1560946774, "last_edit_date": 1560946774, "creation_date": 1479252297, "answer_id": 40621513, "question_id": 40328025, "link": "https://stackoverflow.com/questions/40328025/tcp-connection-over-tor-in-golang/40621513#40621513", "title": "TCP connection over Tor in Golang", "body": "<p>A tor node acts as a SOCKS proxy on port 9050.  Go support for the SOCKS5 protocol lives in package <code>golang.org/x/net/proxy</code>:</p>\n\n<pre><code>import \"golang.org/x/net/proxy\"\n</code></pre>\n\n<p>In order to make connections through tor, you first need to create a new <code>Dialer</code> that goes through the local SOCKS5 proxy:</p>\n\n<pre><code>dialer, err := proxy.SOCKS5(\"tcp\", \"127.0.0.1:9050\", nil, nil)\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>To use this dialer, you just call <code>dialer.Dial</code> instead of <code>net.Dial</code>:</p>\n\n<pre><code>conn, err := dialer.Dial(\"tcp\", \"stackoverflow.com:80\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer conn.Close()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 672, "user_id": 2638505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c4c3639e1f44f15afdb6de18a9e12740?s=128&d=identicon&r=PG", "display_name": "Effi Bar-She&#39;an", "link": "https://stackoverflow.com/users/2638505/effi-bar-shean"}, "is_accepted": false, "score": 0, "last_activity_date": 1594883428, "last_edit_date": 1594883428, "creation_date": 1594805189, "answer_id": 62911709, "question_id": 40328025, "link": "https://stackoverflow.com/questions/40328025/tcp-connection-over-tor-in-golang/62911709#62911709", "title": "TCP connection over Tor in Golang", "body": "<p>There are three ways to instruct a client to use a proxy:</p>\n<ol>\n<li>Set the <code>HTTP_PROXY</code> environment variable:</li>\n</ol>\n<pre><code>$ export HTTP_PROXY=&quot;http://ProxyIP:ProxyPort&quot;\n</code></pre>\n<p><code>HTTP_PROXY</code> environment variable will be used as the proxy URL for HTTP requests and HTTPS requests, unless overridden by <code>HTTPS_PROXY</code> or <code>NO_PROXY</code></p>\n<p>In <em>tor</em> use case it should look like this (when running tor on localhost):</p>\n<pre><code>$ export HTTP_PROXY=&quot;socks5://127.0.0.1:9050&quot;\n</code></pre>\n<ol start=\"2\">\n<li>Explicitly instructing the HTTP client to use a proxy. Here\u2019s an example in golang:</li>\n</ol>\n<pre><code>proxy, _ := url.Parse(&quot;http://ProxyIP:ProxyPort&quot;) \nhttpClient := &amp;http.Client{Transport: &amp;http.Transport{Proxy: http.ProxyURL(proxy)}}\n</code></pre>\n<ol start=\"3\">\n<li>Golang also offers the default transport option as part of the \u201cnet/http\u201d package. This setting instructs the entire program (including the default HTTP client) to use the proxy:</li>\n</ol>\n<pre><code>proxy, _ := url.Parse(&quot;http://ProxyIP:ProxyPort&quot;) \nhttp.DefaultTransport = &amp;http.Client{Transport: &amp;http.Transport{Proxy: http.ProxyURL(proxy)}}\n</code></pre>\n<p>You can find example of go HTTP client using proxy in <a href=\"https://github.com/Tufin/blog/blob/master/go-proxy/common/http.go\" rel=\"nofollow noreferrer\">here</a></p>\n<p>And, you can read about how to run <em>tor</em> proxy inside a docker container, how to run it as part of kubernetes as an egress gateway in <a href=\"https://medium.com/@tufin/how-to-use-a-proxy-with-go-http-client-cfc485e9f342\" rel=\"nofollow noreferrer\">here</a></p>\n"}, {"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 1, "last_activity_date": 1594883814, "creation_date": 1594883814, "answer_id": 62929450, "question_id": 40328025, "link": "https://stackoverflow.com/questions/40328025/tcp-connection-over-tor-in-golang/62929450#62929450", "title": "TCP connection over Tor in Golang", "body": "<p>the most portable way to achieve this is to use the wrapper <a href=\"https://github.com/cretz/bine\" rel=\"nofollow noreferrer\">wrote by Chad Retz</a></p>\n<p>It will embed tor required assets into your binary. So that you can distribute it and ensure your app goes through tor.</p>\n<p>In that scenario the end user does not need to install TBB or anything else other than your app.</p>\n<p>Though to be honest, it does not include automatic updates of the tor engine, so this is something to perform on your end to ensure top security.</p>\n<pre><code>package main\n\nimport (\n    &quot;context&quot;\n    &quot;fmt&quot;\n    &quot;log&quot;\n    &quot;net/http&quot;\n    &quot;time&quot;\n\n    &quot;github.com/cretz/bine/tor&quot;\n)\n\nfunc main() {\n    // Start tor with default config (can set start conf's DebugWriter to os.Stdout for debug logs)\n    fmt.Println(&quot;Starting and registering onion service, please wait a couple of minutes...&quot;)\n    t, err := tor.Start(nil, nil)\n    if err != nil {\n        log.Panicf(&quot;Unable to start Tor: %v&quot;, err)\n    }\n    defer t.Close()\n    // Wait at most a few minutes to publish the service\n    listenCtx, listenCancel := context.WithTimeout(context.Background(), 3*time.Minute)\n    defer listenCancel()\n    // Create a v3 onion service to listen on any port but show as 80\n    onion, err := t.Listen(listenCtx, &amp;tor.ListenConf{Version3: true, RemotePorts: []int{80}})\n    if err != nil {\n        log.Panicf(&quot;Unable to create onion service: %v&quot;, err)\n    }\n    defer onion.Close()\n    fmt.Printf(&quot;Open Tor browser and navigate to http://%v.onion\\n&quot;, onion.ID)\n    fmt.Println(&quot;Press enter to exit&quot;)\n    // Serve the current folder from HTTP\n    errCh := make(chan error, 1)\n    go func() { errCh &lt;- http.Serve(onion, http.FileServer(http.Dir(&quot;.&quot;))) }()\n    // End when enter is pressed\n    go func() {\n        fmt.Scanln()\n        errCh &lt;- nil\n    }()\n    if err = &lt;-errCh; err != nil {\n        log.Panicf(&quot;Failed serving: %v&quot;, err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 708, "user_id": 3302584, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/19cai.jpg?s=128&g=1", "display_name": "Awn", "link": "https://stackoverflow.com/users/3302584/awn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4443, "favorite_count": 5, "accepted_answer_id": 40621513, "answer_count": 3, "score": 8, "last_activity_date": 1594883814, "creation_date": 1477822755, "last_edit_date": 1479254713, "question_id": 40328025, "link": "https://stackoverflow.com/questions/40328025/tcp-connection-over-tor-in-golang", "title": "TCP connection over Tor in Golang", "body": "<p>Is it possible to initiate a TCP connection over the tor network in go? I've looked around but haven't found a mention of it.</p>\n\n<p>If not, is there something similar to TCP - like websockets - that can be used instead?</p>\n\n<p>Note: There's no source code for me to post at the moment since there isn't any yet. This is simply research beforehand.</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1477822226, "post_id": 40327941, "comment_id": 67910954, "body": "Print the error to see what it is and post the result: <code>fmt.Println(&quot;Error:&quot;, err)</code>"}, {"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1477822469, "post_id": 40327941, "comment_id": 67911022, "body": "will be much better if your method returns and <b>error</b> and then just print the error one time"}, {"owner": {"reputation": 603, "user_id": 3782306, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d2502e2aa71d69d257c0990afd018ff5?s=128&d=identicon&r=PG&f=1", "display_name": "Ezio", "link": "https://stackoverflow.com/users/3782306/ezio"}, "edited": false, "score": 0, "creation_date": 1477822589, "post_id": 40327941, "comment_id": 67911050, "body": "Thank you guyz , actually i am new to this , i was actually closing the connection to database so thats why there was not results thanks alot"}], "answers": [{"tags": [], "owner": {"reputation": 603, "user_id": 3782306, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d2502e2aa71d69d257c0990afd018ff5?s=128&d=identicon&r=PG&f=1", "display_name": "Ezio", "link": "https://stackoverflow.com/users/3782306/ezio"}, "is_accepted": false, "score": 0, "last_activity_date": 1477822688, "creation_date": 1477822688, "answer_id": 40328013, "question_id": 40327941, "link": "https://stackoverflow.com/questions/40327941/error-in-retrieving-results-from-database-in-golang-mysql/40328013#40328013", "title": "Error in retrieving results from database in golang mysql", "body": "<p>Found the solution \nthe problem with this was that i was scanning only one variable instead of that, i should have scanned three variables</p>\n"}], "owner": {"reputation": 603, "user_id": 3782306, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d2502e2aa71d69d257c0990afd018ff5?s=128&d=identicon&r=PG&f=1", "display_name": "Ezio", "link": "https://stackoverflow.com/users/3782306/ezio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 601, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1477822688, "creation_date": 1477822045, "question_id": 40327941, "link": "https://stackoverflow.com/questions/40327941/error-in-retrieving-results-from-database-in-golang-mysql", "title": "Error in retrieving results from database in golang mysql", "body": "<p>I am getting an error while retrieving results from database \nI am having a global database variable which is serving for the whole project\nI have a test program to test the connection and retrieve a row\nwhile i am able to connect to the database\nbut there is an error in retrieving the row\nHere is my code</p>\n\n<pre><code> //global database object for every package\n var (\n     db *sql.DB\n )\n\n func initDatabase() bool {\n    var err error\n    db, err = sql.Open(\"mysql\", \"root:admin@/ipuscraper\")\n    if err != nil {\n       fmt.Println(\"Error in database connection\")\n       return false\n    }\n    defer db.Close()\n\n    err = db.Ping()\n    if err != nil {\n          fmt.Println(\"Error in database call\")\n          return false\n    }\n    var str string\n    err = db.QueryRow(\"Select title, date, url from datesheet_ipu order by  id DESC LIMIT 1\").Scan(&amp;str)\n    if err != nil {\n         fmt.Println(\"error in returning result\")\n         return false\n    }\n    fmt.Println(str)\n    return true\n }\n</code></pre>\n\n<p>The error is shown at db.Query() line and the error is not nil\nis there something wrong i am doing ?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 7988, "user_id": 584947, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5c0e998a5b4fdce4f95cbec31e6dab22?s=128&d=identicon&r=PG", "display_name": "anon58192932", "link": "https://stackoverflow.com/users/584947/anon58192932"}, "edited": false, "score": 0, "creation_date": 1477932298, "post_id": 40326797, "comment_id": 67947824, "body": "Awesome thank you. Can you confirm that func literal is just a function defined in-line? Such as required by an in-line go routine?"}], "tags": [], "owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "is_accepted": false, "score": 3, "last_activity_date": 1477811352, "creation_date": 1477811352, "answer_id": 40326797, "question_id": 40326723, "link": "https://stackoverflow.com/questions/40326723/go-vet-range-variable-captured-by-func-literal-when-using-go-routine-inside-of-f/40326797#40326797", "title": "go vet range variable captured by func literal when using go routine inside of for each loop", "body": "<p>Yes, what you did is the simplest way of fixing this warning properly.</p>\n\n<p>Before the fix, there was only a <em>single</em> variable, and all goroutines were referring to it. This means they did not see the value from when they started but the current value. In most cases this is the last one from the range.</p>\n"}, {"comments": [{"owner": {"reputation": 7988, "user_id": 584947, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5c0e998a5b4fdce4f95cbec31e6dab22?s=128&d=identicon&r=PG", "display_name": "anon58192932", "link": "https://stackoverflow.com/users/584947/anon58192932"}, "edited": false, "score": 3, "creation_date": 1477932260, "post_id": 40326812, "comment_id": 67947803, "body": "Thanks for the updated code that looks great! I had a gnarly bug in my code that took over an hour to fix related to something very similar. I was returning []*LoaderProcess before not realizing that a slice is already a pointer so I was essentially returning a slice of pointers where each pointer pointed to the same LoaderProcess instance which happened to be the last command to finish. Which was different every time after executing. So two big lessons learned from one piece of code. Thank you."}], "tags": [], "owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "is_accepted": true, "score": 62, "last_activity_date": 1515779127, "last_edit_date": 1515779127, "creation_date": 1477811579, "answer_id": 40326812, "question_id": 40326723, "link": "https://stackoverflow.com/questions/40326723/go-vet-range-variable-captured-by-func-literal-when-using-go-routine-inside-of-f/40326812#40326812", "title": "go vet range variable captured by func literal when using go routine inside of for each loop", "body": "<p>Don't feel bad it's a common mistake for new comers in Go, and yes the var <strong>currentProcess</strong> changes for each loop, so your goroutines will use the last process in the slice <em>l.processes</em>, all you have to do is pass the variable as a parameter to the anonymous function, like this:</p>\n\n<pre><code>func (l *Loader) StartAsynchronous() []LoaderProcess {\n\n    for ix := range l.processes {\n\n        go func(currentProcess *LoaderProcess) {\n\n            cmd := exec.Command(currentProcess.Command, currentProcess.Arguments...)\n            log.LogMessage(\"Asynchronously executing LoaderProcess: %+v\", currentProcess)\n\n            output, err := cmd.CombinedOutput()\n            if err != nil {\n                log.LogMessage(\"LoaderProcess exited with error status: %+v\\n %v\", currentProcess, err.Error())\n            } else {\n                log.LogMessage(\"LoaderProcess exited successfully: %+v\", currentProcess)\n                currentProcess.Log.LogMessage(string(output))\n            }\n\n            time.Sleep(time.Second * TIME_BETWEEN_SUCCESSIVE_ITERATIONS)\n\n        }(&amp;l.processes[ix]) // passing the current process using index\n\n    }\n\n    return l.processes\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2301, "user_id": 3448879, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/y7XPi.png?s=128&g=1", "display_name": "Jairo Lozano", "link": "https://stackoverflow.com/users/3448879/jairo-lozano"}, "is_accepted": false, "score": 14, "last_activity_date": 1569718514, "creation_date": 1569718514, "answer_id": 58151372, "question_id": 40326723, "link": "https://stackoverflow.com/questions/40326723/go-vet-range-variable-captured-by-func-literal-when-using-go-routine-inside-of-f/58151372#58151372", "title": "go vet range variable captured by func literal when using go routine inside of for each loop", "body": "<p>For those looking for a simpler example:</p>\n\n<p><strong>This is wrong:</strong></p>\n\n<pre><code>func main() {\n  for i:=0; i&lt;10; i++{\n    go func(){\n        processValue(i)\n    }()\n  }\n}\n\nfunc processValue(i int){\n  fmt.Println(i)\n}\n</code></pre>\n\n<p>Is not exactly an error but could lead to unexpected behavior since the variable <strong>i</strong>, which controls your loop could be changed from other go routine. It's actually <a href=\"https://golang.org/cmd/vet/\" rel=\"noreferrer\">go vet command</a> which alerts about this. Go vet helps precisely to find this kind of suspicious constructs, it <em>uses heuristics that do not guarantee all reports are genuine problems, but it can find errors not caught by the compilers</em>. So it's a good practice to run it from time to time. </p>\n\n<p>Go Playground runs <strong>go vet</strong> before running the code, you can see that in action <a href=\"https://play.golang.org/p/Jr6P6XlRg50\" rel=\"noreferrer\">here</a>.</p>\n\n<p><strong>This is correct:</strong></p>\n\n<pre><code>func main() {\n  for i:=0; i&lt;10; i++{\n    go func(differentI int){\n        processValue(differentI)\n    }(i)\n  }\n}\n\nfunc processValue(i int){\n  fmt.Println(i)\n}\n</code></pre>\n\n<p>I intentionally named the func literal parameter <em>differentI</em> to make it obvious that it is a different variable. Doing it that way is safe for concurrent use, <strong>go vet</strong> won't complain and you'll get no weird behaviors. You can see that in action <a href=\"https://play.golang.org/p/mKmp3kxD7QN\" rel=\"noreferrer\">here</a>. (You will see nothing since the printing is done on different go routines but the program will exit successfully)</p>\n\n<p>And by the way, a <strong>func literal</strong> is basically an anonymous function :)</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 13249131, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_KMAnsoXvjI/AAAAAAAAAAI/AAAAAAAAAAA/AAKWJJPD-JC-MaJvC90gr-02TNaqPN4CIQ/photo.jpg?sz=128", "display_name": "Sarju Mulmi", "link": "https://stackoverflow.com/users/13249131/sarju-mulmi"}, "is_accepted": false, "score": -1, "last_activity_date": 1606512348, "creation_date": 1606512348, "answer_id": 65043995, "question_id": 40326723, "link": "https://stackoverflow.com/questions/40326723/go-vet-range-variable-captured-by-func-literal-when-using-go-routine-inside-of-f/65043995#65043995", "title": "go vet range variable captured by func literal when using go routine inside of for each loop", "body": "<p>If you have experience with Javascript &amp; closures in JS, it is very similar &amp; easy to compare it with the classic example for setTimeout inside of a for loop with the setTimeout using the final value of looping var at the end of the iteration.</p>\n"}], "owner": {"reputation": 7988, "user_id": 584947, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/5c0e998a5b4fdce4f95cbec31e6dab22?s=128&d=identicon&r=PG", "display_name": "anon58192932", "link": "https://stackoverflow.com/users/584947/anon58192932"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16587, "favorite_count": 9, "accepted_answer_id": 40326812, "answer_count": 4, "score": 41, "last_activity_date": 1606512348, "creation_date": 1477810587, "last_edit_date": 1477811245, "question_id": 40326723, "link": "https://stackoverflow.com/questions/40326723/go-vet-range-variable-captured-by-func-literal-when-using-go-routine-inside-of-f", "title": "go vet range variable captured by func literal when using go routine inside of for each loop", "body": "<p>I'm not really sure what a 'func literal' is thus this error is confusing me a bit. I think I see the issue - I'm referencing a range value variable from inside a new go routine thus the value might change at anytime and not be what we expect. What's the best way to solve the issue?</p>\n\n<p>The code in question:</p>\n\n<pre><code>func (l *Loader) StartAsynchronous() []LoaderProcess {\n    for _, currentProcess := range l.processes {\n        cmd := exec.Command(currentProcess.Command, currentProcess.Arguments...)\n        log.LogMessage(\"Asynchronously executing LoaderProcess: %+v\", currentProcess)\n        go func() {\n            output, err := cmd.CombinedOutput()\n            if err != nil {\n                log.LogMessage(\"LoaderProcess exited with error status: %+v\\n %v\", currentProcess, err.Error())\n            } else {\n                log.LogMessage(\"LoaderProcess exited successfully: %+v\", currentProcess)\n                currentProcess.Log.LogMessage(string(output))\n            }\n            time.Sleep(time.Second * TIME_BETWEEN_SUCCESSIVE_ITERATIONS)\n        }()\n    }\n    return l.processes\n}\n</code></pre>\n\n<p>My proposed fix:</p>\n\n<pre><code>func (l *Loader) StartAsynchronous() []LoaderProcess {\n    for _, currentProcess := range l.processes {\n        cmd := exec.Command(currentProcess.Command, currentProcess.Arguments...)\n        log.LogMessage(\"Asynchronously executing LoaderProcess: %+v\", currentProcess)\n        localProcess := currentProcess\n        go func() {\n            output, err := cmd.CombinedOutput()\n            if err != nil {\n                log.LogMessage(\"LoaderProcess exited with error status: %+v\\n %v\", localProcess, err.Error())\n            } else {\n                log.LogMessage(\"LoaderProcess exited successfully: %+v\", localProcess)\n                localProcess.Log.LogMessage(string(output))\n            }\n            time.Sleep(time.Second * TIME_BETWEEN_SUCCESSIVE_ITERATIONS)\n        }()\n    }\n    return l.processes\n} \n</code></pre>\n\n<p>But does that really solve the problem? I've just moved the reference from the range variable to a different local variable whose value is based off of the iteration of the for each loop that I'm in.</p>\n"}, {"tags": ["go", "environment-variables"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1477818122, "post_id": 40326540, "comment_id": 67910056, "body": "An <code>if</code> <i>does</i> work."}, {"owner": {"reputation": 863, "user_id": 5233657, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-6rrWrucVC1Q/AAAAAAAAAAI/AAAAAAAAC3A/F8dD8Wji1m4/photo.jpg?sz=128", "display_name": "Ryan Clair", "link": "https://stackoverflow.com/users/5233657/ryan-clair"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1477849412, "post_id": 40326540, "comment_id": 67918472, "body": "@Volker it does? I tried it with   ``` mpass := os.Getenv(&quot;MONGO_PASS&quot;)     if len(mpass) == 0 {       log.Println(&quot;MONGO_PASS env var not set, using mongo default&quot;)       mpass := &quot;pass&quot;     }``` And I get this: <code>.&#47;server.go:63: mpass declared and not used</code>"}, {"owner": {"reputation": 863, "user_id": 5233657, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-6rrWrucVC1Q/AAAAAAAAAAI/AAAAAAAAC3A/F8dD8Wji1m4/photo.jpg?sz=128", "display_name": "Ryan Clair", "link": "https://stackoverflow.com/users/5233657/ryan-clair"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1477850228, "post_id": 40326540, "comment_id": 67918737, "body": "Where line 63 aligns with mpass variable within the if block (I use mpass later on)."}, {"owner": {"reputation": 863, "user_id": 5233657, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-6rrWrucVC1Q/AAAAAAAAAAI/AAAAAAAAC3A/F8dD8Wji1m4/photo.jpg?sz=128", "display_name": "Ryan Clair", "link": "https://stackoverflow.com/users/5233657/ryan-clair"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1477853641, "post_id": 40326540, "comment_id": 67919821, "body": "Figured it out. Should have been using <code>=</code> instead of <code>:=</code> on the <code>mpass</code> within the <code>if</code> statement. Thanks for calling me out Volker :-)"}], "answers": [{"comments": [{"owner": {"reputation": 10112, "user_id": 396567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/XKKMJ.jpg?s=128&g=1", "display_name": "Michael Hausenblas", "link": "https://stackoverflow.com/users/396567/michael-hausenblas"}, "edited": false, "score": 3, "creation_date": 1477853297, "post_id": 40326580, "comment_id": 67919697, "body": "Note that while above code is correct, you should be aware of the semantics: since it tests for length of the string <code>value</code> and the empty string <code>&quot;&quot;</code> has length 0 it means that when the env variable is set to <code>&quot;&quot;</code> you would get the fallback/default value rather than the value (which is trivially <code>&quot;&quot;</code>). Really depends on your use case but I thought it&#39;s worth pointing out since I once ran into this semantic error and burnt a few cycles debugging it ;)"}, {"owner": {"reputation": 840, "user_id": 1223977, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/34PTn.jpg?s=128&g=1", "display_name": "\u0141ukasz Wojciechowski", "link": "https://stackoverflow.com/users/1223977/%c5%81ukasz-wojciechowski"}, "edited": false, "score": 23, "creation_date": 1487833562, "post_id": 40326580, "comment_id": 71964522, "body": "Instead of <code>Getenv</code> you could use <code>LookupEnv</code>. It also returns <code>ok boolean</code> status that the value was indeed there."}], "tags": [], "owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "is_accepted": true, "score": 126, "last_activity_date": 1504183668, "last_edit_date": 1504183668, "creation_date": 1477809025, "answer_id": 40326580, "question_id": 40326540, "link": "https://stackoverflow.com/questions/40326540/how-to-assign-default-value-if-env-var-is-empty/40326580#40326580", "title": "How to assign default value if env var is empty?", "body": "<p>There's no built-in to fall back to a default value,\nso you have to do a good old-fashioned if-else.</p>\n\n<p>But you can always create a helper function to make that easier:</p>\n\n<pre><code>func getenv(key, fallback string) string {\n    value := os.Getenv(key)\n    if len(value) == 0 {\n        return fallback\n    }\n    return value\n}\n</code></pre>\n\n<p>Note that as <a href=\"https://stackoverflow.com/users/396567/michael-hausenblas\">@michael-hausenblas</a> pointed out in a comment,\nkeep in mind that if the value of the environment variable is really empty, you will get the fallback value instead.</p>\n\n<p>Even better as <a href=\"https://stackoverflow.com/users/1223977/%C5%81ukasz-wojciechowski\">@\u0141ukaszWojciechowski</a> pointed out, using <a href=\"https://golang.org/pkg/os/#LookupEnv\" rel=\"noreferrer\"><code>os.LookupEnv</code></a>:</p>\n\n<pre><code>func getEnv(key, fallback string) string {\n    if value, ok := os.LookupEnv(key); ok {\n        return value\n    }\n    return fallback\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7907, "user_id": 1592008, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4e208220f7cb95e6854adb653663736a?s=128&d=identicon&r=PG", "display_name": "Oleg Neumyvakin", "link": "https://stackoverflow.com/users/1592008/oleg-neumyvakin"}, "is_accepted": false, "score": 0, "last_activity_date": 1477809163, "creation_date": 1477809163, "answer_id": 40326593, "question_id": 40326540, "link": "https://stackoverflow.com/questions/40326540/how-to-assign-default-value-if-env-var-is-empty/40326593#40326593", "title": "How to assign default value if env var is empty?", "body": "<p>In case you are OK with adding little dependency you can use something like <a href=\"https://github.com/urfave/cli\" rel=\"nofollow\">https://github.com/urfave/cli</a></p>\n\n<pre><code>package main\n\nimport (\n  \"os\"\n\n  \"github.com/urfave/cli\"\n)\n\nfunc main() {\n  app := cli.NewApp()\n\n  app.Flags = []cli.Flag {\n    cli.StringFlag{\n      Name: \"lang, l\",\n      Value: \"english\",\n      Usage: \"language for the greeting\",\n      EnvVar: \"APP_LANG\",\n    },\n  }\n\n  app.Run(os.Args)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 863, "user_id": 5233657, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-6rrWrucVC1Q/AAAAAAAAAAI/AAAAAAAAC3A/F8dD8Wji1m4/photo.jpg?sz=128", "display_name": "Ryan Clair", "link": "https://stackoverflow.com/users/5233657/ryan-clair"}, "edited": false, "score": 0, "creation_date": 1477851176, "post_id": 40326639, "comment_id": 67919041, "body": "Thank you for the suggestion Michael. I tried exactly that, which was similar to my initial attempt, and it complains that mongo_password inside of the if block isn&#39;t used (same error as my comment to Volker above. I thought this had sometime to do with the fact that variables within an if block were limited to that block, and couldn&#39;t get outside? Or am I mistaken, and that&#39;s declared variables... and my error is due to how I&#39;m using the variable?"}, {"owner": {"reputation": 10112, "user_id": 396567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/XKKMJ.jpg?s=128&g=1", "display_name": "Michael Hausenblas", "link": "https://stackoverflow.com/users/396567/michael-hausenblas"}, "reply_to_user": {"reputation": 863, "user_id": 5233657, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-6rrWrucVC1Q/AAAAAAAAAAI/AAAAAAAAC3A/F8dD8Wji1m4/photo.jpg?sz=128", "display_name": "Ryan Clair", "link": "https://stackoverflow.com/users/5233657/ryan-clair"}, "edited": false, "score": 1, "creation_date": 1477852959, "post_id": 40326639, "comment_id": 67919599, "body": "Note that the line <code>mongo_password := &quot;pass&quot;</code> is essential, because with this <code>mongo_password</code> is declared and defined (set to <code>pass</code> as the default value). If you don&#39;t have that line then I can imagine an error. In our case above, only <code>mp</code> has the local scope of the <code>if</code>, FWIW."}, {"owner": {"reputation": 863, "user_id": 5233657, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-6rrWrucVC1Q/AAAAAAAAAAI/AAAAAAAAC3A/F8dD8Wji1m4/photo.jpg?sz=128", "display_name": "Ryan Clair", "link": "https://stackoverflow.com/users/5233657/ryan-clair"}, "edited": false, "score": 1, "creation_date": 1477853587, "post_id": 40326639, "comment_id": 67919798, "body": "OHHHHHH. Light f&#39;ing bulb. Thank you. I was mixing up declare (:=) and assignment (=). Works like a champ. You rock Michael."}], "tags": [], "owner": {"reputation": 10112, "user_id": 396567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/XKKMJ.jpg?s=128&g=1", "display_name": "Michael Hausenblas", "link": "https://stackoverflow.com/users/396567/michael-hausenblas"}, "is_accepted": false, "score": 14, "last_activity_date": 1477809668, "creation_date": 1477809668, "answer_id": 40326639, "question_id": 40326540, "link": "https://stackoverflow.com/questions/40326540/how-to-assign-default-value-if-env-var-is-empty/40326639#40326639", "title": "How to assign default value if env var is empty?", "body": "<p>Go doesn't have the exact same functionality as Python here; the most idiomatic way to do it though, I can think of, is:</p>\n\n<pre><code>mongo_password := \"pass\"\nif mp := os.Getenv(\"MONGO_PASS\"); mp != \"\" {\n    mongo_password = mp\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3312, "user_id": 4175960, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/QbvYc.png?s=128&g=1", "display_name": "Eddy Hernandez", "link": "https://stackoverflow.com/users/4175960/eddy-hernandez"}, "is_accepted": false, "score": 8, "last_activity_date": 1547307253, "last_edit_date": 1547307253, "creation_date": 1498154337, "answer_id": 44706424, "question_id": 40326540, "link": "https://stackoverflow.com/questions/40326540/how-to-assign-default-value-if-env-var-is-empty/44706424#44706424", "title": "How to assign default value if env var is empty?", "body": "<p>To have a clean code I do this:</p>\n\n<pre><code>myVar := getEnv(\"MONGO_PASS\", \"default-pass\")\n</code></pre>\n\n<p>I defined a function that is used in the whole app</p>\n\n<pre><code>// getEnv get key environment variable if exist otherwise return defalutValue\nfunc getEnv(key, defaultValue string) string {\n    value := os.Getenv(key)\n    if len(value) == 0 {\n        return defaultValue\n    }\n    return value\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1018, "user_id": 968095, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4edc82535acb750e102ba69cec6aa5a6?s=128&d=identicon&r=PG", "display_name": "puradox", "link": "https://stackoverflow.com/users/968095/puradox"}, "is_accepted": false, "score": 38, "last_activity_date": 1515071712, "last_edit_date": 1515071712, "creation_date": 1504173939, "answer_id": 45978733, "question_id": 40326540, "link": "https://stackoverflow.com/questions/40326540/how-to-assign-default-value-if-env-var-is-empty/45978733#45978733", "title": "How to assign default value if env var is empty?", "body": "<p>What you're looking for is <a href=\"https://golang.org/pkg/os/#LookupEnv\" rel=\"noreferrer\"><code>os.LookupEnv</code></a> combined with an <code>if</code> statement.</p>\n\n<p>Here is janos's answer updated to use LookupEnv:</p>\n\n<pre><code>func getEnv(key, fallback string) string {\n    value, exists := os.LookupEnv(key)\n    if !exists {\n        value = fallback\n    }\n    return value\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 302, "user_id": 1229727, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/49Aee.png?s=128&g=1", "display_name": "Jaime Gago", "link": "https://stackoverflow.com/users/1229727/jaime-gago"}, "is_accepted": false, "score": 2, "last_activity_date": 1527027258, "creation_date": 1527027258, "answer_id": 50477169, "question_id": 40326540, "link": "https://stackoverflow.com/questions/40326540/how-to-assign-default-value-if-env-var-is-empty/50477169#50477169", "title": "How to assign default value if env var is empty?", "body": "<p>Had the same question as the OP and found someone encapsulated the answers from this thread into a nifty library that is fairly simple to use, hope this help others!</p>\n\n<p><a href=\"https://github.com/caarlos0/env\" rel=\"nofollow noreferrer\">https://github.com/caarlos0/env</a></p>\n"}, {"tags": [], "owner": {"reputation": 2316, "user_id": 2213164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wllwh.jpg?s=128&g=1", "display_name": "Stanislav", "link": "https://stackoverflow.com/users/2213164/stanislav"}, "is_accepted": false, "score": 0, "last_activity_date": 1604114794, "creation_date": 1604114794, "answer_id": 64618098, "question_id": 40326540, "link": "https://stackoverflow.com/questions/40326540/how-to-assign-default-value-if-env-var-is-empty/64618098#64618098", "title": "How to assign default value if env var is empty?", "body": "<p>For more complex application you can use tooling such as <code>viper</code>, which allows you to set global custom default values, parse configuration files, set a prefix for your app's env var keys (to ensure consistency and name spacing of env var configurations) and many other cool features.</p>\n<p>Sample code:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n\n    &quot;github.com/spf13/viper&quot;\n)\n\nfunc main() {\n    viper.AutomaticEnv() // read value ENV variable\n    // Set default value\n    viper.SetEnvPrefix(&quot;app&quot;)\n    viper.SetDefault(&quot;linetoken&quot;, &quot;DefaultLineTokenValue&quot;)\n\n    // Declare var\n    linetoken := viper.GetString(&quot;linetoken&quot;)\n\n    fmt.Println(&quot;---------- Example ----------&quot;)\n    fmt.Println(&quot;linetoken :&quot;, linetoken)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1958, "user_id": 5553963, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e043e536e9b6017ab7a9c38c219f7ad?s=128&d=identicon&r=PG&f=1", "display_name": "AVarf", "link": "https://stackoverflow.com/users/5553963/avarf"}, "is_accepted": false, "score": 0, "last_activity_date": 1614410039, "creation_date": 1614410039, "answer_id": 66396467, "question_id": 40326540, "link": "https://stackoverflow.com/questions/40326540/how-to-assign-default-value-if-env-var-is-empty/66396467#66396467", "title": "How to assign default value if env var is empty?", "body": "<p>I also had the same problem and I just created a small package called <a href=\"https://gitlab.com/avarf/getenvs\" rel=\"nofollow noreferrer\">getenvs</a> exactly to answer this problem.</p>\n<p>Getenvs supports <code>string</code>, <code>bool</code>, <code>int</code> and <code>float</code> and it can be used like below:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;fmt&quot;\n\n    &quot;gitlab.com/avarf/getenvs&quot;\n)\n\nfunc main() {\n    value := getenvs.GetEnvString(&quot;STRING_GETENV&quot;, &quot;default-string-value&quot;)\n    bvalue, _ := getenvs.GetEnvBool(&quot;BOOL_GETENV&quot;, false)\n    ivalue, _ := getenvs.GetEnvInt(&quot;INT_GETENV&quot;, 10)\n\n    fmt.Println(value)\n    fmt.Println(bvalue)\n    fmt.Println(ivalue)\n}\n</code></pre>\n"}], "owner": {"reputation": 863, "user_id": 5233657, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-6rrWrucVC1Q/AAAAAAAAAAI/AAAAAAAAC3A/F8dD8Wji1m4/photo.jpg?sz=128", "display_name": "Ryan Clair", "link": "https://stackoverflow.com/users/5233657/ryan-clair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58801, "favorite_count": 20, "accepted_answer_id": 40326580, "answer_count": 8, "score": 75, "last_activity_date": 1614410039, "creation_date": 1477808503, "last_edit_date": 1568948200, "question_id": 40326540, "link": "https://stackoverflow.com/questions/40326540/how-to-assign-default-value-if-env-var-is-empty", "title": "How to assign default value if env var is empty?", "body": "<p>How do you assign a default value if an environment variable isn't set in Go?</p>\n\n<p>In Python I could do <code>mongo_password = os.getenv('MONGO_PASS', 'pass')</code> where <code>pass</code> is the default value if <code>MONGO_PASS</code> env var isn't set.</p>\n\n<p>I tried an if statement based on <code>os.Getenv</code> being empty, but that doesn't seem to work due to the scope of variable assignment within an if statement. And I'm checking for multiple env var's, so I can't act on this information within the if statement.</p>\n"}, {"tags": ["encryption", "go"], "comments": [{"owner": {"reputation": 21605, "user_id": 1142167, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/f9MAS.jpg?s=128&g=1", "display_name": "Joel Cornett", "link": "https://stackoverflow.com/users/1142167/joel-cornett"}, "edited": false, "score": 0, "creation_date": 1477852294, "post_id": 40326209, "comment_id": 67919394, "body": "Hi John Smith, welcome to Stack Overflow. Thanks for contributing. If you have an answer to your own question, or wish to expand on an answer to a question, please do so in the answer section below. This allows other users to more easily navigate between questions and answers instead of having to parse the text to figure out which one they are looking at."}], "answers": [{"tags": [], "owner": {"reputation": 2273, "user_id": 6020403, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f0a9f540105e654ef7d03edc36ad3a?s=128&d=identicon&r=PG", "display_name": "BJ Black", "link": "https://stackoverflow.com/users/6020403/bj-black"}, "is_accepted": true, "score": 3, "last_activity_date": 1477805922, "creation_date": 1477805922, "answer_id": 40326330, "question_id": 40326209, "link": "https://stackoverflow.com/questions/40326209/different-result-when-decrypting-file-in-go-and-openssl/40326330#40326330", "title": "Different result when decrypting file in Go and OpenSSL", "body": "<p>What you're seeing is PKCS padding, which OSSL is removing for you and Go isn't by default.  See the relevant Reddit post <a href=\"https://m.reddit.com/r/golang/comments/4pkj67/is_pkcs7_the_default_padding_for_newcbcdecrypter/\" rel=\"nofollow\">here</a>.</p>\n\n<p>Basically, follow the example and you're good to go.</p>\n"}], "owner": {"reputation": 291, "user_id": 6637202, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/252ead8b84f69ed7e89b11f50cd53d23?s=128&d=identicon&r=PG&f=1", "display_name": "John Smith", "link": "https://stackoverflow.com/users/6637202/john-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 40326330, "answer_count": 1, "score": 5, "last_activity_date": 1477838439, "creation_date": 1477804409, "last_edit_date": 1477838439, "question_id": 40326209, "link": "https://stackoverflow.com/questions/40326209/different-result-when-decrypting-file-in-go-and-openssl", "title": "Different result when decrypting file in Go and OpenSSL", "body": "<p>I have written the following code to decrypt a file:</p>\n\n<pre><code>data, err := ioutil.ReadFile(\"file.encrypted\")\nif err != nil {\n    log.Fatal(err)\n}\n\nblock, err := aes.NewCipher(key)\nif err != nil {\n    log.Fatal(err)\n}\n\nmode := cipher.NewCBCDecrypter(block, iv)\n\nmode.CryptBlocks(data, data)\n\nerr = ioutil.WriteFile(\"file.decrypted\", data, 0644)\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n\n<p>I have also decrypted the file using OpenSSL:</p>\n\n<pre><code>openssl aes-128-cbc -d -in file.encrypted -out file.decrypted -iv $IV -K $KEY\n</code></pre>\n\n<p>Output file from Go program is 8 bytes larger than output file from from OpenSSL.</p>\n\n<p>Tail of hexdump from file generated by OpenSSL:</p>\n\n<pre><code>ff ff ff ff ff ff ff ff  ff ff ff ff ff ff ff ff  |................|\nff ff ff ff ff ff ff ff                           |........|\n</code></pre>\n\n<p>Tail of hexdump from file generated by Go program:</p>\n\n<pre><code>ff ff ff ff ff ff ff ff  ff ff ff ff ff ff ff ff  |................|\nff ff ff ff ff ff ff ff  08 08 08 08 08 08 08 08  |................|\n</code></pre>\n\n<p>Why is <code>08 08 08 08 08 08 08 08</code> appended to file output from Go program?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>As BJ Black explains, the reason for extra bytes in output from my Go program is PKCS padding.</p>\n\n<p>The file is encrypted with AES in CBC mode and therefore the plain text input shall be a multiple of block size, padding is added to fulfill this requirement. AES has a block size of 16 bytes so the total number of padding bytes will always be between 1 and 16 bytes. Each padding byte has a value equal to the total number of padding bytes which in my case is <code>0x08</code>.</p>\n\n<p>So, to find out the amount of padding added to the file, one just have to read the last byte of decrypted file and convert that number to int:</p>\n\n<pre><code>paddingBytes := int(data[len(data)-1])\n</code></pre>\n\n<p>The WriteFile function can then be modified like this:</p>\n\n<pre><code>err = ioutil.WriteFile(\"file.decrypted\", data[:len(data)-paddingBytes], 0644)\n</code></pre>\n\n<p>Now output from my Go program is identical to the output from OpenSSL.</p>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 4, "creation_date": 1477797556, "post_id": 40325710, "comment_id": 67906961, "body": "An item sent on a channel will only be received once."}], "answers": [{"tags": [], "owner": {"reputation": 12623, "user_id": 5985853, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/49VtI.jpg?s=128&g=1", "display_name": "Alexey Soshin", "link": "https://stackoverflow.com/users/5985853/alexey-soshin"}, "is_accepted": false, "score": 1, "last_activity_date": 1477842681, "creation_date": 1477842681, "answer_id": 40330827, "question_id": 40325710, "link": "https://stackoverflow.com/questions/40325710/one-data-in-channel-received-by-two-routine/40330827#40330827", "title": "One data in Channel received by two routine", "body": "<p>As @Andy Schweig mentioned, you can pull from Go channel only once. If you still want to receive message twice, you can use Observer design pattern:</p>\n\n<pre><code>import \"fmt\"\n\ntype Observer interface {\n    Notify(message string)\n}\n\ntype Watcher struct {\n    name string\n}\n\nfunc (w Watcher) Notify(message string) {\n    fmt.Printf(\"Watcher %s got message %s\\n\", w.name, message)\n}\n\nvar watchers =  [...]Watcher {{name: \"Watcher 1\"}, {name: \"Watcher 2\"}}\nvar c = make(chan string)\n\nfunc notifier() {\n\n    var message string\n    for {\n        // Messaged pulled only once\n        message = &lt;- c\n\n        // But all watchers still receive it\n        for _, w := range watchers {\n            w.Notify(message)\n        }\n    }\n}\n\nfunc main() {\n    go notifier()\n\n    c &lt;- \"hello\"\n    c &lt;- \"how are you?\"\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4425, "user_id": 2346961, "user_type": "registered", "accept_rate": 98, "profile_image": "https://i.stack.imgur.com/lZJot.jpg?s=128&g=1", "display_name": "Sreejith Nair", "link": "https://stackoverflow.com/users/2346961/sreejith-nair"}, "is_accepted": false, "score": 1, "last_activity_date": 1479332047, "last_edit_date": 1479332047, "creation_date": 1479330981, "answer_id": 40642474, "question_id": 40325710, "link": "https://stackoverflow.com/questions/40325710/one-data-in-channel-received-by-two-routine/40642474#40642474", "title": "One data in Channel received by two routine", "body": "<p>The <code>channel</code> you declared can only deal with one receiver. By default <code>channels</code> are <code>unbuffered</code>, meaning that they will only accept sends if there is a corresponding receiver to receive the sent value. Whereas a <code>buffered</code> channel accept a limited number of values without a corresponding receiver for those values.  If you are looking to inject multiple input and its subsequent receive then you need declare your <code>channel</code> as <code>buffered channel</code>.</p>\n\n<pre><code>ch := make(chan bool, n) //n being the number of items to buffer\n</code></pre>\n"}], "owner": {"reputation": 1480, "user_id": 1956906, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/QqZy0.jpg?s=128&g=1", "display_name": "fanjavaid", "link": "https://stackoverflow.com/users/1956906/fanjavaid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1479332047, "creation_date": 1477797066, "question_id": 40325710, "link": "https://stackoverflow.com/questions/40325710/one-data-in-channel-received-by-two-routine", "title": "One data in Channel received by two routine", "body": "<p>Hello i learn about go routine and channel.\nI do some experiment with channel, i send a data over channel and try to catch it in 2 functions. But my second function not run</p>\n\n<p>Here is my code :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"time\"\n)\n\nfunc timeout(duration int, ch chan&lt;- bool) {\n    time.AfterFunc(time.Duration(duration)*time.Second, func() {\n        ch &lt;- true\n    })\n}\n\nfunc watcher(duration int, ch &lt;-chan bool) {\n    &lt;-ch\n    fmt.Println(\"\\nTimeout! no Answer after\", duration, \"seconds\")\n    os.Exit(0)\n}\n\nfunc watcher2(duration int, ch &lt;-chan bool) {\n    &lt;-ch\n    fmt.Println(\"This is watcher 2 as a second receiver\")\n}\n\nfunc main() {\n    var data = make(chan bool)\n    var duration = 5\n\n    go timeout(duration, data)\n    go watcher(duration, data)\n    go watcher2(duration, data)\n\n    var input string\n    fmt.Print(\"What is 725/25 ? \")\n    fmt.Scan(&amp;input)\n\n    if input == \"29\" {\n        fmt.Println(\"Correct\")\n    } else {\n        fmt.Println(\"Wrong!\")\n    }\n}\n</code></pre>\n\n<p>Can you tell me some explanation about it?\nThank you</p>\n"}, {"tags": ["string", "go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 2, "creation_date": 1477787617, "post_id": 40324940, "comment_id": 67905460, "body": "<a href=\"https://godoc.org/bufio#Reader.ReadString\" rel=\"nofollow noreferrer\">&quot;ReadString reads until the first occurrence of delim in the input, returning a string containing the data up to and including the delimiter&quot;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "reply_to_user": {"reputation": 133, "user_id": 3900311, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6C7Vx.png?s=128&g=1", "display_name": "Juanpa", "link": "https://stackoverflow.com/users/3900311/juanpa"}, "edited": false, "score": 1, "creation_date": 1477807786, "post_id": 40325072, "comment_id": 67908230, "body": "@Juanpa works for me, as it should. You must be overlooking something."}, {"owner": {"reputation": 133, "user_id": 3900311, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6C7Vx.png?s=128&g=1", "display_name": "Juanpa", "link": "https://stackoverflow.com/users/3900311/juanpa"}, "edited": false, "score": 0, "creation_date": 1477857107, "post_id": 40325072, "comment_id": 67920791, "body": "I expected that any string could be treated as the same, being indifferent the way it was caught."}, {"owner": {"reputation": 133, "user_id": 3900311, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6C7Vx.png?s=128&g=1", "display_name": "Juanpa", "link": "https://stackoverflow.com/users/3900311/juanpa"}, "edited": false, "score": 0, "creation_date": 1477875418, "post_id": 40325072, "comment_id": 67925778, "body": "I had to remove a &quot;\\r\\n&quot; from the string caught with reader, so it wasn&#39;t as simple as just a &quot;\\n&quot;."}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 133, "user_id": 3900311, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6C7Vx.png?s=128&g=1", "display_name": "Juanpa", "link": "https://stackoverflow.com/users/3900311/juanpa"}, "edited": false, "score": 0, "creation_date": 1477884833, "post_id": 40325072, "comment_id": 67927598, "body": "@Juanpa Are you working on Windows or OSX ? I can confirm that the only <code>\\n</code> appears when you input the lines in Ubuntu."}, {"owner": {"reputation": 133, "user_id": 3900311, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6C7Vx.png?s=128&g=1", "display_name": "Juanpa", "link": "https://stackoverflow.com/users/3900311/juanpa"}, "edited": false, "score": 0, "creation_date": 1478120902, "post_id": 40325072, "comment_id": 68031328, "body": "I&#39;m Windows user @JohnSPerayil, when I printed the bytes of each char I&#39;ve found that there was a byte 13 and a byte 10 after the last char of my string,then looked for <a href=\"http://www.asciitable.com/\" rel=\"nofollow noreferrer\">asciitable.com</a> to see that 13 is a carriage return, also known as &#39;\\r&#39; and then found a new line or &#39;\\n&#39;"}], "tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 2, "last_activity_date": 1478151231, "last_edit_date": 1478151231, "creation_date": 1477788457, "answer_id": 40325072, "question_id": 40324940, "link": "https://stackoverflow.com/questions/40324940/cant-check-strings-hassuffix-on-string-captured-with-reader-readstring/40325072#40325072", "title": "Can&#39;t check strings.HasSuffix on string captured with reader.ReadString", "body": "<p>As @Tim mentioned the output of <code>reader.ReadString('\\n')</code> includes '\\n' as the last character and <code>fmt.Scanln</code> does not do that. You can either do <code>const TOKEN string = \":=\\n\"</code> or remove the '\\n' from the end of the string.</p>\n\n<p>Update :</p>\n\n<p>There are cases where <code>\\r\\n</code> occurs as a suffix instead of the usually expected<code>\\n</code> (Windows Machines ?)</p>\n\n<p><code>fmt.Scanln</code> handles that case as well, as per <code>fmt</code> godoc.</p>\n\n<p><code>In all the scanning functions, a carriage return followed immediately by a newline is treated as a plain newline (\\r\\n means the same as \\n).</code></p>\n"}], "owner": {"reputation": 133, "user_id": 3900311, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6C7Vx.png?s=128&g=1", "display_name": "Juanpa", "link": "https://stackoverflow.com/users/3900311/juanpa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 0, "accepted_answer_id": 40325072, "answer_count": 1, "score": 1, "last_activity_date": 1478151231, "creation_date": 1477786645, "question_id": 40324940, "link": "https://stackoverflow.com/questions/40324940/cant-check-strings-hassuffix-on-string-captured-with-reader-readstring", "title": "Can&#39;t check strings.HasSuffix on string captured with reader.ReadString", "body": "<p>Overview: I was capturing strings with fmt.Scanln, but one of my needs is that the string must have spaces so I started to use reader.ReadString, I have to check the presence of a suffix in that string to make some replacing, so I used strings.HasSuffix. With strings captured with fmt.Scanln there was no problema but now that I use reader.ReadString it is unabled to find the given suffix in the string.</p>\n\n<p>Is there a clue on what's going on?</p>\n\n<p>Here is a test that isolate the problem, use it in desktop installed Go, not online.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"strings\"\n    \"os\"\n    \"reflect\"\n)\nconst TOKEN string = \":=\"\n\nfunc validate(expr string) {\n    fmt.Println(\"var type: \", reflect.TypeOf(expr))\n    if strings.Contains(expr, TOKEN) {\n        fmt.Println(expr, \"contains works\")\n    } else {\n        fmt.Println(\"error with contains\")\n    }\n\n    if strings.HasSuffix(expr, TOKEN) {\n        fmt.Println(expr, \"suffix works\")\n    } else {\n        fmt.Println(\"error with suffix\")\n    }\n}\n\nfunc main() {\n    var expr2 string\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"type something finished with ':='\")\n    expr1, _ := reader.ReadString('\\n')\n    fmt.Scanln(&amp;expr2)\n\n    fmt.Println(\"validation with reader: \")\n    validate(expr1)\n    fmt.Println()\n    fmt.Println(\"validation with Scanln: \")\n    validate(expr2)\n}\n</code></pre>\n"}, {"tags": ["templates", "go", "range", "slice"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1477783049, "post_id": 40324594, "comment_id": 67904666, "body": "<i>What if I want output two or more slices, what I need to do or change?</i>  You need to pass a data structure to <code>ExecuteTemplate</code> that can contain multiple pieces of data, such as a struct."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1477786362, "post_id": 40324594, "comment_id": 67905266, "body": "Related / possible duplicate of: <a href=\"http://stackoverflow.com/questions/35224066/how-to-pass-multiple-data-to-go-template\">How to pass multiple data to Go template?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 83, "user_id": 7087372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J2Qqk.jpg?s=128&g=1", "display_name": "Roberto", "link": "https://stackoverflow.com/users/7087372/roberto"}, "edited": false, "score": 0, "creation_date": 1477850999, "post_id": 40326640, "comment_id": 67919001, "body": "Thank you, and that means that all the data that I need to pass to the templates need must be in the map, right?"}, {"owner": {"reputation": 3254, "user_id": 2927601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d06918d96014e4de287f37dc5ecba1b1?s=128&d=identicon&r=PG", "display_name": "Laily", "link": "https://stackoverflow.com/users/2927601/laily"}, "reply_to_user": {"reputation": 83, "user_id": 7087372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J2Qqk.jpg?s=128&g=1", "display_name": "Roberto", "link": "https://stackoverflow.com/users/7087372/roberto"}, "edited": false, "score": 0, "creation_date": 1477869098, "post_id": 40326640, "comment_id": 67924529, "body": "Yes, map or a struct"}], "tags": [], "owner": {"reputation": 3254, "user_id": 2927601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d06918d96014e4de287f37dc5ecba1b1?s=128&d=identicon&r=PG", "display_name": "Laily", "link": "https://stackoverflow.com/users/2927601/laily"}, "is_accepted": true, "score": 0, "last_activity_date": 1477809676, "creation_date": 1477809676, "answer_id": 40326640, "question_id": 40324594, "link": "https://stackoverflow.com/questions/40324594/go-templates-two-or-more-slices-ranges/40326640#40326640", "title": "Go Templates: two or more slices ranges", "body": "<p>first question, why <code>rang .resItems</code> doesn't work.<br>\nIn template, <code>.</code> means current item. like <code>this</code> in java. \nif <code>.</code> in some direction like <code>range</code>, it means the item from <code>range</code> operation.<br>\nif not, it means the item you passed form <code>ExecuteTemplate()</code> method. like in <code>ExecuteTemplate(w, \"HomeTemplate\", resItems)</code>, <code>.</code> means <code>resItems</code>. so you can not use <code>.resItems</code> because it means <code>resItems</code> have a value called <code>resItems</code>. </p>\n\n<p>second, if you have more slices to pass to template, you can add all of them to a map, like this:</p>\n\n<pre><code>t := template.New(\"test\")\nt, _ = t.Parse(`\ntest range \n{{range .first}} {{.}} {{end}}\n{{range .second}} {{.}} {{end}}\n`)\nvar res = make(map[string]interface{})\naa := []string{\"first\", \"second\"}\nbb := []string{\"123\", \"456\"}\nres[\"first\"] = aa\nres[\"second\"] = bb\nt.Execute(os.Stdout, res)\n\n// output\ntest range\n first  second\n 123  456\n</code></pre>\n\n<p>I have two array aa and bb, and add them to a map then pass it to the template. In template, <code>.</code> means the map, and <code>.first</code> got the array aa. and so as bb.</p>\n\n<p>Hope this can help you...</p>\n"}], "owner": {"reputation": 83, "user_id": 7087372, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/J2Qqk.jpg?s=128&g=1", "display_name": "Roberto", "link": "https://stackoverflow.com/users/7087372/roberto"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 535, "favorite_count": 0, "accepted_answer_id": 40326640, "answer_count": 1, "score": 0, "last_activity_date": 1477809676, "creation_date": 1477782948, "question_id": 40324594, "link": "https://stackoverflow.com/questions/40324594/go-templates-two-or-more-slices-ranges", "title": "Go Templates: two or more slices ranges", "body": "<p>The next code works perfect for output one slice inside the HomeTemplate.</p>\n\n<p>main.go</p>\n\n<pre><code>type Item struct {\n    Id          int\n    Name string\n    Type      string\n}\n\nvar tmpl = template.Must(template.ParseGlob(\"tmpl/*\"))\n\nfunc Index(w http.ResponseWriter, r *http.Request) {\n\n    db := database.DbConn()\n\n    selDB, err := product.ByID()\n    if err != nil {\n        panic(err.Error())\n    }\n\n    i := Item{}\n\n    resItems := []Item{}\n\n    for selDB.Next() {\n\n        var id int\n        var product_name, product_type string\n\n        err = selDB.Scan(&amp;id, &amp;product_name, &amp;product_type)\n        if err != nil {\n            panic(err.Error())\n        }\n\n        i.Id = id\n        i.Name = product_name\n        i.Type = product_type\n\n        resItems = append(resItems, i)\n\n    }\n\n    tmpl.ExecuteTemplate(w, \"HomeTemplate\", resItems)\n\n    // Close database connection\n    defer db.Close()\n}\n</code></pre>\n\n<p>In the template forks fine the next code:</p>\n\n<pre><code>{{ range . }}\n    {{ .Name }}&lt;br /&gt;\n{{ end }}\n</code></pre>\n\n<p>Why something like this does not work?</p>\n\n<pre><code>{{ range .resItems }}\n    {{ .Name }}&lt;br /&gt;\n{{ end }}\n</code></pre>\n\n<p>What if I want output two or more slices, what I need to do or change?</p>\n\n<p>Thank you</p>\n"}, {"tags": ["json", "go", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 279, "user_id": 1310618, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6c3b061959da80f4656935e95dd99c12?s=128&d=identicon&r=PG", "display_name": "TestingInProd", "link": "https://stackoverflow.com/users/1310618/testinginprod"}, "edited": false, "score": 0, "creation_date": 1477783563, "post_id": 40324161, "comment_id": 67904767, "body": "thanks..you are right"}, {"owner": {"reputation": 279, "user_id": 1310618, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6c3b061959da80f4656935e95dd99c12?s=128&d=identicon&r=PG", "display_name": "TestingInProd", "link": "https://stackoverflow.com/users/1310618/testinginprod"}, "edited": false, "score": 0, "creation_date": 1477784752, "post_id": 40324161, "comment_id": 67905010, "body": "Just a follow up question.  I got the output as below  when I added Type and Paylod  {Id:4787366250 Type:IssueCommentEvent Payload:{Size:0}} {Id:4787366249 Type:PushEvent Payload:{Size:1}}   Is there way to filter Type in the Struct itself ? What I meant was, can I do the below  type events struct { \tId string <code>json:&quot;id&quot;</code> \tType string <code>json:&quot;type&quot;:&quot;PushEvent&quot;</code> \tPayload eventPayload <code>json:&quot;payload&quot;</code> } Checking whether type is PushEvent"}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 3, "last_activity_date": 1477779566, "last_edit_date": 1477779566, "creation_date": 1477778846, "answer_id": 40324161, "question_id": 40324142, "link": "https://stackoverflow.com/questions/40324142/json-parsing-in-go/40324161#40324161", "title": "Json parsing in go", "body": "<p>Make <code>id</code> field uppercase</p>\n\n<pre><code>type events struct {\n    Id string `json:\"id\"`\n}\n</code></pre>\n\n<p>Go json library uses reflection to access fields of structures. Reflection allows only exported fields to be modified. Therefore you need to make that field exported by making the first letter uppercase.</p>\n\n<p>See <a href=\"https://blog.golang.org/laws-of-reflection#TOC_10.\" rel=\"nofollow\">Laws of Reflection</a></p>\n"}], "owner": {"reputation": 279, "user_id": 1310618, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6c3b061959da80f4656935e95dd99c12?s=128&d=identicon&r=PG", "display_name": "TestingInProd", "link": "https://stackoverflow.com/users/1310618/testinginprod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "closed_date": 1477818249, "accepted_answer_id": 40324161, "answer_count": 1, "score": -1, "last_activity_date": 1477779649, "creation_date": 1477778706, "question_id": 40324142, "link": "https://stackoverflow.com/questions/40324142/json-parsing-in-go", "closed_reason": "Duplicate", "title": "Json parsing in go", "body": "<p>I am trying to parse json in <a href=\"https://api.github.com/events\" rel=\"nofollow\">this</a> url. My code is as below, but the output is not as expected. I want to extract id, url inside payload only for pushevent. How do i do that . Thanks</p>\n\n<pre><code>type events struct {\n    id string `json:\"id\"`\n}\n\nfunc pullUrlFromGit(urlHolder chan string){\n\n    client := &amp;http.Client{}\n    resp, _ := client.Get(\"https://api.github.com/events\")\n    defer resp.Body.Close()\n    body,_ := ioutil.ReadAll(resp.Body)\n\n    var gtevents []events\n    json.Unmarshal(body,&amp;gtevents)\n\n    log.Printf(\"%+v\",gtevents)\n}\n</code></pre>\n\n<p>The output i am getting is as below.</p>\n\n<pre><code>[{id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:} {id:}]\n</code></pre>\n"}, {"tags": ["mysql", "go", "switch-statement", "variable-declaration"], "answers": [{"comments": [{"owner": {"reputation": 603, "user_id": 3782306, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d2502e2aa71d69d257c0990afd018ff5?s=128&d=identicon&r=PG&f=1", "display_name": "Ezio", "link": "https://stackoverflow.com/users/3782306/ezio"}, "edited": false, "score": 0, "creation_date": 1477750372, "post_id": 40319921, "comment_id": 67895729, "body": "thanks mate just started with golang few days ago so still a newbie :P"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1477750920, "last_edit_date": 1592644375, "creation_date": 1477750064, "answer_id": 40319921, "question_id": 40319810, "link": "https://stackoverflow.com/questions/40319810/database-connection-golang-mysql/40319921#40319921", "title": "Database Connection golang mysql", "body": "<p>Variables declared in the <code>case</code> branches of a <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"nofollow noreferrer\"><code>switch</code></a> statement are <em>scoped</em> to the case branch, they are not accessible (not in scope) outside of the <code>case</code>.</p>\n<p>Solution is simple, declare <code>stmt</code> and the <code>err</code> variables before the <code>switch</code>, and use <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"nofollow noreferrer\">assignment</a> (<code>=</code>) instead of the <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">short variable declarations</a> (<code>:=</code>):</p>\n<pre><code>var stmt *sql.Stmt\nvar err error\n\nswitch folder {\ncase &quot;Results&quot;:\n    stmt, err = db.Prepare(&quot;INSERT results_ipu SET title=?, date=?, url=?, remoteUrl=?&quot;)\ncase &quot;Notices&quot;:\n    stmt, err = db.Prepare(&quot;INSERT notice_ipu SET title=?, date=?, url=?, remoteUrl=?&quot;)\ncase &quot;Datesheets&quot;:\n    stmt, err = db.Prepare(&quot;INSERT datesheet_ipu SET title=?, date=?, url=?, remoteUrl=?&quot;)\n}\n\nif err != nil {\n    // handle error\n}\n\nres, err1 := stmt.Exec(elem.title, elem.date, elem.url, elem.remoteUrl)\n</code></pre>\n<p>Source from the spec:</p>\n<p><a href=\"https://golang.org/ref/spec#Declarations_and_scope\" rel=\"nofollow noreferrer\">Declarations and Scope:</a></p>\n<blockquote>\n<p>Go is lexically scoped using <a href=\"https://golang.org/ref/spec#Blocks\" rel=\"nofollow noreferrer\">blocks</a>:<br />\n...</p>\n<ol start=\"5\">\n<li>The scope of a constant or variable identifier declared inside a function begins at the end of the ConstSpec or VarSpec (ShortVarDecl for short variable declarations) and ends at the end of the innermost containing block.</li>\n</ol>\n<p>...</p>\n</blockquote>\n<p>And <a href=\"https://golang.org/ref/spec#Blocks\" rel=\"nofollow noreferrer\">Spec: Blocks:</a></p>\n<blockquote>\n<p>A block is a possibly empty sequence of declarations and statements within matching brace brackets.</p>\n<p>[...] In addition to explicit blocks in the source code, there are implicit blocks:</p>\n<ol start=\"5\">\n<li>Each clause in a <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"nofollow noreferrer\">&quot;switch&quot;</a> or <a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"nofollow noreferrer\">&quot;select&quot;</a> statement acts as an implicit block.</li>\n</ol>\n</blockquote>\n"}], "owner": {"reputation": 603, "user_id": 3782306, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d2502e2aa71d69d257c0990afd018ff5?s=128&d=identicon&r=PG&f=1", "display_name": "Ezio", "link": "https://stackoverflow.com/users/3782306/ezio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1099, "favorite_count": 0, "accepted_answer_id": 40319921, "answer_count": 1, "score": 3, "last_activity_date": 1477751473, "creation_date": 1477749412, "last_edit_date": 1477751473, "question_id": 40319810, "link": "https://stackoverflow.com/questions/40319810/database-connection-golang-mysql", "title": "Database Connection golang mysql", "body": "<p>I am trying to write a test program for my Go code. This code has a global <code>db</code> variable which I initialize in the <code>main</code> package.</p>\n\n<pre><code>package database\n\nimport(\n    \"database/sql\"\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\n//Data type that defines one identity\ntype element struct {\n     title string\n     date string\n     url string\n     remoteUrl string\n}\n\n\n//global database object for every package\nvar (\n   db *sql.DB\n)\n\n// params  elem : element to be inserted ,     folder     : folderName \nfunc insertNoticeData( elem element, folder string) bool  {\n\n     switch folder {\n         case \"Results\" : stmt, err := db.Prepare(\"INSERT results_ipu SET title=?, date=?, url=?, remoteUrl=?\")\n         case \"Notices\" : stmt, err := db.Prepare(\"INSERT notice_ipu SET title=?, date=?, url=?, remoteUrl=?\")\n         case \"Datesheets\" : stmt, err := db.Prepare(\"INSERT datesheet_ipu SET title=?, date=?, url=?, remoteUrl=?\")\n     }\n\n     res, err1 := stmt.Exec(elem.title, elem.date, elem.url, elem.remoteUrl)\n     if err1 != nil {\n     fmt.Println(\"Error inserting in database \")\n     return false\n     }\n     return true\n}\n</code></pre>\n\n<p>It's giving me an error: <code>undefined symbol stmt</code></p>\n\n<p>What am I missing here?</p>\n"}, {"tags": ["go", "indexing", "slice"], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1571, "user_id": 1587118, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/cBN8s.jpg?s=128&g=1", "display_name": "SRC", "link": "https://stackoverflow.com/users/1587118/src"}, "edited": false, "score": 0, "creation_date": 1477744056, "post_id": 40319047, "comment_id": 67894152, "body": "@SRC Yes, I see it, what is your question regarding to it? <code>s1</code> is a slice with one element only, <code>s[2]</code> is an index expression, denoting the 2nd (0 indexed) element which is <code>3</code>."}, {"owner": {"reputation": 6320, "user_id": 1870253, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/322c901287818397bee1fea580bc3bd1?s=128&d=identicon&r=PG", "display_name": "sge", "link": "https://stackoverflow.com/users/1870253/sge"}, "edited": false, "score": 0, "creation_date": 1477744275, "post_id": 40319047, "comment_id": 67894201, "body": "Maybe my example was poorly chosen. I am well aware of the difference between a single value access and creating a new slice. I actually meant to know how the idea behind the indices works as it seems the first value is an index while the second one is the position of the element starting with 1. I updated the question."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 6320, "user_id": 1870253, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/322c901287818397bee1fea580bc3bd1?s=128&d=identicon&r=PG", "display_name": "sge", "link": "https://stackoverflow.com/users/1870253/sge"}, "edited": false, "score": 0, "creation_date": 1477744701, "post_id": 40319047, "comment_id": 67894317, "body": "@sge See edited question. Also read the related question which details the logic behind it."}, {"owner": {"reputation": 6320, "user_id": 1870253, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/322c901287818397bee1fea580bc3bd1?s=128&d=identicon&r=PG", "display_name": "sge", "link": "https://stackoverflow.com/users/1870253/sge"}, "edited": false, "score": 0, "creation_date": 1477744725, "post_id": 40319047, "comment_id": 67894321, "body": "Allright. I guess I am confused since I work with matlab a lot and there s2[1:3] actually contains 3 values. Thanks for clarifying."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1477751591, "last_edit_date": 1592644375, "creation_date": 1477743727, "answer_id": 40319047, "question_id": 40318987, "link": "https://stackoverflow.com/questions/40318987/what-is-the-idea-behind-the-notation-of-indices-of-go-slices/40319047#40319047", "title": "What is the idea behind the notation of indices of Go slices?", "body": "<p>Relevant section from the spec: <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">Slice expressions</a>.</p>\n<blockquote>\n<p>For a string, array, pointer to array, or slice <code>a</code>, the primary expression</p>\n<pre><code>a[low : high]\n</code></pre>\n<p>constructs a substring or slice. The <em>indices</em> <code>low</code> and <code>high</code> select which elements of operand <code>a</code> appear in the result. <strong>The result has indices starting at <code>0</code> and length equal to <code>high - low</code></strong>.</p>\n</blockquote>\n<p>So <code>s2 := s[1:3]</code> creates a new slice with length <code>3 - 1 = 2</code>, so it will contain 2 elements: <code>s[1]</code> and <code>s[2]</code>.</p>\n<p>When slicing a slice, <code>low</code> should be the index of the first element you want to include (<strong>inclusive</strong>), and <code>high</code> should be the index of the last element that will <strong>not</strong> be incuded (<code>high</code> is <strong>exclusive</strong>).</p>\n<p>So if you want the result to include the elements <code>[2, 3]</code>, you need to provide slicing indices <code>1</code> and <code>3</code>:</p>\n<pre><code>s2 := s[1:3] // will be [2, 3]\n</code></pre>\n<p>What might be confusing is that the elements in your slice start with <code>1</code>, but the index starts with <code>0</code>.</p>\n<p>For reasoning behind the inclusive-exclusive indices, see related question: <a href=\"https://stackoverflow.com/questions/26857582/in-a-go-slice-why-does-slohi-end-at-element-hi-1\">In a Go slice, why does s[lo:hi] end at element hi-1?</a></p>\n"}], "owner": {"reputation": 6320, "user_id": 1870253, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/322c901287818397bee1fea580bc3bd1?s=128&d=identicon&r=PG", "display_name": "sge", "link": "https://stackoverflow.com/users/1870253/sge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 723, "favorite_count": 0, "accepted_answer_id": 40319047, "answer_count": 1, "score": 0, "last_activity_date": 1477751591, "creation_date": 1477743332, "last_edit_date": 1477744993, "question_id": 40318987, "link": "https://stackoverflow.com/questions/40318987/what-is-the-idea-behind-the-notation-of-indices-of-go-slices", "title": "What is the idea behind the notation of indices of Go slices?", "body": "<p>I can't seem to wrap my head around the notation of indices when working with Go slices.</p>\n\n<p>Given a slice <code>s</code>.</p>\n\n<pre><code> s := []int{1, 2, 3, 4, 5}\n</code></pre>\n\n<p>I now want to create a new slice <code>s2 = [2 3]</code>.</p>\n\n<pre><code> s2 := s[1:3] // s2 = [2 3]\n</code></pre>\n\n<p>Now, what is the thought process that I should go through when accessing this value? Am I reading values starting from index <code>1</code> up to and including the third element of the slice? Or am I reading values from index <code>1</code> up to and excluding index <code>3</code>?</p>\n\n<p>I am not starting at index <code>1</code> and going up to index <code>3</code> and neither am I starting at position <code>1</code> and going up to position <code>3</code> as both of these would result in <code>s2</code> having 3 elements.</p>\n\n<p>What is the idea behind this notation?</p>\n"}, {"tags": ["go", "garbage-collection", "jvm"], "comments": [{"owner": {"reputation": 496316, "user_id": 57695, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/53ee9941b3fefef67175daf212e62d41?s=128&d=identicon&r=PG", "display_name": "Peter Lawrey", "link": "https://stackoverflow.com/users/57695/peter-lawrey"}, "edited": false, "score": 1, "creation_date": 1477764180, "post_id": 40318257, "comment_id": 67899770, "body": "I think you will find that as Go is younger it is struggling to catch up with the JVM. Most likely it will, but it&#39;s a long way from getting them."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1477818382, "post_id": 40318257, "comment_id": 67910116, "body": "You seem to assume that there is just one JVM. You assumption is wrong."}], "answers": [{"tags": [], "owner": {"reputation": 34798, "user_id": 1362755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97aa8c37ffa60c4262955aefae56e605?s=128&d=identicon&r=PG", "display_name": "the8472", "link": "https://stackoverflow.com/users/1362755/the8472"}, "is_accepted": true, "score": 28, "last_activity_date": 1616536752, "last_edit_date": 1616536752, "creation_date": 1477739838, "answer_id": 40318538, "question_id": 40318257, "link": "https://stackoverflow.com/questions/40318257/why-go-can-lower-gc-pauses-to-sub-1ms-and-jvm-has-not/40318538#40318538", "title": "Why Go can lower GC pauses to sub 1ms and JVM has not?", "body": "<p><strong>2021 Update</strong>: With OpenJDK 16 ZGC now has a <a href=\"https://malloc.se/blog/zgc-jdk16\" rel=\"nofollow noreferrer\">max pause time of &lt;1ms and average pause times 50\u00b5s</a></p>\n<p>It achieves these goals while still performing compaction, unlike Go's collector.</p>\n<hr />\n<blockquote>\n<p>What are the (architectural?) constraints which prevent JVM from lowering GC pauses to golang levels</p>\n</blockquote>\n<p>There aren't.</p>\n<blockquote>\n<p>High GC pauses are one if the things JVM users struggle with for a long time.</p>\n</blockquote>\n<p>A little googling shows that similar solutions are available for java too</p>\n<ul>\n<li>Azul offers a <a href=\"https://www.azul.com/resources/azul-technology/azul-c4-garbage-collector/\" rel=\"nofollow noreferrer\">pauseless collector</a> that scales even to 100GB+</li>\n<li>Redhat is contributing <a href=\"http://openjdk.java.net/jeps/189\" rel=\"nofollow noreferrer\">shenandoah</a> to openjdk and oracle <a href=\"https://wiki.openjdk.java.net/display/zgc/Main\" rel=\"nofollow noreferrer\">zgc</a>.</li>\n<li>IBM offers <a href=\"http://researcher.watson.ibm.com/researcher/view_group_subpage.php?id=175\" rel=\"nofollow noreferrer\">metronome</a>, also aiming for microsecond pause times</li>\n<li>various other realtime JVMs</li>\n</ul>\n<p>The other collectors in openjdk are, unlike Go's, compacting generational collectors. That is to avoid fragmentation problems and to provide higher throughput on server-class machines with large heaps by enabling bump pointer allocation and reducing the CPU time spent in GC. And at least under good conditions CMS can achieve single-digit millisecond pauses, despite being paired with a moving young-generation collector.</p>\n<p>Go's collector is non-generational, non-compacting and requires write barriers (see this <a href=\"https://stackoverflow.com/questions/7823725/what-kind-of-garbage-collection-does-go-use\">other SO question</a>), which results in lower throughput/more CPU overhead for collections, higher memory footprint (fragmentation) and less cache-efficient placement of objects on the heap (non-compact memory layout).</p>\n"}, {"tags": [], "owner": {"reputation": 26934, "user_id": 8316315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44d833a8a46fea39d7bfca1540ea9c07?s=128&d=identicon&r=PG&f=1", "display_name": "Florian Weimer", "link": "https://stackoverflow.com/users/8316315/florian-weimer"}, "is_accepted": false, "score": 0, "last_activity_date": 1532261753, "creation_date": 1532261753, "answer_id": 51465033, "question_id": 40318257, "link": "https://stackoverflow.com/questions/40318257/why-go-can-lower-gc-pauses-to-sub-1ms-and-jvm-has-not/51465033#51465033", "title": "Why Go can lower GC pauses to sub 1ms and JVM has not?", "body": "<p>According to this presentation, <a href=\"https://blog.golang.org/ismmkeynote\" rel=\"nofollow noreferrer\">Getting to Go: The Journey of Go's Garbage Collector</a>, the Go collectors only utilize half of the heap for live data:</p>\n\n<blockquote>\n  <p>Heap 2X live heap</p>\n</blockquote>\n\n<p>My impression is that Java GCs generally aim for higher heap utilization, so they make a very different trade-off here.</p>\n"}, {"tags": [], "owner": {"reputation": 3504, "user_id": 3502543, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/Z13lg.jpg?s=128&g=1", "display_name": "Maksym", "link": "https://stackoverflow.com/users/3502543/maksym"}, "is_accepted": false, "score": -2, "last_activity_date": 1570830322, "creation_date": 1570830322, "answer_id": 58348813, "question_id": 40318257, "link": "https://stackoverflow.com/questions/40318257/why-go-can-lower-gc-pauses-to-sub-1ms-and-jvm-has-not/58348813#58348813", "title": "Why Go can lower GC pauses to sub 1ms and JVM has not?", "body": "<blockquote>\n  <p>What are the (architectural?) constraints which prevent JVM from\n  lowering GC pauses to Go levels, but are not affecting Go?</p>\n</blockquote>\n\n<p>Principal I would say is that java is reference-oriented language, while Go is value-oriented language.</p>\n\n<p>There are many aspects of it, Object metadata, Concurrency Handling... Naturally Java doesn't allow to put primitives in collections which give a lot of overhead in a sense of amount of Objects, in Golang you have Array, Slice and Map which support primitive types...</p>\n\n<p><a href=\"https://blog.golang.org/ismmkeynote\" rel=\"nofollow noreferrer\">Here</a> is a good article about Golang GC development and evolution.</p>\n"}], "owner": {"reputation": 2279, "user_id": 706650, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/ef3096b4882fbd87055934614385bcb9?s=128&d=identicon&r=PG", "display_name": "mabn", "link": "https://stackoverflow.com/users/706650/mabn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3561, "favorite_count": 3, "accepted_answer_id": 40318538, "answer_count": 3, "score": 15, "last_activity_date": 1616536752, "creation_date": 1477737612, "last_edit_date": 1477740540, "question_id": 40318257, "link": "https://stackoverflow.com/questions/40318257/why-go-can-lower-gc-pauses-to-sub-1ms-and-jvm-has-not", "title": "Why Go can lower GC pauses to sub 1ms and JVM has not?", "body": "<p>So there's that: <a href=\"https://groups.google.com/forum/?fromgroups#!topic/golang-dev/Ab1sFeoZg_8\">https://groups.google.com/forum/?fromgroups#!topic/golang-dev/Ab1sFeoZg_8</a>:</p>\n\n<blockquote>\n  <p>Today I submitted changes to the garbage collector that make typical worst-case stop-the-world times less than 100 microseconds. This should particularly improve pauses for applications with many active goroutines, which could previously inflate pause times significantly.</p>\n</blockquote>\n\n<p>High GC pauses are one if the things JVM users struggle with for a long time.</p>\n\n<p>What are the (architectural?) constraints which prevent JVM from lowering GC pauses to Go levels, but are not affecting Go?</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 603, "user_id": 3782306, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d2502e2aa71d69d257c0990afd018ff5?s=128&d=identicon&r=PG&f=1", "display_name": "Ezio", "link": "https://stackoverflow.com/users/3782306/ezio"}, "edited": false, "score": 0, "creation_date": 1477735112, "post_id": 40317919, "comment_id": 67892046, "body": "what if i am not printing anything to stdout and instead doing something like downloading a file ?"}, {"owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "reply_to_user": {"reputation": 603, "user_id": 3782306, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d2502e2aa71d69d257c0990afd018ff5?s=128&d=identicon&r=PG&f=1", "display_name": "Ezio", "link": "https://stackoverflow.com/users/3782306/ezio"}, "edited": false, "score": 0, "creation_date": 1477735682, "post_id": 40317919, "comment_id": 67892172, "body": "As long as the two methods don&#39;t access shared data, they can be safe"}, {"owner": {"reputation": 603, "user_id": 3782306, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d2502e2aa71d69d257c0990afd018ff5?s=128&d=identicon&r=PG&f=1", "display_name": "Ezio", "link": "https://stackoverflow.com/users/3782306/ezio"}, "edited": false, "score": 0, "creation_date": 1477737911, "post_id": 40317919, "comment_id": 67892726, "body": "My function is sharing a database variable which helps to connect to different tables in the database , but a call from any function access only a particular table in the database other that what other functions are accessing"}, {"owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "reply_to_user": {"reputation": 603, "user_id": 3782306, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d2502e2aa71d69d257c0990afd018ff5?s=128&d=identicon&r=PG&f=1", "display_name": "Ezio", "link": "https://stackoverflow.com/users/3782306/ezio"}, "edited": false, "score": 0, "creation_date": 1477739123, "post_id": 40317919, "comment_id": 67893038, "body": "This is starting to look like an <a href=\"http://meta.stackexchange.com/questions/66377/what-is-the-xy-problem\">XY problem</a>... Methods accessing shared data can be safe if they use synchronization. Database that allow concurrent access use synchronization, so yes, you can probably use a database safely by concurrent goroutines."}], "tags": [], "owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "is_accepted": true, "score": 1, "last_activity_date": 1477735644, "last_edit_date": 1495542834, "creation_date": 1477734983, "answer_id": 40317919, "question_id": 40317747, "link": "https://stackoverflow.com/questions/40317747/resolving-conflicts-with-goroutines/40317919#40317919", "title": "Resolving conflicts with goroutines?", "body": "<p>Whether multiple goroutines are safe to run concurrently or not comes down to whether they share data without synchronization. In this example, both <code>abc</code> and <code>xyz</code> print to <code>stdout</code> using <code>fmt.Println</code>, and call the same routine, <code>call</code>, which prints to <code>stdout</code> using <code>fmt.Println</code>. Since <a href=\"https://stackoverflow.com/q/14694088/641955\"><code>fmt.Println</code> doesn't use synchronization when printing to <code>stdout</code></a>, the answer is no, this program is not safe.</p>\n"}], "owner": {"reputation": 603, "user_id": 3782306, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/d2502e2aa71d69d257c0990afd018ff5?s=128&d=identicon&r=PG&f=1", "display_name": "Ezio", "link": "https://stackoverflow.com/users/3782306/ezio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "accepted_answer_id": 40317919, "answer_count": 1, "score": 1, "last_activity_date": 1477735644, "creation_date": 1477733552, "question_id": 40317747, "link": "https://stackoverflow.com/questions/40317747/resolving-conflicts-with-goroutines", "title": "Resolving conflicts with goroutines?", "body": "<p>I have a really minor doubt\nSuppose there are three func A,B,C\nC is being called from both A and B\nI am running A and B on different threads , will it result in conflict any time in feature when it calls C within it</p>\n\n<p>for reference i am adding this code</p>\n\n<pre><code>package main\n\nimport (\n\"fmt\"\n)\n\nfunc xyz() {\n     for true {\n         fmt.Println(\"Inside xyz\")\n         call(\"xyz\")\n     }\n}\n\nfunc abc() {\n    for true {\n         fmt.Println(\"Inside abc\")\n         call(\"abc\")\n    }\n}\n\nfunc call(s string) {\n    fmt.Println(\"call from \" + s)\n}\n\nfunc main() {\n    go xyz()\n    go abc()\n    var input string\n    fmt.Scanln(&amp;input)\n}\n</code></pre>\n\n<p>Here A = xyz(), B = abc(), C = call()</p>\n\n<p>will there be any conflict or any runtime error in future while running these two go routines</p>\n"}, {"tags": ["google-app-engine", "go", "google-app-engine-go"], "answers": [{"comments": [{"owner": {"reputation": 802, "user_id": 2018909, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/10ebdad579fc333db3830e893baf977e?s=128&d=identicon&r=PG", "display_name": "srini", "link": "https://stackoverflow.com/users/2018909/srini"}, "edited": false, "score": 0, "creation_date": 1477933222, "post_id": 40317099, "comment_id": 67948286, "body": "thank you, but I see a note in the document saying &quot;It should only be used by aetest package&quot;. I believe it might not be a risk. Is there any other solution?"}, {"owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "reply_to_user": {"reputation": 802, "user_id": 2018909, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/10ebdad579fc333db3830e893baf977e?s=128&d=identicon&r=PG", "display_name": "srini", "link": "https://stackoverflow.com/users/2018909/srini"}, "edited": false, "score": 0, "creation_date": 1478574061, "post_id": 40317099, "comment_id": 68200928, "body": "Why do you need to call <code>NewContext</code> to begin with? Perhaps a better approach would be to completely separate the appengine specific parts of the logic, and make the application logic testable independent of appengine specific state?"}, {"owner": {"reputation": 802, "user_id": 2018909, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/10ebdad579fc333db3830e893baf977e?s=128&d=identicon&r=PG", "display_name": "srini", "link": "https://stackoverflow.com/users/2018909/srini"}, "edited": false, "score": 0, "creation_date": 1478732454, "post_id": 40317099, "comment_id": 68276518, "body": "the Context is required for the appengine datastore operations like put, get, so it is required in my case."}, {"owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "reply_to_user": {"reputation": 802, "user_id": 2018909, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/10ebdad579fc333db3830e893baf977e?s=128&d=identicon&r=PG", "display_name": "srini", "link": "https://stackoverflow.com/users/2018909/srini"}, "edited": false, "score": 0, "creation_date": 1478732615, "post_id": 40317099, "comment_id": 68276590, "body": "What I mean is that you could abstract those APIs into interfaces and provide a mock context and a mock datstore to boot (or just a datastore, if you can hide the context), compatible with but independent of the appengine package"}, {"owner": {"reputation": 802, "user_id": 2018909, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/10ebdad579fc333db3830e893baf977e?s=128&d=identicon&r=PG", "display_name": "srini", "link": "https://stackoverflow.com/users/2018909/srini"}, "edited": false, "score": 0, "creation_date": 1478735553, "post_id": 40317099, "comment_id": 68277539, "body": "i&#39;m not sure how to do that. just now, I have posted a solution that I found working for me. I believe it is different than what you are talking about. However, I&#39;m interested to learn your solution too."}], "tags": [], "owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "is_accepted": false, "score": 1, "last_activity_date": 1477726966, "creation_date": 1477726966, "answer_id": 40317099, "question_id": 40316822, "link": "https://stackoverflow.com/questions/40316822/golang-appengine-api-testing-error-appengine-newcontext-passed-an-unknown-http/40317099#40317099", "title": "golang appengine api testing error &quot;appengine: NewContext passed an unknown http.Request&quot;", "body": "<p><code>NewContext</code> derives a context from in <a href=\"https://cloud.google.com/appengine/docs/go/reference#NewContext\" rel=\"nofollow\">flight HTTP requests</a>, i.e. ones that have been registered with it.</p>\n\n<p>Since you are creating a new request, unknown to the <a href=\"https://github.com/golang/appengine/blob/master/internal/api.go#L254-L271\" rel=\"nofollow\">internal appengine package</a>, it's panicking.</p>\n\n<p>That package also provides a <a href=\"https://godoc.org/google.golang.org/appengine/internal#RegisterTestRequest\" rel=\"nofollow\"><code>RegisterTestRequest</code></a> function, but it's not mentioned in the main documentation so YMMV. I have no experience with this.</p>\n"}, {"tags": [], "owner": {"reputation": 802, "user_id": 2018909, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/10ebdad579fc333db3830e893baf977e?s=128&d=identicon&r=PG", "display_name": "srini", "link": "https://stackoverflow.com/users/2018909/srini"}, "is_accepted": true, "score": 2, "last_activity_date": 1479270244, "last_edit_date": 1479270244, "creation_date": 1478735328, "answer_id": 40517915, "question_id": 40316822, "link": "https://stackoverflow.com/questions/40316822/golang-appengine-api-testing-error-appengine-newcontext-passed-an-unknown-http/40517915#40517915", "title": "golang appengine api testing error &quot;appengine: NewContext passed an unknown http.Request&quot;", "body": "<p>Apologies for the delay in response. I was working on the solution myself</p>\n\n<p>Here is how I solved the go appengine unit tests issue: the complete solution code can be found on <a href=\"https://github.com/muly/research/tree/APIUnitTestError22Solved/golang/appengine/ApiTesting\" rel=\"nofollow noreferrer\">this github repo branch</a>.</p>\n\n<p>In the *_test.go file, I have used the following.</p>\n\n<ul>\n<li>httptest.NewServer(..) to create a new instance of the test server. also used to capture the base url of the service which is used in preparing the request object.</li>\n<li>aetest.NewContext() to create a new context for testing purpose</li>\n<li>http.NewRequest(..) to create the new request</li>\n<li>gorilla's context.Set(..) to assign key (\"Context\"), value (context created in above step) to the request created above</li>\n<li>httptest.NewRecorder() a new recorder to save the results</li>\n<li>http.Handler.ServeHTTP(..) passing the recorded and request. used to make the API request </li>\n</ul>\n\n<p>For each API handler code, instead of directly creating the new context using appengine.NewContext, I have code described in the below sudocode</p>\n\n<pre><code>using the gorilla's context.GetOk(..), check \n    IF the received request object has the key \"Context\"\n    THEN using value of that key as the context\n    ELSE derive context using appengine.NewContext(r)\n</code></pre>\n\n<p>I have wrapped the reusable functionality into a separate library called <a href=\"https://github.com/muly/aeunittest\" rel=\"nofollow noreferrer\">aeunittest</a> and used it in my code.</p>\n\n<p>With this setup, i'm, able to run the goapp test to fire the unit tests. see the <a href=\"https://github.com/muly/research/tree/APIUnitTestError22Solved/golang/appengine/ApiTesting\" rel=\"nofollow noreferrer\">solved code</a> for complete details of the solution.</p>\n\n<p>Here is the blogpost that helped me find this solution. Thanks a lot Mark. <a href=\"http://www.compoundtheory.com/testing-go-http-handlers-in-google-app-engine-with-mux-and-higher-order-functions/\" rel=\"nofollow noreferrer\">TESTING GO HTTP HANDLERS IN GOOGLE APP ENGINE WITH MUX AND HIGHER ORDER FUNCTIONS</a>.</p>\n"}], "owner": {"reputation": 802, "user_id": 2018909, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/10ebdad579fc333db3830e893baf977e?s=128&d=identicon&r=PG", "display_name": "srini", "link": "https://stackoverflow.com/users/2018909/srini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 965, "favorite_count": 2, "accepted_answer_id": 40517915, "answer_count": 2, "score": 3, "last_activity_date": 1479270244, "creation_date": 1477724195, "question_id": 40316822, "link": "https://stackoverflow.com/questions/40316822/golang-appengine-api-testing-error-appengine-newcontext-passed-an-unknown-http", "title": "golang appengine api testing error &quot;appengine: NewContext passed an unknown http.Request&quot;", "body": "<p>I'm using appengine and golang to develop simple RESTful APIs. The code works fine when I start service using goapp serve, and I started writing the unit test functions to test the API endpoints, and I'm struck here with the panic error <code>appengine: NewContext passed an unknown http.Request</code>. I'm getting this error when i run <code>goapp test</code>.</p>\n\n<p>It looks like for some reason, i'm not able to pass the request that I created and pass it to <code>appengine.NewContext()</code></p>\n\n<p>Below is the snippet of the code..</p>\n\n<pre><code>body := strings.NewReader(\"\")\n\nrequest, err := http.NewRequest(\"GET\", \"endpoint url\", body) //inst.NewRequest(\"GET\", goalUrl, body) //\nif err != nil {\n    t.Error(err)\n}\nt.Log(request)\n\nc := appengine.NewContext(request) // ERROR: appengine: NewContext passed an unknown http.Request\n</code></pre>\n\n<p>I have created a <a href=\"https://github.com/muly/research/tree/APIUnitTestError22Simplified/golang/appengine/ApiTesting\" rel=\"nofollow\">simple reproducible code</a>. Can you help me with this? or Does anyone have their golang API project on appengine, and have unit test functions to test the endpoints, i'll like to take a look at their code...</p>\n\n<p>Here is the <a href=\"https://github.com/muly/lifelog/issues/22\" rel=\"nofollow\">gitlab issue</a> that I posted, which has all the required details of the issue along with examples and detailed error message. Thank for all your help.</p>\n"}, {"tags": ["unit-testing", "go"], "answers": [{"tags": [], "owner": {"reputation": 667, "user_id": 7058050, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/307b8a4eb324c043ff6bba1370750097?s=128&d=identicon&r=PG&f=1", "display_name": "djd0", "link": "https://stackoverflow.com/users/7058050/djd0"}, "is_accepted": true, "score": 19, "last_activity_date": 1477720458, "last_edit_date": 1477720458, "creation_date": 1477716382, "answer_id": 40316102, "question_id": 40316052, "link": "https://stackoverflow.com/questions/40316052/in-memory-file-for-testing/40316102#40316102", "title": "In-memory file for testing", "body": "<p>You can use a <a href=\"https://golang.org/pkg/bytes/#Buffer\" rel=\"noreferrer\">Buffer</a>.</p>\n\n<p>In general, it's a good idea to use <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"noreferrer\">io.Reader</a> and <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"noreferrer\">io.Writer</a> interfaces in your code (Buffer implements both) to deal with IO. That way you can deal with various methods of input/output (local file, memory buffer, network connection...) in the same way, without knowing what you are dealing with in the specific function you're using. It makes it more abstract and makes testing trivial.</p>\n\n<hr>\n\n<p>Example of use with a trivial function:</p>\n\n<p>Function definition:</p>\n\n<pre><code>// mypkg project mypkg.go\npackage mypkg\n\nimport (\n    \"bufio\"\n    \"io\"\n    \"strings\"\n)\n\nfunc MyFunction(in io.Reader, out io.Writer) {\n    rd := bufio.NewReader(in)\n    str, _ := rd.ReadString('\\n')\n    io.WriteString(out, strings.TrimSuffix(str, \"\\n\")+\" was input\\n\")\n}\n</code></pre>\n\n<p>Function use within a program:</p>\n\n<pre><code>package main\n\nimport (\n    \"mypkg\"\n    \"os\"\n)\n\nfunc main() {\n    mypkg.MyFunction(os.Stdin, os.Stdout)\n}\n</code></pre>\n\n<p>Test:</p>\n\n<pre><code>// mypkg project mypkg_test.go\npackage mypkg\n\nimport (\n    \"bytes\"\n    \"testing\"\n)\n\nfunc TestMyFunction(t *testing.T) {\n    ibuf := bytes.NewBufferString(\"hello\\n\")\n    obuf := bytes.NewBufferString(\"\")\n    MyFunction(ibuf, obuf)\n    if obuf.String() != \"hello was input\\n\" {\n        t.Fail()\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 34067, "user_id": 38140, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0b5c9699fa348a28c4accd81ebce0a91?s=128&d=identicon&r=PG", "display_name": "gotgenes", "link": "https://stackoverflow.com/users/38140/gotgenes"}, "edited": false, "score": 0, "creation_date": 1477779934, "post_id": 40316416, "comment_id": 67904044, "body": "Afero mocks an entire filesystem. That&#39;s really heavy compared to my needs, where I only need to mock file I/O. I can see how Afero has value for something like Hugo, though."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 3, "last_activity_date": 1477719931, "creation_date": 1477719931, "answer_id": 40316416, "question_id": 40316052, "link": "https://stackoverflow.com/questions/40316052/in-memory-file-for-testing/40316416#40316416", "title": "In-memory file for testing", "body": "<p>As mentioned in \"<a href=\"http://bepsays.com/en/2016/10/12/pragmatic-and-effective-testing-in-go/\" rel=\"nofollow\">Pragmatic and Effective Testing in Go</a>\", you can use <a href=\"https://github.com/spf13/afero\" rel=\"nofollow\"><code>spf13/afero</code></a> for file abstraction which leads to easier tests.</p>\n\n<p>That library has a <a href=\"https://github.com/spf13/afero#using-afero-for-testing\" rel=\"nofollow\">Using Afero for Testing</a>:</p>\n\n<blockquote>\n  <p>There is a large benefit to using a mock filesystem for testing. </p>\n  \n  <p>It has a completely blank state every time it is initialized and can be easily reproducible regardless of OS.<br>\n  You could create files to your heart\u2019s content and the file access would be fast while also saving you from all the annoying issues with deleting temporary files, Windows file locking, etc.<br>\n  The MemMapFs backend is perfect for testing.</p>\n  \n  <ul>\n  <li>Much faster than performing I/O operations on disk</li>\n  <li>Avoid security issues and permissions</li>\n  <li>Far more control. '<code>rm -rf /</code>' with confidence</li>\n  <li>Test setup is far more easier to do</li>\n  <li>No test cleanup needed</li>\n  </ul>\n</blockquote>\n\n<p>It uses a <a href=\"https://github.com/spf13/afero#memory-backed-storage\" rel=\"nofollow\">fully atomic memory backed filesystem (<code>MemMapFs</code>)</a>.<br>\nIt is fully concurrent and will work within go routines safely.</p>\n"}, {"tags": [], "owner": {"reputation": 1451, "user_id": 1795125, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/074209c5cd0c3ce13669ae5c0f594e1c?s=128&d=identicon&r=PG", "display_name": "Chaim Leib Halbert", "link": "https://stackoverflow.com/users/1795125/chaim-leib-halbert"}, "is_accepted": false, "score": 3, "last_activity_date": 1558568938, "last_edit_date": 1558568938, "creation_date": 1558048774, "answer_id": 56177725, "question_id": 40316052, "link": "https://stackoverflow.com/questions/40316052/in-memory-file-for-testing/56177725#56177725", "title": "In-memory file for testing", "body": "<p>If you need an <code>io.ReadSeeker</code>, and you don't need write access, use <a href=\"https://golang.org/pkg/bytes/#Reader\" rel=\"nofollow noreferrer\"><code>bytes.Reader</code></a>:</p>\n\n<pre><code>import \"bytes\"\n\ndata := []byte(\"success\")\nreadSeeker := bytes.NewReader(data)\n</code></pre>\n\n<p>This is useful for things like <a href=\"https://golang.org/pkg/net/http/#ServeContent\" rel=\"nofollow noreferrer\"><code>http.ServeContent()</code></a>.</p>\n"}], "owner": {"reputation": 34067, "user_id": 38140, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0b5c9699fa348a28c4accd81ebce0a91?s=128&d=identicon&r=PG", "display_name": "gotgenes", "link": "https://stackoverflow.com/users/38140/gotgenes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12449, "favorite_count": 4, "accepted_answer_id": 40316102, "answer_count": 3, "score": 15, "last_activity_date": 1558568938, "creation_date": 1477715747, "question_id": 40316052, "link": "https://stackoverflow.com/questions/40316052/in-memory-file-for-testing", "title": "In-memory file for testing", "body": "<p>How does one create in-memory files for unit testing in Go?</p>\n\n<p>In Python, I test reading from a file or writing to a file using <a href=\"https://docs.python.org/3/library/io.html?highlight=stringio#io.BytesIO\" rel=\"noreferrer\"><code>io.BytesIO</code></a> or <a href=\"https://docs.python.org/3/library/io.html?highlight=stringio#io.StringIO\" rel=\"noreferrer\"><code>io.StringIO</code></a>. For example, to test a file parser, I would have</p>\n\n<pre><code>def test_parse_function():\n    infile = io.StringIO('''\\\nline1\nline2\nline3\n''')\n    parsed_contents = parse_function(infile)\n    expected_contents = ['line1', 'line2', 'line3']  # or whatever is appropriate\n    assert parsed_contents == expected_contents\n</code></pre>\n\n<p>Similarly for file output, I would have something like the following:</p>\n\n<pre><code>def test_write_function():\n    outfile = io.StringIO()\n    write_function(outfile, ['line1', 'line2', 'line3'])\n    outfile.seek(0)\n    output = outfile.read()\n    expected_output = '''\\\nline1\nline2\nline3\n'''\n    assert output == expected_output\n</code></pre>\n"}, {"tags": ["string", "go", "permutation", "indexoutofboundsexception"], "comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1477720752, "post_id": 40315918, "comment_id": 67889782, "body": "Note: always use formatted code (see the button &quot;Format&quot; on the playground page)"}], "answers": [{"comments": [{"owner": {"reputation": 105, "user_id": 2149538, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6457bd7eeda97c8264f9b172927e3d4d?s=128&d=identicon&r=PG", "display_name": "Joshua Lee", "link": "https://stackoverflow.com/users/2149538/joshua-lee"}, "edited": false, "score": 0, "creation_date": 1477746043, "post_id": 40316482, "comment_id": 67894636, "body": "Ahhh I can&#39;t believe I missed that! Thank you, I was so focused on the recursion line because that&#39;s what the compiler was telling me..."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1477720549, "creation_date": 1477720549, "answer_id": 40316482, "question_id": 40315918, "link": "https://stackoverflow.com/questions/40315918/golang-string-permutation-slice-bounds-out-of-range/40316482#40316482", "title": "golang - string permutation - slice bounds out of range", "body": "<p>Simple:</p>\n\n<pre><code>for i := 0; i &lt; n; n++ {\n                   ^^^\n                    ?\n</code></pre>\n\n<p>Replace <code>n</code> by <code>i</code>, which is supposed to go from <code>0</code> to <code>n-1</code>.</p>\n\n<p><a href=\"https://play.golang.org/p/b_QNRTIaZe\" rel=\"nofollow\">Resulting playground</a>.</p>\n"}], "owner": {"reputation": 105, "user_id": 2149538, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/6457bd7eeda97c8264f9b172927e3d4d?s=128&d=identicon&r=PG", "display_name": "Joshua Lee", "link": "https://stackoverflow.com/users/2149538/joshua-lee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 467, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1543425908, "creation_date": 1477713808, "last_edit_date": 1477720668, "question_id": 40315918, "link": "https://stackoverflow.com/questions/40315918/golang-string-permutation-slice-bounds-out-of-range", "title": "golang - string permutation - slice bounds out of range", "body": "<p><a href=\"https://play.golang.org/p/pJvK2PADtG\" rel=\"nofollow\">Here</a> is the Go Playground code for this problem.</p>\n\n<p>I am trying to write a golang string permutation using recursion.<br>\nThe permutation function takes two arguments, prefix which is an empty string (<code>\"\"</code>) and <code>str</code> which is \"<code>abc</code>\". The code is below</p>\n\n<pre><code>func main() {\n    str := \"abc\"\n    perm(\"\", str)\n}\n\nfunc perm(prefix string, str string) {\n    n := len(str)\n    fmt.Println(n)\n    if n == 0 {\n        fmt.Println(prefix)\n    } else {\n        for i := 0; i &lt; n; n++ {\n            perm(prefix+str[i:i+1], str[0:i]+str[(i+1):n])\n        }\n    }\n}\n</code></pre>\n\n<p>When I run this code, I am shown 3,2,1,0 for the value of n as expected.<br>\nI successfully get \"<code>abc</code>\" but then I get a \"<code>panic: runtime error: slice bounds out of range</code>\" error.  </p>\n\n<p>It never shows the second round of 3,2,1,0 so it doesn't even get to the <code>b</code> combinations. I feel like if an error would occur is when it gets to the <code>c</code> portion of the string but since it doesn't even get to the <code>b</code> portion, I am not sure what is wrong.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 1, "last_activity_date": 1477755988, "last_edit_date": 1477755988, "creation_date": 1477721316, "answer_id": 40316557, "question_id": 40315863, "link": "https://stackoverflow.com/questions/40315863/golang-memory-leak-when-break-call-net-lookuphost-by-time-after/40316557#40316557", "title": "golang memory leak when break call net.LookupHost by time.After", "body": "<p>You can check an alternative implementation proposed in <a href=\"https://github.com/bogdanovich/dns_resolver\" rel=\"nofollow\"><code>bogdanovich/dns_resolver</code></a></p>\n\n<p>Its <a href=\"https://github.com/bogdanovich/dns_resolver/blob/8c2aece5b6f59475aecb061a3734966975c42b11/dns_resolver.go\" rel=\"nofollow\"><code>dns_resolver.go</code></a> does include timeout management</p>\n\n<pre><code>resolver := dns_resolver.New([]string{\"8.8.8.8\", \"8.8.4.4\"})\n// OR\n// resolver := dns_resolver.NewFromResolvConf(\"resolv.conf\")\n\n// In case of i/o timeout\nresolver.RetryTimes = 5\n</code></pre>\n\n<p>You can then wrap the all call in a goroutine, in order for the call to not break abruptly <code>net.LookupHost()</code>.</p>\n\n<pre><code>ip, err := resolver.LookupHost(\"google.com\")\nif err != nil {\n    log.Fatal(err.Error())\n}\nlog.Println(ip)\n// Output [216.58.192.46]\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 2492511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f89e3fb7db5584d606ab796ab4345be?s=128&d=identicon&r=PG", "display_name": "\u0412\u0438\u043a\u0442\u043e\u0440 \u041f\u0443\u043f\u043a\u0438\u043d", "link": "https://stackoverflow.com/users/2492511/%d0%92%d0%b8%d0%ba%d1%82%d0%be%d1%80-%d0%9f%d1%83%d0%bf%d0%ba%d0%b8%d0%bd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 152, "favorite_count": 1, "accepted_answer_id": 40316557, "answer_count": 1, "score": 1, "last_activity_date": 1477755988, "creation_date": 1477713005, "last_edit_date": 1477721388, "question_id": 40315863, "link": "https://stackoverflow.com/questions/40315863/golang-memory-leak-when-break-call-net-lookuphost-by-time-after", "title": "golang memory leak when break call net.LookupHost by time.After", "body": "<p>I use this function to limit response time from DNS server</p>\n\n<pre><code>func LookupHost(hostname string, timeout time.Duration) ([]string, error) {\n    c1 := make(chan []string)\n    c2 := make(chan error)\n\n    go func() {\n        var ipaddr []string\n        ipaddr, err := net.LookupHost(hostname)\n        if err != nil {\n            c2 &lt;- err\n            close(c2)\n        }\n\n        c1 &lt;- ipaddr\n        close(c1)\n    }()\n\n    select {\n    case ipaddr := &lt;-c1:\n        return ipaddr, nil\n    case err := &lt;-c2:\n        return []string{}, err\n    case &lt;-time.After(timeout):\n        return []string{}, errors.New(\"timeout\")\n    }\n\n}\n</code></pre>\n\n<p>The problem is that this function eat memory.<br>\nI think it is because I break <code>net.LookupHost(hostname)</code> syscall. </p>\n\n<p>Any way to avoid this?<br>\nMay be some other way how to query DNS servers with timeouts?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 0, "creation_date": 1477711029, "post_id": 40315686, "comment_id": 67888443, "body": "Most probably because the main thread exits before the goroutine got time to complete its work. Put a sleep of 2/3 seconds at the end of main function and check. Also remove the sleep from  addUrls routine."}, {"owner": {"reputation": 279, "user_id": 1310618, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6c3b061959da80f4656935e95dd99c12?s=128&d=identicon&r=PG", "display_name": "TestingInProd", "link": "https://stackoverflow.com/users/1310618/testinginprod"}, "reply_to_user": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 0, "creation_date": 1477711576, "post_id": 40315686, "comment_id": 67888520, "body": "Hey thanks ..That was the problem .."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1477734691, "post_id": 40315686, "comment_id": 67891961, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/28958192/whats-wrong-with-this-golang-code\">What&#39;s wrong with this golang code?</a>; and <a href=\"http://stackoverflow.com/questions/28307783/goroutine-does-not-execute-if-time-sleep-included\">Goroutine does not execute if time.Sleep included</a>."}, {"owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "edited": false, "score": 0, "creation_date": 1477754377, "post_id": 40315686, "comment_id": 67896868, "body": "Using a <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\"><code>sync.WaitGroup</code></a> or reading on a channel in <code>main</code> will be more fault tolerant and responsive than a sleep when taking into account any variance in the goro execution. Sleep is a pretty error prone synchronisation mechanism."}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "reply_to_user": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "edited": false, "score": 0, "creation_date": 1477893633, "post_id": 40315686, "comment_id": 67929307, "body": "@nothingmuch Yuval? Welcome!"}, {"owner": {"reputation": 1242, "user_id": 7061430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81912bc5ca02376f99a5ee44531dee27?s=128&d=identicon&r=PG", "display_name": "nothingmuch", "link": "https://stackoverflow.com/users/7061430/nothingmuch"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1477904324, "post_id": 40315686, "comment_id": 67932431, "body": "@hobbs Indeed! Hi! Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 279, "user_id": 1310618, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6c3b061959da80f4656935e95dd99c12?s=128&d=identicon&r=PG", "display_name": "TestingInProd", "link": "https://stackoverflow.com/users/1310618/testinginprod"}, "is_accepted": false, "score": -1, "last_activity_date": 1477719291, "creation_date": 1477719291, "answer_id": 40316347, "question_id": 40315686, "link": "https://stackoverflow.com/questions/40315686/golang-routine-terminates-early/40316347#40316347", "title": "Golang routine terminates early", "body": "<p>Actually The problem was like Nipun said, the main got terminated early. </p>\n"}, {"tags": [], "owner": {"reputation": 735, "user_id": 6697038, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Eqwd8.jpg?s=128&g=1", "display_name": "nosequeldeebee", "link": "https://stackoverflow.com/users/6697038/nosequeldeebee"}, "is_accepted": false, "score": 1, "last_activity_date": 1477893384, "creation_date": 1477893384, "answer_id": 40337241, "question_id": 40315686, "link": "https://stackoverflow.com/questions/40315686/golang-routine-terminates-early/40337241#40337241", "title": "Golang routine terminates early", "body": "<p>You are using <code>time.Sleep</code> to wait for <code>main</code> to finish but you really should be using WaitGroups. </p>\n\n<p>That way you don't have to try to pick some arbitrary time and hope it's enough for your program to finish, or worry about setting too much time and your program sits around doing nothing. </p>\n\n<p>I've added the implementation of WaitGroups to your code here:</p>\n\n<blockquote>\n  <p><a href=\"https://play.golang.org/p/1zn2JYefaA\" rel=\"nofollow\">https://play.golang.org/p/1zn2JYefaA</a></p>\n</blockquote>\n\n<p>Also, the way your <code>consumeUrls</code> function is written is not looping properly and you won't get everything in your channel printed. But since that wasn't your specific question I won't address it here.</p>\n"}], "owner": {"reputation": 279, "user_id": 1310618, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/6c3b061959da80f4656935e95dd99c12?s=128&d=identicon&r=PG", "display_name": "TestingInProd", "link": "https://stackoverflow.com/users/1310618/testinginprod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1477893384, "creation_date": 1477710761, "question_id": 40315686, "link": "https://stackoverflow.com/questions/40315686/golang-routine-terminates-early", "title": "Golang routine terminates early", "body": "<p>I just started using go and wrote my first program but the output is not as expected. I have writtern a async routine addUrl which adds url to channel 5000 times and consumeUrl removes from the channel and prints it.\nThe routine runs only 9 time. Why is it? Below is the code and output</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"time\"\n\nvar urlCount = 0\n\nfunc main(){\n\n    urlHolder := make(chan string,5000)\n\n    fmt.Printf(\"Starting program\")\n\n    go addUrls(urlHolder)\n\n    time.Sleep(time.Millisecond * 100)\n    go consumeUrls(urlHolder)\n\n    fmt.Printf(\"Done\")\n\n}\n\nfunc addUrls(urlHolder chan string){\n    var myurl string = \"https://example.com/\"\n\n    for i:=0; i&lt;5000 ; i++ {\n        urlHolder&lt;-myurl\n        fmt.Printf(\" %d url added \\n\",i)\n        time.Sleep(time.Millisecond * 10)\n    }\n\n}\n\nfunc consumeUrls(urlHolder chan string) {\n    urlCount++\n    urlsConsumed := &lt;- urlHolder\n    fmt.Printf(\"Pulled url %d\",urlCount,\" \",urlsConsumed,\"\\n\")\n    time.Sleep(time.Millisecond * 20)\n}  \n</code></pre>\n\n<p>The output is </p>\n\n<pre><code>Starting program\n 0 url added \n 1 url added \n 2 url added \n 3 url added \n 4 url added \n 5 url added \n 6 url added \n 7 url added \n 8 url added \nDone\n</code></pre>\n\n<p>Why is it terminating at 8 when loop is 5000?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3031, "user_id": 1315900, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/81ac598abb24d160c87a6f9a72e250d2?s=128&d=identicon&r=PG", "display_name": "Fermin Silva", "link": "https://stackoverflow.com/users/1315900/fermin-silva"}, "edited": false, "score": 0, "creation_date": 1477688377, "post_id": 40313027, "comment_id": 67883386, "body": "Doesn&#39;t cmd.Wait close the output ? (that is the gzW) For now I solved by manually calling flush on the gzW, but will try your solution and report back"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 3031, "user_id": 1315900, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/81ac598abb24d160c87a6f9a72e250d2?s=128&d=identicon&r=PG", "display_name": "Fermin Silva", "link": "https://stackoverflow.com/users/1315900/fermin-silva"}, "edited": false, "score": 0, "creation_date": 1477689818, "post_id": 40313027, "comment_id": 67883935, "body": "@FerminSilva, no it does not call Close. (Cmd.Stdout is an <code>io.Writer</code>, not an <code>io.WriteCloser</code>). Also, if you don&#39;t Close the <code>gzip.Writer</code>, the crc footer won&#39;t be written, and decompressing the output will error."}, {"owner": {"reputation": 3031, "user_id": 1315900, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/81ac598abb24d160c87a6f9a72e250d2?s=128&d=identicon&r=PG", "display_name": "Fermin Silva", "link": "https://stackoverflow.com/users/1315900/fermin-silva"}, "edited": false, "score": 0, "creation_date": 1477690575, "post_id": 40313027, "comment_id": 67884168, "body": "good to know! BTW, whats the problem about blocking on the close calls if my code is already in a gorutine?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 3031, "user_id": 1315900, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/81ac598abb24d160c87a6f9a72e250d2?s=128&d=identicon&r=PG", "display_name": "Fermin Silva", "link": "https://stackoverflow.com/users/1315900/fermin-silva"}, "edited": false, "score": 0, "creation_date": 1477691421, "post_id": 40313027, "comment_id": 67884500, "body": "@FerminSilva: Blocking in the goroutine is fine, but in this case if one of those calls is blocking, it&#39;s because of a problem. With the added <code>WaitGroup</code>, if you close the pipe first you&#39;ll see that the goroutine doesn&#39;t return because the <code>gzip.Writer</code> can&#39;t close."}, {"owner": {"reputation": 3031, "user_id": 1315900, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/81ac598abb24d160c87a6f9a72e250d2?s=128&d=identicon&r=PG", "display_name": "Fermin Silva", "link": "https://stackoverflow.com/users/1315900/fermin-silva"}, "edited": false, "score": 0, "creation_date": 1477691574, "post_id": 40313027, "comment_id": 67884550, "body": "Great. Last question, can I assume (with <i>some</i> confidence) that if a library requires a Writer then I will need to call close myself but if a library requires a WriterCloser then it will close the stream when it&#39;s done ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 3031, "user_id": 1315900, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/81ac598abb24d160c87a6f9a72e250d2?s=128&d=identicon&r=PG", "display_name": "Fermin Silva", "link": "https://stackoverflow.com/users/1315900/fermin-silva"}, "edited": false, "score": 0, "creation_date": 1477691987, "post_id": 40313027, "comment_id": 67884713, "body": "@FerminSilva: I would say that&#39;s a good general assumption, as functions should ask for the minimal interface needed, but having documentation that confirms the behavior is always better."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1477707707, "last_edit_date": 1477707707, "creation_date": 1477687832, "answer_id": 40313027, "question_id": 40312349, "link": "https://stackoverflow.com/questions/40312349/pipe-command-output-to-reader-through-gzip/40313027#40313027", "title": "Pipe command output to Reader through gzip", "body": "<p>You're closing the gzip writer and pipe writer in the wrong order. You need to close the <code>gzip.Writer</code> to flush any buffers and write the gzip footer, then you can close the <code>PipeWriter</code> to unblock the <code>ReadAll</code>. Also adding the <code>WaitGroup</code> ensures that you're not blocked on any of the close calls. </p>\n\n<pre><code>cmd := exec.Command(\"echo\", \"hello_from_echo and more\")\n\npr, pw := io.Pipe()\ngzW := gzip.NewWriter(pw)\n\ncmd.Stdout = gzW\ncmd.Start()\n\nvar wg sync.WaitGroup\nwg.Add(1)\ngo func() {\n    defer wg.Done()\n    err := cmd.Wait()\n    if err != nil {\n        log.Println(err)\n    }\n    gzW.Close()\n    pw.Close()\n}()\n\nbuf, err := ioutil.ReadAll(pr)\nif err != nil {\n    t.Fatal(err)\n}\nwg.Wait()\nfmt.Println(hex.EncodeToString(buf))\n</code></pre>\n"}], "owner": {"reputation": 3031, "user_id": 1315900, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/81ac598abb24d160c87a6f9a72e250d2?s=128&d=identicon&r=PG", "display_name": "Fermin Silva", "link": "https://stackoverflow.com/users/1315900/fermin-silva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 592, "favorite_count": 0, "accepted_answer_id": 40313027, "answer_count": 1, "score": 1, "last_activity_date": 1477707707, "creation_date": 1477684509, "question_id": 40312349, "link": "https://stackoverflow.com/questions/40312349/pipe-command-output-to-reader-through-gzip", "title": "Pipe command output to Reader through gzip", "body": "<p>I'm trying to execute a shell command and compress it's output.\nThe problem is that I then need to interface with an API that expects a Reader.</p>\n\n<p>For that I tried with the following (simplified code):</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/hex\"\n    \"testing\"\n    \"fmt\"\n    \"io\"\n    \"io/ioutil\"\n    \"os/exec\"\n    \"compress/gzip\"\n)\n\nfunc TestPipe(t *testing.T) {\n    cmd := exec.Command(\"echo\", \"hello_from_echo\")\n\n    reader, writer := io.Pipe()\n    gzW := gzip.NewWriter(writer)\n\n    cmd.Stdout = gzW \n    cmd.Start()\n\n    go func() {\n        fmt.Println(\"Waiting\")\n        cmd.Wait()\n        fmt.Println(\"wait done\")\n        // writer.Close()\n        // gzW.Close()\n    }()\n\n    msg, _ := ioutil.ReadAll( reader )\n    fmt.Println( hex.EncodeToString( msg ) )\n}\n</code></pre>\n\n<p>The problem is that ReadAll hangs forever. If I close <code>gzW</code> nothing really changes. However, if I close the <code>writer</code> variable, now the program finishes without hanging, but the output is:</p>\n\n<pre><code>$ go test -run Pipe\nWaiting\nwait done\n1f8b080000096e8800ff\nPASS\n</code></pre>\n\n<p>However, no matter what I echo the output is the same. If I try it from the command line like this: <code>echo \"hello_from_echo\" | gzip | hexdump</code> the output is totally different, so there's something wrong with that approach.</p>\n\n<p>Any clue what could be the problem?</p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["string", "go", "concat"], "comments": [{"owner": {"reputation": 4197, "user_id": 1632346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c043a71ec4903a9a9e6a4de90c787fa1?s=128&d=identicon&r=PG", "display_name": "slomek", "link": "https://stackoverflow.com/users/1632346/slomek"}, "edited": false, "score": 1, "creation_date": 1477675973, "post_id": 40310333, "comment_id": 67877841, "body": "Did you post the question and answer at the same time? What for?"}, {"owner": {"reputation": 3707, "user_id": 968809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/012f28cccc6dbfb5e5d6d2214225550b?s=128&d=identicon&r=PG", "display_name": "cohadar", "link": "https://stackoverflow.com/users/968809/cohadar"}, "reply_to_user": {"reputation": 4197, "user_id": 1632346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c043a71ec4903a9a9e6a4de90c787fa1?s=128&d=identicon&r=PG", "display_name": "slomek", "link": "https://stackoverflow.com/users/1632346/slomek"}, "edited": false, "score": 5, "creation_date": 1477676221, "post_id": 40310333, "comment_id": 67877950, "body": "Because I could not find the answer on stack overflow earlier, and google gave shitty results. It is a standard practice."}, {"owner": {"reputation": 4197, "user_id": 1632346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c043a71ec4903a9a9e6a4de90c787fa1?s=128&d=identicon&r=PG", "display_name": "slomek", "link": "https://stackoverflow.com/users/1632346/slomek"}, "edited": false, "score": 0, "creation_date": 1477680833, "post_id": 40310333, "comment_id": 67880120, "body": "I believe that the common practice is to ask questions when you don&#39;t know the answer."}, {"owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "edited": false, "score": 0, "creation_date": 1477682107, "post_id": 40310333, "comment_id": 67880756, "body": "It&#39;s not the first time that you post a question adding a few moments later an answer. Use the documentation instead of making question where you already know the answer."}, {"owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "reply_to_user": {"reputation": 4197, "user_id": 1632346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c043a71ec4903a9a9e6a4de90c787fa1?s=128&d=identicon&r=PG", "display_name": "slomek", "link": "https://stackoverflow.com/users/1632346/slomek"}, "edited": false, "score": 16, "creation_date": 1477682357, "post_id": 40310333, "comment_id": 67880857, "body": "@slomek If you click on <b>Ask Question</b>, you&#39;ll see a checkbox <b>Answer your own question</b>. This is in fact encouraged by <a href=\"https://stackoverflow.blog/2011/07/its-ok-to-ask-and-answer-your-own-questions/\">this blog post</a>, linked from the ask question page."}, {"owner": {"reputation": 4197, "user_id": 1632346, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c043a71ec4903a9a9e6a4de90c787fa1?s=128&d=identicon&r=PG", "display_name": "slomek", "link": "https://stackoverflow.com/users/1632346/slomek"}, "reply_to_user": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "edited": false, "score": 2, "creation_date": 1477685704, "post_id": 40310333, "comment_id": 67882351, "body": "What @Tinwor wrote is exactly what I meant. It&#39;s OK to answer your own questions, but there is no point of asking one if you <b>already</b> have an answer. If you posted it, then worked through it and came up with some solution, I wouldn&#39;t mind that."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1477676432, "post_id": 40310334, "comment_id": 67878038, "body": "go strings are a sequence of <i>bytes</i>, not runes. Ranging over a string implicitly returns runes, along with the byte indexes in the string."}, {"owner": {"reputation": 3707, "user_id": 968809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/012f28cccc6dbfb5e5d6d2214225550b?s=128&d=identicon&r=PG", "display_name": "cohadar", "link": "https://stackoverflow.com/users/968809/cohadar"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1477677303, "post_id": 40310334, "comment_id": 67878457, "body": "Actually they are not because not every byte sequence is a valid string. They can be type casted into sequences of bytes."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1477677908, "post_id": 40310334, "comment_id": 67878724, "body": "No, I assure you they are (there is no type casting, only conversion). The string data structure consists solely of an array of bytes, and the length that of that array. The range operator scans for runes, but the string is still bytes. The <code>string</code> and <code>[]byte</code> types have the same underlying data, and can be converted in both directions. <a href=\"https://play.golang.org/p/TBiD44CUI2\" rel=\"nofollow noreferrer\">play.golang.org/p/TBiD44CUI2</a>"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1477678080, "post_id": 40310334, "comment_id": 67878795, "body": "Which makes me wonder, how does range behave with invalid code points?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 0, "creation_date": 1477678355, "post_id": 40310334, "comment_id": 67878921, "body": "@captncraig, the same way it would if you converted the <code>string</code> to <code>[]rune</code>. You get the replacement character <code>0xfffd</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1477679079, "post_id": 40310334, "comment_id": 67879296, "body": "@cohadar: sorry, the phrase &quot;they are utf-8 encoded sequences of runes&quot; was what I found confusing. I though you meant that strings were a representation of <code>[]rune</code>, which they are not."}, {"owner": {"reputation": 3707, "user_id": 968809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/012f28cccc6dbfb5e5d6d2214225550b?s=128&d=identicon&r=PG", "display_name": "cohadar", "link": "https://stackoverflow.com/users/968809/cohadar"}, "edited": false, "score": 0, "creation_date": 1477680201, "post_id": 40310334, "comment_id": 67879779, "body": "for i := range &quot;\u20ac\u20ac\u20ac&quot; { fmt.Print(i) } // prints 036  for i := range []byte(&quot;\u20ac\u20ac\u20ac&quot;) { fmt.Print(i) } // prints 012345678"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1477680748, "post_id": 40310334, "comment_id": 67880073, "body": "@cohadar: that&#39;s showing the byte indexes, which exactly what I said and demonstrated in my comment. The same thing without <code>range</code> looks like: <a href=\"https://play.golang.org/p/fDjZYSdkIv\" rel=\"nofollow noreferrer\">play.golang.org/p/fDjZYSdkIv</a> (and for good measure, the <code>[]byte</code> equivalent too <a href=\"https://play.golang.org/p/NgBiQvs4Yr\" rel=\"nofollow noreferrer\">play.golang.org/p/NgBiQvs4Yr</a>)"}, {"owner": {"reputation": 3707, "user_id": 968809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/012f28cccc6dbfb5e5d6d2214225550b?s=128&d=identicon&r=PG", "display_name": "cohadar", "link": "https://stackoverflow.com/users/968809/cohadar"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1477682399, "post_id": 40310334, "comment_id": 67880873, "body": "@JimB yes, you are right. I just wanted to point out that even thou &quot;under the hood&quot; some things are same, does not mean type is the same. For example int32 and unit32 are same under the hood but behave differently in sign operations or when printing. Contrast this with int32 and rune which are same both in value and in type (aliases)"}], "tags": [], "owner": {"reputation": 3707, "user_id": 968809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/012f28cccc6dbfb5e5d6d2214225550b?s=128&d=identicon&r=PG", "display_name": "cohadar", "link": "https://stackoverflow.com/users/968809/cohadar"}, "is_accepted": false, "score": 67, "last_activity_date": 1477675878, "creation_date": 1477675878, "answer_id": 40310334, "question_id": 40310333, "link": "https://stackoverflow.com/questions/40310333/how-to-append-a-character-to-a-string-in-golang/40310334#40310334", "title": "How to append a character to a string in Golang?", "body": "<p>In Go rune type is <strong>not</strong> a character type, it is just another name for int32.</p>\n\n<p>If you come from Java or a similar language this will surprise you because Java has char type and you can add char to a string.</p>\n\n<pre><code>String s = \"hello\";\nchar c = 'x';\nSystem.out.println(s + c);\n</code></pre>\n\n<p>In Go you need to be more explicit:</p>\n\n<pre><code>s := \"hello\";\nc := 'x';\nfmt.Println(s + string(c));\n</code></pre>\n\n<p>Omg do you really need to convert every char to a string constant? Yes, but do not worry, this is just because of a type system and compiler optimizes it correctly. Under the hood both Java and Go append the char in the same manner.</p>\n\n<p>If you think extra typing sucks, just compare how many times <strong>string</strong> keyword appears in each example above. :)</p>\n\n<p><strong>Extra info: (technical details)</strong></p>\n\n<p>In Go strings are <strong>not</strong> sequences of runes, they are <strong>utf-8</strong> encoded sequences of runes. When you range over a string you get runes, but you cannot simply append a rune to a string.\nFor example: euro sign '\u20ac' is an integer 0x20AC (this is called code point)\nBut when you encode euro sign in utf-8 you get 3 bytes: 0xE2 0x82 0xAC\n<a href=\"http://www.fileformat.info/info/unicode/char/20aC/index.htm\" rel=\"noreferrer\">http://www.fileformat.info/info/unicode/char/20aC/index.htm</a></p>\n\n<p>So appending a char actually works like this:</p>\n\n<pre><code>s = append(s, encodeToUtf8(c)) // Go\ns = append(s, encodeToUtf16(c)) // Java\n</code></pre>\n\n<p>Note that encodings are done at compile time.</p>\n\n<p>Utf-8 can encode a character with 1, 2, 3, or 4 bytes.\nUtf-16 can encode a character with 2 or with 4 bytes.</p>\n\n<p>So Go usually appends 1 byte (for ascii) or 2, 3, 4 bytes for Chinese, and Java usually appends 2 bytes (for ascii) or 4 bytes for Chinese.</p>\n\n<p>Since most characters that we (west) use can be encoded with 2 bytes Java gives the false belief that strings are sequences of 2byte char-s, which is true until you need to encode \u7f8e\u56fd\u5fc5\u987b\u6b7b</p>\n"}, {"comments": [{"owner": {"reputation": 526, "user_id": 1035977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/310abc9d873d41cede1258891d6bcaf3?s=128&d=identicon&r=PG", "display_name": "Gwyneth Llewelyn", "link": "https://stackoverflow.com/users/1035977/gwyneth-llewelyn"}, "edited": false, "score": 1, "creation_date": 1595182333, "post_id": 61913584, "comment_id": 111379351, "body": "I&#39;m a bit confused since your code does not really work on the Go playground. For instance, where does <code>r</code> come from? The declarations of <code>s</code> and <code>c</code> aren&#39;t syntactically valid Go (unless I&#39;m missing something) but suspiciously like Java. Maybe you wanted something like this: <a href=\"https://play.golang.org/p/06Sa2CfB7JW\" rel=\"nofollow noreferrer\">play.golang.org/p/06Sa2CfB7JW</a> ?"}, {"owner": {"reputation": 71, "user_id": 13581897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f3e514ba1ccc9f6911f8ed2eaed5b17?s=128&d=identicon&r=PG&f=1", "display_name": "ashutosh", "link": "https://stackoverflow.com/users/13581897/ashutosh"}, "reply_to_user": {"reputation": 526, "user_id": 1035977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/310abc9d873d41cede1258891d6bcaf3?s=128&d=identicon&r=PG", "display_name": "Gwyneth Llewelyn", "link": "https://stackoverflow.com/users/1035977/gwyneth-llewelyn"}, "edited": false, "score": 0, "creation_date": 1595302916, "post_id": 61913584, "comment_id": 111420075, "body": "@GwynethLlewelyn yes, you are right, my bad. Corrected Code syntax"}], "tags": [], "owner": {"reputation": 71, "user_id": 13581897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f3e514ba1ccc9f6911f8ed2eaed5b17?s=128&d=identicon&r=PG&f=1", "display_name": "ashutosh", "link": "https://stackoverflow.com/users/13581897/ashutosh"}, "is_accepted": false, "score": 6, "last_activity_date": 1595302835, "last_edit_date": 1595302835, "creation_date": 1589979031, "answer_id": 61913584, "question_id": 40310333, "link": "https://stackoverflow.com/questions/40310333/how-to-append-a-character-to-a-string-in-golang/61913584#61913584", "title": "How to append a character to a string in Golang?", "body": "<p><strong>Simple but little inefficient</strong></p>\n<p>While this works perfectly fine for a simple program, But it is a little inefficient. Because strings in Go are immutable , so every time we want to change string or add to string then we are creating new string. For the scenario where we need to add multiple characters/strings to string, then it is inefficient</p>\n<pre><code>s := &quot;hello&quot;;\nc := 'x';\nfmt.Println(s + string(c));\n</code></pre>\n<p><strong>Using <a href=\"https://golang.org/pkg/strings/#Builder\" rel=\"nofollow noreferrer\">strings.Builder</a> (Go 1.10+)</strong></p>\n<p>A Builder is used to efficiently build a string using Write methods. It minimizes memory copying. The zero value is ready to use. Do not copy a non-zero Builder.</p>\n<pre><code>    package main\n\n    import (\n      &quot;strings&quot;\n      &quot;fmt&quot;\n    )\n    \n    func main() {\n        var s string\n        s = &quot;hello&quot;;\n        var c = 'x';\n        var sb strings.Builder\n        sb.WriteString(s)\n        sb.WriteRune(c)\n        fmt.Println(sb.String())\n    }\n</code></pre>\n<p><a href=\"https://play.golang.org/p/n1plG9eOxHD\" rel=\"nofollow noreferrer\">https://play.golang.org/p/n1plG9eOxHD</a></p>\n"}], "owner": {"reputation": 3707, "user_id": 968809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/012f28cccc6dbfb5e5d6d2214225550b?s=128&d=identicon&r=PG", "display_name": "cohadar", "link": "https://stackoverflow.com/users/968809/cohadar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60985, "favorite_count": 4, "answer_count": 2, "score": 47, "last_activity_date": 1595302835, "creation_date": 1477675878, "last_edit_date": 1512250498, "question_id": 40310333, "link": "https://stackoverflow.com/questions/40310333/how-to-append-a-character-to-a-string-in-golang", "title": "How to append a character to a string in Golang?", "body": "<p>How to append a character to a string in Go?</p>\n\n<p>This does not work:</p>\n\n<pre><code>s := \"hello\";\nc := 'x'; \nfmt.Println(s + c);\n</code></pre>\n\n<p><em>invalid operation: s + c (mismatched types string and rune)</em></p>\n\n<p>This does not work either:</p>\n\n<pre><code>s := \"hello\";\nc := 'x'; \nfmt.Println(s + rune(c));\n</code></pre>\n\n<p><em>invalid operation: s + rune(c) (mismatched types string and rune)</em></p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1477671187, "post_id": 40309003, "comment_id": 67875391, "body": "What makes you think it&#39;s not using enough CPU cores? What behavior do you expect, and what behavior do you observe?"}, {"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1477671327, "post_id": 40309003, "comment_id": 67875461, "body": "I share a screen of <code>htop</code> while executing the application so you&#39;ll understand it. Basically, there&#39;s only <code>1 thread active</code> at a time and all cores are used around 25%."}, {"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1477673491, "post_id": 40309003, "comment_id": 67876541, "body": "You say you&#39;re spawning 4 goroutines. How do you know you&#39;re getting 4?"}, {"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1477673804, "post_id": 40309003, "comment_id": 67876712, "body": "That&#39;s an error, I spawn 8 of them using the for and giving it Max Cores."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1477674321, "post_id": 40309003, "comment_id": 67876991, "body": "Your goroutines are just spawning other processes. Your Go process isn&#39;t going any real work, so why would it use any CPU time?"}, {"owner": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1477674405, "post_id": 40309003, "comment_id": 67877043, "body": "How do you know you&#39;re getting 8 goroutines, then? Did you remember to set GOMAXPROCS to at least 8?"}, {"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "reply_to_user": {"reputation": 213464, "user_id": 2357112, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/3f80897d57525afe9eac4fb8c8318052?s=128&d=identicon&r=PG", "display_name": "user2357112 supports Monica", "link": "https://stackoverflow.com/users/2357112/user2357112-supports-monica"}, "edited": false, "score": 0, "creation_date": 1477677222, "post_id": 40309003, "comment_id": 67878414, "body": "@user2357112 Cores is 8 from <code>cores := MaxParallelism()</code> or do you think I did it wrong?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1477681249, "post_id": 40309003, "comment_id": 67880349, "body": "And what are your goroutines doing that you think they should use more than one CPU? It looks to me like they&#39;re executing external commands, which means the goroutines will run for microseconds at most, then do nothing waiting for the command to return. But you haven&#39;t shown us enough to really know for sure."}, {"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1477681849, "post_id": 40309003, "comment_id": 67880667, "body": "You are right, they have to execute 2 different external commands and write their result in a file. I did not share the code because I think I&#39;m doing something wrong on the piece of code I put above. I would just like to use my resources at 100%. Do you think that the fact that those external commands are Pretty slow lead to an underutilization of resources because goroutines are waiting for response?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1477688447, "post_id": 40309003, "comment_id": 67883408, "body": "@AndreaM16: running external commands and writing the output to a file takes almost no resources. You&#39;re program isn&#39;t going to use 100% of your CPUs, because it&#39;s not doing anything. If the external commands are doing the work, they are what will be using the CPU time."}, {"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1477727385, "post_id": 40309003, "comment_id": 67890749, "body": "I noticed that <code>CPU</code> and <code>Core</code> utilization grows when generating lots of tasks, so, basically, <code>Go</code> understands by its own when and how using them."}], "answers": [{"comments": [{"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 1, "creation_date": 1477683137, "post_id": 40312011, "comment_id": 67881228, "body": "Thank you for the answer. As I said I&#39;m Pretty new to Go in general and I don&#39;t know many things since I&#39;m using it from few days. So, basically, Hoe many goroutines should I instantiate with 4 cores and a solid I7? I would just like to use my resources at their maximum possibilities."}], "tags": [], "owner": {"reputation": 7915, "user_id": 494343, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/446b5d6d3a019f8219b5d8102c1d4bbc?s=128&d=identicon&r=PG", "display_name": "Schultz9999", "link": "https://stackoverflow.com/users/494343/schultz9999"}, "is_accepted": true, "score": 3, "last_activity_date": 1477689063, "last_edit_date": 1477689063, "creation_date": 1477682947, "answer_id": 40312011, "question_id": 40309003, "link": "https://stackoverflow.com/questions/40309003/goroutines-not-using-max-cpu-and-cores/40312011#40312011", "title": "Goroutines not Using Max CPU and Cores", "body": "<p>Goroutines and threads are not the same. Ergo you should not expect any CPU affinity. See more for details here <a href=\"http://tleyden.github.io/blog/2014/10/30/goroutines-vs-threads/\" rel=\"nofollow\">http://tleyden.github.io/blog/2014/10/30/goroutines-vs-threads/</a>.</p>\n\n<blockquote>\n  <p>Here are some of the advantages of Goroutines over threads:</p>\n  \n  <ul>\n  <li>You can run more goroutines on a typical system than you can threads.</li>\n  <li>Goroutines have growable segmented stacks. </li>\n  <li>Goroutines have a faster startup time than threads. </li>\n  <li>Goroutines come with built-in primitives to communicate safely between themselves (channels). </li>\n  <li>Goroutines allow you to avoid having to resort to mutex locking when sharing data structures. </li>\n  <li>Goroutines are multiplexed onto a small number of OS threads, rather than a 1:1 mapping. </li>\n  <li>You can write massively concurrent servers without having to resort to evented programming.</li>\n  </ul>\n</blockquote>\n\n<p>EDIT:\nAnswer to your question in the comments. There is no definitive answer. As others mentioned, it depends on what your code does. You may never end up using 100% CPU if you, for example, do I/O, which is slow. So no matter how many routines you start, I/O is slow. Contrarily, if your goroutine has a very tight loop doing just some computation then it's likely that 8 goroutines will consume your 8 CPUs completely.</p>\n"}, {"tags": [], "owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "is_accepted": false, "score": 2, "last_activity_date": 1477932024, "creation_date": 1477932024, "answer_id": 40346609, "question_id": 40309003, "link": "https://stackoverflow.com/questions/40309003/goroutines-not-using-max-cpu-and-cores/40346609#40346609", "title": "Goroutines not Using Max CPU and Cores", "body": "<p>After reading around, getting some hints and trying some stuff, it came out that the code was written just fine and there were not real problems caused by it.</p>\n\n<p>Essentially, <code>Go</code> scales pretty good and, the more <code>tasks</code> you generate, the more <code>CPU</code> resources are used.</p>\n\n<p>For instance, setting an higher range on the <code>for</code>, e.g. <code>1.000.000</code>, makes <code>Go</code> use all the <code>cores</code> available at <code>~55%</code> of their possibilities.</p>\n\n<p>I hope it will help someone.</p>\n"}], "owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2409, "favorite_count": 2, "accepted_answer_id": 40312011, "answer_count": 2, "score": 4, "last_activity_date": 1477932024, "creation_date": 1477670691, "last_edit_date": 1477673855, "question_id": 40309003, "link": "https://stackoverflow.com/questions/40309003/goroutines-not-using-max-cpu-and-cores", "title": "Goroutines not Using Max CPU and Cores", "body": "<p>I'm realizing my very first <code>Golang</code> application and I'm having some issues on using <code>MAX CPU &amp; Cores</code> when using <code>GoRoutines</code> and I don't really know why.</p>\n\n<p>When using a tool such as <code>htop</code>, <code>CPU</code> isn't used at its max power and only <code>1..4 threads</code> are active at time. Also, all <code>cores</code> are active but they are around <code>25%-40%</code> utilization.</p>\n\n<p>I used:</p>\n\n<pre><code>func MaxParallelism() int {\n    maxProcs := runtime.GOMAXPROCS(0)\n    numCPU := runtime.NumCPU()\n    if maxProcs &lt; numCPU {\n        return maxProcs\n    }\n    return numCPU\n}\n</code></pre>\n\n<p>In order to get the number of <code>goroutines</code> to be instantiated.</p>\n\n<p>Here's How I set up the application:</p>\n\n<pre><code>//Common Channel for the goroutines\ntasks := make(chan *exec.Cmd, 64)\n\n    //Spawning Max Cores Number goroutines (8)\n    var wg sync.WaitGroup\n    cores := MaxParallelism()\n    for i := 0; i &lt; cores; i++ {\n        wg.Add(1)\n        go func(num int, w *sync.WaitGroup) {\n            defer w.Done()\n            var (\n                out []byte\n                err error\n            )\n            for cmd := range tasks {\n                out, err = cmd.Output()\n                if err != nil {\n                    fmt.Printf(\"Can't get stdout:\", err)\n                }\n                . . .\n            }\n        }(i, &amp;wg)\n    }\n\n    //Generate Tasks\n    for i := 0; i &lt; 100000; i++ {\n      tasks &lt;- exec.Command(cmd1, args...)\n      tasks &lt;- exec.Command(cmd2, args...)\n    }\n\nclose(tasks)\n// wait for the workers to finish\nwg.Wait()\n</code></pre>\n\n<p>I share two screenshots of <code>htop</code> while executing the application</p>\n\n<p><a href=\"https://i.stack.imgur.com/CLu8A.png\" rel=\"nofollow\"><img src=\"https://i.stack.imgur.com/CLu8A.png\" alt=\"enter image description here\"></a>\n<a href=\"https://i.stack.imgur.com/XM2OJ.png\" rel=\"nofollow\"><img src=\"https://i.stack.imgur.com/XM2OJ.png\" alt=\"enter image description here\"></a></p>\n\n<p>I don't know If it May help but I'm launching it through <code>Intellij Idea</code>.</p>\n\n<p><strong>How do I use Max CPU properly and Cores?</strong></p>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3202, "user_id": 3358074, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vnKYD.png?s=128&g=1", "display_name": "dmitryro", "link": "https://stackoverflow.com/users/3358074/dmitryro"}, "edited": false, "score": 0, "creation_date": 1477669581, "post_id": 40308476, "comment_id": 67874593, "body": "You can use BitReader as in <a href=\"https://play.golang.org/p/Wyr_K9YAro\" rel=\"nofollow noreferrer\">play.golang.org/p/Wyr_K9YAro</a>"}], "answers": [{"comments": [{"owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "edited": false, "score": 0, "creation_date": 1477672612, "post_id": 40308819, "comment_id": 67876143, "body": "Very nice answer, educating instead of giving away the straight solution. Keep it up!"}], "tags": [], "owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "is_accepted": false, "score": 7, "last_activity_date": 1477694530, "last_edit_date": 1477694530, "creation_date": 1477670027, "answer_id": 40308819, "question_id": 40308476, "link": "https://stackoverflow.com/questions/40308476/how-do-i-get-the-bits-from-a-byte-in-golang/40308819#40308819", "title": "How do I get the bits from a byte in golang?", "body": "<p>fmt.Sprintf(\"%08b\", byte(1)) is great idea. It shows you, how the number is store internally. And example to compute hamming distance (very boring) could be:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc HamDist(n1,n2 uint8) uint8 {\n    var w uint8 = 0\n    if n1&amp;1 != n2&amp;1 {\n        w++\n    }\n    if n1&amp;2 != n2&amp;2 {\n        w++\n    }\n    if n1&amp;4 != n2&amp;4 {\n        w++\n    }\n    if n1&amp;8 != n2&amp;8 {\n        w++\n    }\n    if n1&amp;16 != n2&amp;16 {\n        w++\n    }\n    if n1&amp;32 != n2&amp;32 {\n        w++\n    }\n    if n1&amp;64 != n2&amp;64 {\n        w++\n    }\n    if n1&amp;128 != n2&amp;128 {\n        w++\n    }\n    return w\n}\n\nfunc main() {\n    fmt.Println(HamDist(255,0))\n}\n</code></pre>\n\n<p>And now tasks for you:</p>\n\n<ol>\n<li>rewrite the code using a loop</li>\n<li>extend program to compute hamming distance of 16-bit number</li>\n<li>please think what xor operator does and whether should not be possible compute HammingDistance easier, if you has defined a function that computes Hamming weight.</li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 19673, "user_id": 145435, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/824b41e6108a22c4c96f50ee23419369?s=128&d=identicon&r=PG", "display_name": "Matt", "link": "https://stackoverflow.com/users/145435/matt"}, "edited": false, "score": 0, "creation_date": 1501659230, "post_id": 40309527, "comment_id": 77869263, "body": "out of curiousity, do you know why <code>%b</code> alone only shows 6 bits?"}], "tags": [], "owner": {"reputation": 3365, "user_id": 4322228, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/388b0e91fd6bb09be4f12dc5a67a992a?s=128&d=identicon&r=PG&f=1", "display_name": "kskyriacou", "link": "https://stackoverflow.com/users/4322228/kskyriacou"}, "is_accepted": true, "score": 19, "last_activity_date": 1575438456, "last_edit_date": 1575438456, "creation_date": 1477672835, "answer_id": 40309527, "question_id": 40308476, "link": "https://stackoverflow.com/questions/40308476/how-do-i-get-the-bits-from-a-byte-in-golang/40309527#40309527", "title": "How do I get the bits from a byte in golang?", "body": "<p>You can see the visual representation of bits using <code>fmt.Sprintf(%08b, ..)</code> as others have already suggested.</p>\n\n<p>However, if you want to use the bits in operations, such as for calculating the Hamming distance, you'll need to use <a href=\"https://golang.org/ref/spec#Arithmetic_operators\" rel=\"noreferrer\">bitwise operators</a>.</p>\n\n<p>To calculate the nth bit of a byte, you'll need to <code>bitwise AND</code> that byte with another byte whose <em>nth</em> bit is set to 1 and the rest to 0 (aka masking). In other words, that other byte (mask) is the number <em>2^n-1</em>.</p>\n\n<p>For example, to find the 1st bit of the number 13 (00001101), we would have to mask it with 2^0 = 1 (00000001). We compare the output of performing bitwise AND on both numbers to the mask. If they are equal, it means that the nth bit is 1, otherwise it is 0. We continue like this and find all the bits. Illustrated in Go code:</p>\n\n<pre><code>fmt.Print(13 &amp; 1) // Output: 1 -&gt; 1\nfmt.Print(13 &amp; 2) // Output: 2 -&gt; 0\nfmt.Print(13 &amp; 4) // Output: 4 -&gt; 1\nfmt.Print(13 &amp; 8) // Output: 8 -&gt; 1\n// Not necessary to continue, but shown for the sake of the example\nfmt.Print(13 &amp; 16) // Output: 0 -&gt; 0\nfmt.Print(13 &amp; 32) // Output: 0 -&gt; 0\nfmt.Print(13 &amp; 64) // Output: 0 -&gt; 0\nfmt.Print(13 &amp; 128) // Output: 0 -&gt; 0\n</code></pre>\n\n<p>Therefore, 13 in binary is 00001101</p>\n\n<p>Here's a function I wrote recently for calculating the Hamming distance between two arrays of bytes. Just pass an array consisting of a single byte each in your case</p>\n\n<pre><code>func hamming(a, b []byte) (int, error) {\n    if len(a) != len(b) {\n        return 0, errors.New(\"a b are not the same length\")\n    }\n\n    diff := 0\n    for i := 0; i &lt; len(a); i++ {\n        b1 := a[i]\n        b2 := b[i]\n        for j := 0; j &lt; 8; j++ {\n            mask := byte(1 &lt;&lt; uint(j))\n            if (b1 &amp; mask) != (b2 &amp; mask) {\n                diff++\n            }\n        }\n    }\n    return diff, nil\n}\n</code></pre>\n\n<p>Go Playground: <a href=\"https://play.golang.org/p/O1EGdzDYAn\" rel=\"noreferrer\">https://play.golang.org/p/O1EGdzDYAn</a></p>\n"}, {"tags": [], "owner": {"reputation": 1685, "user_id": 996804, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/LsmKp.jpg?s=128&g=1", "display_name": "Bishal Paudel", "link": "https://stackoverflow.com/users/996804/bishal-paudel"}, "is_accepted": false, "score": 1, "last_activity_date": 1578166985, "creation_date": 1578166985, "answer_id": 59594215, "question_id": 40308476, "link": "https://stackoverflow.com/questions/40308476/how-do-i-get-the-bits-from-a-byte-in-golang/59594215#59594215", "title": "How do I get the bits from a byte in golang?", "body": "<p>You can simply do:</p>\n\n<pre><code>fmt.Printf(\"%08b\", YourNumber)\n</code></pre>\n\n<p>You can also use <code>%016b</code> or <code>%032b</code> or any other.</p>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 3997070, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97c629b0d9f19f3ca9236ee73e06d054?s=128&d=identicon&r=PG&f=1", "display_name": "cheng dong", "link": "https://stackoverflow.com/users/3997070/cheng-dong"}, "is_accepted": false, "score": 0, "last_activity_date": 1605390989, "last_edit_date": 1605390989, "creation_date": 1605339701, "answer_id": 64831854, "question_id": 40308476, "link": "https://stackoverflow.com/questions/40308476/how-do-i-get-the-bits-from-a-byte-in-golang/64831854#64831854", "title": "How do I get the bits from a byte in golang?", "body": "<pre><code>import &quot;math/bits&quot;\n\nbits.OnesCount8(byte(0) ^ byte(255))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 269, "user_id": 2105489, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2f2de1fca3cddc2162f295dcf528f431?s=128&d=identicon&r=PG", "display_name": "nullgraph", "link": "https://stackoverflow.com/users/2105489/nullgraph"}, "is_accepted": false, "score": 0, "last_activity_date": 1605844449, "creation_date": 1605844449, "answer_id": 64923561, "question_id": 40308476, "link": "https://stackoverflow.com/questions/40308476/how-do-i-get-the-bits-from-a-byte-in-golang/64923561#64923561", "title": "How do I get the bits from a byte in golang?", "body": "<p>There's been some great answers here, but another way to calculate the Hamming distance between two bytes is to XOR them and count the number of 1s (the weight). The easiest way to count the 1s that I know of is to get the last bit, by masking it with a 1, and then shift right.</p>\n<p>Here's a function I wrote in golang to calculate the Hamming distance between two strings.</p>\n<pre><code>func HammingDistance(s1, s2 string) (int, error) {\n    if len(s1) != len(s2) {\n        return 0, fmt.Errorf(&quot;Hamming distance of strings of different lengths %d and %d&quot;, len(s1), len(s2))\n    }\n    b1 := []byte(s1)\n    b2 := []byte(s2)\n    distance := 0\n    for i := range b1 {\n        xored := b1[i] ^ b2[i]\n        for j := 0; j &lt; 8; j++ {\n            distance += int(xored &amp; 1)\n            xored = xored &gt;&gt; 1\n        }\n    }\n    return distance, nil\n}\n</code></pre>\n<p>To calculate the Hamming distance of two bytes, you would only need the inner for loop.</p>\n"}], "owner": {"reputation": 5534, "user_id": 1484555, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/9ede0b6ed1e9d2f7037ff60242dd7561?s=128&d=identicon&r=PG", "display_name": "almel", "link": "https://stackoverflow.com/users/1484555/almel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17052, "favorite_count": 0, "accepted_answer_id": 40309527, "answer_count": 5, "score": 7, "last_activity_date": 1605844449, "creation_date": 1477668849, "last_edit_date": 1477669306, "question_id": 40308476, "link": "https://stackoverflow.com/questions/40308476/how-do-i-get-the-bits-from-a-byte-in-golang", "title": "How do I get the bits from a byte in golang?", "body": "<p>I'm trying to compute the Hamming distance between two byte's, such that</p>\n\n<p><code>HammingDist(byte(255), byte(0)) == 8</code> </p>\n\n<p>I need the bits in each byte, but I can't find any function in any of the built-in packages for doing so. So, given <code>byte(1)</code> how do I get the bit representation 00000001?</p>\n"}, {"tags": ["go", "xor"], "answers": [{"tags": [], "owner": {"reputation": 1519, "user_id": 956974, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/e4e92ede1b688d8487b0bb540e830d55?s=128&d=identicon&r=PG", "display_name": "Alexis", "link": "https://stackoverflow.com/users/956974/alexis"}, "is_accepted": false, "score": 1, "last_activity_date": 1477665268, "creation_date": 1477665268, "answer_id": 40307427, "question_id": 40307373, "link": "https://stackoverflow.com/questions/40307373/golang-carret-before-int-what-does-it-mean/40307427#40307427", "title": "Golang Carret before int what does it mean", "body": "<p>As a unary operator it means 'bitwise not'</p>\n"}, {"comments": [{"owner": {"reputation": 4428, "user_id": 967143, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/348299fd90e68b310fc75c3c96a6ad58?s=128&d=identicon&r=PG", "display_name": "Johny19", "link": "https://stackoverflow.com/users/967143/johny19"}, "edited": false, "score": 0, "creation_date": 1477666704, "post_id": 40307602, "comment_id": 67872815, "body": "Thank you! Alexis answered first but your is more complete"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1477665894, "creation_date": 1477665894, "answer_id": 40307602, "question_id": 40307373, "link": "https://stackoverflow.com/questions/40307373/golang-carret-before-int-what-does-it-mean/40307602#40307602", "title": "Golang Carret before int what does it mean", "body": "<p>From the <a href=\"https://golang.org/ref/spec#Arithmetic_operators\" rel=\"nofollow\">\"Arithmetic Operators\"</a> section of the language specification:</p>\n\n<blockquote>\n  <p>For integer operands, the unary operators +, -, and ^ are defined as\n  follows:</p>\n\n<pre><code>+x                          is 0 + x\n-x    negation              is 0 - x\n^x    bitwise complement    is m ^ x  with m = \"all bits set to 1\" for unsigned x\n                                      and  m = -1 for signed x\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 4428, "user_id": 967143, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/348299fd90e68b310fc75c3c96a6ad58?s=128&d=identicon&r=PG", "display_name": "Johny19", "link": "https://stackoverflow.com/users/967143/johny19"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 40307602, "answer_count": 2, "score": 0, "last_activity_date": 1477665894, "creation_date": 1477665095, "question_id": 40307373, "link": "https://stackoverflow.com/questions/40307373/golang-carret-before-int-what-does-it-mean", "title": "Golang Carret before int what does it mean", "body": "<p>I'm aware the carret symbol ^ means bitwise XOR\nbut I'm looking at a pice of go code and I see things like</p>\n\n<pre><code>input[0] = ^output[3]\nor\ninput[3] = input[3] &amp;^ (input[3] &amp;^ input[3])\n</code></pre>\n\n<p>when I try for example:</p>\n\n<pre><code>^1 gives -2\n^2 gives -3\netc..\n</code></pre>\n"}, {"tags": ["go", "types", "uml", "entity-relationship"], "comments": [{"owner": {"reputation": 30989, "user_id": 3379653, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/f97JZ.png?s=128&g=1", "display_name": "qwerty_so", "link": "https://stackoverflow.com/users/3379653/qwerty-so"}, "edited": false, "score": 2, "creation_date": 1477666693, "post_id": 40307163, "comment_id": 67872806, "body": "If you were just asking how to show type struct of Golang in UML you might get an answer. But &quot;asking for tool to...&quot; is OT."}, {"owner": {"reputation": 16400, "user_id": 350542, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/024d1da9fad214ca44af8fcc649ebb86?s=128&d=identicon&r=PG", "display_name": "jayunit100", "link": "https://stackoverflow.com/users/350542/jayunit100"}, "reply_to_user": {"reputation": 30989, "user_id": 3379653, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/f97JZ.png?s=128&g=1", "display_name": "qwerty_so", "link": "https://stackoverflow.com/users/3379653/qwerty-so"}, "edited": false, "score": 0, "creation_date": 1478741053, "post_id": 40307163, "comment_id": 68278901, "body": "why is a tool for analyzing type dependencies off topic?"}, {"owner": {"reputation": 16400, "user_id": 350542, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/024d1da9fad214ca44af8fcc649ebb86?s=128&d=identicon&r=PG", "display_name": "jayunit100", "link": "https://stackoverflow.com/users/350542/jayunit100"}, "reply_to_user": {"reputation": 30989, "user_id": 3379653, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/f97JZ.png?s=128&g=1", "display_name": "qwerty_so", "link": "https://stackoverflow.com/users/3379653/qwerty-so"}, "edited": false, "score": 0, "creation_date": 1478741157, "post_id": 40307163, "comment_id": 68278923, "body": "There are several other questions which ask about visualization technology for code bases, w/ up votes.  I would say it would set an odd precedent to close questions about developer tooling: <a href=\"http://stackoverflow.com/questions/4886836/what-debuggervisualizers-are-already-existing-within-visualstudio-or-net-framew/4886864#4886864\" title=\"what debuggervisualizers are already existing within visualstudio or net framew\">stackoverflow.com/questions/4886836/&hellip;</a>  <a href=\"http://stackoverflow.com/questions/5540467/visualize-type-arguments-of-generic-inheritance-in-class-designer-in-vs-2010\" title=\"visualize type arguments of generic inheritance in class designer in vs 2010\">stackoverflow.com/questions/5540467/&hellip;</a>"}, {"owner": {"reputation": 30989, "user_id": 3379653, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/f97JZ.png?s=128&g=1", "display_name": "qwerty_so", "link": "https://stackoverflow.com/users/3379653/qwerty-so"}, "edited": false, "score": 0, "creation_date": 1478759264, "post_id": 40307163, "comment_id": 68283200, "body": "<a href=\"http://stackoverflow.com/help/on-topic\">stackoverflow.com/help/on-topic</a> 4. list topic"}, {"owner": {"reputation": 16400, "user_id": 350542, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/024d1da9fad214ca44af8fcc649ebb86?s=128&d=identicon&r=PG", "display_name": "jayunit100", "link": "https://stackoverflow.com/users/350542/jayunit100"}, "reply_to_user": {"reputation": 30989, "user_id": 3379653, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/f97JZ.png?s=128&g=1", "display_name": "qwerty_so", "link": "https://stackoverflow.com/users/3379653/qwerty-so"}, "edited": false, "score": 0, "creation_date": 1478787968, "post_id": 40307163, "comment_id": 68299870, "body": "Ok, I see, this is in the &quot;find or recommend a software library&quot; category."}, {"owner": {"reputation": 30989, "user_id": 3379653, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/f97JZ.png?s=128&g=1", "display_name": "qwerty_so", "link": "https://stackoverflow.com/users/3379653/qwerty-so"}, "edited": false, "score": 0, "creation_date": 1478809443, "post_id": 40307163, "comment_id": 68312237, "body": "Yes. Most people get struck by that one day :-) But I guess if you omit that last part of your question it will still fall in the category of &quot;too broad&quot; or &quot;opinion based&quot;. I don&#39;t have any golang background (just googled a bit), but would guess that those type graphs can&#39;t be wizardry."}], "owner": {"reputation": 16400, "user_id": 350542, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/024d1da9fad214ca44af8fcc649ebb86?s=128&d=identicon&r=PG", "display_name": "jayunit100", "link": "https://stackoverflow.com/users/350542/jayunit100"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 800, "favorite_count": 2, "answer_count": 0, "score": 3, "last_activity_date": 1558980017, "creation_date": 1477664483, "question_id": 40307163, "link": "https://stackoverflow.com/questions/40307163/visualizing-type-dependencies-in-golang", "title": "Visualizing type dependencies in golang", "body": "<p>How can I visualize how types depend on one another in a complex golang app ?  Is there a way I can generate a UML/ER dependency diagram ?</p>\n\n<p>There are some well known ways to generate call graphs, but I haven't seen a way to generate \"Type\" graphs.</p>\n\n<p><em>detail</em></p>\n\n<p>I'm actually looking at a swagger based REST Api definition, so, if there are ways to use swagger to generate type data, that also might be valuable.</p>\n"}, {"tags": ["go", "tar", "glow"], "answers": [{"comments": [{"owner": {"reputation": 249, "user_id": 1862366, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/J0hu2.jpg?s=128&g=1", "display_name": "PiKaY", "link": "https://stackoverflow.com/users/1862366/pikay"}, "edited": false, "score": 0, "creation_date": 1477666274, "post_id": 40307401, "comment_id": 67872531, "body": "Thanks @JimB but I want to append all the tar_readers to a single multireader. Is that possible?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 249, "user_id": 1862366, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/J0hu2.jpg?s=128&g=1", "display_name": "PiKaY", "link": "https://stackoverflow.com/users/1862366/pikay"}, "edited": false, "score": 0, "creation_date": 1477666506, "post_id": 40307401, "comment_id": 67872679, "body": "@PiKaY: no, because there is only one tar.Reader. To use a MultiReader you would have to copy every file to individual buffers to make separate io.Readers. This is doing exactly what you want, but without the extra copy."}, {"owner": {"reputation": 249, "user_id": 1862366, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/J0hu2.jpg?s=128&g=1", "display_name": "PiKaY", "link": "https://stackoverflow.com/users/1862366/pikay"}, "edited": false, "score": 0, "creation_date": 1477666970, "post_id": 40307401, "comment_id": 67872972, "body": "Thank You @JimB There was a little constraint due to the organization of my current code. I guess I could fit this :) . Thank You for the answer"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1477665197, "creation_date": 1477665197, "answer_id": 40307401, "question_id": 40307143, "link": "https://stackoverflow.com/questions/40307143/copying-extracted-tar-gz-to-a-single-file/40307401#40307401", "title": "Copying extracted tar.gz to a single file", "body": "<p>You're appending the same <code>tar.Reader</code> over and over to the <code>files</code> slice. You have to read the file from the archive after you read the header. Just copy the files at that point. You probably should check for regular files too, vs directories, symlinks, etc.</p>\n\n<pre><code>copied := 0\nfor {\n    header, err := tar_reader.Next()\n    if err == io.EOF {\n        break\n    } else if err != nil {\n        log.Fatalf(\"Cannot read file inside tarball %v\", err)\n    }\n\n    if !(header.Typeflag == tar.TypeReg || header.Typeflag == tar.TypeRegA) {\n        continue\n    }\n\n\n    n, err = io.Copy(writer, tar_reader)\n    if err != nil {\n        log.Fatalf(\"Cannot write unarchived file %v\", err)\n    }\n    copied += n\n}\nreturn copied, nil\n</code></pre>\n"}], "owner": {"reputation": 249, "user_id": 1862366, "user_type": "registered", "accept_rate": 31, "profile_image": "https://i.stack.imgur.com/J0hu2.jpg?s=128&g=1", "display_name": "PiKaY", "link": "https://stackoverflow.com/users/1862366/pikay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 40307401, "answer_count": 1, "score": 1, "last_activity_date": 1477665197, "creation_date": 1477664387, "question_id": 40307143, "link": "https://stackoverflow.com/questions/40307143/copying-extracted-tar-gz-to-a-single-file", "title": "Copying extracted tar.gz to a single file", "body": "<p>I am trying to copy the extracted content of a tar.gz to a single file in go lang. I will have only text inside the files.</p>\n\n<p>The following is my current code.</p>\n\n<pre><code>f, err := os.Open(fullpath)\nif err != nil {\n    log.Panicf(\"Can not open file %s: %v\", fullpath, err)\n    return \"\"\n}\ndefer f.Close()\nreader, err := gzip.NewReader(f)\nif err != nil{\n    log.Panicf(\"Cannot read gzip archive %v\", err);\n    return \"\"\n}\ndefer reader.Close()\ntar_reader := tar.NewReader(reader)\nvar files []io.Reader\nfor{\n    header, err := tar_reader.Next()\n    if err == io.EOF {\n        break\n    } else if err != nil {\n        log.Panicf(\"Cannot read file inside tarball %v\", err);\n        return 0, err\n    } else {\n        log.Println(\"Parsing file : \", header.Name)\n        files = append(files, tar_reader)\n    }\n}\nreader = io.MultiReader(files...)\nwriter, err := os.Create(target)\nif err != nil {\n    log.Panicf(\"Cannot write unarchived file %v\", err);\n    return 0, err\n}\ndefer writer.Close()\n\nresult,err := io.Copy(writer, reader)\nif(err != nil) {\n    log.Panicf(\"Cannot write unarchived file %v\", err);\n}\nreturn result,err\n</code></pre>\n\n<p>While I am not getting any error with the above code, the files are just not read. The output has no data. Please point me on where I am going wrong.</p>\n"}, {"tags": ["string", "file", "go"], "answers": [{"comments": [{"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1477661587, "post_id": 40305897, "comment_id": 67869517, "body": "How should I do that kind of check?"}, {"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1477662070, "post_id": 40305897, "comment_id": 67869855, "body": "Nevermind, it works properly, just need to print <code>current line</code>."}, {"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1477662405, "post_id": 40305897, "comment_id": 67870084, "body": "Just a last thing, How am I supposed to print the current duplicate field in a way that I have <code>currLine, duplicateLIne</code>, like: <code>000000 ABABABABABABABAB, 010101 ABABABABABABABAB</code>?"}, {"owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "reply_to_user": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1477667091, "post_id": 40305897, "comment_id": 67873040, "body": "Instead of store only the string you can create a struct with the current line and then return the struct when match inside the func contains. Or if you want return all the match inside the array create a temp array in contains, append all the matches and then return the temp array. Hope this can help  you"}], "tags": [], "owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "is_accepted": true, "score": 1, "last_activity_date": 1477667714, "last_edit_date": 1477667714, "creation_date": 1477660450, "answer_id": 40305897, "question_id": 40305433, "link": "https://stackoverflow.com/questions/40305433/for-each-word-in-a-file-find-if-current-word-is-present-more-than-once/40305897#40305897", "title": "For each Word in a File, Find If current Word is Present More than Once", "body": "<p>The first issue is caused because you are using the same stream to read the file and check duplicate so when the inner for reach the bottom of the file finish, then the outer for check if there is something more to scan but it find the EOF and exit.<br>\nThe easiest way to solve your problem is creating an array where you put all the text that you find for the first time and when the text value are already present just print the duplicate. Something like this:  </p>\n\n<pre><code>duplicates := make([]string,0)\nfor scanner.Scan() {\n    line := scanner.Text()\n    text := line[6:]\n    //Do your check\n    //if all your control are ok\n    if ! contains(duplicates, text) {\n        duplicates = append(duplicates, text)\n    } else {\n        //Print the duplicates\n    }\n</code></pre>\n\n<p>And here there is the <code>contains</code> implementation</p>\n\n<pre><code>func contains(s []string, e string) bool {\n    for _, a := range s {\n        if a == e {\n            return true\n        }\n    }\n    return false\n}\n</code></pre>\n"}], "owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 40305897, "answer_count": 1, "score": 1, "last_activity_date": 1477667714, "creation_date": 1477658772, "last_edit_date": 1477659039, "question_id": 40305433, "link": "https://stackoverflow.com/questions/40305433/for-each-word-in-a-file-find-if-current-word-is-present-more-than-once", "title": "For each Word in a File, Find If current Word is Present More than Once", "body": "<p>I'm very new to <code>Golang</code> and I'm having some issues on trying to <code>find</code> and <code>print</code> all the lines in a file which contain a certain same <code>value</code>.</p>\n\n<p>My file is structured like the following:</p>\n\n<pre><code>index text\nindex text\n     .\n     .\n     .\nindex text\n</code></pre>\n\n<p>Where <code>index</code> is ALWAYS <code>6 digits long</code> and <code>text</code> is ALWAYS <code>16 digits long</code>.</p>\n\n<blockquote>\n  <p>I need to <code>find</code> and <code>print</code> all the lines which contain the same <code>text</code> value.</p>\n</blockquote>\n\n<p>That's what I tried so far:</p>\n\n<pre><code>func main() {\n\n    //Array to contain common texts\n    found := make([]string, 6)\n\n    r, _ := os.Open(\"store.txt\")\n    scanner := bufio.NewScanner(r)\n    //Splits in words\n    scanner.Split(bufio.ScanWords)\n    //Loop over all Words in the file\n    for scanner.Scan() {\n        line := scanner.Text()\n        //If the current line is 16 digits long\n        if(utf8.RuneCountInString(line) == 16){\n           currLine := line\n            //Search in the same files all the 16 digits long texts and\n            for scanner.Scan(){\n                searchLine := scanner.Text()\n                //If a same text is found\n                if(utf8.RuneCountInString(searchLine) == 16){\n                    //Append it to found array\n                    if(currLine == searchLine){\n                        found = append(found, currLine)\n                    }\n                }\n            }\n        }\n    }\n    //Print found Array\n    fmt.Println(found)\n    //Close File\n    r.Close()\n}\n</code></pre>\n\n<p>Then, I would like to use <code>found</code> to <code>print</code> all the <code>lines</code> which match the current <code>found[i-element]</code>.</p>\n\n<p>The code above works only for the very first step.\nFor instance, If in my file, at the very first line it gets <code>1234567890123456</code> (e.g. from index 1) then it checks and appends only one time, it does not loop for all the lines (for the remaining n-1 words).</p>\n\n<ul>\n<li><p><strong>How can I fix the first issue?</strong></p></li>\n<li><p><strong>Do you think adding the duplicate <code>texts</code> in an <code>Array</code> and then print the matching lines based on it is a bad idea?</strong></p></li>\n</ul>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1072, "user_id": 401499, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/84bf781c7191b1cddf264cd3ef5d2e49?s=128&d=identicon&r=PG", "display_name": "Tomasz Kap\u0142o\u0144ski", "link": "https://stackoverflow.com/users/401499/tomasz-kap%c5%82o%c5%84ski"}, "edited": false, "score": 0, "creation_date": 1477657866, "post_id": 40305117, "comment_id": 67867268, "body": "Oh, sorry. The problem I have is with <code>II</code> - I pasted with bitwise OR only by accident because I was trying to find out what&#39;s going on."}, {"owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "edited": false, "score": 2, "creation_date": 1477657962, "post_id": 40305117, "comment_id": 67867327, "body": "How is defined i?"}], "answers": [{"comments": [{"owner": {"reputation": 1072, "user_id": 401499, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/84bf781c7191b1cddf264cd3ef5d2e49?s=128&d=identicon&r=PG", "display_name": "Tomasz Kap\u0142o\u0144ski", "link": "https://stackoverflow.com/users/401499/tomasz-kap%c5%82o%c5%84ski"}, "edited": false, "score": 0, "creation_date": 1477657884, "post_id": 40305175, "comment_id": 67867281, "body": "Oh, sorry. The problem I have is with <code>II</code> - I pasted with bitwise OR only by accident because I was trying to find out what&#39;s going on. \u2013"}], "tags": [], "owner": {"reputation": 3334, "user_id": 4473327, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hP14q.jpg?s=128&g=1", "display_name": "neuhaus", "link": "https://stackoverflow.com/users/4473327/neuhaus"}, "is_accepted": false, "score": 0, "last_activity_date": 1477658473, "last_edit_date": 1477658473, "creation_date": 1477657859, "answer_id": 40305175, "question_id": 40305117, "link": "https://stackoverflow.com/questions/40305117/ii-operator-in-if-condition-works-strange/40305175#40305175", "title": "II operator in if condition works strange", "body": "<p>Use <code>||</code> instead of <code>|</code> in the if statement. </p>\n\n<p><code>||</code>\nis \"logical or\" which is what you want.</p>\n\n<p>Once you have fixed that issue, also change the \"i\" variable to \"j\" because that's what you want to compare against.</p>\n"}, {"comments": [{"owner": {"reputation": 1072, "user_id": 401499, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/84bf781c7191b1cddf264cd3ef5d2e49?s=128&d=identicon&r=PG", "display_name": "Tomasz Kap\u0142o\u0144ski", "link": "https://stackoverflow.com/users/401499/tomasz-kap%c5%82o%c5%84ski"}, "edited": false, "score": 0, "creation_date": 1477658301, "post_id": 40305272, "comment_id": 67867544, "body": "Jesus... you can imagine that <code>i</code> is in outer loop and it was just a typo... :)"}, {"owner": {"reputation": 3334, "user_id": 4473327, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hP14q.jpg?s=128&g=1", "display_name": "neuhaus", "link": "https://stackoverflow.com/users/4473327/neuhaus"}, "edited": false, "score": 0, "creation_date": 1477658391, "post_id": 40305272, "comment_id": 67867602, "body": "So your issue is solved?"}], "tags": [], "owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "is_accepted": false, "score": 1, "last_activity_date": 1477658203, "creation_date": 1477658203, "answer_id": 40305272, "question_id": 40305117, "link": "https://stackoverflow.com/questions/40305117/ii-operator-in-if-condition-works-strange/40305272#40305272", "title": "II operator in if condition works strange", "body": "<p>I don't how know how is defined the <code>i</code> variable but change it to j it works as expected, take a look on this <a href=\"https://play.golang.org/p/5rnq88S2X6\" rel=\"nofollow\">go playground example</a></p>\n"}], "owner": {"reputation": 1072, "user_id": 401499, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/84bf781c7191b1cddf264cd3ef5d2e49?s=128&d=identicon&r=PG", "display_name": "Tomasz Kap\u0142o\u0144ski", "link": "https://stackoverflow.com/users/401499/tomasz-kap%c5%82o%c5%84ski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "closed_date": 1477660450, "answer_count": 2, "score": 0, "last_activity_date": 1477658473, "creation_date": 1477657673, "last_edit_date": 1477657810, "question_id": 40305117, "link": "https://stackoverflow.com/questions/40305117/ii-operator-in-if-condition-works-strange", "closed_reason": "Not suitable for this site", "title": "II operator in if condition works strange", "body": "<p>I'm totally new in terms of go and for practice I decided to write a few simple apps. Quite fast I got into weird problem:</p>\n\n<pre><code>sum := 0\nfor j:= 0; j&lt;10; j++ {\n   if (j%5 == 0) || (i%3 == 0) {\n      fmt.Println(j)\n      sum += j\n   }\n}\n</code></pre>\n\n<p>Obviously I want to sum up all the numbers divisible by 5 or by 3 lower than 10. But when I run it I get:</p>\n\n<pre><code>0\n1\n2\n3\n4\n5\n6\n7\n8\n9\n45\n</code></pre>\n\n<p>The weird part is it works fine if I check for divisibility only by 3 or only by 5...</p>\n"}, {"tags": ["go", "routes", "http-status-code-404", "beego"], "comments": [{"owner": {"reputation": 459, "user_id": 307826, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YiVIy.jpg?s=128&g=1", "display_name": "Stef K", "link": "https://stackoverflow.com/users/307826/stef-k"}, "edited": false, "score": 0, "creation_date": 1478429618, "post_id": 40304050, "comment_id": 68142750, "body": "try to delete <code>commentsRouter_controllers.go</code> beego will rebuild it which may be the solution to your problem."}, {"owner": {"reputation": 1948, "user_id": 1924657, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/gumlg.jpg?s=128&g=1", "display_name": "Bryce", "link": "https://stackoverflow.com/users/1924657/bryce"}, "edited": false, "score": 0, "creation_date": 1486542099, "post_id": 40304050, "comment_id": 71384830, "body": "Try beego admin router <code>&#47;listconf?command=router</code> to check if the router init success."}], "owner": {"reputation": 666, "user_id": 1819852, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/da91c0f9296f7029e059362ea5809af6?s=128&d=identicon&r=PG", "display_name": "souravlahoti", "link": "https://stackoverflow.com/users/1819852/souravlahoti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1668, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1477653889, "creation_date": 1477653889, "question_id": 40304050, "link": "https://stackoverflow.com/questions/40304050/beego-router-nomatch-404", "title": "Beego Router Nomatch - 404", "body": "<p>My project was created using bee api appname [ bee api xxabc ] and everything was running fine. Due to some reason had to rename the project to xx-def and changing all the imports to the new renamed package \"github.com/username/xx-def/controllers\" etc.</p>\n\n<p>But now on running the project using bee run the build is successful but it shows mismatch GET /api 404 on hitting the route</p>\n\n<p>I had deleted all the previous packages and pkg and bin folder and go get everything but did not resolve the issue.</p>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n\n    \"github.com/astaxie/beego\"\n    \"github.com/babajob/xx-def/services\"\n)\n\nfunc main() {\n    BEEGO_RUNMODE := os.Getenv(\"BEEGO_RUNMODE\")\n    if BEEGO_RUNMODE == \"dev\" {\n        beego.BConfig.WebConfig.DirectoryIndex = true\n        beego.BConfig.WebConfig.StaticDir[\"/swagger\"] = \"swagger\"\n        beego.BConfig.RouterCaseSensitive = true\n    } else {\n        beego.BConfig.WebConfig.DirectoryIndex = true\n        beego.BConfig.RouterCaseSensitive = true\n        authPlugin := services.NewBasicAuthenticator(services.SecretAuth, \"Authorization Required\")\n        beego.InsertFilter(\"*\", beego.BeforeRouter, authPlugin)\n    }\n\n    beego.Run()\n}\n</code></pre>\n\n<p>router.go</p>\n\n<pre><code>package routers\n\nimport (\n    \"github.com/astaxie/beego\"\n    \"github.com/babajob/xx-def/controllers\"\n)\n\nfunc init() {\n    beego.Router(\"/api\", &amp;controllers.XYZController{}, \"get:Api\")\n}\n</code></pre>\n\n<p>XYZController.go</p>\n\n<pre><code>package controllers\n\nimport (\n    \"strconv\"\n\n    \"github.com/astaxie/beego\"\n    \"github.com/astaxie/beego/logs\"\n    \"github.com/babajob/xx-def/models\"\n    \"github.com/babajob/xx-def/repository\"\n    \"github.com/babajob/xx-def/services\"\n\n    \"github.com/gorilla/feeds\"\n)\n\ntype XYZController struct {\n    beego.Controller\n}\n\nfunc (x *XYZController) Api() {\n    //do something db related\n    x.Data[\"json\"] = \"hello\"\n    x.ServeJSON()\n}\n</code></pre>\n\n<p>There is a commentsRouter_controllers.go file which I think Swagger uses it even I updated it but no use</p>\n"}, {"tags": ["performance", "caching", "go"], "comments": [{"owner": {"reputation": 7915, "user_id": 494343, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/446b5d6d3a019f8219b5d8102c1d4bbc?s=128&d=identicon&r=PG", "display_name": "Schultz9999", "link": "https://stackoverflow.com/users/494343/schultz9999"}, "edited": false, "score": 0, "creation_date": 1477692227, "post_id": 40302270, "comment_id": 67884779, "body": "I can&#39;t say I understand the question. Do you want to use map as the  key and something else as a value?"}, {"owner": {"reputation": 3680, "user_id": 1813875, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6078165a3f6a8693a0b1a1101e9260c7?s=128&d=identicon&r=PG", "display_name": "harryz", "link": "https://stackoverflow.com/users/1813875/harryz"}, "reply_to_user": {"reputation": 7915, "user_id": 494343, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/446b5d6d3a019f8219b5d8102c1d4bbc?s=128&d=identicon&r=PG", "display_name": "Schultz9999", "link": "https://stackoverflow.com/users/494343/schultz9999"}, "edited": false, "score": 0, "creation_date": 1477730996, "post_id": 40302270, "comment_id": 67891392, "body": "@Schultz9999 I want to store a map in cache"}], "answers": [{"comments": [{"owner": {"reputation": 3680, "user_id": 1813875, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6078165a3f6a8693a0b1a1101e9260c7?s=128&d=identicon&r=PG", "display_name": "harryz", "link": "https://stackoverflow.com/users/1813875/harryz"}, "edited": false, "score": 0, "creation_date": 1479112670, "post_id": 40433737, "comment_id": 68404477, "body": "My data is like <code>type PredicateMap map[uint64]HostPredicate</code>, but it can <b>not</b> be override, thus makes storing a <code>*map</code> not work."}, {"owner": {"reputation": 3680, "user_id": 1813875, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6078165a3f6a8693a0b1a1101e9260c7?s=128&d=identicon&r=PG", "display_name": "harryz", "link": "https://stackoverflow.com/users/1813875/harryz"}, "edited": false, "score": 0, "creation_date": 1480571430, "post_id": 40433737, "comment_id": 69020089, "body": "Accepted as answer. Eventually, I found that storing a index saves me a lot time."}], "tags": [], "owner": {"reputation": 7915, "user_id": 494343, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/446b5d6d3a019f8219b5d8102c1d4bbc?s=128&d=identicon&r=PG", "display_name": "Schultz9999", "link": "https://stackoverflow.com/users/494343/schultz9999"}, "is_accepted": true, "score": 0, "last_activity_date": 1478307333, "creation_date": 1478307333, "answer_id": 40433737, "question_id": 40302270, "link": "https://stackoverflow.com/questions/40302270/golang-right-way-to-store-map-structure-in-lru-cache/40433737#40433737", "title": "Golang: right way to store map structure in lru cache", "body": "<p>The code above will work. I looked at the source of LRU cache you refer to. Here are my notes:</p>\n\n<ul>\n<li>whatever you decide, make sure access to this LRU is thread-safe if you plan to use it within goroutines.</li>\n<li>you may store <code>*map</code> instead of plain <code>map</code>, which would eliminate a need to call add.</li>\n<li>if it's ok to add to the map with override, skip presence check (<code>if v, ok...</code>)</li>\n</ul>\n\n<p>So having said that, here is what it becomes:</p>\n\n<pre><code>m sync.Mutex\nm.Lock()\ndefer m.Unlock()\ncache.Get(cacheKey)[key] = new_value\n</code></pre>\n\n<p>If you elaborate on what sort of data you are planning to store, we may try to come up with an alternative solution.</p>\n"}], "owner": {"reputation": 3680, "user_id": 1813875, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6078165a3f6a8693a0b1a1101e9260c7?s=128&d=identicon&r=PG", "display_name": "harryz", "link": "https://stackoverflow.com/users/1813875/harryz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1475, "favorite_count": 0, "accepted_answer_id": 40433737, "answer_count": 1, "score": 0, "last_activity_date": 1478307333, "creation_date": 1477647452, "question_id": 40302270, "link": "https://stackoverflow.com/questions/40302270/golang-right-way-to-store-map-structure-in-lru-cache", "title": "Golang: right way to store map structure in lru cache", "body": "<p>I have a structure like: <code>map[key]value</code>, and I want to store it in <code>\"github.com/golang/groupcache/lru\"</code> by a string key, say, the <code>cacheKey</code>.</p>\n\n<p>Here is my question:</p>\n\n<p>I found whenever I want update the cached item, I need to <code>Get</code> it first:</p>\n\n<pre><code>item := cache.Get(cacheKey)\nif v, ok := item[key]; ok{\n    item[key]=new_value\n    cache.Add(cacheKey, item)\n}\n</code></pre>\n\n<p>Is it right way to do this?</p>\n\n<p>Or, as some of people suggested, I need to re-design my structure to make sure I can do <code>cache.Add(cacheKey, item)</code> whenever I want to update it.</p>\n\n<p>Or, I should even use a combined key like <code>cacheKey_key</code> to store that item?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1477647104, "post_id": 40301385, "comment_id": 67861550, "body": "What &quot;lastly stored documents&quot; does mean, ie how long do you keep an document in cache (IOW consider it &quot;lastly stored&quot;)?"}, {"owner": {"reputation": 21, "user_id": 7084431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/213efc87b6a66cacddb2e71cea5c5437?s=128&d=identicon&r=PG&f=1", "display_name": "StuGG", "link": "https://stackoverflow.com/users/7084431/stugg"}, "reply_to_user": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1477651754, "post_id": 40301385, "comment_id": 67863972, "body": "With &quot;lastly stored&quot; I mean the last, say 200, items uploaded by the users. (I know that, with heavy traffic, that is not very useful. But part of the problem is giving the user a random item back. Additionally the problem in the question is something I want to solve to better understand how to use go)"}, {"owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "edited": false, "score": 0, "creation_date": 1477652341, "post_id": 40301385, "comment_id": 67864302, "body": "COrrect me if I&#39;m wrong but you are trying to create a sharded hashtable to prevent locking all the hashtable when you set a value by set I mean create/update/delete) but at the same time you don&#39;t want add a master lock when you try to create a new sharded hashtable when it doesn&#39;t exist?"}, {"owner": {"reputation": 21, "user_id": 7084431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/213efc87b6a66cacddb2e71cea5c5437?s=128&d=identicon&r=PG&f=1", "display_name": "StuGG", "link": "https://stackoverflow.com/users/7084431/stugg"}, "edited": false, "score": 0, "creation_date": 1477653591, "post_id": 40301385, "comment_id": 67864959, "body": "Or put another way: Having X shards, how do I distribute the handlers spawned by net/http.ListenAndServe evenly to them. Is there some kind of per handler ID I can use? (I hope I use the word shard correctly)."}, {"owner": {"reputation": 21, "user_id": 7084431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/213efc87b6a66cacddb2e71cea5c5437?s=128&d=identicon&r=PG&f=1", "display_name": "StuGG", "link": "https://stackoverflow.com/users/7084431/stugg"}, "edited": false, "score": 0, "creation_date": 1477654252, "post_id": 40301385, "comment_id": 67865283, "body": "Or put another way, I want web handlers that work in parallel but can access global data (that is synchronized only from time to time). But possibly without using a master lock that all handlers have to acquire at start. The problem is that the handlers are short lived goroutines that are started somewhere in net/http and I don&#39;t know how to do the synchronization/distribution without said lock."}, {"owner": {"reputation": 21, "user_id": 7084431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/213efc87b6a66cacddb2e71cea5c5437?s=128&d=identicon&r=PG&f=1", "display_name": "StuGG", "link": "https://stackoverflow.com/users/7084431/stugg"}, "edited": false, "score": 0, "creation_date": 1477654474, "post_id": 40301385, "comment_id": 67865391, "body": "I read up on sharded hash tables. I think they are different from what I want to implement. Some clients are adding items. And some clients want to get random or the last X items. The retrieving client obviously don&#39;t know the contents/key of the items. So I don&#39;t think I can use a hash table for that."}, {"owner": {"reputation": 21, "user_id": 7084431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/213efc87b6a66cacddb2e71cea5c5437?s=128&d=identicon&r=PG&f=1", "display_name": "StuGG", "link": "https://stackoverflow.com/users/7084431/stugg"}, "edited": false, "score": 0, "creation_date": 1477655441, "post_id": 40301385, "comment_id": 67865879, "body": "I found this: <a href=\"https://golang.org/pkg/sync/atomic/#AddInt32\" rel=\"nofollow noreferrer\">golang.org/pkg/sync/atomic/#AddInt32</a> , that could be used to create a new value per handler. It would still be a central value shared between different goroutines. But it probably is really fast?"}], "answers": [{"tags": [], "owner": {"reputation": 1529, "user_id": 2604529, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6SJdc.jpg?s=128&g=1", "display_name": "Marcel Novy", "link": "https://stackoverflow.com/users/2604529/marcel-novy"}, "is_accepted": false, "score": 1, "last_activity_date": 1477662372, "creation_date": 1477662372, "answer_id": 40306452, "question_id": 40301385, "link": "https://stackoverflow.com/questions/40301385/golang-web-server-and-concurrent-approach-for-an-in-memory-cache/40306452#40306452", "title": "Golang web-server and concurrent approach for an in memory cache", "body": "<p>You don't really serialize your server with <strong>RWLock</strong>. Use <code>RLock()</code> for parallel read of documents. </p>\n\n<p>Check on <a href=\"https://github.com/orcaman/concurrent-map\" rel=\"nofollow\">thread-safe concurrent map for go</a> library. It utilizes mutex and sharding technics alongside. I would also added CQRS to database level and It could easily handle 100K concurrent requests/sec. </p>\n"}], "owner": {"reputation": 21, "user_id": 7084431, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/213efc87b6a66cacddb2e71cea5c5437?s=128&d=identicon&r=PG&f=1", "display_name": "StuGG", "link": "https://stackoverflow.com/users/7084431/stugg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 588, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1477662372, "creation_date": 1477644606, "last_edit_date": 1477653339, "question_id": 40301385, "link": "https://stackoverflow.com/questions/40301385/golang-web-server-and-concurrent-approach-for-an-in-memory-cache", "title": "Golang web-server and concurrent approach for an in memory cache", "body": "<p>I am not new to programming, but I am relatively new to golang and still not completely used to the golang concurrency approach.</p>\n\n<p>The general set-up:</p>\n\n<ul>\n<li>Web server (should be fast and parallel), so I use net/http</li>\n<li>I need to store and retrieve lots of documents. While retrieving happens more often than storing, the factor is rather low. Maybe 20.</li>\n<li>When retrieving the, by far, most important are the lastly stored documents. The rest can be retrieved just from the disk/DB if needed.\n\n<ul>\n<li>Solution: In memory cache of last added items.</li>\n<li>Note: On retrieval, I don't care about the last 3 seconds. Meaning, if, at time (A), I ask for a complete list of the last added items, the items added in the last 3 seconds can (partially or completely) be missing. But when asking again at time (A+3s) all those items should be in the list.</li>\n</ul></li>\n</ul>\n\n<p>My question is related to how to implement the in memory cache.</p>\n\n<h2>Naive approach #1 (RWLock)</h2>\n\n<ul>\n<li>Have a big list of items in memory.</li>\n<li>Guard it with a RW lock</li>\n</ul>\n\n<p>Problem with this approach: I successfully serialized the web server :)</p>\n\n<p>OK, please forget about this approach.</p>\n\n<h2>Approach #2: Split things up</h2>\n\n<ul>\n<li>have X lists in memory (each with RWLock)</li>\n<li>on http handler start get a random number and chose one of the X lists, work only on that list</li>\n<li>Another collector routine is started every 2.5 seconds collecting and combining the lists</li>\n</ul>\n\n<p>This is better, I theoretically could even split the work between servers.</p>\n\n<p>But, for example based on the golang tour code:</p>\n\n<pre><code>func main() {\n    http.HandleFunc(\"/view/\", makeHandler(viewHandler))\n    http.HandleFunc(\"/edit/\", makeHandler(editHandler))\n    http.HandleFunc(\"/save/\", makeHandler(saveHandler))\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p><strong>How do I pass/get a new random number in the http handler without serializing?</strong></p>\n\n<ul>\n<li>It does not need to be cryptographically secure. I just want to use it to pick one of the X lists.</li>\n<li>I know there is a global random generator but that uses a mutex internally, so back to square 1.</li>\n<li>I could ask the clients (JavaScript) to provide a random number as get parameter. But that sounds dangerous (DOS)? Or is this OK?</li>\n<li>I might not know the users IP address in the go server (reverse proxy setup).</li>\n</ul>\n\n<p>And: <strong>Generally is this a good approach? Is there a better way?</strong> And now I am limiting myself to X, this does not scale. If I want X to change during run-time, how could I tell the handlers about that change (without becoming serial again)?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 139, "user_id": 647527, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c5fe708c1c028555fd0f5cbbb812a291?s=128&d=identicon&r=PG", "display_name": "user647527", "link": "https://stackoverflow.com/users/647527/user647527"}, "edited": false, "score": 0, "creation_date": 1477646517, "post_id": 40300914, "comment_id": 67861239, "body": "Thank you. I want it to be in map, so i can call like fmt.Println(parsed[&quot;id.resp_h&quot;].(string)) to get some value."}, {"owner": {"reputation": 139, "user_id": 647527, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c5fe708c1c028555fd0f5cbbb812a291?s=128&d=identicon&r=PG", "display_name": "user647527", "link": "https://stackoverflow.com/users/647527/user647527"}, "edited": false, "score": 0, "creation_date": 1477646801, "post_id": 40300914, "comment_id": 67861397, "body": "hi @ctcherry. is that possible to do string replace before  json.Marshal ? As  i need to filter some unwanted string. Kindly help me. Thank You"}, {"owner": {"reputation": 26448, "user_id": 10322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa46a3814b72439b1d2efa8f7c9162c2?s=128&d=identicon&r=PG", "display_name": "ctcherry", "link": "https://stackoverflow.com/users/10322/ctcherry"}, "reply_to_user": {"reputation": 139, "user_id": 647527, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c5fe708c1c028555fd0f5cbbb812a291?s=128&d=identicon&r=PG", "display_name": "user647527", "link": "https://stackoverflow.com/users/647527/user647527"}, "edited": false, "score": 0, "creation_date": 1477690712, "post_id": 40300914, "comment_id": 67884240, "body": "You can do find/replace on <code>[]bytes</code> with the stdlib <code>bytes.Replace</code> function is that what you mean? <a href=\"https://golang.org/pkg/bytes/#Replace\" rel=\"nofollow noreferrer\">golang.org/pkg/bytes/#Replace</a>"}], "tags": [], "owner": {"reputation": 26448, "user_id": 10322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa46a3814b72439b1d2efa8f7c9162c2?s=128&d=identicon&r=PG", "display_name": "ctcherry", "link": "https://stackoverflow.com/users/10322/ctcherry"}, "is_accepted": true, "score": 0, "last_activity_date": 1477642917, "creation_date": 1477642917, "answer_id": 40300914, "question_id": 40300769, "link": "https://stackoverflow.com/questions/40300769/how-to-pass-type-common-mapstr-to-type-byte/40300914#40300914", "title": "How to pass (type *common.MapStr) to type []byte?", "body": "<p>I assume the struct you are working with is <code>common.MapStr</code> from <a href=\"https://github.com/elastic/libbeat\" rel=\"nofollow\">https://github.com/elastic/libbeat</a></p>\n\n<p><code>common.MapStr</code> is already a <code>map[string]interface{}</code> so I'm not sure why you are turing it into JSON, and then parsing it back into the same kind of structure, but if thats what you really want to do, replacing the error line with:</p>\n\n<p><code>bytes, err := json.Marshal(publishEvent)</code></p>\n\n<p>should work. You will get an error on the next line about redeclaring <code>err</code> so change it to:</p>\n\n<p><code>err = json.Unmarshal(bytes, &amp;parsed)</code></p>\n\n<p>Resulting in the following code (also added another error check):</p>\n\n<pre><code>var parsed map[string]interface{}\nbytes, err := json.Marshal(publishEvent)\nif err != nil{\n    fmt.Println(\"error: \", err)\n    // you'll want to exit or return here since we can't parse `bytes`\n}\nerr = json.Unmarshal(bytes, &amp;parsed)\nif err != nil{\n    fmt.Println(\"error: \", err)\n}\n</code></pre>\n"}], "owner": {"reputation": 139, "user_id": 647527, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c5fe708c1c028555fd0f5cbbb812a291?s=128&d=identicon&r=PG", "display_name": "user647527", "link": "https://stackoverflow.com/users/647527/user647527"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 317, "favorite_count": 0, "accepted_answer_id": 40300914, "answer_count": 1, "score": -3, "last_activity_date": 1477642917, "creation_date": 1477642297, "question_id": 40300769, "link": "https://stackoverflow.com/questions/40300769/how-to-pass-type-common-mapstr-to-type-byte", "title": "How to pass (type *common.MapStr) to type []byte?", "body": "<p>Sorry if the question is too newbie, as i just started to learn go yesterday.\nI try to convert publishEvent into bytes, and compiler shown error like following:</p>\n\n<pre><code>cannot convert publishEvent (type *common.MapStr) to type []byte\n</code></pre>\n\n<p>Can anyone show me the way ?</p>\n\n<p>Thank You.</p>\n\n<pre><code>    var parsed map[string]interface{}\n    bytes := []byte(publishEvent) ---&gt;Error occur here\n    err := json.Unmarshal(bytes, &amp;parsed)\n    if err != nil{\n        fmt.Println(\"error: \", err)\n    }\n</code></pre>\n"}, {"tags": ["go", "revel"], "answers": [{"tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 1, "last_activity_date": 1477636227, "creation_date": 1477636227, "answer_id": 40299306, "question_id": 40299133, "link": "https://stackoverflow.com/questions/40299133/passing-multiple-values-through-renderjson/40299306#40299306", "title": "Passing multiple values through RenderJson", "body": "<p>According to <a href=\"https://godoc.org/github.com/revel/revel#Controller.RenderJson\" rel=\"nofollow\">https://godoc.org/github.com/revel/revel#Controller.RenderJson</a>, RenderJson just takes an <code>interface{}</code>.  So I would expect</p>\n\n<pre><code>return c.RenderJson(\n           Response{\n               Err: \"\",\n               Results: map[string]interface{}{\n                   \"a_struct\": a_struct,\n                   \"other_thing\": someString,\n               },\n           }\n)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 593, "user_id": 8960344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6a4695a4739b1539ab219c4d10459c7?s=128&d=identicon&r=PG", "display_name": "Nima Ghotbi", "link": "https://stackoverflow.com/users/8960344/nima-ghotbi"}, "is_accepted": false, "score": 1, "last_activity_date": 1477636313, "creation_date": 1477636313, "answer_id": 40299335, "question_id": 40299133, "link": "https://stackoverflow.com/questions/40299133/passing-multiple-values-through-renderjson/40299335#40299335", "title": "Passing multiple values through RenderJson", "body": "<p>Yes it is possible</p>\n\n<p>Example from <a href=\"https://revel.github.io/manual/results.html#RenderJson\" rel=\"nofollow\">Revel's manual</a>:</p>\n\n<pre><code>// Simple example\n\ntype Stuff struct {\n    Foo string ` json:\"foo\" xml:\"foo\" `\n    Bar int ` json:\"bar\" xml:\"bar\" `\n}\n\nfunc (c MyController) MyAction() revel.Result {\n    data := make(map[string]interface{})\n    data[\"error\"] = nil\n    stuff := Stuff{Foo: \"xyz\", Bar: 999}\n    data[\"stuff\"] = stuff\n    return c.RenderJson(data)\n    //return c.RenderXml(data)\n}\n</code></pre>\n"}], "owner": {"reputation": 2411, "user_id": 2037570, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5fa24420cee32bd1d97e2fd3a61de37f?s=128&d=identicon&r=PG", "display_name": "Hemant Bhargava", "link": "https://stackoverflow.com/users/2037570/hemant-bhargava"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 0, "accepted_answer_id": 40299306, "answer_count": 2, "score": 0, "last_activity_date": 1477636313, "creation_date": 1477635453, "question_id": 40299133, "link": "https://stackoverflow.com/questions/40299133/passing-multiple-values-through-renderjson", "title": "Passing multiple values through RenderJson", "body": "<p>Learning 'go'. Is it possible to pass multiple values through RenderJson method. Something like :</p>\n\n<pre><code>return c.RenderJson(Response{Err: \"\", Results: {&lt;a_struct&gt;, &lt;string&gt;})\n</code></pre>\n\n<p>I know that you can pass one variable/value/struct like:</p>\n\n<pre><code>return c.RenderJson(Response{Err: \"\", Results: &lt;a_struct&gt;)\n</code></pre>\n\n<p>To achieve my purpose, I can create an struct of 'a_struct' and 'string' and the pass it along. Wondering if it can be achieved by passing muliple values.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1477662755, "post_id": 40296483, "comment_id": 67870311, "body": "Don&#39;t background the process in the shell, it&#39;s only making it so you can&#39;t properly wait on the child process. Either have your server signal once it&#39;s bound the port, or you&#39;re going to have to retry the connection until it does."}], "answers": [{"comments": [{"owner": {"reputation": 712, "user_id": 8868419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44a530d27369c9d4f6ecf421fe83d2b4?s=128&d=identicon&r=PG&f=1", "display_name": "Madeo", "link": "https://stackoverflow.com/users/8868419/madeo"}, "edited": false, "score": 0, "creation_date": 1593236916, "post_id": 40298896, "comment_id": 110714586, "body": "nice library, maybe has passed a lot of time, but if I  ping the server I see that it does not take into account of the port. If there a way to do this? Thanks"}], "tags": [], "owner": {"reputation": 109227, "user_id": 641955, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/Hg2nO.jpg?s=128&g=1", "display_name": "janos", "link": "https://stackoverflow.com/users/641955/janos"}, "is_accepted": true, "score": 17, "last_activity_date": 1477653935, "last_edit_date": 1477653935, "creation_date": 1477634285, "answer_id": 40298896, "question_id": 40296483, "link": "https://stackoverflow.com/questions/40296483/continuously-check-if-tcp-port-is-in-use/40298896#40298896", "title": "Continuously check if tcp port is in use", "body": "<p>You could connect to the port using <code>net.DialTimeout</code> or <code>net.Dial</code>, and if successful, immediately close it. You can do this in a loop until successful.</p>\n\n<pre><code>for {\n    conn, err := net.DialTimeout(\"tcp\", net.JoinHostPort(\"\", port), timeout)\n    if conn != nil {\n        conn.Close()\n        break\n    }\n}\n</code></pre>\n\n<p>A simple tiny library (I wrote) for a similar purpose might also be of interest: <a href=\"https://github.com/janosgyerik/portping/blob/master/portping.go\" rel=\"noreferrer\"><code>portping</code></a>.</p>\n"}], "owner": {"reputation": 145, "user_id": 2252554, "user_type": "registered", "accept_rate": 18, "profile_image": "https://www.gravatar.com/avatar/09b56159cf2d994d15d65b534f6f5c1e?s=128&d=identicon&r=PG", "display_name": "Mosinel", "link": "https://stackoverflow.com/users/2252554/mosinel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5696, "favorite_count": 0, "accepted_answer_id": 40298896, "answer_count": 1, "score": 6, "last_activity_date": 1477653935, "creation_date": 1477617182, "question_id": 40296483, "link": "https://stackoverflow.com/questions/40296483/continuously-check-if-tcp-port-is-in-use", "title": "Continuously check if tcp port is in use", "body": "<p>I'm running a bash command to start up a server in the background :  \"./starServer &amp;\" However, my server takes a few seconds to start up. I'm wondering what I can do to continuously check the port that it's running on to ensure it's up before I actually move on and do other things. I couldn't find anything in the golang api that helped with this. Any help is appreciated!</p>\n\n<pre><code>c := exec.Command(\"/bin/sh\", \"-c\", command)\nerr := c.Start()\nif err != nil {\n    log.Fatalf(\"error: %v\", err)\n}\nl, err1 := net.Listen(\"tcp\", \":\" + port)\n</code></pre>\n"}, {"tags": ["go", "gorilla"], "answers": [{"tags": [], "owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "is_accepted": false, "score": 4, "last_activity_date": 1477616804, "creation_date": 1477616804, "answer_id": 40296441, "question_id": 40295887, "link": "https://stackoverflow.com/questions/40295887/how-to-wrap-gorilla-mux-func-handler-by-yaag-middleware/40296441#40296441", "title": "how to wrap gorilla mux func handler by yaag middleware", "body": "<p>All you have to do is substitute .Handler() by <strong>.HandlerFunc()</strong> and wrap your handler function with the middleware, so each endpoint will pass first for the yaag middleware and then to your handler function, like this:</p>\n\n<pre><code>router := mux.NewRouter().StrictSlash(true)\nfor _, route := range routes {\n    router.\n        Methods(route.Method).\n        Path(route.Pattern).\n        Name(route.Name).\n        HandlerFunc(middleware.HandleFunc(route.HandlerFunc)) // change here\n}\n</code></pre>\n"}], "owner": {"reputation": 1339, "user_id": 1726183, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/e052c9c68ad2978015d389b4c00513f0?s=128&d=identicon&r=PG", "display_name": "Varun Gupta", "link": "https://stackoverflow.com/users/1726183/varun-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 744, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1477676913, "creation_date": 1477611921, "last_edit_date": 1477676913, "question_id": 40295887, "link": "https://stackoverflow.com/questions/40295887/how-to-wrap-gorilla-mux-func-handler-by-yaag-middleware", "title": "how to wrap gorilla mux func handler by yaag middleware", "body": "<p>I am following this tutorial. <a href=\"http://thenewstack.io/make-a-restful-json-api-go/\" rel=\"nofollow\">http://thenewstack.io/make-a-restful-json-api-go/</a></p>\n\n<pre><code>router := mux.NewRouter().StrictSlash(true)\nfor _, route := range routes {\n    router.\n        Methods(route.Method).\n        Path(route.Pattern).\n        Name(route.Name).\n        Handler(route.HandlerFunc)\n}\n</code></pre>\n\n<p>I need to wrap the endpoint func using yaag middleware.</p>\n\n<pre><code>r.HandleFunc(\"/\", middleware.HandleFunc(handler))\n</code></pre>\n\n<p>How to achieve this?</p>\n\n<p>EDIT:\nI am wrapping in around the Logger and returning the haddler. Logger takes first argument, as http.Handle. So wrapping the route.HandlerFunc won't work. Can you please help me here?</p>\n\n<pre><code>handler := Logger(route.HandlerFunc, route.Name)\n\n    router.\n        Methods(route.Method).\n        Path(route.Pattern).\n        Name(route.Name).\n        Handler(handler)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1477605616, "post_id": 40294604, "comment_id": 67848107, "body": "No values in Go are safe for concurrent read and write. Run your program with the race detector as an added verification."}, {"owner": {"reputation": 37934, "user_id": 60950, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/LwZVH.jpg?s=128&g=1", "display_name": "Luk&#225;\u0161 Lalinsk&#253;", "link": "https://stackoverflow.com/users/60950/luk%c3%a1%c5%a1-lalinsk%c3%bd"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1477608444, "post_id": 40294604, "comment_id": 67849168, "body": "@JimB Let&#39;s say I use <code>atomic.Value</code> for accessing the slice (e.g. <a href=\"https://play.golang.org/p/rKpIqZSWww\" rel=\"nofollow noreferrer\">play.golang.org/p/rKpIqZSWww</a>). Does <code>append()</code> have any side-effects that would make it unsafe? The race detector doesn&#39;t report any problems there."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1477608933, "post_id": 40294604, "comment_id": 67849339, "body": "You can&#39;t rely on the order of operations appearing consistent between CPUs. One could write the new array value then increase the length while the other one sees the length increase before it sees the new value, resulting in a garbage read."}, {"owner": {"reputation": 37934, "user_id": 60950, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/LwZVH.jpg?s=128&g=1", "display_name": "Luk&#225;\u0161 Lalinsk&#253;", "link": "https://stackoverflow.com/users/60950/luk%c3%a1%c5%a1-lalinsk%c3%bd"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1477609144, "post_id": 40294604, "comment_id": 67849399, "body": "@ZanLynx I thought that if I do <code>data := o.data</code> I own a copy of the (ptr, len, cap) structure, so another CPU increasing the length of their own copy does not matter to me as a reader."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1477609279, "post_id": 40294604, "comment_id": 67849433, "body": "@Luk&#225;\u0161Lalinsk&#253;: that looks like it might be race free <i>as is</i>, but the Writer will have a logical race, in that concurrent calls will overwrite each other. It&#39;s also very fragile, in that you will have a race if you index into to the slice since the backing array may be shared."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1477610534, "post_id": 40294604, "comment_id": 67849776, "body": "@Luk&#225;\u0161Lalinsk&#253;: Yes, I guess you are correct. The length in each slice is independent."}], "answers": [{"comments": [{"owner": {"reputation": 37934, "user_id": 60950, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/LwZVH.jpg?s=128&g=1", "display_name": "Luk&#225;\u0161 Lalinsk&#253;", "link": "https://stackoverflow.com/users/60950/luk%c3%a1%c5%a1-lalinsk%c3%bd"}, "edited": false, "score": 0, "creation_date": 1477608805, "post_id": 40295105, "comment_id": 67849302, "body": "Cool, so this means that the &quot;shallow copy&quot; of the slice is safe from anything that <code>append()</code> does in the other goroutine? In practice, I&#39;d use <code>RWLock</code> there, but it&#39;s great if this is guaranteed to work."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 37934, "user_id": 60950, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/LwZVH.jpg?s=128&g=1", "display_name": "Luk&#225;\u0161 Lalinsk&#253;", "link": "https://stackoverflow.com/users/60950/luk%c3%a1%c5%a1-lalinsk%c3%bd"}, "edited": false, "score": 0, "creation_date": 1477609124, "post_id": 40295105, "comment_id": 67849392, "body": "Yes, a reader using a shallow copy of a slice is safe from <code>append</code> in another goroutine. The <code>append</code> function does not modify a variable visible to the reader because it either writes beyond the portion of the backing array visible to the reader or it allocates a new backing array."}, {"owner": {"reputation": 7915, "user_id": 494343, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/446b5d6d3a019f8219b5d8102c1d4bbc?s=128&d=identicon&r=PG", "display_name": "Schultz9999", "link": "https://stackoverflow.com/users/494343/schultz9999"}, "edited": false, "score": 0, "creation_date": 1477692923, "post_id": 40295105, "comment_id": 67885012, "body": "This is why the code above works: <a href=\"https://play.golang.org/p/uId7jAWPZH\" rel=\"nofollow noreferrer\">play.golang.org/p/uId7jAWPZH</a>. In a nutshell, <code>append</code> reallocates the new slice to a new location all together. By capturing the old pointer, we are able to loop thru it."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1557238948, "last_edit_date": 1557238948, "creation_date": 1477606807, "answer_id": 40295105, "question_id": 40294604, "link": "https://stackoverflow.com/questions/40294604/is-is-safe-to-append-to-a-slice-from-which-another-thread-is-reading/40295105#40295105", "title": "Is is safe to append() to a slice from which another thread is reading?", "body": "<p>The code in the question is unsafe because it reads a variable in one goroutine and modifies the variable in another goroutine without synchronization.</p>\n\n<p>Here's one way to make the code safe:</p>\n\n<pre><code>type Obj struct {\n   mu sync.Mutex // add mutex\n   ... // other fields as before\n}\n\nfunc (o *Obj) Reader() {\n    o.mu.Lock()\n    data := o.data\n    o.mu.Unlock()\n    for i, value := range data {\n      log.Printf(\"got data[%v] = %v\", i, value)\n    }\n}\n\nfunc (o *Obj) Writer() {\n     o.mu.Lock()\n     o.data = append(o.data, 1234)\n     o.mu.Unlock()\n}\n</code></pre>\n\n<p>It's safe for <code>Reader</code> to range over the local slice variable <code>data</code> because the <code>Writer</code> does not modify the local variable <code>data</code> or the backing array visible through the local variable <code>data</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 15372, "user_id": 7980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65b42c59ffe8d671459604f0f32f7a30?s=128&d=identicon&r=PG", "display_name": "Alec Thomas", "link": "https://stackoverflow.com/users/7980/alec-thomas"}, "is_accepted": false, "score": 0, "last_activity_date": 1554264157, "creation_date": 1554264157, "answer_id": 55486883, "question_id": 40294604, "link": "https://stackoverflow.com/questions/40294604/is-is-safe-to-append-to-a-slice-from-which-another-thread-is-reading/55486883#55486883", "title": "Is is safe to append() to a slice from which another thread is reading?", "body": "<p>A bit late to the party, but if your use-case is frequent reads and infrequent writes, <code>atomic.Value</code> is designed to solve this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Obj struct {\n  data atomic.Value // []int\n  mu sync.Mutex\n}\n\nfunc (o *Obj) Reader() {\n  data := o.data.Load().([]int);\n  for i, value := range data {\n    log.Printf(\"got data[%v] = %v\", i, value)\n  }\n}\n\nfunc (o *Obj) Writer() {\n    o.mu.Lock()\n    data := o.data.Load().([]int);\n    data = append(o.data, 1234)\n    o.data.Store(data)\n    o.mu.Unlock()\n}\n</code></pre>\n\n<p>This will generally be much faster than either a <code>Mutex</code> or an <code>RWMutex</code>.</p>\n\n<p>Note that this will only work with data this is effectively a copy, which it is in this case because you can safely maintain a reference to the previous slice when appending, as <code>append()</code> creates a new copy if it extends. If you're mutating the elements of the slice, or using another data structure, this approach is not safe.</p>\n"}], "owner": {"reputation": 37934, "user_id": 60950, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/LwZVH.jpg?s=128&g=1", "display_name": "Luk&#225;\u0161 Lalinsk&#253;", "link": "https://stackoverflow.com/users/60950/luk%c3%a1%c5%a1-lalinsk%c3%bd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3378, "favorite_count": 0, "accepted_answer_id": 40295105, "answer_count": 2, "score": 5, "last_activity_date": 1557238948, "creation_date": 1477604304, "question_id": 40294604, "link": "https://stackoverflow.com/questions/40294604/is-is-safe-to-append-to-a-slice-from-which-another-thread-is-reading", "title": "Is is safe to append() to a slice from which another thread is reading?", "body": "<p>Let's say I have many goroutines doing something like this:</p>\n\n<pre><code>func (o *Obj) Reader() {\n  data := o.data;\n  for i, value := range data {\n    log.Printf(\"got data[%v] = %v\", i, value)\n  }\n}\n</code></pre>\n\n<p>And one doing this:</p>\n\n<pre><code>func (o *Obj) Writer() {\n    o.data = append(o.data, 1234)\n}\n</code></pre>\n\n<p>If <code>data := o.data</code> means the internal structure of the slice is copied, this looks like it could be safe, because I'm never modifying anything in the accessible range of the copy. I'm either setting one element outside of the range and increasing the length, or allocating a completely new pointer, but the reader would be operating on the original one.</p>\n\n<p>Are my assumptions correct and this is safe to do?</p>\n\n<p>I'm aware that slices are not meant to be \"thread-safe\" in general, the question is more about how much does <code>slice1 := slice2</code> actually copy.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "edited": false, "score": 0, "creation_date": 1477604665, "post_id": 40294496, "comment_id": 67847762, "body": "It is right. Don&#39;t forget to click to link at word export. It explains why fields that name starts with lower letter are not exported."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 6, "last_activity_date": 1477603861, "creation_date": 1477603861, "answer_id": 40294496, "question_id": 40294469, "link": "https://stackoverflow.com/questions/40294469/golang-mgo-how-to-view-result/40294496#40294496", "title": "Golang Mgo - How to view result?", "body": "<p>You need to <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"noreferrer\">export</a> the field names.</p>\n\n<pre><code>type User struct {\n  ID        bson.ObjectId `json:\"-\" bson:\"_id\"`\n  FirstName string        `json:\"first_name\"`\n  LastName  string        `json:\"last_name\"`\n  Email     string        `json:\"email\"`\n  RegId     string        `json:\"registration_id\"`\n  RegKey    string        `json:\"registration_key\"`\n  Password  string        `json:\"password`\n}\n</code></pre>\n\n<p>The BSON codec ignores unexported fields.</p>\n"}], "owner": {"reputation": 62, "user_id": 1004347, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f91387b94184a0d1830bd2a17e134e19?s=128&d=identicon&r=PG", "display_name": "Louis T.", "link": "https://stackoverflow.com/users/1004347/louis-t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 701, "favorite_count": 0, "accepted_answer_id": 40294496, "answer_count": 1, "score": 1, "last_activity_date": 1477603861, "creation_date": 1477603698, "question_id": 40294469, "link": "https://stackoverflow.com/questions/40294469/golang-mgo-how-to-view-result", "title": "Golang Mgo - How to view result?", "body": "<p>It looks like I'm able to successfully connect to my Mongo Database. I'm able to view that there are 30 records in my collection. How do I actually view the records though?</p>\n\n<pre><code>enter code here\npackage main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n    \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\ntype User struct {\n    id        bson.ObjectId `json:\"-\" bson:\"_id\"`\n    firstName string        `json:\"first_name\"`\n    lastName  string        `json:\"last_name\"`\n    email     string        `json:\"email\"`\n    regId     string        `json:\"registration_id\"`\n    regKey    string        `json:\"registration_key\"`\n    password  string        `json:\"password`\n}\n\nfunc main() {\n\n    session, err := mgo.Dial(\"XXX.XXX.XXX.XXX\")\n    if err != nil {\n    panic(err)\n}\ndefer session.Close()\nsession.SetMode(mgo.Monotonic, true)\n//res := []User{}\nc := session.DB(\"cd\").C(\"auth_user\")\n\nres := []User{}\nfmt.Println(c.Find(bson.M{}).All(&amp;res))\nfmt.Println(len(res))\nfmt.Println(res)\nfmt.Println(res[0])\nfmt.Println(res[0].email)\n}\n</code></pre>\n\n<p>The output of the above is:\n\n30\n[{      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      } {      }]</p>\n"}, {"tags": ["go", "gorilla"], "answers": [{"tags": [], "owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "is_accepted": false, "score": 0, "last_activity_date": 1477603391, "creation_date": 1477603391, "answer_id": 40294403, "question_id": 40294254, "link": "https://stackoverflow.com/questions/40294254/golang-generate-rest-api-documentation-using-gorilla-mux/40294403#40294403", "title": "golang generate rest api documentation using gorilla/mux", "body": "<p>The answer is no, but you can use this excellent tool <a href=\"https://github.com/adams-sarah/test2doc\" rel=\"nofollow\">https://github.com/adams-sarah/test2doc</a> to generate documentation</p>\n"}], "owner": {"reputation": 1339, "user_id": 1726183, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/e052c9c68ad2978015d389b4c00513f0?s=128&d=identicon&r=PG", "display_name": "Varun Gupta", "link": "https://stackoverflow.com/users/1726183/varun-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2131, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1477603391, "creation_date": 1477602624, "question_id": 40294254, "link": "https://stackoverflow.com/questions/40294254/golang-generate-rest-api-documentation-using-gorilla-mux", "title": "golang generate rest api documentation using gorilla/mux", "body": "<p>I have a restful service in golang running in production, and using gorrila mux. Is there an extension utility available, which I can add to generate nice restful api documention?</p>\n"}, {"tags": ["string", "go", "hex", "type-conversion"], "answers": [{"comments": [{"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 1, "creation_date": 1477600390, "post_id": 40293650, "comment_id": 67845866, "body": "Almost what I&#39;m looking for, except for the fact that I&#39;m looking for a <code>6 Characters Long String which represents an Hex</code>. I guess I need to change <code>%016x</code> with <code>%06x</code> and it&#39;ll be ok."}, {"owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "reply_to_user": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1477673773, "post_id": 40293650, "comment_id": 67876694, "body": "I changed it, too."}, {"owner": {"reputation": 2153, "user_id": 2667212, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/rKmdj.jpg?s=128&g=1", "display_name": "Hoang Trinh", "link": "https://stackoverflow.com/users/2667212/hoang-trinh"}, "edited": false, "score": 0, "creation_date": 1552377708, "post_id": 40293650, "comment_id": 96974773, "body": "@RolandIllig: How can I replace the 6 with a const variable? For example, const TOPIC_LENGTH = 6 ?"}], "tags": [], "owner": {"reputation": 36931, "user_id": 225757, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/e7140b12949e4652885f6bb02b435f42?s=128&d=identicon&r=PG", "display_name": "Roland Illig", "link": "https://stackoverflow.com/users/225757/roland-illig"}, "is_accepted": true, "score": 10, "last_activity_date": 1477673723, "last_edit_date": 1477673723, "creation_date": 1477600021, "answer_id": 40293650, "question_id": 40293530, "link": "https://stackoverflow.com/questions/40293530/convert-an-int-to-hex-and-then-pad-it-with-0s-to-get-a-fixed-length-string/40293650#40293650", "title": "Convert an int to hex and then pad it with 0&#39;s to get a fixed length String", "body": "<pre><code>import \"fmt\"\n\nhex := fmt.Sprintf(\"%06x\", num)\n</code></pre>\n\n<p>The <code>x</code> means hexadecimal, the <code>6</code> means 6 digits, the <code>0</code> means left-pad with zeros and the <code>%</code> starts the whole sequence.</p>\n"}], "owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1836, "favorite_count": 1, "accepted_answer_id": 40293650, "answer_count": 1, "score": 6, "last_activity_date": 1561813040, "creation_date": 1477599550, "last_edit_date": 1561813040, "question_id": 40293530, "link": "https://stackoverflow.com/questions/40293530/convert-an-int-to-hex-and-then-pad-it-with-0s-to-get-a-fixed-length-string", "title": "Convert an int to hex and then pad it with 0&#39;s to get a fixed length String", "body": "<p>I'm having some issues on trying to convert an <code>int</code> to hex then, padding it with <code>0</code>s in order to get a <code>6 Characters String</code> which represents the hex number.</p>\n\n<p>So far, I tried the following:</p>\n\n<pre><code>intNumber := 12\nhexNumber := strconv.FormatInt(intNumber, 16) //not working\n</code></pre>\n\n<p>And then I found out how to pad it with <code>0</code>s, using <code>%06d, number/string</code>. It makes all the strings 6 characters long.</p>\n\n<p><a href=\"https://play.golang.org/p/lEYcu-dfiM\" rel=\"nofollow noreferrer\">Here you can Find a Playground</a> which I set up to make some tests.</p>\n\n<p><strong>How can I achieve this in a efficient way?</strong>    </p>\n\n<p>For any Clarifications on the question, just leave a comment below.\nThanks In advance.</p>\n"}, {"tags": ["go", "cloud-foundry", "godeps", "pcfdev"], "comments": [{"owner": {"reputation": 11590, "user_id": 774395, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/468lE.jpg?s=128&g=1", "display_name": "EngineerBetter_DJ", "link": "https://stackoverflow.com/users/774395/engineerbetter-dj"}, "edited": false, "score": 0, "creation_date": 1477598288, "post_id": 40292871, "comment_id": 67844757, "body": "Do you get the same issue if you push the app to Pivotal Web Services? Accounts come with a free trial, which should make it reasonably easy to test. That&#39;d help nail down if it&#39;s a PCFDev issue or a buildpack issue."}, {"owner": {"reputation": 478, "user_id": 3130596, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2c9b5273e47975f6198779bcfe51bf70?s=128&d=identicon&r=PG&f=1", "display_name": "codewizard", "link": "https://stackoverflow.com/users/3130596/codewizard"}, "reply_to_user": {"reputation": 11590, "user_id": 774395, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/468lE.jpg?s=128&g=1", "display_name": "EngineerBetter_DJ", "link": "https://stackoverflow.com/users/774395/engineerbetter-dj"}, "edited": false, "score": 0, "creation_date": 1477677192, "post_id": 40292871, "comment_id": 67878398, "body": "@EngineerBetter great point. I get the same behavior when pushing to run.pivotal.io"}, {"owner": {"reputation": 11590, "user_id": 774395, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/468lE.jpg?s=128&g=1", "display_name": "EngineerBetter_DJ", "link": "https://stackoverflow.com/users/774395/engineerbetter-dj"}, "edited": false, "score": 0, "creation_date": 1477677244, "post_id": 40292871, "comment_id": 67878429, "body": "Someone in the Cloud Foundry Slack (slack.cloudfoundry.org) suggested that maybe you hadn&#39;t pushed your dependencies?"}], "owner": {"reputation": 478, "user_id": 3130596, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2c9b5273e47975f6198779bcfe51bf70?s=128&d=identicon&r=PG&f=1", "display_name": "codewizard", "link": "https://stackoverflow.com/users/3130596/codewizard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 169, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1477598543, "creation_date": 1477596909, "last_edit_date": 1477598543, "question_id": 40292871, "link": "https://stackoverflow.com/questions/40292871/godep-cant-find-gin-when-pushing-go-project-to-pcf-dev", "title": "Godep cant find gin when pushing go project to PCF-dev", "body": "<p>Yesterday my app was pushing fine. When I came back today to push I am having issues where godeps can't find certain dependencies. Im able to godep go install just fine on my local machine, which leads me to believe this is a PCF issue of some type.</p>\n\n<p><code>go push</code> output: </p>\n\n<pre><code>Starting app business-service in org pcfdev-org / space pcfdev-space as user...\nDownloading dotnet_core_buildpack_beta...\nDownloading go_buildpack...\nDownloading nodejs_buildpack...\nDownloading ruby_buildpack...\nDownloading staticfile_buildpack...\nDownloaded ruby_buildpack\nDownloading python_buildpack...\nDownloaded go_buildpack\nDownloading php_buildpack...\nDownloaded nodejs_buildpack\nDownloading binary_buildpack...\nDownloaded dotnet_core_buildpack_beta\nDownloading java_buildpack...\nDownloaded binary_buildpack\nDownloaded php_buildpack\nDownloaded python_buildpack\nDownloaded staticfile_buildpack\nDownloaded java_buildpack\nCreating container\nSuccessfully created container\nDownloading app package...\nDownloaded app package (9.1K)\nStaging...\n-------&gt; Buildpack version 1.7.10\nfile:///tmp/buildpacks/d17226e3d1bc5f728403b1521b69c8ae/dependencies/https___buildpacks.cloudfoundry.org_concourse-binaries_godep_godep-v74-linux-x64.tgz\nfile:///tmp/buildpacks/d17226e3d1bc5f728403b1521b69c8ae/dependencies/https___buildpacks.cloudfoundry.org_concourse-binaries_glide_glide-v0.11.0-linux-x64.tgz\n-----&gt; Checking Godeps/Godeps.json file.\n-----&gt; Installing go1.6.3... done\nDownloaded [file:///tmp/buildpacks/d17226e3d1bc5f728403b1521b69c8ae/dependencies/https___storage.googleapis.com_golang_go1.6.3.linux-amd64.tar.gz]\n !!    Installing package '.' (default)\n-----&gt; Running: godep go install -v -tags cloudfoundry --buildmode=pie .\nserver/server.go:4:2: cannot find package \"gopkg.in/gin-gonic/gin.v1\" in any of:\n    /tmp/cache/go1.6.3/go/src/gopkg.in/gin-gonic/gin.v1 (from $GOROOT)\n    /tmp/app/.heroku/go/src/business-service/Godeps/_workspace/src/gopkg.in/gin-gonic/gin.v1 (from $GOPATH)\n    /tmp/app/.heroku/go/src/gopkg.in/gin-gonic/gin.v1\ngodep: go exit status 1\nFailed to compile droplet\nExit status 223\nStaging failed: Exited with status 223\nDestroying container\nSuccessfully destroyed container\n</code></pre>\n\n<p>Godeps.json:</p>\n\n<pre><code>{\n    \"ImportPath\": \"business-service\",\n    \"GoVersion\": \"go1.6\",\n    \"GodepVersion\": \"v74\",\n    \"Deps\": [\n        {\n            \"ImportPath\": \"github.com/gin-gonic/gin/binding\",\n            \"Comment\": \"v1.0-2-g3900df0\",\n            \"Rev\": \"3900df04d2a88e22beaf6a2970c63648b9e1b0e1\"\n        },\n        {\n            \"ImportPath\": \"github.com/gin-gonic/gin/render\",\n            \"Comment\": \"v1.0-2-g3900df0\",\n            \"Rev\": \"3900df04d2a88e22beaf6a2970c63648b9e1b0e1\"\n        },\n        {\n            \"ImportPath\": \"github.com/golang/protobuf/proto\",\n            \"Rev\": \"98fa357170587e470c5f27d3c3ea0947b71eb455\"\n        },\n        {\n            \"ImportPath\": \"github.com/manucorporat/sse\",\n            \"Rev\": \"ee05b128a739a0fb76c7ebd3ae4810c1de808d6d\"\n        },\n        {\n            \"ImportPath\": \"golang.org/x/net/context\",\n            \"Rev\": \"65dfc08770ce66f74becfdff5f8ab01caef4e946\"\n        },\n        {\n            \"ImportPath\": \"gopkg.in/gin-gonic/gin.v1\",\n            \"Comment\": \"v1.0\",\n            \"Rev\": \"2dae550eb5392006a4582ce9c90016a9b5a74e8b\"\n        },\n        {\n            \"ImportPath\": \"gopkg.in/go-playground/validator.v8\",\n            \"Comment\": \"v8.18.1\",\n            \"Rev\": \"5f57d2222ad794d0dffb07e664ea05e2ee07d60c\"\n        },\n        {\n            \"ImportPath\": \"gopkg.in/yaml.v2\",\n            \"Rev\": \"a5b47d31c556af34a302ce5d659e6fea44d90de0\"\n        }\n    ]\n}\n</code></pre>\n"}, {"tags": ["http", "go"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 3, "last_activity_date": 1477662954, "last_edit_date": 1477662954, "creation_date": 1477594859, "answer_id": 40292271, "question_id": 40291861, "link": "https://stackoverflow.com/questions/40291861/how-to-break-a-chunked-in-go-using-net-http/40292271#40292271", "title": "How to break a chunked in go using net/http?", "body": "<p>That error you see from curl is because the connection was immediately closed by the http server when it saw the panic. In order to force the connection closed without a <code>panic</code>, you will have to hijack it:</p>\n\n<pre><code>// inside the http handler\n// func(w http.ResponseWriter, r *http.Request) {\n\n// to abort an HTTP/1.1 response\nif w, ok := w.(http.Hijacker); ok {\n    c, _, err := w.Hijack()\n    if err != nil {\n        log.Println(\"cannot close connection:\", err)\n        return\n    }\n    c.Close()\n    return\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4456, "user_id": 4127569, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8b728c7d6c1dce81f5a82249b7617756?s=128&d=identicon&r=PG&f=1", "display_name": "jch", "link": "https://stackoverflow.com/users/4127569/jch"}, "is_accepted": false, "score": 1, "last_activity_date": 1479255335, "creation_date": 1479255335, "answer_id": 40622004, "question_id": 40291861, "link": "https://stackoverflow.com/questions/40291861/how-to-break-a-chunked-in-go-using-net-http/40622004#40622004", "title": "How to break a chunked in go using net/http?", "body": "<p>In Go 1.7, hijacking (as proposed in JimB's answer) is probably the best solution.  Unfortunately, it only works in HTTP/1.1 \u2014 it will not do anything useful in HTTP/2.</p>\n\n<p>Go 1.8 introduces a new value <code>ErrAbortHandler</code>, and the official way of interrupting an HTTP reply mid-stream is <code>panic(http.ErrAbortHandler)</code>, which works for both HTTP/1.1 and HTTP.2.  This is described in <a href=\"https://github.com/golang/go/issues/17790\" rel=\"nofollow noreferrer\">issue 17790</a>.</p>\n"}], "owner": {"reputation": 4478, "user_id": 557406, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/99836456ec6d87389df32d2cdcf8d825?s=128&d=identicon&r=PG", "display_name": "Charles L.", "link": "https://stackoverflow.com/users/557406/charles-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 492, "favorite_count": 0, "accepted_answer_id": 40292271, "answer_count": 2, "score": 2, "last_activity_date": 1479255335, "creation_date": 1477593366, "question_id": 40291861, "link": "https://stackoverflow.com/questions/40291861/how-to-break-a-chunked-in-go-using-net-http", "title": "How to break a chunked in go using net/http?", "body": "<p>I have an http server with an endpoint that returns lots of data streamed from a db.  The response is chunked (<code>&lt; Transfer-Encoding: chunked</code>).  And if I run into an error, like the DB crashing, I can use a panic &amp; curl will warn me of an issue:</p>\n\n<pre><code>curl: (18) transfer closed with outstanding read data remaining\n</code></pre>\n\n<p>I don't want a panic though - I just want a simple log message.  And if I <code>recover()</code> I don't get the error in curl so there's no indication of something breaking.</p>\n\n<p>Is there a way to break an chunked http response without a panic?</p>\n"}]