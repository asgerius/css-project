[{"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 4599888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99e9a907515cab260b1ce3124d12f741?s=128&d=identicon&r=PG&f=1", "display_name": "suz", "link": "https://stackoverflow.com/users/4599888/suz"}, "edited": false, "score": 0, "creation_date": 1549511324, "post_id": 54564688, "comment_id": 95930370, "body": "Cool, thanks! It works as I expected! :) One more thing. Is there a way to specify type? so both a and b must have same type? Instead of throwing an error?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 11, "user_id": 4599888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99e9a907515cab260b1ce3124d12f741?s=128&d=identicon&r=PG&f=1", "display_name": "suz", "link": "https://stackoverflow.com/users/4599888/suz"}, "edited": false, "score": 0, "creation_date": 1549511741, "post_id": 54564688, "comment_id": 95930484, "body": "Errors are not thrown in Go.  Please describe what you mean by &quot;throwing an error&quot; and how to reproduce it."}, {"owner": {"reputation": 11, "user_id": 4599888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99e9a907515cab260b1ce3124d12f741?s=128&d=identicon&r=PG&f=1", "display_name": "suz", "link": "https://stackoverflow.com/users/4599888/suz"}, "edited": false, "score": 0, "creation_date": 1549665434, "post_id": 54564688, "comment_id": 95998698, "body": "Oops sorry I don&#39;t speak Go.. i mean instead of returning error <code>compare() (bool, err) {  if a.type() != b.type(){ return nil, error.New() } } </code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 11, "user_id": 4599888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99e9a907515cab260b1ce3124d12f741?s=128&d=identicon&r=PG&f=1", "display_name": "suz", "link": "https://stackoverflow.com/users/4599888/suz"}, "edited": false, "score": 0, "creation_date": 1549666519, "post_id": 54564688, "comment_id": 95998988, "body": "I am confused about what you are asking. The two functions shown in my answer have a single return value, a boolean.  The functions do not return an error.  If the two types are different, then the functions return false.  Are you asking to add an error return value to the functions, or are the functions good as is?"}, {"owner": {"reputation": 11, "user_id": 4599888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99e9a907515cab260b1ce3124d12f741?s=128&d=identicon&r=PG&f=1", "display_name": "suz", "link": "https://stackoverflow.com/users/4599888/suz"}, "edited": false, "score": 0, "creation_date": 1549907107, "post_id": 54564688, "comment_id": 96064543, "body": "I was hoping there is a way to restrict that A and B has a same type. It just returns false in case a and b has different type, but instead of that, i was hoping if a and b has different type, they can not even call the method."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 11, "user_id": 4599888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99e9a907515cab260b1ce3124d12f741?s=128&d=identicon&r=PG&f=1", "display_name": "suz", "link": "https://stackoverflow.com/users/4599888/suz"}, "edited": false, "score": 0, "creation_date": 1549907956, "post_id": 54564688, "comment_id": 96064961, "body": "It is not possible to prevent the application from calling the function when a an b have different types.  What do you want to have happen when different types are passed to the function?  The choices are: return false, return with an error or panic."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1549667637, "last_edit_date": 1549667637, "creation_date": 1549499601, "answer_id": 54564688, "question_id": 54564335, "link": "https://stackoverflow.com/questions/54564335/is-there-a-way-to-compare-with-any-pointer-objects-in-golang/54564688#54564688", "title": "Is there a way to compare with any pointer objects in golang?", "body": "<p>Given that you are only working with two types, use <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertions</a> to get the concrete pointer types and compare:</p>\n\n<pre><code>func compare(a interface{}, b interface{}) bool {\n    switch a := a.(type) {\n    case *string:\n        b, _ := b.(*string)\n        return a != nil &amp;&amp; b != nil &amp;&amp; *a == *b\n    case *int:\n        b, _ := b.(*int)\n        return a != nil &amp;&amp; b != nil &amp;&amp; *a == *b\n    default:\n        return false\n    }\n}\n</code></pre>\n\n<p>Here are some examples of calling the function:</p>\n\n<pre><code>a := \"hello\"\nb := \"world\"\nc := \"hello\"\nfmt.Println(compare(&amp;a, nil))\nfmt.Println(compare(nil, &amp;a))\nfmt.Println(compare(&amp;a, &amp;b))\nfmt.Println(compare(&amp;a, &amp;a))\nfmt.Println(compare(&amp;a, &amp;c))\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/3pxjtAzIH9P\" rel=\"nofollow noreferrer\">Run it in the Playground</a></p>\n\n<p>Use the <a href=\"https://godoc.org/reflect\" rel=\"nofollow noreferrer\">reflect</a> API to compare all comparable types:</p>\n\n<pre><code>func compare(a interface{}, b interface{}) bool {\n    if a == nil &amp;&amp; b == nil {\n        return true\n    }\n    if a == nil || b == nil {\n        return false\n    }\n    va := reflect.ValueOf(a)\n    vb := reflect.ValueOf(b)\n    if va.Type() != vb.Type() {\n        return false\n    }\n    if va.Kind() == reflect.Ptr {\n        if va.IsNil() || vb.IsNil() {\n            return false\n        }\n        va = va.Elem()\n        vb = vb.Elem()\n    }\n    if !va.Type().Comparable() {\n        return false\n    }\n    return va.Interface() == vb.Interface()\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 4599888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99e9a907515cab260b1ce3124d12f741?s=128&d=identicon&r=PG&f=1", "display_name": "suz", "link": "https://stackoverflow.com/users/4599888/suz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 870, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549667637, "creation_date": 1549497066, "question_id": 54564335, "link": "https://stackoverflow.com/questions/54564335/is-there-a-way-to-compare-with-any-pointer-objects-in-golang", "title": "Is there a way to compare with any pointer objects in golang?", "body": "<p>I am trying to make a comparator, that takes either two string pointers, or two integer pointers and returns the result. any of pointer can be nil and i want true only when they have value and value is equal.</p>\n\n<p>I tried with interface like </p>\n\n<pre><code>type T *interface{}\nfunc compare(a T,b T) bool\n</code></pre>\n\n<p>because i had to check nil when cast *string to T, it is useless.</p>\n\n<p>I am expecting to call function like </p>\n\n<pre><code>var a *string\nvar b *string\nif compare(a, b){\n  // do something\n}\n</code></pre>\n\n<p>or</p>\n\n<pre><code>var a *string\nvar b *string\nif a.equal(b){ \n  // do sth \n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 6, "creation_date": 1549486780, "post_id": 54562453, "comment_id": 95923775, "body": "Reading concurrently is always safe. It&#39;s writing concurrently that gets you into trouble."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1549486872, "post_id": 54562453, "comment_id": 95923821, "body": "You rarely need a pointer to a slice. If you&#39;re passing it via a pointer so that it can be modified, then that is not safe. If you&#39;re not modifying the slice header, then there is no reason for a pointer."}, {"owner": {"reputation": 37, "user_id": 9266147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af99f68b3f97f9c4fbee353aeb5b8139?s=128&d=identicon&r=PG&f=1", "display_name": "hamochi", "link": "https://stackoverflow.com/users/9266147/hamochi"}, "edited": false, "score": 0, "creation_date": 1549487048, "post_id": 54562453, "comment_id": 95923895, "body": "You&#39;re completely right, I don&#39;t need a pointer to a slice, I forgot my go basics =)"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1549487148, "post_id": 54562453, "comment_id": 95923947, "body": "@Flimzy &quot;Reading concurrently is always safe&quot; --- this is a dangerous statement, if you have concurrent writes, then concurrent reads are not safe either."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1549522182, "post_id": 54562453, "comment_id": 95933571, "body": "@zerkms: Yes, that&#39;s what &quot;It&#39;s writing concurrently that gets you into trouble&quot; means."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1549522274, "post_id": 54562453, "comment_id": 95933607, "body": "Put another way: Reads are never the problem. Writes cause problems. Or restated: &quot;Reading concurrently is always safe.&quot;"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1549522410, "post_id": 54562453, "comment_id": 95933652, "body": "I agree, to be honest I cannot formulate it differently, yet I still can also see how it may be misread. Sorry :-)"}], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 0, "last_activity_date": 1549495366, "creation_date": 1549495366, "answer_id": 54564082, "question_id": 54562453, "link": "https://stackoverflow.com/questions/54562453/is-it-safe-to-read-concurrently-from-a-pointer/54564082#54564082", "title": "Is it safe to read concurrently from a pointer?", "body": "<p>Read-only data is usually fine for concurrent access, but you have to be very careful when passing references (pointers, slices, maps and so on) around. Today maybe no one is modifying them while you're also reading, but tomorrow someone may be.</p>\n\n<p>If this is a throwaway script, you'll be fine. But if it's part of a larger program, I'd recommend future-proofing your code by judiciously protecting concurrent access. In your case something like a <a href=\"https://golang.org/pkg/sync/#RWMutex\" rel=\"nofollow noreferrer\">reader-writer lock</a> could be a good match - all the readers will be able to acquire the lock concurrently, so the performance impact is negligible. And then if you do decide in the future this data could be modified, you already have the proper groundwork laid down w.r.t. safety.</p>\n\n<p>Don't forget to run your code with the race detector enabled.</p>\n"}], "owner": {"reputation": 37, "user_id": 9266147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af99f68b3f97f9c4fbee353aeb5b8139?s=128&d=identicon&r=PG&f=1", "display_name": "hamochi", "link": "https://stackoverflow.com/users/9266147/hamochi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1549495366, "creation_date": 1549486707, "question_id": 54562453, "link": "https://stackoverflow.com/questions/54562453/is-it-safe-to-read-concurrently-from-a-pointer", "title": "Is it safe to read concurrently from a pointer?", "body": "<p>I'm working on an image uploader and want to concurrently resize the image to different sizes. Once I've read the file as a []byte I'm passing a reference of that buffer to my resize functions that are being run concurrently. </p>\n\n<p>Is this safe? I'm thinking by passing a reference of a large file to be read by resize functions will save me memory, and the concurrency will save me time. </p>\n\n<p>Thank you!</p>\n"}, {"tags": ["go", "geo", "s2"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1549481819, "post_id": 54560147, "comment_id": 95921652, "body": "I think you need Cap.ContainsPoint. <a href=\"https://github.com/golang/geo/blob/e41ca803f92c4c1770133cfa5b4fc8249a7dbe82/s2/cap.go#L178\" rel=\"nofollow noreferrer\">github.com/golang/geo/blob/&hellip;</a>"}, {"owner": {"reputation": 11, "user_id": 8708529, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3027fe5a65796aeb86d84a2ca07a1369?s=128&d=identicon&r=PG&f=1", "display_name": "Nithin Chandra", "link": "https://stackoverflow.com/users/8708529/nithin-chandra"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1549524239, "post_id": 54560147, "comment_id": 95934417, "body": "Thanks @Not_a_Golfer , Cap.ContainsPoint is the one"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1549526327, "post_id": 54560147, "comment_id": 95935281, "body": "Maybe add your solution as an answer so people looking for it in the future can find it?"}], "answers": [{"tags": [], "owner": {"reputation": 127, "user_id": 3562600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6561bd3234fa28d0e07d7d5b6d1d3e6d?s=128&d=identicon&r=PG", "display_name": "harogaston", "link": "https://stackoverflow.com/users/3562600/harogaston"}, "is_accepted": false, "score": 0, "last_activity_date": 1594050394, "creation_date": 1594050394, "answer_id": 62759654, "question_id": 54560147, "link": "https://stackoverflow.com/questions/54560147/how-to-use-geo-s2-library-to-determine-a-latlong-lies-inside-a-radius-from-anoth/62759654#62759654", "title": "How to use geo/s2 library to determine a LatLong lies inside a radius from another LatLong in Go?", "body": "<p>[This is not my answer, but many people don't even go through the comments and may miss the information]</p>\n<p>As <a href=\"https://stackoverflow.com/users/1239701/not-a-golfer\">@not-a-golfer</a> said <a href=\"https://stackoverflow.com/questions/54560147/how-to-use-geo-s2-library-to-determine-a-latlong-lies-inside-a-radius-from-anoth/62759654#comment95921652_54560147\">in this comment</a> you should use <a href=\"https://github.com/golang/geo/blob/e41ca803f92c4c1770133cfa5b4fc8249a7dbe82/s2/cap.go#L178\" rel=\"nofollow noreferrer\">https://github.com/golang/geo/blob/e41ca803f92c4c1770133cfa5b4fc8249a7dbe82/s2/cap.go#L178</a></p>\n"}], "owner": {"reputation": 11, "user_id": 8708529, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3027fe5a65796aeb86d84a2ca07a1369?s=128&d=identicon&r=PG&f=1", "display_name": "Nithin Chandra", "link": "https://stackoverflow.com/users/8708529/nithin-chandra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 358, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1594050394, "creation_date": 1549477237, "question_id": 54560147, "link": "https://stackoverflow.com/questions/54560147/how-to-use-geo-s2-library-to-determine-a-latlong-lies-inside-a-radius-from-anoth", "title": "How to use geo/s2 library to determine a LatLong lies inside a radius from another LatLong in Go?", "body": "<p>I have tried this code , couldn't find any examples for geo/s2 for Go</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/golang/geo/s2\"\n)\n\nfunc main(){\n    rect := s2.RectFromLatLng(s2.LatLngFromDegrees(12.9279,77.6271))\n    rect = rect.AddPoint(s2.LatLngFromDegrees(12.9081,77.6476))\n    isThere := rect.ContainsLatLng(s2.LatLngFromDegrees(12.9177,77.6233))\n\n    fmt.Printf(\"%+v\", rect.Hi())\n    fmt.Printf(\"%+v\", rect.Lo())\n    println(isThere)\n\n}\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3"], "comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 2, "creation_date": 1549476237, "post_id": 54559833, "comment_id": 95919088, "body": "Python version probably silently truncates at the max as well."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1549476483, "post_id": 54559833, "comment_id": 95919197, "body": "You stated &quot;Signature Version 4 is maximum for a week&quot;. That matches the error you&#39;re receiving. So, it would seem the maximum is one week."}, {"owner": {"reputation": 162605, "user_id": 174777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6PnNW.jpg?s=128&g=1", "display_name": "John Rotenstein", "link": "https://stackoverflow.com/users/174777/john-rotenstein"}, "edited": false, "score": 0, "creation_date": 1549496869, "post_id": 54559833, "comment_id": 95927426, "body": "What is your use-case for requiring long-lived pre-signed URLs? We might be able to suggest an alternative."}, {"owner": {"reputation": 8456, "user_id": 1879101, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/knzYU.jpg?s=128&g=1", "display_name": "Vitaly Zdanevich", "link": "https://stackoverflow.com/users/1879101/vitaly-zdanevich"}, "reply_to_user": {"reputation": 162605, "user_id": 174777, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6PnNW.jpg?s=128&g=1", "display_name": "John Rotenstein", "link": "https://stackoverflow.com/users/174777/john-rotenstein"}, "edited": false, "score": 1, "creation_date": 1549522574, "post_id": 54559833, "comment_id": 95933729, "body": "@JohnRotenstein I need to have a podcast feed with audio links to a private S3. Alternative solution is to have intermediate &quot;directory&quot; with long random name."}], "answers": [{"comments": [{"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1549495576, "post_id": 54559988, "comment_id": 95927072, "body": "If you&#39;d like to expand this answer, it is worth noting that pre-signed URLs using Signature Version 2 did support extremely long expirations, but Sig V2 only works only in older regions and <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/dev/auth-request-sig-v2.html\" rel=\"nofollow noreferrer\">S3 support for Sig V2 will be discontinued in 2019</a>.  All the SDKs now use Signature V4 and you&#39;re quite correct -- the max is 1 week.  <a href=\"https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/private-content-signed-urls.html\" rel=\"nofollow noreferrer\">CloudFront signed URLs</a> support much longer expiration and CloudFront can be integrated with S3."}], "tags": [], "owner": {"reputation": 1401, "user_id": 2111274, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/oF6os.jpg?s=128&g=1", "display_name": "Jan Richter", "link": "https://stackoverflow.com/users/2111274/jan-richter"}, "is_accepted": false, "score": 1, "last_activity_date": 1549476572, "creation_date": 1549476572, "answer_id": 54559988, "question_id": 54559833, "link": "https://stackoverflow.com/questions/54559833/cannot-presign-url-for-years/54559988#54559988", "title": "Cannot presign URL for years?", "body": "<p>If you want to pre-sign URL for longer than a week, then your use case for pre-signed URLs is not valid. <a href=\"https://docs.aws.amazon.com/AmazonS3/latest/API/sigv4-query-string-auth.html\" rel=\"nofollow noreferrer\">According to the spec</a> it is really just one week.</p>\n\n<p>Pre-signed URLs are often used to serve content from S3 to authenticated users only.</p>\n"}], "owner": {"reputation": 8456, "user_id": 1879101, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/knzYU.jpg?s=128&g=1", "display_name": "Vitaly Zdanevich", "link": "https://stackoverflow.com/users/1879101/vitaly-zdanevich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 335, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1549476572, "creation_date": 1549475919, "question_id": 54559833, "link": "https://stackoverflow.com/questions/54559833/cannot-presign-url-for-years", "title": "Cannot presign URL for years?", "body": "<p>Signature Version 4 is maximum for a week. In Python I did:</p>\n\n<pre><code>s3_client = boto3.client('s3',\n                         aws_access_key_id=access_key,\n                         aws_secret_access_key=secret_key,\n                         config=botocore.client.Config(signature_version='s3')\n                         )\n\n    return s3_client.generate_presigned_url(\n        'get_object',\n        Params={\n            'Bucket': bucket_name,\n            'Key': key\n        },\n        ExpiresIn=400000000)  # this is a max: ~ten years\n</code></pre>\n\n<p>But for Go I found only <a href=\"https://github.com/aws/aws-sdk-go/blob/master/aws/request/request.go#L273\" rel=\"nofollow noreferrer\">func (*Request) Presign</a>:</p>\n\n<pre><code>req, _ := s3Client.GetObjectRequest(&amp;s3.GetObjectInput{\n    Bucket: aws.String(bucketName),\n    Key:    &amp;key,\n})\ntenYears := time.Now().AddDate(10, 0, 0).Sub(time.Now())\nurl, err := req.Presign(tenYears)\n</code></pre>\n\n<p>HTTP response for such URL is:\n<code>AuthorizationQueryParametersError: X-Amz-Expires must be less than a week (in seconds); that is, the given X-Amz-Expires must be less than 604800 seconds.</code></p>\n\n<p>No way to presign URL in Go using AWS SDK for years?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1549473778, "post_id": 54559189, "comment_id": 95917926, "body": "What exactly is the problem you&#39;re trying to solve?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1549473955, "post_id": 54559189, "comment_id": 95918027, "body": "panics are not exceptions, they are intended to indicate a problem with the program and crash."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1549474145, "post_id": 54559189, "comment_id": 95918153, "body": "If err isn&#39;t nil, resp is. Your deferred function will panic <i>again</i> due to a nil-pointer dereference."}, {"owner": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "edited": false, "score": 0, "creation_date": 1549474374, "post_id": 54559189, "comment_id": 95918255, "body": "Sorry, everyone for my lameness, I just want to exit safely from the goroutine in any other case where error arises, that&#39;s all :)"}, {"owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 1, "creation_date": 1549476122, "post_id": 54559189, "comment_id": 95919036, "body": "Your Update 2 code deadlocks if there is no error! It tries to send a message twice when it succeeds. The playground always fails which is why it is working fine there."}, {"owner": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "reply_to_user": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 0, "creation_date": 1549477511, "post_id": 54559189, "comment_id": 95919646, "body": "No, @StephenWeinberg it doesn&#39;t deadlock"}, {"owner": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "reply_to_user": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 0, "creation_date": 1549478759, "post_id": 54559189, "comment_id": 95920219, "body": "@StephenWeinberg Why do you create a new goroutine func() to handle wg.Wait() , why not do it in the main thread itself ?"}], "answers": [{"comments": [{"owner": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "edited": false, "score": 0, "creation_date": 1549475334, "post_id": 54559435, "comment_id": 95918695, "body": "So, how do I handle that chan to not hang, I assume there could be two ways, first I send something to it even in case of error or I should change the code in <code>main</code> to handle input from chan differently , am I correct ? If so, can you give some example for the same, it would be great help. Thanks."}, {"owner": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "reply_to_user": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "edited": false, "score": 0, "creation_date": 1549475649, "post_id": 54559435, "comment_id": 95918846, "body": "Yes, definitely <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#dont-panic\" rel=\"nofollow noreferrer\">don&#39;t panic</a> @temporarya, this is one of the <a href=\"https://go-proverbs.github.io/\" rel=\"nofollow noreferrer\">go-proverbs</a>"}, {"owner": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "edited": false, "score": 0, "creation_date": 1549477669, "post_id": 54559435, "comment_id": 95919719, "body": "@Stephen Weinberg Why do you create a new goroutine <code>func()</code> to handle <code>wg.Wait()</code> , why not do it in the main thread itself ?"}, {"owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "edited": false, "score": 2, "creation_date": 1549479960, "post_id": 54559435, "comment_id": 95920816, "body": "Try it. If you are waiting for the wait group you are not listening on the channel. If you are not listening on the channel, you will deadlock."}], "tags": [], "owner": {"reputation": 43554, "user_id": 727643, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RIm6q.jpg?s=128&g=1", "display_name": "Stephen Weinberg", "link": "https://stackoverflow.com/users/727643/stephen-weinberg"}, "is_accepted": true, "score": 8, "last_activity_date": 1549475937, "last_edit_date": 1549475937, "creation_date": 1549474451, "answer_id": 54559435, "question_id": 54559189, "link": "https://stackoverflow.com/questions/54559189/how-do-i-handle-panic-in-goroutines/54559435#54559435", "title": "How do I handle panic in goroutines?", "body": "<p>You are using recover correctly. You have two problems:</p>\n\n<ol>\n<li><p>You are using panic incorrectly. You should only panic when there was a programming error. Avoid using panics unless you believe taking down the program is a reasonable response to what happened. In this case, I would just return the error, not panic.</p></li>\n<li><p>You are panicing during your panic. What is happening is that you are first panicing at <code>panic(err)</code>. Then in your defer function, you are panicing at <code>resp.Body.Close()</code>. When http.Get returns an error, it returns a nil response. That means that <code>resp.Body.Close()</code> is acting on a nil value.</p></li>\n</ol>\n\n<p>The idiomatic way to handle this would be something like the following:</p>\n\n<pre><code>func MakeRequest(url string, ch chan&lt;- string, wg *sync.WaitGroup) {\n    defer wg.Done()\n    start := time.Now()\n    resp, err := http.Get(url)\n    if err != nil {\n        //handle error without panicing\n    }\n    // there was no error, so resp.Body is guaranteed to exist.\n    defer resp.Body.Close()\n    ...\n</code></pre>\n\n<hr>\n\n<p><strong>Response to update:</strong> If<code>http.Get()</code> returns an error, you never send on the channel. At some point all goroutines except the main goroutine stop running and the main goroutine is waiting on <code>&lt;-ch</code>. Since that channel receive will never complete and there is nothing else for the Go runtime to schedule, it panics (unrecoverably).</p>\n\n<hr>\n\n<p><strong>Response to comment:</strong> To ensure the channel doesn't hang, you need some sort of coordination to know when messages will stop coming. How this is implemented depends on your real program, and an example cannot necessarily extrapolate to reality. For this example, I would simply close the channel when the WaitGroup is done.</p>\n\n<p><a href=\"https://play.golang.org/p/E3CAYRN8u7h\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<pre><code>func main() {\n    var wg sync.WaitGroup\n    output := []string{\n        \"https://www.facebook.com\",\n        \"\",\n    }\n    start := time.Now()\n    ch := make(chan string)\n    for _, url := range output {\n        wg.Add(1)\n        go MakeRequest(url, ch, &amp;wg)\n    }\n\n    go func() {\n        wg.Wait()\n        close(ch)\n    }()\n\n    for val := range ch {\n        fmt.Println(val)\n    }\n    fmt.Printf(\"%.2fs elapsed\\n\", time.Since(start).Seconds())\n}\n</code></pre>\n"}], "owner": {"reputation": 465, "user_id": 10908624, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-p2CK2T6EA2E/AAAAAAAAAAI/AAAAAAAAAAA/AKxrwcZ0eyA5GJd_mDTMTRsg4hB-iscplQ/mo/photo.jpg?sz=128", "display_name": "temporarya", "link": "https://stackoverflow.com/users/10908624/temporarya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1947, "favorite_count": 1, "accepted_answer_id": 54559435, "answer_count": 1, "score": 2, "last_activity_date": 1549475937, "creation_date": 1549473635, "last_edit_date": 1549475551, "question_id": 54559189, "link": "https://stackoverflow.com/questions/54559189/how-do-i-handle-panic-in-goroutines", "title": "How do I handle panic in goroutines?", "body": "<p>I am quite new to <code>golang</code>.So, please spare me the sword ( if possible ).</p>\n\n<p>I was trying to get data from the web by studying the tutorial <a href=\"https://blog.narenarya.in/concurrent-http-in-go.html\" rel=\"nofollow noreferrer\">here</a></p>\n\n<p>Now, the tutorial goes all well, but I wanted to check for edge cases and error-handling ( just to be thorough with my new learning of the language, don't want to be the one with half-baked knowledge ).</p>\n\n<p>Here's my <a href=\"https://play.golang.org/p/cwrs6jBqHBa\" rel=\"nofollow noreferrer\">go-playground code</a>.</p>\n\n<p>Before asking I looked at a lot of references like :</p>\n\n<ol>\n<li><a href=\"https://blog.golang.org/defer-panic-and-recover\" rel=\"nofollow noreferrer\">Go blog defer,panic and recover</a></li>\n<li><a href=\"https://stackoverflow.com/questions/50409011/handling-panics-in-go-routines\">handling panics in goroutines</a></li>\n<li><a href=\"https://stackoverflow.com/questions/43058841/how-should-i-write-goroutine\">how-should-i-write-goroutine </a></li>\n</ol>\n\n<p>And a few more, however I couldn't figure it out much.</p>\n\n<p>Here's the code in case you don't want to go to the playground ( for reasons yet unknown to man ) :</p>\n\n<pre><code>// MakeRequest : Makes requests concurrently\nfunc MakeRequest(url string, ch chan&lt;- string, wg *sync.WaitGroup) {\n    start := time.Now()\n    resp, err := http.Get(url)\n    defer func() {\n        resp.Body.Close()\n        wg.Done()\n            if r := recover(); r != nil {\n                fmt.Println(\"Recovered in f\", r)\n            }\n    }()\n    if err != nil {\n        fmt.Println(err)\n        panic(err)\n    }\n    secs := time.Since(start).Seconds()\n    body, _ := ioutil.ReadAll(resp.Body)\n\n    ch &lt;- fmt.Sprintf(\"%.2f elapsed with response length: %d %s\", secs, len(body), url)\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n    output := []string{\n        \"https://www.facebook.com\",\n        \"\",\n    }\n    start := time.Now()\n    ch := make(chan string)\n    for _, url := range output {\n        wg.Add(1)\n        go MakeRequest(url, ch, &amp;wg)\n    }\n\n    for range output {\n        fmt.Println(&lt;-ch)\n    }\n    fmt.Printf(\"%.2fs elapsed\\n\", time.Since(start).Seconds())\n}\n</code></pre>\n\n<h2>Update</h2>\n\n<p>I changed the code to ( let's say ) handle the error in goroutine like this ( <a href=\"https://play.golang.org/p/_uqME3rf5eQ\" rel=\"nofollow noreferrer\">go-playground here</a> ):  </p>\n\n<pre><code>func MakeRequest(url string, ch chan&lt;- string, wg *sync.WaitGroup) {\n    start := time.Now()\n    resp, err := http.Get(url)\n\n    if err == nil {\n        secs := time.Since(start).Seconds()\n        body, _ := ioutil.ReadAll(resp.Body)\n\n        ch &lt;- fmt.Sprintf(\"%.2f elapsed with response length: %d %s\", secs, len(body), url)\n        // fmt.Println(err)\n        // panic(err)\n    }\n    defer wg.Done()\n}\n</code></pre>\n\n<h3>Update 2 :</h3>\n\n<p>After an answer I changed the code to this and it successfully removes the <code>chan</code> deadlock, however now I need to handle this in <code>main</code> :</p>\n\n<pre><code>func MakeRequest(url string, ch chan&lt;- string, wg *sync.WaitGroup) {\n    defer wg.Done()\n    start := time.Now()\n    resp, err := http.Get(url)\n\n    if err == nil {\n        secs := time.Since(start).Seconds()\n        body, _ := ioutil.ReadAll(resp.Body)\n\n        ch &lt;- fmt.Sprintf(\"%.2f elapsed with response length: %d %s\", secs, len(body), url)\n        // fmt.Println(err)\n        // panic(err)\n    }\n    // defer resp.Body.Close()\n    ch &lt;- fmt.Sprintf(\"\")\n}\n</code></pre>\n\n<p>Isn't there a more <strong>elegant</strong> way to handle this ?</p>\n\n<p>But now I get locked up in deadlock.</p>\n\n<p>Thanks and regards.<br>\nTemporarya<br>\n( a golang noobie )</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 4, "creation_date": 1549471397, "post_id": 54558527, "comment_id": 95916643, "body": "What you&#39;re looking for is not possible; documentation is not included in the compiled output."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1549471452, "post_id": 54558527, "comment_id": 95916679, "body": "Not at runtime within your app (comments aren&#39;t included in the binary), but there&#39;s always <code>go doc</code> while you&#39;re working."}, {"owner": {"reputation": 383, "user_id": 636635, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/qFPpL.jpg?s=128&g=1", "display_name": "xsigndll", "link": "https://stackoverflow.com/users/636635/xsigndll"}, "edited": false, "score": 0, "creation_date": 1549471675, "post_id": 54558527, "comment_id": 95916810, "body": "It would be ok for me to parse the file and read it. Any shortcut functions available for that? I\u2018m currently fiddling around with go/ast but it\u2018s kinda tricky. I was thinking that there may be an easier solution?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1549471819, "post_id": 54558527, "comment_id": 95916890, "body": "Use the <a href=\"https://godoc.org/go/doc\" rel=\"nofollow noreferrer\">go/doc</a> package to extract documentation from source code."}, {"owner": {"reputation": 383, "user_id": 636635, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/qFPpL.jpg?s=128&g=1", "display_name": "xsigndll", "link": "https://stackoverflow.com/users/636635/xsigndll"}, "edited": false, "score": 1, "creation_date": 1549471915, "post_id": 54558527, "comment_id": 95916945, "body": "Uhm... i\u2018m kinda puzzled that i haven\u2018t found THAT one. Thanks."}, {"owner": {"reputation": 16010, "user_id": 1568658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FPSGe.jpg?s=128&g=1", "display_name": "user218867", "link": "https://stackoverflow.com/users/1568658/user218867"}, "edited": false, "score": 0, "creation_date": 1549483351, "post_id": 54558527, "comment_id": 95922283, "body": "<code>go doc</code> command?"}], "answers": [{"comments": [{"owner": {"reputation": 383, "user_id": 636635, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/qFPpL.jpg?s=128&g=1", "display_name": "xsigndll", "link": "https://stackoverflow.com/users/636635/xsigndll"}, "edited": false, "score": 0, "creation_date": 1549472170, "post_id": 54558739, "comment_id": 95917099, "body": "Thanks. I was actually looking for go/doc which receives the AST and delivers a shortcut for getting func docs."}, {"owner": {"reputation": 7617, "user_id": 1364007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d106de3dec9586b56ed7f110497689e?s=128&d=identicon&r=PG", "display_name": "Wai Ha Lee", "link": "https://stackoverflow.com/users/1364007/wai-ha-lee"}, "edited": false, "score": 0, "creation_date": 1549484174, "post_id": 54558739, "comment_id": 95922642, "body": "This is a link-only answer - if the link dies, the answer contains no useful information. See <a href=\"https://meta.stackexchange.com/q/8231/284827\">Are answers that just contain links elsewhere really &quot;good answers&quot;?</a> or <a href=\"https://meta.stackexchange.com/q/225370/284827\">Your answer is in another castle: when is an answer not an answer?</a> for more information."}, {"owner": {"reputation": 608, "user_id": 4823789, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/16701fdace0347de7dbf1c356d295e76?s=128&d=identicon&r=PG&f=1", "display_name": "ND003", "link": "https://stackoverflow.com/users/4823789/nd003"}, "reply_to_user": {"reputation": 7617, "user_id": 1364007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d106de3dec9586b56ed7f110497689e?s=128&d=identicon&r=PG", "display_name": "Wai Ha Lee", "link": "https://stackoverflow.com/users/1364007/wai-ha-lee"}, "edited": false, "score": 0, "creation_date": 1549541815, "post_id": 54558739, "comment_id": 95943979, "body": "@WaiHaLee Agreed and changed"}], "tags": [], "owner": {"reputation": 608, "user_id": 4823789, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/16701fdace0347de7dbf1c356d295e76?s=128&d=identicon&r=PG&f=1", "display_name": "ND003", "link": "https://stackoverflow.com/users/4823789/nd003"}, "is_accepted": false, "score": 0, "last_activity_date": 1549541768, "last_edit_date": 1549541768, "creation_date": 1549472029, "answer_id": 54558739, "question_id": 54558527, "link": "https://stackoverflow.com/questions/54558527/how-to-get-func-documentation-in-golang/54558739#54558739", "title": "How to get func documentation in golang?", "body": "<p>You can use the godoc tool to generate documentation.</p>\n\n<p>Check the following link\n<a href=\"https://blog.golang.org/godoc-documenting-go-code\" rel=\"nofollow noreferrer\">https://blog.golang.org/godoc-documenting-go-code</a></p>\n\n<p>It should give what you are looking for</p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 7, "last_activity_date": 1549472781, "creation_date": 1549472781, "answer_id": 54558947, "question_id": 54558527, "link": "https://stackoverflow.com/questions/54558527/how-to-get-func-documentation-in-golang/54558947#54558947", "title": "How to get func documentation in golang?", "body": "<p>Use the <a href=\"https://godoc.org/go/doc\" rel=\"noreferrer\">go/doc</a> package to extract documentation from source code.</p>\n"}, {"tags": [], "owner": {"reputation": 383, "user_id": 636635, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/qFPpL.jpg?s=128&g=1", "display_name": "xsigndll", "link": "https://stackoverflow.com/users/636635/xsigndll"}, "is_accepted": false, "score": 1, "last_activity_date": 1549614914, "creation_date": 1549614914, "answer_id": 54588577, "question_id": 54558527, "link": "https://stackoverflow.com/questions/54558527/how-to-get-func-documentation-in-golang/54588577#54588577", "title": "How to get func documentation in golang?", "body": "<p>Just in case someone needs the code, I'll post it here. It may be a bit ugly still, but works fine for my scenarios. You may adjust it upon your own needs.</p>\n\n<pre><code>package funcreader\n\nimport (\n    \"go/ast\"\n    \"go/doc\"\n    \"go/parser\"\n    \"go/token\"\n    \"path/filepath\"\n    \"reflect\"\n    \"runtime\"\n    \"strings\"\n)\n\n// Get the name and path of a func\nfunc FuncPathAndName(f interface{}) string {\n    return runtime.FuncForPC(reflect.ValueOf(f).Pointer()).Name()\n}\n\n// Get the name of a func (with package path)\nfunc FuncName(f interface{}) string {\n    splitFuncName := strings.Split(FuncPathAndName(f), \".\")\n    return splitFuncName[len(splitFuncName)-1]\n}\n\n// Get description of a func\nfunc FuncDescription(f interface{}) string {\n    fileName, _ := runtime.FuncForPC(reflect.ValueOf(f).Pointer()).FileLine(0)\n    funcName := FuncName(f)\n    fset := token.NewFileSet()\n\n    // Parse src\n    parsedAst, err := parser.ParseFile(fset, fileName, nil, parser.ParseComments)\n    if err != nil {\n        log.Fatal(err)\n        return \"\"\n    }\n\n    pkg := &amp;ast.Package{\n        Name:  \"Any\",\n        Files: make(map[string]*ast.File),\n    }\n    pkg.Files[fileName] = parsedAst\n\n    importPath, _ := filepath.Abs(\"/\")\n    myDoc := doc.New(pkg, importPath, doc.AllDecls)\n    for _, theFunc := range myDoc.Funcs {\n        if theFunc.Name == funcName {\n            return theFunc.Doc\n        }\n    }\n    return \"\"\n}\n</code></pre>\n"}], "owner": {"reputation": 383, "user_id": 636635, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/qFPpL.jpg?s=128&g=1", "display_name": "xsigndll", "link": "https://stackoverflow.com/users/636635/xsigndll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1177, "favorite_count": 1, "accepted_answer_id": 54558947, "answer_count": 3, "score": 3, "last_activity_date": 1549614914, "creation_date": 1549471358, "last_edit_date": 1549471755, "question_id": 54558527, "link": "https://stackoverflow.com/questions/54558527/how-to-get-func-documentation-in-golang", "title": "How to get func documentation in golang?", "body": "<p>How can I get the func description within go code?</p>\n\n<pre><code>// My very nice description\nfunc myFunc() { ... }\n</code></pre>\n\n<p>I'd like to have <code>My very nice description</code>.</p>\n\n<p>Getting the name of a func is pretty straight forward:</p>\n\n<pre><code>runtime.FuncForPC(reflect.ValueOf(myFunc).Pointer()).Name()\n</code></pre>\n\n<p>Is there something similar for the documentation? It would be ok for me to parse the original go file. Any shortcuts there?</p>\n"}, {"tags": ["google-app-engine", "go", "testing"], "answers": [{"tags": [], "owner": {"reputation": 1166, "user_id": 9745709, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iiwwL.png?s=128&g=1", "display_name": "Pablo Alm&#233;cija Rodr&#237;guez", "link": "https://stackoverflow.com/users/9745709/pablo-alm%c3%a9cija-rodr%c3%adguez"}, "is_accepted": false, "score": 2, "last_activity_date": 1549470789, "creation_date": 1549470789, "answer_id": 54558356, "question_id": 54557831, "link": "https://stackoverflow.com/questions/54557831/where-to-put-test-codes-for-gae-go-project/54558356#54558356", "title": "Where to put test codes for GAE/Go project?", "body": "<p>Same as when you are creating the folder structure in java to put your tests in, in Go, it is not related to the fact that you have your application deployed in GAE. Go does not use a specific patch for the tests, but specific syntax for the test methods.\nHere there is a useful guide on <a href=\"https://www.toptal.com/go/your-introductory-course-to-testing-with-go\" rel=\"nofollow noreferrer\">how to get started with testing in Go</a> including good practices, and also the <a href=\"https://golang.org/pkg/testing/\" rel=\"nofollow noreferrer\">official documentation related to testing</a>, in which they specify</p>\n\n<blockquote>\n  <p>Package testing provides support for automated testing of Go packages. It is intended to be used in concert with the \u201cgo test\u201d command, which automates execution of any function of the form <code>func TestXxx(*testing.T)</code></p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 1772, "user_id": 4706119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e597fc1530bb59898a572f5625417851?s=128&d=identicon&r=PG&f=1", "display_name": "hutabalian", "link": "https://stackoverflow.com/users/4706119/hutabalian"}, "is_accepted": false, "score": 0, "last_activity_date": 1549474003, "creation_date": 1549474003, "answer_id": 54559311, "question_id": 54557831, "link": "https://stackoverflow.com/questions/54557831/where-to-put-test-codes-for-gae-go-project/54559311#54559311", "title": "Where to put test codes for GAE/Go project?", "body": "<p>Well, if you're asking for the convention, you should put the file in the same package as the one being tested, as pointed out <a href=\"https://golang.org/pkg/testing\" rel=\"nofollow noreferrer\">here</a>. And 1 package means 1 directory. </p>\n\n<p>You can have something like this:</p>\n\n<pre><code>rootdir/\n    main.go\n    main_test.go\n        feature/\n            feature.go\n            feature_test.go\n</code></pre>\n"}], "owner": {"reputation": 2594, "user_id": 3090068, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/69636a28e85f584b8f264495494f3de0?s=128&d=identicon&r=PG&f=1", "display_name": "Yuki Inoue", "link": "https://stackoverflow.com/users/3090068/yuki-inoue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "closed_date": 1549521015, "answer_count": 2, "score": 0, "last_activity_date": 1549474003, "creation_date": 1549469235, "last_edit_date": 1549472626, "question_id": 54557831, "link": "https://stackoverflow.com/questions/54557831/where-to-put-test-codes-for-gae-go-project", "closed_reason": "Duplicate", "title": "Where to put test codes for GAE/Go project?", "body": "<p>I'm developing a project which is using GAE/Go. In Java, you usually put all the test code in <code>${PROJECT_ROOT}/src/test/java</code>. In Rails, you put them in, for example, <code>${PROJECT_ROOT}/spec</code>.</p>\n\n<h3>Question</h3>\n\n<p>Where do I put test codes for GAE/Go project?  Is there any recommendation/convention?</p>\n"}, {"tags": ["go", "byte", "computer-science", "bit"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 7224809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de16967b33adb38822b5c2ec3090feea?s=128&d=identicon&r=PG", "display_name": "jpincas", "link": "https://stackoverflow.com/users/7224809/jpincas"}, "edited": false, "score": 0, "creation_date": 1549475258, "post_id": 54557561, "comment_id": 95918654, "body": "I cannot thank you enough for this - you really understood the level of help I needed.  I need to study it for a while and work out which one will be best.  I&#39;ll report back here once I&#39;ve done it.  Thanks again."}, {"owner": {"reputation": 35, "user_id": 7224809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de16967b33adb38822b5c2ec3090feea?s=128&d=identicon&r=PG", "display_name": "jpincas", "link": "https://stackoverflow.com/users/7224809/jpincas"}, "edited": false, "score": 0, "creation_date": 1549476896, "post_id": 54557561, "comment_id": 95919366, "body": "OK - I adapted your second solution to get to something that finally works!! Since I have only the written <code>[]byte</code>, not the original number, I have created these 2 functions:<code>func flipFloat(b []byte) []byte { \tif b[0]&gt;&gt;7 &gt; 0 { \t\tfor i, bb := range b { \t\t\tb[i] = ^bb \t\t} \t} else { \t\tb[0] ^= 0x80 \t}  \treturn b }  func flipFloatBack(b []byte) []byte { \tif b[0]&gt;&gt;7 &gt; 0 { \t\tb[0] ^= 0x80 \t} else { \t\tfor i, bb := range b { \t\t\tb[i] = ^bb \t\t} \t}  \treturn b }</code>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1549475595, "last_edit_date": 1549475595, "creation_date": 1549468290, "answer_id": 54557561, "question_id": 54557158, "link": "https://stackoverflow.com/questions/54557158/byte-ordering-of-floats/54557561#54557561", "title": "Byte ordering of floats", "body": "<h2>Using <code>math.Float64bits()</code></h2>\n\n<p>You could use <a href=\"https://golang.org/pkg/math/#Float64bits\" rel=\"nofollow noreferrer\"><code>math.Float64bits()</code></a> which returns an <code>uint64</code> value having the same bytes / bits as the <code>float64</code> value passed to it.</p>\n\n<p>Once you have an <code>uint64</code>, performing bitwise operations on it is trivial:</p>\n\n<pre><code>f := 1.0 // Some float64 value\n\nbits := math.Float64bits(f)\nif f &gt;= 0 {\n    bits ^= 0x8000000000000000\n} else {\n    bits ^= 0xffffffffffffffff\n}\n</code></pre>\n\n<p>Then serialize the <code>bits</code> value instead of the <code>f</code> float64 value, and you're done.</p>\n\n<p>Let's see this in action. Let's create a wrapper type holding a <code>float64</code> number and its bytes:</p>\n\n<pre><code>type num struct {\n    f    float64\n    data [8]byte\n}\n</code></pre>\n\n<p>Let's create a slice of these <code>num</code>s:</p>\n\n<pre><code>nums := []*num{\n    {f: 1.0},\n    {f: 2.0},\n    {f: 0.0},\n    {f: -1.0},\n    {f: -2.0},\n    {f: math.Pi},\n}\n</code></pre>\n\n<p>Serializing them:</p>\n\n<pre><code>for _, n := range nums {\n    bits := math.Float64bits(n.f)\n    if n.f &gt;= 0 {\n        bits ^= 0x8000000000000000\n    } else {\n        bits ^= 0xffffffffffffffff\n    }\n    if err := binary.Write(bytes.NewBuffer(n.data[:0]), binary.BigEndian, bits); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>This is how we can sort them byte-wise:</p>\n\n<pre><code>sort.Slice(nums, func(i int, j int) bool {\n    ni, nj := nums[i], nums[j]\n    for k := range ni.data {\n        if bi, bj := ni.data[k], nj.data[k]; bi &lt; bj {\n            return true // We're certain it's less\n        } else if bi &gt; bj {\n            return false // We're certain it's not less\n        } // We have to check the next byte\n    }\n    return false // If we got this far, they are equal (=&gt; not less)\n})\n</code></pre>\n\n<p>And now let's see the order after byte-wise sorting:</p>\n\n<pre><code>fmt.Println(\"Final order byte-wise:\")\nfor _, n := range nums {\n    fmt.Printf(\"% .7f %3v\\n\", n.f, n.data)\n}\n</code></pre>\n\n<p>Output will be (try it on the <a href=\"https://play.golang.org/p/dEZD_0c8gj8\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Final order byte-wise:\n-2.0000000 [ 63 255 255 255 255 255 255 255]\n-1.0000000 [ 64  15 255 255 255 255 255 255]\n 0.0000000 [128   0   0   0   0   0   0   0]\n 1.0000000 [191 240   0   0   0   0   0   0]\n 2.0000000 [192   0   0   0   0   0   0   0]\n 3.1415927 [192   9  33 251  84  68  45  24]\n</code></pre>\n\n<h2>Without <code>math.Float64bits()</code></h2>\n\n<p>Another option would be to first serialize the <code>float64</code> value, and then perform XOR operations on the bytes.</p>\n\n<p>If the number is positive (or zero), XOR the first byte with <code>0x80</code>, and the rest with <code>0x00</code>, which is basically do nothing with them.</p>\n\n<p>If the number is negative, XOR all the bytes with <code>0xff</code>, which is basically a bitwise negation.</p>\n\n<p>In action: the only part that is different is the serialization and XOR operations:</p>\n\n<pre><code>for _, n := range nums {\n    if err := binary.Write(bytes.NewBuffer(n.data[:0]), binary.BigEndian, n.f); err != nil {\n        panic(err)\n    }\n    if n.f &gt;= 0 {\n        n.data[0] ^= 0x80\n    } else {\n        for i, b := range n.data {\n            n.data[i] = ^b\n        }\n    }\n}\n</code></pre>\n\n<p>The rest is the same. The output will also be the same. Try this one on the <a href=\"https://play.golang.org/p/GnqizrcfbP6\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 35, "user_id": 7224809, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de16967b33adb38822b5c2ec3090feea?s=128&d=identicon&r=PG", "display_name": "jpincas", "link": "https://stackoverflow.com/users/7224809/jpincas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 110, "favorite_count": 0, "accepted_answer_id": 54557561, "answer_count": 1, "score": 3, "last_activity_date": 1549475595, "creation_date": 1549467065, "question_id": 54557158, "link": "https://stackoverflow.com/questions/54557158/byte-ordering-of-floats", "title": "Byte ordering of floats", "body": "<p>I'm working on Tormenta (<a href=\"https://github.com/jpincas/tormenta\" rel=\"nofollow noreferrer\">https://github.com/jpincas/tormenta</a>) which is backed by BadgerDB (<a href=\"https://github.com/dgraph-io/badger\" rel=\"nofollow noreferrer\">https://github.com/dgraph-io/badger</a>).  BadgerDB stores keys (slices of bytes) in byte order. I am creating keys which contain floats which need to be stored in order so I can user Badger's key iteration properly. I don't have a solid CS background so I'm a little out of my depth.</p>\n\n<p>I encode the floats like this: <code>binary.Write(buf, binary.BigEndian, myFloat)</code>. This works fine for positive floats - the key order is what you'd expect, but the byte ordering breaks down for negative floats.</p>\n\n<p>As an aside, ints present the same problem, but I was able to fix that relatively easily by flipping the sign bit on the int with <code>b[0] ^= 1 &lt;&lt; 7</code> (where <code>b</code> is the <code>[]byte</code> holding the result of encoding the int), and then flipping back when retrieving the key.</p>\n\n<p>Although <code>b[0] ^= 1 &lt;&lt; 7</code> DOES also flip the sign bit on floats and thus places all the negative floats before the positive ones, the negative ones are incorrectly (backwards) ordered. It is necessary to flip the sign bit and reverse the order of the negative floats.</p>\n\n<p>A similar question was asked on StackOverflow here: <a href=\"https://stackoverflow.com/questions/43299299/sorting-floating-point-values-using-their-byte-representation\">Sorting floating-point values using their byte-representation</a>, and the solution was agreed to be:</p>\n\n<blockquote>\n  <p>XOR all positive numbers with 0x8000... and negative numbers with 0xffff.... This should flip the sign bit on both (so negative numbers go first), and then reverse the ordering on negative numbers.</p>\n</blockquote>\n\n<p>However, that's way above my bit-flipping-skills level, so I was hoping a Go bit-ninja could help me translate that into some Go code.</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1549462910, "post_id": 54555291, "comment_id": 95911205, "body": "Try setting <a href=\"https://github.com/aws/aws-sdk-go/blob/a11bbbbaa2d8da66e392810bdb9fdb83acf5bff0/aws/config.go#L42\" rel=\"nofollow noreferrer\"><code>Config.Credentials</code></a> using the <a href=\"https://github.com/aws/aws-sdk-go/blob/a11bbbbaa2d8da66e392810bdb9fdb83acf5bff0/aws/credentials/credentials.go#L67\" rel=\"nofollow noreferrer\"><code>credentials.AnonymousCredentials</code></a> value. (<a href=\"https://docs.aws.amazon.com/sdk-for-go/api/aws/credentials/#AnonymousCredentials\" rel=\"nofollow noreferrer\">link to docs</a>)"}, {"owner": {"reputation": 390, "user_id": 2481981, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6b557fbb677f7cc2fd8647f723195ffb?s=128&d=identicon&r=PG", "display_name": "Sreenath", "link": "https://stackoverflow.com/users/2481981/sreenath"}, "edited": false, "score": 0, "creation_date": 1553856669, "post_id": 54555291, "comment_id": 97550466, "body": "is it possible to download a folder?"}], "answers": [{"comments": [{"owner": {"reputation": 390, "user_id": 2481981, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/6b557fbb677f7cc2fd8647f723195ffb?s=128&d=identicon&r=PG", "display_name": "Sreenath", "link": "https://stackoverflow.com/users/2481981/sreenath"}, "edited": false, "score": 1, "creation_date": 1553856623, "post_id": 54556148, "comment_id": 97550438, "body": "how can i download a folder?"}], "tags": [], "owner": {"reputation": 935, "user_id": 10391130, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CBVYnKKBv5w/AAAAAAAAAAI/AAAAAAAAAEc/bw1Ub6elbng/photo.jpg?sz=128", "display_name": "Madhuka Wickramapala", "link": "https://stackoverflow.com/users/10391130/madhuka-wickramapala"}, "is_accepted": true, "score": 1, "last_activity_date": 1549512800, "last_edit_date": 1549512800, "creation_date": 1549464064, "answer_id": 54556148, "question_id": 54555291, "link": "https://stackoverflow.com/questions/54555291/how-to-download-from-public-s3-bucket-using-golang/54556148#54556148", "title": "How to download from public s3 bucket using golang", "body": "<p>We can set <code>Credentials: credentials.AnonymousCredentials</code> when creating session. Following is the working code.</p>\n\n<pre><code>func DownloadFromS3Bucket(bucket, item, path string) {\n    file, err := os.Create(filepath.Join(path, item))\n    if err != nil {\n        fmt.Printf(\"Error in downloading from file: %v \\n\", err)\n        os.Exit(1)\n    }\n\n    defer file.Close()\n\n    sess, _ := session.NewSession(&amp;aws.Config{\n        Region: aws.String(constants.AWS_REGION), Credentials: credentials.AnonymousCredentials},\n    )\n\n    // Create a downloader with the session and custom options\n    downloader := s3manager.NewDownloader(sess, func(d *s3manager.Downloader) {\n        d.PartSize = 64 * 1024 * 1024 // 64MB per part\n        d.Concurrency = 6\n    })\n\n    numBytes, err := downloader.Download(file,\n        &amp;s3.GetObjectInput{\n            Bucket: aws.String(bucket),\n            Key:    aws.String(item),\n        })\n    if err != nil {\n        fmt.Printf(\"Error in downloading from file: %v \\n\", err)\n        os.Exit(1)\n    }\n\n    fmt.Println(\"Download completed\", file.Name(), numBytes, \"bytes\")\n}\n</code></pre>\n"}], "owner": {"reputation": 935, "user_id": 10391130, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CBVYnKKBv5w/AAAAAAAAAAI/AAAAAAAAAEc/bw1Ub6elbng/photo.jpg?sz=128", "display_name": "Madhuka Wickramapala", "link": "https://stackoverflow.com/users/10391130/madhuka-wickramapala"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1514, "favorite_count": 0, "accepted_answer_id": 54556148, "answer_count": 1, "score": 1, "last_activity_date": 1549562631, "creation_date": 1549461356, "question_id": 54555291, "link": "https://stackoverflow.com/questions/54555291/how-to-download-from-public-s3-bucket-using-golang", "title": "How to download from public s3 bucket using golang", "body": "<p>I'm implementing a function to download a file from an s3 bucket. This worked fine when the bucket was private and I set the credentials</p>\n\n<pre><code>os.Setenv(\"AWS_ACCESS_KEY_ID\", \"test\")\nos.Setenv(\"AWS_SECRET_ACCESS_KEY\", \"test\")\n</code></pre>\n\n<p>However, I made the s3 bucket public as described in <a href=\"https://www.simplified.guide/aws/create-public-s3-bucket\" rel=\"nofollow noreferrer\">here</a> and now I want to download it without credentials.</p>\n\n<pre><code>func DownloadFromS3Bucket(bucket, item, path string) {\n    file, err := os.Create(filepath.Join(path, item))\n    if err != nil {\n        fmt.Printf(\"Error in downloading from file: %v \\n\", err)\n        os.Exit(1)\n    }\n\n    defer file.Close()\n\n    sess, _ := session.NewSession(&amp;aws.Config{\n        Region: aws.String(constants.AWS_REGION)},\n    )\n\n    // Create a downloader with the session and custom options\n    downloader := s3manager.NewDownloader(sess, func(d *s3manager.Downloader) {\n        d.PartSize = 64 * 1024 * 1024 // 64MB per part\n        d.Concurrency = 6\n    })\n\n    numBytes, err := downloader.Download(file,\n        &amp;s3.GetObjectInput{\n            Bucket: aws.String(bucket),\n            Key:    aws.String(item),\n        })\n    if err != nil {\n        fmt.Printf(\"Error in downloading from file: %v \\n\", err)\n        os.Exit(1)\n    }\n\n    fmt.Println(\"Download completed\", file.Name(), numBytes, \"bytes\")\n}\n</code></pre>\n\n<p>But now I'm getting an error.</p>\n\n<pre><code>Error in downloading from file: NoCredentialProviders: no valid providers in chain. Deprecated.\n    For verbose messaging see aws.Config.CredentialsChainVerboseErrors\n</code></pre>\n\n<p>Any idea how to download it without credentials?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1549556194, "post_id": 54552516, "comment_id": 95952805, "body": ":D I&#39;ve had to answer a similar interview question long ago and far away, especially the bit about fetching images using routines that you&#39;ve since added to your question :D  Using SO to blag your way to an interview... naughty!"}], "answers": [{"comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1549465882, "post_id": 54552987, "comment_id": 95913130, "body": "first loop doesn&#39;t seem to use <code>idx</code>, so should be <code>for _, input := range inputs</code>. Also: <code>outs := map[int]output{}</code> is shorter to write"}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1549467115, "post_id": 54552987, "comment_id": 95913915, "body": "&quot;shorter to write&quot; is certainly preference, but I take the first point. Making edits"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1549467613, "post_id": 54552987, "comment_id": 95914261, "body": "Well, it&#39;s 4 characters shorter, so it&#39;s objectively shorter. But preference is a valid argument in this case"}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": false, "score": 0, "last_activity_date": 1549467125, "last_edit_date": 1549467125, "creation_date": 1549453774, "answer_id": 54552987, "question_id": 54552516, "link": "https://stackoverflow.com/questions/54552516/golang-group-and-merge-by-value-in-goroutine/54552987#54552987", "title": "Golang group and merge by value in goroutine", "body": "<pre><code>var inputs []input // assuming the json has been unmarshalled correctly\n\nouts := make(map[int]output)\n\n// this will create a map, keyed by id, values are groups of inputs\nfor _, input := range inputs {\n\n    out, exists := outs[input.ID]\n    if !exists {\n        out = output{\n            ID: input.ID,\n            Name: input.Name,\n        }\n    }\n\n   out.Image = append(out.Image, img{Name: input.Name})\n}\n\noutput := make([]output, len(outs))\nvar idx int\nfor key, out := range outs {\n    output[idx] = out\n    idx++\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1549465770, "post_id": 54556332, "comment_id": 95913050, "body": "top-tip: <code>var outputs []output</code>, you know how big the slice will be (<code>len(outputlist)</code>), so you can allocate the required memory up-front instead of relying on golang reallocating <code>cap(output) * 2</code> every time you exceed <code>2^N</code> elements by writing: <code>outputs := make([]output, 0, len(outputlist)</code>"}, {"owner": {"reputation": 49, "user_id": 2582103, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/360f2462b56974daa7acf51b4e22ec37?s=128&d=identicon&r=PG", "display_name": "machmum", "link": "https://stackoverflow.com/users/2582103/machmum"}, "edited": false, "score": 0, "creation_date": 1549514191, "post_id": 54556332, "comment_id": 95930985, "body": "Thanks for your answer! It works for my previous result. I already updated my question, would be grateful if you have solution for my second problem above. Thanks"}], "tags": [], "owner": {"reputation": 11, "user_id": 10628465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b228e5afe8e1aaab9cd2350454504ce?s=128&d=identicon&r=PG", "display_name": "Peter Eichelsheim", "link": "https://stackoverflow.com/users/10628465/peter-eichelsheim"}, "is_accepted": false, "score": 1, "last_activity_date": 1549464560, "creation_date": 1549464560, "answer_id": 54556332, "question_id": 54552516, "link": "https://stackoverflow.com/questions/54552516/golang-group-and-merge-by-value-in-goroutine/54556332#54556332", "title": "Golang group and merge by value in goroutine", "body": "<p>Here a little sample with sample json input, using map[int]output to club images into the same product ID.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n)\n\ntype input struct {\n    ID    int `json:\"id\"`\n    Name  string `json:\"name\"`\n    Image img    `json:\"image\"`\n}\n\ntype output struct {\n    ID    int `json:\"id\"`\n    Name  string `json:\"name\"`\n    Image []img  `json:\"image\"`\n}\n\ntype img struct {\n    Name string `json:\"name\"`\n}\n\nfunc main() {\n\n    var jsoninput = []byte(`\n    [{\n        \"id\": 10,\n        \"name\": \"product 10\",\n        \"image\": {\"name\": \"image 10a\"}\n    }, {\n        \"id\": 10,\n            \"name\": \"product 10\",\n            \"image\": {\"name\": \"image 10b\"}\n    }, {\n        \"id\": 11,\n            \"name\": \"product 11\",\n            \"image\": {\"name\": \"image 11a\"}\n    }, {\n        \"id\": 11,\n            \"name\": \"product 11\",\n            \"image\": {\"name\": \"image 11b\"}\n    }, {\n        \"id\": 11,\n            \"name\": \"product 11\",\n            \"image\": {\"name\": \"image 11c\"}\n    }]`)\n\n    var inputs []input\n\n    err := json.Unmarshal(jsoninput, &amp;inputs)\n    if err != nil {\n        log.Fatalln(\"could not Unmarshal:\", err)\n    }\n\n    var outputlist = make(map[int]output)\n\n    for _, inp := range inputs {\n        outputlist[inp.ID] = output{inp.ID, inp.Name, append(outputlist[inp.ID].Image, inp.Image)}\n    }\n\n    var outputs []output\n\n    for _, outp := range outputlist{\n        outputs = append(outputs,outp)\n    }\n\n    jsonoutput, err := json.Marshal(outputs)\n\n    fmt.Println(string(jsonoutput))\n}\n</code></pre>\n"}], "owner": {"reputation": 49, "user_id": 2582103, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/360f2462b56974daa7acf51b4e22ec37?s=128&d=identicon&r=PG", "display_name": "machmum", "link": "https://stackoverflow.com/users/2582103/machmum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 748, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1570727358, "creation_date": 1549452268, "last_edit_date": 1549514396, "question_id": 54552516, "link": "https://stackoverflow.com/questions/54552516/golang-group-and-merge-by-value-in-goroutine", "title": "Golang group and merge by value in goroutine", "body": "<p>I'm new in go and tried to populate slice data by same values in GO.\nRefer to the following example</p>\n\n<pre><code>input struct {\n  ID string `json:\"id\"`\n  Name string `json:\"name\"`\n  Image string `json:\"image\"`\n}\n\noutput struct {\n  ID    string `json:\"id\"`\n  Name  string `json:\"name\"`\n  Image []img `json:\"image\"`\n}\n\nimg struct {\n  Name string `json:\"name\"`\n  Width  int  `json:\"width\"`\n  Height int  `json:\"height\"`\n}\n\ninput = [{\n        \"id\": 10,\n        \"name\": \"product 10\",\n        \"image\": {\"name\": \"https://i.imgur.com/eKSk6Fq.jpg\"}\n    }, {\n        \"id\": 10,\n            \"name\": \"product 10\",\n            \"image\": {\"name\": \"https://i.imgur.com/np1wmxw.jpg\"}\n    }, {\n        \"id\": 11,\n            \"name\": \"product 11\",\n            \"image\": {\"name\": \"https://i.imgur.com/jlFgGpe.jpg\"}\n    }, {\n        \"id\": 11,\n            \"name\": \"product 11\",\n            \"image\": {\"name\": \"https://i.imgur.com/B0D4iRk.jpg\"}\n    }, {\n        \"id\": 11,\n            \"name\": \"product 11\",\n            \"image\": {\"name\": \"https://i.imgur.com/4AiXzf8.jpg\"}\n    }]\n\n// expected output\noutput = [{\n    \"id\": 10,\n    \"name\": \"product 10\",\n    \"image\": [{\n        \"name\": \"https://i.imgur.com/eKSk6Fq.jpg\",\n        \"width\": 900,\n        \"height\": 600\n    }, {\n        \"name\": \"https://i.imgur.com/np1wmxw.jpg\",\n        \"width\": 600,\n        \"height\": 600\n    }]\n}, {\n    \"id\": 11,\n    \"name\": \"product 11\",\n    \"image\": [{\n        \"name\": \"https://i.imgur.com/jlFgGpe.jpg\",\n        \"width\": 639,\n        \"height\": 700\n    }, {\n        \"name\": \"https://i.imgur.com/B0D4iRk.jpg\",\n        \"width\": 1280,\n        \"height\": 960\n    }, {\n        \"name\": \"https://i.imgur.com/4AiXzf8.jpg\",\n        \"width\": 540,\n        \"height\": 405\n    }]\n}]\n</code></pre>\n\n<p>I would like to group <code>input</code> to a new slice based on the same <code>ID</code>,\nso the result <code>output</code> would be new slice of new struct with grouped <code>image</code> with same <code>ID</code>. </p>\n\n<ul>\n<li>H\u0336o\u0336w\u0336 \u0336w\u0336o\u0336u\u0336l\u0336d\u0336 \u0336I\u0336 \u0336a\u0336c\u0336h\u0336i\u0336e\u0336v\u0336e\u0336d\u0336 \u0336t\u0336h\u0336e\u0336 \u0336<code>\u0336o\u0336u\u0336t\u0336p\u0336u\u0336t\u0336</code>\u0336 \u0336r\u0336e\u0336s\u0336u\u0336l\u0336t\u0336 \u0336u\u0336s\u0336i\u0336n\u0336g\u0336 \u0336G\u0336O\u0336?  update: got the answer from Peter Eichelsheim</li>\n<li>Also, if I had to ge image size in the <code>input</code> with http.get and want to use goroutine, how would I achieve the result? since my last code here <a href=\"https://play.golang.org/p/w2awSWUILS-\" rel=\"nofollow noreferrer\">playground</a> not achieving the correct output (always get the last input)</li>\n</ul>\n\n<p>note: I don't know why I get null in go playground, but in my laptop the result is: [{\"id\":11,\"name\":\"product 11\",\"image\":[{\"name\":\"<a href=\"https://i.imgur.com/B0D4iRk.jpg\" rel=\"nofollow noreferrer\">https://i.imgur.com/B0D4iRk.jpg</a>\",\"width\":1280,\"height\":960}]}]</p>\n\n<p>In PHP, I would do something below to achieve the intended <code>output</code>.</p>\n\n<pre><code>foreach ($input as $key =&gt; $value) {\n            if (!isset($output[$value[\"id\"]])) {\n                $output[$value[\"id\"]] = [\n                    \"id\" =&gt; $value[\"id\"],\n                    \"name\" =&gt; $value[\"name\"],\n                    \"image\" =&gt; [],\n                ];\n            }\n\n            $get = getimagesize($value[\"image\"][\"name\"]);\n            if ($get) {\n                $width  = isset($get[0]) ? $get[0] : 0;\n                $height = isset($get[1]) ? $get[1] : 0;\n            }\n\n            $output[$value[\"id\"]][\"image\"][$key] = [\n                \"name\" =&gt; $value[\"image\"][\"name\"],\n                \"width\" =&gt; $width,\n                \"height\" =&gt; $height,\n            ];\n\n            $output[$value[\"id\"]][\"image\"] = array_values($output[$value[\"id\"]][\"image\"]);\n}\n\n$output = array_values($output);\n$json = json_encode($output, true);\n\necho $json;\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "time", "timezone", "timezone-offset"], "answers": [{"comments": [{"owner": {"reputation": 1768, "user_id": 452281, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/abb031deb5c8c34179f02933363d6161?s=128&d=identicon&r=PG", "display_name": "jftuga", "link": "https://stackoverflow.com/users/452281/jftuga"}, "edited": false, "score": 0, "creation_date": 1549451598, "post_id": 54552153, "comment_id": 95904364, "body": "What&#39;s a good way to convert <code>-0800</code> to <code>-8*3600</code>?"}, {"owner": {"reputation": 1768, "user_id": 452281, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/abb031deb5c8c34179f02933363d6161?s=128&d=identicon&r=PG", "display_name": "jftuga", "link": "https://stackoverflow.com/users/452281/jftuga"}, "edited": false, "score": 0, "creation_date": 1549452329, "post_id": 54552153, "comment_id": 95904790, "body": "So the <code>-0700</code> is arbitrary as it is just a formatting specifier? Could this be any valid time zone?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1768, "user_id": 452281, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/abb031deb5c8c34179f02933363d6161?s=128&d=identicon&r=PG", "display_name": "jftuga", "link": "https://stackoverflow.com/users/452281/jftuga"}, "edited": false, "score": 1, "creation_date": 1549452443, "post_id": 54552153, "comment_id": 95904860, "body": "@jftuga The layout (format) must be given using the reference time, which is <code>Mon Jan 2 15:04:05 -0700 MST 2006</code>. So the zone offset in the layout must be -7 hours, formatted in a way it is in your input. This is detailed in <a href=\"https://golang.org/pkg/time/#Parse\" rel=\"nofollow noreferrer\"><code>time.Parse()</code></a>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1549451980, "last_edit_date": 1549451980, "creation_date": 1549451285, "answer_id": 54552153, "question_id": 54552101, "link": "https://stackoverflow.com/questions/54552101/how-to-construct-time-time-with-timezone-offset/54552153#54552153", "title": "How to construct time.Time with timezone offset", "body": "<p>You may use <a href=\"https://golang.org/pkg/time/#FixedZone\" rel=\"nofollow noreferrer\"><code>time.FixedZone()</code></a> to construct a <a href=\"https://golang.org/pkg/time/#Location\" rel=\"nofollow noreferrer\"><code>time.Location</code></a> with a fixed offset.</p>\n\n<p>Example:</p>\n\n<pre><code>loc := time.FixedZone(\"myzone\", -8*3600)\nnativeDate := time.Date(2019, 2, 6, 0, 0, 0, 0, loc)\nfmt.Println(nativeDate)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/IbMPYUNryBe\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>2019-02-06 00:00:00 -0800 myzone\n</code></pre>\n\n<p>If you have the zone offset as a string, you may use <a href=\"https://golang.org/pkg/time/#Parse\" rel=\"nofollow noreferrer\"><code>time.Parse()</code></a> to parse it. Use a layout string that only contains the reference zone offset:</p>\n\n<pre><code>t, err := time.Parse(\"-0700\", \"-0800\")\nfmt.Println(t, err)\n</code></pre>\n\n<p>This outputs (try it on the <a href=\"https://play.golang.org/p/Q8zQsNN8Cpq\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>0000-01-01 00:00:00 -0800 -0800 &lt;nil&gt;\n</code></pre>\n\n<p>As you can see, the result <a href=\"https://golang.org/pkg/time/#Time\" rel=\"nofollow noreferrer\"><code>time.Time</code></a> has a zone offset of -0800 hours.</p>\n\n<p>So our original example can also be written as:</p>\n\n<pre><code>t, err := time.Parse(\"-0700\", \"-0800\")\nif err != nil {\n    panic(err)\n}\n\nnativeDate := time.Date(2019, 2, 6, 0, 0, 0, 0, t.Location())\nfmt.Println(nativeDate)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/lQqTwN2GR0L\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>2019-02-06 00:00:00 -0800 -0800\n</code></pre>\n"}], "owner": {"reputation": 1768, "user_id": 452281, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/abb031deb5c8c34179f02933363d6161?s=128&d=identicon&r=PG", "display_name": "jftuga", "link": "https://stackoverflow.com/users/452281/jftuga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1919, "favorite_count": 1, "closed_date": 1574154659, "accepted_answer_id": 54552153, "answer_count": 1, "score": 2, "last_activity_date": 1574154580, "creation_date": 1549451113, "last_edit_date": 1574154580, "question_id": 54552101, "link": "https://stackoverflow.com/questions/54552101/how-to-construct-time-time-with-timezone-offset", "closed_reason": "Duplicate", "title": "How to construct time.Time with timezone offset", "body": "<p>This is an example date from an Apache log:</p>\n\n<pre><code>[07/Mar/2004:16:47:46 -0800]\n</code></pre>\n\n<p>I have successfully parsed this into year(int), month(time.Month), day(int), hour(int), minute(int), second(int), and timezone(string).</p>\n\n<p>How can I construct time.Time such that it includes the <code>-0800</code> time zone offset?</p>\n\n<p>This is what I have so far:</p>\n\n<pre><code>var nativeDate time.Time\nnativeDate = time.Date(year, time.Month(month), day, hour, minute, second, 0, ????)\n</code></pre>\n\n<p>What should I use in place of <code>????</code>? <code>time.Local</code> or <code>time.UTC</code> is not appropriate here.</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1549437806, "post_id": 54548441, "comment_id": 95897129, "body": "This code looks fine. Maybe the error is on another line?"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1549437891, "post_id": 54548441, "comment_id": 95897158, "body": "@SergioTulentsev there was no error it was a warning which the <code>go vet</code> is showing"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1549437942, "post_id": 54548441, "comment_id": 95897178, "body": "Ah right. Thanks for posting a self-answer, learned something today :)"}], "answers": [{"comments": [{"owner": {"reputation": 158, "user_id": 10245760, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-RNQ3BJ-mSGQ/AAAAAAAAAAI/AAAAAAAAAAw/B-wcw98aIqQ/photo.jpg?sz=128", "display_name": "Karl Anthony Baluyot", "link": "https://stackoverflow.com/users/10245760/karl-anthony-baluyot"}, "edited": false, "score": 0, "creation_date": 1577765932, "post_id": 54548495, "comment_id": 105248691, "body": "I see its cleaner when we provide the keys"}, {"owner": {"reputation": 1334, "user_id": 890258, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/VkAJ6.jpg?s=128&g=1", "display_name": "Chris W", "link": "https://stackoverflow.com/users/890258/chris-w"}, "edited": false, "score": 3, "creation_date": 1581020446, "post_id": 54548495, "comment_id": 106300361, "body": "filter := bson.D{{Key: &quot;autorefid&quot;, Value: &quot;100&quot;}}     // skipping <code>primitive.E</code> also works."}, {"owner": {"reputation": 2219, "user_id": 8608146, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3B2gl.jpg?s=128&g=1", "display_name": "Phani Rithvij", "link": "https://stackoverflow.com/users/8608146/phani-rithvij"}, "edited": false, "score": 0, "creation_date": 1604278798, "post_id": 54548495, "comment_id": 114290835, "body": "So if we have it in a variable <code>e := functionWhichReturnsE(...)</code> and we need a <code>bson.D</code> we need to do <code>bd := bson.D{Key: e.Key, Value: e.Value}</code> ? looks ok, until you do it for <code>template.Template</code>. Better to disable it smh"}, {"owner": {"reputation": 1122, "user_id": 4970650, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/496526a825adf2e6587a19d3a6d391f7?s=128&d=identicon&r=PG", "display_name": "Cirelli94", "link": "https://stackoverflow.com/users/4970650/cirelli94"}, "edited": false, "score": 0, "creation_date": 1616148398, "post_id": 54548495, "comment_id": 117917521, "body": "I think I&#39;ll add something like  <code>func E(s string, i interface{}) bson.E { return bson.E{ Key: s, Value: i, } }</code> to my <code>utils</code> package :S"}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 64, "last_activity_date": 1573665550, "last_edit_date": 1573665550, "creation_date": 1549437846, "answer_id": 54548495, "question_id": 54548441, "link": "https://stackoverflow.com/questions/54548441/composite-literal-uses-unkeyed-fields/54548495#54548495", "title": "Composite literal uses unkeyed fields", "body": "<p>The warnings can be stopped by setting the check flag to false.</p>\n\n<pre><code>$ go doc cmd/vet\n</code></pre>\n\n<blockquote>\n  <p>By default all checks are performed. If any flags are explicitly set to true, only those tests are run. Conversely, if any flag is\n  explicitly set to false, only those tests are disabled. Thus\n  -printf=true runs the printf check, -printf=false runs all checks except the printf check.</p>\n\n<pre><code>Unkeyed composite literals\n\nFlag: -composites\n\nComposite struct literals that do not use the field-keyed syntax.\n</code></pre>\n</blockquote>\n\n<p>But the warning is due to not providing the keys name when setting the value in <code>primitive.E</code> struct.</p>\n\n<p>Setting keys for <code>primitive.E</code> struct will remove the warning messages. For example</p>\n\n<pre><code>filter := bson.D{primitive.E{Key: \"autorefid\", Value: \"100\"}}\n</code></pre>\n\n<blockquote>\n  <p>Package primitive contains types similar to Go primitives for BSON\n  types can do not have direct Go primitive representations.</p>\n</blockquote>\n\n<pre><code>type E struct {\n    Key   string\n    Value interface{}\n}\n</code></pre>\n\n<blockquote>\n  <p>E represents a BSON element for a D. It is usually used inside a D.</p>\n</blockquote>\n\n<p>For more information have a look at <a href=\"https://godoc.org/github.com/mongodb/mongo-go-driver/bson/primitive#E\" rel=\"noreferrer\">primitive.E</a></p>\n"}, {"tags": [], "owner": {"reputation": 908, "user_id": 1200221, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e74c8f974693c4fa442346c2bfb1102a?s=128&d=identicon&r=PG", "display_name": "dbam", "link": "https://stackoverflow.com/users/1200221/dbam"}, "is_accepted": false, "score": 14, "last_activity_date": 1576526182, "creation_date": 1576526182, "answer_id": 59363459, "question_id": 54548441, "link": "https://stackoverflow.com/questions/54548441/composite-literal-uses-unkeyed-fields/59363459#59363459", "title": "Composite literal uses unkeyed fields", "body": "<p>You can change:</p>\n\n<pre><code>filter := bson.D{{\"autorefid\", \"100\"}}\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>filter := bson.D{primitive.E{Key: \"autorefid\", Value: \"100\"}}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 113, "user_id": 11887481, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kTYZQ.jpg?s=128&g=1", "display_name": "itsdilunga", "link": "https://stackoverflow.com/users/11887481/itsdilunga"}, "is_accepted": false, "score": 5, "last_activity_date": 1596954032, "last_edit_date": 1596954032, "creation_date": 1596913439, "answer_id": 63319245, "question_id": 54548441, "link": "https://stackoverflow.com/questions/54548441/composite-literal-uses-unkeyed-fields/63319245#63319245", "title": "Composite literal uses unkeyed fields", "body": "<p>You can simply change:</p>\n<pre><code>filter := bson.D{{&quot;autorefid&quot;, &quot;100&quot;}}\n</code></pre>\n<p>to:</p>\n<pre><code>filter := bson.D{{Key: &quot;autorefid&quot;, Value: &quot;100&quot;}}\n</code></pre>\n<p>//Skip primitive.E as said by Chris W</p>\n"}, {"comments": [{"owner": {"reputation": 3184, "user_id": 1058916, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/5f2f3475aba0c4b388692df3f5546bb9?s=128&d=identicon&r=PG", "display_name": "fefe", "link": "https://stackoverflow.com/users/1058916/fefe"}, "edited": false, "score": 1, "creation_date": 1607394614, "post_id": 63747469, "comment_id": 115253259, "body": "This explains why it only warns about struct from other package. This won&#39;t warn about struct from the same package of the code."}], "tags": [], "owner": {"reputation": 2005, "user_id": 292382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1273e01f22fc4ee1f2b29587c37a294e?s=128&d=identicon&r=PG", "display_name": "antichris", "link": "https://stackoverflow.com/users/292382/antichris"}, "is_accepted": false, "score": 11, "last_activity_date": 1599250210, "creation_date": 1599250210, "answer_id": 63747469, "question_id": 54548441, "link": "https://stackoverflow.com/questions/54548441/composite-literal-uses-unkeyed-fields/63747469#63747469", "title": "Composite literal uses unkeyed fields", "body": "<p>Since no one else has pointed this out \u2014 the warning is there to safeguard you from changes in the third-party API breaking your code silently.</p>\n<p>Ignoring this <code>vet</code> warning has the potential to lead to really nasty and hard to track down runtime bugs, so you'd be better off if you were to <strong>always specify the keys of 3rd party <code>struct</code>s explicitly</strong>.</p>\n<p>Such would be the case if the maintainers of the library you are using decided to change the order of elements in their <code>struct</code> for whatever reason. For example, switching <code>Key</code> with <code>Value</code>, in the OP case. Your code would still appear to compile just fine, but what you intended to be the key would now be passed as the value and vice versa, and things would just start breaking in unexpected ways.</p>\n"}, {"tags": [], "owner": {"reputation": 105, "user_id": 11771377, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-lfMxcUhCoLQ/AAAAAAAAAAI/AAAAAAAAXmE/4L4spdR3BRA/photo.jpg?sz=128", "display_name": "Mekel Ilyasa", "link": "https://stackoverflow.com/users/11771377/mekel-ilyasa"}, "is_accepted": false, "score": 2, "last_activity_date": 1613135442, "creation_date": 1613135442, "answer_id": 66172486, "question_id": 54548441, "link": "https://stackoverflow.com/questions/54548441/composite-literal-uses-unkeyed-fields/66172486#66172486", "title": "Composite literal uses unkeyed fields", "body": "<p>Actually, if <strong>ordered</strong> representation of a BSON document doesn't necessary you can change your BSON document to <strong>unordered</strong> representation by simply change</p>\n<pre><code>filter := bson.D{{&quot;autorefid&quot;, &quot;100&quot;}}\n</code></pre>\n<p>to</p>\n<pre><code>filter := bson.M{&quot;autorefid&quot;: &quot;100&quot;}\n</code></pre>\n<p>See <a href=\"https://stackoverflow.com/a/64281937/11771377\">this</a> stackoverflow answer for more details about <code>bson.D</code> vs <code>bson.M</code>. The MongoDB server is smart enough to find matching indices regardless of the used order.</p>\n"}], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33328, "favorite_count": 8, "accepted_answer_id": 54548495, "answer_count": 5, "score": 50, "last_activity_date": 1613135442, "creation_date": 1549437570, "last_edit_date": 1549445241, "question_id": 54548441, "link": "https://stackoverflow.com/questions/54548441/composite-literal-uses-unkeyed-fields", "title": "Composite literal uses unkeyed fields", "body": "<p>I am working with new official mongodb driver for golang. I have created one complex query to insert the data into mongo db and then sort it according to an element value. I am using a filter in which I have created the bson type using :-</p>\n\n<pre><code>filter := bson.D{{\"autorefid\", \"100\"}}\n</code></pre>\n\n<p>But It is showing a warning saying:</p>\n\n<blockquote>\n  <p>primitive.E composite literal uses unkeyed fields</p>\n</blockquote>\n\n<p>The warnings are creating a mess in my code.</p>\n"}, {"tags": ["http", "go", "post"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1549437102, "post_id": 54548281, "comment_id": 95896855, "body": "After sending a request, yes, the connection will (often) stay open, for subsequent requests. But that won&#39;t help you here. For the level of control you seem to need, I don&#39;t think the <code>net&#47;http</code> package in the std lib is sufficient."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1549439261, "post_id": 54548281, "comment_id": 95897776, "body": "I have the feeling that you are trying to use the syntax of HTTP but with different semantics. The semantics of HTTP don&#39;t have the idea of sending part of the request, reading part of the response, sending more data from the request etc. One way to do this is to have multiple request/responses. Another way might be to use a preliminary response (status code 100) after receiving the request header to signal the client to go on with the request body and then send a final response once the body is done (don&#39;t know if this is supported in golang). Or you could use Websockets."}, {"owner": {"reputation": 4671, "user_id": 2844742, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/GRfAv.gif?s=128&g=1", "display_name": "unclemeat", "link": "https://stackoverflow.com/users/2844742/unclemeat"}, "edited": false, "score": 0, "creation_date": 1549447561, "post_id": 54548281, "comment_id": 95901886, "body": "That&#39;s correct, Steffen. As noted in the post, I&#39;m implementing a protocol which is basically just a behavioral specification for HTTP streaming. If there&#39;s a simple way to do this without the http library I&#39;m all ears. It would be really handy if I could just use this library for constructing and sending the request with an empty body, and then somehow get access to the still open connection object. But it doesn&#39;t seem like that&#39;s possible, and I&#39;m not looking forward to implementing http over sockets manually to solve 5% of the problem."}], "answers": [{"tags": [], "owner": {"reputation": 4671, "user_id": 2844742, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/GRfAv.gif?s=128&g=1", "display_name": "unclemeat", "link": "https://stackoverflow.com/users/2844742/unclemeat"}, "is_accepted": true, "score": 0, "last_activity_date": 1549510767, "last_edit_date": 1549510767, "creation_date": 1549496803, "answer_id": 54564293, "question_id": 54548281, "link": "https://stackoverflow.com/questions/54548281/go-http-request-post-headers-wait-for-response-then-post-chunked-body-content/54564293#54564293", "title": "Go HTTP Request POST headers, wait for response, then post chunked body content", "body": "<p>So the server is blocking in Flush because the body is still open. Turns out if you set the <code>Connection</code> header to <code>close</code> in the client's POST request (EDIT: You can set it in the servers response headers before flushing and it works regardless of what the client is doing), the server will ignore the fact that the body is still open and flush anyway (and keep the connection open to read data). Neat.</p>\n\n<p>I can't seem to find any documentation in either the HTTP spec or the Go http library which describes this behavior. But here we are.</p>\n"}], "owner": {"reputation": 4671, "user_id": 2844742, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/GRfAv.gif?s=128&g=1", "display_name": "unclemeat", "link": "https://stackoverflow.com/users/2844742/unclemeat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 973, "favorite_count": 0, "accepted_answer_id": 54564293, "answer_count": 1, "score": 0, "last_activity_date": 1549510767, "creation_date": 1549436801, "last_edit_date": 1549446615, "question_id": 54548281, "link": "https://stackoverflow.com/questions/54548281/go-http-request-post-headers-wait-for-response-then-post-chunked-body-content", "title": "Go HTTP Request POST headers, wait for response, then post chunked body content", "body": "<p>I'm trying to figure out if there is a way to post chunked data to a HTTP server which attempts to send headers before accepting any of my request body.</p>\n\n<p>I have a server which receives never ending streams of data via POST requests. Upon receiving new POST requests, it constructs headers and immediately attempts to Flush.</p>\n\n<pre><code>http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    requestId := uuid.Must(uuid.NewV4()).String()\n\n    w.Header().Set(\"X-Request-Id\", requestId)\n    w.Header().Set(\"Content-Type\", \"application/octet-stream\")\n\n    client := &amp;Connection{requestId, make(chan []byte, 50), r, w}\n    defer client.Request.Body.Close()\n\n    switch client.Request.Method {\n        case http.MethodPost:\n            client.Writer.(http.Flusher).Flush()\n            // goes on to read data from the connection until it is closed\n    }\n}\n</code></pre>\n\n<p>This works fine for POST clients which are implemented using sockets, which can decide to read the servers response before actually sending any of the body data. However, I can't figure out how to get it to work for a Go http Request object.</p>\n\n<p>On the client side, I have a goroutine which is Writing data to an io.PipeWriter, and I have passed the PipeReader (pr) to the Request object:</p>\n\n<pre><code>req := &amp;http.Request{\n    Method: \"POST\",   \n    ProtoMajor: 1,    \n    ProtoMinor: 1,    \n    URL: serverUrl,\n    TransferEncoding: []string{\"chunked\"},\n    Body: pr,\n    Header: make(map[string][]string),\n}\n\nresp, err := http.DefaultClient.Do(req)\n</code></pre>\n\n<p>This hangs forever on both ends because the PipeReader is never closed, and the server blocks on Flush. What I would like to do is send headers, wait for the response from the server, then start sending body content.</p>\n\n<p>I have tried simply not including the <code>Body</code> in the Request object, this sends the headers, receives the response headers, AND the connection <em>seems</em> to stay open. But from all my reading I can't seem to find a way to send additional data over this connection.</p>\n\n<p>Of course, I can just not Flush on the server end and handle the data - but I'm actually implementing a protocol which specifies this behavior, and so existing client software doesn't send the body data unless it first receives the response headers.</p>\n"}, {"tags": ["go", "time", "timezone", "timezone-offset"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549436756, "post_id": 54547840, "comment_id": 95896704, "body": "What do you mean you&#39;re getting inconsistent results?"}, {"owner": {"reputation": 11, "user_id": 11021301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b4ea903c34293efa40832f037e3d30b?s=128&d=identicon&r=PG&f=1", "display_name": "Hare Hepull", "link": "https://stackoverflow.com/users/11021301/hare-hepull"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549437409, "post_id": 54547840, "comment_id": 95896981, "body": "I expect the format <code>+AB:CD</code> as mentioned but values &quot;MST&quot; &amp; &quot;CET&quot; appear."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549443016, "post_id": 54547840, "comment_id": 95899386, "body": "Why do you expect that, when the documentation for <code>Zone()</code> says it always returns the abbreviated name, when it exists?"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 3, "last_activity_date": 1549438465, "last_edit_date": 1549438465, "creation_date": 1549437599, "answer_id": 54548446, "question_id": 54547840, "link": "https://stackoverflow.com/questions/54547840/get-complete-utc-offset-format/54548446#54548446", "title": "Get complete UTC offset format", "body": "<p>The <code>Zone()</code> method you're using is working <a href=\"https://golang.org/pkg/time/#Time.Zone\" rel=\"nofollow noreferrer\">exactly as advertized</a>.</p>\n\n<blockquote>\n  <p>Zone computes the time zone in effect at time t, returning the abbreviated name of the zone (such as \"CET\") and its offset in seconds east of UTC.</p>\n</blockquote>\n\n<p>A better approach for you would be to use the <a href=\"https://golang.org/pkg/time/#Time.Format\" rel=\"nofollow noreferrer\"><code>Format</code></a> method. Something like:</p>\n\n<pre><code>zone := time.Now().In(loc).Format(\"-0700\")\n</code></pre>\n\n<p>Of course, be aware: Even this won't be 100% consistent, due to daylight savings time.</p>\n"}], "owner": {"reputation": 11, "user_id": 11021301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b4ea903c34293efa40832f037e3d30b?s=128&d=identicon&r=PG&f=1", "display_name": "Hare Hepull", "link": "https://stackoverflow.com/users/11021301/hare-hepull"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 909, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1583167068, "creation_date": 1549434682, "last_edit_date": 1583167068, "question_id": 54547840, "link": "https://stackoverflow.com/questions/54547840/get-complete-utc-offset-format", "title": "Get complete UTC offset format", "body": "<p>I need to get the UTC offset for a location. I am getting trouble with the inconsistency of the results from different values. All I need to get are values in the format <code>+HHMM</code> (e.g., <code>+0100</code> for \"Europe/Rome\").</p>\n\n<pre><code>func main() {\n    loc, _:= time.LoadLocation(\"Asia/Kathmandu\")\n    offset, others:= time.Now().In(loc).Zone()\n    fmt.Println(offset, others)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/aVxflQ3Z9eU\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<p>What I get:</p>\n\n<ul>\n<li>\"Asia/Kathmandu\": <code>+0545</code> (suitable)</li>\n<li>\"Asia/Ho_Chi_Minh\": <code>+07</code> (should be <code>+0700</code>)</li>\n<li>\"America/Phoenix\": <code>MST</code> (should be <code>-0700</code>)</li>\n<li>\"Europe/Rome\": <code>CET</code> (should be <code>+0100</code>)</li>\n</ul>\n\n<p><a href=\"https://en.wikipedia.org/wiki/List_of_tz_database_time_zones\" rel=\"nofollow noreferrer\">Reference Timezone country names</a></p>\n"}, {"tags": ["go", "serialization", "reflection"], "answers": [{"comments": [{"owner": {"reputation": 132, "user_id": 8290819, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/1ba7cbb1dc3db9c1bb81319972768bbb?s=128&d=identicon&r=PG&f=1", "display_name": "Fransebas", "link": "https://stackoverflow.com/users/8290819/fransebas"}, "edited": false, "score": 0, "creation_date": 1549463662, "post_id": 54547784, "comment_id": 95911706, "body": "I tried that with a simpler example but I get panic. <code>type superint struct { \ta int \tb int };  func (s*superint) lol()  {  }  type a interface { \tlol() }  func debug(){ \ti := superint{ \t\ta : 1, \t\tb : 9, \t} \tvalPtr := reflect.ValueOf(&amp;i) \tfmt.Printf(&quot;%v \\n&quot;, &amp;i.a) \tfmt.Printf(&quot;%v \\n&quot;, valPtr.Elem().Field(0).Addr().Interface()) }</code>"}, {"owner": {"reputation": 132, "user_id": 8290819, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/1ba7cbb1dc3db9c1bb81319972768bbb?s=128&d=identicon&r=PG&f=1", "display_name": "Fransebas", "link": "https://stackoverflow.com/users/8290819/fransebas"}, "edited": false, "score": 0, "creation_date": 1549464431, "post_id": 54547784, "comment_id": 95912211, "body": "I&#39;m so used to public and private that didn&#39;t understood what &quot;unexported&quot; mean, Thanks!!!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1549464444, "last_edit_date": 1549464444, "creation_date": 1549434416, "answer_id": 54547784, "question_id": 54547587, "link": "https://stackoverflow.com/questions/54547587/how-to-get-the-address-of-a-struct-field-through-reflect-in-go/54547784#54547784", "title": "How to get the address of a struct field through reflect in GO", "body": "<p>Use the reflect API to get the <a href=\"https://godoc.org/reflect#Value.Addr\" rel=\"nofollow noreferrer\">address</a> of the field:</p>\n\n<pre><code>last_n_bytes := Deserialize(valPtr.Elem().Field(i).Addr().Interface(), b)\n</code></pre>\n\n<p>The <code>superint</code> example panics because the application takes the address of an unexported field through the reflect API.  That's not allowed because it would allow another package to modify the field.</p>\n\n<p>Here's a working example with <a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">exported</a> fields:</p>\n\n<pre><code>type superint struct {\n    A int\n    B int\n}\n\nfunc (s *superint) lol() {}\n\ntype a interface{ lol() }\n\nfunc main() {\n    i := superint{A: 1, B: 9}\n    valPtr := reflect.ValueOf(&amp;i)\n    fmt.Printf(\"%v \\n\", &amp;i.A)\n    fmt.Printf(\"%v \\n\", valPtr.Elem().Field(0).Addr().Interface())\n}\n</code></pre>\n"}], "owner": {"reputation": 132, "user_id": 8290819, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/1ba7cbb1dc3db9c1bb81319972768bbb?s=128&d=identicon&r=PG&f=1", "display_name": "Fransebas", "link": "https://stackoverflow.com/users/8290819/fransebas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 514, "favorite_count": 0, "closed_date": 1549467596, "accepted_answer_id": 54547784, "answer_count": 1, "score": 0, "last_activity_date": 1549465167, "creation_date": 1549433405, "last_edit_date": 1549465167, "question_id": 54547587, "link": "https://stackoverflow.com/questions/54547587/how-to-get-the-address-of-a-struct-field-through-reflect-in-go", "closed_reason": "Needs details or clarity", "title": "How to get the address of a struct field through reflect in GO", "body": "<p>I'm working on a code to deserialize streams of bytes into objects and I'm stuck on getting the pointer of the field of a struct.</p>\n\n<p>Basically how the code works is as follows: it gets the pointer to a struct, then depending on the type it serializes it, ex. if it's an integer it takes the next 4 bytes. The tricky case is if it's a struct because I have to recursively run Deserialize on all of its attributes and I don't know how to get the address of its field to pass them to Deserialize.</p>\n\n<pre><code>func Deserialize(objPtr interface{}, b []byte) (bytesRead int) {\n    // it should be the address of the object\n\n    val := reflect.ValueOf(objPtr).Elem()\n    valPtr := reflect.ValueOf(objPtr)\n\n    // check if either the object or *object is Serializable\n    _, isSerializable := (val.Interface()).(Serializable)\n    _, bo := (valPtr.Interface()).(Serializable)\n    isSerializable = isSerializable || bo\n\n    // specific type serialization\n    if isSerializable{\n        return objPtr.(Serializable).Deserializebyte(b)\n    }\n\n    switch val.Kind() {\n    case reflect.Uint32, reflect.Int, reflect.Int32:\n        res := reflect.ValueOf(binary.LittleEndian.Uint32(b[:4]))\n        valPtr.Set(res)\n        return 4\n    case reflect.Uint64, reflect.Int64:\n        res := reflect.ValueOf(binary.LittleEndian.Uint32(b[:8]))\n        valPtr.Set(res)\n        return 8\n    case reflect.Struct:\n        n_bytes := 0\n        for i := 0; i &lt; val.NumField(); i++ {\n\n            // stuck in here\n            valPtr.Elem()\n\n            // I don't think the next line works\n            last_n_bytes := Deserialize(&amp;(valPtr.Elem().Field(i).Interface()), b)\n            n_bytes += last_n_bytes\n            b = b[last_n_bytes:]\n        }\n        //valPtr.Set(res)\n        return n_bytes\n    default:\n        panic(\"this panic is for debug, every case should be handled above\")\n        res := val.Bytes()\n        valPtr.Set(res)\n        return len(val.Bytes())\n    }\n    return 0\n}\n</code></pre>\n"}, {"tags": ["http", "go", "server", "reverse-proxy"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1549469171, "post_id": 54547354, "comment_id": 95915335, "body": "It handles it like any other response. Why do you think it would it be any different? (the go documentation generally does what it says it&#39;s going to do, and any discrepancies can be filed as bugs)"}, {"owner": {"reputation": 643, "user_id": 5046220, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d6703018e7d190e03c461a2ea5c162b6?s=128&d=identicon&r=PG&f=1", "display_name": "supriya", "link": "https://stackoverflow.com/users/5046220/supriya"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1549514073, "post_id": 54547354, "comment_id": 95930963, "body": "I don&#39;t see anything in go description. Maybe it is handled, not sure though.Could you point me to that link if you know?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1549543255, "post_id": 54547354, "comment_id": 95944855, "body": "It says it proxies the response back to the client, and doesn\u2019t mention exceptions. Servers always send data in chunks (packets), and usually use chunked encoding, but there is no such thing as a special type of \u201cstreaming response\u201d"}], "owner": {"reputation": 643, "user_id": 5046220, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d6703018e7d190e03c461a2ea5c162b6?s=128&d=identicon&r=PG&f=1", "display_name": "supriya", "link": "https://stackoverflow.com/users/5046220/supriya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 186, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1549432257, "creation_date": 1549432257, "question_id": 54547354, "link": "https://stackoverflow.com/questions/54547354/does-httputil-reverse-proxy-handle-streaming-response-from-a-server", "title": "Does httputil reverse proxy handle streaming response from a server?", "body": "<p>httputil reverse proxy (<a href=\"https://golang.org/pkg/net/http/httputil/#ReverseProxy\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/httputil/#ReverseProxy</a> ) takes request from a client, transfers it to corresponding server and returns the response back. Does it handle streaming response as well from a server? </p>\n\n<p>By streaming response I mean if server is sending data in chunks (like large image upload or image download). If yes, then how does it handle it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2280, "user_id": 1918890, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/018e4722f070586f7a475e3942b9aa32?s=128&d=identicon&r=PG", "display_name": "Praveen", "link": "https://stackoverflow.com/users/1918890/praveen"}, "edited": false, "score": 0, "creation_date": 1549432234, "post_id": 54547298, "comment_id": 95895075, "body": "what you are looking for is called graceful shutdown <a href=\"https://medium.com/@kpbird/golang-gracefully-stop-application-23c2390bb212\" rel=\"nofollow noreferrer\">medium.com/@kpbird/&hellip;</a>"}, {"owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "edited": false, "score": 0, "creation_date": 1549433124, "post_id": 54547298, "comment_id": 95895348, "body": "Can the goroutines get blocked for long time? What do you want to do then? I believe in general you should have a way to signal child that app is shutting down but that is only possible if say child are non-blocking"}, {"owner": {"reputation": 1061, "user_id": 489149, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2369401260afca71c5bc5707f5b8765d?s=128&d=identicon&r=PG", "display_name": "Ian Herbert", "link": "https://stackoverflow.com/users/489149/ian-herbert"}, "edited": false, "score": 0, "creation_date": 1549499121, "post_id": 54547298, "comment_id": 95928018, "body": "It may block for short time, but the thing im aiming to achieve is that we complete all work before shutting down. In my main app I am implementing a time-out so that if <code>Close</code> takes too long, it will still gracefully shutdown."}], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 0, "last_activity_date": 1549434710, "creation_date": 1549434710, "answer_id": 54547847, "question_id": 54547298, "link": "https://stackoverflow.com/questions/54547298/how-to-coordinate-shutdown-with-many-goroutines/54547847#54547847", "title": "How to coordinate shutdown with many goroutines", "body": "<p>Yes, <code>WaitGroup</code> is the right answer. You can use <code>WaitGroup.Add</code> at anytime that the counter is greater than zero, as per <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\">doc</a>.</p>\n\n<blockquote>\n  <p>Note that calls with a positive delta that occur when the counter is zero must happen before a Wait. Calls with a negative delta, or calls with a positive delta that start when the counter is greater than zero, may happen at any time. Typically this means the calls to Add should execute before the statement creating the goroutine or other event to be waited for. If a WaitGroup is reused to wait for several independent sets of events, new Add calls must happen after all previous Wait calls have returned. See the WaitGroup example. </p>\n</blockquote>\n\n<p>But one trick is that, you should always keep the counter greater than zero, before <code>Close</code> is called. That usually means you should call <code>wg.Add</code> in <code>NewFoo</code> (or something like that) and <code>wg.Done</code> in <code>Close</code>. And to prevent multiple calls to <code>Done</code> ruining the wait group, you should wrap <code>Close</code> into <code>sync.Once</code>. You may also want to prevent new <code>Bar()</code> from being called.</p>\n"}, {"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1549456314, "post_id": 54552460, "comment_id": 95907228, "body": "While <code>errgroup</code> provides a single error handling point, it is hardly useful. OP does not describe how error should be handled (e.g., abort at the first error, or tolerate no more than X errors, etc.,). I would say use waitgroup and adds your own error handling code."}, {"owner": {"reputation": 8470, "user_id": 538866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb67b45ca1dc2584f8e4d703d009177b?s=128&d=identicon&r=PG", "display_name": "Jonas G. Drange", "link": "https://stackoverflow.com/users/538866/jonas-g-drange"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1549458025, "post_id": 54552460, "comment_id": 95908228, "body": "I agree that it is not useful for OP&#39;s code as it stands now, but OP opened up for commenting on whether or not his/hers question made sense. I suggest it does not make sense without error handling. Add error handling\u2014and <code>errgroup</code> becomes wildly useful."}, {"owner": {"reputation": 1061, "user_id": 489149, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2369401260afca71c5bc5707f5b8765d?s=128&d=identicon&r=PG", "display_name": "Ian Herbert", "link": "https://stackoverflow.com/users/489149/ian-herbert"}, "edited": false, "score": 0, "creation_date": 1549498323, "post_id": 54552460, "comment_id": 95927817, "body": "In my actual implementation, my <code>Bar</code> function returns an <code>error</code> and that gets bubbled up."}], "tags": [], "owner": {"reputation": 8470, "user_id": 538866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb67b45ca1dc2584f8e4d703d009177b?s=128&d=identicon&r=PG", "display_name": "Jonas G. Drange", "link": "https://stackoverflow.com/users/538866/jonas-g-drange"}, "is_accepted": false, "score": 0, "last_activity_date": 1549452390, "last_edit_date": 1549452390, "creation_date": 1549452086, "answer_id": 54552460, "question_id": 54547298, "link": "https://stackoverflow.com/questions/54547298/how-to-coordinate-shutdown-with-many-goroutines/54552460#54552460", "title": "How to coordinate shutdown with many goroutines", "body": "<p><code>WaitGroup</code> is one way, however, the Go team introduced the <code>errgroup</code> for your use case exactly. The most inconvenient part of leaf bebop's answer, is the disregard for error handling. Error handling is the reason <code>errgroup</code> exists. And idiomatic go code should <em>never</em> swallow errors. </p>\n\n<p>However, keeping the signatures of your <code>Foo</code> struct, (except a cosmetic <code>workerNumber</code>)\u2014and no error handling\u2014my proposal looks like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n\n    \"golang.org/x/sync/errgroup\"\n)\n\ntype Foo struct {\n    errg errgroup.Group\n}\n\nfunc NewFoo() *Foo {\n    foo := &amp;Foo{\n        errg: errgroup.Group{},\n    }\n    return foo\n}\n\nfunc (a *Foo) Bar(workerNumber int) {\n    a.errg.Go(func() error {\n        select {\n        // simulates the long running clals\n        case &lt;-time.After(time.Second * time.Duration(rand.Intn(10))):\n            fmt.Println(fmt.Sprintf(\"worker %d completed its work\", workerNumber))\n            return nil\n        }\n    })\n}\n\nfunc (a *Foo) Close() {\n    a.errg.Wait()\n}\n\nfunc main() {\n    foo := NewFoo()\n\n    for i := 0; i &lt; 10; i++ {\n        foo.Bar(i)\n    }\n\n    &lt;-time.After(time.Second * 5)\n    fmt.Println(\"Waiting for workers to complete...\")\n    foo.Close()\n    fmt.Println(\"Done.\")\n}\n</code></pre>\n\n<p>The benefit here, is that if you introduce error handling in your code (you should), you only need to slightly modify this code: In short, <code>errg.Wait()</code> would return the first redis error, and <code>Close()</code> could propagate this up through the stack (to main, in this case).</p>\n\n<p>Utilizing the <code>context.Context</code> package as well, you would also be able to immediately cancel any running redis call, if one fails. There are examples of this in the <code>errgroup</code> documentation.</p>\n"}, {"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1549456417, "post_id": 54552714, "comment_id": 95907283, "body": "I think you misunderstood. OP wants to ensure all <code>Bar</code> that is running will <i>not</i> be cancelled when <code>Close</code> is called - he wants them running till finished."}, {"owner": {"reputation": 1061, "user_id": 489149, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2369401260afca71c5bc5707f5b8765d?s=128&d=identicon&r=PG", "display_name": "Ian Herbert", "link": "https://stackoverflow.com/users/489149/ian-herbert"}, "edited": false, "score": 1, "creation_date": 1549497942, "post_id": 54552714, "comment_id": 95927734, "body": "Yes that is right and in my specific use case, I am doing a sort of timeout in my main app using <code>time.After(ShutdownTimeoutSeconds * time.Second)</code> within a <code>select {}</code> and either we get the timeout or we get a final shutdown signal which is signaled after the <code>Close()</code> finishes."}], "tags": [], "owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "is_accepted": false, "score": 0, "last_activity_date": 1549457294, "last_edit_date": 1549457294, "creation_date": 1549452821, "answer_id": 54552714, "question_id": 54547298, "link": "https://stackoverflow.com/questions/54547298/how-to-coordinate-shutdown-with-many-goroutines/54552714#54552714", "title": "How to coordinate shutdown with many goroutines", "body": "<p>I think waiting indefinitely for all the go routines to finish is not the right way.\nIf one of the go routines get blocked or say it hangs due to some reason and never terminates successfully, what should happen kill the process or wait for go routines to finish ?</p>\n\n<p>Instead you should wait with some timeout and kill the app irrespective of whether all the routines have finished or not.</p>\n\n<p><strong>Edit: Original ans</strong>\nThanks @leaf bebop for pointing it out. I misunderstood the question.</p>\n\n<p>Context package can be used to signal all the go routines to handle kill signal.</p>\n\n<p><code>appCtx, cancel := context.WithCancel(context.Background())</code></p>\n\n<p>Here appCtx will have to be passed to all the go routines.</p>\n\n<p>On exit signal call <code>cancel()</code>.</p>\n\n<p>functions running as go routines can handle how to handle cancel context.</p>\n\n<p><a href=\"https://www.sohamkamani.com/blog/golang/2018-06-17-golang-using-context-cancellation/\" rel=\"nofollow noreferrer\">Using context cancellation in Go</a></p>\n"}, {"tags": [], "owner": {"reputation": 951, "user_id": 461801, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b8c288cff5bdf68453b7859b52047f45?s=128&d=identicon&r=PG", "display_name": "Kimmeh", "link": "https://stackoverflow.com/users/461801/kimmeh"}, "is_accepted": false, "score": 0, "last_activity_date": 1549573546, "creation_date": 1549573546, "answer_id": 54582274, "question_id": 54547298, "link": "https://stackoverflow.com/questions/54547298/how-to-coordinate-shutdown-with-many-goroutines/54582274#54582274", "title": "How to coordinate shutdown with many goroutines", "body": "<p>A pattern i use a lot is: <a href=\"https://play.golang.org/p/ibMz36TS62z\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ibMz36TS62z</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\ntype response struct {\n    message string\n}\n\nfunc task(i int, done chan response) {\n    time.Sleep(1 * time.Second)\n    done &lt;- response{fmt.Sprintf(\"%d done\", i)}\n}\n\nfunc main() {\n\n    responses := GetResponses(10)\n\n    fmt.Println(\"all done\", len(responses))\n}\n\nfunc GetResponses(n int) []response {\n    donequeue := make(chan response)\n    wg := sync.WaitGroup{}\n    for i := 0; i &lt; n; i++ {\n        wg.Add(1)\n        go func(value int) {\n            defer wg.Done()\n            task(value, donequeue)\n        }(i)\n    }\n    go func() {\n        wg.Wait()\n        close(donequeue)\n    }()\n    responses := []response{}\n    for result := range donequeue {\n        responses = append(responses, result)\n    }\n\n    return responses\n}\n</code></pre>\n\n<p>this makes it easy to throttle as well: <a href=\"https://play.golang.org/p/a4MKwJKj634\" rel=\"nofollow noreferrer\">https://play.golang.org/p/a4MKwJKj634</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\ntype response struct {\n    message string\n}\n\nfunc task(i int, done chan response) {\n    time.Sleep(1 * time.Second)\n    done &lt;- response{fmt.Sprintf(\"%d done\", i)}\n}\n\nfunc main() {\n\n    responses := GetResponses(10, 2)\n\n    fmt.Println(\"all done\", len(responses))\n}\n\nfunc GetResponses(n, concurrent int) []response {\n\n    throttle := make(chan int, concurrent)\n    for i := 0; i &lt; concurrent; i++ {\n        throttle &lt;- i\n    }\n    donequeue := make(chan response)\n    wg := sync.WaitGroup{}\n    for i := 0; i &lt; n; i++ {\n        wg.Add(1)\n        &lt;-throttle\n        go func(value int) {\n            defer wg.Done()\n            throttle &lt;- 1\n            task(value, donequeue)\n        }(i)\n    }\n    go func() {\n        wg.Wait()\n        close(donequeue)\n    }()\n    responses := []response{}\n    for result := range donequeue {\n        responses = append(responses, result)\n    }\n\n    return responses\n}\n</code></pre>\n"}], "owner": {"reputation": 1061, "user_id": 489149, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/2369401260afca71c5bc5707f5b8765d?s=128&d=identicon&r=PG", "display_name": "Ian Herbert", "link": "https://stackoverflow.com/users/489149/ian-herbert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 761, "favorite_count": 0, "answer_count": 4, "score": 4, "last_activity_date": 1549573546, "creation_date": 1549431960, "question_id": 54547298, "link": "https://stackoverflow.com/questions/54547298/how-to-coordinate-shutdown-with-many-goroutines", "title": "How to coordinate shutdown with many goroutines", "body": "<p>Say I have a function</p>\n\n<pre><code>type Foo struct {}\n\nfunc (a *Foo) Bar() {\n    // some expensive work - does some calls to redis\n}\n</code></pre>\n\n<p>which gets executed within a goroutine at some point in my app. Lots of these may be executing at any given point. Prior to application termination, I would like to ensure all remaining goroutines have finished their work.</p>\n\n<p>Can I do something like this:</p>\n\n<pre><code>type Foo struct {\n    wg sync.WaitGroup\n}\n\nfunc (a *Foo) Close() {\n    a.wg.Wait()\n}\n\nfunc (a *Foo) Bar() {\n    a.wg.Add(1)\n    defer a.wg.Done()\n\n    // some expensive work - does some calls to redis\n}\n</code></pre>\n\n<p>Assuming here that Bar gets executed within a goroutine and many of these may be running at a given time and that Bar should not be called once Close is called and Close is called upon a sigterm or sigint.</p>\n\n<p>Does this make sense?</p>\n\n<p>Usually I would see the Bar function look like this:</p>\n\n<pre><code>func (a *Foo) Bar() {\n    a.wg.Add(1)\n\n    go func() {\n        defer a.wg.Done()\n        // some expensive work - does some calls to redis\n    }()\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 5, "user_id": 11021102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1d2cb212a5337732ba00314731dc20?s=128&d=identicon&r=PG&f=1", "display_name": "fayik", "link": "https://stackoverflow.com/users/11021102/fayik"}, "edited": false, "score": 0, "creation_date": 1549433151, "post_id": 54547333, "comment_id": 95895358, "body": "i tried that and it did solve it for a moment but it is now giving this,&amp;{44 0 0 true false false false 0xc4200c4000 0 [] [] [] []} ?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 5, "user_id": 11021102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1d2cb212a5337732ba00314731dc20?s=128&d=identicon&r=PG&f=1", "display_name": "fayik", "link": "https://stackoverflow.com/users/11021102/fayik"}, "edited": false, "score": 0, "creation_date": 1549434558, "post_id": 54547333, "comment_id": 95895876, "body": "Edit the question to show what is producing that output and a description of what you expect.  Note that the output in your comment shows boolean values, yet the question does use any boolean types. It&#39;s unclear what you are asking."}, {"owner": {"reputation": 5, "user_id": 11021102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1d2cb212a5337732ba00314731dc20?s=128&d=identicon&r=PG&f=1", "display_name": "fayik", "link": "https://stackoverflow.com/users/11021102/fayik"}, "edited": false, "score": 0, "creation_date": 1549458874, "post_id": 54547333, "comment_id": 95908745, "body": "it is showing that because of the 0 y values, but i want to run through a dataset and assign first value to a slice named x and second column to a slice named y, and then append them to a single file called dataset??                                              for {       \trecord, err := reader.Read()       for _, i := range record[:1] {         parsedValue, err := strconv.ParseFloat(i, 64)             dataset = append(dataset, gomeans.Point{parsedValue,0}) }, like here i am i want to iterate through record and get x and y value?(ist and 2nd field respectively)?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 5, "user_id": 11021102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1d2cb212a5337732ba00314731dc20?s=128&d=identicon&r=PG&f=1", "display_name": "fayik", "link": "https://stackoverflow.com/users/11021102/fayik"}, "edited": false, "score": 0, "creation_date": 1549469677, "post_id": 54547333, "comment_id": 95915643, "body": "Your first comment states that the problem is solved. You then go on to describe issues not supported by the question. As already noted, there are no booleans in the question. There are no slices or columns named x and y in the question. I suggest asking a new question about these other problems.  Include minimal code illustrating the problem in that question."}, {"owner": {"reputation": 5, "user_id": 11021102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1d2cb212a5337732ba00314731dc20?s=128&d=identicon&r=PG&f=1", "display_name": "fayik", "link": "https://stackoverflow.com/users/11021102/fayik"}, "edited": false, "score": 0, "creation_date": 1549521699, "post_id": 54547333, "comment_id": 95933380, "body": "this is a new issue but they blocked me becoz someone downvoted my question, i dont know..my question was pretty clear and neat to me..."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 5, "user_id": 11021102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1d2cb212a5337732ba00314731dc20?s=128&d=identicon&r=PG&f=1", "display_name": "fayik", "link": "https://stackoverflow.com/users/11021102/fayik"}, "edited": false, "score": 0, "creation_date": 1549553413, "post_id": 54547333, "comment_id": 95951081, "body": "Your comments here make it unclear what you are asking.  The question also shows lack of research."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1549432177, "creation_date": 1549432177, "answer_id": 54547333, "question_id": 54547266, "link": "https://stackoverflow.com/questions/54547266/too-few-values-in-struct-intializer-error/54547333#54547333", "title": "Too few values in struct intializer error", "body": "<p>A struct composite literal must either use named fields or specify all fields. The Point struct has two fields, X and Y.  Assuming that you were attempting to set the X field, do one of the following:</p>\n\n<pre><code> Point{X: rand.Float64()}  // Y defaults to zero value\n Point(X: rand.Float64(), Y: 0} // Y explicitly set to zero using name\n Point(rand.Float64(), 0}  // Y explicitly set to zero using positional value\n</code></pre>\n\n<p>Specifying struct fields by name is generally preferred over positional values.</p>\n"}], "owner": {"reputation": 5, "user_id": 11021102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b1d2cb212a5337732ba00314731dc20?s=128&d=identicon&r=PG&f=1", "display_name": "fayik", "link": "https://stackoverflow.com/users/11021102/fayik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 645, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1552209293, "creation_date": 1549431807, "last_edit_date": 1552209293, "question_id": 54547266, "link": "https://stackoverflow.com/questions/54547266/too-few-values-in-struct-intializer-error", "title": "Too few values in struct intializer error", "body": "<p>i am getting the error, too few values in struct initialiser at line  clusters = append(clusters, Cluster{Point{rand.Float64()}, []Point{}}) \nthe function that throws the error is below. </p>\n\n<pre><code>func initClusters(k int) (clusters []Cluster) {\nrand.Seed(time.Now().UnixNano())\nfor i := 0; i &lt; k; i++ {\n    clusters = append(clusters, Cluster{Point{rand.Float64()},[]Point{}})\n}\nreturn\n}\n</code></pre>\n\n<p>i am putting k = 3,  the cluster struct defined is </p>\n\n<pre><code>type Cluster struct {\nCenter Point\nPoints []Point\n}\n</code></pre>\n\n<p>and the point is also a struct defined as: </p>\n\n<pre><code>type Point struct {\nX float64\nY float64\n}\n</code></pre>\n\n<p>Can someone please help?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 2, "creation_date": 1549416246, "post_id": 54545286, "comment_id": 95891560, "body": "Go aside, how do you currently interact with your <code>program</code>?  Stdin / Stdout?  Pipes? Sockets?"}, {"owner": {"reputation": 21, "user_id": 11020499, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-aHF-6ahMmik/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPb_2DI1KTBa0SoTe05zuPViVZGzw/mo/photo.jpg?sz=128", "display_name": "Maha Alrasheed", "link": "https://stackoverflow.com/users/11020499/maha-alrasheed"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1549417014, "post_id": 54545286, "comment_id": 95891685, "body": "I don&#39;t know how this could work, that is what I&#39;m trying to figure out. I wish someone could guide me in this. The binary that I&#39;m trying to interact with receives an input and give and output and waits for another input. So what I want to do is interacting with it in that way."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1549417247, "post_id": 54545286, "comment_id": 95891720, "body": "It sounds like you are interacting with stdin and stdout then.  Take a look here: <a href=\"https://stackoverflow.com/questions/36382880/go-write-to-stdin-on-external-command\" title=\"go write to stdin on external command\">stackoverflow.com/questions/36382880/&hellip;</a>"}, {"owner": {"reputation": 21, "user_id": 11020499, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-aHF-6ahMmik/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPb_2DI1KTBa0SoTe05zuPViVZGzw/mo/photo.jpg?sz=128", "display_name": "Maha Alrasheed", "link": "https://stackoverflow.com/users/11020499/maha-alrasheed"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1549417402, "post_id": 54545286, "comment_id": 95891750, "body": "I&#39;m trying stdin, but I don&#39;t know how I can write to the binary not to my program."}, {"owner": {"reputation": 21, "user_id": 11020499, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-aHF-6ahMmik/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPb_2DI1KTBa0SoTe05zuPViVZGzw/mo/photo.jpg?sz=128", "display_name": "Maha Alrasheed", "link": "https://stackoverflow.com/users/11020499/maha-alrasheed"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1549417460, "post_id": 54545286, "comment_id": 95891761, "body": "Oh, I will try this. Thank you so much!"}], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 1, "last_activity_date": 1549461498, "last_edit_date": 1549461498, "creation_date": 1549460977, "answer_id": 54555174, "question_id": 54545286, "link": "https://stackoverflow.com/questions/54545286/how-can-i-run-a-binary-file-in-my-golang-program-and-keep-interacting-with-it-by/54555174#54555174", "title": "How can I run a binary file in my golang program and keep interacting with it by sending some input and waiting for the output?", "body": "<p>I believe the right way to accomplish this is using the <code>StdinPipe</code> and <code>StdoutPipe</code> methods of <code>exec.Cmd</code>.</p>\n\n<p>See examples in <a href=\"https://golang.org/pkg/os/exec/#Cmd.StdinPipe\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/exec/#Cmd.StdinPipe</a>, etc.</p>\n\n<hr>\n\n<p>Here's an example that invokes the <code>bc</code> command (built-in calculator that takes calculations from stdin and emits results to stdout) and interacts with it a bit:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os/exec\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"bc\", \"-q\")\n\n    stdin, err := cmd.StdinPipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    stdout, err := cmd.StdoutPipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    if err := cmd.Start(); err != nil {\n        log.Fatal(err)\n    }\n\n    stdin.Write([]byte(\"2 + 2\\n\"))\n\n    r := bufio.NewReader(stdout)\n    b, err := r.ReadBytes('\\n')\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(\"Read:\", string(b))\n}\n</code></pre>\n\n<p>In a real program you may want to run this thing in a goroutine so it doesn't block the rest of the application, happens in the background, etc.</p>\n"}], "owner": {"reputation": 21, "user_id": 11020499, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-aHF-6ahMmik/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPb_2DI1KTBa0SoTe05zuPViVZGzw/mo/photo.jpg?sz=128", "display_name": "Maha Alrasheed", "link": "https://stackoverflow.com/users/11020499/maha-alrasheed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 722, "favorite_count": 2, "answer_count": 1, "score": 2, "last_activity_date": 1549461498, "creation_date": 1549414794, "last_edit_date": 1549414990, "question_id": 54545286, "link": "https://stackoverflow.com/questions/54545286/how-can-i-run-a-binary-file-in-my-golang-program-and-keep-interacting-with-it-by", "title": "How can I run a binary file in my golang program and keep interacting with it by sending some input and waiting for the output?", "body": "<p>How can I run a binary file in my golang program and keep interacting with it by sending some input and waiting for the output? In what I did, I run it only once. And I want to keep this binary file running and interact with it, I don't want to run it multiple times.</p>\n\n<pre><code>package main\n\nimport (\n    \"os/exec\"\n    \"bytes\"\n    \"fmt\"\n)\n\nfunc main() {\n    command := exec.Command(\"./program\")\n    var output bytes.Buffer\n    command.Stdout = &amp;output\n    command.Run()\n    result := output.String()\n    IV := result[:4]\n    cipher := result[5:]\n    cipher = cipher[:len(cipher)-1]\n    fmt.Printf(\"%v\", result)\n    fmt.Printf(\"%v\", IV)\n    fmt.Printf(\"%v\", cipher)\n}\n</code></pre>\n"}, {"tags": ["windows", "go", "permissions", "file-permissions", "read-write"], "comments": [{"owner": {"reputation": 3740, "user_id": 1246282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e2c2f18588f9771a7db500e90a6eb44?s=128&d=identicon&r=PG", "display_name": "chrsblck", "link": "https://stackoverflow.com/users/1246282/chrsblck"}, "edited": false, "score": 0, "creation_date": 1549415034, "post_id": 54545225, "comment_id": 95891337, "body": "Does the file <code>test.txt</code> exist before you run this program? The <a href=\"https://golang.org/pkg/io/ioutil/#WriteFile\" rel=\"nofollow noreferrer\">docs</a> say &quot;If the file does not exist, WriteFile creates it with permissions perm; otherwise WriteFile truncates it before writing.&quot;. This means, if the file is already present, <code>WriteFile()</code> won&#39;t modify the perms."}, {"owner": {"reputation": 61, "user_id": 8045515, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Yp7TIFJpZK8/AAAAAAAAAAI/AAAAAAAABiw/10MEtAehGQ4/photo.jpg?sz=128", "display_name": "barjo", "link": "https://stackoverflow.com/users/8045515/barjo"}, "reply_to_user": {"reputation": 3740, "user_id": 1246282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e2c2f18588f9771a7db500e90a6eb44?s=128&d=identicon&r=PG", "display_name": "chrsblck", "link": "https://stackoverflow.com/users/1246282/chrsblck"}, "edited": false, "score": 0, "creation_date": 1549416088, "post_id": 54545225, "comment_id": 95891528, "body": "Nope, it doesn&#39;t exist. Completely clean directory, only containing main.go. The newly created file always has access permissions of 0644."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1549416354, "post_id": 54545225, "comment_id": 95891578, "body": "What is your executing user&#39;s umask?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1549416415, "post_id": 54545225, "comment_id": 95891585, "body": "<code>test.txt</code> already exists with permission <code>0644</code>. I would expect this file to be written out with only <code>0200</code> if you have a default umask."}, {"owner": {"reputation": 61, "user_id": 8045515, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Yp7TIFJpZK8/AAAAAAAAAAI/AAAAAAAABiw/10MEtAehGQ4/photo.jpg?sz=128", "display_name": "barjo", "link": "https://stackoverflow.com/users/8045515/barjo"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1549416803, "post_id": 54545225, "comment_id": 95891649, "body": "@JimB <code>test.txt</code> doesn&#39;t exist at all before this code is run. I don&#39;t know what &#39;default unmask&#39; is, but I would assume I&#39;m using the default as I haven&#39;t made any attempts to change it (wouldn&#39;t know how). I&#39;m on Windows if that helps?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1549417259, "post_id": 54545225, "comment_id": 95891723, "body": "oh, you&#39;re on windows, that probably has something to do with it. It may be that since <code>0222</code> doesn&#39;t really make sense, it adds appropriate read permissions as well."}, {"owner": {"reputation": 15921, "user_id": 1542723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8a969ba62fc77da0a20654caffbe234?s=128&d=identicon&r=PG", "display_name": "Ferrybig", "link": "https://stackoverflow.com/users/1542723/ferrybig"}, "edited": false, "score": 0, "creation_date": 1549438071, "post_id": 54545225, "comment_id": 95897221, "body": "Windows doesn&#39;t have numerical permissions, it has a different model. Bash is just faking it to the Linux model as Linux tools expect it to be there"}, {"owner": {"reputation": 29355, "user_id": 205580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/460e6e299e385fd46df156c85a1dd55f?s=128&d=identicon&r=PG", "display_name": "Eryk Sun", "link": "https://stackoverflow.com/users/205580/eryk-sun"}, "edited": false, "score": 0, "creation_date": 1549506558, "post_id": 54545225, "comment_id": 95929492, "body": "The permissions get ignored. Ultimately it calls <code>syscall.Open</code>. Confirm this for yourself in the Windows implementation of <a href=\"https://github.com/golang/go/blob/release-branch.go1.11/src/syscall/syscall_windows.go#L247\" rel=\"nofollow noreferrer\"><code>syscall.Open</code></a>. Also, like a lot of POSIX-over-Windows tools, their <a href=\"https://github.com/golang/go/blob/release-branch.go1.11/src/syscall/syscall_windows.go#L538\" rel=\"nofollow noreferrer\">syscall.Chmod</a> sets the file&#39;s readonly attribute if write access isn&#39;t allowed."}], "owner": {"reputation": 61, "user_id": 8045515, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Yp7TIFJpZK8/AAAAAAAAAAI/AAAAAAAABiw/10MEtAehGQ4/photo.jpg?sz=128", "display_name": "barjo", "link": "https://stackoverflow.com/users/8045515/barjo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 475, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1549437180, "creation_date": 1549414206, "last_edit_date": 1549437180, "question_id": 54545225, "link": "https://stackoverflow.com/questions/54545225/permissions-ignored-when-writing-a-file", "title": "Permissions ignored when writing a file", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n)\n\nfunc check(e error) {\n    if e != nil {\n        panic(e)\n    }\n}\n\nfunc main() {\n    ioutil.WriteFile(\"test.txt\", []byte(\"Hello world\"), 0222)\n\n    b, e := ioutil.ReadFile(\"test.txt\")\n    check(e)\n\n    fmt.Println(string(b))\n}\n</code></pre>\n\n<p>I'm using the <code>io/ioutil</code> package to read/write a file, and setting the permissions to 0222 (write, write, write) when writing the file still allows me to read the file after it's written.</p>\n\n<p>Using <code>stat test.txt</code> in Bash, the access shows as <code>(0644/-rw-r--r--)</code>.</p>\n\n<p>Why is the file written with 0644 permissions and not the specified 0222?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 5, "creation_date": 1549413748, "post_id": 54545009, "comment_id": 95891069, "body": "&quot;I want to make this method generic&quot; and &quot;I&#39;m very new to Go&quot; almost always means you&#39;re going down the wrong road. Do not create complicated things based on reflection to save three lines of simple code; just write the three lines of simple code and move on. What &quot;some operation&quot; do you have in mind that you could apply to every possible type? Or is there really a small number of types you&#39;re actually dealing with? (Sounds like you want an interface, not reflection.) If you&#39;re trying to write a generic map() or filter() function, stop. If there were a good way to do that, it&#39;d be in stdlib."}, {"owner": {"reputation": 61, "user_id": 5131192, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-SMT-YkgJ5oo/AAAAAAAAAAI/AAAAAAAAEiI/e2XXyKYfObk/photo.jpg?sz=128", "display_name": "TiN", "link": "https://stackoverflow.com/users/5131192/tin"}, "reply_to_user": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 1, "creation_date": 1549414647, "post_id": 54545009, "comment_id": 95891263, "body": "@RobNapier I&#39;ve added some more information in the original post, if that helps to make it clear. Thanks!"}, {"owner": {"reputation": 6095, "user_id": 2317463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ccc6966c56da13c927a06caf26b02b92?s=128&d=identicon&r=PG", "display_name": "Jake Burkhead", "link": "https://stackoverflow.com/users/2317463/jake-burkhead"}, "edited": false, "score": 1, "creation_date": 1549414786, "post_id": 54545009, "comment_id": 95891296, "body": "Have you read <a href=\"https://github.com/golang/go/wiki/InterfaceSlice\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/InterfaceSlice</a> ?"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1549418462, "last_edit_date": 1549418462, "creation_date": 1549418067, "answer_id": 54545617, "question_id": 54545009, "link": "https://stackoverflow.com/questions/54545009/cast-interface-to-interface/54545617#54545617", "title": "cast interface{} to []interface{}", "body": "<p>As the error message states, a <code>[]string</code> is not an <code>[]interface{}</code>. See the <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">FAQ</a> for  an explanation.</p>\n\n<p>Use the reflect API do to this generically:</p>\n\n<pre><code>v := reflect.ValueOf(raw)\nswitch v.Kind() {\ncase reflect.Slice:\n    for i := 0; i &lt; v.Len(); i++ {\n        elem := v.Index(i).Interface()\n        // elem is an element of the slice\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/1yzPFgT8Lwa\" rel=\"nofollow noreferrer\">Run it on the Playground</a>.</p>\n"}], "owner": {"reputation": 61, "user_id": 5131192, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-SMT-YkgJ5oo/AAAAAAAAAAI/AAAAAAAAEiI/e2XXyKYfObk/photo.jpg?sz=128", "display_name": "TiN", "link": "https://stackoverflow.com/users/5131192/tin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 54545617, "answer_count": 1, "score": 0, "last_activity_date": 1549418462, "creation_date": 1549412311, "last_edit_date": 1549414433, "question_id": 54545009, "link": "https://stackoverflow.com/questions/54545009/cast-interface-to-interface", "title": "cast interface{} to []interface{}", "body": "<p>How can I cast an interface{} to []interface{} ?</p>\n\n<pre><code>rt := reflect.ValueOf(raw)\nswitch rt.Kind() {\ncase reflect.Slice:\n    src := raw.([]interface{}) //this operation errors out\n    for _,_ :=  range src {\n        //some operation\n    }  \n}\n</code></pre>\n\n<p>I get an error <code>panic: interface conversion: interface {} is []string, not []interface {}</code>\nI want make this method generic enough to handle any type, not a fixed type. </p>\n\n<p>I'm very new to Go and I'm stuck with this problem, most likely I'm doing it wrong. Any suggestion how can I get around this ?</p>\n\n<p><strong>Edit:</strong>\nSome operation is <code>json.Marshal</code> which return byte array.</p>\n\n<p><strong>What I'm really trying to do:</strong>\nI have a function that receives interface type, if it is an array/slice then I would like to run json.Marshal on each item rather than apply it as a whole. Basically, I'm trying to break up the JSON blob if the first level object is an array, and yes it needs to be generic.</p>\n"}, {"tags": ["go", "rpc"], "comments": [{"owner": {"reputation": 1907, "user_id": 3625843, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/sXmwj.png?s=128&g=1", "display_name": "Evan Conrad", "link": "https://stackoverflow.com/users/3625843/evan-conrad"}, "edited": false, "score": 0, "creation_date": 1549427046, "post_id": 54544680, "comment_id": 95893641, "body": "Is there a reason you couldn&#39;t put this in your headers? Or possibly as another argument to your RPC call?"}, {"owner": {"reputation": 601, "user_id": 1347268, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/abd1a63352cf4aa1e8e18228eb2c88c3?s=128&d=identicon&r=PG", "display_name": "Mark Fletcher", "link": "https://stackoverflow.com/users/1347268/mark-fletcher"}, "reply_to_user": {"reputation": 1907, "user_id": 3625843, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/sXmwj.png?s=128&g=1", "display_name": "Evan Conrad", "link": "https://stackoverflow.com/users/3625843/evan-conrad"}, "edited": false, "score": 0, "creation_date": 1549428544, "post_id": 54544680, "comment_id": 95893999, "body": "I suppose so? But what if the meta data is in the form of a struct? It just didn&#39;t seem that &#39;clean&#39; of an idea."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1549429520, "post_id": 54544680, "comment_id": 95894246, "body": "If the RPC protocol of your choice doesn&#39;t support complex types you have to encode them into a supported type. Using JSON you can turn most data structures into a string, for instance."}], "owner": {"reputation": 601, "user_id": 1347268, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/abd1a63352cf4aa1e8e18228eb2c88c3?s=128&d=identicon&r=PG", "display_name": "Mark Fletcher", "link": "https://stackoverflow.com/users/1347268/mark-fletcher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1549409732, "creation_date": 1549409732, "question_id": 54544680, "link": "https://stackoverflow.com/questions/54544680/rpc-with-some-meta-data-along-with-streaming", "title": "RPC with some meta-data along with streaming", "body": "<p>Using Go, I am looking for a way to do RPC where I can send some meta-data and an associated stream of data. The meta-data is small and will fit in memory, so can be transferred using any number of ways, but then the associated large buffer won't fit in memory and we don't want to keep a copy in memory, we just want to stream it/operate on it as a stream.</p>\n\n<p>As an example, say I want to set up an image resizing server. I want to make a call to the server with the dimensions of the resized image and some other parameters, but assume the image itself won't fit in memory (on the client, we're reading it off disk, or streaming it from a separate network call, for example).</p>\n"}, {"tags": ["go", "dependency-injection"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1549399919, "post_id": 54542758, "comment_id": 95886781, "body": "You&#39;re probably missing the build constraint as explained in the <a href=\"https://github.com/google/wire/blob/master/_tutorial/README.md\" rel=\"nofollow noreferrer\">Google Wire docs</a>."}], "answers": [{"comments": [{"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 1, "creation_date": 1549411115, "post_id": 54542882, "comment_id": 95890467, "body": "Indeed, the empty line requirement comes from go/build (<a href=\"https://golang.org/pkg/go/build/\" rel=\"nofollow noreferrer\">golang.org/pkg/go/build</a>), but it&#39;s a shame that the error is delayed and confusing. We&#39;ve opened <a href=\"https://github.com/google/wire/issues/117\" rel=\"nofollow noreferrer\">github.com/google/wire/issues/117</a> for Wire to track a potential solution"}], "tags": [], "owner": {"reputation": 996, "user_id": 1478734, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e7e6165d9ee3338be3582313ec6648ba?s=128&d=identicon&r=PG", "display_name": "ehrt1974", "link": "https://stackoverflow.com/users/1478734/ehrt1974"}, "is_accepted": false, "score": 2, "last_activity_date": 1549400010, "creation_date": 1549400010, "answer_id": 54542882, "question_id": 54542758, "link": "https://stackoverflow.com/questions/54542758/wire-generating-second-function-with-same-name-in-same-namespace/54542882#54542882", "title": "Wire generating second function with same name in same namespace", "body": "<p>Just found the solution.</p>\n\n<p>A build constraint (like <code>//+build wireinject</code>) needs to be followed by an empty line, otherwise it will be ignored by <code>go build</code> and the file will be included in the build.</p>\n"}], "owner": {"reputation": 996, "user_id": 1478734, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/e7e6165d9ee3338be3582313ec6648ba?s=128&d=identicon&r=PG", "display_name": "ehrt1974", "link": "https://stackoverflow.com/users/1478734/ehrt1974"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1549400101, "creation_date": 1549399529, "last_edit_date": 1549400101, "question_id": 54542758, "link": "https://stackoverflow.com/questions/54542758/wire-generating-second-function-with-same-name-in-same-namespace", "title": "Wire generating second function with same name in same namespace", "body": "<p>I'm having a look at Go <a href=\"https://github.com/google/wire\" rel=\"nofollow noreferrer\">wire</a>. The problem I am having is that <code>wire</code> generates code from a template in a file in the same directory which means that there are now two functions with the same signature in the same namespace, which go, of course, does not like.</p>\n\n<p>How should I deal with this? should i write a script which deletes the original file before running <code>go build</code> or <code>go run</code> ?</p>\n"}, {"tags": ["go", "concurrency", "synchronization", "locking", "mutex"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1549392073, "post_id": 54540798, "comment_id": 95883215, "body": "Channels are the only synchronization <i>primitive</i>, but there are mutex locks in the stdlib: <a href=\"https://golang.org/pkg/sync/\" rel=\"nofollow noreferrer\">golang.org/pkg/sync</a>"}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 3061631, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a169b7c924832cf6f273040850b38b6c?s=128&d=identicon&r=PG&f=1", "display_name": "user3061631", "link": "https://stackoverflow.com/users/3061631/user3061631"}, "edited": false, "score": 0, "creation_date": 1549392969, "post_id": 54540839, "comment_id": 95883652, "body": "Thank you for your suggestion, I&#39;ll study the linked resources. Does this approach scale?"}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "reply_to_user": {"reputation": 15, "user_id": 3061631, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a169b7c924832cf6f273040850b38b6c?s=128&d=identicon&r=PG&f=1", "display_name": "user3061631", "link": "https://stackoverflow.com/users/3061631/user3061631"}, "edited": false, "score": 0, "creation_date": 1549397505, "post_id": 54540839, "comment_id": 95885752, "body": "@user3061631: scale in what sense?"}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 1, "last_activity_date": 1549391374, "creation_date": 1549391374, "answer_id": 54540839, "question_id": 54540798, "link": "https://stackoverflow.com/questions/54540798/selective-mutual-exclusion-on-goroutines/54540839#54540839", "title": "&quot;selective&quot; mutual exclusion on goroutines", "body": "<p>You can use a buffered channel as a semaphore, and create such a channel per user. Then two goroutines related to the same user will only be able to do things after acquiring the semaphore (successfully writing to the channel).</p>\n\n<hr>\n\n<p>Resources on using Go channels as semaphores:</p>\n\n<ul>\n<li>Effective Go: <a href=\"https://golang.org/doc/effective_go.html#channels\" rel=\"nofollow noreferrer\">https://golang.org/doc/effective_go.html#channels</a></li>\n<li><a href=\"http://www.golangpatterns.info/concurrency/semaphores\" rel=\"nofollow noreferrer\">http://www.golangpatterns.info/concurrency/semaphores</a></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1549404350, "last_edit_date": 1549404350, "creation_date": 1549397511, "answer_id": 54542291, "question_id": 54540798, "link": "https://stackoverflow.com/questions/54540798/selective-mutual-exclusion-on-goroutines/54542291#54542291", "title": "&quot;selective&quot; mutual exclusion on goroutines", "body": "<p>Use <a href=\"https://godoc.org/sync#Mutex\" rel=\"nofollow noreferrer\">sync.Mutex</a> for mutual exclusion.  Use one mutex for each active user.  </p>\n\n<p>I'll assume that users are identified by some sort of id. Let's call that type <code>userID</code>. Use a map keyed by <code>userID</code> to store the per user mutex. </p>\n\n<p>A mutex is only needed for active users, not all potential users. Use an integer counter to determine if a user is active.</p>\n\n<p>The aforementioned map and counters should also be protected by a mutex.</p>\n\n<p>Here's the code:</p>\n\n<pre><code>type userID string // replace userID type with id type for your application\n\n// userLock is the per user lock\ntype userLock struct {\n    sync.Mutex\n\n    // n is number of goroutines between lock and unlock\n    n int\n}\n\nvar (\n    // mu protects locks map and n field in userLock\n    mu    sync.Mutex\n\n    // locks is map of active locks\n    locks = map[userID]*userLock{}\n)\n\n\n// lockUser locks the user specified by id. If the lock is\n// already in use, the calling goroutine blocks until\n// the lock is available.\nfunc lockUser(id userID) {\n    mu.Lock()\n    l := locks[id]\n    if l == nil {\n        l = &amp;userLock{}\n        locks[id] = l\n    }\n    l.n++\n    mu.Unlock()\n    l.Lock()\n}\n\n// unlockUser unlocks the user specified by id. It \n// is a run-time error if the user is not locked on\n// entry unlockUser.\nfunc unlockUser(id userID) {\n    mu.Lock()\n    l := locks[id]\n    if l == nil {\n        panic(\"unlock without lock\")\n    }\n    l.n--\n    if l.n == 0 {\n        delete(locks, id)\n    }\n    mu.Unlock()\n    l.Unlock()\n}\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 3061631, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/a169b7c924832cf6f273040850b38b6c?s=128&d=identicon&r=PG&f=1", "display_name": "user3061631", "link": "https://stackoverflow.com/users/3061631/user3061631"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1549404350, "creation_date": 1549391208, "last_edit_date": 1549397172, "question_id": 54540798, "link": "https://stackoverflow.com/questions/54540798/selective-mutual-exclusion-on-goroutines", "title": "&quot;selective&quot; mutual exclusion on goroutines", "body": "<p>I am new to Go and I would like to implement a custom mutual exclusion mechanism, where each application user can execute one goroutine at a time.\nTo simplify, consider U1 and U2 as application users and F1(userId), F2(userId) and F3(userId) three different goroutines, which read/write records from a database <strong>that are related only to a given user</strong>. I would like that, if U1 calls (F1, F2, F3), (F2, F3) are not executed until F1 has ended, than F2 or F3 are executed (in calling order would be an optimal solution), lastly the remaining one is executed. U2 is not affected by U1 lock, but she is controlled by its own lock as described before. How would you implement this? Is there a built-in primitive? Thanks</p>\n"}, {"tags": ["go", "struct", "initialization", "composite-literals"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1549392149, "post_id": 54540633, "comment_id": 95883247, "body": "The best way would be to write a custom linter."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1549395503, "post_id": 54540633, "comment_id": 95884832, "body": "A hypothetical problem easily discovered during unit testing so nothing to worry about."}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1549403298, "post_id": 54540747, "comment_id": 95888253, "body": "There is a good idea in this, but it&#39;s unnecessary to construct a value of <code>tempPerson</code> and to convert and assign it to a <code>Person</code> every time <code>copyPerson()</code> is called. After all, you just need to know if the struct types (their fields) match, which check can be performed at compile time. See <a href=\"https://stackoverflow.com/a/54542774/1705598\">my answer how to do that</a>."}], "tags": [], "owner": {"reputation": 1771, "user_id": 2736037, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/FJzsN.jpg?s=128&g=1", "display_name": "elijahcarrel", "link": "https://stackoverflow.com/users/2736037/elijahcarrel"}, "is_accepted": false, "score": 0, "last_activity_date": 1549390953, "creation_date": 1549390953, "answer_id": 54540747, "question_id": 54540633, "link": "https://stackoverflow.com/questions/54540633/prevent-missing-fields-in-struct-initialization/54540747#54540747", "title": "Prevent missing fields in struct initialization", "body": "<p>The best solution I have been able to come up with (and it's not very good) is to define a new struct <code>tempPerson</code> identical to the <code>Person</code> struct and put it nearby to any code which initializes a new Person struct, and to change the code that initializes a <code>Person</code> so that it instead initializes it as a <code>tempPerson</code> but then casts it to a <code>Person</code>. Like this:</p>\n\n<pre><code>type tempPerson struct {\n    Name string\n    Age  int\n    [some other fields]\n}\n\nfunc copyPerson(origPerson Person) *Person {\n    tempCopy := tempPerson{\n        Name: orig.Name,\n        Age:  orig.Age,\n        [some other fields]\n    }\n    copy := (Person)(tempCopy)\n    return &amp;copy\n}\n</code></pre>\n\n<p>This way if another field <code>Gender</code> is added to <code>Person</code> but not to <code>tempPerson</code> the code will fail at compile-time. Presumably the developer would then see the error, edit <code>tempPerson</code> to match their change to <code>Person</code>, and in doing so notice the nearby code which uses <code>tempPerson</code> and recognize that they should edit that code to also handle the <code>Gender</code> field as well.</p>\n\n<p>I don't love this solution because it involves copying and pasting the struct definition everywhere that we initialize a <code>Person</code> struct and would like to have this safety. Is there any better way?</p>\n"}, {"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 1, "last_activity_date": 1549390976, "creation_date": 1549390976, "answer_id": 54540751, "question_id": 54540633, "link": "https://stackoverflow.com/questions/54540633/prevent-missing-fields-in-struct-initialization/54540751#54540751", "title": "Prevent missing fields in struct initialization", "body": "<p>I'm not aware of a language rule that enforces that.</p>\n\n<p>But you can write custom checkers for <a href=\"https://golang.org/cmd/vet/\" rel=\"nofollow noreferrer\">Go vet</a> if you'd like. <a href=\"https://agniva.me/vet/2019/01/21/vet-analyzer.html\" rel=\"nofollow noreferrer\">Here's a recent post talking about that</a>.</p>\n\n<hr>\n\n<p>That said, I would reconsider the design here. If the <code>Person</code> struct is so important in your code base, centralize its creation and copying so that \"distant places\" don't just create and move <code>Person</code>s around. Refactor your code so that only a single constructor is used to build <code>Person</code>s (maybe something like <code>person.New</code> returning a <code>person.Person</code>), and then you'll be able to centrally control how its fields are initialized.</p>\n"}, {"comments": [{"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 2, "creation_date": 1549391629, "post_id": 54540877, "comment_id": 95883013, "body": "I don&#39;t think he&#39;s asking for a better way to copy a person, he&#39;s asking how to handle when fields get added to the struct, to ensure that everywhere that creates an instance sets the value and it doesn&#39;t just get the default value."}], "tags": [], "owner": {"reputation": 926, "user_id": 3083825, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/a0acf64bb8976dcf3dc0a2a1e3994ca8?s=128&d=identicon&r=PG", "display_name": "SomeGuyFortune", "link": "https://stackoverflow.com/users/3083825/someguyfortune"}, "is_accepted": false, "score": 0, "last_activity_date": 1549391484, "creation_date": 1549391484, "answer_id": 54540877, "question_id": 54540633, "link": "https://stackoverflow.com/questions/54540633/prevent-missing-fields-in-struct-initialization/54540877#54540877", "title": "Prevent missing fields in struct initialization", "body": "<p>Here is how i would do it:</p>\n\n<pre><code>func copyPerson(origPerson Person) *Person { \n    newPerson := origPerson\n\n    //proof that 'newPerson' points to a new person object\n    newPerson.name = \"new name\"\n    return &amp;newPerson\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/hPICNt40sOH\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n"}, {"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1549463207, "post_id": 54540888, "comment_id": 95911417, "body": "Having fields only accessible through getter/setter methods is unidiomatic Go."}, {"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1549476549, "post_id": 54540888, "comment_id": 95919229, "body": "@Adrian not really the point of what I&#39;m showing.  Using interfaces is completely idiomatic, and if you need access to the fields, you simply return the struct instead of the interface - the exported fields of an unexported struct are still accessible."}, {"owner": {"reputation": 545, "user_id": 3156509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/E5THb.jpg?s=128&g=1", "display_name": "Beeno Tung", "link": "https://stackoverflow.com/users/3156509/beeno-tung"}, "edited": false, "score": 0, "creation_date": 1575295392, "post_id": 54540888, "comment_id": 104507747, "body": "Using this approach, it&#39;ll become verbose to write functions that accept <code>person</code> struct as argument, the consumers in other package will have to define each fields themselves as interface."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 5, "last_activity_date": 1569653117, "last_edit_date": 1569653117, "creation_date": 1549391525, "answer_id": 54540888, "question_id": 54540633, "link": "https://stackoverflow.com/questions/54540633/prevent-missing-fields-in-struct-initialization/54540888#54540888", "title": "Prevent missing fields in struct initialization", "body": "<p>The way I would solve this is to just use <code>NewPerson(params)</code> and not export the person.  This makes it so the only way to get a <code>person</code> instance is to go through your <code>New</code> method.</p>\n\n<pre><code>package person\n\n// Struct is not exported\ntype person struct {\n    Name string\n    Age  int\n    Gender bool\n}\n\n// We are forced to call the constructor to get an instance of person\nfunc New(name string, age int, gender bool) person {\n    return person{name, age, gender}\n}\n</code></pre>\n\n<p>This forces everyone to get an instance from the same place.  When you add a field, you can add it to the function definition and then you get compile time errors anywhere they are constructing a new instance, so you can easily find them and fix them.</p>\n"}, {"tags": [], "owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "is_accepted": false, "score": 0, "last_activity_date": 1549391853, "creation_date": 1549391853, "answer_id": 54540961, "question_id": 54540633, "link": "https://stackoverflow.com/questions/54540633/prevent-missing-fields-in-struct-initialization/54540961#54540961", "title": "Prevent missing fields in struct initialization", "body": "<p><strong>Approach 1 Add something like copy constructor:</strong></p>\n\n<pre><code>type Person struct {\n    Name string\n    Age  int\n}\n\nfunc CopyPerson(name string, age int)(*Person, error){\n    // check params passed if needed\n    return &amp;Person{Name: name, Age: age}, nil\n}\n\n\np := CopyPerson(p1.Name, p1.age) // force all fields to be passed\n</code></pre>\n\n<p><strong>Approach 2:</strong> (not sure if this is possible)</p>\n\n<p>Can this be covered in tests say using reflection? <br>\nIf we compare the number of fields initialised(initialise all the field with values different than the default values) in the original struct and the fields in copy returned by the copy function.</p>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1549392477, "creation_date": 1549392477, "answer_id": 54541141, "question_id": 54540633, "link": "https://stackoverflow.com/questions/54540633/prevent-missing-fields-in-struct-initialization/54541141#54541141", "title": "Prevent missing fields in struct initialization", "body": "<p>The idiomatic way would be to not do this at all, and instead <a href=\"https://www.youtube.com/watch?v=PAAkCSZUG1c&amp;t=6m25s\" rel=\"nofollow noreferrer\">make the zero value useful</a>. The example of a copy function doesn't really make sense because it's totally unnecessary - you could just say:</p>\n\n<pre><code>copy := new(Person)\n*copy = *origPerson\n</code></pre>\n\n<p>and not need a dedicated function nor have to keep a listing of fields up to date. If you want a constructor for new instances like <code>NewPerson</code>, just write one and use it as a matter of course. Linters are great for some things but nothing beats well-understood best practices and peer code review.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1549444504, "last_edit_date": 1549444504, "creation_date": 1549399592, "answer_id": 54542774, "question_id": 54540633, "link": "https://stackoverflow.com/questions/54540633/prevent-missing-fields-in-struct-initialization/54542774#54542774", "title": "Prevent missing fields in struct initialization", "body": "<p>First of all, your <code>copyPerson()</code> function does not live up to its name. It copies <em>some</em> fields of a <code>Person</code>, but not (necessarily) all. It should've been named <code>copySomeFieldsOfPerson()</code>.</p>\n\n<p>To copy a complete struct value, just assign the struct value. If you have a function receiving a non-pointer <code>Person</code>, that is already a copy, so just return its address:</p>\n\n<pre><code>func copyPerson(p Person) *Person {\n    return &amp;p\n}\n</code></pre>\n\n<p>That's all, this will copy all present and future fields of <code>Person</code>.</p>\n\n<p>Now there may be cases where fields are pointers or header-like values (like a slice) which should be \"detached\" from the original field (more precisely from the pointed object), in which case you do need to make manual adjustments, e.g.</p>\n\n<pre><code>type Person struct {\n    Name string\n    Age  int\n    Data []byte\n}\n\nfunc copyPerson(p Person) *Person {\n    p2 := p\n    p2.Data = append(p2.Data, p.Data...)\n    return &amp;p2\n}\n</code></pre>\n\n<p>Or an alternative solution which does not make another copy of <code>p</code> but still detaches <code>Person.Data</code>:</p>\n\n<pre><code>func copyPerson(p Person) *Person {\n    var data []byte\n    p.Data = append(data, p.Data...)\n    return &amp;p\n}\n</code></pre>\n\n<p>Of course, if someone adds a field which also needs manual handling, this won't help you out.</p>\n\n<p>You could also use unkeyed literal, like this:</p>\n\n<pre><code>func copyPerson(p Person) *Person {\n    return &amp;Person{\n        p.Name,\n        p.Age,\n    }\n}\n</code></pre>\n\n<p>This will result in a compile-time error if someone adds a new field to <code>Person</code>, because an unkeyed composite struct literal must list all fields. Again, this will not help you out if someone changes the fields where the new fields are assignable to the old ones (e.g. someone swaps 2 fields next to each other having the same type), also unkeyed literals are discouraged.</p>\n\n<p>Best would be for the package owner to provide a copy constructor, next to the <code>Person</code> type definition. So if someone changes <code>Person</code>, he / she should be responsible keeping <code>CopyPerson()</code> still operational. And as others mentioned, you should already have unit tests which should fail if <code>CopyPerson()</code> does not live up to its name.</p>\n\n<h2>The best viable option?</h2>\n\n<p>If you can't place the <code>CopyPerson()</code> next to the <code>Person</code> type and have its author maintain it, go ahead with the struct value copying and manual handling of pointer and header-like fields.</p>\n\n<p>And you can create a <code>person2</code> type which is a \"snapshot\" of the <code>Person</code> type. Use a blank global variable to receive compile-time alert if the original <code>Person</code> type changes, in which case <code>copyPerson()</code>'s containing source file will refuse to compile, so you'll know it needs adjusting.</p>\n\n<p>This is how it can be done:</p>\n\n<pre><code>type person2 struct {\n    Name string\n    Age  int\n}\n\nvar _ = Person(person2{})\n</code></pre>\n\n<p>The blank variable declaration will not compile if fields of <code>Person</code> and <code>person2</code> do not match.</p>\n\n<p>A variation of the above compile-time check could be to use typed-<code>nil</code> pointers:</p>\n\n<pre><code>var _ = (*Person)((*person2)(nil))\n</code></pre>\n"}], "owner": {"reputation": 1771, "user_id": 2736037, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/FJzsN.jpg?s=128&g=1", "display_name": "elijahcarrel", "link": "https://stackoverflow.com/users/2736037/elijahcarrel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3668, "favorite_count": 3, "answer_count": 7, "score": 6, "last_activity_date": 1575313469, "creation_date": 1549390519, "last_edit_date": 1575313469, "question_id": 54540633, "link": "https://stackoverflow.com/questions/54540633/prevent-missing-fields-in-struct-initialization", "title": "Prevent missing fields in struct initialization", "body": "<p>Consider this example. Let's say I have this object which is ubiquitous throughout my codebase:</p>\n\n<pre><code>type Person struct {\n    Name string\n    Age  int\n    [some other fields]\n}\n</code></pre>\n\n<p>Somewhere deep in the codebase, I also have some code that creates a new <code>Person</code> struct. Maybe it's something like the following utility function (note that this is just an example of some function that creates a <code>Person</code>-- the point of my question is not to ask about the copy function specifically):</p>\n\n<pre><code>func copyPerson(origPerson Person) *Person {\n    copy := Person{\n        Name: origPerson.Name,\n        Age:  origPerson.Age,\n        [some other fields]\n    }\n    return &amp;copy\n}\n</code></pre>\n\n<p>Another developer comes along and adds a new field <code>Gender</code> to the <code>Person</code> struct. However, because the <code>copyPerson</code> function is in a distant piece of code they forget to update <code>copyPerson</code>. Since golang doesn't throw any warning or error if you omit a parameter when creating a struct, the code will compile and appear to work fine; the only difference is that the <code>copyPerson</code> method will now fail to copy over the <code>Gender</code> struct, and the result of <code>copyPerson</code> will have <code>Gender</code> replaced with a nil value (e.g. the empty string). </p>\n\n<p>What is the best way to prevent this from happening? Is there a way to ask golang to enforce no missing parameters in a specific struct initialization? Is there a linter that can detect this type of potential error?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1549384389, "post_id": 54538936, "comment_id": 95879196, "body": "Most likely you have an endless &quot;recursion&quot; so your code runs out of stack."}, {"owner": {"reputation": 13686, "user_id": 1663919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0abe37f1cd26ea99091568cf4edf448?s=128&d=identicon&r=PG", "display_name": "Zdeslav Vojkovic", "link": "https://stackoverflow.com/users/1663919/zdeslav-vojkovic"}, "edited": false, "score": 3, "creation_date": 1549384398, "post_id": 54538936, "comment_id": 95879203, "body": "Most likely you have a cycle (a node pointing to itself as a child, either directly or indirectly) in your Trie."}, {"owner": {"reputation": 323, "user_id": 4054684, "user_type": "registered", "accept_rate": 38, "profile_image": "https://lh6.googleusercontent.com/-wjxce8yMONk/AAAAAAAAAAI/AAAAAAAAAgE/xD7t1kCNF4g/photo.jpg?sz=128", "display_name": "sreang rathanak", "link": "https://stackoverflow.com/users/4054684/sreang-rathanak"}, "edited": false, "score": 0, "creation_date": 1549384713, "post_id": 54538936, "comment_id": 95879371, "body": "Any suggested solution?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1549385097, "post_id": 54538936, "comment_id": 95879586, "body": "Post a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. Most likely the &quot;bug&quot; is in <code>Trie.MarshalJSON()</code> or <code>Node.MarshalJSON()</code>."}, {"owner": {"reputation": 13686, "user_id": 1663919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e0abe37f1cd26ea99091568cf4edf448?s=128&d=identicon&r=PG", "display_name": "Zdeslav Vojkovic", "link": "https://stackoverflow.com/users/1663919/zdeslav-vojkovic"}, "edited": false, "score": 1, "creation_date": 1549385099, "post_id": 54538936, "comment_id": 95879589, "body": "yes, analyze your code, find where the cycle is created and break it. Do you have a custom JSON marshaller for Trie?"}, {"owner": {"reputation": 1369, "user_id": 1632556, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/ErjRS.jpg?s=128&g=1", "display_name": "Soumya Kanti", "link": "https://stackoverflow.com/users/1632556/soumya-kanti"}, "edited": false, "score": 1, "creation_date": 1577695262, "post_id": 54538936, "comment_id": 105225931, "body": "This is a genuine question. Why on earth someone thinks it is &#39;off-topic&#39;?"}], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 3, "last_activity_date": 1549387705, "last_edit_date": 1549387705, "creation_date": 1549387363, "answer_id": 54539873, "question_id": 54538936, "link": "https://stackoverflow.com/questions/54538936/runtime-goroutine-stack-exceeds-1000000000-byte-limit-when-save-struct-to-json/54539873#54539873", "title": "runtime: goroutine stack exceeds 1000000000-byte limit, when save struct to json", "body": "<p>The problem is that each <code>Node</code> has a reference to it's parent, as well as to it's children.  So when it encodes a child, for the parent field, it encodes the parent again, and for that parent, it encodes the child again, etc.  A simple solution would be to simply not use the <code>Parent</code> field when encoding</p>\n\n<pre><code>Parent   *Node `json:\"-\"`\n</code></pre>\n\n<p>This will prevent the cycle.</p>\n\n<p><a href=\"https://play.golang.org/p/BdVgMNjlZOa\" rel=\"nofollow noreferrer\">https://play.golang.org/p/BdVgMNjlZOa</a></p>\n"}], "owner": {"reputation": 323, "user_id": 4054684, "user_type": "registered", "accept_rate": 38, "profile_image": "https://lh6.googleusercontent.com/-wjxce8yMONk/AAAAAAAAAAI/AAAAAAAAAgE/xD7t1kCNF4g/photo.jpg?sz=128", "display_name": "sreang rathanak", "link": "https://stackoverflow.com/users/4054684/sreang-rathanak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 729, "favorite_count": 1, "closed_date": 1549404988, "accepted_answer_id": 54539873, "answer_count": 1, "score": -2, "last_activity_date": 1563958203, "creation_date": 1549384277, "last_edit_date": 1563958203, "question_id": 54538936, "link": "https://stackoverflow.com/questions/54538936/runtime-goroutine-stack-exceeds-1000000000-byte-limit-when-save-struct-to-json", "closed_reason": "Not suitable for this site", "title": "runtime: goroutine stack exceeds 1000000000-byte limit, when save struct to json", "body": "<p>I've defined a go struct of Trie data structure.</p>\n\n<pre><code>type Node struct {\nVal      rune\nIsWord   bool\nIsRoot   bool\nParent   *Node\nChildren map[rune]*Node\n}\ntype Trie struct {\nRoot *Node\n}\ntrie := algorithms.InitTrie()\n</code></pre>\n\n<p>However, it raises an error</p>\n\n<pre><code>runtime: goroutine stack exceeds 1000000000-byte limit\nfatal error: stack overflow\nruntime stack:\nruntime.throw(0x10e9426, 0xe)\n/usr/local/go/src/runtime/panic.go:605 +0x95\nruntime.newstack(0x0)\n/usr/local/go/src/runtime/stack.go:1050 +0x6e1\nruntime.morestack()\n/usr/local/go/src/runtime/asm_amd64.s:415 +0x86\n</code></pre>\n\n<p>When I insert some words and save it into json file.</p>\n\n<pre><code>fmt.Println(json.Marshal(&amp;trie))\n</code></pre>\n"}, {"tags": ["regex", "go"], "answers": [{"comments": [{"owner": {"reputation": 73, "user_id": 10801095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55328b51701f5afad5fae4a5701d5ed8?s=128&d=identicon&r=PG&f=1", "display_name": "kjvf", "link": "https://stackoverflow.com/users/10801095/kjvf"}, "edited": false, "score": 0, "creation_date": 1549446532, "post_id": 54538956, "comment_id": 95901291, "body": "But I&#39;ve got other strings such as area=Hello, and its picking them up. I just want to pick up any String that begins with an id which contains a blackslash on it"}, {"owner": {"reputation": 17840, "user_id": 2102956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b347220471064a3cb72d768ec2314e6?s=128&d=identicon&r=PG", "display_name": "Pushpesh Kumar Rajwanshi", "link": "https://stackoverflow.com/users/2102956/pushpesh-kumar-rajwanshi"}, "reply_to_user": {"reputation": 73, "user_id": 10801095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55328b51701f5afad5fae4a5701d5ed8?s=128&d=identicon&r=PG&f=1", "display_name": "kjvf", "link": "https://stackoverflow.com/users/10801095/kjvf"}, "edited": false, "score": 0, "creation_date": 1549451599, "post_id": 54538956, "comment_id": 95904366, "body": "@kjvf: Well, if you carefully read your post, you have written this &quot;that would extract anything after the = to the ,&quot; and I have exactly followed what you wrote and gave you the solution. Now as you wrote in your comment that you only need text followed by <code>id=</code>, my regex just needs little change and instead of just <code>=</code> it needs to be <code>id=</code> and that will work perfectly for you. Let me update my answer."}, {"owner": {"reputation": 17840, "user_id": 2102956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b347220471064a3cb72d768ec2314e6?s=128&d=identicon&r=PG", "display_name": "Pushpesh Kumar Rajwanshi", "link": "https://stackoverflow.com/users/2102956/pushpesh-kumar-rajwanshi"}, "reply_to_user": {"reputation": 73, "user_id": 10801095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55328b51701f5afad5fae4a5701d5ed8?s=128&d=identicon&r=PG&f=1", "display_name": "kjvf", "link": "https://stackoverflow.com/users/10801095/kjvf"}, "edited": false, "score": 0, "creation_date": 1549451845, "post_id": 54538956, "comment_id": 95904502, "body": "@kjvf: Updated my post to ensure your intended text is preceded by <code>id=</code> instead of just <code>=</code>. Check and let me know if you face any issues."}], "tags": [], "owner": {"reputation": 17840, "user_id": 2102956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b347220471064a3cb72d768ec2314e6?s=128&d=identicon&r=PG", "display_name": "Pushpesh Kumar Rajwanshi", "link": "https://stackoverflow.com/users/2102956/pushpesh-kumar-rajwanshi"}, "is_accepted": false, "score": 1, "last_activity_date": 1549451801, "last_edit_date": 1549451801, "creation_date": 1549384317, "answer_id": 54538956, "question_id": 54538871, "link": "https://stackoverflow.com/questions/54538871/regex-to-find-string-and-backslashes/54538956#54538956", "title": "Regex to find string and backslashes", "body": "<p>You can use this regex and capture your text from group1,</p>\n\n<pre><code>id=([^,=]*),\n</code></pre>\n\n<p><strong>Explanation:</strong></p>\n\n<ul>\n<li><code>id=</code> - Matches <code>id=</code> literally</li>\n<li><code>([^,=]*)</code> - Matches any character except <code>,</code> or <code>=</code> zero or more times and captures in first grouping pattern</li>\n<li><code>,</code> - Matches a comma</li>\n</ul>\n\n<p><strong><a href=\"https://regex101.com/r/ypsR4t/2\" rel=\"nofollow noreferrer\">Demo</a></strong></p>\n\n<p>Sample Go codes,</p>\n\n<pre><code>var re = regexp.MustCompile(`id=([^,=]*),`)\nvar str = `id=PS\\\\ Old\\\\ Gen, value=34 id=Code\\\\ Cache,value=22`\n\nres := re.FindAllStringSubmatch(str, -1)\nfor i := range res {\n    fmt.Printf(\"Match: %s\\n\", res[i][1])\n}\n</code></pre>\n\n<p>Prints,</p>\n\n<pre><code>Match: PS\\\\ Old\\\\ Gen\nMatch: Code\\\\ Cache\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1373, "user_id": 409524, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/kDiKX.jpg?s=128&g=1", "display_name": "matteo rulli", "link": "https://stackoverflow.com/users/409524/matteo-rulli"}, "is_accepted": false, "score": 0, "last_activity_date": 1549384325, "creation_date": 1549384325, "answer_id": 54538963, "question_id": 54538871, "link": "https://stackoverflow.com/questions/54538871/regex-to-find-string-and-backslashes/54538963#54538963", "title": "Regex to find string and backslashes", "body": "<p>Does something like <code>id=([^,]+),</code> do the trick?</p>\n\n<p>Capture group no.1 will contain your match. See this in action <a href=\"https://regex101.com/r/2oW9Mx/1\" rel=\"nofollow noreferrer\">here</a></p>\n"}, {"tags": [], "owner": {"reputation": 28753, "user_id": 1138192, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/4ed67a4983ab0568593e133930430941?s=128&d=identicon&r=PG", "display_name": "Always Sunny", "link": "https://stackoverflow.com/users/1138192/always-sunny"}, "is_accepted": false, "score": 0, "last_activity_date": 1549385849, "creation_date": 1549385849, "answer_id": 54539438, "question_id": 54538871, "link": "https://stackoverflow.com/questions/54538871/regex-to-find-string-and-backslashes/54539438#54539438", "title": "Regex to find string and backslashes", "body": "<p>How about that? <strong>SEE</strong> <a href=\"https://regex101.com/r/fsp3FS/2\" rel=\"nofollow noreferrer\">REGEX</a></p>\n\n<pre><code>package main\n\nimport (\n    \"regexp\"\n    \"fmt\"\n)\n\nfunc main() {\n    var re = regexp.MustCompile(`(?mi)id=([^,]+)`)\n    var str = `id=PS\\\\ Old\\\\ Gen, value=34 and id=Code\\\\ Cache,value=22`\n\n    for i, match := range re.FindAllString(str, -1) {\n        fmt.Println(match, \"found at index\", i)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 73, "user_id": 10801095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55328b51701f5afad5fae4a5701d5ed8?s=128&d=identicon&r=PG&f=1", "display_name": "kjvf", "link": "https://stackoverflow.com/users/10801095/kjvf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "answer_count": 3, "score": -1, "last_activity_date": 1549451801, "creation_date": 1549384084, "question_id": 54538871, "link": "https://stackoverflow.com/questions/54538871/regex-to-find-string-and-backslashes", "title": "Regex to find string and backslashes", "body": "<p>I have these strings and they can come in a variety of ways such as:</p>\n\n<p><code>id=PS\\\\ Old\\\\ Gen, value=34</code> and <code>id=Code\\\\ Cache,value=22</code> etc.</p>\n\n<p>I would like a regex that would extract anything after the <code>=</code> to the <code>,</code> so basically: <code>PS\\\\ Old\\\\ Gen</code> and <code>Code\\\\ Cache</code> etc.</p>\n\n<p>I have written the following regex but can't seem to get the last word before the <code>,</code>. </p>\n\n<p><code>(([a-zA-z]+)\\\\{2})+</code></p>\n\n<p>Any thoughts? This is for go language.</p>\n"}, {"tags": ["go", "jwe"], "comments": [{"owner": {"reputation": 961, "user_id": 1775688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I2f0b.png?s=128&g=1", "display_name": "Jota Santos", "link": "https://stackoverflow.com/users/1775688/jota-santos"}, "edited": false, "score": 1, "creation_date": 1549374589, "post_id": 54535781, "comment_id": 95873257, "body": "Hum... you will need to use the <code>jwt</code> subpackage. There is an example in the godoc: <a href=\"https://godoc.org/gopkg.in/square/go-jose.v2/jwt#example-Encrypted\" rel=\"nofollow noreferrer\">godoc.org/gopkg.in/square/go-jose.v2/jwt#example-Encrypted</a>  The <code>jwt.Claims</code> has <code>Expiry</code>, and it is that you are looking for. I hope it helps."}, {"owner": {"reputation": 47877, "user_id": 414062, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/xc7mu.jpg?s=128&g=1", "display_name": "Dominic", "link": "https://stackoverflow.com/users/414062/dominic"}, "edited": false, "score": 2, "creation_date": 1549375194, "post_id": 54535781, "comment_id": 95873595, "body": "I think you mean JWT tbh? JWE is just the encryption for the object in a JWT isn&#39;t it? Looks like that guy couldn&#39;t be bothered to make some decent documentation"}, {"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "reply_to_user": {"reputation": 47877, "user_id": 414062, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/xc7mu.jpg?s=128&g=1", "display_name": "Dominic", "link": "https://stackoverflow.com/users/414062/dominic"}, "edited": false, "score": 0, "creation_date": 1549385317, "post_id": 54535781, "comment_id": 95879719, "body": "@Dominic I think I read somewhere that JWE and JWS are two types of JWT. Is it correct ?"}, {"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "reply_to_user": {"reputation": 961, "user_id": 1775688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I2f0b.png?s=128&g=1", "display_name": "Jota Santos", "link": "https://stackoverflow.com/users/1775688/jota-santos"}, "edited": false, "score": 0, "creation_date": 1549385481, "post_id": 54535781, "comment_id": 95879833, "body": "@JamilloSantos Thanks a lot mate, you saved the day."}, {"owner": {"reputation": 47877, "user_id": 414062, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/xc7mu.jpg?s=128&g=1", "display_name": "Dominic", "link": "https://stackoverflow.com/users/414062/dominic"}, "edited": false, "score": 0, "creation_date": 1549385698, "post_id": 54535781, "comment_id": 95879975, "body": "Ah yes I think you are correct - <a href=\"https://medium.facilelogin.com/jwt-jws-and-jwe-for-not-so-dummies-b63310d201a3\" rel=\"nofollow noreferrer\">medium.facilelogin.com/&hellip;</a>. Generally people just refer to JWT though. Shame the developer made something so low level with only generated docs, hope Go doesn&#39;t &quot;go&quot; the same way as Java. In Node this is so trivial!"}, {"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 0, "creation_date": 1549388183, "post_id": 54535781, "comment_id": 95881378, "body": "Yup. It needs more docs for sure. I was also surprised to see that this lib is quite popular without proper docs."}], "owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 651, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1549375411, "creation_date": 1549374140, "last_edit_date": 1549375411, "question_id": 54535781, "link": "https://stackoverflow.com/questions/54535781/how-to-add-expiry-to-jwe-token", "title": "How to add expiry to JWE token?", "body": "<p>I'm using <a href=\"https://github.com/square/go-jose/tree/v2\" rel=\"nofollow noreferrer\">Jose</a> library to create JWE's. I have successfully managed to create and parse JWE. JWT has fields like <strong>exp</strong>, <strong>iat</strong> which help in invalidating token after a certain period of time.<br><br>How can I set expiry on JWE ?</p>\n\n<p>Here's what I've tried, without exp:</p>\n\n<pre><code>package main\n\nimport (\n    jose \"gopkg.in/square/go-jose.v2\"\n)\n\n// len(key) is 32\nfunc CreateJWE(value, key string)(string, error){\n    encrypter, err := jose.NewEncrypter(jose.A256GCM, jose.Recipient{Algorithm: jose.A256GCMKW, Key: []byte(key)}, nil)\n    if err != nil {\n        return \"\", err\n    }\n    object, err := encrypter.Encrypt([]byte(value)])\n    if err != nil {\n        return \"\", err\n    }\n    return object.FullSerialize(), nil\n}\n\nfunc ParseJWE(jwe, key string)(string, error){\n    object, err := jose.ParseEncrypted(jwe)\n    if err != nil {\n        return \"\", err\n    }\n    b, err := (*object).Decrypt(key)\n    return string(b), err\n}\n</code></pre>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1549370434, "post_id": 54534588, "comment_id": 95870738, "body": "Channels is the right answer."}], "answers": [{"comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1549370745, "post_id": 54534707, "comment_id": 95870903, "body": "It should be noted that if you are using a <code>slice</code>, uncareful <code>append</code> to the <code>slice</code> would cause data race. Thus I would recommend an <code>array</code> in this case."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1549370819, "post_id": 54534707, "comment_id": 95870946, "body": "@leafbebop Yes, if using a slice, it must be pre-allocated, and only element at a given index may be written in the goroutine."}, {"owner": {"reputation": 9607, "user_id": 3924219, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ae3162deaeb55113f7f3e61c35bb0571?s=128&d=identicon&r=PG&f=1", "display_name": "kentor", "link": "https://stackoverflow.com/users/3924219/kentor"}, "edited": false, "score": 0, "creation_date": 1549371727, "post_id": 54534707, "comment_id": 95871541, "body": "Do you mind editing my given code sample so that it works with your suggested channel approach? I am a bit confused how I&#39;d do so because of the waitgroup.  I believe having a code solution would be the easiest to understand as I am not sure if I should use a waitgroup at all in your proposed solution"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 9607, "user_id": 3924219, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ae3162deaeb55113f7f3e61c35bb0571?s=128&d=identicon&r=PG&f=1", "display_name": "kentor", "link": "https://stackoverflow.com/users/3924219/kentor"}, "edited": false, "score": 0, "creation_date": 1549371844, "post_id": 54534707, "comment_id": 95871622, "body": "@kentor Waitgroup can be used to wait a set of goroutines to finish their work. If you use a channel and you know how many values you expect on it, you don&#39;t even need a WaitGroup, you can just read <code>n</code> values from the channel and then you know you&#39;re done."}, {"owner": {"reputation": 9607, "user_id": 3924219, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ae3162deaeb55113f7f3e61c35bb0571?s=128&d=identicon&r=PG&f=1", "display_name": "kentor", "link": "https://stackoverflow.com/users/3924219/kentor"}, "edited": false, "score": 0, "creation_date": 1549371924, "post_id": 54534707, "comment_id": 95871685, "body": "I believe I don&#39;t know how many values I can expect to be returned through the channel because each goroutine may just fail and therefore doesn&#39;t return any value"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 9607, "user_id": 3924219, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ae3162deaeb55113f7f3e61c35bb0571?s=128&d=identicon&r=PG&f=1", "display_name": "kentor", "link": "https://stackoverflow.com/users/3924219/kentor"}, "edited": false, "score": 1, "creation_date": 1549372001, "post_id": 54534707, "comment_id": 95871733, "body": "@kentor Goroutines that &quot;fail&quot; should also return a value, so yes, you expect exactly as many values as goroutines you launch. The values sent on the channel should be struct values, wrapping the 2 return values of your current function. So even if an error should be returned, that would still be a value to be sent on the channel."}, {"owner": {"reputation": 9607, "user_id": 3924219, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ae3162deaeb55113f7f3e61c35bb0571?s=128&d=identicon&r=PG&f=1", "display_name": "kentor", "link": "https://stackoverflow.com/users/3924219/kentor"}, "edited": false, "score": 0, "creation_date": 1549381257, "post_id": 54534707, "comment_id": 95877385, "body": "I believe the current approach assumes that my getInt32() method always puts just one int32 (instead of an unknown number of int32) into the channel. What would it look like if the function is supposed to send n int32 into the channel? Thanks for all the help!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 9607, "user_id": 3924219, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ae3162deaeb55113f7f3e61c35bb0571?s=128&d=identicon&r=PG&f=1", "display_name": "kentor", "link": "https://stackoverflow.com/users/3924219/kentor"}, "edited": false, "score": 0, "creation_date": 1549444769, "post_id": 54534707, "comment_id": 95900294, "body": "@kentor You could change the <code>result</code> type to have a <code>data</code> field that is not a single <code>int32</code> but a slice, e.g. <code>[]int32</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1549372500, "last_edit_date": 1549372500, "creation_date": 1549370554, "answer_id": 54534707, "question_id": 54534588, "link": "https://stackoverflow.com/questions/54534588/get-responses-from-multiple-go-routines-into-an-array/54534707#54534707", "title": "Get responses from multiple go routines into an array", "body": "<p>If you don't process the return values of the function launched as a goroutine, they are discarded. See <a href=\"https://stackoverflow.com/questions/27868369/what-happens-to-return-value-from-goroutine/27870734#27870734\">What happens to return value from goroutine</a>.</p>\n\n<p>You may use a slice to collect the results, where each goroutine could receive the index to put the results to, or alternatively the address of the element. See <a href=\"https://stackoverflow.com/questions/49879322/can-i-concurrently-write-different-slice-elements/49879469#49879469\">Can I concurrently write different slice elements</a>. Note that if you use this, the slice must be pre-allocated and only the element belonging to the goroutine may be written, you can't \"touch\" other elements and you can't append to the slice.</p>\n\n<p>Or you may use a channel, on which the goroutines send values that include the index or ID of the item they processed, so the collecting goroutine can identify or order them. See <a href=\"https://stackoverflow.com/questions/37856337/how-to-collect-values-from-n-goroutines-executed-in-a-specific-order/37857863#37857863\">How to collect values from N goroutines executed in a specific order?</a></p>\n\n<p>If processing should stop on the first error encountered, see <a href=\"https://stackoverflow.com/questions/45500836/close-multiple-goroutine-if-an-error-occurs-in-one-in-go/45502591#45502591\">Close multiple goroutine if an error occurs in one in go</a></p>\n\n<p>Here's an example how it could look like when using a channel. Note that no waitgroup is needed here, because we know that we expect as many values on the channel as many goroutines we launch.</p>\n\n<pre><code>type result struct {\n    task int32\n    data int32\n    err  error\n}\n\nfunc main() {\n    tasks := []int32{1, 2, 3, 4}\n\n    ch := make(chan result)\n\n    for _, task := range tasks {\n        go calcTask(task, ch)\n    }\n\n    // Collect results:\n    results := make([]result, len(tasks))\n\n    for i := range results {\n        results[i] = &lt;-ch\n    }\n\n    fmt.Printf(\"Results: %+v\\n\", results)\n}\n\nfunc calcTask(task int32, ch chan&lt;- result) {\n    if task &gt; 2 {\n        // Simulate failure\n        ch &lt;- result{task: task, err: fmt.Errorf(\"task %v failed\", task)}\n        return\n    }\n\n    // Simulate success\n    ch &lt;- result{task: task, data: task * 2, err: nil}\n}\n</code></pre>\n\n<p>Output (try ot on the <a href=\"https://play.golang.org/p/CL0-jF_Vu2V\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Results: [{task:4 data:0 err:0x40e130} {task:1 data:2 err:&lt;nil&gt;} {task:2 data:4 err:&lt;nil&gt;} {task:3 data:0 err:0x40e138}]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 9607, "user_id": 3924219, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ae3162deaeb55113f7f3e61c35bb0571?s=128&d=identicon&r=PG&f=1", "display_name": "kentor", "link": "https://stackoverflow.com/users/3924219/kentor"}, "edited": false, "score": 0, "creation_date": 1549382711, "post_id": 54535532, "comment_id": 95878272, "body": "I didn&#39;t think about creating a go routine for consuming the results. Thanks for that! I assume there&#39;s no mutex required because just one go routine writes into the array?"}, {"owner": {"reputation": 2384, "user_id": 102315, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c8b935f2e5d916f361ffe33fe94a3d10?s=128&d=identicon&r=PG", "display_name": "Alper", "link": "https://stackoverflow.com/users/102315/alper"}, "edited": false, "score": 0, "creation_date": 1568365223, "post_id": 54535532, "comment_id": 102258657, "body": "Aren&#39;t there any more higher level ways to do this?"}], "tags": [], "owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "is_accepted": true, "score": 4, "last_activity_date": 1549373267, "creation_date": 1549373267, "answer_id": 54535532, "question_id": 54534588, "link": "https://stackoverflow.com/questions/54534588/get-responses-from-multiple-go-routines-into-an-array/54535532#54535532", "title": "Get responses from multiple go routines into an array", "body": "<p>I also believe you have to use channel, it must be something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"sync\"\n)\n\nvar (\n    BrokersByBrokerID = []int32{1, 2, 3}\n)\n\ntype result struct {\n    data string\n    err string // you must use error type here\n}\n\nfunc main()  {\n    var wg sync.WaitGroup\n    var results []result\n    ch := make(chan result)\n\n    for _, broker := range BrokersByBrokerID {\n        wg.Add(1)\n        go getInt32(ch, &amp;wg, broker)\n    }\n\n    go func() {\n        for v := range ch {\n            results = append(results, v)\n        }\n    }()\n\n    wg.Wait()\n    close(ch)\n\n    log.Printf(\"collected %v\", results)\n}\n\nfunc getInt32(ch chan result, wg *sync.WaitGroup, broker int32) {\n    defer wg.Done()\n\n    if broker == 1 {\n        ch &lt;- result{err: fmt.Sprintf(\"error: gor broker 1\")}\n        return\n    }\n\n    ch &lt;- result{data: fmt.Sprintf(\"broker %d - ok\", broker)}\n}\n</code></pre>\n\n<p>Result will look like this:</p>\n\n<pre><code>2019/02/05 15:26:28 collected [{broker 3 - ok } {broker 2 - ok } { error: gor broker 1}]\n</code></pre>\n"}], "owner": {"reputation": 9607, "user_id": 3924219, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ae3162deaeb55113f7f3e61c35bb0571?s=128&d=identicon&r=PG&f=1", "display_name": "kentor", "link": "https://stackoverflow.com/users/3924219/kentor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1749, "favorite_count": 1, "accepted_answer_id": 54535532, "answer_count": 2, "score": 2, "last_activity_date": 1549469078, "creation_date": 1549370141, "last_edit_date": 1549469078, "question_id": 54534588, "link": "https://stackoverflow.com/questions/54534588/get-responses-from-multiple-go-routines-into-an-array", "title": "Get responses from multiple go routines into an array", "body": "<p>I need to fetch responses from multiple go routines and put them into an array. I know that channels could be used for this, however I am not sure how I can make sure that all go routines have finished processing the results. Thus I am using a waitgroup.</p>\n\n<p><strong>Code</strong></p>\n\n<pre><code>func main() {\n  log.Info(\"Collecting ints\")\n  var results []int32\n  for _, broker := range e.BrokersByBrokerID {\n      wg.Add(1)\n      go getInt32(&amp;wg)\n  }\n  wg.Wait()\n  log.info(\"Collected\")\n}\n\nfunc getInt32(wg *sync.WaitGroup) (int32, error) {\n  defer wg.Done()\n\n  // Just to show that this method may just return an error and no int32\n  err := broker.Open(config)\n  if err != nil &amp;&amp; err != sarama.ErrAlreadyConnected {\n    return 0, fmt.Errorf(\"Cannot connect to broker '%v': %s\", broker.ID(), err)\n  }\n  defer broker.Close()\n\n  return 1003, nil\n}\n</code></pre>\n\n<p><strong>My question</strong></p>\n\n<p>How can I put all the response int32 (which may return an error) into my int32 array, making sure that all go routines have finished their processing work and returned either the error or the int?</p>\n"}, {"tags": ["regex", "go", "telegraf", "telegraf-inputs-plugin"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 2, "creation_date": 1549364538, "post_id": 54532898, "comment_id": 95867308, "body": "Any reason that it must be a regexp? Why not just <code>strings.Count</code>?"}, {"owner": {"reputation": 47877, "user_id": 414062, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/xc7mu.jpg?s=128&g=1", "display_name": "Dominic", "link": "https://stackoverflow.com/users/414062/dominic"}, "edited": false, "score": 0, "creation_date": 1549364552, "post_id": 54532898, "comment_id": 95867316, "body": "What are you planning to do? Just detect or also change the string?"}, {"owner": {"reputation": 73, "user_id": 10801095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55328b51701f5afad5fae4a5701d5ed8?s=128&d=identicon&r=PG&f=1", "display_name": "kjvf", "link": "https://stackoverflow.com/users/10801095/kjvf"}, "reply_to_user": {"reputation": 47877, "user_id": 414062, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/xc7mu.jpg?s=128&g=1", "display_name": "Dominic", "link": "https://stackoverflow.com/users/414062/dominic"}, "edited": false, "score": 0, "creation_date": 1549364933, "post_id": 54532898, "comment_id": 95867529, "body": "I need to use the regex in a config file. Just detecting. @Dominic"}, {"owner": {"reputation": 47877, "user_id": 414062, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/xc7mu.jpg?s=128&g=1", "display_name": "Dominic", "link": "https://stackoverflow.com/users/414062/dominic"}, "edited": false, "score": 0, "creation_date": 1549366566, "post_id": 54532898, "comment_id": 95868450, "body": "So you don&#39;t need to know how many there are or where they are? Your config file could also just contain a string it doesn&#39;t have to be regex does it? Seems better suited to a simple strings function."}], "answers": [{"tags": [], "owner": {"reputation": 191, "user_id": 9870721, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Eitam Ring", "link": "https://stackoverflow.com/users/9870721/eitam-ring"}, "is_accepted": false, "score": 2, "last_activity_date": 1549366903, "last_edit_date": 1549366903, "creation_date": 1549366572, "answer_id": 54533529, "question_id": 54532898, "link": "https://stackoverflow.com/questions/54532898/find-if-a-backslash-exists-in-a-string-go/54533529#54533529", "title": "find if a backslash exists in a string Go", "body": "<p>You can use <strong>strings.Count(myString, <code>\\</code>)</strong></p>\n\n<p>with literal example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    myString := `id=PS\\\\Old\\\\Gen`\n    a := `\\`\n    i := strings.Count(myString, a)\n    fmt.Println(i)\n}\n</code></pre>\n\n<p>result = 4</p>\n\n<p>without literal</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    myString := \"id=PS\\\\Old\\\\Gen\"\n    a := `\\`\n    i := strings.Count(myString, a)\n    fmt.Println(i)\n}\n</code></pre>\n\n<p>Result=2</p>\n\n<p>if you just need contain use </p>\n\n<pre><code>myString := \"id=PS\\\\ Old\\\\ Gen\"\na:=`\\`\ni := strings.Contains(myString, a)\nfmt.Println(i)\n</code></pre>\n\n<p>Result=true</p>\n"}, {"comments": [{"owner": {"reputation": 73, "user_id": 10801095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55328b51701f5afad5fae4a5701d5ed8?s=128&d=identicon&r=PG&f=1", "display_name": "kjvf", "link": "https://stackoverflow.com/users/10801095/kjvf"}, "edited": false, "score": 0, "creation_date": 1549367043, "post_id": 54533571, "comment_id": 95868705, "body": "I have tried that but it complains. It&#39;s printing out this: <code>regexp: Compile(</code>`): error parsing regexp: trailing backslash at end of expression: `` `  See this for context: <a href=\"https://community.influxdata.com/t/telegraf-measurement-values-and-strings/6891\" rel=\"nofollow noreferrer\">community.influxdata.com/t/&hellip;</a>"}, {"owner": {"reputation": 47877, "user_id": 414062, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/xc7mu.jpg?s=128&g=1", "display_name": "Dominic", "link": "https://stackoverflow.com/users/414062/dominic"}, "reply_to_user": {"reputation": 73, "user_id": 10801095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55328b51701f5afad5fae4a5701d5ed8?s=128&d=identicon&r=PG&f=1", "display_name": "kjvf", "link": "https://stackoverflow.com/users/10801095/kjvf"}, "edited": false, "score": 0, "creation_date": 1549367634, "post_id": 54533571, "comment_id": 95869041, "body": "@kjvf are you using <code>&quot;</code> or ` (backtick)?"}, {"owner": {"reputation": 73, "user_id": 10801095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55328b51701f5afad5fae4a5701d5ed8?s=128&d=identicon&r=PG&f=1", "display_name": "kjvf", "link": "https://stackoverflow.com/users/10801095/kjvf"}, "edited": false, "score": 0, "creation_date": 1549368587, "post_id": 54533571, "comment_id": 95869605, "body": "I am using <code>&quot;</code>. I think it looks like a bcktick because of my formatting"}], "tags": [], "owner": {"reputation": 47877, "user_id": 414062, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/xc7mu.jpg?s=128&g=1", "display_name": "Dominic", "link": "https://stackoverflow.com/users/414062/dominic"}, "is_accepted": false, "score": 1, "last_activity_date": 1549366719, "creation_date": 1549366719, "answer_id": 54533571, "question_id": 54532898, "link": "https://stackoverflow.com/questions/54532898/find-if-a-backslash-exists-in-a-string-go/54533571#54533571", "title": "find if a backslash exists in a string Go", "body": "<p>It sounds like you don't need to know the position or occurence of <code>\\\\</code> so in that cause I'd suggest going as simple as possible:</p>\n\n<pre><code>import \"strings\"\n\n...\n\nfmt.Println(strings.Contains(\"id=PS\\\\ Old\\\\ Gen\", \"\\\\\")) // true\n</code></pre>\n\n<p>So you can just store <code>\"\\\\\"</code> in your config.</p>\n"}], "owner": {"reputation": 73, "user_id": 10801095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55328b51701f5afad5fae4a5701d5ed8?s=128&d=identicon&r=PG&f=1", "display_name": "kjvf", "link": "https://stackoverflow.com/users/10801095/kjvf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 351, "favorite_count": 0, "closed_date": 1549371093, "answer_count": 2, "score": -3, "last_activity_date": 1549367171, "creation_date": 1549364371, "question_id": 54532898, "link": "https://stackoverflow.com/questions/54532898/find-if-a-backslash-exists-in-a-string-go", "closed_reason": "Not suitable for this site", "title": "find if a backslash exists in a string Go", "body": "<p>I have a string like this:</p>\n\n<p><code>id=PS\\\\ Old\\\\ Gen</code></p>\n\n<p>and I would to build a regex to find out if it contains a backslash; one after the other. So in this case, the regex should find 2 occurances as there are 2 <code>\\\\</code>.</p>\n\n<p>I tried building up the query but couldn't figure out the right way.</p>\n\n<p>i need the regex that's compatiable with Go.</p>\n"}, {"tags": ["google-app-engine", "go", "dockerfile", "app-engine-flexible"], "comments": [{"owner": {"reputation": 1166, "user_id": 9745709, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iiwwL.png?s=128&g=1", "display_name": "Pablo Alm&#233;cija Rodr&#237;guez", "link": "https://stackoverflow.com/users/9745709/pablo-alm%c3%a9cija-rodr%c3%adguez"}, "edited": false, "score": 0, "creation_date": 1549976153, "post_id": 54532602, "comment_id": 96092404, "body": "I edited my answer with some options. Why do you need Debian?"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 10835580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd077fb3e716b8aa25ee3998e4f754eb?s=128&d=identicon&r=PG&f=1", "display_name": "Partha C", "link": "https://stackoverflow.com/users/10835580/partha-c"}, "edited": false, "score": 0, "creation_date": 1549470080, "post_id": 54533808, "comment_id": 95915876, "body": "Thanks for the tip Pablo. Based on your input did some research, and updated my query realizing I won&#39;t be able to copy the exe directly, instead the debian package needs to be installed in the environment during build."}], "tags": [], "owner": {"reputation": 1166, "user_id": 9745709, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iiwwL.png?s=128&g=1", "display_name": "Pablo Alm&#233;cija Rodr&#237;guez", "link": "https://stackoverflow.com/users/9745709/pablo-alm%c3%a9cija-rodr%c3%adguez"}, "is_accepted": false, "score": 0, "last_activity_date": 1549975564, "last_edit_date": 1549975564, "creation_date": 1549367518, "answer_id": 54533808, "question_id": 54532602, "link": "https://stackoverflow.com/questions/54532602/how-to-copy-an-exe-file-to-app-engine-flex-with-go-runtime/54533808#54533808", "title": "How to copy an exe file to App Engine (flex) with Go runtime?", "body": "<p>You can copy a file using the command <code>COPY</code>.</p>\n\n<p>However, it will not work, since the VM running the GAE flex instance uses Linux as seen in <a href=\"https://stackoverflow.com/questions/51685973/is-there-any-way-to-run-an-image-windows-docker-on-ubuntu\">StackOverflow</a>.</p>\n\n<p>I also found this <a href=\"https://stackoverflow.com/questions/38898224/is-it-possible-to-run-a-windows-executable-in-google-app-engine-flexible-env\">related thread</a>, it may be helpful for you.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>Other options you have to deploy your application, which is in need of a windows executable file, is to create a VM instance with Windows and deploy your application there. Or you could find an alternative for that stand-alone executable for Linux, perhaps?</p>\n"}], "owner": {"reputation": 11, "user_id": 10835580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd077fb3e716b8aa25ee3998e4f754eb?s=128&d=identicon&r=PG&f=1", "display_name": "Partha C", "link": "https://stackoverflow.com/users/10835580/partha-c"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 155, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1549975564, "creation_date": 1549363337, "last_edit_date": 1549470015, "question_id": 54532602, "link": "https://stackoverflow.com/questions/54532602/how-to-copy-an-exe-file-to-app-engine-flex-with-go-runtime", "title": "How to copy an exe file to App Engine (flex) with Go runtime?", "body": "<p>My Go application needs to use a stand-alone executable, which I would like to copy it along with 'gcloud app deploy' command during deployment to GAE flex environment. </p>\n\n<ol>\n<li>I have tried keeping the exe in the folder where other go files are located during deploy, but this doesn't seem to take the exe to the GAE flex</li>\n<li>I tried using these 2 lines in Dockerfile and changed the \"runtime: custom\" in app.yaml, but that didn't fix either, as I am missing few more things it seems.</li>\n</ol>\n\n<blockquote>\n<pre><code>FROM gcr.io/google-appengine/golang \nADD test.exe /usr/local/bin/\n</code></pre>\n</blockquote>\n\n<p>Can anyone suggest, without/with Dockerfile, how can I copy the test.exe and also build the go application on a GAE flex environment?</p>\n\n<p><strong>EDIT:</strong>\n<strong>I realize I should install the package (Debian package) on the GAE machine itself, and make it available for the App Engine app.</strong> </p>\n\n<p>Any pointers on how to prepare the Dockerfile so that the Debian package is installed with all its dependencies and is also accessible to the app that I am deploying to App Engine?</p>\n"}, {"tags": ["json", "go", "struct", "unmarshalling"], "comments": [{"owner": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "edited": false, "score": 0, "creation_date": 1549387195, "post_id": 54532448, "comment_id": 95880840, "body": "Well written. Thank you ;)"}, {"owner": {"reputation": 319, "user_id": 2497090, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/xHuus.jpg?s=128&g=1", "display_name": "DavidR", "link": "https://stackoverflow.com/users/2497090/davidr"}, "reply_to_user": {"reputation": 967, "user_id": 2569807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FHwBd.jpg?s=128&g=1", "display_name": "daplho", "link": "https://stackoverflow.com/users/2569807/daplho"}, "edited": false, "score": 0, "creation_date": 1549444035, "post_id": 54532448, "comment_id": 95899880, "body": "@daplho I made it clearer"}], "answers": [{"comments": [{"owner": {"reputation": 319, "user_id": 2497090, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/xHuus.jpg?s=128&g=1", "display_name": "DavidR", "link": "https://stackoverflow.com/users/2497090/davidr"}, "edited": false, "score": 0, "creation_date": 1549363217, "post_id": 54532516, "comment_id": 95866527, "body": "Awesome. I couldn&#39;t figure out before why people sometimes used pointers in receivers and other times not."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 7, "last_activity_date": 1549387257, "last_edit_date": 1549387257, "creation_date": 1549363060, "answer_id": 54532516, "question_id": 54532448, "link": "https://stackoverflow.com/questions/54532448/struct-is-empty-after-json-unmarshal-when-accessed-by-another-package/54532516#54532516", "title": "Struct is empty after Json unmarshal when accessed by another package", "body": "<p><code>Contact.Load()</code> modifies the struct, so in order to retain the changes, it must have a pointer receiver:</p>\n\n<pre><code>func (contact *Contact) Load() error {\n    // ...\n}\n</code></pre>\n\n<p>All parameters (including the receiver) are passed by value which means a copy is made and the functions / methods can only operate on the copy. If the receiver is not a pointer then all changes the method makes are on the copy which is discarded when the method returns.</p>\n\n<p>If the receiver is a pointer, it will also be copied, but you don't want to modify the pointer but the pointed value, which will be the same.</p>\n\n<p>See related / possible duplicates:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/43890706/my-object-is-not-updated-even-if-i-use-the-pointer-to-a-type-to-update-it/43890923#43890923\">My object is not updated even if I use the pointer to a type to update it</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/47435161/remove-an-element-of-a-slice-in-a-struct/47435232#47435232\">Remove an element of a slice in a struct</a></p>\n"}], "owner": {"reputation": 319, "user_id": 2497090, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/xHuus.jpg?s=128&g=1", "display_name": "DavidR", "link": "https://stackoverflow.com/users/2497090/davidr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 54532516, "answer_count": 1, "score": 1, "last_activity_date": 1549444016, "creation_date": 1549362848, "last_edit_date": 1549444016, "question_id": 54532448, "link": "https://stackoverflow.com/questions/54532448/struct-is-empty-after-json-unmarshal-when-accessed-by-another-package", "title": "Struct is empty after Json unmarshal when accessed by another package", "body": "<p>I'm am using a struct <code>Contact</code> that has a <code>Load()</code> method. The idea is that <code>Load()</code> populates <code>Contact</code>'s fields with data. The data is unmarshalled from json returned by a server. Once loaded, I want to be able to access the data on <code>Contact</code>.</p>\n\n<p>I know that the json is unmarshalling correctly because I can print the data to the console within <code>Load()</code>, immediately after it has been unmarshalled. However, this data is not present on <code>Contact</code> once it has been loaded. So when I create a new <code>Contact</code> and call its <code>Load()</code> method, its data fields are still empty when I go to access them.</p>\n\n<p>This is a simplified version of my code (minus imports for brevity):</p>\n\n<pre><code>package main\n\nfunc main() {\n    client := &amp;http.Client{}\n\n    mp := myPackage.NewContact(\"1234\", client)\n    if err := mp.Load(); err != nil {\n        log.Println(err)\n    }\n\n    // prints empty string\n    log.Println(mp.EmailOptIn)\n\n}\n\n// myPackage\n\npackage myPackage\n\ntype Contact struct {\n    ID          string\n    client      *http.Client\n    EmailOptIn  string      `json:\"marketing_optin\"`\n}\n\nfunc NewContact(ID string, client *http.Client) *Contact {\n    return &amp;Contact{\n        ID:     ID,\n        client: client,\n    }\n}\n\nfunc (contact Contact) Load() error {\n    req, err := http.NewRequest(\"GET\", \"https://anAPI.com/\"+contact.ID, nil)\n    if err != nil {\n        log.Println(err)\n    }\n\n    resp, err := contact.client.Do(req)\n    if err != nil {\n        log.Println(err)\n    }\n    defer resp.Body.Close()\n\n    if resp.StatusCode == 200 {\n        body, _ := ioutil.ReadAll(resp.Body)\n\n        if err = json.Unmarshal(body, &amp;contact); err != nil {\n            log.Println(\"Can't unmarshall: \" + err.Error())\n        }\n\n        // prints \"Opted_in\"\n        log.Println(contact.EmailOptIn)\n\n        return nil\n    }\n\n    return errors.New(\"oh dear\")\n}\n</code></pre>\n"}, {"tags": ["go", "sqlite"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1549384661, "post_id": 54531978, "comment_id": 95879333, "body": "Formatting would make this question much more readable, and some explanation would help as well. Posting nothing but code isn&#39;t really a question."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 2, "last_activity_date": 1549489089, "last_edit_date": 1549489089, "creation_date": 1549361796, "answer_id": 54532097, "question_id": 54531978, "link": "https://stackoverflow.com/questions/54531978/how-do-i-resolve-cannot-refer-to-unexported-field-or-method-models-model-getdevi/54532097#54532097", "title": "how do i resolve cannot refer to unexported field or method models.Model.getDevices in golang", "body": "<p>You simply <strong>cannot</strong> access an unexported symbol. The whole reason of being unexported is that you cannot access it. There is no way around so you must export the method. I can recommend the Tour of Go for this type of fundamental questions.</p>\n"}], "owner": {"reputation": 1, "user_id": 10999172, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-KGEq3OFplvU/AAAAAAAAAAI/AAAAAAAAAAc/coGLncqskz0/photo.jpg?sz=128", "display_name": "Kumar Pun", "link": "https://stackoverflow.com/users/10999172/kumar-pun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 651, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1549489089, "creation_date": 1549361476, "last_edit_date": 1549442286, "question_id": 54531978, "link": "https://stackoverflow.com/questions/54531978/how-do-i-resolve-cannot-refer-to-unexported-field-or-method-models-model-getdevi", "title": "how do i resolve cannot refer to unexported field or method models.Model.getDevices in golang", "body": "<p><strong>entities.go</strong></p>\n\n<p>package entities</p>\n\n<p>type Device struct {</p>\n\n<pre><code>Id        int    \nName      string \n</code></pre>\n\n<p>}</p>\n\n<p><strong>models.go</strong></p>\n\n<pre><code>package models\n</code></pre>\n\n<p>import (</p>\n\n<pre><code>\"log\"\n\"net/http\"\nentities \"../entities\"\n\"github.com/gorilla/mux\"\n\"github.com/jinzhu/gorm\"\n_ \"github.com/jinzhu/gorm/dialects/sqlite\"\n</code></pre>\n\n<p>)</p>\n\n<p>var devices []entities.Device</p>\n\n<p>type Model struct{}</p>\n\n<p>func HttpInfo(r *http.Request) {</p>\n\n<pre><code>fmt.Printf(\"%s\\t %s\\t %s%s\\r\\n\", r.Method, r.Proto, r.Host, r.URL)\n</code></pre>\n\n<p>}</p>\n\n<p>func (c Model) getDevices(db *gorm.DB) http.HandlerFunc {</p>\n\n<pre><code>return func(w http.ResponseWriter, r *http.Request) {\n\n    setJsonHeader(w)\n\n    HttpInfo(r)\n    var devices entities.Device\n    if err := db.Find(&amp;devices).Error; err != nil {\n        fmt.Println(err)\n    } else {\n        json.NewEncoder(w).Encode(devices)\n\n    }\n}\n</code></pre>\n\n<p>}</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n</code></pre>\n\n<p>import (</p>\n\n<pre><code>\"log\"\n\"net/http\"\n\nentities \"./src/entities\"\nmodels \"./src/models\"\n\"github.com/gorilla/handlers\"\n\"github.com/gorilla/mux\"\n\"github.com/jinzhu/gorm\"\n_ \"github.com/jinzhu/gorm/dialects/sqlite\"\n</code></pre>\n\n<p>)</p>\n\n<p>var devices []entities.Device</p>\n\n<p>var db *gorm.DB</p>\n\n<p>var err error</p>\n\n<p>func main() {</p>\n\n<pre><code>// Handle Subsequent requests\n\nfmt.Println(\"Api running on port 4000...\")\n\nr := mux.NewRouter().StrictSlash(true)\n\n\nr.HandleFunc(\"/devices\", model.getDevices(db)).Methods(\"GET\")\n\nr.HandleFunc(\"/devices/{id}\", model.getDevice).Methods(\"GET\")\n\n\nlog.Fatal(http.ListenAndServe(\":4000\", handlers.CORS(headers, methods, origins)(r)))\n</code></pre>\n\n<p>}</p>\n"}, {"tags": ["go", "mongo-go"], "answers": [{"tags": [], "owner": {"reputation": 8470, "user_id": 538866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb67b45ca1dc2584f8e4d703d009177b?s=128&d=identicon&r=PG", "display_name": "Jonas G. Drange", "link": "https://stackoverflow.com/users/538866/jonas-g-drange"}, "is_accepted": true, "score": 1, "last_activity_date": 1549354369, "last_edit_date": 1549354369, "creation_date": 1549354040, "answer_id": 54530025, "question_id": 54529622, "link": "https://stackoverflow.com/questions/54529622/how-to-turn-database-access-into-a-function-idiomatically-in-go/54530025#54530025", "title": "How to turn DataBase access into a Function idiomatically in Go", "body": "<p>As I understand it, the connection should be long-lived and set up as a part of a constructor, i.e. not part of the request flow.</p>\n\n<p>This will typically look something like this:</p>\n\n<pre><code>type BackendAPI struct {\n    client *mongo.Client\n}\n\nfunc NewBackendAPI(mongoURI string) (*BackendAPI, error) {\n    client, err := mongo.NewClient(mongoURI)\n    if err != nil {\n        return nil, err\n    }\n    ctx, cancel := context.WithTimeout(context.Background(), 20*time.Second)\n    defer cancel()\n    err = client.Connect(ctx)\n    if err != nil {\n        return nil, err\n    }\n\n    return &amp;BackendAPI{client}, nil\n}\n\nfunc (api *BackendAPI) func CreateStudentAccountEndpoint(response http.ResponseWriter, request *http.Request) {\n    response.Header().Set(\"Content-Type\", \"application/json\")\n\n    // note the use of the long-lived api.client, which is connected already.\n    studentCollection := api.client.Database(dbName).Collection(\"students\")\n    _, err = studentCollection.InsertOne(context.Background() ,data)\n    if err != nil {\n        response.WriteHeader(501)\n        response.Write([]byte(`{ \"message\": \"` + err.Error() + `\" }`))\n        return // at this point, the method should return\n    }\n    // encoding json object for returning to the client\n    jsonStudent, err := json.Marshal(student)\n    if err != nil {\n        http.Error(response, err.Error(), http.StatusInternalServerError)\n    }\n\n    response.Write(jsonStudent)\n}\n</code></pre>\n\n<p>If you worry about losing the connection, you could implement a call to <code>api.client.Ping</code> in there, but in my opinion this should only be attempted if you encounter a failure you believe you can recover from by reconnecting.</p>\n"}], "owner": {"reputation": 93, "user_id": 7314528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cc870234a102615dbbf04b99166d3fc?s=128&d=identicon&r=PG&f=1", "display_name": "Trevor James Oluotch", "link": "https://stackoverflow.com/users/7314528/trevor-james-oluotch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 0, "accepted_answer_id": 54530025, "answer_count": 1, "score": 0, "last_activity_date": 1549358459, "creation_date": 1549352223, "last_edit_date": 1549358459, "question_id": 54529622, "link": "https://stackoverflow.com/questions/54529622/how-to-turn-database-access-into-a-function-idiomatically-in-go", "title": "How to turn DataBase access into a Function idiomatically in Go", "body": "<p>I have built a Backend API in Go, it works however I want refactor the code for the DB access layer into a function - idiomatically.</p>\n\n<pre><code>// Get the form data entered by client; FirstName, LastName, phone Number,\n// assign the person a unique i.d\n// check to see if that user isn't in the database already\n// if they are send an error message with the a  'bad' response code\n// if they aren't in db add to db and send a message with success\nfunc CreateStudentAccountEndpoint(response http.ResponseWriter, request *http.Request){\n\n    client, err := mongo.NewClient(\"mongodb://localhost:27017\")\n    if err != nil {\n        log.Fatalf(\"Error connecting to mongoDB client Host: Err-&gt; %v\\n \", err)\n    }\n    ctx, cancel := context.WithTimeout(context.Background(), 20*time.Second)\n    defer cancel()\n    err = client.Connect(ctx)\n    if err != nil {\n        log.Fatalf(\"Error Connecting to MongoDB at context.WtihTimeout: Err-&gt; %v\\n \", err)\n    }\n\n\n    response.Header().Set(\"Content-Type\", \"application/json\")\n\n    studentCollection := client.Database(dbName).Collection(\"students\")\n    _, err = studentCollection.InsertOne(context.Background(),data)\n    if err != nil {\n        response.WriteHeader(501)\n        response.Write([]byte(`{ \"message\": \"` + err.Error() + `\" }`))\n    }\n    // encoding json object for returning to the client\n    jsonStudent, err := json.Marshal(student)\n    if err != nil {\n        http.Error(response, err.Error(), http.StatusInternalServerError)\n    }\n\n    response.Write(jsonStudent)\n}\n</code></pre>\n\n<p>I understand that I can create a method which returns (*mongoClient, err) as I utilise the client local variable later on in the code.</p>\n\n<p>However I am lost as to how to implement the <code>defer cancel()</code> part because it executes once the method <code>CreateStudenAccountEndpoint</code> is at the end. But I am at a loss on how to implement this <code>defer</code> section in a method that will recognise that I want the defer to happen at the end of the function that calls the DB access layer method e.g <code>CreateStudentAccountEndpoint</code> not the actual db access method itself.</p>\n"}, {"tags": ["pointers", "go", "biginteger"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1549341273, "post_id": 54527525, "comment_id": 95857320, "body": "Always use *big.Int. Go can take the address of a variable automatically (under some conditions), see <a href=\"https://tour.golang.org/methods/6\" rel=\"nofollow noreferrer\">tour.golang.org/methods/6</a> ff for why you can call Text on a big.Int. Never talk and think about a pointer as being a &quot;reference&quot;: It is not. big.Ints are not designed to be passed as values."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1549342902, "post_id": 54527525, "comment_id": 95857713, "body": "Related: <a href=\"https://stackoverflow.com/questions/33587227/golang-method-sets-pointer-vs-value-receiver\" title=\"golang method sets pointer vs value receiver\">stackoverflow.com/questions/33587227/&hellip;</a>. All methods are defined for the pointer type, so you should use pointers to avoid confusion. A counter example is time.Time, where all methods are defined in the value type, so you should not use pointers. // In Go <a href=\"https://golang.org/ref/spec#Calls\" rel=\"nofollow noreferrer\">everything is passed by value</a>."}], "answers": [{"tags": [], "owner": {"reputation": 16516, "user_id": 1133291, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/538bd3553b7540f411a84101e4cbf294?s=128&d=identicon&r=PG", "display_name": "Gal Ben-Haim", "link": "https://stackoverflow.com/users/1133291/gal-ben-haim"}, "is_accepted": false, "score": -1, "last_activity_date": 1549356433, "creation_date": 1549356433, "answer_id": 54530586, "question_id": 54527525, "link": "https://stackoverflow.com/questions/54527525/difference-between-big-int-and-big-int-and-how-do-you-pass-a-big-int-by-value/54530586#54530586", "title": "Difference between big.Int and *big.Int, and how do you pass a big.Int by value", "body": "<p><a href=\"https://golang.org/pkg/math/big/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/math/big/</a> the <code>Text()</code> method has a pointer receiver, which means that you can only call <code>a.Text()</code> if a is <code>*big.Int</code>.</p>\n\n<p><code>*big.Int</code> is a pointer to <code>big.Int</code>, see <a href=\"https://play.golang.org/p/dD70b0tPeGp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/dD70b0tPeGp</a> for a fixed version of your code</p>\n"}, {"tags": [], "owner": {"reputation": 2547, "user_id": 6255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454bc16f39711097b06e71a597725238?s=128&d=identicon&r=PG&f=1", "display_name": "jussius", "link": "https://stackoverflow.com/users/6255980/jussius"}, "is_accepted": false, "score": 0, "last_activity_date": 1549360367, "last_edit_date": 1549360367, "creation_date": 1549359995, "answer_id": 54531539, "question_id": 54527525, "link": "https://stackoverflow.com/questions/54527525/difference-between-big-int-and-big-int-and-how-do-you-pass-a-big-int-by-value/54531539#54531539", "title": "Difference between big.Int and *big.Int, and how do you pass a big.Int by value", "body": "<p>The <code>Text()</code> method is defined for receiver type <code>*big.Int</code>, so obviously you can call it on variables of that type and on return values of functions returning <code>*big.Int</code>. You can also call it on variables of type <code>big.Int</code>, because Go automatically takes the address of a variable when you're trying to call its pointer methods, just to save you the trouble of typing an extra ampersand.</p>\n\n<p>However you can't call it on return value of a function returning <code>big.Int</code>, because that value is not addressable. Here's what the spec says about addressability:</p>\n\n<blockquote>\n  <p>For an operand x of type T, the address operation &amp;x generates a\n  pointer of type *T to x. The operand must be addressable, that is,\n  either a variable, pointer indirection, or slice indexing operation;\n  or a field selector of an addressable struct operand; or an array\n  indexing operation of an addressable array. As an exception to the\n  addressability requirement, x may also be a (possibly parenthesized)\n  composite literal.</p>\n</blockquote>\n\n<p>Your return value is none of those things, so you can't use the pointer method any more than you can write <code>foo := &amp;myFunc()</code>. To work around this, you could save the return value on a variable to make it addressable. But most likely your function should return a pointer in the first place.</p>\n\n<p>Also note that there are no references in Go. Everything is passed by value, and pointers are values just like any other.</p>\n"}], "owner": {"reputation": 153, "user_id": 8704430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e348ef7b41694b6635199391d860889e?s=128&d=identicon&r=PG&f=1", "display_name": "user40176", "link": "https://stackoverflow.com/users/8704430/user40176"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 116, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1549360367, "creation_date": 1549338999, "last_edit_date": 1549351357, "question_id": 54527525, "link": "https://stackoverflow.com/questions/54527525/difference-between-big-int-and-big-int-and-how-do-you-pass-a-big-int-by-value", "title": "Difference between big.Int and *big.Int, and how do you pass a big.Int by value", "body": "<p>I can use methods like Text() on a big.Int and it works fine, but if I return a big.Int then use \"myfunc().Text()\" throws an error, whereas if I return a *big.Int, I get no error. Why can I use Text() on a big.Int, *big.Int, and on a function that returns *big.Int but not on a function whose return value is big.Int?</p>\n\n<p><a href=\"https://play.golang.org/p/ovgeQDHFstP\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ovgeQDHFstP</a></p>\n\n<p>Based on this and other behavior (such as how it prints), it seems like *big.Int is the type that is intended for use, is that correct?</p>\n\n<p>Also, if I make and use a variable of type big.Int or *big.Int, it is passed by reference. That's fine. But if I wanted to pass one by value, how is that best done?</p>\n\n<p>Should I make a new big.Int and set it to the original value using Set() and pass that? Or should I pass the original big.Int in, and copy its value to a new big.Int using Set() inside the function? Or is there some other, better way of doing it?</p>\n"}, {"tags": ["go", "timer"], "answers": [{"tags": [], "owner": {"reputation": 278, "user_id": 3882761, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/de53bc6a417356dca44b12d601d0db28?s=128&d=identicon&r=PG&f=1", "display_name": "SAyotte", "link": "https://stackoverflow.com/users/3882761/sayotte"}, "is_accepted": true, "score": 4, "last_activity_date": 1549330882, "creation_date": 1549330882, "answer_id": 54526746, "question_id": 54526745, "link": "https://stackoverflow.com/questions/54526745/best-way-to-call-function-with-variable-execution-time-at-minimum-intervals-in-g/54526746#54526746", "title": "Best way to call function with variable execution time at minimum intervals in Golang?", "body": "<p>While writing the question, I remembered that the Golang source is super easy to read... and figured I should just have a peek before looking silly. I am pleased with what I found :)</p>\n\n<p>Comments in <a href=\"https://golang.org/src/time/tick.go?s=818:970#L16\" rel=\"nofollow noreferrer\">the source</a> for <code>time.Ticker</code> say if the tick-reader falls behind it will start dropping ticks rather than blocking on writing to the channel (which has a buffer of only 1). The effect of this is to get things back \"on track\" immediately after we've missed one or more ticks.</p>\n\n<p>Example proof:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    t := time.NewTicker(time.Millisecond * 50)\n    for i := 0; i &lt; 10; i++ {\n        fmt.Printf(\"New invocation starting at %dms\\n\", time.Now().Round(time.Millisecond).Nanosecond()/int(time.Millisecond))\n        if i%3 == 0 {\n            fmt.Println(\"Executing for 25ms\")\n            time.Sleep(time.Millisecond * 25)\n        } else {\n            fmt.Println(\"Executing for 75ms\")\n            time.Sleep(time.Millisecond * 75)\n        }\n        fmt.Println(\"Waiting for ticker...\")\n        &lt;-t.C\n    }\n    t.Stop()\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>New invocation starting at 0ms\nExecuting for 25ms\nWaiting for ticker...\nNew invocation starting at 50ms\nExecuting for 75ms\nWaiting for ticker...\nNew invocation starting at 125ms\nExecuting for 75ms\nWaiting for ticker...\nNew invocation starting at 200ms\nExecuting for 25ms\nWaiting for ticker...\nNew invocation starting at 250ms\nExecuting for 75ms\nWaiting for ticker...\nNew invocation starting at 325ms\nExecuting for 75ms\nWaiting for ticker...\nNew invocation starting at 400ms\nExecuting for 25ms\nWaiting for ticker...\nNew invocation starting at 450ms\nExecuting for 75ms\nWaiting for ticker...\nNew invocation starting at 525ms\nExecuting for 75ms\nWaiting for ticker...\nNew invocation starting at 600ms\nExecuting for 25ms\nWaiting for ticker...\n</code></pre>\n"}], "owner": {"reputation": 278, "user_id": 3882761, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/de53bc6a417356dca44b12d601d0db28?s=128&d=identicon&r=PG&f=1", "display_name": "SAyotte", "link": "https://stackoverflow.com/users/3882761/sayotte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 186, "favorite_count": 0, "accepted_answer_id": 54526746, "answer_count": 1, "score": 2, "last_activity_date": 1549330882, "creation_date": 1549330882, "question_id": 54526745, "link": "https://stackoverflow.com/questions/54526745/best-way-to-call-function-with-variable-execution-time-at-minimum-intervals-in-g", "title": "Best way to call function with variable execution time at minimum intervals in Golang?", "body": "<p>I want to execute a function at <em>no less than</em> a given interval in Go, measured by the start of one invocation to the start of the next invocation. The function itself will vary in its execution time.</p>\n\n<p>If the function runs for longer than that interval, I want to run it again immediately. But if/when it eventually resumes completing in less than a full interval, I want it to immediately resume waiting until the next interval-boundary.</p>\n\n<p>For context, this is a rate-limiter-- the called function could easily spin the CPU but it wouldn't produce additional value, as it's interacting with humans who can't possibly react that fast.</p>\n\n<p>An example for clarity (<code>interval == 20ms</code> in example):</p>\n\n<pre><code>runtime:  15ms\nwait:      5ms\nruntime:  25ms\nwait:      0ms\nruntime:  25ms\nwait:      0ms\nruntime:  15ms\nwait:      5ms &lt;-- this is the important bit\n</code></pre>\n\n<p>If I use <code>time.Ticker</code>, I believe additional \"ticks\" will either queue up in the <code>Ticker.C</code> channel (if it's buffered) causing it to make a bunch of invocations with no delay when it resumes, or the Ticker's writer will block on writing to the channel and end up resuming with an over-long delay for the first invocation afterit resumes.</p>\n\n<p>Right now I'm doing some math, which is working, but it feels like it might be un-idiomatic:</p>\n\n<pre><code>minDurationBetweenRuns := time.Millisecond * 100\nfor {\n    lastRunTime := time.Now()\n\n    DO_STUFF_HERE()\n\n    durationSinceLastRun := time.Now().Sub(lastRunTime)\n    if durationSinceLastRun &lt; minDurationBetweenRuns {\n        sleepTime := minDurationBetweenRuns - durationSinceLastRun\n        if sleepTime &gt; minDurationBetweenRuns {\n            sleepTime = minDurationBetweenRuns\n        }\n        time.Sleep(sleepTime)\n    }\n}\n</code></pre>\n"}, {"tags": ["dictionary", "go", "composite-literals"], "answers": [{"comments": [{"owner": {"reputation": 383, "user_id": 636635, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/qFPpL.jpg?s=128&g=1", "display_name": "xsigndll", "link": "https://stackoverflow.com/users/636635/xsigndll"}, "edited": false, "score": 0, "creation_date": 1549317835, "post_id": 54524904, "comment_id": 95852408, "body": "Meaning the map of <code>package A</code> will be constructed upon first interaction with the package? Or at import?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 383, "user_id": 636635, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/qFPpL.jpg?s=128&g=1", "display_name": "xsigndll", "link": "https://stackoverflow.com/users/636635/xsigndll"}, "edited": false, "score": 0, "creation_date": 1549317887, "post_id": 54524904, "comment_id": 95852431, "body": "Package <code>A</code> will be initialized before any other package could reference anything from it."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1549317831, "last_edit_date": 1549317831, "creation_date": 1549317418, "answer_id": 54524904, "question_id": 54524868, "link": "https://stackoverflow.com/questions/54524868/extend-map-from-other-packages-at-compile-time/54524904#54524904", "title": "Extend map from other packages at compile time", "body": "<p>You can't do this \"at compile\" time. In fact, the composite literal that <code>package A</code> uses, that also will be constructed and used at runtime. There are no composite literal constants.</p>\n\n<p>Going further, whatever code you write in package <code>B</code>, if it imports package <code>A</code>, code of package <code>B</code> will only run after package <code>A</code> has been initialized, including the map you posted.</p>\n\n<p>If you want <code>A.MyMap</code> to have a different value before it can be seen by any other package, you should modify the source of package <code>A</code>. This could be a generated additional file, which could use a package <code>init()</code> function, assigning a new value to <code>MyMap</code>, or adding new values to it.</p>\n\n<p>If you can, you could also modify package <code>A</code> so that the initialization of <code>MyMap</code> is moved to a different source file, one that can be generated.</p>\n"}, {"comments": [{"owner": {"reputation": 383, "user_id": 636635, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/qFPpL.jpg?s=128&g=1", "display_name": "xsigndll", "link": "https://stackoverflow.com/users/636635/xsigndll"}, "edited": false, "score": 1, "creation_date": 1549317457, "post_id": 54524905, "comment_id": 95852280, "body": "That one is working ofc. I intentionally need it at compile time :-/ I tried init() but failed to have this one being called without the package actually being imported. I guess I&#39;ll have to find a way around it somehow."}], "tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 2, "last_activity_date": 1549317469, "last_edit_date": 1549317469, "creation_date": 1549317419, "answer_id": 54524905, "question_id": 54524868, "link": "https://stackoverflow.com/questions/54524868/extend-map-from-other-packages-at-compile-time/54524905#54524905", "title": "Extend map from other packages at compile time", "body": "<p>It is actually extension at runtime but it should fit your example.</p>\n\n<p>Use <a href=\"https://golang.org/doc/effective_go.html#init\" rel=\"nofollow noreferrer\">init</a> function.</p>\n\n<pre><code>package B\n\nimport \"A\"\n\nfunc init() {\n    A.MyMap[\"key3\"] = \"value\"\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 2, "last_activity_date": 1549317789, "creation_date": 1549317789, "answer_id": 54524979, "question_id": 54524868, "link": "https://stackoverflow.com/questions/54524868/extend-map-from-other-packages-at-compile-time/54524979#54524979", "title": "Extend map from other packages at compile time", "body": "<p>You pass a string at linking time with command</p>\n\n<pre><code>go build -ldflags '-X somemap={\"k\":\"v\"}'\n</code></pre>\n\n<p>and then parse it to map at run time. You can easily use JSON format.</p>\n\n<p>See more on <a href=\"https://github.com/golang/go/wiki/GcToolchainTricks#including-build-information-in-the-executable\" rel=\"nofollow noreferrer\">GcToolchainTricks</a>.</p>\n"}], "owner": {"reputation": 383, "user_id": 636635, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/qFPpL.jpg?s=128&g=1", "display_name": "xsigndll", "link": "https://stackoverflow.com/users/636635/xsigndll"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 54524904, "answer_count": 3, "score": 3, "last_activity_date": 1549350917, "creation_date": 1549317189, "last_edit_date": 1549350917, "question_id": 54524868, "link": "https://stackoverflow.com/questions/54524868/extend-map-from-other-packages-at-compile-time", "title": "Extend map from other packages at compile time", "body": "<p>I'm trying to extend a map across packages at 'compile time'. Is this possible?</p>\n\n<p>I have package <code>A</code> with a predefined map:</p>\n\n<pre><code>package A\n\nvar MyMap = map[string]string{\"key1\": \"value\", \"key2\": \"value\"}\n</code></pre>\n\n<p>And I would like to extend the map during 'compile time'. This shall be done in another package. E.g. like so (not working code ofc.):</p>\n\n<pre><code>package B\n\nimport \"A\"\n\nA.MyMap.Slice1[\"key3\"] = \"value\" // extend the map during compile time\n</code></pre>\n\n<p>Is this somehow possible?</p>\n"}, {"tags": ["docker", "go", "alpine"], "comments": [{"owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 1, "creation_date": 1549317181, "post_id": 54524785, "comment_id": 95852170, "body": "<a href=\"https://hub.docker.com/r/frolvlad/alpine-glibc/\" rel=\"nofollow noreferrer\">hub.docker.com/r/frolvlad/alpine-glibc</a> Get this image as base image, run the same steps in the golang&#39;s official dockerfile (<a href=\"https://github.com/docker-library/golang/blob/master/Dockerfile-alpine.template\" rel=\"nofollow noreferrer\">github.com/docker-library/golang/blob/master/&hellip;</a>) to create your builder image, compile your code, profit."}, {"owner": {"reputation": 1284, "user_id": 787610, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/de7bacddae46a9afdee74284ebdea287?s=128&d=identicon&r=PG", "display_name": "Anders Sewerin Johansen", "link": "https://stackoverflow.com/users/787610/anders-sewerin-johansen"}, "reply_to_user": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 0, "creation_date": 1549317553, "post_id": 54524785, "comment_id": 95852311, "body": "Hmm it&#39;s a good start, but now I have to configure that image to be ready to build my Go code..."}, {"owner": {"reputation": 8470, "user_id": 538866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb67b45ca1dc2584f8e4d703d009177b?s=128&d=identicon&r=PG", "display_name": "Jonas G. Drange", "link": "https://stackoverflow.com/users/538866/jonas-g-drange"}, "edited": false, "score": 0, "creation_date": 1549347467, "post_id": 54524785, "comment_id": 95858984, "body": "&quot;I have to configure that image to be ready to build my Go code&quot; Yes, you should attempt that configuration."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1549347795, "post_id": 54524785, "comment_id": 95859081, "body": "Actually, <code>golang:latest</code>is based on Debian Stretch. Basically, all you should need to do is to leave out the <code>alpine</code> modifier in the <code>FROM</code> directive of your build stage."}, {"owner": {"reputation": 10144, "user_id": 7256341, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/RXEvi.jpg?s=128&g=1", "display_name": "valiano", "link": "https://stackoverflow.com/users/7256341/valiano"}, "edited": false, "score": 0, "creation_date": 1549374091, "post_id": 54524785, "comment_id": 95872977, "body": "Another option is installing <code>musl-dev</code> on Ubuntu (and adding it as a depdendency of your app)"}, {"owner": {"reputation": 1284, "user_id": 787610, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/de7bacddae46a9afdee74284ebdea287?s=128&d=identicon&r=PG", "display_name": "Anders Sewerin Johansen", "link": "https://stackoverflow.com/users/787610/anders-sewerin-johansen"}, "edited": false, "score": 0, "creation_date": 1549381533, "post_id": 54524785, "comment_id": 95877548, "body": "So I tried the alpine-glibc approach, but the binary still shows as linked to musl when I test with ldd. Off to try the alpine-latest. Other alternatives are: 1) building it locally on my host machine then using COPY instead of using a builder image or 2) take the setup for the golang builder image and transplant it to an Ubuntu image."}, {"owner": {"reputation": 1284, "user_id": 787610, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/de7bacddae46a9afdee74284ebdea287?s=128&d=identicon&r=PG", "display_name": "Anders Sewerin Johansen", "link": "https://stackoverflow.com/users/787610/anders-sewerin-johansen"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1549468600, "post_id": 54524785, "comment_id": 95914997, "body": "@Markus golang:latest still links to musl, no joy. As for valiano&#39;s suggestion, I don&#39;t have that kind of control over the configuration of the node, so that&#39;s not an option. At this point I think the simplest option is to not use a build container, and just copy the binary from my dev machine. After all I can build there, as this is where I develop and debug, and it&#39;s a vanilla Ubuntu machine."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1549477491, "post_id": 54524785, "comment_id": 95919632, "body": "Please add your Dockerfile to your question by editing it."}], "owner": {"reputation": 1284, "user_id": 787610, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/de7bacddae46a9afdee74284ebdea287?s=128&d=identicon&r=PG", "display_name": "Anders Sewerin Johansen", "link": "https://stackoverflow.com/users/787610/anders-sewerin-johansen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1961, "favorite_count": 0, "answer_count": 0, "score": 4, "last_activity_date": 1549316787, "creation_date": 1549316787, "question_id": 54524785, "link": "https://stackoverflow.com/questions/54524785/how-to-build-a-go-executable-that-doesnt-link-to-musl-libc", "title": "How to build a go executable that doesn&#39;t link to musl libc", "body": "<p>So: </p>\n\n<p>The official Go build container is based on Alpine.</p>\n\n<p>Alpine uses <a href=\"https://www.musl-libc.org/\" rel=\"nofollow noreferrer\">musl</a> as libc instead of glibc.</p>\n\n<p>I need to build a Go executable in a container that can be run on Ubuntu, which uses glibc.</p>\n\n<p>How do I either</p>\n\n<ol>\n<li>Make the official GoLang build container use glibc or</li>\n<li>Build my GoLang project on an Ubuntu based container</li>\n</ol>\n\n<p>I can't use the <a href=\"https://stackoverflow.com/questions/36279253/go-compiled-binary-wont-run-in-an-alpine-docker-container-on-ubuntu-host\">Disable CGO</a> solution, as my Go code is a FUSE driver, which requires CGO</p>\n"}, {"tags": ["java", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1549314506, "post_id": 54524243, "comment_id": 95851043, "body": "<a href=\"https://golang.org/pkg/encoding/binary/#Read\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/binary/#Read</a> first example shows reading a float."}, {"owner": {"reputation": 393, "user_id": 5638083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rZrXN.png?s=128&g=1", "display_name": "Gilgamesh Skytrooper", "link": "https://stackoverflow.com/users/5638083/gilgamesh-skytrooper"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1549329737, "post_id": 54524243, "comment_id": 95855317, "body": "I&#39;m not trying to read a single float, I need to read a byte slice. Why did you downvote my question?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1549331751, "post_id": 54524243, "comment_id": 95855704, "body": "@GilgameshSkytrooper: If you don&#39;t want to read a float, and want to read a byte slice, I&#39;m afraid I don&#39;t understand what you want. Your description says you want to read 4 byte chunks into float values, in which case you can use the <code>binary</code> package as shown in the example, or read them into a uint32 and convert that directly to a float32 in the exact same manner as described in the java <code>DataInput</code> documentation."}, {"owner": {"reputation": 393, "user_id": 5638083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rZrXN.png?s=128&g=1", "display_name": "Gilgamesh Skytrooper", "link": "https://stackoverflow.com/users/5638083/gilgamesh-skytrooper"}, "edited": false, "score": 0, "creation_date": 1549332874, "post_id": 54524243, "comment_id": 95855887, "body": "Sorry, the data type I am trying to read is float slice. The code I am translating from Java declares a float Vector, then  loops through a DataInputStream, and running <code>readFloat()</code>, and pushing those values to the vector. I&#39;m not entirely sure, if this helps you understand, but here&#39;s what I have: <a href=\"https://gist.github.com/gilgameshskytrooper/80dc43d97475024ac2c9c9bfa1f3a37e\" rel=\"nofollow noreferrer\">gist.github.com/gilgameshskytrooper/&hellip;</a> (changed since last time because the pure Go piping stuff didn&#39;t work out)"}, {"owner": {"reputation": 393, "user_id": 5638083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rZrXN.png?s=128&g=1", "display_name": "Gilgamesh Skytrooper", "link": "https://stackoverflow.com/users/5638083/gilgamesh-skytrooper"}, "edited": false, "score": 0, "creation_date": 1549333007, "post_id": 54524243, "comment_id": 95855906, "body": "The code I am translating is lines 591-610 of the file at <a href=\"https://github.com/marytts/marytts/blob/4aada82d17abf01a7ea0d8bce755866ebaa6e235/marytts-runtime/src/main/java/marytts/htsengine/HTSEngineTest.java\" rel=\"nofollow noreferrer\">github.com/marytts/marytts/blob/&hellip;</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1549385137, "post_id": 54524243, "comment_id": 95879604, "body": "@GilgameshSkytrooper: please include the relevant code in the question, and it would be helpful to distill this down to a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>. You seem to have multiple issues here causing confusion."}, {"owner": {"reputation": 393, "user_id": 5638083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rZrXN.png?s=128&g=1", "display_name": "Gilgamesh Skytrooper", "link": "https://stackoverflow.com/users/5638083/gilgamesh-skytrooper"}, "edited": false, "score": 0, "creation_date": 1549385597, "post_id": 54524243, "comment_id": 95879914, "body": "touche. I will reformulate my original question. Thanks"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1549408469, "post_id": 54524243, "comment_id": 95889857, "body": "To start you off in the right direction, you&#39;re reading into a 0-length slice, which is going to yield 0 values. You only want to read 4-byte values, but you&#39;re using float64. Are you sure you want <code>LitttleEndian</code>? I&#39;m fairly certain the java is going to interpret the values as <code>BigEndian</code>."}, {"owner": {"reputation": 393, "user_id": 5638083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rZrXN.png?s=128&g=1", "display_name": "Gilgamesh Skytrooper", "link": "https://stackoverflow.com/users/5638083/gilgamesh-skytrooper"}, "edited": false, "score": 0, "creation_date": 1549475534, "post_id": 54524243, "comment_id": 95918796, "body": "I read that in general, OS level IO is all LittleEndian while network transferred bytes are BigEndian. But good to know."}], "owner": {"reputation": 393, "user_id": 5638083, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/rZrXN.png?s=128&g=1", "display_name": "Gilgamesh Skytrooper", "link": "https://stackoverflow.com/users/5638083/gilgamesh-skytrooper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 163, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1549486402, "creation_date": 1549313966, "last_edit_date": 1549486402, "question_id": 54524243, "link": "https://stackoverflow.com/questions/54524243/java-io-datainputstream-readfloat-in-golang", "title": "Java.io.DataInputStream.readFloat() in Golang", "body": "<p>I am writing a program that emulates the functionality of the following Java program:</p>\n\n<pre class=\"lang-java prettyprint-override\"><code>public class MFCC {\n  public static void main(String[] args) throws IOException, InterruptedException, Exception {\n    System.out.println(\"MFCC Coefficient Extractor\");\n    // Executables\n    String sox = \"/usr/bin/sox\";\n    String x2x = \"/usr/local/bin/x2x\";\n    String frame = \"/usr/local/bin/frame\";\n    String window = \"/usr/local/bin/window\";\n    String mcep = \"/usr/local/bin/mcep\";\n    String swab = \"/usr/local/bin/swab\";\n\n    // Command Line Options\n    String WavFile = \"/output/audio.wav\";\n    String RawFile = WavFile + \".raw\";\n    String frameLength = \"400\";\n    String frameLengthOutput = \"512\";\n    String framePeriod = \"80\";\n    String mgcOrder = \"24\";\n    String mfccFile = WavFile + \".mfc\";\n\n    String soxcmd = sox + \" \" + WavFile + \" \" + RawFile;\n    launchProc(soxcmd, \"sox\", WavFile);\n\n    // MFCC\n    String mfcccmd = x2x + \" +sf \" + WavFile + \" | \" + frame + \" -l \" + frameLength + \" -p \" + framePeriod + \" | \" + window\n        + \" -l \" + frameLength + \" -L \" + frameLengthOutput + \" -w 1 -n 1 | \" + mcep + \" -a 0.42 -m \" + mgcOrder\n        + \" -l \" + frameLengthOutput + \" | \" + swab + \" +f &gt; \" + mfccFile;\n\n    launchBatchProc(mfcccmd, \"getSptkMfcc\", WavFile);\n\n        int numFrames;\n    DataInputStream mfcData = null;\n        Vector&lt;Float&gt; mfc = new Vector&lt;Float&gt;();\n\n        mfcData = new DataInputStream(new BufferedInputStream(new FileInputStream(mfccFile)));\n        try {\n            while (true) {\n                mfc.add(mfcData.readFloat());\n            }\n        } catch (EOFException e) {\n        }\n        mfcData.close();\n\n    System.out.println(\"Coefficient vector length: \" + mfc.size());\n    System.out.println(\"The coefficients are: \" + mfc);\n  }\n}\n</code></pre>\n\n<p>(Run it by cloning <a href=\"https://github.com/gilgameshskytrooper/javamfcc.git\" rel=\"nofollow noreferrer\">this repo</a> and running <code>docker build -t javamfcc:latest . &amp;&amp; docker run --name javamfcc --rm -v $PWD/output:/output javamfcc:latest</code>)</p>\n\n<p>The basic gist of what this program is by running an audio file through a list of pipes of executables provided by <a href=\"https://sourceforge.net/projects/sp-tk/\" rel=\"nofollow noreferrer\">the SPTK project</a>, and parsing the final output by reading 4 bytes as a float, and appending those values to a single vector.</p>\n\n<p>I more or less have a good idea of how to get the pipes, but am having trouble figuring out how I can loop through the final *io.Reader and read every 4 bytes as a float (as is accomplished in <code>Java.io.DataInputStream.readFloat()</code>) done with the following code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fileName := \"/output/audio.wav\"\n    frameLength := 400\n    frameLengthOutput := 512\n    framePeriod := 80\n    mgcOrder := 24\n\n    mfcc := exec.Command(\"mfcc.sh\", \"/output/\"+fileheader.Filename, strconv.Itoa(frameLength), strconv.Itoa(frameLengthOutput), strconv.Itoa(framePeriod), strconv.Itoa(mgcOrder))\n    mfccout, mfccerr := mfcc.Output()\n    if mfccerr != nil {\n        log.Println(\"Error executing mfcc.sh\")\n        panic(mfccerr)\n    }\n\n    b := bytes.NewReader(mfcc)\n\n}\n</code></pre>\n\n<p>mfcc.sh</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>#!/bin/bash\nfilename=$1\nframeLength=$2\nframeLengthOutput=$3\nframePeriod=$4\nmgcOrder=$5\n\necho \"filename: \"$filename\necho \"frameLength: \"$frameLength\necho \"frameLengthOutput: \"$frameLengthOutput\necho \"framePeriod: \"$framePeriod\necho \"mgcOrder: \"$mgcOrder\nx2x +sf $filename | frame -l $frameLength -p $framePeriod | window -l $frameLength -L $frameLengthOutput -w 1 -n 1 | mcep -a 0.42 -m $mgcOrder -l $frameLengthOutput | swab +f\n</code></pre>\n"}, {"tags": ["mysql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 534, "user_id": 6192935, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-WzVJWA1aLts/AAAAAAAAAAI/AAAAAAAABfQ/FxZhI2PBCBA/photo.jpg?sz=128", "display_name": "Manish Champaneri", "link": "https://stackoverflow.com/users/6192935/manish-champaneri"}, "edited": false, "score": 2, "creation_date": 1549344867, "post_id": 54523765, "comment_id": 95858233, "body": "You can refer to this url : <a href=\"https://github.com/jinzhu/gorm/issues/202#issuecomment-52582525\" rel=\"nofollow noreferrer\">github.com/jinzhu/gorm/issues/202#issuecomment-52582525</a>"}], "answers": [{"comments": [{"owner": {"reputation": 347, "user_id": 11465355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97c3df82a32f65c9fb0db3827f4d2a5b?s=128&d=identicon&r=PG&f=1", "display_name": "Heikkisorsa", "link": "https://stackoverflow.com/users/11465355/heikkisorsa"}, "edited": false, "score": 0, "creation_date": 1602589888, "post_id": 57069554, "comment_id": 113762995, "body": "If you don&#39;t want to change your struct definitions you can go with this solution (converting struct to map) as well: <a href=\"https://stackoverflow.com/questions/64330504/update-method-does-not-update-zero-value\" title=\"update method does not update zero value\">stackoverflow.com/questions/64330504/&hellip;</a>"}, {"owner": {"reputation": 555, "user_id": 7168030, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-gpgjxsBVshQ/AAAAAAAAAAI/AAAAAAAAACg/IU7EpGdbVak/photo.jpg?sz=128", "display_name": "hashlash", "link": "https://stackoverflow.com/users/7168030/hashlash"}, "edited": false, "score": 0, "creation_date": 1604287811, "post_id": 57069554, "comment_id": 114292363, "body": "But wouldn&#39;t this will allow <code>nil</code> as a valid value? Which we may not want"}], "tags": [], "owner": {"reputation": 55, "user_id": 9321069, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-11Kzi-0PHBU/AAAAAAAAAAI/AAAAAAAAAAc/e94hIqeDmH8/photo.jpg?sz=128", "display_name": "Jonyhy96", "link": "https://stackoverflow.com/users/9321069/jonyhy96"}, "is_accepted": false, "score": 3, "last_activity_date": 1563344068, "creation_date": 1563344068, "answer_id": 57069554, "question_id": 54523765, "link": "https://stackoverflow.com/questions/54523765/update-with-0-value-using-gorm/57069554#57069554", "title": "Update with 0 value using Gorm", "body": "<p>I found a very tricky way to solve this problem.You just need to change your struct field type into a ptr.</p>\n\n<p>change</p>\n\n<pre><code>type Temp struct{\nString string\nBool bool\n}\n</code></pre>\n\n<p>to</p>\n\n<pre><code>type Temp struct{\nString *string\nBool *bool\n}\n</code></pre>\n"}], "owner": {"reputation": 629, "user_id": 7406696, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/d8e99f62483082d6e035c172ac28b094?s=128&d=identicon&r=PG&f=1", "display_name": "Pablo R.", "link": "https://stackoverflow.com/users/7406696/pablo-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4738, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1563344068, "creation_date": 1549311661, "last_edit_date": 1549350941, "question_id": 54523765, "link": "https://stackoverflow.com/questions/54523765/update-with-0-value-using-gorm", "title": "Update with 0 value using Gorm", "body": "<p>I am trying to update some values using gorm library but bytes and ints with 0 value are not updated</p>\n\n<pre><code>var treatment model.TreatmentDB\n\nerr = json.Unmarshal(b, &amp;treatment)\nif err != nil {\n    http.Error(w, err.Error(), 500)\n    return\n}\n\nfmt.Println(&amp;treatment)\n\ndb := db.DB.Table(\"treatment\").Where(\"id = ?\", nID).Updates(&amp;treatment)\n</code></pre>\n\n<p>this print value is {0 3 1 0 0 0 2018-01-01 4001-01-01} and those 0 are the byte value (tinyint(1) in database, if I change to int also not working) which are not updated, the rest of values work fine</p>\n\n<p>if I update them without using Gorm this way it's working perfectly with 0 values</p>\n\n<pre><code>var query  = fmt.Sprintf(\"UPDATE `pharmacy_sh`.`treatment` SET `id_med` = '%d', `morning` = '%d', `afternoon` = '%d', `evening` = '%d', `start_treatment` = '%s', `end_treatment` = '%s' WHERE (`id` = '%s')\", treatment.IDMed, treatment.Morning,  treatment.Afternoon, treatment.Evening, treatment.StartTreatment, treatment.EndTreatment, nID)\n\nupdate, err := dbConnector.Exec(query)\n</code></pre>\n\n<p>and this is my model obj</p>\n\n<pre><code>type TreatmentDB struct {\ngorm.Model\nID              int         `json:\"id\"`\nIDMed           int         `json:\"id_med\"`\nIDUser          int         `json:\"id_user\"`\nMorning         byte        `json:\"morning\"`\nAfternoon       byte        `json:\"afternoon\"`\nEvening         byte        `json:\"evening\"`\nStartTreatment  string      `json:\"start_treatment\"`\nEndTreatment    string      `json:\"end_treatment\"`\n}\n</code></pre>\n\n<p>Thanks for any help!!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1549305533, "post_id": 54521576, "comment_id": 95847234, "body": "Why not take the Tour of Go once more to get more familiar with the language and the stdlib?"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 11013627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/543d8d01b4f6e00f12a16e3fbbdc8f25?s=128&d=identicon&r=PG&f=1", "display_name": "Alex-Sizov", "link": "https://stackoverflow.com/users/11013627/alex-sizov"}, "edited": false, "score": 0, "creation_date": 1549344995, "post_id": 54523392, "comment_id": 95858263, "body": "Thak you very much for the answer!Yes, it solves the problem. Sorry for the dump question, maybe i shoud take tour of go one more time as Volker suggested)"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 0, "last_activity_date": 1549309969, "creation_date": 1549309969, "answer_id": 54523392, "question_id": 54521576, "link": "https://stackoverflow.com/questions/54521576/cant-figure-out-how-to-use-buffers-with-binary-web-socket/54523392#54523392", "title": "Can`t figure out how to use buffers with binary web socket", "body": "<p>The <a href=\"https://godoc.org/log\" rel=\"nofollow noreferrer\">log</a> package writes each log message on a separate line.  If the log message does not end with a newline, then the log package will add one.</p>\n\n<p>These extra newlines are garbling the output. To fix the output, replace the call to <code>log.Printf(\"%s\", message)</code> with a function that does not add newlines to the output.  Here are some options: </p>\n\n<p>Write the message to stderr (same destination as default log package config):</p>\n\n<pre><code>os.Stderr.Write(message)\n</code></pre>\n\n<p>Write the message to stdout (a more conventional location to write program output):</p>\n\n<pre><code>os.Stdout.Write(message)\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 11013627, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/543d8d01b4f6e00f12a16e3fbbdc8f25?s=128&d=identicon&r=PG&f=1", "display_name": "Alex-Sizov", "link": "https://stackoverflow.com/users/11013627/alex-sizov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 54523392, "answer_count": 1, "score": 1, "last_activity_date": 1549309969, "creation_date": 1549302287, "question_id": 54521576, "link": "https://stackoverflow.com/questions/54521576/cant-figure-out-how-to-use-buffers-with-binary-web-socket", "title": "Can`t figure out how to use buffers with binary web socket", "body": "<p>everyone!\nI'm trying to get my go code work with openstack serial console. It`s exposed via web socket. And i have problems with it.</p>\n\n<p>I found gorrilla websocket lib (which is great) and took <a href=\"https://github.com/gorilla/websocket/blob/master/examples/echo/client.go\" rel=\"nofollow noreferrer\">this example </a> as a reference</p>\n\n<p>With a few tweaks, now i have a code like this:</p>\n\n<pre><code>package main\nimport (\n\"log\"\n\"net/url\"\n\"os\"\n\"os/signal\"\n\"time\"\n\"net/http\"\n\n\"github.com/gorilla/websocket\"\n)\n\n\nfunc main() {\nDialSettings := &amp;websocket.Dialer {\n    Proxy:            http.ProxyFromEnvironment,\n    HandshakeTimeout: 45 * time.Second,\n    Subprotocols: []string{\"binary\",},\n    ReadBufferSize: 4096,\n    WriteBufferSize: 4096,\n}\nlog.SetFlags(0)\ninterrupt := make(chan os.Signal, 1)\nsignal.Notify(interrupt, os.Interrupt)\n\nu, _ := url.Parse(\"ws://172.17.0.64:6083/?token=d1763f2b-3466-424c-aece-6aeea2a733d5\") //websocket url  as it outputs from 'nova get-serial-console test' cmd\nlog.Printf(\"connecting to %s\", u.String())\n\nc, _, err := DialSettings.Dial(u.String(), nil)\nif err != nil {\n    log.Fatal(\"dial:\", err)\n}\ndefer c.Close()\n\ndone := make(chan struct{})\n\ngo func() {\n    defer close(done)\n    for {\n        _, message, err := c.ReadMessage()\n        if err != nil {\n            log.Println(\"read:\", err)\n            return\n        }\n        log.Printf(\"%s\", message)\n    }\n}()\nc.WriteMessage(websocket.TextMessage, []byte(\"\\n\")) //just to force output to console\n\nfor {\n    select {\n    case &lt;-done:\n        return\n    case &lt;-interrupt:\n        log.Println(\"interrupt\")\n\n        // Cleanly close the connection by sending a close message and then\n        // waiting (with timeout) for the server to close the connection.\n        err := c.WriteMessage(websocket.CloseMessage, websocket.FormatCloseMessage(websocket.CloseNormalClosure, \"\"))\n        if err != nil {\n            log.Println(\"write close:\", err)\n            return\n        }\n        select {\n        case &lt;-done:\n        case &lt;-time.After(time.Second):\n        }\n        return\n    }\n}\n</code></pre>\n\n<p>}</p>\n\n<p>And i get output like this:</p>\n\n<pre><code>connecting to ws://172.17.0.64:6083/?token=d1763f2b-3466-424c-aece-6aeea2a733d5\n\n\nCentOS Linux 7\n(C\nore)\nK\nerne\nl\n3.10.0-862.el7.x86_64\n o\nn an\n x\n86_64\n\ncentos\n-test login:\n</code></pre>\n\n<p>Total mess...</p>\n\n<p>I think it's because i recieve just a chunks of bytes with no way to delimit them. I need some buffer to store them and when do something like <code>bufio.ReadLine</code>. But i'm not most experienced go programmer, and i run out of ideas how to do this. At the end i just need strings to work with.</p>\n"}, {"tags": ["arrays", "sorting", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1549297049, "post_id": 54519969, "comment_id": 95843105, "body": "If you know the index it should be placed in, sure (see <a href=\"https://github.com/golang/go/wiki/SliceTricks#insert\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/SliceTricks#insert</a>). But there is no magic to keep a slice sorted while appending to it (there&#39;s little magic in Go at all, in fact.)"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1549301959, "post_id": 54519969, "comment_id": 95845604, "body": "You have a <code>[][]byte</code> you need to sort. How do you wish to sort? Lexicographically? Do you need to support UTF-8? What does ascendingly mean in this context? Do you want to sort the first or the second dimension(s)? This question is confusing."}, {"owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1549304280, "post_id": 54519969, "comment_id": 95846684, "body": "@thwd actually <code>ByteInterface</code> is sortable. The <code>[]byte</code> are hex addresses, so in alphabetical ascending order"}], "answers": [{"comments": [{"owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "edited": false, "score": 0, "creation_date": 1549304191, "post_id": 54520818, "comment_id": 95846648, "body": "Nice job. I wonder though if this extra work is worth instead of just sorting afterwards with normal sorting (<code>ByteInterface</code> is sortable).  But it answers my question so I will accept it"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "edited": false, "score": 2, "creation_date": 1549324276, "post_id": 54520818, "comment_id": 95854251, "body": "@faboolous the real question is whether or not the extra code complexity is worth whatever gains may be achieved. Or if you&#39;re willing to accept that some random dev down the line may (i.e.) decide it&#39;s a good idea to switch the first two elements of the existing slice being append-sorted to, which breaks the assumption that a sorted slice always comes out the other end if a non-empty slice is appended to."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 5, "last_activity_date": 1549299255, "creation_date": 1549299255, "answer_id": 54520818, "question_id": 54519969, "link": "https://stackoverflow.com/questions/54519969/sort-while-appending-to-slice/54520818#54520818", "title": "Sort while appending to slice?", "body": "<p>On each iteration, do the following:</p>\n\n<ol>\n<li><p>Grow the target slice (possibly reallocating it):</p>\n\n<pre><code>numElems := len(returnObj)\nreturnObj = append(returnObj, make([]byte, len(obj))...)\n</code></pre></li>\n<li><p>Use the standard approach for insertion to keep the destination sorted by finding a place to put each byte from the source slice, one by one:</p>\n\n<pre><code>for _, b := range obj {\n  i := sort.Search(numElems, func (i int) bool {\n    return returnObj[i] &gt;= b\n  }\n  if i &lt; numElems {\n    copy(returnObj[i+1:], returnObj[i:])\n  }\n  returnObj[i] = b\n  numElems++\n}\n</code></pre>\n\n<p>(The call to <code>copy</code> should be optimized by copying less but this is left as an exercise for the reader.)</p></li>\n</ol>\n"}], "owner": {"reputation": 5142, "user_id": 169252, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/f87a0e2badc0703de4d0a171a9bb4fa5?s=128&d=identicon&r=PG&f=1", "display_name": "transient_loop", "link": "https://stackoverflow.com/users/169252/transient-loop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 305, "favorite_count": 0, "accepted_answer_id": 54520818, "answer_count": 1, "score": 2, "last_activity_date": 1549299255, "creation_date": 1549296355, "last_edit_date": 1549296565, "question_id": 54519969, "link": "https://stackoverflow.com/questions/54519969/sort-while-appending-to-slice", "title": "Sort while appending to slice?", "body": "<p>I have a <code>[]byte</code> which I need to sort, in ascending order.</p>\n\n<p>I get an object with the items and then iterate the array in order to create the object returned:</p>\n\n<pre><code>// unfortunately, for some obscure reason I can't change the data types of the caller and the object from the function call are different, although both are []byte underneath (...)\n\ntype ID []byte\n// in another package:\ntype ByteInterface []byte\n\n\nfunc (c *Store) GetAll() ByteInterface {\n  returnObj := make([]ByteInterface,0)\n  obj, err := GetData()\n  // err handling\n  for _, b := range obj.IDs {\n     returnObj = append(returnObj, ByteInterface(b))\n  }\n  return returnObj\n}\n</code></pre>\n\n<p>So I'm asking myself if it is possible to do the <code>append</code> so that <code>returnObj</code> is sorted right away, or if I need to sort <code>obj.ByteData</code> upfront (or sort <code>returnOjb</code> afterwards).</p>\n"}, {"tags": ["go", "goland"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1549295621, "post_id": 54519685, "comment_id": 95842363, "body": "Did you enable dep integration? File -&gt; Settings -&gt; Go -&gt; Dep"}, {"owner": {"reputation": 21, "user_id": 5656454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f617f65bebe1ba5520459b0bd4caa26?s=128&d=identicon&r=PG&f=1", "display_name": "jappleba", "link": "https://stackoverflow.com/users/5656454/jappleba"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1549297183, "post_id": 54519685, "comment_id": 95843175, "body": "I did not, but I just upgraded to Goland 2018.3.3 and this seems to have fixed the issue."}], "owner": {"reputation": 21, "user_id": 5656454, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f617f65bebe1ba5520459b0bd4caa26?s=128&d=identicon&r=PG&f=1", "display_name": "jappleba", "link": "https://stackoverflow.com/users/5656454/jappleba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 308, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1549295438, "creation_date": 1549295438, "question_id": 54519685, "link": "https://stackoverflow.com/questions/54519685/why-is-the-vendor-file-is-not-showing-up-in-goland-even-though-it-exists", "title": "Why is the vendor File is not showing up in GoLand even though it exists?", "body": "<p>I am using GoLand for GO. I am using dep ensure for dependency management and this creates a vendor directory within the root project directory. This vendor directory exists and has the correct dependencies in it. However, GoLand IDE is not recognizing this directory and as a result the ide thinks that these dependencies are not in the project. However, I am able to build the project successfully because the folder exists, just not in the ide.</p>\n\n<pre><code>GOFLAGS=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"darwin\"\nGOOS=\"darwin\"\nGOPATH=\"/Users/japplebaum/projects\"\nGOPROXY=\"\"\nGORACE=\"\"\nGOROOT=\"/usr/local/Cellar/go/1.11.2/libexec\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/usr/local/Cellar/go/1.11.2/libexec/pkg/tool/darwin_amd64\"\nGCCGO=\"gccgo\"\nCC=\"clang\"\nCXX=\"clang++\"\nCGO_ENABLED=\"1\"\nGOMOD=\"\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/r2/y6dlsprd6kzc76kjk01vlv8h0000gn/T/go-build291641657=/tmp/go-build -gno-record-gcc-switches -fno-common\"\n</code></pre>\n\n<p>I am expecting to see the vendor folder in the IDE. Thank you in advance for any help you might be able to provide.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1549295724, "post_id": 54519662, "comment_id": 95842413, "body": "You&#39;re discarding the error returned from <code>json.Unmarshal</code>. Any time you run into a problem, make sure your&#39;e checking your errors. Also, if the quoted JSON contains real tokens, please make sure you&#39;ve invalidated them since they&#39;re now compromised."}], "answers": [{"tags": [], "owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "is_accepted": true, "score": 2, "last_activity_date": 1549296529, "last_edit_date": 1549296529, "creation_date": 1549296209, "answer_id": 54519930, "question_id": 54519662, "link": "https://stackoverflow.com/questions/54519662/json-decoding-unmarshalling-not-working-as-expected-in-json/54519930#54519930", "title": "json decoding/unmarshalling not working as expected in json", "body": "<p>You have to check error from <code>json.Unmarshal</code> or from <code>decoder.Decode</code>.\n<br>And <code>\"expires_in\": 299,</code> it is not time, it is int.</p>\n\n<p>code:</p>\n\n<pre><code>package main\n\nimport (\n  \"encoding/json\"\n  \"fmt\"\n  \"net/http\"\n)\n\ntype Token struct {\n  AccessToken  string    `json:\"access_token\"`\n  TokenType    string    `json:\"token_type\"`\n  RefreshToken string    `json:\"refresh_token\"`\n  Expiry       int       `json:\"expires_in\"`\n}\n\nfunc main() {\n  http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    decoder := json.NewDecoder(r.Body)\n    var authToken Token\n    if err := decoder.Decode(&amp;authToken); err != nil {\n      fmt.Fprintf(w, \"error: %s\", err)\n      return\n    }\n\n    fmt.Println(\"-------------------- accessToken \" + authToken.AccessToken)\n    fmt.Println(\"-------------------- refreshToken \" + authToken.RefreshToken)\n    fmt.Println(\"-------------------- expires \", authToken.Expiry)\n    fmt.Println(\"--------------------  type \" + authToken.TokenType)\n  })\n\n  http.ListenAndServe(\":8000\", nil)\n}\n</code></pre>\n\n<p>curl:</p>\n\n<pre><code>curl -XPOST 'http://localhost:8000' -H 'Content-Type: application/json' -d '{\n  \"access_token\": \"at\",\n  \"refresh_token\": \"rt\",\n  \"expires_in\": 299,\n  \"token_type\": \"bearer\"\n}'\n</code></pre>\n\n<p>result:</p>\n\n<pre><code>-------------------- accessToken at\n-------------------- refreshToken rt\n-------------------- expires  299\n--------------------  type bearer\n</code></pre>\n"}], "owner": {"reputation": 2547, "user_id": 6387370, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/CpJXI.png?s=128&g=1", "display_name": "zakaria amine", "link": "https://stackoverflow.com/users/6387370/zakaria-amine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 54519930, "answer_count": 1, "score": 0, "last_activity_date": 1549296529, "creation_date": 1549295341, "question_id": 54519662, "link": "https://stackoverflow.com/questions/54519662/json-decoding-unmarshalling-not-working-as-expected-in-json", "title": "json decoding/unmarshalling not working as expected in json", "body": "<p>I have an authentication payload that I need to decode to obtain some tokens in  a webapp:</p>\n\n<pre><code>{\n    \"access_token\": \"eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJzUG9sQmV3Z2ZBMGxHbFdzTnZLNEVndGJ1WHhnOU90dVhXeFRVbWhKeF9NIn0.eyJqdGkiOiJkMjAzOWQ0ZC00NjEwLTQ2ZmMtYjE5NC03Nzc4YWJhZGE1YmYiLCJleHAiOjE1NDkyOTQyMjUsIm5iZiI6MCwiaWF0IjoxNTQ5MjkzOTI1LCJpc3MiOiJodHRwOi8vMTkyLjE2OC45OS4xMDA6OTAvYXV0aC9yZWFsbXMvc2FtcGxlc2hvcCIsImF1ZCI6ImFjY291bnQiLCJzdWIiOiJkYWU0NjE1OC03ZjQ2LTQ0N2UtOGZmMC0xNWIxNzEyZGY1NWIiLCJ0eXAiOiJCZWFyZXIiLCJhenAiOiJmcm9udGVuZCIsImF1dGhfdGltZSI6MTU0OTI5MzkyNSwic2Vzc2lvbl9zdGF0ZSI6IjY2YjNkNjJkLWIzYzYtNDJiYi04Njc5LWYwZGVkMGU3ODk1NyIsImFjciI6IjEiLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsib2ZmbGluZV9hY2Nlc3MiLCJ1bWFfYXV0aG9yaXphdGlvbiJdfSwicmVzb3VyY2VfYWNjZXNzIjp7ImFjY291bnQiOnsicm9sZXMiOlsibWFuYWdlLWFjY291bnQiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6Im9wZW5pZCBlbWFpbCBwcm9maWxlIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJuYW1lIjoidGVzdGVyIHRlc3RlciIsInByZWZlcnJlZF91c2VybmFtZSI6InRlc3RlckB0ZXN0ZXIuY29tIiwiZ2l2ZW5fbmFtZSI6InRlc3RlciIsImZhbWlseV9uYW1lIjoidGVzdGVyIiwiZW1haWwiOiJ0ZXN0ZXJAdGVzdGVyLmNvbSJ9.A8mdTXpANdTn_n3k-6peoIy2p9RmAakA7hxF0aTtCYk_FrpP8GC4Eg4sE2TgSzSzKGSVbEbp3zJkT6v8MVPv721rqYir99uJ-gLv48P83WFEAu93Gf315CSXBi4wSsph-vahOhI75BwPYteZdD9CJJUnbt53fuxfwjimJZW9zqyWBc8CZZ--7oxScgXJb8rJEMFlm4uA0WOCPw9TelPBZE7wxmyaibU6DKZqQlKsC14wPFi8-URGhL2ZG2n21kz58nsLcRiBLiGAwDSWakKuFTWgc6M_Pfu8tF6mQ2FWWMHwIN8aOc_OZ6gvyFsdY0v2BxRd1Agta8KopM3IpMsa6w\",\n    \"expires_in\": 299,\n    \"refresh_expires_in\": 1799,\n    \"refresh_token\": \"eyJhbGciOiJIUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJlM2ZmYTkxZi05NGJiLTQzMWMtYWY4YS05MTgyMmU1MjBjZWMifQ.eyJqdGkiOiJjM2ZjMTRhMy0xODA2LTRkYzgtYjZjZi01MTI1NTg1NWFiYzMiLCJleHAiOjE1NDkyOTU3MjUsIm5iZiI6MCwiaWF0IjoxNTQ5MjkzOTI1LCJpc3MiOiJodHRwOi8vMTkyLjE2OC45OS4xMDA6OTAvYXV0aC9yZWFsbXMvc2FtcGxlc2hvcCIsImF1ZCI6Imh0dHA6Ly8xOTIuMTY4Ljk5LjEwMDo5MC9hdXRoL3JlYWxtcy9zYW1wbGVzaG9wIiwic3ViIjoiZGFlNDYxNTgtN2Y0Ni00NDdlLThmZjAtMTViMTcxMmRmNTViIiwidHlwIjoiUmVmcmVzaCIsImF6cCI6ImZyb250ZW5kIiwiYXV0aF90aW1lIjowLCJzZXNzaW9uX3N0YXRlIjoiNjZiM2Q2MmQtYjNjNi00MmJiLTg2NzktZjBkZWQwZTc4OTU3IiwicmVhbG1fYWNjZXNzIjp7InJvbGVzIjpbIm9mZmxpbmVfYWNjZXNzIiwidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50Iiwidmlldy1wcm9maWxlIl19fSwic2NvcGUiOiJvcGVuaWQgZW1haWwgcHJvZmlsZSJ9.XCvoZnyrVeGGF4iORaQ_1BAlKyma9B0DENw1n1E6I_8\",\n    \"token_type\": \"bearer\",\n    \"id_token\": \"eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJzUG9sQmV3Z2ZBMGxHbFdzTnZLNEVndGJ1WHhnOU90dVhXeFRVbWhKeF9NIn0.eyJqdGkiOiIyODM3YzRmOS1iNmYwLTQwZjktYTZiNy1jMDBiMTk3M2M4ODYiLCJleHAiOjE1NDkyOTQyMjUsIm5iZiI6MCwiaWF0IjoxNTQ5MjkzOTI1LCJpc3MiOiJodHRwOi8vMTkyLjE2OC45OS4xMDA6OTAvYXV0aC9yZWFsbXMvc2FtcGxlc2hvcCIsImF1ZCI6ImZyb250ZW5kIiwic3ViIjoiZGFlNDYxNTgtN2Y0Ni00NDdlLThmZjAtMTViMTcxMmRmNTViIiwidHlwIjoiSUQiLCJhenAiOiJmcm9udGVuZCIsImF1dGhfdGltZSI6MTU0OTI5MzkyNSwic2Vzc2lvbl9zdGF0ZSI6IjY2YjNkNjJkLWIzYzYtNDJiYi04Njc5LWYwZGVkMGU3ODk1NyIsImFjciI6IjEiLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsIm5hbWUiOiJ0ZXN0ZXIgdGVzdGVyIiwicHJlZmVycmVkX3VzZXJuYW1lIjoidGVzdGVyQHRlc3Rlci5jb20iLCJnaXZlbl9uYW1lIjoidGVzdGVyIiwiZmFtaWx5X25hbWUiOiJ0ZXN0ZXIiLCJlbWFpbCI6InRlc3RlckB0ZXN0ZXIuY29tIn0.kKIpxriAXWiySz9xOmr_XHmMgz7_L0q-qgt0WHb8yFRSdrPFePRqoe_RKnxtxwn6nIGOYbY78djr9GMtMpAcJquumpHpo3RGG1o5Y088rft4A7NNvUwDJeZhx6DkeVq5FfL0hvNfUntfUvtQaaVYh4M6TjJo6nakyJ1ZSyrRwSZZmNXzd0S4XY3oV19DOiyrLl3qBxhgw33pLYla5dIAs_KnrGVmLSpNJT61T810kqN-dT1c4EFMZ1iz7Bfh4RucK4oHGZmPlR3znqMMijirK8QT7ukTJvhG-TlmfsBMe0r_9UjdQ9wxjZ7pDi7pfYKVOv55O9Lzk2PbAjIHe3UKiA\",\n    \"not-before-policy\": 1549293916,\n    \"session_state\": \"66b3d62d-b3c6-42bb-8679-f0ded0e78957\",\n    \"scope\": \"openid email profile\"\n}\n</code></pre>\n\n<p>The struct I am using is as follow: </p>\n\n<pre><code>type Token struct {\n    AccessToken  string    `json:\"access_token\"`\n    TokenType    string    `json:\"token_type\"`\n    RefreshToken string    `json:\"refresh_token\"`\n    Expiry       time.Time `json:\"expires_in\"`\n}\n</code></pre>\n\n<p>After decoding the response, I tried printing the response :</p>\n\n<pre><code>var authToken Token\njson.Unmarshal(response.Body, &amp;authToken)\n\n        fmt.Println(\"-------------------- accessToken \" + authToken.AccessToken)\n        fmt.Println(\"-------------------- refreshToken \" + authToken.RefreshToken)\n        fmt.Println(\"-------------------- expires \", authToken.Expiry)\n        fmt.Println(\"--------------------  type \" + authToken.TokenType)\n</code></pre>\n\n<p>Only the first one AccessToken has a value, everything else is empty. </p>\n\n<p>I also tried using <code>json.NewDecoder(response.Body).Decode(&amp;authToken)</code></p>\n\n<p>Same result. </p>\n\n<p>Is there anything wrong with my approach ? </p>\n"}, {"tags": ["go", "slice", "allocation", "indexoutofrangeexception"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1549291353, "post_id": 54518443, "comment_id": 95839800, "body": "A <code>map[int]</code> is probably a better choice than a sparsely-populated slice, for various reasons."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1549291525, "post_id": 54518443, "comment_id": 95839921, "body": "There are no sparse slices (or arrays) in Go. You must redesign."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1549292429, "post_id": 54518482, "comment_id": 95840515, "body": "I would probably make the new slice and copy the old into it. It&#39;s just as readable, and while the compiler <i>might</i> recognize that the <code>make</code> in the <code>append</code> isn&#39;t needed, I wouldn&#39;t count on it."}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1549312980, "post_id": 54518482, "comment_id": 95850521, "body": "@JimB: Fair enough. For the record I took this snippet from <a href=\"https://github.com/golang/go/wiki/SliceTricks#extend\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/SliceTricks#extend</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1549313633, "post_id": 54518482, "comment_id": 95850752, "body": "Yeah, IMO some of those &quot;tricks&quot; try a little too hard to make on-liners. It&#39;s not incorrect, and probably makes no difference for small slices, but it&#39;s worth noting."}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 2, "last_activity_date": 1549291157, "creation_date": 1549291157, "answer_id": 54518482, "question_id": 54518443, "link": "https://stackoverflow.com/questions/54518443/what-is-the-idiomatic-way-in-go-to-write-by-index-to-an-out-of-index-element-i/54518482#54518482", "title": "What is the idiomatic way in go to write (by index) to an out of index element in a slice?", "body": "<p>You'd need to check if <code>x</code> is outside the slice's range and extend the slice if it is (append zeros or something like that). There are no magic shortcuts. To \"extend\" a slice you can do:</p>\n\n<pre><code>a = append(a, make([]T, j)...)\n</code></pre>\n\n<p>Where <code>a</code> is the slice, <code>T</code> is the type of its contents and <code>j</code> is by how much you want to extend it.</p>\n"}], "owner": {"reputation": 127, "user_id": 11012871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a7b1879b3b70c17a332c28aff2c15bb6?s=128&d=identicon&r=PG&f=1", "display_name": "S. Melted", "link": "https://stackoverflow.com/users/11012871/s-melted"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 54518482, "answer_count": 1, "score": -4, "last_activity_date": 1551801537, "creation_date": 1549290998, "last_edit_date": 1551801537, "question_id": 54518443, "link": "https://stackoverflow.com/questions/54518443/what-is-the-idiomatic-way-in-go-to-write-by-index-to-an-out-of-index-element-i", "title": "What is the idiomatic way in go to write (by index) to an out of index element in a slice?", "body": "<p>Suppose I have a sparsely populated slice and want to read/write to an element by index that may or may not be outside the capacity of the slice.</p>\n\n<p>What is the idiomatic way of writing to s[x] when x may exceed the capacity?</p>\n"}, {"tags": ["go", "events", "channels"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1549286920, "post_id": 54517080, "comment_id": 95837063, "body": "<i>&quot;Is it a problem that each worker queue uses the same demoHandler?&quot;</i> if they are used in a read-only fashion, then no. If you&#39;re also writing (ie setting the handler&#39;s fields) then you should use a mutex from the <code>sync</code> package to avoid possible race conditions."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1549288051, "post_id": 54517080, "comment_id": 95837728, "body": "After the problem appears, send the process a SIGQUIT to dump the goroutine stacks.  That should help pinpoint where the program is blocked. I suspect that you will find goroutiens blocked on <code>worker := &lt;-queue</code>.  I am having trouble understanding the purpose of some of the code.  If you are still stuck, it will be helpful to update the question to describe in words the purpose of the code."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1549291534, "post_id": 54517080, "comment_id": 95839930, "body": "&quot;Don&#39;t communicate by sharing memory, share memory by communicating.&quot; I.e., doesn&#39;t have multiple goroutines read the same memory, have them notify each other via channels of information that they need."}], "answers": [{"tags": [], "owner": {"reputation": 41, "user_id": 10868780, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WOv28xJ33iI/AAAAAAAAAAI/AAAAAAAAAHA/crx1LAvpxsQ/photo.jpg?sz=128", "display_name": "Carlos Fuentes", "link": "https://stackoverflow.com/users/10868780/carlos-fuentes"}, "is_accepted": false, "score": 0, "last_activity_date": 1549297779, "creation_date": 1549297779, "answer_id": 54520402, "question_id": 54517080, "link": "https://stackoverflow.com/questions/54517080/in-a-go-worker-event-system-should-workers-access-the-same-struct-via-pointer/54520402#54520402", "title": "In a go worker/event system, should workers access the same struct (via pointer) to do work?", "body": "<p>\"In a go worker/event system, should workers access the same struct (via pointer) to do work?\"\nNo, it's not a problem. It would be a problem if the code inside your handler access a <a href=\"https://en.wikipedia.org/wiki/Critical_section\" rel=\"nofollow noreferrer\">critical section</a>, but I think that's not causing your program to block.</p>\n\n<p>Your server doesn't crash or block either because no panic is being triggered, and your program is listening and executing on separate goroutines, which are lightweight threads of execution.</p>\n\n<p>It probably has to be with the channels you are using to send and receive events.</p>\n\n<p>Sends and receives to a <a href=\"https://tour.golang.org/concurrency/2\" rel=\"nofollow noreferrer\">channel</a> are blocking by default. This means that when you send or receive from a channel it will block its goroutine until the other side is ready.</p>\n\n<p>In the case of <a href=\"https://tour.golang.org/concurrency/3\" rel=\"nofollow noreferrer\">buffered channels</a>, sends block when the buffer is full, and receives block when the buffer is empty, as in your stream channel:</p>\n\n<pre><code>var stream = make(chan *Event, 100)\n</code></pre>\n\n<p>You said: \"After around 100 events have been triggered the listeners stop getting called when events are published\".</p>\n\n<p>So if you call the Publish function and do <code>stream &lt;- ev</code> when the \"stream\" channel buffer is full, it will block until the channel has place to receive another element.</p>\n\n<p>I'd suggest reading a bit about <a href=\"https://gobyexample.com/non-blocking-channel-operations\" rel=\"nofollow noreferrer\">non-blocking channel operations</a>.</p>\n\n<p>Maybe the block is occurring in some part of your real usage code.</p>\n"}], "owner": {"reputation": 9, "user_id": 11012001, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f8493ee670aee8ba562dff4982edc10?s=128&d=identicon&r=PG&f=1", "display_name": "pepperallday", "link": "https://stackoverflow.com/users/11012001/pepperallday"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 160, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549297779, "creation_date": 1549286572, "question_id": 54517080, "link": "https://stackoverflow.com/questions/54517080/in-a-go-worker-event-system-should-workers-access-the-same-struct-via-pointer", "title": "In a go worker/event system, should workers access the same struct (via pointer) to do work?", "body": "<p>I'm a beginner gopher, and I wrote an event listener worker queue for a project I'm working on.</p>\n\n<p>I've deployed it on a staging server. After around 100 events have been triggered the listeners stop getting called when events are published. The server hasn't crashed either.</p>\n\n<p>Here is my implementation:</p>\n\n<pre><code>// Event struct \ntype Event struct {\n  Name string\n  Data interface{}\n}\n\n// Stream to publish events to\nvar stream = make(chan *Event, 100)\n\n// Publish sends new event data to the stream by the event name\nfunc Publish(name string, data interface{}) {\n  ev := &amp;Event{name, data}\n  stream &lt;- ev\n}\n\n// Handler provides the interface for all event handlers.\n// The Work will be called with the event that it should process\ntype Handler interface {\n  Work(*Event)\n}\n\ntype worker struct {\n  Handler\n  Listen chan *Event\n  Quit   chan bool\n}\n\n// Stop shuts down the worker\nfunc (w *worker) Stop() {\n  go func() {\n    w.Quit &lt;- true\n  }()\n}\n\n// Queue of worker Listen channels\ntype workerQueue chan chan *Event\n\n// registry of workers\nvar registry = make(map[string][]workerQueue)\n\n// Register creates 20 workers, assigns them to a queue, and \n// appends the resulting worker queue to an event on the handler registry\nfunc Register(name string, handlers ...Handler) {\n  if _, ok := registry[name]; !ok {\n    registry[name] = make([]workerQueue, 0)\n  }\n\n  // Create workerQueues for each handler\n  for _, h := range handlers {\n    queue := make(workerQueue, numListeners)\n\n    // Create 20 workers\n    for i := 0; i &lt; 20; i++ {\n      newWorker := worker{\n        Handler: h,\n        Listen:  make(chan *Event),\n        Quit:    make(chan bool),\n      }\n\n      go func() {\n        for {\n          select {\n          case ev := &lt;-newWorker.Listen:\n            nl.Work(ev)\n          case &lt;-newWorker.Quit:\n            return\n          }\n        }\n      }()\n\n      queue &lt;- newWorker.Listen\n    }\n\n    registry[name] = append(registry[name], queue)\n  }\n}\n\n// Start begins listening for events on stream\nfunc Start() {\n  go func() {\n    for {\n      select {\n      // listen for events\n      case ev := &lt;-stream:\n        go func() {\n          // get registered queues for the event\n          queues, ok := registry[ev.Name]\n\n          if !ok {\n            return\n          }\n\n          // Get worker channel from queue and send the event\n          for _, queue := range queues {\n            worker := &lt;-queue\n            worker &lt;- ev\n          }\n        }()\n      }\n    }\n  }()\n}\n</code></pre>\n\n<p>Here is an example usage. </p>\n\n<pre><code>// Usage\n\nStart()\n\ntype demoHandler struct {\n  db *sql.DB\n}\n\ntype eventData struct {}\n\nfunc (h *demoHandler) Work(ev *Event) {\n  // Do something\n  return\n}\n\n// Register handler\nRegister('some-event', &amp;demoHandler{r})\n\nPublish('some-event', &amp;eventData{})\n</code></pre>\n\n<p>I'm passing a pointer to a demoHandler as the event handler because they need access to the underlying sql instance. Is it a problem that each worker queue uses the same demoHandler? </p>\n\n<p>I can't for the life of me figure out where I went wrong! Short of an error in the handler code, is there a mistake in my code which causes all of my workers to go down?</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "answers": [{"comments": [{"owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "edited": false, "score": 0, "creation_date": 1549288696, "post_id": 54517078, "comment_id": 95838131, "body": "Mostly it means we need proto2 for our use-case. Thanks"}], "tags": [], "owner": {"reputation": 921791, "user_id": 23354, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/CrVFH.png?s=128&g=1", "display_name": "Marc Gravell", "link": "https://stackoverflow.com/users/23354/marc-gravell"}, "is_accepted": true, "score": 3, "last_activity_date": 1549287147, "last_edit_date": 1549287147, "creation_date": 1549286569, "answer_id": 54517078, "question_id": 54516940, "link": "https://stackoverflow.com/questions/54516940/protocol-buffer-zero-value-for-integer/54517078#54517078", "title": "Protocol buffer zero value for integer", "body": "<p><code>proto3</code> doesn't distinguish between zero and absent; the concepts of defaults and implicit vs explicit values disappeared:</p>\n\n<ul>\n<li>the default value is always zero (or false, etc)</li>\n<li>if the value is zero, it isn't sent; otherwise, it is</li>\n</ul>\n\n<p>What you're after is more possible with <code>proto2</code>. Alternatively, just add a <em>separate</em> field to indicate that you have a value for something:</p>\n\n<pre class=\"lang-proto prettyprint-override\"><code>message Req {\n    int amount = 1;\n    bool amountHasValue = 2;\n}\n</code></pre>\n\n<p>Or use a nested sub-message, i.e.</p>\n\n<pre class=\"lang-proto prettyprint-override\"><code>message Foo {\n    Bar bar = 1;\n}\nmessage Bar {\n    int amount = 1;\n}\n</code></pre>\n\n<p>(so; without a value you <em>just</em> send a <code>Foo</code>; with a value, you send a <code>Foo</code> with a <code>Bar</code>, and whatever the <code>amount</code> is: it is)</p>\n"}], "owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 749, "favorite_count": 0, "accepted_answer_id": 54517078, "answer_count": 1, "score": 1, "last_activity_date": 1549287147, "creation_date": 1549286027, "question_id": 54516940, "link": "https://stackoverflow.com/questions/54516940/protocol-buffer-zero-value-for-integer", "title": "Protocol buffer zero value for integer", "body": "<p>I have a Go struct what we are using currently in our restful API which looks like this:</p>\n\n<pre><code>type Req struct {\n  Amount *int\n}\n</code></pre>\n\n<p>I'm using pointer here, because if the Amount is nil, it means the <code>Amount</code> was not filled, if the Amount isn't nil, but it's zero, it means the field was filled, but the value is zero. </p>\n\n<p>When we started to change to protofiles and we want to use it like, the main API get's the request as HTTP API and send it to the next service through gRPC with the same protofile I faced with the issue, the <code>proto3</code> can't generate pointer for the Amount. That's fine because the protocol buffers designed for the purpose of sending data between separated systems, but how can I handle the issue above, because if I get the request I can't decide that the Amount is nil or just zero. </p>\n"}, {"tags": ["database", "go", "database-design", "leveldb"], "comments": [{"owner": {"reputation": 8470, "user_id": 538866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb67b45ca1dc2584f8e4d703d009177b?s=128&d=identicon&r=PG", "display_name": "Jonas G. Drange", "link": "https://stackoverflow.com/users/538866/jonas-g-drange"}, "edited": false, "score": 0, "creation_date": 1549349561, "post_id": 54515752, "comment_id": 95859696, "body": "LevelDB is probably already implemented using some tree. You should simply create you secondary index by having email as a key, and the user&#39;s UUID as a value. This way you can probably retrieve quickly and efficiently."}, {"owner": {"reputation": 1563, "user_id": 1619003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wKhdR.png?s=128&g=1", "display_name": "GraphicalDot", "link": "https://stackoverflow.com/users/1619003/graphicaldot"}, "reply_to_user": {"reputation": 8470, "user_id": 538866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb67b45ca1dc2584f8e4d703d009177b?s=128&d=identicon&r=PG", "display_name": "Jonas G. Drange", "link": "https://stackoverflow.com/users/538866/jonas-g-drange"}, "edited": false, "score": 0, "creation_date": 1549352672, "post_id": 54515752, "comment_id": 95860929, "body": "That&#39;s exactly  what I have done,  I created a new key,  and stored a map of email uuid against it and then stored it on the same leveldb."}, {"owner": {"reputation": 8470, "user_id": 538866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb67b45ca1dc2584f8e4d703d009177b?s=128&d=identicon&r=PG", "display_name": "Jonas G. Drange", "link": "https://stackoverflow.com/users/538866/jonas-g-drange"}, "edited": false, "score": 0, "creation_date": 1549353312, "post_id": 54515752, "comment_id": 95861198, "body": "Sorry, that&#39;s not what I meant. Given a user <code>A</code> with UUID <code>abba-cafe</code> and e-mail <code>A@example.org</code>, you store <code>abba-cafe</code> as a direct value on the key <code>A@example.org</code>. You should not store a map."}, {"owner": {"reputation": 1563, "user_id": 1619003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wKhdR.png?s=128&g=1", "display_name": "GraphicalDot", "link": "https://stackoverflow.com/users/1619003/graphicaldot"}, "reply_to_user": {"reputation": 8470, "user_id": 538866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb67b45ca1dc2584f8e4d703d009177b?s=128&d=identicon&r=PG", "display_name": "Jonas G. Drange", "link": "https://stackoverflow.com/users/538866/jonas-g-drange"}, "edited": false, "score": 0, "creation_date": 1549355771, "post_id": 54515752, "comment_id": 95862264, "body": "Ok Thanks a lot Jonas ..."}], "answers": [{"tags": [], "owner": {"reputation": 1772, "user_id": 4706119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e597fc1530bb59898a572f5625417851?s=128&d=identicon&r=PG&f=1", "display_name": "hutabalian", "link": "https://stackoverflow.com/users/4706119/hutabalian"}, "is_accepted": true, "score": 1, "last_activity_date": 1549443617, "creation_date": 1549443617, "answer_id": 54549840, "question_id": 54515752, "link": "https://stackoverflow.com/questions/54515752/secondary-index-on-key-value-database/54549840#54549840", "title": "Secondary Index on Key/Value database", "body": "<blockquote>\n  <p>Is it right to store secondary index data in the Database itself</p>\n</blockquote>\n\n<p>Yes, this is okay. But as pointed out by Jonas in the comment, you should put the email as key and UUID as value. Another option is to use email as the key for your database instead of using UUID. This way you don't need to use a secondary index. </p>\n\n<p>Another strategy for better performance, you can use in-memory databases such as Redis (or maybe LevelDB itself can be used to store the data in memory) to store the secondary index (email as key and UUID as value). </p>\n\n<blockquote>\n  <p>Are there any good out of box indexing algorithms other than B-Tree, HashMaps</p>\n</blockquote>\n\n<p>Anyway, B-Tree and HashMap are data structures, not algorithms. And what you did actually is not indexing with HashMap, it's just storing HashMaps as values for your key. Indexing usually depends on the DBMS implementation (we can only choose from the options they provided).</p>\n\n<p>So, about the data structures used for indexing, whether it's good or not, really depends on the use cases. For example, if you need to do range search you can use B-Tree (used by default by most of the DBMSs), B+ tree (used by default by MySQL InnoDB), and Skip List (Redis use this data structure for its Sorted Set). You can read more about secondary indexing with Redis Sorted Set <a href=\"https://redis.io/topics/indexes\" rel=\"nofollow noreferrer\">here</a>. </p>\n\n<p>And for your case, you only need to store email as key and UUID as value. Hash Table is commonly used for this. Most of the DBMSs use this data structure to do primary key access with just O(1) time complexity. And I believe LevelDB implementation is also based on this data structure. </p>\n"}], "owner": {"reputation": 1563, "user_id": 1619003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wKhdR.png?s=128&g=1", "display_name": "GraphicalDot", "link": "https://stackoverflow.com/users/1619003/graphicaldot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1070, "favorite_count": 0, "accepted_answer_id": 54549840, "answer_count": 1, "score": 1, "last_activity_date": 1567828201, "creation_date": 1549282002, "last_edit_date": 1549304882, "question_id": 54515752, "link": "https://stackoverflow.com/questions/54515752/secondary-index-on-key-value-database", "title": "Secondary Index on Key/Value database", "body": "<p>Lets say, I have  data structure like </p>\n\n<pre><code> type User struct {\n      UUid string \n      Username string\n      Email String \n      Password string \n      FirstName string \n      LastName string\n}\n</code></pre>\n\n<p>I am storing Users []User into a key/value database in levelDB. The unique key will be UUid and then user struct will be endoed and stored against this UUID.</p>\n\n<pre><code>var network bytes.Buffer // Stand-in for a network connection\nenc := gob.NewEncoder(&amp;network)\nerr := enc.Encode(user)\n   if err != nil {\n      log.Println(\"Error in encoding gob\")\n      return \"\", err\n }\nerr = dbSession.DBSession.Put([]byte(user.UserID), network.Bytes(), nil)\n</code></pre>\n\n<p>Since the key for all the entries is the unique uuid, I want to make a secondary index on email so that I dont necessarily have to scan all the entries present in the database to find a particular entry corresponding to an Email.</p>\n\n<p>What I have Done:\nI have created a key called as SIndex and stored a map[string][string] data structure in it, where a key will be an email and value will be the uuid. Every time a new entry comes in, This Sindex will be updated to acommodate  the new uuid and email.</p>\n\n<p>Its a bad approach: \nBecause as data grows, Whole map corresponding to Sindex needs to be fetched and decoded, If email doesn't exists, add a new key to Sindex, encode it and store back again. </p>\n\n<p>A B-tree would be a better fit. </p>\n\n<p>My question : Is it right to store secondary index data in the Database itself, if not what strategies shall I use to implement a secondary Index, I know the choice of secondary index greatly influenced by the data but Are there any good out of box indexing algorithms other than B-Tree, HashMaps?</p>\n"}, {"tags": ["go", "types"], "comments": [{"owner": {"reputation": 6020, "user_id": 7199668, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/e47d89b0ada41bf07a3d80b0002f0386?s=128&d=identicon&r=PG&f=1", "display_name": "mast3rd3mon", "link": "https://stackoverflow.com/users/7199668/mast3rd3mon"}, "edited": false, "score": 3, "creation_date": 1549281686, "post_id": 54515646, "comment_id": 95834176, "body": "why doesnt javascript have number types? its a difference between languages"}, {"owner": {"reputation": 46235, "user_id": 2541573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Z1qtP.png?s=128&g=1", "display_name": "jub0bs", "link": "https://stackoverflow.com/users/2541573/jub0bs"}, "edited": false, "score": 0, "creation_date": 1549281714, "post_id": 54515646, "comment_id": 95834196, "body": "Related: <a href=\"https://stackoverflow.com/q/45158059/2541573\">stackoverflow.com/q/45158059/2541573</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 7, "creation_date": 1549281791, "post_id": 54515646, "comment_id": 95834239, "body": "What is a <code>long</code> number type? Is it something like Java&#39;s <code>long</code>? Then its equivalent is <code>int64</code>. Are you talking about arbitrary precision? For that there is <a href=\"https://golang.org/pkg/math/big/#Int\" rel=\"nofollow noreferrer\"><code>big.Int</code></a>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1549284460, "post_id": 54515646, "comment_id": 95835751, "body": "What do you need a <code>long</code> type for?"}, {"owner": {"reputation": 5906, "user_id": 198825, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/aba9dac582a7e4346b1895366200e2f2?s=128&d=identicon&r=PG", "display_name": "noamt", "link": "https://stackoverflow.com/users/198825/noamt"}, "edited": false, "score": 0, "creation_date": 1549288491, "post_id": 54515646, "comment_id": 95837996, "body": "Just out of curiosity in language design. So many downvotes. Didn&#39;t realize this question would be such a PITA for everyone"}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 4, "creation_date": 1549288709, "post_id": 54515646, "comment_id": 95838141, "body": "Note that <code>long</code> is a historic name originally used when extended bit-width of registers became available. In some C models like ILP32 longs are the same size as ints (32 bits), and in some they&#39;re different (LP64). Go uses the much more modern explicit-bit-width specification with int32, int64 etc"}, {"owner": {"reputation": 5906, "user_id": 198825, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/aba9dac582a7e4346b1895366200e2f2?s=128&d=identicon&r=PG", "display_name": "noamt", "link": "https://stackoverflow.com/users/198825/noamt"}, "reply_to_user": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 0, "creation_date": 1549288763, "post_id": 54515646, "comment_id": 95838171, "body": "Great explanation, @EliBendersky . Would have accepted this as an answer"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1549292249, "post_id": 54515646, "comment_id": 95840393, "body": "It has the same types, it just has more intuitive  names for short, long, etc. based on their bit width."}], "answers": [{"tags": [], "owner": {"reputation": 191, "user_id": 9870721, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Eitam Ring", "link": "https://stackoverflow.com/users/9870721/eitam-ring"}, "is_accepted": true, "score": 4, "last_activity_date": 1549286741, "last_edit_date": 1549286741, "creation_date": 1549281792, "answer_id": 54515702, "question_id": 54515646, "link": "https://stackoverflow.com/questions/54515646/language-design-no-long-number-type/54515702#54515702", "title": "Language Design - No long number type?", "body": "<p>There is no need for long</p>\n\n<p>in c# for example long represent Signed 64-bit integer</p>\n\n<p>Just use int64</p>\n\n<p>int{8,16,32,64}\u200a\u2014\u200aSigned integers of 8,16,32,64 bit in size (int32, int64, etc)</p>\n\n<p>Another thing  mast3rd3mon pointed out : Javascript does not even have number types.</p>\n\n<p>in most languages long provide a Signed 64-bit integer , so go provide you this tool by using int64.\nThe name should not matter to you, only his value type.</p>\n"}], "owner": {"reputation": 5906, "user_id": 198825, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/aba9dac582a7e4346b1895366200e2f2?s=128&d=identicon&r=PG", "display_name": "noamt", "link": "https://stackoverflow.com/users/198825/noamt"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "closed_date": 1549293738, "accepted_answer_id": 54515702, "answer_count": 1, "score": -12, "last_activity_date": 1549288692, "creation_date": 1549281594, "last_edit_date": 1549288692, "question_id": 54515646, "link": "https://stackoverflow.com/questions/54515646/language-design-no-long-number-type", "closed_reason": "Opinion-based", "title": "Language Design - No long number type?", "body": "<p>Go has the following numeric types:\n<code>int</code> <code>int8</code> <code>int16</code> <code>int32</code> <code>int64</code> <code>uint</code> <code>uint8</code> <code>uint16</code> <code>uint32</code> <code>uint64</code>.</p>\n\n<p>Why doesn't Go have a <code>long</code> number type?</p>\n"}, {"tags": ["database", "go", "database-design", "leveldb"], "answers": [{"tags": [], "owner": {"reputation": 2953, "user_id": 1805397, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BPHyG.jpg?s=128&g=1", "display_name": "wouter bolsterlee", "link": "https://stackoverflow.com/users/1805397/wouter-bolsterlee"}, "is_accepted": true, "score": 1, "last_activity_date": 1554213477, "creation_date": 1554213477, "answer_id": 55476656, "question_id": 54515332, "link": "https://stackoverflow.com/questions/54515332/auto-adjusting-leveldb-disk-space/55476656#55476656", "title": "Auto adjusting levelDB disk space?", "body": "<p>LevelDB compacts SST files in a background thread while the database grows. Since these files are immutable, this works by creating new ones, and then removing the old ones. Hence, this \u2018compaction\u2019\u00a0step requires (temporarily) extra disk space.</p>\n"}], "owner": {"reputation": 1563, "user_id": 1619003, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wKhdR.png?s=128&g=1", "display_name": "GraphicalDot", "link": "https://stackoverflow.com/users/1619003/graphicaldot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 55476656, "answer_count": 1, "score": 0, "last_activity_date": 1554213477, "creation_date": 1549280378, "last_edit_date": 1549280751, "question_id": 54515332, "link": "https://stackoverflow.com/questions/54515332/auto-adjusting-leveldb-disk-space", "title": "Auto adjusting levelDB disk space?", "body": "<p>I am using Go to store keys/values in the levelDB database. While i am inserting new key/values in the LevelDB, I checked the disk space used by leveldbfile Folder, it increases and then decreases in cycles.</p>\n\n<pre><code>  \u279c  loomio git:(master) \u2717 du -h leveldbfile\n  7.4M  leveldbfile\n  \u279c  loomio git:(master) \u2717 du -h leveldbfile\n  1.2M  leveldbfile\n  \u279c  loomio git:(master) \u2717 du -h leveldbfile\n  8.3M  leveldbfile\n  \u279c  loomio git:(master) \u2717 du -h leveldbfile\n  8.4M  leveldbfile\n  \u279c  loomio git:(master) \u2717 du -h leveldbfile\n  6.0M  leveldbfile\n  \u279c  loomio git:(master) \u2717 du -h leveldbfile\n  3.6M  leveldbfile\n  \u279c  loomio git:(master) \u2717 du -h leveldbfile\n   11M  leveldbfile\n  \u279c  loomio git:(master) \u2717 du -h leveldbfile\n   10M  leveldbfile\n  \u279c  loomio git:(master) \u2717 du -h leveldbfile\n  3.7M  leveldbfile\n  \u279c  loomio git:(master) \u2717 du -h leveldbfile\n  1.2M  leveldbfile\n  \u279c  loomio git:(master) \u2717 du -h leveldbfile\n  8.3M  leveldbfile\n  \u279c  loomio git:(master) \u2717 du -h leveldbfile\n  6.0M  leveldbfile\n  \u279c  loomio git:(master) \u2717 du -h leveldbfile\n  3.7M  leveldbfile\n  \u279c  loomio git:(master) \u2717 du -h leveldbfile\n  1.4M  leveldbfile\n  \u279c  loomio git:(master) \u2717 du -h leveldbfile\n  8.5M  leveldbfile\n</code></pre>\n\n<p>The code for Storing email, password for users is </p>\n\n<pre><code>        func AddUser(dbSession config.Database, user *models.User) (string, error) {\n\n            user_id := uuid.NewV4()\n            user.UserID = user_id.String()\n            ok := RetreiveSecondaryIndex(dbSession, user.Email)\n            if ok {\n                log.Println(\"This is the user id found in secondary index\", ok)\n                return \"\", errors.New(\"The email is already registered\")\n\n            }\n\n            var network bytes.Buffer // Stand-in for a network connection\n            enc := gob.NewEncoder(&amp;network)\n\n            err := enc.Encode(user)\n            if err != nil {\n                log.Println(\"Error in encoding gob\")\n                return \"\", err\n            }\n\n\n            err = dbSession.DBSession.Put([]byte(user.UserID), network.Bytes(), nil)\n            //dberr := userCollection.Insert(user)\n            fmt.Println(err)\n            if err != nil {\n                log.Println(err)\n                return \"\", err\n            }\n\n            AddSecondaryIndex(dbSession, user.Username, user.Email)\n\n            return user.UserID, nil\n        }\n</code></pre>\n\n<p>Why is LevelDB readjusting its disk space and on what basis?</p>\n"}, {"tags": ["for-loop", "go", "slice", "specifications"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 8, "creation_date": 1549269775, "post_id": 54512586, "comment_id": 95828237, "body": "Exactly the same. The only difference is that you don&#39;t assign the index to a variable."}, {"owner": {"reputation": 598, "user_id": 9552116, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Coconut", "link": "https://stackoverflow.com/users/9552116/coconut"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549271317, "post_id": 54512586, "comment_id": 95828859, "body": "Any proof? I know they&#39;re the same. What happens if I wrote the latter and just one day the program suddenly starts retrieving elements in random order as if the slice were a map? I want to make sure if the <code>for ... range</code> without the index really is reliable."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1549271417, "post_id": 54512586, "comment_id": 95828890, "body": "The proof is in the spec. If it does anything other than that, it&#39;s broken. The <a href=\"https://golang.org/ref/spec#Blank_identifier\" rel=\"nofollow noreferrer\">blank identifier</a> is only an identifier. It cannot, by definition, have any other effect."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1549274513, "last_edit_date": 1592644375, "creation_date": 1549273070, "answer_id": 54513368, "question_id": 54512586, "link": "https://stackoverflow.com/questions/54512586/iteration-order-of-for-range-when-the-index-is-implicit/54513368#54513368", "title": "Iteration order of `for ... range` when the index is implicit", "body": "<p>It's in the spec, but I think you overlook something. There are <em>iteration values</em> and <em>iteration variables</em>.</p>\n<blockquote>\n<p>For each entry it assigns <em>iteration values</em> to corresponding <em>iteration variables</em> if present and then executes the block.</p>\n</blockquote>\n<p>And your quote refers to <em>iteration values</em>:</p>\n<blockquote>\n<p>For an array, pointer to array, or slice value <code>a</code>, the index <strong>iteration values</strong> are produced in increasing order, starting at element index 0. If at most one iteration variable is present, the range loop produces iteration values from 0 up to <code>len(a)-1</code> and does not index into the array or slice itself.</p>\n</blockquote>\n<p>So as you can see, regardless of how many <em>iteration variables</em> there are, the iteration values are always in increasing order, starting at element index 0.</p>\n<p>And the second iteration value is always <code>a[i]</code>, where <code>i</code> corresponds to the first iteration value, the index:</p>\n<blockquote>\n<pre><code>Range expression                          1st value          2nd value\n\narray or slice  a  [n]E, *[n]E, or []E    index    i  int    a[i]       E\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 598, "user_id": 9552116, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Coconut", "link": "https://stackoverflow.com/users/9552116/coconut"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1651, "favorite_count": 0, "accepted_answer_id": 54513368, "answer_count": 1, "score": 0, "last_activity_date": 1600932273, "creation_date": 1549269668, "last_edit_date": 1600932273, "question_id": 54512586, "link": "https://stackoverflow.com/questions/54512586/iteration-order-of-for-range-when-the-index-is-implicit", "title": "Iteration order of `for ... range` when the index is implicit", "body": "<p><a href=\"https://golang.org/ref/spec#For_range\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#For_range</a></p>\n\n<blockquote>\n  <p>For statements with <em>range</em> clause</p>\n  \n  <p>For an array, pointer to array, or slice value a, the index iteration values are produced in increasing order, starting at element index 0. If at most one iteration variable is present, the range loop produces iteration values from 0 up to len(a)-1 and does not index into the array or slice itself. For a nil slice, the number of iterations is 0.</p>\n</blockquote>\n\n<p>According to the spec, iterating over a linear data structure (array or slice or string) in Go will get each of elements in there always in order the index increases.</p>\n\n<pre><code>for i, v := range []int{11, 22, 33, 44} {\n    fmt.Println(i, v)\n}\n</code></pre>\n\n<p>But the thing is that I can't really find in the spec the guarantee that,</p>\n\n<p>this range-iterate-over clause with an implicit index iteration value, too, will always keep the same order as well:</p>\n\n<pre><code>for _, v := range []int{11, 22, 33, 44} {\n    fmt.Println(v)\n}\n</code></pre>\n\n<p>Will those two examples I put above always perform in the same order?</p>\n\n<p>I assume they do but I haven't heard the promise yet.</p>\n\n<p>How does <code>for ... range</code> work when the index iteration value is represented by the blank identifier(the underscore <code>_</code>)?</p>\n"}, {"tags": ["go", "app-engine-flexible", "go-modules"], "comments": [{"owner": {"reputation": 1380, "user_id": 1170354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H14HR.jpg?s=128&g=1", "display_name": "Oliver", "link": "https://stackoverflow.com/users/1170354/oliver"}, "edited": false, "score": 0, "creation_date": 1554180332, "post_id": 54510817, "comment_id": 97645505, "body": "Did you ever work out what was happening here?"}, {"owner": {"reputation": 1973, "user_id": 72721, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/87bd5e904102ed9355e67afc0d1463e8?s=128&d=identicon&r=PG&f=1", "display_name": "Rohith", "link": "https://stackoverflow.com/users/72721/rohith"}, "reply_to_user": {"reputation": 1380, "user_id": 1170354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H14HR.jpg?s=128&g=1", "display_name": "Oliver", "link": "https://stackoverflow.com/users/1170354/oliver"}, "edited": false, "score": 0, "creation_date": 1554285170, "post_id": 54510817, "comment_id": 97691582, "body": "@Oliver, no I didn&#39;t. I started using app engine flex with a Dockerfile."}, {"owner": {"reputation": 1380, "user_id": 1170354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H14HR.jpg?s=128&g=1", "display_name": "Oliver", "link": "https://stackoverflow.com/users/1170354/oliver"}, "edited": false, "score": 0, "creation_date": 1554293595, "post_id": 54510817, "comment_id": 97696845, "body": "Ah that&#39;s annoying, I went back to using dep. As it&#39;s consistent with other parts of the project. I feel like so much of this is half finished and half documented. :("}, {"owner": {"reputation": 1, "user_id": 6655524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/513f6b5c7645d361f7d4c20b3183643a?s=128&d=identicon&r=PG", "display_name": "Mat&#237;as Blasi", "link": "https://stackoverflow.com/users/6655524/mat%c3%adas-blasi"}, "edited": false, "score": 0, "creation_date": 1579571185, "post_id": 54510817, "comment_id": 105802207, "body": "Looks like here is the official answer: <a href=\"https://github.com/golang/go/issues/34107\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/34107</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1605, "user_id": 1156254, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/vUfbC.gif?s=128&g=1", "display_name": "automaticAllDramatic", "link": "https://stackoverflow.com/users/1156254/automaticalldramatic"}, "edited": false, "score": 0, "creation_date": 1567772959, "post_id": 55757526, "comment_id": 102074155, "body": "I have a similar problem, copying did not really help in my case - <a href=\"https://stackoverflow.com/questions/57822057/deploying-to-google-app-engine-flexible-for-go1-12-fails\" title=\"deploying to google app engine flexible for go1 12 fails\">stackoverflow.com/questions/57822057/&hellip;</a>"}], "tags": [], "owner": {"reputation": 116, "user_id": 8627444, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HqVXT.png?s=128&g=1", "display_name": "shrumm", "link": "https://stackoverflow.com/users/8627444/shrumm"}, "is_accepted": false, "score": 2, "last_activity_date": 1555655267, "creation_date": 1555655267, "answer_id": 55757526, "question_id": 54510817, "link": "https://stackoverflow.com/questions/54510817/deploying-to-google-app-engine-flexible-with-go-mod-fails-because-it-is-looking/55757526#55757526", "title": "Deploying to google app engine flexible with go.mod fails because it is looking for dependent libraries in GOPATH", "body": "<p>I have a workaround for you - it's not pretty. I don't know why app engine doesn't try to resolve dependencies with go modules and instead looks just in the $GOPATH.</p>\n\n<p>My workaround is to just copy the appropriate folder in go modules cache back to the Go Path. I'd love to know if someone has a better solution.</p>\n\n<p>Your mod cache should be in <code>$GOPATH/pkg/mod</code></p>\n\n<p>Copy the dependencies you need, into your <code>$GOPATH/src</code> folder and you should be good to go.</p>\n\n<p>Related issue, hope this helps someone. This led me down a rabbit hole because I recently switched to Go modules, and GAE was complaining about a bug in a dependency which was fixed in a newer version of it. I updated the dependency multiple times, it worked fine on local testing but I kept getting the same error on <code>app deploy</code>. Eventually I realised what was happening: when running your code locally, Go correctly assembled dependencies from the go modules cache - app engine was taking it from the 'old' location from the Go Path. Once you enable Go modules <code>go get</code> only updates the mod cache.</p>\n"}, {"tags": [], "owner": {"reputation": 413, "user_id": 6039122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8cfac0207c5bc06a9542737ff0ec9e12?s=128&d=identicon&r=PG&f=1", "display_name": "alextru", "link": "https://stackoverflow.com/users/6039122/alextru"}, "is_accepted": false, "score": 0, "last_activity_date": 1557834778, "creation_date": 1557834778, "answer_id": 56129830, "question_id": 54510817, "link": "https://stackoverflow.com/questions/54510817/deploying-to-google-app-engine-flexible-with-go-mod-fails-because-it-is-looking/56129830#56129830", "title": "Deploying to google app engine flexible with go.mod fails because it is looking for dependent libraries in GOPATH", "body": "<p>According to the documentation of App Engine Standard and Flex, both support the Go 1.11 runtime. Now, we know Go 1.11 <a href=\"https://golang.org/cmd/go/#hdr-Preliminary_module_support\" rel=\"nofollow noreferrer\">introduced</a> experimental support for Go modules, keeping compatibility with GOPATH. However, while using Go modules through a <code>go.mod</code> file is an approach <a href=\"https://cloud.google.com/appengine/docs/standard/go111/specifying-dependencies\" rel=\"nofollow noreferrer\">presented</a> for Standard, it is <a href=\"https://cloud.google.com/appengine/docs/flexible/go/using-go-libraries\" rel=\"nofollow noreferrer\">not mentioned at all</a> for Flex.</p>\n\n<p>So, for Flex, either you have everything under the GOPATH, following the indications in the docs, or stick with the workaround provided by @shrumm.</p>\n"}], "owner": {"reputation": 1973, "user_id": 72721, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/87bd5e904102ed9355e67afc0d1463e8?s=128&d=identicon&r=PG&f=1", "display_name": "Rohith", "link": "https://stackoverflow.com/users/72721/rohith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1047, "favorite_count": 2, "answer_count": 2, "score": 5, "last_activity_date": 1579571185, "creation_date": 1549259852, "question_id": 54510817, "link": "https://stackoverflow.com/questions/54510817/deploying-to-google-app-engine-flexible-with-go-mod-fails-because-it-is-looking", "title": "Deploying to google app engine flexible with go.mod fails because it is looking for dependent libraries in GOPATH", "body": "<p>I have the helloworld app from <a href=\"https://github.com/GoogleCloudPlatform/golang-samples/tree/master/appengine_flexible/helloworld\" rel=\"noreferrer\">here</a> with a couple of modifications. </p>\n\n<ol>\n<li>I've used logrus (to bring in dependency to an external lib)</li>\n<li>I've added a go.mod using go mod init</li>\n<li>I have checkout this code outside of my GOPATH.</li>\n</ol>\n\n<p>Everything works on localhost. I'm able to see the hello message on localhost:8080. When I attempt to do a gcloud app deploy I get the following error:</p>\n\n<pre><code>staging for go1.11\nStaging Flex app: failed analyzing /home/.../code/app-engine-gomod: cannot find package \"github.com/sirupsen/logrus\" in any of:\n    ($GOROOT not set)\n    /home/.../go/src/github.com/sirupsen/logrus (from $GOPATH)\nGOPATH: /home/.../go\n</code></pre>\n\n<p>I've tried with and without <code>go mod vendor</code> doesn't help. What am I doing wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1549253340, "post_id": 54509958, "comment_id": 95823422, "body": "You need to find or write a parser for the rules file format.  Is the file a well known format?"}, {"owner": {"reputation": 269, "user_id": 970474, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dc8b82f90739993544798e25a8b4164b?s=128&d=identicon&r=PG", "display_name": "checkmate", "link": "https://stackoverflow.com/users/970474/checkmate"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1549253750, "post_id": 54509958, "comment_id": 95823498, "body": "its on linux im doing this, so actually the file is just a text file. i tried with this on csv format. but then there is issues with the double quotations."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1549254577, "post_id": 54509958, "comment_id": 95823638, "body": "It sounds like you might have control over the format of the text file.  Can you use JSON?"}], "answers": [{"comments": [{"owner": {"reputation": 269, "user_id": 970474, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dc8b82f90739993544798e25a8b4164b?s=128&d=identicon&r=PG", "display_name": "checkmate", "link": "https://stackoverflow.com/users/970474/checkmate"}, "edited": false, "score": 0, "creation_date": 1549299362, "post_id": 54510700, "comment_id": 95844391, "body": "Hey @ThunderCat this looks amazing, let me check this and get back to you soon as possible"}, {"owner": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "edited": false, "score": 0, "creation_date": 1601829187, "post_id": 54510700, "comment_id": 113520937, "body": "Can we wrtie <code>defer file.Close()</code> before <code>err</code> check?"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1549259052, "creation_date": 1549259052, "answer_id": 54510700, "question_id": 54509958, "link": "https://stackoverflow.com/questions/54509958/how-to-assign-values-from-a-file-line-in-to-a-map-in-golang/54510700#54510700", "title": "how to assign values from a file line in to a map in Golang", "body": "<p>Consider using <a href=\"https://www.json.org/\" rel=\"nofollow noreferrer\">JSON</a> for the file format so you can the JSON parser in the standard library:</p>\n\n<pre><code>[\n{\"name\": \"hero\", \"age\":\"27\"},\n{\"name\": \"villein\", \"age\":\"30\"}\n]\n</code></pre>\n\n<p>With this format, the code is:</p>\n\n<pre><code>file, err := os.Open(\"rules\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer file.Close()\nvar data []map[string]string\nif err := json.NewDecoder(file).Decode(&amp;data); err != nil {\n    log.Fatal(err)\n}\n// variable data is a slice of maps\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/QU-UUsZ2geb\" rel=\"nofollow noreferrer\">Run it on the Playground</a></p>\n"}], "owner": {"reputation": 269, "user_id": 970474, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dc8b82f90739993544798e25a8b4164b?s=128&d=identicon&r=PG", "display_name": "checkmate", "link": "https://stackoverflow.com/users/970474/checkmate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1630, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549259052, "creation_date": 1549252540, "question_id": 54509958, "link": "https://stackoverflow.com/questions/54509958/how-to-assign-values-from-a-file-line-in-to-a-map-in-golang", "title": "how to assign values from a file line in to a map in Golang", "body": "<p>I am trying to write a self of key value pairs, later be used as a rule engine. Here what i am trying to achieve is getting the following code to make a map called \"f\" and assign the values on the file line to it. However the following code throws an exception saying  \"f is not a type\"</p>\n\n<p>Is the method im doing to achieve the above task is correct? if not please suggest a better way of doing it, and better if you can provide me with a sample code\nHow to assign the line value to the map? better if you can provide me with a sample code</p>\n\n<p>Thank you in advance</p>\n\n<p><strong>rules file</strong></p>\n\n<pre><code>\"name\": \"hero\", \"age\":\"27\n\"name\": \"villein\", \"age\":\"30\n</code></pre>\n\n<p><strong>code</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n)\n\nfunc main() {\n    file, err := os.Open(\"rules\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer file.Close()\n\n    scanner := bufio.NewScanner(file)\n    for scanner.Scan() {\n        var f = make(map[string]string)\n        f {scanner.Text()}\n        fmt.Println(f)\n    }\n\n    if err := scanner.Err(); err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "plugins", "compiler-errors", "shared-libraries", "static-libraries"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 1, "creation_date": 1549364434, "post_id": 54509223, "comment_id": 95867255, "body": "See if this <a href=\"https://github.com/golang/go/issues/18671\" rel=\"nofollow noreferrer\">issue</a> help."}, {"owner": {"reputation": 22041, "user_id": 108207, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/dd8608b8b423bdcbda3fe5c0cf8b6230?s=128&d=identicon&r=PG&f=1", "display_name": "Niklas R.", "link": "https://stackoverflow.com/users/108207/niklas-r"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1549522513, "post_id": 54509223, "comment_id": 95933699, "body": "@leafbebop Thanks but when I try downgrading as it says in one comment, the issue persists. I think that maybe one must propose a patch or change the actual behavior of the Go compiler / language in order to make my program happen. The reason I try to do it is that we have the intention to generate lots of plugins at runtime and we cannot let the generated objects become very large, because there might be thousands of them generated at runtime."}, {"owner": {"reputation": 475, "user_id": 1681234, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0f42b79ce1072c3756fc5526d36f3c48?s=128&d=identicon&r=PG", "display_name": "Oswin", "link": "https://stackoverflow.com/users/1681234/oswin"}, "edited": false, "score": 1, "creation_date": 1554727363, "post_id": 54509223, "comment_id": 97846105, "body": "Hi Niklas, did you find a solution for your problem ? I&#39;m running into the same with Go .12"}, {"owner": {"reputation": 22041, "user_id": 108207, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/dd8608b8b423bdcbda3fe5c0cf8b6230?s=128&d=identicon&r=PG&f=1", "display_name": "Niklas R.", "link": "https://stackoverflow.com/users/108207/niklas-r"}, "reply_to_user": {"reputation": 475, "user_id": 1681234, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0f42b79ce1072c3756fc5526d36f3c48?s=128&d=identicon&r=PG", "display_name": "Oswin", "link": "https://stackoverflow.com/users/1681234/oswin"}, "edited": false, "score": 0, "creation_date": 1570878439, "post_id": 54509223, "comment_id": 103060683, "body": "@Oswin no solution, but there is more info at this link <a href=\"https://github.com/golang/go/issues/17150\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/17150</a>"}, {"owner": {"reputation": 475, "user_id": 1681234, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0f42b79ce1072c3756fc5526d36f3c48?s=128&d=identicon&r=PG", "display_name": "Oswin", "link": "https://stackoverflow.com/users/1681234/oswin"}, "edited": false, "score": 0, "creation_date": 1574758773, "post_id": 54509223, "comment_id": 104335206, "body": "Here is an interesting article describing the steps for this and the problem you&#39;ll run into : <a href=\"https://blog.ksub.org/bytes/2017/02/12/exploring-shared-objects-in-go/\" rel=\"nofollow noreferrer\">blog.ksub.org/bytes/2017/02/12/exploring-shared-objects-in-g&zwnj;&#8203;o</a>"}], "owner": {"reputation": 22041, "user_id": 108207, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/dd8608b8b423bdcbda3fe5c0cf8b6230?s=128&d=identicon&r=PG&f=1", "display_name": "Niklas R.", "link": "https://stackoverflow.com/users/108207/niklas-r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 167, "favorite_count": 0, "answer_count": 0, "score": 5, "last_activity_date": 1549522376, "creation_date": 1549243723, "last_edit_date": 1549522376, "question_id": 54509223, "link": "https://stackoverflow.com/questions/54509223/cannot-compile-plugin-for-a-shared-object", "title": "Cannot compile plugin for a shared object", "body": "<p>It looks like my issue is that GoLang includes the runtime in plugins so that they cannot be shared. I did</p>\n\n<p><code>go install -buildmode=shared std</code></p>\n\n<p>And then I try to compile my plugin as shared:</p>\n\n<pre><code> go build -buildmode=plugin -linkshared /tmp/code_SUM.go\n# command-line-arguments\nruntime.islibrary: missing Go type information for global symbol: size 1\n</code></pre>\n\n<p>My code</p>\n\n<pre><code># cat /tmp/code_SUM.go\npackage main\nimport (\n        \"fmt\"\n)\nfunc SUM(x int, y int) int { fmt.Println(\"\")\nreturn x+y}\n</code></pre>\n\n<p>Is there any workaround or some way to patch / change the Go compiler / language in order to make my program happen?</p>\n"}, {"tags": ["sql", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1549232725, "post_id": 54507846, "comment_id": 95819977, "body": "Edit the question to include the stack trace printed with the panic and the panicking line of code."}], "owner": {"reputation": 41, "user_id": 5814652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2ab4d97a5d174f4f364a9d8764d1d0a?s=128&d=identicon&r=PG&f=1", "display_name": "neohwang", "link": "https://stackoverflow.com/users/5814652/neohwang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1549229868, "creation_date": 1549229868, "question_id": 54507846, "link": "https://stackoverflow.com/questions/54507846/variable-argument-in-sql-query-function", "title": "variable argument in sql query function", "body": "<p>This is my code</p>\n\n<pre><code>func QueryMap2(db *sql.DB, query string, args ...interface{}) (error) {\nrows, err := db.Query(query, args...)\nif err!=nil {\n    return err\n}\n</code></pre>\n\n<p>....</p>\n\n<pre><code>dblib.QueryMap2(myDB, \"select * from user where userid=?\", \"admin\")\n</code></pre>\n\n<p>This is error message</p>\n\n<p>panic: interface conversion: interface {} is int64, not []uint8</p>\n\n<p>help me</p>\n"}, {"tags": ["arrays", "go", "slice"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1549230746, "post_id": 54507818, "comment_id": 95819549, "body": "You can&#39;t do &quot;easily&quot; what you want. Slices and arrays are not 2-dimensional, they  are just composed to form a multi-dimensional object. See <a href=\"https://stackoverflow.com/questions/39561140/how-is-two-dimensional-arrays-memory-representation/39561477#39561477\">How is two dimensional array&#39;s memory representation</a>."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1549231487, "post_id": 54507818, "comment_id": 95819716, "body": "What you&#39;re talking about is just not something that Go does. <code>a[0:2]</code>is a slice consisting of the first three elements of <code>a</code> (i.e., a slice of 3 <code>[]int</code>s). If you do the same slice operation on that, you just get the same thing, as you saw. You may want to take a look at these explanations of how slices work: <a href=\"https://tour.golang.org/moretypes/7\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/7</a> <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">blog.golang.org/go-slices-usage-and-internals</a>"}, {"owner": {"reputation": 169, "user_id": 5236295, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-LPJUP5i-fIA/AAAAAAAAAAI/AAAAAAAAADk/ojCwuKH8fvc/photo.jpg?sz=128", "display_name": "Jonas D", "link": "https://stackoverflow.com/users/5236295/jonas-d"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1549231908, "post_id": 54507818, "comment_id": 95819816, "body": "@AndySchweig thanks that&#39;s just the explanation I needed. I guess I was naively hoping for a <code>numpy</code> type capability"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1549232591, "last_edit_date": 1549232591, "creation_date": 1549232066, "answer_id": 54508122, "question_id": 54507818, "link": "https://stackoverflow.com/questions/54507818/selecting-2d-sub-slice-of-a-2d-slice-using-ranges-in-go/54508122#54508122", "title": "selecting 2D sub-slice of a 2D-slice using ranges in go", "body": "<p>You can't do  what you want in a single step. Slices and arrays are not 2-dimensional, they are just composed to form a multi-dimensional object. See <a href=\"https://stackoverflow.com/questions/39561140/how-is-two-dimensional-arrays-memory-representation/39561477#39561477\">How is two dimensional array&#39;s memory representation</a></p>\n\n<p>So with a slice expression, you just get a slice that will hold a subset of the \"full\" rows, and its type will be the same: <code>[][]int</code>. If you slice it again, you just slicing the slice of rows again.</p>\n\n<p>Also note that the higher index in a slice expression is exclusive, so <code>a[0:2]</code> will only have 2 rows, so you should use <code>a[0:3]</code> or simply <code>a[:3]</code> instead.</p>\n\n<p>To get what you want, you have to slice the rows individually like this:</p>\n\n<pre><code>b := a[0:3]\nfor i := range b {\n    b[i] = b[i][0:3]\n}\nfmt.Println(b)\n</code></pre>\n\n<p>This will output (try it on the <a href=\"https://play.golang.org/p/Y1i5a8jbFiE\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[[0 1 2] [1 2 3] [2 3 4]]\n</code></pre>\n\n<p>Or shorter:</p>\n\n<pre><code>b := a[:3]\nfor i, bi := range b {\n    b[i] = bi[:3]\n}\n</code></pre>\n"}], "owner": {"reputation": 169, "user_id": 5236295, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-LPJUP5i-fIA/AAAAAAAAAAI/AAAAAAAAADk/ojCwuKH8fvc/photo.jpg?sz=128", "display_name": "Jonas D", "link": "https://stackoverflow.com/users/5236295/jonas-d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 490, "favorite_count": 0, "accepted_answer_id": 54508122, "answer_count": 1, "score": 3, "last_activity_date": 1549232591, "creation_date": 1549229614, "last_edit_date": 1549232149, "question_id": 54507818, "link": "https://stackoverflow.com/questions/54507818/selecting-2d-sub-slice-of-a-2d-slice-using-ranges-in-go", "title": "selecting 2D sub-slice of a 2D-slice using ranges in go", "body": "<p>I'm getting a surprising result when selecting a 2D sub-slice of a slice.\nConsider the following 2D int array</p>\n\n<pre><code>a := [][]int{\n    {0, 1, 2, 3},\n    {1, 2, 3, 4},\n    {2, 3, 4, 5},\n    {3, 4, 5, 6},\n}\n</code></pre>\n\n<p>To select the top left 3x3 2D slice using ranges I would use</p>\n\n<pre><code>b := a[0:2][0:2]\n</code></pre>\n\n<p>I would expect the result to be</p>\n\n<pre><code>[[0 1 2] [1 2 3] [2 3 4]]\n</code></pre>\n\n<p>however the second index range doesn't seem to have any effect, and returns the following instead:</p>\n\n<pre><code>[[0 1 2 3] [1 2 3 4] [2 3 4 5]]\n</code></pre>\n\n<p>What am I missing? Can you simply not select a sub-slice like this where the dimension > 1 ?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1549230936, "post_id": 54507672, "comment_id": 95819589, "body": "Parsing Go code is in the standard library: <a href=\"https://golang.org/pkg/go/\" rel=\"nofollow noreferrer\"><code>go&#47;xxx</code></a> packages. You can also change / manipulate the ast representation. For #3, you could just call / execute the <code>go</code> command."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1549236824, "post_id": 54507672, "comment_id": 95820793, "body": "@icza there is no way to compile an AST. The \u201cstable api\u201d for the compiler is the source code. Any optimizations would be probably be done using the SSA form, which is the closest thing the GC compiler has to an IR."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1549264270, "post_id": 54507672, "comment_id": 95826120, "body": "Whether you consider the (various) compilers intermediate formats stable or not is your choice. Just take a look at the compiler and the supporting packages."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1549267716, "post_id": 54507672, "comment_id": 95827440, "body": "@JimB Yes, I didn&#39;t say (didn&#39;t mean to imply) that AST can be compiled directly. You first have to write the modified AST to files, and you may call the <code>go</code> tool to compile those."}], "answers": [{"tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": true, "score": 1, "last_activity_date": 1549279101, "creation_date": 1549279101, "answer_id": 54514992, "question_id": 54507672, "link": "https://stackoverflow.com/questions/54507672/does-go-have-a-stable-compiler-api/54514992#54514992", "title": "Does Go have a stable compiler API?", "body": "<p>As @icza said in a comment, you may use the <a href=\"https://golang.org/pkg/go/\" rel=\"nofollow noreferrer\"><code>go/...</code></a> packages from the standard library to do this.</p>\n\n<p>The standard library falls under the Go 1 guarantee (API stability).</p>\n\n<p>These packages may see additions and bug fixes to their APIs but not breaking changes, for as long as the major version of Go remains 1.</p>\n\n<p>Read the <a href=\"https://golang.org/doc/go1compat\" rel=\"nofollow noreferrer\">guarantee document</a> for further information and edge cases.</p>\n"}], "owner": {"reputation": 25603, "user_id": 45843, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/55f76441107f14055f95e08bb7bd01df?s=128&d=identicon&r=PG&f=1", "display_name": "rwallace", "link": "https://stackoverflow.com/users/45843/rwallace"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 54514992, "answer_count": 1, "score": 1, "last_activity_date": 1549279101, "creation_date": 1549228627, "question_id": 54507672, "link": "https://stackoverflow.com/questions/54507672/does-go-have-a-stable-compiler-api", "title": "Does Go have a stable compiler API?", "body": "<p>Does Go have a stable compiler API? That is, suppose you want to:</p>\n\n<ol>\n<li>Parse Go code to an intermediate format</li>\n<li>Do something (e.g. analysis or optimization) with the code</li>\n<li>Generate a binary as normal</li>\n</ol>\n\n<p>and you would like to use the existing compiler implementation for steps 1 and 3, is this possible?</p>\n\n<p>To further clarify what I mean: C++ does have a compiler API, thanks to Clang/LLVM, but not a stable one (Clang/LLVM regularly breaks API backward compatibility, or did last I checked), so that's the kind of thing I'm looking for, but hopefully stable.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 3, "creation_date": 1549226681, "post_id": 54507322, "comment_id": 95818427, "body": "It is hard to say without knowing what your code does. There is also a variable <code>x</code> which is defined before the codeblock so ,we don&#39;t know your whole code. Coming to your second question, yes Go is slower than c++ in an effective implementation"}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1549226926, "post_id": 54507322, "comment_id": 95818501, "body": "Finding some way to avoid <code>fmt.Scanf</code> might help, since it\u2019s probably* the heaviest part of that loop. Kind of like how the same thing in Java would probably avoid <code>Scanner</code>."}, {"owner": {"reputation": 19, "user_id": 10322444, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HsgPq7Dw8pg/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPGNIH83TC0QoyFMZQqCx3BhXwcFg/mo/photo.jpg?sz=128", "display_name": "suryansh verma", "link": "https://stackoverflow.com/users/10322444/suryansh-verma"}, "edited": false, "score": 0, "creation_date": 1549226980, "post_id": 54507322, "comment_id": 95818516, "body": "Is there any way to write this loop more efficienly"}, {"owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1549227012, "post_id": 54507322, "comment_id": 95818529, "body": "@Ry- You&#39;re right. But since they mention &quot;competitive programming&quot; it&#39;s likely that&#39;s the interface to the program under test. As a simple cheap thing to try the OP could store all the numbers in a slice and then process them without interspersing the slow calls."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "reply_to_user": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "edited": false, "score": 0, "creation_date": 1549227074, "post_id": 54507322, "comment_id": 95818547, "body": "@cnicutar: Yep, to clarify, I mean trying approaches like reading in the entire input at once. Not sure if that\u2019ll actually help, but as far as trying to solve the problem in Go goes, that\u2019s where I\u2019d start. (Also, @ suryansh, what\u2019s the time limit?)"}, {"owner": {"reputation": 19, "user_id": 10322444, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HsgPq7Dw8pg/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPGNIH83TC0QoyFMZQqCx3BhXwcFg/mo/photo.jpg?sz=128", "display_name": "suryansh verma", "link": "https://stackoverflow.com/users/10322444/suryansh-verma"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1549227233, "post_id": 54507322, "comment_id": 95818591, "body": "@Ry time limit is 1 second"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1549227379, "post_id": 54507322, "comment_id": 95818640, "body": "By the way you have something weird going on at the end of that code. You assign a value to <code>f</code> but then ignore it and assign a different value to <code>f</code>."}, {"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1549227399, "post_id": 54507322, "comment_id": 95818645, "body": "Another thing it looks like you could do is move the <code>m++</code> out of the loop, since it isn\u2019t used after it\u2019s changed inside."}, {"owner": {"reputation": 19, "user_id": 10322444, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HsgPq7Dw8pg/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPGNIH83TC0QoyFMZQqCx3BhXwcFg/mo/photo.jpg?sz=128", "display_name": "suryansh verma", "link": "https://stackoverflow.com/users/10322444/suryansh-verma"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1549227503, "post_id": 54507322, "comment_id": 95818677, "body": "@ZanLynx i have to give result in float64 &quot;f = float64(x)&quot; is the case if m != 0 at end of loop"}, {"owner": {"reputation": 19, "user_id": 10322444, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HsgPq7Dw8pg/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPGNIH83TC0QoyFMZQqCx3BhXwcFg/mo/photo.jpg?sz=128", "display_name": "suryansh verma", "link": "https://stackoverflow.com/users/10322444/suryansh-verma"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1549227670, "post_id": 54507322, "comment_id": 95818726, "body": "@Ry- actually i have to ignore the effect of last case on m so I incremented m by 1"}, {"owner": {"reputation": 19, "user_id": 10322444, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HsgPq7Dw8pg/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPGNIH83TC0QoyFMZQqCx3BhXwcFg/mo/photo.jpg?sz=128", "display_name": "suryansh verma", "link": "https://stackoverflow.com/users/10322444/suryansh-verma"}, "edited": false, "score": 0, "creation_date": 1549227970, "post_id": 54507322, "comment_id": 95818806, "body": "&quot;<a href=\"http://codeforces.com/problemset/problem/1111/B\" rel=\"nofollow noreferrer\">codeforces.com/problemset/problem/1111/B</a>  --  Average Superhero Gang Power&quot; in case anybody wants to know actual question"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1549314787, "post_id": 54507322, "comment_id": 95851161, "body": "@suryanshverma: I reverted your edit. On Stack Overflow, we need to see the code."}], "answers": [{"comments": [{"owner": {"reputation": 19, "user_id": 10322444, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HsgPq7Dw8pg/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPGNIH83TC0QoyFMZQqCx3BhXwcFg/mo/photo.jpg?sz=128", "display_name": "suryansh verma", "link": "https://stackoverflow.com/users/10322444/suryansh-verma"}, "edited": false, "score": 0, "creation_date": 1549488220, "post_id": 54522142, "comment_id": 95924413, "body": "thanks for the help. Why does bufio.Newscanner takes lesser time to take input as compared to fmt.Scanf"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 19, "user_id": 10322444, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HsgPq7Dw8pg/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPGNIH83TC0QoyFMZQqCx3BhXwcFg/mo/photo.jpg?sz=128", "display_name": "suryansh verma", "link": "https://stackoverflow.com/users/10322444/suryansh-verma"}, "edited": false, "score": 0, "creation_date": 1549504939, "post_id": 54522142, "comment_id": 95929191, "body": "@suryanshverma: bufio.Scanner was added to Go to do simple tasks such as read the input as a sequence of lines or space-delimited words. It uses efficient, compiled code. The Go fmt package implements formatted I/O with functions analogous to C&#39;s printf and scanf. It uses runtime interpretation of format strings and the Go reflect package. You amplified the performance difference by looping pver the code 100000 times."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1549459367, "last_edit_date": 1549459367, "creation_date": 1549304632, "answer_id": 54522142, "question_id": 54507322, "link": "https://stackoverflow.com/questions/54507322/how-to-improve-execution-time-in-go/54522142#54522142", "title": "How to improve execution time in go", "body": "<p>Go execution time can be improved to milliseconds for n = 100000, under the 1 second time limit.</p>\n\n<hr>\n\n<p>For example, a complete solution to the problem,</p>\n\n<pre><code>// Problem - 1111B - Codeforces\n// B. Average Superhero Gang Power\n// http://codeforces.com/problemset/problem/1111/B\n\npackage main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"sort\"\n    \"strconv\"\n)\n\nfunc readInt(s *bufio.Scanner) (int, error) {\n    if s.Scan() {\n        i, err := strconv.Atoi(s.Text())\n        if err != nil {\n            return 0, err\n        }\n        return i, nil\n    }\n    err := s.Err()\n    if err == nil {\n        err = io.EOF\n    }\n    return 0, err\n}\n\nfunc main() {\n    s := bufio.NewScanner(os.Stdin)\n    s.Split(bufio.ScanWords)\n\n    var n, k, m int\n    var err error\n    n, err = readInt(s)\n    if err != nil {\n        panic(err)\n    }\n    if n &lt; 1 || n &gt; 10e5 {\n        panic(\"invalid n\")\n    }\n    k, err = readInt(s)\n    if err != nil {\n        panic(err)\n    }\n    if k &lt; 1 || k &gt; 10e5 {\n        panic(\"invalid k\")\n    }\n    m, err = readInt(s)\n    if err != nil {\n        panic(err)\n    }\n    if m &lt; 1 || m &gt; 10e7 {\n        panic(\"invalid m\")\n    }\n\n    a := make([]int, n)\n    sum := int64(0)\n    for i := 0; i &lt; n; i++ {\n        ai, err := readInt(s)\n        if err != nil {\n            panic(err)\n        }\n        if ai &lt; 1 || ai &gt; 10e6 {\n            panic(\"invalid a\")\n        }\n        a[i] = ai\n        sum += int64(ai)\n    }\n    sort.Slice(a, func(i, j int) bool {\n        return a[i] &gt; a[j]\n    })\n\n    i, ik := 0, k\n    for ; m &gt; 0; m-- {\n        j := len(a) - 1\n        if j &gt;= 1 &amp;&amp; (int64(n-1)*(1+sum) &lt; int64(n)*(sum-int64(a[j]))) {\n            // delete\n            sum -= int64(a[j])\n            a = a[:j]\n        } else {\n            // increment\n            sum++\n            a[i]++\n            ik--\n            if ik &lt;= 0 {\n                ik = k\n                i++\n                if i &gt;= len(a) {\n                    break\n                }\n            }\n        }\n    }\n\n    // fmt.Println(sum, len(a))\n    avg := float64(sum) / float64(len(a))\n\n    fmt.Printf(\"%.20f\\n\", avg)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run heroes.go\n2 4 6\n4 7\n11.00000000000000000000\n$ \n\n$ go run heroes.go\n4 2 6\n1 3 2 3\n5.00000000000000000000\n$ \n</code></pre>\n\n<hr>\n\n<p>A benchmark for a cast of avengers with random powers, where <code>n := 100000</code>, <code>k := 100</code>, and <code>m := 100000</code>:</p>\n\n<pre><code>$ ls -s -h heroes.test\n676K heroes.test\n$ go build heroes.go\n$ time ./heroes &lt; heroes.test\n708329.74652807507663965225\nreal    0m0.067s\nuser    0m0.038s\nsys     0m0.004s\n$ \n</code></pre>\n"}], "owner": {"reputation": 19, "user_id": 10322444, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-HsgPq7Dw8pg/AAAAAAAAAAI/AAAAAAAAAAA/APUIFaPGNIH83TC0QoyFMZQqCx3BhXwcFg/mo/photo.jpg?sz=128", "display_name": "suryansh verma", "link": "https://stackoverflow.com/users/10322444/suryansh-verma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 1, "answer_count": 1, "score": -4, "last_activity_date": 1549459367, "creation_date": 1549226241, "last_edit_date": 1549335459, "question_id": 54507322, "link": "https://stackoverflow.com/questions/54507322/how-to-improve-execution-time-in-go", "title": "How to improve execution time in go", "body": "<p>I was writing this code for \"competitive Programming\". It consisted of only 1 loop but gave \"Time Limit Exceed\" if n = 100000.  Can Go be considered for competitive Programming?</p>\n\n<pre><code>fmt.Scanln(&amp;n, &amp;k, &amp;m)\nfor i := 0; i &lt; n; i++ {\n    fmt.Scanf(\"%d\", &amp;z)\n    if m &gt;= 0 {\n        if z &gt; x {\n            x = z\n            m--\n        }\n        if i == n-1 {\n            m++\n        }\n    } else {\n        if cnt == 0 {\n            x = 0\n        }\n        x += z\n        cnt++\n    }\n}\nif m == 0 {\n    f = float64(x / (n - m))\n}\nif k &lt; m {\n    x += k\n} else {\n    x += m\n}\nf = float64(x)\nfmt.Println(f)\n</code></pre>\n\n<hr>\n\n<p>\"<a href=\"http://codeforces.com/problemset/problem/1111/B\" rel=\"nofollow noreferrer\">codeforces.com/problemset/problem/1111/B</a> -- Average Superhero Gang Power\"</p>\n"}, {"tags": ["go", "concurrency", "interrupt", "goroutine", "interrupted-exception"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549224236, "post_id": 54506475, "comment_id": 95817718, "body": "How would a goroutine be interrupted?"}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1549226911, "post_id": 54506475, "comment_id": 95818493, "body": "See this answer for a discussion of how a goroutine might be stopped <a href=\"https://stackoverflow.com/questions/6807590/how-to-stop-a-goroutine\" title=\"how to stop a goroutine\">stackoverflow.com/questions/6807590/how-to-stop-a-goroutine</a>  (corrected link)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1549292715, "post_id": 54506475, "comment_id": 95840685, "body": "It really depends on what you mean by &quot;interrupted&quot;. Interruption like you&#39;re referring to from Java does not happen in Go."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1549222023, "creation_date": 1549222023, "answer_id": 54506683, "question_id": 54506475, "link": "https://stackoverflow.com/questions/54506475/detect-go-routine-interruption/54506683#54506683", "title": "Detect Go routine interruption", "body": "<blockquote>\n  <p>Is there a way to detect if a go routine was interrupted while it was executing?</p>\n</blockquote>\n\n<p>No.</p>\n"}, {"tags": [], "owner": {"reputation": 4669, "user_id": 63814, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/607eab54ab44ecd7ebefa443e1925596?s=128&d=identicon&r=PG", "display_name": "MahlerFive", "link": "https://stackoverflow.com/users/63814/mahlerfive"}, "is_accepted": false, "score": 3, "last_activity_date": 1549227104, "creation_date": 1549227104, "answer_id": 54507466, "question_id": 54506475, "link": "https://stackoverflow.com/questions/54506475/detect-go-routine-interruption/54507466#54507466", "title": "Detect Go routine interruption", "body": "<p>There are a few ways to tell if a goroutine has stopped.</p>\n\n<ol>\n<li>Pass a channel to the goroutine. Inside the goroutine, defer closing the channel. Outside the goroutine, you can wait for the channel to be closed.</li>\n<li>Create a <code>sync.WaitGroup</code> and increment it by one. Pass the <code>WaitGroup</code> to the goroutine. Inside the goroutine, defer calling <code>Done()</code> on the <code>WaitGroup</code>. Outside the goroutine you can call <code>Wait()</code> on the <code>WaitGroup</code> to know when it's finished.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1549227851, "last_edit_date": 1549227851, "creation_date": 1549227435, "answer_id": 54507504, "question_id": 54506475, "link": "https://stackoverflow.com/questions/54506475/detect-go-routine-interruption/54507504#54507504", "title": "Detect Go routine interruption", "body": "<p><a href=\"https://docs.oracle.com/javase/8/docs/api/java/lang/InterruptedException.html\" rel=\"nofollow noreferrer\"><code>InterruptedException</code></a> in Java is thrown if the thread is interrupted e.g. with the <a href=\"https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#interrupt--\" rel=\"nofollow noreferrer\"><code>Thread.interrupt()</code></a> method (while it is waiting, sleeping, or otherwise occupied).</p>\n\n<p>In Go, you can't interrupt a goroutine from the outside (see <a href=\"https://stackoverflow.com/questions/28240133/cancel-a-blocking-operation-in-go/28240299#28240299\">cancel a blocking operation in Go</a>), which means there is no sense talking about detecting it.</p>\n\n<p>A goroutine may end normally if the function that is executed in a goroutine returns, or it may end abruptly if it panics. But even if it panics, that is due to its own function, and not because another goroutine forces it or interrupts it.</p>\n\n<p>A goroutine can only be stopped if it self supports some kind of termination, e.g. it may monitor a channel which another goroutine may close (or send a value on it), which when detected the goroutine may return voluntarily\u2013which will count as a normal termination (and not interruption). </p>\n"}], "owner": {"reputation": 21, "user_id": 11005562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19c19c469bca11e05a1d8ddfeab415e1?s=128&d=identicon&r=PG&f=1", "display_name": "Murky", "link": "https://stackoverflow.com/users/11005562/murky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 307, "favorite_count": 0, "answer_count": 3, "score": -2, "last_activity_date": 1563274103, "creation_date": 1549220854, "last_edit_date": 1563274103, "question_id": 54506475, "link": "https://stackoverflow.com/questions/54506475/detect-go-routine-interruption", "title": "Detect Go routine interruption", "body": "<p>Is there a way to detect if a go routine was interrupted while it was executing? I would like something similar to <code>InterruptedException</code> in Java:  <a href=\"https://docs.oracle.com/javase/8/docs/api/java/lang/InterruptedException.html\" rel=\"nofollow noreferrer\">https://docs.oracle.com/javase/8/docs/api/java/lang/InterruptedException.html</a></p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549211880, "post_id": 54504906, "comment_id": 95813807, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/38091816/packages-type-cannot-be-used-as-the-vendored-packages-type\">package&#39;s type cannot be used as the vendored package&#39;s type</a>"}, {"owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549212044, "post_id": 54504906, "comment_id": 95813851, "body": "Thanks @Flimzy, I will look at those answers. I would be reluctant to move any deps, as I think this ought to work out of the box. But removing <code>vendor</code> and re-fetching seems okay. I will try that..."}, {"owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549212765, "post_id": 54504906, "comment_id": 95814076, "body": "One of those answers recommends the  <code>godep</code> command, which I do not have. Furthermore, it is deprecated and archived on GitHub. I have loade <code>dep</code> instead, and am trying to load dependencies with this."}, {"owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549218648, "post_id": 54504906, "comment_id": 95815936, "body": "@Flimzy: thanks, your pointer helped. Now that I have an answer (below), would you say a better dup is available? I sense the real error was in the first block, but yours relates to the second. Alternatively, if you would like to post an explanatory answer, I&#39;ll accept yours in preference to my own."}], "answers": [{"comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1549273768, "post_id": 54505311, "comment_id": 95830102, "body": "I would like to point out that GOPATH is already set by <code>golang:alpine</code>. If you have a <a href=\"https://github.com/docker-library/golang/blob/2e795f515357c575359f0720acaf7f5490f8bcf5/1.11/alpine3.8/Dockerfile#L59\" rel=\"nofollow noreferrer\">look at the Dockerfile</a>, it is set to <code>&#47;go</code>. Furthermore, I\u2018d strongly suggest using a <a href=\"https://docs.docker.com/develop/develop-images/multistage-build/\" rel=\"nofollow noreferrer\">multi stage build</a>. Edit: which you already did in the repo, but not your answer here... ;)"}, {"owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1549284136, "post_id": 54505311, "comment_id": 95835570, "body": "Thanks @MarkusWMahlberg. Yes, I got a multi-stage build, but only once the build worked - that&#39;s just icing on the cake really. You are right that <code>GOPATH</code> was set, but GoLang insisted that my source project needed to be in <code>{$GOPATH}&#47;src</code>, hence the env var hackery."}, {"owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1549284163, "post_id": 54505311, "comment_id": 95835586, "body": "If this can be simplified (maybe because blatting the vendor folder is not actually necessary?) I am all ears <code>:=)</code>"}], "tags": [], "owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "is_accepted": true, "score": 1, "last_activity_date": 1549219636, "last_edit_date": 1549219636, "creation_date": 1549213307, "answer_id": 54505311, "question_id": 54504906, "link": "https://stackoverflow.com/questions/54504906/why-does-go-build-fail-for-my-docker-project/54505311#54505311", "title": "Why does &quot;go build&quot; fail for my Docker project?", "body": "<p>Flimzy kindly pointed me to another answer (which I would never have found without knowledgeable assistance). Since I think the build process is non-trivial, especially for non-Gophers such as myself, I will post the new <code>Dockerfile</code>:</p>\n\n<pre><code># Docker image for the Mongo Stitch command\n\nFROM golang:alpine\n\n# Do a system update\nRUN apk update\n\nRUN apk add git curl\n\n# Declare base dir\nWORKDIR /root/src\n\nRUN git clone https://github.com/10gen/stitch-cli.git\n\nWORKDIR /root/src/stitch-cli\n\n# Remove the old dependencies\nRUN rm -rf vendor\n\n# Fetch the dependencies\nRUN curl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh\nRUN GOPATH=$GOPATH:/root dep ensure\n\n# Now it should build\nRUN GOPATH=$GOPATH:/root go build\n\nCMD [\"/bin/sh\"]\n</code></pre>\n\n<p>The fetching of the dependencies results in this error:</p>\n\n<pre><code>Warning: the following project(s) have [[constraint]] stanzas in Gopkg.toml:\n\n  \u2717  github.com/10gen/escaper\n  \u2717  github.com/dgrijalva/jwt-go\n  \u2717  github.com/ogier/pflag\n  \u2717  gopkg.in/mgo.v2\n\nHowever, these projects are not direct dependencies of the current project:\nthey are not imported in any .go files, nor are they in the 'required' list in\nGopkg.toml. Dep only applies [[constraint]] rules to direct dependencies, so\nthese rules will have no effect.\n\nEither import/require packages from these projects so that they become direct\ndependencies, or convert each [[constraint]] to an [[override]] to enforce rules\non these projects, if they happen to be transitive dependencies.\n</code></pre>\n\n<p>However, it still seems to compile. My worry is that I have had to do far more steps than are in the documentation, which leads me to think that I have made this more complicated than it needs to be.</p>\n\n<h2>Docker repo</h2>\n\n<p>I have made my Docker repo permanently <a href=\"https://github.com/halfer/docker-stitch-cli\" rel=\"nofollow noreferrer\">available here</a>.</p>\n"}], "owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1799, "favorite_count": 0, "accepted_answer_id": 54505311, "answer_count": 1, "score": 1, "last_activity_date": 1549219636, "creation_date": 1549210746, "last_edit_date": 1549216567, "question_id": 54504906, "link": "https://stackoverflow.com/questions/54504906/why-does-go-build-fail-for-my-docker-project", "title": "Why does &quot;go build&quot; fail for my Docker project?", "body": "<p>I have a npm binary I'd like to package up in a Docker container. I have this configuration:</p>\n\n<pre><code># Docker image for the Mongo Stitch command\n\nFROM golang:alpine\n\n# Do a system update\nRUN apk update\n\nRUN apk add git\n\n# Declare base dir\nWORKDIR /root\n\n# The console binary for Mongo Stitch\nRUN git clone https://github.com/10gen/stitch-cli.git\n\nWORKDIR /root/stitch-cli\n\nRUN go build\n\nCMD [\"/bin/sh\"]\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>main.go:8:2: cannot find package \"github.com/10gen/stitch-cli/commands\" in any of:\n    /usr/local/go/src/github.com/10gen/stitch-cli/commands (from $GOROOT)\n    /go/src/github.com/10gen/stitch-cli/commands (from $GOPATH)\nmain.go:9:2: cannot find package \"github.com/10gen/stitch-cli/utils\" in any of:\n    /usr/local/go/src/github.com/10gen/stitch-cli/utils (from $GOROOT)\n    /go/src/github.com/10gen/stitch-cli/utils (from $GOPATH)\nmain.go:11:2: cannot find package \"github.com/mitchellh/cli\" in any of:\n    /usr/local/go/src/github.com/mitchellh/cli (from $GOROOT)\n    /go/src/github.com/mitchellh/cli (from $GOPATH)\n</code></pre>\n\n<p>This is unexpected, since I imagine the official Go container would have everything I need. I have these vars set:</p>\n\n<pre><code>~ # set | grep GO\nGOLANG_VERSION='1.11.5'\nGOPATH='/go'\n</code></pre>\n\n<p>The <a href=\"https://github.com/10gen/stitch-cli/blob/master/README.md\" rel=\"nofollow noreferrer\">build instructions</a> say that <code>go build</code> is sufficient to get this working. I have played with <code>go get</code>, with various error outputs, but I think this might be a wild goose chase, since if I had to fetch dependencies manually the instructions would have said so.</p>\n\n<p>For what it's worth though, if I do issue a <code>go get</code> in the container shell, I get this:</p>\n\n<pre><code>~/stitch-cli # go get\ngo get: no install location for directory /root/stitch-cli outside GOPATH\n    For more details see: 'go help gopath'\n</code></pre>\n\n<p>I've tried parsing the material in said help file, but I am not sure what part applies to my case.</p>\n\n<p>So, I wondered if <a href=\"https://stackoverflow.com/a/35966272/472495\">missing <code>GOROOT</code> was worth fixing</a>. I did this:</p>\n\n<pre><code>~/stitch-cli # which go\n/usr/local/go/bin/go\n~/stitch-cli # GOROOT=/usr/local/go\n~/stitch-cli # export GOROOT\n~/stitch-cli # go build\n# _/root/stitch-cli\n./main.go:25:3: cannot use commands.NewWhoamiCommandFactory(ui) (type \"github.com/10gen/stitch-cli/vendor/github.com/mitchellh/cli\".CommandFactory) as type \"github.com/mitchellh/cli\".CommandFactory in map value\n./main.go:26:3: cannot use commands.NewLoginCommandFactory(ui) (type \"github.com/10gen/stitch-cli/vendor/github.com/mitchellh/cli\".CommandFactory) as type \"github.com/mitchellh/cli\".CommandFactory in map value\n./main.go:27:3: cannot use commands.NewLogoutCommandFactory(ui) (type \"github.com/10gen/stitch-cli/vendor/github.com/mitchellh/cli\".CommandFactory) as type \"github.com/mitchellh/cli\".CommandFactory in map value\n./main.go:28:3: cannot use commands.NewExportCommandFactory(ui) (type \"github.com/10gen/stitch-cli/vendor/github.com/mitchellh/cli\".CommandFactory) as type \"github.com/mitchellh/cli\".CommandFactory in map value\n./main.go:29:3: cannot use commands.NewImportCommandFactory(ui) (type \"github.com/10gen/stitch-cli/vendor/github.com/mitchellh/cli\".CommandFactory) as type \"github.com/mitchellh/cli\".CommandFactory in map value\n~/stitch-cli # \n</code></pre>\n\n<p>OK, maybe this is a bit further, but I am now firmly in \"trying random things\" territory. Is there something I can do to have it work out of the box?</p>\n\n<p>I also tried ordinary Alpine (v3.9) with Go manually installed, and that did not even have <code>GOPATH</code> set, but I got much the same \"cannot find package\" errors. What could I try next to get this to compile?</p>\n\n<p>I have also tried switching to the full-fat version of the Golang image, rather than this lighter Alpine image, and I get the same issues, both with <code>build</code> and <code>get</code>.</p>\n\n<p>I could also go back to installing via NPM, but I had problems with that (and that issue would probably be out of scope of a Golang question).</p>\n\n<h2>Possible duplicate</h2>\n\n<p>My question has been identified as a possible duplicate <a href=\"https://stackoverflow.com/questions/38091816\">of this question</a>. I think that question is essentially a duplicate of the secondary problem noted here, which as I mentioned earlier, was probably a red herring. If there are any dups detailing an answer to the first error, that would likely be a better signpost.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1549209681, "post_id": 54504721, "comment_id": 95813164, "body": "The only impact importing an extra package can possibly have, is in compiled output size, and memory usage."}, {"owner": {"reputation": 1224, "user_id": 3572717, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/JAVac.jpg?s=128&g=1", "display_name": "Yoaz Menda", "link": "https://stackoverflow.com/users/3572717/yoaz-menda"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1549210267, "post_id": 54504721, "comment_id": 95813315, "body": "How about an imported package &#39;init&#39; code. Can&#39;t it potentially have code inside there, that will impact the execution of other code? for example, profiling information?"}], "owner": {"reputation": 1224, "user_id": 3572717, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/JAVac.jpg?s=128&g=1", "display_name": "Yoaz Menda", "link": "https://stackoverflow.com/users/3572717/yoaz-menda"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1549209632, "creation_date": 1549209632, "question_id": 54504721, "link": "https://stackoverflow.com/questions/54504721/import-runtime-debug-performance-penalty", "title": "import &quot;runtime/debug&quot; performance penalty", "body": "<p>Will this import statement:</p>\n\n<blockquote>\n  <p>import \"runtime/debug\"</p>\n</blockquote>\n\n<p>have any performance penalty on my application? does it somehow impact the runtime?\nI'm using the 'debug' package to print stack trace in just case of unexpected panic.</p>\n"}, {"tags": ["go", "websocket"], "answers": [{"tags": [], "owner": {"reputation": 409, "user_id": 4476357, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lkPLG1GYS_Q/AAAAAAAAAAI/AAAAAAAAABg/gCmW6uoXgTk/photo.jpg?sz=128", "display_name": "cperez08", "link": "https://stackoverflow.com/users/4476357/cperez08"}, "is_accepted": false, "score": 1, "last_activity_date": 1549212607, "creation_date": 1549212607, "answer_id": 54505202, "question_id": 54504240, "link": "https://stackoverflow.com/questions/54504240/secure-websocket-server-in-go-using-autocert/54505202#54505202", "title": "Secure websocket server in go using autocert", "body": "<p>I'm not sure what is your issue but trying to add the HostPolicy in order to let to the manager know which host is allowed to respond to. here an example <a href=\"https://github.com/kjk/go-cookbook/blob/master/free-ssl-certificates/main.go#L77\" rel=\"nofollow noreferrer\">https://github.com/kjk/go-cookbook/blob/master/free-ssl-certificates/main.go#L77</a> </p>\n\n<p><em>Note: as a suggestion try to use 443 or 8443 as a secure ports.</em></p>\n"}], "owner": {"reputation": 2402, "user_id": 4621142, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/Pa0B7.jpg?s=128&g=1", "display_name": "Bobface", "link": "https://stackoverflow.com/users/4621142/bobface"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549212607, "creation_date": 1549206643, "question_id": 54504240, "link": "https://stackoverflow.com/questions/54504240/secure-websocket-server-in-go-using-autocert", "title": "Secure websocket server in go using autocert", "body": "<p>I am trying to setup a secure websocket server (<code>wss://</code>) in go using <code>acme/autocert</code>. The program starts, but when I try to connect to it I get the following error: </p>\n\n<pre><code>http: TLS handshake error from &lt;IP&gt;: acme/autocert: \nunable to authorize \"&lt;my domain&gt;\"; challenge \"tls-alpn-01\" failed with error: \nacme: authorization error for &lt;my domain&gt;: 403 urn:acme:error:unauthorized:\nCannot negotiate ALPN protocol \"acme-tls/1\" for tls-alpn-01 challenge\n</code></pre>\n\n<p>This is the code I am using to start the websocket server:</p>\n\n<pre><code>func Run() {\n\n    hub = newHub()\n    go hub.run()\n\n    mux := http.NewServeMux()\n\n    mux.HandleFunc(\"/ws\", func(w http.ResponseWriter, r *http.Request) {\n        serveWs(hub, w, r)\n    })\n\n    certManager := autocert.Manager{\n        Prompt: autocert.AcceptTOS,\n        Cache:  autocert.DirCache(\"certs\"),\n    }\n\n    server := &amp;http.Server{\n        Addr:    \":8080\",\n        Handler: mux,\n        TLSConfig: &amp;tls.Config{\n            GetCertificate: certManager.GetCertificate,\n        },\n    }\n\n    go server.ListenAndServeTLS(\"\", \"\")\n}\n</code></pre>\n\n<p>It should automatically get a new certificate when there is none in the cache (<code>certs</code> folder). The error message tells me that there is a problem while negotiating the protocol when creating a new certificate. Do I need to add supported protocols somewhere?</p>\n"}, {"tags": ["go", "rabbitmq", "amqp", "channel", "goroutine"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1549204461, "post_id": 54503834, "comment_id": 95811727, "body": "Channels are used to communicate between goroutines. They don&#39;t make sense in a single goroutine. So yes, of course that&#39;s okay."}, {"owner": {"reputation": 37, "user_id": 10766931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82c0cc360924ba44a4107a31902e2dfe?s=128&d=identicon&r=PG&f=1", "display_name": "George", "link": "https://stackoverflow.com/users/10766931/george"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1549204832, "post_id": 54503834, "comment_id": 95811814, "body": "@Peter i&#39;m not about golang channels, but about rabbitmq channels"}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 10766931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82c0cc360924ba44a4107a31902e2dfe?s=128&d=identicon&r=PG&f=1", "display_name": "George", "link": "https://stackoverflow.com/users/10766931/george"}, "edited": false, "score": 0, "creation_date": 1549294899, "post_id": 54506677, "comment_id": 95841950, "body": "Thanks for reply"}], "tags": [], "owner": {"reputation": 1450, "user_id": 3745422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1746658c4978166acc9dc1d50747cae7?s=128&d=identicon&r=PG", "display_name": "Pietro Martinelli", "link": "https://stackoverflow.com/users/3745422/pietro-martinelli"}, "is_accepted": false, "score": 2, "last_activity_date": 1549221989, "creation_date": 1549221989, "answer_id": 54506677, "question_id": 54503834, "link": "https://stackoverflow.com/questions/54503834/is-it-okay-to-use-one-rabbitmq-channel-for-all-goroutines/54506677#54506677", "title": "Is it okay to use one RabbitMQ channel for all goroutines?", "body": "<p>I'm not a golang-guy, by I use every day RabbitMq with .Net driver; .Net driver <em>channels</em> (an abstraction that encapsulate interactions with queue/exchange and message publishing/subscribing) are very similar to golang RabbitMq <em>channels</em>, so I think my answer can help you.\nWhile <em>connections</em> are <em>tread safe</em> by design and are supposed to be shared between threads, <em>channels</em> are not: so, if different aysnchronous goroutines can be run in different threads (this is up to you: I don't known how golang runtime works) you should not share the same channel instance between them.\nI hope this can help you.</p>\n"}], "owner": {"reputation": 37, "user_id": 10766931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/82c0cc360924ba44a4107a31902e2dfe?s=128&d=identicon&r=PG&f=1", "display_name": "George", "link": "https://stackoverflow.com/users/10766931/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 742, "favorite_count": 0, "closed_date": 1549275141, "answer_count": 1, "score": 2, "last_activity_date": 1549269663, "creation_date": 1549204043, "last_edit_date": 1549205484, "question_id": 54503834, "link": "https://stackoverflow.com/questions/54503834/is-it-okay-to-use-one-rabbitmq-channel-for-all-goroutines", "closed_reason": "Needs details or clarity", "title": "Is it okay to use one RabbitMQ channel for all goroutines?", "body": "<p>I'm doing a message publisher and a receiver to/from rabbitmq queue.\nI'm planning to use one rabbitmq channel for publishing messages and one for fetching, but i also want my code to be asynchronous, is it the right way to use one rabbitmq channel per multiple goroutines?</p>\n"}, {"tags": ["mongodb", "go", "boltdb"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1549202940, "post_id": 54503353, "comment_id": 95811283, "body": "Try redis or redisearch."}, {"owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "edited": false, "score": 0, "creation_date": 1549209620, "post_id": 54503353, "comment_id": 95813140, "body": "Try in memory Sqlite"}, {"owner": {"reputation": 384, "user_id": 2987525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e6f7d5672002a61ac41d8011669ead3?s=128&d=identicon&r=PG&f=1", "display_name": "RichieK", "link": "https://stackoverflow.com/users/2987525/richiek"}, "edited": false, "score": 0, "creation_date": 1549213541, "post_id": 54503353, "comment_id": 95814324, "body": "with sqlite there is a good post at <a href=\"https://stackoverflow.com/questions/1711631/improve-insert-per-second-performance-of-sqlite\" title=\"improve insert per second performance of sqlite\">stackoverflow.com/questions/1711631/&hellip;</a>"}, {"owner": {"reputation": 2071, "user_id": 432152, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/a098ed2b0c3c100e9b66d6b13d6d5d18?s=128&d=identicon&r=PG", "display_name": "Filipe Pina", "link": "https://stackoverflow.com/users/432152/filipe-pina"}, "edited": false, "score": 1, "creation_date": 1549228502, "post_id": 54503353, "comment_id": 95818945, "body": "I tried MySQL and it was worst than mongo, so SQLite wasn\u2019t really an option.. in-memory either as it\u2019s a 100gb file..."}, {"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 0, "creation_date": 1550531519, "post_id": 54503353, "comment_id": 96294909, "body": "@FilipePina, by speed you mean the writing speed to the database ? If so, do you have the app, the database, and file on the same machine ? For MongoDB, you could try inserting all of them first without index, then add a foreground index once done."}, {"owner": {"reputation": 2071, "user_id": 432152, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/a098ed2b0c3c100e9b66d6b13d6d5d18?s=128&d=identicon&r=PG", "display_name": "Filipe Pina", "link": "https://stackoverflow.com/users/432152/filipe-pina"}, "reply_to_user": {"reputation": 384, "user_id": 2987525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e6f7d5672002a61ac41d8011669ead3?s=128&d=identicon&r=PG&f=1", "display_name": "RichieK", "link": "https://stackoverflow.com/users/2987525/richiek"}, "edited": false, "score": 0, "creation_date": 1551309880, "post_id": 54503353, "comment_id": 96598334, "body": "yes, everything in same machine.. I could do that but I can&#39;t use the results while index isn&#39;t over so not sure if there&#39;s any gain from it... but I&#39;ll give it a go thanks. post suggested by @RichieK has very nice improvements on sqlite but it is still so slow..."}], "owner": {"reputation": 2071, "user_id": 432152, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/a098ed2b0c3c100e9b66d6b13d6d5d18?s=128&d=identicon&r=PG", "display_name": "Filipe Pina", "link": "https://stackoverflow.com/users/432152/filipe-pina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 280, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1549200476, "creation_date": 1549200476, "question_id": 54503353, "link": "https://stackoverflow.com/questions/54503353/best-way-to-index-large-file", "title": "Best way to index large file", "body": "<p>I have a file with about 100gb with a <code>word:tag</code> per line. I want to index these on <code>word</code> to easily get the list of <code>tag</code>s for a given word.</p>\n\n<p>I wanted to save this on boltdb (mainly to checkout boltdb) but random write access is bad so I was aiming to index the file in some other way first, then moving all of it to boltdb without need to check for duplicates or de/serialisation of the <code>tag</code> list</p>\n\n<p>So, for reference, if I simply read the file into memory (discarding data), I get about 8 MB/s.</p>\n\n<p>If I write to boltdb files using code such as</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>        line := \"\"\n        linesRead := 0\n        for scanner.Scan() {\n            line = scanner.Text()\n            linesRead += 1\n            data := strings.Split(line, \":\")\n\n            err = bucket.Put([]byte(data[0]), []byte(data[1]))\n            logger.FatalErr(err)\n            // commit on every N lines\n            if linesRead % 10000 == 0 {\n                err = tx.Commit()\n                logger.FatalErr(err)\n                tx, err = db.Begin(true)\n                logger.FatalErr(err)\n                bucket = tx.Bucket(name)\n            }\n        }\n</code></pre>\n\n<p>I get about 300 Kb/s speed and this is not even complete (as it's not adding <code>tag</code> to each <code>word</code>, only stores the last occurrence). So adding the array and JSON serialisation would definitely lower that speed...</p>\n\n<p>So I gave mongodb a try</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>        index := mgo.Index{\n            Key: []string{\"word\"},\n            Unique: true,\n            DropDups: false,\n            Background: true,\n            Sparse: true,\n        }\n        err = c.EnsureIndex(index)\n        logger.FatalErr(err)\n\n        line := \"\"\n        linesRead := 0\n        bulk := c.Bulk()\n\n        for scanner.Scan() {\n            line = scanner.Text()\n            data := strings.Split(line, \":\")\n            bulk.Upsert(bson.M{\"word\": data[0]}, bson.M{\"$push\": bson.M{\"tags\": data[1]}})\n            linesRead += 1\n\n            if linesRead % 10000 == 0 {\n                _, err = bulk.Run()\n                logger.FatalErr(err)\n                bulk = c.Bulk()\n            }\n        }\n</code></pre>\n\n<p>And I get about 300 Kb/s as well (though <code>Upsert</code> and <code>$push</code> here handle appending to the list).</p>\n\n<p>I tried with a local MySQL instance as well (indexed on <code>word</code>) but speed was like 30x slower...</p>\n"}, {"tags": ["go", "keyboard"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1549189933, "post_id": 54501860, "comment_id": 95808070, "body": "There&#39;s no way to do it in that library, but you can wrap it with a goroutine that emualtes this behavior, or use a different method."}, {"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1549200141, "post_id": 54501860, "comment_id": 95810530, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/43965556/how-to-read-a-key-in-go-but-continue-application-if-no-key-pressed-within-x-seco\">How to read a key in Go but continue application if no key pressed within x seconds?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 11008021, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nAMt5.jpg?s=128&g=1", "display_name": "pagislav", "link": "https://stackoverflow.com/users/11008021/pagislav"}, "is_accepted": false, "score": 0, "last_activity_date": 1549205416, "last_edit_date": 1549205416, "creation_date": 1549202522, "answer_id": 54503645, "question_id": 54501860, "link": "https://stackoverflow.com/questions/54501860/how-to-stop-waiting-for-a-keypress-after-a-time/54503645#54503645", "title": "How to stop waiting for a keypress after a time", "body": "<pre><code>func getKeyTimeout(tm time.Duration) (ch rune, err error) {\nif err = keyboard.Open(); err != nil {\n    return\n}\ndefer keyboard.Close()\n\nvar (\n    chChan  = make(chan rune, 1)\n    errChan = make(chan error, 1)\n)\n\ngo func(chChan chan&lt;- rune, errChan chan&lt;- error) {\n    ch, _, err := keyboard.GetSingleKey()\n    if err != nil {\n        errChan &lt;- err\n        return\n    }\n    chChan &lt;- ch\n}(chChan, errChan)\n\nselect {\ncase &lt;-time.After(tm):\n    return 0, err\ncase ch = &lt;-chChan:\ncase err = &lt;-errChan:\n}\n\nreturn\n}\n\nch, err := tools.GetKey(time.Millisecond * n)\nif err != nil {\n    panic(err)\n}\nif ch != rune(0) {\n    fmt.Printf(\"You pressed: %q\\r\\n\", ch)\n} else {\n      fmt.Printf(\"Key was not pressed\")\n}\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 11008021, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nAMt5.jpg?s=128&g=1", "display_name": "pagislav", "link": "https://stackoverflow.com/users/11008021/pagislav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549205416, "creation_date": 1549189009, "last_edit_date": 1549189471, "question_id": 54501860, "link": "https://stackoverflow.com/questions/54501860/how-to-stop-waiting-for-a-keypress-after-a-time", "title": "How to stop waiting for a keypress after a time", "body": "<p>I use this code in my project, but keyboard.GetSingleKey() waiting keystroke. How to make the function not wait for a keypress and return nil (for example, after 1 second)?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/eiannone/keyboard\"\n)\nfunc main() {\n    char, _, err := keyboard.GetSingleKey()\n    if (err != nil) {\n         panic(err)\n    }\n    fmt.Printf(\"You pressed: %q\\r\\n\", char)\n}\n</code></pre>\n\n<p>If key was not pressed output \"Key was not pressed\",but in another case output \"You pressed: \" and key name</p>\n"}, {"tags": ["json", "go", "jwt"], "answers": [{"tags": [], "owner": {"reputation": 18287, "user_id": 1029453, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/x570w.jpg?s=128&g=1", "display_name": "Richard Huxton", "link": "https://stackoverflow.com/users/1029453/richard-huxton"}, "is_accepted": false, "score": 1, "last_activity_date": 1549182238, "creation_date": 1549182238, "answer_id": 54501108, "question_id": 54500948, "link": "https://stackoverflow.com/questions/54500948/sending-a-sms-to-a-phone-number-taking-from-data-base-the-code-is-not-working/54501108#54501108", "title": "sending a sms to a phone number taking from data base. the code is not working", "body": "<p>This is a very vague question, and in computing precision matters. WHAT doesn't work? Did you try debugging your code in any way? You will need to learn how to test and debug code or programming will be very frustrating for you.</p>\n\n<p>In this case, if that is the code you are actually running then the problem looks to be with your query. I know nothing of <code>gorp</code> but you have a query with three parameters there and aren't providing any of them. I don't see how you can get any rows returned from that. It may be you need a separate \"Execute\" call or some such - check the documentation. If you don't get any rows then the message sending loop will never do anything.</p>\n"}], "owner": {"reputation": 11, "user_id": 11007767, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-P8XxVQs9VIs/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPCmnChq_eakesVXgbCwLdrSi-dEg/mo/photo.jpg?sz=128", "display_name": "neeraj sati", "link": "https://stackoverflow.com/users/11007767/neeraj-sati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "closed_date": 1549192303, "answer_count": 1, "score": -1, "last_activity_date": 1549184456, "creation_date": 1549180475, "last_edit_date": 1549184456, "question_id": 54500948, "link": "https://stackoverflow.com/questions/54500948/sending-a-sms-to-a-phone-number-taking-from-data-base-the-code-is-not-working", "closed_reason": "Not suitable for this site", "title": "sending a sms to a phone number taking from data base. the code is not working", "body": "<p>while trying to send sms code it is not working but when i put the url in browser the status is success. while i m integrating it with my app it is not working and i am using postgresql to access the details.</p>\n\n<pre><code>package controllers\n\nimport (\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/go-gorp/gorp\"\n    _ \"github.com/go-sql-driver/mysql\"\n    //\"github.com/streetcom/app/log\"\n)\n\nvar (\n    Dbm *gorp.DbMap\n)\n\nfunc Sendsms(msg string) {\n    rows, err := Dbm.Query(\"Select mobile_number from alert WHERE name=$1 AND email=$2 AND mobile_number=$3\")\n    defer rows.Close()\n    if err != nil {\n        log.Println(err.Error())\n    } else {\n        for rows.Next() {\n            var mobile_number string\n            err = rows.Scan(&amp;mobile_number)\n            if err != nil {\n                log.Println(err.Error())\n            } else {\n                response, err := http.Get(\"https://api.textlocal.in/send/?apikey=redacted&amp;sender=TXTLCL&amp;numbers=\" + mobile_number + \"&amp;message=\" + msg)\n                if err != nil {\n                    log.Println(err)\n\n                } else {\n                    defer response.Body.Close()\n                    contents, err := ioutil.ReadAll(response.Body)\n                    if err != nil {\n                        log.Println(err)\n                    } else {\n                        log.Printf(\"%s\\n\", string(contents))\n                    }\n\n                }\n            }\n\n        }\n\n    }\n\n}\n</code></pre>\n"}, {"tags": ["go", "sqlx", "go-cobra"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1549177038, "post_id": 54499965, "comment_id": 95805785, "body": "You should call NewDB if, when, and where you need it. init is the worst choice by far. You don&#39;t want to establish a database connection if --help is given, for instance."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 1, "creation_date": 1549185885, "post_id": 54499965, "comment_id": 95807269, "body": "The information that you are using cobra  is not relevant here. You could also create your app with the flag package. It would be helpful what your app does and how long does it run. If it is a server you should also check if the connection is still alive, if it just runs for loading data into a file and quits after that you just call NewDB when you need it."}, {"owner": {"reputation": 16093, "user_id": 534298, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4ba32c06ed067564a6c6512de5217657?s=128&d=identicon&r=PG", "display_name": "nos", "link": "https://stackoverflow.com/users/534298/nos"}, "reply_to_user": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1549194375, "post_id": 54499965, "comment_id": 95809084, "body": "@apxp There is no long-running server for this app. It is a command line client to query db. Thank you both for the good points and I will call <code>NewDB</code> wherever it&#39;s needed"}], "owner": {"reputation": 16093, "user_id": 534298, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/4ba32c06ed067564a6c6512de5217657?s=128&d=identicon&r=PG", "display_name": "nos", "link": "https://stackoverflow.com/users/534298/nos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 135, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1549168130, "creation_date": 1549168130, "question_id": 54499965, "link": "https://stackoverflow.com/questions/54499965/where-should-a-sqlx-db-object-be-save-for-a-cobra-application", "title": "Where should a *sqlx.DB object be save for a cobra application?", "body": "<p>I have a cobra project which accesses database using <code>sqlx</code> package, and the command has sub-commands. The cobra related code is in the <code>cmd</code> folder/subpackage and the DB related code is in the <code>db</code> folder/subpackage.</p>\n\n<p>I would like to have package db to have a factory function</p>\n\n<pre><code>func NewDB() *sqlx.DB\n</code></pre>\n\n<p>which is called somewhere from the <code>cmd</code> package. But I am not sure where to call it and how to make it available to all sub-commands.</p>\n\n<p>One idea is to have a global variable in the <code>cmd</code> package, and initialize it either in <code>root.go</code>'s <code>init()</code> or <code>rootCmd</code>'s <code>PersistentPreRun</code>. Is it bad to use global variable in this case?</p>\n\n<p>If I don't use global variable, \none possibility is to have the sub-commands call <code>db.NewDB()</code>. Somehow it doesn't feel very nice this way either.</p>\n\n<p>I find it nicer to call <code>db.NewDB()</code> once in <code>cmd</code> package, probably in <code>root.go</code>. But where should I save the DB handle such that sub-commands can use it? </p>\n"}, {"tags": ["go", "app-engine-flexible"], "comments": [{"owner": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 0, "creation_date": 1549167675, "post_id": 54499650, "comment_id": 95804650, "body": "Have you initialized the module in the directory before changing the version to 1.11? Try <code>go mod init hello_world</code> in the app and try it again. Maybe it will solve this."}], "answers": [{"comments": [{"owner": {"reputation": 1973, "user_id": 72721, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/87bd5e904102ed9355e67afc0d1463e8?s=128&d=identicon&r=PG&f=1", "display_name": "Rohith", "link": "https://stackoverflow.com/users/72721/rohith"}, "edited": false, "score": 1, "creation_date": 1549194876, "post_id": 54501986, "comment_id": 95809195, "body": "Thanks - that worked! I originally followed the documentation here: <a href=\"https://cloud.google.com/appengine/docs/standard/go111/config/appref\" rel=\"nofollow noreferrer\">cloud.google.com/appengine/docs/standard/go111/config/appref</a> - which  says runtime: go111. I realise now that that is for the standard app engine. Would&#39;ve been nice if they stuck to the same naming convention for standard and flex."}, {"owner": {"reputation": 6155, "user_id": 4378314, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/7935867003690df779b06563293f6293?s=128&d=identicon&r=PG", "display_name": "MarsAndBack", "link": "https://stackoverflow.com/users/4378314/marsandback"}, "edited": false, "score": 0, "creation_date": 1567135954, "post_id": 54501986, "comment_id": 101881552, "body": "This got me as well. I was reading their docs and thought it strange."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 5, "last_activity_date": 1549202792, "last_edit_date": 1549202792, "creation_date": 1549190249, "answer_id": 54501986, "question_id": 54499650, "link": "https://stackoverflow.com/questions/54499650/deploying-helloworld-to-app-engine-flexible-with-go111-fails/54501986#54501986", "title": "Deploying helloworld to app engine flexible with go111 fails", "body": "<blockquote>\n  <p><strong>App Engine Documentation Go Flexible Environment</strong> </p>\n  \n  <p><a href=\"https://cloud.google.com/appengine/docs/flexible/go/reference/app-yaml#general\" rel=\"noreferrer\">app.yaml Configuration File</a> </p>\n  \n  <p>runtime: go   </p>\n  \n  <p>This setting is required. It is the name of the App\n  Engine language runtime used by this application. To specify Go, use\n  go, and it will default to the latest supported Go version;\n  alternatively, specify one of the following supported release\n  versions: go1.10, go1.9, or go1.8.</p>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p>I want to use go1.11, so I changed the app.yaml to say runtime: go111 </p>\n  \n  <p>ERROR: (gcloud.app.deploy) Your application does not satisfy all of\n  the requirements for a runtime of type [go111].  Please correct the\n  errors and try again.</p>\n</blockquote>\n\n<p>Think about it for a moment. Is runtime of type <code>go111</code> <code>go1.11</code> or <code>go11.1</code>?</p>\n\n<hr>\n\n<p>Read the error message.</p>\n\n<blockquote>\n  <p><code>ERROR: runtime of type [go111]</code>.</p>\n</blockquote>\n\n<p>Read the documentation. </p>\n\n<blockquote>\n  <p>specify one of the following supported release versions: go1.10</p>\n</blockquote>\n\n<p>Which would make Go 1.11 <code>go1.11</code>.</p>\n\n<p>You used <code>go111</code> and got</p>\n\n<pre><code>ERROR: runtime of type [go111].\n</code></pre>\n\n<p>What happens if you follow the instructions in the documentation and use <code>go1.11</code> for Go 1.11?</p>\n"}], "owner": {"reputation": 1973, "user_id": 72721, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/87bd5e904102ed9355e67afc0d1463e8?s=128&d=identicon&r=PG&f=1", "display_name": "Rohith", "link": "https://stackoverflow.com/users/72721/rohith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1017, "favorite_count": 1, "accepted_answer_id": 54501986, "answer_count": 1, "score": 1, "last_activity_date": 1549202792, "creation_date": 1549163651, "last_edit_date": 1549195011, "question_id": 54499650, "link": "https://stackoverflow.com/questions/54499650/deploying-helloworld-to-app-engine-flexible-with-go111-fails", "title": "Deploying helloworld to app engine flexible with go111 fails", "body": "<p>I'm attempting to deploy the helloworld app (source code <a href=\"https://github.com/GoogleCloudPlatform/golang-samples/tree/master/appengine_flexible/helloworld\" rel=\"nofollow noreferrer\">here</a>) to app engine flexible. When I deploy this without any changes to the code, everything works fine. But I want to use go1.11, so I changed the app.yaml to say </p>\n\n<pre><code>runtime: go111    # changed from runtime: go\n</code></pre>\n\n<p>and I get the error:</p>\n\n<pre><code>Beginning deployment of service [default]...\nBuilding and pushing image for service [default]\nERROR: (gcloud.app.deploy) Your application does not satisfy all of the requirements for a runtime of type [go111].  Please correct the errors and try again.\n</code></pre>\n\n<p>This is not a very helpful error message and googling hasn't helped so far as well. What can I do to debug/fix this issue?</p>\n"}, {"tags": ["go", "datetime-format"], "answers": [{"tags": [], "owner": {"reputation": 6598, "user_id": 504717, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/598508c7ef12ece4ca6c1c0f542e5dcd?s=128&d=identicon&r=PG", "display_name": "Em Ae", "link": "https://stackoverflow.com/users/504717/em-ae"}, "is_accepted": true, "score": 3, "last_activity_date": 1549159264, "last_edit_date": 1549159264, "creation_date": 1549158726, "answer_id": 54499265, "question_id": 54499195, "link": "https://stackoverflow.com/questions/54499195/how-to-format-current-time-into-yyyy-mm-ddthhmmssz/54499265#54499265", "title": "How to format current time into YYYY-MM-DDTHH:MM:SSZ", "body": "<p>Go provides very flexible way to parse the time by example. For this, you have to write the \"reference\" time in the format of your choice. The reference time is <code>Mon Jan 2 15:04:05 MST 2006</code>. In my case, I used this reference time to parse the <code>Now()</code>:</p>\n\n<pre><code>fmt.Println(time.Now().UTC().Format(\"2006-01-02T15:04:05Z\"))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5880, "user_id": 166233, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b88b1c85a798a2aee3a35f5cd805d0e2?s=128&d=identicon&r=PG", "display_name": "Steve Wilhelm", "link": "https://stackoverflow.com/users/166233/steve-wilhelm"}, "is_accepted": false, "score": 1, "last_activity_date": 1549175332, "creation_date": 1549175332, "answer_id": 54500512, "question_id": 54499195, "link": "https://stackoverflow.com/questions/54499195/how-to-format-current-time-into-yyyy-mm-ddthhmmssz/54500512#54500512", "title": "How to format current time into YYYY-MM-DDTHH:MM:SSZ", "body": "<p>\"If a time is in Coordinated Universal Time (UTC), a \"Z\" is added directly after the time without a separating space. \"Z\" is the zone designator for the zero UTC offset. \"09:30 UTC\" is therefore represented as \"09:30Z\" or \"0930Z\". Likewise, \"14:45:15 UTC\" is written as \"14:45:15Z\" or \"144515Z\".[16]\"</p>\n\n<p>From <a href=\"https://en.wikipedia.org/wiki/Time_zone#UTC\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Time_zone#UTC</a></p>\n\n<pre><code>// Some valid layouts are invalid time values for time.Parse, due to formats\n// such as _ for space padding and Z for zone information.\n</code></pre>\n\n<p>and</p>\n\n<pre><code>// Replacing the sign in the format with a Z triggers\n// the ISO 8601 behavior of printing Z instead of an\n// offset for the UTC zone. Thus:\n//  Z0700  Z or \u00b1hhmm\n//  Z07:00 Z or \u00b1hh:mm\n//  Z07    Z or \u00b1hh\n</code></pre>\n\n<p>From the source for package <a href=\"https://golang.org/src/time/format.go\" rel=\"nofollow noreferrer\">time/format.go</a></p>\n"}], "owner": {"reputation": 6598, "user_id": 504717, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/598508c7ef12ece4ca6c1c0f542e5dcd?s=128&d=identicon&r=PG", "display_name": "Em Ae", "link": "https://stackoverflow.com/users/504717/em-ae"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1745, "favorite_count": 0, "accepted_answer_id": 54499265, "answer_count": 2, "score": 1, "last_activity_date": 1549175332, "creation_date": 1549157938, "last_edit_date": 1549158339, "question_id": 54499195, "link": "https://stackoverflow.com/questions/54499195/how-to-format-current-time-into-yyyy-mm-ddthhmmssz", "title": "How to format current time into YYYY-MM-DDTHH:MM:SSZ", "body": "<p>Never tried Go before and currently doing a small project. One of the task is to get current system time and represent it in <code>YYYY-MM-DDT00:00:00Z</code> format. I believe that <code>Z</code> means that time is represented in UTC format but when i looked into db, all timestamps are like this i.e., <code>2011-11-22T15:22:10Z</code>. </p>\n\n<p>So how can i format like this in Go?</p>\n\n<p><em>Update</em>\nI was able to format it using following code</p>\n\n<pre><code>t := time.Now()\nfmt.Println(t.Format(\"2006-01-02T15:04:05Z\"))\n</code></pre>\n\n<p>Now the question remains, what <code>Z</code> signifies here. Should i get UTC Time? </p>\n\n<p>Another question, it looks like that the value i am using to format impacts the output i.e., when i used <code>2019-01-02T15:04:05Z</code> the output became <code>2029-02-02T20:45:11Z</code>, why?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1549193618, "post_id": 54498962, "comment_id": 95808891, "body": "There&#39;s no such thing as a global variable in Go. Only package variables."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1549193704, "post_id": 54498962, "comment_id": 95808907, "body": "A better approach, though, is dependency injection. Pass your variable into the function(s) that need it, rather than relying on global state. Global state is (usually) evil."}], "answers": [{"comments": [{"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "reply_to_user": {"reputation": 1176, "user_id": 951321, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9eb886c753c17c33ba7fd8061af43e3f?s=128&d=identicon&r=PG", "display_name": "markhorrocks", "link": "https://stackoverflow.com/users/951321/markhorrocks"}, "edited": false, "score": 1, "creation_date": 1549156251, "post_id": 54498991, "comment_id": 95803093, "body": "@markhorrocks: yes, a helper package makes sense if it&#39;s being used from more than one package"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1549292821, "post_id": 54498991, "comment_id": 95840751, "body": "It&#39;s not highly unusual, it&#39;s impossible. You cannot import <code>main</code> from another package. It&#39;s a hard compiler rule, but even if it weren&#39;t it would still be impossible - <code>main</code> is the entry point of every application, so any reachable package importing <code>main</code> would be creating a circular dependency."}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 2, "last_activity_date": 1549312926, "last_edit_date": 1549312926, "creation_date": 1549155399, "answer_id": 54498991, "question_id": 54498962, "link": "https://stackoverflow.com/questions/54498962/golang-global-variable-of-type-html-template-not-defined-in-other-packages/54498991#54498991", "title": "Golang global variable of type html/template not defined in other packages", "body": "<p><code>tmpl</code> will not be visible from another package. To import variables from other packages you have to refer to them by a fully qualified name and have the variables start with an uppercase letter, <code>pack.Tmpl</code> etc.</p>\n\n<p>Also it's impossible to import variables from <code>main</code> into other packages.</p>\n"}, {"tags": [], "owner": {"reputation": 1176, "user_id": 951321, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9eb886c753c17c33ba7fd8061af43e3f?s=128&d=identicon&r=PG", "display_name": "markhorrocks", "link": "https://stackoverflow.com/users/951321/markhorrocks"}, "is_accepted": false, "score": 0, "last_activity_date": 1549159902, "creation_date": 1549159902, "answer_id": 54499356, "question_id": 54498962, "link": "https://stackoverflow.com/questions/54498962/golang-global-variable-of-type-html-template-not-defined-in-other-packages/54499356#54499356", "title": "Golang global variable of type html/template not defined in other packages", "body": "<p>This is the solution I used for declaring templates in a helper package:</p>\n\n<pre><code>package helpers\n\nimport (\n    \"html/template\"\n    \"log\"\n)\n\n// Tmpl global template var\nvar Tmpl = template.New(\"master\")\n\nfunc init() {\n    _, err := Tmpl.ParseGlob(\"templates/*.html\")\n    if err != nil {\n        log.Fatalln(\"Error loading templates:\", err)\n    }\n}\n</code></pre>\n\n<p>Then in my controllers package:</p>\n\n<pre><code>package controllers\n\nimport (\n        \"myapp/helpers\"\n)\n\nsomeFunc() {\n.... \nhelpers.Tmpl.ExecuteTemplate(w, \"header.html\", nil)\n....\n} \n</code></pre>\n"}], "owner": {"reputation": 1176, "user_id": 951321, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9eb886c753c17c33ba7fd8061af43e3f?s=128&d=identicon&r=PG", "display_name": "markhorrocks", "link": "https://stackoverflow.com/users/951321/markhorrocks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 133, "favorite_count": 0, "accepted_answer_id": 54498991, "answer_count": 2, "score": -2, "last_activity_date": 1549312926, "creation_date": 1549155061, "question_id": 54498962, "link": "https://stackoverflow.com/questions/54498962/golang-global-variable-of-type-html-template-not-defined-in-other-packages", "title": "Golang global variable of type html/template not defined in other packages", "body": "<p>I have declared a global var as suggested in this question <a href=\"https://stackoverflow.com/questions/15352130/is-it-necessary-to-put-templates-into-a-map-for-reusing-in-go\">Is it necessary to put templates into a map for reusing in Go?</a></p>\n\n<p>I declared the global var in my main package before <code>func main()</code> but it is still not declared in another package.</p>\n\n<pre><code>package main\n\nimport{\n  \"html/template\"\n  .....\n)\n\nvar tmpl = template.New(\"master\")\n\nfunc main() {\n\n    func init() {\n\n        _, err := tmpl.ParseGlob(\"templates/*.html\")\n        if err != nil {\n            log.Fatalln(\"Error loading templates:\", err)\n        }\n....\n}    \n</code></pre>\n\n<p>In another package I write inside a function:</p>\n\n<pre><code>    tmpl.ExecuteTemplate(w, \"venue-index.html\", res)\n</code></pre>\n\n<p>but I get an error </p>\n\n<blockquote>\n  <p>tmpl: undefined</p>\n</blockquote>\n\n<p>I realise that there are other similar questions but the answers have not solved my problem. What am I doing wrong?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 1, "creation_date": 1549155247, "post_id": 54498942, "comment_id": 95802925, "body": "this block gives an error, I&#39;m currently testing. I haven&#39;t used it before , but maybe you can fix it and edit your code"}, {"owner": {"reputation": 871, "user_id": 2508466, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/UHx7w.jpg?s=128&g=1", "display_name": "yaccob", "link": "https://stackoverflow.com/users/2508466/yaccob"}, "edited": false, "score": 0, "creation_date": 1549155406, "post_id": 54498942, "comment_id": 95802953, "body": "It&#39;s funny, because this was my very first attempt. It doesn&#39;t work because go says correctly: &quot;Impossible type switch case: &#39;os.File&#39; does not implement &#39;io.Reader&#39;&quot;"}, {"owner": {"reputation": 1677, "user_id": 4105099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/383350df3cda0186e32237dfc271490e?s=128&d=identicon&r=PG&f=1", "display_name": "jan.vogt", "link": "https://stackoverflow.com/users/4105099/jan-vogt"}, "edited": false, "score": 0, "creation_date": 1549155568, "post_id": 54498942, "comment_id": 95802976, "body": "os.File is actually an *os.File, and you have to import all necessary packages"}, {"owner": {"reputation": 1677, "user_id": 4105099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/383350df3cda0186e32237dfc271490e?s=128&d=identicon&r=PG&f=1", "display_name": "jan.vogt", "link": "https://stackoverflow.com/users/4105099/jan-vogt"}, "edited": false, "score": 0, "creation_date": 1549155640, "post_id": 54498942, "comment_id": 95802994, "body": "Go Playgrounds don&#39;t support files, but at least it compiles... <a href=\"https://play.golang.org/p/ApPuB33iDrd\" rel=\"nofollow noreferrer\">play.golang.org/p/ApPuB33iDrd</a>"}, {"owner": {"reputation": 871, "user_id": 2508466, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/UHx7w.jpg?s=128&g=1", "display_name": "yaccob", "link": "https://stackoverflow.com/users/2508466/yaccob"}, "edited": false, "score": 0, "creation_date": 1549155928, "post_id": 54498942, "comment_id": 95803041, "body": "Wow! That&#39;s it. Obviously both of us missed the * - but you noticed it while I didn&#39;t :-) Thanks, now it works"}, {"owner": {"reputation": 1677, "user_id": 4105099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/383350df3cda0186e32237dfc271490e?s=128&d=identicon&r=PG&f=1", "display_name": "jan.vogt", "link": "https://stackoverflow.com/users/4105099/jan-vogt"}, "edited": false, "score": 0, "creation_date": 1549156050, "post_id": 54498942, "comment_id": 95803055, "body": "You&#39;re welcome! Glad it worked. Would you consider marking it as the accepted answer, by clicking the checkmark? Thanks."}], "tags": [], "owner": {"reputation": 1677, "user_id": 4105099, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/383350df3cda0186e32237dfc271490e?s=128&d=identicon&r=PG&f=1", "display_name": "jan.vogt", "link": "https://stackoverflow.com/users/4105099/jan-vogt"}, "is_accepted": true, "score": 2, "last_activity_date": 1549155891, "last_edit_date": 1549155891, "creation_date": 1549154777, "answer_id": 54498942, "question_id": 54498899, "link": "https://stackoverflow.com/questions/54498899/how-can-i-implement-an-interface-for-the-union-of-2-or-more-types/54498942#54498942", "title": "How can I implement an interface for the union of 2 (or more) types?", "body": "<p>You're looking for the <a href=\"https://golang.org/doc/effective_go.html#type_switch\" rel=\"nofollow noreferrer\">type switch</a> control structure.</p>\n\n<p>Your <code>printFilenameIfReaderIsFile</code> function should look like (not actually checked):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func printFilenameIfReaderIsFile(reader io.Reader) {\n  switch f := reader.(type) {\n    case *os.File:\n      // f is now *os.File (not a os.File!)\n      fmt.Printf(\"%s\\n\", f.Name())\n  }\n}\n</code></pre>\n\n<p>EDIT: Don't forget, that <code>os.Open</code> returns a <code>*os.File</code> instead of an <code>os.File</code> <a href=\"https://golang.org/pkg/os/#Open\" rel=\"nofollow noreferrer\">see docs</a>!</p>\n"}], "owner": {"reputation": 871, "user_id": 2508466, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/UHx7w.jpg?s=128&g=1", "display_name": "yaccob", "link": "https://stackoverflow.com/users/2508466/yaccob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 54498942, "answer_count": 1, "score": 2, "last_activity_date": 1549155891, "creation_date": 1549154008, "question_id": 54498899, "link": "https://stackoverflow.com/questions/54498899/how-can-i-implement-an-interface-for-the-union-of-2-or-more-types", "title": "How can I implement an interface for the union of 2 (or more) types?", "body": "<p>To be more concrete:</p>\n\n<p>I have 2 Readers. One I get from os.Open(\"someExistingFile\") and the other one from strings.NewReader(\"hello world\").</p>\n\n<p>One of them implemets Name(), the other one doesn't. I want to either make the other one also implement Name() (e.g. returning \"\") or (preferred) only call Name() if the type of the actual parameter supports it. </p>\n\n<p>I hope the code fragment below indicates clearly what I want to solve.</p>\n\n<p>I played around with different receivers, even with reflection but I didn't get to the point ...</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"io\"\n    \"os\"\n    \"strings\"\n)\n\nfunc main() {\n    stringReader := strings.NewReader(\"hello world\")\n    fileReader, _ := os.Open(\"someExistingFile\") // error handling omitted\n    fileReader.Name()\n\n    printFilenameIfReaderIsFile(stringReader)\n    printFilenameIfReaderIsFile(fileReader)\n}\n\nfunc printFilenameIfReaderIsFile(reader io.Reader) {\n    // here I want to ...\n    // ... either check if this reader is of type os.File and in this case call its Name() method (preferred)\n    // ... or use a custom type instead of io.Reader.\n    //     This type's Name() method should return the filename for fileReader and nil for stringReader.\n}\n</code></pre>\n"}, {"tags": ["go", "testing"], "answers": [{"tags": [], "owner": {"reputation": 5880, "user_id": 166233, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b88b1c85a798a2aee3a35f5cd805d0e2?s=128&d=identicon&r=PG", "display_name": "Steve Wilhelm", "link": "https://stackoverflow.com/users/166233/steve-wilhelm"}, "is_accepted": false, "score": 1, "last_activity_date": 1549145582, "creation_date": 1549145582, "answer_id": 54498032, "question_id": 54497932, "link": "https://stackoverflow.com/questions/54497932/is-it-possible-to-change-the-value-of-os-args-so-i-can-add-tests-to-the-cli-that/54498032#54498032", "title": "Is it possible to change the value of os.Args so I can add tests to the CLI that I&#39;m creating?", "body": "<p>I think the answer to the previous question <a href=\"https://stackoverflow.com/questions/33723300/how-to-test-the-passing-of-arguments-in-golang\">How to test the passing of arguments in Golang?</a> describes how to modify the os.Args during testing.</p>\n\n<p><a href=\"https://stackoverflow.com/users/847869/tomasz\">tomasz</a> states \" the very first value in os.Args is a (path to) executable itself, so os.Args = []string{\"cmd\", \"-user=bla\"} should fix your issue. You can take a look at <a href=\"https://golang.org/src/flag/flag_test.go#L318\" rel=\"nofollow noreferrer\">flag test</a> from the standard package where they're doing something similar.\"</p>\n"}], "owner": {"reputation": 55, "user_id": 8431001, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23396f07b186686733ca6899622e5a26?s=128&d=identicon&r=PG&f=1", "display_name": "920smmsmsms", "link": "https://stackoverflow.com/users/8431001/920smmsmsms"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 915, "favorite_count": 0, "closed_date": 1549209895, "answer_count": 1, "score": 0, "last_activity_date": 1549145582, "creation_date": 1549144775, "question_id": 54497932, "link": "https://stackoverflow.com/questions/54497932/is-it-possible-to-change-the-value-of-os-args-so-i-can-add-tests-to-the-cli-that", "closed_reason": "Duplicate", "title": "Is it possible to change the value of os.Args so I can add tests to the CLI that I&#39;m creating?", "body": "<p>Is it possible to change the value of <code>os.Args</code> globally in a Golang program? I'm writting a library like Cobra just for fun, and internally I make use of <code>os.Args</code> to parse the command-line arguments. I would like to do that to properly test the parser.</p>\n\n<p>Currently what I am doing is manually changing the internal variable of my package, but that's a bad practice.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["go", "openssh"], "answers": [{"comments": [{"owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 0, "creation_date": 1549163493, "post_id": 54497701, "comment_id": 95804075, "body": "You can see the complete code in my question. Stdout is shown in the screen otherwise I would not see the the password prompt. It is handled automatically, so I assume stdin and stdout should be too. I do not want to create a new ssh, especially because I do not even know what Ansible needs. How would I connect the received stderr and stdout to the caller of my program ?"}, {"owner": {"reputation": 561, "user_id": 784060, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8e0323646a1c6c7acf5d83aac6a6cdf3?s=128&d=identicon&r=PG", "display_name": "Joshua Vega", "link": "https://stackoverflow.com/users/784060/joshua-vega"}, "reply_to_user": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 0, "creation_date": 1549166143, "post_id": 54497701, "comment_id": 95804443, "body": "@Marged if you want to propagate the error up you can write to <code>os.Stdout</code> and <code>os.Stderr</code> by using <code>fmt.Fprint</code>. Something like <code>fmt.Fprint(os.Stderr, stderr.String())</code>. This will require you to capture <code>cmd.Stdout</code> and <code>cmd.Stderr</code> as I did in my sample code."}, {"owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 0, "creation_date": 1549191554, "post_id": 54497701, "comment_id": 95808426, "body": "Thank you. Does this cause problems with long running tasks. If I understand you correctly this would gather all output and send it when the called program exits. Can it be done &quot;live&quot; ? And how would I use this in stdin ?"}, {"owner": {"reputation": 561, "user_id": 784060, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8e0323646a1c6c7acf5d83aac6a6cdf3?s=128&d=identicon&r=PG", "display_name": "Joshua Vega", "link": "https://stackoverflow.com/users/784060/joshua-vega"}, "reply_to_user": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "edited": false, "score": 0, "creation_date": 1549229814, "post_id": 54497701, "comment_id": 95819293, "body": "@Marged In that case, I believe <code>exec.Command.StdoutPipe()</code> and the similar functions are what you&#39;re interested in as they allow you to dynamically read and write data to the command until the command exits. Additionally, <code>golang.org&#47;x&#47;crypto&#47;ssh</code> also provides <code>StdoutPipe()</code> and such as member functions of the <code>ssh.Session</code> struct."}], "tags": [], "owner": {"reputation": 561, "user_id": 784060, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8e0323646a1c6c7acf5d83aac6a6cdf3?s=128&d=identicon&r=PG", "display_name": "Joshua Vega", "link": "https://stackoverflow.com/users/784060/joshua-vega"}, "is_accepted": false, "score": 1, "last_activity_date": 1549142928, "creation_date": 1549142928, "answer_id": 54497701, "question_id": 54497528, "link": "https://stackoverflow.com/questions/54497528/called-program-fails-if-run-through-os-exec/54497701#54497701", "title": "Called program fails if run through os.exec", "body": "<p>Are you capturing <code>Stdout</code> and <code>Stderr</code> from <code>cmd</code>? This is where the respective outputs of the command is sent to. The documentation for <a href=\"https://golang.org/pkg/os/exec/#Command\" rel=\"nofollow noreferrer\">exec.Command</a> has a really good example on this.</p>\n\n<p>In your case, you'll also want to setup <code>Stdin</code> so that you can pass the password for example.</p>\n\n<p>Here's a really basic example based on your code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n  \"bytes\"\n  \"fmt\"\n  \"log\"\n  \"os\"\n  \"os/exec\"\n)\n\nfunc main() {\n  params := os.Args[1:]\n  fmt.Println(\"Passing this to ssh: %s\", params)\n\n  var stdin  bytes.Buffer\n  var stdout bytes.Buffer\n  var stderr bytes.Bufer\n\n  cmd := exec.Command(\"ssh\", params...)\n  cmd.Stdin  = &amp;stdin\n  cmd.Stdout = &amp;stdout\n  cmd.Stderr = &amp;stderr\n\n  if err := cmd.Run(); err != nil {\n    log.Fatal(err)\n  }\n\n  fmt.Println(\"Stdout: %s\", stdout.String())\n  fmt.Println(\"stderr: %s\", stderr.String())\n}\n</code></pre>\n\n<p>Since <code>stdin</code>, <code>stdout</code>, and <code>stderr</code> are all <code>bytes.Buffer</code>s, you can read and write from them just like any other buffer.</p>\n\n<p>You might also want to consider using the <code>golang.org/x/crypto/ssh</code> package which provides a native SSH interface for Go instead of using sub-processes.</p>\n"}], "owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549142928, "creation_date": 1549141683, "question_id": 54497528, "link": "https://stackoverflow.com/questions/54497528/called-program-fails-if-run-through-os-exec", "title": "Called program fails if run through os.exec", "body": "<p>I am not sure if this is a problem of the called program or if the problem is caused by the way I call the program. Because of this I start at the source code.</p>\n\n<p>I need to call ssh from a program (if you are interested in the reasons I will mention them below) but ssh silently exits.</p>\n\n<p>When I call <code>ssh -v user@remotehost</code> from shell this succeeds:</p>\n\n<ul>\n<li>the wanted debug output on stderr is shown</li>\n<li>I am asked for the password</li>\n<li>I can see the remote hosts shell</li>\n</ul>\n\n<p>But when I do the same from within my program (<code>myssh -v user@remotehost</code> only this happens:</p>\n\n<ul>\n<li>I am asked for the password</li>\n</ul>\n\n<p>Neither the debug output on stderr is shown  nor do I reach the remote hosts shell.</p>\n\n<p>This is my sourcecode:</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"log\"\n        \"os\"\n        \"os/exec\"\n)\n\nfunc main() {\n        params := os.Args[1:]\n        fmt.Printf(\"passing this to ssh: %s\\n\", params)\n        cmd := exec.Command(\"ssh\", params...)\n        err := cmd.Run()\n        if err != nil {\n                log.Fatal(err)\n        }\n}\n</code></pre>\n\n<p><em>Reason why I wrote this code: I use Ansible which calls ssh. I need to \"manipulate\" the parameters that Ansible passes to ssh. So far I asked on the OpenSSH  and Ansible mailing lists, there is no means in OpenSSH and Ansible to change the parameters (for others it is, but not those I need). The best suggestion I got and that I want to implement is to provide an alternative ssh command to Ansible, use that to receive and modify the parameters and pass them on to the real ssh.</em></p>\n"}, {"tags": ["rest", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1549137437, "post_id": 54496660, "comment_id": 95799166, "body": "What have you tried? Include your code. What problems did you encounter?"}], "answers": [{"tags": [], "owner": {"reputation": 9542, "user_id": 8068625, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4spqa.png?s=128&g=1", "display_name": "Henry Woody", "link": "https://stackoverflow.com/users/8068625/henry-woody"}, "is_accepted": true, "score": 2, "last_activity_date": 1549140825, "last_edit_date": 1549140825, "creation_date": 1549139120, "answer_id": 54497194, "question_id": 54496660, "link": "https://stackoverflow.com/questions/54496660/how-to-make-a-post-request-with-multiple-parameters/54497194#54497194", "title": "How to make a post request with multiple parameters", "body": "<p>You can do this using the <a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow noreferrer\">html/template</a> package in the Go standard library.</p>\n\n<p>The basic process here is:</p>\n\n<ol>\n<li>Write a template (in go/HTML template language)</li>\n<li>Read in the template (using <code>template.ParseFiles</code> or similar)</li>\n<li>Listen for requests</li>\n<li>Pass information from relevant requests to your template (using <code>ExecuteTemplate</code> or similar)</li>\n</ol>\n\n<p>You can pass a struct to <code>ExecuteTemplate</code>, which is then accessible in the template you define (see below for an example). For example, if your struct has a field called <code>Name</code>, then you can access this information in the template with <code>{{ .Name }}</code>.</p>\n\n<p>Here is a sample:</p>\n\n<p><strong>main.go</strong>:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"log\"\n    \"encoding/json\"\n    \"html/template\"\n    \"net/http\"\n)\n\nvar tpl *template.Template\n\nfunc init() {\n    // Read your template(s) into the program\n    tpl = template.Must(template.ParseFiles(\"index.gohtml\"))\n}\n\nfunc main() {\n    // Set up routes\n    http.HandleFunc(\"/endpoint\", EndpointHandler)\n    http.ListenAndServe(\":8080\", nil)\n}\n\n// define the expected structure of payloads\ntype Payload struct {\n    Name string     `json:\"name\"`\n    Hobby string    `json:\"hobby\"`\n}\n\nfunc EndpointHandler(w http.ResponseWriter, r *http.Request) {\n    // Read the body from the request into a Payload struct\n    var payload Payload\n    err := json.NewDecoder(r.Body).Decode(&amp;payload)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Pass payload as the data to give to index.gohtml and write to your ResponseWriter\n    w.Header().Set(\"Content-Type\", \"text/html\")\n    tpl.ExecuteTemplate(w, \"index.gohtml\", payload)\n}\n</code></pre>\n\n<p><strong>index.gohtml</strong>:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;&lt;/title&gt;\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;div&gt;\n        &lt;span&gt;Your name is&lt;/span&gt;&lt;span&gt;{{ .Name }}&lt;/span&gt;\n    &lt;/div&gt;\n\n    &lt;div&gt;\n        &lt;span&gt;Your hobby is&lt;/span&gt;&lt;span&gt;{{ .Hobby }}&lt;/span&gt;\n    &lt;/div&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>Sample:</p>\n\n<p>With payload:</p>\n\n<pre><code>{\n    \"name\": \"Ahmed\",\n    \"hobby\": \"devving\"\n}\n</code></pre>\n\n<p>Response:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n    &lt;head&gt;\n        &lt;title&gt;&lt;/title&gt;\n    &lt;/head&gt;\n    &lt;body&gt;\n        &lt;div&gt;\n            &lt;span&gt;Your name is&lt;/span&gt;\n            &lt;span&gt;Ahmed&lt;/span&gt;\n        &lt;/div&gt;\n        &lt;div&gt;\n            &lt;span&gt;Your hobby is&lt;/span&gt;\n            &lt;span&gt;devving&lt;/span&gt;\n        &lt;/div&gt;\n    &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>Note this is pretty fragile, so you should definitely add better error and edge-case handling, but hopefully this is a helpful starting point.</p>\n"}], "owner": {"reputation": 37, "user_id": 9950692, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-KCaaQE_0KGk/AAAAAAAAAAI/AAAAAAAAAX4/gGMxpMBTGDM/photo.jpg?sz=128", "display_name": "Ahmed Osman", "link": "https://stackoverflow.com/users/9950692/ahmed-osman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 604, "favorite_count": 1, "accepted_answer_id": 54497194, "answer_count": 1, "score": -2, "last_activity_date": 1549140825, "creation_date": 1549135304, "last_edit_date": 1549137416, "question_id": 54496660, "link": "https://stackoverflow.com/questions/54496660/how-to-make-a-post-request-with-multiple-parameters", "title": "How to make a post request with multiple parameters", "body": "<p>How could I make a POST request to take in multiple parameters and output info on a webpage, in Go using the standard library.</p>\n\n<p>i.e</p>\n\n<p>user puts in name and favorite hobby</p>\n\n<p><strong>Name</strong> : </p>\n\n<p><strong>Hobby</strong> : </p>\n\n<p><strong>Submit</strong> (button)</p>\n\n<p>then webpage updates and shows</p>\n\n<p>Your Name is <strong>(Name)</strong> and you like to <strong>(Hobby)</strong></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 28754, "user_id": 1153938, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/deBjQ.jpg?s=128&g=1", "display_name": "Vorsprung", "link": "https://stackoverflow.com/users/1153938/vorsprung"}, "edited": false, "score": 0, "creation_date": 1549140576, "post_id": 54496580, "comment_id": 95799998, "body": "not sure what you are aiming to do?  convert int to uint?  convert byte arrays to something?"}], "answers": [{"tags": [], "owner": {"reputation": 561, "user_id": 784060, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/8e0323646a1c6c7acf5d83aac6a6cdf3?s=128&d=identicon&r=PG", "display_name": "Joshua Vega", "link": "https://stackoverflow.com/users/784060/joshua-vega"}, "is_accepted": false, "score": 2, "last_activity_date": 1549141407, "creation_date": 1549141407, "answer_id": 54497492, "question_id": 54496580, "link": "https://stackoverflow.com/questions/54496580/converting-variable-sized-byte-to-int64-in-golang/54497492#54497492", "title": "Converting variable-sized []byte to int64 in Golang", "body": "<p>First, your slice is too long. Because of this, if each value represents a byte, then a 64-bit unsigned integer requires only 8 entries. The slice is read from front to back so in your sample the <code>23</code> entry is chopped off because it's the 10th entry.</p>\n\n<p>Also, when reading from the buffer, you need to pass a reference as the last parameter (<code>&amp;ret</code>).</p>\n\n<p>Lastly, you define <code>ret</code> as a <code>uint</code> which is 32-bits long where as the <code>mySlice</code> defines a 64-bit integer (<code>uint64</code>). This means that the last 32-bits of your slice will be cut off.</p>\n\n<p>Below is a the working code for your sample and it's output:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\nimport \"bytes\"\nimport \"encoding/binary\"\n\nfunc main() {\n    var mySlice = []byte{0, 0, 0, 0, 0, 0, 0, 23}\n    data := binary.BigEndian.Uint64(mySlice)\n    fmt.Println(data)\n\n    var ret uint64\n    buf := bytes.NewBuffer(mySlice)\n    binary.Read(buf, binary.BigEndian, &amp;ret)\n    fmt.Println(ret)\n}\n</code></pre>\n\n<pre><code>23\n23\n</code></pre>\n"}], "owner": {"reputation": 471, "user_id": 589969, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/743586d634a537e7466e2dd5b16e18a3?s=128&d=identicon&r=PG&f=1", "display_name": "Odinovsky", "link": "https://stackoverflow.com/users/589969/odinovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4155, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549185934, "creation_date": 1549134669, "last_edit_date": 1549185934, "question_id": 54496580, "link": "https://stackoverflow.com/questions/54496580/converting-variable-sized-byte-to-int64-in-golang", "title": "Converting variable-sized []byte to int64 in Golang", "body": "<p>I have a method that transposes slice of int64 ([]int64) to a int64 but I haven't found a way to do <a href=\"https://play.golang.org/p/T1QiFUamKjq\" rel=\"nofollow noreferrer\">it</a>.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"bytes\"\nimport \"encoding/binary\"\n\nfunc main() {\n    var mySlice = []byte{0, 0, 0, 0, 0, 0, 0, 0, 0, 23}\n    data := binary.BigEndian.Uint64(mySlice)\n    fmt.Println(data)\n\n    var ret int64\n    buf := bytes.NewBuffer(mySlice)\n    binary.Read(buf, binary.BigEndian, ret)\n\n    fmt.Println(ret)\n}\n</code></pre>\n\n<p>My method initializes []byte from a given size (say, make([]byte, 20)) and my method operates on a given bit and dimension size and interleaves it (bit operations):</p>\n\n<p>So, say a []byte{0 0 0 0 0 0 0 0 0 23} gives 23 and a [more trailing zeroes..., 125, more tailing zeroes...] is 500</p>\n\n<p>I guess I'm looking for something more like java's <a href=\"https://docs.oracle.com/javase/7/docs/api/java/math/BigInteger.html\" rel=\"nofollow noreferrer\">BigInteger</a> class that takes in []byte (and signum) in BigEndian.</p>\n\n<p>The method I'm trying to port (from Java) would be something like this:</p>\n\n<pre><code>BigInteger toIndex(long... transposedIndex) {\n        byte[] b = new byte[length];\n        int bIndex = length - 1;\n        long mask = 1L &lt;&lt; (bits - 1);\n        for (int i = 0; i &lt; bits; i++) {\n            for (int j = 0; j &lt; transposedIndex.length; j++) {\n                if ((transposedIndex[j] &amp; mask) != 0) {\n                    b[length - 1 - bIndex / 8] |= 1 &lt;&lt; (bIndex % 8);\n                }\n                bIndex--;\n            }\n            mask &gt;&gt;= 1;\n        }\n        // b is expected to be BigEndian\n        return new BigInteger(1, b);\n    }\n</code></pre>\n\n<p>and what I have in Golang is this:</p>\n\n<pre><code>func (s *TestStruct) untranspose(x []int64) (b int64) {\n    t := make([]byte, s.length)\n    bIndex := s.length - 1\n    mask := int64(1 &lt;&lt; (s.bits - 1))\n\n    for i := 0; i &lt; int(s.bits); i++ {\n        for j := 0; j &lt; len(x); j++ {\n            if (x[j] &amp; mask) != 0 {\n                t[s.length - 1 - bIndex / 8] |= 1 &lt;&lt; (bIndex % 8)\n            }\n\n            bIndex--\n        }\n        mask &gt;&gt;= 1\n    }\n\n    return int64(binary.BigEndian.Uint64(t))\n}\n</code></pre>\n\n<p>which doesn't seem to be correct. []byte could be longer than 8-bit, say, [0 0 0 0 0 0 0 0 2 170]</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1549134226, "post_id": 54496295, "comment_id": 95798213, "body": "Your error has nothing to do with your regular expression. But you didn&#39;t show the code that&#39;s actually causing the error, so it&#39;s hard to help.  Please show relevant code."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549187313, "post_id": 54496295, "comment_id": 95807539, "body": "You haven&#39;t included the definition of <code>SomeStruct</code>, so no, this isn&#39;t all the code."}, {"owner": {"reputation": 119, "user_id": 5589201, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-z8vW_wFt3DA/AAAAAAAAAAI/AAAAAAAAABM/9VI0Lq5Sf1Q/photo.jpg?sz=128", "display_name": "Constantine Bateruk", "link": "https://stackoverflow.com/users/5589201/constantine-bateruk"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549199604, "post_id": 54496295, "comment_id": 95810362, "body": "It&#39;s all the relevant code."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549201151, "post_id": 54496295, "comment_id": 95810800, "body": "Thanks for updating the question. Now it does indeed look complete."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549201160, "post_id": 54496295, "comment_id": 95810803, "body": "Did you try exporting <code>collection</code>?"}, {"owner": {"reputation": 119, "user_id": 5589201, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-z8vW_wFt3DA/AAAAAAAAAAI/AAAAAAAAABM/9VI0Lq5Sf1Q/photo.jpg?sz=128", "display_name": "Constantine Bateruk", "link": "https://stackoverflow.com/users/5589201/constantine-bateruk"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549201345, "post_id": 54496295, "comment_id": 95810860, "body": "All I did now in code section. If you wondering why there reflect error I guess it&#39;s somewhere inside mongodb driver. If I change collection to Collection results are the same."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549201997, "post_id": 54496295, "comment_id": 95811040, "body": "Well the error is pretty clear that the problem relates to trying to use an unexported field (and not to your regular expression). It&#39;s unfortunate that the error isn&#39;t very specific about which unexported field you&#39;re trying to use. Best I can suggest is export everything, possibly one at a time, until the error goes away."}, {"owner": {"reputation": 119, "user_id": 5589201, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-z8vW_wFt3DA/AAAAAAAAAAI/AAAAAAAAABM/9VI0Lq5Sf1Q/photo.jpg?sz=128", "display_name": "Constantine Bateruk", "link": "https://stackoverflow.com/users/5589201/constantine-bateruk"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549204254, "post_id": 54496295, "comment_id": 95811661, "body": "All fields in my struct is exported. I also made all variables like <code>some</code>, <code>re</code>, <code>result</code> and <code>query</code> exported so as structures but it&#39;s didn&#39;t change anything. If i change <code>obj{&quot;comment&quot;: obj{&quot;$not&quot;: re}}</code> to let&#39;s say <code>obj{&quot;comment&quot;: obj{&quot;$not&quot;: obj{&quot;$ne&quot;: &quot;123&quot;}}}</code> there is no error, that is why I said that problem with regexp passed to $not;"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549205344, "post_id": 54496295, "comment_id": 95811938, "body": "It looks like your problem might be with <code>obj</code> then. Try exporting that. Intuitively, that makes sense, as it&#39;s difficult for mgo to parse your query, if doing so requires traversing unexported types."}, {"owner": {"reputation": 119, "user_id": 5589201, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-z8vW_wFt3DA/AAAAAAAAAAI/AAAAAAAAABM/9VI0Lq5Sf1Q/photo.jpg?sz=128", "display_name": "Constantine Bateruk", "link": "https://stackoverflow.com/users/5589201/constantine-bateruk"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549205603, "post_id": 54496295, "comment_id": 95811992, "body": "I already tried exporting literally everything in this file."}, {"owner": {"reputation": 119, "user_id": 5589201, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-z8vW_wFt3DA/AAAAAAAAAAI/AAAAAAAAABM/9VI0Lq5Sf1Q/photo.jpg?sz=128", "display_name": "Constantine Bateruk", "link": "https://stackoverflow.com/users/5589201/constantine-bateruk"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549206858, "post_id": 54496295, "comment_id": 95812321, "body": "It does compile. I just copied this exact code from above and run it. <a href=\"https://i.imgur.com/slir6lp.png\" rel=\"nofollow noreferrer\">i.imgur.com/slir6lp.png</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549207712, "post_id": 54496295, "comment_id": 95812574, "body": "Oh indeed, it does compile. <code>gofmt</code> was removing an import erroneously for me."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549207740, "post_id": 54496295, "comment_id": 95812581, "body": "Unfortunately, I don&#39;t have any mongo servers, so I can&#39;t actually run it far enough to trigger your error."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1549207879, "post_id": 54496295, "comment_id": 95812631, "body": "Does the error you received have any extra information not included in the question? Such as a stack trace?"}], "answers": [{"tags": [], "owner": {"reputation": 119, "user_id": 5589201, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-z8vW_wFt3DA/AAAAAAAAAAI/AAAAAAAAABM/9VI0Lq5Sf1Q/photo.jpg?sz=128", "display_name": "Constantine Bateruk", "link": "https://stackoverflow.com/users/5589201/constantine-bateruk"}, "is_accepted": true, "score": 0, "last_activity_date": 1564147410, "last_edit_date": 1564147410, "creation_date": 1549219380, "answer_id": 54506251, "question_id": 54496295, "link": "https://stackoverflow.com/questions/54496295/how-to-make-not-regexp-query-work-in-go/54506251#54506251", "title": "How to make $not regexp query work in Go?", "body": "<p>The answer is <code>obj{\"comment\": obj{\"$not\": bson.RegEx{Pattern: \".*\" + \"exclude\" + \".*\"}}}</code> instead of <code>obj{\"comment\": obj{\"$not\": re}}</code></p>\n"}], "owner": {"reputation": 119, "user_id": 5589201, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh5.googleusercontent.com/-z8vW_wFt3DA/AAAAAAAAAAI/AAAAAAAAABM/9VI0Lq5Sf1Q/photo.jpg?sz=128", "display_name": "Constantine Bateruk", "link": "https://stackoverflow.com/users/5589201/constantine-bateruk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 54506251, "answer_count": 1, "score": -1, "last_activity_date": 1564147410, "creation_date": 1549132890, "last_edit_date": 1549199474, "question_id": 54496295, "link": "https://stackoverflow.com/questions/54496295/how-to-make-not-regexp-query-work-in-go", "title": "How to make $not regexp query work in Go?", "body": "<p>I'm having trouble implementing non-full text exclude search with golang and mongodb. </p>\n\n<p>It's work in mongo shell:</p>\n\n<pre><code>db.collectionName.find({\"comment\":{\"$not\": /.*excludeThis.*/}})\n</code></pre>\n\n<p>It's don't work in Go:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"regexp\"\n\n    \"github.com/night-codes/mgo-wrapper\"\n    mgo \"gopkg.in/mgo.v2\"\n)\n\ntype (\n\n\n    SomeStruct struct {\n            ID      uint64 `form:\"id\" json:\"id\" bson:\"_id\"`\n            Name    string `form:\"name\" json:\"name\" bson:\"name\"`\n            Comment string   `form:\"comment\" json:\"comment\" bson:\"comment\"`\n        }\n\n    collectionStruct struct {\n        collection *mgo.Collection\n    }\n\n    obj map[string]interface{}\n    arr []interface{}\n)\n\nvar (\n    some = collectionStruct{collection: mongo.DB(\"somedb\").C(\"somecollection\")}\n)\n\nfunc main() {\n    re := regexp.MustCompile(\".*\" + \"exclude\" + \".*\")\n    query := obj{\"comment\": obj{\"$not\": re}}\n\n    result := []SomeStruct{}\n    if err := some.collection.Find(query).All(&amp;result); err != nil {\n        log.Println(\"Error:\", err)\n        return\n    }\n\n    log.Println(\"Result:\")\n    for k := range result {\n        log.Printf(\"%+v\\n\", result[k])\n    }\n    log.Println(\"-------\")\n}\n</code></pre>\n\n<p>I'm getting error: </p>\n\n<blockquote>\n  <p>Error: reflect.Value.Interface: cannot return value obtained from unexported field or method</p>\n</blockquote>\n\n<p>Is here any way to make regex work or implement it in other way?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 5880, "user_id": 166233, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b88b1c85a798a2aee3a35f5cd805d0e2?s=128&d=identicon&r=PG", "display_name": "Steve Wilhelm", "link": "https://stackoverflow.com/users/166233/steve-wilhelm"}, "edited": false, "score": 1, "creation_date": 1549129885, "post_id": 54495401, "comment_id": 95796964, "body": "Asked and answered before here: <a href=\"https://stackoverflow.com/questions/8270816/converting-go-struct-to-json\" title=\"converting go struct to json\">stackoverflow.com/questions/8270816/&hellip;</a>"}, {"owner": {"reputation": 2859, "user_id": 6225565, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iqBej.jpg?s=128&g=1", "display_name": "Shalauddin Ahamad Shuza", "link": "https://stackoverflow.com/users/6225565/shalauddin-ahamad-shuza"}, "edited": false, "score": 2, "creation_date": 1549130637, "post_id": 54495401, "comment_id": 95797147, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/8270816/converting-go-struct-to-json\">Converting Go struct to JSON</a>"}, {"owner": {"reputation": 25, "user_id": 11005777, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--MDG-a0fy_k/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPKFXhGyRb-aXv6RiNfGPJQmValIA/mo/photo.jpg?sz=128", "display_name": "Richard Chester", "link": "https://stackoverflow.com/users/11005777/richard-chester"}, "edited": false, "score": 1, "creation_date": 1549133899, "post_id": 54495401, "comment_id": 95798122, "body": "I think this may be a duplication of Steve wilhelms answer, also that does not answer the question as if you refer to the example I&#39;ve provided I&#39;ve already done this. For this answer to be relevant there would have to be a struct that contained a value that was of the user type and I would have to be able to have multiple users without just declaring the type as []users or including every possible user in the users stuct explicitly"}, {"owner": {"reputation": 5880, "user_id": 166233, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b88b1c85a798a2aee3a35f5cd805d0e2?s=128&d=identicon&r=PG", "display_name": "Steve Wilhelm", "link": "https://stackoverflow.com/users/166233/steve-wilhelm"}, "edited": false, "score": 0, "creation_date": 1549150964, "post_id": 54495401, "comment_id": 95802219, "body": "Wondering why you do not want to use an array, slice, or map?"}, {"owner": {"reputation": 25, "user_id": 11005777, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--MDG-a0fy_k/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPKFXhGyRb-aXv6RiNfGPJQmValIA/mo/photo.jpg?sz=128", "display_name": "Richard Chester", "link": "https://stackoverflow.com/users/11005777/richard-chester"}, "edited": false, "score": 0, "creation_date": 1549179627, "post_id": 54495401, "comment_id": 95806135, "body": "Basically because my program is to make a json and then feed it into an external api I have no control over, the api works fine if it&#39;s simple and want to write the json by hand but quickly gets complicated for bigger applications. That&#39;s why I&#39;m trying to build a program to generate the json for me."}, {"owner": {"reputation": 25, "user_id": 11005777, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--MDG-a0fy_k/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPKFXhGyRb-aXv6RiNfGPJQmValIA/mo/photo.jpg?sz=128", "display_name": "Richard Chester", "link": "https://stackoverflow.com/users/11005777/richard-chester"}, "edited": false, "score": 0, "creation_date": 1549180566, "post_id": 54495401, "comment_id": 95806286, "body": "I think I need to be able to change the Myhouse stuct at run time so that if the user enters two rooms it looks like <code>type Myhouse struct {Bedroom *Bedroom json:&quot;bedroom&quot;, Bedroom1 *Bedroom json:&quot;bedroom1&quot;}</code> and if it was 3 bedrooms it world be  <code>type Myhouse struct {Bedroom *Bedroom json:&quot;bedroom&quot;, Bedroom1 *Bedroom json:&quot;bedroom1&quot;,Bedroom2 *Bedroom json:&quot;bedroom2&quot; }</code> up to a theoretically Infinate amount of rooms"}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 11005777, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--MDG-a0fy_k/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPKFXhGyRb-aXv6RiNfGPJQmValIA/mo/photo.jpg?sz=128", "display_name": "Richard Chester", "link": "https://stackoverflow.com/users/11005777/richard-chester"}, "edited": false, "score": 0, "creation_date": 1549134154, "post_id": 54495844, "comment_id": 95798192, "body": "This is just a small scale version of the example I provided and does not answer the question.  Now if there was a value in another struct that pointed to the foo type and allowed me to call it multiple times without explicitly calling it in the struct like bar:{foo:{num:int, title:string}, anotherfoo:{num:int, title:string}}"}], "tags": [], "owner": {"reputation": 5880, "user_id": 166233, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b88b1c85a798a2aee3a35f5cd805d0e2?s=128&d=identicon&r=PG", "display_name": "Steve Wilhelm", "link": "https://stackoverflow.com/users/166233/steve-wilhelm"}, "is_accepted": false, "score": 1, "last_activity_date": 1549130175, "creation_date": 1549130175, "answer_id": 54495844, "question_id": 54495401, "link": "https://stackoverflow.com/questions/54495401/converting-between-golang-structs-and-json-dynamically/54495844#54495844", "title": "Converting between Golang Structs and Json Dynamically", "body": "<p>Asked and answered before here:\n<a href=\"https://stackoverflow.com/questions/8270816/converting-go-struct-to-json\">Converting Go struct to JSON</a></p>\n\n<pre><code>// Annotate the struct with json tags\ntype Foo struct {\n    Number int    `json:\"number\"`\n    Title  string `json:\"title\"`\n}\n// ...\nfoo := &amp;Foo{Number: 123, Title: \"Bar\"}\nf, err := json.Marshal(foo)\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 11005777, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--MDG-a0fy_k/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQPKFXhGyRb-aXv6RiNfGPJQmValIA/mo/photo.jpg?sz=128", "display_name": "Richard Chester", "link": "https://stackoverflow.com/users/11005777/richard-chester"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 230, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1549143471, "creation_date": 1549127329, "last_edit_date": 1549143471, "question_id": 54495401, "link": "https://stackoverflow.com/questions/54495401/converting-between-golang-structs-and-json-dynamically", "title": "Converting between Golang Structs and Json Dynamically", "body": "<p>I'm wondering if there is a way to dynamically expand the number of entries that share the same data types in a struct without using an array.</p>\n\n<p>for example:</p>\n\n<pre><code>type MyHouse struct{\nBedroom *Bedroom `json:\"bedroom\"`\nKitchen *Kitchen `json:\"Kitchen\"`\n}\n\ntype Kitchen struct{\nSink *Sink `json:\"sink\"`\nOven *Oven `json:\"oven\"`\n}\n\ntype Oven struct{\nBrand   string `json:\"brand\"`\nHobSize []int  `json:\"hobs\"`\n\ntype Sink struct{\nVolume int `json:\"volume\"`\n}\n\ntype Bedroom struct{\nBed   *Bed   `json:\"bed\"`\nTable *Table `json:\"table\"`\n}\n\ntype Bed struct{\nBrand string `json:\"brand\"`\nSize  String `json:\"size\"`\n\ntype Table struct{\nBrand       string `json:\"brand\"`\nLegs        int    `json:\"legs\"`\nSurfaceArea int    `json:\"SurfacceArea\"`\nDraws       []Draws`json:\"draws\"`\n}\n\ntype Draws struct{\nDepth  int `json:\"depth\"`\nWidth  int `json:\"width\"`\nLength int `json:\"length\"`\n}\nfunc main() { \nres := &amp;MyHouse{\n Bedroom: &amp;Bedroom{ \n  Bed: &amp;Bed{\n            Brand: \"Sleepy\",\n            Size : \"King\"},\n  Table: &amp;Table{\n              Brand    : \"TabelY\"\n              Legs     : 1\n              SurfaceAr: 32\n              Draws    : []Draws{\n                               {\n                                Depth  :10\n                                Width  :10\n                                Length :10\n                                },\n                                {  \n                                Depth  :20\n                                Width  :10\n                                Length :10   \n                                }\n                               }\n                              }\n                             }                   \nKitcken: &amp;Kitchen{\n Oven: &amp;Oven{\n   Brand: \"Bake right\",\n   hobs: []int{12,12,24,24}\n}\nSink: &amp;Sink{\n Volume: 56\n}\n}\n}\nrestopring, _ := json.Marshal(res)\n\n    fmt.Println(string(resprint)) \n}\n</code></pre>\n\n<p>This is fine to simply print out exactly what is there, and I could just exchange the hard-coded values for variables (I didn't just to keep this simple) if I want to simply be able to alter the values.</p>\n\n<p>what I want to be able to do is add another table to the bedroom with the exact same data (different values) without turning the tables into an array of tables (and actually the same for the rooms) so that I could print out a json that was formatted something like:</p>\n\n<p>{MasterBedroom:(all relevant stuff)},{SpareBedroom:(its own set of stuff)}</p>\n\n<p>Also, this is just an example, in reality, It may be buildings with 100s of rooms each with a lot of furniture all requiring different names but sharing the same basic data defined in the structs. I was thinking about some kind of for loop that might take a user value for how many bedrooms a user had and dynamically create that many bedrooms in the json like:</p>\n\n<p>{Bedroom1:(all relevant stuff)},{Bedroom2:(its own set of stuff)}.... etc</p>\n\n<p>I've seen a couple examples that use the map but they end up printing out:</p>\n\n<p>map[[Bedroom1:[all stuff]],Bedroom2:[its stuff]] </p>\n\n<p>which also doesn't work the way I need it to</p>\n\n<p>Thank you in advance</p>\n\n<p>To clarify in the example I have given you would need to be able to make an infinite number of rooms inside the json without using []bedrooms in the my house struct</p>\n\n<p>This is not the same as the json marshal example some people have posted that has user:Frank as an example</p>\n"}, {"tags": ["go", "logging"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 52685, "user_id": 980550, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/8emhY.jpg?s=128&g=1", "display_name": "lurker", "link": "https://stackoverflow.com/users/980550/lurker"}, "edited": false, "score": 1, "creation_date": 1549124245, "post_id": 54494701, "comment_id": 95795204, "body": "@lurker, the standard <code>log</code> package is configured this way: it writes to stderr by default."}, {"owner": {"reputation": 52685, "user_id": 980550, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/8emhY.jpg?s=128&g=1", "display_name": "lurker", "link": "https://stackoverflow.com/users/980550/lurker"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1549130107, "post_id": 54494701, "comment_id": 95797029, "body": "@kostix ah ok, duh, wasn&#39;t thinking about the &quot;log&quot; part. Thanks."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 7356550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f415e7825585d5e1dc35699a7b0a1d5e?s=128&d=identicon&r=PG&f=1", "display_name": "Addy.Osami", "link": "https://stackoverflow.com/users/7356550/addy-osami"}, "edited": false, "score": 0, "creation_date": 1549169356, "post_id": 54494742, "comment_id": 95804882, "body": "Ah. I see. Thank you"}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": false, "score": 1, "last_activity_date": 1549122985, "creation_date": 1549122985, "answer_id": 54494742, "question_id": 54494701, "link": "https://stackoverflow.com/questions/54494701/why-go-programs-print-output-to-terminal-screen-but-not-dev-stderr/54494742#54494742", "title": "Why go programs print output to terminal screen but not /dev/stderr?", "body": "<p>In standard Unix/Linux terminals, both <code>stdout</code> and <code>stderr</code> are connected to the terminal so the output goes there.</p>\n\n<p>Here's a shell snippet to clarify this:</p>\n\n<pre><code>$ echo \"joe\" &gt;&gt; /dev/stderr\njoe\n</code></pre>\n\n<p>Even though we echoed \"joe\" to something that looks like a file, it gets emitted to the screen. Replace <code>/dev/stderr</code> with <code>/tmp/foo</code> and you won't see the output on the screen (though it will be appended to the file <code>/tmp/foo</code>)</p>\n\n<hr>\n\n<p>In Go you can specifically select which stream to output to by passing it to functions like <code>fmt.Fprintf</code> in its first argument.</p>\n"}, {"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 1, "last_activity_date": 1549125604, "creation_date": 1549125604, "answer_id": 54495133, "question_id": 54494701, "link": "https://stackoverflow.com/questions/54494701/why-go-programs-print-output-to-terminal-screen-but-not-dev-stderr/54495133#54495133", "title": "Why go programs print output to terminal screen but not /dev/stderr?", "body": "<p>Well, several things are going on here.</p>\n\n<p>First, is that on a UNIX-like system (and you appear to be on a Linux-based one), the environment in which each user-space program runs, includes the concept of the so-called <a href=\"https://en.wikipedia.org/wiki/Standard_streams\" rel=\"nofollow noreferrer\">\"standard I/O streams\"</a> \u2014 that is, each program bootstrapped by the OS and taken control automatically has three file descriptors opened and available: representing the standard input stream, the standard output stream and the standard error stream.</p>\n\n<p>Second, typically (but not always) the spawned program inherits these streams from its parent program. For the case of an interactive shell running in a terminal (or a terminal emulator), that parent program is the shell, and so the standard I/O streams of the spawned program are inherited from the shell.\nThe shell's standard I/O streams, in turn, naturally connected to the terminal it runs at: that's why it's possible to input data to the shell and read what it prints back: you actually type into the terminal, not to the shell; it's the terminal which delivers that data to the shell; the case for the shell's output is just the reverse.</p>\n\n<p>Third, that <code>/dev/stderr</code> is a Linux-specific \"hack\" which is a virtual device meaning \"whatever <em>my</em> stderr is connected to\".\nThat is, when a process opens that special file, it gets back a file descriptor connected to whatever the process' stderr <em>is already connected to.</em></p>\n\n<p>Fourth, let's grok the code example you cited:</p>\n\n<blockquote>\n  <p><code>NewFile(uintptr(syscall.Stderr), \"/dev/stderr\")</code></p>\n</blockquote>\n\n<p>Here, a call to <code>os.NewFile</code> is made, receiving two arguments.\nTo cite it's documentation:</p>\n\n<p><code>$ go doc os.NewFile</code></p>\n\n<blockquote>\n  <p><code>func NewFile(fd uintptr, name string) *File</code><br/>\n  <code>NewFile</code> returns a new <code>File</code> with the given file descriptor and name. The returned value will be <code>nil</code> if <code>fd</code> is not a valid file descriptor.<br/>\n  &lt;\u2026></p>\n</blockquote>\n\n<p>OK, so this function takes a raw kernel-level\n<a href=\"https://en.wikipedia.org/wiki/File_descriptor\" rel=\"nofollow noreferrer\">file descriptor</a>\nand a name of the file <em>it is supposed to have been opened to.</em>\nThat latter bit is crucial: the OS kernel itself is (almost) oblivious about what sort of stream a file descriptor actually represents \u2014 at least as long as its public API is considered.</p>\n\n<p>So, when <code>NewFile</code> is called to obtain an instance of <code>*os.File</code> for the program's standard error stream by the <code>log</code> package,\nit <em>does not open</em> the file \"/dev/stderr\" (even though it exists);\nit merely uses it's name since <code>os.NewFile</code> requests it.\nIt could have used \"\" there to much the same extent except for changes in error reporting: if something fails when using the resulting <code>*os.File</code>, the error output would not have included the name \"/dev/stderr\".</p>\n\n<p>The <code>syscall.Stderr</code> value is merely the number of the file descriptor connected to the standard error stream.\nOn UNIX-compatible kernels it's always <code>2</code>; you can run <code>go doc syscall.Stderr</code> and see for yourself.</p>\n\n<p><strong>To recap,</strong></p>\n\n<ul>\n<li>The call <code>NewFile(...)</code> you referred to does not open any files;\nit merely wraps an already open file descriptor connected to the standard error stream of the current process into a value of type <code>os.File</code> which is used throughout the <code>os</code> package for I/O on files.</li>\n<li>On Linux, the special virtual device file <code>/dev/stderr</code> does really exist but it has nothing to do with what's happening here.</li>\n<li>When you run a program in an interactive shell without using any  <a href=\"https://en.wikipedia.org/wiki/Redirection_(computing)\" rel=\"nofollow noreferrer\">I/O redirection</a>, the standard streams of the created process are connected to the same \"sinks and sources\" as those of the shell. And they, in turn, are most of the time connected to the terminal which hosts the shell.</li>\n</ul>\n\n<p>Now I urge you to fetch an introductory book on the design of UNIX-like operating systems and read it.</p>\n"}], "owner": {"reputation": 1, "user_id": 7356550, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f415e7825585d5e1dc35699a7b0a1d5e?s=128&d=identicon&r=PG&f=1", "display_name": "Addy.Osami", "link": "https://stackoverflow.com/users/7356550/addy-osami"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 358, "favorite_count": 0, "answer_count": 2, "score": -4, "last_activity_date": 1549125604, "creation_date": 1549122763, "question_id": 54494701, "link": "https://stackoverflow.com/questions/54494701/why-go-programs-print-output-to-terminal-screen-but-not-dev-stderr", "title": "Why go programs print output to terminal screen but not /dev/stderr?", "body": "<p>As I see in the source of golang\ngo will print output to <code>os.Stderr</code> which is</p>\n\n<pre><code>Stderr = NewFile(uintptr(syscall.Stderr), \"/dev/stderr\")\n</code></pre>\n\n<p>So why I run this program in my terminal with the command <code>go run main.go</code>\nthe output is printed to the terminal screen, not the <code>/dev/stderr</code></p>\n\n<pre><code>// main.go\nfunc main() {\n    log.Println(\"this is my first log\")\n}\n</code></pre>\n"}, {"tags": ["function", "go", "struct", "field"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 11005562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19c19c469bca11e05a1d8ddfeab415e1?s=128&d=identicon&r=PG&f=1", "display_name": "Murky", "link": "https://stackoverflow.com/users/11005562/murky"}, "edited": false, "score": 0, "creation_date": 1549121966, "post_id": 54494564, "comment_id": 95794504, "body": "I want the structure instances to be able to store functions of any signature, which is why I used <code>interface{}</code> as the argument and return types. Is there a different way of doing that? I have updated the question to indicate the same"}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "reply_to_user": {"reputation": 21, "user_id": 11005562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19c19c469bca11e05a1d8ddfeab415e1?s=128&d=identicon&r=PG&f=1", "display_name": "Murky", "link": "https://stackoverflow.com/users/11005562/murky"}, "edited": false, "score": 2, "creation_date": 1549122159, "post_id": 54494564, "comment_id": 95794555, "body": "@Murky: that will not work, as Go doesn&#39;t have generics at this time [there&#39;s a proposal in progress for Go 2: <a href=\"https://go.googlesource.com/proposal/+/master/design/go2draft-generics-overview.md]\" rel=\"nofollow noreferrer\">go.googlesource.com/proposal/+/master/design/&hellip;</a>. The only way to accomplish it right now is have your actual functions also use <code>interface{}</code> for everything and do the runtime dispatch with type switches. Alternatively, change the design - it&#39;s very possible your real issue is solvable using idiomatic Go constructs like interfaces"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 21, "user_id": 11005562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19c19c469bca11e05a1d8ddfeab415e1?s=128&d=identicon&r=PG&f=1", "display_name": "Murky", "link": "https://stackoverflow.com/users/11005562/murky"}, "edited": false, "score": 3, "creation_date": 1549122432, "post_id": 54494564, "comment_id": 95794643, "body": "@Murky, the answer to your question <a href=\"https://golang.org/doc/faq#covariant_types\" rel=\"nofollow noreferrer\">is in the FAQ</a>. Also consider reading <a href=\"https://blog.merovius.de/2018/06/03/why-doesnt-go-have-variance-in.html\" rel=\"nofollow noreferrer\">this</a>."}, {"owner": {"reputation": 21, "user_id": 11005562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19c19c469bca11e05a1d8ddfeab415e1?s=128&d=identicon&r=PG&f=1", "display_name": "Murky", "link": "https://stackoverflow.com/users/11005562/murky"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1549122670, "post_id": 54494564, "comment_id": 95794709, "body": "Thanks for clearing things up EliBendersky, @kostix. I am marking the question solved."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 21, "user_id": 11005562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19c19c469bca11e05a1d8ddfeab415e1?s=128&d=identicon&r=PG&f=1", "display_name": "Murky", "link": "https://stackoverflow.com/users/11005562/murky"}, "edited": false, "score": 1, "creation_date": 1549128510, "post_id": 54494564, "comment_id": 95796560, "body": "@Murky, I recommend you to ponder the idea about interfaces, and <code>interface{}</code> in particular a bit more. <a href=\"https://research.swtch.com/interfaces\" rel=\"nofollow noreferrer\">This excellent explanation</a> of interfaces is a bit outdated but 99.9% correct, and it will explain to you that <code>interface{}</code> is not merely a (kinda weirdly-looking) syntactic construct meaning &quot;any type&quot; but actually a rather concrete type: a struct with two pointer-sized fields. That&#39;s why <code>bool</code> (which is usually a platform-sized <code>int</code> internally) cannot be somehow automagically &quot;be matched&quot; by that struct; they have different undelying data layouts"}, {"owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "reply_to_user": {"reputation": 21, "user_id": 11005562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19c19c469bca11e05a1d8ddfeab415e1?s=128&d=identicon&r=PG&f=1", "display_name": "Murky", "link": "https://stackoverflow.com/users/11005562/murky"}, "edited": false, "score": 0, "creation_date": 1549136435, "post_id": 54494564, "comment_id": 95798886, "body": "Hi @Murky - this was also my first question on SO (or a slight variation)! <a href=\"https://stackoverflow.com/questions/42303611/go-function-types-that-return-structs-being-used-with-interfaces\" title=\"go function types that return structs being used with interfaces\">stackoverflow.com/questions/42303611/&hellip;</a>  After asking the question I came across this proposal to add it to the language which was closed but had an interesting discussion of the problem: <a href=\"https://github.com/golang/go/issues/12754\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/12754</a>"}, {"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1599986441, "post_id": 54494564, "comment_id": 112940775, "body": "Compilable version of this code <a href=\"https://play.golang.org/p/_KC2Kz-7oRa\" rel=\"nofollow noreferrer\">play.golang.org/p/_KC2Kz-7oRa</a>."}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 3, "last_activity_date": 1549121790, "creation_date": 1549121790, "answer_id": 54494564, "question_id": 54494427, "link": "https://stackoverflow.com/questions/54494427/functions-as-members-in-structures/54494564#54494564", "title": "Functions as members in structures", "body": "<p>Your code's problem is the incompatible types between the declaration in the struct and <code>testFunc</code>. A function taking <code>interface{}</code> and returning <code>interface{}</code> doesn't have the same type as a function taking and returning <code>bool</code>, so the initialization fails. The compiler error message you pasted is right on point here.</p>\n\n<hr>\n\n<p>This will work:</p>\n\n<pre><code>package main\n\ntype myStruct struct {\n    myFun func(bool) bool\n}\n\nfunc testFunc(b bool) bool {\n    //some functionality here\n    //returns a boolean at the end\n    return true\n}\n\nfunc main() {\n    fr := myStruct{testFunc}\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 11005562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19c19c469bca11e05a1d8ddfeab415e1?s=128&d=identicon&r=PG&f=1", "display_name": "Murky", "link": "https://stackoverflow.com/users/11005562/murky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 0, "accepted_answer_id": 54494564, "answer_count": 1, "score": -1, "last_activity_date": 1549122371, "creation_date": 1549120807, "last_edit_date": 1549122371, "question_id": 54494427, "link": "https://stackoverflow.com/questions/54494427/functions-as-members-in-structures", "title": "Functions as members in structures", "body": "<p>I am trying to make function as a member in my structure  </p>\n\n<pre><code>type myStruct struct {\n    myFun func(interface{}) interface{}\n}\nfunc testFunc1(b bool) bool {\n    //some functionality here\n    //returns a boolean at the end\n}\nfunc testFunc2(s string) int {\n    //some functionality like measuring the string length\n    // returns an integer indicating the length\n}\nfunc main() {\n    fr := myStruct{testFunc1}\n    gr := myStruct{testFunc2}\n}\n</code></pre>\n\n<p>I am getting the error:</p>\n\n<pre><code>Cannot use testFunc (type func(b bool) bool) as type func(interface{}) interface{}\nInspection info: Reports composite literals with incompatible types and values.\n</code></pre>\n\n<p>I am unable to figure out why I am getting this error.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 761, "user_id": 1132603, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e119a6578046f5bd108773919d8f2904?s=128&d=identicon&r=PG", "display_name": "Totoro", "link": "https://stackoverflow.com/users/1132603/totoro"}, "edited": false, "score": 0, "creation_date": 1549117346, "post_id": 54493887, "comment_id": 95793287, "body": "I don&#39;t think you need any goroutine here unless you are only practicing. If you are practicing you also don&#39;t need the second wait group inside the func filecheck, usually waitgroups would be used outside the method unless that method is calling another goroutine"}, {"owner": {"reputation": 269, "user_id": 970474, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dc8b82f90739993544798e25a8b4164b?s=128&d=identicon&r=PG", "display_name": "checkmate", "link": "https://stackoverflow.com/users/970474/checkmate"}, "reply_to_user": {"reputation": 761, "user_id": 1132603, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e119a6578046f5bd108773919d8f2904?s=128&d=identicon&r=PG", "display_name": "Totoro", "link": "https://stackoverflow.com/users/1132603/totoro"}, "edited": false, "score": 0, "creation_date": 1549121955, "post_id": 54493887, "comment_id": 95794500, "body": "@Totoro any recommended way i can write this? can u adjust the code if you don&#39;t mind"}], "answers": [{"comments": [{"owner": {"reputation": 269, "user_id": 970474, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dc8b82f90739993544798e25a8b4164b?s=128&d=identicon&r=PG", "display_name": "checkmate", "link": "https://stackoverflow.com/users/970474/checkmate"}, "edited": false, "score": 0, "creation_date": 1549122401, "post_id": 54494608, "comment_id": 95794635, "body": "so your suggesting this all is run on the main function?"}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "reply_to_user": {"reputation": 269, "user_id": 970474, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dc8b82f90739993544798e25a8b4164b?s=128&d=identicon&r=PG", "display_name": "checkmate", "link": "https://stackoverflow.com/users/970474/checkmate"}, "edited": false, "score": 0, "creation_date": 1549122879, "post_id": 54494608, "comment_id": 95794791, "body": "@checkmate: that would be the simplest solution, so yes. Unless you have more complicated requirements in your &quot;real life&quot; scenario, in which case it&#39;s probably a different question."}, {"owner": {"reputation": 269, "user_id": 970474, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dc8b82f90739993544798e25a8b4164b?s=128&d=identicon&r=PG", "display_name": "checkmate", "link": "https://stackoverflow.com/users/970474/checkmate"}, "edited": false, "score": 0, "creation_date": 1549123069, "post_id": 54494608, "comment_id": 95794838, "body": "Hey thanx mate.... it solved the issue i had.... i actually need waitgroup in the actual solution.... but it require only in one point. thnx"}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 2, "last_activity_date": 1549122042, "creation_date": 1549122042, "answer_id": 54494608, "question_id": 54493887, "link": "https://stackoverflow.com/questions/54493887/go-lang-multi-waitgroup-and-timer-stops-in-the-end/54494608#54494608", "title": "Go lang multi waitgroup and timer stops in the end", "body": "<p>The short answer is that you have this in the loop:</p>\n\n<pre><code>    wg.Done()\n</code></pre>\n\n<p>Which makes the main goroutine proceed to exit as soon as the file is read once.</p>\n\n<hr>\n\n<p>The longer answer is that you're not using wait groups correctly here, IMHO. For example there's absolutely no point in passing a <code>WaitGroup</code> into <code>looping</code>.</p>\n\n<p>It's not clear what your code is trying to accomplish - you certainly don't need any goroutines to just perform the task you've specified - it can all be gone with no concurrency and thus simpler code.</p>\n"}], "owner": {"reputation": 269, "user_id": 970474, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dc8b82f90739993544798e25a8b4164b?s=128&d=identicon&r=PG", "display_name": "checkmate", "link": "https://stackoverflow.com/users/970474/checkmate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 54494608, "answer_count": 1, "score": 0, "last_activity_date": 1549122193, "creation_date": 1549116941, "last_edit_date": 1549122193, "question_id": 54493887, "link": "https://stackoverflow.com/questions/54493887/go-lang-multi-waitgroup-and-timer-stops-in-the-end", "title": "Go lang multi waitgroup and timer stops in the end", "body": "<p>i have written the following code in order to run until someone exit the program manually.</p>\n\n<p>it does is</p>\n\n<ul>\n<li><p>----- check if the exists every 1 second</p></li>\n<li><p>----- if available then read the file and print the file content line by line</p></li>\n</ul>\n\n<p>for this i have first call a function from the main\nand then i call a waitgroup and call a function again from there to do the aforementioned tasks.</p>\n\n<p>please check if i have written the source code correctly as im a newbi on GO</p>\n\n<p>plus this only runs once and stop... i want to it keep alive and see if the file exsists</p>\n\n<p>please help me</p>\n\n<pre><code> package main\n\nimport (\n    \"encoding/csv\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    mainfunction()\n}\n\n//------------------------------------------------------------------\n\nfunc mainfunction() {\n    var wg sync.WaitGroup\n    wg.Add(1)\n\n    go filecheck(&amp;wg)\n\n    wg.Wait()\n    fmt.Printf(\"Program finished \\n\")\n\n}\n\nfunc filecheck(wg *sync.WaitGroup) {\n\n    for range time.Tick(time.Second * 1) {\n        fmt.Println(\"Foo\")\n\n        var wgi sync.WaitGroup\n        wgi.Add(1)\n\n        oldName := \"test.csv\"\n        newName := \"testi.csv\"\n\n        if _, err := os.Stat(oldName); os.IsNotExist(err) {\n            fmt.Printf(\"Path does not exsist \\n\")\n        } else {\n            os.Rename(oldName, newName)\n            if err != nil {\n                log.Fatal(err)\n            }\n            looping(newName, &amp;wgi)\n        }\n        fmt.Printf(\"Test complete \\n\")\n        wgi.Wait()\n        wg.Done()\n        time.Sleep(time.Second * 5)\n    }\n}\n\nfunc looping(newName string, wgi *sync.WaitGroup) {\n    file, _ := os.Open(newName)\n    r := csv.NewReader(file)\n    for {\n        record, err := r.Read()\n        if err == io.EOF {\n            break\n        }\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        var Date = record[0]\n        var Agent = record[1]\n        var Srcip = record[2]\n        var Level = record[3]\n\n        fmt.Printf(\"Data: %s Agent: %s Srcip: %s Level: %s\\n\", Date, Agent, Srcip, Level)\n    }\n    fmt.Printf(\"Test complete 2 \\n\")\n    wgi.Done()\n\n    fmt.Printf(\"for ended\")\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 608, "user_id": 4823789, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/16701fdace0347de7dbf1c356d295e76?s=128&d=identicon&r=PG&f=1", "display_name": "ND003", "link": "https://stackoverflow.com/users/4823789/nd003"}, "edited": false, "score": 1, "creation_date": 1549110649, "post_id": 54492714, "comment_id": 95791715, "body": "Use an empty struct."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1549185357, "post_id": 54492714, "comment_id": 95807156, "body": "As long as you do not evaluate the value taken from the channel, I do not see a problem. And you can use Godoc/comments."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1549297243, "post_id": 54492755, "comment_id": 95843208, "body": "I frequently end up defining <code>type Sentinel struct{}</code> and <code>var Nothing = Sentinel{}</code> just to keep code readable and because having <code>struct{}{}</code> everywhere just looks messy to me."}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 11, "last_activity_date": 1549107917, "creation_date": 1549107917, "answer_id": 54492755, "question_id": 54492714, "link": "https://stackoverflow.com/questions/54492714/which-channel-type-should-be-used-when-the-message-is-never-evaluated/54492755#54492755", "title": "Which channel type should be used when the message is never evaluated?", "body": "<p><code>chan struct{}</code> is a valid choice \u2014 <code>struct{}</code> is a valid type, but a value of this type <a href=\"https://dave.cheney.net/2014/03/25/the-empty-struct\" rel=\"noreferrer\">contains no data and has zero size</a>, and all <code>struct{}</code> values are indistinguishable, making it a <a href=\"https://en.wikipedia.org/wiki/Unit_type\" rel=\"noreferrer\">unit type</a> for Go. To construct a value of type <code>struct{}</code> to send on the channel, you can use the literal <code>struct{}{}</code>.</p>\n"}], "owner": {"reputation": 871, "user_id": 2508466, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/UHx7w.jpg?s=128&g=1", "display_name": "yaccob", "link": "https://stackoverflow.com/users/2508466/yaccob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 54492755, "answer_count": 1, "score": 8, "last_activity_date": 1549107917, "creation_date": 1549107667, "question_id": 54492714, "link": "https://stackoverflow.com/questions/54492714/which-channel-type-should-be-used-when-the-message-is-never-evaluated", "title": "Which channel type should be used when the message is never evaluated?", "body": "<p>With the following select statement I want to ensure that some none-blocking function is only executed one by one:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>select {\ncase &lt;-available:\ndefault:\n    fmt.Println(\"busy\")\n    return\n}\ngo func() {\n    defer func() { available &lt;- true }()\n    doSomethingOneByOne()\n}()\n</code></pre>\n\n<p>Currently I'm using <code>bool</code> as a channel type and it works as expected.</p>\n\n<p>What I don't like is that using <code>bool</code> suggests that it matters if the value is <code>true</code> or <code>false</code>. But actually it doesn't matter in this case. In my opinion this makes understanding the code a bit harder because it is misleading.</p>\n\n<p>Is there a convention for which type to use when the value doesn't matter? </p>\n"}, {"tags": ["go", "cryptography", "aes"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user11004990"}, "edited": false, "score": 0, "creation_date": 1549111676, "post_id": 54493138, "comment_id": 95791923, "body": "I use the block variable later in code, so if I remove that it&#39;s going to give me an undefined variable error.<code>util&#47;aes.go:30:35: undefined: block</code>"}], "tags": [], "owner": {"reputation": 608, "user_id": 4823789, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/16701fdace0347de7dbf1c356d295e76?s=128&d=identicon&r=PG&f=1", "display_name": "ND003", "link": "https://stackoverflow.com/users/4823789/nd003"}, "is_accepted": true, "score": 0, "last_activity_date": 1549204437, "last_edit_date": 1549204437, "creation_date": 1549110949, "answer_id": 54493138, "question_id": 54492518, "link": "https://stackoverflow.com/questions/54492518/aes-newcipher-returns-a-valid-block-but-i-get-an-error-when-calling-block-block/54493138#54493138", "title": "aes.NewCipher returns a valid block, but I get an error when calling block.BlockSize()", "body": "<p>Remove this line</p>\n\n<pre><code>var block cipher.Block\n</code></pre>\n\n<p>As you are initializing block in the next line.</p>\n\n<p>Essentially, you are creating 2 block variables.</p>\n"}, {"comments": [{"owner": {"reputation": 608, "user_id": 4823789, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/16701fdace0347de7dbf1c356d295e76?s=128&d=identicon&r=PG&f=1", "display_name": "ND003", "link": "https://stackoverflow.com/users/4823789/nd003"}, "edited": false, "score": 0, "creation_date": 1549204327, "post_id": 54493278, "comment_id": 95811693, "body": "That is what I was trying to tell you. I don&#39;t know why did you vote it down. If that resolves your problem, please accept the answer."}, {"owner": {"user_type": "does_not_exist", "display_name": "user11004990"}, "reply_to_user": {"reputation": 608, "user_id": 4823789, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/16701fdace0347de7dbf1c356d295e76?s=128&d=identicon&r=PG&f=1", "display_name": "ND003", "link": "https://stackoverflow.com/users/4823789/nd003"}, "edited": false, "score": 0, "creation_date": 1549294380, "post_id": 54493278, "comment_id": 95841665, "body": "I didn&#39;t down vote it, your solution was going in the right direction, but it gave new errors, thanks to your suggestion I finally thought of what was wrong."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user11004990"}, "is_accepted": false, "score": 1, "last_activity_date": 1549112078, "creation_date": 1549112078, "answer_id": 54493278, "question_id": 54492518, "link": "https://stackoverflow.com/questions/54492518/aes-newcipher-returns-a-valid-block-but-i-get-an-error-when-calling-block-block/54493278#54493278", "title": "aes.NewCipher returns a valid block, but I get an error when calling block.BlockSize()", "body": "<p>I see my issue now, I'm not that familiar with go, so I was basically creating 2 block variables, one that was accessible function wide and one only accessible form inside the if statement.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user11004990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 54493138, "answer_count": 2, "score": -1, "last_activity_date": 1549204437, "creation_date": 1549106237, "last_edit_date": 1549106766, "question_id": 54492518, "link": "https://stackoverflow.com/questions/54492518/aes-newcipher-returns-a-valid-block-but-i-get-an-error-when-calling-block-block", "title": "aes.NewCipher returns a valid block, but I get an error when calling block.BlockSize()", "body": "<p>I'm trying to get AES encryption and decryption working in my go API, I create a new block using aes.NewCipher(mykey) and the block seems to be valid, but then when I call cipher.NewCBCDecrypter(block, iv) the function causes a \"invalid memory address or nil pointer dereference\" error at line 26 in cbc.go when it tries to call b.BlockSize().</p>\n\n<p>So I tried calling block.BlockSize() from my own code and I also get an exception, but when I check the block var it's not nil.</p>\n\n<pre><code>func Decrypt(data []byte) (result []byte, err error) {\n    logger := logrus.New()\n\n    logger.Infof(\"Starting decryption for string: %s\\n\", string(data[:]))\n\n    var block cipher.Block\n\n    if block, err := aes.NewCipher([]byte(app.Config.AESKey)); (err != nil) || (block == nil) {\n        logger.Infof(\"Failed to create block\\n\")\n        return nil, err\n    }\n\n    if len(data) &lt; aes.BlockSize {\n        logger.Infof(\"Input too short\\n\")\n        return nil, nil\n    }\n\n    cbc := cipher.NewCBCDecrypter(block, []byte(app.Config.AESIV))\n    cbc.CryptBlocks(data, data)\n\n    return data, nil\n}\n</code></pre>\n\n<p>I would expect the function to work properly since aes.NewCipher doesn't return an error.</p>\n"}, {"tags": ["function", "go"], "comments": [{"owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "edited": false, "score": 0, "creation_date": 1549099196, "post_id": 54491583, "comment_id": 95789082, "body": "If you want to return &quot;string array from func&quot; than you need to <code>return s</code> but you <code>return quote</code>"}], "answers": [{"tags": [], "owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "is_accepted": false, "score": 2, "last_activity_date": 1549101251, "creation_date": 1549101251, "answer_id": 54491881, "question_id": 54491583, "link": "https://stackoverflow.com/questions/54491583/not-able-to-print-full-string-array/54491881#54491881", "title": "Not able to print full string array", "body": "<p>Your code returns last value of <code>quote</code> which is the value on last iteration on string array <code>s</code>.</p>\n\n<p>If you need to return string array <code>s</code> - return it. Excuse me for truism.</p>\n\n<pre><code>func varFunc(s ...string) []string {\n\n    fmt.Println(s)\n\n    fmt.Printf(\"%T\\n\", s)\n    quote := \"\"\n    for _, v := range s {\n\n        quote = v\n        fmt.Println(\"init: \", quote)\n    }\n    fmt.Println(\"is there: \", quote)\n    return s\n\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "edited": false, "score": 0, "creation_date": 1549348295, "post_id": 54491889, "comment_id": 95859254, "body": "Note: &quot;I&#39;m trying to return a <b>string array</b> from a function&quot;"}], "tags": [], "owner": {"reputation": 129, "user_id": 7594900, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Kh0Ve.jpg?s=128&g=1", "display_name": "WutchZone", "link": "https://stackoverflow.com/users/7594900/wutchzone"}, "is_accepted": false, "score": 3, "last_activity_date": 1549101301, "creation_date": 1549101301, "answer_id": 54491889, "question_id": 54491583, "link": "https://stackoverflow.com/questions/54491583/not-able-to-print-full-string-array/54491889#54491889", "title": "Not able to print full string array", "body": "<p>Because you are overwriting the last value with <code>=</code> operator. If i understood correctly you are trying to print array as a single string. Apply <code>+=</code> symbol to <code>qoute</code> and it should work for you.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n\n    myquote := varFunc(\"Go\", \"Bunny\", \"Let's\", \"Change\", \"ourself\")\n    fmt.Println(\"here also:\", myquote)\n\n}\n\nfunc varFunc(s ...string) string {\n\n    fmt.Println(s)\n\n    fmt.Printf(\"%T\\n\", s)\n    quote := \"\"\n    for _, v := range s {\n\n        quote += v + \" \"\n        fmt.Println(\"init: \", quote)\n    }\n    fmt.Println(\"is there: \", quote)\n    return quote\n\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 9057760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/469c13f1d5372a70973374fa08a997a4?s=128&d=identicon&r=PG&f=1", "display_name": "Akhilesh", "link": "https://stackoverflow.com/users/9057760/akhilesh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1549101301, "creation_date": 1549098571, "last_edit_date": 1549100874, "question_id": 54491583, "link": "https://stackoverflow.com/questions/54491583/not-able-to-print-full-string-array", "title": "Not able to print full string array", "body": "<p>I'm trying to return a string array from a function, but it is printing only the last index position value. Here is my code and output.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n\n    myquote := varFunc(\"Go\", \"Bunny\", \"Let's\", \"Change\", \"ourself\")\n    fmt.Println(\"here also:\", myquote)\n\n}\n\nfunc varFunc(s ...string) string {\n\n    fmt.Println(s)\n\n    fmt.Printf(\"%T\\n\", s)\n    quote := \"\"\n    for _, v := range s {\n\n        quote = v\n        fmt.Println(\"init: \", quote)\n    }\n    fmt.Println(\"is there: \", quote)\n    return quote\n\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/jyZDL5oPmcz\" rel=\"nofollow noreferrer\">https://play.golang.org/p/jyZDL5oPmcz</a></p>\n\n<p>My output:</p>\n\n<pre><code>[Go Bunny Let's Change ourself]\n[]string\ninit:  Go\ninit:  Bunny\ninit:  Let's\ninit:  Change\ninit:  ourself\nis there:  ourself\nhere also: ourself\n\nProgram exited.\n</code></pre>\n"}, {"tags": ["mongodb", "go"], "answers": [{"comments": [{"owner": {"reputation": 638, "user_id": 4380048, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1d95bf68a0b437b36450e18b08f6ef71?s=128&d=identicon&r=PG&f=1", "display_name": "Forkmohit", "link": "https://stackoverflow.com/users/4380048/forkmohit"}, "edited": false, "score": 0, "creation_date": 1549098560, "post_id": 54491456, "comment_id": 95788948, "body": "There are few more fields apart from name, I want it to (not)match to."}, {"owner": {"reputation": 384, "user_id": 2987525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e6f7d5672002a61ac41d8011669ead3?s=128&d=identicon&r=PG&f=1", "display_name": "RichieK", "link": "https://stackoverflow.com/users/2987525/richiek"}, "reply_to_user": {"reputation": 638, "user_id": 4380048, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1d95bf68a0b437b36450e18b08f6ef71?s=128&d=identicon&r=PG&f=1", "display_name": "Forkmohit", "link": "https://stackoverflow.com/users/4380048/forkmohit"}, "edited": false, "score": 0, "creation_date": 1549099318, "post_id": 54491456, "comment_id": 95789117, "body": "then just add them to the match query and array filters"}], "tags": [], "owner": {"reputation": 384, "user_id": 2987525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e6f7d5672002a61ac41d8011669ead3?s=128&d=identicon&r=PG&f=1", "display_name": "RichieK", "link": "https://stackoverflow.com/users/2987525/richiek"}, "is_accepted": false, "score": 0, "last_activity_date": 1549097469, "creation_date": 1549097469, "answer_id": 54491456, "question_id": 54490828, "link": "https://stackoverflow.com/questions/54490828/how-to-update-a-field-in-an-array-in-the-documnet/54491456#54491456", "title": "How to update a field in an array in the documnet", "body": "<p>If you have Mongo >= 3.6, here an example to edit all but the last with name 126.</p>\n\n<pre><code>db.collection.update(\n  { \"id\" : \"fafsahjaf867rwhrbjw\", \"files.name\": \"126\" },\n  { \"$set\": { \"files.$[elem].status\": \"INACTIVE\" } },\n  { \"arrayFilters\": [{ \"elem.name\": {$ne : \"126\"} }], \"multi\": true }\n)\n</code></pre>\n\n<p>Got that solution from <a href=\"https://stackoverflow.com/questions/4669178/how-to-update-multiple-array-elements-in-mongodb\">How to Update Multiple Array Elements in mongodb</a></p>\n"}], "owner": {"reputation": 638, "user_id": 4380048, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1d95bf68a0b437b36450e18b08f6ef71?s=128&d=identicon&r=PG&f=1", "display_name": "Forkmohit", "link": "https://stackoverflow.com/users/4380048/forkmohit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 44, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1549097469, "creation_date": 1549090934, "question_id": 54490828, "link": "https://stackoverflow.com/questions/54490828/how-to-update-a-field-in-an-array-in-the-documnet", "title": "How to update a field in an array in the documnet", "body": "<p>I have a document with following structure. I want to insert a new file in the array <strong>files</strong> followed by making all other file status set to \"INACTIVE\". After inserting,  I am trying following code to update other file of the array but it is unable to match.</p>\n\n<pre><code>{\n  {\n \"id\":\"fafsahjaf867rwhrbjw\",\n \"files\" : [\n            {\"name\": \"123\", status:\"ACTIVE\"},\n            {\"name\": \"124\", status:\"ACTIVE\"},\n            {\"name\": \"125\", status:\"ACTIVE\"},\n            {\"name\": \"126\", status:\"ACTIVE\"},\n           ] \n   },\n}\n</code></pre>\n\n<hr>\n\n<pre><code>    query = bson.M{ \"id\": productId,\n    \"files\": bson.M{\n        \"$not\": bson.M{\"$elemMatch\": fileObj}}}\n\n    update = bson.M{\n    \"$set\": bson.M{\n        \"files.$.status\": \"INACTIVE\",\n    },\n  }\n</code></pre>\n"}, {"tags": ["xml", "go"], "answers": [{"comments": [{"owner": {"reputation": 4708, "user_id": 2018197, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/e79644ab55e429eef882608a17f09a86?s=128&d=identicon&r=PG", "display_name": "Kakar", "link": "https://stackoverflow.com/users/2018197/kakar"}, "edited": false, "score": 1, "creation_date": 1549100979, "post_id": 54490881, "comment_id": 95789535, "body": "<code>newlines before and after the content within the loc elements.</code>! That was it!"}], "tags": [], "owner": {"reputation": 2783, "user_id": 4145098, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/41Miz.jpg?s=128&g=1", "display_name": "Ullaakut", "link": "https://stackoverflow.com/users/4145098/ullaakut"}, "is_accepted": true, "score": 1, "last_activity_date": 1549091949, "last_edit_date": 1549091949, "creation_date": 1549091476, "answer_id": 54490881, "question_id": 54490304, "link": "https://stackoverflow.com/questions/54490304/xml-parsing-returns-string-with-newlines/54490881#54490881", "title": "XML parsing returns string with newlines", "body": "<p>You are right indeed, the issue comes from the newlines. As you can see, you are using <code>Printf</code> without adding any <code>\\n</code> and one is added at the beginning and one at the end in the output.</p>\n\n<p>You can use <a href=\"https://golang.org/pkg/strings/#Trim\" rel=\"nofollow noreferrer\"><code>strings.Trim</code></a> to remove those newlines. Here is <a href=\"https://goplay.space/#yLpX1NTY3dJ\" rel=\"nofollow noreferrer\">an example</a> working with the sitemap that you are trying to parse. Once the string is trimmed, you will be able to call <code>http.Get</code> on it without any errors.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    var s SitemapIndex\n    xml.Unmarshal(bytes, &amp;s)\n\n    for _, Location := range s.Locations {\n        loc := strings.Trim(Location.Loc, \"\\n\")\n        fmt.Printf(\"Location: %s\\n\", loc)\n    }\n}\n</code></pre>\n\n<p>This code properly outputs the locations without any newlines, as expected:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>Location: https://www.washingtonpost.com/news-sitemaps/politics.xml\nLocation: https://www.washingtonpost.com/news-sitemaps/opinions.xml\nLocation: https://www.washingtonpost.com/news-sitemaps/local.xml\nLocation: https://www.washingtonpost.com/news-sitemaps/sports.xml\nLocation: https://www.washingtonpost.com/news-sitemaps/national.xml\nLocation: https://www.washingtonpost.com/news-sitemaps/world.xml\nLocation: https://www.washingtonpost.com/news-sitemaps/business.xml\nLocation: https://www.washingtonpost.com/news-sitemaps/technology.xml\nLocation: https://www.washingtonpost.com/news-sitemaps/lifestyle.xml\nLocation: https://www.washingtonpost.com/news-sitemaps/entertainment.xml\nLocation: https://www.washingtonpost.com/news-sitemaps/goingoutguide.xml\n</code></pre>\n\n<p>The reason why you have those newlines in the <code>Location.Loc</code> field is because of the XML returned by this URL. Entries are following this form:</p>\n\n<pre class=\"lang-xml prettyprint-override\"><code>&lt;sitemap&gt;\n&lt;loc&gt;\nhttps://www.washingtonpost.com/news-sitemaps/goingoutguide.xml\n&lt;/loc&gt;\n&lt;/sitemap&gt;\n</code></pre>\n\n<p>And as you can see, there are newlines before and after the content within the <code>loc</code> elements.</p>\n"}, {"tags": [], "owner": {"reputation": 5880, "user_id": 166233, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/b88b1c85a798a2aee3a35f5cd805d0e2?s=128&d=identicon&r=PG", "display_name": "Steve Wilhelm", "link": "https://stackoverflow.com/users/166233/steve-wilhelm"}, "is_accepted": false, "score": 1, "last_activity_date": 1549128838, "last_edit_date": 1549128838, "creation_date": 1549091538, "answer_id": 54490890, "question_id": 54490304, "link": "https://stackoverflow.com/questions/54490304/xml-parsing-returns-string-with-newlines/54490890#54490890", "title": "XML parsing returns string with newlines", "body": "<p>See the comments embedded in the modified code to describe and fix the issue</p>\n\n<pre><code>func main() {\n    resp, _ := http.Get(\"https://www.washingtonpost.com/news-sitemaps/index.xml\")\n    bytes, _ := ioutil.ReadAll(resp.Body)\n    var s SitemapIndex\n    xml.Unmarshal(bytes, &amp;s)\n    for _, Location := range s.Locations {\n            // Note that %v shows that there are indeed newlines at beginning and end of Location.Loc\n            fmt.Printf(\"Location: (%v)\", Location.Loc)\n            // solution: use strings.TrimSpace to remove newlines from Location.Loc\n            resp, err := http.Get(strings.TrimSpace(Location.Loc))\n            fmt.Println(\"resp\", resp)\n            fmt.Println(\"err\", err)\n    }\n</code></pre>\n\n<p>}</p>\n"}], "owner": {"reputation": 4708, "user_id": 2018197, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/e79644ab55e429eef882608a17f09a86?s=128&d=identicon&r=PG", "display_name": "Kakar", "link": "https://stackoverflow.com/users/2018197/kakar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "accepted_answer_id": 54490881, "answer_count": 2, "score": 1, "last_activity_date": 1549128838, "creation_date": 1549085700, "last_edit_date": 1549116817, "question_id": 54490304, "link": "https://stackoverflow.com/questions/54490304/xml-parsing-returns-string-with-newlines", "title": "XML parsing returns string with newlines", "body": "<p>I am trying to parse XML via the sitemap, and then loop over the address to get the details of the post in Go. But I am getting this weird error:</p>\n\n<blockquote>\n  <p>: first path segment in URL cannot contain colon</p>\n</blockquote>\n\n<p>This is the code snippet:</p>\n\n<pre><code>type SitemapIndex struct {\n    Locations []Location `xml:\"sitemap\"`\n}\n\ntype Location struct {\n    Loc string `xml:\"loc\"`\n}\n\nfunc (l Location) String() string {\n    return fmt.Sprintf(l.Loc)\n}\n\nfunc main() {\n    resp, _ := http.Get(\"https://www.washingtonpost.com/news-sitemaps/index.xml\")\n    bytes, _ := ioutil.ReadAll(resp.Body)\n    var s SitemapIndex\n    xml.Unmarshal(bytes, &amp;s)\n    for _, Location := range s.Locations {\n        fmt.Printf(\"Location: %s\", Location.Loc)\n        resp, err := http.Get(Location.Loc)\n        fmt.Println(\"resp\", resp)\n        fmt.Println(\"err\", err)\n    }\n}\n</code></pre>\n\n<p>And the output:</p>\n\n<pre><code>Location: \nhttps://www.washingtonpost.com/news-sitemaps/politics.xml\nresp &lt;nil&gt;\nerr parse \nhttps://www.washingtonpost.com/news-sitemaps/politics.xml\n: first path segment in URL cannot contain colon\nLocation: \nhttps://www.washingtonpost.com/news-sitemaps/opinions.xml\nresp &lt;nil&gt;\nerr parse \nhttps://www.washingtonpost.com/news-sitemaps/opinions.xml\n: first path segment in URL cannot contain colon\n...\n...\n</code></pre>\n\n<p>My guess is that the <code>Location.Loc</code> returns a new line before and after the actuall address.\nEg: <code>\\nLocation: https://www.washingtonpost.com/news-sitemaps/politics.xml\\n</code></p>\n\n<p>Because hardcoding the URL works as expected:</p>\n\n<pre><code>for _, Location := range s.Locations {\n        fmt.Printf(\"Location: %s\", Location.Loc)\n        test := \"https://www.washingtonpost.com/news-sitemaps/politics.xml\"\n        resp, err := http.Get(test)\n        fmt.Println(\"resp\", resp)\n        fmt.Println(\"err\", err)\n    }\n</code></pre>\n\n<p>Output, as you can see the error is nil:</p>\n\n<pre><code>Location: \nhttps://www.washingtonpost.com/news-sitemaps/politics.xml\nresp &amp;{200 OK 200 HTTP/2.0 2 0 map[Server:[nginx] Arc-Service:[api] Arc-Org-Name:[washpost] Expires:[Sat, 02 Feb 2019 05:32:38 GMT] Content-Security-Policy:[upgrade-insecure-requests] Arc-Deployment:[washpost] Arc-Organization:[washpost] Cache-Control:[private, max-age=60] Arc-Context:[index] Arc-Application:[Feeds] Vary:[Accept-Encoding] Content-Type:[text/xml; charset=utf-8] Arc-Servername:[api.washpost.arcpublishing.com] Arc-Environment:[index] Arc-Org-Env:[washpost] Arc-Route:[/feeds] Date:[Sat, 02 Feb 2019 05:31:38 GMT]] 0xc000112870 -1 [] false true map[] 0xc00017c200 0xc0000ca370}\nerr &lt;nil&gt;\nLocation: \n...\n...\n</code></pre>\n\n<p>But I am very new to Go, and so I have no idea what's wrong. Could you please tell me where I am wrong?</p>\n"}, {"tags": ["go", "struct", "interface", "polymorphism"], "answers": [{"comments": [{"owner": {"reputation": 7348, "user_id": 2684196, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/45AEF.jpg?s=128&g=1", "display_name": "Willis Blackburn", "link": "https://stackoverflow.com/users/2684196/willis-blackburn"}, "reply_to_user": {"reputation": 646, "user_id": 1011932, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/60d5c176edc9aae48133f89107c4c3d5?s=128&d=identicon&r=PG", "display_name": "river", "link": "https://stackoverflow.com/users/1011932/river"}, "edited": false, "score": 1, "creation_date": 1549124146, "post_id": 54489879, "comment_id": 95795162, "body": "You can use a pointer to an interface variable to change the value of the variable from another scope. If you have <code>func f(a Animal)</code> then you can use <code>a</code> in the function to invoke <code>Animal</code> methods, but if you change the value of <code>a</code> itself, that change is only visible within <code>f</code>. If you instead write <code>func f(a *Animal)</code> then <code>a</code> is now a pointer to some interface variable defined elsewhere, and you can change that variable by setting <code>*a</code>."}], "tags": [], "owner": {"reputation": 7348, "user_id": 2684196, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/45AEF.jpg?s=128&g=1", "display_name": "Willis Blackburn", "link": "https://stackoverflow.com/users/2684196/willis-blackburn"}, "is_accepted": false, "score": 3, "last_activity_date": 1549080399, "creation_date": 1549080399, "answer_id": 54489879, "question_id": 54489752, "link": "https://stackoverflow.com/questions/54489752/cant-assign-a-struct-pointer-to-a-interface-pointer/54489879#54489879", "title": "Can&#39;t assign a struct pointer to a interface pointer", "body": "<p>A variable with an interface type is already a pointer; you don't need to declare it as a pointer to an interface. Just do <code>var a Animal</code> and it will work.</p>\n"}, {"comments": [{"owner": {"reputation": 646, "user_id": 1011932, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/60d5c176edc9aae48133f89107c4c3d5?s=128&d=identicon&r=PG", "display_name": "river", "link": "https://stackoverflow.com/users/1011932/river"}, "edited": false, "score": 0, "creation_date": 1549087416, "post_id": 54490217, "comment_id": 95786956, "body": "If I use <code>Dog</code> to implement <code>Animal</code>, <code>var a *Animal=new(Dog) </code> fails too!  Why? @HolaYang"}, {"owner": {"reputation": 389, "user_id": 6321432, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CpTh0.jpg?s=128&g=1", "display_name": "HolaYang", "link": "https://stackoverflow.com/users/6321432/holayang"}, "reply_to_user": {"reputation": 646, "user_id": 1011932, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/60d5c176edc9aae48133f89107c4c3d5?s=128&d=identicon&r=PG", "display_name": "river", "link": "https://stackoverflow.com/users/1011932/river"}, "edited": false, "score": 0, "creation_date": 1549110889, "post_id": 54490217, "comment_id": 95791763, "body": "That&#39;s another problem, a pointer to interface is almost never useful in golang.w"}, {"owner": {"reputation": 389, "user_id": 6321432, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CpTh0.jpg?s=128&g=1", "display_name": "HolaYang", "link": "https://stackoverflow.com/users/6321432/holayang"}, "reply_to_user": {"reputation": 646, "user_id": 1011932, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/60d5c176edc9aae48133f89107c4c3d5?s=128&d=identicon&r=PG", "display_name": "river", "link": "https://stackoverflow.com/users/1011932/river"}, "edited": false, "score": 0, "creation_date": 1549111014, "post_id": 54490217, "comment_id": 95791793, "body": "Read <a href=\"https://stackoverflow.com/questions/44370277/type-is-pointer-to-interface-not-interface-confusion\">this</a> for more information."}], "tags": [], "owner": {"reputation": 389, "user_id": 6321432, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CpTh0.jpg?s=128&g=1", "display_name": "HolaYang", "link": "https://stackoverflow.com/users/6321432/holayang"}, "is_accepted": false, "score": -1, "last_activity_date": 1549084765, "creation_date": 1549084765, "answer_id": 54490217, "question_id": 54489752, "link": "https://stackoverflow.com/questions/54489752/cant-assign-a-struct-pointer-to-a-interface-pointer/54490217#54490217", "title": "Can&#39;t assign a struct pointer to a interface pointer", "body": "<p><code>Dog</code> is a type, so <code>*Dog</code> is.</p>\n\n<p><code>Dog</code> DOES NOT implement the interface <code>Animal</code>, but <code>*Dog</code> does.</p>\n\n<p>So <code>var a Animal = new(Dog)</code> is ok.</p>\n"}, {"tags": [], "owner": {"reputation": 53, "user_id": 5497296, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GnyH5.pngs?s=128&g=1", "display_name": "AmirSo", "link": "https://stackoverflow.com/users/5497296/amirso"}, "is_accepted": false, "score": 1, "last_activity_date": 1549098721, "creation_date": 1549098721, "answer_id": 54491595, "question_id": 54489752, "link": "https://stackoverflow.com/questions/54489752/cant-assign-a-struct-pointer-to-a-interface-pointer/54491595#54491595", "title": "Can&#39;t assign a struct pointer to a interface pointer", "body": "<p>You must remove pointer from interface.</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>\n//Animal interface\ntype Animal interface {\n    run()\n}\n\n//Dog struct\ntype Dog struct {\n    name string\n}\n\nfunc (d *Dog) run() {\n    fmt.Println(d.name, \"is running\")\n}\n\nfunc main() {\n    var d *Dog\n    var a Animal\n\n    d = new(Dog)\n    d.name = \"Putty\"\n    d.run()\n    a = d //errors here\n    a.run()\n}\n\n</code></pre>\n"}], "owner": {"reputation": 646, "user_id": 1011932, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/60d5c176edc9aae48133f89107c4c3d5?s=128&d=identicon&r=PG", "display_name": "river", "link": "https://stackoverflow.com/users/1011932/river"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 253, "favorite_count": 1, "answer_count": 3, "score": 0, "last_activity_date": 1549100965, "creation_date": 1549078602, "last_edit_date": 1549100965, "question_id": 54489752, "link": "https://stackoverflow.com/questions/54489752/cant-assign-a-struct-pointer-to-a-interface-pointer", "title": "Can&#39;t assign a struct pointer to a interface pointer", "body": "<p>The struct <code>Dog</code> implemetments all the methods of interface <code>Animal</code>, why does <code>*Dos</code> can't be assigned to <code>*Animal</code> ?</p>\n\n<pre><code>type Animal interface {\n    run()\n}\n\ntype Dog struct {\n    name string\n}\n\nfunc (d *Dog) run() {\n    fmt.Println( d.name , \" is running\")\n}\n\nfunc main(){\n    var d *Dog\n    var a *Animal\n\n    d = new(Dog)\n    d.run()\n    a = d   //errors here\n}\n</code></pre>\n\n<p>Go informs the following errros:</p>\n\n<pre><code>Cannot use 'd' (type *Dog) as type *Animal in assignment\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "is_accepted": true, "score": 1, "last_activity_date": 1549126790, "last_edit_date": 1549126790, "creation_date": 1549077022, "answer_id": 54489625, "question_id": 54489520, "link": "https://stackoverflow.com/questions/54489520/building-in-array-containing-both-strings-and-regex-patterns/54489625#54489625", "title": "Building $in array containing both strings and regex patterns", "body": "<p>Use <code>[]interface{}</code>:</p>\n\n<pre><code>matches := []interface{}{\n    bson.RegEx{\"jo.+\", \"i\"},\n    \"David\",\n    \"Jenna\",\n}\n\ndb.C(\"people\").Find(bson.M{\"name\": bson.M{\"$in\": matches}})\n</code></pre>\n\n<p><code>[]</code> means slice and <code>interface{}</code> means any type. Put together, <code>[]interface{}</code> is a slice of any type.</p>\n"}], "owner": {"reputation": 6255, "user_id": 163757, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/01b44077976666b4de7a7f252248419b?s=128&d=identicon&r=PG", "display_name": "user163757", "link": "https://stackoverflow.com/users/163757/user163757"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 54489625, "answer_count": 1, "score": 0, "last_activity_date": 1549126790, "creation_date": 1549075714, "last_edit_date": 1549100976, "question_id": 54489520, "link": "https://stackoverflow.com/questions/54489520/building-in-array-containing-both-strings-and-regex-patterns", "title": "Building $in array containing both strings and regex patterns", "body": "<p>I have a Mongo collection where every document in the collection has a sources array property.  Searches on this property can be a combination of exact matches and regex.  For example, when using Mongo shell, the query below searches for documents with source='gas valves' OR 'hose' is contained in source item.  This works just as I expect</p>\n\n<pre><code>db.notice.find({sources:{$in:[/\\bhose/i,'gas valves']}})\n</code></pre>\n\n<p>Things get a little trickier in mgo.  Because some items in the $in array can be regex, and the others strings - the only way I have figured to make a query is by using $or:</p>\n\n<pre><code>var regEx []bson.RegEx\nvar matches []string\n// do stuff to populate regEx and matches\nfilter[\"$or\"] = []bson.M{\n    {\"sources\":bson.M{\"$in\":regEx}},\n    {\"sources\":bson.M{\"$in\":matches}},\n}\n</code></pre>\n\n<p>Is there some way I could construct one slice with both regex and string to use with $in - eliminating the need for the $or</p>\n"}, {"tags": ["go", "google-cloud-platform", "google-cloud-functions"], "answers": [{"tags": [], "owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "is_accepted": false, "score": 4, "last_activity_date": 1549404137, "last_edit_date": 1549404137, "creation_date": 1549068705, "answer_id": 54488960, "question_id": 54488732, "link": "https://stackoverflow.com/questions/54488732/cloud-function-deployment-time/54488960#54488960", "title": "Cloud function deployment time", "body": "<p>I've observed similar behavior. This seems to happen when your <code>go.mod</code> file includes large packages that need to be fetched during deployment. To streamline deployments make sure, you can vendor your dependencies (<code>go mod tidy</code>, <code>go mod vendor</code>).</p>\n\n<p>Note that if you your deployed files include a <code>go.mod</code> file, <a href=\"https://cloud.google.com/functions/docs/concepts/go-runtime#vendor_directory\" rel=\"nofollow noreferrer\">the vendor directory will be ignored</a>. If you deploy your functions using the gcloud CLI, create a <code>.gcloudignore</code> file in your project's directory and add <code>go.mod</code> and <code>go.sum</code> to that file.</p>\n\n<p>For example:</p>\n\n<p>.gcloudignore</p>\n\n<pre><code>.gcloudignore\n.git\n.gitignore\ngo.mod\ngo.sum\n</code></pre>\n\n<p>In my case it reduced deployment time up to 4 times.</p>\n"}], "owner": {"reputation": 11, "user_id": 9706108, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f92ad6ec166dcb6ce3dcdfb62973b121?s=128&d=identicon&r=PG&f=1", "display_name": "kyle-la", "link": "https://stackoverflow.com/users/9706108/kyle-la"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1549404137, "creation_date": 1549066373, "last_edit_date": 1549077741, "question_id": 54488732, "link": "https://stackoverflow.com/questions/54488732/cloud-function-deployment-time", "title": "Cloud function deployment time", "body": "<p>I am deploying a function to cloud function, but it takes substantial time to deploy. How can I optimize my deployment?</p>\n\n<p>I have tried deployed with and without go.mod. I have also tried include vendor (go mod vendor).</p>\n\n<p>gcloud functions deploy FuncX --entry-point FuncX --runtime go111 --trigger-http</p>\n"}, {"tags": ["go", "go-html-template"], "answers": [{"tags": [], "owner": {"reputation": 1267, "user_id": 1598790, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a11ea12f06eefbb34068f4c1090e2e0b?s=128&d=identicon&r=PG", "display_name": "ramrunner", "link": "https://stackoverflow.com/users/1598790/ramrunner"}, "is_accepted": true, "score": 1, "last_activity_date": 1549090878, "last_edit_date": 1549090878, "creation_date": 1549089791, "answer_id": 54490702, "question_id": 54488703, "link": "https://stackoverflow.com/questions/54488703/how-to-render-templates-for-multiple-models-with-common-partials/54490702#54490702", "title": "How to render templates for multiple models with common partials", "body": "<p>just a barebones solution would be the following:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"text/template\"\n)\n\nfunc main() {\n    //read in one go the header, footer and all your other tmpls.\n    //append to that slice every time the relevant content that you want rendered.\n    alltmpls := []string{\"./layouts/header.tmpl\", \"./layouts/footer.tmpl\", \"./users/index.tmpl\"}\n    templates, err := template.ParseFiles(alltmpls...)\n    t := templates.Lookup(\"header.tmpl\")\n    t.ExecuteTemplate(os.Stdout, \"header\", nil)\n    t = templates.Lookup(\"index.tmpl\")\n    t.ExecuteTemplate(os.Stdout, \"index\", nil)\n    t = templates.Lookup(\"footer.tmpl\")\n    t.ExecuteTemplate(os.Stdout, \"footer\", nil)\n}\n</code></pre>\n\n<p>in reality you would want a function that returns a slice of the appropriate files to populate the alltmpls variable. It should scan your directories and get all files from there to pass to ParseFiles() and then proceed to call the Lookup and ExecuteTemplate steps for every template.</p>\n\n<p>Taking this idea further, i would create a new type that would embed a template (or a slice of templates) to be annotated by a header and a footer.</p>\n\n<pre><code>type hftemplate struct {\n    template.Template\n    header, footer *template.Template\n}\n\nfunc (h *hftemplate) ExecuteTemplate(wr io.Writer, name string, data interface{}) error {\n    h.header.ExecuteTemplate(wr, \"header\", nil)\n    err := h.ExecuteTemplate(wr, name, data)\n    h.footer.ExecuteTemplate(wr, \"footer\", nil)\n    return err\n}\n</code></pre>\n\n<p>and of course you can turn that struct embedding into a fully fledged field of []Template to do multiple ExecuteTemplates between the header and the footer.</p>\n"}], "owner": {"reputation": 1176, "user_id": 951321, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/9eb886c753c17c33ba7fd8061af43e3f?s=128&d=identicon&r=PG", "display_name": "markhorrocks", "link": "https://stackoverflow.com/users/951321/markhorrocks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 195, "favorite_count": 0, "accepted_answer_id": 54490702, "answer_count": 1, "score": 0, "last_activity_date": 1549100988, "creation_date": 1549066139, "last_edit_date": 1549100988, "question_id": 54488703, "link": "https://stackoverflow.com/questions/54488703/how-to-render-templates-for-multiple-models-with-common-partials", "title": "How to render templates for multiple models with common partials", "body": "<p>I have many models in my golang project with CRUD views and I want to render these with common headers and footers but can't figure out how to do it. The examples I've seen are too simplistic.</p>\n\n<p>Suppose I have a template structure like this:</p>\n\n<pre><code>templates\n  - layouts\n    - header.tmpl\n    - footer.tmpl\n  - users\n    - index.tmpl\n    - new.tmpl\n    - edit.tmpl\n    - show.tmpl   \n  - venues\n    - index.tmpl\n    - new.tmpl\n    - edit.tmpl\n    - show.tmpl   \n</code></pre>\n\n<p>How do I render these templates for a specified model with the common header and footer?</p>\n"}, {"tags": ["tensorflow", "go"], "answers": [{"tags": [], "owner": {"reputation": 5655, "user_id": 6708503, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b6830ee25bc34994df9835cc17b64aa?s=128&d=identicon&r=PG&f=1", "display_name": "ash", "link": "https://stackoverflow.com/users/6708503/ash"}, "is_accepted": false, "score": 0, "last_activity_date": 1550448681, "creation_date": 1550448681, "answer_id": 54738919, "question_id": 54488423, "link": "https://stackoverflow.com/questions/54488423/golang-tensorflow-batch-image-input/54738919#54738919", "title": "Golang Tensorflow Batch Image Input", "body": "<p>The Go API isn't as comprehensive and to make things easier there are a few additions that could be made. However, given the current API, it is <em>possible</em> to construct the batched tensor using something like this:</p>\n\n<pre><code>var buf bytes.Buffer\nfor i, img := range images {\n  bytes, err := gocv.IMEncode(gocv.JPEGFileExt, img)\n  if err != nil {\n    fmt.Println(\"Error\")\n  }\n  tensor, err = tf.NewTensor(string(bytes))\n  if err != nil {\n    fmt.Println(\"Error\")\n  }\n  normalized, err := session.Run(\n    map[tf.Output]*Tensor: { input: tensor },\n    []tf.Output{output},\n    nil)\n  if _, err := normalized[0].WriteContentsTo(&amp;buf); err != nil {\n    // Handle error\n  }\n}\n\nbatchShape := []int64{len(images), 224, 224, 3}\nbatch, err := tf.ReadTensor(tf.Float, batchShape, &amp;buf)\nif err != nil {\n  // Handle error\n}\n\n// Now feed \"batch\" to the model\n</code></pre>\n\n<p>Another alternative would be to do this batching in the graph by constructing a graph that packs multiple single-image tensors together in a batch using the <a href=\"https://godoc.org/github.com/tensorflow/tensorflow/tensorflow/go/op#Pack\" rel=\"nofollow noreferrer\"><code>Pack</code></a> operation).</p>\n\n<p>Hope that helps.</p>\n\n<p>(P.S. Seems like you also asked this in a GitHub issue and the same answer is posited there: <a href=\"https://github.com/tensorflow/tensorflow/issues/25440\" rel=\"nofollow noreferrer\">https://github.com/tensorflow/tensorflow/issues/25440</a>)</p>\n"}], "owner": {"reputation": 41, "user_id": 10817065, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Lh9lPRnGk9E/AAAAAAAAAAI/AAAAAAAAABI/zGCgsMNTWZ4/photo.jpg?sz=128", "display_name": "Anil Kumar Nayak", "link": "https://stackoverflow.com/users/10817065/anil-kumar-nayak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 356, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1550448681, "creation_date": 1549063404, "question_id": 54488423, "link": "https://stackoverflow.com/questions/54488423/golang-tensorflow-batch-image-input", "title": "Golang Tensorflow Batch Image Input", "body": "<p>Problem Statement: Could not able to make batch image processing in GO Tensorflow.</p>\n\n<p>I have been going through following URL on GoLang Tensorflow.\n<a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/go/example_inception_inference_test.go\" rel=\"nofollow noreferrer\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/go/example_inception_inference_test.go</a></p>\n\n<p>I am Facing problem while making batch of images for input to model.\nCheck this line\n<a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/go/example_inception_inference_test.go#L199\" rel=\"nofollow noreferrer\">https://github.com/tensorflow/tensorflow/blob/master/tensorflow/go/example_inception_inference_test.go#L199</a></p>\n\n<p>Any help will be appreciated!</p>\n\n<pre><code>result, err := classifier.Session.Run(\n        map[tf.Output]*tf.Tensor{\n            inputTensor.Output(0): imageTensor,\n        },\n        []tf.Output{\n            outputTensorOne.Output(0),\n            outputTensorTwo.Output(0),\n        },\n        nil, /*targets*/\n    )\n\n// How to make that imageTensor a batch of images in GO Tensorflow.\n</code></pre>\n"}, {"tags": ["go", "timeout", "mutex"], "comments": [{"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "edited": false, "score": 2, "creation_date": 1549063271, "post_id": 54488284, "comment_id": 95783282, "body": "Also discussed here: <a href=\"https://groups.google.com/forum/#!msg/golang-nuts/MTaJNZ49u60/fqHSq8fYI7oJ\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!msg/golang-nuts/MTaJNZ49u60/&hellip;</a> and <a href=\"https://groups.google.com/forum/#!msg/golang-nuts/OM37bQ41n3Q/wtZgT5wwtUcJ\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!msg/golang-nuts/OM37bQ41n3Q/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 3, "last_activity_date": 1549063699, "creation_date": 1549063699, "answer_id": 54488460, "question_id": 54488284, "link": "https://stackoverflow.com/questions/54488284/attempting-to-acquire-a-lock-with-a-deadline-in-golang/54488460#54488460", "title": "Attempting to acquire a lock with a deadline in golang?", "body": "<p>I think you're asking several different things here:</p>\n\n<ol>\n<li><p>Does this facility exist in the standard libray? No, it doesn't. You can probably find implementations elsewhere - this is possible to implement <em>using</em> the standard library (atomics, for example).</p></li>\n<li><p>Why doesn't this facility exist in the standard library: the issue you mentioned in the question is one discussion. There are also several discussions on the go-nuts mailing list with several Go code developers contributing: <a href=\"https://groups.google.com/forum/#!msg/golang-nuts/OM37bQ41n3Q/wtZgT5wwtUcJ\" rel=\"nofollow noreferrer\">link 1</a>, <a href=\"https://groups.google.com/forum/#!msg/golang-nuts/MTaJNZ49u60/fqHSq8fYI7oJ\" rel=\"nofollow noreferrer\">link 2</a>. And it's easy to find other discussions by googling.</p></li>\n<li><p>How can I design my program such that I won't need this?</p></li>\n</ol>\n\n<p>The answer to (3) is more nuanced and depends on your exact issue. Your question already says</p>\n\n<blockquote>\n  <p>It is possible to implement it as a worker queue (with channels and\n  stuff), but in that case it becomes more difficult to gauge and\n  utilize all available CPU</p>\n</blockquote>\n\n<p>Without providing details on why it would be more difficult to utilize all CPUs, as opposed to checking for a mutex lock state.</p>\n\n<p>In Go you usually want channels whenever the locking schemes become non-trivial. It shouldn't be slower, and it should be much more maintainable. </p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 25, "last_activity_date": 1549064219, "last_edit_date": 1549064219, "creation_date": 1549063837, "answer_id": 54488475, "question_id": 54488284, "link": "https://stackoverflow.com/questions/54488284/attempting-to-acquire-a-lock-with-a-deadline-in-golang/54488475#54488475", "title": "Attempting to acquire a lock with a deadline in golang?", "body": "<p>Use a channel with buffer size of one as mutex.</p>\n\n<pre><code>l := make(chan struct{}, 1)\n</code></pre>\n\n<p>Lock:</p>\n\n<pre><code>l &lt;- struct{}{}\n</code></pre>\n\n<p>Unlock:</p>\n\n<pre><code>&lt;-l\n</code></pre>\n\n<p>Try lock:</p>\n\n<pre><code>select {\ncase l &lt;- struct{}{}:\n    // lock acquired\n    &lt;-l\ndefault:\n    // lock not acquired\n}\n</code></pre>\n\n<p>Try with timeout:</p>\n\n<pre><code>select {\ncase l &lt;- struct{}{}:\n    // lock acquired\n    &lt;-l\ncase &lt;-time.After(time.Minute):\n    // lock not acquired\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 13476329, "user_type": "registered", "profile_image": "https://graph.facebook.com/10157214817285963/picture?type=large", "display_name": "Viney", "link": "https://stackoverflow.com/users/13476329/viney"}, "is_accepted": false, "score": 1, "last_activity_date": 1588771368, "creation_date": 1588771368, "answer_id": 61636333, "question_id": 54488284, "link": "https://stackoverflow.com/questions/54488284/attempting-to-acquire-a-lock-with-a-deadline-in-golang/61636333#61636333", "title": "Attempting to acquire a lock with a deadline in golang?", "body": "<p>How about this package: <a href=\"https://github.com/viney-shih/go-lock\" rel=\"nofollow noreferrer\">https://github.com/viney-shih/go-lock</a> . It use <strong>channel</strong> and <strong>semaphore</strong> (<a href=\"https://github.com/golang/sync/blob/master/semaphore/semaphore.go\" rel=\"nofollow noreferrer\">golang.org/x/sync/semaphore</a>) to solve your problem.</p>\n\n<p><code>go-lock</code> implements <code>TryLock</code>, <code>TryLockWithTimeout</code> and <code>TryLockWithContext</code> functions in addition to Lock and Unlock. It provides flexibility to control the resources.</p>\n\n<p>Examples:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n    \"context\"\n\n    lock \"github.com/viney-shih/go-lock\"\n)\n\nfunc main() {\n    casMut := lock.NewCASMutex()\n\n    casMut.Lock()\n    defer casMut.Unlock()\n\n    // TryLock without blocking\n    fmt.Println(\"Return\", casMut.TryLock()) // Return false\n\n    // TryLockWithTimeout without blocking\n    fmt.Println(\"Return\", casMut.TryLockWithTimeout(50*time.Millisecond)) // Return false\n\n    // TryLockWithContext without blocking\n    ctx, cancel := context.WithTimeout(context.Background(), 50*time.Millisecond)\n    defer cancel()\n\n    fmt.Println(\"Return\", casMut.TryLockWithContext(ctx)) // Return false\n\n\n    // Output:\n    // Return false\n    // Return false\n    // Return false\n}\n</code></pre>\n"}], "owner": {"reputation": 61, "user_id": 11003392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0891d4fad4dbe5baa5d376d71128b274?s=128&d=identicon&r=PG&f=1", "display_name": "A Child of The Universe", "link": "https://stackoverflow.com/users/11003392/a-child-of-the-universe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3215, "favorite_count": 0, "accepted_answer_id": 54488460, "answer_count": 3, "score": 5, "last_activity_date": 1588771368, "creation_date": 1549062411, "last_edit_date": 1549658991, "question_id": 54488284, "link": "https://stackoverflow.com/questions/54488284/attempting-to-acquire-a-lock-with-a-deadline-in-golang", "title": "Attempting to acquire a lock with a deadline in golang?", "body": "<p>How can one only attempt to acquire a mutex-like lock in go, either aborting immediately (like <em>TryLock</em> does in other implementations) or by observing some form of deadline (basically <em>LockBefore</em>)?</p>\n\n<p>I can think of 2 situations right now where this would be greatly helpful and where I'm looking for some sort of solution. The first one is: a CPU-heavy service which receives latency sensitive requests (e.g. a web service). In this case you would want to do something like the <em>RPCService</em> example below. It is possible to implement it as a worker queue (with channels and stuff), but in that case it becomes more difficult to gauge and utilize all available CPU. It is also possible to just accept that by the time you acquire the lock your code may already be over deadline, but that is not ideal as it wastes some amount of resources and means we can't do things like a \"degraded ad-hoc response\".</p>\n\n<pre><code>    /* Example 1: LockBefore() for latency sensitive code. */\n    func (s *RPCService) DoTheThing(ctx context.Context, ...) ... {\n      if s.someObj[req.Parameter].mtx.LockBefore(ctx.Deadline()) {\n        defer s.someObj[req.Parameter].mtx.Unlock()\n        ... expensive computation based on internal state ...\n      } else {\n        return s.cheapCachedResponse[req.Parameter]\n      }\n    }\n</code></pre>\n\n<p>Another case is when you have a bunch of objects which should be touched, but which may be locked, and where touching them should complete within a certain amount of time (e.g. updating some stats). In this case you could also either use <em>LockBefore()</em> or some form of <em>TryLock()</em>, see the Stats example below.</p>\n\n<pre><code>    /* Example 2: TryLock() for updating stats. */\n    func (s *StatsObject) updateObjStats(key, value interface{}) {\n      if s.someObj[key].TryLock() {\n        defer s.someObj[key].Unlock()\n        ... update stats ...\n        ... fill in s.cheapCachedResponse ...\n      }\n    }\n\n    func (s *StatsObject) UpdateStats() {\n      s.someObj.Range(s.updateObjStats)\n    }\n</code></pre>\n\n<p>For ease of use, let's assume that in the above case we're talking about the same <em>s.someObj</em>. Any object may be blocked by <em>DoTheThing()</em> operations for a long time, which means we would want to skip it in <em>updateObjStats</em>. Also, we would want to make sure that we return the cheap response in <em>DoTheThing()</em> in case we can't acquire a lock in time.</p>\n\n<p>Unfortunately, sync.Mutex only and exclusively has the functions <em>Lock()</em> and <em>Unlock()</em>. There is no way to <em>potentially</em> acquire a lock. Is there some easy way to do this instead? Am I approaching this class of problems from an entirely wrong angle, and is there a different, more \"go\"ish way to solve them? Or will I have to implement my own Mutex library if I want to solve these? I am aware of <a href=\"https://github.com/golang/go/issues/6123\" rel=\"noreferrer\">issue 6123</a> which seems to suggest that there is no such thing and that the way I'm approaching these problems is entirely un-go-ish.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1549053899, "post_id": 54486751, "comment_id": 95780478, "body": "Context is an interface. You can implement it however you&#39;d like."}, {"owner": {"reputation": 3005, "user_id": 999858, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f1a8a12d17c9e5a10c343b061fb67e34?s=128&d=identicon&r=PG", "display_name": "Tigran Saluev", "link": "https://stackoverflow.com/users/999858/tigran-saluev"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1549091695, "post_id": 54486751, "comment_id": 95787701, "body": "I guess it&#39;s the copy-paste answer then."}], "owner": {"reputation": 3005, "user_id": 999858, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f1a8a12d17c9e5a10c343b061fb67e34?s=128&d=identicon&r=PG", "display_name": "Tigran Saluev", "link": "https://stackoverflow.com/users/999858/tigran-saluev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 309, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1549659235, "creation_date": 1549052908, "last_edit_date": 1549659235, "question_id": 54486751, "link": "https://stackoverflow.com/questions/54486751/cancelling-a-context-with-custom-error-in-go", "title": "Cancelling a context with custom error in Go", "body": "<p>I create cancellable Go context and I need to cancel it from time to time. Yet, the standard \"context cancelled\" error message does not seem quite informative to me. I would like to make custom one. But there is no clear way to do that! When you open <code>context</code> package sources, particularly <code>WithCancel</code> function, you see that the error <code>Cancelled</code> is used but actually there's no reason why custom error object is not an argument of <code>CancelFunc</code>.</p>\n\n<p>The question is, is there a concise way to create cancellable context with custom cancel error message in Go, without copy-pasting <code>WithCancel</code> source code?</p>\n"}, {"tags": ["go", "gcloud", "vendor"], "answers": [{"comments": [{"owner": {"reputation": 7736, "user_id": 2744242, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/71d3267f5993b6b79619213c789524b5?s=128&d=identicon&r=PG&f=1", "display_name": "rafaelcb21", "link": "https://stackoverflow.com/users/2744242/rafaelcb21"}, "edited": false, "score": 0, "creation_date": 1549072032, "post_id": 54488005, "comment_id": 95784986, "body": "Did not work, appears <code>404 page not found</code>. I performed the command <code>go get github.com&#47;gorilla&#47;mux</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 7736, "user_id": 2744242, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/71d3267f5993b6b79619213c789524b5?s=128&d=identicon&r=PG&f=1", "display_name": "rafaelcb21", "link": "https://stackoverflow.com/users/2744242/rafaelcb21"}, "edited": false, "score": 0, "creation_date": 1549072866, "post_id": 54488005, "comment_id": 95785088, "body": "What specifically did you do that resulted in the 404 page not found?"}, {"owner": {"reputation": 7736, "user_id": 2744242, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/71d3267f5993b6b79619213c789524b5?s=128&d=identicon&r=PG&f=1", "display_name": "rafaelcb21", "link": "https://stackoverflow.com/users/2744242/rafaelcb21"}, "edited": false, "score": 0, "creation_date": 1549082214, "post_id": 54488005, "comment_id": 95786225, "body": "I ran the <code>go get github.com&#47;gorilla&#47;mux</code> command and then the <code>gcloud app deploy</code> Then I went in the browser and put the address <code>http:&#47;&#47;api.testcaixa-803f4.appspot.com&#47;sample</code>. <code>localhost</code> it works..."}, {"owner": {"reputation": 7736, "user_id": 2744242, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/71d3267f5993b6b79619213c789524b5?s=128&d=identicon&r=PG&f=1", "display_name": "rafaelcb21", "link": "https://stackoverflow.com/users/2744242/rafaelcb21"}, "edited": false, "score": 0, "creation_date": 1549082722, "post_id": 54488005, "comment_id": 95786292, "body": "<code>localhost</code> it works but needs the line <code>http.ListenAndServe(&quot;:8000&quot;, r)</code>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 7736, "user_id": 2744242, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/71d3267f5993b6b79619213c789524b5?s=128&d=identicon&r=PG&f=1", "display_name": "rafaelcb21", "link": "https://stackoverflow.com/users/2744242/rafaelcb21"}, "edited": false, "score": 1, "creation_date": 1549091736, "post_id": 54488005, "comment_id": 95787706, "body": "See updated answer.  Use <code>dev_appserver.py</code> to run the server locally.  It will help you find these issues before deploying."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1549091687, "last_edit_date": 1549091687, "creation_date": 1549060456, "answer_id": 54488005, "question_id": 54486017, "link": "https://stackoverflow.com/questions/54486017/in-deploy-gcloud-is-not-encountering-the-vendor-dependencies/54488005#54488005", "title": "In deploy gcloud is not encountering the vendor dependencies", "body": "<p>If you want to use your vendored version of the mux package, then ensure that the SAMPLE-API files are in a <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">Go workspace</a>. </p>\n\n<p>If vendoring is not required, then delete the vendor directory, run <code>go get github.com/gorilla/mux</code> and then deploy your app. In this case, your application files do not need to be in a workspace. </p>\n\n<p>In addition to these build related issues, you must register the Gorilla mux with <a href=\"https://godoc.org/net/http#DefaultServeMux\" rel=\"nofollow noreferrer\">http.DefaultServeMux</a>.  </p>\n\n<pre><code>func init(){\n    r := mux.NewRouter()\n    r.HandleFunc(\"/sample\", GetInfo)\n    http.Handle(\"/\", r)\n}\n</code></pre>\n"}], "owner": {"reputation": 7736, "user_id": 2744242, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/71d3267f5993b6b79619213c789524b5?s=128&d=identicon&r=PG&f=1", "display_name": "rafaelcb21", "link": "https://stackoverflow.com/users/2744242/rafaelcb21"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 54488005, "answer_count": 1, "score": 0, "last_activity_date": 1549091687, "creation_date": 1549049290, "last_edit_date": 1549049737, "question_id": 54486017, "link": "https://stackoverflow.com/questions/54486017/in-deploy-gcloud-is-not-encountering-the-vendor-dependencies", "title": "In deploy gcloud is not encountering the vendor dependencies", "body": "<p>I created by the commands <code>govendor init</code> and <code>govendor fetch \"github.com/gorilla/mux\"</code> the vendor directory in the project.</p>\n\n<p><a href=\"https://i.stack.imgur.com/rVQbP.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/rVQbP.png\" alt=\"enter image description here\"></a></p>\n\n<p>However, when performing deploy in gcloud <code>gcloud app deploy</code> the following error occurs, <code>github.com/gorilla/mux</code> is not found:</p>\n\n<blockquote>\n  <p>ERROR: (gcloud.app.deploy) Error Response: [9] Deployment contains files that cannot be compiled: Compile failed:\n  /work_dir/main.go:5:5: can't find import: \"github.com/gorilla/mux\"</p>\n</blockquote>\n\n<p>What is missing to make deploy work? My plan is free in gcloud</p>\n\n<p><strong>app.yaml</strong></p>\n\n<pre><code>service: api\nruntime: go\napi_version: go1\n\nhandlers:\n- url: /sample\n  script: _go_app\n</code></pre>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"github.com/gorilla/mux\"\n    \"net/http\"\n    \"google.golang.org/appengine\"\n)\n\ntype Foo struct {\n    Text string `json:\"text\"`\n}\n\nfunc GetInfo(w http.ResponseWriter, r *http.Request) {\n    json.NewEncoder(w).Encode(Foo{\"hello\"})\n}\n\nfunc init(){\n    r := mux.NewRouter()\n    r.HandleFunc(\"/sample\", GetInfo)\n}\n\nfunc main() {\n    appengine.Main()\n}\n</code></pre>\n"}, {"tags": ["reactjs", "postgresql", "go"], "answers": [{"comments": [{"owner": {"reputation": 748, "user_id": 5289157, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh3.googleusercontent.com/-KVN5tChB2OQ/AAAAAAAAAAI/AAAAAAAABRk/FEKK6XOtwnI/photo.jpg?sz=128", "display_name": "Greg Miller", "link": "https://stackoverflow.com/users/5289157/greg-miller"}, "edited": false, "score": 0, "creation_date": 1549049080, "post_id": 54485940, "comment_id": 95778697, "body": "Solid idea! It doesn&#39;t have to be on every key press. Mainly wondering if this was a problem that had a popular solution that I just couldn&#39;t find online."}, {"owner": {"reputation": 1723, "user_id": 10007935, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WIHnM.jpg?s=128&g=1", "display_name": "Mike Abeln", "link": "https://stackoverflow.com/users/10007935/mike-abeln"}, "reply_to_user": {"reputation": 748, "user_id": 5289157, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh3.googleusercontent.com/-KVN5tChB2OQ/AAAAAAAAAAI/AAAAAAAABRk/FEKK6XOtwnI/photo.jpg?sz=128", "display_name": "Greg Miller", "link": "https://stackoverflow.com/users/5289157/greg-miller"}, "edited": false, "score": 0, "creation_date": 1549049464, "post_id": 54485940, "comment_id": 95778831, "body": "Fair enough, I&#39;m not sure of a popular solution that exists for the use case. The onBlur method seems like it might be a good option too... any idea why it isn&#39;t always firing?"}, {"owner": {"reputation": 748, "user_id": 5289157, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh3.googleusercontent.com/-KVN5tChB2OQ/AAAAAAAAAAI/AAAAAAAABRk/FEKK6XOtwnI/photo.jpg?sz=128", "display_name": "Greg Miller", "link": "https://stackoverflow.com/users/5289157/greg-miller"}, "edited": false, "score": 1, "creation_date": 1549050095, "post_id": 54485940, "comment_id": 95779065, "body": "It seems to be an issue only on older Safari browsers (I expect IE too). It was a problem to do with event bubbling/propagation within Safari, however it was about a month ago since looking at it so can&#39;t exactly remember the issue.  Nonetheless, I&#39;ll go with your solution until I stumble across something else. It seems reasonable to use this solution anyways. Will update this question if I ever find different solutions!"}], "tags": [], "owner": {"reputation": 1723, "user_id": 10007935, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WIHnM.jpg?s=128&g=1", "display_name": "Mike Abeln", "link": "https://stackoverflow.com/users/10007935/mike-abeln"}, "is_accepted": true, "score": 2, "last_activity_date": 1549048951, "creation_date": 1549048951, "answer_id": 54485940, "question_id": 54485791, "link": "https://stackoverflow.com/questions/54485791/saving-form-data-as-user-types-react-postgres/54485940#54485940", "title": "Saving form data as user types (React/Postgres)", "body": "<p>Does it have to patch the data for every keypress or can you use a delay?</p>\n\n<p>For instance...</p>\n\n<p><strong>User starts typing:</strong> Register the event, set a timeout for say 3 seconds</p>\n\n<p><strong>If the user keeps typing:</strong> reset that timeout back to the full 3s</p>\n\n<p><strong>If the user pauses typing + 3s passes:</strong> patch the data with new value</p>\n\n<p><strong>When the user resumes typing:</strong> set another timeout</p>\n"}], "owner": {"reputation": 748, "user_id": 5289157, "user_type": "registered", "accept_rate": 45, "profile_image": "https://lh3.googleusercontent.com/-KVN5tChB2OQ/AAAAAAAAAAI/AAAAAAAABRk/FEKK6XOtwnI/photo.jpg?sz=128", "display_name": "Greg Miller", "link": "https://stackoverflow.com/users/5289157/greg-miller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 54485940, "answer_count": 1, "score": 1, "last_activity_date": 1549048960, "creation_date": 1549048248, "last_edit_date": 1549048960, "question_id": 54485791, "link": "https://stackoverflow.com/questions/54485791/saving-form-data-as-user-types-react-postgres", "title": "Saving form data as user types (React/Postgres)", "body": "<p>Given a simple textbox to answer a question, how would you go about saving answers as the user types? Assuming that the answer is upserted.</p>\n\n<p>Using a somewhat naive example of an onChange handler and saving answers using an API within that onChange, I ran into two problems:</p>\n\n<ol>\n<li>Sends what seems to be too many patch requests from client to API since it's every time the input textbox answer changes.</li>\n<li>If using postgres upsert or creating your own, then the second request made by the onChange handler may not see the first if the user is typing quickly, creating duplicate records for that textbox (two answers for one question)</li>\n<li>I need to execute queries beforehand to get necessary relationship values before updating, so the HTTP wait time is fairly long. Fixing this now, but seems to not address the above two issues.</li>\n</ol>\n\n<p>I thought of only saving once the user presses spacebar, but that seems hacky. Normally of course I'd save after clicking a submit button, but in this case it must be as the user types.</p>\n\n<p>Any suggestions / comments? Cheers.</p>\n\n<p>EDIT:</p>\n\n<p>Also tried saving within onBlur.. But this doesn't always get called depending on where the user clicks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1549037063, "post_id": 54483028, "comment_id": 95773139, "body": "Those are the only  cases I can think of but read the spec: <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">golang.org/ref/spec</a>"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1549037731, "last_edit_date": 1549037731, "creation_date": 1549037318, "answer_id": 54483122, "question_id": 54483028, "link": "https://stackoverflow.com/questions/54483028/list-of-cases-in-go-that-allow-omitting-an-optional-second-returned-value/54483122#54483122", "title": "List of cases in Go that allow omitting an optional second returned value", "body": "<p>The expressions with optional values when used in an assignment or initialization are:  <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a>, <a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"nofollow noreferrer\">map index</a> and <a href=\"https://golang.org/ref/spec#Receive_operator\" rel=\"nofollow noreferrer\">channel receive</a>.</p>\n\n<p>The specification does not have a formal list of these expressions, but the expressions are all described in the <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">specification</a>.</p>\n"}], "owner": {"reputation": 73, "user_id": 6189601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce27b575ef26c6019c8c7731c7239108?s=128&d=identicon&r=PG&f=1", "display_name": "genexpr", "link": "https://stackoverflow.com/users/6189601/genexpr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "accepted_answer_id": 54483122, "answer_count": 1, "score": 0, "last_activity_date": 1549037731, "creation_date": 1549036976, "question_id": 54483028, "link": "https://stackoverflow.com/questions/54483028/list-of-cases-in-go-that-allow-omitting-an-optional-second-returned-value", "title": "List of cases in Go that allow omitting an optional second returned value", "body": "<p>When calling functions or methods with multiple return values, the caller, if unpacking any return values, must unpack them ALL. </p>\n\n<pre><code>f, err := os.Open(\"filename\")\n</code></pre>\n\n<p>The <code>err</code> variable must be either declared or ignored with the blank identifier <code>_</code>, but it cannot be omitted.</p>\n\n<p>However, there are some operations built into the language, which allow one to omit the optional second return value.</p>\n\n<p>Is there a more or less formal list of situations where an operation with a data structure or a function call returns a second value that is optional and can be ignored by only receiving the first return value? For example:</p>\n\n<pre><code>m := make(map[string]int)\nv, ok := m[\"hello\"]\n</code></pre>\n\n<p>The <code>ok</code> variable is entirely optional and can be omitted.</p>\n\n<pre><code>v := m[\"hello\"]\n</code></pre>\n\n<p>Likewise, with channels:</p>\n\n<p><code>v, ok := &lt;-ch</code></p>\n\n<p>or</p>\n\n<p><code>v := &lt;-ch</code></p>\n\n<p>Are there any other cases of that behavior beyond the two above?</p>\n"}, {"tags": ["go", "package", "gopath"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1549032484, "post_id": 54481747, "comment_id": 95770593, "body": "If you&#39;re using GOPATH, all packages must be in GOPATH to work. You may be inadvertently mixing module and GOPATH behavior here, but you can save yourself a lot of pain later by just following the documentation."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1549040684, "post_id": 54481747, "comment_id": 95775108, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/24306183/can-someone-explain-why-gopath-is-convenient-and-how-it-should-be-used-in-genera\">Can someone explain why GOPATH is convenient and how it should be used in general?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "edited": false, "score": 0, "creation_date": 1549072995, "post_id": 54482073, "comment_id": 95785118, "body": "This is great! So the reason I also want the <code>$HOME&#47;goprivate</code> in there is because it enables me to also import from packages that I&#39;ve written myself? Or are there other reasons to also include <code>$HOME&#47;goprivate</code> in the GOPATH?"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1549033791, "last_edit_date": 1549033791, "creation_date": 1549033482, "answer_id": 54482073, "question_id": 54481747, "link": "https://stackoverflow.com/questions/54481747/what-is-the-reason-to-have-gopath-set-to-my-workspace/54482073#54482073", "title": "What is the reason to have GOPATH set to my workspace?", "body": "<blockquote>\n  <p><code>go help gopath</code></p>\n  \n  <p>Go searches each directory listed in GOPATH to find source code, but\n  new packages are always downloaded into the first directory in the\n  list.</p>\n</blockquote>\n\n<hr>\n\n<p><code>$GOPATH</code> is a directory list. For example, on Linux,</p>\n\n<pre><code>export GOPATH=$HOME/gopublic:$HOME/goprivate\n</code></pre>\n\n<p><code>go get</code> places all downloads in the first directory in the list: <code>$HOME/gopublic</code>. Put all your packages in the second directory in the list: <code>$HOME/goprivate</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 119, "user_id": 9160403, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-K1U7Hl0_D9I/AAAAAAAAAAI/AAAAAAAABfo/3O0tmAVoJYY/photo.jpg?sz=128", "display_name": "Virepri", "link": "https://stackoverflow.com/users/9160403/virepri"}, "is_accepted": false, "score": 0, "last_activity_date": 1549034292, "creation_date": 1549034292, "answer_id": 54482288, "question_id": 54481747, "link": "https://stackoverflow.com/questions/54481747/what-is-the-reason-to-have-gopath-set-to-my-workspace/54482288#54482288", "title": "What is the reason to have GOPATH set to my workspace?", "body": "<p><code>GOPATH</code> is a default directory that the golang toolchain looks at when you're attempting to compile code. It's not <em>technically</em> 100% necessary to set a custom one, as if I recall correctly, it defaults to <code>~/go/</code>.</p>\n\n<p>As peterSO said above, <code>GOPATH</code> is a list and puts packages into the first entry.</p>\n"}], "owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 1, "accepted_answer_id": 54482073, "answer_count": 2, "score": 2, "last_activity_date": 1549073145, "creation_date": 1549032205, "last_edit_date": 1549073145, "question_id": 54481747, "link": "https://stackoverflow.com/questions/54481747/what-is-the-reason-to-have-gopath-set-to-my-workspace", "title": "What is the reason to have GOPATH set to my workspace?", "body": "<p>I read everywhere that my <code>GOPATH</code> must be set to my workspace. If I do that and use <code>go get</code> to get packages from for example github, they are all added to my workspace though, which I don't find particularly useful because it clutters my workspace. In my workspace I expect to find MY code and my code only.</p>\n\n<p>So I now have my own repos in <code>~/repos/go</code> and left my <code>GOPATH</code> to be the default <code>~/go</code>. This works perfect. All libraries I import live in <code>~/go</code>, which keeps my own workplace <code>~/repos/go</code> nice and clean. This works great for me, so I'm not sure why this is not the recommended way of working.</p>\n\n<p>Am I missing something? Are there things I break or are functionalities not working in this way?</p>\n\n<p>All tips are welcome!</p>\n\n<p>[EDIT] To explain why my question is different from <a href=\"https://stackoverflow.com/questions/24306183/can-someone-explain-why-gopath-is-convenient-and-how-it-should-be-used-in-genera\">this question</a>: I know what <code>GOPATH</code> does (define a place to put packages when using go get and a place to import packages from), but I was unaware of why you need to have the public code in the same place as your own code. Turns out there is no need for it, as explained by @peterSO in the (excellent) answer I accepted below.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 153, "user_id": 4894231, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8a3c0fa1e0b2ef9a9607b5239d30b359?s=128&d=identicon&r=PG&f=1", "display_name": "user270386", "link": "https://stackoverflow.com/users/4894231/user270386"}, "edited": false, "score": 0, "creation_date": 1549031650, "post_id": 54481299, "comment_id": 95770142, "body": "But what advantage will this have over time.After? Apart from that, both solutions kind of look same. I was hoping that there might be a better way of doing whole logic inside for loop. Or some different approach altogether instead of reading values from two channels. Is that possible?"}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "reply_to_user": {"reputation": 153, "user_id": 4894231, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8a3c0fa1e0b2ef9a9607b5239d30b359?s=128&d=identicon&r=PG&f=1", "display_name": "user270386", "link": "https://stackoverflow.com/users/4894231/user270386"}, "edited": false, "score": 1, "creation_date": 1549032081, "post_id": 54481299, "comment_id": 95770370, "body": "@user270386: this is the most general solution, and it&#39;s easier than rolling your own function with <code>time.After</code>. It&#39;s general because it allows you actual goroutine to do any blocking thing. Doing blocking operations in goroutines is idiomatic in Go because it results in the simplest code.  Channels and selects are the idiomatic Go approach for mutliplexing concurrent processes."}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 3, "last_activity_date": 1549030506, "creation_date": 1549030506, "answer_id": 54481299, "question_id": 54481108, "link": "https://stackoverflow.com/questions/54481108/how-to-send-updates-from-long-running-goroutine/54481299#54481299", "title": "How to send updates from long running goroutine?", "body": "<p>Consider using <a href=\"https://golang.org/pkg/time/#NewTicker\" rel=\"nofollow noreferrer\">time.NewTicker</a>, which sends a periodic value to a channel. Here's an example from the documentation:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    ticker := time.NewTicker(time.Second)\n    defer ticker.Stop()\n    done := make(chan bool)\n    go func() {\n        time.Sleep(10 * time.Second)\n        done &lt;- true\n    }()\n    for {\n        select {\n        case &lt;-done:\n            fmt.Println(\"Done!\")\n            return\n        case t := &lt;-ticker.C:\n            fmt.Println(\"Current time: \", t)\n        }\n    }\n}\n</code></pre>\n\n<p>Note that the embedded goroutine invoking <code>func</code> emulates a long task by sleeping for 10 seconds, while the caller uses <code>select</code> to wait for the result, while also receiving periodic events from the ticker - this is where you can do the API progress update.</p>\n"}], "owner": {"reputation": 153, "user_id": 4894231, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8a3c0fa1e0b2ef9a9607b5239d30b359?s=128&d=identicon&r=PG&f=1", "display_name": "user270386", "link": "https://stackoverflow.com/users/4894231/user270386"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 490, "favorite_count": 0, "accepted_answer_id": 54481299, "answer_count": 1, "score": 2, "last_activity_date": 1549030506, "creation_date": 1549029897, "question_id": 54481108, "link": "https://stackoverflow.com/questions/54481108/how-to-send-updates-from-long-running-goroutine", "title": "How to send updates from long running goroutine?", "body": "<p>I have a goroutine for a long running job. When the job is done, it pushes the results to a channel. In the meantime, while the job is running, I want to keep updating an API with the status RUNNING.</p>\n\n<p>So far, I have the following code :</p>\n\n<pre><code>func getProgressTimeout() &lt;-chan time.Time {\n    return time.After(5 * time.Minute)\n}\n\nfunc runCommand(arg *Request) {\n    chanResult := make(chan Results)\n\n    go func(args *Request, c chan Results) {\n        resp, err := execCommand(args)\n        c &lt;- Results{\n            resp: resp,\n            err:  err,\n        }\n    }(arg, chanResult)\n\n    var err error\n\nprogressLoop:\n    for {\n        select {\n        case &lt;-getProgressTimeout():\n            updateProgress()  // this method will send status= RUNNING to a REST API\n\n        case out := &lt;-chanResult:\n            err = jobCompleted(request, out)\n            break progressLoop\n        }\n    }\n    return err\n}\n</code></pre>\n\n<p>I am new to golang. And I have reached the above code after lot of trial and error, and googling. It's working now. Still it doesn't feel intuitive to me when I look at it (this may very well be because, I am still trying to learn the Go way of doing things). So my question is, can I refactor this into better shape? Is there some existing pattern which is applicable in this kind of scenario? Or if there is some totally different approach to keep sending periodic updates while job is running?</p>\n\n<p>Also, any suggestions to improve upon my golang concurrency are also appreciated. :)</p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["json", "go", "endpoint"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1549033348, "post_id": 54480198, "comment_id": 95771081, "body": "&quot;How can I know what kind of request is sent if I only have one endpoint&quot; unless you design a way into the API, you can&#39;t, regardless of what language you&#39;re using. That&#39;s just an impossible API design. There has to be some way to detect what the client is trying to do."}, {"owner": {"reputation": 414, "user_id": 3371250, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0f11de743fa7ae72be84540d51e9f571?s=128&d=identicon&r=PG&f=1", "display_name": "Ipsider", "link": "https://stackoverflow.com/users/3371250/ipsider"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1549361966, "post_id": 54480198, "comment_id": 95865780, "body": "Yes, got it. Thanks for the input."}], "answers": [{"comments": [{"owner": {"reputation": 414, "user_id": 3371250, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0f11de743fa7ae72be84540d51e9f571?s=128&d=identicon&r=PG&f=1", "display_name": "Ipsider", "link": "https://stackoverflow.com/users/3371250/ipsider"}, "edited": false, "score": 0, "creation_date": 1549361996, "post_id": 54480774, "comment_id": 95865792, "body": "That makes total sense. Thank you for your input! I created a solution based on this approach."}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 1, "last_activity_date": 1549028994, "last_edit_date": 1549028994, "creation_date": 1549028590, "answer_id": 54480774, "question_id": 54480198, "link": "https://stackoverflow.com/questions/54480198/how-to-create-multiple-validation-methods-for-one-endpoint/54480774#54480774", "title": "How to create multiple validation methods for one endpoint?", "body": "<p>If you have a single endpoint/rpc that has to accept different JSON types, you'll need to tell it how to distinguish between them, somehow. One option is to have something like:</p>\n\n<pre><code>type request struct {\n  bodyA *requestBodyA\n  bodyB *requestBodyB\n}\n</code></pre>\n\n<p>Then, populate these fields in a container JSON object appropriately. The <code>json</code> module will only populate <code>bodyA</code> if a <code>bodyA</code> key is present, otherwise leaving it a <code>nil</code>, and so on.</p>\n\n<p>Here's a more complete example:</p>\n\n<pre><code>type RequestBodyFoo struct {\n    Name    string\n    Balance float64\n}\n\ntype RequestBodyBar struct {\n    Id  int\n    Ref int\n}\n\ntype Request struct {\n    Foo *RequestBodyFoo\n    Bar *RequestBodyBar\n}\n\nfunc (r *Request) Show() {\n    if r.Foo != nil {\n        fmt.Println(\"Request has Foo:\", *r.Foo)\n    }\n    if r.Bar != nil {\n        fmt.Println(\"Request has Bar:\", *r.Bar)\n    }\n}\n\nfunc main() {\n    bb := []byte(`\n    {\n        \"Foo\": {\"Name\": \"joe\", \"balance\": 4591.25}\n    }\n    `)\n\n    var req Request\n    if err := json.Unmarshal(bb, &amp;req); err != nil {\n        panic(err)\n    }\n    req.Show()\n\n    var req2 Request\n    bb = []byte(`\n    {\n        \"Bar\": {\"Id\": 128992, \"Ref\": 801472}\n    }\n    `)\n    if err := json.Unmarshal(bb, &amp;req2); err != nil {\n        panic(err)\n    }\n    req2.Show()\n}\n</code></pre>\n\n<p>Another option is to do it more dynamically with maps, but it's likely that the method above will be sufficient.</p>\n"}], "owner": {"reputation": 414, "user_id": 3371250, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0f11de743fa7ae72be84540d51e9f571?s=128&d=identicon&r=PG&f=1", "display_name": "Ipsider", "link": "https://stackoverflow.com/users/3371250/ipsider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 54480774, "answer_count": 1, "score": -1, "last_activity_date": 1549028994, "creation_date": 1549026461, "question_id": 54480198, "link": "https://stackoverflow.com/questions/54480198/how-to-create-multiple-validation-methods-for-one-endpoint", "title": "How to create multiple validation methods for one endpoint?", "body": "<p>I want to make a validation api in order to validate a set of json requests regarding specific set of rules. To do that I want to use just one endpoint and call functions that correspond to the specific json struct. I know that there is no method overloading in go so I am kind of stumped.</p>\n\n<pre><code>...\n\ntype requestBodyA struct {\n    SomeField   string `json:\"someField\"`\n    SomeOtherField  string `json:\"someOtherField\"`\n}\n\ntype requestBodyB struct {\n    SomeDifferentField   string `json:\"someDifferentField\"`\n    SomeOtherDifferentField  string `json:\"someOtherDifferentField\"`\n}\n\n\n\ntype ValidationService interface {\n    ValidateRequest(ctx context.Context, s string) (err error)\n}\n\ntype basicValidationService struct{}\n\n...\n</code></pre>\n\n<p>So in order to validate lots of different json requests, is it better to create structs for each and every json request? Or should I create these dynamically? How can I know what kind of request is sent if I only have one endpoint?</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 5830441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9d401655ff1e8ffbc4181c91230ef831?s=128&d=identicon&r=PG&f=1", "display_name": "vomnes", "link": "https://stackoverflow.com/users/5830441/vomnes"}, "is_accepted": false, "score": 3, "last_activity_date": 1549028118, "creation_date": 1549028118, "answer_id": 54480633, "question_id": 54480019, "link": "https://stackoverflow.com/questions/54480019/unmarshalling-json-with-elements-2-layers-deep/54480633#54480633", "title": "Unmarshalling JSON with elements 2 layers deep", "body": "<p>You can use the map type</p>\n\n<pre><code>var x map[string]interface{} // Adapt to match with the JSON structure\n</code></pre>\n\n<p>Or you can details all the structure of your JSON</p>\n\n<pre><code>type Item struct {\n   Name string `json:\"name,omitempty\"`\n   Someint int `json:\"Someint,omitempty\"` // or string depend on the data type\n   Somefloat float32 `json:\"somefloat,omitempty\"` // or string depend on the data type\n}\n\ntype Report struct {\n   Report     []map[string][]Item  `json:\"report,omitempty\"` // map[string] because it item1 so I assume it can be item2, item3...\n}\n</code></pre>\n\n<p>Correct code for you needs:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\nfunc main() {\n   type Item struct {\n     Name string `json:\"name,omitempty\"`\n     Someint string `json:\"Someint,omitempty\"` // or int depend on the data type\n     Somefloat string `json:\"somefloat,omitempty\"` // or float32 depend on the data type\n   }\n\n   type Report struct {\n      Report     []map[string][]Item  `json:\"report,omitempty\"` // map[string] because it item1 so I assume it can be item2, item3...\n   }\n\n   var x Report\n\n   // If I print APICall.buff.Bytes() here I see the valid JSON object I want to parse.\n\n   if err := json.Unmarshal([]byte(`{\n    \"report\": [\n        {\n            \"item1\": [\n                {\"name\":\"somename1\", \"someint\":\"1\", \"somefloat\":\"2.0\"},\n                {\"name\":\"somename2\", \"someint\":\"2\", \"somefloat\":\"3.0\"}\n            ],\n            \"item2\": [\n                {\"name\":\"somename1\", \"someint\":\"1\", \"somefloat\":\"2.0\"},\n                {\"name\":\"somename2\", \"someint\":\"2\", \"somefloat\":\"3.0\"}\n            ]\n        }\n    ]\n   }`), &amp;x); err != nil {\n      fmt.Println(err)\n   }\n\n   fmt.Printf(\"%+v\\n%+v\", x, x.Report[0][\"item1\"][0])\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>{Report:[map[item1:[{Name:somename1 Someint:1 Somefloat:2.0} {Name:somename2 Someint:2 Somefloat:3.0}] item2:[{Name:somename1 Someint:1 Somefloat:2.0} {Name:somename2 Someint:2 Somefloat:3.0}]]]}\n\n{Name:somename1 Someint:1 Somefloat:2.0}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user10646429"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1549028118, "creation_date": 1549025774, "question_id": 54480019, "link": "https://stackoverflow.com/questions/54480019/unmarshalling-json-with-elements-2-layers-deep", "title": "Unmarshalling JSON with elements 2 layers deep", "body": "<p>How do you extract sub-sections of a JSON structure?</p>\n\n<p>I'm parsing an API call that returns data in the following manner (trimmed for brevity):</p>\n\n<pre><code>{\n    \"report\": [\n        {\n            \"item1\": [\n                {\"name\":\"somename\", \"someint\":\"1\", \"somefloat\":\"2.0\"}\n            ]\n        }\n    ]\n}\n</code></pre>\n\n<p>So in python I would do this:</p>\n\n<p><code>\ndata = json.loads(myvar)['report'][0]['item1'][0]\nprint data['name']\n</code></p>\n\n<p>How is this done in Go? I can't change or tweak the upstream API.</p>\n\n<pre><code>type MyData struct {\n    name string\n    someint int\n    somefloat float\n}\n\nvar x MyData\n\n// If I print APICall.buff.Bytes() here I see the valid JSON object I want to parse.\n\nif err := json.Unmarshal(APICall.buff.Bytes(), &amp;MyData); err != nil {\n    log.Fatal(err)\n}\n\nfmt.Printf(\"%+v\\n\", MyData)\n\n</code></pre>\n\n<p>This runs successfully but my struct is full of empty keys.</p>\n\n<pre><code>&amp;{name: someint:0 somefloat:0}\n\n</code></pre>\n"}, {"tags": ["file", "go", "io"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user8332267"}, "edited": false, "score": 0, "creation_date": 1549027172, "post_id": 54479939, "comment_id": 95767635, "body": "Thank you, sir, That&#39;s ok now"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1549027326, "post_id": 54479939, "comment_id": 95767744, "body": "@Pwn3rGamer Actually this is already implemented in <code>os.Truncate()</code>. See edited answer."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1549027665, "last_edit_date": 1549027665, "creation_date": 1549025567, "answer_id": 54479939, "question_id": 54479808, "link": "https://stackoverflow.com/questions/54479808/how-to-remove-the-last-n-bytes-from-a-file/54479939#54479939", "title": "How to remove the last N bytes from a file", "body": "<p>Actually, this is already implemented is the <a href=\"https://golang.org/pkg/os/#Truncate\" rel=\"nofollow noreferrer\"><code>os.Truncate()</code></a> function. But this function takes the new size. So to use this, you have to first get the size of the file. For that, you may use <a href=\"https://golang.org/pkg/os/#Stat\" rel=\"nofollow noreferrer\"><code>os.Stat()</code></a>.</p>\n\n<p>Wrapping it into a function:</p>\n\n<pre><code>func truncateFile(name string, bytesToRemove int64) error {\n    fi, err := os.Stat(name)\n    if err != nil {\n        return err\n    }\n\n    return os.Truncate(name, fi.Size()-bytesToRemove)\n}\n</code></pre>\n\n<p>Using it to remove the last 5000 bytes:</p>\n\n<pre><code>if err := truncateFile(\"C:\\\\Test.zip\", 5000); err != nil {\n    fmt.Println(\"Error:\", err)\n}\n</code></pre>\n\n<p>Another alternative  is to use the <a href=\"https://golang.org/pkg/os/#File.Truncate\" rel=\"nofollow noreferrer\"><code>File.Truncate()</code></a> method for that. If we have an <code>os.File</code>, we may also use <a href=\"https://golang.org/pkg/os/#File.Stat\" rel=\"nofollow noreferrer\"><code>File.Stat()</code></a> to get its size.</p>\n\n<p>This is how it would look like:</p>\n\n<pre><code>func truncateFile(name string, bytesToRemove int64) error {\n    f, err := os.OpenFile(name, os.O_RDWR, 0644)\n    if err != nil {\n        return err\n    }\n    defer f.Close()\n\n    fi, err := f.Stat()\n    if err != nil {\n        return err\n    }\n\n    return f.Truncate(fi.Size() - bytesToRemove)\n}\n</code></pre>\n\n<p>Using it is the same. This may be preferable if we're working on a file (we have it opened) and we have to truncate it. But in that case you'd want to pass <code>os.File</code> instead of its name to <code>truncateFile()</code>.</p>\n\n<p>Note: if you try to remove more bytes than the file currently has, <code>truncateFile()</code> will return an error.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8332267"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 536, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1583653966, "creation_date": 1549025075, "last_edit_date": 1583653966, "question_id": 54479808, "link": "https://stackoverflow.com/questions/54479808/how-to-remove-the-last-n-bytes-from-a-file", "title": "How to remove the last N bytes from a file", "body": "<p>I want to delete thelast N bytes from file in Go,</p>\n"}]